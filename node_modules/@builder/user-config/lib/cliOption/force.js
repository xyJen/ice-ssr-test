var path = require('path');
var fs = require('fs-extra');
function emptyDir(dir) {
    if (fs.existsSync(dir)) {
        fs.emptyDirSync(dir);
    }
}
module.exports = function () {
    var args = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        args[_i] = arguments[_i];
    }
    var force = args[1], context = args[2], api = args[3];
    if (force) {
        var command = context.command, userConfig_1 = context.userConfig, rootDir_1 = context.rootDir;
        var onHook = api.onHook;
        onHook("before.".concat(command, ".run"), function (_a) {
            var config = _a.config;
            if (userConfig_1.vite) {
                // vite 模式缓存目录固定为 /node_modules/.vite
                emptyDir(path.join(rootDir_1, 'node_modules', '.vite'));
            }
            else {
                config.forEach(function (webpackConfig) {
                    if (webpackConfig.cache && webpackConfig.cache.cacheDirectory) {
                        emptyDir(webpackConfig.cache.cacheDirectory);
                    }
                });
            }
        });
    }
};
//# sourceMappingURL=force.js.map