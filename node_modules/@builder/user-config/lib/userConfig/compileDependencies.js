var formatPath = require('@builder/app-helpers').formatPath;
var defaultCompileDependencies = [
    'ansi-regex',
    'ansi-styles',
    'chalk',
    'query-string',
    'react-dev-utils',
    'split-on-first',
    'strict-uri-encode',
    'strip-ansi',
];
/**
 * Exclude the core-js for that it will fail to run in IE
 * @swc/helpers and @babel/runtime have been es5
 */
var skipDependenciesRegx = [/core-js/, /@swc\/helpers/, /@babel\/runtime/];
module.exports = function (config, compileDependencies) {
    var matchExclude = function (filepath) {
        filepath = formatPath(filepath);
        if (skipDependenciesRegx.some(function (regx) { return filepath.match(regx); }))
            return true;
        // compile build-plugin module for default
        var deps = [/build-plugin.*module/].concat(defaultCompileDependencies, compileDependencies).map(function (dep) {
            if (dep instanceof RegExp) {
                return dep.source;
            }
            else if (typeof dep === 'string') {
                // add default node_modules
                var matchStr = "node_modules/?.+".concat(dep, "/");
                return matchStr;
            }
            return false;
        }).filter(Boolean);
        var matchReg = deps.length ? new RegExp(deps.join('|')) : null;
        if (matchReg && matchReg.test(filepath)) {
            return false;
        }
        // exclude node_modules as default
        return /node_modules/.test(filepath);
    };
    ['jsx', 'tsx', 'swc-tsx', 'swc-jsx'].forEach(function (rule) {
        if (config.module.rules.get(rule)) {
            config.module
                .rule(rule)
                .exclude.clear()
                .add(matchExclude);
        }
    });
};
//# sourceMappingURL=compileDependencies.js.map