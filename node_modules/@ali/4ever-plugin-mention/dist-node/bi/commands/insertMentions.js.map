{"version":3,"sources":["../../../../src/bi/commands/insertMentions.ts"],"names":["insertMention","controller","suggestion","command","Commands","insertInline","type","data","moveToStartOfNextText","insertText","insertMentions","suggestions","focus","value","selection","document","start","getStart","at","endText","text","offset","mentionLength","deleteBackward","forEach"],"mappings":";;;;;;;AAAA;;AAEA;;AAEA,SAASA,aAAT,CAAuBC,UAAvB,EAA+CC,UAA/C,EAAuE;AACrE,SAAOD,UAAU,CACdE,OADI,CACIC,sBAASC,YADb,EAC2B;AAC9BC,IAAAA,IAAI,EAAE,SADwB;AAE9BC,IAAAA,IAAI,EAAEL;AAFwB,GAD3B,EAKJC,OALI,CAKIC,sBAASI,qBALb,EAMJL,OANI,CAMIC,sBAASK,UANb,EAMyB,GANzB,CAAP;AAOD;;AAEc,SAASC,cAAT,CACbT,UADa,EAEbU,WAFa,EAGb;AACAV,EAAAA,UAAU,CAACE,OAAX,CAAmBC,sBAASQ,KAA5B;AACA,QAAM;AAAEC,IAAAA;AAAF,MAAYZ,UAAlB;AACA,QAAM;AAAEa,IAAAA,SAAF;AAAaC,IAAAA;AAAb,MAA0BF,KAAhC;AACA,QAAMG,KAAK,GAAGF,SAAS,CAAEG,QAAX,CAAoBF,QAApB,CAAd;AACA,QAAMG,EAAE,GAAG,sBAAUL,KAAK,CAACM,OAAN,CAAeC,IAAzB,EAA+BJ,KAAK,CAACK,MAArC,CAAX;AACA,QAAMC,aAAa,GAAGN,KAAK,CAACK,MAAN,GAAeH,EAArC;AAEAjB,EAAAA,UAAU,CAACE,OAAX,CAAmBC,sBAASmB,cAA5B,EAA4CD,aAA5C;AACAX,EAAAA,WAAW,CAACa,OAAZ,CAAqBtB,UAAD,IAAgB;AAClCD,IAAAA,UAAU,CAACE,OAAX,CAAmBH,aAAnB,EAAkCE,UAAlC;AACD,GAFD;AAGA,SAAOD,UAAP;AACD","sourcesContent":["import { Controller, Commands, TextPoint } from '@ali/4ever-cangjie';\nimport { Suggestion } from '../types';\nimport { nearsetAt } from '../utils';\n\nfunction insertMention(controller: Controller, suggestion: Suggestion) {\n  return controller\n    .command(Commands.insertInline, {\n      type: 'mention',\n      data: suggestion,\n    })\n    .command(Commands.moveToStartOfNextText)\n    .command(Commands.insertText, ' ');\n}\n\nexport default function insertMentions(\n  controller: Controller,\n  suggestions: Suggestion[],\n) {\n  controller.command(Commands.focus);\n  const { value } = controller;\n  const { selection, document } = value;\n  const start = selection!.getStart(document) as TextPoint;\n  const at = nearsetAt(value.endText!.text, start.offset);\n  const mentionLength = start.offset - at;\n\n  controller.command(Commands.deleteBackward, mentionLength);\n  suggestions.forEach((suggestion) => {\n    controller.command(insertMention, suggestion);\n  });\n  return controller;\n}\n"],"file":"insertMentions.js"}