{"version":3,"sources":["../../../../src/bi/handlers/onCangjieInput.ts"],"names":["onCangjieInput","event","controller","next","detail","data","query","decorations","value","quickInsertDecoration","find","mark","type","command","removeMention","preventDefault"],"mappings":";;;;;;;;;AACA;;AAEA;;AACA;;AAEe,SAASA,cAAT,CACbC,KADa,EAEbC,UAFa,EAGbC,IAHa,EAIb;AACA;AACA,MAAIF,KAAK,CAACG,MAAN,CAAaC,IAAb,KAAsB,GAA1B,EAA+B;AAC7B,WAAOF,IAAI,EAAX;AACD;;AACD,MAAID,UAAU,CAACI,KAAX,CAAiB,wBAAjB,CAAJ,EAAgD;AAC9C,WAAOH,IAAI,EAAX;AACD;;AAED,MAAI,6CAAqBD,UAArB,CAAJ,EAAsC;AAEpC,UAAM;AAAEK,MAAAA;AAAF,QAAkBL,UAAU,CAACM,KAAnC,CAFoC,CAGpC;;AACA,UAAMC,qBAAqB,GAAGF,WAAW,CAACG,IAAZ,CAC5B,CAAC;AAAEC,MAAAA;AAAF,KAAD,KAAcA,IAAI,CAACC,IAAL,KAAc,SADA,CAA9B;;AAGA,QAAIH,qBAAJ,EAA2B;AACzBP,MAAAA,UAAU,CAACW,OAAX,CAAmBC,sBAAnB;AACD;;AAED,WAAO,4BAAwBZ,UAAxB,CAAP;AACD,GArBD,CAuBA;;;AACAD,EAAAA,KAAK,CAACc,cAAN;AACA,SAAO,4BAAwBb,UAAxB,CAAP;AACD","sourcesContent":["import { Controller } from '@ali/4ever-cangjie';\nimport removeMention from '../commands/removeMention';\n\nimport insertMentionSuggestion from '../commands/insertMention';\nimport isSelectionInMention from '../queries/isSelectionInMentionSuggestion';\n\nexport default function onCangjieInput(\n  event: CustomEvent,\n  controller: Controller,\n  next: () => void,\n) {\n  // 当输入 @ 的时候，触发\n  if (event.detail.data !== '@') {\n    return next();\n  }\n  if (controller.query('isCollapsedInBlockVoid')) {\n    return next();\n  }\n\n  if (isSelectionInMention(controller)) {\n\n    const { decorations } = controller.value;\n    // 若此时仍尝试呼出相同插入，则重新呼出\n    const quickInsertDecoration = decorations.find(\n      ({ mark }) => mark.type === 'mention',\n    );\n    if (quickInsertDecoration) {\n      controller.command(removeMention);\n    }\n\n    return insertMentionSuggestion(controller);\n  }\n\n  // 限制行首、或者前面有空格\n  event.preventDefault();\n  return insertMentionSuggestion(controller);\n}\n"],"file":"onCangjieInput.js"}