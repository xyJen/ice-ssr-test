{"version":3,"sources":["../../../../src/bi/handlers/createOnAction.ts"],"names":["createOnAction","onSuggestionSelected","onAction","action","controller","next","type","payload","MENTION_ACTIVE","MENTION_INSERT","suggestion","at","command","setMention","suggest","flush","MENTION_DEACTIVE","removeMention","MENTION_MULTIPLE_INSERT","suggestions","insertMentions","MENTION_PLACEHOLDER_INSERT","insertPlaceholder","MENTION_PLACEHOLDER_EXIT","text","node","exitPlaceholder","MENTION_PLACEHOLDER_CANCEL","key","cancelPlaceholder","MENTION_PLACEHOLDER_ACTIVE","Commands","moveToEndOfNode"],"mappings":";;;;;;;;;;;AAAA;;AAEA;;AAYA;;AACA;;AACA;;AACA;;AAEe,SAASA,cAAT,CAAwB;AACrCC,EAAAA;AADqC,CAAxB,EAES;AACtB,SAAO,SAASC,QAAT,CACLC,MADK,EAELC,UAFK,EAGLC,IAHK,EAIL;AACA,UAAM;AAAEC,MAAAA,IAAF;AAAQC,MAAAA;AAAR,QAAoBJ,MAA1B;;AACA,QAAIG,IAAI,KAAKE,uBAAb,EAA6B;AAC3B,aAAO,4BAAwBJ,UAAxB,CAAP;AACD;;AACD,QAAIE,IAAI,KAAKG,uBAAb,EAA6B;AAC3B,YAAM;AAAEC,QAAAA,UAAF;AAAcC,QAAAA;AAAd,UAAqBJ,OAA3B;;AACA,UAAI,CAACN,oBAAL,EAA2B;AACzB,eAAOG,UAAU,CAACQ,OAAX,CAAmBC,mBAAnB,EAA+BH,UAA/B,EAA2CC,EAA3C,CAAP;AACD;;AACDV,MAAAA,oBAAoB,CAACS,UAAD,EAAcI,OAAD,IAAa;AAC5C;AACA;AACAV,QAAAA,UAAU,CAACQ,OAAX,CAAmBC,mBAAnB,EAA+BC,OAA/B,EAAwCH,EAAxC,EAA4CI,KAA5C;AACD,OAJmB,CAApB;AAKA,aAAOX,UAAP;AACD;;AACD,QAAIE,IAAI,KAAKU,yBAAb,EAA+B;AAC7B,aAAOZ,UAAU,CAACQ,OAAX,CAAmBK,sBAAnB,CAAP;AACD;;AACD,QAAIX,IAAI,KAAKY,gCAAb,EAAsC;AACpC,YAAM;AAAEC,QAAAA;AAAF,UAAkBZ,OAAxB;AACA,aAAOH,UAAU,CAACQ,OAAX,CAAmBQ,uBAAnB,EAAmCD,WAAnC,CAAP;AACD;;AACD,QAAIb,IAAI,KAAKe,mCAAb,EAAyC;AACvC,aAAOjB,UAAU,CAACQ,OAAX,CAAmBU,gCAAnB,CAAP;AACD;;AACD,QAAIhB,IAAI,KAAKiB,iCAAb,EAAuC;AACrC,YAAM;AAAEC,QAAAA,IAAF;AAAQC,QAAAA;AAAR,UAAiBlB,OAAvB;AACA,aAAOH,UAAU,CAACQ,OAAX,CAAmBc,8BAAnB,EAAoCF,IAApC,EAA0CC,IAA1C,CAAP;AACD;;AACD,QAAInB,IAAI,KAAKqB,mCAAb,EAAyC;AACvC,YAAM;AAAEC,QAAAA;AAAF,UAAUrB,OAAhB;AACA,aAAOH,UAAU,CAACQ,OAAX,CAAmBiB,gCAAnB,EAAsCD,GAAtC,CAAP;AACD;;AACD,QAAItB,IAAI,KAAKwB,mCAAb,EAAyC;AACvC,YAAM;AAAEL,QAAAA;AAAF,UAAWlB,OAAjB;AACA,aAAOH,UAAU,CAACQ,OAAX,CAAmBmB,sBAASC,eAA5B,EAA6CP,IAA7C,CAAP;AACD;;AACD,WAAOpB,IAAI,EAAX;AACD,GA5CD;AA6CD","sourcesContent":["import { Controller, Commands, Action } from '@ali/4ever-cangjie';\nimport { MentionPluginConfig } from '../types';\nimport {\n  MENTION_ACTIVE,\n  MENTION_DEACTIVE,\n  MENTION_INSERT,\n  MENTION_MULTIPLE_INSERT,\n  MENTION_PLACEHOLDER_INSERT,\n  MENTION_PLACEHOLDER_EXIT,\n  MENTION_PLACEHOLDER_CANCEL,\n  InsertMentionPayload,\n  MENTION_PLACEHOLDER_ACTIVE,\n  MultipleInsertMentionPayload,\n} from '../actions';\nimport insertMentionSuggestion, { insertPlaceholder, exitPlaceholder } from '../commands/insertMention';\nimport insertMentions from '../commands/insertMentions';\nimport removeMention, { cancelPlaceholder } from '../commands/removeMention';\nimport setMention from '../commands/setMention';\n\nexport default function createOnAction({\n  onSuggestionSelected,\n}: MentionPluginConfig) {\n  return function onAction(\n    action: Action,\n    controller: Controller,\n    next: () => void,\n  ) {\n    const { type, payload } = action;\n    if (type === MENTION_ACTIVE) {\n      return insertMentionSuggestion(controller);\n    }\n    if (type === MENTION_INSERT) {\n      const { suggestion, at } = payload as InsertMentionPayload;\n      if (!onSuggestionSelected) {\n        return controller.command(setMention, suggestion, at);\n      }\n      onSuggestionSelected(suggestion, (suggest) => {\n        // 这里为什么要 flush 呢🤔，导致了排版模式下插入 mention 后光标移动有 BUG\n        // eslint-disable-next-line @typescript-eslint/indent\n        controller.command(setMention, suggest, at).flush();\n      });\n      return controller;\n    }\n    if (type === MENTION_DEACTIVE) {\n      return controller.command(removeMention);\n    }\n    if (type === MENTION_MULTIPLE_INSERT) {\n      const { suggestions } = payload as MultipleInsertMentionPayload;\n      return controller.command(insertMentions, suggestions);\n    }\n    if (type === MENTION_PLACEHOLDER_INSERT) {\n      return controller.command(insertPlaceholder);\n    }\n    if (type === MENTION_PLACEHOLDER_EXIT) {\n      const { text, node } = payload!;\n      return controller.command(exitPlaceholder, text, node);\n    }\n    if (type === MENTION_PLACEHOLDER_CANCEL) {\n      const { key } = payload!;\n      return controller.command(cancelPlaceholder, key);\n    }\n    if (type === MENTION_PLACEHOLDER_ACTIVE) {\n      const { node } = payload!;\n      return controller.command(Commands.moveToEndOfNode, node);\n    }\n    return next();\n  };\n}\n"],"file":"createOnAction.js"}