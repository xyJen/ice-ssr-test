"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = onCangjieInput;

var _removeMention = _interopRequireDefault(require("../commands/removeMention"));

var _insertMention = _interopRequireDefault(require("../commands/insertMention"));

var _isSelectionInMentionSuggestion = _interopRequireDefault(require("../queries/isSelectionInMentionSuggestion"));

function onCangjieInput(event, controller, next) {
  // 当输入 @ 的时候，触发
  if (event.detail.data !== '@') {
    return next();
  }

  if (controller.query('isCollapsedInBlockVoid')) {
    return next();
  }

  if ((0, _isSelectionInMentionSuggestion.default)(controller)) {
    const {
      decorations
    } = controller.value; // 若此时仍尝试呼出相同插入，则重新呼出

    const quickInsertDecoration = decorations.find(({
      mark
    }) => mark.type === 'mention');

    if (quickInsertDecoration) {
      controller.command(_removeMention.default);
    }

    return (0, _insertMention.default)(controller);
  } // 限制行首、或者前面有空格


  event.preventDefault();
  return (0, _insertMention.default)(controller);
}
//# sourceMappingURL=onCangjieInput.js.map