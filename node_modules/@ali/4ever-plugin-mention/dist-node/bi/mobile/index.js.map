{"version":3,"sources":["../../../../src/bi/mobile/index.ts"],"names":["mobileBiFactory","configs","mentionConfig","mention","mentionId","getMentionId","extraItems","renderMentionPanel","renderMark","toolbar","commands","insertMention","actions","isActions","renderNode","onCangjieInput","onCangjieBlur","onAction","action","controller","next","type","payload","MENTION_SELECT","MENTION_INSERT","suggestion","command","Commands","focus","MENTION_CANCEL_SELECT","removeMention","queries","isSelectionInMention","getMentionKeyword"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;AACA;;AACA;;AAEO,MAAMA,eAAgC,GAAIC,OAAD,IAAa;AAC3D,QAAMC,aAAa,GAAGD,OAAO,CAACE,OAAR,IAAmB,EAAzC;AACA,QAAMC,SAAS,GAAGF,aAAa,CAACG,YAAd,GACdH,aAAa,CAACG,YAAd,EADc,GAEd,EAFJ;AAIA,QAAMC,UAAU,GAAG,EAAnB;;AACA,MAAIJ,aAAa,CAACK,kBAAlB,EAAsC;AACpC;AACAD,IAAAA,UAAU,CAACE,UAAX,GAAwB,yBAAWN,aAAa,CAACK,kBAAzB,CAAxB;AACD;;AAED,SAAO,EACL,GAAG,mBAAU,EAAV,CADE;AAELE,IAAAA,OAAO,EAAE,sBAAQP,aAAR,CAFJ;AAGLQ,IAAAA,QAAQ,EAAE;AACRC,MAAAA,aAAa,EAAbA;AADQ,KAHL;AAMLC,IAAAA,OAAO,EAAPA,gBANK;AAOLC,IAAAA,SAAS,EAATA,kBAPK;AAQLC,IAAAA,UAAU,EAAE,yBAAWV,SAAX,EAAsBF,aAAtB,CARP;AASLa,IAAAA,cAAc,EAAdA,uBATK;AAULC,IAAAA,aAAa,EAAbA,sBAVK;;AAWLC,IAAAA,QAAQ,CAACC,MAAD,EAASC,UAAT,EAAqBC,IAArB,EAA2B;AACjC,YAAM;AAAEC,QAAAA,IAAF;AAAQC,QAAAA;AAAR,UAAoBJ,MAA1B;;AACA,UAAIG,IAAI,KAAKE,uBAAb,EAA6B;AAC3B,qCAAkBJ,UAAlB;AACA,eAAOA,UAAP;AACD;;AACD,UAAIE,IAAI,KAAKG,uBAAb,EAA6B;AAC3B,cAAM;AAAEC,UAAAA;AAAF,YAAiBH,OAAvB;AACAH,QAAAA,UAAU,CAACO,OAAX,CAAmBC,sBAASC,KAA5B;AACA,eAAOT,UAAU,CAACO,OAAX,CAAmBf,sBAAnB,EAAkCc,UAAlC,CAAP;AACD;;AACD,UAAIJ,IAAI,KAAKQ,8BAAb,EAAoC;AAClC,eAAOV,UAAU,CAACO,OAAX,CAAmBI,sBAAnB,CAAP;AACD;;AACD,aAAOV,IAAI,EAAX;AACD,KA1BI;;AA2BLW,IAAAA,OAAO,EAAE;AACPC,MAAAA,oBAAoB,EAApBA,0CADO;AAEPC,MAAAA,iBAAiB,EAAjBA;AAFO,KA3BJ;AA+BL,OAAG3B;AA/BE,GAAP;AAiCD,CA7CM","sourcesContent":["import { Commands, MobileBiFactory } from '@ali/4ever-cangjie';\nimport toolbar from './toolbar';\nimport renderNode from './renderNode';\nimport onCangjieInput from './onCangjieInput';\nimport onCangjieBlur from './onCangjieBlur';\nimport insertMention from './insertMention';\nimport { isSelectionInMention } from '../queries/isSelectionInMention';\nimport getMentionKeyword from '../queries/getMentionKeyword';\nimport insertMentionMark from '../commands/insertMention';\nimport { Suggestion } from '../types';\nimport { actions, isActions, MENTION_CANCEL_SELECT, MENTION_INSERT, MENTION_SELECT } from '../actions';\nimport removeMention from './removeMention';\nimport { moFactory } from '../../mo';\nimport renderMark from './renderMark';\n\nexport const mobileBiFactory: MobileBiFactory = (configs) => {\n  const mentionConfig = configs.mention || {};\n  const mentionId = mentionConfig.getMentionId\n    ? mentionConfig.getMentionId()\n    : '';\n\n  const extraItems = {};\n  if (mentionConfig.renderMentionPanel) {\n    // @ts-ignore\n    extraItems.renderMark = renderMark(mentionConfig.renderMentionPanel);\n  }\n\n  return {\n    ...moFactory({}),\n    toolbar: toolbar(mentionConfig),\n    commands: {\n      insertMention,\n    },\n    actions,\n    isActions,\n    renderNode: renderNode(mentionId, mentionConfig),\n    onCangjieInput,\n    onCangjieBlur,\n    onAction(action, controller, next) {\n      const { type, payload } = action;\n      if (type === MENTION_SELECT) {\n        insertMentionMark(controller);\n        return controller;\n      }\n      if (type === MENTION_INSERT) {\n        const { suggestion } = payload as Suggestion;\n        controller.command(Commands.focus);\n        return controller.command(insertMention, suggestion);\n      }\n      if (type === MENTION_CANCEL_SELECT) {\n        return controller.command(removeMention);\n      }\n      return next();\n    },\n    queries: {\n      isSelectionInMention,\n      getMentionKeyword,\n    },\n    ...extraItems,\n  };\n};\n"],"file":"index.js"}