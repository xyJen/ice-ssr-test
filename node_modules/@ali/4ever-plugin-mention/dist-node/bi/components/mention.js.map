{"version":3,"sources":["../../../../src/bi/components/mention.tsx"],"names":["returnNull","Mention","React","Component","handleMentionHover","mentionConfig","node","props","onMentionHover","componentDidMount","mentionId","id","data","dom","ReactDOM","findDOMNode","scrollIntoView","render","attributes","controller","isSelected","injections","Placeholder","selection","value","name","login","isPlaceholder","text","getFirstText","leaf","leaves","marks","currentUser","getCurrentUser","onMentionClick","locale","isSelf","toString","style","handleMentionClick","event","preventDefault","stopPropagation","isCollapsed"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport {\n  Text,\n  Inline,\n  Controller,\n  RenderMarkProps,\n  Decoration,\n  Injection,\n} from '@ali/4ever-cangjie';\nimport { marksToStyle as convertMarks } from '@ali/4ever-plugin-marks';\nimport MentionComponent from '../../components/mention'\nimport { MentionPluginConfig } from '../types';\nimport { MentionNameWrapper } from '../../components/styled';\n\nexport interface MentionProps {\n  node: Inline;\n  attributes: RenderMarkProps['attributes'];\n  isSelected: boolean;\n  mentionId: number;\n  decorations?: Decoration[];\n  controller: Controller;\n  mentionConfig: MentionPluginConfig;\n  injections?: Injection[];\n  Placeholder?: React.ComponentType<any>;\n}\n\nconst returnNull = () => null;\n\nclass Mention extends React.Component<MentionProps> {\n  componentDidMount() {\n    const { node, mentionId } = this.props;\n    const { id } = node.data;\n    if (mentionId && mentionId === id) {\n      // eslint-disable-next-line react/no-find-dom-node\n      const dom = ReactDOM.findDOMNode(this) as HTMLDivElement;\n      dom.scrollIntoView();\n    }\n  }\n\n  handleMentionHover = () => {\n    const { mentionConfig, node } = this.props;\n    const { onMentionHover } = mentionConfig;\n    if (onMentionHover) {\n      onMentionHover(node);\n    }\n  };\n\n  render() {\n    const {\n      node,\n      attributes,\n      controller,\n      isSelected,\n      injections,\n      Placeholder,\n      mentionConfig\n    } = this.props;\n    const { selection } = controller.value;\n    const { id, name, login, isPlaceholder } = node.data;\n    const text = node.getFirstText() as Text;\n    const leaf = text.leaves[0];\n    const marks = leaf ? leaf.marks : [];\n    const currentUser = mentionConfig.getCurrentUser ? mentionConfig.getCurrentUser() : returnNull;\n    const { onMentionClick, locale = {} } = mentionConfig;\n    const isSelf = (currentUser && login)\n      ? currentUser.toString() === login.toString()\n      : false;\n    const style = convertMarks(marks);\n\n    const handleMentionClick = (event: React.MouseEvent) => {\n      event.preventDefault();\n      event.stopPropagation();\n      if (onMentionClick) {\n        onMentionClick(node);\n      }\n    };\n\n    if (isPlaceholder && !!Placeholder) {\n      return (<Placeholder\n        controller={controller}\n        injections={injections}\n        node={node}\n        mentionConfig={mentionConfig}\n        locale={locale}\n        isSelected={isSelected && selection.isCollapsed}\n      />);\n    }\n\n    return (\n      <MentionComponent\n        {...attributes}\n        data-type=\"mention\"\n        isSelf={isSelf}\n        id={id}\n        isSelected={isSelected && selection.isCollapsed}\n        onClick={handleMentionClick}\n        onMouseEnter={this.handleMentionHover}\n        style={style}\n        node={node}\n      >\n        @\n        <MentionNameWrapper>{name}</MentionNameWrapper>\n      </MentionComponent>\n    );\n  }\n}\n\nexport default Mention;\n"],"file":"mention.js"}