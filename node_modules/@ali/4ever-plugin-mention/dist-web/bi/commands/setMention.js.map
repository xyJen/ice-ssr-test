{"version":3,"sources":["../../../../src/bi/commands/setMention.ts"],"names":["Commands","Inline","removeMention","nearsetAt","controller","suggestion","at","value","selection","document","injections","start","getStart","offset","endText","text","mentionLength","inline","create","type","data","id","login","name","avatarUrl","excludeInjections","filter","i","key","setInjections","command","setNodeByKey","focus","moveToStartOfNextText","deleteBackward","insertInline"],"mappings":"AAAA,SAAqBA,QAArB,EAA+BC,MAA/B,QAAmE,oBAAnE;AACA,OAAOC,aAAP;AACA,SAASC,SAAT;AAGA,gBAAe,UAACC,UAAD,EAAyBC,UAAzB,EAAiDC,EAAjD,EAAiE;AAC9E,MAAI,CAACD,UAAL,EAAiB,OAAOD,UAAP;AAD6D,MAEtEG,KAFsE,GAE5DH,UAF4D,CAEtEG,KAFsE;AAAA,MAGtEC,SAHsE,GAGlCD,KAHkC,CAGtEC,SAHsE;AAAA,MAG3DC,QAH2D,GAGlCF,KAHkC,CAG3DE,QAH2D;AAAA,MAGjDC,UAHiD,GAGlCH,KAHkC,CAGjDG,UAHiD;AAI9E,MAAMC,KAAK,GAAGH,SAAS,CAACI,QAAV,CAAmBH,QAAnB,CAAd;AAEA,MAAMI,MAAM,GAAGV,SAAS,CAACI,KAAK,CAACO,OAAN,CAAeC,IAAhB,EAAsBJ,KAAK,CAACE,MAA5B,CAAxB;AACA,MAAMG,aAAa,GAAGL,KAAK,CAACE,MAAN,GAAeA,MAArC;AAEA,MAAMI,MAAM,GAAGhB,MAAM,CAACiB,MAAP,CAAc;AAC3BC,IAAAA,IAAI,EAAE,SADqB;AAE3BC,IAAAA,IAAI,EAAE;AACJC,MAAAA,EAAE,EAAEhB,UAAU,CAACgB,EADX;AAEJC,MAAAA,KAAK,EAAEjB,UAAU,CAACiB,KAFd;AAGJC,MAAAA,IAAI,EAAElB,UAAU,CAACkB,IAHb;AAIJC,MAAAA,SAAS,EAAEnB,UAAU,CAACmB;AAJlB;AAFqB,GAAd,CAAf,CAT8E,CAmB9E;;AACA,MAAIlB,EAAJ,EAAQ;AACN,QAAMmB,iBAA8B,GAAGf,UAAU,CAACgB,MAAX,CAAkB,UAACC,CAAD;AAAA,aAAOA,CAAC,CAACC,GAAF,KAAUtB,EAAjB;AAAA,KAAlB,CAAvC;AACA,WAAOF,UAAU,CACdyB,aADI,WACcJ,iBADd,GAEJK,OAFI,CAEI9B,QAAQ,CAAC+B,YAFb,EAE2BzB,EAF3B,EAE+B;AAClCc,MAAAA,IAAI,EAAEH,MAAM,CAACG;AADqB,KAF/B,EAKJU,OALI,CAKI9B,QAAQ,CAACgC,KALb,EAMJF,OANI,CAMI9B,QAAQ,CAACiC,qBANb,CAAP;AAOD;;AAED7B,EAAAA,UAAU,CACP0B,OADH,CACW9B,QAAQ,CAACkC,cADpB,EACoClB,aADpC,EAEGc,OAFH,CAEW9B,QAAQ,CAACgC,KAFpB,EAGGF,OAHH,CAGW9B,QAAQ,CAACmC,YAHpB,EAGkClB,MAHlC,EAIGa,OAJH,CAIW9B,QAAQ,CAACiC,qBAJpB;AAMA,SAAO/B,aAAa,CAACE,UAAD,CAApB;AACD,CAtCD","sourcesContent":["import { Controller, Commands, Inline, Injection, TextPoint } from '@ali/4ever-cangjie';\nimport removeMention from './removeMention';\nimport { nearsetAt } from '../utils';\nimport { Suggestion } from '../types';\n\nexport default (controller: Controller, suggestion: Suggestion, at?: string) => {\n  if (!suggestion) return controller;\n  const { value } = controller;\n  const { selection, document, injections } = value;\n  const start = selection.getStart(document) as TextPoint;\n\n  const offset = nearsetAt(value.endText!.text, start.offset);\n  const mentionLength = start.offset - offset;\n\n  const inline = Inline.create({\n    type: 'mention',\n    data: {\n      id: suggestion.id,\n      login: suggestion.login,\n      name: suggestion.name,\n      avatarUrl: suggestion.avatarUrl,\n    },\n  });\n\n  // 如果是 placeholder 类型的 mention 做 setData\n  if (at) {\n    const excludeInjections: Injection[] = injections.filter((i) => i.key !== at);\n    return controller\n      .setInjections([...excludeInjections])\n      .command(Commands.setNodeByKey, at, {\n        data: inline.data,\n      })\n      .command(Commands.focus)\n      .command(Commands.moveToStartOfNextText);\n  }\n\n  controller\n    .command(Commands.deleteBackward, mentionLength)\n    .command(Commands.focus)\n    .command(Commands.insertInline, inline)\n    .command(Commands.moveToStartOfNextText);\n\n  return removeMention(controller);\n};\n"],"file":"setMention.js"}