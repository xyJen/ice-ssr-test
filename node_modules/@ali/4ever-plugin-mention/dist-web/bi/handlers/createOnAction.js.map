{"version":3,"sources":["../../../../src/bi/handlers/createOnAction.ts"],"names":["Commands","MENTION_ACTIVE","MENTION_DEACTIVE","MENTION_INSERT","MENTION_MULTIPLE_INSERT","MENTION_PLACEHOLDER_INSERT","MENTION_PLACEHOLDER_EXIT","MENTION_PLACEHOLDER_CANCEL","MENTION_PLACEHOLDER_ACTIVE","insertMentionSuggestion","insertPlaceholder","exitPlaceholder","insertMentions","removeMention","cancelPlaceholder","setMention","createOnAction","onSuggestionSelected","onAction","action","controller","next","type","payload","suggestion","at","command","suggest","flush","suggestions","text","node","key","moveToEndOfNode"],"mappings":"AAAA,SAAqBA,QAArB,QAA6C,oBAA7C;AAEA,SACEC,cADF,EAEEC,gBAFF,EAGEC,cAHF,EAIEC,uBAJF,EAKEC,0BALF,EAMEC,wBANF,EAOEC,0BAPF,EASEC,0BATF;AAYA,OAAOC,uBAAP,IAAkCC,iBAAlC,EAAqDC,eAArD;AACA,OAAOC,cAAP;AACA,OAAOC,aAAP,IAAwBC,iBAAxB;AACA,OAAOC,UAAP;AAEA,eAAe,SAASC,cAAT,OAES;AAAA,MADtBC,oBACsB,QADtBA,oBACsB;AACtB,SAAO,SAASC,QAAT,CACLC,MADK,EAELC,UAFK,EAGLC,IAHK,EAIL;AAAA,QACQC,IADR,GAC0BH,MAD1B,CACQG,IADR;AAAA,QACcC,OADd,GAC0BJ,MAD1B,CACcI,OADd;;AAEA,QAAID,IAAI,KAAKrB,cAAb,EAA6B;AAC3B,aAAOQ,uBAAuB,CAACW,UAAD,CAA9B;AACD;;AACD,QAAIE,IAAI,KAAKnB,cAAb,EAA6B;AAAA,kBACAoB,OADA;AAAA,UACnBC,UADmB,SACnBA,UADmB;AAAA,UACPC,EADO,SACPA,EADO;;AAE3B,UAAI,CAACR,oBAAL,EAA2B;AACzB,eAAOG,UAAU,CAACM,OAAX,CAAmBX,UAAnB,EAA+BS,UAA/B,EAA2CC,EAA3C,CAAP;AACD;;AACDR,MAAAA,oBAAoB,CAACO,UAAD,EAAa,UAACG,OAAD,EAAa;AAC5C;AACA;AACAP,QAAAA,UAAU,CAACM,OAAX,CAAmBX,UAAnB,EAA+BY,OAA/B,EAAwCF,EAAxC,EAA4CG,KAA5C;AACD,OAJmB,CAApB;AAKA,aAAOR,UAAP;AACD;;AACD,QAAIE,IAAI,KAAKpB,gBAAb,EAA+B;AAC7B,aAAOkB,UAAU,CAACM,OAAX,CAAmBb,aAAnB,CAAP;AACD;;AACD,QAAIS,IAAI,KAAKlB,uBAAb,EAAsC;AAAA,kBACZmB,OADY;AAAA,UAC5BM,WAD4B,SAC5BA,WAD4B;AAEpC,aAAOT,UAAU,CAACM,OAAX,CAAmBd,cAAnB,EAAmCiB,WAAnC,CAAP;AACD;;AACD,QAAIP,IAAI,KAAKjB,0BAAb,EAAyC;AACvC,aAAOe,UAAU,CAACM,OAAX,CAAmBhB,iBAAnB,CAAP;AACD;;AACD,QAAIY,IAAI,KAAKhB,wBAAb,EAAuC;AAAA,kBACdiB,OADc;AAAA,UAC7BO,IAD6B,SAC7BA,IAD6B;AAAA,UACvBC,IADuB,SACvBA,IADuB;AAErC,aAAOX,UAAU,CAACM,OAAX,CAAmBf,eAAnB,EAAoCmB,IAApC,EAA0CC,IAA1C,CAAP;AACD;;AACD,QAAIT,IAAI,KAAKf,0BAAb,EAAyC;AAAA,kBACvBgB,OADuB;AAAA,UAC/BS,GAD+B,SAC/BA,GAD+B;AAEvC,aAAOZ,UAAU,CAACM,OAAX,CAAmBZ,iBAAnB,EAAsCkB,GAAtC,CAAP;AACD;;AACD,QAAIV,IAAI,KAAKd,0BAAb,EAAyC;AAAA,kBACtBe,OADsB;AAAA,UAC/BQ,KAD+B,SAC/BA,IAD+B;AAEvC,aAAOX,UAAU,CAACM,OAAX,CAAmB1B,QAAQ,CAACiC,eAA5B,EAA6CF,KAA7C,CAAP;AACD;;AACD,WAAOV,IAAI,EAAX;AACD,GA5CD;AA6CD","sourcesContent":["import { Controller, Commands, Action } from '@ali/4ever-cangjie';\nimport { MentionPluginConfig } from '../types';\nimport {\n  MENTION_ACTIVE,\n  MENTION_DEACTIVE,\n  MENTION_INSERT,\n  MENTION_MULTIPLE_INSERT,\n  MENTION_PLACEHOLDER_INSERT,\n  MENTION_PLACEHOLDER_EXIT,\n  MENTION_PLACEHOLDER_CANCEL,\n  InsertMentionPayload,\n  MENTION_PLACEHOLDER_ACTIVE,\n  MultipleInsertMentionPayload,\n} from '../actions';\nimport insertMentionSuggestion, { insertPlaceholder, exitPlaceholder } from '../commands/insertMention';\nimport insertMentions from '../commands/insertMentions';\nimport removeMention, { cancelPlaceholder } from '../commands/removeMention';\nimport setMention from '../commands/setMention';\n\nexport default function createOnAction({\n  onSuggestionSelected,\n}: MentionPluginConfig) {\n  return function onAction(\n    action: Action,\n    controller: Controller,\n    next: () => void,\n  ) {\n    const { type, payload } = action;\n    if (type === MENTION_ACTIVE) {\n      return insertMentionSuggestion(controller);\n    }\n    if (type === MENTION_INSERT) {\n      const { suggestion, at } = payload as InsertMentionPayload;\n      if (!onSuggestionSelected) {\n        return controller.command(setMention, suggestion, at);\n      }\n      onSuggestionSelected(suggestion, (suggest) => {\n        // 这里为什么要 flush 呢🤔，导致了排版模式下插入 mention 后光标移动有 BUG\n        // eslint-disable-next-line @typescript-eslint/indent\n        controller.command(setMention, suggest, at).flush();\n      });\n      return controller;\n    }\n    if (type === MENTION_DEACTIVE) {\n      return controller.command(removeMention);\n    }\n    if (type === MENTION_MULTIPLE_INSERT) {\n      const { suggestions } = payload as MultipleInsertMentionPayload;\n      return controller.command(insertMentions, suggestions);\n    }\n    if (type === MENTION_PLACEHOLDER_INSERT) {\n      return controller.command(insertPlaceholder);\n    }\n    if (type === MENTION_PLACEHOLDER_EXIT) {\n      const { text, node } = payload!;\n      return controller.command(exitPlaceholder, text, node);\n    }\n    if (type === MENTION_PLACEHOLDER_CANCEL) {\n      const { key } = payload!;\n      return controller.command(cancelPlaceholder, key);\n    }\n    if (type === MENTION_PLACEHOLDER_ACTIVE) {\n      const { node } = payload!;\n      return controller.command(Commands.moveToEndOfNode, node);\n    }\n    return next();\n  };\n}\n"],"file":"createOnAction.js"}