{"version":3,"sources":["../../../../src/bi/handlers/onCangjiePaste.ts"],"names":["Commands","environment","createOnCangjiePaste","config","onCangjiePaste","event","controller","next","IS_MOBILE","hasPopup","value","decorations","some","d","mark","type","clipboardData","query","fragment","getFragment","command","insertText","text"],"mappings":"AAAA,SAASA,QAAT,EAAuCC,WAAvC,QAA0E,oBAA1E;AAEA,eAAe,SAASC,oBAAT,CACbC,MADa,EAEa;AAC1B,SAAO,SAASC,cAAT,CAAwBC,KAAxB,EAA+BC,UAA/B,EAAuDC,IAAvD,EAA6D;AAClE,QAAIN,WAAW,CAACO,SAAhB,EAA2B;AACzB,aAAOD,IAAI,EAAX;AACD;;AACD,QAAME,QAAQ,GAAGH,UAAU,CAACI,KAAX,CAAiBC,WAAjB,CAA6BC,IAA7B,CACf,UAACC,CAAD;AAAA,aAAOA,CAAC,CAACC,IAAF,CAAOC,IAAP,KAAgB,SAAhB,IAA6BF,CAAC,CAACC,IAAF,CAAOC,IAAP,KAAgB,cAApD;AAAA,KADe,CAAjB;;AAGA,QAAI,CAACN,QAAL,EAAe;AACb,aAAOF,IAAI,EAAX;AACD;;AACD,QAAMS,aAAa,GAAGV,UAAU,CAACW,KAAX,CAAiB,kBAAjB,EAAqCZ,KAArC,CAAtB;AAEA,QAAMa,QAAQ,GAAGF,aAAH,oBAAGA,aAAa,CAAEG,WAAf,EAAjB;;AACA,QAAI,CAACD,QAAL,EAAe;AACb,aAAOX,IAAI,EAAX;AACD;;AACD,WAAOD,UAAU,CAACc,OAAX,CAAmBpB,QAAQ,CAACqB,UAA5B,EAAwCH,QAAQ,CAACI,IAAjD,CAAP;AACD,GAjBD;AAkBD","sourcesContent":["import { Commands, Controller, Plugin, environment, BiPluginConfig } from '@ali/4ever-cangjie';\n\nexport default function createOnCangjiePaste(\n  config: BiPluginConfig,\n): Plugin['onCangjiePaste'] {\n  return function onCangjiePaste(event, controller: Controller, next) {\n    if (environment.IS_MOBILE) {\n      return next();\n    }\n    const hasPopup = controller.value.decorations.some(\n      (d) => d.mark.type === 'mention' || d.mark.type === 'quick-insert',\n    );\n    if (!hasPopup) {\n      return next();\n    }\n    const clipboardData = controller.query('getClipboardData', event);\n\n    const fragment = clipboardData?.getFragment();\n    if (!fragment) {\n      return next();\n    }\n    return controller.command(Commands.insertText, fragment.text);\n  };\n}\n"],"file":"onCangjiePaste.js"}