{"version":3,"sources":["../../../../src/bi/handlers/onCangjieInput.ts"],"names":["removeMention","insertMentionSuggestion","isSelectionInMention","onCangjieInput","event","controller","next","detail","data","query","decorations","value","quickInsertDecoration","find","mark","type","command","preventDefault"],"mappings":"AACA,OAAOA,aAAP;AAEA,OAAOC,uBAAP;AACA,OAAOC,oBAAP;AAEA,eAAe,SAASC,cAAT,CACbC,KADa,EAEbC,UAFa,EAGbC,IAHa,EAIb;AACA;AACA,MAAIF,KAAK,CAACG,MAAN,CAAaC,IAAb,KAAsB,GAA1B,EAA+B;AAC7B,WAAOF,IAAI,EAAX;AACD;;AACD,MAAID,UAAU,CAACI,KAAX,CAAiB,wBAAjB,CAAJ,EAAgD;AAC9C,WAAOH,IAAI,EAAX;AACD;;AAED,MAAIJ,oBAAoB,CAACG,UAAD,CAAxB,EAAsC;AAAA,QAE5BK,WAF4B,GAEZL,UAAU,CAACM,KAFC,CAE5BD,WAF4B,EAGpC;;AACA,QAAME,qBAAqB,GAAGF,WAAW,CAACG,IAAZ,CAC5B;AAAA,UAAGC,IAAH,QAAGA,IAAH;AAAA,aAAcA,IAAI,CAACC,IAAL,KAAc,SAA5B;AAAA,KAD4B,CAA9B;;AAGA,QAAIH,qBAAJ,EAA2B;AACzBP,MAAAA,UAAU,CAACW,OAAX,CAAmBhB,aAAnB;AACD;;AAED,WAAOC,uBAAuB,CAACI,UAAD,CAA9B;AACD,GArBD,CAuBA;;;AACAD,EAAAA,KAAK,CAACa,cAAN;AACA,SAAOhB,uBAAuB,CAACI,UAAD,CAA9B;AACD","sourcesContent":["import { Controller } from '@ali/4ever-cangjie';\nimport removeMention from '../commands/removeMention';\n\nimport insertMentionSuggestion from '../commands/insertMention';\nimport isSelectionInMention from '../queries/isSelectionInMentionSuggestion';\n\nexport default function onCangjieInput(\n  event: CustomEvent,\n  controller: Controller,\n  next: () => void,\n) {\n  // 当输入 @ 的时候，触发\n  if (event.detail.data !== '@') {\n    return next();\n  }\n  if (controller.query('isCollapsedInBlockVoid')) {\n    return next();\n  }\n\n  if (isSelectionInMention(controller)) {\n\n    const { decorations } = controller.value;\n    // 若此时仍尝试呼出相同插入，则重新呼出\n    const quickInsertDecoration = decorations.find(\n      ({ mark }) => mark.type === 'mention',\n    );\n    if (quickInsertDecoration) {\n      controller.command(removeMention);\n    }\n\n    return insertMentionSuggestion(controller);\n  }\n\n  // 限制行首、或者前面有空格\n  event.preventDefault();\n  return insertMentionSuggestion(controller);\n}\n"],"file":"onCangjieInput.js"}