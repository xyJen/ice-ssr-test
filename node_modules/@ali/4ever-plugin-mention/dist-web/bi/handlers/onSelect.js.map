{"version":3,"sources":["../../../../src/bi/handlers/onSelect.ts"],"names":["removeMention","onSelect","event","controller","next","value","selection","decorations","mentionDecorations","find","item","mark","type","isCollapsed","focus","offset","start","end"],"mappings":"AACA,OAAOA,aAAP;AAEA,eAAe,SAASC,QAAT,CACbC,KADa,EAEbC,UAFa,EAGbC,IAHa,EAIb;AAAA,MACQC,KADR,GACkBF,UADlB,CACQE,KADR;AAAA,MAEQC,SAFR,GAEmCD,KAFnC,CAEQC,SAFR;AAAA,MAEmBC,WAFnB,GAEmCF,KAFnC,CAEmBE,WAFnB;AAGA,MAAMC,kBAAkB,GAAGD,WAAW,CAACE,IAAZ,CACzB,UAAAC,IAAI;AAAA,WAAIA,IAAI,CAACC,IAAL,CAAUC,IAAV,KAAmB,SAAvB;AAAA,GADqB,CAA3B;AAHA,MAMQC,WANR,GAMwBP,SANxB,CAMQO,WANR;AAOA,MAAMC,KAAK,GAAGR,SAAS,CAACQ,KAAxB;;AACA,MAAI,CAACD,WAAL,EAAkB;AAChBb,IAAAA,aAAa,CAACG,UAAD,CAAb;AACD;;AACD,MAAIU,WAAW,IAAIL,kBAAnB,EAAuC;AACrC,QACEM,KAAK,CAACC,MAAN,GAAeP,kBAAkB,CAACQ,KAAnB,CAAyBD,MAAxC,IACAD,KAAK,CAACC,MAAN,GAAeP,kBAAkB,CAACS,GAAnB,CAAuBF,MAFxC,EAGE;AACAf,MAAAA,aAAa,CAACG,UAAD,CAAb;AACD;AACF;;AACD,SAAOC,IAAI,EAAX;AACD","sourcesContent":["import { Controller, TextPoint } from '@ali/4ever-cangjie';\nimport removeMention from '../commands/removeMention';\n\nexport default function onSelect(\n  event: KeyboardEvent,\n  controller: Controller,\n  next: () => void\n) {\n  const { value } = controller;\n  const { selection, decorations } = value;\n  const mentionDecorations = decorations.find(\n    item => item.mark.type === 'mention',\n  );\n  const { isCollapsed } = selection;\n  const focus = selection.focus as TextPoint;\n  if (!isCollapsed) {\n    removeMention(controller);\n  }\n  if (isCollapsed && mentionDecorations) {\n    if (\n      focus.offset > mentionDecorations.start.offset ||\n      focus.offset < mentionDecorations.end.offset\n    ) {\n      removeMention(controller);\n    }\n  }\n  return next();\n}\n"],"file":"onSelect.js"}