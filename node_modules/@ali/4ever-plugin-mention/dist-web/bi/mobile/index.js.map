{"version":3,"sources":["../../../../src/bi/mobile/index.ts"],"names":["Commands","toolbar","renderNode","onCangjieInput","onCangjieBlur","insertMention","isSelectionInMention","getMentionKeyword","insertMentionMark","actions","isActions","MENTION_CANCEL_SELECT","MENTION_INSERT","MENTION_SELECT","removeMention","moFactory","renderMark","mobileBiFactory","configs","mentionConfig","mention","mentionId","getMentionId","extraItems","renderMentionPanel","commands","onAction","action","controller","next","type","payload","suggestion","command","focus","queries"],"mappings":";AAAA,SAASA,QAAT,QAA0C,oBAA1C;AACA,OAAOC,OAAP;AACA,OAAOC,UAAP;AACA,OAAOC,cAAP;AACA,OAAOC,aAAP;AACA,OAAOC,aAAP;AACA,SAASC,oBAAT;AACA,OAAOC,iBAAP;AACA,OAAOC,iBAAP;AAEA,SAASC,OAAT,EAAkBC,SAAlB,EAA6BC,qBAA7B,EAAoDC,cAApD,EAAoEC,cAApE;AACA,OAAOC,aAAP;AACA,SAASC,SAAT;AACA,OAAOC,UAAP;AAEA,OAAO,IAAMC,eAAgC,GAAG,SAAnCA,eAAmC,CAACC,OAAD,EAAa;AAC3D,MAAMC,aAAa,GAAGD,OAAO,CAACE,OAAR,IAAmB,EAAzC;AACA,MAAMC,SAAS,GAAGF,aAAa,CAACG,YAAd,GACdH,aAAa,CAACG,YAAd,EADc,GAEd,EAFJ;AAIA,MAAMC,UAAU,GAAG,EAAnB;;AACA,MAAIJ,aAAa,CAACK,kBAAlB,EAAsC;AACpC;AACAD,IAAAA,UAAU,CAACP,UAAX,GAAwBA,UAAU,CAACG,aAAa,CAACK,kBAAf,CAAlC;AACD;;AAED,sBACKT,SAAS,CAAC,EAAD,CADd;AAEEd,IAAAA,OAAO,EAAEA,OAAO,CAACkB,aAAD,CAFlB;AAGEM,IAAAA,QAAQ,EAAE;AACRpB,MAAAA,aAAa,EAAbA;AADQ,KAHZ;AAMEI,IAAAA,OAAO,EAAPA,OANF;AAOEC,IAAAA,SAAS,EAATA,SAPF;AAQER,IAAAA,UAAU,EAAEA,UAAU,CAACmB,SAAD,EAAYF,aAAZ,CARxB;AASEhB,IAAAA,cAAc,EAAdA,cATF;AAUEC,IAAAA,aAAa,EAAbA,aAVF;AAWEsB,IAAAA,QAXF,oBAWWC,MAXX,EAWmBC,UAXnB,EAW+BC,IAX/B,EAWqC;AAAA,UACzBC,IADyB,GACPH,MADO,CACzBG,IADyB;AAAA,UACnBC,OADmB,GACPJ,MADO,CACnBI,OADmB;;AAEjC,UAAID,IAAI,KAAKjB,cAAb,EAA6B;AAC3BL,QAAAA,iBAAiB,CAACoB,UAAD,CAAjB;AACA,eAAOA,UAAP;AACD;;AACD,UAAIE,IAAI,KAAKlB,cAAb,EAA6B;AAAA,mBACJmB,OADI;AAAA,YACnBC,UADmB,QACnBA,UADmB;AAE3BJ,QAAAA,UAAU,CAACK,OAAX,CAAmBjC,QAAQ,CAACkC,KAA5B;AACA,eAAON,UAAU,CAACK,OAAX,CAAmB5B,aAAnB,EAAkC2B,UAAlC,CAAP;AACD;;AACD,UAAIF,IAAI,KAAKnB,qBAAb,EAAoC;AAClC,eAAOiB,UAAU,CAACK,OAAX,CAAmBnB,aAAnB,CAAP;AACD;;AACD,aAAOe,IAAI,EAAX;AACD,KA1BH;AA2BEM,IAAAA,OAAO,EAAE;AACP7B,MAAAA,oBAAoB,EAApBA,oBADO;AAEPC,MAAAA,iBAAiB,EAAjBA;AAFO;AA3BX,KA+BKgB,UA/BL;AAiCD,CA7CM","sourcesContent":["import { Commands, MobileBiFactory } from '@ali/4ever-cangjie';\nimport toolbar from './toolbar';\nimport renderNode from './renderNode';\nimport onCangjieInput from './onCangjieInput';\nimport onCangjieBlur from './onCangjieBlur';\nimport insertMention from './insertMention';\nimport { isSelectionInMention } from '../queries/isSelectionInMention';\nimport getMentionKeyword from '../queries/getMentionKeyword';\nimport insertMentionMark from '../commands/insertMention';\nimport { Suggestion } from '../types';\nimport { actions, isActions, MENTION_CANCEL_SELECT, MENTION_INSERT, MENTION_SELECT } from '../actions';\nimport removeMention from './removeMention';\nimport { moFactory } from '../../mo';\nimport renderMark from './renderMark';\n\nexport const mobileBiFactory: MobileBiFactory = (configs) => {\n  const mentionConfig = configs.mention || {};\n  const mentionId = mentionConfig.getMentionId\n    ? mentionConfig.getMentionId()\n    : '';\n\n  const extraItems = {};\n  if (mentionConfig.renderMentionPanel) {\n    // @ts-ignore\n    extraItems.renderMark = renderMark(mentionConfig.renderMentionPanel);\n  }\n\n  return {\n    ...moFactory({}),\n    toolbar: toolbar(mentionConfig),\n    commands: {\n      insertMention,\n    },\n    actions,\n    isActions,\n    renderNode: renderNode(mentionId, mentionConfig),\n    onCangjieInput,\n    onCangjieBlur,\n    onAction(action, controller, next) {\n      const { type, payload } = action;\n      if (type === MENTION_SELECT) {\n        insertMentionMark(controller);\n        return controller;\n      }\n      if (type === MENTION_INSERT) {\n        const { suggestion } = payload as Suggestion;\n        controller.command(Commands.focus);\n        return controller.command(insertMention, suggestion);\n      }\n      if (type === MENTION_CANCEL_SELECT) {\n        return controller.command(removeMention);\n      }\n      return next();\n    },\n    queries: {\n      isSelectionInMention,\n      getMentionKeyword,\n    },\n    ...extraItems,\n  };\n};\n"],"file":"index.js"}