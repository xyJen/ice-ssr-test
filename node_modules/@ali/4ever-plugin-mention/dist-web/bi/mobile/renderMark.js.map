{"version":3,"sources":["../../../../src/bi/mobile/renderMark.tsx"],"names":["React","useEffect","useRef","ReactDOM","MentionAt","Portal","props","className","overlay","children","cloneElement","createPortal","document","body","MentionSuggestionPortal","mentionRef","current","screenY","getBoundingClientRect","y","window","scrollBy","top","left","behavior","mentionPanel","renderMark","controller","next","mark","markText","text","type","query","overlayElement","value","composing"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,MAA3B,QAAyC,OAAzC;qBAC4B,a;AAA5B,OAAOC,QAAP,MAAqB,WAArB;AAEA,SAASC,SAAT;;AAeA,IAAMC,MAAM,GAAG,SAATA,MAAS,CAACC,KAAD,EAAyB;AAAA,MAC9BC,SAD8B,GACGD,KADH,CAC9BC,SAD8B;AAAA,MACnBC,OADmB,GACGF,KADH,CACnBE,OADmB;AAAA,MACVC,QADU,GACGH,KADH,CACVG,QADU;AAEtC,sBACE,kDACGT,KAAK,CAACU,YAAN,CAAmBD,QAAnB,CADH,eAGIN,QAAQ,CAACQ,YAAT,eACE;AAAK,IAAA,SAAS,EAAEJ;AAAhB,kBACGP,KAAK,CAACU,YAAN,CAAmBF,OAAnB,CADH,CADF,EAIEI,QAAQ,CAACC,IAJX,CAHJ,CADF;AAaD,CAfD;;AAiBA,IAAMC,uBAAuB,GAAG,SAA1BA,uBAA0B,CAACR,KAAD,EAAqC;AAAA,MAC3DE,OAD2D,GACrCF,KADqC,CAC3DE,OAD2D;AAAA,MAClDC,QADkD,GACrCH,KADqC,CAClDG,QADkD;AAEnE,MAAMM,UAAU,GAAGb,MAAM,CAAiB,IAAjB,CAAzB;AAEAD,EAAAA,SAAS,CAAC,YAAM;AACd,QAAI,CAACc,UAAU,CAACC,OAAhB,EAAyB;AAEzB,QAAMC,OAAO,GAAGF,UAAU,CAACC,OAAX,CAAmBE,qBAAnB,GAA2CC,CAA3D;AACA,QAAIF,OAAO,GAAG,GAAd,EAAmB;AAEnBG,IAAAA,MAAM,CAACC,QAAP,CAAgB;AACdC,MAAAA,GAAG,EAAEL,OAAO,GAAG,GADD;AAEdM,MAAAA,IAAI,EAAE,CAFQ;AAGdC,MAAAA,QAAQ,EAAE;AAHI,KAAhB;AAKD,GAXQ,EAWN,EAXM,CAAT;AAaA,sBACE,eAAC,MAAD;AACE,IAAA,OAAO,EAAEhB,OADX;AAEE,IAAA,SAAS,EAAC;AAFZ,kBAIE,eAAC,SAAD;AAAW,IAAA,GAAG,EAAEO,UAAhB;AAA4B,iBAAU,YAAtC;AAAmD,IAAA,MAAM;AAAzD,KACGN,QAAQ,EADX,CAJF,CADF;AAUD,CA3BD;;AA6BA,gBAAe,UAACgB,YAAD,EAA6D;AAC1E,SAAO,SAASC,UAAT,CAAoBpB,KAApB,EAA2BqB,UAA3B,EAAuCC,IAAvC,EAA6C;AAAA,QAC1CC,IAD0C,GACjBvB,KADiB,CAC1CuB,IAD0C;AAAA,QAC9BC,QAD8B,GACjBxB,KADiB,CACpCyB,IADoC;;AAElD,QAAIF,IAAI,CAACG,IAAL,KAAc,SAAd,IAA2B,CAACL,UAAU,CAACM,KAAX,CAAiB,uBAAjB,CAAhC,EAA2E;AACzE,UAAMF,IAAI,GAAGJ,UAAU,CAACM,KAAX,CAAiB,mBAAjB,CAAb;AACA,UAAI,CAACR,YAAL,EAAmB,OAAOG,IAAI,EAAX;AACnB,UAAI,CAACG,IAAL,EAAW,OAAOH,IAAI,EAAX;AACX,UAAIG,IAAI,CAAC,CAAD,CAAJ,KAAYD,QAAQ,CAAC,CAAD,CAAxB,EAA6B,OAAOF,IAAI,EAAX;AAE7B,UAAMM,cAAc,GAAGT,YAAY,CAACM,IAAD,EAAOJ,UAAP,CAAnC;AAEA,0BACE,eAAC,uBAAD,eACMrB,KADN;AAEE,QAAA,OAAO,EAAE4B,cAFX;AAGE,QAAA,WAAW,EAAE,CAAC,CAACP,UAAU,CAACQ,KAAX,CAAiBC;AAHlC,SADF;AAOD;;AAED,WAAOR,IAAI,EAAX;AACD,GApBD;AAqBD,CAtBD","sourcesContent":["import React, { useEffect, useRef } from 'react';\nimport ReactDOM from 'react-dom';\nimport { RenderMarkProps } from '@ali/4ever-cangjie';\nimport { MentionAt } from '../components/styled';\nimport { MentionPluginConfig } from '../types';\n\ninterface IMentionSuggestionPortal {\n  overlay: React.ReactElement;\n  children: RenderMarkProps['children'];\n}\n\n\ninterface IPortalProps {\n  overlay: React.ReactElement;\n  className: string;\n  children: React.ReactElement;\n}\n\nconst Portal = (props: IPortalProps) => {\n  const { className, overlay, children } = props;\n  return (\n    <>\n      {React.cloneElement(children)}\n      {\n        ReactDOM.createPortal(\n          <div className={className}>\n            {React.cloneElement(overlay)}\n          </div>,\n          document.body,\n        )\n      }\n    </>\n  );\n};\n\nconst MentionSuggestionPortal = (props: IMentionSuggestionPortal) => {\n  const { overlay, children } = props;\n  const mentionRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (!mentionRef.current) return;\n\n    const screenY = mentionRef.current.getBoundingClientRect().y;\n    if (screenY < 100) return;\n\n    window.scrollBy({\n      top: screenY - 100,\n      left: 0,\n      behavior: 'smooth',\n    });\n  }, []);\n\n  return (\n    <Portal\n      overlay={overlay}\n      className=\"mobile-mention-suggestion-portal\"\n    >\n      <MentionAt ref={mentionRef} data-type=\"mention-at\" active>\n        {children()}\n      </MentionAt>\n    </Portal>\n  );\n};\n\nexport default (mentionPanel: MentionPluginConfig['renderMentionPanel']) => {\n  return function renderMark(props, controller, next) {\n    const { mark, text: markText } = props;\n    if (mark.type === 'mention' && !controller.query('isDisableMentionPanel')) {\n      const text = controller.query('getMentionKeyword');\n      if (!mentionPanel) return next();\n      if (!text) return next();\n      if (text[0] !== markText[0]) return next();\n\n      const overlayElement = mentionPanel(text, controller);\n\n      return (\n        <MentionSuggestionPortal\n          {...props}\n          overlay={overlayElement}\n          isComposing={!!controller.value.composing}\n        />\n      );\n    }\n\n    return next();\n  };\n};\n"],"file":"renderMark.js"}