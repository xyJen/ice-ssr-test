{"version":3,"sources":["../../../../src/bi/components/mention.tsx"],"names":["React","ReactDOM","marksToStyle","convertMarks","MentionComponent","MentionNameWrapper","returnNull","Mention","handleMentionHover","props","mentionConfig","node","onMentionHover","componentDidMount","mentionId","id","data","dom","findDOMNode","scrollIntoView","render","attributes","controller","isSelected","injections","Placeholder","selection","value","name","login","isPlaceholder","text","getFirstText","leaf","leaves","marks","currentUser","getCurrentUser","onMentionClick","locale","isSelf","toString","style","handleMentionClick","event","preventDefault","stopPropagation","isCollapsed","Component"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport {\n  Text,\n  Inline,\n  Controller,\n  RenderMarkProps,\n  Decoration,\n  Injection,\n} from '@ali/4ever-cangjie';\nimport { marksToStyle as convertMarks } from '@ali/4ever-plugin-marks';\nimport MentionComponent from '../../components/mention'\nimport { MentionPluginConfig } from '../types';\nimport { MentionNameWrapper } from '../../components/styled';\n\nexport interface MentionProps {\n  node: Inline;\n  attributes: RenderMarkProps['attributes'];\n  isSelected: boolean;\n  mentionId: number;\n  decorations?: Decoration[];\n  controller: Controller;\n  mentionConfig: MentionPluginConfig;\n  injections?: Injection[];\n  Placeholder?: React.ComponentType<any>;\n}\n\nconst returnNull = () => null;\n\nclass Mention extends React.Component<MentionProps> {\n  componentDidMount() {\n    const { node, mentionId } = this.props;\n    const { id } = node.data;\n    if (mentionId && mentionId === id) {\n      // eslint-disable-next-line react/no-find-dom-node\n      const dom = ReactDOM.findDOMNode(this) as HTMLDivElement;\n      dom.scrollIntoView();\n    }\n  }\n\n  handleMentionHover = () => {\n    const { mentionConfig, node } = this.props;\n    const { onMentionHover } = mentionConfig;\n    if (onMentionHover) {\n      onMentionHover(node);\n    }\n  };\n\n  render() {\n    const {\n      node,\n      attributes,\n      controller,\n      isSelected,\n      injections,\n      Placeholder,\n      mentionConfig\n    } = this.props;\n    const { selection } = controller.value;\n    const { id, name, login, isPlaceholder } = node.data;\n    const text = node.getFirstText() as Text;\n    const leaf = text.leaves[0];\n    const marks = leaf ? leaf.marks : [];\n    const currentUser = mentionConfig.getCurrentUser ? mentionConfig.getCurrentUser() : returnNull;\n    const { onMentionClick, locale = {} } = mentionConfig;\n    const isSelf = (currentUser && login)\n      ? currentUser.toString() === login.toString()\n      : false;\n    const style = convertMarks(marks);\n\n    const handleMentionClick = (event: React.MouseEvent) => {\n      event.preventDefault();\n      event.stopPropagation();\n      if (onMentionClick) {\n        onMentionClick(node);\n      }\n    };\n\n    if (isPlaceholder && !!Placeholder) {\n      return (<Placeholder\n        controller={controller}\n        injections={injections}\n        node={node}\n        mentionConfig={mentionConfig}\n        locale={locale}\n        isSelected={isSelected && selection.isCollapsed}\n      />);\n    }\n\n    return (\n      <MentionComponent\n        {...attributes}\n        data-type=\"mention\"\n        isSelf={isSelf}\n        id={id}\n        isSelected={isSelected && selection.isCollapsed}\n        onClick={handleMentionClick}\n        onMouseEnter={this.handleMentionHover}\n        style={style}\n        node={node}\n      >\n        @\n        <MentionNameWrapper>{name}</MentionNameWrapper>\n      </MentionComponent>\n    );\n  }\n}\n\nexport default Mention;\n"],"file":"mention.js"}