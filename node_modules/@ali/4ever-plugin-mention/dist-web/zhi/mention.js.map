{"version":3,"sources":["../../../src/zhi/mention.tsx"],"names":["React","useCallback","marksToStyle","convertMarks","BtnWrapper","MentionComponent","MentionNameWrapper","Mention","props","node","onMentionClick","onMentionHover","getCurrentUser","locale","rest","data","name","login","id","isPlaceholder","text","getFirstText","leaf","leaves","marks","style","isSelf","handleMentionClick","event","preventDefault","stopPropagation","handleMentionHover","mentionPlaceholder","type"],"mappings":";;AAAA,OAAOA,KAAP,IAAeC,WAAf,QAAiC,OAAjC;qBAC4B,a;AAC5B,SAASC,YAAY,IAAIC,YAAzB,QAA6C,yBAA7C;AAEA,SAASC,UAAT;AACA,OAAOC,gBAAP;AACA,SAASC,kBAAT;AAUA,eAAe,SAASC,OAAT,CAAiBC,KAAjB,EAAsC;AAAA,MAC3CC,IAD2C,GAC+BD,KAD/B,CAC3CC,IAD2C;AAAA,MACrCC,cADqC,GAC+BF,KAD/B,CACrCE,cADqC;AAAA,MACrBC,cADqB,GAC+BH,KAD/B,CACrBG,cADqB;AAAA,MACLC,cADK,GAC+BJ,KAD/B,CACLI,cADK;AAAA,MACWC,MADX,GAC+BL,KAD/B,CACWK,MADX;AAAA,MACsBC,IADtB,iCAC+BN,KAD/B;;AAAA,mBAERC,IAAI,CAACM,IAFG;AAAA,MAE3CC,IAF2C,cAE3CA,IAF2C;AAAA,MAErCC,KAFqC,cAErCA,KAFqC;AAAA,MAE9BC,EAF8B,cAE9BA,EAF8B;AAAA,MAE1BC,aAF0B,cAE1BA,aAF0B;AAGnD,MAAMC,IAAI,GAAGX,IAAI,CAACY,YAAL,EAAb;AACA,MAAMC,IAAI,GAAGF,IAAI,IAAIA,IAAI,CAACG,MAAL,CAAY,CAAZ,CAArB;AACA,MAAMC,KAAK,GAAGF,IAAI,GAAGA,IAAI,CAACE,KAAR,GAAgB,EAAlC;AACA,MAAMC,KAAK,GAAGtB,YAAY,CAACqB,KAAD,CAA1B;AAEA,MAAME,MAAM,GAAGd,cAAc,GAAGA,cAAc,OAAOK,KAAxB,GAAgC,KAA7D;AAEA,MAAMU,kBAAkB,GAAG1B,WAAW,CAAC,UAAC2B,KAAD,EAA6B;AAClEA,IAAAA,KAAK,CAACC,cAAN;AACAD,IAAAA,KAAK,CAACE,eAAN;;AACA,QAAIpB,cAAJ,EAAoB;AAClB;AACAA,MAAAA,cAAc,CAACD,IAAI,CAACM,IAAN,CAAd;AACD;AACF,GAPqC,EAOnC,CAACN,IAAI,CAACM,IAAN,EAAYL,cAAZ,CAPmC,CAAtC;AASA,MAAMqB,kBAAkB,GAAG9B,WAAW,CAAC,UAAC2B,KAAD,EAA6B;AAClE,QAAIjB,cAAJ,EAAoB;AAClB;AACAA,MAAAA,cAAc,CAACF,IAAI,CAACM,IAAN,CAAd;AACD;AACF,GALqC,EAKnC,CAACN,IAAI,CAACM,IAAN,EAAYJ,cAAZ,CALmC,CAAtC;;AAQA,MAAIQ,aAAJ,EAAmB;AACjB,wBACE,eAAC,UAAD;AAAY,MAAA,QAAQ;AAApB,aACKN,MAAM,CAACmB,kBADZ,CADF;AAKD;;AAED,sBACE,eAAC,gBAAD,eACMlB,IADN;AAEE;AACA,IAAA,EAAE,EAAEI,EAHN;AAIE,iBAAWT,IAAI,CAACwB,IAJlB;AAKE,IAAA,KAAK,EAAER,KALT;AAME,IAAA,OAAO,EAAEE,kBANX;AAOE,IAAA,YAAY,EAAEI,kBAPhB;AAQE,IAAA,MAAM,EAAEL,MARV;AASE,IAAA,IAAI,EAAEjB;AATR,wBAYE,eAAC,kBAAD,QAAqBO,IAArB,CAZF,CADF;AAgBD","sourcesContent":["import React, {useCallback} from 'react';\nimport { Inline } from '@ali/4ever-cangjie';\nimport { marksToStyle as convertMarks } from '@ali/4ever-plugin-marks';\nimport type { MentionPluginLocale, onMentionClickType } from '../utils/types';\nimport { BtnWrapper } from '../components/placeholder';\nimport MentionComponent from '../components/mention';\nimport { MentionNameWrapper } from '../components/styled';\n\nexport interface MentionProps {\n  node: Inline;\n  onMentionClick?: onMentionClickType;\n  onMentionHover?: onMentionClickType;\n  getCurrentUser?: () => string;\n  locale: MentionPluginLocale;\n}\n\nexport default function Mention(props: MentionProps) {\n  const { node, onMentionClick, onMentionHover, getCurrentUser, locale, ...rest } = props;\n  const { name, login, id, isPlaceholder } = node.data;\n  const text = node.getFirstText();\n  const leaf = text && text.leaves[0];\n  const marks = leaf ? leaf.marks : [];\n  const style = convertMarks(marks);\n\n  const isSelf = getCurrentUser ? getCurrentUser() === login : false;\n\n  const handleMentionClick = useCallback((event: React.MouseEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    if (onMentionClick) {\n      // @ts-ignore\n      onMentionClick(node.data);\n    }\n  }, [node.data, onMentionClick]);\n\n  const handleMentionHover = useCallback((event: React.MouseEvent) => {\n    if (onMentionHover) {\n      // @ts-ignore\n      onMentionHover(node.data);\n    }\n  }, [node.data, onMentionHover]);\n\n\n  if (isPlaceholder) {\n    return (\n      <BtnWrapper isReader>\n        @ {locale.mentionPlaceholder}\n      </BtnWrapper>\n    );\n  }\n\n  return (\n    <MentionComponent\n      {...rest}\n      // @ts-ignore\n      id={id}\n      data-type={node.type}\n      style={style}\n      onClick={handleMentionClick}\n      onMouseEnter={handleMentionHover}\n      isSelf={isSelf}\n      node={node}\n    >\n      @\n      <MentionNameWrapper>{name}</MentionNameWrapper>\n    </MentionComponent>\n  );\n}\n"],"file":"mention.js"}