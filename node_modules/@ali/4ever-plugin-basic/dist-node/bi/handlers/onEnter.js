"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = onEnter;

var _everCangjie = require("@ali/4ever-cangjie");

var _everUtils = require("@ali/4ever-utils");

function onEnter(event, controller, next) {
  const {
    value
  } = controller;
  const {
    startBlock,
    selection,
    focusInline
  } = value;
  if (!startBlock || !selection) return next(); // 如果当前有 inline 节点 focus 状态 不处理

  if (focusInline) return next();
  const closestParagraphBlock = (0, _everUtils.getClosestParagraph)(value);
  if (!closestParagraphBlock) return next(); // 如果原始段落本身没有id，暂不处理，生成锚点的时候自然会生成id

  if (!closestParagraphBlock.data.uuid) return next();
  event.preventDefault();
  controller.command(_everCangjie.Commands.splitBlock);
  const {
    document: newDocument,
    selection: newSelection
  } = controller.value;
  const currentBlock = newDocument.getClosestBlock(newSelection.anchor.key);

  if (currentBlock) {
    return controller.command(_everCangjie.Commands.setNodeByKey, currentBlock.key, {
      data: { ...currentBlock?.data,
        uuid: (0, _everUtils.uniqueId)()
      }
    });
  }

  return controller;
}
//# sourceMappingURL=onEnter.js.map