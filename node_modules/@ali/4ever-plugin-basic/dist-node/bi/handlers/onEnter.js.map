{"version":3,"sources":["../../../../src/bi/handlers/onEnter.ts"],"names":["onEnter","event","controller","next","value","startBlock","selection","focusInline","closestParagraphBlock","data","uuid","preventDefault","command","Commands","splitBlock","document","newDocument","newSelection","currentBlock","getClosestBlock","anchor","key","setNodeByKey"],"mappings":";;;;;;;AACA;;AACA;;AAGe,SAASA,OAAT,CACbC,KADa,EAEbC,UAFa,EAGbC,IAHa,EAIb;AACA,QAAM;AAAEC,IAAAA;AAAF,MAAYF,UAAlB;AACA,QAAM;AAAEG,IAAAA,UAAF;AAAcC,IAAAA,SAAd;AAAyBC,IAAAA;AAAzB,MAAyCH,KAA/C;AACA,MAAI,CAACC,UAAD,IAAe,CAACC,SAApB,EAA+B,OAAOH,IAAI,EAAX,CAH/B,CAKA;;AACA,MAAII,WAAJ,EAAiB,OAAOJ,IAAI,EAAX;AAEjB,QAAMK,qBAAmC,GAAG,oCAAoBJ,KAApB,CAA5C;AACA,MAAI,CAACI,qBAAL,EAA4B,OAAOL,IAAI,EAAX,CAT5B,CAWA;;AACA,MAAI,CAACK,qBAAqB,CAACC,IAAtB,CAA2BC,IAAhC,EAAsC,OAAOP,IAAI,EAAX;AAEtCF,EAAAA,KAAK,CAACU,cAAN;AACAT,EAAAA,UAAU,CAACU,OAAX,CAAmBC,sBAASC,UAA5B;AAEA,QAAM;AAAEC,IAAAA,QAAQ,EAAEC,WAAZ;AAAyBV,IAAAA,SAAS,EAAEW;AAApC,MAAqDf,UAAU,CAACE,KAAtE;AACA,QAAMc,YAAY,GAAGF,WAAW,CAACG,eAAZ,CAA4BF,YAAY,CAACG,MAAb,CAAoBC,GAAhD,CAArB;;AAEA,MAAIH,YAAJ,EAAkB;AAChB,WAAOhB,UAAU,CAACU,OAAX,CAAmBC,sBAASS,YAA5B,EAA0CJ,YAAY,CAACG,GAAvD,EAA4D;AACjEZ,MAAAA,IAAI,EAAE,EACJ,GAAGS,YAAY,EAAET,IADb;AAEJC,QAAAA,IAAI,EAAE;AAFF;AAD2D,KAA5D,CAAP;AAMD;;AAED,SAAOR,UAAP;AACD","sourcesContent":["import * as React from 'react';\nimport { Controller, Commands, Block } from '@ali/4ever-cangjie';\nimport { getClosestParagraph } from '@ali/4ever-utils';\nimport { uniqueId }  from '@ali/4ever-utils';\n\nexport default function onEnter(\n  event: React.KeyboardEvent,\n  controller: Controller,\n  next: Function,\n) {\n  const { value } = controller;\n  const { startBlock, selection, focusInline } = value;\n  if (!startBlock || !selection) return next();\n\n  // 如果当前有 inline 节点 focus 状态 不处理\n  if (focusInline) return next();\n\n  const closestParagraphBlock: Block | null = getClosestParagraph(value);\n  if (!closestParagraphBlock) return next();\n\n  // 如果原始段落本身没有id，暂不处理，生成锚点的时候自然会生成id\n  if (!closestParagraphBlock.data.uuid) return next();\n\n  event.preventDefault();\n  controller.command(Commands.splitBlock);\n\n  const { document: newDocument, selection: newSelection } = controller.value;\n  const currentBlock = newDocument.getClosestBlock(newSelection.anchor.key);\n\n  if (currentBlock) {\n    return controller.command(Commands.setNodeByKey, currentBlock.key, {\n      data: {\n        ...currentBlock?.data,\n        uuid: uniqueId(),\n      },\n    });\n  }\n\n  return controller;\n}\n"],"file":"onEnter.js"}