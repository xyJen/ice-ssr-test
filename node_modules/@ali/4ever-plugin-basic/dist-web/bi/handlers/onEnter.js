import _extends from "@babel/runtime/helpers/extends";
import { Commands } from '@ali/4ever-cangjie';
import { getClosestParagraph } from '@ali/4ever-utils';
import { uniqueId } from '@ali/4ever-utils';
export default function onEnter(event, controller, next) {
  var value = controller.value;
  var startBlock = value.startBlock,
      selection = value.selection,
      focusInline = value.focusInline;
  if (!startBlock || !selection) return next(); // 如果当前有 inline 节点 focus 状态 不处理

  if (focusInline) return next();
  var closestParagraphBlock = getClosestParagraph(value);
  if (!closestParagraphBlock) return next(); // 如果原始段落本身没有id，暂不处理，生成锚点的时候自然会生成id

  if (!closestParagraphBlock.data.uuid) return next();
  event.preventDefault();
  controller.command(Commands.splitBlock);
  var _controller$value = controller.value,
      newDocument = _controller$value.document,
      newSelection = _controller$value.selection;
  var currentBlock = newDocument.getClosestBlock(newSelection.anchor.key);

  if (currentBlock) {
    return controller.command(Commands.setNodeByKey, currentBlock.key, {
      data: _extends({}, currentBlock == null ? void 0 : currentBlock.data, {
        uuid: uniqueId()
      })
    });
  }

  return controller;
}
//# sourceMappingURL=onEnter.js.map