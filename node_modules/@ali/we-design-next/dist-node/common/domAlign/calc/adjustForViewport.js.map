{"version":3,"file":"adjustForViewport.js","names":["adjustVertical","elFuturePos","elRegion","tgtRegion","visibleRect","align","pos","utils","clone","points","overflow","offset","adjustY","resizeHeight","srcAlignType","srcV","charAt","tgtPos","getAlignOffset","tgtPosTop","top","size","height","bottom","adjustHorizontal","adjustX","resizeWidth","srcH","tgtPosLeft","left","width","right","adjustForViewport","horizontalInfo","verticalInfo","mix"],"sources":["../../../../../src/common/domAlign/calc/adjustForViewport.tsx"],"sourcesContent":["import { utils } from '../utils/utils';\nimport type { IPos, IFullRegion, IAlign, IVisibleRect } from '../interface';\nimport getAlignOffset from './getAlignOffset';\n\nfunction adjustVertical(elFuturePos: IPos, elRegion: IFullRegion, tgtRegion: IFullRegion, visibleRect: IVisibleRect, align: IAlign): { top: number, height: number} {\n  const pos = utils.clone(elFuturePos) as IPos;\n  const { points, overflow, offset = [0, 0] } = align;\n  const { adjustY, resizeHeight } = overflow;\n\n  const srcAlignType = points[0];\n  const srcV = srcAlignType.charAt(0);\n  const tgtPos = getAlignOffset(tgtRegion, points[1]); // 获取target的对齐点的坐标\n  const tgtPosTop = tgtPos.top + offset[1];\n\n  const size = { height: elRegion.height };\n\n  // Top edge outside viewport, try to move it.\n  if (adjustY && resizeHeight && pos.top < visibleRect.top) {\n    // resizeHeight且对齐方式为c或者b时，需要保证top坐标在可视区域内\n    if (srcV === 'c' || srcV === 'b') {\n      pos.top = visibleRect.top;\n    }\n  }\n\n  // Top edge inside and bottom edge outside viewport, try to resize it.\n  if (resizeHeight && (pos.top + size.height > visibleRect.bottom || pos.top < visibleRect.top)) {\n    if (srcV === \"t\") {\n      size.height = visibleRect.bottom - pos.top;\n    } else {\n      // 存在对齐点不在可视区域的情况，此时不resize\n      size.height = tgtPosTop < visibleRect.top ? elRegion.height : (tgtPosTop - visibleRect.top);\n    }\n  }\n\n  // 还放不下，重置top和height\n  if ((adjustY || resizeHeight) && (pos.top + size.height > visibleRect.bottom || pos.top < visibleRect.top)) {\n    pos.top = elFuturePos.top;\n    size.height = elRegion.height;\n  }\n\n  return { top: pos.top, height: size.height };\n}\n\nfunction adjustHorizontal(elFuturePos: IPos, elRegion: IFullRegion, tgtRegion: IFullRegion, visibleRect: IVisibleRect, align: IAlign): { left: number, width: number } {\n  const pos = utils.clone(elFuturePos) as IPos;\n  const { points, overflow, offset = [0, 0] } = align;\n  const { adjustX, resizeWidth } = overflow;\n\n  const srcAlignType = points[0];\n  const srcH = srcAlignType.charAt(1);\n  const tgtPos = getAlignOffset(tgtRegion, points[1]); // 获取target的对齐点的坐标\n  const tgtPosLeft = tgtPos.left + offset[0];\n\n  const size = { width: elRegion.width };\n\n  if (adjustX && resizeWidth && pos.left < visibleRect.left) {\n    if (srcH === 'c' || srcH === 'r') {\n      pos.left = visibleRect.left;\n    }\n  }\n\n  // Left edge inside and right edge outside viewport, try to resize it.\n  if (resizeWidth && (pos.left + size.width > visibleRect.right || pos.left < visibleRect.left)) {\n    if (srcH === 'l') {\n      size.width = visibleRect.right - pos.left;\n    } else {\n      size.width = tgtPosLeft < visibleRect.left ? elRegion.width : tgtPosLeft - visibleRect.left;\n    }\n  }\n\n  // 还放不下，重置left和width\n  if (adjustX && resizeWidth && (pos.left + size.width > visibleRect.right || pos.left < visibleRect.left)) {\n    pos.left = elFuturePos.left;\n    size.width = elRegion.width;\n  }\n\n  return { left: pos.left, width: size.width };\n}\n\nfunction adjustForViewport(elFuturePos: IPos, elRegion: IFullRegion, tgtRegion: IFullRegion, visibleRect: IVisibleRect, align: IAlign): IFullRegion {\n  const horizontalInfo = adjustHorizontal(elFuturePos, elRegion, tgtRegion, visibleRect, align);\n  const verticalInfo = adjustVertical(elFuturePos, elRegion, tgtRegion, visibleRect, align);\n\n  return utils.mix(horizontalInfo, verticalInfo) as IFullRegion;\n}\n\nexport default adjustForViewport;"],"mappings":"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"}