"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _utils = require("../utils/utils");
var _domUtils = require("../utils/dom-utils");
var _alignRect = require("./alignRect");
/**
 * `tgtPoint`: { pageX, pageY } or { clientX, clientY }.
 * If client position provided, will internal convert to page position.
 */

function alignPoint(el, tgtPoint, align) {
  let pageX;
  let pageY;
  const doc = _utils.utils.getDocument(el);
  // 根据 quirksmode，IE 9 以下版本不支持 defaultView.
  const win = doc.defaultView || doc.parentWindow;
  const scrollX = _utils.utils.getWindowScrollLeft(win);
  const scrollY = _utils.utils.getWindowScrollTop(win);
  const viewportWidth = _domUtils.domUtils.viewportWidth(win);
  const viewportHeight = _domUtils.domUtils.viewportHeight(win);
  if ('pageX' in tgtPoint) {
    pageX = tgtPoint.pageX;
  } else {
    pageX = scrollX + tgtPoint.clientX;
  }
  if ('pageY' in tgtPoint) {
    pageY = tgtPoint.pageY;
  } else {
    pageY = scrollY + tgtPoint.clientY;
  }
  const tgtRegion = {
    left: pageX,
    top: pageY,
    width: 0,
    height: 0
  };
  const pointInView = pageX >= 0 && pageX <= scrollX + viewportWidth && pageY >= 0 && pageY <= scrollY + viewportHeight;

  // Provide default target point
  const points = [align.points[0], 'cc'];
  const newAlign = {
    ...align,
    points
  };
  const srcInfo = (0, _alignRect.getRectOfSource)(el, newAlign);
  const tgtInfo = [tgtRegion, pointInView];
  const destInfo = (0, _alignRect.getDestinationRect)(srcInfo, tgtInfo, newAlign);
  (0, _alignRect.alignRect)(el, destInfo, newAlign);
  return destInfo;
}
var _default = alignPoint;
exports.default = _default;
//# sourceMappingURL=alignPoint.js.map