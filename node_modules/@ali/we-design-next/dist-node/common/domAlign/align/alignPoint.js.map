{"version":3,"file":"alignPoint.js","names":["alignPoint","el","tgtPoint","align","pageX","pageY","doc","utils","getDocument","win","defaultView","parentWindow","scrollX","getWindowScrollLeft","scrollY","getWindowScrollTop","viewportWidth","domUtils","viewportHeight","clientX","clientY","tgtRegion","left","top","width","height","pointInView","points","newAlign","srcInfo","getRectOfSource","tgtInfo","destInfo","getDestinationRect","alignRect"],"sources":["../../../../../src/common/domAlign/align/alignPoint.tsx"],"sourcesContent":["import { utils } from '../utils/utils';\nimport { domUtils } from '../utils/dom-utils';\nimport { getRectOfSource, getDestinationRect, alignRect, TargetInfo } from './alignRect';\nimport type { IAlign, IPoints } from '../interface';\n\ntype ITargetPoint = { pageX: number, pageY: number } | { clientX: number, clientY: number };\n\n/**\n * `tgtPoint`: { pageX, pageY } or { clientX, clientY }.\n * If client position provided, will internal convert to page position.\n */\n\nfunction alignPoint(el: HTMLElement, tgtPoint: ITargetPoint, align: IAlign) {\n  let pageX;\n  let pageY;\n\n  const doc = utils.getDocument(el);\n  // 根据 quirksmode，IE 9 以下版本不支持 defaultView.\n  const win = (doc.defaultView || doc.parentWindow) as Window;\n\n  const scrollX = utils.getWindowScrollLeft(win);\n  const scrollY = utils.getWindowScrollTop(win);\n  const viewportWidth = domUtils.viewportWidth(win);\n  const viewportHeight = domUtils.viewportHeight(win);\n\n  if ('pageX' in tgtPoint) {\n    pageX = tgtPoint.pageX;\n  } else {\n    pageX = scrollX + tgtPoint.clientX;\n  }\n\n  if ('pageY' in tgtPoint) {\n    pageY = tgtPoint.pageY;\n  } else {\n    pageY = scrollY + tgtPoint.clientY;\n  }\n\n  const tgtRegion = {\n    left: pageX,\n    top: pageY,\n    width: 0,\n    height: 0,\n  };\n\n  const pointInView =\n    pageX >= 0 &&\n    pageX <= scrollX + viewportWidth &&\n    (pageY >= 0 && pageY <= scrollY + viewportHeight);\n\n  // Provide default target point\n  const points: IPoints = [align.points[0], 'cc'];\n\n  const newAlign: IAlign = { ...align, points };\n  const srcInfo = getRectOfSource(el, newAlign);\n  const tgtInfo: TargetInfo = [tgtRegion, pointInView];\n  const destInfo = getDestinationRect(srcInfo, tgtInfo, newAlign);\n\n  alignRect(el, destInfo, newAlign);\n  return destInfo;\n}\n\nexport default alignPoint;\n"],"mappings":";;;;;;AAAA;AACA;AACA;AAKA;AACA;AACA;AACA;;AAEA,SAASA,UAAU,CAACC,EAAe,EAAEC,QAAsB,EAAEC,KAAa,EAAE;EAC1E,IAAIC,KAAK;EACT,IAAIC,KAAK;EAET,MAAMC,GAAG,GAAGC,YAAK,CAACC,WAAW,CAACP,EAAE,CAAC;EACjC;EACA,MAAMQ,GAAG,GAAIH,GAAG,CAACI,WAAW,IAAIJ,GAAG,CAACK,YAAuB;EAE3D,MAAMC,OAAO,GAAGL,YAAK,CAACM,mBAAmB,CAACJ,GAAG,CAAC;EAC9C,MAAMK,OAAO,GAAGP,YAAK,CAACQ,kBAAkB,CAACN,GAAG,CAAC;EAC7C,MAAMO,aAAa,GAAGC,kBAAQ,CAACD,aAAa,CAACP,GAAG,CAAC;EACjD,MAAMS,cAAc,GAAGD,kBAAQ,CAACC,cAAc,CAACT,GAAG,CAAC;EAEnD,IAAI,OAAO,IAAIP,QAAQ,EAAE;IACvBE,KAAK,GAAGF,QAAQ,CAACE,KAAK;EACxB,CAAC,MAAM;IACLA,KAAK,GAAGQ,OAAO,GAAGV,QAAQ,CAACiB,OAAO;EACpC;EAEA,IAAI,OAAO,IAAIjB,QAAQ,EAAE;IACvBG,KAAK,GAAGH,QAAQ,CAACG,KAAK;EACxB,CAAC,MAAM;IACLA,KAAK,GAAGS,OAAO,GAAGZ,QAAQ,CAACkB,OAAO;EACpC;EAEA,MAAMC,SAAS,GAAG;IAChBC,IAAI,EAAElB,KAAK;IACXmB,GAAG,EAAElB,KAAK;IACVmB,KAAK,EAAE,CAAC;IACRC,MAAM,EAAE;EACV,CAAC;EAED,MAAMC,WAAW,GACftB,KAAK,IAAI,CAAC,IACVA,KAAK,IAAIQ,OAAO,GAAGI,aAAa,IAC/BX,KAAK,IAAI,CAAC,IAAIA,KAAK,IAAIS,OAAO,GAAGI,cAAe;;EAEnD;EACA,MAAMS,MAAe,GAAG,CAACxB,KAAK,CAACwB,MAAM,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC;EAE/C,MAAMC,QAAgB,GAAG;IAAE,GAAGzB,KAAK;IAAEwB;EAAO,CAAC;EAC7C,MAAME,OAAO,GAAG,IAAAC,0BAAe,EAAC7B,EAAE,EAAE2B,QAAQ,CAAC;EAC7C,MAAMG,OAAmB,GAAG,CAACV,SAAS,EAAEK,WAAW,CAAC;EACpD,MAAMM,QAAQ,GAAG,IAAAC,6BAAkB,EAACJ,OAAO,EAAEE,OAAO,EAAEH,QAAQ,CAAC;EAE/D,IAAAM,oBAAS,EAACjC,EAAE,EAAE+B,QAAQ,EAAEJ,QAAQ,CAAC;EACjC,OAAOI,QAAQ;AACjB;AAAC,eAEchC,UAAU;AAAA"}