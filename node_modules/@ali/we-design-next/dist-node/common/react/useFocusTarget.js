"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useFocusTarget = void 0;
var _react = require("react");
const useFocusTarget = ownerRef => {
  const idRef = (0, _react.useRef)(undefined);
  const focusTarget = fn => {
    idRef.current = randomId();
    fn();
    wait(() => {
      const id = idRef.current;
      if (id) {
        const ele = document.getElementById(id);
        if (ele) {
          ele.focus();
          return true;
        }
      }
      return false;
    });
  };
  const focusOwner = fn => {
    idRef.current = undefined;
    fn();
    wait(() => {
      if (ownerRef.current) {
        ownerRef.current.focus();
        return true;
      }
      return false;
    });
  };
  return [idRef.current, focusTarget, focusOwner];
};
exports.useFocusTarget = useFocusTarget;
let waitId = null;
const wait = (callback, timeout = 3000) => {
  let inter = 10;
  const accInter = () => {
    if (inter < 500) {
      inter = Math.min(500, inter * 2);
    }
  };
  const fn = () => {
    const success = callback();
    if (!success) {
      const now = Date.now();
      if (now - beginTime <= timeout) {
        if (waitId) {
          clearTimeout(waitId);
          waitId = null;
        }
        waitId = setTimeout(() => {
          waitId = null;
          fn();
        }, inter);
        accInter();
      }
    }
  };
  const beginTime = Date.now();
  fn();
};
const randomId = () => (Date.now() % (1000 * 3600 * 24) * 10000 + Math.floor(Math.random() * 10000)).toString(32);
//# sourceMappingURL=useFocusTarget.js.map