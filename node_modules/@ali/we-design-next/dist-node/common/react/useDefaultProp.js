"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useDefaultProp = void 0;
var _react = require("react");
var _useEventCallback = require("./useEventCallback");
/**
 * 自定义 React Hook useDefaultProps(defaultValue, value, onChange)
 * 用于处理表单类组件中 defaultValue，value 和 onChange 的「三件套」属性
 * 
 * 关于类型推断：
 *  1. 如果 defaultProp 和 prop 都可能是 undefined，那么 value 就可能是 undefined
 *  2. 如果 defaultProp 和 prop 至少有一个一定不是 undefined，那么 value 就一定不是 undefined
 * 
 * 可参考 useDefaultProp-dev.stories.tsx
 */

const noop = () => {};
const identity = e => e;
const useDefaultProp = (defaultProp, prop, onChangeProp = noop, eventToValue = identity) => {
  const [state, setState] = (0, _react.useState)(defaultProp);
  const changeProp = (0, _useEventCallback.useEventCallback)((e, o) => {
    const args = [e === undefined ? null : e];
    if (prop !== args[0]) {
      if (o !== undefined) {
        args.push(o);
      }
      onChangeProp(...args);
    }
  });
  const changeState = (0, _useEventCallback.useEventCallback)((e, o) => {
    if (state !== e) {
      setState(e === undefined ? undefined : eventToValue(e));
      changeProp(e, o);
    }
  });
  if (prop !== undefined) {
    return [prop === null ? undefined : prop, changeProp];
  } else {
    return [state, changeState];
  }
};
exports.useDefaultProp = useDefaultProp;
//# sourceMappingURL=useDefaultProp.js.map