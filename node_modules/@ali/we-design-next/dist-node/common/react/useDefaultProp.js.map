{"version":3,"file":"useDefaultProp.js","names":["noop","identity","e","useDefaultProp","defaultProp","prop","onChangeProp","eventToValue","state","setState","useState","changeProp","useEventCallback","o","args","undefined","push","changeState"],"sources":["../../../../src/common/react/useDefaultProp.ts"],"sourcesContent":["/**\n * 自定义 React Hook useDefaultProps(defaultValue, value, onChange)\n * 用于处理表单类组件中 defaultValue，value 和 onChange 的「三件套」属性\n * \n * 关于类型推断：\n *  1. 如果 defaultProp 和 prop 都可能是 undefined，那么 value 就可能是 undefined\n *  2. 如果 defaultProp 和 prop 至少有一个一定不是 undefined，那么 value 就一定不是 undefined\n * \n * 可参考 useDefaultProp-dev.stories.tsx\n */\nimport { useState } from 'react';\nimport { useEventCallback } from './useEventCallback';\n\ntype NU<T> = undefined extends T ? never : T;\n\ntype UseDefaultProp = {\n\n  <T, O = void>(\n    defaultProp: NU<T>,\n    prop: NU<T> | undefined,\n    onChangeProp: ((v: NU<T>) => void) | undefined,\n  ): [NU<T>, (v: NU<T>) => void];\n\n  <T, R, O = void>(\n    defaultProp: NU<T>,\n    prop: NU<T> | undefined,\n    onChangeProp: ((v: R, o: O) => void) | undefined,\n    eventToValue: (e: R) => NU<T>\n  ): [NU<T>, (v: R, o: O) => void];\n\n  <T, O = void>(\n    defaultProp: NU<T> | undefined,\n    prop: NU<T>,\n    onChangeProp: ((v: NU<T>, o: O) => void) | undefined,\n  ): [NU<T>, (v: NU<T>, o: O) => void];\n\n  <T, R, O = void>(\n    defaultProp: NU<T> | undefined,\n    prop: NU<T>,\n    onChangeProp: ((v: R, o: O) => void) | undefined,\n    eventToValue: (e: R) => NU<T>\n  ): [NU<T>, (v: R, o: O) => void];\n\n  <T, O = void>(\n    defaultProp: NU<T> | undefined,\n    prop: NU<T> | undefined | null,\n    onChangeProp: ((v: NU<T> | null, o: O) => void) | undefined,\n  ): [NU<T> | undefined, (v: NU<T> | undefined, o: O) => void];\n\n  <T, R, O = void>(\n    defaultProp: NU<T> | undefined,\n    prop: NU<T> | undefined | null,\n    onChangeProp: ((v: R | null, o: O) => void) | undefined,\n    eventToValue: (e: R) => NU<T>\n  ): [NU<T> | undefined, (v: R | undefined, o: O) => void];\n\n}\n\nconst noop = () => { };\n\nconst identity = (e: any) => e;\n\nexport const useDefaultProp: UseDefaultProp =\n  (<T, O, R>(\n    defaultProp: T | undefined,\n    prop: T | undefined | null,\n    onChangeProp: ((v: R | null, o?: O) => void) | undefined = noop,\n    eventToValue: (e: R) => T = identity\n  ): [T | undefined, (v: R | undefined, o: O) => void] => {\n\n    const [state, setState] = useState<T | undefined>(defaultProp);\n\n    const changeProp = useEventCallback(\n      (e: R | undefined, o: O) => {\n\n        const args: [R | null, O?] = [e === undefined ? null : e];\n\n        if (prop !== args[0]) {\n          if (o !== undefined) {\n            args.push(o);\n          }\n          onChangeProp(...args);\n        }\n      }\n    )\n\n    const changeState = useEventCallback(\n      (e: R | undefined, o: O) => {\n        if (state !== e) {\n          setState(e === undefined ? undefined : eventToValue(e));\n          changeProp(e, o);\n        }\n      }\n    );\n\n    if (prop !== undefined) {\n      return [prop === null ? undefined : prop, changeProp];\n    } else {\n      return [state, changeState];\n    }\n  }) as any;\n"],"mappings":";;;;;;AAUA;AACA;AAXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAiDA,MAAMA,IAAI,GAAG,MAAM,CAAE,CAAC;AAEtB,MAAMC,QAAQ,GAAIC,CAAM,IAAKA,CAAC;AAEvB,MAAMC,cAA8B,GACxC,CACCC,WAA0B,EAC1BC,IAA0B,EAC1BC,YAAwD,GAAGN,IAAI,EAC/DO,YAAyB,GAAGN,QAAQ,KACkB;EAEtD,MAAM,CAACO,KAAK,EAAEC,QAAQ,CAAC,GAAG,IAAAC,eAAQ,EAAgBN,WAAW,CAAC;EAE9D,MAAMO,UAAU,GAAG,IAAAC,kCAAgB,EACjC,CAACV,CAAgB,EAAEW,CAAI,KAAK;IAE1B,MAAMC,IAAoB,GAAG,CAACZ,CAAC,KAAKa,SAAS,GAAG,IAAI,GAAGb,CAAC,CAAC;IAEzD,IAAIG,IAAI,KAAKS,IAAI,CAAC,CAAC,CAAC,EAAE;MACpB,IAAID,CAAC,KAAKE,SAAS,EAAE;QACnBD,IAAI,CAACE,IAAI,CAACH,CAAC,CAAC;MACd;MACAP,YAAY,CAAC,GAAGQ,IAAI,CAAC;IACvB;EACF,CAAC,CACF;EAED,MAAMG,WAAW,GAAG,IAAAL,kCAAgB,EAClC,CAACV,CAAgB,EAAEW,CAAI,KAAK;IAC1B,IAAIL,KAAK,KAAKN,CAAC,EAAE;MACfO,QAAQ,CAACP,CAAC,KAAKa,SAAS,GAAGA,SAAS,GAAGR,YAAY,CAACL,CAAC,CAAC,CAAC;MACvDS,UAAU,CAACT,CAAC,EAAEW,CAAC,CAAC;IAClB;EACF,CAAC,CACF;EAED,IAAIR,IAAI,KAAKU,SAAS,EAAE;IACtB,OAAO,CAACV,IAAI,KAAK,IAAI,GAAGU,SAAS,GAAGV,IAAI,EAAEM,UAAU,CAAC;EACvD,CAAC,MAAM;IACL,OAAO,CAACH,KAAK,EAAES,WAAW,CAAC;EAC7B;AACF,CAAS;AAAC"}