{"version":3,"file":"useFocusTarget.js","names":["useFocusTarget","ownerRef","idRef","useRef","undefined","focusTarget","fn","current","randomId","wait","id","ele","document","getElementById","focus","focusOwner","waitId","callback","timeout","inter","accInter","Math","min","success","now","Date","beginTime","clearTimeout","setTimeout","floor","random","toString"],"sources":["../../../../src/common/react/useFocusTarget.ts"],"sourcesContent":["import React, { useRef } from 'react';\n\nexport const useFocusTarget = (\n  ownerRef: React.RefObject<HTMLElement>,\n): [string | undefined, (fn: () => void) => void, (fn: () => void) => void] => {\n\n  const idRef = useRef<string | undefined>(undefined);\n\n  const focusTarget = (fn: () => void) => {\n\n    idRef.current = randomId();\n\n    fn();\n\n    wait(() => {\n      const id = idRef.current;\n      if (id) {\n        const ele = document.getElementById(id);\n        if (ele) {\n          ele.focus();\n          return true;\n        }\n      }\n      return false;\n    });\n\n  };\n\n  const focusOwner = (fn: () => void) => {\n\n    idRef.current = undefined;\n\n    fn();\n\n    wait(() => {\n      if (ownerRef.current) {\n        ownerRef.current.focus();\n        return true;\n      }\n      return false;\n    });\n  };\n\n  return [idRef.current, focusTarget, focusOwner];\n};\n\n\nlet waitId: ReturnType<typeof setTimeout> | null = null;\n\nconst wait = (\n  callback: () => boolean,\n  timeout: number = 3000\n) => {\n\n  let inter = 10;\n  const accInter = () => {\n    if (inter < 500) {\n      inter = Math.min(500, inter * 2);\n    }\n  }\n\n  const fn = () => {\n    const success = callback();\n    if (!success) {\n      const now = Date.now();\n      if (now - beginTime <= timeout) {\n\n        if (waitId) {\n          clearTimeout(waitId);\n          waitId = null;\n        }\n\n        waitId = setTimeout(() => {\n          waitId = null;\n          fn();\n        }, inter);\n        accInter();\n      }\n    }\n  };\n\n  const beginTime = Date.now();\n  fn();\n};\n\nconst randomId = () => (Date.now() % (1000 * 3600 * 24) * 10000 + Math.floor(Math.random() * 10000)).toString(32);\n"],"mappings":";;;;;;AAAA;AAEO,MAAMA,cAAc,GACzBC,QAAsC,IACuC;EAE7E,MAAMC,KAAK,GAAG,IAAAC,aAAM,EAAqBC,SAAS,CAAC;EAEnD,MAAMC,WAAW,GAAIC,EAAc,IAAK;IAEtCJ,KAAK,CAACK,OAAO,GAAGC,QAAQ,EAAE;IAE1BF,EAAE,EAAE;IAEJG,IAAI,CAAC,MAAM;MACT,MAAMC,EAAE,GAAGR,KAAK,CAACK,OAAO;MACxB,IAAIG,EAAE,EAAE;QACN,MAAMC,GAAG,GAAGC,QAAQ,CAACC,cAAc,CAACH,EAAE,CAAC;QACvC,IAAIC,GAAG,EAAE;UACPA,GAAG,CAACG,KAAK,EAAE;UACX,OAAO,IAAI;QACb;MACF;MACA,OAAO,KAAK;IACd,CAAC,CAAC;EAEJ,CAAC;EAED,MAAMC,UAAU,GAAIT,EAAc,IAAK;IAErCJ,KAAK,CAACK,OAAO,GAAGH,SAAS;IAEzBE,EAAE,EAAE;IAEJG,IAAI,CAAC,MAAM;MACT,IAAIR,QAAQ,CAACM,OAAO,EAAE;QACpBN,QAAQ,CAACM,OAAO,CAACO,KAAK,EAAE;QACxB,OAAO,IAAI;MACb;MACA,OAAO,KAAK;IACd,CAAC,CAAC;EACJ,CAAC;EAED,OAAO,CAACZ,KAAK,CAACK,OAAO,EAAEF,WAAW,EAAEU,UAAU,CAAC;AACjD,CAAC;AAAC;AAGF,IAAIC,MAA4C,GAAG,IAAI;AAEvD,MAAMP,IAAI,GAAG,CACXQ,QAAuB,EACvBC,OAAe,GAAG,IAAI,KACnB;EAEH,IAAIC,KAAK,GAAG,EAAE;EACd,MAAMC,QAAQ,GAAG,MAAM;IACrB,IAAID,KAAK,GAAG,GAAG,EAAE;MACfA,KAAK,GAAGE,IAAI,CAACC,GAAG,CAAC,GAAG,EAAEH,KAAK,GAAG,CAAC,CAAC;IAClC;EACF,CAAC;EAED,MAAMb,EAAE,GAAG,MAAM;IACf,MAAMiB,OAAO,GAAGN,QAAQ,EAAE;IAC1B,IAAI,CAACM,OAAO,EAAE;MACZ,MAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,EAAE;MACtB,IAAIA,GAAG,GAAGE,SAAS,IAAIR,OAAO,EAAE;QAE9B,IAAIF,MAAM,EAAE;UACVW,YAAY,CAACX,MAAM,CAAC;UACpBA,MAAM,GAAG,IAAI;QACf;QAEAA,MAAM,GAAGY,UAAU,CAAC,MAAM;UACxBZ,MAAM,GAAG,IAAI;UACbV,EAAE,EAAE;QACN,CAAC,EAAEa,KAAK,CAAC;QACTC,QAAQ,EAAE;MACZ;IACF;EACF,CAAC;EAED,MAAMM,SAAS,GAAGD,IAAI,CAACD,GAAG,EAAE;EAC5BlB,EAAE,EAAE;AACN,CAAC;AAED,MAAME,QAAQ,GAAG,MAAM,CAACiB,IAAI,CAACD,GAAG,EAAE,IAAI,IAAI,GAAG,IAAI,GAAG,EAAE,CAAC,GAAG,KAAK,GAAGH,IAAI,CAACQ,KAAK,CAACR,IAAI,CAACS,MAAM,EAAE,GAAG,KAAK,CAAC,EAAEC,QAAQ,CAAC,EAAE,CAAC"}