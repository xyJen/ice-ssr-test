{"version":3,"file":"DrawerMobile.js","names":["DrawerMobileComp","React","forwardRef","props","ref","visible","onClose","content","height","DEFAULT_DRAWER_MOBILE_HEIGHT","mask","header","footer","touchBar","keepMounted","rest","drawerBoxRef","useRef","bgRef","rootRef","isRealVisible","setRealVisible","useState","dragger","Dragger","getDrawer","current","getBg","getDraggable","getRoot","handleBgClick","e","stopPropagation","currentTarget","target","style","opacity","slideOut","handleBgTransitionEnd","event","propertyName","onBgRef","bg","addEventListener","blockEvent","passive","onDrawerBoxRef","drawer","enableDrag","useEffect","removeEventListener","slideIn","disableDrag","mergeRef","mergeRestProps","mergeClassName","displayName","DrawerMobile","getContainer","container","document","body","ReactDOM","createPortal"],"sources":["../../../../src/display/drawer/DrawerMobile.tsx"],"sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { mergeClassName, mergeRestProps, MergePropsType, mergeRef } from '../../common';\nimport {\n  Sticker,\n  DrawerBox,\n  Background,\n  HeaderBox,\n  TitleBox,\n  FooterBox,\n} from './styled';\nimport { DEFAULT_DRAWER_MOBILE_HEIGHT } from './constants';\nimport { Dragger } from './Dragger';\nimport { blockEvent } from './utils';\n\ntype IDrawerMobileProps = MergePropsType<{\n  /**\n   * Drawer 是否可见\n   */\n  visible: boolean;\n  /**\n   * Drawer 关闭时的回调\n   */\n  onClose: () => void;\n  /**\n   * 指定 Drawer 挂载的节点，false 为挂载到当前位置，默认挂载到 body\n   */\n  getContainer?: () => (HTMLElement | false);\n  /**\n   * 抽屉内容\n   */\n  content: React.ReactNode;\n  /**\n   * Drawer 的页头\n   */\n  header?: React.ReactNode;\n  /**\n   * Drawer 的页脚\n   */\n  footer?: React.ReactNode;\n  /**\n   * 不可见时是否保持渲染\n   */\n  keepMounted?: boolean;\n  /**\n   * 设置 Drawer 的高度, 默认值为 378\n   */\n  height?: number | string;\n  /**\n   * 是否展示遮罩\n   */\n  mask?: boolean\n  /**\n   * 是否展示拖拽杆\n   */\n  touchBar?: boolean;\n}, React.DOMAttributes<HTMLDivElement>>\n\nconst DrawerMobileComp = React.forwardRef<HTMLDivElement, Omit<IDrawerMobileProps, 'getContainer'>>((props, ref) => {\n  const {\n    visible,\n    onClose,\n    content,\n    height = DEFAULT_DRAWER_MOBILE_HEIGHT,\n    mask,\n    header,\n    footer,\n    touchBar,\n    keepMounted,\n    ...rest\n  } = props;\n  const drawerBoxRef = React.useRef<HTMLDivElement | null>(null);\n  const bgRef = React.useRef<HTMLDivElement | null>(null);\n  const rootRef = React.useRef<HTMLDivElement | null>(null);\n  const [isRealVisible, setRealVisible] = React.useState<boolean>(props.visible);\n  const dragger = React.useRef(new Dragger({\n    getDrawer: () => drawerBoxRef.current,\n    getBg: () => bgRef.current,\n    getDraggable: () => drawerBoxRef.current,\n    getRoot: () => rootRef.current,\n  }));\n\n\n  const handleBgClick = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (\n      e.currentTarget === e.target &&\n      typeof onClose === 'function' &&\n      bgRef.current!.style.opacity === '1' &&\n      isRealVisible\n    ) {\n      dragger.current.slideOut();\n    }\n  };\n\n  const handleBgTransitionEnd = (event: TransitionEvent) => {\n    if (!bgRef.current || (event.propertyName === 'opacity' && bgRef.current.style.opacity === '0')) {\n      visible && onClose && onClose();\n      setRealVisible(false);\n    }\n  };\n\n  const onBgRef = (bg: HTMLDivElement) => {\n    bgRef.current = bg;\n    if (bg) {\n      bg.addEventListener('transitionend', handleBgTransitionEnd);\n      bg.addEventListener('touchmove', blockEvent, {\n        passive: false,\n      });\n    }\n  };\n\n  const onDrawerBoxRef = (drawer: HTMLDivElement) => {\n    drawerBoxRef.current = drawer;\n    if (drawer) {\n      dragger.current.enableDrag();\n    }\n  }\n\n  React.useEffect(() => {\n    return () => {\n      bgRef.current?.removeEventListener('transitionend', handleBgTransitionEnd);\n    };\n  }, [handleBgTransitionEnd]);\n\n  React.useEffect(() => {\n    // 外部触发打开\n    if (visible && !isRealVisible) {\n      setRealVisible(true);\n    }\n    if (isRealVisible) {\n      // 外部触发关闭\n      if (!visible) {\n        dragger.current.slideOut();\n      } else {\n        dragger.current.slideIn();\n      }\n    }\n  }, [visible, isRealVisible]);\n\n  React.useEffect(() => {\n    return () => {\n      dragger.current.disableDrag();\n      bgRef.current?.removeEventListener('touchmove', blockEvent);\n    }\n  }, []);\n\n  return (keepMounted || isRealVisible) ? (\n    <Sticker ref={mergeRef(ref, rootRef)} {...mergeRestProps(rest, 'wdn-drawer-mobile')} >\n      <Background\n        ref={onBgRef}\n        isVisible={isRealVisible}\n        mask={mask}\n        onClick={handleBgClick}\n      />\n      <DrawerBox\n        style={{\n          height: height,\n        }}\n        ref={onDrawerBoxRef}\n        className=\"wdn-drawer-mobile-drawer-box\"\n      >\n        <HeaderBox\n          className={mergeClassName(touchBar ? 'wdn-drawer-mobile-show-touch-bar' : '', 'wdn-drawer-mobile-header-box')}\n        >\n          {\n            header ? (\n              <TitleBox className=\"wdn-drawer-mobile-title-box\">\n                {header}\n              </TitleBox>\n            ) : null\n          }\n        </HeaderBox>\n        <React.Fragment>{content}</React.Fragment>\n        <FooterBox className=\"wdn-drawer-mobile-footer-box\">{footer}</FooterBox>\n      </DrawerBox>\n    </Sticker>\n  ) : null;\n});\n\nDrawerMobileComp.displayName = 'DrawerMobileComp';\n\nexport const DrawerMobile = React.forwardRef<HTMLDivElement, IDrawerMobileProps>((props, ref) => {\n  const { getContainer, ...rest } = props;\n  const container = getContainer ? getContainer() : document.body;\n  return container ? (\n    ReactDOM.createPortal(<DrawerMobileComp ref={ref} {...rest} />, container)\n  ) : <DrawerMobileComp ref={ref} {...rest} />;\n});\n\nDrawerMobile.displayName = 'DrawerMobile';"],"mappings":"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"}