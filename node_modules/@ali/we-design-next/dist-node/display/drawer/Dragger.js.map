{"version":3,"file":"Dragger.js","names":["SCROLL_THRESHOLD","Dragger","constructor","params","startTouch","translateY","drawerHeight","getDrawer","getBg","getDraggable","getRoot","scrollDirection","status","onTouchStart","e","stopPropagation","changedTouches","length","addEventListener","onTouchMove","passive","onTouchEnd","touchEnd","curTranslateY","drawer","bg","realTranslateY","height","clientHeight","style","transform","transition","opacity","formatTransformY","transformY","maxTransformY","Math","min","max","isScrollable","target","direction","delta","root","scrollWidth","clientWidth","scrollLeft","overflowX","overflow","getComputedStyle","scrollTop","scrollHeight","overflowY","parentElement","touch","getStartTouch","identifier","blockEvent","clientY","clientX","startTouchX","startTouchY","moveX","moveY","abs","canScroll","removeEventListener","slideOut","newTranslateY","slideIn","enableDrag","draggable","disableDrag"],"sources":["../../../../src/display/drawer/Dragger.ts"],"sourcesContent":["import { getStartTouch, blockEvent } from './utils';\n\ntype IDraggerConstructorParams = {\n  getDrawer: () => (HTMLDivElement | null);\n  getBg: () => (HTMLDivElement | null);\n  getDraggable: () => (HTMLDivElement | null);\n  getRoot: () => (HTMLDivElement | null);\n}\n\nconst SCROLL_THRESHOLD = 5;\ntype ScrollDirection = 'horizontal' | 'vertical' | 'notScroll';\ntype Status = 'scrolling' | 'dragging' | 'none';\n\nexport class Dragger {\n  constructor(params: IDraggerConstructorParams) {\n    this.getDrawer = params.getDrawer;\n    this.getBg = params.getBg;\n    this.getDraggable = params.getDraggable;\n    this.getRoot = params.getRoot;\n  }\n  private startTouch: Touch | null = null;\n  private translateY: number = 0;\n  private drawerHeight: number = 0;\n  private getDrawer: () => HTMLDivElement | null;\n  private getBg: () => HTMLDivElement | null;\n  private getDraggable: () => (HTMLDivElement | null);\n  private getRoot: () => (HTMLDivElement | null);\n  private scrollDirection: ScrollDirection = 'notScroll';\n  private status: Status = 'none';\n\n  onTouchStart = (e: TouchEvent) => {\n    e.stopPropagation();\n    const { changedTouches } = e;\n    const { length } = changedTouches;\n    if (length > 1) {\n      return;\n    }\n    this.startTouch = changedTouches[0];\n    this.translateY = 0;\n    this.getRoot()?.addEventListener('touchmove', this.onTouchMove, {\n      passive: false,\n    });\n    this.getRoot()?.addEventListener('touchend', this.onTouchEnd);\n  }\n\n  touchEnd = (curTranslateY?: number) => {\n    const drawer = this.getDrawer();\n    const bg = this.getBg();\n    if (!drawer || !bg || !(this.status === 'dragging')) {\n      return;\n    }\n    const realTranslateY = curTranslateY || this.translateY;\n    const height = this.drawerHeight || drawer?.clientHeight || 0;\n\n    if (realTranslateY > height * 0.25) {\n      drawer.style.transform = `translateY(${height}px)`;\n      drawer.style.transition = 'transform 0.2s';\n      bg.style.opacity = '0';\n      bg.style.transition = 'opacity 0.6s';\n      this.translateY = height;\n    } else {\n      drawer.style.transform = 'translateY(0px)';\n      drawer.style.transition = 'transform 0.2s';\n      bg.style.opacity = '1';\n      bg.style.transition = 'none';\n      this.translateY = 0;\n    }\n    this.startTouch = null;\n  }\n\n  formatTransformY = (transformY: number) => {\n    const maxTransformY = this.drawerHeight || this.getDrawer()?.clientHeight || 0;\n    return Math.min(maxTransformY, Math.max(0, transformY));\n  };\n\n  isScrollable = (target: HTMLElement | null, direction: 'horizontal' | 'vertical', delta: number): boolean => {\n    if (!target) return false;\n    const root = this.getRoot();\n    if (root === target) {\n      return false;\n    }\n    if (direction === 'horizontal') {\n      const { scrollWidth, clientWidth, scrollLeft } = target;\n      if (scrollWidth > clientWidth) {\n        const {overflowX, overflow} = getComputedStyle(target);\n        if (overflowX === 'scroll' || overflowX === 'auto' || overflow === 'scroll' || overflow === 'auto') {\n          if ((delta > 0 && scrollLeft > 0) || (delta < 0 && target.scrollTop + clientWidth < scrollWidth)) {\n            return true;\n          }\n        }\n      }\n    } else {\n      const { scrollHeight, clientHeight, scrollTop } = target;\n      if (scrollHeight > clientHeight) {\n        const {overflowY, overflow} = getComputedStyle(target);\n        if (overflowY === 'scroll' || overflowY === 'auto' || overflow === 'scroll' || overflow === 'auto') {\n          if ((delta > 0 && scrollTop > 0) || (delta < 0 && target.scrollTop + clientHeight < scrollHeight)) {\n            return true;\n          }\n        }\n      }\n    }\n    return this.isScrollable(target.parentElement, direction, delta);\n  }\n\n  onTouchMove = (e: TouchEvent) => {\n    const { changedTouches } = e;\n    const touch = getStartTouch(changedTouches, this.startTouch?.identifier);\n    if (!touch) {\n      blockEvent(e);\n      this.touchEnd();\n    } else {\n      const { clientY, clientX } = touch;\n      const { target, clientX: startTouchX, clientY: startTouchY } =  this.startTouch!;\n      const moveX = clientX - startTouchX;\n      const moveY = clientY - startTouchY;\n      if (this.status === 'none' && Math.max(Math.abs(moveX), Math.abs(moveY)) > SCROLL_THRESHOLD) {\n        const direction: ScrollDirection = Math.abs(moveX) > Math.abs(moveY) ? 'horizontal' : 'vertical';\n        const delta = direction === 'horizontal' ? moveX : moveY;\n        const canScroll = this.isScrollable(target as HTMLElement, direction, delta);\n        this.scrollDirection = direction;\n        if (canScroll) {\n          this.status = 'scrolling';\n          e.stopPropagation();\n        } else if (direction === 'vertical') {\n          this.status = 'dragging';\n          blockEvent(e);\n        } else {\n          blockEvent(e);\n        }\n      } else if (this.status === 'scrolling') {\n        e.stopPropagation();\n      } else if (this.status === 'dragging') {\n        blockEvent(e);\n        this.translateY = this.formatTransformY(moveY);\n        const drawer = this.getDrawer();\n        if (drawer) {\n          drawer.style.transform = `translateY(${this.translateY}px)`;\n          drawer.style.transition = 'none';\n        }\n      } else {\n        blockEvent(e);\n      }\n    }\n  }\n\n  onTouchEnd = (e: TouchEvent) => {\n    e.stopPropagation();\n    const { changedTouches } = e;\n    const touch = getStartTouch(changedTouches, this.startTouch?.identifier);\n    if (!touch) {\n      this.touchEnd();\n    } else {\n      this.translateY = this.formatTransformY(touch.clientY - (this.startTouch as Touch).clientY);\n      this.touchEnd(this.translateY);\n    }\n    this.getRoot()?.removeEventListener('touchmove', this.onTouchMove);\n    this.getRoot()?.removeEventListener('touchend', this.onTouchEnd);\n    this.scrollDirection = 'notScroll';\n    this.status = 'none';\n  }\n\n  slideOut = () => {\n    const drawer = this.getDrawer();\n    const bg = this.getBg();\n    if (!drawer || !bg) {\n      return;\n    }\n    const newTranslateY = this.drawerHeight || drawer.clientHeight || 0;\n    drawer.style.transform = `translateY(${newTranslateY}px)`;\n    drawer.style.transition = 'transform 0.4s';\n    bg.style.opacity = '0';\n    bg.style.transition = 'opacity 0.4s';\n  };\n\n  slideIn = () => {\n    const drawer = this.getDrawer();\n    const bg = this.getBg();\n    if (!drawer || !bg) {\n      return;\n    }\n    this.drawerHeight = drawer.clientHeight || 0;\n    bg.style.transition = 'opacity 0.2s';\n    bg.style.opacity = '1';\n    drawer.style.transition = 'transform 0.2s';\n    drawer.style.transform = 'translateY(0)';\n  };\n\n  enableDrag = () => {\n    const draggable = this.getDraggable();\n    if (draggable) {\n      draggable.addEventListener('touchstart', this.onTouchStart);\n    }\n  }\n  disableDrag = () => {\n    const draggable = this.getDraggable?.();\n    if (draggable) {\n      draggable.removeEventListener('touchstart', this.onTouchStart);\n    }\n  }\n}"],"mappings":"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"}