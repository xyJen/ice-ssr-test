{"version":3,"file":"Gallery.js","names":["RenderEmptyItem","width","height","Gallery","memo","props","items","columnCount","RenderItem","value","defaultValue","onChange","rest","selected","setSelected","useDefaultProp","hoveredItem","setHoveredItem","useState","itemRows","useMemo","tmp","i","length","push","slice","chooseItem","item","key","hoverItem","event","stopPropagation","preventDefault","isSelected","isHovered","getHoveredItem","findIndex","handleKeyDown","curIndex","keyCode","KEY_CODES","LEFT","UP","RIGHT","DOWN","ENTER","useEffect","some","console","warn","mergeRestProps","map","row","index","data"],"sources":["../../../../src/display/gallery/Gallery.tsx"],"sourcesContent":["import React, { memo,  useMemo, ReactElement, useEffect, useState} from 'react';\nimport { GalleryContainer,GalleryItemWrapper,GalleryItem,GalleryBorder, GalleryItemRow } from './styled';\nimport { IRestProps, KEY_CODES, mergeRestProps, useDefaultProp } from '../../common';\n\n/**\n * Item 唯一标识\n */\ntype SelectedVal = string | number;\n\ntype IGalleryItem<T> = { key: SelectedVal, value: T };\n\ntype RenderItemHandler<T> = ({ data, index }: { data: IGalleryItem<T>, index: number }) => ReactElement;\nexport interface GalleryProps<T>  {\n  /**\n   * 需要渲染的列表\n   */\n  items: Array<IGalleryItem<any>>;\n\n  /**\n   * 每行显示数量\n   * @default 3\n   */\n  columnCount?: number;\n\n  /**\n   * 渲染单个元素\n   */\n  RenderItem?: RenderItemHandler<T>;\n\n  /**\n   * 受控 value \n   */\n  value?: SelectedVal;\n\n  /**\n   * 初始值 \n   */\n  defaultValue?: SelectedVal;\n\n  /**\n   * 选中回调\n   */\n  onChange?: (value: SelectedVal) => void;\n}\nconst RenderEmptyItem = () => {\n  return <div style={{width: '50px',height:'50px'}}></div>\n}\n\n\nexport const Gallery = memo(<T extends Record<string, any>>(props: IRestProps & GalleryProps<T>) => {\n  const {\n    items = [],\n    columnCount = 3,\n    RenderItem =() => <RenderEmptyItem />,\n    value,\n    defaultValue,\n    onChange,\n    ...rest\n  } = props;\n  const [selected, setSelected] = useDefaultProp<SelectedVal>(defaultValue, value, () => { });\n  const [hoveredItem, setHoveredItem] = useState<SelectedVal | undefined>();\n  const itemRows = useMemo(() => {\n    const tmp = [];\n    for (let i = 0; i < items.length; i += columnCount) {\n      tmp.push(items.slice(i, i + columnCount))\n    }\n    return tmp;\n  }, [items, columnCount]);\n  \n  const chooseItem = (item: IGalleryItem<T>) => {\n    setSelected(item.key);\n    onChange?.(item.key);\n    setHoveredItem(item.key)\n  };\n\n  const hoverItem = (event: React.KeyboardEvent, item: IGalleryItem<T>) => {\n    event.stopPropagation();\n    event.preventDefault();\n    setHoveredItem(item.key);\n  };\n\n  const isSelected = (item: IGalleryItem<T>) => {\n    return item.key === selected;\n  };\n\n  const isHovered = (item: IGalleryItem<T>) => {\n    return item.key === hoveredItem;\n  };\n\n  const getHoveredItem = ():number => {\n    return items.findIndex(item => {\n      return isHovered(item);\n    })\n  };\n  \n  const handleKeyDown = (event: React.KeyboardEvent) => {\n    if (!event) return;\n    const curIndex = getHoveredItem();\n    const keyCode = event.keyCode;\n    switch (keyCode) {\n      case KEY_CODES.LEFT:\n        if (curIndex === -1) return hoverItem(event, items[0]);\n        if (curIndex > 0) {\n          return hoverItem(event, items[curIndex - 1])\n        }\n        break;\n      case KEY_CODES.UP:\n        if (curIndex === -1) return hoverItem(event, items[0]);\n        if (curIndex - columnCount >= 0) {\n          return hoverItem(event, items[curIndex - columnCount])\n        }\n        break;\n      case KEY_CODES.RIGHT:\n        if (curIndex === -1) return hoverItem(event, items[0]);\n        if (curIndex !== items.length - 1) {\n          return hoverItem(event, items[curIndex + 1])\n        }\n        break;\n      case KEY_CODES.DOWN:\n        if (curIndex === -1) return hoverItem(event, items[0]);\n        if (curIndex + columnCount < items.length) {\n          return hoverItem(event, items[curIndex + columnCount])\n        }\n        break;\n      case KEY_CODES.ENTER:\n        if (curIndex === -1) return;\n        return chooseItem?.(items[curIndex]);\n    }\n  };\n  \n  useEffect(() => {\n    if (items.some(item => !item.key)) {\n      console.warn('every item in items should have unique key ' );\n    }\n  }, [items]);\n  \n  return (\n    <GalleryContainer\n      tabIndex={-1}\n      onKeyDown={handleKeyDown}\n      {...mergeRestProps(rest, 'wdn-gallery')}\n    >\n      {itemRows.map((row, index) => (\n        <GalleryItemRow>\n          {row.map(item => (\n            <GalleryItemWrapper\n          onClick={() => chooseItem(item)}\n          key={item.key || index}\n        >\n          <GalleryItem>\n            {RenderItem({ data: item, index })}\n          </GalleryItem>\n          <GalleryBorder\n            actived={isSelected(item)}\n            hovered={isHovered(item)}\n          />\n          </GalleryItemWrapper>\n          )) }\n        \n        </GalleryItemRow>\n          )\n      )}\n    </GalleryContainer>\n  );\n}) as <T extends Record<string,any>>(props: IRestProps & GalleryProps<T>) => ReactElement;\n"],"mappings":"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"}