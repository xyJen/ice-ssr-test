{"version":3,"file":"Message.js","names":["MESSAGE_COMMON_DURATION","Root","styled","CSSTransitionGroup","root_style","Message","props","messages","map","msg","key","icon","content","actionTitle","onAction","noop","message","close","hasRendered","messageIndex","renderDom","handleUpdate","msgs","window","document","body","contains","oDiv","createElement","style","position","width","top","left","appendChild","ReactDOM","render","getKey","noopConfig","getProps","title","config","keepAlive","restConfig","undefined","open","itemProps","getContainer","onClose","container","closeLocal","showLocalMessage","setTimeout","sameKeyIndex","findIndex","splice","length","autoCloseFirstIndex","push","filter","m","closeAll","info","options","success","warning","error","loading"],"sources":["../../../../src/display/message/Message.tsx"],"sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { noop } from 'lodash-es';\nimport CSSTransitionGroup from 'react-transition-group/CSSTransitionGroup';\nimport { success, info, warning, error, loading } from './icons';\nimport styled from 'styled-components';\nimport { MessageBox } from './MessageBox';\nimport { showLocalMessage } from './local';\nimport type { IMessageProps, IMessageOptions, IMessageItemProps } from './interface'\n\nimport {\n  root_style,\n} from './styled';\n\nconst MESSAGE_COMMON_DURATION = 3 * 1000;\n\nconst Root = styled(CSSTransitionGroup)`${root_style}`;\n\nconst Message: React.FC<IMessageProps> = (props) => {\n  const { messages } = props;\n\n  return (\n    <Root\n      component=\"div\"\n      transitionName=\"message\"\n      transitionEnterTimeout={300}\n      transitionLeaveTimeout={300}\n    >\n      {messages.map((msg) => {\n        const { key, icon, content, actionTitle, onAction = noop } = msg;\n        return (\n          <MessageBox\n            key={key}\n            icon={icon}\n            content={content}\n            onAction={() => {\n              message.close(key);\n              onAction();\n            }}\n            actionTitle={actionTitle}\n          />\n        );\n      })}\n    </Root>\n  );\n};\n\nlet hasRendered = false;\n\nexport const message = (() => {\n  let messageIndex = 0;\n  let messages: IMessageItemProps[] = [];\n\n  let renderDom: HTMLDivElement | undefined = null!;\n\n  function handleUpdate(msgs: IMessageItemProps[]) {\n    if (!renderDom || !window.document.body.contains(renderDom)) {\n      const oDiv = document.createElement('div');\n      oDiv.style.position = 'absolute';\n      oDiv.style.width = '100%';\n      oDiv.style.top = '0px';\n      oDiv.style.left = '0px';\n      document.body.appendChild(oDiv);\n      renderDom = oDiv;\n    }\n    if (!hasRendered) {\n      ReactDOM.render(<Message messages={[]} />, renderDom);\n      hasRendered = true;\n    }\n    messages = msgs;\n    ReactDOM.render(<Message messages={msgs} />, renderDom);\n  }\n\n  const getKey = () => {\n    const key = `wds-msg-id-${++messageIndex}`;\n    if (messageIndex > 10000000) { messageIndex = 0; }\n    return key;\n  };\n\n  const noopConfig: IMessageOptions = {};\n\n  const getProps = (\n    icon: React.ReactNode,\n    title: React.ReactElement | string,\n    config: IMessageOptions = noopConfig,\n  ): IMessageItemProps => {\n\n    const { key, keepAlive, ...restConfig } = config;\n\n    return {\n      icon,\n      content: title,\n      key: key || getKey(),\n      keepAlive: (keepAlive === undefined) ? !!(config.actionTitle) : keepAlive,\n      ...restConfig\n    }\n  };\n\n  return {\n\n    open(itemProps: IMessageItemProps) {\n\n      const { getContainer, onClose } = itemProps;\n\n      if (getContainer) {\n        const container = getContainer();\n        if (container && container!== window.document.body ) {\n          \n          const closeLocal = showLocalMessage({ container,  ...itemProps }) || noop;\n          if (!itemProps.keepAlive) {\n            setTimeout(() => {\n              closeLocal();\n              onClose && onClose();\n            }, MESSAGE_COMMON_DURATION);\n          }\n\n          return closeLocal;\n        }\n      }\n\n      const { key } = itemProps;\n\n      // 保持非恒定的的只有三个\n      messages = [...messages];\n      const sameKeyIndex =  messages.findIndex((msg) => (msg.key === key));\n      if (sameKeyIndex >= 0) {\n        messages.splice(sameKeyIndex, 1);\n      } else if (messages.length >= 3 && !itemProps.keepAlive) {\n        const autoCloseFirstIndex = messages.findIndex((msg) => !msg.keepAlive);\n        if (autoCloseFirstIndex >= 0) {\n          messages.splice(autoCloseFirstIndex, 1);\n        }\n      }\n      messages.push(itemProps);\n\n      handleUpdate(messages);\n      \n      if (!itemProps.keepAlive) {\n        setTimeout(() => {\n          this.close(key);\n          onClose && onClose();\n        }, MESSAGE_COMMON_DURATION);\n      }\n\n      return () => this.close(itemProps.key);\n    },\n\n    close(key: string) {\n      messages = messages.filter((m) => (m.key !== key))\n      handleUpdate(messages);\n    },\n\n    closeAll(){\n      handleUpdate([]);\n    },\n\n    info(content: string, options?: IMessageOptions) {\n      return this.open(getProps(info, content, options));\n    },\n\n    success(content: string, options?: IMessageOptions) {\n      return this.open(getProps(success, content, options));\n    },\n\n    warning(content: string, options?: IMessageOptions) {\n      return this.open(getProps(warning, content, options));\n    },\n\n    error(content: string, options?: IMessageOptions) {\n      return this.open(getProps(error, content, options));\n    },\n\n    loading(content: string, options?: IMessageOptions) {\n      return this.open(getProps(loading, content, { keepAlive: true, ...options }));\n    },\n\n    message(content: string | React.ReactElement, options?: IMessageOptions) {\n      return this.open(getProps(null, content, options))\n    }\n  };\n\n})();\n"],"mappings":"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"}