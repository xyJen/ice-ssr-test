{"version":3,"file":"local.js","names":["FlagAttributeName","FlagAttributeValue","rootElemSelector","createRootElement","root","document","createElement","setAttribute","Object","assign","style","left","top","position","width","background","pointerEvents","transition","display","justifyContent","zIndex","String","Z_INDEX","MESSAGE","MsgStyle","transform","closeTimerMap","Map","showLocalMessage","opt","container","restProps","body","contains","querySelector","appendChild","ReactDOM","unmountComponentAtNode","opacity","render","timerId","get","window","clearTimeout","setTimeout","close","once","closeLocalMessage","delete","set"],"sources":["../../../../src/display/message/local.tsx"],"sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { once } from 'lodash-es';\nimport { MessageBox } from './MessageBox'\nimport type { IMessageItemProps } from './interface';\nimport { Z_INDEX } from '../../common';\n\nconst FlagAttributeName = 'data-elemType';\nconst FlagAttributeValue = '_localeMessageWrapper_';\nconst rootElemSelector = `[${FlagAttributeName}=\"${FlagAttributeValue}\"]`;\n\nconst createRootElement = () => {\n  const root = document.createElement('div');\n  root.setAttribute(FlagAttributeName, FlagAttributeValue);\n  Object.assign(root.style, {\n    left: '0px',\n    top: '0px',\n    position: 'absolute',\n    width: '100%',\n    background: 'transparent',\n    pointerEvents: 'none',\n    transition: 'all 0.24s',\n    display: 'flex',\n    justifyContent: 'center',\n    zIndex: String(Z_INDEX.MESSAGE),\n  } as CSSStyleDeclaration);\n  return root as HTMLElement;\n};\n\nconst MsgStyle: React.CSSProperties = {\n  pointerEvents: 'fill',\n  transform: 'unset',\n};\n\nconst closeTimerMap = new Map<HTMLElement, number>();\n\nexport const showLocalMessage = (\n  opt: Omit<IMessageItemProps, 'key' | 'getContainer'> & { top?: number, container: HTMLElement }\n) => {\n  const { top = '28px', container, ...restProps  } = opt;\n\n  if (!document.body.contains(container)) { return; }\n  \n  let root = container.querySelector(rootElemSelector) as (HTMLElement | undefined);\n\n  if (!root) {\n    root = createRootElement();\n  }\n  Object.assign(root.style, { top });\n  container.appendChild(root);\n\n  ReactDOM.unmountComponentAtNode(root);\n  root.style.opacity = '0';\n  root.style.transform = 'translate(0, -40px)';\n\n  ReactDOM.render(<MessageBox {...restProps} />, root);\n\n  const timerId = closeTimerMap.get(root);\n  if (timerId) {\n    window.clearTimeout(timerId);\n  }\n  setTimeout(() => {\n    root && (root.style.opacity = '1');\n    root && (root.style.transform = 'translate(0, 0)');\n  }, 0);\n  const close = once(() => closeLocalMessage(container));\n\n  return close;\n};\n\nfunction closeLocalMessage(container: HTMLElement | undefined | null) {\n  const root = container?.querySelector(rootElemSelector) as HTMLElement;\n  if (!root) { return; }\n\n  setTimeout(() => {\n    root.style.opacity = '0';\n    root.style.transform = 'translate(0, -40px)';\n  }, 0);\n  const timerId = setTimeout(() => {\n    if (document.body.contains(root)) {\n      ReactDOM.unmountComponentAtNode(root);\n    }\n    closeTimerMap.delete(root);\n  }, 300) as unknown as number;\n  closeTimerMap.set(root, timerId);\n};"],"mappings":"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"}