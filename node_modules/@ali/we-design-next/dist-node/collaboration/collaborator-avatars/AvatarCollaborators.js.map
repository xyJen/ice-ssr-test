{"version":3,"file":"AvatarCollaborators.js","names":["PLACEMENT_OFFSET","AvatarCollaborators","React","memo","props","collaborators","items","max","DEFAULT_MAX_COLLABORATOR","onClick","highlight","isMoreButtonHighlight","renderMenu","customMorePanelTitle","renderCollaboratorMenu","rest","visibleAvatarIndex","setVisibleAvatarIndex","useState","avatarCount","length","isOverflowing","t","useTranslate","sortedItems","useMemo","map","item","index","sort","a","b","aValue","bValue","mergeRestProps","slice","idx","key","undefined","color","COLOR_SCHEME","COLOR_SCHEME_LEN","visible","v","value","mergeClassName","Number"],"sources":["../../../../src/collaboration/collaborator-avatars/AvatarCollaborators.tsx"],"sourcesContent":["/* eslint-disable max-lines-per-function */\nimport React from 'react';\nimport { Popover } from '../../display/popover';\nimport {\n  AvatarCollaboratorsWrap,\n  GroupAvatarItem,\n  GroupAvatarList,\n  GroupMoreItem,\n  GroupMoreItemSpan,\n  OverlayWrap,\n  CountWrap,\n} from './styled';\nimport { mergeClassName, MergePropsType, mergeRestProps } from '../../common';\nimport { IAvatarCollaborator, AvatarWithPopover } from './AvatarWithPopover';\nimport { AvatarMoreList } from './AvatarMoreList';\nimport { COLOR_SCHEME, COLOR_SCHEME_LEN, DEFAULT_MAX_COLLABORATOR } from './constants';\nimport { useTranslate } from '../../locale';\n\nexport type IAvatarCollaboratorsProps = MergePropsType<{\n  /**\n   * 显示区最多显示多少个,  默认为 8\n   */\n  max?: number;\n  /**\n   *  点击头像组中头像（或 dropdown 列表中选项）的回调函数\n   *  idx 为头像组中点击的头像的序号 (0-based)\n   */\n  onClick?: (key: string) => void;\n  /**\n   * 用户列表\n   */\n  collaborators?: IAvatarCollaborator[];\n  /**\n   * 协作者头像面板中的菜单\n   */\n  renderCollaboratorMenu?: (c: IAvatarCollaborator) => React.ReactElement;\n  /**\n   * 更多用户按钮出现时，其是否高亮\n   */\n  highlight?: boolean;\n  /**\n   * 菜单顶部\n   */\n  renderMenu?: () => React.ReactNode;\n}, React.HTMLAttributes<HTMLDivElement>>;\n\nconst PLACEMENT_OFFSET: [number, number] = [4, 0];\n\nexport const AvatarCollaborators: React.FC<IAvatarCollaboratorsProps> = React.memo((props) => {\n  const {\n    collaborators: items = [],\n    max = DEFAULT_MAX_COLLABORATOR,\n    onClick,\n    highlight: isMoreButtonHighlight,\n    renderMenu: customMorePanelTitle,\n    renderCollaboratorMenu,\n    ...rest\n  } = props;\n\n  const [visibleAvatarIndex, setVisibleAvatarIndex] = React.useState<number | 'more'>(-1);\n\n  // 数量\n  const avatarCount = items.length;\n  const isOverflowing = avatarCount > max!;\n  const t = useTranslate();\n\n  const sortedItems = React.useMemo(() => {\n    return items.map((item, index) => ({\n      ...item,\n      index,\n    })).sort((a, b) => {\n      const aValue = a.highlight ? 0 : 1;\n      const bValue = b.highlight ? 0 : 1;\n      return aValue - bValue;\n    });\n  }, [items]);\n\n  return (\n    <AvatarCollaboratorsWrap {...mergeRestProps(rest, 'wdn-collaborator-avatars')}>\n      <GroupAvatarList>\n        {sortedItems\n          .slice(0, isOverflowing ? max - 1 : max)\n          .map((item) => {\n            const { index: idx, key } = item;\n            return (\n              <GroupAvatarItem\n                className=\"avatar-item\"\n                key={key}\n              >\n                <AvatarWithPopover\n                  {...item}\n                  renderMenu={renderCollaboratorMenu ? (() => renderCollaboratorMenu(item)) : undefined}\n                  color={item.color || COLOR_SCHEME[idx % COLOR_SCHEME_LEN]}\n                  onClick={() => onClick?.(item.key)}\n                  isPopoverVisible={visibleAvatarIndex === idx}\n                  onPopoverVisibleChange={(visible: boolean) => {\n                    if (visible) {\n                      setVisibleAvatarIndex(idx)\n                    } else {\n                      setVisibleAvatarIndex((visibleAvatarIndex) => {\n                        return visibleAvatarIndex === idx ? -1 : visibleAvatarIndex\n                      });\n                    }\n                  }}\n                />\n              </GroupAvatarItem>\n            );\n          })}\n        {isOverflowing && (\n          <GroupAvatarItem>\n            <Popover\n              animation\n              onVisibleChange={v => {\n                if (v) {\n                  setVisibleAvatarIndex('more');\n                } else if (visibleAvatarIndex === 'more') {\n                  setVisibleAvatarIndex(-1);\n                }\n              }}\n              visible={visibleAvatarIndex === 'more'}\n              trigger=\"click\"\n              placement=\"bottomRight\"\n              placementOffset={PLACEMENT_OFFSET}\n              content={\n                <OverlayWrap>\n                  <CountWrap>\n                    {\n                      !!customMorePanelTitle\n                        ? customMorePanelTitle()\n                        : t('wdn_avatar_group_total-collab-people', {\n                          value: avatarCount,\n                        })\n                    }\n                  </CountWrap>\n                  <AvatarMoreList items={sortedItems} onClick={onClick} />\n                </OverlayWrap>\n              }\n            >\n              <GroupMoreItem className={mergeClassName(visibleAvatarIndex === 'more' ? 'wdn-more-box-active' : '', isMoreButtonHighlight ? 'wdn-more-btn-highlight' : '')}>\n                {\n                  Number(avatarCount) < 999 ? (\n                    <GroupMoreItemSpan>{`${avatarCount}`}</GroupMoreItemSpan>\n                  ) : (\n                    <>\n                      <i /><i /><i />\n                    </>\n                  )\n                }\n              </GroupMoreItem>\n            </Popover>\n          </GroupAvatarItem>\n        )}\n      </GroupAvatarList>\n    </AvatarCollaboratorsWrap>\n  );\n});\n\n"],"mappings":"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"}