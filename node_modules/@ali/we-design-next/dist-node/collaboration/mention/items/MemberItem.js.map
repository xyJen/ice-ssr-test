{"version":3,"file":"MemberItem.js","names":["LAST_CHAR_NUM","MiddleEllipsisText","props","isTextOverflow","setTextOverflow","useState","subTitleRf","useRef","divideIndex","setDivideIndex","React","text","useEffect","current","rect","getBoundingClientRect","containerWidth","width","textWidth","scrollWidth","lastLen","Math","min","length","diIndex","preText","slice","nextText","MemberItemName","memo","name","indexOf","arr","split","map","v","ret","bold","titleArr","reduce","pre","cur","concat","color","COLORS","COMMON","LINK_COLOR","e","replace","MentionItemInner","avatar","description","descriptionText","outside","department","MentionItemInnerWrapper","styled","div","MentionItem","index","data","style","t","useTranslate","item","items","handleMouseEnter","onMouseEnter","handleClick","onClick","stopPropagation","active","MemberItemWrapper","CSS_BORDER_BOX","OTHERS","DAO_HOVER_BG_COLOR","SubTitleWrapper"],"sources":["../../../../../src/collaboration/mention/items/MemberItem.tsx"],"sourcesContent":["import React, { useState, useRef, useMemo, useEffect } from 'react';\nimport styled from 'styled-components';\nimport { useTranslate } from '../../../locale';\nimport { COLORS, CSS_BORDER_BOX } from '../../../common';\n\nexport type IMember = {\n  avatar?: string;\n  name: string;\n  description?: string | { department: string, outside?: boolean };\n};\n\nexport type IMentionItemPropsData = {\n  items: IMember[];\n  active: number;\n  onMouseEnter: (i: number) => void;\n  onClick: (i: number) => void;\n};\n\n\ntype IMentionItemProps = {\n  index: number;\n  style: React.CSSProperties;\n  data: IMentionItemPropsData;\n};\n\ninterface IMiddleEllipsisTextProps {\n  text: string;\n}\nconst LAST_CHAR_NUM = 8;\nconst MiddleEllipsisText: React.FC<IMiddleEllipsisTextProps> = (\n  props: IMiddleEllipsisTextProps,\n) => {\n  const [isTextOverflow, setTextOverflow] = useState<Boolean>(false);\n\n  const subTitleRf = useRef<HTMLDivElement>(null);\n  const [divideIndex, setDivideIndex] = React.useState<number>(0);\n  const { text } = props;\n\n  useEffect(() => {\n    if (subTitleRf.current) {\n      const rect = subTitleRf.current.getBoundingClientRect();\n      const containerWidth = rect.width;\n      const textWidth = subTitleRf.current.scrollWidth;\n      if (containerWidth > 0 && textWidth > containerWidth) {\n        setTextOverflow(true);\n        // 一行展示不下时，中间省略，截取最后X个字符最后显示\n        const lastLen = Math.min(text?.length, LAST_CHAR_NUM);\n        const diIndex = text?.length - lastLen;\n        setDivideIndex(diIndex);\n      }\n    }\n  }, [text]);\n\n  if (!text) return null;\n  const preText = text?.slice(0, divideIndex);\n  const nextText = text?.slice(divideIndex);\n\n  return (\n    <SubTitleWrapper ref={subTitleRf}>\n      {isTextOverflow\n        ? (\n          <>\n            <p>{preText}</p>\n            <p>{nextText}</p>\n          </>\n        )\n        : (\n          <span>{text}</span>\n        )}\n    </SubTitleWrapper>\n  );\n};\n\nconst MemberItemName = React.memo(\n  (props: { name: string }) => {\n\n    const { name } = props;\n\n    if (name.indexOf('<red>') === -1 || name.indexOf('</red>') === -1) {\n      return <span>{name}</span>;\n    }\n\n    try {\n      const arr = name.split(/<red>/g).map((v) => {\n        const ret = v.split(/<\\/red>/);\n        if (ret.length > 1) {\n          return [[ret[0], { bold: true }], [ret[1]]];\n        }\n        return [[ret[0]]];\n      });\n\n      const titleArr = arr.reduce((pre, cur) => pre.concat(cur), []);\n      return (\n        <span>\n          {titleArr.map((v) => {\n            if (v[1] && v[1].bold) {\n              return <span style={{ color: COLORS.COMMON.LINK_COLOR }}>{v[0]}</span>;\n            }\n            return v[0];\n          })}\n        </span>\n      );\n    } catch (e) {\n      return <span>{name.replace(/(<red>|<\\/red>)/g, '')}</span>;\n    }\n  }\n);\n\nconst MentionItemInner = React.memo(\n  (props: IMember) => {\n    const { avatar, name, description } = props;\n\n    const descriptionText = !description ? '' : typeof description === 'string' ? description : description.outside ? '组织外' : description.department;\n\n    return (\n      <MentionItemInnerWrapper>\n        <div>{avatar ? <img src={avatar} /> : <span>{name.replace(/(<red>|<\\/red>)/g, '')}</span>}</div>\n        <div>\n          <div>\n            <MemberItemName name={name} />\n            {/* {<span className=\"sub-title\">(descriptionText)</span>} */}\n          </div>\n          <span>{descriptionText}</span>\n          {/* {extension?.needEllipsisText ? <MiddleEllipsisText text={desc} /> : <span>{desc}</span>} */}\n        </div>\n        {/* {extension?.date && (\n          <div>\n            <span>{extension.date}</span>\n          </div>\n        )} */}\n      </MentionItemInnerWrapper>\n    );\n  },\n);\n\nconst MentionItemInnerWrapper = styled.div`\n  display: flex;\n  cursor: pointer;\n  width: 100%;\n  overflow: hidden;\n  & > div {\n    &:first-child {\n      width: 36px;\n      display: flex;\n      align-items: center;\n\n      img {\n        width: 28px;\n        height: 28px;\n        border-radius: 4px;\n      }\n\n      span {\n        width: 28px;\n        height: 28px;\n        line-height: 26px;\n        border-radius: 4px;\n        overflow: hidden;\n        color: rgb(255, 255, 255);\n        padding: 2px;\n        font-size: 12px;\n        text-align: center;\n        background-color: rgb(0, 137, 255);\n      }\n    }\n\n    &:nth-child(2) {\n      flex: 1;\n      overflow: hidden;\n\n      & > div:first-child {\n        height: 20px;\n        line-height: 20px;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        font-family: sans-serif;\n\n        & > span {\n          color: #191f25;\n          &:first-child {\n            font-size: 14px;\n            line-height: 20px;\n          }\n\n          &.sub-title {\n            display: inline-block;\n            font-size: 12px;\n            margin-left: 2px;\n          }\n        }\n\n        &:only-child {\n          height: 38px;\n          line-height: 38px;\n        }\n      }\n\n      & > span {\n        display: block;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        &:last-child {\n          font-size: 12px;\n          line-height: 17px;\n          color: rgba(17, 31, 44, 0.4);\n        }\n      }\n    }\n\n    &:last-child {\n      // font-family: helvetica;\n      display: flex;\n      flex-direction: column;\n      justify-content: flex-end;\n      font-size: 12px;\n      line-height: 15px;\n      color: rgba(17, 31, 44, 0.4);\n    }\n  }\n`;\n\n\n\nexport const MentionItem: React.FC<IMentionItemProps> = React.memo((props: IMentionItemProps) => {\n\n  const {\n    index,\n    data,\n    style,\n  } = props;\n\n  const t = useTranslate();\n\n  const item = data.items[index];\n\n  const handleMouseEnter = () => data.onMouseEnter(index);\n\n  const handleClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    data.onClick(index);\n    e.stopPropagation();\n  };\n\n  return (\n    <MemberItemWrapper\n      key={`${index}`}\n      style={style}\n      active={data.active === index}\n      onMouseEnter={handleMouseEnter}\n      onClick={handleClick}\n    >\n      <MentionItemInner\n        avatar={item.avatar}\n        name={item.name}\n        description={item.description}\n      />\n    </MemberItemWrapper>\n  );\n});\n\nconst MemberItemWrapper = styled.div<{ active: boolean; }>`\n  ${CSS_BORDER_BOX}\n  display: flex;\n  padding: 8px 6px;\n  border-radius: 4px;\n  ${({ active }) => active && `background: ${COLORS.OTHERS.DAO_HOVER_BG_COLOR};`};\n`;\n\nconst SubTitleWrapper = styled.div`\n  display: flex;\n  flex-direction: row;\n  width: fit-content;\n  max-width: 100%;\n\n  & > span,\n  & > p {\n    font-size: 12px;\n    color: rgba(17, 31, 44, 0.4);\n    line-height: 17px;\n  }\n\n  & > span {\n    &:only-child {\n      white-space: nowrap;\n      width: fit-content;\n    }\n  }\n\n  & > p {\n    margin: 0;\n    &:first-child {\n      flex: 1;\n      display: block;\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n\n    &:last-child {\n      width: fit-content;\n    }\n  }\n`;"],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AAAyD;AAAA;AAAA,uBAF7B;AA2B5B,MAAMA,aAAa,GAAG,CAAC;AACvB,MAAMC,kBAAsD,GAC1DC,KAA+B,IAC5B;EACH,MAAM,CAACC,cAAc,EAAEC,eAAe,CAAC,GAAG,IAAAC,eAAQ,EAAU,KAAK,CAAC;EAElE,MAAMC,UAAU,GAAG,IAAAC,aAAM,EAAiB,IAAI,CAAC;EAC/C,MAAM,CAACC,WAAW,EAAEC,cAAc,CAAC,GAAGC,cAAK,CAACL,QAAQ,CAAS,CAAC,CAAC;EAC/D,MAAM;IAAEM;EAAK,CAAC,GAAGT,KAAK;EAEtB,IAAAU,gBAAS,EAAC,MAAM;IACd,IAAIN,UAAU,CAACO,OAAO,EAAE;MACtB,MAAMC,IAAI,GAAGR,UAAU,CAACO,OAAO,CAACE,qBAAqB,EAAE;MACvD,MAAMC,cAAc,GAAGF,IAAI,CAACG,KAAK;MACjC,MAAMC,SAAS,GAAGZ,UAAU,CAACO,OAAO,CAACM,WAAW;MAChD,IAAIH,cAAc,GAAG,CAAC,IAAIE,SAAS,GAAGF,cAAc,EAAE;QACpDZ,eAAe,CAAC,IAAI,CAAC;QACrB;QACA,MAAMgB,OAAO,GAAGC,IAAI,CAACC,GAAG,CAACX,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEY,MAAM,EAAEvB,aAAa,CAAC;QACrD,MAAMwB,OAAO,GAAG,CAAAb,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEY,MAAM,IAAGH,OAAO;QACtCX,cAAc,CAACe,OAAO,CAAC;MACzB;IACF;EACF,CAAC,EAAE,CAACb,IAAI,CAAC,CAAC;EAEV,IAAI,CAACA,IAAI,EAAE,OAAO,IAAI;EACtB,MAAMc,OAAO,GAAGd,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEe,KAAK,CAAC,CAAC,EAAElB,WAAW,CAAC;EAC3C,MAAMmB,QAAQ,GAAGhB,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEe,KAAK,CAAClB,WAAW,CAAC;EAEzC,oBACE,eAAC,eAAe;IAAC,GAAG,EAAEF;EAAW,GAC9BH,cAAc,gBAEX,2DACE,0BAAIsB,OAAO,CAAK,eAChB,0BAAIE,QAAQ,CAAK,CAChB,gBAGH,6BAAOhB,IAAI,CACZ,CACa;AAEtB,CAAC;AAED,MAAMiB,cAAc,gBAAGlB,cAAK,CAACmB,IAAI,CAC9B3B,KAAuB,IAAK;EAE3B,MAAM;IAAE4B;EAAK,CAAC,GAAG5B,KAAK;EAEtB,IAAI4B,IAAI,CAACC,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,IAAID,IAAI,CAACC,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE;IACjE,oBAAO,6BAAOD,IAAI,CAAQ;EAC5B;EAEA,IAAI;IACF,MAAME,GAAG,GAAGF,IAAI,CAACG,KAAK,CAAC,QAAQ,CAAC,CAACC,GAAG,CAAEC,CAAC,IAAK;MAC1C,MAAMC,GAAG,GAAGD,CAAC,CAACF,KAAK,CAAC,SAAS,CAAC;MAC9B,IAAIG,GAAG,CAACb,MAAM,GAAG,CAAC,EAAE;QAClB,OAAO,CAAC,CAACa,GAAG,CAAC,CAAC,CAAC,EAAE;UAAEC,IAAI,EAAE;QAAK,CAAC,CAAC,EAAE,CAACD,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;MAC7C;MACA,OAAO,CAAC,CAACA,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;IACnB,CAAC,CAAC;IAEF,MAAME,QAAQ,GAAGN,GAAG,CAACO,MAAM,CAAC,CAACC,GAAG,EAAEC,GAAG,KAAKD,GAAG,CAACE,MAAM,CAACD,GAAG,CAAC,EAAE,EAAE,CAAC;IAC9D,oBACE,6BACGH,QAAQ,CAACJ,GAAG,CAAEC,CAAC,IAAK;MACnB,IAAIA,CAAC,CAAC,CAAC,CAAC,IAAIA,CAAC,CAAC,CAAC,CAAC,CAACE,IAAI,EAAE;QACrB,oBAAO;UAAM,KAAK,EAAE;YAAEM,KAAK,EAAEC,cAAM,CAACC,MAAM,CAACC;UAAW;QAAE,GAAEX,CAAC,CAAC,CAAC,CAAC,CAAQ;MACxE;MACA,OAAOA,CAAC,CAAC,CAAC,CAAC;IACb,CAAC,CAAC,CACG;EAEX,CAAC,CAAC,OAAOY,CAAC,EAAE;IACV,oBAAO,6BAAOjB,IAAI,CAACkB,OAAO,CAAC,kBAAkB,EAAE,EAAE,CAAC,CAAQ;EAC5D;AACF,CAAC,CACF;AAED,MAAMC,gBAAgB,gBAAGvC,cAAK,CAACmB,IAAI,CAChC3B,KAAc,IAAK;EAClB,MAAM;IAAEgD,MAAM;IAAEpB,IAAI;IAAEqB;EAAY,CAAC,GAAGjD,KAAK;EAE3C,MAAMkD,eAAe,GAAG,CAACD,WAAW,GAAG,EAAE,GAAG,OAAOA,WAAW,KAAK,QAAQ,GAAGA,WAAW,GAAGA,WAAW,CAACE,OAAO,GAAG,KAAK,GAAGF,WAAW,CAACG,UAAU;EAEhJ,oBACE,eAAC,uBAAuB,qBACtB,4BAAMJ,MAAM,gBAAG;IAAK,GAAG,EAAEA;EAAO,EAAG,gBAAG,6BAAOpB,IAAI,CAACkB,OAAO,CAAC,kBAAkB,EAAE,EAAE,CAAC,CAAQ,CAAO,eAChG,yCACE,yCACE,eAAC,cAAc;IAAC,IAAI,EAAElB;EAAK,EAAG,CAE1B,eACN,6BAAOsB,eAAe,CAAQ,CAE1B,CAMkB;AAE9B,CAAC,CACF;AAED,MAAMG,uBAAuB,gBAAGC,yBAAM,CAACC,GAAG,29BAsFzC;AAIM,MAAMC,WAAwC,gBAAGhD,cAAK,CAACmB,IAAI,CAAE3B,KAAwB,IAAK;EAE/F,MAAM;IACJyD,KAAK;IACLC,IAAI;IACJC;EACF,CAAC,GAAG3D,KAAK;EAET,MAAM4D,CAAC,GAAG,IAAAC,oBAAY,GAAE;EAExB,MAAMC,IAAI,GAAGJ,IAAI,CAACK,KAAK,CAACN,KAAK,CAAC;EAE9B,MAAMO,gBAAgB,GAAG,MAAMN,IAAI,CAACO,YAAY,CAACR,KAAK,CAAC;EAEvD,MAAMS,WAAW,GAAIrB,CAAmC,IAAK;IAC3Da,IAAI,CAACS,OAAO,CAACV,KAAK,CAAC;IACnBZ,CAAC,CAACuB,eAAe,EAAE;EACrB,CAAC;EAED,oBACE,eAAC,iBAAiB;IAChB,GAAG,EAAG,GAAEX,KAAM,EAAE;IAChB,KAAK,EAAEE,KAAM;IACb,MAAM,EAAED,IAAI,CAACW,MAAM,KAAKZ,KAAM;IAC9B,YAAY,EAAEO,gBAAiB;IAC/B,OAAO,EAAEE;EAAY,gBAErB,eAAC,gBAAgB;IACf,MAAM,EAAEJ,IAAI,CAACd,MAAO;IACpB,IAAI,EAAEc,IAAI,CAAClC,IAAK;IAChB,WAAW,EAAEkC,IAAI,CAACb;EAAY,EAC9B,CACgB;AAExB,CAAC,CAAC;AAAC;AAEH,MAAMqB,iBAAiB,gBAAGhB,yBAAM,CAACC,GAAG,gEAChCgB,sBAAc,EAId,CAAC;EAAEF;AAAO,CAAC,KAAKA,MAAM,IAAK,eAAc3B,cAAM,CAAC8B,MAAM,CAACC,kBAAmB,GAAE,CAC/E;AAED,MAAMC,eAAe,gBAAGpB,yBAAM,CAACC,GAAG,2VAkCjC"}