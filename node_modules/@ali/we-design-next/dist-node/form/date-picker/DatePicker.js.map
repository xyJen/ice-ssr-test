{"version":3,"file":"DatePicker.js","names":["DatePicker","React","memo","props","defaultValue","value","_value","onChange","mode","timeFormat","clearable","confirmable","disabledDate","footer","showNow","rest","setValue","useDefaultProp","selectedValue","setSelectedValue","useState","dayjs","curPanel","setCurPanel","prePanelRef","useRef","showTimeOption","useMemo","defaultShowTime","default","showTime","setShowTime","t","useTranslate","useEffect","handleDisabledDate","useCallback","toDate","handleSelect","date","isEqual","handlePanelChange","origin","target","current","now","DateController","getNow","disabled","nowNode","defaultFooter","e","checked","undefined","panelSharedProps","onSelect","mergeRestProps","renderReactNode"],"sources":["../../../../src/form/date-picker/DatePicker.tsx"],"sourcesContent":["import React, { ReactElement, useState, useCallback, useEffect, useRef, useMemo } from \"react\";\nimport dayjs, { Dayjs } from \"dayjs\";\nimport { useTranslate } from '../../locale';\nimport { useDefaultProp, IRestProps, mergeRestProps, IRenderReactNode, renderReactNode } from \"../../common\";\nimport { DateTimePanel, TimePanel, DatePickerFooter } from \"./panels\";\nimport { PanelMode, DateController, isEqual } from \"./date-util\";\nimport { DatePickerWrapper, NowWrapper, SpaceBar, SwitchOptionWrapper } from \"./styled\";\nimport { Button } from \"../../basic/button\";\nimport { Checkbox } from '../checkbox';\n\ntype RawMode = 'date' | 'datetime';\n\nexport type IDatePickerProps = {\n  /**\n   * 日期值\n   */\n  value?: Date | null;\n  /**\n   * 默认的日期值\n   */\n  defaultValue?: Date | null;\n  /**\n   * 值发生变化\n   */\n  onChange?: (value: Date | null, options: { showTime: boolean }) => void;\n  /**\n   * 展示面板类型，默认是date; auto时展示时间开关，开关默认关闭\n   */\n  mode?: RawMode | 'time' | 'auto' | ['auto', { default: RawMode }];\n  /**\n   * 时间面板展示类型，默认HM（只展示时分面板），只在有时间面板时生效\n   */\n  timeFormat?: 'hm' | 'hms';\n  /**\n   * 是否可清除，为true显示清除按钮，默认false\n   */\n  clearable?: boolean;\n  /**\n   * 是否只有点确定才生效，为true显示确定按钮，默认true\n   */\n  confirmable?: boolean;\n  /**\n   * 不可选择的日期\n   */\n  disabledDate?: (date: Date) => boolean;\n  /**\n   * 自定义底部\n   */\n  footer?: IRenderReactNode<void>;\n  /**\n   * 是否显示今天或现在, 默认true\n   */\n  showNow?: boolean;\n} & IRestProps;\n\nexport const DatePicker: React.FC<IDatePickerProps> = React.memo(\n  (props) => {\n    const {\n      defaultValue,\n      value: _value,\n      onChange,\n      mode = 'date',\n      timeFormat = 'hm',\n      clearable = false,\n      confirmable = false,\n      disabledDate,\n      footer,\n      showNow = true,\n      ...rest\n    } = props;\n\n    const [value, setValue] = useDefaultProp(defaultValue, _value, onChange);\n    const [selectedValue, setSelectedValue] = useState<Dayjs | null>(\n      value ? dayjs(value) : null\n    );\n    const [curPanel, setCurPanel] = useState<PanelMode>(\"date\");\n    const prePanelRef = useRef<PanelMode>();\n\n    const showTimeOption: boolean = useMemo(() => mode === 'auto' || typeof mode === 'object', [mode]);\n    const defaultShowTime: boolean = useMemo(() => mode === 'datetime' || (typeof mode === 'object' && mode[1].default === 'datetime'), [mode]);\n    const [showTime, setShowTime] = useState<boolean>(defaultShowTime);\n\n    const t = useTranslate();\n\n    useEffect(() => {\n      setShowTime(defaultShowTime);\n    }, [mode]);\n\n    useEffect(() => {\n      // 受控模式下，使selectedValue和value同步\n      setSelectedValue(value ? dayjs(value) : null);\n    }, [value]);\n\n    const handleDisabledDate = useCallback(\n      (value: Dayjs) => disabledDate?.(value.toDate()) || false,\n      [disabledDate]\n    );\n\n    const handleSelect = useCallback(\n      (date: Dayjs) => {\n        setSelectedValue(date);\n\n        if (\n          !confirmable &&\n          !isEqual(selectedValue, date) &&\n          !handleDisabledDate(date)\n        ) {\n          setValue(date.toDate(), { showTime });\n        }\n      },\n      [confirmable, selectedValue, setValue, handleDisabledDate, showTime]\n    );\n\n    const handlePanelChange = useCallback(\n      (origin: PanelMode, target: PanelMode) => {\n        if (prePanelRef.current === \"month\" && origin === \"year\" && target === \"date\") {\n          setCurPanel(\"month\");\n        } else {\n          setCurPanel(target);\n        }\n        prePanelRef.current = origin;\n      },\n      []\n    );\n\n    const now = DateController.getNow();\n    const disabled = handleDisabledDate(now);\n    const nowNode = showNow ? (\n      <NowWrapper>\n        <Button type=\"text\" disabled={disabled} onClick={() => handleSelect(now)}>\n          {showTime ? t(\"wdn_date_picker_now\") : t(\"wdn_date_picker_today\")}\n        </Button>\n      </NowWrapper>\n    ) : <SpaceBar />;\n\n    let defaultFooter: React.ReactElement = <></>;\n    if (curPanel === \"date\") {\n      defaultFooter = (\n        <DatePickerFooter\n          timeSwitch={\n            showTimeOption ? (\n              <SwitchOptionWrapper>\n                <Checkbox\n                  checked={showTime}\n                  onChange={(e) => setShowTime(e.target.checked)}\n                >\n                  {t(\"wdn_date_picker_time\")}\n                </Checkbox>\n              </SwitchOptionWrapper>\n            ) : null\n          }\n          clear={\n            clearable ? (\n              <Button\n                disabled={!value}\n                onClick={() => {\n                  setSelectedValue(null);\n                  !confirmable && setValue(null, { showTime });\n                }}\n              >\n                {t(\"wdn_date_picker_clear\")}\n              </Button>\n            ) : undefined\n          }\n          confirm={\n            confirmable ? (\n              <Button\n                disabled={!selectedValue}\n                onClick={() => {\n                  if (!disabled && selectedValue) {\n                    setValue(selectedValue.toDate(), { showTime });\n                  }\n                }}\n              >\n                {t(\"wdn_ok\")}\n              </Button>\n            ) : undefined\n          }\n        />\n      );\n    }\n\n    const panelSharedProps = {\n      value: selectedValue,\n      onSelect: handleSelect,\n      showNow: showNow,\n      timeFormat: timeFormat,\n    };\n\n    return (\n      <DatePickerWrapper {...mergeRestProps(rest, \"wdn-date-picker\")}>\n        {mode === \"time\" ? (\n          <TimePanel showHeader={false} {...panelSharedProps} />\n        ) : (\n          <DateTimePanel\n            showTime={showTime}\n            disabledDate={handleDisabledDate}\n            curPanel={curPanel}\n            onPanelChange={handlePanelChange}\n            nowNode={nowNode}\n            {...panelSharedProps}\n          />\n        )}\n        {renderReactNode(footer, defaultFooter, undefined)}\n      </DatePickerWrapper>\n    );\n  }\n);\n"],"mappings":"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"}