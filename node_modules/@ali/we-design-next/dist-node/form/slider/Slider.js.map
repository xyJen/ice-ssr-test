{"version":3,"file":"Slider.js","names":["Slider","memo","props","disable","attachToMarksOnly","range","marks","max","min","step","value","defaultValue","onChange","formatter","point","mark","line","tip","rest","defaultStart","useMemo","defaultEnd","propsStart","propsEnd","start","setStart","useDefaultProp","end","setEnd","sliderRef","useRef","moveStart","isMove","setIsMove","useState","sliderLength","calculateDistance","useCallback","e","current","clientX","x","rect","getBoundingClientRect","left","sliderLeft","right","sliderRight","result","tmpValue","dist","Number","MAX_SAFE_INTEGER","spanWidth","order","Math","round","abs","forEach","newDist","isInteger","toFixed","handleChange","sValue","eValue","rangeValue","handleMouseMove","handleClickOnMark","isNearToStart","renderSliderMarks","marksProps","renderReactNode","undefined","handleMouseDownOnPoint","document","addEventListener","removeEventListener","renderStartPoint","pointProps","isStart","renderEndPoint","renderSliderLine","lineProps","mergeRestProps"],"sources":["../../../../src/form/slider/Slider.tsx"],"sourcesContent":["import React, { memo, useCallback, useMemo, useRef, useState, ReactElement} from 'react';\nimport { SliderContainer } from './styled';\nimport { IRestProps, mergeRestProps, useDefaultProp, renderReactNode } from '../../common';\nimport { SliderLine } from './SliderLine';\nimport { SliderPoint } from './SliderPoint';\nimport { SliderMarks } from './SliderMarks';\n\ntype SliderLegalValue = number | [number, number];\nexport interface SliderBaseProps<T extends SliderLegalValue>  {\n  /**\n   * 是否禁用\n   */\n  disable?: boolean;\n  /**\n   * 是否只能拖拽到刻度上\n   */\n  attachToMarksOnly?: boolean;\n  /**\n   * 标记刻度（吸附效果），并且必须在 min 和 max 之间\n   */\n  marks?: number[];\n\n  /**\n   * 最大值，默认 100\n   */\n  max?: number;\n\n  /**\n   * 最小值，默认 0\n   */\n  min?: number;\n\n  /**\n   * 步长，取值大于 0，且必须能被 (max - min) 整除\n   */\n  step?: number;\n\n  /**\n   * 双滑块模式\t默认为false\n   */\n  range?: boolean;\n\n  /**\n   * 格式化文本\n   */\n  formatter?: (value: React.ReactText) => string;\n\n  /**\n   * 自定义渲染滑块，可指定style和class或设置颜色\n   */\n  point?: React.ReactElement;\n\n  /**\n   * 自定义渲染标记点，可指定style和class或设置颜色\n   */\n  mark?: React.ReactElement;\n\n  /**\n   * 自定义渲染滚动条，可指定style和class或设置颜色\n   */\n  line?: React.ReactElement;\n\n  /**\n   * 自定义tooltip，可指定style和class或设置颜色\n   */\n  tip?: React.ReactElement;\n\n  /**\n   * 受控 value \n   */\n  value?: T;\n\n  /**\n   * 初始值 \n   */\n  defaultValue?: T;\n\n  /**\n   * 监听滑动条 value 的改变\n   */\n  onChange?:(value:T) => void;\n}\n\nexport const Slider = memo(<T extends SliderLegalValue> (props: IRestProps & SliderBaseProps<T>) => {\n  const {\n    disable = false,\n    attachToMarksOnly = false,\n    range = false,\n    marks = [],\n    max = 100,\n    min = 0,\n    step = 1,\n    value,\n    defaultValue,\n    onChange,\n    formatter = (value: React.ReactText) => (`${value}`),\n    point,\n    mark,\n    line,\n    tip,\n    ...rest\n  } = props;\n  const defaultStart = useMemo(() => {\n    if (!range) return min;\n    return (defaultValue as Array<number>)?.[0] ?? min;\n  }, [range, defaultValue, min]);\n  const defaultEnd = useMemo(() => {\n    if (range) return (defaultValue as Array<number>)?.[1] ?? min;\n    return (defaultValue as number) ?? min;\n  }, [range, defaultValue, min]);\n  const propsStart = useMemo(() => {\n    if (!range) return min;\n    return (value as Array<number>)?.[0];\n  }, [value, range]);\n  const propsEnd = useMemo(() => {\n    if (range) return (value as Array<number>)?.[1];\n    return value as number;\n  }, [value, range]);\n\n  const [start, setStart] = useDefaultProp<number>(defaultStart, propsStart, () => { });\n  const [end, setEnd] = useDefaultProp<number>(defaultEnd, propsEnd, () => { });\n\n  const sliderRef = useRef<HTMLDivElement>(null);\n  const moveStart = useRef(false);\n  const [isMove, setIsMove] = useState(false);\n  const sliderLength = useMemo(() => max - min, [max, min]);\n  // 计算移动距离\n  const calculateDistance = useCallback((e: MouseEvent): number => {\n    if (!sliderRef.current) return min;\n    const { clientX: x } = e;\n    const rect = sliderRef.current?.getBoundingClientRect();\n    const { left: sliderLeft, right: sliderRight } = rect || {};\n    let result = 0;\n    if (sliderLeft && sliderRight) {\n      if (x <= sliderLeft) {\n        result = min;\n      } else if (x >= sliderRight) {\n        result = max;\n      } else {\n        let tmpValue = 0;\n        let dist = Number.MAX_SAFE_INTEGER;\n        if (!attachToMarksOnly) {\n          const spanWidth = (sliderRight - sliderLeft) / ((max - min) / step);\n          const order = Math.round((x - sliderLeft) / spanWidth);\n          dist = Math.abs(spanWidth * order + sliderLeft - x);\n          tmpValue = order * step;\n        }\n        marks.forEach((mark) => {\n          const newDist = Math.abs(\n            mark / (max - min) * (sliderRight - sliderLeft) + sliderLeft - x,\n          );\n          if (newDist < dist) {\n            dist = newDist;\n            tmpValue = mark;\n          }\n        });\n        result = tmpValue;\n      }\n    }\n    if (!Number.isInteger(result)) {\n      result = Number(result.toFixed(6));\n    }\n    return result;\n  }, [attachToMarksOnly, marks, max, min, step]);\n\n  const handleChange = useCallback((point: number) => {\n    const [sValue = 0, eValue = 0] = moveStart.current ? [point, end] : [start, point];\n    const rangeValue: [number, number] =\n      sValue > eValue ? [eValue, sValue] : [sValue, eValue];\n    onChange?.((range ? rangeValue : point) as T);\n  }, [onChange, range, start, end]);\n\n  const handleMouseMove = useCallback((e: MouseEvent) => {\n    const result = calculateDistance(e);\n    if (moveStart.current) {\n      setStart(result);\n    } else {\n      setEnd(result);\n    }\n    handleChange(result);\n  }, [calculateDistance, handleChange]);\n\n  const handleClickOnMark = useCallback((mark: number) => {\n    if (disable) return;\n    const isNearToStart = Math.abs(mark - (start ?? min)) < Math.abs((end ?? max) - mark);\n    if (range && isNearToStart) {\n      moveStart.current = true;\n      setStart(mark);\n    } else {\n      moveStart.current = false;\n      setEnd(mark);\n    }\n    handleChange(mark);\n  }, [disable, handleChange, start, end, range, min, max]);\n\n  const renderSliderMarks = useMemo(() => {\n    const marksProps = { marks, handleClickOnMark, sliderLength, disable };\n    return renderReactNode(mark, <SliderMarks {...marksProps} />, undefined);\n  }, [marks, handleClickOnMark, sliderLength, mark, disable]);\n\n  const handleMouseDownOnPoint = useCallback(() => {\n    if (!disable) {\n      setIsMove(true);\n      document.addEventListener('mouseup', () => {\n        document.removeEventListener('mousemove', handleMouseMove);\n        setIsMove(false);\n      });\n      document.addEventListener('mousemove', handleMouseMove);\n    }\n  }, [disable, handleMouseMove]);\n\n  const renderStartPoint = useMemo(() => {\n    if (!range) return null;\n    const pointProps = { range, handleMouseDownOnPoint, point: start, sliderLength, isMove, formatter, moveStart, isStart: true, disable, tip };\n    return renderReactNode(point, <SliderPoint {...pointProps} />, undefined);\n  }, [range, handleMouseDownOnPoint, start, sliderLength, isMove, formatter, point, disable, tip]);\n\n  const renderEndPoint = useMemo(() => {\n    const pointProps = { handleMouseDownOnPoint, point: end, sliderLength, isMove, formatter, moveStart, isStart: false, disable, tip };\n    return renderReactNode(point, <SliderPoint {...pointProps} />, undefined);\n  }, [handleMouseDownOnPoint, end, sliderLength, isMove, formatter, point, disable, tip]);\n\n  const renderSliderLine = useMemo(() => {\n    const lineProps = { start, end, sliderLength, disable };\n    return renderReactNode(line, <SliderLine {...lineProps} />, undefined);\n  }, [start, end, sliderLength, disable, line]);\n  return (\n    <SliderContainer\n      ref={sliderRef}\n      isMove={isMove}\n      {...mergeRestProps(rest, 'wdn-slider')}\n    >\n      {renderSliderLine}\n      {renderSliderMarks}\n      {renderStartPoint}\n      {renderEndPoint}\n    </SliderContainer>\n  );\n}) as <T extends SliderLegalValue>(props: IRestProps & SliderBaseProps<T>) => ReactElement;\n"],"mappings":"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"}