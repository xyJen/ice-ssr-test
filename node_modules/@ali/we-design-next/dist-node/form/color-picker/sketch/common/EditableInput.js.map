{"version":3,"file":"EditableInput.js","names":["DEFAULT_ARROW_OFFSET","UP_KEY_CODE","DOWN_KEY_CODE","ENTER_KEY_CODE","VALID_KEY_CODES","isValidKeyCode","keyCode","indexOf","getNumberValue","value","Number","String","replace","EditableInput","PureComponent","Component","constructor","props","handleBlur","e","_blur","setUpdatedValue","state","blurValue","setState","handleChange","target","handleKeyDown","stopPropagation","isNaN","offset","getArrowOffset","updatedValue","blur","handleDrag","dragLabel","newValue","Math","round","movementX","dragMax","onChange","getValueObjectWithLabel","handleMouseDown","preventDefault","window","addEventListener","handleMouseUp","unbindEventListeners","removeEventListener","toUpperCase","componentDidUpdate","prevProps","prevState","input","document","activeElement","componentWillUnmount","label","arrowOffset","onChangeValue","_input","render","styles","reactCSS","default","wrap","position","style","cursor","placeholder","hideLabel"],"sources":["../../../../../../src/form/color-picker/sketch/common/EditableInput.js"],"sourcesContent":["import React, { Component, PureComponent } from 'react';\nimport reactCSS from 'reactcss';\n\nconst DEFAULT_ARROW_OFFSET = 1;\n\nconst UP_KEY_CODE = 38;\nconst DOWN_KEY_CODE = 40;\nconst ENTER_KEY_CODE = 13\nconst VALID_KEY_CODES = [\n  UP_KEY_CODE,\n  DOWN_KEY_CODE,\n];\nconst isValidKeyCode = keyCode => VALID_KEY_CODES.indexOf(keyCode) > -1;\nconst getNumberValue = value => Number(String(value).replace(/%/g, ''));\n\nexport class EditableInput extends (PureComponent || Component) {\n  constructor(props) {\n    super();\n\n    this.state = {\n      value: String(props.value).toUpperCase(),\n      blurValue: String(props.value).toUpperCase(),\n    };\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (\n      this.props.value !== this.state.value &&\n      (prevProps.value !== this.props.value || prevState.value !== this.state.value)\n    ) {\n      if (this.input === document.activeElement) {\n        this.setState({ blurValue: String(this.props.value).toUpperCase() });\n      } else {\n        this.setState({ value: String(this.props.value).toUpperCase(), blurValue: !this.state.blurValue && String(this.props.value).toUpperCase() });\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    this.unbindEventListeners();\n  }\n\n  getValueObjectWithLabel(value) {\n    return {\n      [this.props.label]: value,\n    };\n  }\n\n  handleBlur = (e) => {\n    // 给 e 加一个 _blur 属性\n    // 用于 onChangeComplete\n    e._blur = true\n\n    this.setUpdatedValue(this.state.value, e)\n\n    if (this.state.blurValue) {\n      this.setState({ value: this.state.blurValue, blurValue: null })\n    }\n  };\n\n  handleChange = (e) => {\n    this.setUpdatedValue(e.target.value, e);\n  };\n\n  getArrowOffset() {\n    return this.props.arrowOffset || DEFAULT_ARROW_OFFSET;\n  }\n\n  handleKeyDown = (e) => {\n    e.stopPropagation();\n    // In case `e.target.value` is a percentage remove the `%` character\n    // and update accordingly with a percentage\n    // https://github.com/casesandberg/react-color/issues/383\n    const value = getNumberValue(e.target.value);\n\n    if (!isNaN(value) && isValidKeyCode(e.keyCode)) {\n      const offset = this.getArrowOffset();\n      const updatedValue = e.keyCode === UP_KEY_CODE ? value + offset : value - offset;\n      this.setUpdatedValue(updatedValue, e);\n    }\n\n    // Enter to blur\n    if (e.keyCode === ENTER_KEY_CODE) {\n      e.target.blur()\n    }\n  };\n\n  setUpdatedValue(value, e) {\n    const onChangeValue = this.props.label ? this.getValueObjectWithLabel(value) : value;\n\n    // 给 e 加一个 _input 属性\n    // 表明这次的 onChange 由输入框触发\n    e._input = true\n    this.props.onChange && this.props.onChange(onChangeValue, e);\n\n    this.setState({ value });\n  }\n\n  handleDrag = (e) => {\n    if (this.props.dragLabel) {\n      const newValue = Math.round(this.props.value + e.movementX);\n      if (newValue >= 0 && newValue <= this.props.dragMax) {\n        this.props.onChange && this.props.onChange(this.getValueObjectWithLabel(newValue), e);\n      }\n    }\n  };\n\n  handleMouseDown = (e) => {\n    if (this.props.dragLabel) {\n      e.preventDefault();\n      this.handleDrag(e);\n      window.addEventListener('mousemove', this.handleDrag);\n      window.addEventListener('mouseup', this.handleMouseUp);\n    }\n  };\n\n  handleMouseUp = () => {\n    this.unbindEventListeners();\n  };\n\n  unbindEventListeners = () => {\n    window.removeEventListener('mousemove', this.handleDrag);\n    window.removeEventListener('mouseup', this.handleMouseUp);\n  };\n\n  render() {\n    const styles = reactCSS({\n      default: {\n        wrap: {\n          position: 'relative',\n        },\n      },\n      'user-override': {\n        wrap: this.props.style && this.props.style.wrap ? this.props.style.wrap : {},\n        input: this.props.style && this.props.style.input ? this.props.style.input : {},\n        label: this.props.style && this.props.style.label ? this.props.style.label : {},\n      },\n      'dragLabel-true': {\n        label: {\n          cursor: 'ew-resize',\n        },\n      },\n    }, {\n      'user-override': true,\n    }, this.props);\n\n    return (\n      <div style={styles.wrap}>\n        <input\n          style={styles.input}\n          ref={input => { this.input = input; }}\n          value={this.state.value}\n          onKeyDown={this.handleKeyDown}\n          onChange={this.handleChange}\n          onBlur={this.handleBlur}\n          placeholder={this.props.placeholder}\n          spellCheck=\"false\"\n        />\n        { this.props.label && !this.props.hideLabel ? (\n          <span style={styles.label} onMouseDown={this.handleMouseDown}>\n            {this.props.label}\n          </span>\n        ) : null}\n      </div>\n    );\n  }\n}\n\nexport default EditableInput;\n"],"mappings":"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"}