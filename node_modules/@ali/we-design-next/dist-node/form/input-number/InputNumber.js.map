{"version":3,"file":"InputNumber.js","names":["isValidNumber","text","isNaN","parseFloat","toValidNumber","isValidNumberFragment","test","normalizeDigits","d","Math","floor","max","setDelayInterval","fn","delay","interval","it","timeout","setTimeout","setInterval","clearTimeout","clearInterval","InputNumber","React","memo","props","defaultValue","value","onChange","min","Infinity","step","bordered","digits","control","onBlur","onEnter","disabled","rest","v","setV","useDefaultProp","t","setT","useState","undefined","handleIncrease","useEventCallback","handleDecrease","timingRef","useRef","handleIncreasingStart","current","handleDecreasingStart","handleIncreasingDecreasingEnd","handleChange","e","target","handleEnter","handleBlur","toFixed","toString","mergeRestProps","paddingRight","overflow"],"sources":["../../../../src/form/input-number/InputNumber.tsx"],"sourcesContent":["import React, { useState, useRef } from 'react';\nimport { Input } from '../input/Input';\nimport { useDefaultProp, useEventCallback, MergePropsType, mergeRestProps } from '../../common';\nimport { ArrowUpIcon, ArrowDownIcon, NumberControlWrap } from './styled';\n\nexport type IInputNumberProps = MergePropsType<{\n  /**\n   * 默认初始值\n   */\n  defaultValue?: number;\n  /**\n   * 值\n   */\n  value?: number | null;\n  /**\n   * 值变化事件\n   */\n  onChange?: (v: number | null) => void;\n  /**\n  * 回车\n  */\n  onEnter?: React.KeyboardEventHandler<HTMLInputElement>;\n  /**\n   * 最小值\n   */\n  min?: number;\n  /**\n   * 最大值\n   */\n  max?: number;\n  /**\n   * 步长\n   */\n  step?: number;\n  /**\n   * 是否有边框\n   */\n  bordered?: boolean;\n  /**\n   * 小数点后的位数\n   */\n  digits?: number;\n  /**\n   * 默认true；flip则上减下加；false则不显示上下按钮\n   */\n  control?: boolean | 'flip';\n}, React.InputHTMLAttributes<HTMLInputElement>>;\n\nconst isValidNumber = (text: string): boolean => !isNaN(parseFloat(text));\n\nconst toValidNumber = (text: string): number => parseFloat(text);\n\n// 是否是合法的数字，或者是形如 '-' 或 '1.' 这样输入到一半的片段\nconst isValidNumberFragment = (text: string): boolean => text !== '' && /^-?(\\d+(\\.\\d*)?)?$/.test(text);\n\n// 小数位数仅支持大于等于 0 的整数\nconst normalizeDigits = (d: number): number => Math.floor(Math.max(d, 0));\n\nconst setDelayInterval = (fn: () => void, delay: number, interval: number): () => void => {\n\n  let it: number = 0;\n  let timeout: number | null = setTimeout(() => {\n    it = setInterval(fn, interval) as any;\n    timeout = null;\n  }, delay) as any;\n\n  return () => {\n    if (timeout) {\n      clearTimeout(timeout);\n    } else {\n      clearInterval(it);\n    }\n  };\n}\n\nexport const InputNumber = React.memo(\n  (props: IInputNumberProps) => {\n\n    const {\n      defaultValue,\n      value,\n      onChange,\n      min = -Infinity,\n      max = Infinity,\n      step = 1,\n      bordered = true,\n      digits,\n      control = true,\n      onBlur,\n      onEnter,\n\n      disabled,\n      ...rest\n    } = props;\n\n    const [v, setV] = useDefaultProp(defaultValue, value, onChange);\n    const [t, setT] = useState<string | undefined>(undefined);\n\n    const handleIncrease = useEventCallback(\n      () => {\n        if (typeof v === 'number') {\n          setT(undefined);\n          setV(Math.min(v + step, max));\n        }\n      }\n    );\n\n    const handleDecrease = useEventCallback(\n      () => {\n        if (typeof v === 'number') {\n          setT(undefined);\n          setV(Math.max(v - step, min));\n        }\n      }\n    );\n\n    const timingRef = useRef<(() => void) | undefined>(undefined);\n\n    const handleIncreasingStart = useEventCallback(() => {\n      if (timingRef.current === undefined) {\n        timingRef.current = setDelayInterval(handleIncrease, 800, 60);\n      }\n    });\n\n    const handleDecreasingStart = useEventCallback(() => {\n      if (timingRef.current === undefined) {\n        timingRef.current = setDelayInterval(handleDecrease, 800, 60);\n      }\n    });\n\n    const handleIncreasingDecreasingEnd = useEventCallback(() => {\n      if (typeof timingRef.current === 'function') {\n        timingRef.current();\n        timingRef.current = undefined;\n      }\n    });\n\n    const handleChange = useEventCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n      const text = e.target.value;\n      if (text === '') {\n        setT(undefined);\n        setV(undefined);\n      } else if (isValidNumber(text)) {\n        setT(text);\n        setV(Math.max(Math.min(toValidNumber(text), max), min));\n      } else if (isValidNumberFragment(text)) {\n        setT(text);\n      }\n    });\n\n    const handleEnter = useEventCallback((e: React.KeyboardEvent<HTMLInputElement>) => {\n      setT(undefined);\n      onEnter && onEnter(e);\n    });\n\n    const handleBlur = useEventCallback((e: React.FocusEvent<HTMLInputElement>) => {\n      setT(undefined);\n      onBlur && onBlur(e);\n    });\n\n    return <Input\n      value={typeof t === 'string' ? t : typeof v === 'number' ? typeof digits === 'number' ? v.toFixed(normalizeDigits(digits)) : v.toString() : ''}\n      onChange={handleChange}\n      disabled={disabled}\n      bordered={bordered}\n      onEnter={handleEnter}\n      suffix={\n        control ?\n        <NumberControlWrap>\n          <ArrowUpIcon\n            disabled={!!disabled || typeof v !== 'number' || (control === 'flip' ? v <= min : v >= max)}\n            onClick={control === 'flip' ? handleDecrease : handleIncrease}\n            onMouseDown={control === 'flip' ? handleDecreasingStart : handleIncreasingStart}\n            onMouseUp={handleIncreasingDecreasingEnd}\n            onMouseLeave={handleIncreasingDecreasingEnd}\n          />\n          <ArrowDownIcon\n            disabled={!!disabled || typeof v !== 'number' || (control === 'flip' ? v >= max : v <= min)}\n            onClick={control === 'flip' ? handleIncrease : handleDecrease}\n            onMouseDown={control === 'flip' ? handleIncreasingStart : handleDecreasingStart}\n            onMouseUp={handleIncreasingDecreasingEnd}\n            onMouseLeave={handleIncreasingDecreasingEnd}\n          />\n        </NumberControlWrap> : undefined\n      }\n      {...mergeRestProps(rest, 'wdn_input_number', { paddingRight: 0, overflow: 'hidden' })}\n      onBlur={handleBlur}\n    />;\n  }\n);"],"mappings":"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"}