{"version":3,"file":"MultiSelect.js","names":["ITEM_WIDTH","MIN_INPUT_WIDTH","LEFT_PADDING","DEFAULT_OPTISON","MultiSelect","React","memo","forwardRef","props","ref","value","outValue","defaultValue","options","onChange","visible","outVisible","defaultVisible","onVisibleChange","disabled","size","getContainer","placeholder","error","inputValue","outInputValue","onInputValueChange","renderTag","renderTagMore","children","rest","flattenOptions","useMemo","flattenNested","k","key","title","setValue","useDefaultProp","setVisible","setInputValue","containerWidth","setContainerWidth","useState","itemWidths","setItemWidths","Map","restWidth","setRestWidth","inputWidth","setInputWidth","displayCount","setDisplayCount","restReady","setRestReady","myRef","useRef","mouseInInput","setMouseInInput","active","setActive","outerRef","focusTargetId","focusTarget","focusOwner","useFocusTarget","mergedDisplayCount","Number","MAX_SAFE_INTEGER","useEffect","current","calcContainerWidth","entries","entry","width","contentRect","eleResizeObserver","ResizeObserver","observe","disconnect","registerSize","origin","clone","delete","set","registerTagMoreSize","_","registerInputSize","updateDisplayCount","count","notReady","length","displayOptions","filter","op","includes","map","label","toString","mergedData","slice","Math","min","useLayoutEffect","totalWidth","len","lastIndex","i","currentItemWidth","get","undefined","onOptionClick","useCallback","curKey","newValue","curKeyIndex","indexOf","splice","push","updateValueByInputValue","result1","find","result","index","handleEsc","handleKeyDown","e","which","KEY_CODES","DELETE","BACKSPACE","pop","ENTER","nativeEvent","stopImmediatePropagation","DOWN","fn","firstKey","o","ESC","handleInputValueChange","target","onTagClose","stopPropagation","onArrowClick","onMouseEnter","onMouseLeave","handleClear","tagsNode","restNode","item","omittedOptions","displayRest","suffixNode","minWidth","p","cloneElement","suffix","proxyRestProps","document","body","mergeRestProps","flexGrow"],"sources":["../../../../src/form/multiselect/MultiSelect.tsx"],"sourcesContent":["import React, { ReactNode, useMemo, useCallback, useState, useLayoutEffect, useEffect, useRef } from 'react';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport { Popover } from '../../display/popover';\nimport { useDefaultProp, IRestProps, mergeRestProps, proxyRestProps, KEY_CODES, useFocusTarget } from '../../common';\nimport { IconSelected, List } from '../../index';\nimport { IListItemNormalized, IListItemCustomized, INestedItems, flattenNested } from '../../basic/list/nested';\nimport { Input } from '../../form/input';\nimport { Tag, TagMore, Item } from './Tag';\nimport { MultiSelectInputWrap, SuffixWrap, OverlayWrap, ErrorTip, DisableMask, OverflowWrap, ArrowDown, ArrowUp, ClearIcon } from './styled';\n\nexport type INormalizedMultiSelectOption = IListItemNormalized;\n\nexport type ICustomizedMultiSelectOption = IListItemCustomized;\n\nexport type IMultiSelectOption = INormalizedMultiSelectOption | ICustomizedMultiSelectOption;\n\nexport type IMultiSelectOptionGroup = {\n  title: string;\n  items: Array<IMultiSelectOption>;\n};\n\nexport type IMultiSelectProps = {\n  /**\n   * 选中值\n   */\n  value?: string[];\n  /**\n   * 默认值\n   */\n  defaultValue?: string[];\n  /**\n   * 选中值变化时的回调\n   */\n  onChange?: (value: string[]) => void;\n  /**\n   * 下拉列表的选项\n   */\n  options?: INestedItems<IMultiSelectOption>;\n  /**\n   * 下拉弹层可见性\n   */\n  visible?: boolean;\n  /**\n   * 下拉弹层默认可见性\n   */\n  defaultVisible?: boolean;\n  /**\n   * 弹层可见性变化时的回调\n   */\n  onVisibleChange?: (visible: boolean) => void;\n  /**\n   * 禁用态\n   */\n  disabled?: boolean;\n  /**\n   * 占位提示\n   */\n  placeholder?: string;\n  /**\n   * 组件尺寸\n   */\n  size?: 'small' | 'normal';\n  /**\n   * 弹层挂载的容器元素\n   */\n  getContainer?: () => HTMLElement;\n  /**\n   * 错误提示\n   */\n  error?: string;\n  /**\n   * 输入框的值\n   */\n  inputValue?: string;\n  /**\n   * 输入框值变化时的回调\n   */\n  onInputValueChange?: (value: string) => void;\n  /**\n   * 标签自定义样式函数\n   */\n  renderTag?: (\n    label: string,\n    value: string,\n    closable?: boolean,\n    onClose?: (e: React.MouseEvent) => void\n  ) => React.ReactNode;\n  /**\n   * 更多标签的自定义样式函数\n   */\n  renderTagMore?: (omittedValues: string[]) => React.ReactNode;\n} & IRestProps;\n\nconst ITEM_WIDTH = 10; // 用来限制渲染的节点，避免性能问题\nconst MIN_INPUT_WIDTH = 40;\nexport const LEFT_PADDING = 4;\n\nconst DEFAULT_OPTISON: [] = [];\n\nexport const MultiSelect = React.memo(React.forwardRef<HTMLInputElement, IMultiSelectProps>((props, ref) => {\n  const {\n    value: outValue,\n    defaultValue = [],\n    options = DEFAULT_OPTISON,\n    onChange,\n    visible: outVisible,\n    defaultVisible = false,\n    onVisibleChange,\n    disabled,\n    size = 'normal',\n    getContainer,\n    placeholder,\n    error,\n    inputValue: outInputValue,\n    onInputValueChange,\n    renderTag,\n    renderTagMore,\n    children,\n    ...rest\n  } = props;\n\n  const flattenOptions = useMemo(() => flattenNested(options, k => ({ key: k, title: k })), [options]);\n\n  const [value, setValue] = useDefaultProp<string[]>(defaultValue, outValue, onChange);\n  const [visible, setVisible] = useDefaultProp<boolean>(defaultVisible, outVisible, onVisibleChange);\n  const [inputValue, setInputValue] = useDefaultProp<string>('', outInputValue, onInputValueChange);\n\n  const [containerWidth, setContainerWidth] = useState<number>(0);\n  const [itemWidths, setItemWidths] = useState(new Map<React.Key, number>());\n  const [restWidth, setRestWidth] = useState<number>(0);\n  const [inputWidth, setInputWidth] = useState<number>(0);\n\n  const [displayCount, setDisplayCount] = useState<number>(0);\n  const [restReady, setRestReady] = useState(false);\n  const myRef = useRef<HTMLDivElement>(null);\n\n  const [mouseInInput, setMouseInInput] = useState<boolean>(false);\n\n  const [active, setActive] = useState<string | null>(null);\n\n  const outerRef = useRef<HTMLInputElement>(null);\n  const [focusTargetId, focusTarget, focusOwner] = useFocusTarget(outerRef);\n\n  const mergedDisplayCount = useMemo(() => {\n    if (displayCount === null) {\n      return Number.MAX_SAFE_INTEGER;\n    }\n    return displayCount || 0;\n  }, [displayCount, containerWidth]);\n\n  useEffect(() => {\n    if (!myRef.current) {\n      return;\n    }\n    const calcContainerWidth = ((entries: ResizeObserverEntry[]) => {\n      const entry = entries[0];\n      if (!entry) {\n        return;\n      }\n      const { width } = entry.contentRect;\n      if (width === 0) {\n        return;\n      }\n      setContainerWidth(width);\n    });\n\n    const eleResizeObserver = new ResizeObserver(calcContainerWidth);\n    eleResizeObserver.observe(myRef.current);\n\n    return () => {\n      eleResizeObserver.disconnect();\n    };\n  }, []);\n\n  const registerSize = (key: React.Key, width: number | null) => {\n    setItemWidths(origin => {\n      const clone = new Map(origin);\n\n      if (width === null) {\n        clone.delete(key);\n      } else {\n        clone.set(key, width);\n      }\n      return clone;\n    });\n  }\n\n  const registerTagMoreSize = (_: React.Key, width: number | null) => {\n    setRestWidth(width!);\n  };\n\n  const registerInputSize = (_: React.Key, width: number | null) => {\n    setInputWidth(width!);\n  }\n\n  const updateDisplayCount = (count: number, notReady?: boolean) => {\n    setDisplayCount(count);\n    if (!notReady) {\n      setRestReady(count < value.length - 1);\n    }\n  }\n  const displayOptions = useMemo(() => {\n    return flattenOptions.filter(op => value.includes(op.key)).map(\n      op => 'title' in op ? { value: op.key, label: op.title?.toString() || '' } : { value: op.key, label: op.key }\n    );\n  }, [options, value]);\n\n  const mergedData = useMemo(() => {\n    return displayOptions.slice(0, Math.min(value.length, containerWidth / ITEM_WIDTH));\n  }, [displayOptions, containerWidth]);\n\n  useLayoutEffect(() => {\n    if (containerWidth && restWidth && mergedData) {\n      let totalWidth = MIN_INPUT_WIDTH + LEFT_PADDING;\n\n      const len = mergedData.length;\n      const lastIndex = len - 1;\n\n      if (!value.length) {\n        updateDisplayCount(0);\n        return;\n      }\n\n      for (let i = 0; i < len; i += 1) {\n        const currentItemWidth = itemWidths.get(mergedData[i].value);\n\n        // 如果数据没ready，break\n        if (currentItemWidth === undefined) {\n          updateDisplayCount(i - 1, true);\n          break;\n        }\n\n        totalWidth += currentItemWidth;\n\n        if (\n          // 只有一个的话，totalWidth就是最后的宽度\n          (lastIndex === 0 && totalWidth <= containerWidth) ||\n          // 最后两个宽度将会是最后宽度\n          (i === lastIndex - 1 && totalWidth + itemWidths.get(mergedData[lastIndex].value)! <= containerWidth)\n        ) {\n          updateDisplayCount(lastIndex);\n          break;\n        } else if (totalWidth + restWidth > containerWidth) {\n          updateDisplayCount(i - 1);\n          break;\n        }\n      }\n    }\n  }, [containerWidth, itemWidths, restWidth, inputWidth, mergedData]);\n\n  const onOptionClick = useCallback((curKey: string) => {\n    const newValue = [...value];\n    const curKeyIndex = newValue.indexOf(curKey);\n    if (curKeyIndex !== -1) {\n      newValue.splice(curKeyIndex, 1);\n    } else {\n      newValue.push(curKey);\n    }\n    setValue(newValue);\n  }, [value, setValue]);\n\n  const updateValueByInputValue = useCallback(() => {\n\n    if (!inputValue) {\n      return;\n    }\n\n    const result1 = flattenOptions.find(op => 'title' in op && !op.disabled && op.title?.toString().includes(inputValue));\n    const result = (result1 && 'title' in result1) ? result1.key : undefined;\n    if (!result) {\n      return;\n    }\n    const newValue = [...value];\n    const index = newValue.indexOf(result);\n    if (index !== -1) {\n      newValue.splice(index, 1);\n    } else {\n      newValue.push(result);\n    }\n    setInputValue('');\n    setValue(newValue);\n  }, [options, inputValue, value, setValue, setInputValue]);\n\n  const handleEsc = useCallback(() => {\n    focusOwner(() => {\n      setActive(null);\n      setVisible(false);\n    });\n  }, [setVisible]);\n\n  const handleKeyDown = useCallback((e: React.KeyboardEvent<HTMLInputElement>) => {\n    switch (e.which) {\n      case KEY_CODES.DELETE:\n      case KEY_CODES.BACKSPACE:\n        if (inputValue === '' && value.length) {\n          const newValue = [...value];\n          newValue.pop();\n          setValue(newValue);\n        }\n        break;\n      case KEY_CODES.ENTER:\n        !visible && setVisible(true);\n        updateValueByInputValue();\n        e.nativeEvent.stopImmediatePropagation();\n        break;\n      case KEY_CODES.DOWN:\n        if (active === null) {\n          const fn = () => {\n            setVisible(true);\n            const firstKey = flattenOptions.filter(o => !('disabled' in o && !!o.disabled))[0].key;\n            if (firstKey) {\n              setActive(firstKey);\n            }\n          };\n          focusTarget(fn);\n        }\n        break;\n      case KEY_CODES.ESC:\n        handleEsc();\n        break;\n      default: break;\n    }\n  }, [updateValueByInputValue, value, inputValue, setValue, active, setVisible, options, handleEsc]);\n\n  const handleInputValueChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setInputValue(e.target.value);\n  }, [setInputValue]);\n\n  const onTagClose = useCallback((e: React.MouseEvent, key: string) => {\n    e.stopPropagation();\n    e.nativeEvent.stopImmediatePropagation();\n    const newValue = [...value];\n    const index = newValue.indexOf(key);\n    if (index !== -1) {\n      newValue.splice(index, 1);\n    }\n    setValue(newValue);\n  }, [value, setValue]);\n\n  const onArrowClick: React.MouseEventHandler<HTMLSpanElement> = useCallback((e: React.MouseEvent) => {\n    // TODO: 点击箭头收起下拉菜单\n    // TODO: (依赖menu) 自定义节点内容时的hover样式、点击自定义节点将所选项、key放到div和input\n    // if (visible) {\n    // ref?.current?.blur();\n    // }\n  }, [visible]);\n\n  const onMouseEnter = useCallback((e: React.MouseEvent) => {\n    !disabled && setMouseInInput(true);\n  }, [disabled]);\n\n  const onMouseLeave = useCallback((e: React.MouseEvent) => {\n    setMouseInInput(false);\n  }, []);\n\n  const handleClear = useCallback((e: React.MouseEvent) => {\n    // TODO: 如果选项有closable为false的，怎么处理\n    e.stopPropagation();\n    e.nativeEvent.stopImmediatePropagation();\n    setValue([]);\n    setInputValue('');\n  }, [setValue, setInputValue]);\n\n  let tagsNode: React.ReactNode;\n  let restNode: React.ReactNode;\n  if (value.length) {\n    tagsNode = mergedData.map((item, index) =>\n      <Item key={item.value} order={index} itemKey={item.value} registerSize={registerSize} display={index <= mergedDisplayCount}>\n        <Tag value={item.value} label={item.label} closable={true} size={size} onClose={(e: React.MouseEvent) => onTagClose(e, item.value)} />\n      </Item>\n    );\n\n    const omittedOptions = displayOptions.slice(mergedDisplayCount + 1);\n    const displayRest = restReady && !!omittedOptions.length;\n    restNode = <Item order={displayRest ? mergedDisplayCount : Number.MAX_SAFE_INTEGER} registerSize={registerTagMoreSize} display={displayRest}>\n      <TagMore omittedTags={omittedOptions} size={size} />\n    </Item>;\n  }\n\n  let suffixNode: React.ReactElement = <SuffixWrap onClick={onArrowClick}>\n    {!disabled && visible ? <ArrowUp disabled={disabled} /> : <ArrowDown disabled={disabled} />}\n  </SuffixWrap>;\n  if (value.length && mouseInInput) {\n    suffixNode = <SuffixWrap onClick={handleClear}><ClearIcon /></SuffixWrap>;\n  }\n\n  return <Popover\n    placement=\"bottomLeft\"\n    placementOffset={[4, 0]}\n    animation\n    content={<OverlayWrap style={{ minWidth: containerWidth }}>\n      <List id={focusTargetId} items={options} onSelect={onOptionClick} active={active} onActiveChange={e => { setActive(e); }}\n        renderItem={({ key }) => (p: React.ReactElement) => {\n          return value.includes(key) ? React.cloneElement(p, { suffix: <IconSelected /> }) : p;\n        }}\n        style={{ minWidth: 'auto' }}\n        {...proxyRestProps(rest, 'list')}\n      />\n    </OverlayWrap>}\n    visible={!disabled && visible}\n    trigger=\"click\"\n    onVisibleChange={(e) => {\n      if (e) {\n        !visible && setVisible(e);\n      } else {\n        visible && setVisible(e);\n        setActive(null);\n      }\n    }}\n    getContainer={getContainer || (() => outerRef.current || document.body)}\n    onKeyDown={(e) => { e.which === KEY_CODES.ESC && handleEsc() }}\n  >\n    <MultiSelectInputWrap\n      tabIndex={-1}\n      ref={outerRef}\n      onKeyDown={handleKeyDown}\n      error={error}\n      disabled={disabled}\n      size={size}\n      visible={!disabled && visible}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n      {...mergeRestProps(rest, 'wdn-multi-select')}\n    >\n      <OverflowWrap ref={myRef}>\n        {tagsNode}\n        {restNode}\n        <Item order={mergedDisplayCount} registerSize={registerInputSize} display style={{ flexGrow: 1 }}>\n          <Input\n            ref={ref}\n            className=\"input\"\n            bordered={false}\n            size={size}\n            value={inputValue}\n            disabled={!!disabled}\n            placeholder={!value.length ? placeholder : undefined}\n            onBlur={updateValueByInputValue}\n            onChange={handleInputValueChange}\n            suffix={suffixNode}\n          />\n        </Item>\n      </OverflowWrap>\n      {disabled && <DisableMask />}\n      {error && <ErrorTip>{error}</ErrorTip>}\n    </MultiSelectInputWrap>\n  </Popover >;\n}));"],"mappings":"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"}