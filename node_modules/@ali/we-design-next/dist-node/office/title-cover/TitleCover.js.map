{"version":3,"file":"TitleCover.js","names":["TitleCover","React","memo","forwardRef","props","ref","cover","renderError","rest","src","thumbSrc","transform","getCover","useEventCallback","offsetY","dataPosition","position","setPosition","useState","DEFAULT_POSITION","imageRef","useRef","isReposition","setIsReposition","onChangeFnsRef","useImperativeHandle","onChange","fn","current","push","i","indexOf","splice","setRenderPosition","renderP","startReposition","endReposition","getImageRef","useEffect","getSafePosition","safePosition","t","useTranslate","style","cursor","mergeRestProps"],"sources":["../../../../src/office/title-cover/TitleCover.tsx"],"sourcesContent":["import React, {\n  DOMAttributes,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n} from 'react';\nimport { useTranslate } from \"../../locale\";\nimport { IRestProps, mergeRestProps } from '../../common/react/mergeRestProps';\nimport { useEventCallback } from '../../common';\nimport { Cover } from './components/cover';\nimport { RepositionTips, TitleCoverWrapper } from './style';\nimport { getSafePosition } from './utils';\nimport { DEFAULT_POSITION } from './constants';\n\nexport type Cover = {\n  /**\n   * 封面图片地址\n   */\n  src: string;\n  /**\n   * 封面缩略图地址\n   */\n  thumbSrc?: string;\n  /**\n   * 偏移量（目前仅支持垂直方向）\n   * 相对垂直方向位置，参考 CSS 属性 object-position\n   * 默认居中（0.5），取值范围 [0, 1]\n   */\n  transform?: {\n    offsetY?: number;\n  };\n};\n\ntype IChangeOption = {\n  isReposition: boolean;\n  position: number;\n};\n\nexport type TitleCoverProps = {\n  cover: Cover;\n  /**\n   * 图片加载失败占位\n   */\n  renderError?: () => React.ReactNode;\n} & IRestProps & DOMAttributes<HTMLDivElement>;\n\ntype TitleCoverHandlers = {\n  onChange: (fn: (option: IChangeOption) => void) => () => void,\n  startReposition: () => void;\n  endReposition: () => void;\n  setRenderPosition: (p: number) => void;\n  getImageRef: () => React.RefObject<HTMLImageElement>;\n  getCover: () => Cover;\n};\n\nexport const TitleCover = React.memo(\n  React.forwardRef<TitleCoverHandlers, TitleCoverProps>(\n    (props, ref) => {\n      const {\n        cover,\n        renderError,\n        ...rest\n      } = props;\n      const {\n        src,\n        thumbSrc,\n        transform = {},\n      } = cover;\n\n      const getCover = useEventCallback(() => cover);\n\n      const { offsetY: dataPosition } = transform;\n\n      const [position, setPosition] = useState<number>(DEFAULT_POSITION);\n      const imageRef = useRef<HTMLImageElement>(null);\n      const [isReposition, setIsReposition] = useState(false);\n      const onChangeFnsRef = useRef<Array<(option: IChangeOption) => void>>([]);\n\n      useImperativeHandle(ref, () => ({\n        onChange: (fn: (option: IChangeOption) => void) => {\n          onChangeFnsRef.current.push(fn);\n          return () => {\n            const i = onChangeFnsRef.current.indexOf(fn);\n            if (i !== -1) {\n              onChangeFnsRef.current.splice(i, 1);\n            }\n          }\n        },\n        setRenderPosition: (renderP) => {\n          setPosition(renderP);\n        },\n        startReposition: () => {\n          setIsReposition(true);\n        },\n        endReposition: () => {\n          setIsReposition(false);\n        },\n        getImageRef: () => imageRef,\n        getCover,\n      }));\n\n      useEffect(() => {\n        setPosition(getSafePosition(dataPosition));\n      }, [dataPosition]);\n\n      useEffect(() => {\n        for (const fn of onChangeFnsRef.current) {\n          fn({\n            isReposition,\n            position,\n          });\n        }\n      }, [isReposition, position]);\n\n      const safePosition = getSafePosition(position);\n\n      const t = useTranslate();\n\n      const style = { cursor: isReposition ? \"move\" : \"auto\" };\n\n      return (\n        <TitleCoverWrapper\n          {...mergeRestProps(rest, 'wdn-title-cover', style)}\n        >\n          <Cover\n            ref={imageRef}\n            src={src}\n            thumbSrc={thumbSrc}\n            position={safePosition}\n            renderError={renderError}\n          />\n          <RepositionTips visible={isReposition}>\n            {t(\"wdn_title_cover_drag_reposition\")}\n          </RepositionTips>\n        </TitleCoverWrapper>\n      );\n    }\n  )\n);\n"],"mappings":";;;;;;AAAA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AAA+C;AAAA;AAAA,uBAZnB;AAuDrB,MAAMA,UAAU,gBAAGC,cAAK,CAACC,IAAI,eAClCD,cAAK,CAACE,UAAU,CACd,CAACC,KAAK,EAAEC,GAAG,KAAK;EACd,MAAM;IACJC,KAAK;IACLC,WAAW;IACX,GAAGC;EACL,CAAC,GAAGJ,KAAK;EACT,MAAM;IACJK,GAAG;IACHC,QAAQ;IACRC,SAAS,GAAG,CAAC;EACf,CAAC,GAAGL,KAAK;EAET,MAAMM,QAAQ,GAAG,IAAAC,wBAAgB,EAAC,MAAMP,KAAK,CAAC;EAE9C,MAAM;IAAEQ,OAAO,EAAEC;EAAa,CAAC,GAAGJ,SAAS;EAE3C,MAAM,CAACK,QAAQ,EAAEC,WAAW,CAAC,GAAG,IAAAC,eAAQ,EAASC,2BAAgB,CAAC;EAClE,MAAMC,QAAQ,GAAG,IAAAC,aAAM,EAAmB,IAAI,CAAC;EAC/C,MAAM,CAACC,YAAY,EAAEC,eAAe,CAAC,GAAG,IAAAL,eAAQ,EAAC,KAAK,CAAC;EACvD,MAAMM,cAAc,GAAG,IAAAH,aAAM,EAAyC,EAAE,CAAC;EAEzE,IAAAI,0BAAmB,EAACpB,GAAG,EAAE,OAAO;IAC9BqB,QAAQ,EAAGC,EAAmC,IAAK;MACjDH,cAAc,CAACI,OAAO,CAACC,IAAI,CAACF,EAAE,CAAC;MAC/B,OAAO,MAAM;QACX,MAAMG,CAAC,GAAGN,cAAc,CAACI,OAAO,CAACG,OAAO,CAACJ,EAAE,CAAC;QAC5C,IAAIG,CAAC,KAAK,CAAC,CAAC,EAAE;UACZN,cAAc,CAACI,OAAO,CAACI,MAAM,CAACF,CAAC,EAAE,CAAC,CAAC;QACrC;MACF,CAAC;IACH,CAAC;IACDG,iBAAiB,EAAGC,OAAO,IAAK;MAC9BjB,WAAW,CAACiB,OAAO,CAAC;IACtB,CAAC;IACDC,eAAe,EAAE,MAAM;MACrBZ,eAAe,CAAC,IAAI,CAAC;IACvB,CAAC;IACDa,aAAa,EAAE,MAAM;MACnBb,eAAe,CAAC,KAAK,CAAC;IACxB,CAAC;IACDc,WAAW,EAAE,MAAMjB,QAAQ;IAC3BR;EACF,CAAC,CAAC,CAAC;EAEH,IAAA0B,gBAAS,EAAC,MAAM;IACdrB,WAAW,CAAC,IAAAsB,sBAAe,EAACxB,YAAY,CAAC,CAAC;EAC5C,CAAC,EAAE,CAACA,YAAY,CAAC,CAAC;EAElB,IAAAuB,gBAAS,EAAC,MAAM;IACd,KAAK,MAAMX,EAAE,IAAIH,cAAc,CAACI,OAAO,EAAE;MACvCD,EAAE,CAAC;QACDL,YAAY;QACZN;MACF,CAAC,CAAC;IACJ;EACF,CAAC,EAAE,CAACM,YAAY,EAAEN,QAAQ,CAAC,CAAC;EAE5B,MAAMwB,YAAY,GAAG,IAAAD,sBAAe,EAACvB,QAAQ,CAAC;EAE9C,MAAMyB,CAAC,GAAG,IAAAC,oBAAY,GAAE;EAExB,MAAMC,KAAK,GAAG;IAAEC,MAAM,EAAEtB,YAAY,GAAG,MAAM,GAAG;EAAO,CAAC;EAExD,oBACE,eAAC,wBAAiB,EACZ,IAAAuB,8BAAc,EAACrC,IAAI,EAAE,iBAAiB,EAAEmC,KAAK,CAAC,eAElD,eAAC,YAAK;IACJ,GAAG,EAAEvB,QAAS;IACd,GAAG,EAAEX,GAAI;IACT,QAAQ,EAAEC,QAAS;IACnB,QAAQ,EAAE8B,YAAa;IACvB,WAAW,EAAEjC;EAAY,EACzB,eACF,eAAC,qBAAc;IAAC,OAAO,EAAEe;EAAa,GACnCmB,CAAC,CAAC,iCAAiC,CAAC,CACtB,CACC;AAExB,CAAC,CACF,CACF;AAAC"}