{"version":3,"file":"index.js","names":["useForceUpdate","setValue","useState","useCallback","Math","random","TIME_6S","DEFAULT_PLAY_SPEED","Carousel","props","children","onChange","autoPlayTime","playSpeed","autoPlay","showCarouselDots","currentItemIndex","itemWidth","isHover","setIsHover","isCurrentItemIndexNumber","carouselChildrenNodes","useMemo","result","React","Children","forEach","node","push","carouselWidth","length","flush","state","useRef","childrenNodes","currentIndex","timer","current","SetCurrentIndex","i","next","nextIndex","reSetCarouselInterval","clearInterval","window","setInterval","useEffect","goTo","index","handleMouseEnter","handleMouseLeave","width","transition","transform","map","_item"],"sources":["../../../../../src/office/guidance/carousel/index.tsx"],"sourcesContent":["/* eslint-disable max-lines-per-function */\nimport React, {\n  useRef,\n  useState,\n  useMemo,\n  useCallback,\n  useEffect,\n} from 'react';\nimport { CarouselWrapper } from './style';\n\nexport interface ICarouselProps {\n  itemWidth: number;\n  currentItemIndex?: number;\n  onChange?: (i: number) => void;\n  autoPlay?: boolean;\n  autoPlayTime?: number;\n  playSpeed?: number;\n  showCarouselDots?: boolean;\n}\n\ninterface IState {\n  childrenNodes: React.ReactNode[];\n  currentIndex: number;\n  timer: number;\n}\n\nconst useForceUpdate = () => {\n  const setValue = useState(-1)[1];\n  return useCallback(() => {\n    setValue(Math.random());\n  }, [setValue]);\n};\n\nconst TIME_6S = 6 * 1000;\nconst DEFAULT_PLAY_SPEED = 0.5;\n\nexport const Carousel = (props: React.PropsWithChildren<ICarouselProps>) => {\n  const {\n    children,\n    onChange = () => {},\n    autoPlayTime = TIME_6S,\n    playSpeed = DEFAULT_PLAY_SPEED,\n    autoPlay = true,\n    showCarouselDots = true,\n    currentItemIndex,\n    itemWidth,\n  } = props;\n\n  const [isHover, setIsHover] = useState(false);\n\n  const isCurrentItemIndexNumber = typeof currentItemIndex === 'number';\n\n  // 初始化的时候生成一次子节点\n  const carouselChildrenNodes = useMemo(() => {\n    const result: React.ReactNode[] = [];\n    React.Children.forEach(children, (node) => {\n      result.push(node);\n    });\n    return result;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const carouselWidth = useMemo(\n    () => itemWidth * carouselChildrenNodes.length,\n    []\n  );\n\n  const flush = useForceUpdate();\n  // 状态\n  const state = useRef<IState>({\n    childrenNodes: carouselChildrenNodes,\n    currentIndex: 0,\n    timer: -1,\n  }).current;\n\n  const SetCurrentIndex = useCallback(\n    (i: number) => {\n      onChange(i);\n      if (isCurrentItemIndexNumber) {\n        return;\n      }\n      state.currentIndex =\n        i >= state.childrenNodes.length ? state.childrenNodes.length - 1 : i;\n      flush();\n    },\n    [flush, isCurrentItemIndexNumber, onChange, state]\n  );\n\n  const next = useCallback(() => {\n    const { childrenNodes, currentIndex } = state;\n    const nextIndex = currentIndex + 1;\n    SetCurrentIndex(nextIndex < childrenNodes.length ? nextIndex : 0);\n  }, [SetCurrentIndex, state]);\n\n  const reSetCarouselInterval = useCallback(() => {\n    if (!autoPlay) {\n      return;\n    }\n    clearInterval(state.timer);\n    state.timer = window.setInterval(() => {\n      if (isHover) {\n        return;\n      }\n      next();\n    }, autoPlayTime);\n  }, [next, state, autoPlayTime, autoPlay, isHover]);\n\n  useEffect(() => {\n    reSetCarouselInterval();\n  }, [isHover]);\n\n  useEffect(() => {\n    if (isCurrentItemIndexNumber && state.currentIndex !== currentItemIndex) {\n      reSetCarouselInterval();\n      state.currentIndex = currentItemIndex!;\n      flush();\n    }\n  }, [\n    currentItemIndex,\n    flush,\n    isCurrentItemIndexNumber,\n    reSetCarouselInterval,\n    state,\n  ]);\n\n  const goTo = useCallback(\n    (index: number) => {\n      const { childrenNodes, currentIndex } = state;\n\n      if (index < 0 || index >= childrenNodes.length) {\n        return;\n      }\n      if (currentIndex === index) {\n        return;\n      }\n      reSetCarouselInterval();\n      SetCurrentIndex(index);\n    },\n    [state, SetCurrentIndex, reSetCarouselInterval]\n  );\n\n  useEffect(() => {\n    if (autoPlay) {\n      reSetCarouselInterval();\n      return () => clearInterval(state.timer);\n    }\n    clearInterval(state.timer);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [autoPlay]);\n\n  const handleMouseEnter = useCallback(() => {\n    setIsHover(true);\n  }, []);\n  const handleMouseLeave = useCallback(() => {\n    setIsHover(false);\n  }, []);\n\n  return (\n    <CarouselWrapper\n      style={{ width: itemWidth }}\n      onMouseEnter={handleMouseEnter}\n      onMouseLeave={handleMouseLeave}\n    >\n      <ul\n        className=\"guide_carousel_list\"\n        style={{\n          width: carouselWidth + 20,\n          transition: `${playSpeed}s`,\n          transform: `translate3d(-${\n            itemWidth * state.currentIndex\n          }px, 0px, 0px)`,\n        }}\n      >\n        {state.childrenNodes.map((node, i) => (\n          <li key={i}>{node}</li>\n        ))}\n      </ul>\n      {showCarouselDots && (\n        <ul className=\"guide_carousel_dots\">\n          {state.childrenNodes.map((_item, i) => (\n            <li\n              key={i}\n              className={i === state.currentIndex ? 'carousel_dots_active' : ''}\n            >\n              <button onClick={() => goTo(i)} />\n            </li>\n          ))}\n        </ul>\n      )}\n    </CarouselWrapper>\n  );\n};\n"],"mappings":"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"}