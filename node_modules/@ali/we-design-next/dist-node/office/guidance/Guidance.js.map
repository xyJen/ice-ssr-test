{"version":3,"file":"Guidance.js","names":["MODAL_FIXED_PLACEMENT","right","bottom","MODAL_FIXED_STYLE","padding","minWidth","zIndex","background","COLORS","WHITE","borderRadius","GuideModalFixed","props","guides","onAction","onCurrentChange","noop","onClose","currentIndex","setCurrentIndex","useState","clamp","v","min","max","onChange","i","key","next","length","prev","currentGuide","t","useTranslate","flexGrow","title","map","description","image","width","display","flexDirection","marginTop","alignItems","color","LIGHT","LEVEL4_BASE_COLOR","cursor","undefined","normalizePlacement","p","dir","offset","isPromise","then","MODAL_FOLLOWING_PLACEMENT","left","top","MODAL_FOLLOWING_STYLE","transform","GuideModalFollowing","isPerformNext","setIsPerformNext","anchor","placement","anchorTarget","anchorTargetIsPromise","anchorRes","anchorEle","anchoreOffset","Array","isArray","mRef","current","update","observeRef","useRef","useEffect","disconnect","ele","target","requestAnimationFrame","doUpdate","align","height","getBoundingClientRect","MapAnchor","place","ResizeObserver","observe","document","body","fn","handleClose","remove","guide","open","opt","container","ensureContainer","globalLang","lang","c","type","rest","ReactDOM","render","close","unmountComponentAtNode","id","divEle","querySelector","createElement","style","position","appendChild","Guidance"],"sources":["../../../../src/office/guidance/Guidance.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect, ReactNode } from 'react';\nimport { noop } from 'lodash-es';\nimport ReactDOM from 'react-dom';\nimport { Button } from '../../basic/button';\nimport { TextSub } from '../../basic/text';\nimport { Modal } from '../../display/modal';\nimport { IconClose, IconArrowLeft, IconArrowRight } from '../../basic/icon';\nimport { IconButton } from '../../basic/icon-button';\nimport { GuidanceTitle, GuidanceFooter } from './style';\nimport { Carousel } from './carousel';\nimport { MapAnchor } from './MapAnchor';\nimport { align } from '../../display/popover/align';\nimport { GuidePanel } from '../../office/guide-panel';\nimport { LocaleContext, useTranslate } from '../../locale';\nimport { COLORS } from '../../common';\nimport { globalLang } from '../../locale';\nimport ResizeObserver from 'resize-observer-polyfill';\n\nconst MODAL_FIXED_PLACEMENT = { right: 12, bottom: 48 };\nconst MODAL_FIXED_STYLE = { padding: 12, minWidth: 0, zIndex: 99998, background: COLORS.WHITE, borderRadius: 8 };\n\ntype IGuideItemFixed = {\n  key: string;\n  title: string;\n  description?: ReactNode;\n  image?: string;\n};\n\ntype IGuideModalFixedProps = {\n  guides?: Array<IGuideItemFixed>;\n  onClose?: () => void;\n  onCurrentChange?: (key: string) => void;\n  onAction?: (key: string) => void;\n};\n\nconst GuideModalFixed: React.FC<IGuideModalFixedProps> = (props) => {\n\n  const {\n    guides = [],\n    onAction,\n    onCurrentChange = noop,\n    onClose,\n  } = props;\n\n  const [currentIndex, setCurrentIndex] = useState(0);\n\n  const clamp = (v: number, min: number, max: number): number =>\n    v < min ? min : v > max ? max : v;\n\n  const onChange = (i: number) => {\n    setCurrentIndex(i);\n    onCurrentChange(guides[i].key);\n  };\n\n  const next = () => {\n    const i = clamp(currentIndex + 1, 0, guides.length - 1);\n    onChange(i);\n  };\n\n  const prev = () => {\n    const i = clamp(currentIndex - 1, 0, guides.length - 1);\n    onChange(i);\n  };\n\n  const currentGuide = guides[currentIndex];\n\n  const t = useTranslate();\n\n  return guides.length !== 0 ? (\n    <Modal\n      defaultPlacement={MODAL_FIXED_PLACEMENT}\n      style={MODAL_FIXED_STYLE}\n      header={null}\n      footer={null}\n      content={\n        <>\n          <GuidanceTitle>\n            <span style={{ flexGrow: 1 }}>{guides[currentIndex].title}</span>\n            <IconButton className='wdn-close-btn' icon={<IconClose />} onClick={onClose} />\n          </GuidanceTitle>\n          <Carousel\n            itemWidth={256}\n            currentItemIndex={currentIndex}\n            onChange={onChange}\n            autoPlay={true}\n            autoPlayTime={8000}\n            showCarouselDots={false}\n          >\n            {guides.map(({ description, image, key }) => (\n              <GuidePanel\n                key={key}\n                style={{ width: 256, padding: 0 }}\n                description={description}\n                image={image}\n              />\n            ))}\n          </Carousel>\n          <div style={{ display: 'flex', flexDirection: 'row', marginTop: 10, alignItems: 'center' }}>\n            {\n              guides.length > 1 ?\n                <>\n                  <IconArrowLeft\n                    onClick={prev}\n                    style={currentIndex === 0 ? { color: COLORS.LIGHT.LEVEL4_BASE_COLOR, cursor: 'disabled' } : undefined}\n                  />\n                  <TextSub style={{ padding: '0 2px' }}>\n                    {currentIndex + 1}/{guides.length}\n                  </TextSub>\n                  <IconArrowRight\n                    onClick={next}\n                    style={currentIndex === guides.length - 1 ? { color: COLORS.LIGHT.LEVEL4_BASE_COLOR, cursor: 'disabled' } : undefined}\n                  />\n                </> :\n                null\n            }\n            <div style={{ flexGrow: 1 }}></div>\n            <Button type='primary' size='small' onClick={() => onAction && onAction(currentGuide.key)}>{t('wdn_guidance_action')}</Button>\n          </div>\n        </>\n      }\n      visible\n    />\n  ) : null;\n};\n\ntype Dir = 'top' | 'bottom' | 'left' | 'right';\n\ntype AnchorTarget = HTMLElement | [HTMLElement, [number, number]];\n\ntype IGuideItemFollowing = {\n  key: string;\n  title: string;\n  description?: ReactNode;\n  image?: string;\n  anchor: () => AnchorTarget | Promise<AnchorTarget>;\n  placement?: Dir | [Dir, number] | [Dir, [number, number]];\n};\n\nconst normalizePlacement = (p: IGuideItemFollowing['placement']): [Dir, [number, number]] => {\n  if (p === undefined) {\n    return ['bottom', [0, 0]];\n  }\n  if (typeof p === 'string') {\n    return [p, [0, 0]];\n  }\n\n  const [dir, offset] = p;\n  if (typeof offset === 'number') {\n    return [dir, [offset, 0]];\n  } else {\n    return [dir, offset];\n  }\n};\n\ntype IGuidanceModalFollowingProps = {\n  guides?: Array<IGuideItemFollowing>;\n  onClose?: () => void;\n  onCurrentChange?: (current: number) => void;\n};\n\nconst isPromise = (p: any): p is Promise<any> => 'then' in p && typeof p.then === 'function';\n\nconst MODAL_FOLLOWING_PLACEMENT = { left: 0, top: 0 };\nconst MODAL_FOLLOWING_STYLE = { transform: 'none', left: -9999, top: -9999, padding: 0, minWidth: 0, zIndex: 99998, background: COLORS.WHITE, borderRadius: 8 };\n\nconst GuideModalFollowing: React.FC<IGuidanceModalFollowingProps> = (props) => {\n\n  const [currentIndex, setCurrentIndex] = useState(0);\n\n  const {\n    guides = [],\n    onCurrentChange = noop,\n    onClose,\n  } = props;\n\n  const clamp = (v: number, min: number, max: number): number =>\n    v < min ? min : v > max ? max : v;\n\n  const [isPerformNext, setIsPerformNext] = useState<boolean>(false);\n\n  const next = async () => {\n\n    const i = clamp(currentIndex + 1, 0, guides.length - 1);\n    const { anchor, placement } = guides[i];\n\n    const [dir, offset] = normalizePlacement(placement);\n\n    const anchorTarget = anchor();\n    const anchorTargetIsPromise = isPromise(anchorTarget);\n    if (anchorTargetIsPromise) {\n      setIsPerformNext(true);\n    }\n    const anchorRes = anchorTargetIsPromise ? await anchorTarget : anchorTarget;\n    const [anchorEle, anchoreOffset] = Array.isArray(anchorRes) ? anchorRes : [anchorRes, [0, 0] as [number, number]];\n\n    if (anchorEle) {\n      setCurrentIndex(i);\n      setIsPerformNext(false);\n      onCurrentChange(i);\n      if (mRef.current) {\n        update(mRef.current, anchorEle, dir, offset, anchoreOffset);\n      }\n    }\n  };\n\n  const observeRef = useRef<ResizeObserver | false>(false);\n  useEffect(() => {\n    return () => {\n      observeRef.current && observeRef.current.disconnect();\n    }\n  }, []);\n\n  const update = (ele: HTMLElement, target: HTMLElement, placement: Dir, offset: [number, number], anchoreOffset: [number, number]) => {\n    requestAnimationFrame(() => {\n\n      const doUpdate = () => {\n        align(ele, target, placement, [5 + offset[0], offset[1]]);\n        const { left, top, width, height } = target.getBoundingClientRect();\n        MapAnchor.place(left + width / 2 + anchoreOffset[0], top + height / 2 + anchoreOffset[1]);\n      }\n\n      observeRef.current && observeRef.current.disconnect();\n      observeRef.current = new ResizeObserver(doUpdate);\n      observeRef.current.observe(document.body);\n\n      doUpdate();\n    });\n  };\n\n  useEffect(() => {\n    if (mRef.current && currentIndex === 0) {\n      const fn = async () => {\n        const { anchor, placement } = guides[0];\n        const [dir, offset] = normalizePlacement(placement);\n        const anchorTarget = anchor();\n        const anchorRes = isPromise(anchorTarget) ? await anchorTarget : anchorTarget;\n        const [anchorEle, anchoreOffset] = Array.isArray(anchorRes) ? anchorRes : [anchorRes, [0, 0] as [number, number]];\n        if (mRef.current) {\n          update(mRef.current, anchorEle, dir, offset, anchoreOffset);\n        }\n      }\n      fn();\n    }\n  }, []);\n\n  const handleClose = () => {\n    MapAnchor.remove();\n    onClose && onClose();\n  };\n\n  const mRef = useRef<HTMLDivElement>(null);\n\n  const guide = guides[currentIndex];\n\n  const t = useTranslate();\n\n  return (guides.length !== 0 && guide) ? (\n    <Modal\n      ref={mRef}\n      defaultPlacement={MODAL_FOLLOWING_PLACEMENT}\n      header={null}\n      style={MODAL_FOLLOWING_STYLE}\n      content={\n        <>\n          <GuidePanel\n            title={guide.title}\n            description={guide.description}\n            image={guide.image}\n            style={{ width: 200 }}\n          />\n          <GuidanceFooter>\n            {\n              currentIndex !== guides.length - 1 ?\n                <TextSub onClick={handleClose}>{`${t('wdn_skip')} (${currentIndex + 1}/${guides.length})`}</TextSub> :\n                null\n            }\n            <div style={{ flexGrow: 1 }}></div>\n            {\n              currentIndex === guides.length - 1 ?\n                <Button type='primary' size='small' onClick={handleClose}>{t('wdn_isee')}</Button> :\n                <Button type='primary' size='small' disabled={isPerformNext} onClick={next}>{t('wdn_next_step')}</Button>\n            }\n          </GuidanceFooter>\n        </>\n      }\n      footer={null}\n      visible\n    />\n  ) : null;\n};\n\n\ntype IGuidanceOptions = ({ type: 'fixed' } & IGuideModalFixedProps) | ({ type: 'following' } & IGuidanceModalFollowingProps);\n\nconst open = (opt: IGuidanceOptions) => {\n  const container = ensureContainer();\n\n  const fn = globalLang.lang ? ((c: React.ReactElement) => <LocaleContext.Provider value={globalLang.lang!} children={c} />) : (c: React.ReactElement) => c;\n\n  if (opt.type === 'fixed') {\n\n    const {\n      type,\n      onClose,\n      ...rest\n    } = opt;\n\n    ReactDOM.render(fn(<GuideModalFixed\n      {...rest}\n      onClose={() => {\n        close();\n        opt.onClose && opt.onClose();\n      }}\n    />), container);\n\n  } else if (opt.type === 'following') {\n\n    const { type, onClose, ...rest } = opt;\n\n    ReactDOM.render(\n      fn(\n        <GuideModalFollowing\n          {...rest}\n          onClose={() => {\n            close();\n            opt.onClose && opt.onClose();\n          }}\n        />\n      ),\n      container,\n    );\n  }\n\n  return { container };\n};\n\nconst close = () => {\n  ReactDOM.unmountComponentAtNode(ensureContainer());\n};\n\nconst ensureContainer = (): HTMLDivElement => {\n\n  const id = 'wdn-guidance-root';\n\n  const divEle = document.querySelector(`div#${id}`);\n\n  if (!divEle) {\n    const ele = document.createElement('div');\n    ele.id = id;\n    ele.style.position = 'absolute';\n    ele.style.width = '100%';\n    ele.style.top = '0px';\n    ele.style.left = '0px';\n    document.body.appendChild(ele);\n  };\n\n  return document.querySelector(`div#${id}`)!;\n};\n\nexport const Guidance = { open, close };\n"],"mappings":"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"}