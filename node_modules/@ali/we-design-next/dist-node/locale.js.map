{"version":3,"file":"locale.js","names":["resources","defaultLocale","LocaleContext","createContext","LocaleProvider","props","useLayoutEffect","globalLang","lang","value","undefined","children","defineLocale","res","translation","useLocale","useContext","useTranslate","locale","contextLocale","l","getT","cacheT","inst","i18next","createInstance","init","fallbackLng","lng","t","bind","useDayjsLocale","DAYJS_LOCALE_MAP","zh_CN","zh_TW","zh_HK","ja","ja_JP","en_US"],"sources":["../../src/locale.tsx"],"sourcesContent":["import React, { createContext, useContext, useLayoutEffect } from 'react';\nimport { LocaleKeys } from './locale-keys';\n\n/* 某些应用会将 i18next 版本锁定为较低版本（未导出 createInstance）TODO：移除此条 ignore 规则 */\n/* eslint-disable import/no-named-as-default-member */\nimport i18next from 'i18next';\n\nconst resources: Record<string, { translation: Record<string, string> }> = {};\n\nconst defaultLocale = 'zh-CN';\n\nexport const LocaleContext = createContext(defaultLocale);\n\nexport const LocaleProvider: React.FC<{ value: string }> = (props) => {\n  useLayoutEffect(() => {\n    globalLang.lang = props.value;\n    return () => globalLang.lang = undefined;\n  }, [props.value]);\n  return <LocaleContext.Provider value={props.value} >{props.children}</LocaleContext.Provider>;\n};\n\nexport function defineLocale(lang: string, res: Record<string, string>): void {\n  resources[lang] = {\n    translation: {\n      ...(resources[lang] ? resources[lang].translation : {}),\n      ...res,\n    },\n  };\n}\n\nexport function useLocale(): string {\n  return useContext(LocaleContext);\n}\n\nexport function useTranslate(locale?: string): (source: LocaleKeys, options?: Record<string, any>) => string {\n  const contextLocale = useContext(LocaleContext);\n  const l = locale || contextLocale || defaultLocale;\n  return getT(l);\n}\n\nconst cacheT: Record<string, any> = {};\n\nfunction getT(locale: string) {\n  if (cacheT[locale]) {\n    return cacheT[locale];\n  }\n\n  const inst = i18next.createInstance();\n  inst.init({\n    fallbackLng: defaultLocale,\n    lng: locale,\n    resources,\n  });\n  cacheT[locale] = inst.t.bind(inst);\n  return cacheT[locale];\n}\n\nexport function useDayjsLocale(locale?: string): any {\n  const contextLocale = useContext(LocaleContext);\n  const l = locale || contextLocale || defaultLocale;\n  const DAYJS_LOCALE_MAP: { [key: string]: string } = {\n    'zh-CN': 'zh-cn',\n    zh_CN: 'zh-cn',\n    'zh-TW': 'zh-tw',\n    zh_TW: 'zh-tw',\n    'zh-HK': 'zh-hk',\n    zh_HK: 'zh-hk',\n    ja: 'ja',\n    ja_JP: 'ja',\n    'ja-JP': 'ja',\n    'en-US': 'en',\n    en_US: 'en',\n  };\n  return DAYJS_LOCALE_MAP[l];\n}\n\nexport const globalLang = { lang: undefined as string | undefined };"],"mappings":";;;;;;;;;;;;AAAA;AAKA;AAA8B;AAAA;AAAA,uBAJF;AAM5B,MAAMA,SAAkE,GAAG,CAAC,CAAC;AAE7E,MAAMC,aAAa,GAAG,OAAO;AAEtB,MAAMC,aAAa,gBAAG,IAAAC,oBAAa,EAACF,aAAa,CAAC;AAAC;AAEnD,MAAMG,cAA2C,GAAIC,KAAK,IAAK;EACpE,IAAAC,sBAAe,EAAC,MAAM;IACpBC,UAAU,CAACC,IAAI,GAAGH,KAAK,CAACI,KAAK;IAC7B,OAAO,MAAMF,UAAU,CAACC,IAAI,GAAGE,SAAS;EAC1C,CAAC,EAAE,CAACL,KAAK,CAACI,KAAK,CAAC,CAAC;EACjB,oBAAO,eAAC,aAAa,CAAC,QAAQ;IAAC,KAAK,EAAEJ,KAAK,CAACI;EAAM,GAAGJ,KAAK,CAACM,QAAQ,CAA0B;AAC/F,CAAC;AAAC;AAEK,SAASC,YAAY,CAACJ,IAAY,EAAEK,GAA2B,EAAQ;EAC5Eb,SAAS,CAACQ,IAAI,CAAC,GAAG;IAChBM,WAAW,EAAE;MACX,IAAId,SAAS,CAACQ,IAAI,CAAC,GAAGR,SAAS,CAACQ,IAAI,CAAC,CAACM,WAAW,GAAG,CAAC,CAAC,CAAC;MACvD,GAAGD;IACL;EACF,CAAC;AACH;AAEO,SAASE,SAAS,GAAW;EAClC,OAAO,IAAAC,iBAAU,EAACd,aAAa,CAAC;AAClC;AAEO,SAASe,YAAY,CAACC,MAAe,EAAiE;EAC3G,MAAMC,aAAa,GAAG,IAAAH,iBAAU,EAACd,aAAa,CAAC;EAC/C,MAAMkB,CAAC,GAAGF,MAAM,IAAIC,aAAa,IAAIlB,aAAa;EAClD,OAAOoB,IAAI,CAACD,CAAC,CAAC;AAChB;AAEA,MAAME,MAA2B,GAAG,CAAC,CAAC;AAEtC,SAASD,IAAI,CAACH,MAAc,EAAE;EAC5B,IAAII,MAAM,CAACJ,MAAM,CAAC,EAAE;IAClB,OAAOI,MAAM,CAACJ,MAAM,CAAC;EACvB;EAEA,MAAMK,IAAI,GAAGC,gBAAO,CAACC,cAAc,EAAE;EACrCF,IAAI,CAACG,IAAI,CAAC;IACRC,WAAW,EAAE1B,aAAa;IAC1B2B,GAAG,EAAEV,MAAM;IACXlB;EACF,CAAC,CAAC;EACFsB,MAAM,CAACJ,MAAM,CAAC,GAAGK,IAAI,CAACM,CAAC,CAACC,IAAI,CAACP,IAAI,CAAC;EAClC,OAAOD,MAAM,CAACJ,MAAM,CAAC;AACvB;AAEO,SAASa,cAAc,CAACb,MAAe,EAAO;EACnD,MAAMC,aAAa,GAAG,IAAAH,iBAAU,EAACd,aAAa,CAAC;EAC/C,MAAMkB,CAAC,GAAGF,MAAM,IAAIC,aAAa,IAAIlB,aAAa;EAClD,MAAM+B,gBAA2C,GAAG;IAClD,OAAO,EAAE,OAAO;IAChBC,KAAK,EAAE,OAAO;IACd,OAAO,EAAE,OAAO;IAChBC,KAAK,EAAE,OAAO;IACd,OAAO,EAAE,OAAO;IAChBC,KAAK,EAAE,OAAO;IACdC,EAAE,EAAE,IAAI;IACRC,KAAK,EAAE,IAAI;IACX,OAAO,EAAE,IAAI;IACb,OAAO,EAAE,IAAI;IACbC,KAAK,EAAE;EACT,CAAC;EACD,OAAON,gBAAgB,CAACZ,CAAC,CAAC;AAC5B;AAEO,MAAMb,UAAU,GAAG;EAAEC,IAAI,EAAEE;AAAgC,CAAC;AAAC"}