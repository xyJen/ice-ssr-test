{"version":3,"file":"Tab.js","names":["TAB_ID_PREFIX","Tab","React","forwardRef","props","ref","switchable","renamable","onContextMenu","onRename","tab","title","active","editing","setActiveTab","onEditingTab","onQuitEditingTab","prefix","suffix","className","restProps","inputRef","useRef","inputValue","setInputValue","useState","editHandlers","useContext","SheetTabsProvider","handleStartEdit","useCallback","setTimeout","current","focus","select","handleQuitEdit","newTitle","trim","undefined","handleKeyDown","e","which","KEY_CODES","ENTER","ESCAPE","blur","handleContextMenu","preventDefault","stopPropagation","useLayoutEffect","editHandlersCurrent","inputStyle","useMemo","height","BOTTOM_BAR_HEIGHT","position","left","right","border","paddingLeft","borderRadius","transition","transform","backgroundColor","nodeRef","mergeRef","useClickOuterRef","mergeClassName","target","value"],"sources":["../../../../src/navigator/sheet-tabs/Tab.tsx"],"sourcesContent":["import React, { useRef, useState, useCallback, useMemo, useContext, useLayoutEffect } from \"react\";\nimport { mergeClassName, KEY_CODES, IRestProps, mergeRef } from \"../../common\";\nimport { Input } from \"../../form/input\";\nimport { TabWrapper, TabText, BOTTOM_BAR_HEIGHT } from \"./styled\";\nimport { SheetTabsProvider } from \"./SheetTabs\";\nimport type { ISheetTabsProps, TabInfo } from \"./SheetTabs\";\nimport { useClickOuterRef } from './useClickOuterRef';\n\ntype ITabProps = Pick<\n  ISheetTabsProps,\n  \"switchable\" | \"renamable\" | \"onContextMenu\" | \"onRename\"\n> &\n  Omit<TabInfo, 'key' | 'hidden'> & {\n    tab?: string;\n    active?: boolean;\n    editing?: boolean;\n    setActiveTab?: (key: string) => void;\n    onEditingTab?: (key: string) => void;\n    onQuitEditingTab?: (key: string) => void;\n    prefix?: React.ReactNode;\n    suffix?: React.ReactNode;\n  } & Omit<IRestProps, 'id'>;\n\nexport const TAB_ID_PREFIX = 'sheet-tab-';\n\nexport const Tab = React.forwardRef<HTMLDivElement, ITabProps>((props, ref) => {\n  const {\n    switchable,\n    renamable,\n    onContextMenu,\n    onRename,\n    tab = '',\n    title,\n    active,\n    editing,\n    setActiveTab,\n    onEditingTab,\n    onQuitEditingTab,\n    prefix,\n    suffix,\n    className,\n    ...restProps // 拖拽透传的props\n  } = props;\n  const inputRef = useRef<HTMLInputElement>(null);\n  const [inputValue, setInputValue] = useState<string | undefined>();\n  const { editHandlers } = useContext(SheetTabsProvider);\n\n  const handleStartEdit = useCallback(() => {\n    onEditingTab?.(tab);\n    setTimeout(() => {\n      if (inputRef.current) {\n        inputRef.current?.focus();\n        inputRef.current?.select();\n      }\n    }, 0);\n  }, [tab, onEditingTab]);\n\n  const handleQuitEdit = useCallback(() => {\n      const newTitle = inputValue && inputValue.trim();\n      typeof newTitle !== 'undefined' && newTitle !== title && onRename?.(tab, newTitle);\n      setInputValue(undefined);\n      onQuitEditingTab?.(tab);\n    },\n    [inputValue, onRename, tab, title, onQuitEditingTab]\n  );\n\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\n    if (\n      inputRef.current &&\n      (e.which === KEY_CODES.ENTER || e.which === KEY_CODES.ESCAPE)\n    ) {\n      inputRef.current.blur();\n    }\n  }, []);\n\n  const handleContextMenu = useCallback((e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    onContextMenu?.(tab, e);\n  }, [onContextMenu]);\n\n  useLayoutEffect(() => {\n    const editHandlersCurrent = editHandlers.current;\n    editHandlersCurrent[tab] = handleStartEdit;\n    return () => {\n      delete editHandlersCurrent[tab];\n    };\n  }, [handleStartEdit, tab]);\n\n  const inputStyle: React.CSSProperties = useMemo(() => {\n    return {\n      height: BOTTOM_BAR_HEIGHT,\n      position: 'absolute',\n      left: 0,\n      right: 0,\n      border: 0,\n      paddingLeft: 8,\n      borderRadius: 'unset',\n      transition: 'none',\n      transform: editing ? undefined : 'translate(-100%, -100%)',\n      backgroundColor: 'white',\n    };\n  }, [editing]);\n\n  // 整合了 draggable 的 ref、点击输入框外的区域的处理\n  const nodeRef = mergeRef(useClickOuterRef<HTMLDivElement>(handleQuitEdit, editing), ref);\n\n  return (\n    <TabWrapper\n      ref={nodeRef}\n      id={`${TAB_ID_PREFIX}${tab}`}\n      className={mergeClassName(\n        !switchable && !active ? \"disabled\" : undefined,\n        active ? \"active\" : undefined,\n        className\n      )}\n      onMouseDown={(e) => {\n        if (active) return;\n        switchable && setActiveTab?.(tab);\n      }}\n      onDoubleClick={() => renamable && handleStartEdit()}\n      onContextMenu={handleContextMenu}\n      {...restProps}\n    >\n      <Input\n        ref={inputRef}\n        bordered={false}\n        style={inputStyle}\n        value={typeof inputValue === 'undefined' ? title : inputValue}\n        onChange={(e) => setInputValue(e.target.value)}\n        onBlur={() => handleQuitEdit()}\n        onKeyDown={(e) => handleKeyDown(e)}\n      />\n      {editing ? null : prefix}\n      <TabText>{title}</TabText>\n      {editing ? null : suffix}\n    </TabWrapper>\n  );\n});\n"],"mappings":"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"}