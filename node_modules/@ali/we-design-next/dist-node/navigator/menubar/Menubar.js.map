{"version":3,"file":"Menubar.js","names":["Menubar","React","memo","props","path","_path","onPathChange","menus","onSelect","setPath","useDefaultProp","ref","useRef","focusTargetId","focusTarget","focusOwner","useFocusTarget","onKeydown","e","idx","findIndex","m","key","keyCode","KEY_CODES","RIGHT","length","undefined","LEFT","DOWN","menu","find","its","flattenNested","items","filter","isNormalized","isEnabled","k","ESC","stopPropagation","map","it","splice","p","v","title"],"sources":["../../../../src/navigator/menubar/Menubar.tsx"],"sourcesContent":["import React, { useRef } from 'react';\nimport { MenubarWrap, MenubarItemWrap } from './styled';\nimport { useFocusTarget, KEY_CODES, useDefaultProp } from '../../common';\nimport { Menu } from '../../display/menu';\nimport { flattenNested, isNormalized, isEnabled } from '../../basic/list/nested';\nimport { Popover } from '../../display/popover';\n\n\ntype IMenuBarProps = {\n\n  path?: Array<string | undefined>;\n\n  onPathChange?: (path: Array<string | undefined>) => void;\n\n  onSelect?: (path: Array<string | undefined>) => void;\n\n  menus?: Array<{\n    key: string,\n    title: string,\n    items: React.ComponentProps<typeof Menu>['items']\n  }>;\n\n};\n\n\nexport const Menubar = React.memo(\n  (props: IMenuBarProps) => {\n\n    const {\n      path: _path,\n      onPathChange,\n      menus = [],\n      onSelect,\n    } = props;\n\n    const [path, setPath] = useDefaultProp([], _path, onPathChange);\n\n    const ref = useRef<HTMLDivElement>(null);\n    const [focusTargetId, focusTarget, focusOwner] = useFocusTarget(ref);\n\n    const onKeydown = (e: React.KeyboardEvent) => {\n      const idx = menus.findIndex(m => m.key === path[0]);\n      if (idx !== -1) {\n        if (e.keyCode === KEY_CODES.RIGHT && idx < menus.length - 1) {\n          focusTarget(\n            () => setPath([menus[idx + 1].key, undefined])\n          )\n        } else if (e.keyCode === KEY_CODES.LEFT && idx > 0) {\n          focusTarget(\n            () => setPath([menus[idx - 1].key, undefined])\n          )\n        } else if (e.keyCode === KEY_CODES.DOWN && !path[1]) {\n          const menu = menus.find(m => m.key === path[0]);\n          if (menu) {\n            const its = flattenNested(menu.items || []).filter(isNormalized).filter(isEnabled);\n            const k = its[0].key;\n            focusTarget(\n              () => setPath([path[0], k])\n            );\n          }\n        } else if (e.keyCode === KEY_CODES.ESC) {\n          focusOwner(\n            () => {\n              setPath([]);\n              e.stopPropagation();\n            }\n          );\n        }\n      }\n    };\n\n    return <MenubarWrap ref={ref} tabIndex={-1} onKeyDown={onKeydown}>\n      {\n        menus.map(it =>\n          <Popover\n            placement=\"bottomLeft\"\n            animation\n            content={\n              <Menu\n                id={focusTargetId}\n                items={it.items}\n                path={[...path].splice(1)}\n                onPathChange={(p) => setPath([it.key, ...p])}\n                onSelect={(p) => onSelect && onSelect([it.key, ...p])}\n              />\n            }\n            visible={path[0] === it.key && path.length > 1}\n            trigger=\"click\"\n            onVisibleChange={v => {\n              if (v) {\n                focusTarget(\n                  () => setPath([it.key, undefined])\n                );\n              } else {\n                if (it.key === path[0]) {\n                  setPath([path[0]]);\n                }\n              }\n            }}>\n            <MenubarItemWrap\n              active={path[0] === it.key}\n              onMouseEnter={\n                () => {\n                  if (!!path[0] && path[0] !== it.key) {\n                    focusTarget(\n                      () => setPath([it.key, undefined])\n                    );\n                  }\n                }\n              }\n            >\n              {it.title}\n            </MenubarItemWrap>\n          </Popover>\n        )\n      }\n    </MenubarWrap >;\n  }\n);\n\n"],"mappings":"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"}