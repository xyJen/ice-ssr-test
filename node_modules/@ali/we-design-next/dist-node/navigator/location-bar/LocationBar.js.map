{"version":3,"file":"LocationBar.js","names":["isSlotEle","child","React","isValidElement","type","Slot","isSlotFixedEle","props","mode","isSlotDiscreteEle","isSlotDynamicEle","isSlotNonDynamicEle","extractAlignedSlots","children","p","align","widths","extractSlot","priority","key","width","i","length","map","filter","Boolean","extractStaticMeasureEles","res","push","staticMeasure","LocationBar","memo","_children","leftLevel","setLeftLevel","useState","Priority","min","rightLevel","setRightLevel","leftDynamicWidth","setLeftDynamicWidth","undefined","rightDynamicWidth","setRightDynamicWidth","widthsRef","useRef","leftEles","current","rightEles","leftDynamicEle","find","rightDynamicEle","ref","leftDynamicMeasureRef","rightDynamicMeasureRef","onResize","useEventCallback","getBoundingClientRect","leftWidth","Math","floor","rightWidth","compute","maxWidth","dynamicEle","dynamicMeasureRef","getStaticWidth","dw","hasDynamic","isControlled","expandedWidth","max","staticWidth","SPACE_BWETEEN","next","lp","ldw","sum","_","n","rp","rdw","throttledOnResize","useMemo","throttle","useEffect","obs","ResizeObserver","observe","disconnect","staticMesaureEles","staticMeasureIdPrefix","Date","now","random","toString","isRenderingStaticEles","setIsRenderingStaticEles","k","div","document","getElementById","toMeasureSlots","sort","join","e","ele","isLeft","position","top","fn","left"],"sources":["../../../../src/navigator/location-bar/LocationBar.tsx"],"sourcesContent":["import React, { useEffect, useState, useRef, ReactElement, useMemo, isValidElement } from 'react';\nimport { LocationBarSlot as Slot } from './LocationBarSlot';\nimport { IPriority, Priority } from './LocationBarSlot';\nimport { LocationBarWrap, LocationBarItemWrap, LocationBarGrower, SPACE_BWETEEN } from './styled';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport { sum, throttle } from 'lodash-es';\nimport { useEventCallback } from '../../common';\n\ntype ILocationBarProps = {\n  children: React.ReactNode[];\n};\n\ntype SlotEle = ReactElement<React.ComponentProps<typeof Slot>> & { key: string };\ntype SlotFixedEle = SlotEle & { props: { mode: 'fixed' } };\ntype SlotDiscreteEle = SlotEle & { props: { mode: 'discrete' } };\ntype SlotDynamicEle = SlotEle & { props: { mode: 'dynamic' } };\n\nconst isSlotEle = (child: React.ReactNode): child is SlotEle => React.isValidElement(child) && child.type === Slot;\nconst isSlotFixedEle = (child: SlotEle): child is SlotFixedEle => child.props.mode === 'fixed';\nconst isSlotDiscreteEle = (child: SlotEle): child is SlotDiscreteEle => child.props.mode === 'discrete';\nconst isSlotDynamicEle = (child: SlotEle): child is SlotDynamicEle => child.props.mode === 'dynamic';\nconst isSlotNonDynamicEle = (child: SlotEle): child is SlotFixedEle | SlotDiscreteEle => isSlotFixedEle(child) || isSlotDiscreteEle(child);\n\nconst extractAlignedSlots = (children: React.ReactNode[], p: IPriority, align: 'left' | 'right', mode: 'static' | 'dynamic' | 'both', widths: Record<string, number>): Array<[string, number, React.ReactElement] | 'left-dynamic' | 'right-dynamic'> => {\n\n  const extractSlot = (child: SlotFixedEle | SlotDiscreteEle, p: IPriority): [string, number, React.ReactElement] | null => {\n    if (isSlotFixedEle(child)) {\n      if (child.props.priority >= p) {\n        const key = child.key;\n        const width = typeof child.props.width === 'number' ? child.props.width : widths[key];\n        if (typeof width === 'number') {\n          return [key, width, child.props.children];\n        } else {\n          return null;\n        }\n      }\n      return null;\n    }\n    if (isSlotDiscreteEle(child)) {\n      const priority = child.props.priority;\n      for (let i = 0; i < priority.length; i++) {\n        if (priority[i] >= p) {\n          const key = child.key;\n          const width = typeof child.props.width[i] === 'number' ? child.props.width[i] : widths[key + '_' + priority[i]];\n          if (typeof width === 'number') {\n            return [key, width, child.props.children[i]];\n          } else {\n            return null;\n          }\n        }\n      }\n      return null;\n    }\n    return null;\n  };\n\n  return children.map(\n    (child, i) => {\n      if (isSlotEle(child) && child.props.align === align) {\n        if (isSlotNonDynamicEle(child)) {\n          return mode === 'dynamic' ? null : extractSlot(child, p);\n        } else if (isSlotDynamicEle(child)) {\n          return mode === 'static' ? null : child.props.align + '-dynamic';\n        }\n      }\n      return null;\n    }\n  ).filter(Boolean) as any;\n};\n\nconst extractStaticMeasureEles = (children: React.ReactNode[],): Array<[string, () => React.ReactNode]> => {\n\n  const res: Array<[string, () => React.ReactNode]> = [];\n\n  for (const child of children) {\n    if (isSlotEle(child) && isSlotNonDynamicEle(child)) {\n      if (isSlotFixedEle(child)) {\n        if (typeof child.props.width !== 'number') {\n          res.push([child.key, child.props.width.staticMeasure]);\n        }\n      } else if (isSlotDiscreteEle(child)) {\n        for (let i = 0; i < child.props.priority.length; i++) {\n          const p = child.props.priority[i];\n          const width = child.props.width[i];\n          if (typeof width !== 'number') {\n            res.push([child.key + '_' + p, width.staticMeasure]);\n          }\n        }\n      }\n    }\n  }\n\n  return res;\n};\n\nexport const LocationBar = React.memo(\n  (props: ILocationBarProps) => {\n\n    const {\n      children: _children\n    } = props;\n\n    const children = _children.filter(child => isValidElement(child) && child.type === Slot && typeof (child as any).key === 'string');\n\n    const [leftLevel, setLeftLevel] = useState<IPriority>(Priority.min());\n    const [rightLevel, setRightLevel] = useState<IPriority>(Priority.min());\n    const [leftDynamicWidth, setLeftDynamicWidth] = useState<number | undefined>(undefined);\n    const [rightDynamicWidth, setRightDynamicWidth] = useState<number | undefined>(undefined);\n\n    const widthsRef = useRef<Record<string, number>>({});\n\n    const leftEles = extractAlignedSlots(children, leftLevel, 'left', 'both', widthsRef.current);\n    const rightEles = extractAlignedSlots(children, rightLevel, 'right', 'both', widthsRef.current);\n\n    const leftDynamicEle = children.find(child => isSlotEle(child) && child.props.align === 'left' && isSlotDynamicEle(child)) as (SlotDynamicEle | undefined);\n    const rightDynamicEle = children.find(child => isSlotEle(child) && child.props.align === 'right' && isSlotDynamicEle(child)) as (SlotDynamicEle | undefined);\n\n    const ref = useRef<HTMLDivElement>(null);\n    const leftDynamicMeasureRef = useRef<HTMLDivElement>(null);\n    const rightDynamicMeasureRef = useRef<HTMLDivElement>(null);\n\n    // Handle Resize\n    const onResize = useEventCallback(() => {\n\n      if (ref.current) {\n\n        const width = ref.current.getBoundingClientRect().width;\n\n        const leftWidth = Math.floor(width * 0.5);\n        const rightWidth = Math.floor(width * 0.4);\n\n        const compute = (\n          maxWidth: number,\n          dynamicEle: SlotDynamicEle | undefined,\n          dynamicMeasureRef: React.RefObject<HTMLDivElement>,\n          getStaticWidth: (p: IPriority) => number,\n        ): [IPriority, number | undefined] => {\n\n          let p = Priority.min();\n          let dw: number | undefined = undefined;\n\n          const hasDynamic = dynamicEle && dynamicMeasureRef.current;\n          const isControlled = hasDynamic && dynamicEle.props.width === 'controlled';\n          const expandedWidth = hasDynamic ? dynamicMeasureRef.current.getBoundingClientRect().width : 0;\n\n          while (p !== Priority.max()) {\n            const staticWidth = getStaticWidth(p);\n\n            // 如果 maxWidth 大于 staticWidth\n            // 如果有动态组件\n            //    如果 isAutoWidth\n            //      动态组件优先级高：尝试全部撑开，失败则升高优先级，continue\n            //      动态组件优先级低：计算动态组件宽度，break\n            //    如果非 isAutoWidth\n            //      尝试全部撑开，失败则升高优先级，continue\n            // 如果没有动态组件，break(undefined)\n\n            if (maxWidth > staticWidth) {\n              if (hasDynamic) {\n                if (isControlled) {\n                  if (dynamicEle.props.priority >= p) {\n                    if (maxWidth > staticWidth + expandedWidth + SPACE_BWETEEN) {\n                      // 全部撑开成功\n                      dw = undefined;\n                      break;\n                    } else {\n                      // 全部撑开失败\n                      // dont break\n                    }\n                  } else {\n                    // 计算动态组件宽度\n                    dw = maxWidth - staticWidth - SPACE_BWETEEN;\n                    break;\n                  }\n                } else {\n                  if (maxWidth > staticWidth + expandedWidth + SPACE_BWETEEN) {\n                    // 全部撑开成功\n                    dw = expandedWidth;\n                    break;\n                  } else {\n                    // 全部撑开失败\n                    // dont break\n                  }\n                }\n              } else {\n                dw = undefined;\n                break;\n              }\n            }\n            p = Priority.next(p);\n          }\n          return [p, dw];\n        }\n\n        const [lp, ldw] = compute(\n          leftWidth,\n          leftDynamicEle,\n          leftDynamicMeasureRef,\n          p => sum(extractAlignedSlots(children, p, 'left', 'static', widthsRef.current).map(([_, n]) => n))\n        );\n        const [rp, rdw] = compute(\n          rightWidth,\n          rightDynamicEle,\n          rightDynamicMeasureRef,\n          p => sum(extractAlignedSlots(children, p, 'right', 'static', widthsRef.current).map(([_, n]) => n))\n        );\n\n        if (lp !== leftLevel) {\n          setLeftLevel(lp);\n        }\n        if (rp !== rightLevel) {\n          setRightLevel(rp);\n        }\n        if (ldw !== leftDynamicWidth) {\n          setLeftDynamicWidth(ldw);\n        }\n        if (rdw !== rightDynamicWidth) {\n          setRightDynamicWidth(rdw);\n        }\n      }\n    });\n    const throttledOnResize = useMemo(() => throttle(onResize, 500), [onResize]);\n    useEffect(() => {\n      if (ref.current) {\n        const obs = new ResizeObserver(throttledOnResize);\n        obs.observe(ref.current);\n        if (leftDynamicMeasureRef.current) {\n          obs.observe(leftDynamicMeasureRef.current);\n        }\n        if (rightDynamicMeasureRef.current) {\n          obs.observe(rightDynamicMeasureRef.current);\n        }\n        return () => {\n          obs.disconnect();\n        };\n      }\n    }, []);\n\n    const staticMesaureEles = extractStaticMeasureEles(children);\n    const staticMeasureIdPrefix = useMemo(() => (Date.now() % (1000 * 3600 * 24) * 10000 + Math.floor(Math.random() * 10000)).toString(32) + '_', []);\n    const [isRenderingStaticEles, setIsRenderingStaticEles] = useState<boolean>(staticMesaureEles.length > 0);\n\n    useEffect(() => {\n      if (isRenderingStaticEles) {\n        for (const [k] of staticMesaureEles) {\n          const div = document.getElementById(staticMeasureIdPrefix + k);\n          if (div) {\n            const { width } = div.getBoundingClientRect();\n            widthsRef.current[k] = width;\n          }\n          setIsRenderingStaticEles(false);\n        }\n      } else {\n        const toMeasureSlots = staticMesaureEles.filter(([k]) => widthsRef.current[k] === undefined);\n        if (toMeasureSlots.length > 0) {\n          setIsRenderingStaticEles(true);\n        }\n      }\n    }, [\n      isRenderingStaticEles,\n      [...staticMesaureEles].sort().map(([k]) => k).join(','),\n    ]);\n\n    return <LocationBarWrap ref={ref}>\n      {\n        [...leftEles, null, ...rightEles].map((e, i) => {\n          if (e === 'left-dynamic') {\n            return (leftDynamicEle && leftDynamicWidth !== -1) ?\n              <LocationBarItemWrap key={leftDynamicEle.key} align='left'>\n                {leftDynamicEle.props.children(leftDynamicWidth)}\n              </LocationBarItemWrap> :\n              null\n          } else if (e === 'right-dynamic') {\n            return (rightDynamicEle && rightDynamicWidth !== -1) ?\n              <LocationBarItemWrap key={rightDynamicEle.key} align='left'>\n                {rightDynamicEle.props.children(rightDynamicWidth)}\n              </LocationBarItemWrap>\n              : null\n          } else if (e === null) {\n            return <LocationBarGrower key=\"__wdn_locationbar_grower\"/>;\n          } else {\n            const [key, width, ele] = e;\n            const isLeft = i <= leftEles.length;\n            return <LocationBarItemWrap key={key} align={isLeft ? 'left' : 'right'} style={{ width }}>{ele}</LocationBarItemWrap>;\n          }\n        })\n      }\n      <div key=\"__wdn_locationbar_left_dynamic_measure\" ref={leftDynamicMeasureRef} style={{ position: 'absolute', top: -9999 }}>\n        {leftDynamicEle ? leftDynamicEle.props.children() : null}\n      </div>\n      <div key=\"__wdn_locationbar_right_dynamic_measure\" ref={rightDynamicMeasureRef} style={{ position: 'absolute', top: -9999 }}>\n        {rightDynamicEle ? rightDynamicEle.props.children() : null}\n      </div>\n      {\n        isRenderingStaticEles ?\n          staticMesaureEles\n            .filter(\n              ([k]) => widthsRef.current[k] === undefined\n            )\n            .map(\n              ([k, fn], p) => <div key={k} style={{ position: 'absolute', left: -9999, top: -9999 }} id={staticMeasureIdPrefix + k}>{fn()}</div>\n            )\n          : null\n      }\n    </LocationBarWrap>;\n  }\n);\n"],"mappings":"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"}