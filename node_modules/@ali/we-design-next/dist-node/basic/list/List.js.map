{"version":3,"file":"List.js","names":["List","memo","forwardRef","props","ref","items","active","_active","onActiveChange","onSelect","noop","keyboard","renderItem","rest","wrapRef","useRef","focusTargetId","focusTarget","focusOwner","useFocusTarget","setActive","useDefaultProp","undefined","onKeyDown","e","kbKey","key","toLowerCase","isArrowUp","keyCode","KEY_CODES","UP","isArrowDown","DOWN","isEnter","ENTER","flattenedItems","flattenNested","flattenedEnabledKeys","filter","isEnabled","map","it","setActiveFromKeyboard","current","targetItem","find","fn","from","currentItem","isCustomized","i","findIndex","j","length","nextKey","stopPropagation","prevKey","sourceItems","useMemo","its","loopNested","push","s","title","hasPrefix","hasSuffix","normalizedItems","isNormalized","prefix","suffix","selected","mergeRef","mergeRestProps","Array","isArray","cloneReactNode","content","id","onMouseEnter","onMouseLeave","p","renderReactNode","disabled","spreadRestProps","displayName","ListItem","children"],"sources":["../../../../src/basic/list/List.tsx"],"sourcesContent":["import React, { memo, forwardRef, useMemo, useRef } from 'react';\nimport { noop } from 'lodash-es';\nimport { MergePropsType, mergeRestProps, spreadRestProps, mergeRef, cloneReactNode, useDefaultProp, useFocusTarget, renderReactNode, IRenderReactNode, KEY_CODES } from '../../common';\nimport { IconSelected } from '../icon';\nimport { ListWrap, ListItemWrap, ListItemPrefix, ListItemSuffix, ListItemContent, ListDivider, ListItemGroupTitle } from './styled';\nimport { IListItem, INestedItems, flattenNested, loopNested, isEnabled, isCustomized, isNormalized } from './nested';\n\ntype IListProps = MergePropsType<{\n  /**\n   * 列表项\n   */\n  items?: INestedItems<IListItem>;\n  /**\n   * 当前激活列表项（悬浮或键盘导航至的项）\n   */\n  active?: string | null;\n  /**\n   * 当前激活菜单项\n   */\n  onActiveChange?: (key: string | null, options: { from: 'mouse' | 'keyboard' }) => void;\n  /**\n   * 选中菜单项\n   */\n  onSelect?: (key: string) => void;\n  /**\n   * 响应键盘事件\n   */\n  keyboard?: boolean;\n  /**\n   * 自定义菜单项渲染\n   */\n  renderItem?: IRenderReactNode<{ key: string }>;\n}, React.HTMLAttributes<HTMLDivElement>>;\n\nexport const List = memo(\n\n  forwardRef(\n    (props: IListProps, ref: React.ForwardedRef<HTMLDivElement>) => {\n\n      const {\n        items = [],\n        active: _active,\n        onActiveChange,\n        onSelect = noop,\n        keyboard = true,\n        renderItem,\n        ...rest\n      } = props;\n\n      const wrapRef = useRef<HTMLDivElement>(null);\n\n      const [focusTargetId, focusTarget, focusOwner] = useFocusTarget(wrapRef);\n\n      const [active, setActive] = useDefaultProp(undefined as string | undefined, _active, onActiveChange);\n\n      const onKeyDown = keyboard ?\n        (e: React.KeyboardEvent) => {\n\n          const kbKey = e.key.toLowerCase();\n          const isArrowUp = kbKey === 'arrowup' || e.keyCode === KEY_CODES.UP;\n          const isArrowDown = kbKey === 'arrowdown' || e.keyCode === KEY_CODES.DOWN;\n          const isEnter = kbKey === 'enter' || e.keyCode === KEY_CODES.ENTER;\n\n          const flattenedItems = flattenNested(items);\n          const flattenedEnabledKeys = flattenedItems.filter(isEnabled).map(it => it.key);\n\n          // 键盘导航到 content 类型的选项，需尝试主动 focus\n          const setActiveFromKeyboard = (key: string, current?: string) => {\n            const targetItem = flattenedItems.find(it => it.key === key);\n\n            if (targetItem) {\n\n              const fn = () => setActive(key, { from: 'keyboard' });\n\n              const currentItem = current ? flattenedItems.find(it => it.key === current) : undefined;\n\n              if (isCustomized(targetItem)) {\n                focusTarget(fn);\n              } else if (currentItem && isCustomized(currentItem)) {\n                focusOwner(fn);\n              } else {\n                fn();\n              }\n            }\n          };\n\n          const i = active ? flattenedEnabledKeys.findIndex(key => key === active) : -1;\n          if (isArrowDown) {\n            const j = i === -1 ? 0 : i + 1;\n            if (j < flattenedEnabledKeys.length) {\n              const nextKey = flattenedEnabledKeys[j];\n              setActiveFromKeyboard(nextKey, active);\n              e.stopPropagation();\n            }\n          } else if (isArrowUp) {\n            const j = i === -1 ? flattenedEnabledKeys.length - 1 : i - 1;\n            if (j >= 0) {\n              const prevKey = flattenedEnabledKeys[j];\n              setActiveFromKeyboard(prevKey, active);\n              e.stopPropagation();\n            }\n          } else if (isEnter) {\n            if (active !== undefined) {\n              onSelect(active);\n              e.stopPropagation();\n            }\n          }\n        } :\n        undefined;\n\n      const sourceItems = useMemo(() => {\n\n        const its: Array<IListItem | Parameters<Parameters<typeof loopNested>[2]>[0]> = [];\n\n        loopNested(\n          items,\n          (it) => its.push(it),\n          (it) => its.push(it),\n          (s) => ({ key: s, title: s })\n        );\n\n        return its;\n      }, [items]);\n\n      // 列表项中，若有任意一项有前缀/后缀，那么其他的项即使没有前后缀，也应空出前后缀的位置\n      const [hasPrefix, hasSuffix] = useMemo(() => {\n        const normalizedItems = flattenNested(items).filter(isNormalized);\n        return [\n          normalizedItems.findIndex(it => !!it.prefix) !== -1,\n          normalizedItems.findIndex(it => !!it.suffix || !!it.selected) !== -1\n        ]\n      }, [items]);\n\n      return <ListWrap\n        ref={mergeRef(ref, wrapRef)}\n        tabIndex={-1}\n        {...mergeRestProps(rest, 'wdn-list', {}, { onKeyDown })}\n      >\n        {\n          sourceItems.map((it) => {\n\n            if (Array.isArray(it) && it[0] === 'divider') {\n\n              return <ListDivider key={it[1]} role='separator' />;\n            } else if (Array.isArray(it) && it[0] === 'group') {\n\n              return <ListItemGroupTitle key={it[2]}>{it[1]}</ListItemGroupTitle>;\n            } else if ('content' in it) {\n\n              return <React.Fragment key={it.key}>\n                {\n                  cloneReactNode(it.content,\n                    {\n                      key: it.key,\n                      id: focusTargetId,\n                      onMouseEnter: () => setActive(it.key, { from: 'mouse' }),\n                      onMouseLeave: () => setActive(undefined, { from: 'mouse' })\n                    }\n                  )\n                }\n              </React.Fragment>\n            } else {\n\n              const prefix: (p: React.ReactNode) => React.ReactNode = hasPrefix ? (p => p || null) : (p => p);\n              const suffix: (p: React.ReactNode) => React.ReactNode = hasSuffix ? (p => p || null) : (p => p);\n\n              return renderReactNode(\n                renderItem,\n                <ListItem\n                  key={it.key}\n                  prefix={prefix(it.prefix)}\n                  suffix={suffix(it.selected ? <IconSelected /> : it.suffix)}\n                  active={it.key === active}\n                  disabled={it.disabled}\n                  onMouseEnter={it.disabled ? undefined : () => setActive(it.key, { from: 'mouse' })}\n                  onMouseLeave={it.disabled ? undefined : () => setActive(undefined, { from: 'mouse' })}\n                  onClick={it.disabled ? undefined : () => onSelect(it.key)}\n                  {...spreadRestProps(rest, it.key)}\n                >\n                  {it.title}\n                </ListItem>,\n                { key: it.key }\n              )\n            }\n          }\n          )\n        }\n      </ListWrap>;\n    }\n  )\n);\n\nList.displayName = 'List';\n\ntype IListItemProps = MergePropsType<{\n  /**\n   * 列表项的内容\n   */\n  children?: React.ReactNode;\n  /**\n   * 是否激活\n   */\n  active?: boolean;\n  /**\n   * 前缀\n   */\n  prefix?: React.ReactNode;\n  /**\n   * 后缀\n   */\n  suffix?: React.ReactNode;\n  /**\n   * 禁用\n   */\n  disabled?: boolean;\n}, React.HTMLAttributes<HTMLDivElement>>;\n\nexport const ListItem = memo(\n\n  forwardRef(\n    (props: IListItemProps, ref: React.ForwardedRef<HTMLDivElement>) => {\n      const {\n        children = '',\n        active = false,\n        prefix,\n        suffix,\n        disabled = false,\n        ...rest\n      } = props;\n\n      return <ListItemWrap ref={ref} isActive={active} disabled={disabled} {...mergeRestProps(rest, 'wdn-listitem')}>\n        {prefix !== undefined ? <ListItemPrefix>{prefix}</ListItemPrefix> : null}\n        <ListItemContent>{children}</ListItemContent>\n        {suffix !== undefined ? <ListItemSuffix>{suffix}</ListItemSuffix> : null}\n      </ListItemWrap>;\n    }\n  )\n);\n\nListItem.displayName = 'ListItem';"],"mappings":"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"}