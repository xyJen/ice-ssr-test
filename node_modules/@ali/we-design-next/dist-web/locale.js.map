{"version":3,"file":"locale.js","names":["React","createContext","useContext","useLayoutEffect","i18next","resources","defaultLocale","LocaleContext","LocaleProvider","props","globalLang","lang","value","undefined","children","defineLocale","res","translation","useLocale","useTranslate","locale","contextLocale","l","getT","cacheT","inst","createInstance","init","fallbackLng","lng","t","bind","useDayjsLocale","DAYJS_LOCALE_MAP","zh_CN","zh_TW","zh_HK","ja","ja_JP","en_US"],"sources":["../../src/locale.tsx"],"sourcesContent":["import React, { createContext, useContext, useLayoutEffect } from 'react';\nimport { LocaleKeys } from './locale-keys';\n\n/* 某些应用会将 i18next 版本锁定为较低版本（未导出 createInstance）TODO：移除此条 ignore 规则 */\n/* eslint-disable import/no-named-as-default-member */\nimport i18next from 'i18next';\n\nconst resources: Record<string, { translation: Record<string, string> }> = {};\n\nconst defaultLocale = 'zh-CN';\n\nexport const LocaleContext = createContext(defaultLocale);\n\nexport const LocaleProvider: React.FC<{ value: string }> = (props) => {\n  useLayoutEffect(() => {\n    globalLang.lang = props.value;\n    return () => globalLang.lang = undefined;\n  }, [props.value]);\n  return <LocaleContext.Provider value={props.value} >{props.children}</LocaleContext.Provider>;\n};\n\nexport function defineLocale(lang: string, res: Record<string, string>): void {\n  resources[lang] = {\n    translation: {\n      ...(resources[lang] ? resources[lang].translation : {}),\n      ...res,\n    },\n  };\n}\n\nexport function useLocale(): string {\n  return useContext(LocaleContext);\n}\n\nexport function useTranslate(locale?: string): (source: LocaleKeys, options?: Record<string, any>) => string {\n  const contextLocale = useContext(LocaleContext);\n  const l = locale || contextLocale || defaultLocale;\n  return getT(l);\n}\n\nconst cacheT: Record<string, any> = {};\n\nfunction getT(locale: string) {\n  if (cacheT[locale]) {\n    return cacheT[locale];\n  }\n\n  const inst = i18next.createInstance();\n  inst.init({\n    fallbackLng: defaultLocale,\n    lng: locale,\n    resources,\n  });\n  cacheT[locale] = inst.t.bind(inst);\n  return cacheT[locale];\n}\n\nexport function useDayjsLocale(locale?: string): any {\n  const contextLocale = useContext(LocaleContext);\n  const l = locale || contextLocale || defaultLocale;\n  const DAYJS_LOCALE_MAP: { [key: string]: string } = {\n    'zh-CN': 'zh-cn',\n    zh_CN: 'zh-cn',\n    'zh-TW': 'zh-tw',\n    zh_TW: 'zh-tw',\n    'zh-HK': 'zh-hk',\n    zh_HK: 'zh-hk',\n    ja: 'ja',\n    ja_JP: 'ja',\n    'ja-JP': 'ja',\n    'en-US': 'en',\n    en_US: 'en',\n  };\n  return DAYJS_LOCALE_MAP[l];\n}\n\nexport const globalLang = { lang: undefined as string | undefined };"],"mappings":";AAAA,OAAOA,KAAK,IAAIC,aAAa,EAAEC,UAAU,EAAEC,eAAe,QAAQ,OAAO;AAAC,qBAC9C;AAE5B;AACA;AACA,OAAOC,OAAO,MAAM,SAAS;AAE7B,IAAMC,SAAkE,GAAG,CAAC,CAAC;AAE7E,IAAMC,aAAa,GAAG,OAAO;AAE7B,OAAO,IAAMC,aAAa,gBAAGN,aAAa,CAACK,aAAa,CAAC;AAEzD,OAAO,IAAME,cAA2C,GAAG,SAA9CA,cAA2C,CAAIC,KAAK,EAAK;EACpEN,eAAe,CAAC,YAAM;IACpBO,UAAU,CAACC,IAAI,GAAGF,KAAK,CAACG,KAAK;IAC7B,OAAO;MAAA,OAAMF,UAAU,CAACC,IAAI,GAAGE,SAAS;IAAA;EAC1C,CAAC,EAAE,CAACJ,KAAK,CAACG,KAAK,CAAC,CAAC;EACjB,oBAAO,eAAC,aAAa,CAAC,QAAQ;IAAC,KAAK,EAAEH,KAAK,CAACG;EAAM,GAAGH,KAAK,CAACK,QAAQ,CAA0B;AAC/F,CAAC;AAED,OAAO,SAASC,YAAY,CAACJ,IAAY,EAAEK,GAA2B,EAAQ;EAC5EX,SAAS,CAACM,IAAI,CAAC,GAAG;IAChBM,WAAW,eACLZ,SAAS,CAACM,IAAI,CAAC,GAAGN,SAAS,CAACM,IAAI,CAAC,CAACM,WAAW,GAAG,CAAC,CAAC,EACnDD,GAAG;EAEV,CAAC;AACH;AAEA,OAAO,SAASE,SAAS,GAAW;EAClC,OAAOhB,UAAU,CAACK,aAAa,CAAC;AAClC;AAEA,OAAO,SAASY,YAAY,CAACC,MAAe,EAAiE;EAC3G,IAAMC,aAAa,GAAGnB,UAAU,CAACK,aAAa,CAAC;EAC/C,IAAMe,CAAC,GAAGF,MAAM,IAAIC,aAAa,IAAIf,aAAa;EAClD,OAAOiB,IAAI,CAACD,CAAC,CAAC;AAChB;AAEA,IAAME,MAA2B,GAAG,CAAC,CAAC;AAEtC,SAASD,IAAI,CAACH,MAAc,EAAE;EAC5B,IAAII,MAAM,CAACJ,MAAM,CAAC,EAAE;IAClB,OAAOI,MAAM,CAACJ,MAAM,CAAC;EACvB;EAEA,IAAMK,IAAI,GAAGrB,OAAO,CAACsB,cAAc,EAAE;EACrCD,IAAI,CAACE,IAAI,CAAC;IACRC,WAAW,EAAEtB,aAAa;IAC1BuB,GAAG,EAAET,MAAM;IACXf,SAAS,EAATA;EACF,CAAC,CAAC;EACFmB,MAAM,CAACJ,MAAM,CAAC,GAAGK,IAAI,CAACK,CAAC,CAACC,IAAI,CAACN,IAAI,CAAC;EAClC,OAAOD,MAAM,CAACJ,MAAM,CAAC;AACvB;AAEA,OAAO,SAASY,cAAc,CAACZ,MAAe,EAAO;EACnD,IAAMC,aAAa,GAAGnB,UAAU,CAACK,aAAa,CAAC;EAC/C,IAAMe,CAAC,GAAGF,MAAM,IAAIC,aAAa,IAAIf,aAAa;EAClD,IAAM2B,gBAA2C,GAAG;IAClD,OAAO,EAAE,OAAO;IAChBC,KAAK,EAAE,OAAO;IACd,OAAO,EAAE,OAAO;IAChBC,KAAK,EAAE,OAAO;IACd,OAAO,EAAE,OAAO;IAChBC,KAAK,EAAE,OAAO;IACdC,EAAE,EAAE,IAAI;IACRC,KAAK,EAAE,IAAI;IACX,OAAO,EAAE,IAAI;IACb,OAAO,EAAE,IAAI;IACbC,KAAK,EAAE;EACT,CAAC;EACD,OAAON,gBAAgB,CAACX,CAAC,CAAC;AAC5B;AAEA,OAAO,IAAMZ,UAAU,GAAG;EAAEC,IAAI,EAAEE;AAAgC,CAAC"}