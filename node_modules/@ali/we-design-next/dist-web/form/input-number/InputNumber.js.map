{"version":3,"file":"InputNumber.js","names":["React","useState","useRef","Input","useDefaultProp","useEventCallback","mergeRestProps","ArrowUpIcon","ArrowDownIcon","NumberControlWrap","isValidNumber","text","isNaN","parseFloat","toValidNumber","isValidNumberFragment","test","normalizeDigits","d","Math","floor","max","setDelayInterval","fn","delay","interval","it","timeout","setTimeout","setInterval","clearTimeout","clearInterval","InputNumber","memo","props","defaultValue","value","onChange","min","Infinity","step","bordered","digits","control","onBlur","onEnter","disabled","rest","v","setV","undefined","t","setT","handleIncrease","handleDecrease","timingRef","handleIncreasingStart","current","handleDecreasingStart","handleIncreasingDecreasingEnd","handleChange","e","target","handleEnter","handleBlur","toFixed","toString","paddingRight","overflow"],"sources":["../../../../src/form/input-number/InputNumber.tsx"],"sourcesContent":["import React, { useState, useRef } from 'react';\nimport { Input } from '../input/Input';\nimport { useDefaultProp, useEventCallback, MergePropsType, mergeRestProps } from '../../common';\nimport { ArrowUpIcon, ArrowDownIcon, NumberControlWrap } from './styled';\n\nexport type IInputNumberProps = MergePropsType<{\n  /**\n   * 默认初始值\n   */\n  defaultValue?: number;\n  /**\n   * 值\n   */\n  value?: number | null;\n  /**\n   * 值变化事件\n   */\n  onChange?: (v: number | null) => void;\n  /**\n  * 回车\n  */\n  onEnter?: React.KeyboardEventHandler<HTMLInputElement>;\n  /**\n   * 最小值\n   */\n  min?: number;\n  /**\n   * 最大值\n   */\n  max?: number;\n  /**\n   * 步长\n   */\n  step?: number;\n  /**\n   * 是否有边框\n   */\n  bordered?: boolean;\n  /**\n   * 小数点后的位数\n   */\n  digits?: number;\n  /**\n   * 默认true；flip则上减下加；false则不显示上下按钮\n   */\n  control?: boolean | 'flip';\n}, React.InputHTMLAttributes<HTMLInputElement>>;\n\nconst isValidNumber = (text: string): boolean => !isNaN(parseFloat(text));\n\nconst toValidNumber = (text: string): number => parseFloat(text);\n\n// 是否是合法的数字，或者是形如 '-' 或 '1.' 这样输入到一半的片段\nconst isValidNumberFragment = (text: string): boolean => text !== '' && /^-?(\\d+(\\.\\d*)?)?$/.test(text);\n\n// 小数位数仅支持大于等于 0 的整数\nconst normalizeDigits = (d: number): number => Math.floor(Math.max(d, 0));\n\nconst setDelayInterval = (fn: () => void, delay: number, interval: number): () => void => {\n\n  let it: number = 0;\n  let timeout: number | null = setTimeout(() => {\n    it = setInterval(fn, interval) as any;\n    timeout = null;\n  }, delay) as any;\n\n  return () => {\n    if (timeout) {\n      clearTimeout(timeout);\n    } else {\n      clearInterval(it);\n    }\n  };\n}\n\nexport const InputNumber = React.memo(\n  (props: IInputNumberProps) => {\n\n    const {\n      defaultValue,\n      value,\n      onChange,\n      min = -Infinity,\n      max = Infinity,\n      step = 1,\n      bordered = true,\n      digits,\n      control = true,\n      onBlur,\n      onEnter,\n\n      disabled,\n      ...rest\n    } = props;\n\n    const [v, setV] = useDefaultProp(defaultValue, value, onChange);\n    const [t, setT] = useState<string | undefined>(undefined);\n\n    const handleIncrease = useEventCallback(\n      () => {\n        if (typeof v === 'number') {\n          setT(undefined);\n          setV(Math.min(v + step, max));\n        }\n      }\n    );\n\n    const handleDecrease = useEventCallback(\n      () => {\n        if (typeof v === 'number') {\n          setT(undefined);\n          setV(Math.max(v - step, min));\n        }\n      }\n    );\n\n    const timingRef = useRef<(() => void) | undefined>(undefined);\n\n    const handleIncreasingStart = useEventCallback(() => {\n      if (timingRef.current === undefined) {\n        timingRef.current = setDelayInterval(handleIncrease, 800, 60);\n      }\n    });\n\n    const handleDecreasingStart = useEventCallback(() => {\n      if (timingRef.current === undefined) {\n        timingRef.current = setDelayInterval(handleDecrease, 800, 60);\n      }\n    });\n\n    const handleIncreasingDecreasingEnd = useEventCallback(() => {\n      if (typeof timingRef.current === 'function') {\n        timingRef.current();\n        timingRef.current = undefined;\n      }\n    });\n\n    const handleChange = useEventCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n      const text = e.target.value;\n      if (text === '') {\n        setT(undefined);\n        setV(undefined);\n      } else if (isValidNumber(text)) {\n        setT(text);\n        setV(Math.max(Math.min(toValidNumber(text), max), min));\n      } else if (isValidNumberFragment(text)) {\n        setT(text);\n      }\n    });\n\n    const handleEnter = useEventCallback((e: React.KeyboardEvent<HTMLInputElement>) => {\n      setT(undefined);\n      onEnter && onEnter(e);\n    });\n\n    const handleBlur = useEventCallback((e: React.FocusEvent<HTMLInputElement>) => {\n      setT(undefined);\n      onBlur && onBlur(e);\n    });\n\n    return <Input\n      value={typeof t === 'string' ? t : typeof v === 'number' ? typeof digits === 'number' ? v.toFixed(normalizeDigits(digits)) : v.toString() : ''}\n      onChange={handleChange}\n      disabled={disabled}\n      bordered={bordered}\n      onEnter={handleEnter}\n      suffix={\n        control ?\n        <NumberControlWrap>\n          <ArrowUpIcon\n            disabled={!!disabled || typeof v !== 'number' || (control === 'flip' ? v <= min : v >= max)}\n            onClick={control === 'flip' ? handleDecrease : handleIncrease}\n            onMouseDown={control === 'flip' ? handleDecreasingStart : handleIncreasingStart}\n            onMouseUp={handleIncreasingDecreasingEnd}\n            onMouseLeave={handleIncreasingDecreasingEnd}\n          />\n          <ArrowDownIcon\n            disabled={!!disabled || typeof v !== 'number' || (control === 'flip' ? v >= max : v <= min)}\n            onClick={control === 'flip' ? handleIncrease : handleDecrease}\n            onMouseDown={control === 'flip' ? handleIncreasingStart : handleDecreasingStart}\n            onMouseUp={handleIncreasingDecreasingEnd}\n            onMouseLeave={handleIncreasingDecreasingEnd}\n          />\n        </NumberControlWrap> : undefined\n      }\n      {...mergeRestProps(rest, 'wdn_input_number', { paddingRight: 0, overflow: 'hidden' })}\n      onBlur={handleBlur}\n    />;\n  }\n);"],"mappings":"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"}