{"version":3,"file":"EditableInput.js","names":["React","Component","PureComponent","reactCSS","DEFAULT_ARROW_OFFSET","UP_KEY_CODE","DOWN_KEY_CODE","ENTER_KEY_CODE","VALID_KEY_CODES","isValidKeyCode","keyCode","indexOf","getNumberValue","value","Number","String","replace","EditableInput","props","handleBlur","e","_blur","setUpdatedValue","state","blurValue","setState","handleChange","target","handleKeyDown","stopPropagation","isNaN","offset","getArrowOffset","updatedValue","blur","handleDrag","dragLabel","newValue","Math","round","movementX","dragMax","onChange","getValueObjectWithLabel","handleMouseDown","preventDefault","window","addEventListener","handleMouseUp","unbindEventListeners","removeEventListener","toUpperCase","componentDidUpdate","prevProps","prevState","input","document","activeElement","componentWillUnmount","label","arrowOffset","onChangeValue","_input","render","styles","wrap","position","style","cursor","placeholder","hideLabel"],"sources":["../../../../../../src/form/color-picker/sketch/common/EditableInput.js"],"sourcesContent":["import React, { Component, PureComponent } from 'react';\nimport reactCSS from 'reactcss';\n\nconst DEFAULT_ARROW_OFFSET = 1;\n\nconst UP_KEY_CODE = 38;\nconst DOWN_KEY_CODE = 40;\nconst ENTER_KEY_CODE = 13\nconst VALID_KEY_CODES = [\n  UP_KEY_CODE,\n  DOWN_KEY_CODE,\n];\nconst isValidKeyCode = keyCode => VALID_KEY_CODES.indexOf(keyCode) > -1;\nconst getNumberValue = value => Number(String(value).replace(/%/g, ''));\n\nexport class EditableInput extends (PureComponent || Component) {\n  constructor(props) {\n    super();\n\n    this.state = {\n      value: String(props.value).toUpperCase(),\n      blurValue: String(props.value).toUpperCase(),\n    };\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (\n      this.props.value !== this.state.value &&\n      (prevProps.value !== this.props.value || prevState.value !== this.state.value)\n    ) {\n      if (this.input === document.activeElement) {\n        this.setState({ blurValue: String(this.props.value).toUpperCase() });\n      } else {\n        this.setState({ value: String(this.props.value).toUpperCase(), blurValue: !this.state.blurValue && String(this.props.value).toUpperCase() });\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    this.unbindEventListeners();\n  }\n\n  getValueObjectWithLabel(value) {\n    return {\n      [this.props.label]: value,\n    };\n  }\n\n  handleBlur = (e) => {\n    // 给 e 加一个 _blur 属性\n    // 用于 onChangeComplete\n    e._blur = true\n\n    this.setUpdatedValue(this.state.value, e)\n\n    if (this.state.blurValue) {\n      this.setState({ value: this.state.blurValue, blurValue: null })\n    }\n  };\n\n  handleChange = (e) => {\n    this.setUpdatedValue(e.target.value, e);\n  };\n\n  getArrowOffset() {\n    return this.props.arrowOffset || DEFAULT_ARROW_OFFSET;\n  }\n\n  handleKeyDown = (e) => {\n    e.stopPropagation();\n    // In case `e.target.value` is a percentage remove the `%` character\n    // and update accordingly with a percentage\n    // https://github.com/casesandberg/react-color/issues/383\n    const value = getNumberValue(e.target.value);\n\n    if (!isNaN(value) && isValidKeyCode(e.keyCode)) {\n      const offset = this.getArrowOffset();\n      const updatedValue = e.keyCode === UP_KEY_CODE ? value + offset : value - offset;\n      this.setUpdatedValue(updatedValue, e);\n    }\n\n    // Enter to blur\n    if (e.keyCode === ENTER_KEY_CODE) {\n      e.target.blur()\n    }\n  };\n\n  setUpdatedValue(value, e) {\n    const onChangeValue = this.props.label ? this.getValueObjectWithLabel(value) : value;\n\n    // 给 e 加一个 _input 属性\n    // 表明这次的 onChange 由输入框触发\n    e._input = true\n    this.props.onChange && this.props.onChange(onChangeValue, e);\n\n    this.setState({ value });\n  }\n\n  handleDrag = (e) => {\n    if (this.props.dragLabel) {\n      const newValue = Math.round(this.props.value + e.movementX);\n      if (newValue >= 0 && newValue <= this.props.dragMax) {\n        this.props.onChange && this.props.onChange(this.getValueObjectWithLabel(newValue), e);\n      }\n    }\n  };\n\n  handleMouseDown = (e) => {\n    if (this.props.dragLabel) {\n      e.preventDefault();\n      this.handleDrag(e);\n      window.addEventListener('mousemove', this.handleDrag);\n      window.addEventListener('mouseup', this.handleMouseUp);\n    }\n  };\n\n  handleMouseUp = () => {\n    this.unbindEventListeners();\n  };\n\n  unbindEventListeners = () => {\n    window.removeEventListener('mousemove', this.handleDrag);\n    window.removeEventListener('mouseup', this.handleMouseUp);\n  };\n\n  render() {\n    const styles = reactCSS({\n      default: {\n        wrap: {\n          position: 'relative',\n        },\n      },\n      'user-override': {\n        wrap: this.props.style && this.props.style.wrap ? this.props.style.wrap : {},\n        input: this.props.style && this.props.style.input ? this.props.style.input : {},\n        label: this.props.style && this.props.style.label ? this.props.style.label : {},\n      },\n      'dragLabel-true': {\n        label: {\n          cursor: 'ew-resize',\n        },\n      },\n    }, {\n      'user-override': true,\n    }, this.props);\n\n    return (\n      <div style={styles.wrap}>\n        <input\n          style={styles.input}\n          ref={input => { this.input = input; }}\n          value={this.state.value}\n          onKeyDown={this.handleKeyDown}\n          onChange={this.handleChange}\n          onBlur={this.handleBlur}\n          placeholder={this.props.placeholder}\n          spellCheck=\"false\"\n        />\n        { this.props.label && !this.props.hideLabel ? (\n          <span style={styles.label} onMouseDown={this.handleMouseDown}>\n            {this.props.label}\n          </span>\n        ) : null}\n      </div>\n    );\n  }\n}\n\nexport default EditableInput;\n"],"mappings":"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"}