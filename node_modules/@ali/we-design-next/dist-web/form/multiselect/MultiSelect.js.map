{"version":3,"file":"MultiSelect.js","names":["React","useMemo","useCallback","useState","useLayoutEffect","useEffect","useRef","ResizeObserver","Popover","useDefaultProp","mergeRestProps","proxyRestProps","KEY_CODES","useFocusTarget","IconSelected","List","flattenNested","Input","Tag","TagMore","Item","MultiSelectInputWrap","SuffixWrap","OverlayWrap","ErrorTip","DisableMask","OverflowWrap","ArrowDown","ArrowUp","ClearIcon","ITEM_WIDTH","MIN_INPUT_WIDTH","LEFT_PADDING","DEFAULT_OPTISON","MultiSelect","memo","forwardRef","props","ref","outValue","value","defaultValue","options","onChange","outVisible","visible","defaultVisible","onVisibleChange","disabled","size","getContainer","placeholder","error","outInputValue","inputValue","onInputValueChange","renderTag","renderTagMore","children","rest","flattenOptions","k","key","title","setValue","setVisible","setInputValue","containerWidth","setContainerWidth","Map","itemWidths","setItemWidths","restWidth","setRestWidth","inputWidth","setInputWidth","displayCount","setDisplayCount","restReady","setRestReady","myRef","mouseInInput","setMouseInInput","active","setActive","outerRef","focusTargetId","focusTarget","focusOwner","mergedDisplayCount","Number","MAX_SAFE_INTEGER","current","calcContainerWidth","entries","entry","width","contentRect","eleResizeObserver","observe","disconnect","registerSize","origin","clone","set","registerTagMoreSize","_","registerInputSize","updateDisplayCount","count","notReady","length","displayOptions","filter","op","includes","map","label","toString","mergedData","slice","Math","min","totalWidth","len","lastIndex","i","currentItemWidth","get","undefined","onOptionClick","curKey","newValue","curKeyIndex","indexOf","splice","push","updateValueByInputValue","result1","find","result","index","handleEsc","handleKeyDown","e","which","DELETE","BACKSPACE","pop","ENTER","nativeEvent","stopImmediatePropagation","DOWN","fn","firstKey","o","ESC","handleInputValueChange","target","onTagClose","stopPropagation","onArrowClick","onMouseEnter","onMouseLeave","handleClear","tagsNode","restNode","item","omittedOptions","displayRest","suffixNode","minWidth","p","cloneElement","suffix","document","body","flexGrow"],"sources":["../../../../src/form/multiselect/MultiSelect.tsx"],"sourcesContent":["import React, { ReactNode, useMemo, useCallback, useState, useLayoutEffect, useEffect, useRef } from 'react';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport { Popover } from '../../display/popover';\nimport { useDefaultProp, IRestProps, mergeRestProps, proxyRestProps, KEY_CODES, useFocusTarget } from '../../common';\nimport { IconSelected, List } from '../../index';\nimport { IListItemNormalized, IListItemCustomized, INestedItems, flattenNested } from '../../basic/list/nested';\nimport { Input } from '../../form/input';\nimport { Tag, TagMore, Item } from './Tag';\nimport { MultiSelectInputWrap, SuffixWrap, OverlayWrap, ErrorTip, DisableMask, OverflowWrap, ArrowDown, ArrowUp, ClearIcon } from './styled';\n\nexport type INormalizedMultiSelectOption = IListItemNormalized;\n\nexport type ICustomizedMultiSelectOption = IListItemCustomized;\n\nexport type IMultiSelectOption = INormalizedMultiSelectOption | ICustomizedMultiSelectOption;\n\nexport type IMultiSelectOptionGroup = {\n  title: string;\n  items: Array<IMultiSelectOption>;\n};\n\nexport type IMultiSelectProps = {\n  /**\n   * 选中值\n   */\n  value?: string[];\n  /**\n   * 默认值\n   */\n  defaultValue?: string[];\n  /**\n   * 选中值变化时的回调\n   */\n  onChange?: (value: string[]) => void;\n  /**\n   * 下拉列表的选项\n   */\n  options?: INestedItems<IMultiSelectOption>;\n  /**\n   * 下拉弹层可见性\n   */\n  visible?: boolean;\n  /**\n   * 下拉弹层默认可见性\n   */\n  defaultVisible?: boolean;\n  /**\n   * 弹层可见性变化时的回调\n   */\n  onVisibleChange?: (visible: boolean) => void;\n  /**\n   * 禁用态\n   */\n  disabled?: boolean;\n  /**\n   * 占位提示\n   */\n  placeholder?: string;\n  /**\n   * 组件尺寸\n   */\n  size?: 'small' | 'normal';\n  /**\n   * 弹层挂载的容器元素\n   */\n  getContainer?: () => HTMLElement;\n  /**\n   * 错误提示\n   */\n  error?: string;\n  /**\n   * 输入框的值\n   */\n  inputValue?: string;\n  /**\n   * 输入框值变化时的回调\n   */\n  onInputValueChange?: (value: string) => void;\n  /**\n   * 标签自定义样式函数\n   */\n  renderTag?: (\n    label: string,\n    value: string,\n    closable?: boolean,\n    onClose?: (e: React.MouseEvent) => void\n  ) => React.ReactNode;\n  /**\n   * 更多标签的自定义样式函数\n   */\n  renderTagMore?: (omittedValues: string[]) => React.ReactNode;\n} & IRestProps;\n\nconst ITEM_WIDTH = 10; // 用来限制渲染的节点，避免性能问题\nconst MIN_INPUT_WIDTH = 40;\nexport const LEFT_PADDING = 4;\n\nconst DEFAULT_OPTISON: [] = [];\n\nexport const MultiSelect = React.memo(React.forwardRef<HTMLInputElement, IMultiSelectProps>((props, ref) => {\n  const {\n    value: outValue,\n    defaultValue = [],\n    options = DEFAULT_OPTISON,\n    onChange,\n    visible: outVisible,\n    defaultVisible = false,\n    onVisibleChange,\n    disabled,\n    size = 'normal',\n    getContainer,\n    placeholder,\n    error,\n    inputValue: outInputValue,\n    onInputValueChange,\n    renderTag,\n    renderTagMore,\n    children,\n    ...rest\n  } = props;\n\n  const flattenOptions = useMemo(() => flattenNested(options, k => ({ key: k, title: k })), [options]);\n\n  const [value, setValue] = useDefaultProp<string[]>(defaultValue, outValue, onChange);\n  const [visible, setVisible] = useDefaultProp<boolean>(defaultVisible, outVisible, onVisibleChange);\n  const [inputValue, setInputValue] = useDefaultProp<string>('', outInputValue, onInputValueChange);\n\n  const [containerWidth, setContainerWidth] = useState<number>(0);\n  const [itemWidths, setItemWidths] = useState(new Map<React.Key, number>());\n  const [restWidth, setRestWidth] = useState<number>(0);\n  const [inputWidth, setInputWidth] = useState<number>(0);\n\n  const [displayCount, setDisplayCount] = useState<number>(0);\n  const [restReady, setRestReady] = useState(false);\n  const myRef = useRef<HTMLDivElement>(null);\n\n  const [mouseInInput, setMouseInInput] = useState<boolean>(false);\n\n  const [active, setActive] = useState<string | null>(null);\n\n  const outerRef = useRef<HTMLInputElement>(null);\n  const [focusTargetId, focusTarget, focusOwner] = useFocusTarget(outerRef);\n\n  const mergedDisplayCount = useMemo(() => {\n    if (displayCount === null) {\n      return Number.MAX_SAFE_INTEGER;\n    }\n    return displayCount || 0;\n  }, [displayCount, containerWidth]);\n\n  useEffect(() => {\n    if (!myRef.current) {\n      return;\n    }\n    const calcContainerWidth = ((entries: ResizeObserverEntry[]) => {\n      const entry = entries[0];\n      if (!entry) {\n        return;\n      }\n      const { width } = entry.contentRect;\n      if (width === 0) {\n        return;\n      }\n      setContainerWidth(width);\n    });\n\n    const eleResizeObserver = new ResizeObserver(calcContainerWidth);\n    eleResizeObserver.observe(myRef.current);\n\n    return () => {\n      eleResizeObserver.disconnect();\n    };\n  }, []);\n\n  const registerSize = (key: React.Key, width: number | null) => {\n    setItemWidths(origin => {\n      const clone = new Map(origin);\n\n      if (width === null) {\n        clone.delete(key);\n      } else {\n        clone.set(key, width);\n      }\n      return clone;\n    });\n  }\n\n  const registerTagMoreSize = (_: React.Key, width: number | null) => {\n    setRestWidth(width!);\n  };\n\n  const registerInputSize = (_: React.Key, width: number | null) => {\n    setInputWidth(width!);\n  }\n\n  const updateDisplayCount = (count: number, notReady?: boolean) => {\n    setDisplayCount(count);\n    if (!notReady) {\n      setRestReady(count < value.length - 1);\n    }\n  }\n  const displayOptions = useMemo(() => {\n    return flattenOptions.filter(op => value.includes(op.key)).map(\n      op => 'title' in op ? { value: op.key, label: op.title?.toString() || '' } : { value: op.key, label: op.key }\n    );\n  }, [options, value]);\n\n  const mergedData = useMemo(() => {\n    return displayOptions.slice(0, Math.min(value.length, containerWidth / ITEM_WIDTH));\n  }, [displayOptions, containerWidth]);\n\n  useLayoutEffect(() => {\n    if (containerWidth && restWidth && mergedData) {\n      let totalWidth = MIN_INPUT_WIDTH + LEFT_PADDING;\n\n      const len = mergedData.length;\n      const lastIndex = len - 1;\n\n      if (!value.length) {\n        updateDisplayCount(0);\n        return;\n      }\n\n      for (let i = 0; i < len; i += 1) {\n        const currentItemWidth = itemWidths.get(mergedData[i].value);\n\n        // 如果数据没ready，break\n        if (currentItemWidth === undefined) {\n          updateDisplayCount(i - 1, true);\n          break;\n        }\n\n        totalWidth += currentItemWidth;\n\n        if (\n          // 只有一个的话，totalWidth就是最后的宽度\n          (lastIndex === 0 && totalWidth <= containerWidth) ||\n          // 最后两个宽度将会是最后宽度\n          (i === lastIndex - 1 && totalWidth + itemWidths.get(mergedData[lastIndex].value)! <= containerWidth)\n        ) {\n          updateDisplayCount(lastIndex);\n          break;\n        } else if (totalWidth + restWidth > containerWidth) {\n          updateDisplayCount(i - 1);\n          break;\n        }\n      }\n    }\n  }, [containerWidth, itemWidths, restWidth, inputWidth, mergedData]);\n\n  const onOptionClick = useCallback((curKey: string) => {\n    const newValue = [...value];\n    const curKeyIndex = newValue.indexOf(curKey);\n    if (curKeyIndex !== -1) {\n      newValue.splice(curKeyIndex, 1);\n    } else {\n      newValue.push(curKey);\n    }\n    setValue(newValue);\n  }, [value, setValue]);\n\n  const updateValueByInputValue = useCallback(() => {\n\n    if (!inputValue) {\n      return;\n    }\n\n    const result1 = flattenOptions.find(op => 'title' in op && !op.disabled && op.title?.toString().includes(inputValue));\n    const result = (result1 && 'title' in result1) ? result1.key : undefined;\n    if (!result) {\n      return;\n    }\n    const newValue = [...value];\n    const index = newValue.indexOf(result);\n    if (index !== -1) {\n      newValue.splice(index, 1);\n    } else {\n      newValue.push(result);\n    }\n    setInputValue('');\n    setValue(newValue);\n  }, [options, inputValue, value, setValue, setInputValue]);\n\n  const handleEsc = useCallback(() => {\n    focusOwner(() => {\n      setActive(null);\n      setVisible(false);\n    });\n  }, [setVisible]);\n\n  const handleKeyDown = useCallback((e: React.KeyboardEvent<HTMLInputElement>) => {\n    switch (e.which) {\n      case KEY_CODES.DELETE:\n      case KEY_CODES.BACKSPACE:\n        if (inputValue === '' && value.length) {\n          const newValue = [...value];\n          newValue.pop();\n          setValue(newValue);\n        }\n        break;\n      case KEY_CODES.ENTER:\n        !visible && setVisible(true);\n        updateValueByInputValue();\n        e.nativeEvent.stopImmediatePropagation();\n        break;\n      case KEY_CODES.DOWN:\n        if (active === null) {\n          const fn = () => {\n            setVisible(true);\n            const firstKey = flattenOptions.filter(o => !('disabled' in o && !!o.disabled))[0].key;\n            if (firstKey) {\n              setActive(firstKey);\n            }\n          };\n          focusTarget(fn);\n        }\n        break;\n      case KEY_CODES.ESC:\n        handleEsc();\n        break;\n      default: break;\n    }\n  }, [updateValueByInputValue, value, inputValue, setValue, active, setVisible, options, handleEsc]);\n\n  const handleInputValueChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setInputValue(e.target.value);\n  }, [setInputValue]);\n\n  const onTagClose = useCallback((e: React.MouseEvent, key: string) => {\n    e.stopPropagation();\n    e.nativeEvent.stopImmediatePropagation();\n    const newValue = [...value];\n    const index = newValue.indexOf(key);\n    if (index !== -1) {\n      newValue.splice(index, 1);\n    }\n    setValue(newValue);\n  }, [value, setValue]);\n\n  const onArrowClick: React.MouseEventHandler<HTMLSpanElement> = useCallback((e: React.MouseEvent) => {\n    // TODO: 点击箭头收起下拉菜单\n    // TODO: (依赖menu) 自定义节点内容时的hover样式、点击自定义节点将所选项、key放到div和input\n    // if (visible) {\n    // ref?.current?.blur();\n    // }\n  }, [visible]);\n\n  const onMouseEnter = useCallback((e: React.MouseEvent) => {\n    !disabled && setMouseInInput(true);\n  }, [disabled]);\n\n  const onMouseLeave = useCallback((e: React.MouseEvent) => {\n    setMouseInInput(false);\n  }, []);\n\n  const handleClear = useCallback((e: React.MouseEvent) => {\n    // TODO: 如果选项有closable为false的，怎么处理\n    e.stopPropagation();\n    e.nativeEvent.stopImmediatePropagation();\n    setValue([]);\n    setInputValue('');\n  }, [setValue, setInputValue]);\n\n  let tagsNode: React.ReactNode;\n  let restNode: React.ReactNode;\n  if (value.length) {\n    tagsNode = mergedData.map((item, index) =>\n      <Item key={item.value} order={index} itemKey={item.value} registerSize={registerSize} display={index <= mergedDisplayCount}>\n        <Tag value={item.value} label={item.label} closable={true} size={size} onClose={(e: React.MouseEvent) => onTagClose(e, item.value)} />\n      </Item>\n    );\n\n    const omittedOptions = displayOptions.slice(mergedDisplayCount + 1);\n    const displayRest = restReady && !!omittedOptions.length;\n    restNode = <Item order={displayRest ? mergedDisplayCount : Number.MAX_SAFE_INTEGER} registerSize={registerTagMoreSize} display={displayRest}>\n      <TagMore omittedTags={omittedOptions} size={size} />\n    </Item>;\n  }\n\n  let suffixNode: React.ReactElement = <SuffixWrap onClick={onArrowClick}>\n    {!disabled && visible ? <ArrowUp disabled={disabled} /> : <ArrowDown disabled={disabled} />}\n  </SuffixWrap>;\n  if (value.length && mouseInInput) {\n    suffixNode = <SuffixWrap onClick={handleClear}><ClearIcon /></SuffixWrap>;\n  }\n\n  return <Popover\n    placement=\"bottomLeft\"\n    placementOffset={[4, 0]}\n    animation\n    content={<OverlayWrap style={{ minWidth: containerWidth }}>\n      <List id={focusTargetId} items={options} onSelect={onOptionClick} active={active} onActiveChange={e => { setActive(e); }}\n        renderItem={({ key }) => (p: React.ReactElement) => {\n          return value.includes(key) ? React.cloneElement(p, { suffix: <IconSelected /> }) : p;\n        }}\n        style={{ minWidth: 'auto' }}\n        {...proxyRestProps(rest, 'list')}\n      />\n    </OverlayWrap>}\n    visible={!disabled && visible}\n    trigger=\"click\"\n    onVisibleChange={(e) => {\n      if (e) {\n        !visible && setVisible(e);\n      } else {\n        visible && setVisible(e);\n        setActive(null);\n      }\n    }}\n    getContainer={getContainer || (() => outerRef.current || document.body)}\n    onKeyDown={(e) => { e.which === KEY_CODES.ESC && handleEsc() }}\n  >\n    <MultiSelectInputWrap\n      tabIndex={-1}\n      ref={outerRef}\n      onKeyDown={handleKeyDown}\n      error={error}\n      disabled={disabled}\n      size={size}\n      visible={!disabled && visible}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n      {...mergeRestProps(rest, 'wdn-multi-select')}\n    >\n      <OverflowWrap ref={myRef}>\n        {tagsNode}\n        {restNode}\n        <Item order={mergedDisplayCount} registerSize={registerInputSize} display style={{ flexGrow: 1 }}>\n          <Input\n            ref={ref}\n            className=\"input\"\n            bordered={false}\n            size={size}\n            value={inputValue}\n            disabled={!!disabled}\n            placeholder={!value.length ? placeholder : undefined}\n            onBlur={updateValueByInputValue}\n            onChange={handleInputValueChange}\n            suffix={suffixNode}\n          />\n        </Item>\n      </OverflowWrap>\n      {disabled && <DisableMask />}\n      {error && <ErrorTip>{error}</ErrorTip>}\n    </MultiSelectInputWrap>\n  </Popover >;\n}));"],"mappings":"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"}