{"version":3,"file":"TimeColumn.js","names":["React","useRef","useLayoutEffect","useEffect","mergeClassName","UlWrapper","LiWrapper","NumberWrapper","TitleLiWrapper","TitleWrapper","LI_HEIGHT","leftPad","Animation","generateUnits","start","end","step","units","i","push","label","value","TimeColumn","memo","props","onSelect","title","showNow","ulRef","current","targetValue","currentValue","scrollTop","animation","duration","progress","p","done","clear","dom","stopPropagation","e","addEventListener","removeEventListener","map","unit","undefined"],"sources":["../../../../../../src/form/date-picker/panels/TimePanel/TimeColumn.tsx"],"sourcesContent":["import React, { useRef, useLayoutEffect, useEffect } from \"react\";\nimport { mergeClassName } from \"../../../../common\";\nimport { UlWrapper, LiWrapper, NumberWrapper, TitleLiWrapper, TitleWrapper, LI_HEIGHT } from \"./styled\";\nimport { leftPad } from \"../../date-util\";\nimport Animation from './Animation';\n\ntype TimeUnit = {\n  value: number;\n  label: string;\n};\n\ninterface ITimeColumnProps {\n  value?: number; // 当前时间列的值\n  units: TimeUnit[];\n  onSelect?: (value: number) => void;\n  title?: string; // 列标题\n  showNow?: boolean;\n}\n\nexport const generateUnits = (\n  start: number,\n  end: number,\n  step: number = 1\n): TimeUnit[] => {\n  const units: TimeUnit[] = [];\n  for (let i = start; i <= end; i += step) {\n    units.push({\n      label: leftPad(i, 2),\n      value: i,\n    });\n  }\n  return units;\n};\n\nexport const TimeColumn: React.FC<ITimeColumnProps> = React.memo((props) => {\n  const { value = 0, units, onSelect, title, showNow } = props;\n\n  const ulRef = useRef<HTMLUListElement>(null);\n\n  useLayoutEffect(() => {\n    if (!ulRef.current) {\n      return;\n    }\n    const targetValue = LI_HEIGHT * value;\n    const currentValue = ulRef.current.scrollTop;\n  \n    const animation = new Animation({\n      duration: 240,\n      progress(p: number): void {\n        if (ulRef.current) {\n          ulRef.current.scrollTop = p * (targetValue - currentValue) + currentValue;\n        }\n      },\n      done(): void {\n        if (ulRef.current) {\n          ulRef.current.scrollTop = targetValue;\n        }\n      },\n    }).start();\n\n    return () => {\n      animation.clear();\n    };\n  }, [value]);\n\n  useEffect(() => {\n    const dom = ulRef && ulRef.current;\n    const stopPropagation = (e: Event) => e.stopPropagation();\n    dom?.addEventListener('mousewheel', stopPropagation);\n    return () => dom?.removeEventListener('mousewheel', stopPropagation);\n  }, []);\n\n  return (\n    <UlWrapper ref={ulRef} showNow={showNow}>\n      {title ? (\n        <TitleLiWrapper>\n          <TitleWrapper>{title}</TitleWrapper>\n        </TitleLiWrapper>\n      ) : null}\n      {units.map((unit) => (\n        <LiWrapper\n          key={unit.value}\n          onClick={() => onSelect?.(unit.value)}\n          className={mergeClassName(\n            value === unit.value ? \"selected\" : undefined\n          )}\n        >\n          <NumberWrapper>{unit.label}</NumberWrapper>\n        </LiWrapper>\n      ))}\n    </UlWrapper>\n  );\n});\n"],"mappings":"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"}