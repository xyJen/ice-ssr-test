import _extends from "@babel/runtime/helpers/extends";
import _objectWithoutPropertiesLoose from "@babel/runtime/helpers/objectWithoutPropertiesLoose";
var _excluded = ["icon", "title", "active", "tooltip", "disabled", "size", "overlay", "autoClose", "overlayVisible", "onVisibleChange", "overlayStyle", "badgeDot", "testid", "role", "getContainer", "placement"];
import React, { cloneElement, useCallback, useRef } from 'react';
var _createElement = /*#__PURE__*/React.createElement;
import { throttle } from "lodash-es";
import { Popover } from "../../../../display/popover";
import { IconArrowDown } from "../../../../basic/icon";
import { ToolbarHoverTip } from "../../toolbarHoverTip";
import { useDefaultProp, mergeRef, mergeClassName } from "../../../../common";
import { Wrapper } from "./styled";
import { BadgeDot } from "../../../../basic/badge";
var placementOffset = [4, 0];
export var BaseIconMenu = /*#__PURE__*/React.memo( /*#__PURE__*/React.forwardRef(function (props, ref) {
  var icon = props.icon,
    title = props.title,
    active = props.active,
    tooltip = props.tooltip,
    disabled = props.disabled,
    size = props.size,
    overlay = props.overlay,
    autoClose = props.autoClose,
    overlayVisible = props.overlayVisible,
    onVisibleChange = props.onVisibleChange,
    overlayStyle = props.overlayStyle,
    badgeDot = props.badgeDot,
    testid = props.testid,
    role = props.role,
    getContainer = props.getContainer,
    _props$placement = props.placement,
    placement = _props$placement === void 0 ? 'bottomLeft' : _props$placement,
    restProps = _objectWithoutPropertiesLoose(props, _excluded);
  var _useDefaultProp = useDefaultProp(false, overlayVisible, onVisibleChange),
    menuVisible = _useDefaultProp[0],
    setMenuVisible = _useDefaultProp[1];
  var cRef = useRef(menuVisible);
  cRef.current = menuVisible;
  var wrapRef = useRef(null);
  var onClick = useCallback(throttle(function () {
    setMenuVisible(!cRef.current);
  }, 300, {
    trailing: false
  }), []);
  var showTitle = size === 'large';
  return /*#__PURE__*/_createElement(Wrapper, _extends({
    ref: mergeRef(ref, wrapRef),
    className: mergeClassName('wdn-toolbar-item', size, (menuVisible || active) && 'active', disabled && 'disabled'),
    "data-testid": testid,
    "data-role": role
  }, restProps), /*#__PURE__*/_createElement(Popover, {
    content: overlay,
    onVisibleChange: setMenuVisible,
    visible: menuVisible,
    getContainer: getContainer || function () {
      return wrapRef.current || document.body;
    },
    placementOffset: placementOffset,
    placement: placement,
    animation: true,
    "data-testid": "overlay-" + testid
  }, /*#__PURE__*/_createElement("div", {
    style: {
      lineHeight: 0
    },
    onClick: disabled ? undefined : onClick
  }, /*#__PURE__*/_createElement(ToolbarHoverTip, {
    overlayVisible: menuVisible,
    disabled: disabled,
    tooltip: tooltip || !showTitle && !disabled && title
  }, /*#__PURE__*/_createElement("div", {
    className: "wdn-toolbar-icon"
  }, /*#__PURE__*/cloneElement(icon, {
    size: size === 'large' ? 'large' : 'normal'
  }), /*#__PURE__*/_createElement(IconArrowDown, {
    className: "wdn-tb-menu-array " + (menuVisible ? 'rotate' : ''),
    style: {
      width: 10,
      height: 10
    }
  }), badgeDot && (typeof badgeDot === 'boolean' ? /*#__PURE__*/_createElement(BadgeDot, {
    style: {
      position: 'absolute',
      top: 0,
      right: 10
    }
  }) : /*#__PURE__*/_createElement(BadgeDot, {
    style: {
      position: 'absolute',
      top: badgeDot.top,
      right: badgeDot.right + 10
    }
  })))))), showTitle && /*#__PURE__*/_createElement("div", {
    className: "wdn-toolbar-title",
    onClick: disabled ? undefined : onClick
  }, /*#__PURE__*/_createElement("div", {
    className: "wdn-tb-title-content"
  }, title)));
}));
//# sourceMappingURL=BaseIonMenu.js.map