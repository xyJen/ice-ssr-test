{"version":3,"file":"splitItemByLength.js","names":["presetItems","Set","noLargeItems","safeDit","itemGroupPadding","itemMargin_d","itemMargin_s","itemSize","iconButton","large","normal","small","iconMenu","splitButton","iconSelect","textSelect","getSlotWidth","item","size","toolbarWidth","slotWidth","props","width","mode","Number","getItemLength","context","typeDisplay","type","displayName","display","presetItemWidth","has","Math","max","getItemsMargin","item1","item2","splitGroupItemByLength","items","length","restLength","res","lastIndex","i","itemLength","push","slice","splitSingleLineItemByLength","visibleItems","isAfterDivider","itemGroup","restLength_","currentItems","resetItems","concat","splitDoubleLineItemByLength","hideItems","Array","isArray","restLength_1","currentItems1","resetItems1","restLength_2","currentItems2","resetItems2","min"],"sources":["../../../../../../../src/navigator/toolbar/layout/toolbarLayout/itemLayout/splitItemByLength.ts"],"sourcesContent":["import type { ReactElement } from 'react';\nimport type { ISingLineItems, IDoubleLineItems } from '../interface';\n\n\nconst presetItems = new Set(['iconSelect', 'textSelect', 'splitButton', 'iconMenu', 'iconButton']);\nconst noLargeItems = new Set(['iconSelect', 'textSelect', 'splitButton']);\n\nconst safeDit = 40;\nconst itemGroupPadding = 6;\n\nconst itemMargin_d = 6;\nconst itemMargin_s = 4;\nconst itemSize: Record<string, { \n  large: number;\n  normal: number;\n  small: number;\n }> = {\n  iconButton: {\n    large: 36 + 9,\n    normal: 28,\n    small: 24,\n  },\n  iconMenu: {\n    large: 48,\n    normal: 36,\n    small: 36,\n  },\n  splitButton: {\n    large: 0,\n    normal: 37,\n    small: 37,\n  },\n  iconSelect: {\n    large: 0,\n    normal: 37,\n    small: 37,\n  },\n  textSelect: {\n    large: 0,\n    normal: 100,\n    small: 100,\n  }\n}\n\nfunction getSlotWidth(\n  item: ReactElement, size: 'large' | 'normal' | 'small', toolbarWidth: number\n) {\n  let slotWidth: number | undefined;\n  if (typeof item.props.width === 'function') {\n    const mode = (size === 'normal') ? 'singleLine' : 'doubleLine';\n    slotWidth = item.props.width({ mode, toolbarWidth: toolbarWidth });\n  } else {\n    slotWidth = item.props.width;\n  }\n  return Number(slotWidth) || 0;\n}\n\nfunction getItemLength(\n  item: ReactElement,\n  size: 'large' | 'normal' | 'small',\n  context: { toolbarWidth: number },\n) {\n  const typeDisplay = (item.type as any).displayName;\n  let displayName = (typeDisplay === 'toolbarSlot') ? item.props.display : typeDisplay;\n\n  const presetItemWidth = itemSize[displayName] && itemSize[displayName][size] || 0\n\n  if (presetItems.has(displayName)) {\n    // splitButton textSelect iconSelect 逻辑特殊\n    if (noLargeItems.has(displayName)) {\n      // splitButton textSelect iconSelect 在双行占两行情况下不显示\n      if(size === 'large') { return 0 }\n      // splitButton 和 双行模式下iconSelect 和 双行模式下 取一个最大值\n      if((displayName === 'splitButton') || ((displayName === 'iconSelect') && (size === 'small'))) {\n        return Math.max(presetItemWidth, getSlotWidth(item, size, context.toolbarWidth));\n      }\n      // textSelect 使用传入的width\n      if (displayName === 'textSelect') {\n        return getSlotWidth(item, size, context.toolbarWidth) || presetItemWidth;\n      }\n    }\n    return presetItemWidth;\n  } else {\n    // 认为是custom 需要根据slot的width进行计算\n    return getSlotWidth(item, size, context.toolbarWidth);\n  }\n}\n\nfunction getItemsMargin(item1: ReactElement, item2: ReactElement,  size: 'large' | 'normal' | 'small') {\n  return size === 'normal' ? itemMargin_s : itemMargin_d ;\n};\n\nfunction splitGroupItemByLength(\n  items: ReactElement[], length: number, size: 'large' | 'normal' | 'small',\n  context: { toolbarWidth: number },\n): [number, ReactElement[]] | [number, ReactElement[], ReactElement[]]  {\n  let restLength = length;\n  const res: ReactElement[] = [];\n  const lastIndex = items.length - 1;\n  for (let i = 0; i < items.length; i++) {\n    let itemLength = getItemLength(items[i], size, context);\n    // 拿不到有效宽度的情况下 忽略掉当前的item\n    if (itemLength <= 0) {\n      \n      continue;\n    }\n    restLength -= itemLength;\n    if (i !== lastIndex) {\n      restLength -= getItemsMargin(items[i], items[i + 1],  size);\n    }\n    if (restLength >= 0) {\n      res.push(items[i])\n    } else {\n      return [\n        0,\n        res,\n        items.slice(i),\n      ];\n    }\n  }\n  return [restLength, res];\n}\n\nexport function splitSingleLineItemByLength(\n  items: ISingLineItems, length: number\n): [ISingLineItems] | [ISingLineItems, ISingLineItems] {\n  let restLength = length - safeDit;\n  const visibleItems: ISingLineItems = [];\n  let isAfterDivider = false;\n  for (let i = 0; i < items.length; i++) {\n    const itemGroup = items[i];\n    if (itemGroup === 'divider') {\n      isAfterDivider = true;\n      visibleItems.push('divider');\n      continue;\n    }\n    if (isAfterDivider) {\n      restLength -= itemGroupPadding;\n      isAfterDivider = false;\n    }\n    \n\n    const [restLength_, currentItems, resetItems] = splitGroupItemByLength(itemGroup, restLength, 'normal', { toolbarWidth: length });\n    if (currentItems.length > 0) {\n      visibleItems.push(currentItems);\n    }\n    if (resetItems) {\n      return [\n        visibleItems,\n        ([resetItems] as ISingLineItems).concat(items.slice(i + 1)),\n      ];\n      // items.slice(i + 1)\n    }\n    restLength = restLength_;\n    restLength -= itemGroupPadding;\n  }\n\n  return [visibleItems];\n}\n\nexport function splitDoubleLineItemByLength(\n  items: IDoubleLineItems, length: number\n):[IDoubleLineItems] | [IDoubleLineItems, IDoubleLineItems] {\n  let restLength = length - safeDit;\n  const visibleItems: IDoubleLineItems = [];\n  const hideItems: IDoubleLineItems = [];\n  const size = 'large';\n  let isAfterDivider = false;\n  for (let i = 0; i < items.length; i++) {\n    const itemGroup = items[i];\n    if (itemGroup === 'divider') {\n      isAfterDivider = true;\n      visibleItems.push('divider');\n      continue;\n    }\n    if (isAfterDivider) {\n      restLength -= itemGroupPadding;\n      isAfterDivider = false;\n    }\n\n\n    if (Array.isArray(itemGroup[0])) {\n  \n      const [restLength_1, currentItems1, resetItems1] = splitGroupItemByLength(itemGroup[0], restLength, 'small', { toolbarWidth: length });\n      const [restLength_2, currentItems2, resetItems2] = splitGroupItemByLength(itemGroup[1]  as unknown as ReactElement[], restLength, 'small', { toolbarWidth: length });\n      restLength = Math.min(restLength_1, restLength_2);\n      if (resetItems1 || resetItems2) {\n        hideItems.push([itemGroup[0] || [], itemGroup[1] as unknown as ReactElement[] || []]);\n        hideItems.push(...items.slice(i + 1));\n        break;\n      }\n      if (currentItems1.length > 0 && currentItems2.length > 0) {\n        visibleItems.push([currentItems1, currentItems2]);\n      }\n      \n    } else {\n      const [restLength_, currentItems, resetItems] = splitGroupItemByLength(itemGroup as unknown as ReactElement[], restLength, size, { toolbarWidth: length });\n      restLength = restLength_;\n      if (currentItems.length > 0) {\n        visibleItems.push(currentItems);\n      }\n      if (resetItems) { \n        hideItems.push(resetItems);\n        hideItems.push(...items.slice(i + 1));\n        break;\n      }\n    }\n    restLength -= itemGroupPadding;\n  }\n\n  return hideItems.length > 0 ? [visibleItems, hideItems] : [visibleItems];\n}\n\n"],"mappings":"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"}