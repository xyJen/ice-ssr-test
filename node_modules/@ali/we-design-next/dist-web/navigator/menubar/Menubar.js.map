{"version":3,"file":"Menubar.js","names":["React","useRef","MenubarWrap","MenubarItemWrap","useFocusTarget","KEY_CODES","useDefaultProp","Menu","flattenNested","isNormalized","isEnabled","Popover","Menubar","memo","props","_path","path","onPathChange","menus","onSelect","setPath","ref","focusTargetId","focusTarget","focusOwner","onKeydown","e","idx","findIndex","m","key","keyCode","RIGHT","length","undefined","LEFT","DOWN","menu","find","its","items","filter","k","ESC","stopPropagation","map","it","splice","p","v","title"],"sources":["../../../../src/navigator/menubar/Menubar.tsx"],"sourcesContent":["import React, { useRef } from 'react';\nimport { MenubarWrap, MenubarItemWrap } from './styled';\nimport { useFocusTarget, KEY_CODES, useDefaultProp } from '../../common';\nimport { Menu } from '../../display/menu';\nimport { flattenNested, isNormalized, isEnabled } from '../../basic/list/nested';\nimport { Popover } from '../../display/popover';\n\n\ntype IMenuBarProps = {\n\n  path?: Array<string | undefined>;\n\n  onPathChange?: (path: Array<string | undefined>) => void;\n\n  onSelect?: (path: Array<string | undefined>) => void;\n\n  menus?: Array<{\n    key: string,\n    title: string,\n    items: React.ComponentProps<typeof Menu>['items']\n  }>;\n\n};\n\n\nexport const Menubar = React.memo(\n  (props: IMenuBarProps) => {\n\n    const {\n      path: _path,\n      onPathChange,\n      menus = [],\n      onSelect,\n    } = props;\n\n    const [path, setPath] = useDefaultProp([], _path, onPathChange);\n\n    const ref = useRef<HTMLDivElement>(null);\n    const [focusTargetId, focusTarget, focusOwner] = useFocusTarget(ref);\n\n    const onKeydown = (e: React.KeyboardEvent) => {\n      const idx = menus.findIndex(m => m.key === path[0]);\n      if (idx !== -1) {\n        if (e.keyCode === KEY_CODES.RIGHT && idx < menus.length - 1) {\n          focusTarget(\n            () => setPath([menus[idx + 1].key, undefined])\n          )\n        } else if (e.keyCode === KEY_CODES.LEFT && idx > 0) {\n          focusTarget(\n            () => setPath([menus[idx - 1].key, undefined])\n          )\n        } else if (e.keyCode === KEY_CODES.DOWN && !path[1]) {\n          const menu = menus.find(m => m.key === path[0]);\n          if (menu) {\n            const its = flattenNested(menu.items || []).filter(isNormalized).filter(isEnabled);\n            const k = its[0].key;\n            focusTarget(\n              () => setPath([path[0], k])\n            );\n          }\n        } else if (e.keyCode === KEY_CODES.ESC) {\n          focusOwner(\n            () => {\n              setPath([]);\n              e.stopPropagation();\n            }\n          );\n        }\n      }\n    };\n\n    return <MenubarWrap ref={ref} tabIndex={-1} onKeyDown={onKeydown}>\n      {\n        menus.map(it =>\n          <Popover\n            placement=\"bottomLeft\"\n            animation\n            content={\n              <Menu\n                id={focusTargetId}\n                items={it.items}\n                path={[...path].splice(1)}\n                onPathChange={(p) => setPath([it.key, ...p])}\n                onSelect={(p) => onSelect && onSelect([it.key, ...p])}\n              />\n            }\n            visible={path[0] === it.key && path.length > 1}\n            trigger=\"click\"\n            onVisibleChange={v => {\n              if (v) {\n                focusTarget(\n                  () => setPath([it.key, undefined])\n                );\n              } else {\n                if (it.key === path[0]) {\n                  setPath([path[0]]);\n                }\n              }\n            }}>\n            <MenubarItemWrap\n              active={path[0] === it.key}\n              onMouseEnter={\n                () => {\n                  if (!!path[0] && path[0] !== it.key) {\n                    focusTarget(\n                      () => setPath([it.key, undefined])\n                    );\n                  }\n                }\n              }\n            >\n              {it.title}\n            </MenubarItemWrap>\n          </Popover>\n        )\n      }\n    </MenubarWrap >;\n  }\n);\n\n"],"mappings":"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"}