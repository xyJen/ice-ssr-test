{"version":3,"file":"Tab.js","names":["React","useRef","useState","useCallback","useMemo","useContext","useLayoutEffect","mergeClassName","KEY_CODES","mergeRef","Input","TabWrapper","TabText","BOTTOM_BAR_HEIGHT","SheetTabsProvider","useClickOuterRef","TAB_ID_PREFIX","Tab","forwardRef","props","ref","switchable","renamable","onContextMenu","onRename","tab","title","active","editing","setActiveTab","onEditingTab","onQuitEditingTab","prefix","suffix","className","restProps","inputRef","inputValue","setInputValue","editHandlers","handleStartEdit","setTimeout","current","focus","select","handleQuitEdit","newTitle","trim","undefined","handleKeyDown","e","which","ENTER","ESCAPE","blur","handleContextMenu","preventDefault","stopPropagation","editHandlersCurrent","inputStyle","height","position","left","right","border","paddingLeft","borderRadius","transition","transform","backgroundColor","nodeRef","target","value"],"sources":["../../../../src/navigator/sheet-tabs/Tab.tsx"],"sourcesContent":["import React, { useRef, useState, useCallback, useMemo, useContext, useLayoutEffect } from \"react\";\nimport { mergeClassName, KEY_CODES, IRestProps, mergeRef } from \"../../common\";\nimport { Input } from \"../../form/input\";\nimport { TabWrapper, TabText, BOTTOM_BAR_HEIGHT } from \"./styled\";\nimport { SheetTabsProvider } from \"./SheetTabs\";\nimport type { ISheetTabsProps, TabInfo } from \"./SheetTabs\";\nimport { useClickOuterRef } from './useClickOuterRef';\n\ntype ITabProps = Pick<\n  ISheetTabsProps,\n  \"switchable\" | \"renamable\" | \"onContextMenu\" | \"onRename\"\n> &\n  Omit<TabInfo, 'key' | 'hidden'> & {\n    tab?: string;\n    active?: boolean;\n    editing?: boolean;\n    setActiveTab?: (key: string) => void;\n    onEditingTab?: (key: string) => void;\n    onQuitEditingTab?: (key: string) => void;\n    prefix?: React.ReactNode;\n    suffix?: React.ReactNode;\n  } & Omit<IRestProps, 'id'>;\n\nexport const TAB_ID_PREFIX = 'sheet-tab-';\n\nexport const Tab = React.forwardRef<HTMLDivElement, ITabProps>((props, ref) => {\n  const {\n    switchable,\n    renamable,\n    onContextMenu,\n    onRename,\n    tab = '',\n    title,\n    active,\n    editing,\n    setActiveTab,\n    onEditingTab,\n    onQuitEditingTab,\n    prefix,\n    suffix,\n    className,\n    ...restProps // 拖拽透传的props\n  } = props;\n  const inputRef = useRef<HTMLInputElement>(null);\n  const [inputValue, setInputValue] = useState<string | undefined>();\n  const { editHandlers } = useContext(SheetTabsProvider);\n\n  const handleStartEdit = useCallback(() => {\n    onEditingTab?.(tab);\n    setTimeout(() => {\n      if (inputRef.current) {\n        inputRef.current?.focus();\n        inputRef.current?.select();\n      }\n    }, 0);\n  }, [tab, onEditingTab]);\n\n  const handleQuitEdit = useCallback(() => {\n      const newTitle = inputValue && inputValue.trim();\n      typeof newTitle !== 'undefined' && newTitle !== title && onRename?.(tab, newTitle);\n      setInputValue(undefined);\n      onQuitEditingTab?.(tab);\n    },\n    [inputValue, onRename, tab, title, onQuitEditingTab]\n  );\n\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\n    if (\n      inputRef.current &&\n      (e.which === KEY_CODES.ENTER || e.which === KEY_CODES.ESCAPE)\n    ) {\n      inputRef.current.blur();\n    }\n  }, []);\n\n  const handleContextMenu = useCallback((e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    onContextMenu?.(tab, e);\n  }, [onContextMenu]);\n\n  useLayoutEffect(() => {\n    const editHandlersCurrent = editHandlers.current;\n    editHandlersCurrent[tab] = handleStartEdit;\n    return () => {\n      delete editHandlersCurrent[tab];\n    };\n  }, [handleStartEdit, tab]);\n\n  const inputStyle: React.CSSProperties = useMemo(() => {\n    return {\n      height: BOTTOM_BAR_HEIGHT,\n      position: 'absolute',\n      left: 0,\n      right: 0,\n      border: 0,\n      paddingLeft: 8,\n      borderRadius: 'unset',\n      transition: 'none',\n      transform: editing ? undefined : 'translate(-100%, -100%)',\n      backgroundColor: 'white',\n    };\n  }, [editing]);\n\n  // 整合了 draggable 的 ref、点击输入框外的区域的处理\n  const nodeRef = mergeRef(useClickOuterRef<HTMLDivElement>(handleQuitEdit, editing), ref);\n\n  return (\n    <TabWrapper\n      ref={nodeRef}\n      id={`${TAB_ID_PREFIX}${tab}`}\n      className={mergeClassName(\n        !switchable && !active ? \"disabled\" : undefined,\n        active ? \"active\" : undefined,\n        className\n      )}\n      onMouseDown={(e) => {\n        if (active) return;\n        switchable && setActiveTab?.(tab);\n      }}\n      onDoubleClick={() => renamable && handleStartEdit()}\n      onContextMenu={handleContextMenu}\n      {...restProps}\n    >\n      <Input\n        ref={inputRef}\n        bordered={false}\n        style={inputStyle}\n        value={typeof inputValue === 'undefined' ? title : inputValue}\n        onChange={(e) => setInputValue(e.target.value)}\n        onBlur={() => handleQuitEdit()}\n        onKeyDown={(e) => handleKeyDown(e)}\n      />\n      {editing ? null : prefix}\n      <TabText>{title}</TabText>\n      {editing ? null : suffix}\n    </TabWrapper>\n  );\n});\n"],"mappings":"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"}