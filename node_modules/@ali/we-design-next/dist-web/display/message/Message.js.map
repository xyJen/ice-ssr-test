{"version":3,"file":"Message.js","names":["React","ReactDOM","noop","CSSTransitionGroup","success","info","warning","error","loading","styled","MessageBox","showLocalMessage","root_style","MESSAGE_COMMON_DURATION","Root","Message","props","messages","map","msg","key","icon","content","actionTitle","onAction","message","close","hasRendered","messageIndex","renderDom","handleUpdate","msgs","window","document","body","contains","oDiv","createElement","style","position","width","top","left","appendChild","render","getKey","noopConfig","getProps","title","config","keepAlive","restConfig","undefined","open","itemProps","getContainer","onClose","container","closeLocal","setTimeout","sameKeyIndex","findIndex","splice","length","autoCloseFirstIndex","push","filter","m","closeAll","options"],"sources":["../../../../src/display/message/Message.tsx"],"sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { noop } from 'lodash-es';\nimport CSSTransitionGroup from 'react-transition-group/CSSTransitionGroup';\nimport { success, info, warning, error, loading } from './icons';\nimport styled from 'styled-components';\nimport { MessageBox } from './MessageBox';\nimport { showLocalMessage } from './local';\nimport type { IMessageProps, IMessageOptions, IMessageItemProps } from './interface'\n\nimport {\n  root_style,\n} from './styled';\n\nconst MESSAGE_COMMON_DURATION = 3 * 1000;\n\nconst Root = styled(CSSTransitionGroup)`${root_style}`;\n\nconst Message: React.FC<IMessageProps> = (props) => {\n  const { messages } = props;\n\n  return (\n    <Root\n      component=\"div\"\n      transitionName=\"message\"\n      transitionEnterTimeout={300}\n      transitionLeaveTimeout={300}\n    >\n      {messages.map((msg) => {\n        const { key, icon, content, actionTitle, onAction = noop } = msg;\n        return (\n          <MessageBox\n            key={key}\n            icon={icon}\n            content={content}\n            onAction={() => {\n              message.close(key);\n              onAction();\n            }}\n            actionTitle={actionTitle}\n          />\n        );\n      })}\n    </Root>\n  );\n};\n\nlet hasRendered = false;\n\nexport const message = (() => {\n  let messageIndex = 0;\n  let messages: IMessageItemProps[] = [];\n\n  let renderDom: HTMLDivElement | undefined = null!;\n\n  function handleUpdate(msgs: IMessageItemProps[]) {\n    if (!renderDom || !window.document.body.contains(renderDom)) {\n      const oDiv = document.createElement('div');\n      oDiv.style.position = 'absolute';\n      oDiv.style.width = '100%';\n      oDiv.style.top = '0px';\n      oDiv.style.left = '0px';\n      document.body.appendChild(oDiv);\n      renderDom = oDiv;\n    }\n    if (!hasRendered) {\n      ReactDOM.render(<Message messages={[]} />, renderDom);\n      hasRendered = true;\n    }\n    messages = msgs;\n    ReactDOM.render(<Message messages={msgs} />, renderDom);\n  }\n\n  const getKey = () => {\n    const key = `wds-msg-id-${++messageIndex}`;\n    if (messageIndex > 10000000) { messageIndex = 0; }\n    return key;\n  };\n\n  const noopConfig: IMessageOptions = {};\n\n  const getProps = (\n    icon: React.ReactNode,\n    title: React.ReactElement | string,\n    config: IMessageOptions = noopConfig,\n  ): IMessageItemProps => {\n\n    const { key, keepAlive, ...restConfig } = config;\n\n    return {\n      icon,\n      content: title,\n      key: key || getKey(),\n      keepAlive: (keepAlive === undefined) ? !!(config.actionTitle) : keepAlive,\n      ...restConfig\n    }\n  };\n\n  return {\n\n    open(itemProps: IMessageItemProps) {\n\n      const { getContainer, onClose } = itemProps;\n\n      if (getContainer) {\n        const container = getContainer();\n        if (container && container!== window.document.body ) {\n          \n          const closeLocal = showLocalMessage({ container,  ...itemProps }) || noop;\n          if (!itemProps.keepAlive) {\n            setTimeout(() => {\n              closeLocal();\n              onClose && onClose();\n            }, MESSAGE_COMMON_DURATION);\n          }\n\n          return closeLocal;\n        }\n      }\n\n      const { key } = itemProps;\n\n      // 保持非恒定的的只有三个\n      messages = [...messages];\n      const sameKeyIndex =  messages.findIndex((msg) => (msg.key === key));\n      if (sameKeyIndex >= 0) {\n        messages.splice(sameKeyIndex, 1);\n      } else if (messages.length >= 3 && !itemProps.keepAlive) {\n        const autoCloseFirstIndex = messages.findIndex((msg) => !msg.keepAlive);\n        if (autoCloseFirstIndex >= 0) {\n          messages.splice(autoCloseFirstIndex, 1);\n        }\n      }\n      messages.push(itemProps);\n\n      handleUpdate(messages);\n      \n      if (!itemProps.keepAlive) {\n        setTimeout(() => {\n          this.close(key);\n          onClose && onClose();\n        }, MESSAGE_COMMON_DURATION);\n      }\n\n      return () => this.close(itemProps.key);\n    },\n\n    close(key: string) {\n      messages = messages.filter((m) => (m.key !== key))\n      handleUpdate(messages);\n    },\n\n    closeAll(){\n      handleUpdate([]);\n    },\n\n    info(content: string, options?: IMessageOptions) {\n      return this.open(getProps(info, content, options));\n    },\n\n    success(content: string, options?: IMessageOptions) {\n      return this.open(getProps(success, content, options));\n    },\n\n    warning(content: string, options?: IMessageOptions) {\n      return this.open(getProps(warning, content, options));\n    },\n\n    error(content: string, options?: IMessageOptions) {\n      return this.open(getProps(error, content, options));\n    },\n\n    loading(content: string, options?: IMessageOptions) {\n      return this.open(getProps(loading, content, { keepAlive: true, ...options }));\n    },\n\n    message(content: string | React.ReactElement, options?: IMessageOptions) {\n      return this.open(getProps(null, content, options))\n    }\n  };\n\n})();\n"],"mappings":";;;AAAA,OAAOA,KAAK,MAAM,OAAO;AAAC,qBACE;AAA5B,OAAOC,QAAQ,MAAM,WAAW;AAChC,SAASC,IAAI,QAAQ,WAAW;AAChC,OAAOC,kBAAkB,MAAM,2CAA2C;AAC1E,SAASC,OAAO,IAAPA,QAAO,EAAEC,IAAI,IAAJA,KAAI,EAAEC,OAAO,IAAPA,QAAO,EAAEC,KAAK,IAALA,MAAK,EAAEC,OAAO,IAAPA,QAAO;AAC/C,OAAOC,MAAM,MAAM,mBAAmB;AACtC,SAASC,UAAU;AACnB,SAASC,gBAAgB;AAGzB,SACEC,UAAU;AAGZ,IAAMC,uBAAuB,GAAG,CAAC,GAAG,IAAI;AAExC,IAAMC,IAAI,gBAAGL,MAAM,CAACN,kBAAkB,CAAC,WAAGS,UAAU,CAAE;AAEtD,IAAMG,OAAgC,GAAG,SAAnCA,OAAgC,CAAIC,KAAK,EAAK;EAClD,IAAQC,QAAQ,GAAKD,KAAK,CAAlBC,QAAQ;EAEhB,oBACE,eAAC,IAAI;IACH,SAAS,EAAC,KAAK;IACf,cAAc,EAAC,SAAS;IACxB,sBAAsB,EAAE,GAAI;IAC5B,sBAAsB,EAAE;EAAI,GAE3BA,QAAQ,CAACC,GAAG,CAAC,UAACC,GAAG,EAAK;IACrB,IAAQC,GAAG,GAAkDD,GAAG,CAAxDC,GAAG;MAAEC,IAAI,GAA4CF,GAAG,CAAnDE,IAAI;MAAEC,OAAO,GAAmCH,GAAG,CAA7CG,OAAO;MAAEC,WAAW,GAAsBJ,GAAG,CAApCI,WAAW;MAAA,gBAAsBJ,GAAG,CAAvBK,QAAQ;MAARA,SAAQ,8BAAGtB,IAAI;IACxD,oBACE,eAAC,UAAU;MACT,GAAG,EAAEkB,GAAI;MACT,IAAI,EAAEC,IAAK;MACX,OAAO,EAAEC,OAAQ;MACjB,QAAQ,EAAE,oBAAM;QACdG,OAAO,CAACC,KAAK,CAACN,GAAG,CAAC;QAClBI,SAAQ,EAAE;MACZ,CAAE;MACF,WAAW,EAAED;IAAY,EACzB;EAEN,CAAC,CAAC,CACG;AAEX,CAAC;AAED,IAAII,WAAW,GAAG,KAAK;AAEvB,OAAO,IAAMF,OAAO,GAAI,YAAM;EAC5B,IAAIG,YAAY,GAAG,CAAC;EACpB,IAAIX,QAA6B,GAAG,EAAE;EAEtC,IAAIY,SAAqC,GAAG,IAAK;EAEjD,SAASC,YAAY,CAACC,IAAyB,EAAE;IAC/C,IAAI,CAACF,SAAS,IAAI,CAACG,MAAM,CAACC,QAAQ,CAACC,IAAI,CAACC,QAAQ,CAACN,SAAS,CAAC,EAAE;MAC3D,IAAMO,IAAI,GAAGH,QAAQ,CAACI,aAAa,CAAC,KAAK,CAAC;MAC1CD,IAAI,CAACE,KAAK,CAACC,QAAQ,GAAG,UAAU;MAChCH,IAAI,CAACE,KAAK,CAACE,KAAK,GAAG,MAAM;MACzBJ,IAAI,CAACE,KAAK,CAACG,GAAG,GAAG,KAAK;MACtBL,IAAI,CAACE,KAAK,CAACI,IAAI,GAAG,KAAK;MACvBT,QAAQ,CAACC,IAAI,CAACS,WAAW,CAACP,IAAI,CAAC;MAC/BP,SAAS,GAAGO,IAAI;IAClB;IACA,IAAI,CAACT,WAAW,EAAE;MAChB1B,QAAQ,CAAC2C,MAAM,eAAC,eAAC,OAAO;QAAC,QAAQ,EAAE;MAAG,EAAG,EAAEf,SAAS,CAAC;MACrDF,WAAW,GAAG,IAAI;IACpB;IACAV,QAAQ,GAAGc,IAAI;IACf9B,QAAQ,CAAC2C,MAAM,eAAC,eAAC,OAAO;MAAC,QAAQ,EAAEb;IAAK,EAAG,EAAEF,SAAS,CAAC;EACzD;EAEA,IAAMgB,MAAM,GAAG,SAATA,MAAM,GAAS;IACnB,IAAMzB,GAAG,mBAAiB,EAAEQ,YAAc;IAC1C,IAAIA,YAAY,GAAG,QAAQ,EAAE;MAAEA,YAAY,GAAG,CAAC;IAAE;IACjD,OAAOR,GAAG;EACZ,CAAC;EAED,IAAM0B,UAA2B,GAAG,CAAC,CAAC;EAEtC,IAAMC,QAAQ,GAAG,SAAXA,QAAQ,CACZ1B,IAAqB,EACrB2B,KAAkC,EAClCC,MAAuB,EACD;IAAA,IADtBA,MAAuB;MAAvBA,MAAuB,GAAGH,UAAU;IAAA;IAGpC,cAA0CG,MAAM;MAAxC7B,GAAG,WAAHA,GAAG;MAAE8B,SAAS,WAATA,SAAS;MAAKC,UAAU;IAErC;MACE9B,IAAI,EAAJA,IAAI;MACJC,OAAO,EAAE0B,KAAK;MACd5B,GAAG,EAAEA,GAAG,IAAIyB,MAAM,EAAE;MACpBK,SAAS,EAAGA,SAAS,KAAKE,SAAS,GAAI,CAAC,CAAEH,MAAM,CAAC1B,WAAY,GAAG2B;IAAS,GACtEC,UAAU;EAEjB,CAAC;EAED,OAAO;IAELE,IAAI,gBAACC,SAA4B,EAAE;MAAA;MAEjC,IAAQC,YAAY,GAAcD,SAAS,CAAnCC,YAAY;QAAEC,OAAO,GAAKF,SAAS,CAArBE,OAAO;MAE7B,IAAID,YAAY,EAAE;QAChB,IAAME,SAAS,GAAGF,YAAY,EAAE;QAChC,IAAIE,SAAS,IAAIA,SAAS,KAAIzB,MAAM,CAACC,QAAQ,CAACC,IAAI,EAAG;UAEnD,IAAMwB,UAAU,GAAG/C,gBAAgB;YAAG8C,SAAS,EAATA;UAAS,GAAMH,SAAS,EAAG,IAAIpD,IAAI;UACzE,IAAI,CAACoD,SAAS,CAACJ,SAAS,EAAE;YACxBS,UAAU,CAAC,YAAM;cACfD,UAAU,EAAE;cACZF,OAAO,IAAIA,OAAO,EAAE;YACtB,CAAC,EAAE3C,uBAAuB,CAAC;UAC7B;UAEA,OAAO6C,UAAU;QACnB;MACF;MAEA,IAAQtC,GAAG,GAAKkC,SAAS,CAAjBlC,GAAG;;MAEX;MACAH,QAAQ,aAAOA,QAAQ,CAAC;MACxB,IAAM2C,YAAY,GAAI3C,QAAQ,CAAC4C,SAAS,CAAC,UAAC1C,GAAG;QAAA,OAAMA,GAAG,CAACC,GAAG,KAAKA,GAAG;MAAA,CAAC,CAAC;MACpE,IAAIwC,YAAY,IAAI,CAAC,EAAE;QACrB3C,QAAQ,CAAC6C,MAAM,CAACF,YAAY,EAAE,CAAC,CAAC;MAClC,CAAC,MAAM,IAAI3C,QAAQ,CAAC8C,MAAM,IAAI,CAAC,IAAI,CAACT,SAAS,CAACJ,SAAS,EAAE;QACvD,IAAMc,mBAAmB,GAAG/C,QAAQ,CAAC4C,SAAS,CAAC,UAAC1C,GAAG;UAAA,OAAK,CAACA,GAAG,CAAC+B,SAAS;QAAA,EAAC;QACvE,IAAIc,mBAAmB,IAAI,CAAC,EAAE;UAC5B/C,QAAQ,CAAC6C,MAAM,CAACE,mBAAmB,EAAE,CAAC,CAAC;QACzC;MACF;MACA/C,QAAQ,CAACgD,IAAI,CAACX,SAAS,CAAC;MAExBxB,YAAY,CAACb,QAAQ,CAAC;MAEtB,IAAI,CAACqC,SAAS,CAACJ,SAAS,EAAE;QACxBS,UAAU,CAAC,YAAM;UACf,KAAI,CAACjC,KAAK,CAACN,GAAG,CAAC;UACfoC,OAAO,IAAIA,OAAO,EAAE;QACtB,CAAC,EAAE3C,uBAAuB,CAAC;MAC7B;MAEA,OAAO;QAAA,OAAM,KAAI,CAACa,KAAK,CAAC4B,SAAS,CAAClC,GAAG,CAAC;MAAA;IACxC,CAAC;IAEDM,KAAK,iBAACN,GAAW,EAAE;MACjBH,QAAQ,GAAGA,QAAQ,CAACiD,MAAM,CAAC,UAACC,CAAC;QAAA,OAAMA,CAAC,CAAC/C,GAAG,KAAKA,GAAG;MAAA,CAAC,CAAC;MAClDU,YAAY,CAACb,QAAQ,CAAC;IACxB,CAAC;IAEDmD,QAAQ,sBAAE;MACRtC,YAAY,CAAC,EAAE,CAAC;IAClB,CAAC;IAEDzB,IAAI,gBAACiB,OAAe,EAAE+C,OAAyB,EAAE;MAC/C,OAAO,IAAI,CAAChB,IAAI,CAACN,QAAQ,CAAC1C,KAAI,EAAEiB,OAAO,EAAE+C,OAAO,CAAC,CAAC;IACpD,CAAC;IAEDjE,OAAO,mBAACkB,OAAe,EAAE+C,OAAyB,EAAE;MAClD,OAAO,IAAI,CAAChB,IAAI,CAACN,QAAQ,CAAC3C,QAAO,EAAEkB,OAAO,EAAE+C,OAAO,CAAC,CAAC;IACvD,CAAC;IAED/D,OAAO,mBAACgB,OAAe,EAAE+C,OAAyB,EAAE;MAClD,OAAO,IAAI,CAAChB,IAAI,CAACN,QAAQ,CAACzC,QAAO,EAAEgB,OAAO,EAAE+C,OAAO,CAAC,CAAC;IACvD,CAAC;IAED9D,KAAK,iBAACe,OAAe,EAAE+C,OAAyB,EAAE;MAChD,OAAO,IAAI,CAAChB,IAAI,CAACN,QAAQ,CAACxC,MAAK,EAAEe,OAAO,EAAE+C,OAAO,CAAC,CAAC;IACrD,CAAC;IAED7D,OAAO,mBAACc,OAAe,EAAE+C,OAAyB,EAAE;MAClD,OAAO,IAAI,CAAChB,IAAI,CAACN,QAAQ,CAACvC,QAAO,EAAEc,OAAO;QAAI4B,SAAS,EAAE;MAAI,GAAKmB,OAAO,EAAG,CAAC;IAC/E,CAAC;IAED5C,OAAO,mBAACH,OAAoC,EAAE+C,OAAyB,EAAE;MACvE,OAAO,IAAI,CAAChB,IAAI,CAACN,QAAQ,CAAC,IAAI,EAAEzB,OAAO,EAAE+C,OAAO,CAAC,CAAC;IACpD;EACF,CAAC;AAEH,CAAC,EAAG"}