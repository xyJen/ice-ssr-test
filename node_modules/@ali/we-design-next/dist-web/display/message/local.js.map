{"version":3,"file":"local.js","names":["React","ReactDOM","once","MessageBox","Z_INDEX","FlagAttributeName","FlagAttributeValue","rootElemSelector","createRootElement","root","document","createElement","setAttribute","Object","assign","style","left","top","position","width","background","pointerEvents","transition","display","justifyContent","zIndex","String","MESSAGE","MsgStyle","transform","closeTimerMap","Map","showLocalMessage","opt","container","restProps","body","contains","querySelector","appendChild","unmountComponentAtNode","opacity","render","timerId","get","window","clearTimeout","setTimeout","close","closeLocalMessage","set"],"sources":["../../../../src/display/message/local.tsx"],"sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { once } from 'lodash-es';\nimport { MessageBox } from './MessageBox'\nimport type { IMessageItemProps } from './interface';\nimport { Z_INDEX } from '../../common';\n\nconst FlagAttributeName = 'data-elemType';\nconst FlagAttributeValue = '_localeMessageWrapper_';\nconst rootElemSelector = `[${FlagAttributeName}=\"${FlagAttributeValue}\"]`;\n\nconst createRootElement = () => {\n  const root = document.createElement('div');\n  root.setAttribute(FlagAttributeName, FlagAttributeValue);\n  Object.assign(root.style, {\n    left: '0px',\n    top: '0px',\n    position: 'absolute',\n    width: '100%',\n    background: 'transparent',\n    pointerEvents: 'none',\n    transition: 'all 0.24s',\n    display: 'flex',\n    justifyContent: 'center',\n    zIndex: String(Z_INDEX.MESSAGE),\n  } as CSSStyleDeclaration);\n  return root as HTMLElement;\n};\n\nconst MsgStyle: React.CSSProperties = {\n  pointerEvents: 'fill',\n  transform: 'unset',\n};\n\nconst closeTimerMap = new Map<HTMLElement, number>();\n\nexport const showLocalMessage = (\n  opt: Omit<IMessageItemProps, 'key' | 'getContainer'> & { top?: number, container: HTMLElement }\n) => {\n  const { top = '28px', container, ...restProps  } = opt;\n\n  if (!document.body.contains(container)) { return; }\n  \n  let root = container.querySelector(rootElemSelector) as (HTMLElement | undefined);\n\n  if (!root) {\n    root = createRootElement();\n  }\n  Object.assign(root.style, { top });\n  container.appendChild(root);\n\n  ReactDOM.unmountComponentAtNode(root);\n  root.style.opacity = '0';\n  root.style.transform = 'translate(0, -40px)';\n\n  ReactDOM.render(<MessageBox {...restProps} />, root);\n\n  const timerId = closeTimerMap.get(root);\n  if (timerId) {\n    window.clearTimeout(timerId);\n  }\n  setTimeout(() => {\n    root && (root.style.opacity = '1');\n    root && (root.style.transform = 'translate(0, 0)');\n  }, 0);\n  const close = once(() => closeLocalMessage(container));\n\n  return close;\n};\n\nfunction closeLocalMessage(container: HTMLElement | undefined | null) {\n  const root = container?.querySelector(rootElemSelector) as HTMLElement;\n  if (!root) { return; }\n\n  setTimeout(() => {\n    root.style.opacity = '0';\n    root.style.transform = 'translate(0, -40px)';\n  }, 0);\n  const timerId = setTimeout(() => {\n    if (document.body.contains(root)) {\n      ReactDOM.unmountComponentAtNode(root);\n    }\n    closeTimerMap.delete(root);\n  }, 300) as unknown as number;\n  closeTimerMap.set(root, timerId);\n};"],"mappings":"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"}