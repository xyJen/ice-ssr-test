{"version":3,"file":"segmented.js","names":["React","useMemo","useRef","useEffect","ResizeObserver","SegmentsWrapper","SegmentsContent","SegmentsOption","SegmentsInk","SegmentsOptionIcon","SegmentsOptionLabel","useDefaultProp","useEventCallback","mergeClassName","normalizeOptions","options","map","opt","value","label","Segmented","props","defaultValue","onChange","_options","_value","block","setValue","optionRefs","updateInk","optionWrapper","current","inkRef","style","left","offsetLeft","width","offsetWidth","ref","observer","observe","disconnect","option","optionValue","icon","disabled","isCustom","isValidElement","handleClick"],"sources":["../../../../src/display/segments/segmented.tsx"],"sourcesContent":["import React, { useMemo, useRef, useEffect } from 'react';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport { SegmentsWrapper, SegmentsContent, SegmentsOption, SegmentsInk, SegmentsOptionIcon, SegmentsOptionLabel } from './styled';\nimport { useDefaultProp, useEventCallback, mergeClassName } from '../../common';\n\ntype ISegmentedOption = {\n  label: React.ReactNode;\n  value: string;\n  icon?: React.ReactNode;\n  disabled?: boolean;\n}\n\ntype ISegmentedProps = {\n  /**\n   * 默认选中值\n   */\n  defaultValue?: string;\n  /**\n   * 选项变化时的回调\n   */\n  onChange?: (value: string) => void;\n  /**\n   * 数据化配置选项内容\n   */\n  options?: Array<string> | Array<ISegmentedOption>;\n  /**\n   * 当前选中的值\n   */\n  value?: string;\n  /**\n   * 将宽度调整为父元素宽度的选项\n   */\n  block?: boolean;\n}\n\n\nconst normalizeOptions = (\n  options: Required<ISegmentedProps>['options']\n): Array<ISegmentedOption> => options.map(\n  opt => typeof opt === 'string' ? { value: opt, label: opt } : opt\n);\n\n\nexport const Segmented: React.FC<ISegmentedProps> = (props) => {\n  const {\n    defaultValue,\n    onChange,\n    options: _options = [],\n    value: _value,\n    block,\n  } = props;\n\n  const options = useMemo(() => normalizeOptions(_options), [_options]);\n  const [value, setValue] = useDefaultProp(defaultValue || options[0].value, _value, onChange);\n  const optionRefs = React.useRef<Record<string, HTMLDivElement | null>>({});\n\n  const updateInk = useEventCallback(() => {\n    const optionWrapper = optionRefs.current[value];\n    if (optionWrapper && inkRef.current) {\n      inkRef.current.style.left = optionWrapper.offsetLeft + 'px';\n      inkRef.current.style.width = optionWrapper.offsetWidth + 'px';\n    }\n  });\n\n  useEffect(() => {\n    updateInk();\n  }, [value, options]);\n\n  useEffect(() => {\n    if (ref.current) {\n      const observer = new ResizeObserver(updateInk);\n      observer.observe(ref.current);\n      return () => observer.disconnect();\n    }\n  }, [updateInk]);\n\n  const ref = useRef<HTMLDivElement>(null);\n  const inkRef = useRef<HTMLDivElement>(null);\n\n  return (\n    <SegmentsWrapper ref={ref} className=\"wdn-segments-wrapper\" isBlock={block} >\n      <SegmentsContent>\n        <SegmentsInk\n          ref={inkRef}\n        />\n        {\n          options.map((option) => {\n            const { label, value: optionValue, icon, disabled } = option;\n            const isCustom = React.isValidElement(label);\n\n            const handleClick = () => {\n              if (disabled) {\n                return;\n              }\n              setValue(optionValue);\n            }\n            return (\n              <SegmentsOption\n                key={optionValue}\n                className={mergeClassName(disabled ? 'wdn-segments-option-disabled' : '')}\n                onClick={handleClick}\n                ref={(ref) => { optionRefs.current[optionValue] = ref }}\n                isCustom={isCustom}\n                isBlock={block}\n                isActive={value === optionValue}\n              >\n                {\n                  icon && <SegmentsOptionIcon>{icon}</SegmentsOptionIcon>\n                }\n                <SegmentsOptionLabel>{label}</SegmentsOptionLabel>\n              </SegmentsOption>\n            )\n          })\n        }\n      </SegmentsContent>\n    </SegmentsWrapper>\n  );\n};\n"],"mappings":"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"}