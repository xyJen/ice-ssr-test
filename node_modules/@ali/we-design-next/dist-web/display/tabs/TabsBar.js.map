{"version":3,"file":"TabsBar.js","names":["React","styled","ResizeObserver","debounce","IconMore","TabsBarTab","useDefaultProp","COLORS","Button","Popover","Menu","TabsInkBar","TAB_MARGIN","TabsNav","div","TabsNavWrap","TabsNavList","TabsNavOperationWrapper","WHITE","btnStyle","border","padding","height","width","display","alignItems","justifyContent","operaIconStyle","fontSize","TabsBar","props","activeKeyProp","activeKey","defaultActiveKey","onActiveTabChange","tabs","animated","useState","isOperaBoxVisible","setOperaBoxVisible","key","setActiveKey","navRef","useRef","navWrapRef","navListRef","scrollOffsetRef","lastWheelDirectionRef","inkBarRef","operaWrapRef","isMorePopoverVisible","setMorePopoverVisible","tabRefs","navWidthRef","navWrapWidthRef","navListWidthRef","activeKeyRef","current","onTabRef","useCallback","elem","updateWidth","offsetWidth","updateScrollOffset","newScroll","style","left","canScrollToLeft","classList","add","remove","useEffect","updateInk","activeTab","activeTabWrapper","parentElement","newOffset","offsetLeft","newWidth","initScrollOffset","navWrapWidth","navListWidth","currentOffset","parseFloat","startOffset","activeTabWidth","minOffset","Math","min","max","maxOffset","abs","handleResize","resizeObserver","forEach","tab","observe","disconnect","handleWheel","e","deltaX","deltaY","mixed","absX","absY","preventDefault","addEventListener","removeEventListener","moreMenuItems","useMemo","visibleStartOffset","visibleEndOffset","items","index","endOffset","prefix","title","disabled","push","selected","handleSelectMoreMenu","path","selectedKey","at","map","onClose"],"sources":["../../../../src/display/tabs/TabsBar.tsx"],"sourcesContent":["import React from 'react';\nimport styled from 'styled-components';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport { debounce } from 'lodash';\nimport { IconMore } from '../../basic/icon';\nimport { TabsBarTab } from './TabsBarTab';\nimport { useDefaultProp, COLORS } from '../../common';\nimport { Button } from '../../basic/button';\nimport { Popover } from '../popover'\nimport { Menu } from '../menu';\nimport type { IMenuItem } from '../menu/Menu';\nimport { TabsInkBar } from './styled';\nimport { TAB_MARGIN } from './constants';\nimport type { ITabPanelProps } from './TabPanel';\nimport type { ITabsProps } from './Tabs';\n\ntype ITabsBarProps = {\n  tabs: ITabPanelProps[];\n} & ITabsProps;\n\nconst TabsNav = styled.div`\n  display: flex;\n  position: relative;\n  overflow: hidden;\n  flex: none;\n  &::after {\n    content: '';\n    position: absolute;\n    height: 1px;\n    left: 0px;\n    right: 0px;\n    bottom: 0px;\n    background: rgba(126, 134, 142, 0.16);\n  }\n`;\n\nconst TabsNavWrap = styled.div`\n  position: relative;\n  display: inline-block;\n  display: flex;\n  flex: auto;\n  align-self: stretch;\n  overflow: hidden;\n  white-space: nowrap;\n  transform: translate(0);\n`;\n\nconst TabsNavList = styled.div`\n  position: relative;\n  display: flex;\n`;\n\nconst TabsNavOperationWrapper = styled.div`\n  display: flex;\n  position: relative;\n  align-items: center;\n  align-self: stretch;\n  padding-left: 10px;\n  padding-bottom: 3px;\n  background: ${COLORS.WHITE};\n  &.tabs-can-scroll-to-left::after {\n    left: -30px;\n    top: 0px;\n    bottom: 0px;\n    width: 30px;\n    content: \"\";\n    position: absolute;\n    pointer-events: none;\n    transition: opacity 0.3s ease 0s;\n    box-shadow: rgb(0 0 0 / 8%) -10px 0px 8px -8px inset;\n  }\n`;\n\nconst btnStyle: React.CSSProperties = {\n  border: 'none',\n  padding: 0,\n  height: 28,\n  width: 28,\n  display: 'flex',\n  alignItems: 'center',\n  justifyContent: 'center',\n};\n\nconst operaIconStyle: React.CSSProperties = {\n  fontSize: 20,\n};\n\nexport const TabsBar: React.FC<ITabsBarProps> = (props) => {\n  const { activeKey: activeKeyProp, defaultActiveKey, onActiveTabChange, tabs, animated } = props;\n  const [isOperaBoxVisible, setOperaBoxVisible] = React.useState(false);\n  const [activeKey, setActiveKey] = useDefaultProp(defaultActiveKey || tabs[0]?.key, activeKeyProp, onActiveTabChange);\n  const navRef = React.useRef<HTMLDivElement>(null);\n  const navWrapRef = React.useRef<HTMLDivElement>(null);\n  const navListRef = React.useRef<HTMLDivElement>(null);\n  const scrollOffsetRef = React.useRef<number>(0);\n  const lastWheelDirectionRef = React.useRef<string>('');\n  const inkBarRef = React.useRef<HTMLDivElement>(null);\n  const operaWrapRef = React.useRef<HTMLDivElement>(null);\n  const [isMorePopoverVisible, setMorePopoverVisible] = React.useState(false);\n  const tabRefs = React.useRef<Record<string, HTMLDivElement>>({});\n  const navWidthRef = React.useRef<number>(0);\n  const navWrapWidthRef = React.useRef<number>(0);\n  const navListWidthRef = React.useRef<number>(0);\n  const activeKeyRef = React.useRef(activeKey);\n  activeKeyRef.current = activeKey;\n\n  const onTabRef = React.useCallback((key: string, elem: HTMLDivElement) => {\n    tabRefs.current[key] = elem;\n  }, []);\n\n  const updateWidth = React.useCallback(() => {\n    navWidthRef.current = navRef.current?.offsetWidth || 0;\n    navListWidthRef.current = navListRef.current?.offsetWidth || 0;\n    navWrapWidthRef.current = navWrapRef.current?.offsetWidth || 0;\n  }, []);\n\n  const updateScrollOffset = React.useCallback((newScroll: number) => {\n    if (!navListRef.current) return;\n    scrollOffsetRef.current = newScroll;\n    navListRef.current.style.left = newScroll + 'px';\n    if (operaWrapRef.current) {\n      const canScrollToLeft = scrollOffsetRef.current > (navWrapWidthRef.current - navListWidthRef.current);\n      if (canScrollToLeft) {\n        operaWrapRef.current.classList.add('tabs-can-scroll-to-left');\n      } else {\n        operaWrapRef.current.classList.remove('tabs-can-scroll-to-left');\n      }\n    }\n  }, []);\n\n  React.useEffect(() => {\n    updateWidth();\n  }, []);\n\n  const updateInk = React.useCallback(() => {\n    if (!inkBarRef.current) return;\n    const activeTab = tabRefs.current[activeKeyRef.current];\n    if (!activeTab) {\n      inkBarRef.current.style.left = '0px';\n      inkBarRef.current.style.width = '0px';\n    } else {\n      const activeTabWrapper = activeTab.parentElement as HTMLDivElement;\n      const newOffset = activeTabWrapper.offsetLeft;\n      inkBarRef.current.style.left = newOffset + 'px';\n      const newWidth = tabRefs.current[activeKeyRef.current]?.offsetWidth || 0;\n      inkBarRef.current.style.width = newWidth + 'px';\n    }\n  }, []);\n\n  const initScrollOffset = React.useCallback(() => {\n    const activeTab = tabRefs.current[activeKeyRef.current];\n    if (!navListRef.current || !navWrapRef.current || !activeKeyRef.current || !activeTab) {\n      return;\n    }\n    const navWrapWidth = navWrapWidthRef.current || navWrapRef.current.offsetWidth;\n    const navListWidth = navListWidthRef.current || navListRef.current.offsetWidth;\n    const currentOffset = parseFloat(navListRef.current.style.left);\n    const activeTabWrapper = activeTab.parentElement as HTMLDivElement;\n    const startOffset = activeTabWrapper.offsetLeft;\n    const activeTabWidth = activeTab.offsetWidth || 0;\n    const minOffset = Math.min(0, Math.max(navWrapWidth - navListWidth, -startOffset));\n    let maxOffset = navWrapWidth - (startOffset + activeTabWidth + TAB_MARGIN);\n    maxOffset = Math.min(0, Math.max(navWrapWidth - navListWidth, maxOffset));\n    if (currentOffset >= minOffset && currentOffset <= maxOffset) {\n      return;\n    }\n    if (Math.abs(minOffset - currentOffset) > Math.abs(maxOffset - currentOffset)) {\n      updateScrollOffset(maxOffset);\n    } else {\n      updateScrollOffset(minOffset);\n    }\n  }, []);\n\n  React.useEffect(() => {\n    updateInk();\n    initScrollOffset();\n  }, [activeKey]);\n\n\n  React.useEffect(() => {\n    const handleResize = debounce(() => {\n      updateWidth();\n      updateInk();\n      initScrollOffset();\n      setOperaBoxVisible(navListWidthRef.current > navWidthRef.current);\n    }, 200);\n    const resizeObserver = new ResizeObserver(handleResize);\n    // tab 内容变化也需要更新 ink 和 滚动偏移量\n    tabs.forEach((tab) => {\n      const { key } = tab;\n      const elem = tabRefs.current[key];\n      elem && resizeObserver.observe(elem);\n    });\n    navRef.current && resizeObserver.observe(navRef.current);\n    navWrapRef.current && resizeObserver.observe(navWrapRef.current);\n    return () => {\n      resizeObserver.disconnect();\n    };\n  }, [tabs]);\n\n  const handleWheel = React.useCallback((e: WheelEvent) => {\n    // 滚动时收起更多菜单\n    setMorePopoverVisible(false);\n    if (!navWrapRef.current || !navListRef.current) {\n      return;\n    }\n    const navWrapWidth = navWrapWidthRef.current || navWrapRef.current.offsetWidth;\n    const navListWidth = navListWidthRef.current || navListRef.current.offsetWidth;\n    if (navWrapWidth >= navListWidth) {\n      return false;\n    }\n    const { deltaX, deltaY } = e;\n    // Convert both to x & y since wheel only happened on PC\n    let mixed: number = 0;\n    const absX = Math.abs(deltaX);\n    const absY = Math.abs(deltaY);\n    if (absX === absY) {\n      mixed = lastWheelDirectionRef.current === 'x' ? deltaX : deltaY;\n    } else if (absX > absY) {\n      mixed = deltaX;\n      lastWheelDirectionRef.current = 'x';\n    } else {\n      mixed = deltaY;\n      lastWheelDirectionRef.current = 'y';\n    }\n    const minOffset = navWrapWidth - navListWidth;\n    const maxOffset = 0;\n    const newOffset = Math.min(\n      Math.max(-mixed + scrollOffsetRef.current, minOffset),\n      maxOffset,\n    );\n    updateScrollOffset(newOffset);\n\n    e.preventDefault();\n  }, []);\n\n  React.useEffect(() => {\n    if (navWrapRef.current) {\n      navWrapRef.current.addEventListener('wheel', handleWheel);\n    }\n    return () => {\n      if (navWrapRef.current) {\n        navWrapRef.current.removeEventListener('wheel', handleWheel);\n      }\n    }\n  }, [handleWheel]);\n\n  const moreMenuItems = React.useMemo<IMenuItem[]>(() => {\n    if (!isOperaBoxVisible || !isMorePopoverVisible || !navWrapRef.current) {\n      return [];\n    }\n    const navWrapWidth = navWrapWidthRef.current || navWrapRef.current.offsetWidth;\n    const visibleStartOffset = -scrollOffsetRef.current;\n    const visibleEndOffset = visibleStartOffset + navWrapWidth;\n    const items: IMenuItem[] = [];\n    let startOffset = 0;\n    tabs.forEach((tab, index) => {\n      const width = tabRefs.current[tab.key].offsetWidth;\n      const endOffset = startOffset + width;\n      if (!(startOffset >= visibleStartOffset && endOffset <= visibleEndOffset)) {\n        const { prefix, title, disabled, key } = tabs[index];\n        items.push({\n          key,\n          title,\n          prefix,\n          disabled,\n          selected: activeKey === key,\n        });  \n      }\n      startOffset = endOffset + TAB_MARGIN;\n    });\n    return items;\n  }, [isOperaBoxVisible, isMorePopoverVisible, tabs, activeKey]);\n\n  const handleSelectMoreMenu = React.useCallback((path: Array<string>) => {\n    const selectedKey = path.at(-1);\n    selectedKey && setActiveKey(selectedKey);\n    setMorePopoverVisible(false);\n  }, []);\n\n  return (\n    <TabsNav ref={navRef} className='wdn-tabs-nav'>\n      <TabsNavWrap\n        ref={navWrapRef}\n      >\n        <TabsNavList\n          ref={navListRef}\n        >\n          {\n            tabs.map((tab) => {\n              const { key, onClose, title, disabled, prefix } = tab;\n              return (\n                <TabsBarTab\n                  key={key}\n                  tabKey={key}\n                  onClose={onClose}\n                  title={title}\n                  prefix={prefix}\n                  disabled={disabled}\n                  onClick={setActiveKey}\n                  activeKey={activeKey}\n                  onRef={onTabRef}\n                />\n              );\n            })\n          }\n          <TabsInkBar\n            ref={inkBarRef}\n            animated={animated}\n            className=\"wdn-tabs-ink-bar\"\n          />\n        </TabsNavList>\n      </TabsNavWrap>\n      {\n        isOperaBoxVisible ? (\n          <TabsNavOperationWrapper ref={operaWrapRef}>\n            <Popover\n              content={<Menu items={moreMenuItems} onSelect={handleSelectMoreMenu} />}\n              placement=\"bottomLeft\"\n              trigger=\"click\"\n              visible={isMorePopoverVisible}\n              onVisibleChange={setMorePopoverVisible}\n            >\n              <Button\n                icon={\n                  <IconMore style={operaIconStyle}/>\n                }\n                style={btnStyle}\n              />\n            </Popover>\n          </TabsNavOperationWrapper>\n        ) : null\n      }\n    </TabsNav>\n  )\n}\n"],"mappings":"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"}