{"version":3,"file":"DrawerMobile.js","names":["React","ReactDOM","mergeClassName","mergeRestProps","mergeRef","Sticker","DrawerBox","Background","HeaderBox","TitleBox","FooterBox","DEFAULT_DRAWER_MOBILE_HEIGHT","Dragger","blockEvent","DrawerMobileComp","forwardRef","props","ref","visible","onClose","content","height","mask","header","footer","touchBar","keepMounted","rest","drawerBoxRef","useRef","bgRef","rootRef","useState","isRealVisible","setRealVisible","dragger","getDrawer","current","getBg","getDraggable","getRoot","handleBgClick","e","stopPropagation","currentTarget","target","style","opacity","slideOut","handleBgTransitionEnd","event","propertyName","onBgRef","bg","addEventListener","passive","onDrawerBoxRef","drawer","enableDrag","useEffect","removeEventListener","slideIn","disableDrag","displayName","DrawerMobile","getContainer","container","document","body","createPortal"],"sources":["../../../../src/display/drawer/DrawerMobile.tsx"],"sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { mergeClassName, mergeRestProps, MergePropsType, mergeRef } from '../../common';\nimport {\n  Sticker,\n  DrawerBox,\n  Background,\n  HeaderBox,\n  TitleBox,\n  FooterBox,\n} from './styled';\nimport { DEFAULT_DRAWER_MOBILE_HEIGHT } from './constants';\nimport { Dragger } from './Dragger';\nimport { blockEvent } from './utils';\n\ntype IDrawerMobileProps = MergePropsType<{\n  /**\n   * Drawer 是否可见\n   */\n  visible: boolean;\n  /**\n   * Drawer 关闭时的回调\n   */\n  onClose: () => void;\n  /**\n   * 指定 Drawer 挂载的节点，false 为挂载到当前位置，默认挂载到 body\n   */\n  getContainer?: () => (HTMLElement | false);\n  /**\n   * 抽屉内容\n   */\n  content: React.ReactNode;\n  /**\n   * Drawer 的页头\n   */\n  header?: React.ReactNode;\n  /**\n   * Drawer 的页脚\n   */\n  footer?: React.ReactNode;\n  /**\n   * 不可见时是否保持渲染\n   */\n  keepMounted?: boolean;\n  /**\n   * 设置 Drawer 的高度, 默认值为 378\n   */\n  height?: number | string;\n  /**\n   * 是否展示遮罩\n   */\n  mask?: boolean\n  /**\n   * 是否展示拖拽杆\n   */\n  touchBar?: boolean;\n}, React.DOMAttributes<HTMLDivElement>>\n\nconst DrawerMobileComp = React.forwardRef<HTMLDivElement, Omit<IDrawerMobileProps, 'getContainer'>>((props, ref) => {\n  const {\n    visible,\n    onClose,\n    content,\n    height = DEFAULT_DRAWER_MOBILE_HEIGHT,\n    mask,\n    header,\n    footer,\n    touchBar,\n    keepMounted,\n    ...rest\n  } = props;\n  const drawerBoxRef = React.useRef<HTMLDivElement | null>(null);\n  const bgRef = React.useRef<HTMLDivElement | null>(null);\n  const rootRef = React.useRef<HTMLDivElement | null>(null);\n  const [isRealVisible, setRealVisible] = React.useState<boolean>(props.visible);\n  const dragger = React.useRef(new Dragger({\n    getDrawer: () => drawerBoxRef.current,\n    getBg: () => bgRef.current,\n    getDraggable: () => drawerBoxRef.current,\n    getRoot: () => rootRef.current,\n  }));\n\n\n  const handleBgClick = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (\n      e.currentTarget === e.target &&\n      typeof onClose === 'function' &&\n      bgRef.current!.style.opacity === '1' &&\n      isRealVisible\n    ) {\n      dragger.current.slideOut();\n    }\n  };\n\n  const handleBgTransitionEnd = (event: TransitionEvent) => {\n    if (!bgRef.current || (event.propertyName === 'opacity' && bgRef.current.style.opacity === '0')) {\n      visible && onClose && onClose();\n      setRealVisible(false);\n    }\n  };\n\n  const onBgRef = (bg: HTMLDivElement) => {\n    bgRef.current = bg;\n    if (bg) {\n      bg.addEventListener('transitionend', handleBgTransitionEnd);\n      bg.addEventListener('touchmove', blockEvent, {\n        passive: false,\n      });\n    }\n  };\n\n  const onDrawerBoxRef = (drawer: HTMLDivElement) => {\n    drawerBoxRef.current = drawer;\n    if (drawer) {\n      dragger.current.enableDrag();\n    }\n  }\n\n  React.useEffect(() => {\n    return () => {\n      bgRef.current?.removeEventListener('transitionend', handleBgTransitionEnd);\n    };\n  }, [handleBgTransitionEnd]);\n\n  React.useEffect(() => {\n    // 外部触发打开\n    if (visible && !isRealVisible) {\n      setRealVisible(true);\n    }\n    if (isRealVisible) {\n      // 外部触发关闭\n      if (!visible) {\n        dragger.current.slideOut();\n      } else {\n        dragger.current.slideIn();\n      }\n    }\n  }, [visible, isRealVisible]);\n\n  React.useEffect(() => {\n    return () => {\n      dragger.current.disableDrag();\n      bgRef.current?.removeEventListener('touchmove', blockEvent);\n    }\n  }, []);\n\n  return (keepMounted || isRealVisible) ? (\n    <Sticker ref={mergeRef(ref, rootRef)} {...mergeRestProps(rest, 'wdn-drawer-mobile')} >\n      <Background\n        ref={onBgRef}\n        isVisible={isRealVisible}\n        mask={mask}\n        onClick={handleBgClick}\n      />\n      <DrawerBox\n        style={{\n          height: height,\n        }}\n        ref={onDrawerBoxRef}\n        className=\"wdn-drawer-mobile-drawer-box\"\n      >\n        <HeaderBox\n          className={mergeClassName(touchBar ? 'wdn-drawer-mobile-show-touch-bar' : '', 'wdn-drawer-mobile-header-box')}\n        >\n          {\n            header ? (\n              <TitleBox className=\"wdn-drawer-mobile-title-box\">\n                {header}\n              </TitleBox>\n            ) : null\n          }\n        </HeaderBox>\n        <React.Fragment>{content}</React.Fragment>\n        <FooterBox className=\"wdn-drawer-mobile-footer-box\">{footer}</FooterBox>\n      </DrawerBox>\n    </Sticker>\n  ) : null;\n});\n\nDrawerMobileComp.displayName = 'DrawerMobileComp';\n\nexport const DrawerMobile = React.forwardRef<HTMLDivElement, IDrawerMobileProps>((props, ref) => {\n  const { getContainer, ...rest } = props;\n  const container = getContainer ? getContainer() : document.body;\n  return container ? (\n    ReactDOM.createPortal(<DrawerMobileComp ref={ref} {...rest} />, container)\n  ) : <DrawerMobileComp ref={ref} {...rest} />;\n});\n\nDrawerMobile.displayName = 'DrawerMobile';"],"mappings":"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"}