{"version":3,"file":"Modal.js","names":["React","useRef","useEffect","ReactDOM","ResizeObserver","Button","IconButton","ModalFooter","ModalHeader","MoadlRoot","ModalContainer","ModalMask","ModalHeaderTitle","ModalContent","IconClose","useTranslate","KEY_CODES","mergeRef","mergeRestProps","renderReactNode","Modal","memo","forwardRef","props","fRef","title","footer","header","content","visible","onConfirm","onCancel","onClose","mask","dragable","dragMove","defaultPlacement","getContainer","document","body","rest","ref","headerRef","current","aligner","createAligner","setAdditionalConstraint","constraint","dragger","createDragger","getOffset","setOffset","destroy","fn","e","keyCode","ESC","addEventListener","removeEventListener","t","createPortal","marginBottom","undefined","ele","placement","offsets","isAutoAlign","isStickingRight","isStickingBottom","placementAligner","start","end","per","s","r","match","n","parseInt","x","rx","px","prx","clientSize","winSize","Math","floor","ceil","alignX","left","right","alignY","top","bottom","size","min","max","additionConstraint","v","align","clientWidth","clientHeight","width","height","documentElement","winWidth","winHeight","ax","ay","cx","cy","tx","ty","style","transform","eleResizeObserver","observe","winResizeObserver","source","disconnect","isDragging","dragStartX","dragStartY","dragStartOffset","dx","pageX","dy","pageY","dragStart","dragEnd","attach","detach"],"sources":["../../../../src/display/modal/Modal.tsx"],"sourcesContent":["import React, { ReactNode, useRef, useEffect, DOMAttributes, ReactElement } from 'react';\nimport ReactDOM from 'react-dom';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport { Button } from '../../basic/button';\nimport { IconButton } from '../../basic/icon-button';\nimport { ModalFooter } from './ModalFooter';\nimport { ModalHeader } from './ModalHeader';\nimport { MoadlRoot, ModalContainer, ModalMask, ModalHeaderTitle, ModalContent } from './styled';\nimport { IconClose } from '../../basic/icon';\nimport { useTranslate } from '../../locale';\nimport { KEY_CODES } from '../../common/consts';\nimport { IRestProps, mergeRef, mergeRestProps, IRenderReactNode, renderReactNode } from '../../common';\n\ntype IPlacement = 'center' | Partial<{\n  left: number | string;\n  right: number | string;\n  top: number | string;\n  bottom: number | string;\n}>;\n\ntype IRect = {\n  left: number;\n  top: number;\n  width: number;\n  height: number;\n};\n\ntype IModalProps = {\n  /**\n   * 标题\n   */\n  title?: React.ReactNode;\n  /**\n   * 自定义底部\n   */\n  footer?: IRenderReactNode<void>;\n  /**\n   * 自定义顶部\n   */\n  header?: IRenderReactNode<void>;\n  /**\n   * 内容\n   */\n  content?: ReactNode;\n  /**\n   * 是否可见\n   */\n  visible: boolean;\n  /**\n   * 位置\n   */\n  defaultPlacement?: IPlacement,\n  /**\n   * 确认事件\n   */\n  onConfirm?: () => void;\n  /**\n   * 取消事件\n   */\n  onCancel?: () => void;\n  /**\n   * 关闭事件（通过关闭按钮或键盘 ESC）\n   */\n  onClose?: () => void;\n  /**\n   * 是否带有背景遮罩\n   */\n  mask?: boolean | 'transparent';\n  /**\n   * 是否可拖拽\n   */\n  dragMove?: boolean | { constraint: () => IRect };\n  /**\n   * 对话框挂载的根节点\n   */\n  getContainer?: () => HTMLElement;\n} & IRestProps & DOMAttributes<HTMLDivElement>;\n\nexport const Modal = React.memo(\n  React.forwardRef(\n    (props: IModalProps, fRef: React.ForwardedRef<HTMLDivElement>) => {\n\n      const {\n        title,\n        footer,\n        header,\n        content,\n        visible,\n        onConfirm,\n        onCancel,\n        onClose,\n        mask,\n        dragMove: dragable,\n        defaultPlacement = 'center',\n        getContainer = () => document.body,\n        ...rest\n      } = props;\n\n      const ref = useRef<HTMLDivElement>(null);\n      const headerRef = useRef<HTMLDivElement>(null);\n\n      useEffect(() => {\n        if (visible && ref.current) {\n\n          const aligner = createAligner(ref.current, defaultPlacement);\n\n          if (typeof dragable === 'object') {\n            aligner.setAdditionalConstraint(dragable.constraint);\n          }\n          const dragger = (dragable && headerRef.current) ? createDragger(headerRef.current, aligner.getOffset, aligner.setOffset) : null;\n\n          return () => {\n            aligner.destroy();\n            dragger && dragger.destroy();\n          }\n        }\n      }, [visible, !!dragable]);\n\n      useEffect(() => {\n        if (onClose) {\n          const fn = (e: KeyboardEvent) => {\n            if (e.keyCode === KEY_CODES.ESC) {\n              onClose();\n            }\n          };\n          document.addEventListener('keydown', fn);\n          return () => {\n            document.removeEventListener('keydown', fn);\n          };\n        }\n      }, [onClose]);\n\n      const t = useTranslate();\n\n      return visible ? ReactDOM.createPortal(\n        <MoadlRoot>\n          {mask ? <ModalMask isTransparent={mask === 'transparent'} /> : null}\n          <ModalContainer {...mergeRestProps(rest, 'wdn-modal')} ref={mergeRef(fRef, ref)}>\n            {\n              renderReactNode(\n                header,\n                <ModalHeader ref={headerRef}>\n                  <ModalHeaderTitle move={!!dragable}>{title}</ModalHeaderTitle>\n                  <IconButton icon={<IconClose />} onClick={onClose} style={{ marginBottom: 16 }} />\n                </ModalHeader>,\n                undefined,\n              )\n            }\n            <ModalContent>{content}</ModalContent>\n            {\n              renderReactNode(\n                footer,\n                <ModalFooter\n                  cancel={<Button onClick={onCancel}>{t('wdn_cancel')}</Button>}\n                  confirm={<Button type=\"primary\" onClick={onConfirm}>{t('wdn_ok')}</Button>}\n                />,\n                undefined,\n              )\n            }\n          </ModalContainer>\n        </MoadlRoot >,\n        getContainer()\n      ) : null;\n    })\n);\n\n\nconst createAligner = (\n  ele: HTMLDivElement,\n  placement: IPlacement\n) => {\n\n  const offsets: [number, number] = [0, 0];\n\n  let isAutoAlign = true;\n  let isStickingRight = false;\n  let isStickingBottom = false;\n\n  const placementAligner = (start?: string | number, end?: string | number) => {\n\n    const per = (s: string) => {\n      const r = s.match(/^(\\d+)%$/);\n      if (r && r[1]) {\n        const n = parseInt(r[1]);\n        if (n >= 0 && n <= 100) {\n          return n / 100;\n        }\n      }\n      return 0;\n    }\n\n    let [x, rx, px, prx]: Array<number | null> = [null, null, null, null];\n\n    if (typeof start === 'number') {\n      x = start;\n    } else if (typeof start === 'string') {\n      px = per(start);\n    } else if (typeof end === 'number') {\n      rx = end;\n    } else if (typeof end === 'string') {\n      prx = per(end);\n    } else {\n      // start is undefined, and end is undefined\n      px = 0.5;\n    }\n\n    return (clientSize: number, winSize: number): number => {\n      if (x !== null) {\n        return x;\n      } else if (rx !== null) {\n        return winSize - rx - clientSize;\n      } else if (px !== null) {\n        return Math.floor(winSize * px - clientSize / 2);\n      } else if (prx !== null) {\n        return Math.ceil(winSize - winSize * prx - clientSize / 2);\n      } else {\n        return Math.floor(winSize * 0.5 - clientSize / 2);\n      }\n    };\n  };\n\n  const alignX = placement === 'center' ? placementAligner('50%') : placementAligner(placement.left, placement.right);\n  const alignY = placement === 'center' ? placementAligner('50%') : placementAligner(placement.top, placement.bottom);\n\n  \n  /**\n   * 将线段 [start, size] 限制在区间 [min, max] 中, 返回新线段的 start。\n   */\n  const constraint = (start: number, size: number, min: number, max: number) => {\n    if (max <= min) {\n      return min;\n    }\n    if (start < min) {\n      return min;\n    }\n    if (start + size > max) {\n      return max - size;\n    }\n    return start;\n  };\n\n  let additionConstraint: (v: IRect) => [number, number] = v => [v.left, v.top];\n\n  const align = () => {\n\n    const [width, height] = [ele.clientWidth, ele.clientHeight];\n    const [winWidth, winHeight] = [document.documentElement.clientWidth, document.documentElement.clientHeight];\n\n    const ax = isAutoAlign ? alignX(width, winWidth) : isStickingRight ? winWidth - width : offsets[0];\n    const ay = isAutoAlign ? alignY(height, winHeight) : isStickingBottom ? winHeight - height : offsets[1];\n\n    const cx = constraint(ax, width, 0, winWidth);\n    const cy = constraint(ay, height, 0, winHeight);\n\n    const [tx, ty] = additionConstraint({ left: cx, width, top: cy, height });\n\n    if (tx + width >= winWidth - 1) {\n      isStickingRight = true;\n    }\n    if (ty + height >= winHeight - 1) {\n      isStickingBottom = true;\n    }\n\n    offsets[0] = tx;\n    offsets[1] = ty;\n    ele.style.transform = `translate(${tx}px, ${ty}px)`;\n  };\n\n  const eleResizeObserver = new ResizeObserver(align);\n  eleResizeObserver.observe(ele);\n\n  const winResizeObserver = new ResizeObserver(align);\n  winResizeObserver.observe(document.documentElement);\n\n  return {\n\n    getOffset: (): [number, number] => {\n      return [...offsets];\n    },\n\n    setOffset: (source: [number, number]) => {\n      isAutoAlign = false;\n      offsets[0] = source[0];\n      offsets[1] = source[1];\n      isStickingRight = false;\n      isStickingBottom = false;\n      align();\n    },\n\n    setAdditionalConstraint: (fn: () => IRect) => {\n      additionConstraint = (v: IRect) => {\n        const r = fn();\n        return [\n          constraint(v.left, v.width, r.left, r.left + r.width),\n          constraint(v.top, v.height, r.top, r.top + r.height),\n        ];\n      }\n    },\n\n    destroy: () => {\n      eleResizeObserver.disconnect();\n      winResizeObserver.disconnect();\n    }\n  };\n};\n\nconst createDragger = (\n  ele: HTMLDivElement,\n  getOffset: () => [number, number],\n  setOffset: (offsets: [number, number]) => void,\n) => {\n\n  let isDragging = false;\n\n  let dragStartX = 0;\n  let dragStartY = 0;\n  let dragStartOffset: [number, number] | null = getOffset();\n\n  const dragMove = (e: MouseEvent) => {\n    if (isDragging && dragStartOffset !== null) {\n      const dx = e.pageX - dragStartX;\n      const dy = e.pageY - dragStartY;\n      setOffset([dragStartOffset[0] + dx, dragStartOffset[1] + dy]);\n    }\n  };\n\n  const dragStart = (e: MouseEvent) => {\n    if (isDragging) {\n      return;\n    }\n    dragStartX = e.pageX;\n    dragStartY = e.pageY;\n    dragStartOffset = getOffset();\n    isDragging = true;\n\n    document.addEventListener('mousemove', dragMove);\n    document.addEventListener('mouseup', dragEnd);\n  };\n\n\n\n  const dragEnd = (e: MouseEvent) => {\n    isDragging = false;\n    dragStartOffset = null;\n    document.removeEventListener('mousemove', dragMove);\n    document.removeEventListener('mouseup', dragEnd);\n  };\n\n  const attach = () => {\n    ele.addEventListener('mousedown', dragStart);\n  };\n\n  const detach = () => {\n    ele.removeEventListener('mousedown', dragStart);\n    document.removeEventListener('mousemove', dragMove);\n    document.removeEventListener('mouseup', dragEnd);\n  };\n\n  attach();\n\n  return {\n    destroy: detach\n  }\n};\n"],"mappings":"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"}