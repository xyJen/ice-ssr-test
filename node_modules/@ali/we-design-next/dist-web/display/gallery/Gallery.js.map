{"version":3,"file":"Gallery.js","names":["React","memo","useMemo","useEffect","useState","GalleryContainer","GalleryItemWrapper","GalleryItem","GalleryBorder","GalleryItemRow","KEY_CODES","mergeRestProps","useDefaultProp","RenderEmptyItem","width","height","Gallery","props","items","columnCount","RenderItem","value","defaultValue","onChange","rest","selected","setSelected","hoveredItem","setHoveredItem","itemRows","tmp","i","length","push","slice","chooseItem","item","key","hoverItem","event","stopPropagation","preventDefault","isSelected","isHovered","getHoveredItem","findIndex","handleKeyDown","curIndex","keyCode","LEFT","UP","RIGHT","DOWN","ENTER","some","console","warn","map","row","index","data"],"sources":["../../../../src/display/gallery/Gallery.tsx"],"sourcesContent":["import React, { memo,  useMemo, ReactElement, useEffect, useState} from 'react';\nimport { GalleryContainer,GalleryItemWrapper,GalleryItem,GalleryBorder, GalleryItemRow } from './styled';\nimport { IRestProps, KEY_CODES, mergeRestProps, useDefaultProp } from '../../common';\n\n/**\n * Item 唯一标识\n */\ntype SelectedVal = string | number;\n\ntype IGalleryItem<T> = { key: SelectedVal, value: T };\n\ntype RenderItemHandler<T> = ({ data, index }: { data: IGalleryItem<T>, index: number }) => ReactElement;\nexport interface GalleryProps<T>  {\n  /**\n   * 需要渲染的列表\n   */\n  items: Array<IGalleryItem<any>>;\n\n  /**\n   * 每行显示数量\n   * @default 3\n   */\n  columnCount?: number;\n\n  /**\n   * 渲染单个元素\n   */\n  RenderItem?: RenderItemHandler<T>;\n\n  /**\n   * 受控 value \n   */\n  value?: SelectedVal;\n\n  /**\n   * 初始值 \n   */\n  defaultValue?: SelectedVal;\n\n  /**\n   * 选中回调\n   */\n  onChange?: (value: SelectedVal) => void;\n}\nconst RenderEmptyItem = () => {\n  return <div style={{width: '50px',height:'50px'}}></div>\n}\n\n\nexport const Gallery = memo(<T extends Record<string, any>>(props: IRestProps & GalleryProps<T>) => {\n  const {\n    items = [],\n    columnCount = 3,\n    RenderItem =() => <RenderEmptyItem />,\n    value,\n    defaultValue,\n    onChange,\n    ...rest\n  } = props;\n  const [selected, setSelected] = useDefaultProp<SelectedVal>(defaultValue, value, () => { });\n  const [hoveredItem, setHoveredItem] = useState<SelectedVal | undefined>();\n  const itemRows = useMemo(() => {\n    const tmp = [];\n    for (let i = 0; i < items.length; i += columnCount) {\n      tmp.push(items.slice(i, i + columnCount))\n    }\n    return tmp;\n  }, [items, columnCount]);\n  \n  const chooseItem = (item: IGalleryItem<T>) => {\n    setSelected(item.key);\n    onChange?.(item.key);\n    setHoveredItem(item.key)\n  };\n\n  const hoverItem = (event: React.KeyboardEvent, item: IGalleryItem<T>) => {\n    event.stopPropagation();\n    event.preventDefault();\n    setHoveredItem(item.key);\n  };\n\n  const isSelected = (item: IGalleryItem<T>) => {\n    return item.key === selected;\n  };\n\n  const isHovered = (item: IGalleryItem<T>) => {\n    return item.key === hoveredItem;\n  };\n\n  const getHoveredItem = ():number => {\n    return items.findIndex(item => {\n      return isHovered(item);\n    })\n  };\n  \n  const handleKeyDown = (event: React.KeyboardEvent) => {\n    if (!event) return;\n    const curIndex = getHoveredItem();\n    const keyCode = event.keyCode;\n    switch (keyCode) {\n      case KEY_CODES.LEFT:\n        if (curIndex === -1) return hoverItem(event, items[0]);\n        if (curIndex > 0) {\n          return hoverItem(event, items[curIndex - 1])\n        }\n        break;\n      case KEY_CODES.UP:\n        if (curIndex === -1) return hoverItem(event, items[0]);\n        if (curIndex - columnCount >= 0) {\n          return hoverItem(event, items[curIndex - columnCount])\n        }\n        break;\n      case KEY_CODES.RIGHT:\n        if (curIndex === -1) return hoverItem(event, items[0]);\n        if (curIndex !== items.length - 1) {\n          return hoverItem(event, items[curIndex + 1])\n        }\n        break;\n      case KEY_CODES.DOWN:\n        if (curIndex === -1) return hoverItem(event, items[0]);\n        if (curIndex + columnCount < items.length) {\n          return hoverItem(event, items[curIndex + columnCount])\n        }\n        break;\n      case KEY_CODES.ENTER:\n        if (curIndex === -1) return;\n        return chooseItem?.(items[curIndex]);\n    }\n  };\n  \n  useEffect(() => {\n    if (items.some(item => !item.key)) {\n      console.warn('every item in items should have unique key ' );\n    }\n  }, [items]);\n  \n  return (\n    <GalleryContainer\n      tabIndex={-1}\n      onKeyDown={handleKeyDown}\n      {...mergeRestProps(rest, 'wdn-gallery')}\n    >\n      {itemRows.map((row, index) => (\n        <GalleryItemRow>\n          {row.map(item => (\n            <GalleryItemWrapper\n          onClick={() => chooseItem(item)}\n          key={item.key || index}\n        >\n          <GalleryItem>\n            {RenderItem({ data: item, index })}\n          </GalleryItem>\n          <GalleryBorder\n            actived={isSelected(item)}\n            hovered={isHovered(item)}\n          />\n          </GalleryItemWrapper>\n          )) }\n        \n        </GalleryItemRow>\n          )\n      )}\n    </GalleryContainer>\n  );\n}) as <T extends Record<string,any>>(props: IRestProps & GalleryProps<T>) => ReactElement;\n"],"mappings":"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"}