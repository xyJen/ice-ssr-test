{"version":3,"file":"index.js","names":["React","useRef","useState","useMemo","useCallback","useEffect","CarouselWrapper","useForceUpdate","setValue","Math","random","TIME_6S","DEFAULT_PLAY_SPEED","Carousel","props","children","onChange","autoPlayTime","playSpeed","autoPlay","showCarouselDots","currentItemIndex","itemWidth","isHover","setIsHover","isCurrentItemIndexNumber","carouselChildrenNodes","result","Children","forEach","node","push","carouselWidth","length","flush","state","childrenNodes","currentIndex","timer","current","SetCurrentIndex","i","next","nextIndex","reSetCarouselInterval","clearInterval","window","setInterval","goTo","index","handleMouseEnter","handleMouseLeave","width","transition","transform","map","_item"],"sources":["../../../../../src/office/guidance/carousel/index.tsx"],"sourcesContent":["/* eslint-disable max-lines-per-function */\nimport React, {\n  useRef,\n  useState,\n  useMemo,\n  useCallback,\n  useEffect,\n} from 'react';\nimport { CarouselWrapper } from './style';\n\nexport interface ICarouselProps {\n  itemWidth: number;\n  currentItemIndex?: number;\n  onChange?: (i: number) => void;\n  autoPlay?: boolean;\n  autoPlayTime?: number;\n  playSpeed?: number;\n  showCarouselDots?: boolean;\n}\n\ninterface IState {\n  childrenNodes: React.ReactNode[];\n  currentIndex: number;\n  timer: number;\n}\n\nconst useForceUpdate = () => {\n  const setValue = useState(-1)[1];\n  return useCallback(() => {\n    setValue(Math.random());\n  }, [setValue]);\n};\n\nconst TIME_6S = 6 * 1000;\nconst DEFAULT_PLAY_SPEED = 0.5;\n\nexport const Carousel = (props: React.PropsWithChildren<ICarouselProps>) => {\n  const {\n    children,\n    onChange = () => {},\n    autoPlayTime = TIME_6S,\n    playSpeed = DEFAULT_PLAY_SPEED,\n    autoPlay = true,\n    showCarouselDots = true,\n    currentItemIndex,\n    itemWidth,\n  } = props;\n\n  const [isHover, setIsHover] = useState(false);\n\n  const isCurrentItemIndexNumber = typeof currentItemIndex === 'number';\n\n  // 初始化的时候生成一次子节点\n  const carouselChildrenNodes = useMemo(() => {\n    const result: React.ReactNode[] = [];\n    React.Children.forEach(children, (node) => {\n      result.push(node);\n    });\n    return result;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const carouselWidth = useMemo(\n    () => itemWidth * carouselChildrenNodes.length,\n    []\n  );\n\n  const flush = useForceUpdate();\n  // 状态\n  const state = useRef<IState>({\n    childrenNodes: carouselChildrenNodes,\n    currentIndex: 0,\n    timer: -1,\n  }).current;\n\n  const SetCurrentIndex = useCallback(\n    (i: number) => {\n      onChange(i);\n      if (isCurrentItemIndexNumber) {\n        return;\n      }\n      state.currentIndex =\n        i >= state.childrenNodes.length ? state.childrenNodes.length - 1 : i;\n      flush();\n    },\n    [flush, isCurrentItemIndexNumber, onChange, state]\n  );\n\n  const next = useCallback(() => {\n    const { childrenNodes, currentIndex } = state;\n    const nextIndex = currentIndex + 1;\n    SetCurrentIndex(nextIndex < childrenNodes.length ? nextIndex : 0);\n  }, [SetCurrentIndex, state]);\n\n  const reSetCarouselInterval = useCallback(() => {\n    if (!autoPlay) {\n      return;\n    }\n    clearInterval(state.timer);\n    state.timer = window.setInterval(() => {\n      if (isHover) {\n        return;\n      }\n      next();\n    }, autoPlayTime);\n  }, [next, state, autoPlayTime, autoPlay, isHover]);\n\n  useEffect(() => {\n    reSetCarouselInterval();\n  }, [isHover]);\n\n  useEffect(() => {\n    if (isCurrentItemIndexNumber && state.currentIndex !== currentItemIndex) {\n      reSetCarouselInterval();\n      state.currentIndex = currentItemIndex!;\n      flush();\n    }\n  }, [\n    currentItemIndex,\n    flush,\n    isCurrentItemIndexNumber,\n    reSetCarouselInterval,\n    state,\n  ]);\n\n  const goTo = useCallback(\n    (index: number) => {\n      const { childrenNodes, currentIndex } = state;\n\n      if (index < 0 || index >= childrenNodes.length) {\n        return;\n      }\n      if (currentIndex === index) {\n        return;\n      }\n      reSetCarouselInterval();\n      SetCurrentIndex(index);\n    },\n    [state, SetCurrentIndex, reSetCarouselInterval]\n  );\n\n  useEffect(() => {\n    if (autoPlay) {\n      reSetCarouselInterval();\n      return () => clearInterval(state.timer);\n    }\n    clearInterval(state.timer);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [autoPlay]);\n\n  const handleMouseEnter = useCallback(() => {\n    setIsHover(true);\n  }, []);\n  const handleMouseLeave = useCallback(() => {\n    setIsHover(false);\n  }, []);\n\n  return (\n    <CarouselWrapper\n      style={{ width: itemWidth }}\n      onMouseEnter={handleMouseEnter}\n      onMouseLeave={handleMouseLeave}\n    >\n      <ul\n        className=\"guide_carousel_list\"\n        style={{\n          width: carouselWidth + 20,\n          transition: `${playSpeed}s`,\n          transform: `translate3d(-${\n            itemWidth * state.currentIndex\n          }px, 0px, 0px)`,\n        }}\n      >\n        {state.childrenNodes.map((node, i) => (\n          <li key={i}>{node}</li>\n        ))}\n      </ul>\n      {showCarouselDots && (\n        <ul className=\"guide_carousel_dots\">\n          {state.childrenNodes.map((_item, i) => (\n            <li\n              key={i}\n              className={i === state.currentIndex ? 'carousel_dots_active' : ''}\n            >\n              <button onClick={() => goTo(i)} />\n            </li>\n          ))}\n        </ul>\n      )}\n    </CarouselWrapper>\n  );\n};\n"],"mappings":"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"}