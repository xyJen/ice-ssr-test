{"version":3,"file":"Guidance.js","names":["React","useState","useRef","useEffect","noop","ReactDOM","Button","TextSub","Modal","IconClose","IconArrowLeft","IconArrowRight","IconButton","GuidanceTitle","GuidanceFooter","Carousel","MapAnchor","align","GuidePanel","LocaleContext","useTranslate","COLORS","globalLang","ResizeObserver","MODAL_FIXED_PLACEMENT","right","bottom","MODAL_FIXED_STYLE","padding","minWidth","zIndex","background","WHITE","borderRadius","GuideModalFixed","props","guides","onAction","onCurrentChange","onClose","currentIndex","setCurrentIndex","clamp","v","min","max","onChange","i","key","next","length","prev","currentGuide","t","flexGrow","title","map","description","image","width","display","flexDirection","marginTop","alignItems","color","LIGHT","LEVEL4_BASE_COLOR","cursor","undefined","normalizePlacement","p","dir","offset","isPromise","then","MODAL_FOLLOWING_PLACEMENT","left","top","MODAL_FOLLOWING_STYLE","transform","GuideModalFollowing","isPerformNext","setIsPerformNext","anchor","placement","anchorTarget","anchorTargetIsPromise","anchorRes","Array","isArray","anchorEle","anchoreOffset","mRef","current","update","observeRef","disconnect","ele","target","requestAnimationFrame","doUpdate","getBoundingClientRect","height","place","observe","document","body","fn","handleClose","remove","guide","open","opt","container","ensureContainer","lang","c","type","rest","render","close","unmountComponentAtNode","id","divEle","querySelector","createElement","style","position","appendChild","Guidance"],"sources":["../../../../src/office/guidance/Guidance.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect, ReactNode } from 'react';\nimport { noop } from 'lodash-es';\nimport ReactDOM from 'react-dom';\nimport { Button } from '../../basic/button';\nimport { TextSub } from '../../basic/text';\nimport { Modal } from '../../display/modal';\nimport { IconClose, IconArrowLeft, IconArrowRight } from '../../basic/icon';\nimport { IconButton } from '../../basic/icon-button';\nimport { GuidanceTitle, GuidanceFooter } from './style';\nimport { Carousel } from './carousel';\nimport { MapAnchor } from './MapAnchor';\nimport { align } from '../../display/popover/align';\nimport { GuidePanel } from '../../office/guide-panel';\nimport { LocaleContext, useTranslate } from '../../locale';\nimport { COLORS } from '../../common';\nimport { globalLang } from '../../locale';\nimport ResizeObserver from 'resize-observer-polyfill';\n\nconst MODAL_FIXED_PLACEMENT = { right: 12, bottom: 48 };\nconst MODAL_FIXED_STYLE = { padding: 12, minWidth: 0, zIndex: 99998, background: COLORS.WHITE, borderRadius: 8 };\n\ntype IGuideItemFixed = {\n  key: string;\n  title: string;\n  description?: ReactNode;\n  image?: string;\n};\n\ntype IGuideModalFixedProps = {\n  guides?: Array<IGuideItemFixed>;\n  onClose?: () => void;\n  onCurrentChange?: (key: string) => void;\n  onAction?: (key: string) => void;\n};\n\nconst GuideModalFixed: React.FC<IGuideModalFixedProps> = (props) => {\n\n  const {\n    guides = [],\n    onAction,\n    onCurrentChange = noop,\n    onClose,\n  } = props;\n\n  const [currentIndex, setCurrentIndex] = useState(0);\n\n  const clamp = (v: number, min: number, max: number): number =>\n    v < min ? min : v > max ? max : v;\n\n  const onChange = (i: number) => {\n    setCurrentIndex(i);\n    onCurrentChange(guides[i].key);\n  };\n\n  const next = () => {\n    const i = clamp(currentIndex + 1, 0, guides.length - 1);\n    onChange(i);\n  };\n\n  const prev = () => {\n    const i = clamp(currentIndex - 1, 0, guides.length - 1);\n    onChange(i);\n  };\n\n  const currentGuide = guides[currentIndex];\n\n  const t = useTranslate();\n\n  return guides.length !== 0 ? (\n    <Modal\n      defaultPlacement={MODAL_FIXED_PLACEMENT}\n      style={MODAL_FIXED_STYLE}\n      header={null}\n      footer={null}\n      content={\n        <>\n          <GuidanceTitle>\n            <span style={{ flexGrow: 1 }}>{guides[currentIndex].title}</span>\n            <IconButton className='wdn-close-btn' icon={<IconClose />} onClick={onClose} />\n          </GuidanceTitle>\n          <Carousel\n            itemWidth={256}\n            currentItemIndex={currentIndex}\n            onChange={onChange}\n            autoPlay={true}\n            autoPlayTime={8000}\n            showCarouselDots={false}\n          >\n            {guides.map(({ description, image, key }) => (\n              <GuidePanel\n                key={key}\n                style={{ width: 256, padding: 0 }}\n                description={description}\n                image={image}\n              />\n            ))}\n          </Carousel>\n          <div style={{ display: 'flex', flexDirection: 'row', marginTop: 10, alignItems: 'center' }}>\n            {\n              guides.length > 1 ?\n                <>\n                  <IconArrowLeft\n                    onClick={prev}\n                    style={currentIndex === 0 ? { color: COLORS.LIGHT.LEVEL4_BASE_COLOR, cursor: 'disabled' } : undefined}\n                  />\n                  <TextSub style={{ padding: '0 2px' }}>\n                    {currentIndex + 1}/{guides.length}\n                  </TextSub>\n                  <IconArrowRight\n                    onClick={next}\n                    style={currentIndex === guides.length - 1 ? { color: COLORS.LIGHT.LEVEL4_BASE_COLOR, cursor: 'disabled' } : undefined}\n                  />\n                </> :\n                null\n            }\n            <div style={{ flexGrow: 1 }}></div>\n            <Button type='primary' size='small' onClick={() => onAction && onAction(currentGuide.key)}>{t('wdn_guidance_action')}</Button>\n          </div>\n        </>\n      }\n      visible\n    />\n  ) : null;\n};\n\ntype Dir = 'top' | 'bottom' | 'left' | 'right';\n\ntype AnchorTarget = HTMLElement | [HTMLElement, [number, number]];\n\ntype IGuideItemFollowing = {\n  key: string;\n  title: string;\n  description?: ReactNode;\n  image?: string;\n  anchor: () => AnchorTarget | Promise<AnchorTarget>;\n  placement?: Dir | [Dir, number] | [Dir, [number, number]];\n};\n\nconst normalizePlacement = (p: IGuideItemFollowing['placement']): [Dir, [number, number]] => {\n  if (p === undefined) {\n    return ['bottom', [0, 0]];\n  }\n  if (typeof p === 'string') {\n    return [p, [0, 0]];\n  }\n\n  const [dir, offset] = p;\n  if (typeof offset === 'number') {\n    return [dir, [offset, 0]];\n  } else {\n    return [dir, offset];\n  }\n};\n\ntype IGuidanceModalFollowingProps = {\n  guides?: Array<IGuideItemFollowing>;\n  onClose?: () => void;\n  onCurrentChange?: (current: number) => void;\n};\n\nconst isPromise = (p: any): p is Promise<any> => 'then' in p && typeof p.then === 'function';\n\nconst MODAL_FOLLOWING_PLACEMENT = { left: 0, top: 0 };\nconst MODAL_FOLLOWING_STYLE = { transform: 'none', left: -9999, top: -9999, padding: 0, minWidth: 0, zIndex: 99998, background: COLORS.WHITE, borderRadius: 8 };\n\nconst GuideModalFollowing: React.FC<IGuidanceModalFollowingProps> = (props) => {\n\n  const [currentIndex, setCurrentIndex] = useState(0);\n\n  const {\n    guides = [],\n    onCurrentChange = noop,\n    onClose,\n  } = props;\n\n  const clamp = (v: number, min: number, max: number): number =>\n    v < min ? min : v > max ? max : v;\n\n  const [isPerformNext, setIsPerformNext] = useState<boolean>(false);\n\n  const next = async () => {\n\n    const i = clamp(currentIndex + 1, 0, guides.length - 1);\n    const { anchor, placement } = guides[i];\n\n    const [dir, offset] = normalizePlacement(placement);\n\n    const anchorTarget = anchor();\n    const anchorTargetIsPromise = isPromise(anchorTarget);\n    if (anchorTargetIsPromise) {\n      setIsPerformNext(true);\n    }\n    const anchorRes = anchorTargetIsPromise ? await anchorTarget : anchorTarget;\n    const [anchorEle, anchoreOffset] = Array.isArray(anchorRes) ? anchorRes : [anchorRes, [0, 0] as [number, number]];\n\n    if (anchorEle) {\n      setCurrentIndex(i);\n      setIsPerformNext(false);\n      onCurrentChange(i);\n      if (mRef.current) {\n        update(mRef.current, anchorEle, dir, offset, anchoreOffset);\n      }\n    }\n  };\n\n  const observeRef = useRef<ResizeObserver | false>(false);\n  useEffect(() => {\n    return () => {\n      observeRef.current && observeRef.current.disconnect();\n    }\n  }, []);\n\n  const update = (ele: HTMLElement, target: HTMLElement, placement: Dir, offset: [number, number], anchoreOffset: [number, number]) => {\n    requestAnimationFrame(() => {\n\n      const doUpdate = () => {\n        align(ele, target, placement, [5 + offset[0], offset[1]]);\n        const { left, top, width, height } = target.getBoundingClientRect();\n        MapAnchor.place(left + width / 2 + anchoreOffset[0], top + height / 2 + anchoreOffset[1]);\n      }\n\n      observeRef.current && observeRef.current.disconnect();\n      observeRef.current = new ResizeObserver(doUpdate);\n      observeRef.current.observe(document.body);\n\n      doUpdate();\n    });\n  };\n\n  useEffect(() => {\n    if (mRef.current && currentIndex === 0) {\n      const fn = async () => {\n        const { anchor, placement } = guides[0];\n        const [dir, offset] = normalizePlacement(placement);\n        const anchorTarget = anchor();\n        const anchorRes = isPromise(anchorTarget) ? await anchorTarget : anchorTarget;\n        const [anchorEle, anchoreOffset] = Array.isArray(anchorRes) ? anchorRes : [anchorRes, [0, 0] as [number, number]];\n        if (mRef.current) {\n          update(mRef.current, anchorEle, dir, offset, anchoreOffset);\n        }\n      }\n      fn();\n    }\n  }, []);\n\n  const handleClose = () => {\n    MapAnchor.remove();\n    onClose && onClose();\n  };\n\n  const mRef = useRef<HTMLDivElement>(null);\n\n  const guide = guides[currentIndex];\n\n  const t = useTranslate();\n\n  return (guides.length !== 0 && guide) ? (\n    <Modal\n      ref={mRef}\n      defaultPlacement={MODAL_FOLLOWING_PLACEMENT}\n      header={null}\n      style={MODAL_FOLLOWING_STYLE}\n      content={\n        <>\n          <GuidePanel\n            title={guide.title}\n            description={guide.description}\n            image={guide.image}\n            style={{ width: 200 }}\n          />\n          <GuidanceFooter>\n            {\n              currentIndex !== guides.length - 1 ?\n                <TextSub onClick={handleClose}>{`${t('wdn_skip')} (${currentIndex + 1}/${guides.length})`}</TextSub> :\n                null\n            }\n            <div style={{ flexGrow: 1 }}></div>\n            {\n              currentIndex === guides.length - 1 ?\n                <Button type='primary' size='small' onClick={handleClose}>{t('wdn_isee')}</Button> :\n                <Button type='primary' size='small' disabled={isPerformNext} onClick={next}>{t('wdn_next_step')}</Button>\n            }\n          </GuidanceFooter>\n        </>\n      }\n      footer={null}\n      visible\n    />\n  ) : null;\n};\n\n\ntype IGuidanceOptions = ({ type: 'fixed' } & IGuideModalFixedProps) | ({ type: 'following' } & IGuidanceModalFollowingProps);\n\nconst open = (opt: IGuidanceOptions) => {\n  const container = ensureContainer();\n\n  const fn = globalLang.lang ? ((c: React.ReactElement) => <LocaleContext.Provider value={globalLang.lang!} children={c} />) : (c: React.ReactElement) => c;\n\n  if (opt.type === 'fixed') {\n\n    const {\n      type,\n      onClose,\n      ...rest\n    } = opt;\n\n    ReactDOM.render(fn(<GuideModalFixed\n      {...rest}\n      onClose={() => {\n        close();\n        opt.onClose && opt.onClose();\n      }}\n    />), container);\n\n  } else if (opt.type === 'following') {\n\n    const { type, onClose, ...rest } = opt;\n\n    ReactDOM.render(\n      fn(\n        <GuideModalFollowing\n          {...rest}\n          onClose={() => {\n            close();\n            opt.onClose && opt.onClose();\n          }}\n        />\n      ),\n      container,\n    );\n  }\n\n  return { container };\n};\n\nconst close = () => {\n  ReactDOM.unmountComponentAtNode(ensureContainer());\n};\n\nconst ensureContainer = (): HTMLDivElement => {\n\n  const id = 'wdn-guidance-root';\n\n  const divEle = document.querySelector(`div#${id}`);\n\n  if (!divEle) {\n    const ele = document.createElement('div');\n    ele.id = id;\n    ele.style.position = 'absolute';\n    ele.style.width = '100%';\n    ele.style.top = '0px';\n    ele.style.left = '0px';\n    document.body.appendChild(ele);\n  };\n\n  return document.querySelector(`div#${id}`)!;\n};\n\nexport const Guidance = { open, close };\n"],"mappings":"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"}