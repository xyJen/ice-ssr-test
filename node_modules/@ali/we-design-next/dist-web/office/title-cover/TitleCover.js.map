{"version":3,"file":"TitleCover.js","names":["React","useEffect","useImperativeHandle","useRef","useState","useTranslate","mergeRestProps","useEventCallback","Cover","RepositionTips","TitleCoverWrapper","getSafePosition","DEFAULT_POSITION","TitleCover","memo","forwardRef","props","ref","cover","renderError","rest","src","thumbSrc","transform","getCover","dataPosition","offsetY","position","setPosition","imageRef","isReposition","setIsReposition","onChangeFnsRef","onChange","fn","current","push","i","indexOf","splice","setRenderPosition","renderP","startReposition","endReposition","getImageRef","safePosition","t","style","cursor"],"sources":["../../../../src/office/title-cover/TitleCover.tsx"],"sourcesContent":["import React, {\n  DOMAttributes,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n} from 'react';\nimport { useTranslate } from \"../../locale\";\nimport { IRestProps, mergeRestProps } from '../../common/react/mergeRestProps';\nimport { useEventCallback } from '../../common';\nimport { Cover } from './components/cover';\nimport { RepositionTips, TitleCoverWrapper } from './style';\nimport { getSafePosition } from './utils';\nimport { DEFAULT_POSITION } from './constants';\n\nexport type Cover = {\n  /**\n   * 封面图片地址\n   */\n  src: string;\n  /**\n   * 封面缩略图地址\n   */\n  thumbSrc?: string;\n  /**\n   * 偏移量（目前仅支持垂直方向）\n   * 相对垂直方向位置，参考 CSS 属性 object-position\n   * 默认居中（0.5），取值范围 [0, 1]\n   */\n  transform?: {\n    offsetY?: number;\n  };\n};\n\ntype IChangeOption = {\n  isReposition: boolean;\n  position: number;\n};\n\nexport type TitleCoverProps = {\n  cover: Cover;\n  /**\n   * 图片加载失败占位\n   */\n  renderError?: () => React.ReactNode;\n} & IRestProps & DOMAttributes<HTMLDivElement>;\n\ntype TitleCoverHandlers = {\n  onChange: (fn: (option: IChangeOption) => void) => () => void,\n  startReposition: () => void;\n  endReposition: () => void;\n  setRenderPosition: (p: number) => void;\n  getImageRef: () => React.RefObject<HTMLImageElement>;\n  getCover: () => Cover;\n};\n\nexport const TitleCover = React.memo(\n  React.forwardRef<TitleCoverHandlers, TitleCoverProps>(\n    (props, ref) => {\n      const {\n        cover,\n        renderError,\n        ...rest\n      } = props;\n      const {\n        src,\n        thumbSrc,\n        transform = {},\n      } = cover;\n\n      const getCover = useEventCallback(() => cover);\n\n      const { offsetY: dataPosition } = transform;\n\n      const [position, setPosition] = useState<number>(DEFAULT_POSITION);\n      const imageRef = useRef<HTMLImageElement>(null);\n      const [isReposition, setIsReposition] = useState(false);\n      const onChangeFnsRef = useRef<Array<(option: IChangeOption) => void>>([]);\n\n      useImperativeHandle(ref, () => ({\n        onChange: (fn: (option: IChangeOption) => void) => {\n          onChangeFnsRef.current.push(fn);\n          return () => {\n            const i = onChangeFnsRef.current.indexOf(fn);\n            if (i !== -1) {\n              onChangeFnsRef.current.splice(i, 1);\n            }\n          }\n        },\n        setRenderPosition: (renderP) => {\n          setPosition(renderP);\n        },\n        startReposition: () => {\n          setIsReposition(true);\n        },\n        endReposition: () => {\n          setIsReposition(false);\n        },\n        getImageRef: () => imageRef,\n        getCover,\n      }));\n\n      useEffect(() => {\n        setPosition(getSafePosition(dataPosition));\n      }, [dataPosition]);\n\n      useEffect(() => {\n        for (const fn of onChangeFnsRef.current) {\n          fn({\n            isReposition,\n            position,\n          });\n        }\n      }, [isReposition, position]);\n\n      const safePosition = getSafePosition(position);\n\n      const t = useTranslate();\n\n      const style = { cursor: isReposition ? \"move\" : \"auto\" };\n\n      return (\n        <TitleCoverWrapper\n          {...mergeRestProps(rest, 'wdn-title-cover', style)}\n        >\n          <Cover\n            ref={imageRef}\n            src={src}\n            thumbSrc={thumbSrc}\n            position={safePosition}\n            renderError={renderError}\n          />\n          <RepositionTips visible={isReposition}>\n            {t(\"wdn_title_cover_drag_reposition\")}\n          </RepositionTips>\n        </TitleCoverWrapper>\n      );\n    }\n  )\n);\n"],"mappings":"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"}