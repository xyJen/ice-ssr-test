{"version":3,"file":"AvatarCollaborators.js","names":["React","Popover","AvatarCollaboratorsWrap","GroupAvatarItem","GroupAvatarList","GroupMoreItem","GroupMoreItemSpan","OverlayWrap","CountWrap","mergeClassName","mergeRestProps","AvatarWithPopover","AvatarMoreList","COLOR_SCHEME","COLOR_SCHEME_LEN","DEFAULT_MAX_COLLABORATOR","useTranslate","PLACEMENT_OFFSET","AvatarCollaborators","memo","props","collaborators","items","max","onClick","isMoreButtonHighlight","highlight","customMorePanelTitle","renderMenu","renderCollaboratorMenu","rest","useState","visibleAvatarIndex","setVisibleAvatarIndex","avatarCount","length","isOverflowing","t","sortedItems","useMemo","map","item","index","sort","a","b","aValue","bValue","slice","idx","key","undefined","color","visible","v","value","Number"],"sources":["../../../../src/collaboration/collaborator-avatars/AvatarCollaborators.tsx"],"sourcesContent":["/* eslint-disable max-lines-per-function */\nimport React from 'react';\nimport { Popover } from '../../display/popover';\nimport {\n  AvatarCollaboratorsWrap,\n  GroupAvatarItem,\n  GroupAvatarList,\n  GroupMoreItem,\n  GroupMoreItemSpan,\n  OverlayWrap,\n  CountWrap,\n} from './styled';\nimport { mergeClassName, MergePropsType, mergeRestProps } from '../../common';\nimport { IAvatarCollaborator, AvatarWithPopover } from './AvatarWithPopover';\nimport { AvatarMoreList } from './AvatarMoreList';\nimport { COLOR_SCHEME, COLOR_SCHEME_LEN, DEFAULT_MAX_COLLABORATOR } from './constants';\nimport { useTranslate } from '../../locale';\n\nexport type IAvatarCollaboratorsProps = MergePropsType<{\n  /**\n   * 显示区最多显示多少个,  默认为 8\n   */\n  max?: number;\n  /**\n   *  点击头像组中头像（或 dropdown 列表中选项）的回调函数\n   *  idx 为头像组中点击的头像的序号 (0-based)\n   */\n  onClick?: (key: string) => void;\n  /**\n   * 用户列表\n   */\n  collaborators?: IAvatarCollaborator[];\n  /**\n   * 协作者头像面板中的菜单\n   */\n  renderCollaboratorMenu?: (c: IAvatarCollaborator) => React.ReactElement;\n  /**\n   * 更多用户按钮出现时，其是否高亮\n   */\n  highlight?: boolean;\n  /**\n   * 菜单顶部\n   */\n  renderMenu?: () => React.ReactNode;\n}, React.HTMLAttributes<HTMLDivElement>>;\n\nconst PLACEMENT_OFFSET: [number, number] = [4, 0];\n\nexport const AvatarCollaborators: React.FC<IAvatarCollaboratorsProps> = React.memo((props) => {\n  const {\n    collaborators: items = [],\n    max = DEFAULT_MAX_COLLABORATOR,\n    onClick,\n    highlight: isMoreButtonHighlight,\n    renderMenu: customMorePanelTitle,\n    renderCollaboratorMenu,\n    ...rest\n  } = props;\n\n  const [visibleAvatarIndex, setVisibleAvatarIndex] = React.useState<number | 'more'>(-1);\n\n  // 数量\n  const avatarCount = items.length;\n  const isOverflowing = avatarCount > max!;\n  const t = useTranslate();\n\n  const sortedItems = React.useMemo(() => {\n    return items.map((item, index) => ({\n      ...item,\n      index,\n    })).sort((a, b) => {\n      const aValue = a.highlight ? 0 : 1;\n      const bValue = b.highlight ? 0 : 1;\n      return aValue - bValue;\n    });\n  }, [items]);\n\n  return (\n    <AvatarCollaboratorsWrap {...mergeRestProps(rest, 'wdn-collaborator-avatars')}>\n      <GroupAvatarList>\n        {sortedItems\n          .slice(0, isOverflowing ? max - 1 : max)\n          .map((item) => {\n            const { index: idx, key } = item;\n            return (\n              <GroupAvatarItem\n                className=\"avatar-item\"\n                key={key}\n              >\n                <AvatarWithPopover\n                  {...item}\n                  renderMenu={renderCollaboratorMenu ? (() => renderCollaboratorMenu(item)) : undefined}\n                  color={item.color || COLOR_SCHEME[idx % COLOR_SCHEME_LEN]}\n                  onClick={() => onClick?.(item.key)}\n                  isPopoverVisible={visibleAvatarIndex === idx}\n                  onPopoverVisibleChange={(visible: boolean) => {\n                    if (visible) {\n                      setVisibleAvatarIndex(idx)\n                    } else {\n                      setVisibleAvatarIndex((visibleAvatarIndex) => {\n                        return visibleAvatarIndex === idx ? -1 : visibleAvatarIndex\n                      });\n                    }\n                  }}\n                />\n              </GroupAvatarItem>\n            );\n          })}\n        {isOverflowing && (\n          <GroupAvatarItem>\n            <Popover\n              animation\n              onVisibleChange={v => {\n                if (v) {\n                  setVisibleAvatarIndex('more');\n                } else if (visibleAvatarIndex === 'more') {\n                  setVisibleAvatarIndex(-1);\n                }\n              }}\n              visible={visibleAvatarIndex === 'more'}\n              trigger=\"click\"\n              placement=\"bottomRight\"\n              placementOffset={PLACEMENT_OFFSET}\n              content={\n                <OverlayWrap>\n                  <CountWrap>\n                    {\n                      !!customMorePanelTitle\n                        ? customMorePanelTitle()\n                        : t('wdn_avatar_group_total-collab-people', {\n                          value: avatarCount,\n                        })\n                    }\n                  </CountWrap>\n                  <AvatarMoreList items={sortedItems} onClick={onClick} />\n                </OverlayWrap>\n              }\n            >\n              <GroupMoreItem className={mergeClassName(visibleAvatarIndex === 'more' ? 'wdn-more-box-active' : '', isMoreButtonHighlight ? 'wdn-more-btn-highlight' : '')}>\n                {\n                  Number(avatarCount) < 999 ? (\n                    <GroupMoreItemSpan>{`${avatarCount}`}</GroupMoreItemSpan>\n                  ) : (\n                    <>\n                      <i /><i /><i />\n                    </>\n                  )\n                }\n              </GroupMoreItem>\n            </Popover>\n          </GroupAvatarItem>\n        )}\n      </GroupAvatarList>\n    </AvatarCollaboratorsWrap>\n  );\n});\n\n"],"mappings":"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"}