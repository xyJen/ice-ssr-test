{"version":3,"file":"MemberItem.js","names":["React","useState","useRef","useEffect","styled","useTranslate","COLORS","CSS_BORDER_BOX","LAST_CHAR_NUM","MiddleEllipsisText","props","isTextOverflow","setTextOverflow","subTitleRf","divideIndex","setDivideIndex","text","current","rect","getBoundingClientRect","containerWidth","width","textWidth","scrollWidth","lastLen","Math","min","length","diIndex","preText","slice","nextText","MemberItemName","memo","name","indexOf","arr","split","map","v","ret","bold","titleArr","reduce","pre","cur","concat","color","COMMON","LINK_COLOR","e","replace","MentionItemInner","avatar","description","descriptionText","outside","department","MentionItemInnerWrapper","div","MentionItem","index","data","style","t","item","items","handleMouseEnter","onMouseEnter","handleClick","onClick","stopPropagation","active","MemberItemWrapper","OTHERS","DAO_HOVER_BG_COLOR","SubTitleWrapper"],"sources":["../../../../../src/collaboration/mention/items/MemberItem.tsx"],"sourcesContent":["import React, { useState, useRef, useMemo, useEffect } from 'react';\nimport styled from 'styled-components';\nimport { useTranslate } from '../../../locale';\nimport { COLORS, CSS_BORDER_BOX } from '../../../common';\n\nexport type IMember = {\n  avatar?: string;\n  name: string;\n  description?: string | { department: string, outside?: boolean };\n};\n\nexport type IMentionItemPropsData = {\n  items: IMember[];\n  active: number;\n  onMouseEnter: (i: number) => void;\n  onClick: (i: number) => void;\n};\n\n\ntype IMentionItemProps = {\n  index: number;\n  style: React.CSSProperties;\n  data: IMentionItemPropsData;\n};\n\ninterface IMiddleEllipsisTextProps {\n  text: string;\n}\nconst LAST_CHAR_NUM = 8;\nconst MiddleEllipsisText: React.FC<IMiddleEllipsisTextProps> = (\n  props: IMiddleEllipsisTextProps,\n) => {\n  const [isTextOverflow, setTextOverflow] = useState<Boolean>(false);\n\n  const subTitleRf = useRef<HTMLDivElement>(null);\n  const [divideIndex, setDivideIndex] = React.useState<number>(0);\n  const { text } = props;\n\n  useEffect(() => {\n    if (subTitleRf.current) {\n      const rect = subTitleRf.current.getBoundingClientRect();\n      const containerWidth = rect.width;\n      const textWidth = subTitleRf.current.scrollWidth;\n      if (containerWidth > 0 && textWidth > containerWidth) {\n        setTextOverflow(true);\n        // 一行展示不下时，中间省略，截取最后X个字符最后显示\n        const lastLen = Math.min(text?.length, LAST_CHAR_NUM);\n        const diIndex = text?.length - lastLen;\n        setDivideIndex(diIndex);\n      }\n    }\n  }, [text]);\n\n  if (!text) return null;\n  const preText = text?.slice(0, divideIndex);\n  const nextText = text?.slice(divideIndex);\n\n  return (\n    <SubTitleWrapper ref={subTitleRf}>\n      {isTextOverflow\n        ? (\n          <>\n            <p>{preText}</p>\n            <p>{nextText}</p>\n          </>\n        )\n        : (\n          <span>{text}</span>\n        )}\n    </SubTitleWrapper>\n  );\n};\n\nconst MemberItemName = React.memo(\n  (props: { name: string }) => {\n\n    const { name } = props;\n\n    if (name.indexOf('<red>') === -1 || name.indexOf('</red>') === -1) {\n      return <span>{name}</span>;\n    }\n\n    try {\n      const arr = name.split(/<red>/g).map((v) => {\n        const ret = v.split(/<\\/red>/);\n        if (ret.length > 1) {\n          return [[ret[0], { bold: true }], [ret[1]]];\n        }\n        return [[ret[0]]];\n      });\n\n      const titleArr = arr.reduce((pre, cur) => pre.concat(cur), []);\n      return (\n        <span>\n          {titleArr.map((v) => {\n            if (v[1] && v[1].bold) {\n              return <span style={{ color: COLORS.COMMON.LINK_COLOR }}>{v[0]}</span>;\n            }\n            return v[0];\n          })}\n        </span>\n      );\n    } catch (e) {\n      return <span>{name.replace(/(<red>|<\\/red>)/g, '')}</span>;\n    }\n  }\n);\n\nconst MentionItemInner = React.memo(\n  (props: IMember) => {\n    const { avatar, name, description } = props;\n\n    const descriptionText = !description ? '' : typeof description === 'string' ? description : description.outside ? '组织外' : description.department;\n\n    return (\n      <MentionItemInnerWrapper>\n        <div>{avatar ? <img src={avatar} /> : <span>{name.replace(/(<red>|<\\/red>)/g, '')}</span>}</div>\n        <div>\n          <div>\n            <MemberItemName name={name} />\n            {/* {<span className=\"sub-title\">(descriptionText)</span>} */}\n          </div>\n          <span>{descriptionText}</span>\n          {/* {extension?.needEllipsisText ? <MiddleEllipsisText text={desc} /> : <span>{desc}</span>} */}\n        </div>\n        {/* {extension?.date && (\n          <div>\n            <span>{extension.date}</span>\n          </div>\n        )} */}\n      </MentionItemInnerWrapper>\n    );\n  },\n);\n\nconst MentionItemInnerWrapper = styled.div`\n  display: flex;\n  cursor: pointer;\n  width: 100%;\n  overflow: hidden;\n  & > div {\n    &:first-child {\n      width: 36px;\n      display: flex;\n      align-items: center;\n\n      img {\n        width: 28px;\n        height: 28px;\n        border-radius: 4px;\n      }\n\n      span {\n        width: 28px;\n        height: 28px;\n        line-height: 26px;\n        border-radius: 4px;\n        overflow: hidden;\n        color: rgb(255, 255, 255);\n        padding: 2px;\n        font-size: 12px;\n        text-align: center;\n        background-color: rgb(0, 137, 255);\n      }\n    }\n\n    &:nth-child(2) {\n      flex: 1;\n      overflow: hidden;\n\n      & > div:first-child {\n        height: 20px;\n        line-height: 20px;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        font-family: sans-serif;\n\n        & > span {\n          color: #191f25;\n          &:first-child {\n            font-size: 14px;\n            line-height: 20px;\n          }\n\n          &.sub-title {\n            display: inline-block;\n            font-size: 12px;\n            margin-left: 2px;\n          }\n        }\n\n        &:only-child {\n          height: 38px;\n          line-height: 38px;\n        }\n      }\n\n      & > span {\n        display: block;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        &:last-child {\n          font-size: 12px;\n          line-height: 17px;\n          color: rgba(17, 31, 44, 0.4);\n        }\n      }\n    }\n\n    &:last-child {\n      // font-family: helvetica;\n      display: flex;\n      flex-direction: column;\n      justify-content: flex-end;\n      font-size: 12px;\n      line-height: 15px;\n      color: rgba(17, 31, 44, 0.4);\n    }\n  }\n`;\n\n\n\nexport const MentionItem: React.FC<IMentionItemProps> = React.memo((props: IMentionItemProps) => {\n\n  const {\n    index,\n    data,\n    style,\n  } = props;\n\n  const t = useTranslate();\n\n  const item = data.items[index];\n\n  const handleMouseEnter = () => data.onMouseEnter(index);\n\n  const handleClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    data.onClick(index);\n    e.stopPropagation();\n  };\n\n  return (\n    <MemberItemWrapper\n      key={`${index}`}\n      style={style}\n      active={data.active === index}\n      onMouseEnter={handleMouseEnter}\n      onClick={handleClick}\n    >\n      <MentionItemInner\n        avatar={item.avatar}\n        name={item.name}\n        description={item.description}\n      />\n    </MemberItemWrapper>\n  );\n});\n\nconst MemberItemWrapper = styled.div<{ active: boolean; }>`\n  ${CSS_BORDER_BOX}\n  display: flex;\n  padding: 8px 6px;\n  border-radius: 4px;\n  ${({ active }) => active && `background: ${COLORS.OTHERS.DAO_HOVER_BG_COLOR};`};\n`;\n\nconst SubTitleWrapper = styled.div`\n  display: flex;\n  flex-direction: row;\n  width: fit-content;\n  max-width: 100%;\n\n  & > span,\n  & > p {\n    font-size: 12px;\n    color: rgba(17, 31, 44, 0.4);\n    line-height: 17px;\n  }\n\n  & > span {\n    &:only-child {\n      white-space: nowrap;\n      width: fit-content;\n    }\n  }\n\n  & > p {\n    margin: 0;\n    &:first-child {\n      flex: 1;\n      display: block;\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n\n    &:last-child {\n      width: fit-content;\n    }\n  }\n`;"],"mappings":"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"}