{"version":3,"file":"useDefaultProp.js","names":["useState","useEventCallback","noop","identity","e","useDefaultProp","defaultProp","prop","onChangeProp","eventToValue","state","setState","changeProp","o","args","undefined","push","changeState"],"sources":["../../../../src/common/react/useDefaultProp.ts"],"sourcesContent":["/**\n * 自定义 React Hook useDefaultProps(defaultValue, value, onChange)\n * 用于处理表单类组件中 defaultValue，value 和 onChange 的「三件套」属性\n * \n * 关于类型推断：\n *  1. 如果 defaultProp 和 prop 都可能是 undefined，那么 value 就可能是 undefined\n *  2. 如果 defaultProp 和 prop 至少有一个一定不是 undefined，那么 value 就一定不是 undefined\n * \n * 可参考 useDefaultProp-dev.stories.tsx\n */\nimport { useState } from 'react';\nimport { useEventCallback } from './useEventCallback';\n\ntype NU<T> = undefined extends T ? never : T;\n\ntype UseDefaultProp = {\n\n  <T, O = void>(\n    defaultProp: NU<T>,\n    prop: NU<T> | undefined,\n    onChangeProp: ((v: NU<T>) => void) | undefined,\n  ): [NU<T>, (v: NU<T>) => void];\n\n  <T, R, O = void>(\n    defaultProp: NU<T>,\n    prop: NU<T> | undefined,\n    onChangeProp: ((v: R, o: O) => void) | undefined,\n    eventToValue: (e: R) => NU<T>\n  ): [NU<T>, (v: R, o: O) => void];\n\n  <T, O = void>(\n    defaultProp: NU<T> | undefined,\n    prop: NU<T>,\n    onChangeProp: ((v: NU<T>, o: O) => void) | undefined,\n  ): [NU<T>, (v: NU<T>, o: O) => void];\n\n  <T, R, O = void>(\n    defaultProp: NU<T> | undefined,\n    prop: NU<T>,\n    onChangeProp: ((v: R, o: O) => void) | undefined,\n    eventToValue: (e: R) => NU<T>\n  ): [NU<T>, (v: R, o: O) => void];\n\n  <T, O = void>(\n    defaultProp: NU<T> | undefined,\n    prop: NU<T> | undefined | null,\n    onChangeProp: ((v: NU<T> | null, o: O) => void) | undefined,\n  ): [NU<T> | undefined, (v: NU<T> | undefined, o: O) => void];\n\n  <T, R, O = void>(\n    defaultProp: NU<T> | undefined,\n    prop: NU<T> | undefined | null,\n    onChangeProp: ((v: R | null, o: O) => void) | undefined,\n    eventToValue: (e: R) => NU<T>\n  ): [NU<T> | undefined, (v: R | undefined, o: O) => void];\n\n}\n\nconst noop = () => { };\n\nconst identity = (e: any) => e;\n\nexport const useDefaultProp: UseDefaultProp =\n  (<T, O, R>(\n    defaultProp: T | undefined,\n    prop: T | undefined | null,\n    onChangeProp: ((v: R | null, o?: O) => void) | undefined = noop,\n    eventToValue: (e: R) => T = identity\n  ): [T | undefined, (v: R | undefined, o: O) => void] => {\n\n    const [state, setState] = useState<T | undefined>(defaultProp);\n\n    const changeProp = useEventCallback(\n      (e: R | undefined, o: O) => {\n\n        const args: [R | null, O?] = [e === undefined ? null : e];\n\n        if (prop !== args[0]) {\n          if (o !== undefined) {\n            args.push(o);\n          }\n          onChangeProp(...args);\n        }\n      }\n    )\n\n    const changeState = useEventCallback(\n      (e: R | undefined, o: O) => {\n        if (state !== e) {\n          setState(e === undefined ? undefined : eventToValue(e));\n          changeProp(e, o);\n        }\n      }\n    );\n\n    if (prop !== undefined) {\n      return [prop === null ? undefined : prop, changeProp];\n    } else {\n      return [state, changeState];\n    }\n  }) as any;\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASA,QAAQ,QAAQ,OAAO;AAChC,SAASC,gBAAgB;AA+CzB,IAAMC,IAAI,GAAG,SAAPA,IAAI,GAAS,CAAE,CAAC;AAEtB,IAAMC,QAAQ,GAAG,SAAXA,QAAQ,CAAIC,CAAM;EAAA,OAAKA,CAAC;AAAA;AAE9B,OAAO,IAAMC,cAA8B,GACxC,SADUA,cAA8B,CAEvCC,WAA0B,EAC1BC,IAA0B,EAC1BC,YAAwD,EACxDC,YAAyB,EAC6B;EAAA,IAFtDD,YAAwD;IAAxDA,YAAwD,GAAGN,IAAI;EAAA;EAAA,IAC/DO,YAAyB;IAAzBA,YAAyB,GAAGN,QAAQ;EAAA;EAGpC,gBAA0BH,QAAQ,CAAgBM,WAAW,CAAC;IAAvDI,KAAK;IAAEC,QAAQ;EAEtB,IAAMC,UAAU,GAAGX,gBAAgB,CACjC,UAACG,CAAgB,EAAES,CAAI,EAAK;IAE1B,IAAMC,IAAoB,GAAG,CAACV,CAAC,KAAKW,SAAS,GAAG,IAAI,GAAGX,CAAC,CAAC;IAEzD,IAAIG,IAAI,KAAKO,IAAI,CAAC,CAAC,CAAC,EAAE;MACpB,IAAID,CAAC,KAAKE,SAAS,EAAE;QACnBD,IAAI,CAACE,IAAI,CAACH,CAAC,CAAC;MACd;MACAL,YAAY,eAAIM,IAAI,CAAC;IACvB;EACF,CAAC,CACF;EAED,IAAMG,WAAW,GAAGhB,gBAAgB,CAClC,UAACG,CAAgB,EAAES,CAAI,EAAK;IAC1B,IAAIH,KAAK,KAAKN,CAAC,EAAE;MACfO,QAAQ,CAACP,CAAC,KAAKW,SAAS,GAAGA,SAAS,GAAGN,YAAY,CAACL,CAAC,CAAC,CAAC;MACvDQ,UAAU,CAACR,CAAC,EAAES,CAAC,CAAC;IAClB;EACF,CAAC,CACF;EAED,IAAIN,IAAI,KAAKQ,SAAS,EAAE;IACtB,OAAO,CAACR,IAAI,KAAK,IAAI,GAAGQ,SAAS,GAAGR,IAAI,EAAEK,UAAU,CAAC;EACvD,CAAC,MAAM;IACL,OAAO,CAACF,KAAK,EAAEO,WAAW,CAAC;EAC7B;AACF,CAAS"}