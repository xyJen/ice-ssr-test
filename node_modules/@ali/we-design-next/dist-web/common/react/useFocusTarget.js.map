{"version":3,"file":"useFocusTarget.js","names":["useRef","useFocusTarget","ownerRef","idRef","undefined","focusTarget","fn","current","randomId","wait","id","ele","document","getElementById","focus","focusOwner","waitId","callback","timeout","inter","accInter","Math","min","success","now","Date","beginTime","clearTimeout","setTimeout","floor","random","toString"],"sources":["../../../../src/common/react/useFocusTarget.ts"],"sourcesContent":["import React, { useRef } from 'react';\n\nexport const useFocusTarget = (\n  ownerRef: React.RefObject<HTMLElement>,\n): [string | undefined, (fn: () => void) => void, (fn: () => void) => void] => {\n\n  const idRef = useRef<string | undefined>(undefined);\n\n  const focusTarget = (fn: () => void) => {\n\n    idRef.current = randomId();\n\n    fn();\n\n    wait(() => {\n      const id = idRef.current;\n      if (id) {\n        const ele = document.getElementById(id);\n        if (ele) {\n          ele.focus();\n          return true;\n        }\n      }\n      return false;\n    });\n\n  };\n\n  const focusOwner = (fn: () => void) => {\n\n    idRef.current = undefined;\n\n    fn();\n\n    wait(() => {\n      if (ownerRef.current) {\n        ownerRef.current.focus();\n        return true;\n      }\n      return false;\n    });\n  };\n\n  return [idRef.current, focusTarget, focusOwner];\n};\n\n\nlet waitId: ReturnType<typeof setTimeout> | null = null;\n\nconst wait = (\n  callback: () => boolean,\n  timeout: number = 3000\n) => {\n\n  let inter = 10;\n  const accInter = () => {\n    if (inter < 500) {\n      inter = Math.min(500, inter * 2);\n    }\n  }\n\n  const fn = () => {\n    const success = callback();\n    if (!success) {\n      const now = Date.now();\n      if (now - beginTime <= timeout) {\n\n        if (waitId) {\n          clearTimeout(waitId);\n          waitId = null;\n        }\n\n        waitId = setTimeout(() => {\n          waitId = null;\n          fn();\n        }, inter);\n        accInter();\n      }\n    }\n  };\n\n  const beginTime = Date.now();\n  fn();\n};\n\nconst randomId = () => (Date.now() % (1000 * 3600 * 24) * 10000 + Math.floor(Math.random() * 10000)).toString(32);\n"],"mappings":"AAAA,SAAgBA,MAAM,QAAQ,OAAO;AAErC,OAAO,IAAMC,cAAc,GAAG,SAAjBA,cAAc,CACzBC,QAAsC,EACuC;EAE7E,IAAMC,KAAK,GAAGH,MAAM,CAAqBI,SAAS,CAAC;EAEnD,IAAMC,WAAW,GAAG,SAAdA,WAAW,CAAIC,EAAc,EAAK;IAEtCH,KAAK,CAACI,OAAO,GAAGC,QAAQ,EAAE;IAE1BF,EAAE,EAAE;IAEJG,IAAI,CAAC,YAAM;MACT,IAAMC,EAAE,GAAGP,KAAK,CAACI,OAAO;MACxB,IAAIG,EAAE,EAAE;QACN,IAAMC,GAAG,GAAGC,QAAQ,CAACC,cAAc,CAACH,EAAE,CAAC;QACvC,IAAIC,GAAG,EAAE;UACPA,GAAG,CAACG,KAAK,EAAE;UACX,OAAO,IAAI;QACb;MACF;MACA,OAAO,KAAK;IACd,CAAC,CAAC;EAEJ,CAAC;EAED,IAAMC,UAAU,GAAG,SAAbA,UAAU,CAAIT,EAAc,EAAK;IAErCH,KAAK,CAACI,OAAO,GAAGH,SAAS;IAEzBE,EAAE,EAAE;IAEJG,IAAI,CAAC,YAAM;MACT,IAAIP,QAAQ,CAACK,OAAO,EAAE;QACpBL,QAAQ,CAACK,OAAO,CAACO,KAAK,EAAE;QACxB,OAAO,IAAI;MACb;MACA,OAAO,KAAK;IACd,CAAC,CAAC;EACJ,CAAC;EAED,OAAO,CAACX,KAAK,CAACI,OAAO,EAAEF,WAAW,EAAEU,UAAU,CAAC;AACjD,CAAC;AAGD,IAAIC,MAA4C,GAAG,IAAI;AAEvD,IAAMP,IAAI,GAAG,SAAPA,IAAI,CACRQ,QAAuB,EACvBC,OAAe,EACZ;EAAA,IADHA,OAAe;IAAfA,OAAe,GAAG,IAAI;EAAA;EAGtB,IAAIC,KAAK,GAAG,EAAE;EACd,IAAMC,QAAQ,GAAG,SAAXA,QAAQ,GAAS;IACrB,IAAID,KAAK,GAAG,GAAG,EAAE;MACfA,KAAK,GAAGE,IAAI,CAACC,GAAG,CAAC,GAAG,EAAEH,KAAK,GAAG,CAAC,CAAC;IAClC;EACF,CAAC;EAED,IAAMb,EAAE,GAAG,SAALA,EAAE,GAAS;IACf,IAAMiB,OAAO,GAAGN,QAAQ,EAAE;IAC1B,IAAI,CAACM,OAAO,EAAE;MACZ,IAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,EAAE;MACtB,IAAIA,GAAG,GAAGE,SAAS,IAAIR,OAAO,EAAE;QAE9B,IAAIF,MAAM,EAAE;UACVW,YAAY,CAACX,MAAM,CAAC;UACpBA,MAAM,GAAG,IAAI;QACf;QAEAA,MAAM,GAAGY,UAAU,CAAC,YAAM;UACxBZ,MAAM,GAAG,IAAI;UACbV,EAAE,EAAE;QACN,CAAC,EAAEa,KAAK,CAAC;QACTC,QAAQ,EAAE;MACZ;IACF;EACF,CAAC;EAED,IAAMM,SAAS,GAAGD,IAAI,CAACD,GAAG,EAAE;EAC5BlB,EAAE,EAAE;AACN,CAAC;AAED,IAAME,QAAQ,GAAG,SAAXA,QAAQ;EAAA,OAAS,CAACiB,IAAI,CAACD,GAAG,EAAE,IAAI,IAAI,GAAG,IAAI,GAAG,EAAE,CAAC,GAAG,KAAK,GAAGH,IAAI,CAACQ,KAAK,CAACR,IAAI,CAACS,MAAM,EAAE,GAAG,KAAK,CAAC,EAAEC,QAAQ,CAAC,EAAE,CAAC;AAAA"}