{"version":3,"file":"adjustForViewport.js","names":["utils","getAlignOffset","adjustVertical","elFuturePos","elRegion","tgtRegion","visibleRect","align","pos","clone","points","overflow","offset","adjustY","resizeHeight","srcAlignType","srcV","charAt","tgtPos","tgtPosTop","top","size","height","bottom","adjustHorizontal","adjustX","resizeWidth","srcH","tgtPosLeft","left","width","right","adjustForViewport","horizontalInfo","verticalInfo","mix"],"sources":["../../../../../src/common/domAlign/calc/adjustForViewport.tsx"],"sourcesContent":["import { utils } from '../utils/utils';\nimport type { IPos, IFullRegion, IAlign, IVisibleRect } from '../interface';\nimport getAlignOffset from './getAlignOffset';\n\nfunction adjustVertical(elFuturePos: IPos, elRegion: IFullRegion, tgtRegion: IFullRegion, visibleRect: IVisibleRect, align: IAlign): { top: number, height: number} {\n  const pos = utils.clone(elFuturePos) as IPos;\n  const { points, overflow, offset = [0, 0] } = align;\n  const { adjustY, resizeHeight } = overflow;\n\n  const srcAlignType = points[0];\n  const srcV = srcAlignType.charAt(0);\n  const tgtPos = getAlignOffset(tgtRegion, points[1]); // 获取target的对齐点的坐标\n  const tgtPosTop = tgtPos.top + offset[1];\n\n  const size = { height: elRegion.height };\n\n  // Top edge outside viewport, try to move it.\n  if (adjustY && resizeHeight && pos.top < visibleRect.top) {\n    // resizeHeight且对齐方式为c或者b时，需要保证top坐标在可视区域内\n    if (srcV === 'c' || srcV === 'b') {\n      pos.top = visibleRect.top;\n    }\n  }\n\n  // Top edge inside and bottom edge outside viewport, try to resize it.\n  if (resizeHeight && (pos.top + size.height > visibleRect.bottom || pos.top < visibleRect.top)) {\n    if (srcV === \"t\") {\n      size.height = visibleRect.bottom - pos.top;\n    } else {\n      // 存在对齐点不在可视区域的情况，此时不resize\n      size.height = tgtPosTop < visibleRect.top ? elRegion.height : (tgtPosTop - visibleRect.top);\n    }\n  }\n\n  // 还放不下，重置top和height\n  if ((adjustY || resizeHeight) && (pos.top + size.height > visibleRect.bottom || pos.top < visibleRect.top)) {\n    pos.top = elFuturePos.top;\n    size.height = elRegion.height;\n  }\n\n  return { top: pos.top, height: size.height };\n}\n\nfunction adjustHorizontal(elFuturePos: IPos, elRegion: IFullRegion, tgtRegion: IFullRegion, visibleRect: IVisibleRect, align: IAlign): { left: number, width: number } {\n  const pos = utils.clone(elFuturePos) as IPos;\n  const { points, overflow, offset = [0, 0] } = align;\n  const { adjustX, resizeWidth } = overflow;\n\n  const srcAlignType = points[0];\n  const srcH = srcAlignType.charAt(1);\n  const tgtPos = getAlignOffset(tgtRegion, points[1]); // 获取target的对齐点的坐标\n  const tgtPosLeft = tgtPos.left + offset[0];\n\n  const size = { width: elRegion.width };\n\n  if (adjustX && resizeWidth && pos.left < visibleRect.left) {\n    if (srcH === 'c' || srcH === 'r') {\n      pos.left = visibleRect.left;\n    }\n  }\n\n  // Left edge inside and right edge outside viewport, try to resize it.\n  if (resizeWidth && (pos.left + size.width > visibleRect.right || pos.left < visibleRect.left)) {\n    if (srcH === 'l') {\n      size.width = visibleRect.right - pos.left;\n    } else {\n      size.width = tgtPosLeft < visibleRect.left ? elRegion.width : tgtPosLeft - visibleRect.left;\n    }\n  }\n\n  // 还放不下，重置left和width\n  if (adjustX && resizeWidth && (pos.left + size.width > visibleRect.right || pos.left < visibleRect.left)) {\n    pos.left = elFuturePos.left;\n    size.width = elRegion.width;\n  }\n\n  return { left: pos.left, width: size.width };\n}\n\nfunction adjustForViewport(elFuturePos: IPos, elRegion: IFullRegion, tgtRegion: IFullRegion, visibleRect: IVisibleRect, align: IAlign): IFullRegion {\n  const horizontalInfo = adjustHorizontal(elFuturePos, elRegion, tgtRegion, visibleRect, align);\n  const verticalInfo = adjustVertical(elFuturePos, elRegion, tgtRegion, visibleRect, align);\n\n  return utils.mix(horizontalInfo, verticalInfo) as IFullRegion;\n}\n\nexport default adjustForViewport;"],"mappings":"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"}