{"version":3,"file":"alignPoint.js","names":["utils","domUtils","getRectOfSource","getDestinationRect","alignRect","alignPoint","el","tgtPoint","align","pageX","pageY","doc","getDocument","win","defaultView","parentWindow","scrollX","getWindowScrollLeft","scrollY","getWindowScrollTop","viewportWidth","viewportHeight","clientX","clientY","tgtRegion","left","top","width","height","pointInView","points","newAlign","srcInfo","tgtInfo","destInfo"],"sources":["../../../../../src/common/domAlign/align/alignPoint.tsx"],"sourcesContent":["import { utils } from '../utils/utils';\nimport { domUtils } from '../utils/dom-utils';\nimport { getRectOfSource, getDestinationRect, alignRect, TargetInfo } from './alignRect';\nimport type { IAlign, IPoints } from '../interface';\n\ntype ITargetPoint = { pageX: number, pageY: number } | { clientX: number, clientY: number };\n\n/**\n * `tgtPoint`: { pageX, pageY } or { clientX, clientY }.\n * If client position provided, will internal convert to page position.\n */\n\nfunction alignPoint(el: HTMLElement, tgtPoint: ITargetPoint, align: IAlign) {\n  let pageX;\n  let pageY;\n\n  const doc = utils.getDocument(el);\n  // 根据 quirksmode，IE 9 以下版本不支持 defaultView.\n  const win = (doc.defaultView || doc.parentWindow) as Window;\n\n  const scrollX = utils.getWindowScrollLeft(win);\n  const scrollY = utils.getWindowScrollTop(win);\n  const viewportWidth = domUtils.viewportWidth(win);\n  const viewportHeight = domUtils.viewportHeight(win);\n\n  if ('pageX' in tgtPoint) {\n    pageX = tgtPoint.pageX;\n  } else {\n    pageX = scrollX + tgtPoint.clientX;\n  }\n\n  if ('pageY' in tgtPoint) {\n    pageY = tgtPoint.pageY;\n  } else {\n    pageY = scrollY + tgtPoint.clientY;\n  }\n\n  const tgtRegion = {\n    left: pageX,\n    top: pageY,\n    width: 0,\n    height: 0,\n  };\n\n  const pointInView =\n    pageX >= 0 &&\n    pageX <= scrollX + viewportWidth &&\n    (pageY >= 0 && pageY <= scrollY + viewportHeight);\n\n  // Provide default target point\n  const points: IPoints = [align.points[0], 'cc'];\n\n  const newAlign: IAlign = { ...align, points };\n  const srcInfo = getRectOfSource(el, newAlign);\n  const tgtInfo: TargetInfo = [tgtRegion, pointInView];\n  const destInfo = getDestinationRect(srcInfo, tgtInfo, newAlign);\n\n  alignRect(el, destInfo, newAlign);\n  return destInfo;\n}\n\nexport default alignPoint;\n"],"mappings":";AAAA,SAASA,KAAK;AACd,SAASC,QAAQ;AACjB,SAASC,eAAe,EAAEC,kBAAkB,EAAEC,SAAS;AAKvD;AACA;AACA;AACA;;AAEA,SAASC,UAAU,CAACC,EAAe,EAAEC,QAAsB,EAAEC,KAAa,EAAE;EAC1E,IAAIC,KAAK;EACT,IAAIC,KAAK;EAET,IAAMC,GAAG,GAAGX,KAAK,CAACY,WAAW,CAACN,EAAE,CAAC;EACjC;EACA,IAAMO,GAAG,GAAIF,GAAG,CAACG,WAAW,IAAIH,GAAG,CAACI,YAAuB;EAE3D,IAAMC,OAAO,GAAGhB,KAAK,CAACiB,mBAAmB,CAACJ,GAAG,CAAC;EAC9C,IAAMK,OAAO,GAAGlB,KAAK,CAACmB,kBAAkB,CAACN,GAAG,CAAC;EAC7C,IAAMO,aAAa,GAAGnB,QAAQ,CAACmB,aAAa,CAACP,GAAG,CAAC;EACjD,IAAMQ,cAAc,GAAGpB,QAAQ,CAACoB,cAAc,CAACR,GAAG,CAAC;EAEnD,IAAI,OAAO,IAAIN,QAAQ,EAAE;IACvBE,KAAK,GAAGF,QAAQ,CAACE,KAAK;EACxB,CAAC,MAAM;IACLA,KAAK,GAAGO,OAAO,GAAGT,QAAQ,CAACe,OAAO;EACpC;EAEA,IAAI,OAAO,IAAIf,QAAQ,EAAE;IACvBG,KAAK,GAAGH,QAAQ,CAACG,KAAK;EACxB,CAAC,MAAM;IACLA,KAAK,GAAGQ,OAAO,GAAGX,QAAQ,CAACgB,OAAO;EACpC;EAEA,IAAMC,SAAS,GAAG;IAChBC,IAAI,EAAEhB,KAAK;IACXiB,GAAG,EAAEhB,KAAK;IACViB,KAAK,EAAE,CAAC;IACRC,MAAM,EAAE;EACV,CAAC;EAED,IAAMC,WAAW,GACfpB,KAAK,IAAI,CAAC,IACVA,KAAK,IAAIO,OAAO,GAAGI,aAAa,IAC/BV,KAAK,IAAI,CAAC,IAAIA,KAAK,IAAIQ,OAAO,GAAGG,cAAe;;EAEnD;EACA,IAAMS,MAAe,GAAG,CAACtB,KAAK,CAACsB,MAAM,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC;EAE/C,IAAMC,QAAgB,gBAAQvB,KAAK;IAAEsB,MAAM,EAANA;EAAM,EAAE;EAC7C,IAAME,OAAO,GAAG9B,eAAe,CAACI,EAAE,EAAEyB,QAAQ,CAAC;EAC7C,IAAME,OAAmB,GAAG,CAACT,SAAS,EAAEK,WAAW,CAAC;EACpD,IAAMK,QAAQ,GAAG/B,kBAAkB,CAAC6B,OAAO,EAAEC,OAAO,EAAEF,QAAQ,CAAC;EAE/D3B,SAAS,CAACE,EAAE,EAAE4B,QAAQ,EAAEH,QAAQ,CAAC;EACjC,OAAOG,QAAQ;AACjB;AAEA,eAAe7B,UAAU"}