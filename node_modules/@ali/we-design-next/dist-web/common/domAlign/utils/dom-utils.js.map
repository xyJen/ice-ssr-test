{"version":3,"file":"dom-utils.js","names":["utils","isBorderBoxFn","getPBMWidth","getWHIgnoreDisplay","MARGIN_INDEX","BORDER_INDEX","CONTENT_INDEX","domUtils","getParent","element","parent","nodeType","host","parentNode","isDocument","viewportWidth","win","prop","doc","document","body","documentElement","documentElementProp","compatMode","viewportHeight","docWidth","refWin","d","Math","max","scrollWidth","docHeight","scrollHeight","outerWidth","el","includeMargin","outerHeight","width","elem","v","val","undefined","isBorderBox","css","height"],"sources":["../../../../../src/common/domAlign/utils/dom-utils.tsx"],"sourcesContent":["import { utils } from './utils';\nimport { isBorderBoxFn, getPBMWidth, getWHIgnoreDisplay, MARGIN_INDEX, BORDER_INDEX, CONTENT_INDEX } from './size-utils';\n\ntype DomUtilType = {\n  getParent: (element: Document | HTMLElement) => Document | HTMLElement | null;\n  viewportWidth: (win: Window) => any;\n  viewportHeight: (win: Window) => any;\n  docWidth: (refWin: Window) => number;\n  docHeight: (refWin: Window) => number;\n  outerWidth: (el: HTMLElement, includeMargin?: boolean) => number;\n  outerHeight: (el: HTMLElement, includeMargin?: boolean) => number;\n  width: (elem: HTMLElement, v?: number) => any;\n  height: (elem: HTMLElement, v?: number) => any;\n};\n\nconst domUtils: DomUtilType = {\n  getParent(element: Document | HTMLElement): Document | HTMLElement | null {\n    let parent: ShadowRoot | Document | DocumentFragment | HTMLElement | ParentNode | null = element;\n    do {\n      if (parent.nodeType === 11 && (parent as ShadowRoot).host) { // ShadowRoot\n        parent = (parent as ShadowRoot).host;\n      } else {\n        parent = parent.parentNode;\n      }\n    } while (parent && parent.nodeType !== 1 && !utils.isDocument(parent)); // 非Element节点、document节点\n    return parent as HTMLElement | Document;\n  },\n  viewportWidth(win: Window) {\n    // pc browser includes scrollbar in window.innerWidth\n    const prop = `clientWidth`;\n    const doc = win.document;\n    const body = doc.body;\n    const documentElement = doc.documentElement;\n    const documentElementProp = documentElement[prop as keyof HTMLElement];\n    // 标准模式取 documentElement\n    // backcompat 取 body\n    return (\n      (doc.compatMode === 'CSS1Compat' && documentElementProp) ||\n      (body && body[prop as keyof HTMLElement]) ||\n      documentElementProp\n    );\n  },\n  viewportHeight(win: Window) {\n    // pc browser includes scrollbar in window.innerWidth\n    const prop = `clientHeight`;\n    const doc = win.document;\n    const body = doc.body;\n    const documentElement = doc.documentElement;\n    const documentElementProp = documentElement[prop as keyof HTMLElement];\n    // 标准模式取 documentElement\n    // backcompat 取 body\n    return (\n      (doc.compatMode === 'CSS1Compat' && documentElementProp) ||\n      (body && body[prop as keyof HTMLElement]) ||\n      documentElementProp\n    );\n  },\n  docWidth(refWin: Window): number {\n    const d = refWin.document;\n    return Math.max(d.documentElement.scrollWidth, d.body.scrollWidth, domUtils.viewportWidth(refWin));\n  },\n  docHeight(refWin: Window): number {\n    const d = refWin.document;\n    return Math.max(\n      // firefox chrome documentElement.scrollHeight< body.scrollHeight\n      // ie standard mode : documentElement.scrollHeight> body.scrollHeight\n      d.documentElement.scrollHeight,\n      // quirks : documentElement.scrollHeight 最大等于可视窗口多一点？\n      d.body.scrollHeight,\n      domUtils.viewportHeight(refWin),\n    );\n  },\n  outerWidth(el: HTMLElement, includeMargin?: boolean): number {\n    return (\n      el &&\n      getWHIgnoreDisplay(el, 'width', includeMargin ? MARGIN_INDEX : BORDER_INDEX)\n    );\n  },\n  outerHeight(el: HTMLElement, includeMargin?: boolean): number {\n    return (\n      el &&\n      getWHIgnoreDisplay(el, 'height', includeMargin ? MARGIN_INDEX : BORDER_INDEX)\n    );\n  },\n  width(elem: HTMLElement, v?: number) {\n    let val = v;\n    if (val !== undefined) {\n      if (elem) {\n        const isBorderBox = isBorderBoxFn(elem);\n        if (isBorderBox) {\n          val += getPBMWidth(elem, ['padding', 'border'], ['Left', 'Right']);\n        }\n        return utils.css(elem, 'width', val);\n      }\n      return undefined;\n    }\n    return elem && getWHIgnoreDisplay(elem, 'width', CONTENT_INDEX);\n  },\n  height(elem: HTMLElement, v?: number) {\n    let val = v;\n    if (val !== undefined) {\n      if (elem) {\n        const isBorderBox = isBorderBoxFn(elem);\n        if (isBorderBox) {\n          val += getPBMWidth(elem, ['padding', 'border'], ['Top', 'Bottom']);\n        }\n        return utils.css(elem, 'height', val);\n      }\n      return undefined;\n    }\n    return elem && getWHIgnoreDisplay(elem, 'height', CONTENT_INDEX);\n  },\n};\n\nexport { domUtils };"],"mappings":"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"}