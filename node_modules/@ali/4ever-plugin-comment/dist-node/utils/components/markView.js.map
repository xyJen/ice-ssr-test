{"version":3,"sources":["../../../../src/utils/components/markView.tsx"],"names":["IS_MOBILE","environment","MarkWrapper","styled","span","COLOR_UNDERLINE","ReadOnlyMarkWrapper","COLOR","VoidMarkWrapper","VoidActiveWrapper","COLOR_ACTIVE","VoidBlockWrapper","div","isActive","VoidBlockPH","MarkView","mark","children","controller","showInline","customClick","contentId","isNew","data","readOnly","style","backgroundColor","handleClick","React","useCallback","isSideBarShowing","run","View","extraProps","VoidMarkView","props","nextElements","isBlock","isDisabled","nodeKey","hideAll","Boolean"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Controller, environment } from '@ali/4ever-cangjie';\nimport styled from 'styled-components';\nimport { COLOR, COLOR_ACTIVE, COLOR_UNDERLINE } from '../constants';\nimport { ViewMark } from '../models/marks';\nimport isSidebarVisible from '../queries/isSidebarVisible';\nimport { setActiveId, setSidebarVisible, showComment } from '../actions';\n\nconst { IS_MOBILE } = environment;\n\ninterface MarkViewProps {\n  mark: ViewMark;\n  showInline?: boolean;\n  controller: Controller;\n  children: any;\n  customClick?: (contentId: string) => void;\n}\n\ninterface VoidMarkViewProps {\n  mark: ViewMark | undefined;\n  isBlock: boolean;\n  nodeKey: string;\n  isDisabled?: boolean;\n  nextElements: any;\n}\n\nconst MarkWrapper = styled.span`\n  border-bottom: 2px solid ${COLOR_UNDERLINE};\n`;\n\nconst ReadOnlyMarkWrapper = styled(MarkWrapper)`\n  cursor: pointer;\n  transition: background 0.25s;\n  &:hover {\n    background-color: ${COLOR};\n  }\n`;\n\nconst VoidMarkWrapper = styled.span`\n  width: 100%;\n  height: 2px;\n  position: absolute;\n  bottom: -2px;\n  left: 0px;\n  background-color: ${COLOR_UNDERLINE};\n`;\n\nconst VoidActiveWrapper = styled(VoidMarkWrapper)`\n  height: 100%;\n  min-height: 3px;\n  bottom: -2px;\n  background: ${COLOR_ACTIVE};\n  border-bottom: 2px solid ${COLOR_UNDERLINE};\n  pointer-events: none;\n`;\n\nconst VoidBlockWrapper = styled.div<{ isActive: boolean }>`\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n  height: 0;\n  border-bottom: 2px solid ${COLOR_UNDERLINE};\n  box-sizing: content-box;\n  border-top: ${({ isActive }) =>\n    isActive ? `4px solid ${COLOR_ACTIVE}` : 'none'};\n`;\n\nconst VoidBlockPH = styled.div<{ isActive: boolean }>`\n  margin-top: ${({ isActive }) => (isActive ? '8px' : '4px')};\n  position: relative;\n`;\n\n/**\n * Mark 渲染\n */\nexport function MarkView({ mark, children, controller, showInline, customClick }: MarkViewProps) {\n  const { contentId, isActive, isNew } = mark.data;\n  const { readOnly } = controller;\n  const style: React.CSSProperties = {};\n  if (isActive || isNew) {\n    style.backgroundColor = COLOR_ACTIVE;\n  }\n  const handleClick = React.useCallback(() => {\n    if (customClick) {\n      return customClick(contentId);\n    }\n    const isSideBarShowing = isSidebarVisible(controller);\n    // 编辑视图 + 右侧没打开，就 ignore 了。\n    if (!controller.readOnly && !isSideBarShowing) {\n      return;\n    }\n    if (!controller.readOnly && showInline) {\n      return;\n    }\n    if (IS_MOBILE) {\n      controller.run('onAction', showComment(contentId));\n    } else {\n      controller.run('onAction', setActiveId(contentId, controller.readOnly));\n      !isSideBarShowing && controller.run('onAction', setSidebarVisible(true));\n    }\n  }, [controller, contentId, showInline]);\n\n  const View = readOnly ? ReadOnlyMarkWrapper : MarkWrapper;\n  const extraProps = readOnly ? { 'data-comment-noblur': true } : {};\n  return (\n    <View\n      {...extraProps}\n      data-comment={contentId}\n      onClick={handleClick}\n      style={style}\n    >\n      {children}\n    </View>\n  );\n}\n\n/**\n * Void 类型的 Mark 渲染\n */\nexport function VoidMarkView(props: VoidMarkViewProps) {\n  const { nextElements, mark, isBlock, isDisabled, nodeKey } = props;\n  const hideAll = Boolean(isDisabled || !mark);\n  const isActive = Boolean(mark?.data.isActive);\n  const extraProps = {\n    'data-comment-void': mark?.data.contentId,\n    // 节点 key。由于 dom 位置调整，从 dom 结构上找 key 不可靠，因此这里自己传入了一个\n    'data-comment-nodekey': nodeKey,\n  };\n  return (\n    <React.Fragment>\n      {nextElements}\n      {!hideAll && isBlock && (\n        <VoidBlockPH isActive={isActive}>\n          <VoidBlockWrapper isActive={isActive} {...extraProps} />\n        </VoidBlockPH>\n      )}\n      {!hideAll && !isBlock && isActive && (\n        <VoidActiveWrapper {...extraProps} />\n      )}\n      {!hideAll && !isBlock && !isActive && <VoidMarkWrapper {...extraProps} />}\n    </React.Fragment>\n  );\n}\n"],"file":"markView.js"}