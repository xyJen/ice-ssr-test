{"version":3,"sources":["../../../../src/utils/components/popupView.tsx"],"names":["EXTRA_HEIGHT_OFFSET","TRANSITION_WAIT_TIME","POPUP_TRANSITION","ToolbarArrowUpNormal","ToolbarArrowDownNormal","PopupWrapper","styled","div","props","isActive","TitleRef","Title","ArrowWrapper","visible","TitleWrapper","IconWrapper","isDisabled","Spliter","Panel","Popup","React","memo","controller","contentId","configs","isNew","isAutoFocus","summary","position","onAdd","onDelete","onCancel","sendComment","getCommentList","renderPopup","closeComment","prev","next","query","getSiblings","children","canCloseComment","readonlyPosition","readOnly","undefined","renderProps","navigateToPrev","useCallback","event","heightPercent","SCROLL_HEIGHT_PERCENT_SIDEBAR","run","navigateToNext","navigateToClose","preventDefault","stopPropagation","tipStyle","locale","PopupView","top","prio","popHeights","updatePosition","ref","useRef","zoom","handleMouseDown","target","noCaptureAttr","Element","closest","hasAttribute","topPx","style","isVisible","setIsVisible","useState","useEffect","callback","p","updator","current","domNode","prettier","transition","cancel","comment"],"mappings":"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","sourcesContent":["import React from 'react';\nimport styled from 'styled-components';\nimport { Controller, useZoom } from '@ali/4ever-cangjie';\nimport { Tooltip } from '@ali/we-design';\nimport { CompleteNormal, ToolbarArrowDownNormal } from '@ali/we-icon';\nimport { CommentPluginConfigs, RenderPopupProps } from '../types';\nimport SimplePopup from './simplePopup';\nimport useResizer from '../utils/useResizer';\nimport { showComment } from '../actions';\nimport getSiblings from '../queries/getSiblings';\nimport blockEvent from '../utils/blockEvent';\nimport { tipStyle } from '../common';\nimport { cancelQueue, enqueue } from '../common/pendingIDs';\nimport requestIdle from '../utils/requestIdle';\nimport { SCROLL_HEIGHT_PERCENT_SIDEBAR } from '../constants';\n\nconst EXTRA_HEIGHT_OFFSET = -14;\nconst TRANSITION_WAIT_TIME = 1000;\nconst POPUP_TRANSITION = 'border 0.25s, box-shadow 0.25s, top 0.25s';\n\nconst ToolbarArrowUpNormal = styled(ToolbarArrowDownNormal)`\n  transform: rotate(180deg);\n`;\n\nconst PopupWrapper = styled.div<{ isActive: boolean }>`\n  position: absolute;\n  -webkit-font-smoothing: antialiased;\n  width: calc(100% - 28px);\n  left: 0px;\n  margin: 14px;\n  background-color: white;\n  border: 1px solid\n    ${(props) => (props.isActive ? '#0089FF' : 'rgba(126, 134, 142, 0.16)')};\n  border-radius: 8px;\n  overflow: hidden;\n  cursor: ${(props) => (props.isActive ? 'initial' : 'pointer')};\n  box-sizing: border-box;\n  box-shadow: ${(props) =>\n    props.isActive\n      ? '0px 0px 1px rgba(0, 0, 0, 0.24), 0px 8px 24px rgba(0, 0, 0, 0.16)'\n      : 'none'};\n  &:focus {\n    outline: none;\n  }\n  &:hover {\n    border: 1px solid ${(props) => (props.isActive ? '#0089FF' : 'white')};\n    box-shadow: 0px 0px 1px rgba(0, 0, 0, 0.24),\n      0px 8px 24px rgba(0, 0, 0, 0.16);\n  }\n  & article[data-cangjie-content] {\n    padding: 0;\n  }\n`;\n\nconst TitleRef = styled.div`\n  width: 2px;\n  height: 14px;\n  background-color: #171a1d;\n  opacity: 0.24;\n  margin-right: 4px;\n`;\n\nconst Title = styled.div`\n  flex: 1;\n  padding-right: 8px;\n  font-size: 14px;\n  height: 26px;\n  line-height: 26px;\n  opacity: 0.6;\n  color: #171a1d;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nconst ArrowWrapper = styled.div<{ visible: boolean }>`\n  opacity: ${(props) => (props.visible ? '1' : '0')};\n  height: 24px;\n  border: 1px solid rgba(126, 134, 142, 0.16);\n  border-radius: 4px;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n`;\n\nconst TitleWrapper = styled.div`\n  padding: 12px 16px;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  &:hover ${ArrowWrapper} {\n    opacity: 1;\n  }\n`;\n\nconst IconWrapper = styled.div<{ isDisabled?: boolean }>`\n  height: 24px;\n  width: 24px;\n  flex: 1;\n  display: flex;\n  cursor: pointer;\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n  color: ${(props) =>\n    props.isDisabled ? 'rgba(23, 26, 29, 0.24)' : '#171A1D'};\n  &:hover {\n    background: ${(props) =>\n      props.isDisabled ? 'transparent' : 'rgba(126, 134, 142, 0.12)'};\n  }\n  & > span {\n    font-size: 20px;\n  }\n`;\n\nconst Spliter = styled.div`\n  width: 1px;\n  height: 22px;\n  background: rgba(126, 134, 142, 0.16);\n`;\n\nconst Panel = styled.div``;\n\ninterface PopupViewProps {\n  controller: Controller;\n  top: number;\n  prio: number;\n  popHeights: Record<string, number>;\n  isNew: boolean;\n  isActive: boolean;\n  contentId: string;\n  summary: string;\n  position?: string;\n  isAutoFocus: boolean;\n  updatePosition: () => void;\n  configs?: CommentPluginConfigs;\n  onAdd: () => void;\n  onDelete: () => void;\n  onCancel: () => void;\n}\n\nconst Popup = React.memo(\n  (\n    props: Omit<\n      PopupViewProps,\n      'top' | 'updatePosition' | 'prio' | 'popHeights'\n    >,\n  ) => {\n    const {\n      controller,\n      contentId,\n      configs,\n      isNew,\n      isAutoFocus,\n      isActive,\n      summary,\n      position,\n      onAdd,\n      onDelete,\n      onCancel,\n    } = props;\n    const { sendComment, getCommentList, renderPopup, closeComment } =\n      configs || {};\n    const { prev, next } = controller.query(getSiblings);\n\n    let children: JSX.Element | undefined;\n    const canCloseComment = !!closeComment;\n    const readonlyPosition = controller.readOnly ? position : undefined;\n    const renderProps: RenderPopupProps = {\n      contentId,\n      isNew,\n      isAutoFocus,\n      isActive,\n      summary,\n      readonlyPosition,\n      onAdd,\n      onDelete,\n      onCancel: isNew ? onCancel : undefined,\n    };\n    const navigateToPrev = React.useCallback(\n      (event: React.MouseEvent) => {\n        if (prev) {\n          const heightPercent = SCROLL_HEIGHT_PERCENT_SIDEBAR;\n          controller.run('onAction', showComment(prev, { heightPercent }));\n        }\n        blockEvent(event);\n      },\n      [controller, prev],\n    );\n    const navigateToNext = React.useCallback(\n      (event: React.MouseEvent) => {\n        if (next) {\n          const heightPercent = SCROLL_HEIGHT_PERCENT_SIDEBAR;\n          controller.run('onAction', showComment(next, { heightPercent }));\n        }\n        blockEvent(event);\n      },\n      [controller, next],\n    );\n    const navigateToClose = React.useCallback(\n      (event: React.MouseEvent) => {\n        event.preventDefault();\n        event.stopPropagation();\n        closeComment && closeComment(contentId);\n      },\n      [closeComment, contentId],\n    );\n\n    if (renderPopup) {\n      children = renderPopup(renderProps);\n    } else {\n      children = (\n        <SimplePopup\n          sendComment={sendComment}\n          getCommentList={getCommentList}\n          {...renderProps}\n        />\n      );\n    }\n\n    return (\n      <React.Fragment>\n        <TitleWrapper>\n          <TitleRef />\n          <Title>{summary}</Title>\n          {!isNew && (\n            <ArrowWrapper visible={isActive}>\n              {isActive && (\n                <Tooltip\n                  overlayStyle={tipStyle}\n                  title={configs?.locale?.prev || 'Prev'}\n                  placement=\"top\"\n                >\n                  <IconWrapper isDisabled={!prev} onClick={navigateToPrev}>\n                    <ToolbarArrowUpNormal />\n                  </IconWrapper>\n                </Tooltip>\n              )}\n              {isActive && !canCloseComment && <Spliter />}\n              {isActive && (\n                <Tooltip\n                  overlayStyle={tipStyle}\n                  title={configs?.locale?.next || 'Next'}\n                  placement=\"top\"\n                >\n                  <IconWrapper isDisabled={!next} onClick={navigateToNext}>\n                    <ToolbarArrowDownNormal />\n                  </IconWrapper>\n                </Tooltip>\n              )}\n\n              {canCloseComment && (\n                <React.Fragment>\n                  {isActive && <Spliter />}\n                  <Tooltip\n                    overlayStyle={tipStyle}\n                    title={\n                      configs?.locale?.closeComment ||\n                      'Resolve and hide comments'\n                    }\n                    placement=\"top\"\n                  >\n                    <IconWrapper\n                      data-comment-noblur\n                      data-comment-no-capture\n                      onMouseDown={navigateToClose}\n                    >\n                      <CompleteNormal />\n                    </IconWrapper>\n                  </Tooltip>\n                </React.Fragment>\n              )}\n            </ArrowWrapper>\n          )}\n        </TitleWrapper>\n        <Panel>{children}</Panel>\n      </React.Fragment>\n    );\n  },\n);\n\nexport default function PopupView(props: PopupViewProps) {\n  const {\n    controller,\n    top,\n    prio,\n    popHeights,\n    updatePosition,\n    isAutoFocus,\n    contentId,\n    configs,\n    isNew,\n    isActive,\n    summary,\n    position,\n    onAdd,\n    onDelete,\n    onCancel,\n  } = props;\n\n  const ref = React.useRef<HTMLDivElement>(null);\n  const zoom = useZoom();\n\n  const handleMouseDown = React.useCallback(\n    (event: React.MouseEvent) => {\n      const { target } = event;\n      const noCaptureAttr = 'data-comment-no-capture';\n      if (\n        target instanceof Element &&\n        !target.closest('.ant-popconfirm') &&\n        !target.closest('.popup-overlay-wrap') &&\n        !target.hasAttribute(noCaptureAttr) &&\n        !target.closest(`[${noCaptureAttr}]`)\n      ) {\n        controller.run('onAction', showComment(contentId));\n      }\n    },\n    [contentId, controller],\n  );\n  const topPx = top + EXTRA_HEIGHT_OFFSET;\n  const style: React.CSSProperties = {\n    top: `${topPx / zoom}px`,\n  };\n  const [isVisible, setIsVisible] = React.useState(isActive);\n  React.useEffect(() => {\n    if (isVisible) {\n      return undefined;\n    }\n    const callback = () => setIsVisible(true);\n    const p = { prio, callback };\n    enqueue(p);\n    return () => {\n      cancelQueue(p);\n    };\n  }, [isVisible, prio]);\n\n  useResizer({\n    ref,\n    updator: updatePosition,\n    popHeights,\n    contentId,\n    isVisible,\n    zoom,\n  });\n  React.useEffect(() => {\n    if (!ref.current) {\n      return undefined;\n    }\n    const domNode = ref.current;\n    const prettier = () => {\n      domNode.style.transition = POPUP_TRANSITION;\n    };\n    const { cancel } = requestIdle(prettier);\n    return cancel;\n  }, [isVisible]);\n  if (!isVisible) {\n    return null;\n  }\n  if (!contentId) {\n    return null;\n  }\n\n  return (\n    <PopupWrapper\n      ref={ref}\n      tabIndex={0}\n      style={style}\n      data-comment-popup\n      data-comment-id={contentId}\n      data-comment-active={isActive}\n      onMouseDownCapture={handleMouseDown}\n      isActive={isActive}\n    >\n      <Popup\n        controller={controller}\n        contentId={contentId}\n        isAutoFocus={isAutoFocus}\n        configs={configs}\n        isNew={isNew}\n        isActive={isActive}\n        summary={summary || configs?.locale?.comment || ''}\n        position={position}\n        onAdd={onAdd}\n        onDelete={onDelete}\n        onCancel={onCancel}\n      />\n    </PopupWrapper>\n  );\n}\n"],"file":"popupView.js"}