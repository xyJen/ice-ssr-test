{"version":3,"sources":["../../../../src/utils/components/Bubbles.tsx"],"names":["IS_MOBILE","environment","Bubbles","styled","div","SIZE","PHWrapper","setBottomMargin","updatePosition","block","children","bubblesRef","React","useRef","phHeight","setHeight","useState","renderKey","updateRenderKey","useReducer","s","onDocSizeChange","useCallback","useEffect","node","current","prev","previousElementSibling","top","nodeTop","getBoundingClientRect","bottom","prevBottom","height","rawHeight","extra","Math","round","style","useMemo"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;uBAH4B,a;AAK5B,MAAM;AAAEA,EAAAA;AAAF,IAAgBC,wBAAtB;;AAEA,MAAMC,OAAO,gBAAGC,0BAAOC,GAAV,0DAGMJ,SAAS,GAAGK,yBAAO,CAAV,GAAcA,yBAAO,CAHpC,CAAb;;AAMA,MAAMC,SAAS,gBAAGH,0BAAOC,GAAV,oDAAf;;AAce,kBAAU;AACvBG,EAAAA,eADuB;AAEvBC,EAAAA,cAFuB;AAGvBC,EAAAA,KAHuB;AAIvBC,EAAAA;AAJuB,CAAV,EAKJ;AACT,QAAMC,UAAU,GAAGC,eAAMC,MAAN,CAA6B,IAA7B,CAAnB;;AACA,QAAM,CAACC,QAAD,EAAWC,SAAX,IAAwBH,eAAMI,QAAN,CAAe,CAAf,CAA9B;;AACA,QAAM,CAACC,SAAD,EAAYC,eAAZ,IAA+BN,eAAMO,UAAN,CAClCC,CAAD,IAAeA,CAAC,GAAG,CADgB,EAEnC,CAFmC,CAArC;;AAIA,QAAMC,eAAe,GAAGT,eAAMU,WAAN,CAAkB,MAAM;AAC9Cd,IAAAA,cAAc;AACdU,IAAAA,eAAe;AAChB,GAHuB,EAGrB,CAACA,eAAD,EAAkBV,cAAlB,CAHqB,CAAxB;;AAIA,8BAAWG,UAAX,EAAuBU,eAAvB;;AACAT,iBAAMW,SAAN,CAAgB,MAAM;AACpB,UAAMC,IAAI,GAAGb,UAAU,CAACc,OAAxB;AACA,UAAMC,IAAI,GAAGf,UAAU,CAACc,OAAX,EAAoBE,sBAAjC;;AACA,QAAI,CAACH,IAAD,IAAS,CAACE,IAAd,EAAoB;AAClB;AACD;;AACD,UAAM;AAAEE,MAAAA,GAAG,EAAEC;AAAP,QAAmBL,IAAI,CAACM,qBAAL,EAAzB;AACA,UAAM;AACJC,MAAAA,MAAM,EAAEC,UADJ;AAEJC,MAAAA,MAAM,EAAEC;AAFJ,QAGFR,IAAI,CAACI,qBAAL,EAHJ;AAIA,UAAMK,KAAK,GAAGC,IAAI,CAACC,KAAL,CAAWR,OAAO,GAAGG,UAArB,CAAd;AACA,UAAMC,MAAM,GAAGG,IAAI,CAACC,KAAL,CAAWH,SAAX,CAAf;;AACA,QAAIC,KAAJ,EAAW;AACT5B,MAAAA,eAAe,CAAC4B,KAAD,CAAf;AACD;;AACD,QAAIrB,QAAQ,KAAKmB,MAAjB,EAAyB;AACvBlB,MAAAA,SAAS,CAACkB,MAAD,CAAT;AACD;AACF,GAnBD,EAmBG,CAACxB,KAAD,EAAQQ,SAAR,CAnBH;;AAoBA,QAAMqB,KAA0B,GAAG1B,eAAM2B,OAAN,CACjC,OAAO;AACLN,IAAAA,MAAM,EAAG,GAAEnB,QAAS;AADf,GAAP,CADiC,EAIjC,CAACA,QAAD,CAJiC,CAAnC;;AAOA,sBACE,eAAC,OAAD;AACE,IAAA,SAAS,EAAC,sBADZ;AAEE,6BAFF;AAGE,IAAA,GAAG,EAAEH;AAHP,KAKG,CAACX,SAAD,iBAAc,eAAC,SAAD;AAAW,IAAA,KAAK,EAAEsC;AAAlB,IALjB,EAMG5B,QANH,CADF;AAUD","sourcesContent":["import React from 'react';\nimport styled from 'styled-components';\nimport { environment, Block } from '@ali/4ever-cangjie';\nimport { BUTTON_SIZE as SIZE } from '../utils/constants';\nimport { useDocSize } from '../hooks/useDocSize';\n\nconst { IS_MOBILE } = environment;\n\nconst Bubbles = styled.div`\n  float: right;\n  position: relative;\n  margin-right: -${IS_MOBILE ? SIZE - 2 : SIZE + 4}px;\n`;\n\nconst PHWrapper = styled.div`\n  position: absolute;\n  width: 28px;\n  bottom: 0;\n  right: 0;\n`;\n\ntype IProps = {\n  setBottomMargin: (m: number) => void;\n  updatePosition: Function;\n  block: Block;\n  children: any;\n};\n\nexport default function ({\n  setBottomMargin,\n  updatePosition,\n  block,\n  children,\n}: IProps) {\n  const bubblesRef = React.useRef<HTMLDivElement>(null);\n  const [phHeight, setHeight] = React.useState(0);\n  const [renderKey, updateRenderKey] = React.useReducer(\n    (s: number) => s + 1,\n    0,\n  );\n  const onDocSizeChange = React.useCallback(() => {\n    updatePosition();\n    updateRenderKey();\n  }, [updateRenderKey, updatePosition]);\n  useDocSize(bubblesRef, onDocSizeChange);\n  React.useEffect(() => {\n    const node = bubblesRef.current;\n    const prev = bubblesRef.current?.previousElementSibling;\n    if (!node || !prev) {\n      return;\n    }\n    const { top: nodeTop } = node.getBoundingClientRect();\n    const {\n      bottom: prevBottom,\n      height: rawHeight,\n    } = prev.getBoundingClientRect();\n    const extra = Math.round(nodeTop - prevBottom);\n    const height = Math.round(rawHeight);\n    if (extra) {\n      setBottomMargin(extra);\n    }\n    if (phHeight !== height) {\n      setHeight(height);\n    }\n  }, [block, renderKey]);\n  const style: React.CSSProperties = React.useMemo(\n    () => ({\n      height: `${phHeight}px`,\n    }),\n    [phHeight],\n  );\n\n  return (\n    <Bubbles\n      className=\"data-comment-bubbles\"\n      data-cache-ignore\n      ref={bubblesRef}\n    >\n      {!IS_MOBILE && <PHWrapper style={style} />}\n      {children}\n    </Bubbles>\n  );\n}\n"],"file":"Bubbles.js"}