"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = useAutoBlur;

var _react = _interopRequireDefault(require("react"));

var _lodash = require("lodash");

var _everCangjie = require("@ali/4ever-cangjie");

var _actions = require("../actions");

var _getActiveId = _interopRequireDefault(require("../queries/getActiveId"));

const EXTRA_SPACE_TOP = 100;
const EXTRA_SPACE_BOTTOM = 80;

function useAutoBlur(controller, enable) {
  const scroller = (0, _everCangjie.useScrollableContainer)();

  _react.default.useEffect(() => {
    if (!enable) {
      return undefined;
    } // eslint-disable-next-line react/no-find-dom-node


    const handleScroll = (0, _lodash.debounce)(() => {
      const activeId = (0, _getActiveId.default)(controller);
      const domNode = window.document.querySelector(`[data-comment-id="${activeId}"]`);

      if (!domNode || !activeId) {
        return;
      }

      const {
        top,
        bottom
      } = domNode.getBoundingClientRect();

      if (bottom < EXTRA_SPACE_TOP || top > window.innerHeight - EXTRA_SPACE_BOTTOM) {
        controller.run('onAction', (0, _actions.setActiveId)(undefined));
      }
    }, 200);
    scroller?.addEventListener('scroll', handleScroll);
    window.addEventListener('resize', handleScroll);
    return () => {
      scroller?.removeEventListener('scroll', handleScroll);
      window.removeEventListener('resize', handleScroll);
    };
  }, [controller, enable]);
}
//# sourceMappingURL=useAutoBlur.js.map