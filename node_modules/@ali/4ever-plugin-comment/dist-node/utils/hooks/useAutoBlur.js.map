{"version":3,"sources":["../../../../src/utils/hooks/useAutoBlur.ts"],"names":["EXTRA_SPACE_TOP","EXTRA_SPACE_BOTTOM","useAutoBlur","controller","enable","scroller","React","useEffect","undefined","handleScroll","activeId","domNode","window","document","querySelector","top","bottom","getBoundingClientRect","innerHeight","run","addEventListener","removeEventListener"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AAIA;;AACA;;AAEA,MAAMA,eAAe,GAAG,GAAxB;AACA,MAAMC,kBAAkB,GAAG,EAA3B;;AAEe,SAASC,WAAT,CAAqBC,UAArB,EAA6CC,MAA7C,EAA+D;AAC5E,QAAMC,QAAQ,GAAG,0CAAjB;;AAEAC,iBAAMC,SAAN,CAAgB,MAAM;AACpB,QAAI,CAACH,MAAL,EAAa;AACX,aAAOI,SAAP;AACD,KAHmB,CAIpB;;;AACA,UAAMC,YAAY,GAAG,sBAAS,MAAM;AAClC,YAAMC,QAAQ,GAAG,0BAAYP,UAAZ,CAAjB;AACA,YAAMQ,OAAO,GAAGC,MAAM,CAACC,QAAP,CAAgBC,aAAhB,CACb,qBAAoBJ,QAAS,IADhB,CAAhB;;AAGA,UAAI,CAACC,OAAD,IAAY,CAACD,QAAjB,EAA2B;AACzB;AACD;;AACD,YAAM;AAAEK,QAAAA,GAAF;AAAOC,QAAAA;AAAP,UAAkBL,OAAO,CAACM,qBAAR,EAAxB;;AACA,UAAID,MAAM,GAAGhB,eAAT,IAA4Be,GAAG,GAAGH,MAAM,CAACM,WAAP,GAAqBjB,kBAA3D,EAA+E;AAC7EE,QAAAA,UAAU,CAACgB,GAAX,CAAe,UAAf,EAA2B,0BAAYX,SAAZ,CAA3B;AACD;AACF,KAZoB,EAYlB,GAZkB,CAArB;AAaAH,IAAAA,QAAQ,EAAEe,gBAAV,CAA2B,QAA3B,EAAqCX,YAArC;AACAG,IAAAA,MAAM,CAACQ,gBAAP,CAAwB,QAAxB,EAAkCX,YAAlC;AACA,WAAO,MAAM;AACXJ,MAAAA,QAAQ,EAAEgB,mBAAV,CAA8B,QAA9B,EAAwCZ,YAAxC;AACAG,MAAAA,MAAM,CAACS,mBAAP,CAA2B,QAA3B,EAAqCZ,YAArC;AACD,KAHD;AAID,GAxBD,EAwBG,CAACN,UAAD,EAAaC,MAAb,CAxBH;AAyBD","sourcesContent":["import React from 'react';\nimport { debounce } from 'lodash-es';\nimport {\n  Controller,\n  useScrollableContainer,\n} from '@ali/4ever-cangjie';\nimport { setActiveId } from '../actions';\nimport getActiveId from '../queries/getActiveId';\n\nconst EXTRA_SPACE_TOP = 100;\nconst EXTRA_SPACE_BOTTOM = 80;\n\nexport default function useAutoBlur(controller: Controller, enable?: boolean) {\n  const scroller = useScrollableContainer();\n\n  React.useEffect(() => {\n    if (!enable) {\n      return undefined;\n    }\n    // eslint-disable-next-line react/no-find-dom-node\n    const handleScroll = debounce(() => {\n      const activeId = getActiveId(controller);\n      const domNode = window.document.querySelector(\n        `[data-comment-id=\"${activeId}\"]`,\n      );\n      if (!domNode || !activeId) {\n        return;\n      }\n      const { top, bottom } = domNode.getBoundingClientRect();\n      if (bottom < EXTRA_SPACE_TOP || top > window.innerHeight - EXTRA_SPACE_BOTTOM) {\n        controller.run('onAction', setActiveId(undefined));\n      }\n    }, 200);\n    scroller?.addEventListener('scroll', handleScroll);\n    window.addEventListener('resize', handleScroll);\n    return () => {\n      scroller?.removeEventListener('scroll', handleScroll);\n      window.removeEventListener('resize', handleScroll);\n    };\n  }, [controller, enable]);\n}\n"],"file":"useAutoBlur.js"}