"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = addNewComment;

var _everCangjie = require("@ali/4ever-cangjie");

var _marks = require("../models/marks");

function addNewComment(controller) {
  const {
    decorations
  } = controller.value;
  const currentDec = decorations.find(dec => _marks.ViewMark.isViewMark(dec.mark) && dec.mark.data.isNew === true);

  if (!currentDec) {
    return;
  } // 在 setComment 之后，marksToDec 中去掉，可以减少一次闪烁。
  // controller.setDecorations(decorations.filter((d) => d !== currentDec));


  const mark = currentDec.mark;
  const anchor = currentDec.start;
  const focus = currentDec.end;
  const {
    contentId
  } = mark.data;

  const dataMark = _marks.DataMark.create({
    contentId
  });

  const range = _everCangjie.Selection.create({
    anchor,
    focus
  });

  if (range.isCollapsed) {
    controller.command(_everCangjie.Commands.addMarkByKey, anchor.key, 0, 0, dataMark);
  } else {
    controller.command(_everCangjie.Commands.addMarkAtRange, range, dataMark);
  }
}
//# sourceMappingURL=addNewComment.js.map