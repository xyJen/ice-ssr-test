{"version":3,"sources":["../../../../src/utils/actions/addNewComment.ts"],"names":["addNewComment","controller","decorations","value","currentDec","find","dec","ViewMark","isViewMark","mark","data","isNew","anchor","start","focus","end","contentId","dataMark","DataMark","create","range","Selection","isCollapsed","command","Commands","addMarkByKey","key","addMarkAtRange"],"mappings":";;;;;;;AAAA;;AACA;;AAEe,SAASA,aAAT,CAAuBC,UAAvB,EAA+C;AAC5D,QAAM;AAAEC,IAAAA;AAAF,MAAkBD,UAAU,CAACE,KAAnC;AACA,QAAMC,UAAU,GAAGF,WAAW,CAACG,IAAZ,CAChBC,GAAD,IAASC,gBAASC,UAAT,CAAoBF,GAAG,CAACG,IAAxB,KAAiCH,GAAG,CAACG,IAAJ,CAASC,IAAT,CAAcC,KAAd,KAAwB,IADjD,CAAnB;;AAGA,MAAI,CAACP,UAAL,EAAiB;AACf;AACD,GAP2D,CAQ5D;AACA;;;AACA,QAAMK,IAAI,GAAGL,UAAU,CAACK,IAAxB;AACA,QAAMG,MAAM,GAAGR,UAAU,CAACS,KAA1B;AACA,QAAMC,KAAK,GAAGV,UAAU,CAACW,GAAzB;AACA,QAAM;AAAEC,IAAAA;AAAF,MAAgBP,IAAI,CAACC,IAA3B;;AACA,QAAMO,QAAQ,GAAGC,gBAASC,MAAT,CAAgB;AAAEH,IAAAA;AAAF,GAAhB,CAAjB;;AACA,QAAMI,KAAK,GAAGC,uBAAUF,MAAV,CAAiB;AAAEP,IAAAA,MAAF;AAAUE,IAAAA;AAAV,GAAjB,CAAd;;AACA,MAAIM,KAAK,CAACE,WAAV,EAAuB;AACrBrB,IAAAA,UAAU,CAACsB,OAAX,CAAmBC,sBAASC,YAA5B,EAA0Cb,MAAM,CAACc,GAAjD,EAAsD,CAAtD,EAAyD,CAAzD,EAA4DT,QAA5D;AACD,GAFD,MAEO;AACLhB,IAAAA,UAAU,CAACsB,OAAX,CAAmBC,sBAASG,cAA5B,EAA4CP,KAA5C,EAAmDH,QAAnD;AACD;AACF","sourcesContent":["import { Commands, Selection, Controller } from '@ali/4ever-cangjie';\nimport { ViewMark, DataMark } from '../models/marks';\n\nexport default function addNewComment(controller: Controller) {\n  const { decorations } = controller.value;\n  const currentDec = decorations.find(\n    (dec) => ViewMark.isViewMark(dec.mark) && dec.mark.data.isNew === true,\n  );\n  if (!currentDec) {\n    return;\n  }\n  // 在 setComment 之后，marksToDec 中去掉，可以减少一次闪烁。\n  // controller.setDecorations(decorations.filter((d) => d !== currentDec));\n  const mark = currentDec.mark as ViewMark;\n  const anchor = currentDec.start;\n  const focus = currentDec.end;\n  const { contentId } = mark.data;\n  const dataMark = DataMark.create({ contentId });\n  const range = Selection.create({ anchor, focus });\n  if (range.isCollapsed) {\n    controller.command(Commands.addMarkByKey, anchor.key, 0, 0, dataMark);\n  } else {\n    controller.command(Commands.addMarkAtRange, range, dataMark);\n  }\n}\n"],"file":"addNewComment.js"}