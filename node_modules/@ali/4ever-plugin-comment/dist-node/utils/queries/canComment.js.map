{"version":3,"sources":["../../../../src/utils/queries/canComment.ts"],"names":["canComment","controller","range","document","value","newRange","selection","convertToTextPoints","Selection","create","isExpanded","anchor","block","getClosestBlock","key","isVoid","query","onlyChild","nodes","length","isText","text","error"],"mappings":";;;;;;;AAAA;;AAEA;AACA;AACA;AACe,SAASA,UAAT,CAAoBC,UAApB,EAA4CC,KAA5C,EAA+D;AAC5E,QAAM;AAAEC,IAAAA;AAAF,MAAeF,UAAU,CAACG,KAAhC;AACA,QAAMC,QAAQ,GAAG,CAACH,KAAK,IAAID,UAAU,CAACG,KAAX,CAAiBE,SAA3B,EAAsCC,mBAAtC,CACfJ,QADe,CAAjB;;AAGA,QAAMG,SAAS,GAAGE,uBAAUC,MAAV,CAAiBJ,QAAjB,CAAlB;;AACA,MAAIC,SAAS,CAACI,UAAd,EAA0B;AACxB,WAAO,IAAP;AACD;;AACD,MAAI;AACF,UAAM;AAAEC,MAAAA;AAAF,QAAaL,SAAnB;AACA,UAAMM,KAAK,GAAGT,QAAQ,CAACU,eAAT,CAAyBF,MAAM,CAACG,GAAhC,CAAd;;AAEA,QAAI,CAACF,KAAL,EAAY;AACV,aAAO,IAAP;AACD;;AACD,UAAMG,MAAM,GAAGd,UAAU,CAACe,KAAX,CAAiB,QAAjB,EAA2BJ,KAA3B,CAAf;AACA,UAAMK,SAAS,GAAG,CAACF,MAAD,IAAWH,KAAK,CAACM,KAAN,CAAYC,MAAZ,KAAuB,CAAlC,IAAuCP,KAAK,CAACM,KAAN,CAAY,CAAZ,CAAzD;;AACA,QAAID,SAAS,IAAIA,SAAS,CAACG,MAAV,EAAb,IAAmC,CAACH,SAAS,CAACI,IAAlD,EAAwD;AACtD,aAAO,KAAP;AACD;AACF,GAZD,CAYE,OAAOC,KAAP,EAAc,CACd;AACD;;AACD,SAAO,IAAP;AACD","sourcesContent":["import { Controller, Selection } from '@ali/4ever-cangjie';\n\n/**\n * 当前 block 是否包含文字或者其它 inline 内容\n */\nexport default function canComment(controller: Controller, range?: Selection) {\n  const { document } = controller.value;\n  const newRange = (range || controller.value.selection).convertToTextPoints(\n    document,\n  );\n  const selection = Selection.create(newRange);\n  if (selection.isExpanded) {\n    return true;\n  }\n  try {\n    const { anchor } = selection;\n    const block = document.getClosestBlock(anchor.key);\n\n    if (!block) {\n      return true;\n    }\n    const isVoid = controller.query('isVoid', block);\n    const onlyChild = !isVoid && block.nodes.length === 1 && block.nodes[0];\n    if (onlyChild && onlyChild.isText() && !onlyChild.text) {\n      return false;\n    }\n  } catch (error) {\n    // ignore\n  }\n  return true;\n}\n"],"file":"canComment.js"}