{"version":3,"sources":["../../../../src/utils/hooks/onAction.tsx"],"names":["Commands","Point","Selection","ACTION_COMMENT_CLICK","ACTION_COMMENT_SHOW","ACTION_COMMENT_ADD","ACTION_COMMENT_CANCEL","ACTION_COMMENT_SET_ID","ACTION_COMMENT_SET_COMMENTS","ACTION_COMMENT_SET_SIDE_BAR","ACTION_COMMENT_SELECTED_NODES","addNewComment","cancelComment","newCommentClick","showComment","setActiveId","setComments","setSidebarVisible","configs","onAction","action","controller","next","type","payload","Error","visible","onSidebarVisibleChange","isDisabled","onDisabled","run","locale","comment","contentId","options","isAutoFocus","onActiveIdChange","comments","selectedNodes","firstNode","lastNode","length","anchor","createFromParams","key","focus","newSelection","create","command","select","dispatch"],"mappings":"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","sourcesContent":["import { Action, Commands, Controller, Point, Selection } from '@ali/4ever-cangjie';\nimport type { NodeSelectToolbarActionPayload } from '@ali/4ever-cangjie';\nimport {\n  ACTION_COMMENT_CLICK,\n  ACTION_COMMENT_SHOW,\n  ACTION_COMMENT_ADD,\n  ACTION_COMMENT_CANCEL,\n  ACTION_COMMENT_SET_ID,\n  ACTION_COMMENT_SET_COMMENTS,\n  ACTION_COMMENT_SET_SIDE_BAR,\n  ACTION_COMMENT_SELECTED_NODES,\n} from '../actions';\nimport { CommentPluginConfigs } from '../types';\nimport addNewComment from '../actions/addNewComment';\nimport cancelComment from '../actions/cancelComment';\nimport newCommentClick from '../actions/newCommentClick';\nimport showComment from '../actions/showComment';\n\nimport setActiveId from '../commands/setActiveId';\nimport setComments from '../commands/setComments';\nimport setSidebarVisible from '../commands/setSidebarVisible';\n\nexport default (configs: CommentPluginConfigs | undefined) => {\n  return function onAction(action: Action, controller: Controller, next) {\n    const { type } = action;\n    /**\n     * 缩放模式下，也要允许设置侧边栏是否可见。不然设置无效，返回后，会出现重叠。\n     */\n    if (type === ACTION_COMMENT_SET_SIDE_BAR) {\n      if (!action.payload) {\n        throw new Error('ACTION_COMMENT_SET_SIDE_BAR: action.payload is empty');\n      }\n      const { visible } = action.payload;\n      setSidebarVisible(controller, visible);\n      const { onSidebarVisibleChange } = configs || {};\n      onSidebarVisibleChange && onSidebarVisibleChange(visible);\n      return next();\n    }\n    if (configs?.isDisabled && configs.isDisabled()) {\n      if (type === ACTION_COMMENT_CLICK) {\n        configs.onDisabled && configs.onDisabled();\n      }\n      return next();\n    }\n    if (type === ACTION_COMMENT_CLICK) {\n      controller.run('onCangjieBlur');\n      newCommentClick(controller, configs?.locale?.comment);\n    } else if (type === ACTION_COMMENT_ADD) {\n      addNewComment(controller);\n    } else if (type === ACTION_COMMENT_SHOW) {\n      showComment(\n        controller,\n        action.payload?.contentId,\n        action.payload?.options,\n        configs,\n      );\n    } else if (type === ACTION_COMMENT_CANCEL) {\n      cancelComment(controller);\n    } else if (type === ACTION_COMMENT_SET_ID) {\n      if (!action.payload) {\n        throw new Error('ACTION_COMMENT_SET_ID: action.payload is empty');\n      }\n      const { contentId, isAutoFocus } = action.payload;\n      setActiveId(controller, contentId, isAutoFocus);\n      const { onActiveIdChange } = configs || {};\n      onActiveIdChange && onActiveIdChange(contentId);\n    } else if (type === ACTION_COMMENT_SET_COMMENTS) {\n      if (!action.payload) {\n        throw new Error('ACTION_COMMENT_SET_COMMENTS: action.payload is empty');\n      }\n      const { comments } = action.payload;\n      setComments(controller, comments);\n    } else if (type === ACTION_COMMENT_SELECTED_NODES) {\n      const { selectedNodes } = action.payload as NodeSelectToolbarActionPayload;\n      const firstNode = selectedNodes[0];\n      const lastNode = selectedNodes[selectedNodes.length - 1];\n      const anchor = Point.createFromParams(firstNode.key, 'before');\n      const focus = Point.createFromParams(lastNode.key, 'after');\n      const newSelection = Selection.create({\n        anchor,\n        focus,\n      });\n      controller.command(Commands.select, newSelection);\n\n      controller.run('onAction', {\n        type: ACTION_COMMENT_CLICK,\n      });\n      controller.dispatch('cancelSelectNode');\n      return controller;\n    }\n    return next();\n  };\n};\n"],"file":"onAction.js"}