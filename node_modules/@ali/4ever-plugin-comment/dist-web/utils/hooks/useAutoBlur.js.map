{"version":3,"sources":["../../../../src/utils/hooks/useAutoBlur.ts"],"names":["React","debounce","useScrollableContainer","setActiveId","getActiveId","EXTRA_SPACE_TOP","EXTRA_SPACE_BOTTOM","useAutoBlur","controller","enable","scroller","useEffect","undefined","handleScroll","activeId","domNode","window","document","querySelector","getBoundingClientRect","top","bottom","innerHeight","run","addEventListener","removeEventListener"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,QAAT,QAAyB,WAAzB;AACA,SAEEC,sBAFF,QAGO,oBAHP;AAIA,SAASC,WAAT;AACA,OAAOC,WAAP;AAEA,IAAMC,eAAe,GAAG,GAAxB;AACA,IAAMC,kBAAkB,GAAG,EAA3B;AAEA,eAAe,SAASC,WAAT,CAAqBC,UAArB,EAA6CC,MAA7C,EAA+D;AAC5E,MAAMC,QAAQ,GAAGR,sBAAsB,EAAvC;AAEAF,EAAAA,KAAK,CAACW,SAAN,CAAgB,YAAM;AACpB,QAAI,CAACF,MAAL,EAAa;AACX,aAAOG,SAAP;AACD,KAHmB,CAIpB;;;AACA,QAAMC,YAAY,GAAGZ,QAAQ,CAAC,YAAM;AAClC,UAAMa,QAAQ,GAAGV,WAAW,CAACI,UAAD,CAA5B;AACA,UAAMO,OAAO,GAAGC,MAAM,CAACC,QAAP,CAAgBC,aAAhB,yBACOJ,QADP,SAAhB;;AAGA,UAAI,CAACC,OAAD,IAAY,CAACD,QAAjB,EAA2B;AACzB;AACD;;AAPiC,kCAQVC,OAAO,CAACI,qBAAR,EARU;AAAA,UAQ1BC,GAR0B,yBAQ1BA,GAR0B;AAAA,UAQrBC,MARqB,yBAQrBA,MARqB;;AASlC,UAAIA,MAAM,GAAGhB,eAAT,IAA4Be,GAAG,GAAGJ,MAAM,CAACM,WAAP,GAAqBhB,kBAA3D,EAA+E;AAC7EE,QAAAA,UAAU,CAACe,GAAX,CAAe,UAAf,EAA2BpB,WAAW,CAACS,SAAD,CAAtC;AACD;AACF,KAZ4B,EAY1B,GAZ0B,CAA7B;AAaAF,IAAAA,QAAQ,QAAR,YAAAA,QAAQ,CAAEc,gBAAV,CAA2B,QAA3B,EAAqCX,YAArC;AACAG,IAAAA,MAAM,CAACQ,gBAAP,CAAwB,QAAxB,EAAkCX,YAAlC;AACA,WAAO,YAAM;AACXH,MAAAA,QAAQ,QAAR,YAAAA,QAAQ,CAAEe,mBAAV,CAA8B,QAA9B,EAAwCZ,YAAxC;AACAG,MAAAA,MAAM,CAACS,mBAAP,CAA2B,QAA3B,EAAqCZ,YAArC;AACD,KAHD;AAID,GAxBD,EAwBG,CAACL,UAAD,EAAaC,MAAb,CAxBH;AAyBD","sourcesContent":["import React from 'react';\nimport { debounce } from 'lodash-es';\nimport {\n  Controller,\n  useScrollableContainer,\n} from '@ali/4ever-cangjie';\nimport { setActiveId } from '../actions';\nimport getActiveId from '../queries/getActiveId';\n\nconst EXTRA_SPACE_TOP = 100;\nconst EXTRA_SPACE_BOTTOM = 80;\n\nexport default function useAutoBlur(controller: Controller, enable?: boolean) {\n  const scroller = useScrollableContainer();\n\n  React.useEffect(() => {\n    if (!enable) {\n      return undefined;\n    }\n    // eslint-disable-next-line react/no-find-dom-node\n    const handleScroll = debounce(() => {\n      const activeId = getActiveId(controller);\n      const domNode = window.document.querySelector(\n        `[data-comment-id=\"${activeId}\"]`,\n      );\n      if (!domNode || !activeId) {\n        return;\n      }\n      const { top, bottom } = domNode.getBoundingClientRect();\n      if (bottom < EXTRA_SPACE_TOP || top > window.innerHeight - EXTRA_SPACE_BOTTOM) {\n        controller.run('onAction', setActiveId(undefined));\n      }\n    }, 200);\n    scroller?.addEventListener('scroll', handleScroll);\n    window.addEventListener('resize', handleScroll);\n    return () => {\n      scroller?.removeEventListener('scroll', handleScroll);\n      window.removeEventListener('resize', handleScroll);\n    };\n  }, [controller, enable]);\n}\n"],"file":"useAutoBlur.js"}