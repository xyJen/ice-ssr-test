import React from 'react';
import { debounce } from 'lodash-es';
import { useScrollableContainer } from '@ali/4ever-cangjie';
import { setActiveId } from "../actions";
import getActiveId from "../queries/getActiveId";
var EXTRA_SPACE_TOP = 100;
var EXTRA_SPACE_BOTTOM = 80;
export default function useAutoBlur(controller, enable) {
  var scroller = useScrollableContainer();
  React.useEffect(function () {
    if (!enable) {
      return undefined;
    } // eslint-disable-next-line react/no-find-dom-node


    var handleScroll = debounce(function () {
      var activeId = getActiveId(controller);
      var domNode = window.document.querySelector("[data-comment-id=\"" + activeId + "\"]");

      if (!domNode || !activeId) {
        return;
      }

      var _domNode$getBoundingC = domNode.getBoundingClientRect(),
          top = _domNode$getBoundingC.top,
          bottom = _domNode$getBoundingC.bottom;

      if (bottom < EXTRA_SPACE_TOP || top > window.innerHeight - EXTRA_SPACE_BOTTOM) {
        controller.run('onAction', setActiveId(undefined));
      }
    }, 200);
    scroller == null ? void 0 : scroller.addEventListener('scroll', handleScroll);
    window.addEventListener('resize', handleScroll);
    return function () {
      scroller == null ? void 0 : scroller.removeEventListener('scroll', handleScroll);
      window.removeEventListener('resize', handleScroll);
    };
  }, [controller, enable]);
}
//# sourceMappingURL=useAutoBlur.js.map