{"version":3,"sources":["../../../../src/utils/actions/addNewComment.ts"],"names":["Commands","Selection","ViewMark","DataMark","addNewComment","controller","decorations","value","currentDec","find","dec","isViewMark","mark","data","isNew","anchor","start","focus","end","contentId","dataMark","create","range","isCollapsed","command","addMarkByKey","key","addMarkAtRange"],"mappings":"AAAA,SAASA,QAAT,EAAmBC,SAAnB,QAAgD,oBAAhD;AACA,SAASC,QAAT,EAAmBC,QAAnB;AAEA,eAAe,SAASC,aAAT,CAAuBC,UAAvB,EAA+C;AAAA,MACpDC,WADoD,GACpCD,UAAU,CAACE,KADyB,CACpDD,WADoD;AAE5D,MAAME,UAAU,GAAGF,WAAW,CAACG,IAAZ,CACjB,UAACC,GAAD;AAAA,WAASR,QAAQ,CAACS,UAAT,CAAoBD,GAAG,CAACE,IAAxB,KAAiCF,GAAG,CAACE,IAAJ,CAASC,IAAT,CAAcC,KAAd,KAAwB,IAAlE;AAAA,GADiB,CAAnB;;AAGA,MAAI,CAACN,UAAL,EAAiB;AACf;AACD,GAP2D,CAQ5D;AACA;;;AACA,MAAMI,IAAI,GAAGJ,UAAU,CAACI,IAAxB;AACA,MAAMG,MAAM,GAAGP,UAAU,CAACQ,KAA1B;AACA,MAAMC,KAAK,GAAGT,UAAU,CAACU,GAAzB;AAZ4D,MAapDC,SAboD,GAatCP,IAAI,CAACC,IAbiC,CAapDM,SAboD;AAc5D,MAAMC,QAAQ,GAAGjB,QAAQ,CAACkB,MAAT,CAAgB;AAAEF,IAAAA,SAAS,EAATA;AAAF,GAAhB,CAAjB;AACA,MAAMG,KAAK,GAAGrB,SAAS,CAACoB,MAAV,CAAiB;AAAEN,IAAAA,MAAM,EAANA,MAAF;AAAUE,IAAAA,KAAK,EAALA;AAAV,GAAjB,CAAd;;AACA,MAAIK,KAAK,CAACC,WAAV,EAAuB;AACrBlB,IAAAA,UAAU,CAACmB,OAAX,CAAmBxB,QAAQ,CAACyB,YAA5B,EAA0CV,MAAM,CAACW,GAAjD,EAAsD,CAAtD,EAAyD,CAAzD,EAA4DN,QAA5D;AACD,GAFD,MAEO;AACLf,IAAAA,UAAU,CAACmB,OAAX,CAAmBxB,QAAQ,CAAC2B,cAA5B,EAA4CL,KAA5C,EAAmDF,QAAnD;AACD;AACF","sourcesContent":["import { Commands, Selection, Controller } from '@ali/4ever-cangjie';\nimport { ViewMark, DataMark } from '../models/marks';\n\nexport default function addNewComment(controller: Controller) {\n  const { decorations } = controller.value;\n  const currentDec = decorations.find(\n    (dec) => ViewMark.isViewMark(dec.mark) && dec.mark.data.isNew === true,\n  );\n  if (!currentDec) {\n    return;\n  }\n  // 在 setComment 之后，marksToDec 中去掉，可以减少一次闪烁。\n  // controller.setDecorations(decorations.filter((d) => d !== currentDec));\n  const mark = currentDec.mark as ViewMark;\n  const anchor = currentDec.start;\n  const focus = currentDec.end;\n  const { contentId } = mark.data;\n  const dataMark = DataMark.create({ contentId });\n  const range = Selection.create({ anchor, focus });\n  if (range.isCollapsed) {\n    controller.command(Commands.addMarkByKey, anchor.key, 0, 0, dataMark);\n  } else {\n    controller.command(Commands.addMarkAtRange, range, dataMark);\n  }\n}\n"],"file":"addNewComment.js"}