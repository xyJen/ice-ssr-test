import { Commands, Selection } from '@ali/4ever-cangjie';
import { ViewMark, DataMark } from "../models/marks";
export default function addNewComment(controller) {
  var decorations = controller.value.decorations;
  var currentDec = decorations.find(function (dec) {
    return ViewMark.isViewMark(dec.mark) && dec.mark.data.isNew === true;
  });

  if (!currentDec) {
    return;
  } // 在 setComment 之后，marksToDec 中去掉，可以减少一次闪烁。
  // controller.setDecorations(decorations.filter((d) => d !== currentDec));


  var mark = currentDec.mark;
  var anchor = currentDec.start;
  var focus = currentDec.end;
  var contentId = mark.data.contentId;
  var dataMark = DataMark.create({
    contentId: contentId
  });
  var range = Selection.create({
    anchor: anchor,
    focus: focus
  });

  if (range.isCollapsed) {
    controller.command(Commands.addMarkByKey, anchor.key, 0, 0, dataMark);
  } else {
    controller.command(Commands.addMarkAtRange, range, dataMark);
  }
}
//# sourceMappingURL=addNewComment.js.map