{"version":3,"sources":["../../../../src/utils/components/markView.tsx"],"names":["React","environment","styled","COLOR","COLOR_ACTIVE","COLOR_UNDERLINE","isSidebarVisible","setActiveId","setSidebarVisible","showComment","IS_MOBILE","MarkWrapper","span","ReadOnlyMarkWrapper","VoidMarkWrapper","VoidActiveWrapper","VoidBlockWrapper","div","isActive","VoidBlockPH","MarkView","mark","children","controller","showInline","customClick","data","contentId","isNew","readOnly","style","backgroundColor","handleClick","useCallback","isSideBarShowing","run","View","extraProps","VoidMarkView","props","nextElements","isBlock","isDisabled","nodeKey","hideAll","Boolean"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Controller, environment } from '@ali/4ever-cangjie';\nimport styled from 'styled-components';\nimport { COLOR, COLOR_ACTIVE, COLOR_UNDERLINE } from '../constants';\nimport { ViewMark } from '../models/marks';\nimport isSidebarVisible from '../queries/isSidebarVisible';\nimport { setActiveId, setSidebarVisible, showComment } from '../actions';\n\nconst { IS_MOBILE } = environment;\n\ninterface MarkViewProps {\n  mark: ViewMark;\n  showInline?: boolean;\n  controller: Controller;\n  children: any;\n  customClick?: (contentId: string) => void;\n}\n\ninterface VoidMarkViewProps {\n  mark: ViewMark | undefined;\n  isBlock: boolean;\n  nodeKey: string;\n  isDisabled?: boolean;\n  nextElements: any;\n}\n\nconst MarkWrapper = styled.span`\n  border-bottom: 2px solid ${COLOR_UNDERLINE};\n`;\n\nconst ReadOnlyMarkWrapper = styled(MarkWrapper)`\n  cursor: pointer;\n  transition: background 0.25s;\n  &:hover {\n    background-color: ${COLOR};\n  }\n`;\n\nconst VoidMarkWrapper = styled.span`\n  width: 100%;\n  height: 2px;\n  position: absolute;\n  bottom: -2px;\n  left: 0px;\n  background-color: ${COLOR_UNDERLINE};\n`;\n\nconst VoidActiveWrapper = styled(VoidMarkWrapper)`\n  height: 100%;\n  min-height: 3px;\n  bottom: -2px;\n  background: ${COLOR_ACTIVE};\n  border-bottom: 2px solid ${COLOR_UNDERLINE};\n  pointer-events: none;\n`;\n\nconst VoidBlockWrapper = styled.div<{ isActive: boolean }>`\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n  height: 0;\n  border-bottom: 2px solid ${COLOR_UNDERLINE};\n  box-sizing: content-box;\n  border-top: ${({ isActive }) =>\n    isActive ? `4px solid ${COLOR_ACTIVE}` : 'none'};\n`;\n\nconst VoidBlockPH = styled.div<{ isActive: boolean }>`\n  margin-top: ${({ isActive }) => (isActive ? '8px' : '4px')};\n  position: relative;\n`;\n\n/**\n * Mark 渲染\n */\nexport function MarkView({ mark, children, controller, showInline, customClick }: MarkViewProps) {\n  const { contentId, isActive, isNew } = mark.data;\n  const { readOnly } = controller;\n  const style: React.CSSProperties = {};\n  if (isActive || isNew) {\n    style.backgroundColor = COLOR_ACTIVE;\n  }\n  const handleClick = React.useCallback(() => {\n    if (customClick) {\n      return customClick(contentId);\n    }\n    const isSideBarShowing = isSidebarVisible(controller);\n    // 编辑视图 + 右侧没打开，就 ignore 了。\n    if (!controller.readOnly && !isSideBarShowing) {\n      return;\n    }\n    if (!controller.readOnly && showInline) {\n      return;\n    }\n    if (IS_MOBILE) {\n      controller.run('onAction', showComment(contentId));\n    } else {\n      controller.run('onAction', setActiveId(contentId, controller.readOnly));\n      !isSideBarShowing && controller.run('onAction', setSidebarVisible(true));\n    }\n  }, [controller, contentId, showInline]);\n\n  const View = readOnly ? ReadOnlyMarkWrapper : MarkWrapper;\n  const extraProps = readOnly ? { 'data-comment-noblur': true } : {};\n  return (\n    <View\n      {...extraProps}\n      data-comment={contentId}\n      onClick={handleClick}\n      style={style}\n    >\n      {children}\n    </View>\n  );\n}\n\n/**\n * Void 类型的 Mark 渲染\n */\nexport function VoidMarkView(props: VoidMarkViewProps) {\n  const { nextElements, mark, isBlock, isDisabled, nodeKey } = props;\n  const hideAll = Boolean(isDisabled || !mark);\n  const isActive = Boolean(mark?.data.isActive);\n  const extraProps = {\n    'data-comment-void': mark?.data.contentId,\n    // 节点 key。由于 dom 位置调整，从 dom 结构上找 key 不可靠，因此这里自己传入了一个\n    'data-comment-nodekey': nodeKey,\n  };\n  return (\n    <React.Fragment>\n      {nextElements}\n      {!hideAll && isBlock && (\n        <VoidBlockPH isActive={isActive}>\n          <VoidBlockWrapper isActive={isActive} {...extraProps} />\n        </VoidBlockPH>\n      )}\n      {!hideAll && !isBlock && isActive && (\n        <VoidActiveWrapper {...extraProps} />\n      )}\n      {!hideAll && !isBlock && !isActive && <VoidMarkWrapper {...extraProps} />}\n    </React.Fragment>\n  );\n}\n"],"file":"markView.js"}