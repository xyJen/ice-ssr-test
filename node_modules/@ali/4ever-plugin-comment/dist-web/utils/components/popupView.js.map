{"version":3,"sources":["../../../../src/utils/components/popupView.tsx"],"names":["React","styled","useZoom","Tooltip","CompleteNormal","ToolbarArrowDownNormal","SimplePopup","useResizer","showComment","getSiblings","blockEvent","tipStyle","cancelQueue","enqueue","requestIdle","SCROLL_HEIGHT_PERCENT_SIDEBAR","EXTRA_HEIGHT_OFFSET","TRANSITION_WAIT_TIME","POPUP_TRANSITION","ToolbarArrowUpNormal","PopupWrapper","div","props","isActive","TitleRef","Title","ArrowWrapper","visible","TitleWrapper","IconWrapper","isDisabled","Spliter","Panel","Popup","memo","controller","contentId","configs","isNew","isAutoFocus","summary","position","onAdd","onDelete","onCancel","sendComment","getCommentList","renderPopup","closeComment","query","prev","next","children","canCloseComment","readonlyPosition","readOnly","undefined","renderProps","navigateToPrev","useCallback","event","heightPercent","run","navigateToNext","navigateToClose","preventDefault","stopPropagation","locale","PopupView","top","prio","popHeights","updatePosition","ref","useRef","zoom","handleMouseDown","target","noCaptureAttr","Element","closest","hasAttribute","topPx","style","useState","isVisible","setIsVisible","useEffect","callback","p","updator","current","domNode","prettier","transition","cancel","comment"],"mappings":"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","sourcesContent":["import React from 'react';\nimport styled from 'styled-components';\nimport { Controller, useZoom } from '@ali/4ever-cangjie';\nimport { Tooltip } from '@ali/we-design';\nimport { CompleteNormal, ToolbarArrowDownNormal } from '@ali/we-icon';\nimport { CommentPluginConfigs, RenderPopupProps } from '../types';\nimport SimplePopup from './simplePopup';\nimport useResizer from '../utils/useResizer';\nimport { showComment } from '../actions';\nimport getSiblings from '../queries/getSiblings';\nimport blockEvent from '../utils/blockEvent';\nimport { tipStyle } from '../common';\nimport { cancelQueue, enqueue } from '../common/pendingIDs';\nimport requestIdle from '../utils/requestIdle';\nimport { SCROLL_HEIGHT_PERCENT_SIDEBAR } from '../constants';\n\nconst EXTRA_HEIGHT_OFFSET = -14;\nconst TRANSITION_WAIT_TIME = 1000;\nconst POPUP_TRANSITION = 'border 0.25s, box-shadow 0.25s, top 0.25s';\n\nconst ToolbarArrowUpNormal = styled(ToolbarArrowDownNormal)`\n  transform: rotate(180deg);\n`;\n\nconst PopupWrapper = styled.div<{ isActive: boolean }>`\n  position: absolute;\n  -webkit-font-smoothing: antialiased;\n  width: calc(100% - 28px);\n  left: 0px;\n  margin: 14px;\n  background-color: white;\n  border: 1px solid\n    ${(props) => (props.isActive ? '#0089FF' : 'rgba(126, 134, 142, 0.16)')};\n  border-radius: 8px;\n  overflow: hidden;\n  cursor: ${(props) => (props.isActive ? 'initial' : 'pointer')};\n  box-sizing: border-box;\n  box-shadow: ${(props) =>\n    props.isActive\n      ? '0px 0px 1px rgba(0, 0, 0, 0.24), 0px 8px 24px rgba(0, 0, 0, 0.16)'\n      : 'none'};\n  &:focus {\n    outline: none;\n  }\n  &:hover {\n    border: 1px solid ${(props) => (props.isActive ? '#0089FF' : 'white')};\n    box-shadow: 0px 0px 1px rgba(0, 0, 0, 0.24),\n      0px 8px 24px rgba(0, 0, 0, 0.16);\n  }\n  & article[data-cangjie-content] {\n    padding: 0;\n  }\n`;\n\nconst TitleRef = styled.div`\n  width: 2px;\n  height: 14px;\n  background-color: #171a1d;\n  opacity: 0.24;\n  margin-right: 4px;\n`;\n\nconst Title = styled.div`\n  flex: 1;\n  padding-right: 8px;\n  font-size: 14px;\n  height: 26px;\n  line-height: 26px;\n  opacity: 0.6;\n  color: #171a1d;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nconst ArrowWrapper = styled.div<{ visible: boolean }>`\n  opacity: ${(props) => (props.visible ? '1' : '0')};\n  height: 24px;\n  border: 1px solid rgba(126, 134, 142, 0.16);\n  border-radius: 4px;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n`;\n\nconst TitleWrapper = styled.div`\n  padding: 12px 16px;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  &:hover ${ArrowWrapper} {\n    opacity: 1;\n  }\n`;\n\nconst IconWrapper = styled.div<{ isDisabled?: boolean }>`\n  height: 24px;\n  width: 24px;\n  flex: 1;\n  display: flex;\n  cursor: pointer;\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n  color: ${(props) =>\n    props.isDisabled ? 'rgba(23, 26, 29, 0.24)' : '#171A1D'};\n  &:hover {\n    background: ${(props) =>\n      props.isDisabled ? 'transparent' : 'rgba(126, 134, 142, 0.12)'};\n  }\n  & > span {\n    font-size: 20px;\n  }\n`;\n\nconst Spliter = styled.div`\n  width: 1px;\n  height: 22px;\n  background: rgba(126, 134, 142, 0.16);\n`;\n\nconst Panel = styled.div``;\n\ninterface PopupViewProps {\n  controller: Controller;\n  top: number;\n  prio: number;\n  popHeights: Record<string, number>;\n  isNew: boolean;\n  isActive: boolean;\n  contentId: string;\n  summary: string;\n  position?: string;\n  isAutoFocus: boolean;\n  updatePosition: () => void;\n  configs?: CommentPluginConfigs;\n  onAdd: () => void;\n  onDelete: () => void;\n  onCancel: () => void;\n}\n\nconst Popup = React.memo(\n  (\n    props: Omit<\n      PopupViewProps,\n      'top' | 'updatePosition' | 'prio' | 'popHeights'\n    >,\n  ) => {\n    const {\n      controller,\n      contentId,\n      configs,\n      isNew,\n      isAutoFocus,\n      isActive,\n      summary,\n      position,\n      onAdd,\n      onDelete,\n      onCancel,\n    } = props;\n    const { sendComment, getCommentList, renderPopup, closeComment } =\n      configs || {};\n    const { prev, next } = controller.query(getSiblings);\n\n    let children: JSX.Element | undefined;\n    const canCloseComment = !!closeComment;\n    const readonlyPosition = controller.readOnly ? position : undefined;\n    const renderProps: RenderPopupProps = {\n      contentId,\n      isNew,\n      isAutoFocus,\n      isActive,\n      summary,\n      readonlyPosition,\n      onAdd,\n      onDelete,\n      onCancel: isNew ? onCancel : undefined,\n    };\n    const navigateToPrev = React.useCallback(\n      (event: React.MouseEvent) => {\n        if (prev) {\n          const heightPercent = SCROLL_HEIGHT_PERCENT_SIDEBAR;\n          controller.run('onAction', showComment(prev, { heightPercent }));\n        }\n        blockEvent(event);\n      },\n      [controller, prev],\n    );\n    const navigateToNext = React.useCallback(\n      (event: React.MouseEvent) => {\n        if (next) {\n          const heightPercent = SCROLL_HEIGHT_PERCENT_SIDEBAR;\n          controller.run('onAction', showComment(next, { heightPercent }));\n        }\n        blockEvent(event);\n      },\n      [controller, next],\n    );\n    const navigateToClose = React.useCallback(\n      (event: React.MouseEvent) => {\n        event.preventDefault();\n        event.stopPropagation();\n        closeComment && closeComment(contentId);\n      },\n      [closeComment, contentId],\n    );\n\n    if (renderPopup) {\n      children = renderPopup(renderProps);\n    } else {\n      children = (\n        <SimplePopup\n          sendComment={sendComment}\n          getCommentList={getCommentList}\n          {...renderProps}\n        />\n      );\n    }\n\n    return (\n      <React.Fragment>\n        <TitleWrapper>\n          <TitleRef />\n          <Title>{summary}</Title>\n          {!isNew && (\n            <ArrowWrapper visible={isActive}>\n              {isActive && (\n                <Tooltip\n                  overlayStyle={tipStyle}\n                  title={configs?.locale?.prev || 'Prev'}\n                  placement=\"top\"\n                >\n                  <IconWrapper isDisabled={!prev} onClick={navigateToPrev}>\n                    <ToolbarArrowUpNormal />\n                  </IconWrapper>\n                </Tooltip>\n              )}\n              {isActive && !canCloseComment && <Spliter />}\n              {isActive && (\n                <Tooltip\n                  overlayStyle={tipStyle}\n                  title={configs?.locale?.next || 'Next'}\n                  placement=\"top\"\n                >\n                  <IconWrapper isDisabled={!next} onClick={navigateToNext}>\n                    <ToolbarArrowDownNormal />\n                  </IconWrapper>\n                </Tooltip>\n              )}\n\n              {canCloseComment && (\n                <React.Fragment>\n                  {isActive && <Spliter />}\n                  <Tooltip\n                    overlayStyle={tipStyle}\n                    title={\n                      configs?.locale?.closeComment ||\n                      'Resolve and hide comments'\n                    }\n                    placement=\"top\"\n                  >\n                    <IconWrapper\n                      data-comment-noblur\n                      data-comment-no-capture\n                      onMouseDown={navigateToClose}\n                    >\n                      <CompleteNormal />\n                    </IconWrapper>\n                  </Tooltip>\n                </React.Fragment>\n              )}\n            </ArrowWrapper>\n          )}\n        </TitleWrapper>\n        <Panel>{children}</Panel>\n      </React.Fragment>\n    );\n  },\n);\n\nexport default function PopupView(props: PopupViewProps) {\n  const {\n    controller,\n    top,\n    prio,\n    popHeights,\n    updatePosition,\n    isAutoFocus,\n    contentId,\n    configs,\n    isNew,\n    isActive,\n    summary,\n    position,\n    onAdd,\n    onDelete,\n    onCancel,\n  } = props;\n\n  const ref = React.useRef<HTMLDivElement>(null);\n  const zoom = useZoom();\n\n  const handleMouseDown = React.useCallback(\n    (event: React.MouseEvent) => {\n      const { target } = event;\n      const noCaptureAttr = 'data-comment-no-capture';\n      if (\n        target instanceof Element &&\n        !target.closest('.ant-popconfirm') &&\n        !target.closest('.popup-overlay-wrap') &&\n        !target.hasAttribute(noCaptureAttr) &&\n        !target.closest(`[${noCaptureAttr}]`)\n      ) {\n        controller.run('onAction', showComment(contentId));\n      }\n    },\n    [contentId, controller],\n  );\n  const topPx = top + EXTRA_HEIGHT_OFFSET;\n  const style: React.CSSProperties = {\n    top: `${topPx / zoom}px`,\n  };\n  const [isVisible, setIsVisible] = React.useState(isActive);\n  React.useEffect(() => {\n    if (isVisible) {\n      return undefined;\n    }\n    const callback = () => setIsVisible(true);\n    const p = { prio, callback };\n    enqueue(p);\n    return () => {\n      cancelQueue(p);\n    };\n  }, [isVisible, prio]);\n\n  useResizer({\n    ref,\n    updator: updatePosition,\n    popHeights,\n    contentId,\n    isVisible,\n    zoom,\n  });\n  React.useEffect(() => {\n    if (!ref.current) {\n      return undefined;\n    }\n    const domNode = ref.current;\n    const prettier = () => {\n      domNode.style.transition = POPUP_TRANSITION;\n    };\n    const { cancel } = requestIdle(prettier);\n    return cancel;\n  }, [isVisible]);\n  if (!isVisible) {\n    return null;\n  }\n  if (!contentId) {\n    return null;\n  }\n\n  return (\n    <PopupWrapper\n      ref={ref}\n      tabIndex={0}\n      style={style}\n      data-comment-popup\n      data-comment-id={contentId}\n      data-comment-active={isActive}\n      onMouseDownCapture={handleMouseDown}\n      isActive={isActive}\n    >\n      <Popup\n        controller={controller}\n        contentId={contentId}\n        isAutoFocus={isAutoFocus}\n        configs={configs}\n        isNew={isNew}\n        isActive={isActive}\n        summary={summary || configs?.locale?.comment || ''}\n        position={position}\n        onAdd={onAdd}\n        onDelete={onDelete}\n        onCancel={onCancel}\n      />\n    </PopupWrapper>\n  );\n}\n"],"file":"popupView.js"}