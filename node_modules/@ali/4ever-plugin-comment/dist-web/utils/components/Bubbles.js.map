{"version":3,"sources":["../../../../src/utils/components/Bubbles.tsx"],"names":["React","styled","environment","BUTTON_SIZE","SIZE","useDocSize","IS_MOBILE","Bubbles","div","PHWrapper","setBottomMargin","updatePosition","block","children","bubblesRef","useRef","useState","phHeight","setHeight","useReducer","s","renderKey","updateRenderKey","onDocSizeChange","useCallback","useEffect","node","current","prev","previousElementSibling","getBoundingClientRect","nodeTop","top","prevBottom","bottom","rawHeight","height","extra","Math","round","style","useMemo"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;qBAC4B,a;AAA5B,OAAOC,MAAP,MAAmB,mBAAnB;AACA,SAASC,WAAT,QAAmC,oBAAnC;AACA,SAASC,WAAW,IAAIC,IAAxB;AACA,SAASC,UAAT;IAEQC,S,GAAcJ,W,CAAdI,S;AAER,IAAMC,OAAO,gBAAGN,MAAM,CAACO,GAAV,0DAGMF,SAAS,GAAGF,IAAI,GAAG,CAAV,GAAcA,IAAI,GAAG,CAHpC,CAAb;AAMA,IAAMK,SAAS,gBAAGR,MAAM,CAACO,GAAV,oDAAf;AAcA,eAAe,gBAKJ;AAAA,MAJTE,eAIS,QAJTA,eAIS;AAAA,MAHTC,cAGS,QAHTA,cAGS;AAAA,MAFTC,KAES,QAFTA,KAES;AAAA,MADTC,QACS,QADTA,QACS;AACT,MAAMC,UAAU,GAAGd,KAAK,CAACe,MAAN,CAA6B,IAA7B,CAAnB;;AADS,wBAEqBf,KAAK,CAACgB,QAAN,CAAe,CAAf,CAFrB;AAAA,MAEFC,QAFE;AAAA,MAEQC,SAFR;;AAAA,0BAG4BlB,KAAK,CAACmB,UAAN,CACnC,UAACC,CAAD;AAAA,WAAeA,CAAC,GAAG,CAAnB;AAAA,GADmC,EAEnC,CAFmC,CAH5B;AAAA,MAGFC,SAHE;AAAA,MAGSC,eAHT;;AAOT,MAAMC,eAAe,GAAGvB,KAAK,CAACwB,WAAN,CAAkB,YAAM;AAC9Cb,IAAAA,cAAc;AACdW,IAAAA,eAAe;AAChB,GAHuB,EAGrB,CAACA,eAAD,EAAkBX,cAAlB,CAHqB,CAAxB;AAIAN,EAAAA,UAAU,CAACS,UAAD,EAAaS,eAAb,CAAV;AACAvB,EAAAA,KAAK,CAACyB,SAAN,CAAgB,YAAM;AAAA;;AACpB,QAAMC,IAAI,GAAGZ,UAAU,CAACa,OAAxB;AACA,QAAMC,IAAI,0BAAGd,UAAU,CAACa,OAAd,qBAAG,oBAAoBE,sBAAjC;;AACA,QAAI,CAACH,IAAD,IAAS,CAACE,IAAd,EAAoB;AAClB;AACD;;AALmB,gCAMKF,IAAI,CAACI,qBAAL,EANL;AAAA,QAMPC,OANO,yBAMZC,GANY;;AAAA,gCAUhBJ,IAAI,CAACE,qBAAL,EAVgB;AAAA,QAQVG,UARU,yBAQlBC,MARkB;AAAA,QASVC,SATU,yBASlBC,MATkB;;AAWpB,QAAMC,KAAK,GAAGC,IAAI,CAACC,KAAL,CAAWR,OAAO,GAAGE,UAArB,CAAd;AACA,QAAMG,MAAM,GAAGE,IAAI,CAACC,KAAL,CAAWJ,SAAX,CAAf;;AACA,QAAIE,KAAJ,EAAW;AACT3B,MAAAA,eAAe,CAAC2B,KAAD,CAAf;AACD;;AACD,QAAIpB,QAAQ,KAAKmB,MAAjB,EAAyB;AACvBlB,MAAAA,SAAS,CAACkB,MAAD,CAAT;AACD;AACF,GAnBD,EAmBG,CAACxB,KAAD,EAAQS,SAAR,CAnBH;AAoBA,MAAMmB,KAA0B,GAAGxC,KAAK,CAACyC,OAAN,CACjC;AAAA,WAAO;AACLL,MAAAA,MAAM,EAAKnB,QAAL;AADD,KAAP;AAAA,GADiC,EAIjC,CAACA,QAAD,CAJiC,CAAnC;AAOA,sBACE,eAAC,OAAD;AACE,IAAA,SAAS,EAAC,sBADZ;AAEE,6BAFF;AAGE,IAAA,GAAG,EAAEH;AAHP,KAKG,CAACR,SAAD,iBAAc,eAAC,SAAD;AAAW,IAAA,KAAK,EAAEkC;AAAlB,IALjB,EAMG3B,QANH,CADF;AAUD","sourcesContent":["import React from 'react';\nimport styled from 'styled-components';\nimport { environment, Block } from '@ali/4ever-cangjie';\nimport { BUTTON_SIZE as SIZE } from '../utils/constants';\nimport { useDocSize } from '../hooks/useDocSize';\n\nconst { IS_MOBILE } = environment;\n\nconst Bubbles = styled.div`\n  float: right;\n  position: relative;\n  margin-right: -${IS_MOBILE ? SIZE - 2 : SIZE + 4}px;\n`;\n\nconst PHWrapper = styled.div`\n  position: absolute;\n  width: 28px;\n  bottom: 0;\n  right: 0;\n`;\n\ntype IProps = {\n  setBottomMargin: (m: number) => void;\n  updatePosition: Function;\n  block: Block;\n  children: any;\n};\n\nexport default function ({\n  setBottomMargin,\n  updatePosition,\n  block,\n  children,\n}: IProps) {\n  const bubblesRef = React.useRef<HTMLDivElement>(null);\n  const [phHeight, setHeight] = React.useState(0);\n  const [renderKey, updateRenderKey] = React.useReducer(\n    (s: number) => s + 1,\n    0,\n  );\n  const onDocSizeChange = React.useCallback(() => {\n    updatePosition();\n    updateRenderKey();\n  }, [updateRenderKey, updatePosition]);\n  useDocSize(bubblesRef, onDocSizeChange);\n  React.useEffect(() => {\n    const node = bubblesRef.current;\n    const prev = bubblesRef.current?.previousElementSibling;\n    if (!node || !prev) {\n      return;\n    }\n    const { top: nodeTop } = node.getBoundingClientRect();\n    const {\n      bottom: prevBottom,\n      height: rawHeight,\n    } = prev.getBoundingClientRect();\n    const extra = Math.round(nodeTop - prevBottom);\n    const height = Math.round(rawHeight);\n    if (extra) {\n      setBottomMargin(extra);\n    }\n    if (phHeight !== height) {\n      setHeight(height);\n    }\n  }, [block, renderKey]);\n  const style: React.CSSProperties = React.useMemo(\n    () => ({\n      height: `${phHeight}px`,\n    }),\n    [phHeight],\n  );\n\n  return (\n    <Bubbles\n      className=\"data-comment-bubbles\"\n      data-cache-ignore\n      ref={bubblesRef}\n    >\n      {!IS_MOBILE && <PHWrapper style={style} />}\n      {children}\n    </Bubbles>\n  );\n}\n"],"file":"Bubbles.js"}