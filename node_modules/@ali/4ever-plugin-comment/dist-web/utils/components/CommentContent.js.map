{"version":3,"sources":["../../../../src/utils/components/CommentContent.tsx"],"names":["React","environment","useZoom","debounce","CommentSideBar","isSidebarVisible","CommentBottomBar","getActiveId","addComment","showComment","setComments","DataMark","ViewMark","CommentInlinePanel","useContentIds","ExternalSidebar","IS_MOBILE","IS_IPAD","IS_PHONE","DEBOUNCE_LOAD_TIME","INIT_SCROLL_DELAY","initNavigate","navigateToComment","controller","onCommentInvalid","subId","options","subObjectId","validInPage","value","decorations","some","d","isViewMark","mark","data","contentId","_","ignoreCheck","run","CommentContent","props","configs","showInline","Boolean","document","isInited","useRef","isCommentLoaded","showBottomBar","isDisabled","fetchCachedComment","reloadComments","isDocLoaded","enableAutoBlur","contentIds","onContentMounted","onContentUnMounted","onSidebarInfoUpdated","disableBottomBar","withCustomApiAdaptor","isLoaded","showSideBar","loadKey","readOnly","current","useEffect","setTimeout","setDecorations","filter","sideBarStatus","onDisabled","setData","loadCachedComment","useCallback","result","Array","isArray","console","error","leading","trailing","undefined","showCommentOnLoaded","navigateRef","navigate","timer","window","flush","clearTimeout","curentCount","useMemo","texts","getTexts","allContentIds","forEach","text","leaves","leave","marks","m","isDataMark","id","push","length","onCommentsChangeRef","handleAdd","handleDelete","commonsProps","onAdd","onDelete"],"mappings":"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","sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\nimport React from 'react';\nimport { Controller, environment, useZoom } from '@ali/4ever-cangjie';\nimport { debounce } from 'lodash-es';\nimport CommentSideBar from './commentSidebar';\nimport isSidebarVisible from '../queries/isSidebarVisible';\nimport CommentBottomBar from './CommentBottomBar';\nimport { CommentPluginConfigs, ShowCommentOptions } from '../types';\nimport getActiveId from '../queries/getActiveId';\nimport { addComment, showComment, setComments } from '../actions';\nimport { DataMark, ViewMark } from '../models/marks';\nimport CommentInlinePanel from './CommentInlinePanel';\nimport useContentIds from '../utils/useContentIds';\nimport ExternalSidebar from './ExternalSidebar';\n\nconst { IS_MOBILE, IS_IPAD } = environment;\nconst IS_PHONE = IS_MOBILE && !IS_IPAD;\nconst DEBOUNCE_LOAD_TIME = 500;\nconst INIT_SCROLL_DELAY = 700;\nlet initNavigate = false;\n\ninterface CommentContentProps {\n  configs: CommentPluginConfigs | undefined;\n  controller: Controller;\n  isDisabled: boolean;\n}\n\nconst navigateToComment =\n  (controller: Controller, onCommentInvalid: Function) =>\n  async (\n    subId?: string | (() => Promise<string>),\n    options?: ShowCommentOptions,\n  ) => {\n    const subObjectId = typeof subId === 'function' ? await subId() : subId;\n    if (typeof subId === 'function' && !subObjectId) {\n      return;\n    }\n    const validInPage = controller.value.decorations.some(\n      (d) =>\n        ViewMark.isViewMark(d.mark) && d.mark.data.contentId === subObjectId,\n    );\n    const _ =\n      validInPage || options?.ignoreCheck\n        ? controller.run('onAction', showComment(subObjectId, options))\n        : onCommentInvalid(subObjectId);\n  };\n\nfunction CommentContent(props: CommentContentProps) {\n  const { controller, configs } = props;\n  const showInline = Boolean(configs?.showInline);\n  const { document } = controller.value;\n  const contentId = getActiveId(controller);\n  const isInited = React.useRef(false);\n  const isCommentLoaded = React.useRef(false);\n  useZoom();\n  const showBottomBar = IS_PHONE && contentId && !showInline;\n  const isDisabled = Boolean(configs?.isDisabled && configs.isDisabled());\n\n  const {\n    fetchCachedComment,\n    reloadComments,\n    isDocLoaded,\n    enableAutoBlur,\n    contentIds,\n    onContentMounted,\n    onContentUnMounted,\n    onSidebarInfoUpdated,\n    disableBottomBar,\n    withCustomApiAdaptor,\n  } = configs || {};\n  const isLoaded = isDocLoaded ? isDocLoaded() : true;\n  const showSideBar =\n    !showInline &&\n    !onSidebarInfoUpdated &&\n    !IS_PHONE &&\n    isSidebarVisible(controller);\n  const loadKey = controller.readOnly ? document : isLoaded;\n\n  useContentIds(controller, isCommentLoaded.current, contentIds);\n  React.useEffect(() => {\n    if (isDisabled) {\n      // timeout 出于体验考虑，下一个 tick 再更新，避免频繁闪烁\n      setTimeout(() => {\n        const { decorations } = controller.value;\n        controller.setDecorations(\n          decorations.filter((d) => !ViewMark.isViewMark(d.mark)),\n        );\n\n        const sideBarStatus = !IS_PHONE && isSidebarVisible(controller);\n        if (sideBarStatus && configs?.onDisabled) {\n          configs.onDisabled();\n        }\n      });\n    } else if (isInited.current) {\n      controller.setData({\n        ...controller.value.data,\n      });\n    }\n    isInited.current = true;\n  }, [controller, isDisabled]);\n\n  const loadCachedComment = React.useCallback(\n    debounce(\n      async () => {\n        try {\n          if (!fetchCachedComment || !loadKey) {\n            return;\n          }\n          const result = await fetchCachedComment();\n          if (!result || !Array.isArray(result)) {\n            return;\n          }\n          isCommentLoaded.current = true;\n          controller.run('onAction', setComments([...result]));\n        } catch (error) {\n          // eslint-disable-next-line no-console\n          console.error(error);\n        }\n      },\n      DEBOUNCE_LOAD_TIME,\n      {\n        leading: true,\n        trailing: true,\n      },\n    ),\n    [controller, fetchCachedComment, loadKey, isDisabled],\n  );\n\n  React.useEffect(() => {\n    if (!isCommentLoaded.current) {\n      return undefined;\n    }\n    const { showCommentOnLoaded, onDisabled } = configs || {};\n    const {\n      subObjectId,\n      onCommentInvalid = () => {},\n      navigateRef,\n    } = showCommentOnLoaded || {};\n    const navigate = navigateToComment(controller, onCommentInvalid);\n    if (isDisabled) {\n      onDisabled && navigateRef && navigateRef(onDisabled);\n    } else {\n      navigateRef && navigateRef(navigate);\n    }\n    if (!subObjectId || initNavigate) {\n      return undefined;\n    }\n    initNavigate = true;\n    // timeout 出于体验考虑，下一个 tick 再更新，避免频繁闪烁\n    const timer = window.setTimeout(() => {\n      navigate(subObjectId);\n      controller.flush();\n    }, INIT_SCROLL_DELAY);\n    return () => {\n      window.clearTimeout(timer);\n    };\n  }, [controller, isCommentLoaded.current]);\n\n  const curentCount = React.useMemo(() => {\n    const texts = document.getTexts();\n    const allContentIds: string[] = [];\n    texts.forEach((text) => {\n      text.leaves.forEach((leave) => {\n        leave.marks.forEach((m) => {\n          if (DataMark.isDataMark(m)) {\n            if (!allContentIds.some((id) => id === m.data.contentId)) {\n              allContentIds.push(m.data.contentId);\n            }\n          }\n        });\n      });\n    });\n    return allContentIds.length;\n  }, [document]);\n\n  // 使用 customApi, 必须放到 reloadComments 之前\n  React.useEffect(() => {\n    withCustomApiAdaptor && withCustomApiAdaptor();\n  }, [withCustomApiAdaptor]);\n\n  React.useEffect(() => {\n    reloadComments && reloadComments();\n  }, [reloadComments, curentCount]);\n\n  React.useEffect(() => {\n    onContentMounted && onContentMounted();\n    return () => {\n      onContentUnMounted && onContentUnMounted();\n    };\n  }, []);\n\n  React.useEffect(() => {\n    loadCachedComment();\n  }, [loadCachedComment]);\n\n  React.useEffect(() => {\n    if (configs?.onCommentsChangeRef) {\n      configs.onCommentsChangeRef(loadCachedComment);\n    }\n    return () => {\n      if (configs?.onCommentsChangeRef) {\n        configs.onCommentsChangeRef(null);\n      }\n    };\n  }, [loadCachedComment, configs]);\n\n  const handleAdd = React.useCallback(() => {\n    controller.run('onAction', addComment());\n  }, [controller]);\n\n  const handleDelete = React.useCallback(() => {\n    // controller.run('onAction', addComment());\n  }, [controller]);\n  const commonsProps = {\n    onAdd: handleAdd,\n    onDelete: handleDelete,\n    configs,\n  };\n\n  return (\n    <React.Fragment>\n      {showSideBar && !isDisabled && (\n        <CommentSideBar\n          enableAutoBlur={enableAutoBlur}\n          {...commonsProps}\n          controller={controller}\n        />\n      )}\n      {!!onSidebarInfoUpdated && !!configs && (\n        <ExternalSidebar\n          configs={configs}\n          isCommentLoaded={isCommentLoaded.current}\n          controller={controller}\n        />\n      )}\n      {showInline && contentId && (\n        <CommentInlinePanel {...commonsProps} contentId={contentId} />\n      )}\n      {showBottomBar && !isDisabled && !disableBottomBar && (\n        <CommentBottomBar {...commonsProps} contentId={contentId!} />\n      )}\n    </React.Fragment>\n  );\n}\n\nexport default CommentContent;\n"],"file":"CommentContent.js"}