{"version":3,"sources":["../../../../src/cardFactory/commands/setCardData.ts"],"names":["Element","Commands","omit","updateCard","controller","node","data","key","targetNode","value","document","getNode","isElement","setNode","command","setNodeByKey","type","withoutSaving"],"mappings":";AAAA,SAAqBA,OAArB,EAA8BC,QAA9B,QAA8C,oBAA9C;AAEA,SAASC,IAAT,QAAqB,WAArB;AAEA,eAAe,SAASC,UAAT,CACbC,UADa,EAEbC,IAFa,EAGbC,IAHa,EAID;AAAA,MACJC,GADI,GACIF,IADJ,CACJE,GADI;AAEZ,MAAMC,UAAU,GAAGJ,UAAU,CAACK,KAAX,CAAiBC,QAAjB,CAA0BC,OAA1B,CAAkCJ,GAAlC,CAAnB;AACA,MAAI,CAACP,OAAO,CAACY,SAAR,CAAkBJ,UAAlB,CAAL,EAAoC,OAAOJ,UAAP;;AACpC,MAAMS,OAAO,GAAG,SAAVA,OAAU,GAAM;AACpB,WAAOT,UAAU,CAACU,OAAX,CAAmBb,QAAQ,CAACc,YAA5B,EAA0CR,GAA1C,EAA+C;AACpDS,MAAAA,IAAI,EAAE,MAD8C;AAEpDV,MAAAA,IAAI,eACCE,UAAU,CAACF,IADZ,EAECJ,IAAI,CAACI,IAAD,EAAO,eAAP,CAFL;AAFgD,KAA/C,CAAP;AAOD,GARD;;AAUA,MAAIA,IAAI,CAACW,aAAT,EAAwB;AACtB;AACA,WAAOb,UAAU,CAACa,aAAX,CAAyB,YAAM;AACpCJ,MAAAA,OAAO;AACR,KAFM,CAAP;AAGD;;AACD,SAAOA,OAAO,EAAd;AACD","sourcesContent":["import { Controller, Element, Commands } from '@ali/4ever-cangjie';\nimport type { CardData } from '@ali/4ever-plugin-card';\nimport { omit } from 'lodash-es';\n\nexport default function updateCard(\n  controller: Controller,\n  node: Element,\n  data: Partial<CardData>,\n): Controller {\n  const { key } = node;\n  const targetNode = controller.value.document.getNode(key);\n  if (!Element.isElement(targetNode)) return controller;\n  const setNode = () => {\n    return controller.command(Commands.setNodeByKey, key, {\n      type: 'card',\n      data: {\n        ...targetNode.data,\n        ...omit(data, 'withoutSaving'),\n      },\n    });\n  };\n\n  if (data.withoutSaving) {\n    // @ts-ignore\n    return controller.withoutSaving(() => {\n      setNode();\n    });\n  }\n  return setNode();\n}\n"],"file":"setCardData.js"}