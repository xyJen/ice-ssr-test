{"version":3,"sources":["../../../src/tagFactory/createRenderElement.tsx"],"names":["React","logger","Tag","ErrorBoundary","InlinePlaceholder","Container","isOwnerAndFirstCreated","setOwnerAndFirstCreated","ChildrenComponent","childProps","controller","plugin","config","locale","renderNode","verticalAlign","node","isOwner","key","useEffect","finalVerticalAlign","createRenderElement","tagTypeConfig","tagType","TYPE","props","next","data","errorTitle","fallback","renderText","error"],"mappings":";AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;qBAC4B,a;AAA5B,OAAOC,MAAP,MAAmB,mBAAnB;AAEA,SAASC,GAAT,QAAoB,uBAApB;AACA,SAASC,aAAT,EAAwBC,iBAAxB,QAAiD,sBAAjD;AAEA,OAAOC,SAAP;AACA,SAASC,sBAAT,EAAiCC,uBAAjC;;AASA,IAAMC,iBAA2C,GAAG,SAA9CA,iBAA8C,OAKjC;AAAA,MAJjBC,UAIiB,QAJjBA,UAIiB;AAAA,MAHjBC,UAGiB,QAHjBA,UAGiB;AAAA,MAFjBC,MAEiB,QAFjBA,MAEiB;AAAA,MADjBC,MACiB,QADjBA,MACiB;AAAA,uBACkCD,MADlC,CACTE,MADS;AAAA,MACTA,MADS,+BACA,EADA;AAAA,MACIC,UADJ,GACkCH,MADlC,CACIG,UADJ;AAAA,MACgBC,aADhB,GACkCJ,MADlC,CACgBI,aADhB;AAAA,MAETC,IAFS,GAEAP,UAFA,CAETO,IAFS;AAIjB,MAAMC,OAAO,GAAGX,sBAAsB,CAACU,IAAI,CAACE,GAAN,CAAtC;AAEAlB,EAAAA,KAAK,CAACmB,SAAN,CAAgB,YAAM;AACpB,QAAIF,OAAJ,EAAaV,uBAAuB,CAACS,IAAI,CAACE,GAAN,EAAW,KAAX,CAAvB;AACd,GAFD,EAEG,CAACF,IAAI,CAACE,GAAN,EAAWD,OAAX,CAFH,EANiB,CAUjB;;AACA,MAAMG,kBAAkB,GAAG,OAAOL,aAAP,KAAyB,UAAzB,GAAsCA,aAAa,CAACC,IAAD,CAAnD,GAA4DD,aAAvF;AAEA,sBACE,eAAC,SAAD,eAAeN,UAAf;AAA2B,IAAA,MAAM,EAAEI,MAAnC;AAA2C,IAAA,aAAa,EAAEO,kBAA1D;AAA8E,IAAA,MAAM,EAAER;AAAtF,MACGE,UAAU,cAAML,UAAN;AAAkBH,IAAAA,sBAAsB,EAAEW;AAA1C,MAAqDP,UAArD,CADb,CADF;AAKD,CAvBD;;AAyBA,eAAe,SAASW,mBAAT,CAA6BV,MAA7B,EAAgEC,MAAhE,EAAqH;AAAA;;AAAA,MACjHU,aADiH,GAC/FX,MAD+F,CAC1HY,OAD0H;AAElI,2BACGrB,GAAG,CAACsB,IADP,IACc,UAACC,KAAD,EAAQf,UAAR,EAAoBgB,IAApB,EAA6B;AAAA,QAC/BV,IAD+B,GACtBS,KADsB,CAC/BT,IAD+B;AAAA,QAG/BO,OAH+B,GAGnBP,IAAI,CAACW,IAHc,CAG/BJ,OAH+B;;AAIvC,QAAID,aAAa,KAAKC,OAAtB,EAA+B;AAC7B,aAAOG,IAAI,EAAX;AACD;;AAED,QAAME,UAAU,eAAaL,OAA7B;;AACA,QAAMM,QAAQ,gBACZ,eAAC,iBAAD,eAAuBJ,KAAvB;AAA8B,MAAA,UAAU,EAAEd,MAAM,CAACmB;AAAjD,OADF;;AAGA,QAAI;AACF,0BACE,eAAC,aAAD;AAAe,QAAA,UAAU,EAAEF,UAA3B;AAAuC,QAAA,QAAQ,EAAEC;AAAjD,sBACE,eAAC,iBAAD;AACE,QAAA,UAAU,EAAEJ,KADd;AAEE,QAAA,UAAU,EAAEf,UAFd;AAGE,QAAA,MAAM,EAAEC,MAHV;AAIE,QAAA,MAAM,EAAEC;AAJV,QADF,CADF;AAUD,KAXD,CAWE,OAAOmB,KAAP,EAAmB;AACnB;AACA9B,MAAAA,MAAM,CAAC8B,KAAP,CAAaH,UAAb,EAAyBG,KAAzB;AACA,aAAOF,QAAP;AACD;AACF,GA7BH;AA+BD","sourcesContent":["import * as React from 'react';\nimport logger from '@ali/4ever-logger';\nimport { BiPluginConfig, Controller } from '@ali/4ever-cangjie';\nimport { Tag } from '@ali/4ever-plugin-tag';\nimport { ErrorBoundary, InlinePlaceholder } from '@ali/4ever-component';\nimport { CustomizedBiTagPluginType, RenderTagProps, TagPluginType } from './type';\nimport Container from './components/Container';\nimport { isOwnerAndFirstCreated, setOwnerAndFirstCreated } from './utils/tagStore';\n\ninterface IChildrenProps {\n  childProps: RenderTagProps;\n  controller: Controller;\n  plugin: CustomizedBiTagPluginType;\n  config: BiPluginConfig;\n}\n\nconst ChildrenComponent: React.FC<IChildrenProps> = ({\n  childProps,\n  controller,\n  plugin,\n  config,\n}): JSX.Element => {\n  const { locale = {}, renderNode, verticalAlign } = plugin;\n  const { node } = childProps;\n\n  const isOwner = isOwnerAndFirstCreated(node.key);\n\n  React.useEffect(() => {\n    if (isOwner) setOwnerAndFirstCreated(node.key, false);\n  }, [node.key, isOwner]);\n\n  // @ts-ignore\n  const finalVerticalAlign = typeof verticalAlign === 'function' ? verticalAlign(node) : verticalAlign;\n\n  return (\n    <Container {...childProps} locale={locale} verticalAlign={finalVerticalAlign} config={config}>\n      {renderNode({ ...childProps, isOwnerAndFirstCreated: isOwner }, controller)}\n    </Container>\n  );\n};\n\nexport default function createRenderElement(plugin: CustomizedBiTagPluginType, config: BiPluginConfig): TagPluginType['renderNode'] {\n  const { tagType: tagTypeConfig } = plugin;\n  return {\n    [Tag.TYPE]: (props, controller, next) => {\n      const { node } = props;\n\n      const { tagType } = node.data;\n      if (tagTypeConfig !== tagType) {\n        return next();\n      }\n\n      const errorTitle = `BI:TAG:${tagType}`;\n      const fallback = (\n        <InlinePlaceholder {...props} renderText={plugin.renderText} />\n      );\n      try {\n        return (\n          <ErrorBoundary errorTitle={errorTitle} fallback={fallback}>\n            <ChildrenComponent\n              childProps={props}\n              controller={controller}\n              plugin={plugin}\n              config={config}\n            />\n          </ErrorBoundary>\n        );\n      } catch (error: any) {\n        // ErrorBoundary 只能捕获子组件错误，这里对组件本身加一层兜底处理\n        logger.error(errorTitle, error);\n        return fallback;\n      }\n    },\n  };\n}\n"],"file":"createRenderElement.js"}