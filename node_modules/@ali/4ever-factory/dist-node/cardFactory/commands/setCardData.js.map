{"version":3,"sources":["../../../../src/cardFactory/commands/setCardData.ts"],"names":["updateCard","controller","node","data","key","targetNode","value","document","getNode","Element","isElement","setNode","command","Commands","setNodeByKey","type","withoutSaving"],"mappings":";;;;;;;AAAA;;AAEA;;AAEe,SAASA,UAAT,CACbC,UADa,EAEbC,IAFa,EAGbC,IAHa,EAID;AACZ,QAAM;AAAEC,IAAAA;AAAF,MAAUF,IAAhB;AACA,QAAMG,UAAU,GAAGJ,UAAU,CAACK,KAAX,CAAiBC,QAAjB,CAA0BC,OAA1B,CAAkCJ,GAAlC,CAAnB;AACA,MAAI,CAACK,qBAAQC,SAAR,CAAkBL,UAAlB,CAAL,EAAoC,OAAOJ,UAAP;;AACpC,QAAMU,OAAO,GAAG,MAAM;AACpB,WAAOV,UAAU,CAACW,OAAX,CAAmBC,sBAASC,YAA5B,EAA0CV,GAA1C,EAA+C;AACpDW,MAAAA,IAAI,EAAE,MAD8C;AAEpDZ,MAAAA,IAAI,EAAE,EACJ,GAAGE,UAAU,CAACF,IADV;AAEJ,WAAG,kBAAKA,IAAL,EAAW,eAAX;AAFC;AAF8C,KAA/C,CAAP;AAOD,GARD;;AAUA,MAAIA,IAAI,CAACa,aAAT,EAAwB;AACtB;AACA,WAAOf,UAAU,CAACe,aAAX,CAAyB,MAAM;AACpCL,MAAAA,OAAO;AACR,KAFM,CAAP;AAGD;;AACD,SAAOA,OAAO,EAAd;AACD","sourcesContent":["import { Controller, Element, Commands } from '@ali/4ever-cangjie';\nimport type { CardData } from '@ali/4ever-plugin-card';\nimport { omit } from 'lodash-es';\n\nexport default function updateCard(\n  controller: Controller,\n  node: Element,\n  data: Partial<CardData>,\n): Controller {\n  const { key } = node;\n  const targetNode = controller.value.document.getNode(key);\n  if (!Element.isElement(targetNode)) return controller;\n  const setNode = () => {\n    return controller.command(Commands.setNodeByKey, key, {\n      type: 'card',\n      data: {\n        ...targetNode.data,\n        ...omit(data, 'withoutSaving'),\n      },\n    });\n  };\n\n  if (data.withoutSaving) {\n    // @ts-ignore\n    return controller.withoutSaving(() => {\n      setNode();\n    });\n  }\n  return setNode();\n}\n"],"file":"setCardData.js"}