{"version":3,"sources":["../../../../src/cardFactory/commands/removeCard.ts"],"names":["isContainerOnlyHasOneCard","controller","node","document","value","container","getParent","key","nodes","length","paramNode","getNode","containerOnlyContainOneCard","command","Commands","replaceNodeByKey","Block","create","removeNodeByKey"],"mappings":";;;;;;;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMA,yBAAyB,GAAG,CAACC,UAAD,EAAyBC,IAAzB,KAAwC;AACxE,QAAM;AAAEC,IAAAA;AAAF,MAAeF,UAAU,CAACG,KAAhC,CADwE,CAExE;;AACA,QAAMC,SAAS,GAAGF,QAAQ,CAACG,SAAT,CAAmBJ,IAAI,CAACK,GAAxB,CAAlB,CAHwE,CAIxE;AACA;;AACA,SAAOF,SAAS,IAAIA,SAAS,EAAEG,KAAX,CAAiBC,MAAjB,KAA4B,CAAzC,IAA8CJ,SAAS,CAACG,KAAV,CAAgB,CAAhB,MAAuBN,IAA5E;AACD,CAPD;;eASe,CAACD,UAAD,EAAyBS,SAAzB,KAAgD;AAC7D;AACA;AACA,MAAI,CAACA,SAAL,EAAgB,OAAOT,UAAP;AAChB,QAAM;AAAEE,IAAAA;AAAF,MAAeF,UAAU,CAACG,KAAhC;AACA,QAAMF,IAAI,GAAGC,QAAQ,CAACQ,OAAT,CAAiBD,SAAS,CAACH,GAA3B,CAAb,CAL6D,CAM7D;;AACA,QAAMK,2BAA2B,GAAGZ,yBAAyB,CAACC,UAAD,EAAaC,IAAb,CAA7D,CAP6D,CAS7D;;AACA,MAAIU,2BAAJ,EAAiC;AAC/B,WAAOX,UAAU,CAACY,OAAX,CAAmBC,sBAASC,gBAA5B,EAA8Cb,IAAI,CAACK,GAAnD,EAAwDS,mBAAMC,MAAN,CAAa,WAAb,CAAxD,CAAP;AACD;;AACD,SAAOhB,UAAU,CAACY,OAAX,CAAmBC,sBAASI,eAA5B,EAA6ChB,IAAI,CAACK,GAAlD,CAAP;AACD,C","sourcesContent":["import { Controller, Block, Element, Commands, Node } from '@ali/4ever-cangjie';\n\n/**\n * 表格中是否只包含一个河图卡片，无其他任何内容\n * @param value\n * @param nodeKey\n * @returns\n */\nconst isContainerOnlyHasOneCard = (controller: Controller, node: Node) => {\n  const { document } = controller.value;\n  // 获取包含该河图卡片的表格容器节点\n  const container = document.getParent(node.key);\n  // 如果当前河图卡片是在表格中，并且该表格中仅包含该河图卡片，无其他内容\n  // @ts-ignore\n  return container && container?.nodes.length === 1 && container.nodes[0] === node;\n};\n\nexport default (controller: Controller, paramNode: Element) => {\n  // 线上监控到个别 NPE 错误为 paramNode 为 null\n  // 但由于中间件机制调用栈太深，找不到是那个业务方发起的调用，这里做个兜底\n  if (!paramNode) return controller;\n  const { document } = controller.value;\n  const node = document.getNode(paramNode.key)!;\n  // 否则仓颉的默认removeNode会导致table-cell结构出现错误，即td下面本该有的paragraph被删掉，然后normolize会将该td用一个div包裹\n  const containerOnlyContainOneCard = isContainerOnlyHasOneCard(controller, node);\n\n  // 如果当前容器里面只有一个河图卡片，那么删除操作需要通过一个空的paragraph来替代当前河图卡片来达到删除效果,其余情况采用默认逻辑即可\n  if (containerOnlyContainOneCard) {\n    return controller.command(Commands.replaceNodeByKey, node.key, Block.create('paragraph'));\n  }\n  return controller.command(Commands.removeNodeByKey, node.key);\n};\n"],"file":"removeCard.js"}