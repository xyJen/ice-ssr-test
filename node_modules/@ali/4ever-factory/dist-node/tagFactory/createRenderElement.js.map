{"version":3,"sources":["../../../src/tagFactory/createRenderElement.tsx"],"names":["ChildrenComponent","childProps","controller","plugin","config","locale","renderNode","verticalAlign","node","isOwner","key","React","useEffect","finalVerticalAlign","isOwnerAndFirstCreated","createRenderElement","tagType","tagTypeConfig","Tag","TYPE","props","next","data","errorTitle","fallback","renderText","error","logger"],"mappings":";;;;;;;;;;;;;AAAA;;AACA;;AAEA;;AACA;;AAEA;;AACA;;uBAN4B,a;;AAe5B,MAAMA,iBAA2C,GAAG,CAAC;AACnDC,EAAAA,UADmD;AAEnDC,EAAAA,UAFmD;AAGnDC,EAAAA,MAHmD;AAInDC,EAAAA;AAJmD,CAAD,KAKjC;AACjB,QAAM;AAAEC,IAAAA,MAAM,GAAG,EAAX;AAAeC,IAAAA,UAAf;AAA2BC,IAAAA;AAA3B,MAA6CJ,MAAnD;AACA,QAAM;AAAEK,IAAAA;AAAF,MAAWP,UAAjB;AAEA,QAAMQ,OAAO,GAAG,sCAAuBD,IAAI,CAACE,GAA5B,CAAhB;AAEAC,EAAAA,KAAK,CAACC,SAAN,CAAgB,MAAM;AACpB,QAAIH,OAAJ,EAAa,uCAAwBD,IAAI,CAACE,GAA7B,EAAkC,KAAlC;AACd,GAFD,EAEG,CAACF,IAAI,CAACE,GAAN,EAAWD,OAAX,CAFH,EANiB,CAUjB;;AACA,QAAMI,kBAAkB,GAAG,OAAON,aAAP,KAAyB,UAAzB,GAAsCA,aAAa,CAACC,IAAD,CAAnD,GAA4DD,aAAvF;AAEA,sBACE,eAAC,kBAAD,6BAAeN,UAAf;AAA2B,IAAA,MAAM,EAAEI,MAAnC;AAA2C,IAAA,aAAa,EAAEQ,kBAA1D;AAA8E,IAAA,MAAM,EAAET;AAAtF,MACGE,UAAU,CAAC,EAAE,GAAGL,UAAL;AAAiBa,IAAAA,sBAAsB,EAAEL;AAAzC,GAAD,EAAqDP,UAArD,CADb,CADF;AAKD,CAvBD;;AAyBe,SAASa,mBAAT,CAA6BZ,MAA7B,EAAgEC,MAAhE,EAAqH;AAClI,QAAM;AAAEY,IAAAA,OAAO,EAAEC;AAAX,MAA6Bd,MAAnC;AACA,SAAO;AACL,KAACe,mBAAIC,IAAL,GAAY,CAACC,KAAD,EAAQlB,UAAR,EAAoBmB,IAApB,KAA6B;AACvC,YAAM;AAAEb,QAAAA;AAAF,UAAWY,KAAjB;AAEA,YAAM;AAAEJ,QAAAA;AAAF,UAAcR,IAAI,CAACc,IAAzB;;AACA,UAAIL,aAAa,KAAKD,OAAtB,EAA+B;AAC7B,eAAOK,IAAI,EAAX;AACD;;AAED,YAAME,UAAU,GAAI,UAASP,OAAQ,EAArC;;AACA,YAAMQ,QAAQ,gBACZ,eAAC,gCAAD,6BAAuBJ,KAAvB;AAA8B,QAAA,UAAU,EAAEjB,MAAM,CAACsB;AAAjD,SADF;;AAGA,UAAI;AACF,4BACE,eAAC,4BAAD;AAAe,UAAA,UAAU,EAAEF,UAA3B;AAAuC,UAAA,QAAQ,EAAEC;AAAjD,wBACE,eAAC,iBAAD;AACE,UAAA,UAAU,EAAEJ,KADd;AAEE,UAAA,UAAU,EAAElB,UAFd;AAGE,UAAA,MAAM,EAAEC,MAHV;AAIE,UAAA,MAAM,EAAEC;AAJV,UADF,CADF;AAUD,OAXD,CAWE,OAAOsB,KAAP,EAAmB;AACnB;AACAC,4BAAOD,KAAP,CAAaH,UAAb,EAAyBG,KAAzB;;AACA,eAAOF,QAAP;AACD;AACF;AA7BI,GAAP;AA+BD","sourcesContent":["import * as React from 'react';\nimport logger from '@ali/4ever-logger';\nimport { BiPluginConfig, Controller } from '@ali/4ever-cangjie';\nimport { Tag } from '@ali/4ever-plugin-tag';\nimport { ErrorBoundary, InlinePlaceholder } from '@ali/4ever-component';\nimport { CustomizedBiTagPluginType, RenderTagProps, TagPluginType } from './type';\nimport Container from './components/Container';\nimport { isOwnerAndFirstCreated, setOwnerAndFirstCreated } from './utils/tagStore';\n\ninterface IChildrenProps {\n  childProps: RenderTagProps;\n  controller: Controller;\n  plugin: CustomizedBiTagPluginType;\n  config: BiPluginConfig;\n}\n\nconst ChildrenComponent: React.FC<IChildrenProps> = ({\n  childProps,\n  controller,\n  plugin,\n  config,\n}): JSX.Element => {\n  const { locale = {}, renderNode, verticalAlign } = plugin;\n  const { node } = childProps;\n\n  const isOwner = isOwnerAndFirstCreated(node.key);\n\n  React.useEffect(() => {\n    if (isOwner) setOwnerAndFirstCreated(node.key, false);\n  }, [node.key, isOwner]);\n\n  // @ts-ignore\n  const finalVerticalAlign = typeof verticalAlign === 'function' ? verticalAlign(node) : verticalAlign;\n\n  return (\n    <Container {...childProps} locale={locale} verticalAlign={finalVerticalAlign} config={config}>\n      {renderNode({ ...childProps, isOwnerAndFirstCreated: isOwner }, controller)}\n    </Container>\n  );\n};\n\nexport default function createRenderElement(plugin: CustomizedBiTagPluginType, config: BiPluginConfig): TagPluginType['renderNode'] {\n  const { tagType: tagTypeConfig } = plugin;\n  return {\n    [Tag.TYPE]: (props, controller, next) => {\n      const { node } = props;\n\n      const { tagType } = node.data;\n      if (tagTypeConfig !== tagType) {\n        return next();\n      }\n\n      const errorTitle = `BI:TAG:${tagType}`;\n      const fallback = (\n        <InlinePlaceholder {...props} renderText={plugin.renderText} />\n      );\n      try {\n        return (\n          <ErrorBoundary errorTitle={errorTitle} fallback={fallback}>\n            <ChildrenComponent\n              childProps={props}\n              controller={controller}\n              plugin={plugin}\n              config={config}\n            />\n          </ErrorBoundary>\n        );\n      } catch (error: any) {\n        // ErrorBoundary 只能捕获子组件错误，这里对组件本身加一层兜底处理\n        logger.error(errorTitle, error);\n        return fallback;\n      }\n    },\n  };\n}\n"],"file":"createRenderElement.js"}