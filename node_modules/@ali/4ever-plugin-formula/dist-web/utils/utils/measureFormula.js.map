{"version":3,"sources":["../../../../src/utils/utils/measureFormula.ts"],"names":["renderToString","CONTENT_MARGIN","ERROR_COLOR","FORMULA_PLACEHOLDER_WIDTH","FORMULA_PLACEHOLDER_HEIGHT","FORMULA_PREVIEW_MIN_WIDTH","FORMULA_PREVIEW_MIN_HEIGHT","createPlaceholderSize","width","height","getKatexString","text","throwOnError","errorColor","calcuSize","formula","size","measureFormula","getValue","min","value","max","Math","editorContent","document","querySelector","domString","faker","createElement","style","innerHTML","appendChild","getBoundingClientRect","removeChild"],"mappings":"AAAA,SAASA,cAAT,QAA+B,OAA/B,C,CAEA;;AACA,OAAO,IAAMC,cAAc,GAAG,CAAvB;AAEP,IAAMC,WAAW,GAAG,SAApB;AAEA,OAAO,IAAMC,yBAAyB,GAAG,EAAlC;AACP,OAAO,IAAMC,0BAA0B,GAAG,EAAnC;AACP,OAAO,IAAMC,yBAAyB,GAAG,CAAlC;AACP,OAAO,IAAMC,0BAA0B,GAAG,EAAnC;AAEP,OAAO,IAAMC,qBAAqB,GAAG,SAAxBA,qBAAwB;AAAA,SAAO;AAC1CC,IAAAA,KAAK,EAAEL,yBADmC;AAE1CM,IAAAA,MAAM,EAAEL;AAFkC,GAAP;AAAA,CAA9B;AAKP,OAAO,SAASM,cAAT,CAAwBC,IAAxB,EAAsCC,YAAtC,EAA4D;AAAA,MAAtBA,YAAsB;AAAtBA,IAAAA,YAAsB,GAAP,KAAO;AAAA;;AACjE,SAAOZ,cAAc,CAACW,IAAD,EAAO;AAC1BE,IAAAA,UAAU,EAAEX,WADc;AAE1BU,IAAAA,YAAY,EAAZA;AAF0B,GAAP,CAArB;AAID;AAED,OAAO,SAASE,SAAT,CAAmBC,OAAnB,EAAoC;AACzC,MAAI,CAACA,OAAL,EAAc;AACZ,WAAOR,qBAAqB,EAA5B;AACD;;AAED,MAAMS,IAAI,GAAGC,cAAc,CAACF,OAAD,CAA3B;AACA,MAAMP,KAAK,GAAGU,QAAQ,CAACb,yBAAD,EAA4BJ,cAAc,GAAG,CAAjB,GAAqBe,IAAI,CAACR,KAAtD,CAAtB;AACA,MAAMC,MAAM,GAAGS,QAAQ,CAACZ,0BAAD,EAA6BL,cAAc,GAAG,CAAjB,GAAqBe,IAAI,CAACP,MAAvD,CAAvB;AACA,SAAO;AAAED,IAAAA,KAAK,EAALA,KAAF;AAASC,IAAAA,MAAM,EAANA;AAAT,GAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,SAASS,QAAT,CAAkBC,GAAlB,EAA+BC,KAA/B,EAA8CC,GAA9C,EAAmE;AACxE,MAAI,CAACA,GAAL,EAAU;AACR,WAAOC,IAAI,CAACD,GAAL,CAASF,GAAT,EAAcC,KAAd,CAAP;AACD;;AACD,SAAOE,IAAI,CAACH,GAAL,CAASG,IAAI,CAACD,GAAL,CAASF,GAAT,EAAcC,KAAd,CAAT,EAA+BC,GAA/B,CAAP;AACD;AAED;AACA;AACA;AACA;;AACA,OAAO,SAASJ,cAAT,CAAwBN,IAAxB,EAAsC;AAC3C,MAAMY,aAAa,GAAGC,QAAQ,CAACC,aAAT,CAAuB,2BAAvB,CAAtB;;AACA,MAAI,CAACF,aAAL,EAAoB;AAClB,WAAOhB,qBAAqB,EAA5B;AACD;;AAED,MAAMmB,SAAS,GAAGhB,cAAc,CAACC,IAAD,CAAhC;AACA,MAAMgB,KAAK,GAAGH,QAAQ,CAACI,aAAT,CAAuB,KAAvB,CAAd;AACAD,EAAAA,KAAK,CAACE,KAAN,CAAYrB,KAAZ,GAAoB,aAApB;AACAmB,EAAAA,KAAK,CAACG,SAAN,GAAkBJ,SAAlB;AACAH,EAAAA,aAAa,CAACQ,WAAd,CAA0BJ,KAA1B;;AAV2C,8BAYjBA,KAAK,CAACK,qBAAN,EAZiB;AAAA,MAYnCxB,KAZmC,yBAYnCA,KAZmC;AAAA,MAY5BC,MAZ4B,yBAY5BA,MAZ4B;;AAa3Cc,EAAAA,aAAa,CAACU,WAAd,CAA0BN,KAA1B;AAEA,SAAO;AACLnB,IAAAA,KAAK,EAALA,KADK;AAELC,IAAAA,MAAM,EAANA;AAFK,GAAP;AAID","sourcesContent":["import { renderToString } from 'katex';\n\n// 公式内容的边距\nexport const CONTENT_MARGIN = 4;\n\nconst ERROR_COLOR = '#FF5219';\n\nexport const FORMULA_PLACEHOLDER_WIDTH = 98;\nexport const FORMULA_PLACEHOLDER_HEIGHT = 32;\nexport const FORMULA_PREVIEW_MIN_WIDTH = 8;\nexport const FORMULA_PREVIEW_MIN_HEIGHT = 32;\n\nexport const createPlaceholderSize = () => ({\n  width: FORMULA_PLACEHOLDER_WIDTH,\n  height: FORMULA_PLACEHOLDER_HEIGHT,\n});\n\nexport function getKatexString(text: string, throwOnError = false) {\n  return renderToString(text, {\n    errorColor: ERROR_COLOR,\n    throwOnError,\n  });\n}\n\nexport function calcuSize(formula: string) {\n  if (!formula) {\n    return createPlaceholderSize();\n  }\n\n  const size = measureFormula(formula);\n  const width = getValue(FORMULA_PREVIEW_MIN_WIDTH, CONTENT_MARGIN * 2 + size.width);\n  const height = getValue(FORMULA_PREVIEW_MIN_HEIGHT, CONTENT_MARGIN * 2 + size.height);\n  return { width, height };\n}\n\n/**\n * 返回一个不超过最小值和最大值的数字\n * @param min 最小值\n * @param value 计算值\n * @param max 最大值\n */\nexport function getValue(min: number, value: number, max?: number | null) {\n  if (!max) {\n    return Math.max(min, value);\n  }\n  return Math.min(Math.max(min, value), max);\n}\n\n/**\n * 返回公式内容的大小\n * @param text 公式字符串\n */\nexport function measureFormula(text: string) {\n  const editorContent = document.querySelector('div[data-cangjie-content]');\n  if (!editorContent) {\n    return createPlaceholderSize();\n  }\n\n  const domString = getKatexString(text);\n  const faker = document.createElement('div');\n  faker.style.width = 'fit-content';\n  faker.innerHTML = domString;\n  editorContent.appendChild(faker);\n\n  const { width, height } = faker.getBoundingClientRect();\n  editorContent.removeChild(faker);\n\n  return {\n    width,\n    height,\n  };\n}\n"],"file":"measureFormula.js"}