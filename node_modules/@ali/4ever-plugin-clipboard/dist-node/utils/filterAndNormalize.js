"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = filterAndNormalize;

var _filter = require("./filter");

var _normalize = require("./normalize");

var _restructFragment = require("./restructFragment");

var _everCangjie = require("@ali/4ever-cangjie");

function filterAndNormalize(props) {
  const {
    fragment,
    models,
    rules,
    schema
  } = props;
  const controllerPid = models?.get('controllerPid');
  let result = fragment; // 业务层根据需要配置，粘贴要过滤的节点

  if (rules) {
    result = (0, _filter.filterFragment)(result, rules);
  } // 粘贴来自不同插件配置的编辑器时，处理framgment中不合法节点


  if (controllerPid && controllerPid !== fragment?.data.copyFrom) {
    result = (0, _restructFragment.restructFragment)(result, models);
  } // 使用Paste中的normalize对fragment进行处理


  result = (0, _normalize.normalizeFragment)(result); // 使用 Mo中的strictSchema 对要粘贴的内容进行normalize处理

  const value = _everCangjie.Value.create({
    document: result
  });

  const controller = _everCangjie.Controller.create({
    value,
    plugins: [{
      schema,
      models: []
    }]
  });

  return controller.value.document;
}
//# sourceMappingURL=filterAndNormalize.js.map