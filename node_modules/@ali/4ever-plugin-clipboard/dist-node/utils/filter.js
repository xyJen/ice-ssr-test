"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.filterFragment = filterFragment;

var _everCangjie = require("@ali/4ever-cangjie");

/* eslint-disable import/prefer-default-export */

/**
 * 过滤 fragment 内容
 * @param fragment
 * @param rules
 */
function filterFragment(fragment, rules) {
  const {
    block,
    inline
  } = rules;
  const pruneMap = new Map();
  fragment.forEachDescendant(node => {
    // 过滤 block 节点
    if (_everCangjie.Block.isBlock(node) && block) {
      const {
        includes,
        excludes
      } = block;

      if (includes && !includes.test(node.type)) {
        pruneMap.set(node.key, true);
      }

      if (excludes && excludes.test(node.type)) {
        pruneMap.set(node.key, true);
      }
    } // 过滤 inline 节点


    if (_everCangjie.Inline.isInline(node) && inline) {
      const {
        includes,
        excludes
      } = inline;

      if (includes && !includes.test(node.type)) {
        pruneMap.set(node.key, true);
      }

      if (excludes && excludes.test(node.type)) {
        pruneMap.set(node.key, true);
      }
    }
  });
  let result = fragment;
  pruneMap.forEach((_, key) => {
    const path = result.getPath(key);

    if (path) {
      result = result.removeNode(path);
    }
  });
  return result;
}
//# sourceMappingURL=filter.js.map