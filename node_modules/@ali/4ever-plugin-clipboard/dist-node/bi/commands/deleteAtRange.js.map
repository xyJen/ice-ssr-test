{"version":3,"sources":["../../../../src/bi/commands/deleteAtRange.ts"],"names":["deleteAtRange","controller","decorations","value","pasteDecoration","find","item","mark","type","PASTE_DECORATION","start","end","command","RangeSelection","create","anchor","focus","selection","isEdgePoint","Commands","insertBlock"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AAEe,SAASA,aAAT,CAAuBC,UAAvB,EAA2D;AACxE,QAAM;AAAEC,IAAAA;AAAF,MAAkBD,UAAU,CAACE,KAAnC;AACA,QAAMC,eAAe,GAAGF,WAAW,CAACG,IAAZ,CACtBC,IAAI,IAAIA,IAAI,CAACC,IAAL,CAAUC,IAAV,KAAmBC,2BADL,CAAxB;AAGA,QAAMC,KAAK,GAAG,4BAAcT,UAAd,CAAd;AACA,MAAI,CAACG,eAAL,EAAsB,OAAOH,UAAP;AACtB,QAAM;AAAEU,IAAAA;AAAF,MAAUP,eAAhB;;AACA,MAAIM,KAAK,KAAKC,GAAd,EAAmB;AACjBV,IAAAA,UAAU,CAACW,OAAX,CACE,eADF,EAEEC,4BAAeC,MAAf,CAAsB;AACpBC,MAAAA,MAAM,EAAEL,KADY;AAEpBM,MAAAA,KAAK,EAAEL;AAFa,KAAtB,CAFF;AAOA,UAAM;AAAEM,MAAAA;AAAF,QAAgBhB,UAAU,CAACE,KAAjC;;AAEA,QAAI,+BAAiBc,SAAS,CAACF,MAA3B,EAAmCd,UAAnC,CAAJ,EAAoD;AAClDA,MAAAA,UAAU,CAACW,OAAX,CAAmB,YAAnB,EAAiC,CAACK,SAAD,CAAjC;AACD;;AAED,QAAIhB,UAAU,CAACE,KAAX,EAAkBc,SAAlB,EAA6BF,MAA7B,EAAqCG,WAArC,EAAJ,EAAwD;AACtD;AACAjB,MAAAA,UAAU,CAACW,OAAX,CAAmBO,sBAASC,WAA5B,EAAyC;AAAEZ,QAAAA,IAAI,EAAE;AAAR,OAAzC;AACD;AACF;;AACD,SAAOP,UAAP;AACD","sourcesContent":["import { Controller, Commands, RangeSelection } from '@ali/4ever-cangjie';\nimport getStartPoint from '../utils/getStartPoint';\nimport isAtStartOfBlock from '../utils/isAtStartOfBlock';\nimport { PASTE_DECORATION } from '../../utils/constants';\n\nexport default function deleteAtRange(controller: Controller): Controller {\n  const { decorations } = controller.value;\n  const pasteDecoration = decorations.find(\n    item => item.mark.type === PASTE_DECORATION,\n  );\n  const start = getStartPoint(controller);\n  if (!pasteDecoration) return controller;\n  const { end } = pasteDecoration;\n  if (start !== end) {\n    controller.command(\n      'deleteAtRange',\n      RangeSelection.create({\n        anchor: start!,\n        focus: end,\n      }),\n    );\n    const { selection } = controller.value;\n\n    if (isAtStartOfBlock(selection.anchor, controller)) {\n      controller.command('clearStyle', [selection]);\n    }\n\n    if (controller.value?.selection?.anchor?.isEdgePoint()) {\n      // 防止插入内容首个节点是 edgeSelectable ,导致 decoration.start 标记失败\n      controller.command(Commands.insertBlock, { type: 'paragraph' });\n    }\n  }\n  return controller;\n}\n"],"file":"deleteAtRange.js"}