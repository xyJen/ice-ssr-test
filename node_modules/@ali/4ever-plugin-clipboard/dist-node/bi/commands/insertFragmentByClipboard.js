"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.insertFragmentByClipboard = insertFragmentByClipboard;

var _everCangjie = require("@ali/4ever-cangjie");

var _showClipboard = require("./showClipboard");

function insertFragmentByClipboard(controller, fragment) {
  if (fragment) {
    if (controller.query('shouldInsertParagraphBeforePaste', fragment)) {
      controller.command(_everCangjie.Commands.insertBlock, {
        type: 'paragraph'
      });
    }

    const {
      document,
      selection
    } = controller.value;
    const {
      anchor: convertedAnchor
    } = selection.convertToTextPoints(document);
    const startPath = document.getPath(convertedAnchor.key);
    const startOffset = convertedAnchor.offset;
    controller.command(_everCangjie.Commands.insertFragment, fragment); // 这里是粘贴后的 focus

    const {
      focus
    } = controller.value.selection;
    const startNode = controller.value.document.getNodeByPath(startPath);

    if (!(startNode && Number.isInteger(startOffset))) {
      return controller;
    }

    const anchor = _everCangjie.TextPoint.create({
      key: startNode.key,
      offset: startOffset
    });

    if (anchor?.isTextPoint() && focus.isTextPoint()) {
      controller.command(_showClipboard.showClipboard, _everCangjie.Selection.create({
        anchor,
        focus
      }));
    }
  }

  return controller;
}
//# sourceMappingURL=insertFragmentByClipboard.js.map