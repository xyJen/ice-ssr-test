"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = deleteAtRange;

var _everCangjie = require("@ali/4ever-cangjie");

var _getStartPoint = _interopRequireDefault(require("../utils/getStartPoint"));

var _isAtStartOfBlock = _interopRequireDefault(require("../utils/isAtStartOfBlock"));

var _constants = require("../../utils/constants");

function deleteAtRange(controller) {
  const {
    decorations
  } = controller.value;
  const pasteDecoration = decorations.find(item => item.mark.type === _constants.PASTE_DECORATION);
  const start = (0, _getStartPoint.default)(controller);
  if (!pasteDecoration) return controller;
  const {
    end
  } = pasteDecoration;

  if (start !== end) {
    controller.command('deleteAtRange', _everCangjie.RangeSelection.create({
      anchor: start,
      focus: end
    }));
    const {
      selection
    } = controller.value;

    if ((0, _isAtStartOfBlock.default)(selection.anchor, controller)) {
      controller.command('clearStyle', [selection]);
    }

    if (controller.value?.selection?.anchor?.isEdgePoint()) {
      // 防止插入内容首个节点是 edgeSelectable ,导致 decoration.start 标记失败
      controller.command(_everCangjie.Commands.insertBlock, {
        type: 'paragraph'
      });
    }
  }

  return controller;
}
//# sourceMappingURL=deleteAtRange.js.map