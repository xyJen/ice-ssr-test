"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = getStartPoint;

var _everCangjie = require("@ali/4ever-cangjie");

var _lodash = require("lodash");

var _constants = require("../../utils/constants");

function findStartBlockKey(block) {
  if (!block.nodes) {
    return block.key;
  } else {
    return findStartBlockKey(block.nodes[0]);
  }
}
/**
 * @description 获取切换粘贴模式前光标所在的point
 * */


function getStartPoint(controller) {
  const {
    decorations,
    document
  } = controller.value;
  const dec = decorations.find(item => item.mark.type === _constants.PASTE_DECORATION);
  const startPoint = dec?.start;

  if (startPoint) {
    const pointPath = document.getPath(startPoint.key);
    const startBlock = document.getNode(startPoint.key);
    const isFirstPointOfDocument = (0, _lodash.isEqual)(pointPath, [0, 0]) && startPoint.offset === 0;

    if (isFirstPointOfDocument) {
      return startPoint;
    }

    if (startBlock) {
      return startPoint;
    }

    return _everCangjie.TextPoint.create({
      key: findStartBlockKey(controller.value.document),
      offset: 0
    });
  }

  return startPoint;
}
//# sourceMappingURL=getStartPoint.js.map