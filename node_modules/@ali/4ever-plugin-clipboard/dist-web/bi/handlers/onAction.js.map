{"version":3,"sources":["../../../../src/bi/handlers/onAction.ts"],"names":["ContextMenu","environment","CLIPBOARD_INSERT_FRAGMENT","CLIPBOARD_SET_DECORATIONS","CLIPBOARD_DEL_SELECTION","CLIPBOARD_HIDE_PASTEPANEL","CLIPBOARD_MATCH_MODE","CLIPBOARD_TEXT_MODE","CLIPBOARD_HIDE_CUSTOM_PASTEPANEL","insertFragmentByClipboard","setDecorations","deleteAtRange","hidePastePanel","getMatchFragment","getMarksFragment","hideCustomPasteButton","onCangjiePasteFail","ClipboardErrorEnum","createOnAction","config","onError","onAction","action","controller","next","payload","type","fragment","decoration","ACTION_PASTE_FAIL","isShortcut","error","Error","CUT_FAILED","IS_MOBILE","locale","ACTION_COPY_FAIL","COPY_FAILED","ACTION_CUT_FAIL"],"mappings":"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","sourcesContent":["import { Controller, Action, ContextMenu, environment } from '@ali/4ever-cangjie';\nimport {\n  CLIPBOARD_INSERT_FRAGMENT,\n  CLIPBOARD_SET_DECORATIONS,\n  CLIPBOARD_DEL_SELECTION,\n  CLIPBOARD_HIDE_PASTEPANEL,\n  CLIPBOARD_MATCH_MODE,\n  CLIPBOARD_TEXT_MODE,\n  CLIPBOARD_HIDE_CUSTOM_PASTEPANEL,\n} from '../actions';\nimport { insertFragmentByClipboard } from '../commands/insertFragmentByClipboard';\nimport setDecorations from '../commands/setDecorations';\nimport deleteAtRange from '../commands/deleteAtRange';\nimport hidePastePanel from '../utils/hidePasteButton';\nimport getMatchFragment from '../utils/getMatchFragment';\nimport getMarksFragment from '../utils/getMarksFragment';\nimport hideCustomPasteButton from '../utils/hideCustomPasteButton';\nimport onCangjiePasteFail from './onCangjiePasteFail';\nimport { ClipboardPluginConfig } from '../../utils/types';\nimport { ClipboardErrorEnum } from '../../utils/constants';\n\nexport default function createOnAction(config?: ClipboardPluginConfig) {\n  const { onError } = config || {};\n  return function onAction(action: Action, controller: Controller, next: Function) {\n    const { payload = {}, type } = action;\n    if (type === CLIPBOARD_INSERT_FRAGMENT) {\n      const { fragment } = payload;\n      return insertFragmentByClipboard(controller, fragment);\n    }\n    if (type === CLIPBOARD_SET_DECORATIONS) {\n      const { decoration } = payload;\n      return setDecorations(controller, decoration);\n    }\n\n    if (type === CLIPBOARD_DEL_SELECTION) {\n      return deleteAtRange(controller);\n    }\n\n    if (type === CLIPBOARD_HIDE_PASTEPANEL) {\n      return hidePastePanel(controller);\n    }\n\n    if (type === CLIPBOARD_HIDE_CUSTOM_PASTEPANEL) {\n      return hideCustomPasteButton(controller);\n    }\n\n    if (type === CLIPBOARD_MATCH_MODE) {\n      const fragment = getMatchFragment(controller, payload.fragment);\n      return insertFragmentByClipboard(controller, fragment);\n    }\n\n    if (type === CLIPBOARD_TEXT_MODE) {\n      const fragment = getMarksFragment(controller, payload.fragment);\n      return insertFragmentByClipboard(controller, fragment);\n    }\n\n    if (type === ContextMenu.ACTION_PASTE_FAIL) {\n      const { isShortcut, error = new Error(ClipboardErrorEnum.CUT_FAILED) } = payload;\n      if (!isShortcut && !environment.IS_MOBILE) {\n        // PC 端右键粘贴失败, 建议使用快捷键\n        onCangjiePasteFail(config?.locale);\n      } else if (onError) {\n        onError(ClipboardErrorEnum.CUT_FAILED, error);\n      }\n    }\n\n    if (type === ContextMenu.ACTION_COPY_FAIL) {\n      const { error = new Error(ClipboardErrorEnum.COPY_FAILED) } = payload;\n      if (onError) {\n        onError(ClipboardErrorEnum.COPY_FAILED, error);\n      }\n    }\n\n    if (type === ContextMenu.ACTION_CUT_FAIL) {\n      const { error = new Error(ClipboardErrorEnum.CUT_FAILED) } = payload;\n      if (onError) {\n        onError(ClipboardErrorEnum.CUT_FAILED, error);\n      }\n    }\n\n    return next();\n  };\n}\n"],"file":"onAction.js"}