import { TextPoint } from '@ali/4ever-cangjie';
import { isEqual } from 'lodash-es';
import { PASTE_DECORATION } from "../../utils/constants";

function findStartBlockKey(block) {
  if (!block.nodes) {
    return block.key;
  } else {
    return findStartBlockKey(block.nodes[0]);
  }
}
/**
 * @description 获取切换粘贴模式前光标所在的point
 * */


export default function getStartPoint(controller) {
  var _controller$value = controller.value,
      decorations = _controller$value.decorations,
      document = _controller$value.document;
  var dec = decorations.find(function (item) {
    return item.mark.type === PASTE_DECORATION;
  });
  var startPoint = dec == null ? void 0 : dec.start;

  if (startPoint) {
    var pointPath = document.getPath(startPoint.key);
    var startBlock = document.getNode(startPoint.key);
    var isFirstPointOfDocument = isEqual(pointPath, [0, 0]) && startPoint.offset === 0;

    if (isFirstPointOfDocument) {
      return startPoint;
    }

    if (startBlock) {
      return startPoint;
    }

    return TextPoint.create({
      key: findStartBlockKey(controller.value.document),
      offset: 0
    });
  }

  return startPoint;
}
//# sourceMappingURL=getStartPoint.js.map