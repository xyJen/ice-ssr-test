import { Commands, RangeSelection } from '@ali/4ever-cangjie';
import getStartPoint from "../utils/getStartPoint";
import isAtStartOfBlock from "../utils/isAtStartOfBlock";
import { PASTE_DECORATION } from "../../utils/constants";
export default function deleteAtRange(controller) {
  var decorations = controller.value.decorations;
  var pasteDecoration = decorations.find(function (item) {
    return item.mark.type === PASTE_DECORATION;
  });
  var start = getStartPoint(controller);
  if (!pasteDecoration) return controller;
  var end = pasteDecoration.end;

  if (start !== end) {
    var _controller$value, _controller$value$sel, _controller$value$sel2;

    controller.command('deleteAtRange', RangeSelection.create({
      anchor: start,
      focus: end
    }));
    var selection = controller.value.selection;

    if (isAtStartOfBlock(selection.anchor, controller)) {
      controller.command('clearStyle', [selection]);
    }

    if ((_controller$value = controller.value) != null && (_controller$value$sel = _controller$value.selection) != null && (_controller$value$sel2 = _controller$value$sel.anchor) != null && _controller$value$sel2.isEdgePoint()) {
      // 防止插入内容首个节点是 edgeSelectable ,导致 decoration.start 标记失败
      controller.command(Commands.insertBlock, {
        type: 'paragraph'
      });
    }
  }

  return controller;
}
//# sourceMappingURL=deleteAtRange.js.map