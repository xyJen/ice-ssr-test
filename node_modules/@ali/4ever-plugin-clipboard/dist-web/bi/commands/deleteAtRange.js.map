{"version":3,"sources":["../../../../src/bi/commands/deleteAtRange.ts"],"names":["Commands","RangeSelection","getStartPoint","isAtStartOfBlock","PASTE_DECORATION","deleteAtRange","controller","decorations","value","pasteDecoration","find","item","mark","type","start","end","command","create","anchor","focus","selection","isEdgePoint","insertBlock"],"mappings":"AAAA,SAAqBA,QAArB,EAA+BC,cAA/B,QAAqD,oBAArD;AACA,OAAOC,aAAP;AACA,OAAOC,gBAAP;AACA,SAASC,gBAAT;AAEA,eAAe,SAASC,aAAT,CAAuBC,UAAvB,EAA2D;AAAA,MAChEC,WADgE,GAChDD,UAAU,CAACE,KADqC,CAChED,WADgE;AAExE,MAAME,eAAe,GAAGF,WAAW,CAACG,IAAZ,CACtB,UAAAC,IAAI;AAAA,WAAIA,IAAI,CAACC,IAAL,CAAUC,IAAV,KAAmBT,gBAAvB;AAAA,GADkB,CAAxB;AAGA,MAAMU,KAAK,GAAGZ,aAAa,CAACI,UAAD,CAA3B;AACA,MAAI,CAACG,eAAL,EAAsB,OAAOH,UAAP;AANkD,MAOhES,GAPgE,GAOxDN,eAPwD,CAOhEM,GAPgE;;AAQxE,MAAID,KAAK,KAAKC,GAAd,EAAmB;AAAA;;AACjBT,IAAAA,UAAU,CAACU,OAAX,CACE,eADF,EAEEf,cAAc,CAACgB,MAAf,CAAsB;AACpBC,MAAAA,MAAM,EAAEJ,KADY;AAEpBK,MAAAA,KAAK,EAAEJ;AAFa,KAAtB,CAFF;AADiB,QAQTK,SARS,GAQKd,UAAU,CAACE,KARhB,CAQTY,SARS;;AAUjB,QAAIjB,gBAAgB,CAACiB,SAAS,CAACF,MAAX,EAAmBZ,UAAnB,CAApB,EAAoD;AAClDA,MAAAA,UAAU,CAACU,OAAX,CAAmB,YAAnB,EAAiC,CAACI,SAAD,CAAjC;AACD;;AAED,6BAAId,UAAU,CAACE,KAAf,sCAAI,kBAAkBY,SAAtB,uCAAI,sBAA6BF,MAAjC,aAAI,uBAAqCG,WAArC,EAAJ,EAAwD;AACtD;AACAf,MAAAA,UAAU,CAACU,OAAX,CAAmBhB,QAAQ,CAACsB,WAA5B,EAAyC;AAAET,QAAAA,IAAI,EAAE;AAAR,OAAzC;AACD;AACF;;AACD,SAAOP,UAAP;AACD","sourcesContent":["import { Controller, Commands, RangeSelection } from '@ali/4ever-cangjie';\nimport getStartPoint from '../utils/getStartPoint';\nimport isAtStartOfBlock from '../utils/isAtStartOfBlock';\nimport { PASTE_DECORATION } from '../../utils/constants';\n\nexport default function deleteAtRange(controller: Controller): Controller {\n  const { decorations } = controller.value;\n  const pasteDecoration = decorations.find(\n    item => item.mark.type === PASTE_DECORATION,\n  );\n  const start = getStartPoint(controller);\n  if (!pasteDecoration) return controller;\n  const { end } = pasteDecoration;\n  if (start !== end) {\n    controller.command(\n      'deleteAtRange',\n      RangeSelection.create({\n        anchor: start!,\n        focus: end,\n      }),\n    );\n    const { selection } = controller.value;\n\n    if (isAtStartOfBlock(selection.anchor, controller)) {\n      controller.command('clearStyle', [selection]);\n    }\n\n    if (controller.value?.selection?.anchor?.isEdgePoint()) {\n      // 防止插入内容首个节点是 edgeSelectable ,导致 decoration.start 标记失败\n      controller.command(Commands.insertBlock, { type: 'paragraph' });\n    }\n  }\n  return controller;\n}\n"],"file":"deleteAtRange.js"}