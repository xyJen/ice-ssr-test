import { Commands, Selection, TextPoint } from '@ali/4ever-cangjie';
import { showClipboard } from "./showClipboard";
export function insertFragmentByClipboard(controller, fragment) {
  if (fragment) {
    if (controller.query('shouldInsertParagraphBeforePaste', fragment)) {
      controller.command(Commands.insertBlock, {
        type: 'paragraph'
      });
    }

    var _controller$value = controller.value,
        document = _controller$value.document,
        selection = _controller$value.selection;

    var _selection$convertToT = selection.convertToTextPoints(document),
        convertedAnchor = _selection$convertToT.anchor;

    var startPath = document.getPath(convertedAnchor.key);
    var startOffset = convertedAnchor.offset;
    controller.command(Commands.insertFragment, fragment); // 这里是粘贴后的 focus

    var focus = controller.value.selection.focus;
    var startNode = controller.value.document.getNodeByPath(startPath);

    if (!(startNode && Number.isInteger(startOffset))) {
      return controller;
    }

    var anchor = TextPoint.create({
      key: startNode.key,
      offset: startOffset
    });

    if (anchor != null && anchor.isTextPoint() && focus.isTextPoint()) {
      controller.command(showClipboard, Selection.create({
        anchor: anchor,
        focus: focus
      }));
    }
  }

  return controller;
}
//# sourceMappingURL=insertFragmentByClipboard.js.map