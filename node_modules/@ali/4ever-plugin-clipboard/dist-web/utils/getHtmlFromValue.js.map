{"version":3,"sources":["../../../src/utils/getHtmlFromValue.ts"],"names":["environment","DATA_CLIPBORAD_CANGJIE","getHtmlFromValue","serializer","value","asl","valueToJsonML","html","jsonMLToHTML","domParser","DOMParser","wrapper","parseFromString","article","getElementsByClassName","content","JSON","stringify","setAttribute","IS_MOBILE","aslDom","window","document","createElement","style","userSelect","width","height","appendChild","children","length","insertBefore","body","innerHTML"],"mappings":"AAAA,SAASA,WAAT,EAA6BC,sBAA7B,QAA+D,oBAA/D;AAEA,eAAe,SAASC,gBAAT,CAA0BC,UAA1B,EAA0CC,KAA1C,EAAgE;AAC7E,MAAMC,GAAG,GAAGF,UAAU,CAACG,aAAX,CAAyBF,KAAzB,CAAZ;AACA,MAAMG,IAAI,GAAGJ,UAAU,CAACK,YAAX,CAAwBH,GAAxB,CAAb;AACA,MAAMI,SAAS,GAAG,IAAIC,SAAJ,EAAlB;AACA,MAAMC,OAAO,GAAGF,SAAS,CAACG,eAAV,CAA0BL,IAA1B,EAAgC,WAAhC,CAAhB;AACA,MAAMM,OAAO,GAAGF,OAAO,CAACG,sBAAR,CAA+B,eAA/B,EAAgD,CAAhD,CAAhB;AACA,MAAMC,OAAO,GAAGC,IAAI,CAACC,SAAL,CAAeZ,GAAf,CAAhB;;AACA,MAAIQ,OAAJ,EAAa;AACXA,IAAAA,OAAO,CAACK,YAAR,CAAqBjB,sBAArB,EAA6Cc,OAA7C;AACD;;AACD,MAAIf,WAAW,CAACmB,SAAhB,EAA2B;AACzB;AACA;AACA;AACA,QAAMC,MAAwB,GAAGC,MAAM,CAACC,QAAP,CAAgBC,aAAhB,CAA8B,OAA9B,CAAjC,CAJyB,CAKzB;;AACAH,IAAAA,MAAM,CAACF,YAAP,CAAoBjB,sBAApB,EAA4Cc,OAA5C,EANyB,CAOzB;;AACAK,IAAAA,MAAM,CAACI,KAAP,CAAaC,UAAb,GAA0B,MAA1B;AACAL,IAAAA,MAAM,CAACM,KAAP,GAAe,CAAf;AACAN,IAAAA,MAAM,CAACO,MAAP,GAAgB,CAAhB;AACAd,IAAAA,OAAO,CAACe,WAAR,CAAoBR,MAApB;;AACA,QAAIP,OAAO,CAACgB,QAAR,CAAiBC,MAArB,EAA6B;AAC3BjB,MAAAA,OAAO,CAACkB,YAAR,CAAqBX,MAArB,EAA6BP,OAAO,CAACgB,QAAR,CAAiB,CAAjB,CAA7B;AACD,KAFD,MAEO;AACLhB,MAAAA,OAAO,CAACe,WAAR,CAAoBR,MAApB;AACD;AACF;;AACD,SAAOT,OAAO,CAACqB,IAAR,CAAaC,SAApB;AACD","sourcesContent":["import { environment, Value, DATA_CLIPBORAD_CANGJIE, Mo } from '@ali/4ever-cangjie';\n\nexport default function getHtmlFromValue(serializer: Mo, value: Value): string {\n  const asl = serializer.valueToJsonML(value);\n  const html = serializer.jsonMLToHTML(asl);\n  const domParser = new DOMParser();\n  const wrapper = domParser.parseFromString(html, 'text/html');\n  const article = wrapper.getElementsByClassName('4ever-article')[0];\n  const content = JSON.stringify(asl);\n  if (article) {\n    article.setAttribute(DATA_CLIPBORAD_CANGJIE, content);\n  }\n  if (environment.IS_MOBILE) {\n    // 在 IOS 上复制内容，IOS 只会保留 text/html 类型的 mime type 内容，且会对 html 进行解析，清空掉 article 上挂载的 asl\n    // 安卓统一与 IOS 相同处理\n    // @ts-ignore\n    const aslDom: HTMLImageElement = window.document.createElement('image');\n    // 属性上挂载的 asl 在移动端往剪切板上写入数据时（copyFragment 方法），会被浏览器自动过滤掉，需要使用空的 image 标签再次做兜底\n    aslDom.setAttribute(DATA_CLIPBORAD_CANGJIE, content);\n    // aslDom 必须作为第一个子元素且 userSelect 设为 none，否则由于 image 占位，在 im 中粘贴会产生两个空行\n    aslDom.style.userSelect = 'none';\n    aslDom.width = 0;\n    aslDom.height = 0;\n    article.appendChild(aslDom);\n    if (article.children.length) {\n      article.insertBefore(aslDom, article.children[0]);\n    } else {\n      article.appendChild(aslDom);\n    }\n  }\n  return wrapper.body.innerHTML;\n}\n"],"file":"getHtmlFromValue.js"}