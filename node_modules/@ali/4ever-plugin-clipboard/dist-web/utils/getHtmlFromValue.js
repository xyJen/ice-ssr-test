import { environment, DATA_CLIPBORAD_CANGJIE } from '@ali/4ever-cangjie';
export default function getHtmlFromValue(serializer, value) {
  var asl = serializer.valueToJsonML(value);
  var html = serializer.jsonMLToHTML(asl);
  var domParser = new DOMParser();
  var wrapper = domParser.parseFromString(html, 'text/html');
  var article = wrapper.getElementsByClassName('4ever-article')[0];
  var content = JSON.stringify(asl);

  if (article) {
    article.setAttribute(DATA_CLIPBORAD_CANGJIE, content);
  }

  if (environment.IS_MOBILE) {
    // 在 IOS 上复制内容，IOS 只会保留 text/html 类型的 mime type 内容，且会对 html 进行解析，清空掉 article 上挂载的 asl
    // 安卓统一与 IOS 相同处理
    // @ts-ignore
    var aslDom = window.document.createElement('image'); // 属性上挂载的 asl 在移动端往剪切板上写入数据时（copyFragment 方法），会被浏览器自动过滤掉，需要使用空的 image 标签再次做兜底

    aslDom.setAttribute(DATA_CLIPBORAD_CANGJIE, content); // aslDom 必须作为第一个子元素且 userSelect 设为 none，否则由于 image 占位，在 im 中粘贴会产生两个空行

    aslDom.style.userSelect = 'none';
    aslDom.width = 0;
    aslDom.height = 0;
    article.appendChild(aslDom);

    if (article.children.length) {
      article.insertBefore(aslDom, article.children[0]);
    } else {
      article.appendChild(aslDom);
    }
  }

  return wrapper.body.innerHTML;
}
//# sourceMappingURL=getHtmlFromValue.js.map