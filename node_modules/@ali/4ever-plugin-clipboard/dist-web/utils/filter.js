/* eslint-disable import/prefer-default-export */
import { Block, Inline } from '@ali/4ever-cangjie';

/**
 * 过滤 fragment 内容
 * @param fragment
 * @param rules
 */
export function filterFragment(fragment, rules) {
  var block = rules.block,
      inline = rules.inline;
  var pruneMap = new Map();
  fragment.forEachDescendant(function (node) {
    // 过滤 block 节点
    if (Block.isBlock(node) && block) {
      var includes = block.includes,
          excludes = block.excludes;

      if (includes && !includes.test(node.type)) {
        pruneMap.set(node.key, true);
      }

      if (excludes && excludes.test(node.type)) {
        pruneMap.set(node.key, true);
      }
    } // 过滤 inline 节点


    if (Inline.isInline(node) && inline) {
      var _includes = inline.includes,
          _excludes = inline.excludes;

      if (_includes && !_includes.test(node.type)) {
        pruneMap.set(node.key, true);
      }

      if (_excludes && _excludes.test(node.type)) {
        pruneMap.set(node.key, true);
      }
    }
  });
  var result = fragment;
  pruneMap.forEach(function (_, key) {
    var path = result.getPath(key);

    if (path) {
      result = result.removeNode(path);
    }
  });
  return result;
}
//# sourceMappingURL=filter.js.map