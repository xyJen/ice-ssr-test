{"version":3,"sources":["../../../../src/utils/queries/range.ts"],"names":["getSubjectStartBlock","controller","node","document","value","path","getPath","key","index","subject","i","prev","nodes","getSubjectEndBlock","endBlock","length","next","hasSubjectGroupBlocks","nextBlock","getNextBlock"],"mappings":";;;;;;;;;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACO,SAASA,oBAAT,CAA8BC,UAA9B,EAAsDC,IAAtD,EAAmE;AACxE;AACA,MAAI,6BAAiBA,IAAjB,CAAJ,EAA4B;AAC1B,WAAOA,IAAP;AACD;;AAED,QAAM;AAAEC,IAAAA;AAAF,MAAeF,UAAU,CAACG,KAAhC;AACA,QAAMC,IAAI,GAAGF,QAAQ,CAACG,OAAT,CAAiBJ,IAAI,CAACK,GAAtB,CAAb;;AACA,MAAI,CAACF,IAAL,EAAW;AACT,WAAO,IAAP;AACD;;AACD,QAAM,CAACG,KAAD,IAAUH,IAAhB,CAXwE,CAaxE;;AACA,MAAII,OAA8B,GAAG,IAArC;AACA,MAAIC,CAAC,GAAGF,KAAK,GAAG,CAAhB;;AACA,SAAOE,CAAC,IAAI,CAAZ,EAAe;AACb,UAAMC,IAAI,GAAGR,QAAQ,CAACS,KAAT,CAAeF,CAAf,CAAb;;AACA,QAAI,6BAAiBC,IAAjB,CAAJ,EAA4B;AAC1BF,MAAAA,OAAO,GAAGE,IAAV;AACA;AACD;;AACDD,IAAAA,CAAC,IAAI,CAAL;AACD;;AAED,SAAOD,OAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASI,kBAAT,CAA4BZ,UAA5B,EAAoDC,IAApD,EAA0E;AAC/E,QAAM;AAAEC,IAAAA;AAAF,MAAeF,UAAU,CAACG,KAAhC;AACA,QAAMC,IAAI,GAAGF,QAAQ,CAACG,OAAT,CAAiBJ,IAAI,CAACK,GAAtB,CAAb;;AACA,MAAI,CAACF,IAAL,EAAW;AACT,WAAO,IAAP;AACD;;AACD,QAAM,CAACG,KAAD,IAAUH,IAAhB;AAEA,MAAIS,QAAe,GAAGZ,IAAtB;AACA,MAAIQ,CAAC,GAAGF,KAAK,GAAG,CAAhB;;AACA,SAAOE,CAAC,GAAGP,QAAQ,CAACS,KAAT,CAAeG,MAA1B,EAAkC;AAChC,UAAMC,IAAI,GAAGb,QAAQ,CAACS,KAAT,CAAeF,CAAf,CAAb;;AACA,QAAI,6BAAiBM,IAAjB,CAAJ,EAA4B;AAC1B;AACD;;AACDF,IAAAA,QAAQ,GAAGE,IAAX;AACAN,IAAAA,CAAC,IAAI,CAAL;AACD;;AAED,SAAOI,QAAP;AACD;AAED;AACA;AACA;AACA;AACA;;;AACO,SAASG,qBAAT,CAA+BhB,UAA/B,EAAuDC,IAAvD,EAA6E;AAClF,QAAM;AAAEC,IAAAA;AAAF,MAAeF,UAAU,CAACG,KAAhC;AACA,QAAMc,SAAS,GAAGf,QAAQ,CAACgB,YAAT,CAAsBjB,IAAI,CAACK,GAA3B,CAAlB;AAEA,SAAO,CAAC,CAACW,SAAF,IAAe,CAAC,6BAAiBA,SAAjB,CAAvB;AACD","sourcesContent":["import { Block, Controller } from '@ali/4ever-cangjie';\nimport { isSubjectHeading, SubjectHeading } from '../utils';\n\n/**\n * 查询节点所在的议题节点\n * @param controller\n * @param node\n * @returns\n */\nexport function getSubjectStartBlock(controller: Controller, node: Block) {\n  // 议题节点没有父级议题\n  if (isSubjectHeading(node)) {\n    return node;\n  }\n\n  const { document } = controller.value;\n  const path = document.getPath(node.key);\n  if (!path) {\n    return null;\n  }\n  const [index] = path;\n\n  // 查询第一个议题节点返回\n  let subject: SubjectHeading | null = null;\n  let i = index - 1;\n  while (i >= 0) {\n    const prev = document.nodes[i];\n    if (isSubjectHeading(prev)) {\n      subject = prev;\n      break;\n    }\n    i -= 1;\n  }\n\n  return subject;\n}\n\n/**\n * 查询议题的末尾节点\n * @param controller\n * @param node\n * @returns\n */\nexport function getSubjectEndBlock(controller: Controller, node: SubjectHeading) {\n  const { document } = controller.value;\n  const path = document.getPath(node.key);\n  if (!path) {\n    return null;\n  }\n  const [index] = path;\n\n  let endBlock: Block = node;\n  let i = index + 1;\n  while (i < document.nodes.length) {\n    const next = document.nodes[i];\n    if (isSubjectHeading(next)) {\n      break;\n    }\n    endBlock = next;\n    i += 1;\n  }\n\n  return endBlock;\n}\n\n/**\n * 查询议题是否包含聚合子节点\n * @param controller\n * @param node\n */\nexport function hasSubjectGroupBlocks(controller: Controller, node: SubjectHeading) {\n  const { document } = controller.value;\n  const nextBlock = document.getNextBlock(node.key);\n\n  return !!nextBlock && !isSubjectHeading(nextBlock);\n}\n"],"file":"range.js"}