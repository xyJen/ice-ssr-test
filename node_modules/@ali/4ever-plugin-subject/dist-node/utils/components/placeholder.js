"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var React = _interopRequireWildcard(require("react"));

var _everCangjie = require("@ali/4ever-cangjie");

var _utils = require("../utils");

var _Portal = _interopRequireDefault(require("./Portal"));

/* eslint-disable react/no-find-dom-node */
const _createElement = /*#__PURE__*/React.createElement;

const Placeholder = props => {
  const {
    controller,
    node,
    placeholder = '',
    display = _utils.isEmptyNode,
    children
  } = props;
  const {
    document,
    selection,
    composing
  } = controller.value;
  const [domNode, setDomNode] = React.useState();
  const nodeRef = React.useRef(node);
  nodeRef.current = node;
  const [, forceRender] = React.useReducer(s => s + 1, 0);
  React.useEffect(() => {
    const sub = controller.inputData$.subscribe(({
      key
    }) => {
      if (nodeRef.current.hasNode(key)) {
        forceRender();
      }
    });
    return () => sub.unsubscribe();
  }, [controller, forceRender]);
  React.useLayoutEffect(() => {
    const dom = _everCangjie.domUtils.findDOMNodeSafely(node.key);

    setDomNode(dom);
  }, [node]);
  const dataNode = document.getNode(node.key);

  const portal = (!composing || !node.hasNode(selection.anchor.key)) && dataNode && display(dataNode) && domNode && /*#__PURE__*/_createElement(_Portal.default, {
    container: domNode
  }, placeholder);

  return /*#__PURE__*/_createElement(React.Fragment, null, portal, children);
};

Placeholder.displayName = 'Placeholder';
var _default = Placeholder;
exports.default = _default;
//# sourceMappingURL=placeholder.js.map