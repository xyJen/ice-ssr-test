{"version":3,"sources":["../../../../src/utils/components/placeholder.tsx"],"names":["Placeholder","props","controller","node","placeholder","display","isEmptyNode","children","document","selection","composing","value","domNode","setDomNode","React","useState","nodeRef","useRef","current","forceRender","useReducer","s","useEffect","sub","inputData$","subscribe","key","hasNode","unsubscribe","useLayoutEffect","dom","domUtils","findDOMNodeSafely","dataNode","getNode","portal","anchor","displayName"],"mappings":";;;;;;;;;;;AACA;;AACA;;AACA;;AACA;;AAJA;uBAC4B,a;;AAqB5B,MAAMA,WAAuC,GAAIC,KAAD,IAAW;AACzD,QAAM;AACJC,IAAAA,UADI;AAEJC,IAAAA,IAFI;AAGJC,IAAAA,WAAW,GAAG,EAHV;AAIJC,IAAAA,OAAO,GAAGC,kBAJN;AAKJC,IAAAA;AALI,MAMFN,KANJ;AAOA,QAAM;AAAEO,IAAAA,QAAF;AAAYC,IAAAA,SAAZ;AAAuBC,IAAAA;AAAvB,MAAqCR,UAAU,CAACS,KAAtD;AAEA,QAAM,CAACC,OAAD,EAAUC,UAAV,IAAwBC,KAAK,CAACC,QAAN,EAA9B;AAEA,QAAMC,OAAO,GAAGF,KAAK,CAACG,MAAN,CAAad,IAAb,CAAhB;AACAa,EAAAA,OAAO,CAACE,OAAR,GAAkBf,IAAlB;AAEA,QAAM,GAAGgB,WAAH,IAAkBL,KAAK,CAACM,UAAN,CAAkBC,CAAD,IAAOA,CAAC,GAAG,CAA5B,EAA+B,CAA/B,CAAxB;AACAP,EAAAA,KAAK,CAACQ,SAAN,CAAgB,MAAM;AACpB,UAAMC,GAAG,GAAGrB,UAAU,CAACsB,UAAX,CAAsBC,SAAtB,CAAgC,CAAC;AAAEC,MAAAA;AAAF,KAAD,KAAa;AACvD,UAAIV,OAAO,CAACE,OAAR,CAAgBS,OAAhB,CAAwBD,GAAxB,CAAJ,EAAkC;AAChCP,QAAAA,WAAW;AACZ;AACF,KAJW,CAAZ;AAKA,WAAO,MAAMI,GAAG,CAACK,WAAJ,EAAb;AACD,GAPD,EAOG,CAAC1B,UAAD,EAAaiB,WAAb,CAPH;AASAL,EAAAA,KAAK,CAACe,eAAN,CAAsB,MAAM;AAC1B,UAAMC,GAAG,GAAGC,sBAASC,iBAAT,CAA2B7B,IAAI,CAACuB,GAAhC,CAAZ;;AACAb,IAAAA,UAAU,CAACiB,GAAD,CAAV;AACD,GAHD,EAGG,CAAC3B,IAAD,CAHH;AAKA,QAAM8B,QAAQ,GAAGzB,QAAQ,CAAC0B,OAAT,CAAiB/B,IAAI,CAACuB,GAAtB,CAAjB;;AACA,QAAMS,MAAM,GAAG,CAAC,CAACzB,SAAD,IAAc,CAACP,IAAI,CAACwB,OAAL,CAAalB,SAAS,CAAC2B,MAAV,CAAiBV,GAA9B,CAAhB,KAAuDO,QAAvD,IAAmE5B,OAAO,CAAC4B,QAAD,CAA1E,IAAwFrB,OAAxF,iBACb,eAAC,eAAD;AAAQ,IAAA,SAAS,EAAEA;AAAnB,KACGR,WADH,CADF;;AAMA,sBACE,qCACG+B,MADH,EAEG5B,QAFH,CADF;AAMD,CA3CD;;AA6CAP,WAAW,CAACqC,WAAZ,GAA0B,aAA1B;eAEerC,W","sourcesContent":["/* eslint-disable react/no-find-dom-node */\nimport * as React from 'react';\nimport { Controller, Block, domUtils } from '@ali/4ever-cangjie';\nimport { isEmptyNode } from '../utils';\nimport Portal from './Portal';\n\nexport interface PlaceholderProps {\n  controller: Controller;\n  /**\n   * 需要注入 placeholder 的节点\n   */\n  node: Block;\n  /**\n   * Placeholder 组件/文本\n   */\n  placeholder?: React.ReactNode;\n  /**\n   * 是否展示 Placeholder\n   */\n  display?: (node: Block) => boolean;\n}\n\nconst Placeholder: React.FC<PlaceholderProps> = (props) => {\n  const {\n    controller,\n    node,\n    placeholder = '',\n    display = isEmptyNode,\n    children,\n  } = props;\n  const { document, selection, composing } = controller.value;\n\n  const [domNode, setDomNode] = React.useState<Element | undefined>();\n\n  const nodeRef = React.useRef(node);\n  nodeRef.current = node;\n\n  const [, forceRender] = React.useReducer((s) => s + 1, 0);\n  React.useEffect(() => {\n    const sub = controller.inputData$.subscribe(({ key }) => {\n      if (nodeRef.current.hasNode(key)) {\n        forceRender()\n      }\n    });\n    return () => sub.unsubscribe();\n  }, [controller, forceRender]);\n\n  React.useLayoutEffect(() => {\n    const dom = domUtils.findDOMNodeSafely(node.key);\n    setDomNode(dom);\n  }, [node]);\n\n  const dataNode = document.getNode(node.key) as Block;\n  const portal = (!composing || !node.hasNode(selection.anchor.key)) && dataNode && display(dataNode) && domNode && (\n    <Portal container={domNode}>\n      {placeholder}\n    </Portal>\n  );\n\n  return (\n    <>\n      {portal}\n      {children}\n    </>\n  );\n};\n\nPlaceholder.displayName = 'Placeholder';\n\nexport default Placeholder;\n"],"file":"placeholder.js"}