"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _everCangjie = require("@ali/4ever-cangjie");

var _everUtils = require("@ali/4ever-utils");

var _queries = require("../queries");

function createRenderMark(options = {}) {
  const {
    inject = false
  } = options;
  return function renderMark(props, controller, next) {
    const {
      mark,
      node
    } = props;
    const {
      document,
      injections
    } = controller.value;

    if (mark.type === 'match' && mark.data.selected) {
      const block = document.getFurthsestBlock(node.key);
      let subject = block && controller.query(_queries.getSubjectStartBlock, block); // 注入 Injection 数据

      if (inject && subject) {
        subject = _everCangjie.Injection.injectIntoNode(injections, subject);
      }

      if (subject && controller.userData.get(subject, 'fold')) {
        controller.run('onAction', (0, _everUtils.toggleFold)({
          node: subject,
          fold: false
        }));
      }
    }

    return next();
  };
}

var _default = createRenderMark;
exports.default = _default;
//# sourceMappingURL=createRenderMark.js.map