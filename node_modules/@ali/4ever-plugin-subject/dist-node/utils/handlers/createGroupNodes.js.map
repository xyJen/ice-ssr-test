{"version":3,"sources":["../../../../src/utils/handlers/createGroupNodes.ts"],"names":["createGroupNodes","groupNodes","start","end","ctx","controller","next","parent","groups","first","nodes","parentGroup","length","Document","isDocument","i","node","children","slice","subject","key","data","remainedRange"],"mappings":";;;;;;;AAAA;;AACA;;AAEA,SAASA,gBAAT,GAAkD;AAChD,SAAO,SAASC,UAAT,CAAoB,CAACC,KAAD,EAAQC,GAAR,CAApB,EAAkCC,GAAlC,EAAuCC,UAAvC,EAAmDC,IAAnD,EAAyD;AAC9D,UAAM;AAAEC,MAAAA,MAAF;AAAUC,MAAAA;AAAV,QAAqBJ,GAA3B;AACA,UAAMK,KAAK,GAAGF,MAAM,CAACG,KAAP,CAAaR,KAAb,CAAd;AACA,UAAMS,WAAW,GAAGH,MAAM,CAACA,MAAM,CAACI,MAAP,GAAgB,CAAjB,CAA1B,CAH8D,CAK9D;;AACA,QAAI,CAACC,sBAASC,UAAT,CAAoBP,MAApB,CAAL,EAAkC;AAChC,aAAOD,IAAI,EAAX;AACD;;AAED,QAAI,6BAAiBG,KAAjB,KAA2B,CAAC,sBAAUE,WAAV,CAAhC,EAAwD;AACtD,UAAII,CAAC,GAAGb,KAAK,GAAG,CAAhB;;AACA,aAAOa,CAAC,GAAGZ,GAAX,EAAgB;AACd,cAAMa,IAAI,GAAGT,MAAM,CAACG,KAAP,CAAaK,CAAb,CAAb;;AACA,YAAI,6BAAiBC,IAAjB,CAAJ,EAA4B;AAC1B;AACD;;AACDD,QAAAA,CAAC,IAAI,CAAL;AACD;;AAED,YAAME,QAAQ,GAAGV,MAAM,CAACG,KAAP,CAAaQ,KAAb,CAAmBhB,KAAnB,EAA0Ba,CAA1B,CAAjB;AAEA,YAAMI,OAAO,GAAG,0BAAc;AAC5BC,QAAAA,GAAG,EAAG,GAAEX,KAAK,CAACW,GAAI,QADU;AAE5BC,QAAAA,IAAI,EAAEZ,KAAK,CAACY,IAFgB;AAG5BX,QAAAA,KAAK,EAAEO;AAHqB,OAAd,CAAhB;AAMA,aAAO;AACLD,QAAAA,IAAI,EAAEG,OADD;AAELG,QAAAA,aAAa,EAAE,CAACP,CAAD,EAAIZ,GAAJ;AAFV,OAAP;AAID;;AAED,WAAOG,IAAI,EAAX;AACD,GAnCD;AAoCD;;eAEcN,gB","sourcesContent":["import { Plugin, Document } from '@ali/4ever-cangjie';\nimport { createSubject, isSubject, isSubjectHeading } from '../utils';\n\nfunction createGroupNodes(): Plugin['groupNodes'] {\n  return function groupNodes([start, end], ctx, controller, next) {\n    const { parent, groups } = ctx;\n    const first = parent.nodes[start];\n    const parentGroup = groups[groups.length - 1];\n\n    // 如果不是一级节点，或者是文档末尾，则不分组\n    if (!Document.isDocument(parent)) {\n      return next();\n    }\n\n    if (isSubjectHeading(first) && !isSubject(parentGroup)) {\n      let i = start + 1;\n      while (i < end) {\n        const node = parent.nodes[i];\n        if (isSubjectHeading(node)) {\n          break;\n        }\n        i += 1;\n      }\n\n      const children = parent.nodes.slice(start, i);\n\n      const subject = createSubject({\n        key: `${first.key}-group`,\n        data: first.data,\n        nodes: children,\n      });\n\n      return {\n        node: subject,\n        remainedRange: [i, end],\n      };\n    }\n\n    return next();\n  };\n}\n\nexport default createGroupNodes;\n"],"file":"createGroupNodes.js"}