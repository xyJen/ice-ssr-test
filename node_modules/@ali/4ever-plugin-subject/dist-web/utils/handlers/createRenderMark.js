import { Injection } from '@ali/4ever-cangjie';
import { toggleFold } from '@ali/4ever-utils';
import { getSubjectStartBlock } from "../queries";

function createRenderMark(options) {
  if (options === void 0) {
    options = {};
  }

  var _options = options,
      _options$inject = _options.inject,
      inject = _options$inject === void 0 ? false : _options$inject;
  return function renderMark(props, controller, next) {
    var mark = props.mark,
        node = props.node;
    var _controller$value = controller.value,
        document = _controller$value.document,
        injections = _controller$value.injections;

    if (mark.type === 'match' && mark.data.selected) {
      var block = document.getFurthsestBlock(node.key);
      var subject = block && controller.query(getSubjectStartBlock, block); // 注入 Injection 数据

      if (inject && subject) {
        subject = Injection.injectIntoNode(injections, subject);
      }

      if (subject && controller.userData.get(subject, 'fold')) {
        controller.run('onAction', toggleFold({
          node: subject,
          fold: false
        }));
      }
    }

    return next();
  };
}

export default createRenderMark;
//# sourceMappingURL=createRenderMark.js.map