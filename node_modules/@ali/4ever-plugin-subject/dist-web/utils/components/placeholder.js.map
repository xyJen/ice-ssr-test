{"version":3,"sources":["../../../../src/utils/components/placeholder.tsx"],"names":["React","domUtils","isEmptyNode","Portal","Placeholder","props","controller","node","placeholder","display","children","value","document","selection","composing","useState","domNode","setDomNode","nodeRef","useRef","current","useReducer","s","forceRender","useEffect","sub","inputData$","subscribe","key","hasNode","unsubscribe","useLayoutEffect","dom","findDOMNodeSafely","dataNode","getNode","portal","anchor","displayName"],"mappings":"AAAA;AACA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;qBAA4B,a;AAC5B,SAA4BC,QAA5B,QAA4C,oBAA5C;AACA,SAASC,WAAT;AACA,OAAOC,MAAP;;AAkBA,IAAMC,WAAuC,GAAG,SAA1CA,WAA0C,CAACC,KAAD,EAAW;AAAA,MAEvDC,UAFuD,GAOrDD,KAPqD,CAEvDC,UAFuD;AAAA,MAGvDC,IAHuD,GAOrDF,KAPqD,CAGvDE,IAHuD;AAAA,2BAOrDF,KAPqD,CAIvDG,WAJuD;AAAA,MAIvDA,WAJuD,mCAIzC,EAJyC;AAAA,uBAOrDH,KAPqD,CAKvDI,OALuD;AAAA,MAKvDA,OALuD,+BAK7CP,WAL6C;AAAA,MAMvDQ,QANuD,GAOrDL,KAPqD,CAMvDK,QANuD;AAAA,0BAQdJ,UAAU,CAACK,KARG;AAAA,MAQjDC,QARiD,qBAQjDA,QARiD;AAAA,MAQvCC,SARuC,qBAQvCA,SARuC;AAAA,MAQ5BC,SAR4B,qBAQ5BA,SAR4B;;AAAA,wBAU3Bd,KAAK,CAACe,QAAN,EAV2B;AAAA,MAUlDC,OAVkD;AAAA,MAUzCC,UAVyC;;AAYzD,MAAMC,OAAO,GAAGlB,KAAK,CAACmB,MAAN,CAAaZ,IAAb,CAAhB;AACAW,EAAAA,OAAO,CAACE,OAAR,GAAkBb,IAAlB;;AAbyD,0BAejCP,KAAK,CAACqB,UAAN,CAAiB,UAACC,CAAD;AAAA,WAAOA,CAAC,GAAG,CAAX;AAAA,GAAjB,EAA+B,CAA/B,CAfiC;AAAA,MAehDC,WAfgD;;AAgBzDvB,EAAAA,KAAK,CAACwB,SAAN,CAAgB,YAAM;AACpB,QAAMC,GAAG,GAAGnB,UAAU,CAACoB,UAAX,CAAsBC,SAAtB,CAAgC,gBAAa;AAAA,UAAVC,GAAU,QAAVA,GAAU;;AACvD,UAAIV,OAAO,CAACE,OAAR,CAAgBS,OAAhB,CAAwBD,GAAxB,CAAJ,EAAkC;AAChCL,QAAAA,WAAW;AACZ;AACF,KAJW,CAAZ;AAKA,WAAO;AAAA,aAAME,GAAG,CAACK,WAAJ,EAAN;AAAA,KAAP;AACD,GAPD,EAOG,CAACxB,UAAD,EAAaiB,WAAb,CAPH;AASAvB,EAAAA,KAAK,CAAC+B,eAAN,CAAsB,YAAM;AAC1B,QAAMC,GAAG,GAAG/B,QAAQ,CAACgC,iBAAT,CAA2B1B,IAAI,CAACqB,GAAhC,CAAZ;AACAX,IAAAA,UAAU,CAACe,GAAD,CAAV;AACD,GAHD,EAGG,CAACzB,IAAD,CAHH;AAKA,MAAM2B,QAAQ,GAAGtB,QAAQ,CAACuB,OAAT,CAAiB5B,IAAI,CAACqB,GAAtB,CAAjB;;AACA,MAAMQ,MAAM,GAAG,CAAC,CAACtB,SAAD,IAAc,CAACP,IAAI,CAACsB,OAAL,CAAahB,SAAS,CAACwB,MAAV,CAAiBT,GAA9B,CAAhB,KAAuDM,QAAvD,IAAmEzB,OAAO,CAACyB,QAAD,CAA1E,IAAwFlB,OAAxF,iBACb,eAAC,MAAD;AAAQ,IAAA,SAAS,EAAEA;AAAnB,KACGR,WADH,CADF;;AAMA,sBACE,qCACG4B,MADH,EAEG1B,QAFH,CADF;AAMD,CA3CD;;AA6CAN,WAAW,CAACkC,WAAZ,GAA0B,aAA1B;AAEA,eAAelC,WAAf","sourcesContent":["/* eslint-disable react/no-find-dom-node */\nimport * as React from 'react';\nimport { Controller, Block, domUtils } from '@ali/4ever-cangjie';\nimport { isEmptyNode } from '../utils';\nimport Portal from './Portal';\n\nexport interface PlaceholderProps {\n  controller: Controller;\n  /**\n   * 需要注入 placeholder 的节点\n   */\n  node: Block;\n  /**\n   * Placeholder 组件/文本\n   */\n  placeholder?: React.ReactNode;\n  /**\n   * 是否展示 Placeholder\n   */\n  display?: (node: Block) => boolean;\n}\n\nconst Placeholder: React.FC<PlaceholderProps> = (props) => {\n  const {\n    controller,\n    node,\n    placeholder = '',\n    display = isEmptyNode,\n    children,\n  } = props;\n  const { document, selection, composing } = controller.value;\n\n  const [domNode, setDomNode] = React.useState<Element | undefined>();\n\n  const nodeRef = React.useRef(node);\n  nodeRef.current = node;\n\n  const [, forceRender] = React.useReducer((s) => s + 1, 0);\n  React.useEffect(() => {\n    const sub = controller.inputData$.subscribe(({ key }) => {\n      if (nodeRef.current.hasNode(key)) {\n        forceRender()\n      }\n    });\n    return () => sub.unsubscribe();\n  }, [controller, forceRender]);\n\n  React.useLayoutEffect(() => {\n    const dom = domUtils.findDOMNodeSafely(node.key);\n    setDomNode(dom);\n  }, [node]);\n\n  const dataNode = document.getNode(node.key) as Block;\n  const portal = (!composing || !node.hasNode(selection.anchor.key)) && dataNode && display(dataNode) && domNode && (\n    <Portal container={domNode}>\n      {placeholder}\n    </Portal>\n  );\n\n  return (\n    <>\n      {portal}\n      {children}\n    </>\n  );\n};\n\nPlaceholder.displayName = 'Placeholder';\n\nexport default Placeholder;\n"],"file":"placeholder.js"}