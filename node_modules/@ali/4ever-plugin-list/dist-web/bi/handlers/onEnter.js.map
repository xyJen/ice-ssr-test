{"version":3,"sources":["../../../../src/bi/handlers/onEnter.ts"],"names":["Commands","Text","increaseItemDepth","splitListItem","removeListNode","toggleWrapInList","getItemDepth","isList","STATS_WITH_1","STATS_WITH_a","STATS_WITH_A","DEFAULT_NUMBER_LIST_ARRAY","isEmptyNode","block","onlyOneChild","nodes","length","isTextNode","isText","isEmpty","text","event","controller","next","value","selection","currentItem","startBlock","firstNode","getFirstNode","firstText","startsWith1","test","startsWitha","startsWithA","specialField","data","list","preventDefault","isCollapsed","anchor","isAtEndOfNode","command","removeTextByKey","key","shiftKey"],"mappings":"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","sourcesContent":["import { Block, Commands, Controller, Text } from '@ali/4ever-cangjie';\nimport {\n  increaseItemDepth,\n  splitListItem,\n  removeListNode,\n  toggleWrapInList,\n} from '../commands';\nimport { getItemDepth, isList } from '../utils';\nimport { STATS_WITH_1, STATS_WITH_a, STATS_WITH_A } from '../regexp';\nimport { DEFAULT_NUMBER_LIST_ARRAY } from '../../utils/listStyleMapping';\n\nfunction isEmptyNode(block: Block): boolean {\n  const onlyOneChild = block.nodes.length === 1;\n  const isTextNode = Text.isText(block.nodes[0]);\n  const isEmpty = !block.text;\n  return onlyOneChild && isTextNode && isEmpty;\n}\n\nexport default (event, controller: Controller, next) => {\n  const { value } = controller;\n  const { selection } = value;\n  const currentItem = value.startBlock;\n  if (!currentItem) return next();\n  const firstNode = currentItem.getFirstNode();\n  const firstText = firstNode.text || '';\n  const startsWith1 = STATS_WITH_1.test(firstText);\n  const startsWitha = STATS_WITH_a.test(firstText);\n  const startsWithA = STATS_WITH_A.test(firstText);\n  const specialField = startsWith1 || startsWitha || startsWithA;\n  if ((!currentItem || !currentItem.data.list) && !specialField) return next();\n  event.preventDefault();\n\n\n  if (isEmptyNode(currentItem)) {\n    if (getItemDepth(currentItem) > 0) {\n      return increaseItemDepth(controller, -1);\n    }\n    return removeListNode(controller);\n  }\n\n  if (\n    !isList(currentItem)\n  ) {\n    if (selection.isCollapsed &&\n      selection.anchor.isAtEndOfNode(currentItem)) {\n        if (startsWith1) {\n          controller.command(Commands.removeTextByKey, firstNode.key, 0, '1.');\n          toggleWrapInList(controller, 'olist', DEFAULT_NUMBER_LIST_ARRAY[0]);\n        } else if (startsWitha) {\n          controller.command(Commands.removeTextByKey, firstNode.key, 0, 'a.');\n          toggleWrapInList(controller, 'olist', DEFAULT_NUMBER_LIST_ARRAY[8]);\n        } else if (startsWithA) {\n          controller.command(Commands.removeTextByKey, firstNode.key, 0, 'A.');\n          toggleWrapInList(controller, 'olist', DEFAULT_NUMBER_LIST_ARRAY[3]);\n        }\n    } else {\n      return next();\n    }\n  }\n  return splitListItem(controller, event.shiftKey);\n};\n"],"file":"onEnter.js"}