import { Commands } from '@ali/4ever-cangjie';
import { increaseItemDepth, removeListNode } from "../commands";
import { getItemDepth, isEmpty, assertZeroCharacter, mergeMabeGroupNode, isList } from "../utils";
export default (function (event, controller, next) {
  var value = controller.value;
  var selection = value.selection;
  var startBlock = value.startBlock;

  if (assertZeroCharacter(controller)) {
    return controller.command(Commands.deleteBackward, 2);
  }

  if (!selection || !startBlock || selection.isExpanded || selection.anchor.offset > 0) return next();
  var currentItem = value.startBlock;
  if (!currentItem) return next();
  var isAtBlockStart = selection.anchor.isAtStartOfNode(startBlock);
  if (!isEmpty(currentItem) && !isAtBlockStart) return next();

  if (!isList(currentItem)) {
    mergeMabeGroupNode(currentItem, controller);
    return next();
  }

  ;
  event.preventDefault();

  if (isEmpty(currentItem) && getItemDepth(currentItem) > 0) {
    return increaseItemDepth(controller, -1);
  }

  return removeListNode(controller);
});
//# sourceMappingURL=onBackspace.js.map