{"version":3,"sources":["../../../../src/bi/handlers/onBackspace.ts"],"names":["Commands","increaseItemDepth","removeListNode","getItemDepth","isEmpty","assertZeroCharacter","mergeMabeGroupNode","isList","event","controller","next","value","selection","startBlock","command","deleteBackward","isExpanded","anchor","offset","currentItem","isAtBlockStart","isAtStartOfNode","preventDefault"],"mappings":"AAAA,SAA6CA,QAA7C,QAAwE,oBAAxE;AACA,SAASC,iBAAT,EAA4BC,cAA5B;AACA,SAASC,YAAT,EAAuBC,OAAvB,EAAgCC,mBAAhC,EAAqDC,kBAArD,EAAyEC,MAAzE;AAEA,gBAAe,UAACC,KAAD,EAAQC,UAAR,EAAgCC,IAAhC,EAAyC;AAAA,MAC9CC,KAD8C,GACpCF,UADoC,CAC9CE,KAD8C;AAEtD,MAAMC,SAAS,GAAGD,KAAK,CAACC,SAAxB;AACA,MAAMC,UAAU,GAAGF,KAAK,CAACE,UAAzB;;AAEA,MAAIR,mBAAmB,CAACI,UAAD,CAAvB,EAAqC;AACnC,WAAOA,UAAU,CAACK,OAAX,CAAmBd,QAAQ,CAACe,cAA5B,EAA4C,CAA5C,CAAP;AACD;;AAED,MACE,CAACH,SAAD,IACA,CAACC,UADD,IAEAD,SAAS,CAACI,UAFV,IAGCJ,SAAS,CAACK,MAAX,CAAgCC,MAAhC,GAAyC,CAJ3C,EAKE,OAAOR,IAAI,EAAX;AAEF,MAAMS,WAAW,GAAGR,KAAK,CAACE,UAA1B;AACA,MAAI,CAACM,WAAL,EAAkB,OAAOT,IAAI,EAAX;AAElB,MAAMU,cAAc,GAAGR,SAAS,CAACK,MAAV,CAAiBI,eAAjB,CAAiCR,UAAjC,CAAvB;AACA,MAAI,CAACT,OAAO,CAACe,WAAD,CAAR,IAAyB,CAACC,cAA9B,EAA8C,OAAOV,IAAI,EAAX;;AAE9C,MAAI,CAACH,MAAM,CAACY,WAAD,CAAX,EAA0B;AACxBb,IAAAA,kBAAkB,CAACa,WAAD,EAAcV,UAAd,CAAlB;AACA,WAAOC,IAAI,EAAX;AACD;;AAAA;AACDF,EAAAA,KAAK,CAACc,cAAN;;AACA,MAAIlB,OAAO,CAACe,WAAD,CAAP,IAAwBhB,YAAY,CAACgB,WAAD,CAAZ,GAA4B,CAAxD,EAA2D;AACzD,WAAOlB,iBAAiB,CAACQ,UAAD,EAAa,CAAC,CAAd,CAAxB;AACD;;AACD,SAAOP,cAAc,CAACO,UAAD,CAArB;AACD,CA/BD","sourcesContent":["import { Block, Controller, Selection, Text, Commands, TextPoint } from '@ali/4ever-cangjie';\nimport { increaseItemDepth, removeListNode } from '../commands';\nimport { getItemDepth, isEmpty, assertZeroCharacter, mergeMabeGroupNode, isList } from '../utils';\n\nexport default (event, controller: Controller, next) => {\n  const { value } = controller;\n  const selection = value.selection as Selection;\n  const startBlock = value.startBlock as Block;\n  \n  if (assertZeroCharacter(controller)) {\n    return controller.command(Commands.deleteBackward, 2);\n  }\n\n  if (\n    !selection ||\n    !startBlock ||\n    selection.isExpanded ||\n    (selection.anchor as TextPoint).offset > 0\n  ) return next();\n\n  const currentItem = value.startBlock;\n  if (!currentItem) return next();\n\n  const isAtBlockStart = selection.anchor.isAtStartOfNode(startBlock);\n  if (!isEmpty(currentItem) && !isAtBlockStart) return next();\n\n  if (!isList(currentItem)) {\n    mergeMabeGroupNode(currentItem, controller);\n    return next()\n  };\n  event.preventDefault();\n  if (isEmpty(currentItem) && getItemDepth(currentItem) > 0) {\n    return increaseItemDepth(controller, -1);\n  }\n  return removeListNode(controller);\n};\n"],"file":"onBackspace.js"}