{"version":3,"sources":["../../../../src/bi/utils/getSiblingItems.ts"],"names":["isInSameList","value","currrentItem","key","currentList","data","list","listId","targetLevel","level","document","root","getParent","nodesLength","nodes","length","prevLevel","siblingsMap","findTarget","i","node","listConfig","push"],"mappings":"AACA,SAASA,YAAT;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,gBAAe,UAACC,KAAD,EAAeC,YAAf,EAAgD;AAAA,MACrDC,GADqD,GAC7CD,YAD6C,CACrDC,GADqD;AAE7D,MAAMC,WAAW,GAAGF,YAAY,CAACG,IAAb,CAAkBC,IAAtC;AACA,MAAI,CAACH,GAAD,IAAQ,CAACC,WAAb,EAA0B,OAAO,CAACF,YAAD,CAAP;AAHmC,MAIrDK,MAJqD,GAItBH,WAJsB,CAIrDG,MAJqD;AAAA,MAItCC,WAJsC,GAItBJ,WAJsB,CAI7CK,KAJ6C;AAAA,MAKrDC,QALqD,GAKxCT,KALwC,CAKrDS,QALqD;AAM7D,MAAMC,IAAI,GAAGD,QAAQ,CAACE,SAAT,CAAmBT,GAAnB,KAA2BO,QAAxC;AACA,MAAMG,WAAW,GAAG,CAAAF,IAAI,QAAJ,YAAAA,IAAI,CAAEG,KAAN,CAAYC,MAAZ,KAAsB,CAA1C;AACA,MAAIC,SAAS,GAAG,CAAhB;AACA,MAAMC,WAAW,GAAG,EAApB;AACA,MAAIC,UAAU,GAAG,KAAjB;;AACA,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,WAApB,EAAiCM,CAAC,EAAlC,EAAsC;AACpC,QAAMC,IAAI,GAAGT,IAAH,oBAAGA,IAAI,CAAEG,KAAN,CAAYK,CAAZ,CAAb;AACA,QAAME,UAAU,GAAGD,IAAI,CAACf,IAAL,CAAUC,IAA7B,CAFoC,CAIpC;;AACA,QAAI,CAACN,YAAY,CAACqB,UAAD,EAAad,MAAb,CAAjB,EAAuC;AACrC;AACD,KAPmC,CASpC;;;AACA,QAAI,CAACU,WAAW,CAACI,UAAU,CAACZ,KAAZ,CAAhB,EAAoC;AAClCQ,MAAAA,WAAW,CAACI,UAAU,CAACZ,KAAZ,CAAX,GAAgC,EAAhC;AACD,KAZmC,CAcpC;;;AACA,QAAIS,UAAU,IAAIG,UAAU,CAACZ,KAAX,GAAmBD,WAArC,EAAkD;AAChD;AACD,KAjBmC,CAmBpC;;;AACA,QAAIa,UAAU,CAACZ,KAAX,GAAmBO,SAAvB,EAAkC;AAChCC,MAAAA,WAAW,CAACD,SAAD,CAAX,GAAyB,EAAzB;AACD;;AAED,QAAII,IAAI,CAACjB,GAAL,KAAaA,GAAjB,EAAsB;AACpBe,MAAAA,UAAU,GAAG,IAAb;AACD;;AAEDF,IAAAA,SAAS,GAAGK,UAAU,CAACZ,KAAvB;AACAQ,IAAAA,WAAW,CAACI,UAAU,CAACZ,KAAZ,CAAX,CAA8Ba,IAA9B,CAAmCF,IAAnC;AACD;;AACD,SAAOH,WAAW,CAACT,WAAD,CAAX,IAA4B,EAAnC;AACD,CA3CD","sourcesContent":["import { Value, Block } from '@ali/4ever-cangjie';\nimport { isInSameList } from '../../utils/isInSameList';\n\n/**\n * @description 当光标在 钉钉文档2c 的列表项内容时,它的兄弟项就是 2a、2b、2c、2d\n *\n *   1. 钉钉文档1\n *      a. 钉钉文档1a\n *      b. 钉钉文档1b\n *         i. 钉钉文档1bi\n *        ii. 钉钉文档1bii\n *       iii. 钉钉文档1biii\n *      c. 钉钉文档1c\n *      d. 钉钉文档1d\n *   2. 钉钉文档2\n *     a. 钉钉文档2a\n *     b. 钉钉文档2b\n *         i. 钉钉文档2bi\n *        ii. 钉钉文档2bii\n *       iii. 钉钉文档2biii\n *     c. 钉钉文档2c\n *     d. 钉钉文档2d\n *   3. 钉钉文档3\n *\n * */\n\nexport default (value: Value, currrentItem: Block): Block[] => {\n  const { key } = currrentItem;\n  const currentList = currrentItem.data.list;\n  if (!key || !currentList) return [currrentItem];\n  const { listId, level: targetLevel } = currentList;\n  const { document } = value;\n  const root = document.getParent(key) || document;\n  const nodesLength = root?.nodes.length || 0;\n  let prevLevel = 0;\n  const siblingsMap = {};\n  let findTarget = false;\n  for (let i = 0; i < nodesLength; i++) {\n    const node = root?.nodes[i] as Block;\n    const listConfig = node.data.list;\n\n    // 当前节点不属于目标列表项，跳过遍历下个节点\n    if (!isInSameList(listConfig, listId)) {\n      continue;\n    }\n\n    // 初始化当前level在map中的初始值\n    if (!siblingsMap[listConfig.level]) {\n      siblingsMap[listConfig.level] = [];\n    }\n\n    // 已经找到目标节点, 当遍历到比目标节点level低的节点时，说明目标节点的兄弟节点已找完，结束遍历\n    if (findTarget && listConfig.level < targetLevel) {\n      break;\n    }\n\n    // 当前level比上一列表项低时，说明step重新从1开始了，清空map中上一层级数据\n    if (listConfig.level < prevLevel) {\n      siblingsMap[prevLevel] = [];\n    }\n\n    if (node.key === key) {\n      findTarget = true;\n    }\n\n    prevLevel = listConfig.level;\n    siblingsMap[listConfig.level].push(node);\n  }\n  return siblingsMap[targetLevel] || [];\n};\n"],"file":"getSiblingItems.js"}