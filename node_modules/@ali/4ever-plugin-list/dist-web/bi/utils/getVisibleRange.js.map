{"version":3,"sources":["../../../../src/bi/utils/getVisibleRange.ts"],"names":["value","selection","document","startBlock","endBlock","anchor","focus","isCollapsed","adjustedSelection","isAtEndOfNode","isAtStartOfNode","p","next","getNextText","key","setStart","moveToStartOfNode","previous","getPreviousText","setEnd","moveToEndOfNode"],"mappings":"AAAA;AAGA,gBAAe,UAACA,KAAD,EAAkB;AAAA,MACvBC,SADuB,GACuBD,KADvB,CACvBC,SADuB;AAAA,MACZC,QADY,GACuBF,KADvB,CACZE,QADY;AAAA,MACFC,UADE,GACuBH,KADvB,CACFG,UADE;AAAA,MACUC,QADV,GACuBJ,KADvB,CACUI,QADV;AAAA,MAEvBC,MAFuB,GAEQJ,SAFR,CAEvBI,MAFuB;AAAA,MAEfC,KAFe,GAEQL,SAFR,CAEfK,KAFe;AAAA,MAERC,WAFQ,GAEQN,SAFR,CAERM,WAFQ;AAG/B,MAAIC,iBAAiB,GAAGP,SAAxB;;AACA,MAAI,CAACM,WAAD,IAAgBJ,UAAhB,IAA8BE,MAAM,CAACI,aAAP,CAAqBN,UAArB,CAA9B,IAAkE,CAACE,MAAM,CAACK,eAAP,CAAuBP,UAAvB,CAAvE,EAA2G;AACzG,QAAMQ,CAAC,GAAGV,SAAS,CAACI,MAApB;AACA,QAAMO,IAAI,GAAGV,QAAQ,CAACW,WAAT,CAAqBF,CAAC,CAACG,GAAvB,CAAb;;AACA,QAAIF,IAAJ,EAAU;AACR;AACAJ,MAAAA,iBAAiB,GAAGP,SAAS,CAACc,QAAV,CAAmBd,SAAS,CAACI,MAAV,CAAiBW,iBAAjB,CAAmCJ,IAAnC,CAAnB,CAApB;AACD;AACF;;AACD,MAAI,CAACL,WAAD,IAAgBH,QAAhB,IAA4BE,KAAK,CAACI,eAAN,CAAsBN,QAAtB,CAA5B,IAA+D,CAACE,KAAK,CAACG,aAAN,CAAoBL,QAApB,CAApE,EAAmG;AACjG,QAAMO,EAAC,GAAGV,SAAS,CAACK,KAApB;AACA,QAAMW,QAAQ,GAAGf,QAAQ,CAACgB,eAAT,CAAyBP,EAAC,CAACG,GAA3B,CAAjB;;AACA,QAAIG,QAAJ,EAAc;AACZ;AACAT,MAAAA,iBAAiB,GAAGP,SAAS,CAACkB,MAAV,CAAiBlB,SAAS,CAACK,KAAV,CAAgBc,eAAhB,CAAgCH,QAAhC,CAAjB,CAApB;AACD;AACF;;AACD,SAAOT,iBAAP;AACD,CArBD","sourcesContent":["// TODO: 暂时拿掉该方法, 只有改造\nimport { Value } from '@ali/4ever-cangjie';\n\nexport default (value: Value) => {\n  const { selection, document, startBlock, endBlock } = value;\n  const { anchor, focus, isCollapsed } = selection;\n  let adjustedSelection = selection;\n  if (!isCollapsed && startBlock && anchor.isAtEndOfNode(startBlock) && !anchor.isAtStartOfNode(startBlock)) {\n    const p = selection.anchor;\n    const next = document.getNextText(p.key);\n    if (next) {\n      // @ts-ignore selection 没有 setStart 方法\n      adjustedSelection = selection.setStart(selection.anchor.moveToStartOfNode(next));\n    }\n  }\n  if (!isCollapsed && endBlock && focus.isAtStartOfNode(endBlock) && !focus.isAtEndOfNode(endBlock)) {\n    const p = selection.focus;\n    const previous = document.getPreviousText(p.key);\n    if (previous) {\n      // @ts-ignore selection 没有 setEnd 方法\n      adjustedSelection = selection.setEnd(selection.focus.moveToEndOfNode(previous));\n    }\n  }\n  return adjustedSelection;\n};\n"],"file":"getVisibleRange.js"}