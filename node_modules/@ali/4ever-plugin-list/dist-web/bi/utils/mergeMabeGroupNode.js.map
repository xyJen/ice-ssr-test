{"version":3,"sources":["../../../../src/bi/utils/mergeMabeGroupNode.ts"],"names":["utils","Commands","toggleFold","omit","isListGroupAvailable","getPreviousViewGroupNode","mergeMabeGroupNode","node","controller","previousViewNode","userData","get","newNode","set","data","list","command","moveToEndOfNode","removeNodeByKey","key","insertBlock","moveToStartOfNode","fold"],"mappings":";AAAA,SAASA,KAAT,QAAsB,8BAAtB;AACA,SAAgBC,QAAhB,QAA4C,oBAA5C;AACA,SAASC,UAAT,QAA2B,iCAA3B;AACA,SAASC,IAAT,QAAqB,WAArB;IAEQC,oB,GAAmDJ,K,CAAnDI,oB;IAAsBC,wB,GAA6BL,K,CAA7BK,wB;AAE9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,eAAe,SAASC,kBAAT,CAA4BC,IAA5B,EAAyCC,UAAzC,EAAiE;AAC9E,MAAMC,gBAAgB,GACpBL,oBAAoB,CAACI,UAAD,CAApB,IACAH,wBAAwB,CAACE,IAAD,EAAOC,UAAP,CAF1B;;AAGA,MAAIC,gBAAgB,IAAID,UAAU,CAACE,QAAX,CAAoBC,GAApB,CAAwBF,gBAAxB,EAA0C,MAA1C,CAAxB,EAA2E;AACzE,QAAMG,OAAO,GAAGL,IAAI,CAACM,GAAL,CAAS,MAAT,eACXV,IAAI,CAACI,IAAI,CAACO,IAAN,EAAY,CAAC,MAAD,CAAZ,CADO;AAEdC,MAAAA,IAAI,eACCN,gBAAgB,CAACK,IAAjB,CAAsBC,IADvB;AAFU,OAAhB;AAMAP,IAAAA,UAAU,CACPQ,OADH,CACWf,QAAQ,CAACgB,eADpB,EACqCR,gBADrC,EAEGO,OAFH,CAEWf,QAAQ,CAACiB,eAFpB,EAEqCX,IAAI,CAACY,GAF1C,EAGGH,OAHH,CAGWf,QAAQ,CAACmB,WAHpB,EAGiCR,OAHjC,EAIGI,OAJH,CAIWf,QAAQ,CAACoB,iBAJpB,EAIuCd,IAJvC,EAPyE,CAYzE;;AACAL,IAAAA,UAAU,CAAC;AAAEK,MAAAA,IAAI,EAAEK,OAAR;AAAiBU,MAAAA,IAAI,EAAE;AAAvB,KAAD,CAAV;AACD;AACF","sourcesContent":["import { utils } from '@ali/4ever-plugin-list-group';\nimport { Block, Commands, Controller } from '@ali/4ever-cangjie';\nimport { toggleFold } from '@ali/4ever-plugin-heading-group';\nimport { omit } from 'lodash-es';\n\nconst { isListGroupAvailable, getPreviousViewGroupNode } = utils;\n\n/**\n * 若上一个可视节点是 GroupNode list 节点，做可视节点的合并\n * I -> 光标，在光标位置按 backspace 键\n *   \n * 场景一：列表 ddd 合并到列表 ccc\n * \n *   1. aaa             1. aaa\n *   |  a. bbb          |  a. bbb\n *   |    i. ccc   ->   |    i. cccIddd\n *   2. Iddd\n * \n * 场景二：段落 ddd 合并到列表 bbb\n * \n *   1. aaa             1. aaa \n *   | >a. bbb     ->   |  > a.bbbIddd\n *   Iddd\n * \n * 场景三：段落 ddd 合并到列表 aaa\n * \n *  >1. aaa        ->   >1. aaaIddd\n *   Iddd          \n */\nexport default function mergeMabeGroupNode(node: Block, controller: Controller) {\n  const previousViewNode =\n    isListGroupAvailable(controller) &&\n    getPreviousViewGroupNode(node, controller);\n  if (previousViewNode && controller.userData.get(previousViewNode, 'fold')) {\n    const newNode = node.set('data', {\n      ...omit(node.data, ['fold']),\n      list: {\n        ...previousViewNode.data.list,\n      },\n    });\n    controller\n      .command(Commands.moveToEndOfNode, previousViewNode)\n      .command(Commands.removeNodeByKey, node.key)\n      .command(Commands.insertBlock, newNode)\n      .command(Commands.moveToStartOfNode, node);\n    // 设置折叠状态\n    toggleFold({ node: newNode, fold: true });\n  }\n}\n"],"file":"mergeMabeGroupNode.js"}