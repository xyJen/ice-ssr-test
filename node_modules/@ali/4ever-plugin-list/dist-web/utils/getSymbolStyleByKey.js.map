{"version":3,"sources":["../../../src/utils/getSymbolStyleByKey.ts"],"names":["environment","Mark","setStyleWithMark","isGradientColor","transferGradientColor","SYMBOL_SIZE_LOWER","convertMarkToSymbolStyle","mark","type","shd","data","value","fonts","ascii","bold","strike","italic","getSymbolStyle","controller","document","listSelections","length","block","getNode","list","symbolStyle","getSymbolStyleByKey","key","result","convertSymbolStyle","isOrdered","shouldDegradeGradient","color","styleName","markStyle","hAnsi","cs","eastAsia","IS_MOBILE","szUnit","parseSymbolMarks","marks","Object","keys","forEach","push","create"],"mappings":"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","sourcesContent":["import { CSSProperties } from 'react';\nimport { Controller, environment, Mark } from '@ali/4ever-cangjie';\nimport { setStyleWithMark } from '@ali/4ever-plugin-marks';\nimport { SymbolStyleProperties } from './types';\nimport { isGradientColor, transferGradientColor } from '@ali/4ever-utils';\n\n// 移动端不支持Arial字体，默认字体显示的项目符号过大，通过视觉对比确定缩小系数\nconst SYMBOL_SIZE_LOWER = 0.8;\n\nexport function convertMarkToSymbolStyle (mark: Mark): SymbolStyleProperties {\n  switch (mark.type) {\n    case 'highlight':\n      return { shd: mark.data.value }\n    case 'fonts':\n      return { fonts: mark.data.ascii }\n    case 'bold':\n      return { bold: mark.data.value ?? true }\n    case 'strike':\n      return { strike: mark.data.value ?? true }\n    case 'italic':\n      return { italic: mark.data.value ?? true }\n    case 'underline':\n      return {}\n    default:\n      return { [mark.type]: mark.data.value }\n  }\n}\n\nexport function getSymbolStyle(controller: Controller): object | null {\n  const { data, document } = controller.value;\n  const listSelections = data.listSelections || [];\n  if (listSelections.length > 0) {\n    const block = document.getNode(listSelections[0]);\n    // @ts-ignore\n    if (block?.data?.list?.symbolStyle) {\n      // @ts-ignore\n      return block.data.list.symbolStyle;\n    }\n  }\n  return null;\n}\n\nexport function getSymbolStyleByKey(\n  controller: Controller,\n  key: string,\n): string | void {\n  const symbolStyle = getSymbolStyle(controller);\n  let result;\n  if (symbolStyle && key) {\n    result = symbolStyle[key];\n  }\n  return result;\n}\n\nexport function convertSymbolStyle(\n  symbolStyle: SymbolStyleProperties,\n  isOrdered: boolean,\n): CSSProperties {\n  const result = {};\n  if (!symbolStyle) return result;\n\n  const shouldDegradeGradient =\n    symbolStyle.shd && symbolStyle.color && isGradientColor(symbolStyle.color);\n\n  for (const styleName in symbolStyle) {\n    if (symbolStyle[styleName]) {\n      let markStyle;\n      switch (styleName) {\n        case 'fonts':\n          markStyle = {\n            type: styleName,\n            data: {\n              ascii: symbolStyle[styleName],\n              hAnsi: symbolStyle[styleName],\n              cs: symbolStyle[styleName],\n              eastAsia: symbolStyle[styleName],\n            },\n          };\n          break;\n        case 'sz':\n          markStyle = {\n            type: styleName,\n            data: {\n              // 由于移动端无序列表符号过大，使用px按比例缩小一些\n              value:\n                (!isOrdered && environment.IS_MOBILE ? SYMBOL_SIZE_LOWER : 1) *\n                (symbolStyle[styleName] || 11),\n              szUnit: 'pt',\n            },\n          };\n          break;\n        case 'shd':\n          // 通用的样式转换不识别这种不规范的数据格式，这里转换一下\n          markStyle = {\n            type: 'highlight',\n            data: {\n              value: symbolStyle[styleName]\n            },\n          };\n          break;\n        default:\n          if (styleName === 'color' && shouldDegradeGradient) {\n            markStyle = {\n              type: 'color',\n              data: {\n                value: transferGradientColor(symbolStyle[styleName]!)[0],\n              },\n            };\n          } else {\n            markStyle = {\n              type: styleName,\n              data: {\n                value: symbolStyle[styleName],\n              },\n            };\n          }\n          break;\n      }\n      setStyleWithMark(result, markStyle);\n    }\n  }\n  return result;\n}\n\nexport function parseSymbolMarks(symbolStyle: SymbolStyleProperties, isOrdered: boolean): Mark[] {\n  if (!symbolStyle) {\n    return [];\n  }\n  const marks: Mark[] = [];\n\n  Object.keys(symbolStyle).forEach((styleName) => {\n    if (symbolStyle[styleName]) {\n      switch (styleName) {\n        case 'fonts': {\n          marks.push(Mark.create({\n            type: styleName,\n            data: {\n              ascii: symbolStyle[styleName],\n              hAnsi: symbolStyle[styleName],\n              cs: symbolStyle[styleName],\n              eastAsia: symbolStyle[styleName],\n            },\n          }));\n          break;\n        }\n\n        case 'sz': {\n          marks.push(Mark.create({\n            type: styleName,\n            data: {\n              // 由于移动端无序列表符号过大，使用px按比例缩小一些\n              value:\n                (!isOrdered && environment.IS_MOBILE ? SYMBOL_SIZE_LOWER : 1) *\n                (symbolStyle[styleName] || 11),\n              szUnit: 'pt',\n            },\n          }));\n          break;\n        }\n\n        default: {\n          marks.push(Mark.create({\n            type: styleName,\n            data: {\n              value: symbolStyle[styleName],\n            },\n          }));\n        }\n      }\n    }\n  });\n\n  return marks;\n}\n"],"file":"getSymbolStyleByKey.js"}