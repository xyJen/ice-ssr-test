"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _everCangjie = require("@ali/4ever-cangjie");

var _commands = require("../commands");

var _utils = require("../utils");

var _default = (event, controller, next) => {
  const {
    value
  } = controller;
  const selection = value.selection;
  const startBlock = value.startBlock;

  if ((0, _utils.assertZeroCharacter)(controller)) {
    return controller.command(_everCangjie.Commands.deleteBackward, 2);
  }

  if (!selection || !startBlock || selection.isExpanded || selection.anchor.offset > 0) return next();
  const currentItem = value.startBlock;
  if (!currentItem) return next();
  const isAtBlockStart = selection.anchor.isAtStartOfNode(startBlock);
  if (!(0, _utils.isEmpty)(currentItem) && !isAtBlockStart) return next();

  if (!(0, _utils.isList)(currentItem)) {
    (0, _utils.mergeMabeGroupNode)(currentItem, controller);
    return next();
  }

  ;
  event.preventDefault();

  if ((0, _utils.isEmpty)(currentItem) && (0, _utils.getItemDepth)(currentItem) > 0) {
    return (0, _commands.increaseItemDepth)(controller, -1);
  }

  return (0, _commands.removeListNode)(controller);
};

exports.default = _default;
//# sourceMappingURL=onBackspace.js.map