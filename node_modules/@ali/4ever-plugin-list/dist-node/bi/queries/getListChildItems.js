"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getListChildItems = void 0;

/**
 * @description 当光标在 列表项 2 时,它的子项就是 2、2a、2b、2bi、2c
 *
 *   1. 钉钉文档1
 *   2. 钉钉文档2
 *     a. 钉钉文档2a
 *     b. 钉钉文档2b
 *         i. 钉钉文档2bi
 *     c. 钉钉文档2c
 *   3. 钉钉文档3
 *
 * */
const getListChildItems = (controller, currrentItem) => {
  const {
    document
  } = controller.value;
  const {
    key
  } = currrentItem;
  const currentList = currrentItem.data.list; // 传入的可能是 renderNode 中的 node，这里 getNode 一次

  const currrentItemNode = document.getNode(key);
  if (!key || !currentList || !currrentItemNode) return [];
  const childItems = [currrentItem];
  const {
    level: targetLevel
  } = currentList; // 排版下为当前 page

  const root = document.getParent(key) || document;
  const nodesLength = root.nodes.length;
  const curIndex = Math.max(0, root.nodes.indexOf(currrentItemNode));
  let foundSelf;

  for (let i = curIndex; i < nodesLength; i++) {
    const targetNode = root.nodes[i];
    foundSelf = foundSelf || targetNode.key === currrentItem.key;
    if (!foundSelf || targetNode.key === currrentItem.key) continue;
    const listConfig = targetNode.data.list;

    if (!listConfig) {
      // 当前节点不是列表项：终止
      return childItems;
    } else if (listConfig.level > targetLevel) {
      // 仅根据 level 判断，允许不同 listId 的列表项被拖拽
      childItems.push(targetNode);
    } else {
      // 只要不是子节点，直接返回
      return childItems;
    }
  }

  return childItems;
};

exports.getListChildItems = getListChildItems;
//# sourceMappingURL=getListChildItems.js.map