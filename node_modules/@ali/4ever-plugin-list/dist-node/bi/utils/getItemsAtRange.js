"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _getCurrentItem = _interopRequireDefault(require("./getCurrentItem"));

var _isList = _interopRequireDefault(require("./isList"));

// 看起来已弃用，没有地方调用
var _default = (controller, range) => {
  const {
    value
  } = controller;
  const valueRange = range || value.selection;

  if (!valueRange.anchor.key) {
    return [];
  }

  const {
    document
  } = value;
  const startBlock = document.getClosestBlock(valueRange.anchor.key);
  const endBlock = document.getClosestBlock(valueRange.focus.key);

  if (!startBlock || !endBlock) {
    return [];
  }

  if (startBlock === endBlock) {
    const item = (0, _getCurrentItem.default)(controller);
    return item ? [item] : [];
  }

  const ancestor = document.getCommonAncestor(startBlock.key, endBlock.key);

  if ((0, _isList.default)(ancestor) && ancestor) {
    const startPath = ancestor.getPath(startBlock.key);
    const endPath = ancestor.getPath(endBlock.key);

    if (startPath && endPath) {
      return ancestor.nodes.slice(startPath[0], endPath[0] + 1);
    }
  }

  if (ancestor?.type === 'list-item') {
    return [ancestor];
  }

  return [];
};

exports.default = _default;
//# sourceMappingURL=getItemsAtRange.js.map