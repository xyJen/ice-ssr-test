{"version":3,"sources":["../../../../src/bi/utils/getItemsAtRange.ts"],"names":["controller","range","value","valueRange","selection","anchor","key","document","startBlock","getClosestBlock","endBlock","focus","item","ancestor","getCommonAncestor","startPath","getPath","endPath","nodes","slice","type"],"mappings":";;;;;;;;;AACA;;AACA;;AAEA;eACe,CAACA,UAAD,EAAyBC,KAAzB,KAAmD;AAChE,QAAM;AAAEC,IAAAA;AAAF,MAAYF,UAAlB;AACA,QAAMG,UAAU,GAAGF,KAAK,IAAIC,KAAK,CAACE,SAAlC;;AAEA,MAAI,CAACD,UAAU,CAACE,MAAX,CAAkBC,GAAvB,EAA4B;AAC1B,WAAO,EAAP;AACD;;AAED,QAAM;AAAEC,IAAAA;AAAF,MAAeL,KAArB;AACA,QAAMM,UAAU,GAAGD,QAAQ,CAACE,eAAT,CAAyBN,UAAU,CAACE,MAAX,CAAkBC,GAA3C,CAAnB;AACA,QAAMI,QAAQ,GAAGH,QAAQ,CAACE,eAAT,CAAyBN,UAAU,CAACQ,KAAX,CAAiBL,GAA1C,CAAjB;;AAEA,MAAI,CAACE,UAAD,IAAe,CAACE,QAApB,EAA8B;AAC5B,WAAO,EAAP;AACD;;AAED,MAAIF,UAAU,KAAKE,QAAnB,EAA6B;AAC3B,UAAME,IAAI,GAAG,6BAAeZ,UAAf,CAAb;AACA,WAAOY,IAAI,GAAG,CAACA,IAAD,CAAH,GAAY,EAAvB;AACD;;AAED,QAAMC,QAAQ,GAAGN,QAAQ,CAACO,iBAAT,CAA2BN,UAAU,CAACF,GAAtC,EAA2CI,QAAQ,CAACJ,GAApD,CAAjB;;AACA,MAAI,qBAAOO,QAAP,KAAoBA,QAAxB,EAAkC;AAChC,UAAME,SAAS,GAAGF,QAAQ,CAACG,OAAT,CAAiBR,UAAU,CAACF,GAA5B,CAAlB;AACA,UAAMW,OAAO,GAAGJ,QAAQ,CAACG,OAAT,CAAiBN,QAAQ,CAACJ,GAA1B,CAAhB;;AACA,QAAIS,SAAS,IAAIE,OAAjB,EAA0B;AACxB,aAAOJ,QAAQ,CAACK,KAAT,CAAeC,KAAf,CAAqBJ,SAAS,CAAC,CAAD,CAA9B,EAAmCE,OAAO,CAAC,CAAD,CAAP,GAAa,CAAhD,CAAP;AACD;AACF;;AACD,MAAIJ,QAAQ,EAAEO,IAAV,KAAmB,WAAvB,EAAoC;AAClC,WAAO,CAACP,QAAD,CAAP;AACD;;AACD,SAAO,EAAP;AACD,C","sourcesContent":["import { Controller, RangeSelection } from '@ali/4ever-cangjie';\nimport getCurrentItem from './getCurrentItem';\nimport isList from './isList';\n\n// 看起来已弃用，没有地方调用\nexport default (controller: Controller, range: RangeSelection) => {\n  const { value } = controller;\n  const valueRange = range || value.selection;\n\n  if (!valueRange.anchor.key) {\n    return [];\n  }\n\n  const { document } = value;\n  const startBlock = document.getClosestBlock(valueRange.anchor.key);\n  const endBlock = document.getClosestBlock(valueRange.focus.key);\n\n  if (!startBlock || !endBlock) {\n    return [];\n  }\n\n  if (startBlock === endBlock) {\n    const item = getCurrentItem(controller);\n    return item ? [item] : [];\n  }\n\n  const ancestor = document.getCommonAncestor(startBlock.key, endBlock.key);\n  if (isList(ancestor) && ancestor) {\n    const startPath = ancestor.getPath(startBlock.key);\n    const endPath = ancestor.getPath(endBlock.key);\n    if (startPath && endPath) {\n      return ancestor.nodes.slice(startPath[0], endPath[0] + 1);\n    }\n  }\n  if (ancestor?.type === 'list-item') {\n    return [ancestor];\n  }\n  return [];\n};\n"],"file":"getItemsAtRange.js"}