{"version":3,"sources":["../../../src/Sidebar/SidebarItems.tsx"],"names":["React","styled","Controller","connectPlugins","Collapse","LazyRenderer","SplitLine","div","SidebarItems","props","layout","plugins","controller","sortedLayout","useMemo","sort","a","b","index","renderItem","useCallback","item","split","pluginName","itemName","plugin","hash","sidebar","fn","Component","items","locale","config","s","renderGroup","group","isLast","renderTitle","defaultFold","useCollapse","key","map","lastIndex","length","connectController"],"mappings":"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","sourcesContent":["import React from 'react';\nimport styled from 'styled-components';\nimport { BiPlugin, Controller } from '@ali/4ever-cangjie';\nimport {  Plugins, connectPlugins } from '../PluginsContext';\nimport Collapse from './Collapse';\nimport { LazyRenderer } from './LazyRenderer';\nexport interface ISidebarItemsLayoutGroup {\n  renderTitle: () => React.ReactNode;\n  items: string[];\n  index?: number;\n  defaultFold?: boolean;\n  useCollapse?: boolean;\n  key: string;\n}\n\nexport type ISidebarItemsLayout = ISidebarItemsLayoutGroup[];\n\nexport interface ISidebarItemsProps {\n  layout: ISidebarItemsLayout; // sidebar 布局配置\n  controller: Controller;\n  plugins: Plugins;\n}\n\nexport const SplitLine = styled.div`\n  padding-bottom: 12px;\n  border-top: 1px solid rgba(126, 134, 142, 0.16);\n`;\n\nconst SidebarItems = (props: ISidebarItemsProps) => {\n  const { layout = [], plugins, controller } = props;\n  const sortedLayout = React.useMemo(() => layout.sort((a, b) => (a.index || 0) - (b.index || 0)), [layout]);\n  const renderItem = React.useCallback((item: string) => {\n    const [pluginName, itemName = 'default'] = item.split('.');\n    const plugin = plugins.hash[pluginName] as BiPlugin;\n    if (!plugin || !plugin.sidebar) {\n      return null;\n    }\n\n    // lazy render\n    if (typeof plugin.sidebar === 'function') {\n      return (\n        <LazyRenderer\n          loader={{\n            fn: () => (plugin.sidebar as any)(),\n          }}\n          render={(sidebar: any) => {\n            const Component = sidebar.items?.[itemName];\n            if (!Component) {\n              return null;\n            }\n\n            return (\n              <Component controller={controller} locale={sidebar.locale || {}} config={sidebar.config || {}} />\n            );\n          }}\n        />\n      )\n    } else {\n      // TODO：待所有插件的 sidebar 迁移为异步后删除\n      const s = plugin.sidebar as any;\n      const Component = s.items?.[itemName];\n      if (!Component) {\n        return null;\n      }\n\n      return (\n        <Component controller={controller} locale={s.locale || {}} config={s.config || {}} />\n      );\n    }\n  }, [plugins, controller]);\n\n  const renderGroup = React.useCallback((group: ISidebarItemsLayoutGroup, isLast: boolean) => {\n    const { renderTitle, items, defaultFold, useCollapse, key } = group;\n    return (\n      <React.Fragment key={key}>\n        <Collapse renderTitle={renderTitle} defaultFold={defaultFold} useCollapse={useCollapse}>\n          {\n            items.map((item) => renderItem(item))\n          }\n        </Collapse>\n        { !isLast && <SplitLine />}\n      </React.Fragment>\n    );\n  }, [renderItem]);\n\n  const lastIndex = sortedLayout.length - 1;\n\n  return (\n    <React.Fragment>\n      {\n        sortedLayout.map((group, index) => renderGroup(group, index === lastIndex))\n      }\n    </React.Fragment>\n  );\n};\nexport default Controller.connectController(connectPlugins(SidebarItems));\n\n"],"file":"SidebarItems.js"}