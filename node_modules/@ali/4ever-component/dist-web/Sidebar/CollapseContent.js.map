{"version":3,"sources":["../../../src/Sidebar/CollapseContent.tsx"],"names":["React","styled","classnames","ContentBox","div","props","maxHeight","PocketBox","Content","fold","animate","style","className","dataName","children","foldRef","useRef","contentRef","pocketRef","heightRef","useState","internalFold","setInternalFold","transition","setTransition","handleTransitionEnd","useCallback","useLayoutEffect","current","pocket","offsetHeight","classNames","displayName"],"mappings":"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","sourcesContent":["// 复用的 HeadingGroupPlugin.Content\nimport * as React from 'react';\nimport styled from 'styled-components';\nimport classnames from 'classnames';\n\nconst ContentBox = styled.div<{ maxHeight: number }>`\n\n  &.transition {\n    max-height: ${(props) => props.maxHeight}px;\n    transition: all 0.2s ease-in-out;\n    overflow: hidden;\n\n    &.fold {\n      display: block;\n    }\n  }\n\n  &.fold {\n    max-height: 0;\n    overflow: hidden;\n    display: none;\n  }\n`;\n\nconst PocketBox = styled.div`\n  /* https://aone.alibaba-inc.com/v2/bug/36003865# 《标题收起展开会出现跳动》 */\n  :first-child > [data-cangjie-leaf-block] > * {\n    margin-top: 0 !important;\n  }\n  & > :first-child > [data-name=\"heading-group-title\"] > [data-name=\"heading-group-title-content\"] > [data-cangjie-leaf-block] > * {\n    margin-top: 0 !important;\n  }\n`;\n\nexport interface ContentProps {\n  /**\n   * 折叠状态\n   */\n  fold: boolean;\n  /**\n   * 是否执行动画\n   */\n  animate?: boolean;\n  style?: React.CSSProperties;\n  className?: string;\n  dataName?: string;\n}\n\nconst Content: React.FC<ContentProps> = (props) => {\n  const {\n    fold,\n    animate = true,\n    style,\n    className,\n    dataName,\n    children,\n  } = props;\n\n  const foldRef = React.useRef(fold);\n  const contentRef = React.useRef<HTMLDivElement>(null);\n  const pocketRef = React.useRef<HTMLDivElement>(null);\n  const heightRef = React.useRef(0);\n  const [internalFold, setInternalFold] = React.useState(fold);\n  const [transition, setTransition] = React.useState(false);\n\n  /**\n   * 动画结束后移除动画类名\n   */\n  const handleTransitionEnd = React.useCallback(() => {\n    setTransition(false);\n  }, []);\n\n  /**\n   * 每次更新后刷新内容高度\n   */\n  React.useLayoutEffect(() => {\n    if (pocketRef.current) {\n      const pocket = pocketRef.current;\n      heightRef.current = pocket.offsetHeight;\n    }\n  });\n\n  /**\n   * 折叠状态发生变化时，先开启 transition，再变更状态\n   */\n  React.useLayoutEffect(() => {\n    if (fold !== foldRef.current) {\n      if (animate) {\n        setTransition(true);\n      } else {\n        setTransition(false);\n        setInternalFold(fold);\n      }\n      foldRef.current = fold;\n    }\n  }, [animate, fold]);\n\n  /**\n   * 开启 transition 后变更 fold 状态\n   */\n  React.useLayoutEffect(() => {\n    if (transition) {\n      setInternalFold(fold);\n    }\n  }, [transition, fold]);\n\n  const classNames = classnames({\n    transition,\n    fold: internalFold,\n  });\n\n  return (\n    <ContentBox\n      ref={contentRef}\n      className={classNames}\n      style={style}\n      maxHeight={heightRef.current}\n      onTransitionEnd={handleTransitionEnd}\n    >\n      <PocketBox\n        ref={pocketRef}\n        data-name={dataName}\n        data-heading-fold={fold}\n        className={className}\n      >\n        {children}\n      </PocketBox>\n    </ContentBox>\n  );\n};\n\nContent.displayName = 'Content';\n\nexport default Content;\n"],"file":"CollapseContent.js"}