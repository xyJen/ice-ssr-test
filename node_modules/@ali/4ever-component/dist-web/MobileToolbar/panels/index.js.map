{"version":3,"sources":["../../../../src/MobileToolbar/panels/index.tsx"],"names":["React","usePanel","blockEvent","close","CloseIcon","Line","Header","BottomPanelWrapper","PanelContentWrapper","CloseButtonWrapper","HEADER_BG","PANEL_TRANSITION_SHORT","PANEL_TRANSITION_LONG","HEADER_BG_FADING","CloseButton","onClick","useState","isTouched","setIsTouched","startTouch","useCallback","event","stopPropagation","endTouch","BottomPanel","props","children","title","icon","height","layout","controller","plugins","closePanel","ref","useRef","offsetRef","isFadingRef","handleDragStatusChange","isDragging","domNode","current","transition","style","requestAnimationFrame","transform","handleDragOffsetChange","rawOffset","offset","isFading","color","headerNode","querySelector"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { usePanel } from '../hooks';\n\nimport { MobileToolbarGroup, Plugins } from '../types';\nimport { blockEvent } from '../utils';\nimport { close as CloseIcon } from '../icons';\nimport { Controller } from '@ali/4ever-cangjie';\nimport Line from '../components/line';\nimport Header from './header';\nimport {\n  BottomPanelWrapper,\n  PanelContentWrapper,\n  CloseButtonWrapper,\n  HEADER_BG,\n} from './styled';\n\nconst PANEL_TRANSITION_SHORT = 'none';\nconst PANEL_TRANSITION_LONG = 'opacity 350ms, transform 350ms';\n\nconst HEADER_BG_FADING = '#ffa39e';\n\ntype IProps = {\n  title: string | React.ComponentType;\n  icon?: React.ComponentType;\n  height?: string;\n  children: any;\n\n  // Panel 上渲染工具条\n  layout: MobileToolbarGroup[];\n  controller: Controller;\n  plugins: Plugins;\n};\n\nfunction CloseButton({ onClick }: { onClick?: () => void }) {\n  const [isTouched, setIsTouched] = React.useState(false);\n\n  const startTouch = React.useCallback(\n    (event: React.MouseEvent | React.TouchEvent) => {\n      event.stopPropagation();\n      setIsTouched(true);\n    },\n    [],\n  );\n  const endTouch = React.useCallback(\n    (event: React.MouseEvent | React.TouchEvent) => {\n      event.stopPropagation();\n      setIsTouched(false);\n    },\n    [],\n  );\n  return (\n    <CloseButtonWrapper\n      onTouchStart={startTouch}\n      onTouchEnd={endTouch}\n      onTouchCancel={endTouch}\n      onMouseDown={onClick}\n      isTouched={isTouched}\n    >\n      <CloseIcon />\n    </CloseButtonWrapper>\n  );\n}\n\nfunction BottomPanel(props: IProps) {\n  const { children, title, icon, height, layout, controller, plugins } = props;\n  const { closePanel } = usePanel();\n  const ref = React.useRef<HTMLDivElement | null>(null);\n  const offsetRef = React.useRef<number>(0);\n  const isFadingRef = React.useRef(false);\n\n  const handleDragStatusChange = (isDragging: boolean) => {\n    const domNode = ref.current;\n    if (!domNode) {\n      return;\n    }\n    const transition = isDragging\n      ? PANEL_TRANSITION_SHORT\n      : PANEL_TRANSITION_LONG;\n    domNode.style.transition = transition;\n    isFadingRef.current = false;\n    requestAnimationFrame(() => {\n      if (offsetRef.current < 100) {\n        domNode.style.transform = 'translate3d(0,0,0)';\n      } else {\n        closePanel && closePanel();\n      }\n    });\n  };\n\n  const handleDragOffsetChange = (rawOffset: number) => {\n    const domNode = ref.current;\n    if (!domNode) {\n      return;\n    }\n    const offset = rawOffset > 0 ? rawOffset : 0;\n    domNode.style.transform = `translate3d(0,${offset}px,0)`;\n    offsetRef.current = offset;\n    const isFading = offset >= 100;\n    if (isFading !== isFadingRef.current) {\n      isFadingRef.current = isFading;\n      const color = isFading ? HEADER_BG_FADING : HEADER_BG;\n      const headerNode = domNode.querySelector('[data-panel-header]') as\n        | HTMLElement\n        | undefined;\n      if (headerNode) {\n        // headerNode.style.background = color;\n      }\n    }\n  };\n\n  return (\n    <BottomPanelWrapper\n      data-toobar-subpanel\n      height={height}\n      ref={ref}\n      onMouseDown={blockEvent}\n    >\n      <CloseButton onClick={closePanel} />\n      {!title && (\n        <Line layout={layout} controller={controller} plugins={plugins} />\n      )}\n      {!!title && (\n        <Header\n          title={title}\n          Icon={icon}\n          onDragOffsetChange={handleDragOffsetChange}\n          onDragStatusChange={handleDragStatusChange}\n        />\n      )}\n\n      <PanelContentWrapper>{children}</PanelContentWrapper>\n    </BottomPanelWrapper>\n  );\n}\n\nexport default BottomPanel;\n"],"file":"index.js"}