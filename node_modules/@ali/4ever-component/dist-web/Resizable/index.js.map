{"version":3,"sources":["../../../src/Resizable/index.tsx"],"names":["React","noop","getRelativeMouseEvent","useHover","XHandle","YHandle","Mask","ResizableWrapper","HandleIcon","isInRange","num","range","showHandle","axisName","axis","showYHandle","showXHandle","getRelatives","event","ref","mouseEvent","window","TouchEvent","touches","Resizable","props","children","className","onResize","onResizeStart","onResizeStop","widthRange","Infinity","heightRange","width","height","visible","style","speed","zoomContainer","innerRef","handleStyle","onClick","autoHeight","isActive","enableBorderHighlight","dragging","useRef","startPoint","heightRef","widthRef","isHover","hoverHandlers","handleDragging","current","preventDefault","stopPropagation","relativeX","relativeY","startX","startY","startHeight","newWidth","newHeight","handleDragStop","unbindEvents","handleDragStart","nativeEvent","getBoundingClientRect","bindEvents","document","removeEventListener","addEventListener","useEffect","resizableStyle","position"],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-use-before-define */\nimport * as React from 'react';\nimport { noop } from 'lodash-es';\nimport { getRelativeMouseEvent } from '@ali/4ever-utils';\nimport { useHover } from '../HoverBlock';\nimport { XHandle, YHandle, Mask, ResizableWrapper } from './styled';\nimport HandleIcon from './icon';\n\ninterface Size {\n  width: number;\n  height: number;\n}\n\ntype DragEvent = MouseEvent | TouchEvent;\n\ntype Range = [number, number];\n\nexport interface ResizableProps {\n  /** classname */\n  className?: string;\n  /** 高度 */\n  height: number;\n  /** 宽度 */\n  width: number;\n  /** 缩放坐标轴 */\n  axis: 'y' | 'x' | 'all';\n  /** 缩放回调 */\n  onResize: (event: DragEvent, size: Size) => void;\n  /** 缩放开始回调 */\n  onResizeStart?: (event: DragEvent) => void;\n  /** 缩放结束回调 */\n  onResizeStop?: (event: DragEvent, size: Size) => void;\n  /** 跟元素事件回调 */\n  onClick?: (event: React.MouseEvent) => void;\n  /** 宽度区间 */\n  widthRange?: Range;\n  /** 高度区间 */\n  heightRange?: Range;\n  /** 是否可见 */\n  visible?: boolean;\n  /** 样式 */\n  style?: React.CSSProperties;\n  /** 速度 */\n  speed?: number;\n  /** zoom container */\n  zoomContainer: HTMLElement | null;\n  /** innerRef */\n  innerRef?: React.RefObject<HTMLDivElement>;\n  /** handle style */\n  handleStyle?: React.CSSProperties;\n  /** 高度是否自适应内容 */\n  autoHeight?: boolean;\n  isActive: boolean;\n  enableBorderHighlight?: boolean;\n}\n\nconst isInRange = (num: number, range: Range) => {\n  return num >= range[0] && num <= range[1];\n};\n\nconst showHandle = (axisName) => {\n  return (axis) => {\n    return axis === axisName || axis === 'all';\n  };\n};\nconst showYHandle = showHandle('y');\nconst showXHandle = showHandle('x');\n\nconst getRelatives = (event: DragEvent, ref: HTMLElement) => {\n  let mouseEvent;\n  if (window.TouchEvent && event instanceof window.TouchEvent) {\n    mouseEvent = (event as TouchEvent).touches[0] as Touch;\n  } else {\n    mouseEvent = event as MouseEvent;\n  }\n  return getRelativeMouseEvent(mouseEvent, ref);\n};\n\nconst Resizable: React.FC<ResizableProps> = (props) => {\n  const {\n    children,\n    axis,\n    className = 'resizable',\n    onResize,\n    onResizeStart = noop,\n    onResizeStop = noop,\n    widthRange = [0, Infinity] as Range,\n    heightRange = [0, Infinity] as Range,\n    width,\n    height,\n    visible,\n    style = {},\n    speed = 1.0,\n    zoomContainer,\n    innerRef = null,\n    handleStyle = {},\n    onClick,\n    autoHeight,\n    isActive,\n    enableBorderHighlight,\n  } = props;\n  const dragging = React.useRef<boolean>(false);\n  const startPoint = React.useRef<[number, number, number]>([0, 0, height]);\n  const heightRef = React.useRef<number>(height);\n  const widthRef = React.useRef<number>(width);\n  const [isHover, hoverHandlers] = useHover(enableBorderHighlight);\n\n  function handleDragging(event: DragEvent) {\n    if (dragging.current) {\n      event.preventDefault();\n      event.stopPropagation();\n      const { relativeX, relativeY } = getRelatives(event, zoomContainer!);\n      const [startX, startY, startHeight] = startPoint.current;\n      const newWidth = (relativeX - startX) * speed + width;\n      const newHeight = (relativeY - startY) * speed + startHeight;\n      if (showYHandle(axis) && isInRange(newHeight, heightRange)) {\n        heightRef.current = newHeight;\n        onResize(event, { width, height: newHeight });\n      } else if (showXHandle(axis) && isInRange(newWidth, widthRange)) {\n        widthRef.current = newWidth;\n        onResize(event, { width: newWidth, height: startHeight });\n      }\n    }\n  }\n\n  function handleDragStop(event: DragEvent) {\n    if (\n      dragging.current &&\n      isInRange(heightRef.current, heightRange) &&\n      isInRange(widthRef.current, widthRange)\n    ) {\n      dragging.current = false;\n      unbindEvents();\n      onResizeStop(event, {\n        height: heightRef.current,\n        width: widthRef.current,\n      });\n    }\n  }\n\n  function handleDragStart(event) {\n    event.preventDefault();\n    event.stopPropagation();\n    const { relativeX, relativeY } = getRelatives(\n      event.nativeEvent,\n      zoomContainer!,\n    );\n    dragging.current = true;\n    const startHeight = autoHeight && innerRef ? innerRef.current!.getBoundingClientRect().height : height;\n    heightRef.current = startHeight;\n    startPoint.current = [relativeX, relativeY, startHeight];\n    bindEvents();\n    onResizeStart(event.nativeEvent);\n  }\n\n  function unbindEvents() {\n    document.removeEventListener('mousemove', handleDragging);\n    document.removeEventListener('touchmove', handleDragging);\n    document.removeEventListener('mouseup', handleDragStop);\n    document.removeEventListener('touchend', handleDragStop);\n  }\n\n  function bindEvents() {\n    document.addEventListener('mousemove', handleDragging);\n    document.addEventListener('touchmove', handleDragging);\n    document.addEventListener('mouseup', handleDragStop);\n    document.addEventListener('touchend', handleDragStop);\n  }\n\n  React.useEffect(() => {\n    return unbindEvents;\n  }, []);\n\n  const resizableStyle: React.CSSProperties = {\n    width: `${width}px`,\n    position: 'relative',\n    ...style,\n  };\n  // autoHeight 模式下，不需要每次换行都重新计算高度，避免产生抖动\n  if (!autoHeight) {\n    resizableStyle.height = `${height}px`;\n  }\n\n  return (\n    <ResizableWrapper\n      className={className}\n      style={resizableStyle}\n      ref={innerRef}\n      onClick={onClick}\n      {...hoverHandlers}\n      isHover={isHover}\n      isActive={isActive}\n      data-hover-box=\"borderBox\"\n    >\n      <Mask visible={dragging.current} />\n      {children}\n      {showYHandle(axis) && visible && (\n        <YHandle\n          style={handleStyle}\n          dragging={dragging.current}\n        >\n          <HandleIcon\n            onMouseDown={handleDragStart}\n            onTouchStart={handleDragStart}\n          />\n        </YHandle>\n      )}\n      {showXHandle(axis) && visible && (\n        <XHandle\n          onMouseDown={handleDragStart}\n          onTouchStart={handleDragStart}\n          style={handleStyle}\n          dragging={dragging.current}\n        >\n          <HandleIcon />\n        </XHandle>\n      )}\n    </ResizableWrapper>\n  );\n};\n\nexport default Resizable;\n"],"file":"index.js"}