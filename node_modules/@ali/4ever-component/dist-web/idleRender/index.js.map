{"version":3,"sources":["../../../src/idleRender/index.tsx"],"names":["React","debounce","requestIdleCallback","cancelIdleCallback","idleRender","Component","delay","options","timeout","debouncedForceUpdate","forceUpdate","updateWhenIdle","shouldComponentUpdate","componentWillUnmount","cancel","render","props"],"mappings":";AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;qBAC4B,a;AAA5B,SAASC,QAAT,QAAyB,WAAzB;AACA,SAASC,mBAAT,EAA8BC,kBAA9B,QAAwD,kBAAxD;AAEA,OAAO,SAASC,UAAT,CACLC,SADK,EAELC,KAFK,EAGLC,OAHK,EAIL;AACA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,YACUC,OADV,GACoB,CAAC,CADrB;AAAA,YAGmBC,oBAHnB,GAG0CR,QAAQ,CAC9C,YAAM;AACJ,cAAKS,WAAL;AACD,OAH6C,EAI9CJ,KAJ8C,EAK9CC,OAL8C,CAHlD;;AAAA,YAWmBI,cAXnB,GAWoC,YAAM;AACtCR,QAAAA,kBAAkB,CAAC,MAAKK,OAAN,CAAlB;AACA,cAAKA,OAAL,GAAeN,mBAAmB,CAAC,YAAM;AACvC,gBAAKO,oBAAL;AACD,SAFiC,CAAlC;AAGD,OAhBH;;AAAA;AAAA;;AAAA;;AAAA,WAkBEG,qBAlBF,GAkBE,iCAAwB;AACtB,WAAKD,cAAL;AACA,aAAO,KAAP;AACD,KArBH;;AAAA,WAuBEE,oBAvBF,GAuBE,gCAAuB;AACrB,WAAKJ,oBAAL,CAA0BK,MAA1B;AACAX,MAAAA,kBAAkB,CAAC,KAAKK,OAAN,CAAlB;AACD,KA1BH;;AAAA,WA4BEO,MA5BF,GA4BE,kBAAS;AACP,0BAAO,eAAC,SAAD,EAAe,KAAKC,KAApB,CAAP;AACD,KA9BH;;AAAA;AAAA,IAAmChB,KAAK,CAACK,SAAzC;AAgCD","sourcesContent":["import * as React from 'react';\nimport { debounce } from 'lodash-es';\nimport { requestIdleCallback, cancelIdleCallback } from '@ali/4ever-utils';\n\nexport function idleRender(\n  Component,\n  delay: number,\n  options: any,\n) {\n  return class IdleComponent extends React.Component {\n    private timeout = -1;\n\n    private readonly debouncedForceUpdate = debounce(\n      () => {\n        this.forceUpdate();\n      },\n      delay,\n      options,\n    );\n\n    private readonly updateWhenIdle = () => {\n      cancelIdleCallback(this.timeout);\n      this.timeout = requestIdleCallback(() => {\n        this.debouncedForceUpdate();\n      });\n    }\n\n    shouldComponentUpdate() {\n      this.updateWhenIdle();\n      return false;\n    }\n\n    componentWillUnmount() {\n      this.debouncedForceUpdate.cancel();\n      cancelIdleCallback(this.timeout);\n    }\n\n    render() {\n      return <Component {...this.props} />;\n    }\n  } as typeof Component;\n}\n"],"file":"index.js"}