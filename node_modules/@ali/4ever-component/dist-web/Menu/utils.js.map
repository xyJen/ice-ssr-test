{"version":3,"sources":["../../../src/Menu/utils.ts"],"names":["TYPE_MENU_ITEM","TYPE_SUB_MENU","TYPE_GROUP","checkIsQuery","query","key","Array","isArray","filter","val","toLowerCase","length","checkIsInclude","isInclude","priority","pos","indexOf","filterMenuByQuery","menus","map","item","type","itemMenus","itemQuery","sort","a","b"],"mappings":"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","sourcesContent":["/* eslint-disable no-case-declarations */\nimport {\n  TYPE_MENU_DATA,\n  TYPE_MENU_ITEM,\n  TYPE_SUB_MENU,\n  TYPE_GROUP,\n  SubMenuProps,\n  MenuItemProps,\n} from './interface';\n\nfunction checkIsQuery(query: string, key: string | string[]) {\n  if (Array.isArray(key)) {\n    return key.filter((val) => val.toLowerCase() === query.toLowerCase()).length > 0;\n  } else {\n    return key.toLowerCase() === query.toLowerCase();\n  }\n}\n\nfunction checkIsInclude(query: string, key: string | string[]) {\n  let isInclude: boolean;\n  let priority: number;\n  if (Array.isArray(key)) {\n    // 获取匹配度最高的值\n    isInclude = key.filter((val) => {\n      const pos = val.toLowerCase().indexOf(query.toLowerCase());\n      if (pos > -1) {\n        // 记录下匹配值最高的query\n        if (!priority || priority < 10 - pos) {\n          priority = 10 - pos;\n        }\n        return true;\n      }\n      return false;\n    }).length > 0;\n  } else {\n    const pos = key.toLowerCase().indexOf(query.toLowerCase());\n    isInclude = pos > -1;\n    if (isInclude) {\n      priority = 10 - pos;\n    }\n  }\n  return {\n    isInclude,\n    // @ts-ignore\n    priority,\n  };\n}\n\nexport const filterMenuByQuery = (query: string, menus: TYPE_MENU_DATA) => {\n  /**\n   * 1.全字匹配，优先级定10；2.匹配部分，根据匹配词的index分配优先级，10-index；\n   * 优先级决定了group的排序\n   */\n  if (!menus) return [];\n  return menus.map(((item) => {\n    const { type } = item;\n    switch (type) {\n      case TYPE_GROUP:\n      case TYPE_SUB_MENU:\n        let itemMenus = (item as SubMenuProps).menus;\n        if (itemMenus) {\n          // @ts-ignore\n          itemMenus = filterMenuByQuery(query, itemMenus);\n          if (itemMenus.length > 0) {\n            return {\n              ...item,\n              menus: itemMenus,\n              // @ts-ignore\n              priority: itemMenus[0].priority,\n            };\n          }\n        }\n        return null;\n      case TYPE_MENU_ITEM:\n        // 这里计算权重和筛选\n        const itemQuery = (item as MenuItemProps).query;\n        if (itemQuery) {\n          if (checkIsQuery(query, itemQuery)) {\n            return {\n              ...item,\n              priority: 10,\n            };\n          }\n          const { isInclude, priority } = checkIsInclude(query, itemQuery);\n          if (isInclude) {\n            return {\n              ...item,\n              priority,\n            };\n          }\n        }\n        return null;\n      default:\n        return null;\n    }\n  }))\n    .filter((item) => !!item)\n    .sort((a, b) => {\n      return b?.priority - a?.priority;\n    });\n};\n"],"file":"utils.js"}