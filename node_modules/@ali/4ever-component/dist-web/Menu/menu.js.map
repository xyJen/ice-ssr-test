{"version":3,"sources":["../../../src/Menu/menu.tsx"],"names":["React","Controller","SubMenu","MenuItemGroup","MenuItem","MenuDivider","InlineMenuItem","InlineMenuItemGroup","Matcher","omit","TYPE_MENU_ITEM","TYPE_SUB_MENU","TYPE_GROUP","TYPE_INLINE_MENU_ITEM","TYPE_INLINE_MENU_GROUP","TYPE_INLINE_MENU_WRAPPER","TYPE_QUERY_ONLY_INLINE_MENU_ITEM","InlineMenuWrapper","usePlugins","checkIfNotAllChildrenHidden","menu","menus","some","item","type","hidden","inlineToBlockMap","Map","convertInlineMenus","map","items","forEach","wrapper","inline","menuKey","tooltip","split","pluginName","menuName","key","get","push","title","isNotMenuItem","maybeWrapper","convertMenusToMatcherData","keywords","query","Array","isArray","data","subItems","convertMatcherDataToMenus","MenuAdapter","props","onQuery","controller","useController","plugins","matcher","useMemo","result","matcherData","lang","enableFuzzy","menuData","results","match","notNullMenuCount","getMenuFromPlugin","defaultMenuName","PluginMenu","locale","plugin","hash","menubar","renderMenuItem","menuExtraKey","rest","renderInlineMenuItem","icon","renderInlineMenuGroup","index","menuGroupData","shouldShowDivider","renderMenus","renderInlineMenuWrapper","menuWrapperData","renderSubMenu","subMenuData","menusView","filter","view","length","renderMenuGroup","renderMenu","console","warn","menuView"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { BiPlugin, Controller } from '@ali/4ever-cangjie';\nimport {\n  SubMenu,\n  MenuItemGroup,\n  MenuItem,\n  MenuDivider,\n  InlineMenuItem,\n  InlineMenuItemGroup,\n} from '@ali/we-design';\nimport { Matcher } from '@ali/4ever-utils';\nimport { omit } from 'lodash-es';\n\nimport {\n  TYPE_MENU_DATA,\n  TYPE_MENU_ITEM,\n  TYPE_SUB_MENU,\n  MENU_ITEM_TYPE,\n  TYPE_GROUP,\n  MenuProps,\n  MenuGroupProps,\n  SubMenuProps,\n  MenuItemProps,\n  TYPE_INLINE_MENU_ITEM,\n  TYPE_INLINE_MENU_GROUP,\n  TYPE_INLINE_MENU_WRAPPER,\n  InlineMenuItemProps,\n  InlineMenuGroupProps,\n  InlineMenuWrapperProps,\n  TYPE_QUERY_ONLY_INLINE_MENU_ITEM,\n} from './interface';\n\nimport { InlineMenuWrapper } from './style';\nimport { usePlugins } from '../PluginsContext';\n\nconst checkIfNotAllChildrenHidden = (menu: SubMenuProps | MenuGroupProps): boolean => {\n  const { menus } = menu;\n\n  return menus.some((item) => {\n    if (item && (item.type === TYPE_SUB_MENU || item.type === TYPE_GROUP)) {\n      return checkIfNotAllChildrenHidden(item);\n    }\n    return item && !(item as MenuItemProps).hidden;\n  });\n};\n\nconst inlineToBlockMap = new Map([\n  ['heading1Inline', 'heading1'],\n  ['heading2Inline', 'heading2'],\n  ['heading3Inline', 'heading3'],\n  ['heading4Inline', 'heading4'],\n  ['tlistInline', 'tlist'],\n  ['olistInline', 'olist'],\n  ['ulistInline', 'ulist'],\n]);\n\nconst convertInlineMenus = (menus: TYPE_MENU_DATA) => {\n  return menus.map((item) => {\n    if (item.type === TYPE_INLINE_MENU_GROUP) {\n      const items: MenuItemProps[] = [];\n      item.menus.forEach((wrapper) => {\n        if (wrapper.type === TYPE_INLINE_MENU_WRAPPER) {\n          (wrapper as InlineMenuWrapperProps).menus.forEach((inline) => {\n            const { menuKey, tooltip } = inline;\n            const [pluginName, menuName] = menuKey.split('.');\n            let key = menuKey;\n            if (menuName) {\n              key = `${pluginName}.${inlineToBlockMap.get(menuName) || menuName}`;\n            }\n            items.push({\n              ...inline,\n              type: TYPE_MENU_ITEM,\n              menuKey: key,\n              title: tooltip,\n            });\n          });\n        }\n      });\n      return {\n        type: TYPE_GROUP,\n        menus: items,\n      };\n    }\n    return item;\n  }) as TYPE_MENU_DATA;\n};\n\nfunction isNotMenuItem(maybeWrapper: any): maybeWrapper is (MenuGroupProps| SubMenuProps) {\n  return maybeWrapper.menus;\n}\n\nconst convertMenusToMatcherData = (menus: TYPE_MENU_DATA) => {\n  return (menus as any).map((item: MenuItemProps | MenuGroupProps | SubMenuProps) => {\n    let keywords: string[] = [];\n    if (item.query) {\n      if (Array.isArray(item.query)) {\n        keywords = [...item.query];\n      } else {\n        keywords.push(item.query);\n      }\n    }\n    if (isNotMenuItem(item)) {\n      return {\n        keywords,\n        data: {\n          ...omit(item, 'menus'),\n        },\n        subItems: convertMenusToMatcherData(item.menus),\n      };\n    }\n    return {\n      keywords,\n      data: {\n        ...item,\n      },\n    };\n  });\n};\n\nconst convertMatcherDataToMenus = (items) => {\n  return items.map((item) => {\n    if (item.subItems) {\n      return {\n        ...item.data,\n        menus: convertMatcherDataToMenus(item.subItems),\n      };\n    }\n    return item.data;\n  });\n};\n\nconst MenuAdapter: React.FC<MenuProps> = (props) => {\n  const {\n    menus,\n    query,\n    onQuery,\n  } = props;\n\n  // TODO: 这里依赖父级Provider，后续有不依赖编辑器的纯menu场景需要兼容\n  const controller = Controller.useController();\n  const plugins = usePlugins();\n  // 初始化搜索工具\n  const matcher: Matcher = React.useMemo(() => {\n    // 有query先转化掉inlineMenu\n    const result = convertInlineMenus(menus);\n    const matcherData = convertMenusToMatcherData(result);\n    return new Matcher({\n      lang: 'en-US',\n      items: matcherData,\n      enableFuzzy: true,\n    });\n  }, [menus]);\n\n  const menuData = React.useMemo(() => {\n    if (!query || !matcher) return menus;\n    const results = matcher.match(query);\n    onQuery?.(results);\n    return convertMatcherDataToMenus(results);\n  }, [query, menus, matcher, onQuery]);\n\n  let notNullMenuCount = 0;\n\n  /**\n   * 从插件中获取menu组件\n   * @param menu\n   */\n  const getMenuFromPlugin = (menu: MenuItemProps | SubMenuProps | InlineMenuItemProps, defaultMenuName = 'menu') => {\n    const { menuKey } = menu;\n    if (!menuKey) {\n      return {\n        PluginMenu: null,\n        locale: {},\n      };\n    }\n\n    const [pluginName, menuName = defaultMenuName] = menuKey.split('.');\n    const plugin: BiPlugin | undefined = plugins?.hash[pluginName] as any;\n    let PluginMenu;\n    if (plugin && plugin.menubar && plugin.menubar[menuName]) {\n      PluginMenu = plugin.menubar[menuName];\n    }\n\n    return {\n      PluginMenu,\n      locale: plugin?.menubar?.locale || {},\n    };\n  };\n\n  /**\n   * 渲染菜单项\n   * @param menu\n   */\n  const renderMenuItem = (menu: MenuItemProps) => {\n    const {\n      title,\n      hidden,\n      menuExtraKey = '',\n      menuKey,\n      ...rest\n    } = menu;\n    if (hidden) return null;\n\n    notNullMenuCount += 1;\n\n    const { PluginMenu, locale } = getMenuFromPlugin(menu);\n    // 通过 menuExtraKey 可实现多个相同功能 menuItem 共存\n    const key = menuKey + menuExtraKey;\n    if (PluginMenu) {\n      return (\n        <PluginMenu\n          key={key}\n          controller={controller}\n          menuItem={{\n            ...menu,\n            menuKey: key,\n          }}\n          locale={locale}\n        />);\n    }\n\n    return (\n      <MenuItem {...rest} key={key} menuKey={key}>\n        {title}\n      </MenuItem>\n    );\n  };\n\n  const renderInlineMenuItem = (menu: InlineMenuItemProps) => {\n    const { hidden, menuKey, menuExtraKey = '', icon, ...rest } = menu;\n    if (hidden) return null;\n    notNullMenuCount += 1;\n    const { PluginMenu, locale } = getMenuFromPlugin(menu, 'inlineMenu');\n    const key = menuKey + menuExtraKey;\n\n    if (PluginMenu) {\n      return (\n        <PluginMenu\n          key={key}\n          controller={controller}\n          menuItem={{\n            ...menu,\n            menuKey: key,\n          }}\n          locale={locale}\n        />\n      );\n    }\n    // @ts-ignore\n    return <InlineMenuItem {...rest} key={key} menuKey={key} />;\n  };\n\n  const renderInlineMenuGroup = (menu: InlineMenuGroupProps, index: number) => {\n    const {\n      title,\n      hidden,\n      menus: menuGroupData,\n    } = menu;\n    if (hidden) return null;\n\n    const shouldShowDivider = index !== 0 && notNullMenuCount >= 1;\n    return (\n      <React.Fragment key={index}>\n        {shouldShowDivider ? <MenuDivider /> : null}\n        <InlineMenuItemGroup title={title}>\n          {renderMenus(menuGroupData as TYPE_MENU_DATA)}\n        </InlineMenuItemGroup>\n      </React.Fragment>\n    );\n  };\n\n  const renderInlineMenuWrapper = (menu: InlineMenuWrapperProps, index: number) => {\n    const {\n      menus: menuWrapperData,\n    } = menu;\n    return (\n      <InlineMenuWrapper key={index}>\n        {renderMenus(menuWrapperData)}\n      </InlineMenuWrapper>\n    );\n  };\n\n  /**\n   * 渲染子菜单\n   * @param menu\n   * @param index\n   */\n  const renderSubMenu = (menu: SubMenuProps, index: number) => {\n    const {\n      title,\n      hidden,\n      menus: subMenuData,\n      ...rest\n    } = menu;\n    if (hidden || !checkIfNotAllChildrenHidden(menu)) return null;\n\n    const { PluginMenu, locale } = getMenuFromPlugin(menu);\n    if (PluginMenu) {\n      return (\n        <PluginMenu\n          key={menu.menuKey}\n          controller={controller}\n          menuItem={menu}\n          locale={locale}\n        />);\n    }\n\n    const menusView = renderMenus(subMenuData || []);\n\n    if (query && (!menusView || menusView.filter((view) => !!view).length === 0)) {\n      return null;\n    }\n\n    return (\n      <SubMenu {...rest} title={title} key={menu.menuKey || index}>\n        {menusView}\n      </SubMenu>\n    );\n  };\n\n  /**\n   * 渲染菜单组\n   * @param menu\n   * @param index\n   */\n  const renderMenuGroup = (menu: MenuGroupProps, index: number) => {\n    const {\n      title,\n      hidden,\n      menus: menuGroupData,\n      ...rest\n    } = menu;\n    if (hidden || !checkIfNotAllChildrenHidden(menu)) return null;\n    const shouldShowDivider = index !== 0 && notNullMenuCount >= 1;\n\n    const menusView = renderMenus(menuGroupData);\n\n    // children 没有值的时候隐藏\n    if (query && (!menusView || menusView.filter((view) => !!view).length === 0)) {\n      return null;\n    }\n\n    return (\n      <React.Fragment key={index}>\n        {shouldShowDivider ? <MenuDivider /> : null}\n        <MenuItemGroup {...rest} title={title || ''}>\n          {menusView}\n        </MenuItemGroup>\n      </React.Fragment>\n    );\n  };\n\n  const renderMenu = (item: MENU_ITEM_TYPE, index: number) => {\n    if (!item) return null;\n    const { type } = item;\n\n    switch (type) {\n      case TYPE_GROUP:\n        return renderMenuGroup(item as MenuGroupProps, index);\n      case TYPE_INLINE_MENU_GROUP:\n        return renderInlineMenuGroup(item as InlineMenuGroupProps, index);\n      case TYPE_INLINE_MENU_WRAPPER:\n        return renderInlineMenuWrapper(item as InlineMenuWrapperProps, index);\n      case TYPE_SUB_MENU:\n        return renderSubMenu(item as SubMenuProps, index);\n      case TYPE_MENU_ITEM:\n        return renderMenuItem(item as MenuItemProps);\n      case TYPE_INLINE_MENU_ITEM:\n        return renderInlineMenuItem(item as InlineMenuItemProps);\n      case TYPE_QUERY_ONLY_INLINE_MENU_ITEM:\n        // 仅支持查询的菜单项在无 query 场景不显示\n        return null;\n      default:\n        console.warn(`not support ${type} (type should be one of: TYPE_GROUP | TYPE_SUB_MENU | TYPE_MENU_ITEM)`);\n        return null;\n    }\n  };\n\n  const renderMenus = (data: TYPE_MENU_DATA) => {\n    if (!data) return null;\n    return data.map(renderMenu);\n  };\n\n  // @ts-ignore\n  const menuView = renderMenus(menuData);\n\n  if (query && (!menuView || menuView.filter((item) => item).length === 0)) {\n    return null;\n  }\n\n  return (\n    <>\n      {menuView}\n    </>\n  );\n};\n\nexport default MenuAdapter;\n"],"file":"menu.js"}