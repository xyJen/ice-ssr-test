{"version":3,"sources":["../../../src/NewToolbar/inlineFloatToolbar.tsx"],"names":["React","useState","useCallback","styled","ButtonSize","ToolbarMode","Controller","Commands","ContextMenu","environment","useSelectionData","usePlugins","judgeShouldShow","ToolbarConfig","ToolbarGroupWrapper","GroupWrapper","ToolbarColumnWrapper","ColumnWrapper","IconButton","Dropdown","ToolbarMoreNormal","Menu","EMenuMode","withTheme","DropdownAnimation","ToolbarReduceIndentNormal","ToolbarIncreaseIndentNormal","ToolbarCutNormal","ToolbarCopyNormal","ToolbarDeleteNormal","ToolbarEraserNormal","ToolbarBrushNormal","renderToolArray","idleRender","upperFirst","default","MenuAdapter","TYPE_GROUP","TYPE_MENU_ITEM","ACTION_COPY","ACTION_CUT","disabledStyle","display","opacity","pointerEvents","MenuWrapper","div","RowWrapper","ToolbarWrapperHeight","ToolbarWrapper","props","enableShadow","ModKey","IS_MAC","sizeStyle","width","noShadowStyle","boxShadow","genShortcutString","parmas","keys","split","formatKeys","map","key","join","ToolbarRenderNext","controller","useController","useReducer","c","forceUpdate","_isPureTableSelection","query","_hasTableSelection","plugins","array","hash","singleLayout","moreSingleLayout","hiddenToolButtons","customToolButtons","disableTargets","fineAdaptation","container","value","toolbarWrapperRef","useRef","target","useMemo","pluginsArray","i","length","tgt","plugin","getTarget","toolbar","renderTool","item","index","isValidElement","name","hideTargets","hideConditions","showTargets","disableItems","size","rest","indexOf","some","n","CustomComponent","pluginName","buttonName","buttons","Component","shouldShow","locale","realSize","medium","showTitle","large","needRender","single","current","renderLine","line","layoutMode","contents","Wrapper","renderGroup","group","toolbarMode","hideBorder","clearPadding","groupFineAdaptation","realFineAdaption","undefined","toString","renderSingleToolbar","singleLineLayout","layout","defaultSingleLayout","tls","idx","toolLines","filter","handleMouseDown","ev","activeElement","window","document","closest","tagName","toLocaleLowerCase","preventDefault","stopPropagation","fTgts","defaultDisableTargets","shouldDisableWholeToolbar","classes","wrapperStyle","handlePendingSelectionChange","selectionData$","MoreMenu","isPureTableSelection","moreToolbarActive","setMoreToolbarActive","onCutOrCopy","action","run","type","onClickCut","onClickCopy","onClickDelete","command","del","insertMenus","draggablePlugin","draggable","arr","menus","menuKey","icon","autoClose","extra","title","copyMenu","menuExtraKey","onClick","cutMenu","deleteMenu","hidden","v","backgroundColor","border","vertical","process","env","NODE_ENV","leading"],"mappings":"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","sourcesContent":["import React, { useState, useCallback } from 'react';\nimport styled from 'styled-components';\nimport {\n  ButtonSize,\n  ToolbarRenderNextProps,\n  ToolButtonProps,\n  ToolGroupProps,\n  ToolLineProps,\n  LayoutType,\n  ToolbarMode,\n} from './interface';\nimport { Controller, Commands, ContextMenu, environment, useSelectionData, BiPlugin } from '@ali/4ever-cangjie';\nimport { usePlugins } from '../PluginsContext';\nimport { judgeShouldShow } from '../Toolbar/util';\nimport ToolbarConfig from './config';\nimport {\n  ToolbarGroupWrapper as GroupWrapper,\n  ToolbarColumnWrapper as ColumnWrapper,\n  IconButton,\n} from '@ali/we-toolbar';\nimport { Dropdown, ToolbarMoreNormal, Menu, EMenuMode, withTheme } from '@ali/we-design';\nimport { DropdownAnimation } from '@ali/we-util';\nimport {\n  ToolbarReduceIndentNormal,\n  ToolbarIncreaseIndentNormal,\n  DocToolbarH1Normal,\n  DocToolbarH2Normal,\n  DocToolbarH3Normal,\n  DocToolbarH4Normal,\n  ToolbarOrderListNormal,\n  ToolbarCheckBoxNormal,\n  ToolbarUnorderListNormal,\n  ToolbarCutNormal,\n  ToolbarCopyNormal,\n  ToolbarDeleteNormal,\n  ToolbarCodeNormal,\n  DocToolbarTextNormal,\n  DocHighBlockNormal,\n  ChangetoNormal,\n  AddDownNormal,\n  AddUpNormal,\n  MaodianNormal,\n  ToolbarEraserNormal,\n  ToolbarLinkV2Normal,\n  ToolbarBrushNormal,\n} from '@ali/we-icon';\nimport { renderToolArray } from './util';\nimport { idleRender } from '../idleRender';\nimport { upperFirst } from 'lodash-es';\nimport {\n  default as MenuAdapter,\n} from '../Menu/menu';\nimport {\n  TYPE_GROUP,\n  TYPE_MENU_ITEM,\n} from '../Menu/interface';\n;\n\nconst { ACTION_COPY, ACTION_CUT } = ContextMenu;\n\ninterface MoreMenuProps {\n  container: HTMLElement;\n  isPureTableSelection: boolean;\n}\n\nexport const disabledStyle: React.CSSProperties = {\n  display: 'flex',\n  opacity: 0.35,\n  pointerEvents: 'none',\n};\n\nexport const MenuWrapper = styled.div`\n  background: #FFF;\n  box-shadow: 0px 0px 1px rgba(0, 0, 0, 0.24), 0px 8px 24px rgba(0, 0, 0, 0.16);\n  border-radius: 4px;\n`;\n\nexport const RowWrapper = withTheme(styled.div`\n  display: flex;\n  margin-bottom: 4px;\n  :last-child {\n    margin-bottom: 0px;\n  }\n  box-sizing: content-box;\n  .split-button-layout,\n  .icon-select-layout {\n    border-left: 2px solid transparent;\n    border-right: 2px solid transparent;\n  }\n  > * {\n    margin-right: 2px;\n  }\n  > *:last-child {\n    margin-right: 0;\n  }\n`);\n\nconst ToolbarWrapperHeight = 36;\n\n// icon-select-layout 覆写 设计要求下拉不能有左右边距\nconst ToolbarWrapper = styled.div<{ enableShadow?: boolean }>`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: relative;\n  background-color: #FFFFFF;\n  height: ${ToolbarWrapperHeight}px;\n  border-radius: 4px;\n  box-shadow: ${props => (props.enableShadow ? '0px 0px 1px rgb(0 0 0 / 24%), 0px 0px 24px rgb(0 0 0 / 8%)' : 'none')};\n  .icon-select-layout {\n    border-left: none;\n    border-right: none;\n  }\n`;\n\nexport const ModKey = environment.IS_MAC ? '⌘' : 'Ctrl';\nexport const sizeStyle: React.CSSProperties = { width: 190 };\nconst noShadowStyle: React.CSSProperties = { boxShadow: 'none' };\n\nfunction genShortcutString(parmas: string) {\n  const keys = parmas.split('+');\n  const formatKeys = keys.map((key) => {\n    return upperFirst(key === 'mod' ? ModKey : key);\n  });\n  return formatKeys.join('+');\n}\n\ninterface InlineFloatToolbarRenderNextProps extends ToolbarRenderNextProps {\n  moreSingleLayout?: ToolLineProps[];\n  container: HTMLElement;\n}\n\nconst ToolbarRenderNext: React.FC<InlineFloatToolbarRenderNextProps> = (props) => {\n  const controller = Controller.useController();\n  const [, forceUpdate] = React.useReducer((c) => !c, false);\n  const _isPureTableSelection = controller.query('isPureTableSelection');\n  const _hasTableSelection = controller.query('hasTableSelection');\n  const plugins = usePlugins() || { array: [], hash: {} };\n  const {\n    singleLayout,\n    moreSingleLayout,\n    hiddenToolButtons = {},\n    customToolButtons = {},\n    disableTargets,\n    fineAdaptation,\n    container,\n  } = props;\n  const { value } = controller;\n  const toolbarWrapperRef = React.useRef<HTMLDivElement>(null);\n\n  /**\n   * 从插件查询哪个插件被选中（暂不支持多个插件同时识别）\n   * 通过调用插件 getTarget 实现\n   */\n  const target = React.useMemo(() => {\n    const pluginsArray = plugins.array;\n    for (let i = 0; i < pluginsArray.length; i += 1) {\n      let tgt;\n      const plugin = pluginsArray[i] as BiPlugin;\n      const getTarget = plugin.toolbar && plugin.toolbar.getTarget;\n      if (getTarget) {\n        tgt = getTarget(controller);\n      }\n      if (tgt) {\n        return tgt;\n      }\n    }\n  }, [plugins.array, value]);\n\n  /**\n   * 渲染单个 toolButton\n   * @param toolButton配置，支持直接传一个react元素\n   * @param index\n   */\n  const renderTool = (item: ToolButtonProps | React.ReactElement, index: number) => {\n    if (React.isValidElement(item)) {\n      return item;\n    }\n    const { name, hideTargets, hideConditions, showTargets, disableTargets: disableItems, size, ...rest } = item;\n\n    if (hideConditions && hideConditions.indexOf('hasTableSelection') > -1) {\n      if (_isPureTableSelection) {\n        return null;\n      }\n    }\n\n    if (hideConditions && hideConditions.some(n => controller.query(n))) {\n      return null;\n    }\n\n    // hiddenToolButtons 优先\n    if (hiddenToolButtons[name]) return null;\n\n    if (name === 'more') {\n      return <MoreMenu container={container} isPureTableSelection={_isPureTableSelection!} />;\n    }\n\n    // 优先从自定义组件里匹配\n    const CustomComponent = customToolButtons[name];\n\n    const [pluginName, buttonName = 'default'] = name.split('.');\n    const plugin = plugins.hash[pluginName] as BiPlugin | undefined;\n    if (!plugin && !CustomComponent) {\n      return null;\n    }\n\n    const buttons = plugin?.toolbar && plugin?.toolbar?.buttons;\n    const Component = CustomComponent || (buttons && buttons[buttonName]);\n\n    if (!Component) {\n      return null;\n    }\n\n    if (plugin?.toolbar) {\n      // 判断是否隐藏\n      const shouldShow = judgeShouldShow(target, showTargets, hideTargets);\n      if (!shouldShow) return null;\n    }\n\n    // 优先取自定义国际化文案\n    const locale = plugin?.toolbar?.locale;\n    const realSize = size || ButtonSize.medium;\n    const showTitle = realSize === ButtonSize.large;\n\n    if (Component.needRender && !Component.needRender(controller)) {\n      return null;\n    }\n\n    return (\n      <Component\n        controller={controller}\n        toolbarMode={ToolbarMode.single}\n        locale={locale}\n        size={realSize}\n        key={index}\n        showTitle={showTitle}\n        getContainer={() => (toolbarWrapperRef.current || container)}\n        {...rest}\n      />\n    );\n  };\n\n  const renderLine = (line: ToolLineProps, index: number, layoutMode: LayoutType = 'row') => {\n    const contents = renderToolArray(line, 'toolButtons', target, renderTool);\n    if (!contents) return null;\n    const Wrapper = layoutMode === 'row' ? RowWrapper : ColumnWrapper;\n\n    return (\n      <Wrapper key={index}>\n        {contents}\n      </Wrapper>\n    );\n  };\n\n  const renderGroup = (group: ToolGroupProps, index: number, toolbarMode: ToolbarMode) => {\n    const { layoutMode, hideBorder, clearPadding, fineAdaptation: groupFineAdaptation } = group;\n    const contents = renderToolArray(group, 'toolLines', target, renderLine, layoutMode);\n\n    // 单行默认精细化控制，双行默认按组收缩\n    let realFineAdaption = toolbarMode === ToolbarMode.single;\n    if (groupFineAdaptation !== undefined) {\n      realFineAdaption = groupFineAdaptation;\n    } else if (fineAdaptation !== undefined) {\n      realFineAdaption = fineAdaptation;\n    }\n    if (!contents) return null;\n    return (\n      <GroupWrapper\n        layoutType=\"row\"\n        groupKey={index.toString()}\n        fineAdaptation={realFineAdaption}\n        key={index}\n        hideBorder={hideBorder}\n        clearPadding={clearPadding}\n      >\n        {contents}\n      </GroupWrapper>\n    );\n  };\n\n  const renderSingleToolbar = (singleLineLayout?: ToolLineProps[]) => {\n    const layout = singleLineLayout || ToolbarConfig.defaultSingleLayout;\n    // @ts-ignore\n    const tls = layout.map((line, idx) => {\n      const group = {\n        toolLines: [\n          line,\n        ],\n        hideBorder: false,\n      };\n      if (idx === layout.length - 1) {\n        group.hideBorder = true;\n      }\n      return renderGroup(group, idx, ToolbarMode.single);\n    }).filter(item => item);\n    if (!tls.length) return null;\n    return (\n      <div style={{ display: 'flex' }}>\n        {tls}\n      </div>\n    );\n  };\n\n  /**\n   * 阻止默认事件，防止文档区域失焦\n   */\n  const handleMouseDown = useCallback(ev => {\n    const { activeElement } = window.document;\n\n    // 对于有自定义输入域的不可编辑对象，不阻止其失焦行为\n    if (activeElement && activeElement.closest('[data-cangjie-not-editable]')) {\n      return;\n    }\n\n    if (ev.target?.tagName.toLocaleLowerCase() !== 'input') {\n      // 放过input，以便输入地方可以正常输入\n      ev.preventDefault && ev.preventDefault();\n      ev.stopPropagation && ev.stopPropagation();\n    }\n  }, []);\n\n  const fTgts = disableTargets || ToolbarConfig.defaultDisableTargets;\n  const shouldDisableWholeToolbar = fTgts[target];\n\n  const classes = 'bi-toolbar inline-float';\n  let wrapperStyle: React.CSSProperties = {\n    display: 'flex',\n  };\n  if (shouldDisableWholeToolbar) {\n    wrapperStyle = disabledStyle;\n  }\n\n  const handlePendingSelectionChange = React.useCallback(() => {\n    // 处理 pending 不及时导致的工具栏长度变化的问题\n    if (!_hasTableSelection && controller.query('hasTableSelection')) {\n      forceUpdate();\n    }\n  }, [controller]);\n\n  useSelectionData(controller.selectionData$, null, handlePendingSelectionChange, []);\n\n  return (\n    <ToolbarWrapper\n      style={wrapperStyle}\n      className={classes}\n      onMouseDown={handleMouseDown}\n      ref={toolbarWrapperRef}\n      data-role=\"inlineToolbar\"\n    >\n      {renderSingleToolbar(singleLayout)}\n    </ToolbarWrapper>\n  );\n};\n\nconst MoreMenu = (props: MoreMenuProps) => {\n  const { container, isPureTableSelection } = props;\n  const [moreToolbarActive, setMoreToolbarActive] = useState(false);\n  const plugins = usePlugins();\n  const controller = Controller.useController();\n  const onCutOrCopy = useCallback((action) => {\n    controller.run('onAction', {\n      type: action,\n    });\n  }, []);\n\n  const onClickCut = useCallback(() => {\n    onCutOrCopy(ACTION_CUT);\n  }, [onCutOrCopy]);\n\n  const onClickCopy = useCallback(() => {\n    onCutOrCopy(ACTION_COPY);\n  }, [onCutOrCopy]);\n\n  const onClickDelete = useCallback(() => {\n    controller.command(Commands.del);\n  }, [onCutOrCopy]);\n\n  const insertMenus: any = React.useMemo(() => {\n    // Copy Cut 的文案只有从 draggable 插件来\n    const draggablePlugin = plugins?.hash?.draggable as BiPlugin;\n    const arr = [\n      {\n        type: TYPE_GROUP,\n        menus: [\n          {\n            type: TYPE_MENU_ITEM,\n            menuKey: 'clearStyle',\n            icon: <ToolbarEraserNormal />,\n            autoClose: false,\n          },\n          {\n            type: TYPE_MENU_ITEM,\n            menuKey: 'formatPainter',\n            icon: <ToolbarBrushNormal />,\n            autoClose: false,\n          },\n        ],\n      },\n      {\n        type: TYPE_GROUP,\n        menus: [\n          {\n            type: TYPE_MENU_ITEM,\n            menuKey: 'indent.right',\n            icon: <ToolbarIncreaseIndentNormal />,\n            autoClose: false,\n            extra: genShortcutString('tab'),\n          },\n          {\n            type: TYPE_MENU_ITEM,\n            menuKey: 'indent.left',\n            icon: <ToolbarReduceIndentNormal />,\n            autoClose: false,\n            extra: genShortcutString('shift+tab'),\n          },\n        ],\n      },\n      {\n        type: TYPE_GROUP,\n        menus: [\n          {\n            type: TYPE_MENU_ITEM,\n            title: draggablePlugin?.toolbar?.locale?.copyMenu,\n            icon: <ToolbarCopyNormal />,\n            menuExtraKey: 'copy',\n            onClick: onClickCopy,\n            extra: genShortcutString('mod+c'),\n          },\n          {\n            type: TYPE_MENU_ITEM,\n            title: draggablePlugin?.toolbar?.locale?.cutMenu,\n            icon: <ToolbarCutNormal />,\n            menuExtraKey: 'cut',\n            onClick: onClickCut,\n            extra: genShortcutString('mod+x'),\n          },\n          {\n            type: TYPE_MENU_ITEM,\n            title: draggablePlugin?.toolbar?.locale?.deleteMenu,\n            icon: <ToolbarDeleteNormal />,\n            menuExtraKey: 'delete',\n            onClick: onClickDelete,\n            hidden: isPureTableSelection,\n          },\n        ],\n      }\n    ];\n\n    return arr;\n  }, [onClickCopy, onClickCut, onClickDelete, isPureTableSelection]);\n  return <Dropdown\n    visible={moreToolbarActive}\n    onVisibleChange={(v) => { setMoreToolbarActive(v); }}\n    // 使用 toolbarWrapperRef 作为 Container 可保证整体动画的流畅\n    // 避免主体动画先完成或者后完成\n    getContainer={() => {\n      return container;\n    }}\n    overlayStyle={{\n      backgroundColor: 'transparent',\n      boxShadow: 'none',\n      border: 'none',\n    }}\n    overlay={\n      <DropdownAnimation visible={moreToolbarActive}>\n        <MenuWrapper style={noShadowStyle}>\n          <Menu\n            mode={EMenuMode.vertical}\n            selectedKeys={[]}\n            destroyOverlayWhenInvisible\n            insertSubmenuToMenuRoot\n            style={sizeStyle}\n            onClick={(v) => { setMoreToolbarActive(false) }}\n            getContainer={() => {\n              return container;\n            }}\n          >\n            <MenuAdapter menus={insertMenus} />\n          </Menu>\n        </MenuWrapper>\n      </DropdownAnimation>\n    }\n    placement=\"bottomLeft\"\n    offsetY={2}\n  >\n    <IconButton\n      icon={<ToolbarMoreNormal />}\n      testid=\"toolbar_more\"\n      onClick={() => { setMoreToolbarActive(!moreToolbarActive); }}\n      active={moreToolbarActive}\n    />\n  </Dropdown>\n};\n\nexport default process.env.NODE_ENV === 'test'\n  ? ToolbarRenderNext\n  : idleRender(ToolbarRenderNext, 400, { leading: true });\n"],"file":"inlineFloatToolbar.js"}