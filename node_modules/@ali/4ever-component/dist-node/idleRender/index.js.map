{"version":3,"sources":["../../../src/idleRender/index.tsx"],"names":["idleRender","Component","delay","options","IdleComponent","React","timeout","debouncedForceUpdate","forceUpdate","updateWhenIdle","shouldComponentUpdate","componentWillUnmount","cancel","render","props"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;uBAD4B,a;;AAGrB,SAASA,UAAT,CACLC,SADK,EAELC,KAFK,EAGLC,OAHK,EAIL;AACA,SAAO,MAAMC,aAAN,SAA4BC,KAAK,CAACJ,SAAlC,CAA4C;AAAA;AAAA;AAAA,WACzCK,OADyC,GAC/B,CAAC,CAD8B;AAAA,WAGhCC,oBAHgC,GAGT,sBACtC,MAAM;AACJ,aAAKC,WAAL;AACD,OAHqC,EAItCN,KAJsC,EAKtCC,OALsC,CAHS;;AAAA,WAWhCM,cAXgC,GAWf,MAAM;AACtC,2CAAmB,KAAKH,OAAxB;AACA,aAAKA,OAAL,GAAe,oCAAoB,MAAM;AACvC,eAAKC,oBAAL;AACD,SAFc,CAAf;AAGD,OAhBgD;AAAA;;AAkBjDG,IAAAA,qBAAqB,GAAG;AACtB,WAAKD,cAAL;AACA,aAAO,KAAP;AACD;;AAEDE,IAAAA,oBAAoB,GAAG;AACrB,WAAKJ,oBAAL,CAA0BK,MAA1B;AACA,yCAAmB,KAAKN,OAAxB;AACD;;AAEDO,IAAAA,MAAM,GAAG;AACP,0BAAO,eAAC,SAAD,EAAe,KAAKC,KAApB,CAAP;AACD;;AA9BgD,GAAnD;AAgCD","sourcesContent":["import * as React from 'react';\nimport { debounce } from 'lodash-es';\nimport { requestIdleCallback, cancelIdleCallback } from '@ali/4ever-utils';\n\nexport function idleRender(\n  Component,\n  delay: number,\n  options: any,\n) {\n  return class IdleComponent extends React.Component {\n    private timeout = -1;\n\n    private readonly debouncedForceUpdate = debounce(\n      () => {\n        this.forceUpdate();\n      },\n      delay,\n      options,\n    );\n\n    private readonly updateWhenIdle = () => {\n      cancelIdleCallback(this.timeout);\n      this.timeout = requestIdleCallback(() => {\n        this.debouncedForceUpdate();\n      });\n    }\n\n    shouldComponentUpdate() {\n      this.updateWhenIdle();\n      return false;\n    }\n\n    componentWillUnmount() {\n      this.debouncedForceUpdate.cancel();\n      cancelIdleCallback(this.timeout);\n    }\n\n    render() {\n      return <Component {...this.props} />;\n    }\n  } as typeof Component;\n}\n"],"file":"index.js"}