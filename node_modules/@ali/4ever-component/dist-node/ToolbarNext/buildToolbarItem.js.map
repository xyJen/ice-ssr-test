{"version":3,"sources":["../../../src/ToolbarNext/buildToolbarItem.tsx"],"names":["isValidItem","item","displayName","String","type","props","display","SlotType","iconButton","iconMenu","iconSelect","splitButton","textSelect","custom","buildToolbarItem","plugins","controller","buttonName","customButtons","extraProps","customButton","CustomComponent","renderComponent","pluginName","split","plugin","hash","Component","renderToolbar","React","isValidElement","Error","key","BasicButton","icon","onClick","rest","handleClick","useCallback"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport type { Controller, BiPlugin } from '@ali/4ever-cangjie';\nimport { IBasicButton, IToolbarButtonConfig, IToolBar } from './interface';\nimport type { Plugins } from '../PluginsContext';\nimport { IconButton, ItemSlot, SlotType } from './basicComponents';\n\nfunction isValidItem(item: React.ReactElement) {\n  let displayName: string;\n  if (String((item.type as any).displayName) === 'toolbarSlot') {\n    displayName = item.props.display;\n  } else {\n    displayName = String((item.type as any).displayName)\n  }\n  switch (displayName) {\n    case SlotType.iconButton:\n    case SlotType.iconMenu:\n    case SlotType.iconSelect:\n    case SlotType.splitButton:\n    case SlotType.textSelect:\n    case SlotType.custom:\n      return true;\n    default:\n      return false;\n  }\n}\n\n\nexport function buildToolbarItem(plugins: Plugins | null, controller: Controller, buttonName: string, customButtons: IToolBar['customButtons'], extraProps: { disabled?: true, key: string } & IToolbarButtonConfig) {\n\n  const customButton = customButtons?.[buttonName]\n  // 自定义按钮优先\n  if (customButton && typeof customButton === 'function') {\n    const CustomComponent = customButton({ extraProps }, controller);\n    return renderComponent(controller, extraProps, CustomComponent);\n  }\n\n  const [pluginName] = buttonName.split('.');\n  const plugin = plugins?.hash[pluginName] as BiPlugin;\n  if (!plugin) {\n    return null;\n  }\n\n  const Component = plugin?.renderToolbar?.({ buttonName, extraProps }, controller);\n\n  return renderComponent(controller, extraProps, Component);\n\n}\n\nfunction renderComponent(controller: Controller, extraProps: { disabled?: true, key: string }, Component: IBasicButton | React.ReactElement<IToolbarButtonConfig> | null | undefined) {\n  if (!Component) {\n    return null;\n  }\n\n  if (React.isValidElement(Component)) {\n    if (!isValidItem(Component)) {\n      throw new Error(`Component with key:${extraProps.key} must wrapped by ItemSlot`);\n    }\n    return Component;\n  }\n\n  return (\n    <ItemSlot display={SlotType.iconButton}>\n      <BasicButton\n        {...Component}\n        {...extraProps}\n        controller={controller}\n      />\n    </ItemSlot>\n  )\n\n}\n\n\nconst BasicButton: React.FC<IBasicButton & { controller: Controller }> = (props) => {\n\n  const { icon, onClick, controller, ...rest } = props;\n\n\n  const handleClick = React.useCallback(() => {\n    if (onClick && typeof onClick === 'function') {\n      onClick(controller);\n    }\n  }, [onClick, controller]);\n\n  return (\n    <IconButton\n      {...rest}\n      icon={icon}\n      onClick={handleClick}\n    />\n  )\n}\n"],"file":"buildToolbarItem.js"}