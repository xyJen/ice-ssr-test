{"version":3,"sources":["../../../src/NewToolbar/inlineFloatToolbar.tsx"],"names":["ACTION_COPY","ACTION_CUT","ContextMenu","disabledStyle","display","opacity","pointerEvents","MenuWrapper","styled","div","RowWrapper","ToolbarWrapperHeight","ToolbarWrapper","props","enableShadow","ModKey","environment","IS_MAC","sizeStyle","width","noShadowStyle","boxShadow","genShortcutString","parmas","keys","split","formatKeys","map","key","join","ToolbarRenderNext","controller","Controller","useController","forceUpdate","React","useReducer","c","_isPureTableSelection","query","_hasTableSelection","plugins","array","hash","singleLayout","moreSingleLayout","hiddenToolButtons","customToolButtons","disableTargets","fineAdaptation","container","value","toolbarWrapperRef","useRef","target","useMemo","pluginsArray","i","length","tgt","plugin","getTarget","toolbar","renderTool","item","index","isValidElement","name","hideTargets","hideConditions","showTargets","disableItems","size","rest","indexOf","some","n","CustomComponent","pluginName","buttonName","buttons","Component","shouldShow","locale","realSize","ButtonSize","medium","showTitle","large","needRender","ToolbarMode","single","current","renderLine","line","layoutMode","contents","Wrapper","ColumnWrapper","renderGroup","group","toolbarMode","hideBorder","clearPadding","groupFineAdaptation","realFineAdaption","undefined","toString","renderSingleToolbar","singleLineLayout","layout","ToolbarConfig","defaultSingleLayout","tls","idx","toolLines","filter","handleMouseDown","ev","activeElement","window","document","closest","tagName","toLocaleLowerCase","preventDefault","stopPropagation","fTgts","defaultDisableTargets","shouldDisableWholeToolbar","classes","wrapperStyle","handlePendingSelectionChange","useCallback","selectionData$","MoreMenu","isPureTableSelection","moreToolbarActive","setMoreToolbarActive","onCutOrCopy","action","run","type","onClickCut","onClickCopy","onClickDelete","command","Commands","del","insertMenus","draggablePlugin","draggable","arr","TYPE_GROUP","menus","TYPE_MENU_ITEM","menuKey","icon","autoClose","extra","title","copyMenu","menuExtraKey","onClick","cutMenu","deleteMenu","hidden","v","backgroundColor","border","EMenuMode","vertical","process","env","NODE_ENV","leading"],"mappings":"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","sourcesContent":["import React, { useState, useCallback } from 'react';\nimport styled from 'styled-components';\nimport {\n  ButtonSize,\n  ToolbarRenderNextProps,\n  ToolButtonProps,\n  ToolGroupProps,\n  ToolLineProps,\n  LayoutType,\n  ToolbarMode,\n} from './interface';\nimport { Controller, Commands, ContextMenu, environment, useSelectionData, BiPlugin } from '@ali/4ever-cangjie';\nimport { usePlugins } from '../PluginsContext';\nimport { judgeShouldShow } from '../Toolbar/util';\nimport ToolbarConfig from './config';\nimport {\n  ToolbarGroupWrapper as GroupWrapper,\n  ToolbarColumnWrapper as ColumnWrapper,\n  IconButton,\n} from '@ali/we-toolbar';\nimport { Dropdown, ToolbarMoreNormal, Menu, EMenuMode, withTheme } from '@ali/we-design';\nimport { DropdownAnimation } from '@ali/we-util';\nimport {\n  ToolbarReduceIndentNormal,\n  ToolbarIncreaseIndentNormal,\n  DocToolbarH1Normal,\n  DocToolbarH2Normal,\n  DocToolbarH3Normal,\n  DocToolbarH4Normal,\n  ToolbarOrderListNormal,\n  ToolbarCheckBoxNormal,\n  ToolbarUnorderListNormal,\n  ToolbarCutNormal,\n  ToolbarCopyNormal,\n  ToolbarDeleteNormal,\n  ToolbarCodeNormal,\n  DocToolbarTextNormal,\n  DocHighBlockNormal,\n  ChangetoNormal,\n  AddDownNormal,\n  AddUpNormal,\n  MaodianNormal,\n  ToolbarEraserNormal,\n  ToolbarLinkV2Normal,\n  ToolbarBrushNormal,\n} from '@ali/we-icon';\nimport { renderToolArray } from './util';\nimport { idleRender } from '../idleRender';\nimport { upperFirst } from 'lodash-es';\nimport {\n  default as MenuAdapter,\n} from '../Menu/menu';\nimport {\n  TYPE_GROUP,\n  TYPE_MENU_ITEM,\n} from '../Menu/interface';\n;\n\nconst { ACTION_COPY, ACTION_CUT } = ContextMenu;\n\ninterface MoreMenuProps {\n  container: HTMLElement;\n  isPureTableSelection: boolean;\n}\n\nexport const disabledStyle: React.CSSProperties = {\n  display: 'flex',\n  opacity: 0.35,\n  pointerEvents: 'none',\n};\n\nexport const MenuWrapper = styled.div`\n  background: #FFF;\n  box-shadow: 0px 0px 1px rgba(0, 0, 0, 0.24), 0px 8px 24px rgba(0, 0, 0, 0.16);\n  border-radius: 4px;\n`;\n\nexport const RowWrapper = withTheme(styled.div`\n  display: flex;\n  margin-bottom: 4px;\n  :last-child {\n    margin-bottom: 0px;\n  }\n  box-sizing: content-box;\n  .split-button-layout,\n  .icon-select-layout {\n    border-left: 2px solid transparent;\n    border-right: 2px solid transparent;\n  }\n  > * {\n    margin-right: 2px;\n  }\n  > *:last-child {\n    margin-right: 0;\n  }\n`);\n\nconst ToolbarWrapperHeight = 36;\n\n// icon-select-layout 覆写 设计要求下拉不能有左右边距\nconst ToolbarWrapper = styled.div<{ enableShadow?: boolean }>`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: relative;\n  background-color: #FFFFFF;\n  height: ${ToolbarWrapperHeight}px;\n  border-radius: 4px;\n  box-shadow: ${props => (props.enableShadow ? '0px 0px 1px rgb(0 0 0 / 24%), 0px 0px 24px rgb(0 0 0 / 8%)' : 'none')};\n  .icon-select-layout {\n    border-left: none;\n    border-right: none;\n  }\n`;\n\nexport const ModKey = environment.IS_MAC ? '⌘' : 'Ctrl';\nexport const sizeStyle: React.CSSProperties = { width: 190 };\nconst noShadowStyle: React.CSSProperties = { boxShadow: 'none' };\n\nfunction genShortcutString(parmas: string) {\n  const keys = parmas.split('+');\n  const formatKeys = keys.map((key) => {\n    return upperFirst(key === 'mod' ? ModKey : key);\n  });\n  return formatKeys.join('+');\n}\n\ninterface InlineFloatToolbarRenderNextProps extends ToolbarRenderNextProps {\n  moreSingleLayout?: ToolLineProps[];\n  container: HTMLElement;\n}\n\nconst ToolbarRenderNext: React.FC<InlineFloatToolbarRenderNextProps> = (props) => {\n  const controller = Controller.useController();\n  const [, forceUpdate] = React.useReducer((c) => !c, false);\n  const _isPureTableSelection = controller.query('isPureTableSelection');\n  const _hasTableSelection = controller.query('hasTableSelection');\n  const plugins = usePlugins() || { array: [], hash: {} };\n  const {\n    singleLayout,\n    moreSingleLayout,\n    hiddenToolButtons = {},\n    customToolButtons = {},\n    disableTargets,\n    fineAdaptation,\n    container,\n  } = props;\n  const { value } = controller;\n  const toolbarWrapperRef = React.useRef<HTMLDivElement>(null);\n\n  /**\n   * 从插件查询哪个插件被选中（暂不支持多个插件同时识别）\n   * 通过调用插件 getTarget 实现\n   */\n  const target = React.useMemo(() => {\n    const pluginsArray = plugins.array;\n    for (let i = 0; i < pluginsArray.length; i += 1) {\n      let tgt;\n      const plugin = pluginsArray[i] as BiPlugin;\n      const getTarget = plugin.toolbar && plugin.toolbar.getTarget;\n      if (getTarget) {\n        tgt = getTarget(controller);\n      }\n      if (tgt) {\n        return tgt;\n      }\n    }\n  }, [plugins.array, value]);\n\n  /**\n   * 渲染单个 toolButton\n   * @param toolButton配置，支持直接传一个react元素\n   * @param index\n   */\n  const renderTool = (item: ToolButtonProps | React.ReactElement, index: number) => {\n    if (React.isValidElement(item)) {\n      return item;\n    }\n    const { name, hideTargets, hideConditions, showTargets, disableTargets: disableItems, size, ...rest } = item;\n\n    if (hideConditions && hideConditions.indexOf('hasTableSelection') > -1) {\n      if (_isPureTableSelection) {\n        return null;\n      }\n    }\n\n    if (hideConditions && hideConditions.some(n => controller.query(n))) {\n      return null;\n    }\n\n    // hiddenToolButtons 优先\n    if (hiddenToolButtons[name]) return null;\n\n    if (name === 'more') {\n      return <MoreMenu container={container} isPureTableSelection={_isPureTableSelection!} />;\n    }\n\n    // 优先从自定义组件里匹配\n    const CustomComponent = customToolButtons[name];\n\n    const [pluginName, buttonName = 'default'] = name.split('.');\n    const plugin = plugins.hash[pluginName] as BiPlugin | undefined;\n    if (!plugin && !CustomComponent) {\n      return null;\n    }\n\n    const buttons = plugin?.toolbar && plugin?.toolbar?.buttons;\n    const Component = CustomComponent || (buttons && buttons[buttonName]);\n\n    if (!Component) {\n      return null;\n    }\n\n    if (plugin?.toolbar) {\n      // 判断是否隐藏\n      const shouldShow = judgeShouldShow(target, showTargets, hideTargets);\n      if (!shouldShow) return null;\n    }\n\n    // 优先取自定义国际化文案\n    const locale = plugin?.toolbar?.locale;\n    const realSize = size || ButtonSize.medium;\n    const showTitle = realSize === ButtonSize.large;\n\n    if (Component.needRender && !Component.needRender(controller)) {\n      return null;\n    }\n\n    return (\n      <Component\n        controller={controller}\n        toolbarMode={ToolbarMode.single}\n        locale={locale}\n        size={realSize}\n        key={index}\n        showTitle={showTitle}\n        getContainer={() => (toolbarWrapperRef.current || container)}\n        {...rest}\n      />\n    );\n  };\n\n  const renderLine = (line: ToolLineProps, index: number, layoutMode: LayoutType = 'row') => {\n    const contents = renderToolArray(line, 'toolButtons', target, renderTool);\n    if (!contents) return null;\n    const Wrapper = layoutMode === 'row' ? RowWrapper : ColumnWrapper;\n\n    return (\n      <Wrapper key={index}>\n        {contents}\n      </Wrapper>\n    );\n  };\n\n  const renderGroup = (group: ToolGroupProps, index: number, toolbarMode: ToolbarMode) => {\n    const { layoutMode, hideBorder, clearPadding, fineAdaptation: groupFineAdaptation } = group;\n    const contents = renderToolArray(group, 'toolLines', target, renderLine, layoutMode);\n\n    // 单行默认精细化控制，双行默认按组收缩\n    let realFineAdaption = toolbarMode === ToolbarMode.single;\n    if (groupFineAdaptation !== undefined) {\n      realFineAdaption = groupFineAdaptation;\n    } else if (fineAdaptation !== undefined) {\n      realFineAdaption = fineAdaptation;\n    }\n    if (!contents) return null;\n    return (\n      <GroupWrapper\n        layoutType=\"row\"\n        groupKey={index.toString()}\n        fineAdaptation={realFineAdaption}\n        key={index}\n        hideBorder={hideBorder}\n        clearPadding={clearPadding}\n      >\n        {contents}\n      </GroupWrapper>\n    );\n  };\n\n  const renderSingleToolbar = (singleLineLayout?: ToolLineProps[]) => {\n    const layout = singleLineLayout || ToolbarConfig.defaultSingleLayout;\n    // @ts-ignore\n    const tls = layout.map((line, idx) => {\n      const group = {\n        toolLines: [\n          line,\n        ],\n        hideBorder: false,\n      };\n      if (idx === layout.length - 1) {\n        group.hideBorder = true;\n      }\n      return renderGroup(group, idx, ToolbarMode.single);\n    }).filter(item => item);\n    if (!tls.length) return null;\n    return (\n      <div style={{ display: 'flex' }}>\n        {tls}\n      </div>\n    );\n  };\n\n  /**\n   * 阻止默认事件，防止文档区域失焦\n   */\n  const handleMouseDown = useCallback(ev => {\n    const { activeElement } = window.document;\n\n    // 对于有自定义输入域的不可编辑对象，不阻止其失焦行为\n    if (activeElement && activeElement.closest('[data-cangjie-not-editable]')) {\n      return;\n    }\n\n    if (ev.target?.tagName.toLocaleLowerCase() !== 'input') {\n      // 放过input，以便输入地方可以正常输入\n      ev.preventDefault && ev.preventDefault();\n      ev.stopPropagation && ev.stopPropagation();\n    }\n  }, []);\n\n  const fTgts = disableTargets || ToolbarConfig.defaultDisableTargets;\n  const shouldDisableWholeToolbar = fTgts[target];\n\n  const classes = 'bi-toolbar inline-float';\n  let wrapperStyle: React.CSSProperties = {\n    display: 'flex',\n  };\n  if (shouldDisableWholeToolbar) {\n    wrapperStyle = disabledStyle;\n  }\n\n  const handlePendingSelectionChange = React.useCallback(() => {\n    // 处理 pending 不及时导致的工具栏长度变化的问题\n    if (!_hasTableSelection && controller.query('hasTableSelection')) {\n      forceUpdate();\n    }\n  }, [controller]);\n\n  useSelectionData(controller.selectionData$, null, handlePendingSelectionChange, []);\n\n  return (\n    <ToolbarWrapper\n      style={wrapperStyle}\n      className={classes}\n      onMouseDown={handleMouseDown}\n      ref={toolbarWrapperRef}\n      data-role=\"inlineToolbar\"\n    >\n      {renderSingleToolbar(singleLayout)}\n    </ToolbarWrapper>\n  );\n};\n\nconst MoreMenu = (props: MoreMenuProps) => {\n  const { container, isPureTableSelection } = props;\n  const [moreToolbarActive, setMoreToolbarActive] = useState(false);\n  const plugins = usePlugins();\n  const controller = Controller.useController();\n  const onCutOrCopy = useCallback((action) => {\n    controller.run('onAction', {\n      type: action,\n    });\n  }, []);\n\n  const onClickCut = useCallback(() => {\n    onCutOrCopy(ACTION_CUT);\n  }, [onCutOrCopy]);\n\n  const onClickCopy = useCallback(() => {\n    onCutOrCopy(ACTION_COPY);\n  }, [onCutOrCopy]);\n\n  const onClickDelete = useCallback(() => {\n    controller.command(Commands.del);\n  }, [onCutOrCopy]);\n\n  const insertMenus: any = React.useMemo(() => {\n    // Copy Cut 的文案只有从 draggable 插件来\n    const draggablePlugin = plugins?.hash?.draggable as BiPlugin;\n    const arr = [\n      {\n        type: TYPE_GROUP,\n        menus: [\n          {\n            type: TYPE_MENU_ITEM,\n            menuKey: 'clearStyle',\n            icon: <ToolbarEraserNormal />,\n            autoClose: false,\n          },\n          {\n            type: TYPE_MENU_ITEM,\n            menuKey: 'formatPainter',\n            icon: <ToolbarBrushNormal />,\n            autoClose: false,\n          },\n        ],\n      },\n      {\n        type: TYPE_GROUP,\n        menus: [\n          {\n            type: TYPE_MENU_ITEM,\n            menuKey: 'indent.right',\n            icon: <ToolbarIncreaseIndentNormal />,\n            autoClose: false,\n            extra: genShortcutString('tab'),\n          },\n          {\n            type: TYPE_MENU_ITEM,\n            menuKey: 'indent.left',\n            icon: <ToolbarReduceIndentNormal />,\n            autoClose: false,\n            extra: genShortcutString('shift+tab'),\n          },\n        ],\n      },\n      {\n        type: TYPE_GROUP,\n        menus: [\n          {\n            type: TYPE_MENU_ITEM,\n            title: draggablePlugin?.toolbar?.locale?.copyMenu,\n            icon: <ToolbarCopyNormal />,\n            menuExtraKey: 'copy',\n            onClick: onClickCopy,\n            extra: genShortcutString('mod+c'),\n          },\n          {\n            type: TYPE_MENU_ITEM,\n            title: draggablePlugin?.toolbar?.locale?.cutMenu,\n            icon: <ToolbarCutNormal />,\n            menuExtraKey: 'cut',\n            onClick: onClickCut,\n            extra: genShortcutString('mod+x'),\n          },\n          {\n            type: TYPE_MENU_ITEM,\n            title: draggablePlugin?.toolbar?.locale?.deleteMenu,\n            icon: <ToolbarDeleteNormal />,\n            menuExtraKey: 'delete',\n            onClick: onClickDelete,\n            hidden: isPureTableSelection,\n          },\n        ],\n      }\n    ];\n\n    return arr;\n  }, [onClickCopy, onClickCut, onClickDelete, isPureTableSelection]);\n  return <Dropdown\n    visible={moreToolbarActive}\n    onVisibleChange={(v) => { setMoreToolbarActive(v); }}\n    // 使用 toolbarWrapperRef 作为 Container 可保证整体动画的流畅\n    // 避免主体动画先完成或者后完成\n    getContainer={() => {\n      return container;\n    }}\n    overlayStyle={{\n      backgroundColor: 'transparent',\n      boxShadow: 'none',\n      border: 'none',\n    }}\n    overlay={\n      <DropdownAnimation visible={moreToolbarActive}>\n        <MenuWrapper style={noShadowStyle}>\n          <Menu\n            mode={EMenuMode.vertical}\n            selectedKeys={[]}\n            destroyOverlayWhenInvisible\n            insertSubmenuToMenuRoot\n            style={sizeStyle}\n            onClick={(v) => { setMoreToolbarActive(false) }}\n            getContainer={() => {\n              return container;\n            }}\n          >\n            <MenuAdapter menus={insertMenus} />\n          </Menu>\n        </MenuWrapper>\n      </DropdownAnimation>\n    }\n    placement=\"bottomLeft\"\n    offsetY={2}\n  >\n    <IconButton\n      icon={<ToolbarMoreNormal />}\n      testid=\"toolbar_more\"\n      onClick={() => { setMoreToolbarActive(!moreToolbarActive); }}\n      active={moreToolbarActive}\n    />\n  </Dropdown>\n};\n\nexport default process.env.NODE_ENV === 'test'\n  ? ToolbarRenderNext\n  : idleRender(ToolbarRenderNext, 400, { leading: true });\n"],"file":"inlineFloatToolbar.js"}