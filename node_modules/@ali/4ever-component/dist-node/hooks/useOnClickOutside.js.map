{"version":3,"sources":["../../../src/hooks/useOnClickOutside.ts"],"names":["useOnClickOutside","ref","handler","preventMousedownOutsideEditor","ignore","listener","event","current","contains","target","closest","preventDefault","document","addEventListener","removeEventListener"],"mappings":";;;;;;;AAAA;;AAEe,SAASA,iBAAT,CACbC,GADa,EAEbC,OAFa;AAGb;AACAC,6BAA6B,GAAG,IAJnB,EAKb;AACAC,MANa,EAOb;AACA,wBAAU,MAAM;AACd,UAAMC,QAAQ,GAAGC,KAAK,IAAI;AACxB;AACA,UAAI,CAACL,GAAG,CAACM,OAAL,IAAgBN,GAAG,CAACM,OAAJ,EAAaC,QAAb,CAAsBF,KAAK,CAACG,MAA5B,CAAhB,IAAuDL,MAAM,GAAGE,KAAK,CAACG,MAAT,CAAjE,EAAmF;AACjF;AACD,OAJuB,CAMxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,UACEN,6BAA6B,IAC7BG,KAAK,CAACG,MADN,IAEA,CAACH,KAAK,CAACG,MAAN,CAAaC,OAAb,CAAqB,qBAArB,CAHH,EAIE;AACAJ,QAAAA,KAAK,CAACK,cAAN;AACD;;AACDT,MAAAA,OAAO,CAACI,KAAD,CAAP;AACD,KAvBD;;AAyBAM,IAAAA,QAAQ,CAACC,gBAAT,CAA0B,WAA1B,EAAuCR,QAAvC;AACAO,IAAAA,QAAQ,CAACC,gBAAT,CAA0B,YAA1B,EAAwCR,QAAxC;AAEA,WAAO,MAAM;AACXO,MAAAA,QAAQ,CAACE,mBAAT,CAA6B,WAA7B,EAA0CT,QAA1C;AACAO,MAAAA,QAAQ,CAACE,mBAAT,CAA6B,YAA7B,EAA2CT,QAA3C;AACD,KAHD;AAID,GAjCD,EAiCG,CAACJ,GAAD,EAAMG,MAAN,EAAcF,OAAd,EAAuBC,6BAAvB,CAjCH;AAkCD","sourcesContent":["import { useEffect } from 'react';\n\nexport default function useOnClickOutside(\n  ref: React.RefObject<HTMLElement>,\n  handler: (event: MouseEvent) => void,\n  /** 是否阻止编辑器以外的 mousedown 行为 */\n  preventMousedownOutsideEditor = true,\n  // 有一些场景，要忽略的并非内部元素，比如 toolbar 弹框\n  ignore?: (target: HTMLElement) => boolean,\n) {\n  useEffect(() => {\n    const listener = event => {\n      // 点击自己或者自己的子树，或者 ignore 生效，则忽略\n      if (!ref.current || ref.current?.contains(event.target) || ignore?.(event.target)) {\n        return;\n      }\n\n      // BACKGROUND\n      // 当我们点击外部时，期望能够 focus 回编辑器，此时存在两种情况：\n      // 1. 点击到编辑器\n      // 2. 点击到其他地方\n      // 对于情况 2，其事件流为\n      // mousedown -> blur -> mouseup\n      // mousedown 时，我们的组件可能会通过 handler 调用 focus 逻辑让编辑器重新聚焦\n      // 但后续的 blur 事件又会让编辑器失焦\n      // 因此，在情况 2 下，我们需要阻止默认的 mousedown 行为（阻止了 mousedown 引起 blur），来防止编辑器失焦\n      if (\n        preventMousedownOutsideEditor &&\n        event.target &&\n        !event.target.closest('[data-slate-editor]')\n      ) {\n        event.preventDefault();\n      }\n      handler(event);\n    };\n\n    document.addEventListener('mousedown', listener);\n    document.addEventListener('touchstart', listener);\n\n    return () => {\n      document.removeEventListener('mousedown', listener);\n      document.removeEventListener('touchstart', listener);\n    };\n  }, [ref, ignore, handler, preventMousedownOutsideEditor]);\n}\n"],"file":"useOnClickOutside.js"}