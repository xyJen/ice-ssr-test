{"version":3,"sources":["../../../src/Sidebar/CollapseContent.tsx"],"names":["ContentBox","styled","div","props","maxHeight","PocketBox","Content","fold","animate","style","className","dataName","children","foldRef","React","useRef","contentRef","pocketRef","heightRef","internalFold","setInternalFold","useState","transition","setTransition","handleTransitionEnd","useCallback","useLayoutEffect","current","pocket","offsetHeight","classNames","displayName"],"mappings":";;;;;;;;;;;AACA;;AACA;;AACA;;AAHA;uBAC4B,a;;AAI5B,MAAMA,UAAU,gBAAGC,0BAAOC,GAAV,+JAGGC,KAAD,IAAWA,KAAK,CAACC,SAHnB,CAAhB;;AAmBA,MAAMC,SAAS,gBAAGJ,0BAAOC,GAAV,yOAAf;;AAwBA,MAAMI,OAA+B,GAAIH,KAAD,IAAW;AACjD,QAAM;AACJI,IAAAA,IADI;AAEJC,IAAAA,OAAO,GAAG,IAFN;AAGJC,IAAAA,KAHI;AAIJC,IAAAA,SAJI;AAKJC,IAAAA,QALI;AAMJC,IAAAA;AANI,MAOFT,KAPJ;AASA,QAAMU,OAAO,GAAGC,KAAK,CAACC,MAAN,CAAaR,IAAb,CAAhB;AACA,QAAMS,UAAU,GAAGF,KAAK,CAACC,MAAN,CAA6B,IAA7B,CAAnB;AACA,QAAME,SAAS,GAAGH,KAAK,CAACC,MAAN,CAA6B,IAA7B,CAAlB;AACA,QAAMG,SAAS,GAAGJ,KAAK,CAACC,MAAN,CAAa,CAAb,CAAlB;AACA,QAAM,CAACI,YAAD,EAAeC,eAAf,IAAkCN,KAAK,CAACO,QAAN,CAAed,IAAf,CAAxC;AACA,QAAM,CAACe,UAAD,EAAaC,aAAb,IAA8BT,KAAK,CAACO,QAAN,CAAe,KAAf,CAApC;AAEA;AACF;AACA;;AACE,QAAMG,mBAAmB,GAAGV,KAAK,CAACW,WAAN,CAAkB,MAAM;AAClDF,IAAAA,aAAa,CAAC,KAAD,CAAb;AACD,GAF2B,EAEzB,EAFyB,CAA5B;AAIA;AACF;AACA;;AACET,EAAAA,KAAK,CAACY,eAAN,CAAsB,MAAM;AAC1B,QAAIT,SAAS,CAACU,OAAd,EAAuB;AACrB,YAAMC,MAAM,GAAGX,SAAS,CAACU,OAAzB;AACAT,MAAAA,SAAS,CAACS,OAAV,GAAoBC,MAAM,CAACC,YAA3B;AACD;AACF,GALD;AAOA;AACF;AACA;;AACEf,EAAAA,KAAK,CAACY,eAAN,CAAsB,MAAM;AAC1B,QAAInB,IAAI,KAAKM,OAAO,CAACc,OAArB,EAA8B;AAC5B,UAAInB,OAAJ,EAAa;AACXe,QAAAA,aAAa,CAAC,IAAD,CAAb;AACD,OAFD,MAEO;AACLA,QAAAA,aAAa,CAAC,KAAD,CAAb;AACAH,QAAAA,eAAe,CAACb,IAAD,CAAf;AACD;;AACDM,MAAAA,OAAO,CAACc,OAAR,GAAkBpB,IAAlB;AACD;AACF,GAVD,EAUG,CAACC,OAAD,EAAUD,IAAV,CAVH;AAYA;AACF;AACA;;AACEO,EAAAA,KAAK,CAACY,eAAN,CAAsB,MAAM;AAC1B,QAAIJ,UAAJ,EAAgB;AACdF,MAAAA,eAAe,CAACb,IAAD,CAAf;AACD;AACF,GAJD,EAIG,CAACe,UAAD,EAAaf,IAAb,CAJH;AAMA,QAAMuB,UAAU,GAAG,yBAAW;AAC5BR,IAAAA,UAD4B;AAE5Bf,IAAAA,IAAI,EAAEY;AAFsB,GAAX,CAAnB;AAKA,sBACE,eAAC,UAAD;AACE,IAAA,GAAG,EAAEH,UADP;AAEE,IAAA,SAAS,EAAEc,UAFb;AAGE,IAAA,KAAK,EAAErB,KAHT;AAIE,IAAA,SAAS,EAAES,SAAS,CAACS,OAJvB;AAKE,IAAA,eAAe,EAAEH;AALnB,kBAOE,eAAC,SAAD;AACE,IAAA,GAAG,EAAEP,SADP;AAEE,iBAAWN,QAFb;AAGE,yBAAmBJ,IAHrB;AAIE,IAAA,SAAS,EAAEG;AAJb,KAMGE,QANH,CAPF,CADF;AAkBD,CAjFD;;AAmFAN,OAAO,CAACyB,WAAR,GAAsB,SAAtB;eAEezB,O","sourcesContent":["// 复用的 HeadingGroupPlugin.Content\nimport * as React from 'react';\nimport styled from 'styled-components';\nimport classnames from 'classnames';\n\nconst ContentBox = styled.div<{ maxHeight: number }>`\n\n  &.transition {\n    max-height: ${(props) => props.maxHeight}px;\n    transition: all 0.2s ease-in-out;\n    overflow: hidden;\n\n    &.fold {\n      display: block;\n    }\n  }\n\n  &.fold {\n    max-height: 0;\n    overflow: hidden;\n    display: none;\n  }\n`;\n\nconst PocketBox = styled.div`\n  /* https://aone.alibaba-inc.com/v2/bug/36003865# 《标题收起展开会出现跳动》 */\n  :first-child > [data-cangjie-leaf-block] > * {\n    margin-top: 0 !important;\n  }\n  & > :first-child > [data-name=\"heading-group-title\"] > [data-name=\"heading-group-title-content\"] > [data-cangjie-leaf-block] > * {\n    margin-top: 0 !important;\n  }\n`;\n\nexport interface ContentProps {\n  /**\n   * 折叠状态\n   */\n  fold: boolean;\n  /**\n   * 是否执行动画\n   */\n  animate?: boolean;\n  style?: React.CSSProperties;\n  className?: string;\n  dataName?: string;\n}\n\nconst Content: React.FC<ContentProps> = (props) => {\n  const {\n    fold,\n    animate = true,\n    style,\n    className,\n    dataName,\n    children,\n  } = props;\n\n  const foldRef = React.useRef(fold);\n  const contentRef = React.useRef<HTMLDivElement>(null);\n  const pocketRef = React.useRef<HTMLDivElement>(null);\n  const heightRef = React.useRef(0);\n  const [internalFold, setInternalFold] = React.useState(fold);\n  const [transition, setTransition] = React.useState(false);\n\n  /**\n   * 动画结束后移除动画类名\n   */\n  const handleTransitionEnd = React.useCallback(() => {\n    setTransition(false);\n  }, []);\n\n  /**\n   * 每次更新后刷新内容高度\n   */\n  React.useLayoutEffect(() => {\n    if (pocketRef.current) {\n      const pocket = pocketRef.current;\n      heightRef.current = pocket.offsetHeight;\n    }\n  });\n\n  /**\n   * 折叠状态发生变化时，先开启 transition，再变更状态\n   */\n  React.useLayoutEffect(() => {\n    if (fold !== foldRef.current) {\n      if (animate) {\n        setTransition(true);\n      } else {\n        setTransition(false);\n        setInternalFold(fold);\n      }\n      foldRef.current = fold;\n    }\n  }, [animate, fold]);\n\n  /**\n   * 开启 transition 后变更 fold 状态\n   */\n  React.useLayoutEffect(() => {\n    if (transition) {\n      setInternalFold(fold);\n    }\n  }, [transition, fold]);\n\n  const classNames = classnames({\n    transition,\n    fold: internalFold,\n  });\n\n  return (\n    <ContentBox\n      ref={contentRef}\n      className={classNames}\n      style={style}\n      maxHeight={heightRef.current}\n      onTransitionEnd={handleTransitionEnd}\n    >\n      <PocketBox\n        ref={pocketRef}\n        data-name={dataName}\n        data-heading-fold={fold}\n        className={className}\n      >\n        {children}\n      </PocketBox>\n    </ContentBox>\n  );\n};\n\nContent.displayName = 'Content';\n\nexport default Content;\n"],"file":"CollapseContent.js"}