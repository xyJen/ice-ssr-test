{"version":3,"sources":["../../../src/Menu/utils.ts"],"names":["checkIsQuery","query","key","Array","isArray","filter","val","toLowerCase","length","checkIsInclude","isInclude","priority","pos","indexOf","filterMenuByQuery","menus","map","item","type","TYPE_GROUP","TYPE_SUB_MENU","itemMenus","TYPE_MENU_ITEM","itemQuery","sort","a","b"],"mappings":"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","sourcesContent":["/* eslint-disable no-case-declarations */\nimport {\n  TYPE_MENU_DATA,\n  TYPE_MENU_ITEM,\n  TYPE_SUB_MENU,\n  TYPE_GROUP,\n  SubMenuProps,\n  MenuItemProps,\n} from './interface';\n\nfunction checkIsQuery(query: string, key: string | string[]) {\n  if (Array.isArray(key)) {\n    return key.filter((val) => val.toLowerCase() === query.toLowerCase()).length > 0;\n  } else {\n    return key.toLowerCase() === query.toLowerCase();\n  }\n}\n\nfunction checkIsInclude(query: string, key: string | string[]) {\n  let isInclude: boolean;\n  let priority: number;\n  if (Array.isArray(key)) {\n    // 获取匹配度最高的值\n    isInclude = key.filter((val) => {\n      const pos = val.toLowerCase().indexOf(query.toLowerCase());\n      if (pos > -1) {\n        // 记录下匹配值最高的query\n        if (!priority || priority < 10 - pos) {\n          priority = 10 - pos;\n        }\n        return true;\n      }\n      return false;\n    }).length > 0;\n  } else {\n    const pos = key.toLowerCase().indexOf(query.toLowerCase());\n    isInclude = pos > -1;\n    if (isInclude) {\n      priority = 10 - pos;\n    }\n  }\n  return {\n    isInclude,\n    // @ts-ignore\n    priority,\n  };\n}\n\nexport const filterMenuByQuery = (query: string, menus: TYPE_MENU_DATA) => {\n  /**\n   * 1.全字匹配，优先级定10；2.匹配部分，根据匹配词的index分配优先级，10-index；\n   * 优先级决定了group的排序\n   */\n  if (!menus) return [];\n  return menus.map(((item) => {\n    const { type } = item;\n    switch (type) {\n      case TYPE_GROUP:\n      case TYPE_SUB_MENU:\n        let itemMenus = (item as SubMenuProps).menus;\n        if (itemMenus) {\n          // @ts-ignore\n          itemMenus = filterMenuByQuery(query, itemMenus);\n          if (itemMenus.length > 0) {\n            return {\n              ...item,\n              menus: itemMenus,\n              // @ts-ignore\n              priority: itemMenus[0].priority,\n            };\n          }\n        }\n        return null;\n      case TYPE_MENU_ITEM:\n        // 这里计算权重和筛选\n        const itemQuery = (item as MenuItemProps).query;\n        if (itemQuery) {\n          if (checkIsQuery(query, itemQuery)) {\n            return {\n              ...item,\n              priority: 10,\n            };\n          }\n          const { isInclude, priority } = checkIsInclude(query, itemQuery);\n          if (isInclude) {\n            return {\n              ...item,\n              priority,\n            };\n          }\n        }\n        return null;\n      default:\n        return null;\n    }\n  }))\n    .filter((item) => !!item)\n    .sort((a, b) => {\n      return b?.priority - a?.priority;\n    });\n};\n"],"file":"utils.js"}