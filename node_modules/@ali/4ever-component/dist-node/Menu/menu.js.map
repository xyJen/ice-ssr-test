{"version":3,"sources":["../../../src/Menu/menu.tsx"],"names":["checkIfNotAllChildrenHidden","menu","menus","some","item","type","TYPE_SUB_MENU","TYPE_GROUP","hidden","inlineToBlockMap","Map","convertInlineMenus","map","TYPE_INLINE_MENU_GROUP","items","forEach","wrapper","TYPE_INLINE_MENU_WRAPPER","inline","menuKey","tooltip","pluginName","menuName","split","key","get","push","TYPE_MENU_ITEM","title","isNotMenuItem","maybeWrapper","convertMenusToMatcherData","keywords","query","Array","isArray","data","subItems","convertMatcherDataToMenus","MenuAdapter","props","onQuery","controller","Controller","useController","plugins","matcher","React","useMemo","result","matcherData","Matcher","lang","enableFuzzy","menuData","results","match","notNullMenuCount","getMenuFromPlugin","defaultMenuName","PluginMenu","locale","plugin","hash","menubar","renderMenuItem","menuExtraKey","rest","renderInlineMenuItem","icon","renderInlineMenuGroup","index","menuGroupData","shouldShowDivider","renderMenus","renderInlineMenuWrapper","menuWrapperData","renderSubMenu","subMenuData","menusView","filter","view","length","renderMenuGroup","renderMenu","TYPE_INLINE_MENU_ITEM","TYPE_QUERY_ONLY_INLINE_MENU_ITEM","console","warn","menuView"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AACA;;AAQA;;AACA;;AAEA;;AAmBA;;AACA;;uBAhC4B,a;;AAkC5B,MAAMA,2BAA2B,GAAIC,IAAD,IAAkD;AACpF,QAAM;AAAEC,IAAAA;AAAF,MAAYD,IAAlB;AAEA,SAAOC,KAAK,CAACC,IAAN,CAAYC,IAAD,IAAU;AAC1B,QAAIA,IAAI,KAAKA,IAAI,CAACC,IAAL,KAAcC,wBAAd,IAA+BF,IAAI,CAACC,IAAL,KAAcE,qBAAlD,CAAR,EAAuE;AACrE,aAAOP,2BAA2B,CAACI,IAAD,CAAlC;AACD;;AACD,WAAOA,IAAI,IAAI,CAAEA,IAAD,CAAwBI,MAAxC;AACD,GALM,CAAP;AAMD,CATD;;AAWA,MAAMC,gBAAgB,GAAG,IAAIC,GAAJ,CAAQ,CAC/B,CAAC,gBAAD,EAAmB,UAAnB,CAD+B,EAE/B,CAAC,gBAAD,EAAmB,UAAnB,CAF+B,EAG/B,CAAC,gBAAD,EAAmB,UAAnB,CAH+B,EAI/B,CAAC,gBAAD,EAAmB,UAAnB,CAJ+B,EAK/B,CAAC,aAAD,EAAgB,OAAhB,CAL+B,EAM/B,CAAC,aAAD,EAAgB,OAAhB,CAN+B,EAO/B,CAAC,aAAD,EAAgB,OAAhB,CAP+B,CAAR,CAAzB;;AAUA,MAAMC,kBAAkB,GAAIT,KAAD,IAA2B;AACpD,SAAOA,KAAK,CAACU,GAAN,CAAWR,IAAD,IAAU;AACzB,QAAIA,IAAI,CAACC,IAAL,KAAcQ,iCAAlB,EAA0C;AACxC,YAAMC,KAAsB,GAAG,EAA/B;AACAV,MAAAA,IAAI,CAACF,KAAL,CAAWa,OAAX,CAAoBC,OAAD,IAAa;AAC9B,YAAIA,OAAO,CAACX,IAAR,KAAiBY,mCAArB,EAA+C;AAC5CD,UAAAA,OAAD,CAAoCd,KAApC,CAA0Ca,OAA1C,CAAmDG,MAAD,IAAY;AAC5D,kBAAM;AAAEC,cAAAA,OAAF;AAAWC,cAAAA;AAAX,gBAAuBF,MAA7B;AACA,kBAAM,CAACG,UAAD,EAAaC,QAAb,IAAyBH,OAAO,CAACI,KAAR,CAAc,GAAd,CAA/B;AACA,gBAAIC,GAAG,GAAGL,OAAV;;AACA,gBAAIG,QAAJ,EAAc;AACZE,cAAAA,GAAG,GAAI,GAAEH,UAAW,IAAGZ,gBAAgB,CAACgB,GAAjB,CAAqBH,QAArB,KAAkCA,QAAS,EAAlE;AACD;;AACDR,YAAAA,KAAK,CAACY,IAAN,CAAW,EACT,GAAGR,MADM;AAETb,cAAAA,IAAI,EAAEsB,yBAFG;AAGTR,cAAAA,OAAO,EAAEK,GAHA;AAITI,cAAAA,KAAK,EAAER;AAJE,aAAX;AAMD,WAbD;AAcD;AACF,OAjBD;AAkBA,aAAO;AACLf,QAAAA,IAAI,EAAEE,qBADD;AAELL,QAAAA,KAAK,EAAEY;AAFF,OAAP;AAID;;AACD,WAAOV,IAAP;AACD,GA3BM,CAAP;AA4BD,CA7BD;;AA+BA,SAASyB,aAAT,CAAuBC,YAAvB,EAA0F;AACxF,SAAOA,YAAY,CAAC5B,KAApB;AACD;;AAED,MAAM6B,yBAAyB,GAAI7B,KAAD,IAA2B;AAC3D,SAAQA,KAAD,CAAeU,GAAf,CAAoBR,IAAD,IAAyD;AACjF,QAAI4B,QAAkB,GAAG,EAAzB;;AACA,QAAI5B,IAAI,CAAC6B,KAAT,EAAgB;AACd,UAAIC,KAAK,CAACC,OAAN,CAAc/B,IAAI,CAAC6B,KAAnB,CAAJ,EAA+B;AAC7BD,QAAAA,QAAQ,GAAG,CAAC,GAAG5B,IAAI,CAAC6B,KAAT,CAAX;AACD,OAFD,MAEO;AACLD,QAAAA,QAAQ,CAACN,IAAT,CAActB,IAAI,CAAC6B,KAAnB;AACD;AACF;;AACD,QAAIJ,aAAa,CAACzB,IAAD,CAAjB,EAAyB;AACvB,aAAO;AACL4B,QAAAA,QADK;AAELI,QAAAA,IAAI,EAAE,EACJ,GAAG,kBAAKhC,IAAL,EAAW,OAAX;AADC,SAFD;AAKLiC,QAAAA,QAAQ,EAAEN,yBAAyB,CAAC3B,IAAI,CAACF,KAAN;AAL9B,OAAP;AAOD;;AACD,WAAO;AACL8B,MAAAA,QADK;AAELI,MAAAA,IAAI,EAAE,EACJ,GAAGhC;AADC;AAFD,KAAP;AAMD,GAxBM,CAAP;AAyBD,CA1BD;;AA4BA,MAAMkC,yBAAyB,GAAIxB,KAAD,IAAW;AAC3C,SAAOA,KAAK,CAACF,GAAN,CAAWR,IAAD,IAAU;AACzB,QAAIA,IAAI,CAACiC,QAAT,EAAmB;AACjB,aAAO,EACL,GAAGjC,IAAI,CAACgC,IADH;AAELlC,QAAAA,KAAK,EAAEoC,yBAAyB,CAAClC,IAAI,CAACiC,QAAN;AAF3B,OAAP;AAID;;AACD,WAAOjC,IAAI,CAACgC,IAAZ;AACD,GARM,CAAP;AASD,CAVD;;wBA+I6B,eAAC,qBAAD,O;;yBAiFA,eAAC,qBAAD,O;;AApN7B,MAAMG,WAAgC,GAAIC,KAAD,IAAW;AAClD,QAAM;AACJtC,IAAAA,KADI;AAEJ+B,IAAAA,KAFI;AAGJQ,IAAAA;AAHI,MAIFD,KAJJ,CADkD,CAOlD;;AACA,QAAME,UAAU,GAAGC,wBAAWC,aAAX,EAAnB;;AACA,QAAMC,OAAO,GAAG,iCAAhB,CATkD,CAUlD;;AACA,QAAMC,OAAgB,GAAGC,eAAMC,OAAN,CAAc,MAAM;AAC3C;AACA,UAAMC,MAAM,GAAGtC,kBAAkB,CAACT,KAAD,CAAjC;AACA,UAAMgD,WAAW,GAAGnB,yBAAyB,CAACkB,MAAD,CAA7C;AACA,WAAO,IAAIE,kBAAJ,CAAY;AACjBC,MAAAA,IAAI,EAAE,OADW;AAEjBtC,MAAAA,KAAK,EAAEoC,WAFU;AAGjBG,MAAAA,WAAW,EAAE;AAHI,KAAZ,CAAP;AAKD,GATwB,EAStB,CAACnD,KAAD,CATsB,CAAzB;;AAWA,QAAMoD,QAAQ,GAAGP,eAAMC,OAAN,CAAc,MAAM;AACnC,QAAI,CAACf,KAAD,IAAU,CAACa,OAAf,EAAwB,OAAO5C,KAAP;AACxB,UAAMqD,OAAO,GAAGT,OAAO,CAACU,KAAR,CAAcvB,KAAd,CAAhB;AACAQ,IAAAA,OAAO,GAAGc,OAAH,CAAP;AACA,WAAOjB,yBAAyB,CAACiB,OAAD,CAAhC;AACD,GALgB,EAKd,CAACtB,KAAD,EAAQ/B,KAAR,EAAe4C,OAAf,EAAwBL,OAAxB,CALc,CAAjB;;AAOA,MAAIgB,gBAAgB,GAAG,CAAvB;AAEA;AACF;AACA;AACA;;AACE,QAAMC,iBAAiB,GAAG,CAACzD,IAAD,EAA2D0D,eAAe,GAAG,MAA7E,KAAwF;AAChH,UAAM;AAAExC,MAAAA;AAAF,QAAclB,IAApB;;AACA,QAAI,CAACkB,OAAL,EAAc;AACZ,aAAO;AACLyC,QAAAA,UAAU,EAAE,IADP;AAELC,QAAAA,MAAM,EAAE;AAFH,OAAP;AAID;;AAED,UAAM,CAACxC,UAAD,EAAaC,QAAQ,GAAGqC,eAAxB,IAA2CxC,OAAO,CAACI,KAAR,CAAc,GAAd,CAAjD;AACA,UAAMuC,MAA4B,GAAGjB,OAAO,EAAEkB,IAAT,CAAc1C,UAAd,CAArC;AACA,QAAIuC,UAAJ;;AACA,QAAIE,MAAM,IAAIA,MAAM,CAACE,OAAjB,IAA4BF,MAAM,CAACE,OAAP,CAAe1C,QAAf,CAAhC,EAA0D;AACxDsC,MAAAA,UAAU,GAAGE,MAAM,CAACE,OAAP,CAAe1C,QAAf,CAAb;AACD;;AAED,WAAO;AACLsC,MAAAA,UADK;AAELC,MAAAA,MAAM,EAAEC,MAAM,EAAEE,OAAR,EAAiBH,MAAjB,IAA2B;AAF9B,KAAP;AAID,GApBD;AAsBA;AACF;AACA;AACA;;;AACE,QAAMI,cAAc,GAAIhE,IAAD,IAAyB;AAC9C,UAAM;AACJ2B,MAAAA,KADI;AAEJpB,MAAAA,MAFI;AAGJ0D,MAAAA,YAAY,GAAG,EAHX;AAIJ/C,MAAAA,OAJI;AAKJ,SAAGgD;AALC,QAMFlE,IANJ;AAOA,QAAIO,MAAJ,EAAY,OAAO,IAAP;AAEZiD,IAAAA,gBAAgB,IAAI,CAApB;AAEA,UAAM;AAAEG,MAAAA,UAAF;AAAcC,MAAAA;AAAd,QAAyBH,iBAAiB,CAACzD,IAAD,CAAhD,CAZ8C,CAa9C;;AACA,UAAMuB,GAAG,GAAGL,OAAO,GAAG+C,YAAtB;;AACA,QAAIN,UAAJ,EAAgB;AACd,0BACE,eAAC,UAAD;AACE,QAAA,GAAG,EAAEpC,GADP;AAEE,QAAA,UAAU,EAAEkB,UAFd;AAGE,QAAA,QAAQ,EAAE,EACR,GAAGzC,IADK;AAERkB,UAAAA,OAAO,EAAEK;AAFD,SAHZ;AAOE,QAAA,MAAM,EAAEqC;AAPV,QADF;AAUD;;AAED,wBACE,eAAC,kBAAD,6BAAcM,IAAd;AAAoB,MAAA,GAAG,EAAE3C,GAAzB;AAA8B,MAAA,OAAO,EAAEA;AAAvC,QACGI,KADH,CADF;AAKD,GAjCD;;AAmCA,QAAMwC,oBAAoB,GAAInE,IAAD,IAA+B;AAC1D,UAAM;AAAEO,MAAAA,MAAF;AAAUW,MAAAA,OAAV;AAAmB+C,MAAAA,YAAY,GAAG,EAAlC;AAAsCG,MAAAA,IAAtC;AAA4C,SAAGF;AAA/C,QAAwDlE,IAA9D;AACA,QAAIO,MAAJ,EAAY,OAAO,IAAP;AACZiD,IAAAA,gBAAgB,IAAI,CAApB;AACA,UAAM;AAAEG,MAAAA,UAAF;AAAcC,MAAAA;AAAd,QAAyBH,iBAAiB,CAACzD,IAAD,EAAO,YAAP,CAAhD;AACA,UAAMuB,GAAG,GAAGL,OAAO,GAAG+C,YAAtB;;AAEA,QAAIN,UAAJ,EAAgB;AACd,0BACE,eAAC,UAAD;AACE,QAAA,GAAG,EAAEpC,GADP;AAEE,QAAA,UAAU,EAAEkB,UAFd;AAGE,QAAA,QAAQ,EAAE,EACR,GAAGzC,IADK;AAERkB,UAAAA,OAAO,EAAEK;AAFD,SAHZ;AAOE,QAAA,MAAM,EAAEqC;AAPV,QADF;AAWD,KAnByD,CAoB1D;;;AACA,wBAAO,eAAC,wBAAD,6BAAoBM,IAApB;AAA0B,MAAA,GAAG,EAAE3C,GAA/B;AAAoC,MAAA,OAAO,EAAEA;AAA7C,OAAP;AACD,GAtBD;;AAwBA,QAAM8C,qBAAqB,GAAG,CAACrE,IAAD,EAA6BsE,KAA7B,KAA+C;AAC3E,UAAM;AACJ3C,MAAAA,KADI;AAEJpB,MAAAA,MAFI;AAGJN,MAAAA,KAAK,EAAEsE;AAHH,QAIFvE,IAJJ;AAKA,QAAIO,MAAJ,EAAY,OAAO,IAAP;AAEZ,UAAMiE,iBAAiB,GAAGF,KAAK,KAAK,CAAV,IAAed,gBAAgB,IAAI,CAA7D;AACA,wBACE,eAAC,cAAD,CAAO,QAAP;AAAgB,MAAA,GAAG,EAAEc;AAArB,OACGE,iBAAiB,UAAqB,IADzC,eAEE,eAAC,6BAAD;AAAqB,MAAA,KAAK,EAAE7C;AAA5B,OACG8C,WAAW,CAACF,aAAD,CADd,CAFF,CADF;AAQD,GAjBD;;AAmBA,QAAMG,uBAAuB,GAAG,CAAC1E,IAAD,EAA+BsE,KAA/B,KAAiD;AAC/E,UAAM;AACJrE,MAAAA,KAAK,EAAE0E;AADH,QAEF3E,IAFJ;AAGA,wBACE,eAAC,wBAAD;AAAmB,MAAA,GAAG,EAAEsE;AAAxB,OACGG,WAAW,CAACE,eAAD,CADd,CADF;AAKD,GATD;AAWA;AACF;AACA;AACA;AACA;;;AACE,QAAMC,aAAa,GAAG,CAAC5E,IAAD,EAAqBsE,KAArB,KAAuC;AAC3D,UAAM;AACJ3C,MAAAA,KADI;AAEJpB,MAAAA,MAFI;AAGJN,MAAAA,KAAK,EAAE4E,WAHH;AAIJ,SAAGX;AAJC,QAKFlE,IALJ;AAMA,QAAIO,MAAM,IAAI,CAACR,2BAA2B,CAACC,IAAD,CAA1C,EAAkD,OAAO,IAAP;AAElD,UAAM;AAAE2D,MAAAA,UAAF;AAAcC,MAAAA;AAAd,QAAyBH,iBAAiB,CAACzD,IAAD,CAAhD;;AACA,QAAI2D,UAAJ,EAAgB;AACd,0BACE,eAAC,UAAD;AACE,QAAA,GAAG,EAAE3D,IAAI,CAACkB,OADZ;AAEE,QAAA,UAAU,EAAEuB,UAFd;AAGE,QAAA,QAAQ,EAAEzC,IAHZ;AAIE,QAAA,MAAM,EAAE4D;AAJV,QADF;AAOD;;AAED,UAAMkB,SAAS,GAAGL,WAAW,CAACI,WAAW,IAAI,EAAhB,CAA7B;;AAEA,QAAI7C,KAAK,KAAK,CAAC8C,SAAD,IAAcA,SAAS,CAACC,MAAV,CAAkBC,IAAD,IAAU,CAAC,CAACA,IAA7B,EAAmCC,MAAnC,KAA8C,CAAjE,CAAT,EAA8E;AAC5E,aAAO,IAAP;AACD;;AAED,wBACE,eAAC,iBAAD,6BAAaf,IAAb;AAAmB,MAAA,KAAK,EAAEvC,KAA1B;AAAiC,MAAA,GAAG,EAAE3B,IAAI,CAACkB,OAAL,IAAgBoD;AAAtD,QACGQ,SADH,CADF;AAKD,GA/BD;AAiCA;AACF;AACA;AACA;AACA;;;AACE,QAAMI,eAAe,GAAG,CAAClF,IAAD,EAAuBsE,KAAvB,KAAyC;AAC/D,UAAM;AACJ3C,MAAAA,KADI;AAEJpB,MAAAA,MAFI;AAGJN,MAAAA,KAAK,EAAEsE,aAHH;AAIJ,SAAGL;AAJC,QAKFlE,IALJ;AAMA,QAAIO,MAAM,IAAI,CAACR,2BAA2B,CAACC,IAAD,CAA1C,EAAkD,OAAO,IAAP;AAClD,UAAMwE,iBAAiB,GAAGF,KAAK,KAAK,CAAV,IAAed,gBAAgB,IAAI,CAA7D;AAEA,UAAMsB,SAAS,GAAGL,WAAW,CAACF,aAAD,CAA7B,CAV+D,CAY/D;;AACA,QAAIvC,KAAK,KAAK,CAAC8C,SAAD,IAAcA,SAAS,CAACC,MAAV,CAAkBC,IAAD,IAAU,CAAC,CAACA,IAA7B,EAAmCC,MAAnC,KAA8C,CAAjE,CAAT,EAA8E;AAC5E,aAAO,IAAP;AACD;;AAED,wBACE,eAAC,cAAD,CAAO,QAAP;AAAgB,MAAA,GAAG,EAAEX;AAArB,OACGE,iBAAiB,WAAqB,IADzC,eAEE,eAAC,uBAAD,6BAAmBN,IAAnB;AAAyB,MAAA,KAAK,EAAEvC,KAAK,IAAI;AAAzC,QACGmD,SADH,CAFF,CADF;AAQD,GAzBD;;AA2BA,QAAMK,UAAU,GAAG,CAAChF,IAAD,EAAuBmE,KAAvB,KAAyC;AAC1D,QAAI,CAACnE,IAAL,EAAW,OAAO,IAAP;AACX,UAAM;AAAEC,MAAAA;AAAF,QAAWD,IAAjB;;AAEA,YAAQC,IAAR;AACE,WAAKE,qBAAL;AACE,eAAO4E,eAAe,CAAC/E,IAAD,EAAyBmE,KAAzB,CAAtB;;AACF,WAAK1D,iCAAL;AACE,eAAOyD,qBAAqB,CAAClE,IAAD,EAA+BmE,KAA/B,CAA5B;;AACF,WAAKtD,mCAAL;AACE,eAAO0D,uBAAuB,CAACvE,IAAD,EAAiCmE,KAAjC,CAA9B;;AACF,WAAKjE,wBAAL;AACE,eAAOuE,aAAa,CAACzE,IAAD,EAAuBmE,KAAvB,CAApB;;AACF,WAAK5C,yBAAL;AACE,eAAOsC,cAAc,CAAC7D,IAAD,CAArB;;AACF,WAAKiF,gCAAL;AACE,eAAOjB,oBAAoB,CAAChE,IAAD,CAA3B;;AACF,WAAKkF,2CAAL;AACE;AACA,eAAO,IAAP;;AACF;AACEC,QAAAA,OAAO,CAACC,IAAR,CAAc,eAAcnF,IAAK,uEAAjC;AACA,eAAO,IAAP;AAlBJ;AAoBD,GAxBD;;AA0BA,QAAMqE,WAAW,GAAItC,IAAD,IAA0B;AAC5C,QAAI,CAACA,IAAL,EAAW,OAAO,IAAP;AACX,WAAOA,IAAI,CAACxB,GAAL,CAASwE,UAAT,CAAP;AACD,GAHD,CAtPkD,CA2PlD;;;AACA,QAAMK,QAAQ,GAAGf,WAAW,CAACpB,QAAD,CAA5B;;AAEA,MAAIrB,KAAK,KAAK,CAACwD,QAAD,IAAaA,QAAQ,CAACT,MAAT,CAAiB5E,IAAD,IAAUA,IAA1B,EAAgC8E,MAAhC,KAA2C,CAA7D,CAAT,EAA0E;AACxE,WAAO,IAAP;AACD;;AAED,sBACE,8CACGO,QADH,CADF;AAKD,CAvQD;;eAyQelD,W","sourcesContent":["import React from 'react';\nimport { BiPlugin, Controller } from '@ali/4ever-cangjie';\nimport {\n  SubMenu,\n  MenuItemGroup,\n  MenuItem,\n  MenuDivider,\n  InlineMenuItem,\n  InlineMenuItemGroup,\n} from '@ali/we-design';\nimport { Matcher } from '@ali/4ever-utils';\nimport { omit } from 'lodash-es';\n\nimport {\n  TYPE_MENU_DATA,\n  TYPE_MENU_ITEM,\n  TYPE_SUB_MENU,\n  MENU_ITEM_TYPE,\n  TYPE_GROUP,\n  MenuProps,\n  MenuGroupProps,\n  SubMenuProps,\n  MenuItemProps,\n  TYPE_INLINE_MENU_ITEM,\n  TYPE_INLINE_MENU_GROUP,\n  TYPE_INLINE_MENU_WRAPPER,\n  InlineMenuItemProps,\n  InlineMenuGroupProps,\n  InlineMenuWrapperProps,\n  TYPE_QUERY_ONLY_INLINE_MENU_ITEM,\n} from './interface';\n\nimport { InlineMenuWrapper } from './style';\nimport { usePlugins } from '../PluginsContext';\n\nconst checkIfNotAllChildrenHidden = (menu: SubMenuProps | MenuGroupProps): boolean => {\n  const { menus } = menu;\n\n  return menus.some((item) => {\n    if (item && (item.type === TYPE_SUB_MENU || item.type === TYPE_GROUP)) {\n      return checkIfNotAllChildrenHidden(item);\n    }\n    return item && !(item as MenuItemProps).hidden;\n  });\n};\n\nconst inlineToBlockMap = new Map([\n  ['heading1Inline', 'heading1'],\n  ['heading2Inline', 'heading2'],\n  ['heading3Inline', 'heading3'],\n  ['heading4Inline', 'heading4'],\n  ['tlistInline', 'tlist'],\n  ['olistInline', 'olist'],\n  ['ulistInline', 'ulist'],\n]);\n\nconst convertInlineMenus = (menus: TYPE_MENU_DATA) => {\n  return menus.map((item) => {\n    if (item.type === TYPE_INLINE_MENU_GROUP) {\n      const items: MenuItemProps[] = [];\n      item.menus.forEach((wrapper) => {\n        if (wrapper.type === TYPE_INLINE_MENU_WRAPPER) {\n          (wrapper as InlineMenuWrapperProps).menus.forEach((inline) => {\n            const { menuKey, tooltip } = inline;\n            const [pluginName, menuName] = menuKey.split('.');\n            let key = menuKey;\n            if (menuName) {\n              key = `${pluginName}.${inlineToBlockMap.get(menuName) || menuName}`;\n            }\n            items.push({\n              ...inline,\n              type: TYPE_MENU_ITEM,\n              menuKey: key,\n              title: tooltip,\n            });\n          });\n        }\n      });\n      return {\n        type: TYPE_GROUP,\n        menus: items,\n      };\n    }\n    return item;\n  }) as TYPE_MENU_DATA;\n};\n\nfunction isNotMenuItem(maybeWrapper: any): maybeWrapper is (MenuGroupProps| SubMenuProps) {\n  return maybeWrapper.menus;\n}\n\nconst convertMenusToMatcherData = (menus: TYPE_MENU_DATA) => {\n  return (menus as any).map((item: MenuItemProps | MenuGroupProps | SubMenuProps) => {\n    let keywords: string[] = [];\n    if (item.query) {\n      if (Array.isArray(item.query)) {\n        keywords = [...item.query];\n      } else {\n        keywords.push(item.query);\n      }\n    }\n    if (isNotMenuItem(item)) {\n      return {\n        keywords,\n        data: {\n          ...omit(item, 'menus'),\n        },\n        subItems: convertMenusToMatcherData(item.menus),\n      };\n    }\n    return {\n      keywords,\n      data: {\n        ...item,\n      },\n    };\n  });\n};\n\nconst convertMatcherDataToMenus = (items) => {\n  return items.map((item) => {\n    if (item.subItems) {\n      return {\n        ...item.data,\n        menus: convertMatcherDataToMenus(item.subItems),\n      };\n    }\n    return item.data;\n  });\n};\n\nconst MenuAdapter: React.FC<MenuProps> = (props) => {\n  const {\n    menus,\n    query,\n    onQuery,\n  } = props;\n\n  // TODO: 这里依赖父级Provider，后续有不依赖编辑器的纯menu场景需要兼容\n  const controller = Controller.useController();\n  const plugins = usePlugins();\n  // 初始化搜索工具\n  const matcher: Matcher = React.useMemo(() => {\n    // 有query先转化掉inlineMenu\n    const result = convertInlineMenus(menus);\n    const matcherData = convertMenusToMatcherData(result);\n    return new Matcher({\n      lang: 'en-US',\n      items: matcherData,\n      enableFuzzy: true,\n    });\n  }, [menus]);\n\n  const menuData = React.useMemo(() => {\n    if (!query || !matcher) return menus;\n    const results = matcher.match(query);\n    onQuery?.(results);\n    return convertMatcherDataToMenus(results);\n  }, [query, menus, matcher, onQuery]);\n\n  let notNullMenuCount = 0;\n\n  /**\n   * 从插件中获取menu组件\n   * @param menu\n   */\n  const getMenuFromPlugin = (menu: MenuItemProps | SubMenuProps | InlineMenuItemProps, defaultMenuName = 'menu') => {\n    const { menuKey } = menu;\n    if (!menuKey) {\n      return {\n        PluginMenu: null,\n        locale: {},\n      };\n    }\n\n    const [pluginName, menuName = defaultMenuName] = menuKey.split('.');\n    const plugin: BiPlugin | undefined = plugins?.hash[pluginName] as any;\n    let PluginMenu;\n    if (plugin && plugin.menubar && plugin.menubar[menuName]) {\n      PluginMenu = plugin.menubar[menuName];\n    }\n\n    return {\n      PluginMenu,\n      locale: plugin?.menubar?.locale || {},\n    };\n  };\n\n  /**\n   * 渲染菜单项\n   * @param menu\n   */\n  const renderMenuItem = (menu: MenuItemProps) => {\n    const {\n      title,\n      hidden,\n      menuExtraKey = '',\n      menuKey,\n      ...rest\n    } = menu;\n    if (hidden) return null;\n\n    notNullMenuCount += 1;\n\n    const { PluginMenu, locale } = getMenuFromPlugin(menu);\n    // 通过 menuExtraKey 可实现多个相同功能 menuItem 共存\n    const key = menuKey + menuExtraKey;\n    if (PluginMenu) {\n      return (\n        <PluginMenu\n          key={key}\n          controller={controller}\n          menuItem={{\n            ...menu,\n            menuKey: key,\n          }}\n          locale={locale}\n        />);\n    }\n\n    return (\n      <MenuItem {...rest} key={key} menuKey={key}>\n        {title}\n      </MenuItem>\n    );\n  };\n\n  const renderInlineMenuItem = (menu: InlineMenuItemProps) => {\n    const { hidden, menuKey, menuExtraKey = '', icon, ...rest } = menu;\n    if (hidden) return null;\n    notNullMenuCount += 1;\n    const { PluginMenu, locale } = getMenuFromPlugin(menu, 'inlineMenu');\n    const key = menuKey + menuExtraKey;\n\n    if (PluginMenu) {\n      return (\n        <PluginMenu\n          key={key}\n          controller={controller}\n          menuItem={{\n            ...menu,\n            menuKey: key,\n          }}\n          locale={locale}\n        />\n      );\n    }\n    // @ts-ignore\n    return <InlineMenuItem {...rest} key={key} menuKey={key} />;\n  };\n\n  const renderInlineMenuGroup = (menu: InlineMenuGroupProps, index: number) => {\n    const {\n      title,\n      hidden,\n      menus: menuGroupData,\n    } = menu;\n    if (hidden) return null;\n\n    const shouldShowDivider = index !== 0 && notNullMenuCount >= 1;\n    return (\n      <React.Fragment key={index}>\n        {shouldShowDivider ? <MenuDivider /> : null}\n        <InlineMenuItemGroup title={title}>\n          {renderMenus(menuGroupData as TYPE_MENU_DATA)}\n        </InlineMenuItemGroup>\n      </React.Fragment>\n    );\n  };\n\n  const renderInlineMenuWrapper = (menu: InlineMenuWrapperProps, index: number) => {\n    const {\n      menus: menuWrapperData,\n    } = menu;\n    return (\n      <InlineMenuWrapper key={index}>\n        {renderMenus(menuWrapperData)}\n      </InlineMenuWrapper>\n    );\n  };\n\n  /**\n   * 渲染子菜单\n   * @param menu\n   * @param index\n   */\n  const renderSubMenu = (menu: SubMenuProps, index: number) => {\n    const {\n      title,\n      hidden,\n      menus: subMenuData,\n      ...rest\n    } = menu;\n    if (hidden || !checkIfNotAllChildrenHidden(menu)) return null;\n\n    const { PluginMenu, locale } = getMenuFromPlugin(menu);\n    if (PluginMenu) {\n      return (\n        <PluginMenu\n          key={menu.menuKey}\n          controller={controller}\n          menuItem={menu}\n          locale={locale}\n        />);\n    }\n\n    const menusView = renderMenus(subMenuData || []);\n\n    if (query && (!menusView || menusView.filter((view) => !!view).length === 0)) {\n      return null;\n    }\n\n    return (\n      <SubMenu {...rest} title={title} key={menu.menuKey || index}>\n        {menusView}\n      </SubMenu>\n    );\n  };\n\n  /**\n   * 渲染菜单组\n   * @param menu\n   * @param index\n   */\n  const renderMenuGroup = (menu: MenuGroupProps, index: number) => {\n    const {\n      title,\n      hidden,\n      menus: menuGroupData,\n      ...rest\n    } = menu;\n    if (hidden || !checkIfNotAllChildrenHidden(menu)) return null;\n    const shouldShowDivider = index !== 0 && notNullMenuCount >= 1;\n\n    const menusView = renderMenus(menuGroupData);\n\n    // children 没有值的时候隐藏\n    if (query && (!menusView || menusView.filter((view) => !!view).length === 0)) {\n      return null;\n    }\n\n    return (\n      <React.Fragment key={index}>\n        {shouldShowDivider ? <MenuDivider /> : null}\n        <MenuItemGroup {...rest} title={title || ''}>\n          {menusView}\n        </MenuItemGroup>\n      </React.Fragment>\n    );\n  };\n\n  const renderMenu = (item: MENU_ITEM_TYPE, index: number) => {\n    if (!item) return null;\n    const { type } = item;\n\n    switch (type) {\n      case TYPE_GROUP:\n        return renderMenuGroup(item as MenuGroupProps, index);\n      case TYPE_INLINE_MENU_GROUP:\n        return renderInlineMenuGroup(item as InlineMenuGroupProps, index);\n      case TYPE_INLINE_MENU_WRAPPER:\n        return renderInlineMenuWrapper(item as InlineMenuWrapperProps, index);\n      case TYPE_SUB_MENU:\n        return renderSubMenu(item as SubMenuProps, index);\n      case TYPE_MENU_ITEM:\n        return renderMenuItem(item as MenuItemProps);\n      case TYPE_INLINE_MENU_ITEM:\n        return renderInlineMenuItem(item as InlineMenuItemProps);\n      case TYPE_QUERY_ONLY_INLINE_MENU_ITEM:\n        // 仅支持查询的菜单项在无 query 场景不显示\n        return null;\n      default:\n        console.warn(`not support ${type} (type should be one of: TYPE_GROUP | TYPE_SUB_MENU | TYPE_MENU_ITEM)`);\n        return null;\n    }\n  };\n\n  const renderMenus = (data: TYPE_MENU_DATA) => {\n    if (!data) return null;\n    return data.map(renderMenu);\n  };\n\n  // @ts-ignore\n  const menuView = renderMenus(menuData);\n\n  if (query && (!menuView || menuView.filter((item) => item).length === 0)) {\n    return null;\n  }\n\n  return (\n    <>\n      {menuView}\n    </>\n  );\n};\n\nexport default MenuAdapter;\n"],"file":"menu.js"}