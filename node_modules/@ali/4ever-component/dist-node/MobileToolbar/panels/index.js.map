{"version":3,"sources":["../../../../src/MobileToolbar/panels/index.tsx"],"names":["PANEL_TRANSITION_SHORT","PANEL_TRANSITION_LONG","HEADER_BG_FADING","CloseButton","onClick","isTouched","setIsTouched","React","useState","startTouch","useCallback","event","stopPropagation","endTouch","BottomPanel","props","children","title","icon","height","layout","controller","plugins","closePanel","ref","useRef","offsetRef","isFadingRef","handleDragStatusChange","isDragging","domNode","current","transition","style","requestAnimationFrame","transform","handleDragOffsetChange","rawOffset","offset","isFading","color","HEADER_BG","headerNode","querySelector","blockEvent"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { usePanel } from '../hooks';\n\nimport { MobileToolbarGroup, Plugins } from '../types';\nimport { blockEvent } from '../utils';\nimport { close as CloseIcon } from '../icons';\nimport { Controller } from '@ali/4ever-cangjie';\nimport Line from '../components/line';\nimport Header from './header';\nimport {\n  BottomPanelWrapper,\n  PanelContentWrapper,\n  CloseButtonWrapper,\n  HEADER_BG,\n} from './styled';\n\nconst PANEL_TRANSITION_SHORT = 'none';\nconst PANEL_TRANSITION_LONG = 'opacity 350ms, transform 350ms';\n\nconst HEADER_BG_FADING = '#ffa39e';\n\ntype IProps = {\n  title: string | React.ComponentType;\n  icon?: React.ComponentType;\n  height?: string;\n  children: any;\n\n  // Panel 上渲染工具条\n  layout: MobileToolbarGroup[];\n  controller: Controller;\n  plugins: Plugins;\n};\n\nfunction CloseButton({ onClick }: { onClick?: () => void }) {\n  const [isTouched, setIsTouched] = React.useState(false);\n\n  const startTouch = React.useCallback(\n    (event: React.MouseEvent | React.TouchEvent) => {\n      event.stopPropagation();\n      setIsTouched(true);\n    },\n    [],\n  );\n  const endTouch = React.useCallback(\n    (event: React.MouseEvent | React.TouchEvent) => {\n      event.stopPropagation();\n      setIsTouched(false);\n    },\n    [],\n  );\n  return (\n    <CloseButtonWrapper\n      onTouchStart={startTouch}\n      onTouchEnd={endTouch}\n      onTouchCancel={endTouch}\n      onMouseDown={onClick}\n      isTouched={isTouched}\n    >\n      <CloseIcon />\n    </CloseButtonWrapper>\n  );\n}\n\nfunction BottomPanel(props: IProps) {\n  const { children, title, icon, height, layout, controller, plugins } = props;\n  const { closePanel } = usePanel();\n  const ref = React.useRef<HTMLDivElement | null>(null);\n  const offsetRef = React.useRef<number>(0);\n  const isFadingRef = React.useRef(false);\n\n  const handleDragStatusChange = (isDragging: boolean) => {\n    const domNode = ref.current;\n    if (!domNode) {\n      return;\n    }\n    const transition = isDragging\n      ? PANEL_TRANSITION_SHORT\n      : PANEL_TRANSITION_LONG;\n    domNode.style.transition = transition;\n    isFadingRef.current = false;\n    requestAnimationFrame(() => {\n      if (offsetRef.current < 100) {\n        domNode.style.transform = 'translate3d(0,0,0)';\n      } else {\n        closePanel && closePanel();\n      }\n    });\n  };\n\n  const handleDragOffsetChange = (rawOffset: number) => {\n    const domNode = ref.current;\n    if (!domNode) {\n      return;\n    }\n    const offset = rawOffset > 0 ? rawOffset : 0;\n    domNode.style.transform = `translate3d(0,${offset}px,0)`;\n    offsetRef.current = offset;\n    const isFading = offset >= 100;\n    if (isFading !== isFadingRef.current) {\n      isFadingRef.current = isFading;\n      const color = isFading ? HEADER_BG_FADING : HEADER_BG;\n      const headerNode = domNode.querySelector('[data-panel-header]') as\n        | HTMLElement\n        | undefined;\n      if (headerNode) {\n        // headerNode.style.background = color;\n      }\n    }\n  };\n\n  return (\n    <BottomPanelWrapper\n      data-toobar-subpanel\n      height={height}\n      ref={ref}\n      onMouseDown={blockEvent}\n    >\n      <CloseButton onClick={closePanel} />\n      {!title && (\n        <Line layout={layout} controller={controller} plugins={plugins} />\n      )}\n      {!!title && (\n        <Header\n          title={title}\n          Icon={icon}\n          onDragOffsetChange={handleDragOffsetChange}\n          onDragStatusChange={handleDragStatusChange}\n        />\n      )}\n\n      <PanelContentWrapper>{children}</PanelContentWrapper>\n    </BottomPanelWrapper>\n  );\n}\n\nexport default BottomPanel;\n"],"file":"index.js"}