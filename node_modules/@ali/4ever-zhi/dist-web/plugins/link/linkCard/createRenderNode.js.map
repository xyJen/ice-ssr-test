{"version":3,"sources":["../../../../../src/plugins/link/linkCard/createRenderNode.tsx"],"names":["React","styled","URLLinkCard","LinkCardPlugin","LinkPlugin","useScrollableContent","normalizeLink","openLink","copyBlockLinkCard","actions","Wrapper","div","LinkCardNode","props","nodeProps","controller","linkConfig","isMobile","locale","protocolAllowList","openLinkOfConfig","node","isSelected","selection","value","data","metadata","href","cardInfo","text","scrollContent","document","body","getContainer","useCallback","urlInfo","useMemo","isTitleEqualsHref","trim","actualTitle","title","desc","imgURL","linkCardLocale","tooltipLocale","editTooltip","edit","copyTooltip","copy","unlinkTooltip","unlink","deleteTooltip","switchStyleTooltip","styleText","handleVisit","normalizedLink","handleCopy","e","preventDefault","stopPropagation","run","isCollapsed","canCopy","undefined","createRenderNode"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport styled from 'styled-components';\nimport { URLLinkCard } from '@ali/we-biz-link-card';\nimport { Controller, RenderNodeProps } from '@ali/4ever-cangjie';\nimport { LinkCardPlugin } from '@ali/4ever-bi';\nimport { LinkPlugin, useScrollableContent } from '@ali/4ever-bamboo';\nimport { CustomizedZhiCardPluginType } from '@ali/4ever-factory';\nimport { BlockLinkCard, LinkPluginConfig } from '../types';\n\nconst { normalizeLink, openLink } = LinkPlugin;\n\nconst { copyBlockLinkCard } = LinkCardPlugin.actions;\n\nconst Wrapper = styled.div`\n  cursor: pointer;\n`;\n\nfunction LinkCardNode(props: {\n  nodeProps: RenderNodeProps<BlockLinkCard>,\n  controller: Controller,\n  linkConfig: LinkPluginConfig,\n  isMobile: boolean\n}) {\n\n  const { nodeProps, controller, linkConfig, isMobile } = props;\n\n  const {\n    locale,\n    protocolAllowList = ['http:', 'https:', 'dingtalk:', 'taobao:'],\n    openLink: openLinkOfConfig,\n  } = linkConfig;\n\n  const { node, isSelected } = nodeProps;\n\n  const { selection } = controller.value;\n\n  const { href, cardInfo, text } = node.data.metadata!;\n\n  const scrollContent = useScrollableContent() || document.body;\n\n  const getContainer = React.useCallback(() => {\n    return scrollContent;\n  }, [scrollContent]);\n\n  const urlInfo = React.useMemo(() => {\n    const isTitleEqualsHref = text.trim() === href.trim();\n    const actualTitle = isTitleEqualsHref ? cardInfo.title : text;\n    return ({\n      title: actualTitle || '',\n      desc: cardInfo.desc || '',\n      imgURL: cardInfo.imgURL || '',\n    })\n  }, [cardInfo, text, href]);\n\n  const linkCardLocale = React.useMemo(() => {\n    const tooltipLocale = {\n      editTooltip: locale.edit,\n      copyTooltip: locale.copy,\n      unlinkTooltip: locale.unlink,\n      deleteTooltip: locale.delete,\n      switchStyleTooltip: locale.styleText,\n    };\n    return { ...locale, ...tooltipLocale };\n  }, [locale]);\n\n  const handleVisit = React.useCallback(\n    () => {\n      if (openLinkOfConfig) {\n        const normalizedLink = normalizeLink(href, protocolAllowList);\n        openLinkOfConfig(normalizedLink);\n      } else {\n        openLink(href, protocolAllowList);\n      }\n    },\n    [href, protocolAllowList, openLinkOfConfig],\n  );\n\n  const handleCopy = React.useCallback(\n    (e: React.MouseEvent) => {\n      e.preventDefault();\n      e.stopPropagation();\n      // 卡片形式下，使用仓颉复制\n      controller.run('onAction', copyBlockLinkCard(node));\n    },\n    [href, node, controller],\n  );\n\n  return (\n    <Wrapper>\n      <URLLinkCard\n        getContainer={getContainer}\n        isSelected={isSelected && selection.isCollapsed}\n        cardStyle={'indoc'}\n        state={'normal'}\n        url={href}\n        readonly={true}\n        locale={linkCardLocale}\n        urlInfo={urlInfo}\n        isMobile={isMobile}\n        // @ts-ignore\n        onCopy={controller.canCopy ? handleCopy : undefined}\n        onOpenURL={handleVisit}\n        editBtnTestID=\"link-toolbar-edit\"\n        copyBtnTestID=\"link-toolbar-copy\"\n        cutBtnTestID=\"link-toolbar-cut\"\n        unlinkBtnTestID=\"link-toolbar-unlink\"\n        deleteBtnTestID=\"link-toolbar-remove\"\n        switchStyleBtnTestID=\"link-toolbar-switch\"\n        linkStyleBtnTestID=\"link-toolbar-switch-link\"\n        cardStyleBtnTestID=\"link-toolbar-switch-card\"\n        cardTestID=\"link-card\"\n      />\n    </Wrapper>);\n}\n\nexport default function createRenderNode(\n  linkConfig: LinkPluginConfig,\n  isMobile: boolean\n): CustomizedZhiCardPluginType['renderNode'] {\n\n  return (nodeProps: RenderNodeProps<BlockLinkCard>, controller: Controller) => {\n    return (\n      <LinkCardNode\n        linkConfig={linkConfig}\n        isMobile={isMobile}\n        nodeProps={nodeProps}\n        controller={controller}\n      />\n    )\n  };\n}\n"],"file":"createRenderNode.js"}