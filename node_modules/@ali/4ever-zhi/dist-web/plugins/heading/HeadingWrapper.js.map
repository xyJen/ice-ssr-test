{"version":3,"sources":["../../../../src/plugins/heading/HeadingWrapper.tsx"],"names":["React","getHeadings","throttleByIdleCallback","equal","HeadingWrapper","props","controller","onHeadingsChange","children","headingsRef","useRef","dataValue","query","value","useEffect","headings","current","displayName"],"mappings":"AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AAEA,SAASC,WAAT,EAAoCC,sBAApC,QAAkE,mBAAlE;AACA,OAAOC,KAAP,MAAkB,iBAAlB;;AAOA,IAAMC,cAA6C,GAAG,SAAhDA,cAAgD,CAACC,KAAD,EAAW;AAAA,MAE7DC,UAF6D,GAK3DD,KAL2D,CAE7DC,UAF6D;AAAA,MAG7DC,gBAH6D,GAK3DF,KAL2D,CAG7DE,gBAH6D;AAAA,MAI7DC,QAJ6D,GAK3DH,KAL2D,CAI7DG,QAJ6D;AAO/D,MAAMC,WAAW,GAAGT,KAAK,CAACU,MAAN,CAA6B,EAA7B,CAApB,CAP+D,CAQ/D;;AACA,MAAMC,SAAgB,GAAGL,UAAU,CAACM,KAAX,CAAiB,cAAjB,KAAoCN,UAAU,CAACO,KAAxE;AAEAb,EAAAA,KAAK,CAACc,SAAN,CAAgBZ,sBAAsB,CAAC,YAAM;AAC3C,QAAMa,QAAQ,GAAGd,WAAW,CAACU,SAAD,CAA5B;;AACA,QAAI,CAACR,KAAK,CAACY,QAAD,EAAWN,WAAW,CAACO,OAAvB,CAAN,IAAyC,OAAOT,gBAAP,KAA4B,UAAzE,EAAqF;AACnFA,MAAAA,gBAAgB,CAACQ,QAAD,CAAhB;AACD;;AACDN,IAAAA,WAAW,CAACO,OAAZ,GAAsBD,QAAtB;AACD,GANqC,CAAtC,EAMI,CAACJ,SAAD,CANJ;AAQA,SAAOH,QAAP;AACD,CApBD;;AAsBAJ,cAAc,CAACa,WAAf,GAA6B,gBAA7B;AAEA,eAAeb,cAAf","sourcesContent":["import * as React from 'react';\nimport { Controller, Value } from '@ali/4ever-cangjie';\nimport { getHeadings, IHeadingItem, throttleByIdleCallback } from '@ali/4ever-bamboo';\nimport equal from 'fast-deep-equal';\n\nexport interface HeadingWrapperProps {\n  controller: Controller;\n  onHeadingsChange: (headings) => void;\n}\n\nconst HeadingWrapper: React.FC<HeadingWrapperProps> = (props) => {\n  const {\n    controller,\n    onHeadingsChange,\n    children,\n  } = props;\n\n  const headingsRef = React.useRef<IHeadingItem[]>([]);\n  // query dataValue 是为了兼容 pi 的场景\n  const dataValue: Value = controller.query('getDataValue') || controller.value;\n\n  React.useEffect(throttleByIdleCallback(() => {\n    const headings = getHeadings(dataValue);\n    if (!equal(headings, headingsRef.current) && typeof onHeadingsChange === 'function') {\n      onHeadingsChange(headings);\n    }\n    headingsRef.current = headings;\n  }), [dataValue]);\n\n  return children as React.ReactElement;\n};\n\nHeadingWrapper.displayName = 'HeadingWrapper';\n\nexport default HeadingWrapper;\n"],"file":"HeadingWrapper.js"}