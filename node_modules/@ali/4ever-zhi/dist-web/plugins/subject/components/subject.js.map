{"version":3,"sources":["../../../../../src/plugins/subject/components/subject.tsx"],"names":["React","useUserData","styled","HeadingGroupPlugin","SubjectPlugin","Content","components","utils","InlinePlaceholder","Placeholder","isEmptyNode","Title","toggleFold","actions","SubjectBox","div","ToolBox","ContentBox","props","paddingRight","BorderBar","color","TitleContent","TitleBox","Subject","node","attributes","controller","children","config","disableFold","locale","reviewConfig","review","MeetingClock","renderMeetingClock","topicTitlePlaceholderBefore","topicTitlePlaceholderAfter","fold","data","subjectPr","id","name","useState","toolWidth","setToolWidth","toolRef","useRef","handleFoldChange","useCallback","_fold","first","nodes","run","refreshToolWidth","tool","current","offsetWidth","useLayoutEffect","useMemo","titleNode","titleElement","contentElements","Array","isArray","length","slice","displayTitlePlaceholder","item","renderTitleToolbar","toolbars","push","renderTitlePlaceholder","type","displayName"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { Block, Controller, useUserData } from '@ali/4ever-cangjie';\nimport { Heading1Data } from '@ali/4ever-mo';\nimport styled from 'styled-components';\nimport { HeadingGroupPlugin, SubjectPlugin } from '@ali/4ever-bamboo';\nimport { SubjectConfig } from '../types';\nimport Content from './content';\n\nconst { components, utils } = SubjectPlugin;\n\nconst { InlinePlaceholder, Placeholder } = components;\nconst { isEmptyNode } = utils;\n\nconst { Title } = HeadingGroupPlugin;\nconst { toggleFold } = HeadingGroupPlugin.actions;\n\nconst SubjectBox = styled.div<{ paddingRight?: number }>`\n  position: relative;\n  padding-left: 24px;\n  margin-top: 36px;\n`;\n\nconst ToolBox = styled.div`\n  position: absolute;\n  height: 28px;\n  right: 0;\n  top: 0;\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n`;\n\nconst ContentBox = styled(Content) <{ paddingRight?: number }>`\n\n  & > [data-type='heading-1-group'] > [data-name='heading-group-title'] {\n    padding-right: ${(props) => props.paddingRight || 0}px;\n  }\n\n  & > * {\n    margin-left: -24px;\n    padding-left: 24px !important;\n  }\n`;\n\nconst BorderBar = styled.div<{ color: string }>`\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 4px;\n  height: 100%;\n  background: ${(props) => props.color};\n  transition: all 0.2s ease-in-out;\n`;\n\nconst TitleContent = styled.div`\n  & > * {\n    margin-left: -24px;\n    padding-left: 24px !important;\n  }\n`;\n\nconst TitleBox = styled(Title) <{ paddingRight?: number }>`\npadding-right: ${(props) => props.paddingRight}px;\n\n& .data-comment-bubbles {\n  left: ${(props) => props.paddingRight}px;\n}\n`;\n\nexport interface SubjectProps {\n  controller: Controller;\n  node: Block<Heading1Data>;\n  attributes: Record<string, string>;\n  config: SubjectConfig;\n}\n\n/**\n * 议题区块\n * @param props\n * @returns\n * @todo 标题 margin 会导致 border 在折叠状态下偏长，这个比较难解\n */\nconst Subject: React.FC<SubjectProps> = (props) => {\n  const {\n    node,\n    attributes,\n    controller,\n    children,\n    config,\n  } = props;\n\n  const { disableFold = false, locale = {}, review: reviewConfig } = config;\n  const {\n    renderMeetingClock: MeetingClock,\n  } = reviewConfig || {};\n  const { topicTitlePlaceholderBefore, topicTitlePlaceholderAfter } = locale;\n  const fold = useUserData(node, 'fold') || false;\n  const { subjectPr = {} } = node.data;\n  const { id, name } = subjectPr;\n  const [toolWidth, setToolWidth] = React.useState(0);\n  const toolRef = React.useRef<HTMLDivElement>(null);\n\n  const handleFoldChange = React.useCallback((_fold: boolean) => {\n    const first = node.nodes[0];\n    controller.run('onAction', toggleFold({\n      node: first as Block,\n      fold: _fold,\n    }));\n  }, [controller, node]);\n\n  const refreshToolWidth = React.useCallback(() => {\n    const tool = toolRef.current;\n    if (tool && tool.offsetWidth !== toolWidth) {\n      setToolWidth(tool.offsetWidth);\n    }\n  }, [toolWidth]);\n\n  React.useLayoutEffect(() => {\n    refreshToolWidth();\n  }, [refreshToolWidth]);\n\n  /**\n   * 议题边框颜色 @狗毛\n   */\n  const color = React.useMemo(() => {\n    if (name === 'review') {\n      return '#F4C800';\n    }\n    if (name === 'topic') {\n      return '#0089FF';\n    }\n    if (name === 'conclusion') {\n      return '#00B042';\n    }\n    return '#0089FF';\n  }, [name]);\n\n  // 切割议题的标题和内容块\n  let titleNode: Block;\n  let titleElement: React.ReactNode;\n  let contentElements: React.ReactNode[];\n\n  if (Array.isArray(children) && children.length >= 1) {\n    titleNode = node.nodes[0] as Block;\n    titleElement = children[0];\n    contentElements = children.slice(1);\n  } else {\n    return <>{children}</>;\n  }\n\n  const displayTitlePlaceholder = (item: Block) => {\n    // 类型是议题 && 非预览模式 && 没有标题 && 有 placeholder 文字配置才展示\n    if (name === 'topic' && isEmptyNode(item) && topicTitlePlaceholderBefore && topicTitlePlaceholderAfter) {\n      return true;\n    }\n    return false;\n  };\n\n  const renderTitleToolbar = () => {\n    const toolbars = [];\n\n    if (name === 'topic') {\n      MeetingClock && toolbars.push(<MeetingClock node={node} />);\n    }\n\n    return toolbars;\n  };\n\n  const renderTitlePlaceholder = () => {\n    if (name === 'topic') {\n      return (\n        <InlinePlaceholder>\n          {topicTitlePlaceholderBefore}\n          {' @ '}\n          {topicTitlePlaceholderAfter}\n        </InlinePlaceholder>\n      );\n    }\n    return '';\n  };\n\n\n  return (\n    <SubjectBox\n      {...attributes}\n      id={id}\n      data-name=\"subject-group\"\n      data-type={node.type}\n      data-foldable\n      data-cangjie-group-block\n      paddingRight={toolWidth}\n    >\n      <BorderBar color={color} />\n      <TitleBox\n        dataName=\"subject-group-title\"\n        fold={fold}\n        onChange={handleFoldChange}\n        disabled={disableFold}\n        paddingRight={toolWidth}\n      >\n        <TitleContent data-name=\"subject-group-title-content\">\n          <Placeholder\n            controller={controller}\n            node={titleNode}\n            display={displayTitlePlaceholder}\n            placeholder={renderTitlePlaceholder()}\n          >\n            {titleElement}\n          </Placeholder>\n        </TitleContent>\n        <ToolBox ref={toolRef}>\n          {renderTitleToolbar()}\n        </ToolBox>\n      </TitleBox>\n      <ContentBox config={config} dataName=\"subject-group-content\" controller={controller} node={node} fold={!disableFold && fold} paddingRight={toolWidth}>\n        {contentElements}\n      </ContentBox>\n    </SubjectBox>\n  );\n};\n\nSubject.displayName = 'Subject';\n\nexport default Subject;\n"],"file":"subject.js"}