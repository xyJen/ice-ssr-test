import * as React from 'react';
var _createElement = /*#__PURE__*/React.createElement;
import { EmbedPlugin } from '@ali/4ever-bamboo';
var FileTypeMap = EmbedPlugin.FileTypeMap,
    VideoPlayer = EmbedPlugin.VideoPlayer,
    MobileEmbedCard = EmbedPlugin.MobileEmbedCard,
    EmbedFailedCard = EmbedPlugin.EmbedFailedCard;
export default function createEmbedPlugin(config) {
  var onDownloadFile = function onDownloadFile(props) {
    var node = props.node;
    var data = node.data;
    var src = data.src,
        name = data.name,
        type = data.type,
        size = data.size;
    var videoConfig = config.video || {};
    var downloadFile = videoConfig.downloadFile;

    if (downloadFile) {
      downloadFile(src, {
        name: name,
        type: type,
        size: size
      });
    }
  };

  var handleMediaLoadError = function handleMediaLoadError(src) {
    var videoConfig = config.video || {};
    var onMediaLoadError = videoConfig.onMediaLoadError;

    if (onMediaLoadError) {
      onMediaLoadError(src);
    }
  };

  var handleMediaLoadSuccess = function handleMediaLoadSuccess(src) {
    var videoConfig = config.video || {};
    var onMediaLoadSuccess = videoConfig.onMediaLoadSuccess;

    if (onMediaLoadSuccess) {
      onMediaLoadSuccess(src);
    }
  };

  var renderPreview = function renderPreview(props) {
    var isSelected = props.isSelected,
        node = props.node;

    var _ref = config.video || {},
        transformVideoURL = _ref.transformVideoURL,
        renderVideoMask = _ref.renderVideoMask,
        setTempPosterUrl = _ref.setTempPosterUrl,
        downloadFile = _ref.downloadFile,
        allowDownload = _ref.allowDownload,
        locale = _ref.locale,
        _ref$enableVideoPrevi = _ref.enableVideoPreview,
        enableVideoPreview = _ref$enableVideoPrevi === void 0 ? true : _ref$enableVideoPrevi,
        allowFullscreen = _ref.allowFullscreen;

    if (!enableVideoPreview) {
      return renderCard(props);
    }

    return /*#__PURE__*/_createElement(VideoPlayer, {
      transformVideoURL: transformVideoURL,
      onMediaLoadSuccess: handleMediaLoadSuccess,
      onMediaLoadError: handleMediaLoadError,
      setTempPosterUrl: setTempPosterUrl,
      node: node,
      isSelected: isSelected,
      renderVideoMask: renderVideoMask,
      isMobile: true,
      allowDownload: downloadFile && allowDownload,
      onDownload: function onDownload() {
        return onDownloadFile(props);
      },
      allowFullscreen: allowFullscreen,
      locale: locale
    });
  };

  var renderCard = function renderCard(props) {
    var node = props.node;
    var data = node.data;
    var src = data.src,
        name = data.name,
        type = data.type,
        size = data.size;

    var _ref2 = config.video || {},
        onPreview = _ref2.onPreview;

    return /*#__PURE__*/_createElement(MobileEmbedCard, {
      name: name,
      onPreview: onPreview,
      src: src,
      type: type,
      size: size
    });
  };

  return {
    renderNode: {
      embed: function embed(props, _, next) {
        var node = props.node;

        if (node.data.type === FileTypeMap.Video && node.data.src) {
          var attributes = props.attributes;
          var data = node.data;
          var viewType = data.viewType;
          return /*#__PURE__*/_createElement("div", attributes, viewType === 'preview' ? renderPreview(props) : renderCard(props));
        }

        if (node.data.type === FileTypeMap.Video && node.data.errorType) {
          var _config$video;

          return /*#__PURE__*/_createElement(EmbedFailedCard, {
            node: node,
            locale: (config == null ? void 0 : (_config$video = config.video) == null ? void 0 : _config$video.locale) || {}
          });
        }

        return next();
      }
    }
  };
}
//# sourceMappingURL=index.js.map