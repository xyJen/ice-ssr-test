{"version":3,"sources":["../../../../../src/plugins/video/mobile/index.tsx"],"names":["React","EmbedPlugin","FileTypeMap","VideoPlayer","MobileEmbedCard","EmbedFailedCard","createEmbedPlugin","config","onDownloadFile","props","node","data","src","name","type","size","videoConfig","video","downloadFile","handleMediaLoadError","onMediaLoadError","handleMediaLoadSuccess","onMediaLoadSuccess","renderPreview","isSelected","transformVideoURL","renderVideoMask","setTempPosterUrl","allowDownload","locale","enableVideoPreview","allowFullscreen","renderCard","onPreview","renderNode","embed","_","next","Video","attributes","viewType","errorType"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport {\n  EmbedPlugin,\n} from '@ali/4ever-bamboo';\nimport { ZhiConfig } from '../../../types';\n\nconst {\n  FileTypeMap,\n  VideoPlayer,\n  MobileEmbedCard,\n  EmbedFailedCard,\n} = EmbedPlugin;\n\nexport default function createEmbedPlugin(config: ZhiConfig) {\n\n  const onDownloadFile = (props) => {\n    const { node } = props;\n    const { data } = node;\n    const { src, name, type, size } = data;\n    const videoConfig = config.video || {};\n    const { downloadFile } = videoConfig;\n    if (downloadFile) {\n      downloadFile(src, {\n        name,\n        type,\n        size,\n      });\n    }\n  };\n\n  const handleMediaLoadError = (src) => {\n    const videoConfig = config.video || {};\n    const { onMediaLoadError } = videoConfig;\n    if (onMediaLoadError) {\n      onMediaLoadError(src);\n    }\n  };\n\n  const handleMediaLoadSuccess = (src) => {\n    const videoConfig = config.video || {};\n    const { onMediaLoadSuccess } = videoConfig;\n    if (onMediaLoadSuccess) {\n      onMediaLoadSuccess(src);\n    }\n  };\n\n  const renderPreview = (props) => {\n    const {\n      isSelected, node,\n    } = props;\n\n    const {\n      transformVideoURL, renderVideoMask, setTempPosterUrl,\n      downloadFile, allowDownload, locale, enableVideoPreview = true,\n      allowFullscreen,\n    } = config.video || {};\n\n    if (!enableVideoPreview) {\n      return renderCard(props);\n    }\n\n    return (\n      <VideoPlayer\n        transformVideoURL={transformVideoURL}\n        onMediaLoadSuccess={handleMediaLoadSuccess}\n        onMediaLoadError={handleMediaLoadError}\n        setTempPosterUrl={setTempPosterUrl}\n        node={node}\n        isSelected={isSelected}\n        renderVideoMask={renderVideoMask}\n        isMobile\n        allowDownload={downloadFile && allowDownload}\n        onDownload={() => onDownloadFile(props)}\n        allowFullscreen={allowFullscreen}\n        locale={locale}\n      />\n    );\n  };\n\n  const renderCard = (props) => {\n    const { node } = props;\n    const { data } = node;\n    const { src, name, type, size } = data;\n    const { onPreview } = config.video || {};\n\n    return (\n      <MobileEmbedCard\n        name={name}\n        onPreview={onPreview}\n        src={src}\n        type={type}\n        size={size}\n      />\n    );\n  };\n\n  return {\n    renderNode: {\n      embed: (props, _, next) => {\n        const { node } = props;\n        if (node.data.type === FileTypeMap.Video && node.data.src) {\n          const { attributes } = props;\n          const { data } = node;\n          const { viewType } = data;\n          return (\n            <div {...attributes}>\n              {viewType === 'preview' ? renderPreview(props) : renderCard(props)}\n            </div>\n          );\n        }\n  \n        if (node.data.type === FileTypeMap.Video && node.data.errorType) {\n          return <EmbedFailedCard node={node} locale={config?.video?.locale || {}} />;\n        }\n        return next();\n      },\n    },\n  };\n}\n"],"file":"index.js"}