{"version":3,"sources":["../../../../src/plugins/calendarCard/createRenderNode.tsx"],"names":["React","useCallback","useEffect","useRef","useState","memoize","CalendarCardPlugin","FlashCalendarCardContainer","JumpToCalendarEventType","CalendarType","TimeTextParagraph","PlaceTextParagraph","SubjectParagraph","ReceiversParagraph","CommentTextParagraph","CommentTextWrapper","ContainerWrapper","BodyWrapper","SubjectPlaceholder","TimePlaceholder","createRenderNode","cardConfig","locale","isMobile","calendarMode","mode","rest","props","node","data","metadata","SHANHUI","clickTimeout","CalendarCardContainer","jumpToCalendar","openProfile","time","place","comment","subject","redirectUrl","isPlaceholder","jumpToCalendarFactory","eventType","event","preventDefault","stopPropagation","style","setStyle","color","height","width","border","clickTimeRef","handleMouseDown","current","Date","getTime","handleClick","undefined","RECEIVER"],"mappings":"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","sourcesContent":["import React, { CSSProperties, useCallback, useEffect, useRef, useState } from 'react';\nimport { memoize } from 'lodash-es';\nimport { Block, RenderNodeProps } from '@ali/4ever-cangjie';\nimport { CalendarCardPlugin } from '@ali/4ever-bamboo';\nimport FlashCalendarCardContainer from './shanhui/FlashCalendarCardContainer';\nimport { ZhiCalendarCardPluginConfig, JumpToCalendarEventType, CalendarType } from './type';\n\nconst {\n  TimeTextParagraph,\n  PlaceTextParagraph,\n  SubjectParagraph,\n  ReceiversParagraph,\n  CommentTextParagraph,\n  CommentTextWrapper,\n  ContainerWrapper,\n  BodyWrapper,\n  SubjectPlaceholder,\n  TimePlaceholder,\n} = CalendarCardPlugin;\n\nexport default function createRenderNode(cardConfig: ZhiCalendarCardPluginConfig) {\n  const { locale, isMobile, mode: calendarMode, ...rest } = cardConfig;\n  return (props: RenderNodeProps<Block>) => {\n    const { node } = props;\n    const { metadata } = node.data as CalendarCardPlugin.CalendarCardDataType;\n    const { mode = calendarMode } = metadata;\n\n    if (mode === CalendarType.SHANHUI) {\n      return (\n        <FlashCalendarCardContainer\n          {...rest}\n          metadata={metadata}\n          locale={locale}\n        />\n      );\n    }\n\n    return (\n      <CalendarCardContainer\n        {...rest}\n        metadata={metadata}\n        locale={locale}\n      />\n    );\n  };\n}\n// 当mousedown与click之间的间隔少于150ms时认为是点击点击而不是拖动选中\nconst clickTimeout = 150;\ninterface IProps {\n  locale?: {\n    refresh: string;\n    refreshTips: string; // 日程卡片有更新\n    receiverCount: string; // 等{count}人参会\n    viewCalendardetails: string; // 查看日程详情\n    noresponse: string; // 未响应\n    received: string; // 已接收\n    refused: string; // 已拒绝\n    pending: string; // 待定\n    organizer: string; // 组织人\n  };\n  metadata: CalendarCardPlugin.CalendarCardMetadataType;\n  jumpToCalendar?: (link?: string, eventType?: JumpToCalendarEventType) => void;\n  openProfile?: (uid: number) => void;\n}\n\nfunction CalendarCardContainer(props: IProps) {\n  const { locale, metadata, jumpToCalendar, openProfile } = props;\n  const { time, place, comment, subject = '', redirectUrl, isPlaceholder } = metadata;\n  const jumpToCalendarFactory = useCallback(memoize((eventType?: JumpToCalendarEventType) => {\n    return (event: React.MouseEvent<Element>) => {\n      event.preventDefault();\n      event.stopPropagation();\n      if (!jumpToCalendar) return;\n      if (isPlaceholder) return;\n      jumpToCalendar(redirectUrl, eventType);\n    };\n  }), [jumpToCalendar]);\n  const [style, setStyle] = useState<CSSProperties>({});\n  useEffect(() => {\n    setStyle({\n      color: isPlaceholder ? 'rgba(17,31,44,0.4)' : '',\n      height: 'auto',\n      width: 'auto',\n      border: '1px solid rgba(17,31,44,0)',\n    });\n  }, [isPlaceholder]);\n  const clickTimeRef = useRef<number | undefined>();\n  const handleMouseDown = useCallback((event: React.SyntheticEvent) => {\n    clickTimeRef.current = new Date().getTime();\n    event.stopPropagation();\n  }, []);\n  const handleClick = useCallback((event: React.SyntheticEvent) => {\n    if (!clickTimeRef.current || (new Date().getTime() - clickTimeRef.current) > clickTimeout) {\n      event.stopPropagation();\n    }\n    clickTimeRef.current = undefined;\n  }, []);\n\n  return (\n    <ContainerWrapper\n      onMouseDown={handleMouseDown}\n      onClick={handleClick}\n      style={style}\n    >\n      <BodyWrapper>\n        <SubjectParagraph\n          isPlaceholder={isPlaceholder}\n          metadata={metadata}\n          subject={isPlaceholder ? <SubjectPlaceholder>{subject}</SubjectPlaceholder> : subject}\n          jumpToCalendar={jumpToCalendarFactory(JumpToCalendarEventType.RECEIVER)}\n        />\n        <TimeTextParagraph>\n          {isPlaceholder ? <TimePlaceholder>{time}</TimePlaceholder> : time}\n        </TimeTextParagraph>\n        <PlaceTextParagraph>{place}</PlaceTextParagraph>\n        <ReceiversParagraph\n          locale={locale}\n          metadata={metadata}\n          openProfile={openProfile}\n          jumpToCalendar={jumpToCalendarFactory(JumpToCalendarEventType.RECEIVER)}\n        />\n        {comment ? (\n          <CommentTextParagraph>\n            <CommentTextWrapper>{comment}</CommentTextWrapper>\n          </CommentTextParagraph>\n        ) : null}\n      </BodyWrapper>\n    </ContainerWrapper>\n  );\n}\n"],"file":"createRenderNode.js"}