{"version":3,"sources":["../../../../../src/plugins/embed/mobile/index.tsx"],"names":["React","EmbedPlugin","moFactory","FileTypeMap","MobileEmbedCard","EmbedFailedCard","createEmbedPlugin","config","renderPreview","props","renderCard","node","data","src","name","type","size","onPreview","embed","renderNode","_","next","Video","Audio","attributes","viewType","errorType","locale"],"mappings":";AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;qBAC4B,a;AAA5B,SACEC,WADF,QAEO,mBAFP;AAGA,SAASC,SAAT,QAA0B,yBAA1B;IAGEC,W,GAGEF,W,CAHFE,W;IACAC,e,GAEEH,W,CAFFG,e;IACAC,e,GACEJ,W,CADFI,e;AAGF,eAAe,SAASC,iBAAT,CAA2BC,MAA3B,EAAmC;AAChD,MAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAACC,KAAD,EAAW;AAC/B;AACA,WAAOC,UAAU,CAACD,KAAD,CAAjB;AACD,GAHD;;AAKA,MAAMC,UAAU,GAAG,SAAbA,UAAa,CAACD,KAAD,EAAW;AAAA,QACpBE,IADoB,GACXF,KADW,CACpBE,IADoB;AAAA,QAEpBC,IAFoB,GAEXD,IAFW,CAEpBC,IAFoB;AAAA,QAGpBC,GAHoB,GAGMD,IAHN,CAGpBC,GAHoB;AAAA,QAGfC,IAHe,GAGMF,IAHN,CAGfE,IAHe;AAAA,QAGTC,IAHS,GAGMH,IAHN,CAGTG,IAHS;AAAA,QAGHC,IAHG,GAGMJ,IAHN,CAGHI,IAHG;AAAA,QAIpBC,SAJoB,GAINV,MAAM,CAACW,KAJD,CAIpBD,SAJoB;AAM5B,wBACE,eAAC,eAAD;AACE,MAAA,IAAI,EAAEH,IADR;AAEE,MAAA,SAAS,EAAEG,SAFb;AAGE,MAAA,GAAG,EAAEJ,GAHP;AAIE,MAAA,IAAI,EAAEE,IAJR;AAKE,MAAA,IAAI,EAAEC;AALR,MADF;AASD,GAfD;;AAiBA,sBACKd,SAAS,CAAC,EAAD,CADd;AAEEiB,IAAAA,UAFF,sBAEaV,KAFb,EAEoBW,CAFpB,EAEuBC,IAFvB,EAE6B;AAAA,UACjBV,IADiB,GACRF,KADQ,CACjBE,IADiB;;AAEzB,UAAIA,IAAI,CAACI,IAAL,KAAc,OAAd,IAAyBJ,IAAI,CAACC,IAAL,CAAUG,IAAV,KAAmBZ,WAAW,CAACmB,KAAxD,IAAiEX,IAAI,CAACC,IAAL,CAAUG,IAAV,KAAmBZ,WAAW,CAACoB,KAApG,EAA2G;AACzG,eAAOF,IAAI,EAAX;AACD;;AAJwB,UAKjBG,UALiB,GAKFf,KALE,CAKjBe,UALiB;AAAA,UAMjBZ,IANiB,GAMRD,IANQ,CAMjBC,IANiB;AAAA,UAOjBa,QAPiB,GAOOb,IAPP,CAOjBa,QAPiB;AAAA,UAOPC,SAPO,GAOOd,IAPP,CAOPc,SAPO;;AASzB,UAAIA,SAAJ,EAAe;AAAA;;AACb,4BAAO,eAAC,eAAD;AAAiB,UAAA,IAAI,EAAEf,IAAvB;AAA6B,UAAA,MAAM,EAAE,CAAAJ,MAAM,QAAN,6BAAAA,MAAM,CAAEW,KAAR,mCAAeS,MAAf,KAAyB;AAA9D,UAAP;AACD;;AAED,0BACE,sBAASH,UAAT,EACGC,QAAQ,KAAK,SAAb,GAAyBjB,aAAa,CAACC,KAAD,CAAtC,GAAgDC,UAAU,CAACD,KAAD,CAD7D,CADF;AAKD;AApBH;AAsBD","sourcesContent":["import * as React from 'react';\nimport {\n  EmbedPlugin,\n} from '@ali/4ever-bamboo';\nimport { moFactory } from '@ali/4ever-plugin-embed';\n\nconst {\n  FileTypeMap,\n  MobileEmbedCard,\n  EmbedFailedCard,\n} = EmbedPlugin;\n\nexport default function createEmbedPlugin(config) {\n  const renderPreview = (props) => {\n    // 移动端除了音视频，其他的都是卡片\n    return renderCard(props);\n  };\n\n  const renderCard = (props) => {\n    const { node } = props;\n    const { data } = node;\n    const { src, name, type, size } = data;\n    const { onPreview } = config.embed;\n\n    return (\n      <MobileEmbedCard\n        name={name}\n        onPreview={onPreview}\n        src={src}\n        type={type}\n        size={size}\n      />\n    );\n  };\n\n  return {\n    ...moFactory({}),\n    renderNode(props, _, next) {\n      const { node } = props;\n      if (node.type !== 'embed' || node.data.type === FileTypeMap.Video || node.data.type === FileTypeMap.Audio) {\n        return next();\n      }\n      const { attributes } = props;\n      const { data } = node;\n      const { viewType, errorType } = data;\n\n      if (errorType) {\n        return <EmbedFailedCard node={node} locale={config?.embed?.locale || {}} />;\n      }\n\n      return (\n        <div {...attributes}>\n          {viewType === 'preview' ? renderPreview(props) : renderCard(props)}\n        </div>\n      );\n    },\n  };\n}\n"],"file":"index.js"}