{"version":3,"sources":["../../../../../src/plugins/subject/components/subject.tsx"],"names":["components","utils","SubjectPlugin","InlinePlaceholder","Placeholder","isEmptyNode","Title","HeadingGroupPlugin","toggleFold","actions","SubjectBox","styled","div","ToolBox","ContentBox","Content","props","paddingRight","BorderBar","color","TitleContent","TitleBox","Subject","node","attributes","controller","children","config","disableFold","locale","review","reviewConfig","renderMeetingClock","MeetingClock","topicTitlePlaceholderBefore","topicTitlePlaceholderAfter","fold","subjectPr","data","id","name","toolWidth","setToolWidth","React","useState","toolRef","useRef","handleFoldChange","useCallback","_fold","first","nodes","run","refreshToolWidth","tool","current","offsetWidth","useLayoutEffect","useMemo","titleNode","titleElement","contentElements","Array","isArray","length","slice","displayTitlePlaceholder","item","renderTitleToolbar","toolbars","push","renderTitlePlaceholder","type","displayName"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { Block, Controller, useUserData } from '@ali/4ever-cangjie';\nimport { Heading1Data } from '@ali/4ever-mo';\nimport styled from 'styled-components';\nimport { HeadingGroupPlugin, SubjectPlugin } from '@ali/4ever-bamboo';\nimport { SubjectConfig } from '../types';\nimport Content from './content';\n\nconst { components, utils } = SubjectPlugin;\n\nconst { InlinePlaceholder, Placeholder } = components;\nconst { isEmptyNode } = utils;\n\nconst { Title } = HeadingGroupPlugin;\nconst { toggleFold } = HeadingGroupPlugin.actions;\n\nconst SubjectBox = styled.div<{ paddingRight?: number }>`\n  position: relative;\n  padding-left: 24px;\n  margin-top: 36px;\n`;\n\nconst ToolBox = styled.div`\n  position: absolute;\n  height: 28px;\n  right: 0;\n  top: 0;\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n`;\n\nconst ContentBox = styled(Content) <{ paddingRight?: number }>`\n\n  & > [data-type='heading-1-group'] > [data-name='heading-group-title'] {\n    padding-right: ${(props) => props.paddingRight || 0}px;\n  }\n\n  & > * {\n    margin-left: -24px;\n    padding-left: 24px !important;\n  }\n`;\n\nconst BorderBar = styled.div<{ color: string }>`\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 4px;\n  height: 100%;\n  background: ${(props) => props.color};\n  transition: all 0.2s ease-in-out;\n`;\n\nconst TitleContent = styled.div`\n  & > * {\n    margin-left: -24px;\n    padding-left: 24px !important;\n  }\n`;\n\nconst TitleBox = styled(Title) <{ paddingRight?: number }>`\npadding-right: ${(props) => props.paddingRight}px;\n\n& .data-comment-bubbles {\n  left: ${(props) => props.paddingRight}px;\n}\n`;\n\nexport interface SubjectProps {\n  controller: Controller;\n  node: Block<Heading1Data>;\n  attributes: Record<string, string>;\n  config: SubjectConfig;\n}\n\n/**\n * 议题区块\n * @param props\n * @returns\n * @todo 标题 margin 会导致 border 在折叠状态下偏长，这个比较难解\n */\nconst Subject: React.FC<SubjectProps> = (props) => {\n  const {\n    node,\n    attributes,\n    controller,\n    children,\n    config,\n  } = props;\n\n  const { disableFold = false, locale = {}, review: reviewConfig } = config;\n  const {\n    renderMeetingClock: MeetingClock,\n  } = reviewConfig || {};\n  const { topicTitlePlaceholderBefore, topicTitlePlaceholderAfter } = locale;\n  const fold = useUserData(node, 'fold') || false;\n  const { subjectPr = {} } = node.data;\n  const { id, name } = subjectPr;\n  const [toolWidth, setToolWidth] = React.useState(0);\n  const toolRef = React.useRef<HTMLDivElement>(null);\n\n  const handleFoldChange = React.useCallback((_fold: boolean) => {\n    const first = node.nodes[0];\n    controller.run('onAction', toggleFold({\n      node: first as Block,\n      fold: _fold,\n    }));\n  }, [controller, node]);\n\n  const refreshToolWidth = React.useCallback(() => {\n    const tool = toolRef.current;\n    if (tool && tool.offsetWidth !== toolWidth) {\n      setToolWidth(tool.offsetWidth);\n    }\n  }, [toolWidth]);\n\n  React.useLayoutEffect(() => {\n    refreshToolWidth();\n  }, [refreshToolWidth]);\n\n  /**\n   * 议题边框颜色 @狗毛\n   */\n  const color = React.useMemo(() => {\n    if (name === 'review') {\n      return '#F4C800';\n    }\n    if (name === 'topic') {\n      return '#0089FF';\n    }\n    if (name === 'conclusion') {\n      return '#00B042';\n    }\n    return '#0089FF';\n  }, [name]);\n\n  // 切割议题的标题和内容块\n  let titleNode: Block;\n  let titleElement: React.ReactNode;\n  let contentElements: React.ReactNode[];\n\n  if (Array.isArray(children) && children.length >= 1) {\n    titleNode = node.nodes[0] as Block;\n    titleElement = children[0];\n    contentElements = children.slice(1);\n  } else {\n    return <>{children}</>;\n  }\n\n  const displayTitlePlaceholder = (item: Block) => {\n    // 类型是议题 && 非预览模式 && 没有标题 && 有 placeholder 文字配置才展示\n    if (name === 'topic' && isEmptyNode(item) && topicTitlePlaceholderBefore && topicTitlePlaceholderAfter) {\n      return true;\n    }\n    return false;\n  };\n\n  const renderTitleToolbar = () => {\n    const toolbars = [];\n\n    if (name === 'topic') {\n      MeetingClock && toolbars.push(<MeetingClock node={node} />);\n    }\n\n    return toolbars;\n  };\n\n  const renderTitlePlaceholder = () => {\n    if (name === 'topic') {\n      return (\n        <InlinePlaceholder>\n          {topicTitlePlaceholderBefore}\n          {' @ '}\n          {topicTitlePlaceholderAfter}\n        </InlinePlaceholder>\n      );\n    }\n    return '';\n  };\n\n\n  return (\n    <SubjectBox\n      {...attributes}\n      id={id}\n      data-name=\"subject-group\"\n      data-type={node.type}\n      data-foldable\n      data-cangjie-group-block\n      paddingRight={toolWidth}\n    >\n      <BorderBar color={color} />\n      <TitleBox\n        dataName=\"subject-group-title\"\n        fold={fold}\n        onChange={handleFoldChange}\n        disabled={disableFold}\n        paddingRight={toolWidth}\n      >\n        <TitleContent data-name=\"subject-group-title-content\">\n          <Placeholder\n            controller={controller}\n            node={titleNode}\n            display={displayTitlePlaceholder}\n            placeholder={renderTitlePlaceholder()}\n          >\n            {titleElement}\n          </Placeholder>\n        </TitleContent>\n        <ToolBox ref={toolRef}>\n          {renderTitleToolbar()}\n        </ToolBox>\n      </TitleBox>\n      <ContentBox config={config} dataName=\"subject-group-content\" controller={controller} node={node} fold={!disableFold && fold} paddingRight={toolWidth}>\n        {contentElements}\n      </ContentBox>\n    </SubjectBox>\n  );\n};\n\nSubject.displayName = 'Subject';\n\nexport default Subject;\n"],"file":"subject.js"}