{"version":3,"sources":["../../../../src/plugins/calendarCard/createRenderNode.tsx"],"names":["TimeTextParagraph","PlaceTextParagraph","SubjectParagraph","ReceiversParagraph","CommentTextParagraph","CommentTextWrapper","ContainerWrapper","BodyWrapper","SubjectPlaceholder","TimePlaceholder","CalendarCardPlugin","createRenderNode","cardConfig","locale","isMobile","mode","calendarMode","rest","props","node","metadata","data","CalendarType","SHANHUI","clickTimeout","CalendarCardContainer","jumpToCalendar","openProfile","time","place","comment","subject","redirectUrl","isPlaceholder","jumpToCalendarFactory","eventType","event","preventDefault","stopPropagation","style","setStyle","color","height","width","border","clickTimeRef","handleMouseDown","current","Date","getTime","handleClick","undefined","JumpToCalendarEventType","RECEIVER"],"mappings":"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","sourcesContent":["import React, { CSSProperties, useCallback, useEffect, useRef, useState } from 'react';\nimport { memoize } from 'lodash-es';\nimport { Block, RenderNodeProps } from '@ali/4ever-cangjie';\nimport { CalendarCardPlugin } from '@ali/4ever-bamboo';\nimport FlashCalendarCardContainer from './shanhui/FlashCalendarCardContainer';\nimport { ZhiCalendarCardPluginConfig, JumpToCalendarEventType, CalendarType } from './type';\n\nconst {\n  TimeTextParagraph,\n  PlaceTextParagraph,\n  SubjectParagraph,\n  ReceiversParagraph,\n  CommentTextParagraph,\n  CommentTextWrapper,\n  ContainerWrapper,\n  BodyWrapper,\n  SubjectPlaceholder,\n  TimePlaceholder,\n} = CalendarCardPlugin;\n\nexport default function createRenderNode(cardConfig: ZhiCalendarCardPluginConfig) {\n  const { locale, isMobile, mode: calendarMode, ...rest } = cardConfig;\n  return (props: RenderNodeProps<Block>) => {\n    const { node } = props;\n    const { metadata } = node.data as CalendarCardPlugin.CalendarCardDataType;\n    const { mode = calendarMode } = metadata;\n\n    if (mode === CalendarType.SHANHUI) {\n      return (\n        <FlashCalendarCardContainer\n          {...rest}\n          metadata={metadata}\n          locale={locale}\n        />\n      );\n    }\n\n    return (\n      <CalendarCardContainer\n        {...rest}\n        metadata={metadata}\n        locale={locale}\n      />\n    );\n  };\n}\n// 当mousedown与click之间的间隔少于150ms时认为是点击点击而不是拖动选中\nconst clickTimeout = 150;\ninterface IProps {\n  locale?: {\n    refresh: string;\n    refreshTips: string; // 日程卡片有更新\n    receiverCount: string; // 等{count}人参会\n    viewCalendardetails: string; // 查看日程详情\n    noresponse: string; // 未响应\n    received: string; // 已接收\n    refused: string; // 已拒绝\n    pending: string; // 待定\n    organizer: string; // 组织人\n  };\n  metadata: CalendarCardPlugin.CalendarCardMetadataType;\n  jumpToCalendar?: (link?: string, eventType?: JumpToCalendarEventType) => void;\n  openProfile?: (uid: number) => void;\n}\n\nfunction CalendarCardContainer(props: IProps) {\n  const { locale, metadata, jumpToCalendar, openProfile } = props;\n  const { time, place, comment, subject = '', redirectUrl, isPlaceholder } = metadata;\n  const jumpToCalendarFactory = useCallback(memoize((eventType?: JumpToCalendarEventType) => {\n    return (event: React.MouseEvent<Element>) => {\n      event.preventDefault();\n      event.stopPropagation();\n      if (!jumpToCalendar) return;\n      if (isPlaceholder) return;\n      jumpToCalendar(redirectUrl, eventType);\n    };\n  }), [jumpToCalendar]);\n  const [style, setStyle] = useState<CSSProperties>({});\n  useEffect(() => {\n    setStyle({\n      color: isPlaceholder ? 'rgba(17,31,44,0.4)' : '',\n      height: 'auto',\n      width: 'auto',\n      border: '1px solid rgba(17,31,44,0)',\n    });\n  }, [isPlaceholder]);\n  const clickTimeRef = useRef<number | undefined>();\n  const handleMouseDown = useCallback((event: React.SyntheticEvent) => {\n    clickTimeRef.current = new Date().getTime();\n    event.stopPropagation();\n  }, []);\n  const handleClick = useCallback((event: React.SyntheticEvent) => {\n    if (!clickTimeRef.current || (new Date().getTime() - clickTimeRef.current) > clickTimeout) {\n      event.stopPropagation();\n    }\n    clickTimeRef.current = undefined;\n  }, []);\n\n  return (\n    <ContainerWrapper\n      onMouseDown={handleMouseDown}\n      onClick={handleClick}\n      style={style}\n    >\n      <BodyWrapper>\n        <SubjectParagraph\n          isPlaceholder={isPlaceholder}\n          metadata={metadata}\n          subject={isPlaceholder ? <SubjectPlaceholder>{subject}</SubjectPlaceholder> : subject}\n          jumpToCalendar={jumpToCalendarFactory(JumpToCalendarEventType.RECEIVER)}\n        />\n        <TimeTextParagraph>\n          {isPlaceholder ? <TimePlaceholder>{time}</TimePlaceholder> : time}\n        </TimeTextParagraph>\n        <PlaceTextParagraph>{place}</PlaceTextParagraph>\n        <ReceiversParagraph\n          locale={locale}\n          metadata={metadata}\n          openProfile={openProfile}\n          jumpToCalendar={jumpToCalendarFactory(JumpToCalendarEventType.RECEIVER)}\n        />\n        {comment ? (\n          <CommentTextParagraph>\n            <CommentTextWrapper>{comment}</CommentTextWrapper>\n          </CommentTextParagraph>\n        ) : null}\n      </BodyWrapper>\n    </ContainerWrapper>\n  );\n}\n"],"file":"createRenderNode.js"}