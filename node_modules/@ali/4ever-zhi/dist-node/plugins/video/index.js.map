{"version":3,"sources":["../../../../src/plugins/video/index.tsx"],"names":["FileTypeMap","VideoPlayer","MobileEmbedCard","EmbedFailedCard","EmbedPlugin","createEmbedPlugin","config","onDownloadFile","props","node","data","src","name","type","size","embedConfig","video","downloadFile","handleMediaLoadError","onMediaLoadError","handleMediaLoadSuccess","onMediaLoadSuccess","renderCard","onPreview","renderPreview","isSelected","transformVideoURL","renderVideoMask","setTempPosterUrl","allowDownload","locale","allowFullscreen","renderNode","embed","_","next","Video","errorType","viewType","attributes"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport {\n  EmbedPlugin,\n} from '@ali/4ever-bamboo';\n\nconst {\n  FileTypeMap,\n  VideoPlayer,\n  MobileEmbedCard,\n  EmbedFailedCard,\n} = EmbedPlugin;\n\nexport default function createEmbedPlugin(config) {\n  const onDownloadFile = (props) => {\n    const { node } = props;\n    const { data } = node;\n    const { src, name, type, size } = data;\n    const embedConfig = config.video || {};\n    const { downloadFile } = embedConfig;\n    if (downloadFile) {\n      downloadFile(src, {\n        name,\n        type,\n        size,\n      });\n    }\n  };\n\n  const handleMediaLoadError = (src) => {\n    const embedConfig = config.video || {};\n    const { onMediaLoadError } = embedConfig;\n    if (onMediaLoadError) {\n      onMediaLoadError(src);\n    }\n  };\n\n  const handleMediaLoadSuccess = (src) => {\n    const embedConfig = config.video || {};\n    const { onMediaLoadSuccess } = embedConfig;\n    if (onMediaLoadSuccess) {\n      onMediaLoadSuccess(src);\n    }\n  };\n\n  const renderCard = (props) => {\n    const { node, onPreview } = props;\n    const { data } = node;\n    const { src, name, type, size } = data;\n\n    return (\n      <MobileEmbedCard\n        name={name}\n        onPreview={onPreview}\n        src={src}\n        type={type}\n        size={size}\n      />\n    );\n  };\n\n  const renderPreview = (props) => {\n    const {\n      isSelected, node,\n    } = props;\n\n    const {\n      transformVideoURL, renderVideoMask, setTempPosterUrl,\n      downloadFile, allowDownload, locale, allowFullscreen,\n    } = config.video || {};\n\n    return (\n      <VideoPlayer\n        transformVideoURL={transformVideoURL}\n        onMediaLoadSuccess={handleMediaLoadSuccess}\n        onMediaLoadError={handleMediaLoadError}\n        setTempPosterUrl={setTempPosterUrl}\n        node={node}\n        isSelected={isSelected}\n        renderVideoMask={renderVideoMask}\n        allowDownload={downloadFile && allowDownload}\n        onDownload={() => onDownloadFile(props)}\n        locale={locale}\n        allowFullscreen={allowFullscreen}\n      />\n    );\n  };\n\n  return {\n    renderNode: {\n      embed: (props, _, next) => {\n        const { node } = props;\n        if (node.data.type === FileTypeMap.Video && node.data.errorType) {\n          return <EmbedFailedCard node={node} locale={config?.video?.locale || {}} />;\n        }\n  \n        if (node.data.type === FileTypeMap.Video && node.data.src) {\n          const { data } = node;\n          const { viewType } = data;\n          const { attributes } = props;\n          return (\n            <div\n              {...attributes}\n            >\n              {viewType === 'preview' ? renderPreview(props) : renderCard(props)}\n            </div>\n          );\n        }\n        return next();\n      },\n    },\n  };\n}\n"],"file":"index.js"}