{"version":3,"sources":["../../../../src/plugins/heading/HeadingWrapper.tsx"],"names":["HeadingWrapper","props","controller","onHeadingsChange","children","headingsRef","React","useRef","dataValue","query","value","useEffect","headings","current","displayName"],"mappings":";;;;;;;;;;;AAAA;;AAEA;;AACA;;AAOA,MAAMA,cAA6C,GAAIC,KAAD,IAAW;AAC/D,QAAM;AACJC,IAAAA,UADI;AAEJC,IAAAA,gBAFI;AAGJC,IAAAA;AAHI,MAIFH,KAJJ;AAMA,QAAMI,WAAW,GAAGC,KAAK,CAACC,MAAN,CAA6B,EAA7B,CAApB,CAP+D,CAQ/D;;AACA,QAAMC,SAAgB,GAAGN,UAAU,CAACO,KAAX,CAAiB,cAAjB,KAAoCP,UAAU,CAACQ,KAAxE;AAEAJ,EAAAA,KAAK,CAACK,SAAN,CAAgB,wCAAuB,MAAM;AAC3C,UAAMC,QAAQ,GAAG,6BAAYJ,SAAZ,CAAjB;;AACA,QAAI,CAAC,4BAAMI,QAAN,EAAgBP,WAAW,CAACQ,OAA5B,CAAD,IAAyC,OAAOV,gBAAP,KAA4B,UAAzE,EAAqF;AACnFA,MAAAA,gBAAgB,CAACS,QAAD,CAAhB;AACD;;AACDP,IAAAA,WAAW,CAACQ,OAAZ,GAAsBD,QAAtB;AACD,GANe,CAAhB,EAMI,CAACJ,SAAD,CANJ;AAQA,SAAOJ,QAAP;AACD,CApBD;;AAsBAJ,cAAc,CAACc,WAAf,GAA6B,gBAA7B;eAEed,c","sourcesContent":["import * as React from 'react';\nimport { Controller, Value } from '@ali/4ever-cangjie';\nimport { getHeadings, IHeadingItem, throttleByIdleCallback } from '@ali/4ever-bamboo';\nimport equal from 'fast-deep-equal';\n\nexport interface HeadingWrapperProps {\n  controller: Controller;\n  onHeadingsChange: (headings) => void;\n}\n\nconst HeadingWrapper: React.FC<HeadingWrapperProps> = (props) => {\n  const {\n    controller,\n    onHeadingsChange,\n    children,\n  } = props;\n\n  const headingsRef = React.useRef<IHeadingItem[]>([]);\n  // query dataValue 是为了兼容 pi 的场景\n  const dataValue: Value = controller.query('getDataValue') || controller.value;\n\n  React.useEffect(throttleByIdleCallback(() => {\n    const headings = getHeadings(dataValue);\n    if (!equal(headings, headingsRef.current) && typeof onHeadingsChange === 'function') {\n      onHeadingsChange(headings);\n    }\n    headingsRef.current = headings;\n  }), [dataValue]);\n\n  return children as React.ReactElement;\n};\n\nHeadingWrapper.displayName = 'HeadingWrapper';\n\nexport default HeadingWrapper;\n"],"file":"HeadingWrapper.js"}