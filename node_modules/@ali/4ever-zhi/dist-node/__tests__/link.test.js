"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var React = _interopRequireWildcard(require("react"));

var _react2 = require("@testing-library/react");

var _everDevTest = require("@ali/4ever-dev-test");

require("@testing-library/jest-dom/extend-expect");

var _reader = _interopRequireDefault(require("./reader"));

var _link = _interopRequireDefault(require("./fixtures/link.json"));

var _linkInCardStyle = _interopRequireDefault(require("./fixtures/linkInCardStyle.json"));

var _blockLinkCard = _interopRequireDefault(require("./fixtures/blockLinkCard.json"));

const _createElement = /*#__PURE__*/React.createElement;
describe('Zhi:link', () => {
  const openLink = jest.fn();
  let spiedWindowOpen;
  let spiedConsoleError;
  beforeAll(() => {
    spiedWindowOpen = jest.spyOn(window, 'open');
    spiedWindowOpen.mockImplementation(openLink);
  });
  afterAll(() => {
    spiedConsoleError.mockRestore();
    spiedWindowOpen.mockRestore();
  });
  afterEach(() => {
    openLink.mockReset();
  });
  it('正确渲染', () => {
    const asl = ['root', _link.default];
    const {
      container
    } = (0, _react2.render)( /*#__PURE__*/_createElement(_reader.default, {
      content: asl
    }));
    expect(container).toMatchSnapshot();
  });
  it('正确渲染 unlink 链接', () => {
    const asl = ['root', ["p", ['span', {
      'data-type': 'text'
    }, ['span', {
      'data-type': 'leaf',
      'unlink': {}
    }, 'www.baidu.com']]]];
    const {
      container
    } = (0, _react2.render)( /*#__PURE__*/_createElement(_reader.default, {
      content: asl
    }));
    expect(container).toMatchSnapshot();
    const linkButton = container.querySelector('a');
    expect(linkButton).not.toBeInTheDocument();
  });
  it('点击链接触发 onOpenLink 事件', () => {
    const asl = ['root', _link.default];
    const handleOpenLink = jest.fn();
    const {
      container
    } = (0, _react2.render)( /*#__PURE__*/_createElement(_reader.default, {
      content: asl,
      openLink: handleOpenLink
    }));
    const linkButton = container.querySelector('a');

    _everDevTest.fireEvent.click(linkButton);

    expect(handleOpenLink).toHaveBeenCalledWith('https://www.baidu.com/');
  });
});
describe('Zhi:linkInCardStyle', () => {
  // 链接卡片依赖于 we-design 不应该使用 snapshot
  it('正确渲染', () => {
    const asl = ['root', _linkInCardStyle.default];
    const reader = (0, _react2.render)( /*#__PURE__*/_createElement(_reader.default, {
      content: asl
    }));
    expect(reader.getByTestId('link-card')).toBeTruthy();
  });
  it('对于没有获得图片的「百度」链接，显示默认占位图', () => {
    const asl = ['root', ["p", ["a", {
      "href": "www.baidu.com/",
      "cardInfo": {
        "title": "百度",
        "width": 480,
        "height": 150,
        "desc": "测试测试",
        "displayType": "card"
      }
    }]]];
    const {
      container
    } = (0, _react2.render)( /*#__PURE__*/_createElement(_reader.default, {
      content: asl
    }));
    const image = container.querySelector('.background-img');
    expect(getComputedStyle(image).backgroundImage).toBe('url(https://img.alicdn.com/imgextra/i3/O1CN01n0JkDW1cBtqqiRXkU_!!6000000003563-2-tps-128-128.png)');
  });
  it('点击链接触发 onOpenLink 事件', () => {
    const asl = ['root', _linkInCardStyle.default];
    const handleOpenLink = jest.fn();
    const reader = (0, _react2.render)( /*#__PURE__*/_createElement(_reader.default, {
      content: asl,
      openLink: handleOpenLink
    }));
    const linkButton = reader.queryByText('link');

    _everDevTest.fireEvent.click(linkButton);

    expect(handleOpenLink).toHaveBeenCalledWith('https://www.baidu.com/');
  });
});
describe('Zhi:blockLinkCard', () => {
  // 链接卡片依赖于 we-design 不应该使用 snapshot
  it('正确渲染', () => {
    const asl = ['root', _blockLinkCard.default];
    const reader = (0, _react2.render)( /*#__PURE__*/_createElement(_reader.default, {
      content: asl
    }));
    expect(reader.getByTestId('link-card')).toBeTruthy();
  });
  it('对于没有获得图片的「百度」链接，显示默认占位图', () => {
    const asl = ['root', ["card", {
      "cardType": "link",
      "height": 88,
      "spacing": {
        "before": 10,
        "after": 10
      },
      "metadata": {
        "text": "1234",
        "href": "www.baidu.com/",
        "cardInfo": {
          "title": "百度",
          "width": 480,
          "height": 150,
          "desc": "测试测试",
          "displayType": "card"
        }
      }
    }, ["span", {
      "data-type": "text"
    }, ["span", {
      "data-type": "leaf"
    }, ""]]]];
    const {
      container
    } = (0, _react2.render)( /*#__PURE__*/_createElement(_reader.default, {
      content: asl
    }));
    const image = container.querySelector('.background-img');
    expect(getComputedStyle(image).backgroundImage).toBe('url(https://img.alicdn.com/imgextra/i3/O1CN01n0JkDW1cBtqqiRXkU_!!6000000003563-2-tps-128-128.png)');
  });
  it('点击链接触发 onOpenLink 事件', () => {
    const asl = ['root', _blockLinkCard.default];
    const handleOpenLink = jest.fn();
    const reader = (0, _react2.render)( /*#__PURE__*/_createElement(_reader.default, {
      content: asl,
      openLink: handleOpenLink
    }));
    const linkButton = reader.queryByText('百度');

    _everDevTest.fireEvent.click(linkButton);

    expect(handleOpenLink).toHaveBeenCalledWith('http://www.baidu.com/');
  });
});
//# sourceMappingURL=link.test.js.map