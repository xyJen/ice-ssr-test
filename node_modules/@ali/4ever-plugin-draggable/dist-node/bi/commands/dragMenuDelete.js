"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = dragMenuDelete;

var _everCangjie = require("@ali/4ever-cangjie");

var _everPluginParagraph = require("@ali/4ever-plugin-paragraph");

var _utils = require("../utils");

var _getIndexOfNode = _interopRequireDefault(require("../utils/getIndexOfNode"));

function dragMenuDelete(controller, payload) {
  const {
    node: currentBlock
  } = payload;
  const {
    document
  } = controller.value;
  const blocks = (0, _utils.getSiblingDraggableBlocks)(controller, currentBlock); // 创建空段落聚焦

  const text = _everCangjie.Text.create('');

  const paragraph = _everPluginParagraph.Paragraph.create({
    nodes: [text]
  });

  const parent = document.getParent(currentBlock.key);
  if (!parent) return controller;
  const index = (0, _getIndexOfNode.default)(currentBlock, parent.nodes);

  const anchor = _everCangjie.TextPoint.create({
    key: text.key,
    offset: 0
  });

  controller.command(_everCangjie.Commands.insertNodeByKey, parent.key, index, paragraph).command(_everCangjie.Commands.select, _everCangjie.Selection.create({
    anchor,
    focus: anchor
  })); // 删除选中节点

  blocks?.forEach(block => controller.command(_everCangjie.Commands.removeNodeByKey, block.key));
  return controller;
}
//# sourceMappingURL=dragMenuDelete.js.map