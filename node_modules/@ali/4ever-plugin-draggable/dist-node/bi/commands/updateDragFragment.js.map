{"version":3,"sources":["../../../../src/bi/commands/updateDragFragment.ts"],"names":["updateDragFragment","controller","payload","dragFragment","oldDragFragment","event","key","node","value","document","getNode","nodes","DragFragment","createDragFragment"],"mappings":";;;;;;;;;AACA;;AACA;;AACA;;AAEA;AACA;AACA;AACA;AACe,SAASA,kBAAT,CAA4BC,UAA5B,EAAoDC,OAApD,EAGZ;AACD,MAAI,CAACA,OAAL,EAAc;AACZ;AACA,UAAM;AAAEC,MAAAA,YAAY,EAAEC;AAAhB,QAAoC,qCAAiBH,UAAjB,KAAgC,EAA1E;AACA,QAAI,CAACG,eAAL,EAAsB,OAAOH,UAAP;AACtB,WAAO,wCAAoBA,UAApB,CAAP;AACD;;AAED,QAAM;AAAEI,IAAAA,KAAF;AAASC,IAAAA;AAAT,MAAiBJ,OAAvB;AACA,QAAMK,IAAI,GAAGN,UAAU,CAACO,KAAX,CAAiBC,QAAjB,CAA0BC,OAA1B,CAAkCJ,GAAlC,CAAb;AACA,MAAI,CAACC,IAAL,EAAW,OAAON,UAAP,CAVV,CAWD;;AACA,QAAMU,KAAK,GAAG,2BAAaV,UAAb,EAAyBK,GAAzB,CAAd;;AACA,QAAMH,YAAY,GAAGS,sBAAaC,kBAAb,CAAgCR,KAAhC,EAAuCM,KAAvC,EAA+CV,UAA/C,CAArB;;AACA,SAAO,uCAAeA,UAAf,EAA2BE,YAA3B,CAAP;AACD","sourcesContent":["import { Controller } from '@ali/4ever-cangjie';\nimport { updateDragFragment as updateFragment, getDraggableData, updateDraggableData } from '../model/draggableData';\nimport DragFragment from '../model/dragFragment';\nimport getDragNodes from '../utils/getDragNodes';\n\n/**\n * 更新 dragFragment，此处的内容应是排版前的原始数据\n * 使用 action 来更新，以便排版模式下劫持后在 behaviorController 中 getDragNodes\n */\nexport default function updateDragFragment(controller: Controller, payload?: {\n  event: React.DragEvent;\n  key: string;\n}) {\n  if (!payload) {\n    // 清除\n    const { dragFragment: oldDragFragment } = getDraggableData(controller) || {};\n    if (!oldDragFragment) return controller;\n    return updateDraggableData(controller);\n  }\n\n  const { event, key } = payload;\n  const node = controller.value.document.getNode(key);\n  if (!node) return controller;\n  // 获取关联的可拖拽元素\n  const nodes = getDragNodes(controller, key);\n  const dragFragment = DragFragment.createDragFragment(event, nodes!, controller);\n  return updateFragment(controller, dragFragment);\n}\n"],"file":"updateDragFragment.js"}