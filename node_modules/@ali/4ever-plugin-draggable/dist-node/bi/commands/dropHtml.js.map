{"version":3,"sources":["../../../../src/bi/commands/dropHtml.ts"],"names":["dropHtml","controller","html","selection","value","space","serializer","htmlToValue","command","Commands","insertFragmentAtRange","document","logger","sum","e","console","warn"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AAEe,SAASA,QAAT,CAAkBC,UAAlB,EAA0CC,IAA1C,EAAwD;AACrE,MAAI,CAACA,IAAL,EAAW,OAAOD,UAAP;AACX,QAAM;AAAEE,IAAAA;AAAF,MAAgBF,UAAU,CAACG,KAAjC;;AAEA,MAAI;AACF;AACA,UAAMC,KAAK,GAAG,oBAAMH,IAAN,IAAc,GAAd,GAAoB,EAAlC;AACA,UAAME,KAAK,GAAGH,UAAU,CAACK,UAAX,CAAsBC,WAAtB,CAAkCL,IAAI,GAAGG,KAAzC,CAAd;AACAJ,IAAAA,UAAU,CAACO,OAAX,CAAmBC,sBAASC,qBAA5B,EAAmDP,SAAnD,EAA8DC,KAAK,CAACO,QAApE;;AACAC,wBAAOC,GAAP,CAAW,WAAX;AACD,GAND,CAME,OAAOC,CAAP,EAAU;AACVC,IAAAA,OAAO,CAACC,IAAR,CAAaF,CAAb;;AACAF,wBAAOC,GAAP,CAAW,kBAAX;AACD;;AAED,SAAOZ,UAAP;AACD","sourcesContent":["import { Controller, Commands } from '@ali/4ever-cangjie';\nimport logger from '@ali/4ever-logger';\nimport isUrl from 'is-url';\n\nexport default function dropHtml(controller: Controller, html: string) {\n  if (!html) return controller;\n  const { selection } = controller.value;\n\n  try {\n    // url 额外插入一个空格避免后续连续文本被识别为链接\n    const space = isUrl(html) ? ' ' : '';\n    const value = controller.serializer.htmlToValue(html + space);\n    controller.command(Commands.insertFragmentAtRange, selection, value.document);\n    logger.sum('drag_html');\n  } catch (e) {\n    console.warn(e);\n    logger.sum('drag_html_failed');\n  }\n\n  return controller;\n}\n"],"file":"dropHtml.js"}