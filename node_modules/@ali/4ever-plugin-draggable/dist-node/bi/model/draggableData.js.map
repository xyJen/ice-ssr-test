{"version":3,"sources":["../../../../src/bi/model/draggableData.ts"],"names":["checkDraggableData","controller","draggableData","dragFragment","dropHolder","key","document","value","isContainTable","query","getNode","getDraggableData","data","_draggableData","updateDraggableData","rest","Object","keys","length","setData","updateDragFragment","nextDraggableData","updateDropHolder","dropPosition","updateDragHander","dragHander"],"mappings":"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","sourcesContent":["/* eslint-disable no-underscore-dangle */\nimport { Controller } from '@ali/4ever-cangjie';\nimport {\n  DragFragmentProps,\n  DraggableDataProps,\n  DropHolderProps,\n  DragHanderProps,\n} from '../types';\n\nfunction checkDraggableData(\n  controller: Controller,\n  draggableData?: DraggableDataProps,\n) {\n  if (!draggableData) return true;\n\n  const { dragFragment, dropHolder } = draggableData;\n\n  const { key } = dropHolder || {};\n\n  const { document } = controller.value;\n  if (\n    dragFragment\n    && key\n    && dragFragment.isContainTable()\n    && controller.query('isNodeInTable', document.getNode(key))\n  ) {\n    // 不允许表格拖入表格\n    return false;\n  }\n\n  return true;\n}\n\nexport function getDraggableData(controller: Controller): DraggableDataProps | undefined {\n  return controller.value.data._draggableData;\n}\n\nexport function updateDraggableData(controller: Controller, draggableData?: DraggableDataProps) {\n  if (!checkDraggableData(controller, draggableData)) {\n    return controller;\n  }\n  const { _draggableData, ...rest } = controller.value.data;\n  if (!draggableData || !Object.keys(draggableData).length) {\n    // 清除\n    return controller.setData({\n      ...rest,\n    });\n  }\n  return controller.setData({\n    ...rest,\n    _draggableData: draggableData,\n  });\n}\n\nexport function updateDragFragment(controller: Controller, dragFragment?: DragFragmentProps) {\n  const { _draggableData } = controller.value.data;\n  const nextDraggableData = {\n    ..._draggableData,\n    dragFragment,\n  };\n  if (!nextDraggableData.dragFragment) {\n    delete nextDraggableData.dragFragment;\n  }\n\n  return updateDraggableData(controller, nextDraggableData);\n}\n\nexport function updateDropHolder(controller: Controller, dropHolder?: DropHolderProps) {\n  const _draggableData = controller.value.data._draggableData as DraggableDataProps | undefined;\n  // 性能考虑，尽量避免触发 setData\n  if (!_draggableData?.dropHolder && !dropHolder) {\n    return controller;\n  }\n\n  if (\n    _draggableData?.dropHolder?.key === dropHolder?.key &&\n    _draggableData?.dropHolder?.dropPosition === dropHolder?.dropPosition\n  ) {\n    return controller;\n  }\n\n  const nextDraggableData = {\n    ..._draggableData,\n    dropHolder,\n  };\n\n  return updateDraggableData(controller, nextDraggableData);\n}\n\nexport function updateDragHander(controller: Controller, dragHander?: DragHanderProps) {\n  const { _draggableData } = controller.value.data;\n\n  const nextDraggableData = {\n    ..._draggableData,\n    dragHander,\n  };\n\n  if (!nextDraggableData.dragHander) {\n    delete nextDraggableData.dragHander;\n  }\n\n  return updateDraggableData(controller, nextDraggableData);\n}\n"],"file":"draggableData.js"}