{"version":3,"sources":["../../../../src/bi/components/dargDropdown.tsx"],"names":["removeHighlightTimer","useActiveInteraction","ActiveInteractionHooks","DragDropdown","props","controller","scale","currentBlock","onClickIcon","active","draggableConfig","customizeMenus","dragHanderclassName","disableDrag","handleClickMenuItem","locale","getCopyURL","shareParagraph","hetu","refblock","extraTransformMenu","trigger","container","document","body","highlightRef","dragMenuVisible","setDragMenuVisible","activeType","setActiveType","activeRef","React","useRef","current","timeout","actions","type","forbiddenElements","query","isForbidden","removeDragHighlight","useCallback","isTableHighlight","run","key","updateDragHighlightByType","removeAllDragHighlight","viewKey","clearPrevent","clearTimeout","onMouseUp","e","stopPropagation","startBlock","value","blocks","command","Commands","moveToEndOfNode","length","focus","handleDragStart","event","handleMouseLeave","dragData","dropHolder","setTimeout","handleMouseEnter","onVisibleChangeForHover","visible","LEGAL_EVENT","hoverMenuVisible","preventMouseMove","onVisibleChangeForClick","handleClickMenu","menuKey","updateHoverBlock","handleClick","tooltipContent","click","clickTip","drag","dragTip","padding","backgroundColor","DraggableRole","dragHand","DragIcon"],"mappings":"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","sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { useEffect, useState, useRef, useCallback } from 'react';\nimport { Dropdown, Tooltip } from '@ali/we-design';\nimport { DropdownAnimation } from '@ali/we-util';\nimport {\n  Controller,\n  Block,\n  Commands,\n  BiPluginConfig,\n} from '@ali/4ever-cangjie';\nimport {\n  useScrollableContent,\n} from '@ali/4ever-cangjie';\nimport { ActiveInteractionHooks } from '@ali/4ever-component';\nimport DragMenu from './dragMenu';\nimport {\n  DragHand,\n  TooltipText,\n  PrimaryText,\n  DragIcon,\n} from './styled';\nimport getElementType from '../utils/getElementType';\nimport { updateDragHighlight, updateDragHander, mountDragHander, removeDragHighlightSingle } from '../actions';\nimport { DraggableDataProps, DraggablePluginConfig, IMenu } from '../types';\nimport dragStartHandler from '../dragEventHandlers/dragStartHandler';\nimport { getDraggableData } from '../model/draggableData';\nimport { useLeftToolbar } from '@ali/4ever-component';\nimport { getSiblingDraggableBlocks } from '../utils';\nimport { dispatchCustomEvent, LEGAL_EVENT } from '@ali/4ever-utils';\nimport { DraggableRole } from '../../utils/role';\n\nlet removeHighlightTimer;\n\nexport interface DragHanderInnerProps extends DraggableDataProps {\n  controller: Controller;\n  scale?: number;\n  currentBlock?: Block;\n  draggableConfig: BiPluginConfig['draggable'];\n  customizeMenus?: IMenu[];\n  dragHanderclassName?: string;\n  disableDrag?: boolean;\n  /**\n   * 因为需要在hover到左侧工具栏以及其子菜单时添加的背景色都不能消失\n   * 因此仅通过监听鼠标移入移出事件无法实现\n   * 通过该回调可以在点击子菜单item，关闭子菜单后通知父组件修改hover状态\n   */\n  handleClickMenuItem?: (menuKey: string, cb: (state: boolean) => void) => void;\n  active?: boolean;\n  onClickIcon?: () => void;\n}\n\nconst { useActiveInteraction } = ActiveInteractionHooks;\n\nconst DragDropdown: React.FC<DragHanderInnerProps> = (props) => {\n  const {\n    controller,\n    scale = 1,\n    currentBlock,\n    onClickIcon,\n    active,\n    draggableConfig,\n    customizeMenus,\n    dragHanderclassName = '',\n    disableDrag,\n    handleClickMenuItem,\n  } = props;\n  const { locale, getCopyURL, shareParagraph, hetu, refblock, extraTransformMenu = [], trigger = 'hover' } = draggableConfig || {};\n  const container = useScrollableContent() || document.body;\n  // 是否触发过高亮\n  const highlightRef = useRef(false);\n\n  const [dragMenuVisible, setDragMenuVisible] = useState(false);\n  const [activeType, setActiveType] = useActiveInteraction();\n  const activeRef = React.useRef('');\n  activeRef.current = activeType;\n\n  const timeout = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  const [, actions] = useLeftToolbar();\n\n  const type = getElementType(currentBlock);\n  // 优先根据传入配置判断\n  const { forbiddenElements = {} } = controller.query('getDraggableConfig') as DraggablePluginConfig || {};\n\n  const isForbidden = forbiddenElements[type];\n\n  /**\n   * 非必要时候不要使用utils中的全局高亮移除方法\n   * 因为由于调用执行时机的问题会导致很多情况下一些\n   * 不必要移除的高亮被移除。\n   * 每个组件只需要保证对自己添加的那部分高亮进行移除即可\n   * 保证各自职责分明。\n   */\n   const removeDragHighlight = React.useCallback((type: 'hover' | 'select' = 'hover') => {\n    // 如果是表格的话就走定制背景色\n    const isTableHighlight = controller.query('isTable', currentBlock);\n    controller.run('onAction', removeDragHighlightSingle({\n      key: currentBlock?.key,\n      isTableHighlight,\n      type,\n    }));\n  }, [currentBlock]);\n\n  const updateDragHighlightByType = React.useCallback((type: 'hover' | 'select' = 'hover') => {\n    if (!currentBlock) return;\n    // 如果是表格的话就走定制背景色\n    const isTableHighlight = controller.query('isTable', currentBlock);\n    controller.run('onAction', updateDragHighlight({\n      key: currentBlock?.key,\n      isTableHighlight,\n      type,\n    }));\n  }, [currentBlock]);\n\n  const removeAllDragHighlight = React.useCallback(() => {\n    removeDragHighlight('select');\n    removeDragHighlight('hover');\n  }, [removeDragHighlight]);\n\n  useEffect(() => {\n    if (currentBlock) {\n      controller.run('onAction', updateDragHander({\n        viewKey: currentBlock?.key,\n        type: 'hover',\n      }));\n    } else {\n      controller.run('onAction', updateDragHander());\n    }\n  }, [currentBlock]);\n\n  useEffect(() => {\n    if (!dragMenuVisible && activeRef.current === 'leftMenu') {\n      setActiveType('');\n    }\n  }, [dragMenuVisible, setActiveType]);\n\n  useEffect(() => {\n    return () => {\n      actions.clearPrevent();\n      /**\n       * 组件 unmount 的时候移除高亮\n       * 这个逻辑可以保证大多数场景下被添加的高亮被移除。\n       * 但是表格的cornerToolbar例外，其生命周期跟随表格\n       * 并非在鼠标移出后卸载，因此需要在mouseLeave的时候\n       * 对高亮进行移除\n       */\n      highlightRef.current && removeAllDragHighlight();\n      timeout.current && clearTimeout(timeout.current);\n    };\n  }, [removeAllDragHighlight]);\n\n  const onMouseUp = useCallback((e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (!currentBlock) return;\n    const { startBlock } = controller.value;\n    if (currentBlock?.key === startBlock?.key) return;\n    const blocks = getSiblingDraggableBlocks(controller, currentBlock)!;\n    controller\n      .command(Commands.moveToEndOfNode, blocks[blocks.length - 1])\n      .command(Commands.focus);\n  }, [currentBlock]);\n\n  if (isForbidden || (currentBlock && controller.query('disableDrag', currentBlock))) {\n    // 销毁：dragEnd 后可能会触发 mouseenter 事件，造成不一致\n    return null;\n  }\n\n  const handleDragStart = (event: React.DragEvent) => {\n    clearTimeout(removeHighlightTimer);\n    actions.clearPrevent();\n    timeout.current && clearTimeout(timeout.current);\n    setDragMenuVisible(false);\n    // 此处能确保 dragStart 一定触发\n    dragStartHandler(event, controller, {\n      viewKey: currentBlock?.key as any,\n    });\n  };\n\n  const handleMouseLeave = () => {\n    // 这个逻辑是为了处理鼠标快速移进移出时导致下拉菜单还未显示的情况\n    // 此时高亮已经添加，如果仅依赖于visibleChange来处理高亮移除则\n    // 无法处理这种情况\n    if (!dragMenuVisible) {\n      removeDragHighlight('hover');\n    } else {\n      return;\n    }\n    // hover到button时，鼠标移动到下拉子菜单选项上也不移除block选中态\n    const dragData = getDraggableData(controller);\n    if (!dragData?.dropHolder) {\n      removeHighlightTimer = setTimeout(() => removeDragHighlight('hover'), 150);\n    }\n    timeout.current && clearTimeout(timeout.current);\n  };\n\n  const handleMouseEnter = () => {\n    highlightRef.current = true;\n    // 高亮都走 dom 直接更改，不去触发 value.data 变更，此处用 action 方便排版模式下感知\n    updateDragHighlightByType('hover');\n  };\n\n  const onVisibleChangeForHover = (visible: boolean) => {\n    // cornerToolbar菜单状态变更的时候设置对应状态，防止背景色置空\n    dispatchCustomEvent(LEGAL_EVENT.hoverMenuVisible, { visible });\n    if (visible) {\n      timeout.current = setTimeout(() => {\n        controller.run('onAction', mountDragHander());\n        setDragMenuVisible(visible);\n        actions.preventMouseMove();\n      }, 300);\n    } else {\n      actions.clearPrevent();\n      // 鼠标移出导致下拉框菜单隐藏时去掉block的背景色\n      removeDragHighlight('hover');\n      timeout.current && clearTimeout(timeout.current);\n      // 菜单延时消失逻辑\n      timeout.current = setTimeout(() => {\n        setDragMenuVisible(visible);\n      }, 200);\n    }\n  };\n\n  const onVisibleChangeForClick = (visible: boolean) => {\n    // cornerToolbar菜单状态变更的时候设置对应状态，防止背景色置空\n    dispatchCustomEvent(LEGAL_EVENT.hoverMenuVisible, { visible });\n    setDragMenuVisible(visible);\n    if (visible) {\n      controller.run('onAction', mountDragHander());\n      actions.preventMouseMove();\n    } else {\n      actions.clearPrevent();\n      // 鼠标移出导致下拉框菜单隐藏时去掉block的背景色\n      removeDragHighlight('select');\n    }\n  };\n\n  const handleClickMenu = (menuKey: string) => {\n    actions.clearPrevent();\n    actions.updateHoverBlock();\n    // 点击菜单选项后移除背景色\n    removeDragHighlight('select');\n    if (handleClickMenuItem) {\n      // 移除表格左上角汉堡的hover态\n      handleClickMenuItem(menuKey, setDragMenuVisible);\n    } else {\n      setDragMenuVisible(false);\n    }\n  };\n\n  const handleClick = () => {\n    setDragMenuVisible(true);\n    if (trigger === 'click') {\n      updateDragHighlightByType('select');\n    }\n    setActiveType('leftMenu');\n    actions.preventMouseMove();\n    onClickIcon?.();\n  };\n\n  const tooltipContent = (\n    <>\n      <TooltipText><PrimaryText>{locale?.click}</PrimaryText>{locale?.clickTip}</TooltipText>\n      <TooltipText><PrimaryText>{locale?.drag}</PrimaryText>{locale?.dragTip}</TooltipText>\n    </>\n  );\n\n  return (\n    <Dropdown\n      overlay={\n        dragMenuVisible ?\n          (\n            <DropdownAnimation\n              visible={dragMenuVisible}\n            >\n              <div onMouseUp={onMouseUp}>\n                <DragMenu\n                  locale={locale}\n                  controller={controller}\n                  extraTransformMenu={extraTransformMenu}\n                  currentBlock={currentBlock!}\n                  handleClickMenu={handleClickMenu}\n                  getCopyURL={getCopyURL}\n                  shareParagraph={shareParagraph}\n                  hetu={hetu}\n                  refblock={refblock}\n                  customizeMenus={customizeMenus}\n                />\n              </div>\n            </DropdownAnimation>) : null\n      }\n      placement=\"leftTop\"\n      trigger={trigger}\n      onVisibleChange={trigger === 'hover'? onVisibleChangeForHover : onVisibleChangeForClick}\n      getContainer={() => {\n        return container;\n      }}\n      visible={dragMenuVisible}\n      overlayAutoAlign={false}\n    >\n      <span>\n        <Tooltip\n          placement='top'\n          title={tooltipContent}\n          overlayStyle={{padding: '4px 8px', backgroundColor: 'rgba(23,26,29,1)'}}\n          disabled={dragMenuVisible || trigger === 'hover'}\n        >\n          <DragHand\n            scale={scale}\n            data-testid=\"drag-hander\"\n            draggable={!disableDrag}\n            data-drag-handler-key={currentBlock?.key}\n            onMouseEnter={handleMouseEnter}\n            onMouseLeave={handleMouseLeave}\n            onClick={handleClick}\n            onDragStart={handleDragStart}\n            data-is-hover={dragMenuVisible}\n            data-role={DraggableRole.dragHand}\n            className={dragHanderclassName}\n            active={active}\n          >\n            {DragIcon}\n          </DragHand>\n        </Tooltip>\n      </span>\n    </Dropdown>\n  );\n};\n\nexport default DragDropdown;\n"],"file":"dargDropdown.js"}