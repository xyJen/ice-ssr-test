{"version":3,"sources":["../../../../src/bi/utils/hetu.tsx"],"names":["getHetuDragMenuItems","options","block","locale","config","controller","type","metadata","cardType","data","sync","targetId","id","mimeType","injections","value","filter","i","key","syncStatus","length","types","includes","isMainSync","copyItem","TYPE_MENU_ITEM","title","copySyncLink","icon","menuExtraKey","role","onClick","toMainItem","toSyncMain","toOrigin"],"mappings":";;;;;;;;;AAAA;;AAEA;;AAIA;;uBAL4B,a;;wBAgEhB,eAAC,2BAAD,O;;yBAcE,eAAC,uBAAD,O;;AA1DP,SAASA,oBAAT,CAA8BC,OAA9B,EAKJ;AACD,QAAM;AACJC,IAAAA,KADI;AACGC,IAAAA,MADH;AACWC,IAAAA,MADX;AACmBC,IAAAA;AADnB,MAEFJ,OAFJ;AAGA,QAAM;AAAEK,IAAAA;AAAF,MAAWJ,KAAjB;AACA,QAAM;AACJK,IAAAA,QAAQ,GAAG,EADP;AAEJC,IAAAA;AAFI,MAGFN,KAAK,CAACO,IAHV;AAIA,QAAM;AAAEC,IAAAA,IAAF;AAAQC,IAAAA,QAAR;AAAkBC,IAAAA,EAAlB;AAAsBN,IAAAA,IAAI,EAAEO;AAA5B,MAAyCN,QAA/C,CATC,CAWD;;AACA,QAAMO,UAAU,GAAGT,UAAU,CAACU,KAAX,CAAiBD,UAAjB,CAA4BE,MAA5B,CAChBC,CAAD,IAAOA,CAAC,CAACC,GAAF,KAAUhB,KAAK,CAACgB,GADN,CAAnB;AAGA,MAAIC,UAAU,GAAG,EAAjB;;AACA,MAAIL,UAAU,CAACM,MAAf,EAAuB;AACrBD,IAAAA,UAAU,GAAGL,UAAU,CAAC,CAAD,CAAV,CAAcL,IAAd,CAAmBU,UAAhC;AACD,GAlBA,CAoBD;;;AACA,MAAI,EAAEb,IAAI,KAAK,MAAT,IAAmBE,QAAQ,KAAK,MAAhC,IAA0CJ,MAAM,CAACiB,KAAP,CAAaC,QAAb,CAAsBT,QAAtB,CAA5C,CAAJ,EAAkF;AAChF,WAAO,EAAP;AACD;;AACD,QAAMU,UAAU,GAAGZ,QAAQ,KAAKC,EAAhC,CAxBC,CA0BD;;AACA,MAAIO,UAAU,KAAK,SAAf,IAA6B,CAACI,UAAD,IAAe,CAAC,SAAD,EAAYD,QAAZ,CAAqBH,UAArB,CAAhD,EAAmF;AACjF,WAAO,EAAP;AACD;;AAED,MAAI,CAACT,IAAL,EAAW;AACT;AACA,WAAO,EAAP;AACD,GAHD,MAGO;AACL;AACA,UAAMc,QAAQ,GAAG;AACflB,MAAAA,IAAI,EAAEmB,6BADS;AAEfC,MAAAA,KAAK,EAAEvB,MAAM,EAAEwB,YAFA;AAGfC,MAAAA,IAAI,MAHW;AAIfC,MAAAA,YAAY,EAAE,cAJC;AAKfC,MAAAA,IAAI,EAAE,cALS;AAMfC,MAAAA,OAAO,EAAE,MAAM;AACb3B,QAAAA,MAAM,CAACuB,YAAP,CAAoBf,EAApB,EAAwBV,KAAK,CAACgB,GAA9B;AACD;AARc,KAAjB;;AAWA,QAAIK,UAAJ,EAAgB;AACd,aAAO,CAACC,QAAD,CAAP;AACD,KAFD,MAEO;AACL,YAAMQ,UAAU,GAAG;AACjB1B,QAAAA,IAAI,EAAEmB,6BADW;AAEjBC,QAAAA,KAAK,EAAEvB,MAAM,EAAE8B,UAFE;AAGjBL,QAAAA,IAAI,OAHa;AAIjBC,QAAAA,YAAY,EAAE,YAJG;AAKjBC,QAAAA,IAAI,EAAE,YALW;AAMjBC,QAAAA,OAAO,EAAE,MAAM;AACb3B,UAAAA,MAAM,CAAC8B,QAAP,CAAgBvB,QAAhB;AACD;AARgB,OAAnB;AAUA,aAAO,CAACa,QAAD,EAAWQ,UAAX,CAAP;AACD;AACF;AACF","sourcesContent":["import React from 'react';\nimport { Block, Controller } from '@ali/4ever-cangjie';\nimport {\n  CopyblocklinkNormal,\n  GotoblockNormal,\n} from '@ali/we-icon';\nimport {\n  TYPE_MENU_ITEM,\n} from '@ali/4ever-component';\n\nexport interface HetuConfig {\n  enable: boolean;\n  types: string[];\n  /** 普通插件转变为同步块并拷贝引用链接 */\n  normalToMain: (id: string, nodeKey: string) => void;\n  /** 复制引用链接 */\n  copySyncLink: (id: string, nodeKey: string) => void;\n  /** 返回原始同步块 */\n  toOrigin: (targetId: string) => void;\n}\n\nexport function getHetuDragMenuItems(options: {\n  block: Block;\n  locale: Record<string, string> | undefined;\n  config: HetuConfig;\n  controller: Controller;\n}) {\n  const {\n    block, locale, config, controller,\n  } = options;\n  const { type } = block;\n  const {\n    metadata = {},\n    cardType,\n  } = block.data;\n  const { sync, targetId, id, type: mimeType } = metadata;\n\n  // injection 在 block.data 没生效，直接从 value 获取\n  const injections = controller.value.injections.filter(\n    (i) => i.key === block.key,\n  );\n  let syncStatus = '';\n  if (injections.length) {\n    syncStatus = injections[0].data.syncStatus;\n  }\n\n  // 不支持同步块的河图插件，暂不展示\n  if (!(type === 'card' && cardType === 'hetu' && config.types.includes(mimeType))) {\n    return [];\n  }\n  const isMainSync = targetId === id;\n\n  // 如果是副本同步块，在 deleted 时，不展示\n  if (syncStatus === 'loading' || (!isMainSync && ['deleted'].includes(syncStatus))) {\n    return [];\n  }\n\n  if (!sync) {\n    // 变为同步块并 copy\n    return [];\n  } else {\n    // copyItem，但行为不一致\n    const copyItem = {\n      type: TYPE_MENU_ITEM,\n      title: locale?.copySyncLink,\n      icon: <CopyblocklinkNormal />,\n      menuExtraKey: 'copySyncLink',\n      role: \"copySyncLink\",\n      onClick: () => {\n        config.copySyncLink(id, block.key);\n      },\n    };\n\n    if (isMainSync) {\n      return [copyItem];\n    } else {\n      const toMainItem = {\n        type: TYPE_MENU_ITEM,\n        title: locale?.toSyncMain,\n        icon: <GotoblockNormal />,\n        menuExtraKey: 'toSyncMain',\n        role: \"toSyncMain\",\n        onClick: () => {\n          config.toOrigin(targetId);\n        },\n      };\n      return [copyItem, toMainItem];\n    }\n  }\n}\n"],"file":"hetu.js"}