{"version":3,"sources":["../../../../src/bi/dragEventHandlers/dragOverInlineHandler.ts"],"names":["dragOverInlineHandler","event","controller","draggableData","dragFragment","type","DRAG_TYPE","inline","range","document","selection","value","preFocus","convertToTextPoints","focus","nextFocus","key","offset","run"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AAGA;;AAKe,SAASA,qBAAT,CACbC,KADa,EAEbC,UAFa,EAGb;AACA,QAAMC,aAAa,GAAG,qCAAiBD,UAAjB,CAAtB;AACA,MAAI,CAACC,aAAL,EAAoB;AAEpB,QAAM;AAAEC,IAAAA;AAAF,MAAmBD,aAAzB,CAJA,CAKA;;AACA,MAAI,CAACC,YAAD,IAAiBA,YAAY,CAACC,IAAb,KAAsBC,iBAAUC,MAArD,EAA6D;AAE7D,QAAMC,KAAK,GAAG,oCAAsBN,UAAtB,EAAkCD,KAAlC,CAAd;AACA,MAAI,CAACO,KAAL,EAAY;AAEZ,QAAM;AAAEC,IAAAA,QAAF;AAAYC,IAAAA;AAAZ,MAA0BR,UAAU,CAACS,KAA3C;AACA,QAAMC,QAAQ,GAAGF,SAAS,CAACG,mBAAV,CAA8BJ,QAA9B,EAAwCK,KAAzD;AACA,QAAMC,SAAS,GAAGP,KAAK,CAACK,mBAAN,CAA0BJ,QAA1B,EAAoCK,KAAtD;;AACA,MACEF,QAAQ,CAACI,GAAT,KAAiBD,SAAS,CAACC,GAA3B,IACAJ,QAAQ,CAACK,MAAT,KAAoBF,SAAS,CAACE,MAFhC,EAGE;AACA;AACD,GAnBD,CAqBA;;;AACAf,EAAAA,UAAU,CAACgB,GAAX,CAAe,iBAAf,EAAkC,qCAAmB;AACnDR,IAAAA,SAAS,EAAEF;AADwC,GAAnB,CAAlC;AAGAN,EAAAA,UAAU,CAACgB,GAAX,CAAe,gBAAf;AACD","sourcesContent":["import { Controller, CangjieSelectEvent } from '@ali/4ever-cangjie';\nimport getRangeFromDragEvent from '../utils/getRangeFromDragEvent';\nimport {\n  getDraggableData,\n} from '../model/draggableData';\nimport {\n  DRAG_TYPE,\n} from '../types';\n\n\nexport default function dragOverInlineHandler(\n  event: DragEvent,\n  controller: Controller,\n) {\n  const draggableData = getDraggableData(controller);\n  if (!draggableData) return;\n\n  const { dragFragment } = draggableData;\n  // 只处理 inline 元素\n  if (!dragFragment || dragFragment.type !== DRAG_TYPE.inline) return;\n\n  const range = getRangeFromDragEvent(controller, event);\n  if (!range) return;\n\n  const { document, selection } = controller.value;\n  const preFocus = selection.convertToTextPoints(document).focus;\n  const nextFocus = range.convertToTextPoints(document).focus;\n  if (\n    preFocus.key === nextFocus.key &&\n    preFocus.offset === nextFocus.offset\n  ) {\n    return;\n  }\n\n  // UI 层拿到不到数据层 controller，使用 action 在排版模式下同步更新选区\n  controller.run('onCangjieSelect', CangjieSelectEvent({\n    selection: range,\n  }));\n  controller.run('onCangjieFocus');\n}\n"],"file":"dragOverInlineHandler.js"}