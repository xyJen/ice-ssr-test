{"version":3,"sources":["../../../../src/bi/dragEventHandlers/dragOverHandler.ts"],"names":["threshold","lastPosition","checkAndUpdatePosition","x","y","res","undefined","Math","abs","dragOverHandler","event","controller","dispatch","zoom","draggableConfig","dragFragment","nextDropHolderData","type","DRAG_TYPE","blocks","inline","autoScrollThreshold","leading"],"mappings":";;;;;;;;;;AAAA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAGA;;AAIA;;AACA;;AACA;;AAEA,MAAMA,SAAS,GAAG,CAAlB;AACA,IAAIC,YAAJ;;AAEO,SAASC,sBAAT,CAAgCC,CAAhC,EAA4CC,CAA5C,EAAwD;AAC7D,MAAIC,GAAG,GAAG,IAAV;;AACA,MAAIF,CAAC,KAAKG,SAAN,IAAmBF,CAAC,KAAKE,SAA7B,EAAwC;AACtCL,IAAAA,YAAY,GAAGK,SAAf;AACA,WAAOD,GAAP;AACD;;AACD,MAAIJ,YAAY,IAAIM,IAAI,CAACC,GAAL,CAASL,CAAC,GAAGF,YAAY,CAACE,CAA1B,IAA+BH,SAA/C,IAA4DO,IAAI,CAACC,GAAL,CAASJ,CAAC,GAAGH,YAAY,CAACG,CAA1B,IAA+BJ,SAA/F,EAA0G;AACxGK,IAAAA,GAAG,GAAG,KAAN;AACD;;AAED,MAAIA,GAAJ,EAAS;AACPJ,IAAAA,YAAY,GAAG;AACbE,MAAAA,CADa;AAEbC,MAAAA;AAFa,KAAf;AAID;;AAED,SAAOC,GAAP;AACD;;AAED,MAAMI,eAAe,GAAG,sBAAS,CAC/BC,KAD+B,EAE/BC,UAF+B,EAG/BC,QAH+B,EAI/BC,IAJ+B,EAK/BC,eAL+B,KAM5B;AACH,QAAM;AAAEC,IAAAA;AAAF,MAAmB,qCAAiBJ,UAAjB,KAAgC,EAAzD,CADG,CAEH;AACA;;AACA,MAAII,YAAY,IAAI,8BAAkBA,YAAlB,CAApB,EAAqD;AACnD,UAAMC,kBAAkB,GAAG,qCAAuBN,KAAvB,EAA8BC,UAA9B,EAA0CE,IAA1C,CAA3B;;AACA,QAAIG,kBAAJ,EAAwB;AACtBJ,MAAAA,QAAQ,CAAC,+BAAiBI,kBAAjB,CAAD,CAAR;AACD;AACF,GALD,MAKO,IAAID,YAAY,IAAI,4BAAgBA,YAAhB,CAApB,EAAmD;AACxD,uCAAqBL,KAArB,EAA4BC,UAA5B,EAAwCC,QAAxC,EAAkDC,IAAlD;AACD,GAFM,MAEA,IAAIE,YAAY,EAAEE,IAAd,KAAuBC,iBAAUC,MAArC,EAA6C;AAClD,UAAMH,kBAAkB,GAAG,mCAAqBN,KAArB,EAA4BC,UAA5B,EAAwCE,IAAxC,CAA3B;;AACA,QAAIG,kBAAJ,EAAwB;AACtBJ,MAAAA,QAAQ,CAAC,+BAAiBI,kBAAjB,CAAD,CAAR;AACD;AACF,GALM,MAKA,IAAID,YAAY,EAAEE,IAAd,KAAuBC,iBAAUE,MAArC,EAA6C;AAClD,wCAAsBV,KAAtB,EAA6BC,UAA7B;AACD,GAFM,MAEA;AACL,yCAAuBD,KAAvB,EAA8BC,UAA9B;AACD;;AAED,2BAAWD,KAAX,EAAkBI,eAAe,EAAEO,mBAAnC;AACD,CA7BuB,EA6BrB,EA7BqB,EA6BjB;AAAEC,EAAAA,OAAO,EAAE;AAAX,CA7BiB,CAAxB;eA+Beb,e","sourcesContent":["import { throttle } from 'lodash-es';\nimport { Controller } from '@ali/4ever-cangjie';\nimport dragOverBlockHandler from './dragOverBlockHandler';\nimport dragOverInlineHandler from './dragOverInlineHandler';\nimport dragOverUnknownHandler from './dragOverUnknownHandler';\nimport autoScroll from '../utils/autoScroll';\nimport { updateDropHolder, clearDropHolder } from '../actions';\nimport {\n  getDraggableData,\n} from '../model/draggableData';\nimport {\n  DRAG_TYPE,\n  DraggablePluginConfig,\n} from '../types';\nimport { isSubjectFragment, isImageFragment } from '../utils';\nimport dragOverSubjectHandler from './dragOverSubjectHandler';\nimport dragOverImageHandler from './dragOverImageHandler';\n\nconst threshold = 5;\nlet lastPosition: { x: number; y: number } | undefined;\n\nexport function checkAndUpdatePosition(x?: number, y?: number) {\n  let res = true;\n  if (x === undefined || y === undefined) {\n    lastPosition = undefined;\n    return res;\n  }\n  if (lastPosition && Math.abs(x - lastPosition.x) < threshold && Math.abs(y - lastPosition.y) < threshold) {\n    res = false;\n  }\n\n  if (res) {\n    lastPosition = {\n      x,\n      y,\n    };\n  }\n\n  return res;\n}\n\nconst dragOverHandler = throttle((\n  event: DragEvent,\n  controller: Controller,\n  dispatch: React.Dispatch<any>,\n  zoom: number,\n  draggableConfig?: DraggablePluginConfig,\n) => {\n  const { dragFragment } = getDraggableData(controller) || {};\n  // 若 fragment 是议题区块，则不能分割其他议题\n  // TODO: callout 参照实现\n  if (dragFragment && isSubjectFragment(dragFragment)) {\n    const nextDropHolderData = dragOverSubjectHandler(event, controller, zoom);\n    if (nextDropHolderData) {\n      dispatch(updateDropHolder(nextDropHolderData));\n    }\n  } else if (dragFragment && isImageFragment(dragFragment)) {\n    dragOverImageHandler(event, controller, dispatch, zoom);\n  } else if (dragFragment?.type === DRAG_TYPE.blocks) {\n    const nextDropHolderData = dragOverBlockHandler(event, controller, zoom);\n    if (nextDropHolderData) {\n      dispatch(updateDropHolder(nextDropHolderData));\n    }\n  } else if (dragFragment?.type === DRAG_TYPE.inline) {\n    dragOverInlineHandler(event, controller);\n  } else {\n    dragOverUnknownHandler(event, controller);\n  }\n\n  autoScroll(event, draggableConfig?.autoScrollThreshold);\n}, 50, { leading: true });\n\nexport default dragOverHandler;\n"],"file":"dragOverHandler.js"}