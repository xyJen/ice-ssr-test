{"version":3,"sources":["../../../../src/bi/components/dargDropdown.tsx"],"names":["React","useEffect","useState","useRef","useCallback","Dropdown","Tooltip","DropdownAnimation","Commands","useScrollableContent","ActiveInteractionHooks","DragMenu","DragHand","TooltipText","PrimaryText","DragIcon","getElementType","updateDragHighlight","updateDragHander","mountDragHander","removeDragHighlightSingle","dragStartHandler","getDraggableData","useLeftToolbar","getSiblingDraggableBlocks","dispatchCustomEvent","LEGAL_EVENT","DraggableRole","removeHighlightTimer","useActiveInteraction","DragDropdown","props","controller","scale","currentBlock","onClickIcon","active","draggableConfig","customizeMenus","dragHanderclassName","disableDrag","handleClickMenuItem","locale","getCopyURL","shareParagraph","hetu","refblock","extraTransformMenu","trigger","container","document","body","highlightRef","dragMenuVisible","setDragMenuVisible","activeType","setActiveType","activeRef","current","timeout","actions","type","query","forbiddenElements","isForbidden","removeDragHighlight","isTableHighlight","run","key","updateDragHighlightByType","removeAllDragHighlight","viewKey","clearPrevent","clearTimeout","onMouseUp","e","stopPropagation","startBlock","value","blocks","command","moveToEndOfNode","length","focus","handleDragStart","event","handleMouseLeave","dragData","dropHolder","setTimeout","handleMouseEnter","onVisibleChangeForHover","visible","hoverMenuVisible","preventMouseMove","onVisibleChangeForClick","handleClickMenu","menuKey","updateHoverBlock","handleClick","tooltipContent","click","clickTip","drag","dragTip","padding","backgroundColor","dragHand"],"mappings":"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","sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { useEffect, useState, useRef, useCallback } from 'react';\nimport { Dropdown, Tooltip } from '@ali/we-design';\nimport { DropdownAnimation } from '@ali/we-util';\nimport {\n  Controller,\n  Block,\n  Commands,\n  BiPluginConfig,\n} from '@ali/4ever-cangjie';\nimport {\n  useScrollableContent,\n} from '@ali/4ever-cangjie';\nimport { ActiveInteractionHooks } from '@ali/4ever-component';\nimport DragMenu from './dragMenu';\nimport {\n  DragHand,\n  TooltipText,\n  PrimaryText,\n  DragIcon,\n} from './styled';\nimport getElementType from '../utils/getElementType';\nimport { updateDragHighlight, updateDragHander, mountDragHander, removeDragHighlightSingle } from '../actions';\nimport { DraggableDataProps, DraggablePluginConfig, IMenu } from '../types';\nimport dragStartHandler from '../dragEventHandlers/dragStartHandler';\nimport { getDraggableData } from '../model/draggableData';\nimport { useLeftToolbar } from '@ali/4ever-component';\nimport { getSiblingDraggableBlocks } from '../utils';\nimport { dispatchCustomEvent, LEGAL_EVENT } from '@ali/4ever-utils';\nimport { DraggableRole } from '../../utils/role';\n\nlet removeHighlightTimer;\n\nexport interface DragHanderInnerProps extends DraggableDataProps {\n  controller: Controller;\n  scale?: number;\n  currentBlock?: Block;\n  draggableConfig: BiPluginConfig['draggable'];\n  customizeMenus?: IMenu[];\n  dragHanderclassName?: string;\n  disableDrag?: boolean;\n  /**\n   * 因为需要在hover到左侧工具栏以及其子菜单时添加的背景色都不能消失\n   * 因此仅通过监听鼠标移入移出事件无法实现\n   * 通过该回调可以在点击子菜单item，关闭子菜单后通知父组件修改hover状态\n   */\n  handleClickMenuItem?: (menuKey: string, cb: (state: boolean) => void) => void;\n  active?: boolean;\n  onClickIcon?: () => void;\n}\n\nconst { useActiveInteraction } = ActiveInteractionHooks;\n\nconst DragDropdown: React.FC<DragHanderInnerProps> = (props) => {\n  const {\n    controller,\n    scale = 1,\n    currentBlock,\n    onClickIcon,\n    active,\n    draggableConfig,\n    customizeMenus,\n    dragHanderclassName = '',\n    disableDrag,\n    handleClickMenuItem,\n  } = props;\n  const { locale, getCopyURL, shareParagraph, hetu, refblock, extraTransformMenu = [], trigger = 'hover' } = draggableConfig || {};\n  const container = useScrollableContent() || document.body;\n  // 是否触发过高亮\n  const highlightRef = useRef(false);\n\n  const [dragMenuVisible, setDragMenuVisible] = useState(false);\n  const [activeType, setActiveType] = useActiveInteraction();\n  const activeRef = React.useRef('');\n  activeRef.current = activeType;\n\n  const timeout = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  const [, actions] = useLeftToolbar();\n\n  const type = getElementType(currentBlock);\n  // 优先根据传入配置判断\n  const { forbiddenElements = {} } = controller.query('getDraggableConfig') as DraggablePluginConfig || {};\n\n  const isForbidden = forbiddenElements[type];\n\n  /**\n   * 非必要时候不要使用utils中的全局高亮移除方法\n   * 因为由于调用执行时机的问题会导致很多情况下一些\n   * 不必要移除的高亮被移除。\n   * 每个组件只需要保证对自己添加的那部分高亮进行移除即可\n   * 保证各自职责分明。\n   */\n   const removeDragHighlight = React.useCallback((type: 'hover' | 'select' = 'hover') => {\n    // 如果是表格的话就走定制背景色\n    const isTableHighlight = controller.query('isTable', currentBlock);\n    controller.run('onAction', removeDragHighlightSingle({\n      key: currentBlock?.key,\n      isTableHighlight,\n      type,\n    }));\n  }, [currentBlock]);\n\n  const updateDragHighlightByType = React.useCallback((type: 'hover' | 'select' = 'hover') => {\n    if (!currentBlock) return;\n    // 如果是表格的话就走定制背景色\n    const isTableHighlight = controller.query('isTable', currentBlock);\n    controller.run('onAction', updateDragHighlight({\n      key: currentBlock?.key,\n      isTableHighlight,\n      type,\n    }));\n  }, [currentBlock]);\n\n  const removeAllDragHighlight = React.useCallback(() => {\n    removeDragHighlight('select');\n    removeDragHighlight('hover');\n  }, [removeDragHighlight]);\n\n  useEffect(() => {\n    if (currentBlock) {\n      controller.run('onAction', updateDragHander({\n        viewKey: currentBlock?.key,\n        type: 'hover',\n      }));\n    } else {\n      controller.run('onAction', updateDragHander());\n    }\n  }, [currentBlock]);\n\n  useEffect(() => {\n    if (!dragMenuVisible && activeRef.current === 'leftMenu') {\n      setActiveType('');\n    }\n  }, [dragMenuVisible, setActiveType]);\n\n  useEffect(() => {\n    return () => {\n      actions.clearPrevent();\n      /**\n       * 组件 unmount 的时候移除高亮\n       * 这个逻辑可以保证大多数场景下被添加的高亮被移除。\n       * 但是表格的cornerToolbar例外，其生命周期跟随表格\n       * 并非在鼠标移出后卸载，因此需要在mouseLeave的时候\n       * 对高亮进行移除\n       */\n      highlightRef.current && removeAllDragHighlight();\n      timeout.current && clearTimeout(timeout.current);\n    };\n  }, [removeAllDragHighlight]);\n\n  const onMouseUp = useCallback((e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (!currentBlock) return;\n    const { startBlock } = controller.value;\n    if (currentBlock?.key === startBlock?.key) return;\n    const blocks = getSiblingDraggableBlocks(controller, currentBlock)!;\n    controller\n      .command(Commands.moveToEndOfNode, blocks[blocks.length - 1])\n      .command(Commands.focus);\n  }, [currentBlock]);\n\n  if (isForbidden || (currentBlock && controller.query('disableDrag', currentBlock))) {\n    // 销毁：dragEnd 后可能会触发 mouseenter 事件，造成不一致\n    return null;\n  }\n\n  const handleDragStart = (event: React.DragEvent) => {\n    clearTimeout(removeHighlightTimer);\n    actions.clearPrevent();\n    timeout.current && clearTimeout(timeout.current);\n    setDragMenuVisible(false);\n    // 此处能确保 dragStart 一定触发\n    dragStartHandler(event, controller, {\n      viewKey: currentBlock?.key as any,\n    });\n  };\n\n  const handleMouseLeave = () => {\n    // 这个逻辑是为了处理鼠标快速移进移出时导致下拉菜单还未显示的情况\n    // 此时高亮已经添加，如果仅依赖于visibleChange来处理高亮移除则\n    // 无法处理这种情况\n    if (!dragMenuVisible) {\n      removeDragHighlight('hover');\n    } else {\n      return;\n    }\n    // hover到button时，鼠标移动到下拉子菜单选项上也不移除block选中态\n    const dragData = getDraggableData(controller);\n    if (!dragData?.dropHolder) {\n      removeHighlightTimer = setTimeout(() => removeDragHighlight('hover'), 150);\n    }\n    timeout.current && clearTimeout(timeout.current);\n  };\n\n  const handleMouseEnter = () => {\n    highlightRef.current = true;\n    // 高亮都走 dom 直接更改，不去触发 value.data 变更，此处用 action 方便排版模式下感知\n    updateDragHighlightByType('hover');\n  };\n\n  const onVisibleChangeForHover = (visible: boolean) => {\n    // cornerToolbar菜单状态变更的时候设置对应状态，防止背景色置空\n    dispatchCustomEvent(LEGAL_EVENT.hoverMenuVisible, { visible });\n    if (visible) {\n      timeout.current = setTimeout(() => {\n        controller.run('onAction', mountDragHander());\n        setDragMenuVisible(visible);\n        actions.preventMouseMove();\n      }, 300);\n    } else {\n      actions.clearPrevent();\n      // 鼠标移出导致下拉框菜单隐藏时去掉block的背景色\n      removeDragHighlight('hover');\n      timeout.current && clearTimeout(timeout.current);\n      // 菜单延时消失逻辑\n      timeout.current = setTimeout(() => {\n        setDragMenuVisible(visible);\n      }, 200);\n    }\n  };\n\n  const onVisibleChangeForClick = (visible: boolean) => {\n    // cornerToolbar菜单状态变更的时候设置对应状态，防止背景色置空\n    dispatchCustomEvent(LEGAL_EVENT.hoverMenuVisible, { visible });\n    setDragMenuVisible(visible);\n    if (visible) {\n      controller.run('onAction', mountDragHander());\n      actions.preventMouseMove();\n    } else {\n      actions.clearPrevent();\n      // 鼠标移出导致下拉框菜单隐藏时去掉block的背景色\n      removeDragHighlight('select');\n    }\n  };\n\n  const handleClickMenu = (menuKey: string) => {\n    actions.clearPrevent();\n    actions.updateHoverBlock();\n    // 点击菜单选项后移除背景色\n    removeDragHighlight('select');\n    if (handleClickMenuItem) {\n      // 移除表格左上角汉堡的hover态\n      handleClickMenuItem(menuKey, setDragMenuVisible);\n    } else {\n      setDragMenuVisible(false);\n    }\n  };\n\n  const handleClick = () => {\n    setDragMenuVisible(true);\n    if (trigger === 'click') {\n      updateDragHighlightByType('select');\n    }\n    setActiveType('leftMenu');\n    actions.preventMouseMove();\n    onClickIcon?.();\n  };\n\n  const tooltipContent = (\n    <>\n      <TooltipText><PrimaryText>{locale?.click}</PrimaryText>{locale?.clickTip}</TooltipText>\n      <TooltipText><PrimaryText>{locale?.drag}</PrimaryText>{locale?.dragTip}</TooltipText>\n    </>\n  );\n\n  return (\n    <Dropdown\n      overlay={\n        dragMenuVisible ?\n          (\n            <DropdownAnimation\n              visible={dragMenuVisible}\n            >\n              <div onMouseUp={onMouseUp}>\n                <DragMenu\n                  locale={locale}\n                  controller={controller}\n                  extraTransformMenu={extraTransformMenu}\n                  currentBlock={currentBlock!}\n                  handleClickMenu={handleClickMenu}\n                  getCopyURL={getCopyURL}\n                  shareParagraph={shareParagraph}\n                  hetu={hetu}\n                  refblock={refblock}\n                  customizeMenus={customizeMenus}\n                />\n              </div>\n            </DropdownAnimation>) : null\n      }\n      placement=\"leftTop\"\n      trigger={trigger}\n      onVisibleChange={trigger === 'hover'? onVisibleChangeForHover : onVisibleChangeForClick}\n      getContainer={() => {\n        return container;\n      }}\n      visible={dragMenuVisible}\n      overlayAutoAlign={false}\n    >\n      <span>\n        <Tooltip\n          placement='top'\n          title={tooltipContent}\n          overlayStyle={{padding: '4px 8px', backgroundColor: 'rgba(23,26,29,1)'}}\n          disabled={dragMenuVisible || trigger === 'hover'}\n        >\n          <DragHand\n            scale={scale}\n            data-testid=\"drag-hander\"\n            draggable={!disableDrag}\n            data-drag-handler-key={currentBlock?.key}\n            onMouseEnter={handleMouseEnter}\n            onMouseLeave={handleMouseLeave}\n            onClick={handleClick}\n            onDragStart={handleDragStart}\n            data-is-hover={dragMenuVisible}\n            data-role={DraggableRole.dragHand}\n            className={dragHanderclassName}\n            active={active}\n          >\n            {DragIcon}\n          </DragHand>\n        </Tooltip>\n      </span>\n    </Dropdown>\n  );\n};\n\nexport default DragDropdown;\n"],"file":"dargDropdown.js"}