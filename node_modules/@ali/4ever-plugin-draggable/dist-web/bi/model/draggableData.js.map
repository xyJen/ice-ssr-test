{"version":3,"sources":["../../../../src/bi/model/draggableData.ts"],"names":["checkDraggableData","controller","draggableData","dragFragment","dropHolder","key","document","value","isContainTable","query","getNode","getDraggableData","data","_draggableData","updateDraggableData","rest","Object","keys","length","setData","updateDragFragment","nextDraggableData","updateDropHolder","dropPosition","updateDragHander","dragHander"],"mappings":";;;AAAA;AASA,SAASA,kBAAT,CACEC,UADF,EAEEC,aAFF,EAGE;AACA,MAAI,CAACA,aAAL,EAAoB,OAAO,IAAP;AADpB,MAGQC,YAHR,GAGqCD,aAHrC,CAGQC,YAHR;AAAA,MAGsBC,UAHtB,GAGqCF,aAHrC,CAGsBE,UAHtB;;AAAA,aAKgBA,UAAU,IAAI,EAL9B;AAAA,MAKQC,GALR,QAKQA,GALR;;AAAA,MAOQC,QAPR,GAOqBL,UAAU,CAACM,KAPhC,CAOQD,QAPR;;AAQA,MACEH,YAAY,IACTE,GADH,IAEGF,YAAY,CAACK,cAAb,EAFH,IAGGP,UAAU,CAACQ,KAAX,CAAiB,eAAjB,EAAkCH,QAAQ,CAACI,OAAT,CAAiBL,GAAjB,CAAlC,CAJL,EAKE;AACA;AACA,WAAO,KAAP;AACD;;AAED,SAAO,IAAP;AACD;;AAED,OAAO,SAASM,gBAAT,CAA0BV,UAA1B,EAAkF;AACvF,SAAOA,UAAU,CAACM,KAAX,CAAiBK,IAAjB,CAAsBC,cAA7B;AACD;AAED,OAAO,SAASC,mBAAT,CAA6Bb,UAA7B,EAAqDC,aAArD,EAAyF;AAC9F,MAAI,CAACF,kBAAkB,CAACC,UAAD,EAAaC,aAAb,CAAvB,EAAoD;AAClD,WAAOD,UAAP;AACD;;AAH6F,8BAI1DA,UAAU,CAACM,KAAX,CAAiBK,IAJyC;AAAA,MAItFC,cAJsF,yBAItFA,cAJsF;AAAA,MAInEE,IAJmE;;AAK9F,MAAI,CAACb,aAAD,IAAkB,CAACc,MAAM,CAACC,IAAP,CAAYf,aAAZ,EAA2BgB,MAAlD,EAA0D;AACxD;AACA,WAAOjB,UAAU,CAACkB,OAAX,cACFJ,IADE,EAAP;AAGD;;AACD,SAAOd,UAAU,CAACkB,OAAX,cACFJ,IADE;AAELF,IAAAA,cAAc,EAAEX;AAFX,KAAP;AAID;AAED,OAAO,SAASkB,kBAAT,CAA4BnB,UAA5B,EAAoDE,YAApD,EAAsF;AAAA,MACnFU,cADmF,GAChEZ,UAAU,CAACM,KAAX,CAAiBK,IAD+C,CACnFC,cADmF;;AAE3F,MAAMQ,iBAAiB,gBAClBR,cADkB;AAErBV,IAAAA,YAAY,EAAZA;AAFqB,IAAvB;;AAIA,MAAI,CAACkB,iBAAiB,CAAClB,YAAvB,EAAqC;AACnC,WAAOkB,iBAAiB,CAAClB,YAAzB;AACD;;AAED,SAAOW,mBAAmB,CAACb,UAAD,EAAaoB,iBAAb,CAA1B;AACD;AAED,OAAO,SAASC,gBAAT,CAA0BrB,UAA1B,EAAkDG,UAAlD,EAAgF;AAAA;;AACrF,MAAMS,cAAc,GAAGZ,UAAU,CAACM,KAAX,CAAiBK,IAAjB,CAAsBC,cAA7C,CADqF,CAErF;;AACA,MAAI,EAACA,cAAD,YAACA,cAAc,CAAET,UAAjB,KAA+B,CAACA,UAApC,EAAgD;AAC9C,WAAOH,UAAP;AACD;;AAED,MACE,CAAAY,cAAc,QAAd,qCAAAA,cAAc,CAAET,UAAhB,2CAA4BC,GAA5B,OAAoCD,UAApC,oBAAoCA,UAAU,CAAEC,GAAhD,KACA,CAAAQ,cAAc,QAAd,sCAAAA,cAAc,CAAET,UAAhB,4CAA4BmB,YAA5B,OAA6CnB,UAA7C,oBAA6CA,UAAU,CAAEmB,YAAzD,CAFF,EAGE;AACA,WAAOtB,UAAP;AACD;;AAED,MAAMoB,iBAAiB,gBAClBR,cADkB;AAErBT,IAAAA,UAAU,EAAVA;AAFqB,IAAvB;;AAKA,SAAOU,mBAAmB,CAACb,UAAD,EAAaoB,iBAAb,CAA1B;AACD;AAED,OAAO,SAASG,gBAAT,CAA0BvB,UAA1B,EAAkDwB,UAAlD,EAAgF;AAAA,MAC7EZ,cAD6E,GAC1DZ,UAAU,CAACM,KAAX,CAAiBK,IADyC,CAC7EC,cAD6E;;AAGrF,MAAMQ,iBAAiB,gBAClBR,cADkB;AAErBY,IAAAA,UAAU,EAAVA;AAFqB,IAAvB;;AAKA,MAAI,CAACJ,iBAAiB,CAACI,UAAvB,EAAmC;AACjC,WAAOJ,iBAAiB,CAACI,UAAzB;AACD;;AAED,SAAOX,mBAAmB,CAACb,UAAD,EAAaoB,iBAAb,CAA1B;AACD","sourcesContent":["/* eslint-disable no-underscore-dangle */\nimport { Controller } from '@ali/4ever-cangjie';\nimport {\n  DragFragmentProps,\n  DraggableDataProps,\n  DropHolderProps,\n  DragHanderProps,\n} from '../types';\n\nfunction checkDraggableData(\n  controller: Controller,\n  draggableData?: DraggableDataProps,\n) {\n  if (!draggableData) return true;\n\n  const { dragFragment, dropHolder } = draggableData;\n\n  const { key } = dropHolder || {};\n\n  const { document } = controller.value;\n  if (\n    dragFragment\n    && key\n    && dragFragment.isContainTable()\n    && controller.query('isNodeInTable', document.getNode(key))\n  ) {\n    // 不允许表格拖入表格\n    return false;\n  }\n\n  return true;\n}\n\nexport function getDraggableData(controller: Controller): DraggableDataProps | undefined {\n  return controller.value.data._draggableData;\n}\n\nexport function updateDraggableData(controller: Controller, draggableData?: DraggableDataProps) {\n  if (!checkDraggableData(controller, draggableData)) {\n    return controller;\n  }\n  const { _draggableData, ...rest } = controller.value.data;\n  if (!draggableData || !Object.keys(draggableData).length) {\n    // 清除\n    return controller.setData({\n      ...rest,\n    });\n  }\n  return controller.setData({\n    ...rest,\n    _draggableData: draggableData,\n  });\n}\n\nexport function updateDragFragment(controller: Controller, dragFragment?: DragFragmentProps) {\n  const { _draggableData } = controller.value.data;\n  const nextDraggableData = {\n    ..._draggableData,\n    dragFragment,\n  };\n  if (!nextDraggableData.dragFragment) {\n    delete nextDraggableData.dragFragment;\n  }\n\n  return updateDraggableData(controller, nextDraggableData);\n}\n\nexport function updateDropHolder(controller: Controller, dropHolder?: DropHolderProps) {\n  const _draggableData = controller.value.data._draggableData as DraggableDataProps | undefined;\n  // 性能考虑，尽量避免触发 setData\n  if (!_draggableData?.dropHolder && !dropHolder) {\n    return controller;\n  }\n\n  if (\n    _draggableData?.dropHolder?.key === dropHolder?.key &&\n    _draggableData?.dropHolder?.dropPosition === dropHolder?.dropPosition\n  ) {\n    return controller;\n  }\n\n  const nextDraggableData = {\n    ..._draggableData,\n    dropHolder,\n  };\n\n  return updateDraggableData(controller, nextDraggableData);\n}\n\nexport function updateDragHander(controller: Controller, dragHander?: DragHanderProps) {\n  const { _draggableData } = controller.value.data;\n\n  const nextDraggableData = {\n    ..._draggableData,\n    dragHander,\n  };\n\n  if (!nextDraggableData.dragHander) {\n    delete nextDraggableData.dragHander;\n  }\n\n  return updateDraggableData(controller, nextDraggableData);\n}\n"],"file":"draggableData.js"}