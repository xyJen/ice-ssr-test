{"version":3,"sources":["../../../../src/bi/commands/updateDragFragment.ts"],"names":["updateDragFragment","updateFragment","getDraggableData","updateDraggableData","DragFragment","getDragNodes","controller","payload","oldDragFragment","dragFragment","event","key","node","value","document","getNode","nodes","createDragFragment"],"mappings":"AACA,SAASA,kBAAkB,IAAIC,cAA/B,EAA+CC,gBAA/C,EAAiEC,mBAAjE;AACA,OAAOC,YAAP;AACA,OAAOC,YAAP;AAEA;AACA;AACA;AACA;;AACA,eAAe,SAASL,kBAAT,CAA4BM,UAA5B,EAAoDC,OAApD,EAGZ;AACD,MAAI,CAACA,OAAL,EAAc;AACZ;AADY,eAE8BL,gBAAgB,CAACI,UAAD,CAAhB,IAAgC,EAF9D;AAAA,QAEUE,eAFV,QAEJC,YAFI;;AAGZ,QAAI,CAACD,eAAL,EAAsB,OAAOF,UAAP;AACtB,WAAOH,mBAAmB,CAACG,UAAD,CAA1B;AACD;;AANA,MAQOI,KARP,GAQsBH,OARtB,CAQOG,KARP;AAAA,MAQcC,GARd,GAQsBJ,OARtB,CAQcI,GARd;AASD,MAAMC,IAAI,GAAGN,UAAU,CAACO,KAAX,CAAiBC,QAAjB,CAA0BC,OAA1B,CAAkCJ,GAAlC,CAAb;AACA,MAAI,CAACC,IAAL,EAAW,OAAON,UAAP,CAVV,CAWD;;AACA,MAAMU,KAAK,GAAGX,YAAY,CAACC,UAAD,EAAaK,GAAb,CAA1B;AACA,MAAMF,YAAY,GAAGL,YAAY,CAACa,kBAAb,CAAgCP,KAAhC,EAAuCM,KAAvC,EAA+CV,UAA/C,CAArB;AACA,SAAOL,cAAc,CAACK,UAAD,EAAaG,YAAb,CAArB;AACD","sourcesContent":["import { Controller } from '@ali/4ever-cangjie';\nimport { updateDragFragment as updateFragment, getDraggableData, updateDraggableData } from '../model/draggableData';\nimport DragFragment from '../model/dragFragment';\nimport getDragNodes from '../utils/getDragNodes';\n\n/**\n * 更新 dragFragment，此处的内容应是排版前的原始数据\n * 使用 action 来更新，以便排版模式下劫持后在 behaviorController 中 getDragNodes\n */\nexport default function updateDragFragment(controller: Controller, payload?: {\n  event: React.DragEvent;\n  key: string;\n}) {\n  if (!payload) {\n    // 清除\n    const { dragFragment: oldDragFragment } = getDraggableData(controller) || {};\n    if (!oldDragFragment) return controller;\n    return updateDraggableData(controller);\n  }\n\n  const { event, key } = payload;\n  const node = controller.value.document.getNode(key);\n  if (!node) return controller;\n  // 获取关联的可拖拽元素\n  const nodes = getDragNodes(controller, key);\n  const dragFragment = DragFragment.createDragFragment(event, nodes!, controller);\n  return updateFragment(controller, dragFragment);\n}\n"],"file":"updateDragFragment.js"}