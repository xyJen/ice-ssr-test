{"version":3,"sources":["../../../../src/bi/commands/dropHtml.ts"],"names":["Commands","logger","isUrl","dropHtml","controller","html","selection","value","space","serializer","htmlToValue","command","insertFragmentAtRange","document","sum","e","console","warn"],"mappings":"AAAA,SAAqBA,QAArB,QAAqC,oBAArC;AACA,OAAOC,MAAP,MAAmB,mBAAnB;AACA,OAAOC,KAAP,MAAkB,QAAlB;AAEA,eAAe,SAASC,QAAT,CAAkBC,UAAlB,EAA0CC,IAA1C,EAAwD;AACrE,MAAI,CAACA,IAAL,EAAW,OAAOD,UAAP;AAD0D,MAE7DE,SAF6D,GAE/CF,UAAU,CAACG,KAFoC,CAE7DD,SAF6D;;AAIrE,MAAI;AACF;AACA,QAAME,KAAK,GAAGN,KAAK,CAACG,IAAD,CAAL,GAAc,GAAd,GAAoB,EAAlC;AACA,QAAME,KAAK,GAAGH,UAAU,CAACK,UAAX,CAAsBC,WAAtB,CAAkCL,IAAI,GAAGG,KAAzC,CAAd;AACAJ,IAAAA,UAAU,CAACO,OAAX,CAAmBX,QAAQ,CAACY,qBAA5B,EAAmDN,SAAnD,EAA8DC,KAAK,CAACM,QAApE;AACAZ,IAAAA,MAAM,CAACa,GAAP,CAAW,WAAX;AACD,GAND,CAME,OAAOC,CAAP,EAAU;AACVC,IAAAA,OAAO,CAACC,IAAR,CAAaF,CAAb;AACAd,IAAAA,MAAM,CAACa,GAAP,CAAW,kBAAX;AACD;;AAED,SAAOV,UAAP;AACD","sourcesContent":["import { Controller, Commands } from '@ali/4ever-cangjie';\nimport logger from '@ali/4ever-logger';\nimport isUrl from 'is-url';\n\nexport default function dropHtml(controller: Controller, html: string) {\n  if (!html) return controller;\n  const { selection } = controller.value;\n\n  try {\n    // url 额外插入一个空格避免后续连续文本被识别为链接\n    const space = isUrl(html) ? ' ' : '';\n    const value = controller.serializer.htmlToValue(html + space);\n    controller.command(Commands.insertFragmentAtRange, selection, value.document);\n    logger.sum('drag_html');\n  } catch (e) {\n    console.warn(e);\n    logger.sum('drag_html_failed');\n  }\n\n  return controller;\n}\n"],"file":"dropHtml.js"}