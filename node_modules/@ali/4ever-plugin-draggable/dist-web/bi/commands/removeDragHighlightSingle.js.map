{"version":3,"sources":["../../../../src/bi/commands/removeDragHighlightSingle.ts"],"names":["Heading","getSiblingDraggableBlocks","removeDragHightlightSingle","removeDragTableHightlightSingle","findDOMNodeByKey","getClosestDom","Heading1","removeDragHighlightSingle","controller","payload","key","isTableHighlight","type","block","value","document","getNode","blocks","config","query","data","calloutPr","enableSubjectGroup","isHeading1","subjectPr","group","enableBorderHighlight","forEach","node","dom","dispatch","reason"],"mappings":"AACA,SAASA,OAAT,QAAwB,2BAAxB;AACA,SAASC,yBAAT;AACA,SAASC,0BAAT,EAAqCC,+BAArC,EAAsEC,gBAAtE;AAEA,SAASC,aAAT;IAEQC,Q,GAAaN,O,CAAbM,Q;AAER;AACA;AACA;AACA;;AACA,eAAe,SAASC,yBAAT,CAAmCC,UAAnC,EAA2DC,OAA3D,EAAoE;AAAA;;AAAA,MACzEC,GADyE,GACvBD,OADuB,CACzEC,GADyE;AAAA,8BACvBD,OADuB,CACpEE,gBADoE;AAAA,MACpEA,gBADoE,sCACjD,KADiD;AAAA,sBACvBF,OADuB,CAC1CG,IAD0C;AAAA,MAC1CA,IAD0C,8BACnC,OADmC;AAEjF,MAAMC,KAAK,GAAGL,UAAU,CAACM,KAAX,CAAiBC,QAAjB,CAA0BC,OAA1B,CAAkCN,GAAG,IAAI,EAAzC,CAAd;AAEA,MAAI,CAACG,KAAL,EAAY,OAAOL,UAAP;AAEZ,MAAMS,MAAM,GAAGhB,yBAAyB,CAACO,UAAD,EAAaK,KAAb,CAAxC,CANiF,CAQjF;;AACA,MAAMK,MAAM,GAAGV,UAAU,CAACW,KAAX,CAAiB,oBAAjB,CAAf;;AACA,MAAIN,KAAK,QAAL,mBAAAA,KAAK,CAAEO,IAAP,yBAAaC,SAAb,IACDH,MAAM,IAAIA,MAAM,CAACI,kBAAjB,IAAuChB,QAAQ,CAACiB,UAAT,CAAoBV,KAApB,CAAvC,IAAqEA,KAAK,CAACO,IAAN,CAAWI,SADnF,EAEE;AACA,QAAMC,KAAK,GAAGrB,gBAAgB,CAAIS,KAAK,CAACH,GAAV,YAA9B;;AACA,QAAIe,KAAJ,EAAW;AACT,UAAId,gBAAJ,EAAsB;AACpBR,QAAAA,+BAA+B,CAACsB,KAAD,CAA/B;AACD,OAFD,MAEO;AACLvB,QAAAA,0BAA0B,CAACuB,KAAD,CAA1B;AACD;;AACD,aAAOjB,UAAP;AACD;AACF;;AACD,MAAMkB,qBAAqB,GAAGlB,UAAU,CAACW,KAAX,CAAiB,uBAAjB,CAA9B;AAEAF,EAAAA,MAAM,QAAN,YAAAA,MAAM,CAAEU,OAAR,CAAgB,UAACC,IAAD,EAAU;AACxB,QAAMC,GAAG,GAAGxB,aAAa,CAACuB,IAAD,CAAzB;;AACA,QAAIjB,gBAAJ,EAAsB;AACpBR,MAAAA,+BAA+B,CAAC0B,GAAD,CAA/B;AACD,KAFD,MAEO;AACL3B,MAAAA,0BAA0B,CAAC2B,GAAD,CAA1B;AACD;AACF,GAPD;;AASA,MAAIZ,MAAM,IAAIS,qBAAd,EAAqC;AACnClB,IAAAA,UAAU,CAACsB,QAAX,CAAoB,iBAApB,EAAuC;AACrCF,MAAAA,IAAI,EAAEX,MAD+B;AAErCL,MAAAA,IAAI,EAAJA,IAFqC;AAGrCmB,MAAAA,MAAM,EAAE;AAH6B,KAAvC;AAKD;;AAED,SAAOvB,UAAP;AACD","sourcesContent":["import { Controller, Block } from '@ali/4ever-cangjie';\nimport { Heading } from '@ali/4ever-plugin-heading';\nimport { getSiblingDraggableBlocks } from '../utils/getDragNodes';\nimport { removeDragHightlightSingle, removeDragTableHightlightSingle, findDOMNodeByKey } from '../utils/domUtils';\nimport { DraggablePluginConfig } from '../types';\nimport { getClosestDom } from '../utils';\n\nconst { Heading1 } = Heading;\n\n/**\n * 给已添加高亮可拖拽元素移除高亮（dom操作）\n * 不会引起 controller.value 变更\n */\nexport default function removeDragHighlightSingle(controller: Controller, payload) {\n  const { key, isTableHighlight = false, type = 'hover' } = payload;\n  const block = controller.value.document.getNode(key || '') as Block;\n\n  if (!block) return controller;\n\n  const blocks = getSiblingDraggableBlocks(controller, block);\n\n  // 若支持议题拖拽，则议题的背景色需要统一\n  const config = controller.query('getDraggableConfig') as DraggablePluginConfig;\n  if (block?.data?.calloutPr ||\n    (config && config.enableSubjectGroup && Heading1.isHeading1(block) && block.data.subjectPr)\n  ) {\n    const group = findDOMNodeByKey(`${block.key}-group`);\n    if (group) {\n      if (isTableHighlight) {\n        removeDragTableHightlightSingle(group);\n      } else {\n        removeDragHightlightSingle(group);\n      }\n      return controller;\n    }\n  }\n  const enableBorderHighlight = controller.query('enableBorderHighlight');\n\n  blocks?.forEach((node) => {\n    const dom = getClosestDom(node);\n    if (isTableHighlight) {\n      removeDragTableHightlightSingle(dom);\n    } else {\n      removeDragHightlightSingle(dom);\n    }\n  });\n\n  if (blocks && enableBorderHighlight) {\n    controller.dispatch('removeHighlight', {\n      node: blocks,\n      type,\n      reason: 'dragBtn',\n    });\n  }\n\n  return controller;\n}\n"],"file":"removeDragHighlightSingle.js"}