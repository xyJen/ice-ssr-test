{"version":3,"sources":["../../../../src/bi/commands/updateDragHighlight.ts"],"names":["Heading","getSiblingDraggableBlocks","addDragHighlight","addDragTableHighlight","findDOMNodeByKey","getClosestDom","Heading1","updateDragHighlight","controller","payload","key","isTableHighlight","type","block","value","document","getNode","blocks","config","query","data","calloutPr","enableSubjectGroup","isHeading1","subjectPr","group","enableBorderHighlight","forEach","node","dom","dispatch","reason"],"mappings":"AACA,SAASA,OAAT,QAAwB,2BAAxB;AACA,SAASC,yBAAT;AACA,SAASC,gBAAT,EAA2BC,qBAA3B,EAAkDC,gBAAlD;AAEA,SAASC,aAAT;IAEQC,Q,GAAaN,O,CAAbM,Q;AAER;AACA;AACA;AACA;;AACA,eAAe,SAASC,mBAAT,CAA6BC,UAA7B,EAAqDC,OAArD,EAA8D;AAAA;;AAAA,MACnEC,GADmE,GACjBD,OADiB,CACnEC,GADmE;AAAA,8BACjBD,OADiB,CAC9DE,gBAD8D;AAAA,MAC9DA,gBAD8D,sCAC3C,KAD2C;AAAA,sBACjBF,OADiB,CACpCG,IADoC;AAAA,MACpCA,IADoC,8BAC7B,OAD6B;AAE3E,MAAMC,KAAK,GAAGL,UAAU,CAACM,KAAX,CAAiBC,QAAjB,CAA0BC,OAA1B,CAAkCN,GAAG,IAAI,EAAzC,CAAd;AAEA,MAAI,CAACG,KAAL,EAAY,OAAOL,UAAP;AAEZ,MAAMS,MAAM,GAAGhB,yBAAyB,CAACO,UAAD,EAAaK,KAAb,CAAxC,CAN2E,CAQ3E;;AACA,MAAMK,MAAM,GAAGV,UAAU,CAACW,KAAX,CAAiB,oBAAjB,CAAf;;AACA,MAAIN,KAAK,QAAL,mBAAAA,KAAK,CAAEO,IAAP,yBAAaC,SAAb,IACDH,MAAM,IAAIA,MAAM,CAACI,kBAAjB,IAAuChB,QAAQ,CAACiB,UAAT,CAAoBV,KAApB,CAAvC,IAAqEA,KAAK,CAACO,IAAN,CAAWI,SADnF,EAEE;AACA,QAAMC,KAAK,GAAGrB,gBAAgB,CAAIS,KAAK,CAACH,GAAV,YAA9B;;AACA,QAAIe,KAAJ,EAAW;AACT,UAAId,gBAAJ,EAAsB;AACpBR,QAAAA,qBAAqB,CAACsB,KAAD,CAArB;AACD,OAFD,MAEO;AACLvB,QAAAA,gBAAgB,CAACuB,KAAD,CAAhB;AACD;;AACD,aAAOjB,UAAP;AACD;AACF;;AAED,MAAMkB,qBAAqB,GAAGlB,UAAU,CAACW,KAAX,CAAiB,uBAAjB,CAA9B;AAEAF,EAAAA,MAAM,QAAN,YAAAA,MAAM,CAAEU,OAAR,CAAgB,UAACC,IAAD,EAAU;AACxB,QAAMC,GAAG,GAAGxB,aAAa,CAACuB,IAAD,CAAzB;;AACA,QAAIjB,gBAAJ,EAAsB;AACpBR,MAAAA,qBAAqB,CAAC0B,GAAD,CAArB;AACD,KAFD,MAEO;AACL3B,MAAAA,gBAAgB,CAAC2B,GAAD,EAAMH,qBAAN,CAAhB;AACD;AACF,GAPD;;AASA,MAAIT,MAAM,IAAIS,qBAAd,EAAqC;AACnClB,IAAAA,UAAU,CAACsB,QAAX,CAAoB,iBAApB,EAAuC;AACrCF,MAAAA,IAAI,EAAEX,MAD+B;AAErCL,MAAAA,IAAI,EAAJA,IAFqC;AAGrCmB,MAAAA,MAAM,EAAE;AAH6B,KAAvC;AAKD;;AAED,SAAOvB,UAAP;AACD","sourcesContent":["import { Controller, Block } from '@ali/4ever-cangjie';\nimport { Heading } from '@ali/4ever-plugin-heading';\nimport { getSiblingDraggableBlocks } from '../utils/getDragNodes';\nimport { addDragHighlight, addDragTableHighlight, findDOMNodeByKey } from '../utils/domUtils';\nimport { DraggablePluginConfig } from '../types';\nimport { getClosestDom } from '../utils';\n\nconst { Heading1 } = Heading;\n\n/**\n * 给可拖拽元素加高亮（dom操作）\n * 不会引起 controller.value 变更\n */\nexport default function updateDragHighlight(controller: Controller, payload) {\n  const { key, isTableHighlight = false, type = 'hover' } = payload;\n  const block = controller.value.document.getNode(key || '') as Block;\n\n  if (!block) return controller;\n\n  const blocks = getSiblingDraggableBlocks(controller, block);\n\n  // 若支持议题拖拽，则议题的背景色需要统一\n  const config = controller.query('getDraggableConfig') as DraggablePluginConfig;\n  if (block?.data?.calloutPr ||\n    (config && config.enableSubjectGroup && Heading1.isHeading1(block) && block.data.subjectPr)\n  ) {\n    const group = findDOMNodeByKey(`${block.key}-group`);\n    if (group) {\n      if (isTableHighlight) {\n        addDragTableHighlight(group);\n      } else {\n        addDragHighlight(group);\n      }\n      return controller;\n    }\n  }\n\n  const enableBorderHighlight = controller.query('enableBorderHighlight');\n\n  blocks?.forEach((node) => {\n    const dom = getClosestDom(node);\n    if (isTableHighlight) {\n      addDragTableHighlight(dom);\n    } else {\n      addDragHighlight(dom, enableBorderHighlight);\n    }\n  });\n\n  if (blocks && enableBorderHighlight) {\n    controller.dispatch('updateHighlight', {\n      node: blocks,\n      type,\n      reason: 'dragBtn',\n    });\n  }\n\n  return controller;\n}\n"],"file":"updateDragHighlight.js"}