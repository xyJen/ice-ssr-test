{"version":3,"sources":["../../../../src/bi/utils/getDropHolderDataFromViewKeys.ts"],"names":["getClosestDom","DROP_POSITION","getDropHolderDataFromViewKeys","controller","event","viewKeys","document","value","startViewKey","endViewKey","length","undefined","startViewNode","getNode","endViewNode","startNode","endNode","startNodeRect","getBoundingClientRect","endNodeRect","clientY","top","height","rect","left","width","pagePosition","before","after"],"mappings":"AACA,OAAOA,aAAP;AACA,SAASC,aAAT;AAEA,eAAe,SAASC,6BAAT,CACbC,UADa,EAEbC,KAFa,EAGbC,QAHa,EAIb;AAAA,MACQC,QADR,GACqBH,UAAU,CAACI,KADhC,CACQD,QADR;AAEA,MAAME,YAAY,GAAGH,QAAQ,CAAC,CAAD,CAA7B;AACA,MAAMI,UAAU,GAAGJ,QAAQ,CAACA,QAAQ,CAACK,MAAT,GAAkB,CAAnB,CAA3B;AACA,MAAIF,YAAY,KAAKC,UAArB,EAAiC,OAAOE,SAAP;AAEjC,MAAMC,aAAa,GAAGN,QAAQ,CAACO,OAAT,CAAiBL,YAAjB,CAAtB;AACA,MAAMM,WAAW,GAAGR,QAAQ,CAACO,OAAT,CAAiBJ,UAAjB,CAApB;AACA,MAAMM,SAAS,GAAGf,aAAa,CAACY,aAAD,CAA/B;AACA,MAAMI,OAAO,GAAGhB,aAAa,CAACc,WAAD,CAA7B;AACA,MAAI,CAACC,SAAD,IAAc,CAACC,OAAnB,EAA4B,OAAOL,SAAP,CAV5B,CAYA;;AACA,MAAMM,aAAa,GAAGF,SAAS,CAACG,qBAAV,EAAtB;AACA,MAAMC,WAAW,GAAGH,OAAO,CAACE,qBAAR,EAApB;AAdA,MAeQE,OAfR,GAeoBhB,KAfpB,CAeQgB,OAfR;;AAiBA,MAAIA,OAAO,GAAGH,aAAa,CAACI,GAAxB,IAA+BD,OAAO,GAAGH,aAAa,CAACI,GAAd,GAAoBJ,aAAa,CAACK,MAA/E,EAAuF;AACvF;AACE,WAAO;AACLC,MAAAA,IAAI,EAAE;AACJF,QAAAA,GAAG,EAAEJ,aAAa,CAACI,GADf;AAEJG,QAAAA,IAAI,EAAEP,aAAa,CAACO,IAFhB;AAGJC,QAAAA,KAAK,EAAER,aAAa,CAACQ,KAHjB;AAIJH,QAAAA,MAAM,EAAEL,aAAa,CAACK;AAJlB,OADD;AAOLI,MAAAA,YAAY,EAAEzB,aAAa,CAAC0B;AAPvB,KAAP;AASD,GAXD,MAWO;AACP;AACE,WAAO;AACLJ,MAAAA,IAAI,EAAE;AACJF,QAAAA,GAAG,EAAEF,WAAW,CAACE,GADb;AAEJG,QAAAA,IAAI,EAAEL,WAAW,CAACK,IAFd;AAGJC,QAAAA,KAAK,EAAEN,WAAW,CAACM,KAHf;AAIJH,QAAAA,MAAM,EAAEH,WAAW,CAACG;AAJhB,OADD;AAOLI,MAAAA,YAAY,EAAEzB,aAAa,CAAC2B;AAPvB,KAAP;AASD;AACF","sourcesContent":["import { Controller, Block } from '@ali/4ever-cangjie';\nimport getClosestDom from './getClosestDom';\nimport { DROP_POSITION } from '../types';\n\nexport default function getDropHolderDataFromViewKeys(\n  controller: Controller,\n  event: DragEvent,\n  viewKeys: string[],\n) {\n  const { document } = controller.value;\n  const startViewKey = viewKeys[0];\n  const endViewKey = viewKeys[viewKeys.length - 1];\n  if (startViewKey === endViewKey) return undefined;\n\n  const startViewNode = document.getNode(startViewKey) as Block;\n  const endViewNode = document.getNode(endViewKey) as Block;\n  const startNode = getClosestDom(startViewNode);\n  const endNode = getClosestDom(endViewNode);\n  if (!startNode || !endNode) return undefined;\n\n  // 处理跨页的情形\n  const startNodeRect = startNode.getBoundingClientRect();\n  const endNodeRect = endNode.getBoundingClientRect();\n  const { clientY } = event;\n\n  if (clientY > startNodeRect.top && clientY < startNodeRect.top + startNodeRect.height) {\n  // 在前\n    return {\n      rect: {\n        top: startNodeRect.top,\n        left: startNodeRect.left,\n        width: startNodeRect.width,\n        height: startNodeRect.height,\n      },\n      pagePosition: DROP_POSITION.before,\n    };\n  } else {\n  // 在后\n    return {\n      rect: {\n        top: endNodeRect.top,\n        left: endNodeRect.left,\n        width: endNodeRect.width,\n        height: endNodeRect.height,\n      },\n      pagePosition: DROP_POSITION.after,\n    };\n  }\n}"],"file":"getDropHolderDataFromViewKeys.js"}