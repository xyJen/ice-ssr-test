import { Inline } from '@ali/4ever-cangjie';
import { Heading } from '@ali/4ever-plugin-heading';
import { Image } from '@ali/4ever-plugin-image';
import { Paragraph } from '@ali/4ever-plugin-paragraph';

function isContainInlineNode(node) {
  return node.nodes.some(function (n) {
    if (Inline.isInline(n) && !Image.isImage(n)) {
      return true;
    } else if (n.type === 'line') {
      return isContainInlineNode(n);
    }

    return false;
  });
}
/**
 * 判断 node 是否可拖拽
 * @param node
 * @param container
 */


export default function isNodeDraggable(controller, node) {
  if (Inline.isInline(node)) return true; // 除文字段落外都可以拖

  if (!Heading.isHeading(node) && !Paragraph.isParagraph(node)) return true;

  if (isContainInlineNode(node)) {
    // 包含行内节点允许拖拽（类似公式、日期等）
    return true;
  } // PERF: node.text 迭代获取文本更费性能，这里尽量通过直接根据 nodes 判断


  var nodes = node.nodes;
  var firstNodeText = nodes[0].text;

  if (nodes.length === 1) {
    return !!firstNodeText;
  }

  if (nodes.length === 3) {
    var thirdNodeText = nodes[2].text;

    if (!firstNodeText && Image.isImage(nodes[1]) && !thirdNodeText) {
      // 根据特定结构判断，若是单张图片不允许拖拽
      return false;
    }
  }

  return true;
}
//# sourceMappingURL=isNodeDraggable.js.map