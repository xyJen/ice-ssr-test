{"version":3,"sources":["../../../../src/bi/utils/hetu.tsx"],"names":["React","CopyblocklinkNormal","GotoblockNormal","TYPE_MENU_ITEM","getHetuDragMenuItems","options","block","locale","config","controller","type","data","metadata","cardType","sync","targetId","id","mimeType","injections","value","filter","i","key","syncStatus","length","types","includes","isMainSync","copyItem","title","copySyncLink","icon","menuExtraKey","role","onClick","toMainItem","toSyncMain","toOrigin"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Block, Controller } from '@ali/4ever-cangjie';\nimport {\n  CopyblocklinkNormal,\n  GotoblockNormal,\n} from '@ali/we-icon';\nimport {\n  TYPE_MENU_ITEM,\n} from '@ali/4ever-component';\n\nexport interface HetuConfig {\n  enable: boolean;\n  types: string[];\n  /** 普通插件转变为同步块并拷贝引用链接 */\n  normalToMain: (id: string, nodeKey: string) => void;\n  /** 复制引用链接 */\n  copySyncLink: (id: string, nodeKey: string) => void;\n  /** 返回原始同步块 */\n  toOrigin: (targetId: string) => void;\n}\n\nexport function getHetuDragMenuItems(options: {\n  block: Block;\n  locale: Record<string, string> | undefined;\n  config: HetuConfig;\n  controller: Controller;\n}) {\n  const {\n    block, locale, config, controller,\n  } = options;\n  const { type } = block;\n  const {\n    metadata = {},\n    cardType,\n  } = block.data;\n  const { sync, targetId, id, type: mimeType } = metadata;\n\n  // injection 在 block.data 没生效，直接从 value 获取\n  const injections = controller.value.injections.filter(\n    (i) => i.key === block.key,\n  );\n  let syncStatus = '';\n  if (injections.length) {\n    syncStatus = injections[0].data.syncStatus;\n  }\n\n  // 不支持同步块的河图插件，暂不展示\n  if (!(type === 'card' && cardType === 'hetu' && config.types.includes(mimeType))) {\n    return [];\n  }\n  const isMainSync = targetId === id;\n\n  // 如果是副本同步块，在 deleted 时，不展示\n  if (syncStatus === 'loading' || (!isMainSync && ['deleted'].includes(syncStatus))) {\n    return [];\n  }\n\n  if (!sync) {\n    // 变为同步块并 copy\n    return [];\n  } else {\n    // copyItem，但行为不一致\n    const copyItem = {\n      type: TYPE_MENU_ITEM,\n      title: locale?.copySyncLink,\n      icon: <CopyblocklinkNormal />,\n      menuExtraKey: 'copySyncLink',\n      role: \"copySyncLink\",\n      onClick: () => {\n        config.copySyncLink(id, block.key);\n      },\n    };\n\n    if (isMainSync) {\n      return [copyItem];\n    } else {\n      const toMainItem = {\n        type: TYPE_MENU_ITEM,\n        title: locale?.toSyncMain,\n        icon: <GotoblockNormal />,\n        menuExtraKey: 'toSyncMain',\n        role: \"toSyncMain\",\n        onClick: () => {\n          config.toOrigin(targetId);\n        },\n      };\n      return [copyItem, toMainItem];\n    }\n  }\n}\n"],"file":"hetu.js"}