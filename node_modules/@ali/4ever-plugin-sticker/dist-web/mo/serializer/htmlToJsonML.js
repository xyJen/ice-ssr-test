import { getTagName, getLastChild, isEmojiClsName, paragraphTags } from '@ali/4ever-utils';
import { createEmptyText } from '@ali/4ever-cangjie';
import Sticker from "../models";
export default {
  name: 'sticker',
  onOpenTag: function onOpenTag(state, name, attrs) {
    // 解析来自 IM 的表情
    if (!isEmojiClsName(attrs == null ? void 0 : attrs["class"])) return false;
    var sticker = ['span', {
      code: attrs.title.replace(/\[|\]/g, ''),
      'data-type': Sticker.TYPE
    }, createEmptyText()];
    state.push(sticker);
    return true;
  },
  onCloseTag: function onCloseTag(state, name, attrs) {
    if (!isEmojiClsName(attrs == null ? void 0 : attrs["class"])) return false;
    var sticker = state.pop();
    var parent = state.peek();

    if (paragraphTags[getTagName(parent)]) {
      state.append(sticker);
      return true;
    }

    var prevSibling = getLastChild(parent);

    if (prevSibling && prevSibling.isPhantom) {
      prevSibling.push(sticker, createEmptyText());
    } else {
      var phantom = ['p', createEmptyText(), sticker, createEmptyText()];
      phantom.isPhantom = true;
      state.append(phantom);
    }

    return true;
  }
};
//# sourceMappingURL=htmlToJsonML.js.map