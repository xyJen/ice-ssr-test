{"version":3,"sources":["../../../src/utils/sticker.ts"],"names":["Sticker","constructor","customSticker","lang","DEFAULT_LANG","stickerMap","stickerLang","stickerList","getStickerList","Map","map","s","code","cusStk","parseStickers","type","SPRITE","stickers","stk","src","spriteWidth","width","spriteHeight","height","SINGLE","x","y","getInfoByCode","get","getStickerSource","stickerInfo","getStickerLocale","locale"],"mappings":";;;;;;;AAAA;;AAEA;;AAeA,MAAMA,OAAN,CAAc;AACZ;AAGA;AAGA;AAGAC,EAAAA,WAAW,CAAC;AAAEC,IAAAA,aAAF;AAAiBC,IAAAA,IAAI,GAAGC;AAAxB,GAAD,EAAwD;AAAA,SAR3DC,UAQ2D;AAAA,SAL3DC,WAK2D;AAAA,SAFnEC,WAEmE;AACjE,SAAKD,WAAL,GAAmBH,IAAnB;AACA,SAAKI,WAAL,GAAmB,KAAKC,cAAL,CAAoBN,aAApB,CAAnB;AACA,SAAKG,UAAL,GAAkB,IAAII,GAAJ,CAAQ,KAAKF,WAAL,CAAiBG,GAAjB,CAAsBC,CAAD,IAAO,CAACA,CAAC,CAACC,IAAH,EAASD,CAAT,CAA5B,CAAR,CAAlB;AACD;;AAEOH,EAAAA,cAAR,CAAuBN,aAAvB,EAAuD;AACrD,WAAO,qBAAQA,aAAa,CAACQ,GAAd,CAAmBG,MAAD,IAAY,KAAKC,aAAL,CAAmBD,MAAnB,CAA9B,CAAR,CAAP;AACD;;AAEOC,EAAAA,aAAR,CAAsBZ,aAAtB,EAAsD;AACpD,QAAIA,aAAa,EAAEa,IAAf,KAAwBC,iBAA5B,EAAoC;AAClC,aAAOd,aAAa,CAACe,QAAd,CAAuBP,GAAvB,CAA4BQ,GAAD,IAAS;AACzCA,QAAAA,GAAG,CAACC,GAAJ,GAAUjB,aAAa,CAACiB,GAAxB;AACAD,QAAAA,GAAG,CAACE,WAAJ,GAAkBlB,aAAa,CAACmB,KAAhC;AACAH,QAAAA,GAAG,CAACI,YAAJ,GAAmBpB,aAAa,CAACqB,MAAjC;AACA,eAAOL,GAAP;AACD,OALM,CAAP;AAMD,KARmD,CAUpD;;;AACA,QAAIhB,aAAa,EAAEa,IAAf,KAAwBS,iBAA5B,EAAoC;AAClC,aAAOtB,aAAa,CAACe,QAAd,CAAuBP,GAAvB,CAA4BQ,GAAD,IAAS;AACzCA,QAAAA,GAAG,CAACO,CAAJ,GAAQ,CAAR;AACAP,QAAAA,GAAG,CAACQ,CAAJ,GAAQ,CAAR;AACAR,QAAAA,GAAG,CAACE,WAAJ,GAAkBF,GAAG,CAACG,KAAtB;AACAH,QAAAA,GAAG,CAACI,YAAJ,GAAmBJ,GAAG,CAACK,MAAvB;AACA,eAAOL,GAAP;AACD,OANM,CAAP;AAOD;;AAED,WAAO,EAAP;AACD;;AAEDS,EAAAA,aAAa,CAACf,IAAD,EAAO;AAClB,WAAO,KAAKP,UAAL,CAAgBuB,GAAhB,CAAoBhB,IAApB,CAAP;AACD;;AAEDiB,EAAAA,gBAAgB,CAACjB,IAAD,EAAO;AACrB,UAAMkB,WAAW,GAAG,KAAKH,aAAL,CAAmBf,IAAnB,CAApB;AACA,WAAOkB,WAAW,EAAEX,GAApB;AACD;;AAEDY,EAAAA,gBAAgB,CAACnB,IAAD,EAAOT,IAAP,EAAc;AAC5B,UAAM2B,WAAW,GAAG,KAAKH,aAAL,CAAmBf,IAAnB,CAApB;AACA,WAAOkB,WAAW,EAAEE,MAAb,CAAoB7B,IAAI,IAAI,KAAKG,WAAjC,KAAiD,EAAxD;AACD;;AAxDW;;eA2DCN,O","sourcesContent":["import { flatten } from 'lodash-es';\nimport { ICustomSticker, SingleSticker } from './types';\nimport { DEFAULT_LANG, SINGLE, SPRITE } from './constants';\n\nexport interface IStickerProps {\n  lang?: string;\n  customSticker: ICustomSticker;\n}\n\n/**\n * @description 对 SingleSticker、SpriteSticker 加工后的通用类型\n */\ninterface CommonSticker extends SingleSticker {\n  spriteWidth: number;\n  spriteHeight: number;\n}\n\nclass Sticker {\n  // 表情映射表\n  private stickerMap: Map<string, CommonSticker>;\n\n  // 表情语言\n  private stickerLang: string;\n\n  // 表情列表\n  stickerList: CommonSticker[];\n\n  constructor({ customSticker, lang = DEFAULT_LANG }: IStickerProps) {\n    this.stickerLang = lang;\n    this.stickerList = this.getStickerList(customSticker);\n    this.stickerMap = new Map(this.stickerList.map((s) => [s.code, s]));\n  }\n\n  private getStickerList(customSticker): CommonSticker[] {\n    return flatten(customSticker.map((cusStk) => this.parseStickers(cusStk)));\n  }\n\n  private parseStickers(customSticker): CommonSticker[] {\n    if (customSticker?.type === SPRITE) {\n      return customSticker.stickers.map((stk) => {\n        stk.src = customSticker.src;\n        stk.spriteWidth = customSticker.width;\n        stk.spriteHeight = customSticker.height;\n        return stk;\n      });\n    }\n\n    // TODO 目前仅支持雪碧图，单个表情或动图待支持 @灯少\n    if (customSticker?.type === SINGLE) {\n      return customSticker.stickers.map((stk) => {\n        stk.x = 0;\n        stk.y = 0;\n        stk.spriteWidth = stk.width;\n        stk.spriteHeight = stk.height;\n        return stk;\n      });\n    }\n\n    return [];\n  }\n\n  getInfoByCode(code) {\n    return this.stickerMap.get(code);\n  }\n\n  getStickerSource(code) {\n    const stickerInfo = this.getInfoByCode(code);\n    return stickerInfo?.src;\n  }\n\n  getStickerLocale(code, lang?) {\n    const stickerInfo = this.getInfoByCode(code);\n    return stickerInfo?.locale[lang || this.stickerLang] || '';\n  }\n}\n\nexport default Sticker;\n"],"file":"sticker.js"}