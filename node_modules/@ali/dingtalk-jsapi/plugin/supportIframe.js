"use strict";
/**
 * 支持 iframe 下使用 jsapi（仅支持同源, 仅支持 H5）
 * @author 西涣
 * @since 2020/8/17
 */
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
Object.defineProperty(exports, "__esModule", { value: true });
require("../entry/union");
var ddSdk_1 = require("../lib/ddSdk");
/**
 * top window 初始化
 * @description 请在 top window 应用启动时调用
 */
var topHostInit = function () {
    var ddSdkExportSdk = ddSdk_1.ddSdk.getExportSdk();
    var currentPlatformConfig = ddSdk_1.ddSdk.getPlatformConfigMap()[ddSdkExportSdk.env.platform];
    if (currentPlatformConfig) {
        window.__dingtalk_jsapi_top_platfrom_config__ = currentPlatformConfig;
    }
};
/**
 * iframe 中初始化
 * @description 请在 iframe 应用启动时调用
 */
var clientInit = function () {
    var topWindow = window.top;
    var ddSdkExportSdk = ddSdk_1.ddSdk.getExportSdk();
    try {
        if (topWindow.__dingtalk_jsapi_top_platfrom_config__) {
            ddSdk_1.ddSdk.setPlatform(__assign(__assign({}, topWindow.__dingtalk_jsapi_top_platfrom_config__), { platform: ddSdkExportSdk.env.platform }));
        }
        else {
            // tslint:disable-next-line: no-console
            console.info('Not find top Window iframe init vars, Calling the jsapi may fail. \n solution: please import "@ali/dingtalk-jsapi/plugin/supportIframe" in Top Window firstly or let Top Window in the DingTalk env');
        }
    }
    catch (error) {
        // tslint:disable-next-line: no-console
        console.info('Get top window error, error: ', error);
    }
};
if (window.top === window) {
    topHostInit();
}
else {
    clientInit();
}
