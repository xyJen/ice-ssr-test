{"version":3,"file":"index.js","sources":["../../src/utils/environment.ts","../../src/utils/deepFreeze.ts","../../src/models/immutableRecord.ts","../../src/models/node.ts","../../src/models/mark.ts","../../src/utils/listUtils.ts","../../src/models/leaf.ts","../../src/utils/keyUtils.ts","../../src/utils/setUtils.ts","../../src/models/text.ts","../../src/models/path.ts","../../src/models/error.ts","../../src/models/element.ts","../../src/models/inline.ts","../../src/models/block.ts","../../src/interfaces/controller.ts","../../src/hooks/useHots.ts","../../src/controller/useController.ts","../../src/controller/connectController.tsx","../../src/models/operation.ts","../../src/models/point.ts","../../src/utils/grapheme/classes-v13.0.0.ts","../../src/utils/grapheme/GraphemeBreaker.ts","../../src/utils/textUtils.ts","../../src/utils/dom/findClosestInContent.ts","../../src/constants.ts","../../src/utils/dom/findPoint.ts","../../src/utils/dom/findRange.ts","../../src/utils/dom/caretRangeFromTargetAndCoord.ts","../../src/utils/dom/getElementByCangjieKey.ts","../../src/utils/dom/findDOMNode.ts","../../src/utils/dom/findDOMLeaves.ts","../../src/utils/dom/findDOMPoint.ts","../../src/utils/dom/findDOMRange.ts","../../src/utils/dom/isPointAtEdge.ts","../../src/utils/dom/findRectFromPoint.ts","../../src/utils/dom/localCaretPos.ts","../../src/utils/dom/caretHanging.ts","../../src/queries/selection.ts","../../src/models/selection.ts","../../src/models/document.ts","../../src/models/injection.ts","../../src/utils/selection.ts","../../src/commands/selection.ts","../../src/commands/remove.ts","../../src/commands/move.ts","../../src/commands/utils.ts","../../src/contexts/split.ts","../../src/commands/split.ts","../../src/contexts/insert.ts","../../src/commands/insert.ts","../../src/contexts/merge.ts","../../src/commands/merge.ts","../../src/commands/mark.ts","../../src/commands/delete.ts","../../src/commands/replace.ts","../../src/commands/set.ts","../../src/contexts/wrap.ts","../../src/commands/wrap.ts","../../src/contexts/unwrap.ts","../../src/commands/unwrap.ts","../../src/commands/index.ts","../../src/mo/utils/constants.ts","../../src/utils/getClipboardData.ts","../../src/events/dataTransfer.ts","../../src/models/dataTransfer.ts","../../src/events/cangjieClipboard.ts","../../src/events/cangjieSelect.ts","../../src/locale/contextMenu.ts","../../src/utils/transfer.ts","../../src/utils/omitEmpty.ts","../../src/utils/createClipboardDataFromSelection.ts","../../src/components/mobile/icons.tsx","../../src/plugins/contextMenu.ts","../../src/hooks/useScroll.ts","../../src/utils/dom/findCaretPosition.ts","../../src/components/mobile/popupPosition.ts","../../src/hooks/useSelectionData.ts","../../src/components/mobile/contextMenu.tsx","../../src/hooks/useZoom.ts","../../src/components/mobile/Zoomer.tsx","../../src/utils/dom/scrollToSelection.ts","../../src/utils/dom/outsideScroller.ts","../../src/components/ScrollableContainer/index.tsx","../../src/components/mobile/handles.tsx","../../src/plugins/mobile.tsx","../../src/plugins/queries.ts","../../src/plugins/renderNode.ts","../../src/plugins/commands.ts","../../src/plugins/normalization.ts","../../src/plugins/coreSchema.ts","../../src/models/history.ts","../../src/utils/hotkeys.ts","../../src/plugins/history.ts","../../src/components/selection/caret/caret.tsx","../../src/components/selection/caret/index.tsx","../../src/events/cangjieInput.ts","../../src/utils/dom/findNode.ts","../../src/utils/shouldStopInsideVoid.ts","../../src/utils/perf.ts","../../src/plugins/core.tsx","../../src/plugins/uuid/createMapOperation.ts","../../src/plugins/uuid/queries.ts","../../src/plugins/uuid/utils.ts","../../src/plugins/uuid/actions.ts","../../src/plugins/uuid/commands.ts","../../src/plugins/uuid/onAction.ts","../../src/plugins/uuid/constants.ts","../../src/plugins/uuid/index.ts","../../src/plugins/group/actions.ts","../../src/plugins/group/onAction.ts","../../src/plugins/group/renderNode.tsx","../../src/plugins/group/renderGroup.tsx","../../src/plugins/group/onResetValue.ts","../../src/plugins/group/index.ts","../../src/utils/flushtask.ts","../../src/utils/getChildrenOverlaps.ts","../../src/utils/getChildrenInjections.ts","../../src/utils/opContext.ts","../../src/models/observable.ts","../../src/controller/pendings/selection.ts","../../src/controller/pendings/textinput.ts","../../src/controller/pendings/index.ts","../../src/controller/pendingQueue.tsx","../../src/utils/setInjection.ts","../../src/controller/userData.ts","../../src/interfaces/perf.ts","../../src/events/cangjiePerf.ts","../../src/controller/hots.ts","../../src/controller/utils/isEventHandler.ts","../../src/virtualize/constants.ts","../../src/virtualize/virtualizeUtils.ts","../../src/virtualize/calculateUtils.ts","../../src/virtualize/nodeManager.ts","../../src/virtualize/outputManager.tsx","../../src/utils/dom/findCurrentDOMRange.ts","../../src/utils/dom/findRangeByEvent.ts","../../src/utils/dom/optimizeRectsToFitLineHeight.ts","../../src/utils/dom/selection.ts","../../src/utils/dom/scrollToNode.ts","../../src/utils/dom/index.ts","../../src/virtualize/viewManager.ts","../../src/virtualize/virtualizeManager.ts","../../src/controller/groupManager.ts","../../src/utils/virtualize.ts","../../src/mo/utils/jsonml.ts","../../src/mo/utils/nodeTypes.ts","../../src/mo/utils/parseHtml.ts","../../src/mo/utils/createTextWithString.ts","../../src/mo/utils/createEmptyParagraph.ts","../../src/mo/serialization/jsonMLToValue.ts","../../src/mo/serialization/valueToJsonML.ts","../../src/mo/serialization/jsonMLToNode.ts","../../src/mo/serialization/nodeToJsonML.ts","../../src/mo/serialization/htmlToJsonML/DomParser.ts","../../src/mo/serialization/htmlToJsonML/State.ts","../../src/mo/serialization/htmlToJsonML/Deserializer.ts","../../src/mo/serialization/htmlToJsonML/htmlFrom.ts","../../src/mo/serialization/htmlToJsonML/index.ts","../../src/mo/serialization/jsonMLToHTML.tsx","../../src/mo/serialization/textToJsonML.ts","../../src/mo/serialization/nodeToText.ts","../../src/mo/serialization/valueToText.ts","../../src/mo/serialization/markdownToHTML.ts","../../src/mo/serialization/htmlToMarkdown.ts","../../src/mo/plugins/document/jsonMLToHTML.tsx","../../src/mo/plugins/document/jsonMLToValue.ts","../../src/mo/plugins/document/valueToJsonML.ts","../../src/mo/plugins/document/schema.ts","../../src/mo/plugins/document/index.ts","../../src/mo/schema/createSchema.ts","../../src/mo/plugins/text/createHTMLToJsonML.tsx","../../src/mo/plugins/text/createJsonMLToValue.ts","../../src/mo/plugins/text/createJsonToHtml.tsx","../../src/mo/plugins/text/createValueToJsonMl.ts","../../src/mo/plugins/text/createValueToText.ts","../../src/mo/plugins/text/index.ts","../../src/mo/serialization/createSerializer.ts","../../src/mo/serialization/htmlToJsonML/HtmlParser.ts","../../src/mo/common/borderStyle.ts","../../src/controller/useControllerStatic.ts","../../src/controller/index.ts","../../src/hooks/useStyle.ts","../../src/controller/provider.tsx","../../src/models/decoration.ts","../../src/models/userData.ts","../../src/models/value.ts","../../src/queries/index.ts","../../src/hooks/usePendingTerminal.ts","../../src/plugins/placeholder.tsx","../../src/plugins/perfLazyRender/useElementVisibility.ts","../../src/plugins/perfLazyRender/index.tsx","../../src/plugins/perfFirstRender.tsx","../../src/components/selection/context.tsx","../../src/hooks/useOffsetPosition.ts","../../src/hooks/useLeafBlockResizer.ts","../../src/hooks/useUserData.ts","../../src/hooks/useGroupData.ts","../../src/utils/dom/scrollToVisible.ts","../../src/hooks/useInputDetector.ts","../../src/hooks/useSelectionCalculator.ts","../../src/events/pasteInput.ts","../../src/components/hiddenTextArea.tsx","../../src/hooks/useResumePosition.ts","../../src/hooks/useScrollBySelection.ts","../../src/components/selection/range.tsx","../../src/hooks/usePerf.ts","../../src/components/selection/renderer.tsx","../../src/utils/caretColor.ts","../../src/components/selection/utils/getRectsFromLeaf.ts","../../src/components/selection/utils/dom.ts","../../src/components/selection/utils/traverse.ts","../../src/components/selection/utils/antiAliasingRects.ts","../../src/components/selection/utils/getRectsFromSelection.ts","../../src/components/selection/utils/getSelectionAppearance.ts","../../src/components/shadowDom.tsx","../../src/components/selection/slot.tsx","../../src/components/selection/utils/splitSelectionAndGetWrapper.ts","../../src/components/selection/utils/useSelectionWrappers.tsx","../../src/components/selection/index.tsx","../../src/hooks/useCangjieKeyBindingRef.ts","../../src/plugins/group/utils.ts","../../src/components/voidWrapper.tsx","../../src/components/leaf.tsx","../../src/utils/replaceNodeIntoElement.ts","../../src/hooks/useInputPending.ts","../../src/hooks/useView.ts","../../src/components/groupWrapper.tsx","../../src/components/node.tsx","../../src/virtualize/components/VirtualizePlaceholder.tsx","../../src/virtualize/hooks/useVirtualize.ts","../../src/components/editableContent.tsx","../../src/hooks/useClickToScroll.ts","../../src/components/ScrollableContent/index.tsx","../../src/components/content.tsx","../../src/utils/normalizePendingConfig.ts","../../src/utils/createAction.ts","../../src/utils/getUserData.ts","../../src/index.ts"],"sourcesContent":["/**\n * @packageDocumentation\n * @module environment\n */\nexport const IS_IOS =\n  typeof navigator !== 'undefined' &&\n  typeof window !== 'undefined' &&\n  /iPad|iPhone|iPod/.test(navigator.userAgent) &&\n  !(window as any).MSStream;\n\nexport const IS_ANDROID =\n  typeof navigator !== 'undefined' && /Android/i.test(navigator.userAgent);\n\nexport const IS_MOBILE = IS_IOS || IS_ANDROID;\n\nexport const IS_TOUCH_DEVICE =\n  typeof navigator !== 'undefined' && navigator.maxTouchPoints > 0;\n\nexport const IS_IPAD =\n  typeof navigator !== 'undefined' &&\n  typeof window !== 'undefined' &&\n  /iPad/.test(navigator.userAgent) &&\n  !(window as any).MSStream;\n\nexport const IS_MAC =\n  typeof navigator !== 'undefined' && /Mac OS X/i.test(navigator.userAgent);\n\nexport const IS_WINDOWS =\n  typeof navigator !== 'undefined' && /Windows/i.test(navigator.userAgent);\n\nexport const IS_FIREFOX =\n  typeof navigator !== 'undefined' &&\n  /mozilla\\/[a-z._\\d]+ \\((?:mobile)|(?:tablet)/i.test(navigator.userAgent);\n\n// Mac 容器内置的 Safari 内核浏览器在 userAgent 上没有 Safari 标识...\n// 这里为了兼容钉钉容器内置 Safari 的情况\nexport const IS_SAFARI =\n  typeof navigator !== 'undefined' &&\n  navigator.vendor === 'Apple Computer, Inc.';\n\nexport const IS_DEV = process.env.NODE_ENV === 'development';\n\nexport const IS_NODE = !!(\n  typeof process !== 'undefined' &&\n\tprocess.versions &&\n\tprocess.versions.node\n);\n\n/**\n * 返回 Chrome 版本\n */\nexport const getChromeVersion = () => {\n  const raw = navigator?.userAgent?.match(/Chrom(e|ium)\\/([0-9]+)\\./);\n  return raw ? parseInt(raw[2], 10) : -1;\n};\n","/**\n * @packageDocumentation\n * @ignore\n */\n\n/**\n * Freeze an object or array in Cangjie data to prevent modification\n *\n * Since Cangjie abandoned the immutableJS library, now it's developer's\n * responsibility to create new data object for any updated properties.\n * This function is used in Cangjie debug mode to prevent mistakes of altering\n * existing object.\n *\n * Note:\n * 1. use it in development mode, since it may cause bad performance\n *   https://immerjs.github.io/immer/docs/performance\n *\n * 2. use it in 'strict mode' to trigger a TypeError; otherwise the caller\n *   will just fails silently, which doesn't make any use it.\n */\n\nfunction isFrozen(obj: any): boolean {\n  if (obj === null || typeof obj !== 'object') {\n    return true;\n  }\n  return Object.isFrozen(obj);\n}\n\nexport default function deepFreeze(obj: any) {\n  if (isFrozen(obj)) {\n    return;\n  }\n\n  // we don't use Object.keys here, as we want to incude Arrays\n  const propNames = Object.getOwnPropertyNames(obj);\n\n  for (const key of propNames) {\n    const value = obj[key];\n    if (!isFrozen(value)) {\n      deepFreeze(value);\n    }\n  }\n\n  return Object.freeze(obj);\n}\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport { IS_DEV } from '../utils/environment';\nimport deepFreeze from '../utils/deepFreeze';\n\nexport default abstract class ImmutableRecord {\n  protected freeze() {\n    if (IS_DEV) {\n      deepFreeze(this);\n    }\n  }\n\n  abstract merge(props: Partial<object>): ImmutableRecord;\n\n  abstract set<K extends keyof object>(\n    key: K,\n    value: object[K],\n  ): ImmutableRecord;\n}\n","/**\n * @packageDocumentation\n * @module Models\n */\nimport isPlainObject from 'is-plain-object';\nimport ImmutableRecord from './immutableRecord';\nimport Element from './element';\nimport Text from './text';\nimport { Serializable, SerializeOptions } from '../interfaces/serializable';\n\nexport interface NodeProperties {\n  key?: string;\n}\n\nexport default abstract class Node extends ImmutableRecord\n  implements Serializable {\n  static createProperties(attrs: string | object = {}) {\n    if (typeof attrs === 'string') {\n      return { type: attrs };\n    }\n\n    if (isPlainObject(attrs)) {\n      return attrs;\n    }\n\n    throw new Error(\n      `\\`Node.createProperties\\` only accepts objects, strings, but you passed it: ${attrs}`,\n    );\n  }\n\n  public readonly key: string;\n\n  protected constructor(props: Required<NodeProperties>) {\n    super();\n    const { key } = props;\n    this.key = key;\n  }\n\n  public abstract get text(): string;\n\n  public abstract regenerateKey(): Node;\n\n  /**\n   * 获取自身树下的所有 Text 节点\n   * 如果自身是 Text，则返回只含有自身的数组\n   */\n  public abstract getTexts(): Text[];\n\n  /**\n   * 把当前的 Node 转化成子类型（Text 或者 Element）\n   */\n  public toSubType(): Text | Element {\n    const node: Node = this;\n    if (node instanceof Text) {\n      return node;\n    } else if (node instanceof Element) {\n      return node;\n    }\n    throw new Error(`${node} is not a Node`);\n  }\n\n  /**\n   * 此节点是否是一个Text节点。see Text.isText\n   */\n  public isText(): this is Text {\n    return this instanceof Text;\n  }\n\n  /**\n   * 此节点是否是一个Element节点。see Element.isElement\n   */\n  public isElement(): this is Element {\n    return this instanceof Element;\n  }\n\n  /**\n   * 获取第一个叶子Node；如果自身就是一个叶子Node，则返回自身\n   * 根据目前Schema规范，返回的都都是一个text；但是后续Cangjie扩展，可能返回其它类型Node\n   */\n  public getFirstNode(): Node {\n    if (!this.isElement() || !this.nodes.length) {\n      return this;\n    }\n    return this.nodes[0].getFirstNode();\n  }\n\n  /**\n   * 获取最后一个叶子Node；如果自身就是一个叶子Node，则返回自身\n   * 根据目前Schema规范，返回的都都是一个text；但是后续Cangjie扩展，可能返回其它类型Node\n   */\n  public getLastNode(): Node {\n    if (!this.isElement() || !this.nodes.length) {\n      return this;\n    }\n    return this.nodes[this.nodes.length - 1].getLastNode();\n  }\n\n  /**\n   * 获取第一个Text\n   * 根据目前Schema规范，都会返回一个text；但是后续Cangjie扩展，可能返回null\n   */\n  public getFirstText(): Text | null {\n    if (this.isText()) {\n      return this;\n    }\n    if (!this.isElement() || !this.nodes.length) {\n      return null;\n    }\n    return this.nodes[0].getFirstText();\n  }\n\n  /**\n   * 获取最后一个Text\n   * 根据目前Schema规范，都会返回一个text；但是后续Cangjie扩展，可能返回null\n   */\n  public getLastText(): Text | null {\n    if (this.isText()) {\n      return this;\n    }\n    if (!this.isElement() || !this.nodes.length) {\n      return null;\n    }\n    return this.nodes[this.nodes.length - 1].getLastText();\n  }\n\n  public abstract toJSON(options?: SerializeOptions): any;\n}\n","/**\n * @packageDocumentation\n * @module Models\n */\nimport isPlainObject from 'is-plain-object';\nimport equal from 'fast-deep-equal';\nimport ImmutableRecord from './immutableRecord';\nimport Data from '../interfaces/data';\nimport { Serializable } from '../interfaces/serializable';\n\nexport interface MarkProperties<D extends Data = Data> {\n  type: string;\n  data?: D;\n}\n\nexport interface MarkJSON<D extends Data = Data> {\n  klass?: 'mark';\n  type: string;\n  data?: D;\n}\n\nexport default class Mark<D extends Data = Data> extends ImmutableRecord\n  implements Serializable<MarkJSON<D>> {\n  static create<SD extends Data = Data>(properties: Mark<SD> | MarkProperties<SD> | string): Mark<SD> {\n    if (Mark.isMark(properties)) {\n      return properties;\n    }\n\n    let props = properties;\n    if (typeof props === 'string') {\n      props = { type: props };\n    }\n    if (isPlainObject(props)) {\n      const { type, data = {} as SD } = props;\n\n      if (typeof type !== 'string') {\n        throw new Error('`Mark.fromJS` requires a `type` string.');\n      }\n\n      return new Mark<SD>({\n        type,\n        data,\n      });\n    }\n\n    throw new Error(\n      `\\`Mark.create\\` only accepts objects, strings or marks, but you passed it: ${properties}`,\n    );\n  }\n\n  static fromJSON(json: MarkJSON) {\n    return Mark.create(json);\n  }\n\n  static isMark(maybeMark: any): maybeMark is Mark {\n    return maybeMark instanceof Mark;\n  }\n\n  protected constructor(props: Required<MarkProperties<D>>) {\n    super();\n    const { type, data } = props;\n    this.type = type;\n    this.data = { ...data };\n    this.freeze();\n  }\n\n  public readonly type: string;\n\n  public readonly data: D;\n\n  public merge(props: Partial<MarkProperties<D>>) {\n    return new Mark<D>({\n      type: this.type,\n      data: this.data,\n      ...props,\n    });\n  }\n\n  public set<T extends keyof MarkProperties<D>>(\n    key: T,\n    value: Required<MarkProperties<D>>[T],\n  ) {\n    return this.merge({\n      [key]: value,\n    });\n  }\n\n  public isEqual(mark?: Mark): boolean {\n    return equal(this, mark);\n  }\n\n  public toJSON(): MarkJSON<D> {\n    return {\n      klass: 'mark',\n      type: this.type,\n      data: { ...this.data },\n    };\n  }\n}\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport equal from 'fast-deep-equal';\n\ntype Func<T> = (a: T) => boolean;\n\nexport default {\n  skipUntil<T>(as: T[], func: Func<T>) {\n    const index = as.findIndex((a) => func(a));\n    if (index === -1) {\n      return [];\n    }\n    return as.slice(index);\n  },\n  takeUntil<T>(as: T[], func: Func<T>) {\n    const index = as.findIndex((a) => func(a));\n    if (index === -1) {\n      return as.slice();\n    }\n    return as.slice(0, index);\n  },\n  hasSameMembers<T, P>(a: T[], b: P[]) {\n    if (a.length !== b.length) {\n      return false;\n    }\n    return a.length === 0 || a.every((aElem) => !!b.find((bElem) => equal(aElem, bElem)));\n  },\n};\n","/**\n * @packageDocumentation\n * @module Models\n */\nimport equal from 'fast-deep-equal';\nimport isPlainObject from 'is-plain-object';\nimport ImmutableRecord from './immutableRecord';\nimport Mark, { MarkJSON } from './mark';\nimport { Serializable } from '../interfaces/serializable';\nimport listUtils from '../utils/listUtils';\n\nfunction has<T>(as: T[], b: T) {\n  return as.some((a) => equal(a, b));\n}\n\nfunction union<T>(as: T[], bs: T[]) {\n  return bs.reduce((merged, b) => {\n    if (has(merged, b)) {\n      return merged;\n    }\n    return [...merged, b];\n  }, as);\n}\n\nfunction except<T>(as: T[], bs: T[]) {\n  return as.filter((a) => !has(bs, a));\n}\n\nexport interface LeafProperties {\n  text: string;\n  marks?: Mark[];\n}\n\nexport interface LeafJSON {\n  klass?: 'leaf';\n  key?: string;\n  text: string;\n  marks?: MarkJSON[];\n}\n\nexport default class Leaf extends ImmutableRecord\n  implements Serializable<LeafJSON> {\n  static create(properties: Leaf | LeafProperties | string = ''): Leaf {\n    if (Leaf.isLeaf(properties)) {\n      return properties;\n    }\n\n    let props = properties;\n    if (typeof props === 'string') {\n      props = { text: props };\n    }\n\n    if (isPlainObject(props)) {\n      const { text = '', marks = [] } = props;\n      return new Leaf({\n        text,\n        marks: marks.map(Mark.create),\n      });\n    }\n\n    throw new Error(\n      `\\`Leaf.create\\` only accepts objects, strings or leaves, but you passed it: ${properties}`,\n    );\n  }\n\n  static fromJSON(json: LeafJSON) {\n    const { marks } = json;\n    return Leaf.create({\n      ...json,\n      marks: marks ? marks.map(Mark.fromJSON) : undefined,\n    });\n  }\n\n  static isLeaf(maybeLeaf: any): maybeLeaf is Leaf {\n    return maybeLeaf instanceof Leaf;\n  }\n\n  /**\n   * 对leaves进行normalize，并返回新Leafs\n   */\n  static normalizeLeaves(leaves: Leaf[]) {\n    if (leaves.length === 0) {\n      return [Leaf.create()];\n    }\n    if (leaves.length === 1) {\n      return leaves;\n    }\n\n    let invalid = false;\n    const normalized = leaves.reduceRight((ls: Leaf[], leaf) => {\n      const next = ls[0];\n      if (!next) {\n        return [leaf];\n      }\n\n      if (listUtils.hasSameMembers(leaf.marks, next.marks)) {\n        invalid = true;\n        ls[0] = next.set('text', `${leaf.text}${next.text}`);\n        return ls;\n      }\n\n      if (next.text === '') {\n        invalid = true;\n        ls[0] = leaf;\n        return ls;\n      }\n\n      if (leaf.text === '') {\n        invalid = true;\n        return ls;\n      }\n      ls.unshift(leaf);\n      return ls;\n    }, []);\n\n    if (!invalid) {\n      return leaves;\n    }\n    return normalized;\n  }\n\n  /**\n   * 对leaves执行split操作。\n   * @offset text的偏移量，如果位于某一个leaf内部，则分割该leaf\n   */\n  static splitLeaves(leaves: Leaf[], offset: number): [Leaf[], Leaf[]] {\n    if (offset < 0) {\n      return [[], leaves];\n    }\n\n    if (leaves.length === 0) {\n      return [[], []];\n    }\n\n    let endOffset = 0;\n    let left: Leaf | undefined;\n    let right: Leaf | undefined;\n    const index = leaves.findIndex((leaf) => {\n      const startOffset = endOffset;\n      const { text } = leaf;\n      endOffset += text.length;\n\n      if (endOffset < offset) {\n        return false;\n      }\n      if (startOffset > offset) {\n        return false;\n      }\n\n      const length = offset - startOffset;\n      if (typeof text.slice !== 'function') {\n        throw new Error(`Unable to split leaf with text: ${text}`);\n      }\n      left = leaf.set('text', text.slice(0, length));\n      right = leaf.set('text', text.slice(length));\n      return true;\n    });\n\n    if (!left || !right) {\n      // Same as `!left && !right`\n      return [leaves, []];\n    }\n\n    if (left.text === '') {\n      if (index === 0) {\n        return [[left], leaves];\n      }\n\n      return [leaves.slice(0, index), leaves.slice(index)];\n    }\n\n    if (right.text === '') {\n      if (index === leaves.length - 1) {\n        return [leaves, [right]];\n      }\n\n      const splittedIndex = index + 1;\n      return [leaves.slice(0, splittedIndex), leaves.slice(splittedIndex)];\n    }\n\n    return [\n      [...leaves.slice(0, index), left],\n      [right, ...leaves.slice(index + 1)],\n    ];\n  }\n\n  /**\n   * 在leaves中搜索第offset个字符对应的位置\n   */\n  static searchLeafAtOffset(leaves: Leaf[], offset: number) {\n    let startOffset = 0;\n    let endOffset = 0;\n    const index = leaves.findIndex((leaf) => {\n      startOffset = endOffset;\n      endOffset = startOffset + leaf.text.length;\n      return endOffset >= offset;\n    });\n\n    const found = index !== -1;\n    if (!found) {\n      return null;\n    }\n\n    return {\n      index,\n      leaf: leaves[index],\n      startOffset,\n      endOffset,\n    };\n  }\n\n  protected constructor(props: Required<LeafProperties>) {\n    super();\n    const { text, marks } = props;\n    this.text = text;\n    this.marks = marks;\n    this.freeze();\n  }\n\n  public readonly text: string;\n\n  public readonly marks: Mark[];\n\n  public merge(props: Partial<LeafProperties>) {\n    return new Leaf({\n      text: this.text,\n      marks: this.marks,\n      ...props,\n    });\n  }\n\n  public set<T extends keyof LeafProperties>(\n    key: T,\n    value: Required<LeafProperties>[T],\n  ) {\n    return this.merge({\n      [key]: value,\n    });\n  }\n\n  /**\n   * 拷贝一个新Leaf，并把Mark加上去\n   */\n  public addMark(mark: Mark) {\n    return this.set('marks', union(this.marks, [mark]));\n  }\n\n  /**\n   * 拷贝一个新Leaf，并把Marks加上去\n   */\n  public addMarks(marks: Mark[]) {\n    return this.set('marks', union(this.marks, marks));\n  }\n\n  /**\n   * 拷贝一个新Leaf，并把Mark过滤掉\n   */\n  public removeMark(mark: Mark) {\n    return this.set('marks', except(this.marks, [mark]));\n  }\n\n  /**\n   * 拷贝一个新Leaf，并把Mark替换掉\n   * 如果mark不存在、mark和新mark相等，则返回当前的Leaf\n   */\n  public setMark(mark: Mark, newMark: Mark) {\n    if (equal(mark, newMark)) {\n      return this;\n    }\n\n    const { marks } = this;\n    if (!has(marks, mark)) {\n      return this;\n    }\n\n    const newMarks = marks.map((m) => (equal(m, mark) ? newMark : mark));\n    return this.set('marks', newMarks);\n  }\n\n  public toJSON(): LeafJSON {\n    return {\n      klass: 'leaf',\n      text: this.text,\n      marks: this.marks.map((mark) => mark.toJSON()),\n    };\n  }\n}\n","/**\n * @packageDocumentation\n * @module keyUtils\n */\n\n/**\n * cangjie key 生成逻辑，默认从 0 开始递增。\n *\n * key 在多版本、多实例 cangjie 嵌套时，保持全局唯一\n */\n\nlet localCount = 0;\n\nconst cangjieKeyGen = '__cangjieKeyGen';\nconst hasWindow = typeof window === 'object';\nif (hasWindow && !window[cangjieKeyGen]) {\n  window[cangjieKeyGen] = 0;\n}\n\nconst keyUtils = {\n  create() {\n    if (hasWindow) {\n      const keyStr = `${window[cangjieKeyGen]}`;\n      window[cangjieKeyGen] = window[cangjieKeyGen] + 1;\n      return keyStr;\n    }\n    const keyStr = `${localCount}`;\n    localCount = localCount + 1;\n    return keyStr;\n  },\n\n  parse(key: string): [string, number] {\n    const [k, o] = key.split(':');\n    return [k, parseInt(o, 10)];\n  },\n\n  resetGenerator() {\n    if (hasWindow) {\n      window[cangjieKeyGen] = 0;\n    }\n    localCount = 0;\n  },\n};\n\nexport default keyUtils;\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport equal from 'fast-deep-equal';\n\ntype EqualFunc<T> = (a: T, b: T) => boolean;\n\nexport default {\n  add<T>(as: T[], b: T) {\n    const index = as.findIndex(a => equal(a, b));\n    const newAs = [...as];\n    if (index !== -1) {\n      newAs.splice(index, 1);\n    }\n    newAs.push(b);\n    return newAs;\n  },\n\n  remove<T>(as: T[], b: T) {\n    return as.filter(a => !equal(a, b));\n  },\n\n  has<T>(as: T[], b: T, isEqual: EqualFunc<T> = equal) {\n    return as.some((a) => isEqual(a, b));\n  },\n\n  intersect<T>(as: T[], bs: T[]) {\n    return as.filter((a => bs.some(b => equal(a, b))));\n  },\n\n  union<T>(as: T[], bs: T[], isEqual: EqualFunc<T> = equal) {\n    return bs.reduce((merged, b) => {\n      if (this.has(merged, b, isEqual)) {\n        return merged;\n      }\n      merged.push(b);\n      return merged;\n    }, [...as]);\n  },\n\n  removeDuplicate<T>(as: T[]) {\n    return as.filter((a, index) => \n      index === as.findIndex(b => equal(b, a))\n    );\n  },\n\n  isSuperSet(as: any[], bs: any[]) {\n    return bs.every(b => as.findIndex(a => equal(a, b)) !== -1)\n  },\n}\n","/**\n * @packageDocumentation\n * @module Models\n */\nimport isPlainObject from 'is-plain-object';\nimport Decoration from './decoration';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport Element from './element';\nimport Node, { NodeProperties } from './node';\nimport Leaf, { LeafJSON } from './leaf';\nimport Mark, { MarkProperties } from './mark';\nimport { Serializable, SerializeOptions } from '../interfaces/serializable';\nimport keyUtils from '../utils/keyUtils';\nimport setUtils from '../utils/setUtils';\nimport listUtils from '../utils/listUtils';\n\nconst SUPRESS_NORMALIZE = { normalize: false };\nconst TEXTS = new WeakMap<Text, string>();\n\ntype TextChildren = Leaf[];\n\nexport interface TextProperties extends NodeProperties {\n  leaves?: TextChildren;\n}\n\nexport interface TextJSON {\n  klass: 'text';\n  key?: string;\n  leaves: LeafJSON[];\n}\n\nexport default class Text extends Node\n  implements Serializable<TextJSON> {\n  static create(properties: Text | TextProperties | string = ''): Text {\n    if (Text.isText(properties)) {\n      return properties;\n    }\n\n    let props = properties;\n    if (typeof props === 'string') {\n      props = { leaves: [Leaf.create(props)] };\n    }\n    if (isPlainObject(props)) {\n      const { key = keyUtils.create(), leaves = [] } = props;\n      return new Text({\n        key,\n        leaves: leaves.map(Leaf.create),\n      });\n    }\n\n    throw new Error(\n      `\\`Text.create\\` only accepts objects, strings or texts, but you passed it: ${properties}`,\n    );\n  }\n\n  static fromJSON(json: TextJSON) {\n    return Text.create({\n      ...json,\n      leaves: json.leaves.map(Leaf.fromJSON),\n    });\n  }\n\n  static isText(maybeText: any): maybeText is Text {\n    return maybeText instanceof Text;\n  }\n\n  static isEmptyText(maybeText: any): maybeText is Text {\n    return maybeText instanceof Text && !maybeText.text;\n  }\n\n  static isTextList(maybeTextList: any): maybeTextList is Text[] {\n    return Array.isArray(maybeTextList) && maybeTextList.every(Text.isText);\n  }\n\n  protected constructor(props: Required<TextProperties>, options = { normalize: true }) {\n    super(props);\n    const { leaves } = props;\n    this.leaves = options.normalize ? Leaf.normalizeLeaves(leaves) : leaves;\n    this.freeze();\n  }\n\n  public readonly leaves: TextChildren;\n\n  /**\n   * 获取对应的文本string\n   */\n  public get text() {\n    if (process.env.NODE_ENV !== 'test' && TEXTS.has(this)) {\n      return TEXTS.get(this)!;\n    }\n    const t = this.leaves.map(({ text }) => text).join('');\n    TEXTS.set(this, t);\n    return t;\n  }\n\n  /**\n   * 获取所有的marks\n   */\n  public get marks() {\n    return this.getMarks();\n  }\n\n  /**\n   * 获取自身树下的所有 Text 节点\n   * 如果自身是 Text，则返回只含有自身的数组\n   */\n  public getTexts(): Text[] {\n    return [this];\n  }\n\n  public merge(props: Partial<TextProperties>) {\n    return new Text({\n      key: this.key,\n      leaves: this.leaves,\n      ...props,\n    });\n  }\n\n  public set<T extends keyof TextProperties>(\n    key: T,\n    value: Required<TextProperties>[T],\n  ) {\n    return this.merge({\n      [key]: value,\n    });\n  }\n\n  public regenerateKey() {\n    return this.set('key', keyUtils.create());\n  }\n\n  public getLeaves(decorations?: Decoration[]) {\n    if (!decorations || decorations.length === 0) {\n      return this.leaves;\n    }\n    if (this.leaves.length === 0) {\n      const marks = decorations.map(({ mark }) => mark);\n      const leaf = Leaf.create({ text: '', marks });\n      return [leaf];\n    }\n    if (this.text.length === 0) {\n      const firstLeaf = this.leaves[0];\n      const marks = decorations.map((d) => d.mark);\n      return [firstLeaf.addMarks(marks)];\n    }\n\n    const { key, text } = this;\n    let { leaves } = this;\n    decorations.forEach((dec) => {\n      const { start, end, mark } = dec;\n      const hasStart = start.key === key;\n      const hasEnd = end.key === key;\n      if (hasStart || hasEnd) {\n        const index = hasStart ? start.offset : 0;\n        const length = hasEnd ? end.offset - index : text.length - index;\n        if (length < 1) {\n          return;\n        }\n        if (index >= text.length) {\n          return;\n        }\n        if (index !== 0 || length < text.length) {\n          const [before, bundle] = Leaf.splitLeaves(leaves, index);\n          const [middle, after] = Leaf.splitLeaves(bundle, length);\n          leaves = before.concat(\n            middle.map((l) => l.addMark(mark)),\n            after,\n          );\n          return;\n        }\n      }\n      leaves = leaves.map((l) => l.addMark(mark));\n    });\n\n    if (leaves === this.leaves) {\n      return leaves;\n    }\n    return Leaf.normalizeLeaves(leaves);\n  }\n\n  /**\n   * 获取所有的marks\n   */\n  public getMarks() {\n    if (this.leaves.length === 0) {\n      return [];\n    }\n\n    return this.leaves.reduce<Mark[]>(\n      (marks, leaf) => setUtils.union(marks, leaf.marks),\n      [],\n    );\n  }\n\n  /**\n   * 获取text内所有文字都有的，公共marks\n   */\n  public getActiveMarks() {\n    if (this.leaves.length === 0) {\n      return [];\n    }\n\n    const firstMarks = this.leaves[0].marks;\n    if (firstMarks.length === 0) {\n      return firstMarks;\n    }\n\n    return this.leaves\n      .slice(1)\n      .reduce(\n        (marks, leaf) => setUtils.intersect(marks, leaf.marks),\n        firstMarks,\n      );\n  }\n\n  /**\n   * 根据offset区间，获取marks\n   */\n  public getMarksBetweenOffsets(startOffset: number, endOffset: number) {\n    if (startOffset <= 0 && endOffset >= this.text.length) {\n      return this.getMarks();\n    }\n\n    if (startOffset >= endOffset) return [];\n    // For empty text in a paragraph, use getActiveMarks;\n    if (this.text === '') return this.getActiveMarks();\n\n    let result: Mark[] | null = null;\n    let leafEnd = 0;\n    this.leaves.forEach((leaf) => {\n      const leafStart = leafEnd;\n      leafEnd = leafStart + leaf.text.length;\n\n      if (leafEnd <= startOffset) return;\n      if (leafStart >= endOffset) return;\n\n      if (!result) {\n        result = leaf.marks;\n        return;\n      }\n\n      result = setUtils.union(result, leaf.marks);\n    });\n\n    return result || [];\n  }\n\n  /**\n   * 根据offset区间，获取区间内所有文字都含有的，公共marks\n   */\n  public getActiveMarksBetweenOffsets(startOffset: number, endOffset: number) {\n    if (startOffset <= 0 && endOffset >= this.text.length) {\n      return this.getActiveMarks();\n    }\n\n    if (startOffset >= endOffset) return [];\n    // For empty text in a paragraph, use getActiveMarks;\n    if (this.text === '') return this.getActiveMarks();\n\n    let result: Mark[] = [];\n    let leafEnd = 0;\n    let foundNoMarks = false;\n\n    this.leaves.forEach((leaf) => {\n      const leafStart = leafEnd;\n      leafEnd = leafStart + leaf.text.length;\n\n      if (leafEnd <= startOffset) return;\n      if (leafStart >= endOffset) return;\n\n      foundNoMarks = foundNoMarks || !leaf.marks.length;\n      if (!result.length) {\n        result = leaf.marks;\n        return;\n      }\n\n      result = setUtils.intersect(result, leaf.marks);\n    });\n\n    if (foundNoMarks && result.length) {\n      // aaaBBB: a has no marks, B has marks, so they have no intersected marks\n      result = [];\n    }\n\n    return result || [];\n  }\n\n  /**\n   * 获取第index个文字，对应的marks\n   */\n  public getMarksAtIndex(index: number) {\n    const leafObj = Leaf.searchLeafAtOffset(this.leaves, index);\n    return !leafObj ? [] : leafObj.leaf.marks;\n  }\n\n  /**\n   * 拷贝出一个新的text节点，并在指定的位置添加mark\n   * 如果offset不合法，则返回自身\n   */\n  public addMark(offset: number, length: number, mark: Mark) {\n    return this.addMarks(offset, length, [mark]);\n  }\n\n  /**\n   * 拷贝出一个新的text节点，并在指定的位置添加marks。\n   * 如果marks是0，或者offset不合法，则返回自身\n   */\n  public addMarks(offset: number, length: number, marks: Mark[]) {\n    if (this.text === '' && offset === 0) {\n      const { leaves } = this;\n      const first = leaves[0];\n      if (!first) {\n        return this.set('leaves', [Leaf.create({ text: '', marks })]);\n      }\n\n      const newFirst = first.addMarks(marks);\n      if (newFirst === first) {\n        return this;\n      }\n      return this.set('leaves', [newFirst]);\n    }\n\n    if (length === 0 || offset >= this.text.length) {\n      return this;\n    }\n\n    const [before, bundle] = Leaf.splitLeaves(this.leaves, offset);\n    const [middle, after] = Leaf.splitLeaves(bundle, length);\n    return this.set('leaves', [\n      ...before,\n      ...middle.map((leaf) => leaf.addMarks(marks)),\n      ...after,\n    ]);\n  }\n\n  /**\n   * 拷贝出一个新的text节点，并在指定的位置过滤掉对应的mark\n   * 如果当前没有这个mark，或者offset不合法，则返回自身\n   */\n  public removeMark(offset: number, length: number, mark: Mark) {\n    if (this.text === '' && offset === 0) {\n      const { leaves } = this;\n      const first = leaves[0];\n      if (!first) {\n        return this;\n      }\n\n      const newFirst = first.removeMark(mark);\n      if (newFirst === first) {\n        return this;\n      }\n      return this.set('leaves', [newFirst]);\n    }\n\n    if (length === 0 || offset >= this.text.length) {\n      return this;\n    }\n\n    const [before, bundle] = Leaf.splitLeaves(this.leaves, offset);\n    const [middle, after] = Leaf.splitLeaves(bundle, length);\n    return this.set('leaves', [\n      ...before,\n      ...middle.map((leaf) => leaf.removeMark(mark)),\n      ...after,\n    ]);\n  }\n\n  /**\n   * 在指定的区间，设置一个新的Mark\n   * 如果指定区间不合法，或者区间内已经存在同样的mark，则返回自身\n   */\n  public setMark(\n    offset: number,\n    length: number,\n    mark: Mark,\n    properties: Partial<MarkProperties>,\n  ) {\n    const newMark = mark.merge(properties);\n\n    if (this.text === '' && offset === 0 && length === 0) {\n      const { leaves } = this;\n      const first = leaves[0];\n      if (!first) {\n        return this;\n      }\n\n      const newFirst = first.setMark(mark, newMark);\n      if (newFirst === first) {\n        return this;\n      }\n      return this.set('leaves', [newFirst]);\n    }\n\n    if (length === 0 || offset >= this.text.length) {\n      return this;\n    }\n\n    const [before, bundle] = Leaf.splitLeaves(this.leaves, offset);\n    const [middle, after] = Leaf.splitLeaves(bundle, length);\n    return this.set('leaves', [\n      ...before,\n      ...middle.map((leaf) => leaf.setMark(mark, newMark)),\n      ...after,\n    ]);\n  }\n\n  /**\n   * 复制出一个新的text，并在指定的位置，插入对应的文字和marks\n   */\n  public insertText(offset: number, text: string, marks: Mark[] = []) {\n    if (this.text === '') {\n      return this.set('leaves', [Leaf.create({ text, marks })]);\n    }\n    if (text.length === 0) {\n      return this;\n    }\n\n    const { leaves } = this;\n    const leafObj = Leaf.searchLeafAtOffset(\n      leaves,\n      offset,\n    );\n    if (!leafObj) {\n      throw new Error(`Text.insertText, could not find leaf with offset: ${offset}`);\n    }\n    const { index, leaf, startOffset } = leafObj;\n    const delta = offset - startOffset;\n    const beforeText = leaf.text.slice(0, delta);\n    const afterText = leaf.text.slice(delta);\n\n    const newLeaves = [...leaves];\n    if (listUtils.hasSameMembers(leaf.marks, marks)) {\n      const newLeaf = leaf.set('text', beforeText + text + afterText);\n      newLeaves[index] = newLeaf;\n      return this.set('leaves', newLeaves);\n    }\n    newLeaves.splice(\n      index,\n      1,\n      leaf.set('text', beforeText),\n      Leaf.create({ text, marks }),\n      leaf.set('text', afterText),\n    );\n    return this.set('leaves', newLeaves);\n  }\n\n  /**\n   * 在指定的位置，删掉指定的text长度的文字\n   * 本杰：TODO: check whether deleted text is same as text?\n   */\n  public removeText(offset: number, text: string) {\n    if (text.length === 0 || offset >= this.text.length) {\n      return this;\n    }\n\n    // PERF: For simple backspace, we can operate directly on the leaf\n    if (text.length === 1) {\n      const leafObj = Leaf.searchLeafAtOffset(\n        this.leaves,\n        offset + 1,\n      );\n      if (!leafObj) {\n        throw new Error(`Text.removeText, could not find leaf with offset: ${offset}`);\n      }\n      const { index, leaf, startOffset } = leafObj;\n      const newLeaves = [...this.leaves];\n\n      if (leaf.text.length === 1) {\n        if (newLeaves.length === 1) {\n          // keep marks when delete the last leaf\n          newLeaves[0] = Leaf.create({\n            text: '',\n            marks: leaf.marks,\n          });\n        } else {\n          newLeaves.splice(index, 1);\n        }\n        // PERF: Avoid normalizing twice for normalized `leaves`.\n        return new Text(\n          { key: this.key, leaves: newLeaves },\n          SUPRESS_NORMALIZE,\n        );\n      }\n\n      const delta = offset - startOffset;\n      const beforeText = leaf.text.slice(0, delta);\n      const afterText = leaf.text.slice(delta + text.length);\n      const newText = beforeText + afterText;\n      newLeaves[index] = leaf.set('text', newText);\n      return new Text(\n        { key: this.key, leaves: newLeaves},\n        SUPRESS_NORMALIZE,\n      );\n    }\n\n    const [before, bundle] = Leaf.splitLeaves(this.leaves, offset);\n    const after = Leaf.splitLeaves(bundle, text.length)[1];\n    // PERF: reduce `leaves` to be normalized.\n    const middle = Leaf.normalizeLeaves([...before.slice(-1), ...after.slice(0, 1)]);\n    const leaves = [\n      ...before.slice(0, -1),\n      ...middle,\n      ...after.slice(1),\n    ];\n\n    if (leaves.length === 1) {\n      const first = leaves[0];\n      if (first.text === '') {\n        return new Text(\n          { key: this.key, leaves: [first.set('marks', this.getActiveMarks())] },\n          SUPRESS_NORMALIZE,\n        );\n      }\n    }\n\n    return new Text(\n      { key: this.key, leaves },\n      SUPRESS_NORMALIZE,\n    );\n  }\n\n  /**\n   * 拷贝出一个新的text，并把传入的text的leaves添加上去\n   */\n  public mergeText(other: Text) {\n    const leaves = this.leaves.concat(other.leaves);\n    return this.set('leaves', leaves);\n  }\n\n  /**\n   * 在指定的位置做一个split，返回split后的两个text\n   */\n  public splitText(position: number) {\n    const [befores, afters] = Leaf.splitLeaves(this.leaves, position);\n    const a = this.set('leaves', befores);\n    const b = this.set('leaves', afters).regenerateKey();\n    return [a, b];\n  }\n\n  public toJSON(options?: SerializeOptions) {\n    const object: TextJSON = {\n      klass: 'text',\n      leaves: this.leaves.map((leaf) => leaf.toJSON()),\n    };\n    if (options?.preserveKeys) {\n      object.key = this.key;\n    }\n    return object;\n  }\n}\n","/**\n * @packageDocumentation\n * @module Models\n */\nimport equal from 'fast-deep-equal';\nimport Operation, {\n  MergeNodeOperation,\n  MoveNodeOperation,\n  SplitNodeOperation,\n} from './operation';\n\n/**\n * @ignore\n */\nexport type PathJSON = number[];\n\nexport default class Path extends Array<number> {\n  /**\n   * Compare priority between `path` and `target`:\n   *\n   * - if `path` is before `target`, return -1\n   * - if `path` is after `target`, return 1\n   * - if `path` is equal to `target`, return 0\n   * - else if something went wrong, return null\n   *\n   * @param path - path\n   * @param target - target path\n   *\n   * # Example\n   *\n   * ```ts\n   * Path.compare([1,0], [1,0])     // 0\n   * Path.compare([1,1,1], [1,0])   // 1\n   * Path.compare([1,0,0,1], [1,1]) // -1\n   * ```\n   */\n  static compare(path: Path, target: Path) {\n    const m = Math.min(path.length, target.length);\n\n    for (let i = 0; i < m; i += 1) {\n      const pv = path[i];\n      const tv = target[i];\n\n      // If the path's value is ever less than the target's, it's before.\n      if (pv < tv) {\n        return -1;\n      }\n\n      // If the target's value is ever less than the path's, it's after.\n      if (pv > tv) {\n        return 1;\n      }\n    }\n\n    // Paths should now be equal, otherwise something is wrong\n    return path.length === target.length ? 0 : null;\n  }\n\n  /**\n   * Crop `a` and `b` into the same size.\n   *\n   * @param a\n   * @param b\n   * @param size - crop size, default is the shortest between a and b\n   *\n   * # Example\n   *\n   * ```ts\n   * Path.crop([1,1,0], [1,1])    // [1,1]\n   * Path.crop([1,1,0], [1,1], 1) // [1]\n   * ```\n   */\n  static crop(a: Path, b: Path, size = Math.min(a.length, b.length)) {\n    const ca: Path = a.slice(0, size);\n    const cb: Path = b.slice(0, size);\n    return [ca, cb];\n  }\n\n  /**\n   * Decrement a `path` by `n` at `index`.\n   *\n   * @param path\n   * @param n - default is 1\n   * @param index - default is the last index\n   *\n   * # Example\n   *\n   * ```ts\n   * Path.decrement([1,1,1])       // [1,1,0]\n   * Path.decrement([1,1,3], 2)    // [1,1,1]\n   * Path.decrement([1,1,3], 1, 1) // [1,0,3]\n   * ```\n   */\n  static decrement(path: Path, n = 1, index = path.length - 1) {\n    return Path.increment(path, 0 - n, index);\n  }\n\n  /**\n   * Increment a `path` by `n` at `index`.\n   *\n   * @param path\n   * @param n - default is 1\n   * @param index - default is the last index\n   *\n   * # Example\n   *\n   * ```ts\n   * Path.increment([1,1,1])       // [1,1,2]\n   * Path.increment([1,1,1], 2)    // [1,1,3]\n   * Path.increment([1,1,1], 2, 1) // [1,3,1]\n   * ```\n   */\n  static increment(path: Path, n = 1, index = path.length - 1) {\n    const newPath: Path = [...path];\n    newPath[index] += n;\n    return newPath;\n  }\n\n  /**\n   * Link the `subPath` to the `ancestor`.\n   *\n   * @param ancestor\n   * @param subPath\n   *\n   * # Example\n   *\n   * ```ts\n   * Path.link([1,0], [1]) // [1,0,1]\n   * ```\n   */\n  static link(ancestor: Path, subPath: Path) {\n    return ancestor.concat(subPath);\n  }\n\n  /**\n   * If the `path` is the ancestor of the `target`.\n   *\n   * @param path\n   * @param target\n   *\n   * # Example\n   *\n   * Given the document tree:\n   *\n   * ```txt\n   *         []\n   *        /  \\\n   *     [0]   [1]\n   *    /  \\\n   * [0,0]  [0,1]\n   * ```\n   *\n   * ```ts\n   * Path.isAncestor([], [0,0])  // true\n   * Path.isAncestor([0], [0,0]) // true\n   * ```\n   */\n  static isAncestor(path: Path, target: Path) {\n    const [p, t] = Path.crop(path, target);\n    return path.length < target.length && Path.isEqual(p, t);\n  }\n\n  /**\n   * If the `path` is descendant of the `target`.\n   *\n   * @param path\n   * @param target\n   *\n   * # Example\n   *\n   * Given the document tree:\n   *\n   * ```txt\n   *         []\n   *        /  \\\n   *      [0]   [1]\n   *         __/ | \\__\n   *    [1,0]  [1,1]  [1,2]\n   *      /\n   *   [1,0,0]\n   * ```\n   *\n   * ```ts\n   * Path.isDescendant([1,0], [1]) // true\n   * Path.isDescendant([1], [])   // true\n   * ```\n   */\n  static isDescendant(path: Path, target: Path) {\n    return (\n      path.length > target.length &&\n      Path.isEqual(path.slice(0, target.length), target)\n    );\n  }\n\n  /**\n   * If the `path` is before the `target`.\n   *\n   * @param path\n   * @param target\n   *\n   * # Example\n   *\n   * Given the document tree:\n   *\n   * ```txt\n   *         []\n   *        / \\\n   *      [0] [1]\n   *         /  \\\n   *    [1,0]   [1,1]\n   * ```\n   *\n   * ```ts\n   * Path.isBefore([0], [1,1])   // true\n   * Path.isBefore([1,0], [1,1]) // true\n   * ```\n   */\n  static isBefore(path: Path, target: Path) {\n    const [p, t] = Path.crop(path, target);\n    return Path.compare(p, t) === -1;\n  }\n\n  /**\n   * If the `path` is after the `target`.\n   *\n   * @param path\n   * @param target\n   *\n   * # Example\n   *\n   * Given the document tree:\n   *\n   * ```txt\n   *         []\n   *        /  \\\n   *     [0]   [1]\n   *          /  \\\n   *     [1,0]   [1,1]\n   * ```\n   *\n   * ```ts\n   * Path.isAfter([1], [0])   // true\n   * Path.isAfter([1,0], [0]) // true\n   * ```\n   */\n  static isAfter(path: Path, target: Path) {\n    const [p, t] = Path.crop(path, target);\n    return Path.compare(p, t) === 1;\n  }\n\n  /**\n   * If the `path` is equal to `target`.\n   *\n   * @param path\n   * @param target\n   *\n   * # Example\n   *\n   * ```ts\n   * Path.isEqual([], [])       // true\n   * Path.isEqual([1,0], [1,0]) // true\n   * Path.isEqual([0], [1])     // false\n   * ```\n   */\n  static isEqual(path: Path, target: Path) {\n    return equal(path, target);\n  }\n\n  /**\n   * If the `path` is the sibling of the `target`.\n   *\n   * @param path\n   * @param target\n   *\n   * # Example\n   *\n   * Given the document tree:\n   *\n   * ```txt\n   *         []\n   *        /  \\\n   *      [0]   [1]\n   *         __/ | \\__\n   *    [1,0]  [1,1]  [1,2]\n   * ```\n   *\n   * ```ts\n   * Path.isSibling([1,0], [1,1]) // true\n   * Path.isSibling([1,2], [1,1]) // true\n   * ```\n   */\n  static isSibling(path: Path, target: Path) {\n    if (path.length !== target.length) {\n      return false;\n    }\n    const p = Path.parent(path);\n    const t = Path.parent(target);\n    return Path.isEqual(p, t) && path[path.length - 1] !== target[path.length - 1];\n  }\n\n  /**\n   * If the `path` is the previous sibling of the `target`.\n   *\n   * @param path\n   * @param target\n   *\n   * # Example\n   *\n   * Given the document tree:\n   *\n   * ```txt\n   *         []\n   *        /  \\\n   *      [0]   [1]\n   *         __/ | \\__\n   *    [1,0]  [1,1]  [1,2]\n   * ```\n   *\n   * ```ts\n   * Path.isPrevSibling([0], [1]) // true\n   * Path.isPrevsSibling([1,1], [1,2]) // true\n   * Path.isPrevsSibling([0], [1,2]) // false\n   * ```\n   */\n  static isPrevSibling(path: Path, target: Path) {\n    return Path.isSibling(path, target) && Path.isBefore(path, target);\n  }\n\n  /**\n   * If the `path` is younger than the `target`.It means at the level which `path` lives, the `path` is ends before `target`.\n   *\n   * @param path\n   * @param target\n   *\n   * # Example\n   *\n   * Given the document tree:\n   *\n   * ```txt\n   *         []\n   *        / \\\n   *     [0]   [1]\n   *        __/ | \\__\n   *   [1,0]  [1,1]  [1,2]\n   *          /   \\\n   *   [1,1,0]   [1,1,1]\n   * ```\n   *\n   * ```ts\n   * Path.isYounger([1,1,0], [1,1,1]) // true\n   * Path.isYounger([1,0], [1,1,1])   // true\n   * Path.isYounger([0], [1,1,1])     // true\n   * ```\n   */\n  static isYounger(path: Path, target: Path) {\n    const index = path.length - 1;\n    const [p, t] = Path.crop(path, target, index);\n    const pl = path[index];\n    const tl = target[index];\n\n    return Path.isEqual(p, t) && pl < tl;\n  }\n\n  /**\n   * If the `path` is deeper than the `target`.\n   *\n   * @param path\n   * @param target\n   *\n   * # Example\n   *\n   * Given the document tree:\n   *\n   * ```txt\n   *         []\n   *        /  \\\n   *      [0]  [1]\n   *           /  \\\n   *      [1,0]   [1,1]\n   * ```\n   *\n   * ```ts\n   * Path.isDeeper([1,0], [1]) // true\n   * Path.isDeeper([1,0], [])  // true\n   * ```\n   */\n  static isDeeper(path: Path, target: Path) {\n    return path.length > target.length;\n  }\n\n  /**\n   * If the `path` is parent of the `target`.\n   *\n   * @param path\n   * @param target\n   *\n   * # Example\n   *\n   * Given the document tree:\n   *\n   * ```txt\n   *        []\n   *       / \\\n   *    [0]  [1]\n   *         /  \\\n   *    [1,0]   [1,1]\n   * ```\n   *\n   * ```ts\n   * Path.isParent([1], [1,0]) // true\n   * Path.isParent([], [1])    // true\n   * ```\n   */\n  static isParent(path: Path, target: Path) {\n    return (\n      path.length + 1 === target.length &&\n      Path.isEqual(path, Path.parent(target))\n    );\n  }\n\n  /**\n   * If the `path` is child of the `target`\n   *\n   *\n   * @param path\n   * @param target\n   *\n   * # Example\n   *\n   * Given the document tree:\n   *\n   * ```txt\n   *         []\n   *        /  \\\n   *      [0]  [1]\n   *          /  \\\n   *     [1,0]   [1,1]\n   * ```\n   *\n   * ```ts\n   * Path.isChild([1,0], [1]) // true\n   * ```\n   */\n  static isChild(path: Path, target: Path) {\n    return (\n      path.length === target.length + 1 &&\n      Path.isEqual(path.slice(0, -1), target)\n    );\n  }\n\n  /**\n   * Get the next sibiling of the `path`.\n   *\n   * @param path\n   *\n   * # Example\n   *\n   * Given the document tree:\n   *\n   * ```txt\n   *         []\n   *        /  \\\n   *      [0]  [1]\n   *          /  \\\n   *     [1,0]   [1,1]\n   * ```\n   *\n   * ```ts\n   * Path.next([1,0]) // [1,1]\n   * Path.next([])    // null\n   * ```\n   */\n  static next(path: Path) {\n    if (path.length === 0) {\n      return null;\n    }\n\n    const last = path[path.length - 1];\n    return path.slice(0, -1).concat(last + 1);\n  }\n\n  /**\n   * Get the previous sibiling of the `path`.\n   *\n   * @param path\n   *\n   * # Example\n   *\n   * Given the document tree:\n   *\n   * ```txt\n   *         []\n   *        /  \\\n   *      [0]  [1]\n   *          /  \\\n   *     [1,0]   [1,1]\n   * ```\n   *\n   * ```ts\n   * Path.previous([1,1]) // [1,0]\n   * Path.previous([])    // null\n   * Path.previous([1,0]) // null\n   * ```\n   */\n  static previous(path: Path) {\n    if (path.length === 0) {\n      return null;\n    }\n\n    const last = path[path.length - 1];\n    if (last <= 0) {\n      return null;\n    }\n    return path.slice(0, -1).concat(last - 1);\n  }\n\n  /**\n   * Get the parent path of the `path`,\n   * Note: the parent of root is still root.\n   *\n   * @param path\n   *\n   * # Example\n   *\n   * Given the document tree:\n   *\n   * ```txt\n   *         []\n   *        /  \\\n   *      [0]  [1]\n   *          /  \\\n   *     [1,0]   [1,1]\n   * ```\n   *\n   * ```ts\n   * Path.parent([1,0]) // [1]\n   * Path.parent([0])   // []\n   * Path.parent([])    // []\n   * ```\n   */\n  static parent(path: Path) {\n    return path.slice(0, -1);\n  }\n\n  /**\n   * Get all ancestors of the `path`.\n   *\n   * @param path\n   *\n   * # Example\n   *\n   * Given the document tree:\n   *\n   *```txt\n   *        []\n   *       /  \\\n   *    [0]   [1]\n   *       __/ | \\__\n   *  [1,0]  [1,1]  [1,2]\n   *          /\n   *      [1,1,0]\n   * ```\n   *\n   * ```ts\n   * Path.ancestors([1,1,0]) // [[], [1], [1,1]]\n   * ```\n   */\n  static ancestors(path: Path) {\n    const ancestors: Path[] = [];\n    for (let i = 0; i < path.length; i += 1) {\n      ancestors.push(path.slice(0, i));\n    }\n    return ancestors;\n  }\n\n  /**\n   * Get the common ancestor between `a` and `b`.\n   *\n   * @param a\n   * @param b\n   *\n   * # Example\n   *\n   * Given the document tree:\n   *\n   *```txt\n   *        []\n   *       /  \\\n   *    [0]   [1]\n   *       __/ | \\__\n   *  [1,0]  [1,1]  [1,2]\n   *          /       /\n   *      [1,1,0]  [1,2,0]\n   * ```\n   *\n   * ```ts\n   * Path.common([1,1,0], [1,2,0]) // [1]\n   * ```\n   */\n  static common(a: Path, b: Path) {\n    const path: Path = [];\n    // eslint-disable-next-line no-plusplus\n    for (let i = 0; i < a.length && i < b.length; i++) {\n      const av = a[i];\n      const bv = b[i];\n\n      if (av !== bv) break;\n\n      path.push(av);\n    }\n\n    return path;\n  }\n\n  /**\n   * Get the path of `path` relative to `ancestor`.\n   *\n   * @param a\n   * @param b\n   *\n   * # Example\n   *\n   * Given the document tree:\n   *\n   *```txt\n   *        []\n   *       /  \\\n   *    [0]   [1]\n   *       __/ | \\__\n   *  [1,0]  [1,1]  [1,2]\n   *          /       /\n   *      [1,1,0]  [1,2,0]\n   * ```\n   *\n   * ```ts\n   * Path.relative([1,1,0], [1]) // [1,0]\n   * Path.relative([1,0,0], [0]) // null\n   * ```\n   */\n  static relative(path: Path, ancestor: Path) {\n    if (!Path.isAncestor(ancestor, path) || Path.isEqual(path, ancestor)) {\n      return null;\n    }\n\n    return path.slice(ancestor.length);\n  }\n\n  /**\n   * Transform the `path` based on `operation`.\n   * @param path\n   * @param operation\n   */\n  static transform(path: Path, operation: Operation): Path[] {\n    if (operation.type === 'set_selection') {\n      return [path];\n    }\n\n    const { type, path: p } = operation;\n    if (\n      type === 'add_mark' ||\n      type === 'insert_text' ||\n      type === 'remove_mark' ||\n      type === 'remove_text' ||\n      type === 'set_mark' ||\n      type === 'set_node' ||\n      path.length === 0\n    ) {\n      return [path];\n    }\n\n    const pIndex = p.length - 1;\n    const pEqual = Path.isEqual(p, path);\n    const pYounger = Path.isYounger(p, path);\n    const pAbove = Path.isAncestor(p, path);\n\n    if (type === 'insert_node') {\n      if (pEqual || pYounger || pAbove) {\n        /**\n         * ## Insert at the path\n         *\n         * ```js\n         * path    = [1,0]\n         * op.path = [1,0]\n         * ```\n         *\n         * move path forward at op.path's level           [1,0] --> [1,1]\n         *\n         * ```txt\n         *         []                                               []\n         *      __/ \\__                                          __/ \\__\n         *   [0]       [1]             --- transform -->      [0]       [1]\n         *             /                                                / |\n         *          *[1,0]*                                        [1,0]  *[1,1]*\n         * ```\n         *\n         * ## Insert above the path\n         *\n         * ```js\n         * path    = [1,0]\n         * op.path = [1]\n         * ```\n         *\n         * move path forward at op.path's level           [1,0] --> [2,0]\n         *\n         * ```txt\n         *         []                                               [ ]\n         *      __/ \\__                                          __/ | \\__\n         *   [0]       [1]           --- transform -->        [0]   [1]   [2]\n         *             /                                                  /\n         *         *[1,0]*                                            *[2,0]*\n         * ```\n         *\n         * ## Insert at younger\n         *\n         * ```js\n         * path    = [1]\n         * op.path = [0]\n         * ```\n         *\n         * move path forward at op.path's level           [1] --> [2]\n         *\n         * ```txt\n         *          [ ]                                             [ ]\n         *         /  |                                          __/ | \\__\n         *       [0] *[1]*           --- transform -->        [0]   [1]   *[2]*\n         * ```\n         */\n        return [Path.increment(path, 1, pIndex)];\n      }\n    } else if (type === 'remove_node') {\n      if (pYounger) {\n        /**\n         * ## Remove at younger\n         *\n         * ```js\n         * path    = [1,0]\n         * op.path = [0]\n         * ```\n         *\n         * move path forward at op.path's level           [1,0] --> [0,0]\n         *\n         * ```txt\n         *         []                                               [ ]\n         *      __/ \\__                                          __/ | \\__\n         *   [0]       [1]           --- transform -->        [0]   [1]   [2]\n         *             /                                      /\n         *         *[1,0]*                                 *[0,0]*\n         * ```\n         */\n        return [Path.decrement(path, 1, pIndex)];\n      }\n      if (pEqual || pAbove) {\n        /**\n         * ## Remove at the path\n         *\n         * ```js\n         * path    = [1,0]\n         * op.path = [1,0]\n         * ```\n         *\n         * path is removed           [1,0] --> removed\n         *\n         * ```txt\n         *         []                                               []\n         *      __/ \\__                                          __/ \\__\n         *   [0]       [1]             --- transform -->      [0]       [1]\n         *             /\n         *          *[1,0]*\n         * ```\n         *\n         * ## Remove above the path\n         *\n         * ```js\n         * path    = [1,0]\n         * op.path = [1]\n         * ```\n         *\n         * path is removed           [1,0] --> removed\n         *\n         * ```txt\n         *         []                                               [ ]\n         *      __/ \\__                                          __/  \\__\n         *   [0]       [1]           --- transform -->        [0]        [1]\n         *             /\n         *         *[1,0]*\n         * ```\n         *\n         */\n        return [];\n      }\n    } else if (type === 'merge_node') {\n      if (!Path.previous(p)) {\n        return [path];\n      }\n      if (pEqual || pYounger) {\n        /**\n         * ## Merge at the path\n         *\n         * ```js\n         * path         = [1]\n         * op.path      = [1]\n         * op.position  = 2\n         * ```\n         *\n         * move path forward at op.path's level                 [0,1] -> [0]\n         *\n         * ```txt\n         *            []                                                []\n         *         __/ \\__                                           __/ \\__\n         *      [0]      *[1]*                                    *[0]*\n         *     /  \\       /             ---- transform -->      __/  |  \\__\n         * [0,0] [0,1]  [1,0]                              [0,0]   [0,1]  [0,2]\n         * ```\n         *\n         * ## Merge at younger\n         *\n         * ```js\n         * path         = [1,0,2,0]\n         * op.path      = [1,0,1]\n         * op.position  = 1\n         * ```\n         *\n         * move path forward at op.path's level         [1,0,2,0] -> [1,0,1,0]\n         *\n         *```txt\n         *            []                                                []\n         *         __/ \\__                                           __/ \\__\n         *      [0]       [1]                                     [0]       [1]\n         *     /  \\       /             ---- transform -->        / \\        /\n         * [0,0] [0,1]  [1,0]                                 [0,0] [0,1]  [1,0]\n         *          ___/  |  \\___                                          /  \\\n         * [1,0,0] <-- [1,0,1]   [1,0,2]                            [1,0,0]   [1,0,1]\n         *                         /                                             /\n         *                   *[1,0,2,0]*                                    *[1,0,1,0]*\n         *```\n         */\n        return [Path.decrement(path, 1, pIndex)];\n      }\n      if (pAbove) {\n        /**\n         *\n         * ## Merge above the path\n         *\n         * ```js\n         * path        = [1,0]\n         * op.path     = [1]\n         * op.position = 2\n         * ```\n         *\n         * 1. move path forward at op.path's level    [1,0] -> [0,0]\n         * 2. move sub path to the position               [0,0] -> [0,2]\n         *\n         * ```\n         *            []                                                []\n         *         __/ \\__                                           __/\n         *      [0]  <-- [1]                                      [0]\n         *     /  \\       /             ---- transform -->     __/ | \\__\n         * [0,0] [0,1] *[1,0]*                            [0,0] [0, 1]  *[0,2]*\n         *          ___/  |  \\___                                    ___/  |  \\___\n         *   [1,0,0]   [1,0,1]   [1,0,2]                      [0,2,0]   [0,2,1]   [0,2,2]\n         * ```\n         */\n        const { position } = operation as MergeNodeOperation;\n        return [\n          Path.increment(Path.decrement(path, 1, pIndex), position, pIndex + 1),\n        ];\n      }\n    } else if (type === 'split_node') {\n      if (pEqual) {\n        /**\n         * ## Split at the path\n         *\n         * ```js\n         * path        = [1]\n         * op.path     = [1]\n         * op.position = 1\n         * ```\n         *\n         * split path into 2 paths:  [1] -> [1], [2]\n         *\n         * ```\n         *         []                                          [ ]\n         *      __/ \\__                                     __/ | \\__\n         *   [0]      *[1]*      --- transform -->       [0]  *[1]*  *[2]*\n         *            /  \\                                     /      /\n         *       [1,0] s [1,1]                              [1,0]   [2,0]\n         * ```\n         */\n        return [path, Path.increment(path)];\n      }\n      if (pYounger) {\n        /**\n         * ## Split at younger\n         *\n         * ```js\n         * path        = [1,0,0]\n         * op.path     = [0]\n         * op.position = 1\n         * ```\n         *\n         * move path foward at op.path's level: [1,0,0] -> [2,0,0]\n         *\n         * ```txt\n         *              []                                          [ ]\n         *           __/ \\__                                     __/ | \\__\n         *        [0]       [1]      --- transform -->       [0]   [1]    [2]\n         *       /  \\       /                                /      /     /\n         *  [0,0] s [0,1] [1,0]                           [0,0]  [1,0] [2,0]\n         *                 /                                            /\n         *             *[1,0,0]*                                   *[2,0,0]*\n         * ```\n         */\n        return [Path.increment(path, 1, pIndex)];\n      }\n      if (pAbove) {\n        /*\n         * ## Split above\n         *\n         * If split happened before the path at op.path's level\n         *\n         * ```js\n         * path        = [1,0,2]\n         * op.path     = [1,0]\n         * op.position = 1\n         * ```\n         *\n         * 1. move path foward at op.path's level: [1,0,2] -> [1,1,2]\n         * 2. move path backward to the split position:    [1,1,2] -> [1,1,1]\n         *\n         * ```txt\n         *              []                                          []\n         *           __/ \\__                                     __/  \\__\n         *        [0]       [1]      --- transform -->        [0]        [1]\n         *                   /                                        __/   \\__\n         *                [1,0]                                  [1,0]         [1,1]\n         *            ____/ | \\____                                /           /   \\\n         *     [1,0,0] s [1,0,1]   *[1,0,2]*                  [1,0,0]   [1,1,0]    *[1,1,1]*\n         * ```\n         */\n        const { position } = operation as SplitNodeOperation;\n        if (path[pIndex + 1] >= position) {\n          return [\n            Path.decrement(\n              Path.increment(path, 1, pIndex),\n              position,\n              pIndex + 1,\n            ),\n          ];\n        }\n      }\n    }\n\n    if (type === 'move_node') {\n      const { newPath: np } = operation as MoveNodeOperation;\n      const npIndex = np.length - 1;\n      const npEqual = Path.isEqual(np, path);\n\n      // Stay\n      if (Path.isEqual(p, np)) {\n        return [path];\n      }\n\n      const npYounger = Path.isYounger(np, path);\n      const npAbove = Path.isAncestor(np, path);\n\n      if (pAbove) {\n        /*\n         * ## Move above the path\n         *\n         * If move node forward to the deeper\n         *\n         * ```js\n         * path       = [1,0]\n         * op.path    = [1]\n         * op.newPath = [2,0]\n         * ```\n         *\n         * 1. move new path to the left at op.path's level:    [2,0] -> [1,0]\n         * 2. link sub path to the path:                       [1,0] + [0] -> [1,0,0]\n         *\n         * ```txt\n         *         [  ]                                     [ ]\n         *      __/ | \\__                                __/  |__\n         *   [0]   [1]  [2]    --- transform -->      [0]        [1]\n         *         /     /                                       / \\\n         *    *[1,0]*  [2,0]                                [1,0]  [1,1]\n         *              /                                    /      /\n         *           [2,0,0]                          *[1,0,0]*   [1,1,0]\n         * ```\n         *\n         * Else\n         *\n         * ```js\n         * path       = [1,0]\n         * op.path    = [1]\n         * op.newPath = [0]\n         * ```\n         *\n         * link sub path to new path:                                [0] + [0] -> [0,0]\n         *\n         * ```\n         *         []                                         []\n         *      __/ \\__                                    __/ |__\n         *   [0]       [1]       --- transform -->      [0]       [1]\n         *              /                                /\n         *          *[1,0]*                           *[0,0]*\n         * ```\n         */\n        const subPath = Path.relative(path, p)!;\n\n        if (Path.isAfter(np, p) && Path.isDeeper(np, p)) {\n          return [Path.link(Path.decrement(np, 1, p.length - 1), subPath)];\n        }\n\n        return [Path.link(np, subPath)];\n      } else if (pEqual) {\n        /*\n         * ## Move at the path\n         *\n         * If move forward to the deeper\n         *\n         * ```js\n         * path       = [1]\n         * op.path    = [1]\n         * op.newPath = [2,0]\n         * ```\n         *\n         * 1. move new path backward at op.path's level:      [2,0] -> [1,0]\n         * 2. move path to the new path:                         [1]   -> [1,0]\n         *\n         * ```txt\n         *         [  ]                                         []\n         *      __/ | \\__                                      / \\\n         *   [0]  *[1]*  [2]    --- transform -->           [0]  [1]\n         *               /                                       /  \\\n         *            [2,0]                                 *[1,0]*  [1,1]\n         * ```\n         *\n         * Else\n         *\n         * ```js\n         * path       = [1,0]\n         * op.path    = [1,0]\n         * op.newPath = [2,0]\n         * ```\n         *\n         * move path to new path:                               [1,0] -> [2,0]\n         *\n         * ```txt\n         *         [  ]                                         [ ]\n         *      __/ | \\__                                    __/ | \\__\n         *   [0]   [1]   [2]    --- transform -->         [0]   [1]   [2]\n         *          /     /                                          /  \\\n         *      *[1,0]* [2,0]                                  *[2,0]* [2,1]\n         * ```\n         */\n        if (Path.isYounger(p, np) && Path.isDeeper(np, p)) {\n          return [Path.decrement(np, 1, p.length - 1)];\n        }\n        return [np];\n      } else if (Path.isSibling(p, np) && (npAbove || npEqual)) {\n        if (pYounger) {\n          /*\n           * ## Move younger to sibling, the sibling is the ancestor of the path.\n           *\n           * ```js\n           * path       = [1,0]\n           * op.path    = [0]\n           * op.newPath = [1]\n           * ```\n           *\n           * move path forward at op.path's level:        [1,0] -> [0,0]\n           *\n           * ```txt\n           *         []                                       []\n           *        / \\                                      / \\\n           *     [0]  [1]       --- transform -->          [0] [1]\n           *           /                                    /\n           *        *[1,0]*                              *[0,0]*\n           * ```\n           *\n           * ## Move younger to sibling, the sibling is the path.\n           *\n           * ```js\n           * path       = [2]\n           * op.path    = [0]\n           * op.newPath = [2]\n           * ```\n           *\n           * move path forward at op.path's level:        [2] -> [1]\n           *\n           * ```txt\n           *         [ ]                                        [ ]\n           *        / | \\         --- transform -->          __/ | \\__\n           *    [0] [1] *[2]*                             [0]  *[1]*  [2]\n           * ```\n           */\n          return [Path.decrement(path, 1, pIndex)];\n        } else {\n          /*\n           * ## Move older to sibling, the sibling is ancestor of the path.\n           *\n           * ```js\n           * path       = [1, 0]\n           * op.path    = [2]\n           * op.newPath = [0]\n           * ```\n           *\n           * move path foward at op.path's level:        [1,0] -> [2,0]\n           *\n           * ```txt\n           *         [ ]                                       [ ]\n           *        / | \\                                     / | \\\n           *     [0] [1] [2]      --- transform -->        [0] [1] [2]\n           *          /                                            /\n           *       *[1,0]*                                      *[2,0]*\n           *\n           * ```\n           *\n           * ## Move older to sibling, the sibling is the path.\n           *\n           * ```js\n           * path       = [1]\n           * op.path    = [2]\n           * op.newPath = [1]\n           * ```\n           *\n           * move path forward at op.path's level:        [1] -> [2]\n           *\n           * ```txt\n           *         [ ]                                        [ ]\n           *        / | \\         --- transform -->          __/ | \\__\n           *    [0] *[1]* [2]                             [0]   [1]  *[2]*\n           * ```\n           */\n          return [Path.increment(path, 1, pIndex)];\n        }\n      } else if (npEqual || npYounger || npAbove) {\n        if (pYounger) {\n          /*\n           * ## Move younger to path.\n           *\n           * ```js\n           * path       = [1,1]\n           * op.path    = [0]\n           * op.newPath = [1,0]\n           * ```\n           *\n           * 1. move path backward at op.path's level:        [1,1] -> [0,1]\n           * 2. move path forward at op.newPath's level:      [0,1] -> [0,2]\n           *\n           * ```txt\n           *        [ ]                                    [ ]\n           *     __/ | \\__                              __/ | \\__\n           *  [0]   [1]  [2]   --- transform -->    [0]  [1]   [2]\n           *        / \\                          __/ | \\__\n           *   [1,0]  *[1,1]*               [0,0]  [0,1]  *[0,2]*\n           * ```\n           *\n           * ## Move younger to path's younger.\n           *\n           * ```js\n           * path       = [1,1]\n           * op.path    = [0]\n           * op.newPath = [1,0]\n           * ```\n           *\n           * 1. move path backward at op.path's level:        [1,1] -> [0,1]\n           * 2. move path forward at op.newPath's level:      [0,1] -> [0,2]\n           *\n           * ```txt\n           *        [ ]                                  [ ]\n           *     __/  \\__                                /\n           *  [0]      [1]    --- transform -->        [0]\n           *           /  \\                         __/ | \\__\n           *      [1,0]  *[1,1]*               [0,0]  [0,1]  *[0,2]*\n           * ```\n           *\n           * ## Move younger to path's ancestor.\n           *\n           * ```js\n           * path       = [1,0,0]\n           * op.path    = [0]\n           * op.newPath = [1,0]\n           * ```\n           *\n           * 1. move path backward at op.path's level:        [1,0,0] -> [0,0,0]\n           * 2. move path forward at op.newPath's level:      [0,0,0] -> [0,1,0]\n           *\n           * ```txt\n           *        [ ]                                    [ ]\n           *     __/  \\__                                 /\n           *  [0]        [1]    --- transform -->      [0]\n           *             /                             / \\\n           *          [1,0]                       [0,0]  [0,1]\n           *           /                                   /\n           *       *[1,0,0]*                            *[0,1,0]*\n           * ```\n           *\n           */\n\n          return [Path.increment(Path.decrement(path, 1, pIndex), 1, npIndex)];\n        }\n        /*\n         * ## Move to path.\n         *\n         * ```js\n         * path       = [1]\n         * op.path    = [2]\n         * op.newPath = [1]\n         * ```\n         *\n         * move path to the right at op.newPath's level:      [1] -> [2]\n         *\n         * ```txt\n         *        [ ]                                    [ ]\n         *     __/ | \\__                              __/ | \\__\n         *  [0]  *[1]*  [2]   --- transform -->     [0]  [1]   *[2]*\n         * ```\n         *\n         * ## Move to path's younger.\n         *\n         * ```js\n         * path       = [1,0]\n         * op.path    = [1,1]\n         * op.newPath = [0]\n         * ```\n         *\n         * move path to the right at op.newPath's level:      [1,0] -> [2,0]\n         *\n         * ```txt\n         *        [ ]                                  [ ]\n         *     __/  \\__                             __/ | \\__\n         *  [0]      [1]    --- transform -->    [0]   [1]   [2]\n         *           /  \\                                     /\n         *      *[1,0]* [1,1]                             *[2,0]*\n         * ```\n         *\n         * ## Move to path's ancestor.\n         *\n         * ```js\n         * path       = [1,0]\n         * op.path    = [0,0]\n         * op.newPath = [1]\n         * ```\n         *\n         * move path to the right at op.newPath's level:      [1,0] -> [2,0]\n         *\n         * ```txt\n         *        [ ]                                    [ ]\n         *     __/  \\__                               __/ | \\__\n         *  [0]        [1]    --- transform -->    [0]   [1]   [2]\n         *   /          /                                       /\n         * [0,0]    *[1,0]*                                 *[2,0]*\n         * ```\n         *\n         */\n        return [Path.increment(path, 1, npIndex)];\n      } else if (pYounger) {\n        /**\n         * ## Move younger to the right of the path.\n         *\n         * ```js\n         * path       = [1,0]\n         * op.path    = [0]\n         * op.newPath = [1,1]\n         * ```\n         *\n         * move path backward at op.path's level:          [1,0] -> [0,0]\n         *\n         * ```txt\n         *         []                                       []\n         *        / \\                                      /\n         *     [0]  [1]       --- transform -->          [0]\n         *         /   \\                                 / \\\n         *    *[1,0]*  [1,1]                       *[0,0]* [0,1]\n         * ```\n         *\n         * ```js\n         * path       = [1]\n         * op.path    = [0]\n         * op.newPath = [2,0]\n         * ```\n         *\n         * move path backward at op.path's level:          [1] -> [0]\n         *\n         * ```txt\n         *         [ ]                                       []\n         *      __/ | \\__                                   / \\\n         *   [0]  *[1]*  [2]     --- transform -->      *[0]*  [1]\n         *               /                                     / \\\n         *            [2,0]                                [1,0] [1,1]\n         * ```\n         *\n         * ## Move younger below the path.\n         *\n         * ```js\n         * path       = [1,0]\n         * op.path    = [0]\n         * op.newPath = [1,1]\n         * ```\n         *\n         * move path backward at op.path's level:          [1,0] -> [0,0]\n         *\n         * ```txt\n         *         []                                       []\n         *        / \\                                      /\n         *     [0]  [1]       --- transform -->          [0]\n         *         /   \\                                 / \\\n         *    *[1,0]*  [1,1]                       *[0,0]* [0,1]\n         * ```\n         */\n\n        return [Path.decrement(path, 1, pIndex)];\n      }\n    }\n\n    return [path];\n  }\n\n    /**\n   * If the `path` is root path\n   *\n   *\n   * @param path\n   * @param target\n   *\n   * # Example\n   *\n   *\n   * ```ts\n   * Path.isRoot([]) // true\n   * ```\n   */\n  static isRoot(path: Path) {\n    return path.length === 0 ;\n  }\n}\n","import Path from './path';\nimport Node from './node';\n\nfunction whereToStr(where?: Path | string) {\n  if (typeof where === 'string') {\n    return `with key: ${where}.`;\n  } else if (Array.isArray(where)) {\n    return `with path: ${where}.`;\n  }\n  return `with unknown: ${typeof where}, ${where}.`;\n}\n\ntype NodeType = 'element' | 'node' | 'text' | 'block' | 'inline';\n\n/** 节点不存在 Error */\nexport class NodeNotFoundError extends Error {\n  static createAssertNotFoundError<T extends Node>(\n    type: NodeType,\n    ofType: (maybeNode: Node) => boolean,\n  ) {\n    return function assertNotFound(\n      maybeNode: Node | null,\n      method: string,\n      where?: Path | string,\n    ) {\n      if (!maybeNode || !ofType(maybeNode)) {\n        throw new NodeNotFoundError(method, type, where);\n      }\n      return maybeNode as T;\n    };\n  }\n\n  constructor(method: string, type: NodeType, where?: Path | string) {\n    super(`[${method}] could not find ${type} ${whereToStr(where)}`);\n    Object.setPrototypeOf(this, NodeNotFoundError.prototype);\n  }\n}\n\n/** 路径不存在的 Error */\nexport class PathNotFoundError extends Error {\n  constructor(key: string) {\n    super(`\\`Element.assertPath\\` could not find path with key: ${key}`);\n    Object.setPrototypeOf(this, PathNotFoundError.prototype);\n  }\n}\n","/**\n * @packageDocumentation\n * @module Models\n */\nimport Text from './text';\nimport Node, { NodeProperties } from './node';\nimport Path from './path';\nimport Mark, { MarkProperties } from './mark';\nimport keyUtils from '../utils/keyUtils';\nimport Data from '../interfaces/data';\nimport Block from './block';\nimport Inline from './inline';\nimport { NodeNotFoundError, PathNotFoundError } from './error';\n\nexport type KeysToEdgesTable = Record<string, [string, number]>;\n\nexport const KEYS_TO_EDGES_TABLE_CACHE = new WeakMap<\nElement,\nKeysToEdgesTable\n>();\n\nexport function linkKeysToEdgesTable(src: Element, target: Element) {\n  const table = KEYS_TO_EDGES_TABLE_CACHE.get(src);\n  if (table) {\n    KEYS_TO_EDGES_TABLE_CACHE.set(target, table);\n  }\n}\n\ntype Predicate<T extends Node = Node> = (\n  node: T,\n  index?: number,\n  self?: T[],\n) => boolean;\n\ntype Iterator<N extends Node = Node, T = void> = (node: N) => T;\n\nexport type ElementTypeName = 'block' | 'inline' | 'text';\n\nconst assertNode = NodeNotFoundError.createAssertNotFoundError<Node>(\n  'node',\n  (node) => node instanceof Node,\n);\nconst assertElement = NodeNotFoundError.createAssertNotFoundError<Element>(\n  'element',\n  (node) => node instanceof Element,\n);\nconst assertText = NodeNotFoundError.createAssertNotFoundError<Text>(\n  'text',\n  (node) => node instanceof Text,\n);\nconst assertBlock = NodeNotFoundError.createAssertNotFoundError<Block>(\n  'block',\n  (node) => node instanceof Block,\n);\n\nexport interface ElementProperties<\n  D extends Data = Data,\n  N extends Node[] = Node[],\n> extends NodeProperties {\n  data?: D;\n  nodes?: N;\n}\n\nexport default abstract class Element<\n  D extends Data = Data,\n  N extends Node[] = Node[],\n> extends Node {\n  /**\n   * 判断 `maybeElement` 是否为 Element\n   * @param maybeElement\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const block = (<block type=\"paragraph\">Hello</block>);\n   * const inline = (<inline type=\"link\">www.dingtalk.com</inline>);\n   * const text = (<text>Hello</text>);\n   *\n   * assertTrue(Element.isElement(block));\n   * assertTrue(Element.isElement(inline));\n   * assertFlase(Element.isElement(text));\n   * ```\n   */\n  static isElement(maybeElement: any): maybeElement is Element {\n    return maybeElement instanceof Element;\n  }\n\n  public readonly data: D;\n\n  public readonly nodes: N;\n\n  protected constructor(props: Required<ElementProperties<D, N>>) {\n    super(props);\n    const { data, nodes } = props;\n    this.data = { ...data };\n    this.nodes = nodes;\n  }\n\n  public abstract readonly type: string;\n\n  abstract merge(props: Partial<ElementProperties<D, N>>): Element;\n\n  abstract set<K extends keyof ElementProperties<N>>(\n    key: K,\n    value: Required<ElementProperties<D, N>>[K],\n  ): Element<D, N>;\n\n  /**\n   * 判断节点是否是 Inline 类型\n   *\n   * @example\n   * ```tsx\n   * const document = (<document><block type=\"paragraph\">Hello</block></document>);\n   * const block = (<block type=\"paragraph\">Hello</block>);\n   * const inline = (<inline type=\"link\">www.dingtalk.com</inline>);\n   *\n   * assertTrue(inline.isInline());\n   * assertFalse(block.isInline());\n   * assertFalse(document.isInline());\n   * ```\n   */\n  public isInline(): this is Inline {\n    return this instanceof Inline;\n  }\n\n  /**\n   * 判断节点是否是 Block 类型\n   *\n   * @example\n   * ```tsx\n   * const document = (<document><block type=\"paragraph\">Hello</block></document>);\n   * const block = (<block type=\"paragraph\">Hello</block>);\n   * const inline = (<inline type=\"link\">www.dingtalk.com</inline>);\n   *\n   * assertTrue(block.isBlock());\n   * assertFalse(inline.isBlock());\n   * assertFalse(document.isBlock());\n   * ```\n   */\n  public isBlock(): this is Block {\n    return this instanceof Block;\n  }\n\n  /**\n   * 重新生成节点 key，避免出现 key 重复的节点\n\n  * @example\n   * ```tsx\n   * const block = (<block type=\"paragraph\">Hello</block>);\n   *\n   * const newBlock = block.regenerateKey();\n   * assertFalse(block.key === newBlock.key);\n   * ```\n   * @returns\n   */\n  public regenerateKey() {\n    return this.set('key', keyUtils.create());\n  }\n\n  /**\n   * 获取子节点\n   * @param key\n   * @throws NodeNotFoundError 无法找到节点时，抛出异常\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       <text key=\"hello\">Hello</text>\n   *     </block>\n   *     <block type=\"paragraph\" key=\"world-block\">\n   *       <text key=\"world\">World</text>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(element.assertNode('own'), <block key=\"own\" />);\n   * assertEqual(element.assertNode('hello'), <text key=\"hello\" />);\n   * assertEqual(element.assertNode('world-block'), <block type=\"paragraph\" key=\"world-block\"/>);\n   * assert(() => element.assertNode('not-exists')).toThrow();\n   * ```\n   */\n  public assertNode(key: string) {\n    const node = this.getNode(key);\n    return assertNode(node, 'Element.assertNode', this.assertPath(key));\n  }\n\n  /**\n   * 获取子节点\n   * @param path\n   * @throws NodeNotFoundError 无法找到节点时，抛出异常\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       <text key=\"hello\">Hello</text>\n   *     </block>\n   *     <block type=\"paragraph\" key=\"world-block\">\n   *       <text key=\"world\">World</text>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(element.assertNodeByPath([]), <block key=\"own\" />);\n   * assertEqual(element.assertNodeByPath([0,0]), <text key=\"hello\" />);\n   * assertEqual(element.assertNodeByPath([1]), <block type=\"paragraph\" key=\"world-block\"/>);\n   * assert(() => element.assertNodeByPath([2])).toThrow();\n   * ```\n   *\n   *\n   */\n  public assertNodeByPath(path: Path) {\n    const node = this.getNodeByPath(path);\n    return assertNode(node, 'Element.assertNodeByPath', path);\n  }\n\n  /**\n   * 获取子 text 节点\n   * @param key\n   * @throws NodeNotFoundError 无法找到节点时，抛出异常\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       <text key=\"hello\">Hello</text>\n   *     </block>\n   *     <block type=\"paragraph\" key=\"world-block\">\n   *       <text key=\"world\">World</text>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.assertText('hello'),\n   *   <text key=\"hello\">Hello</text>\n   * );\n   * assert(() => element.assertText('hello-block')).toThrow();\n   * assert(() => element.assertText('not-exists')).toThrow();\n   * ```\n   */\n  public assertText(key: string) {\n    const node = this.getNode(key);\n    return assertText(node, 'Element.assertText', this.assertPath(key));\n  }\n\n  /**\n   * 获取子 text 节点\n   * @param path\n   * @throws NodeNotFoundError 无法找到节点时，抛出异常\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       <text key=\"hello\">Hello</text>\n   *     </block>\n   *     <block type=\"paragraph\" key=\"world-block\">\n   *       <text key=\"world\">World</text>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.assertTextByPath([0,0]),\n   *   <text key=\"hello\">Hello</text>\n   * );\n   * assert(() => element.assertTextByPath([0])).toThrow();\n   * assert(() => element.assertTextByPath([0,1])).toThrow();\n   * ```\n   */\n  public assertTextByPath(path: Path) {\n    const node = this.getNodeByPath(path);\n    return assertText(node, 'Element.assertTextByPath', path);\n  }\n\n  /**\n   * 根据 `key`，获取子 element 节点\n   * @param key\n   * @throws NodeNotFoundError 无法找到节点时，抛出异常\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       <text key=\"hello\">Hello</text>\n   *     </block>\n   *     <block type=\"paragraph\" key=\"world-block\">\n   *       <text key=\"world\">World</text>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.assertElement('hello-block'),\n   *   <block type=\"paragraph\" key=\"hello-block\" />\n   * );\n   * assert(() => element.assertElement('hello')).toThrow();\n   * assert(() => element.assertElement('not-exists')).toThrow();\n   * ```\n   */\n  public assertElement(key: string) {\n    const node = this.getNode(key);\n    return assertElement(node, 'Element.assertElement', this.assertPath(key));\n  }\n\n  /**\n   * 获取子 element 节点\n   * @param path\n   * @throws NodeNotFoundError 无法找到节点时，抛出异常\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       <text key=\"hello\">Hello</text>\n   *     </block>\n   *     <block type=\"paragraph\" key=\"world-block\">\n   *       <text key=\"world\">World</text>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.assertElementByPath([0]),\n   *   <block type=\"paragraph\" key=\"hello-block\" />\n   * );\n   * assert(() => element.assertElementByPath([0,0])).toThrow();\n   * assert(() => element.assertElementByPath([2])).toThrow();\n   * ```\n   */\n  public assertElementByPath(path: Path) {\n    const node = this.getNodeByPath(path);\n    return assertElement(node, 'Element.assertElementByPath', path);\n  }\n\n  /**\n   * 获取节点 path\n   * @param key\n   * @throws NodeNotFoundError 无法找到节点时，抛出异常\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       <text key=\"hello\">Hello</text>\n   *     </block>\n   *     <block type=\"paragraph\" key=\"world-block\">\n   *       <text key=\"world\">World</text>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(element.assertPath('own'), []);\n   * assertEqual(element.assertPath('hello-block'), [0]);\n   * assertEqual(element.assertPath('hello'), [0, 0]);\n   * assert(() => element.assertPath('not-exists')).toThrow();\n   * ```\n   */\n  public assertPath(key: string) {\n    const path = this.getPath(key);\n    if (path === null) {\n      throw new PathNotFoundError(key);\n    }\n    return path;\n  }\n\n  /**\n   * 判断节点是否存在于当前的节点子树中\n   * @param key\n   * @returns\n   *\n   * @example\n   *\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       <text key=\"hello\">Hello</text>\n   *     </block>\n   *     <block type=\"paragraph\" key=\"world-block\">\n   *       <text key=\"world\">World</text>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertTrue(element.hasNode('hello'));\n   * assertFalse(element.hasNode('own));\n   * assertFalse(element.hasNode('not-exists'));\n   * ```\n   */\n  public hasNode(key: string) {\n    return Boolean(this.getKeysToEdgesTable()[key]);\n  }\n\n  /**\n   * 判断节点是否为空：仅含有一个空的 text 节点\n   *\n   * @example\n   *\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <text />\n   *   </block>\n   * );\n   *\n   * assertTrue(element.isEmpty());\n   * ```\n   */\n  public isEmpty() {\n    const { nodes } = this;\n    return nodes.length === 1 && Text.isText(nodes[0]) && !nodes[0].text;\n  }\n\n  /**\n   * 获取子节点\n   * @param key\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       <text key=\"hello\">Hello</text>\n   *     </block>\n   *     <block type=\"paragraph\" key=\"world-block\">\n   *       <text key=\"world\">World</text>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(element.getNode('own'), <block key=\"own\" />);\n   * assertEqual(element.getNode('hello'), <text key=\"hello\" />);\n   * assertEqual(element.getNode('world-block'), <block type=\"paragraph\" key=\"world-block\"/>);\n   * assertEqual(element.getNode(), null);\n   * ```\n   */\n  public getNode(key: string) {\n    const path = this.getPath(key);\n    return this.getNodeByPath(path);\n  }\n\n  /**\n   * 获取子节点，如果没有找到，将返回 null\n   * @param path\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       <text key=\"hello\">Hello</text>\n   *     </block>\n   *     <block type=\"paragraph\" key=\"world-block\">\n   *       <text key=\"world\">World</text>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(element.getNodeByPath([]), <block key=\"own\" />);\n   * assertEqual(element.getNodeByPath([0,0]), <text key=\"hello\" />);\n   * assertEqual(element.getNodeByPath([1]), <block type=\"paragraph\" key=\"world-block\"/>);\n   * assertEqual(element.getNodeByPath([2]), null);\n   * ```\n   */\n  public getNodeByPath(path: Path | null) {\n    if (!path) {\n      return null;\n    }\n\n    return path.reduce((n: Node | null, index: number, idx) => {\n      if (!n) {\n        return null;\n      }\n      const node = n.toSubType();\n      if (node.isText()) {\n        return idx === path.length - 1 ? node : null;\n      }\n      return node.nodes[index] || null;\n    }, this);\n  }\n\n  /**\n   * 获取相对于当前节点的 path，如果没有找到，就返回 `null`\n   * @param key\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       <text key=\"hello\">Hello</text>\n   *     </block>\n   *     <block type=\"paragraph\" key=\"world-block\">\n   *       <text key=\"world\">World</text>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(element.getPath('own'), []);\n   * assertEqual(element.getPath('hello'), [0,0]);\n   * assertEqual(element.getPath('world-block'), [1]);\n   * assertEqual(element.getPath('not-exists'), null);\n   * ```\n   */\n  public getPath(key: string) {\n    if (key === this.key) {\n      return [];\n    }\n\n    const keysToEdgesTable = this.getKeysToEdgesTable();\n    if (!keysToEdgesTable[key]) {\n      return null;\n    }\n\n    const path: Path = [];\n    let k = key;\n    while (keysToEdgesTable[k]) {\n      const [parentKey, index] = keysToEdgesTable[k];\n      path.push(index);\n      k = parentKey;\n    }\n    path.reverse();\n    return path;\n  }\n\n  /**\n   * 获取上一个兄弟节点，若不存在，将返回 null\n   * @param key\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *     <block type=\"paragraph\" key=\"world-block\">World</block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getPreviousSibling('world-block'),\n   *   <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   * );\n   * assertEqual(\n   *   element.getPreviousSibling('hello-block'),\n   *   null\n   * );\n   * ```\n   */\n  public getPreviousSibling(key: string) {\n    const path = this.getPath(key);\n    if (!path || path.length === 0) {\n      return null;\n    }\n    return this.getPreviousSiblingByPath(path);\n  }\n\n  /**\n   * 获取上一个兄弟节点，若不存在，将返回 null\n   * @param path\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *     <block type=\"paragraph\" key=\"world-block\">World</block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getPreviousSiblingByPath([1]),\n   *   <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   * );\n   * assertEqual(\n   *   element.getPreviousSiblingByPath([0]),\n   *   null\n   * );\n   * ```\n   */\n  public getPreviousSiblingByPath(path: Path) {\n    const lastIndex = path[path.length - 1];\n    if (lastIndex <= 0) {\n      return null;\n    }\n    return this.getNodeByPath(Path.decrement(path));\n  }\n\n  /**\n   * 获取下一个兄弟节点，若不存在，返回 null\n   * @param key\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *     <block type=\"paragraph\" key=\"world-block\">World</block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getNextSibling('hello-block'),\n   *   <block type=\"paragraph\" key=\"world-block\">World</block>\n   * );\n   * assertEqual(\n   *   element.getNextSibling('world-block'),\n   *   null\n   * );\n   * ```\n   */\n  public getNextSibling(key: string) {\n    const path = this.getPath(key);\n    if (!path || path.length === 0) {\n      return null;\n    }\n    return this.getNextSiblingByPath(path);\n  }\n\n  /**\n   * 获取下一个兄弟节点，若不存在，返回 null\n   * @param path\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *     <block type=\"paragraph\" key=\"world-block\">World</block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getNextSiblingByPath([0]),\n   *   <block type=\"paragraph\" key=\"world-block\">World</block>\n   * );\n   * assertEqual(\n   *   element.getNextSiblingByPath([1]),\n   *   null\n   * );\n   * ```\n   */\n  public getNextSiblingByPath(path: Path) {\n    return this.getNodeByPath(Path.increment(path));\n  }\n\n  /**\n   * 获取上一个叶子节点，若不存在，将返回 null\n   * @param key\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *       <block type=\"paragraph\" key=\"world-block\">World</block>\n   *     </block>\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"cangjie-block\">Cangjie</block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getPreviousNode('cangjie-block'),\n   *   <text>World</text>\n   * );\n   * assertEqual(\n   *   element.getPreviousNode('hello-block'),\n   *   null\n   * );\n   * ```\n   */\n  public getPreviousNode(key: string) {\n    const path = this.getPath(key);\n    if (!path) {\n      return null;\n    }\n    return this.getPreviousNodeByPath(path);\n  }\n\n  /**\n   * 获取上一个叶子节点，若不存在，将返回 null\n   * @param path\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *       <block type=\"paragraph\" key=\"world-block\">World</block>\n   *     </block>\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"cangjie-block\">Cangjie</block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getPreviousNodeByPath([1,0]),\n   *   <text>World</text>\n   * );\n   * assertEqual(\n   *   element.getPreviousNodeByPath([0,0]),\n   *   null\n   * );\n   * ```\n   */\n  public getPreviousNodeByPath(path: Path) {\n    let previousNode = this.getPreviousSiblingByPath(path);\n    let parentPath = Path.parent(path);\n    while (!previousNode && parentPath.length) {\n      const parentPrevSibling = this.getPreviousSiblingByPath(parentPath);\n      previousNode = parentPrevSibling && parentPrevSibling.getLastNode();\n      parentPath = Path.parent(parentPath);\n    }\n    return previousNode;\n  }\n\n  /**\n   * 获取下一个叶子节点，若不存在，将返回 null\n   * @param key\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *     </block>\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"world-block\">World</block>\n   *       <block type=\"paragraph\" key=\"cangjie-block\">Cangjie</block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getNextNode('hello-block'),\n   *   <text>World</text>\n   * );\n   * assertEqual(\n   *   element.getNextNode('cangjie-block'),\n   *   null\n   * );\n   * ```\n   */\n  public getNextNode(key: string) {\n    const path = this.getPath(key);\n    if (!path) {\n      return null;\n    }\n    return this.getNextNodeByPath(path);\n  }\n\n  /**\n   * 获取下一个叶子节点，若不存在，将返回 null\n   * @param path\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *     </block>\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"world-block\">World</block>\n   *       <block type=\"paragraph\" key=\"cangjie-block\">Cangjie</block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getNextNodeByPath([0, 0]),\n   *   <text>World</text>\n   * );\n   * assertEqual(\n   *   element.getNextNodeByPath([1,1]),\n   *   null\n   * );\n   * ```\n   */\n  public getNextNodeByPath(path: Path) {\n    let nextNode = this.getNextSiblingByPath(path);\n    let parentPath = Path.parent(path);\n    while (!nextNode && parentPath.length) {\n      const parentNextSibling = this.getNextSiblingByPath(parentPath);\n      nextNode = parentNextSibling && parentNextSibling.getFirstNode();\n      parentPath = Path.parent(parentPath);\n    }\n    return nextNode;\n  }\n\n  /**\n   * 获取上一个文本节点\n   * @param key\n   * @throws NodeNotFoundError 若节点不存在，则抛错\n   * @returns\n   *\n   * * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *       <block type=\"paragraph\" key=\"world-block\">World</block>\n   *     </block>\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"cangjie-block\">Cangjie</block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.assertPreviousText('cangjie-block'),\n   *   <text>World</text>\n   * );\n   * assert(() => element.assertPreviousText('hello-block')).toThrow();\n   * ```\n   */\n  public assertPreviousText(key: string) {\n    const text = this.getPreviousText(key);\n    return assertText(text, 'assertPreviousText', key);\n  }\n\n  /**\n   * 获取上一个文本节点，若不存在，将返回 null\n   * @param key\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *       <block type=\"paragraph\" key=\"world-block\">World</block>\n   *     </block>\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"cangjie-block\">Cangjie</block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getPreviousText('cangjie-block'),\n   *   <text>World</text>\n   * );\n   * assertEqual(\n   *   element.getPreviousText('hello-block'),\n   *   null\n   * );\n   * ```\n   */\n  public getPreviousText(key: string) {\n    const path = this.getPath(key);\n    if (!path || !path.length) {\n      return null;\n    }\n    return this.getPreviousTextByPath(path);\n  }\n\n  /**\n   * 获取上一个文本节点，若不存在，将返回 null\n   * @param path\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *       <block type=\"paragraph\" key=\"world-block\">World</block>\n   *     </block>\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"cangjie-block\">Cangjie</block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getPreviousTextByPath([1,0]),\n   *   <text>World</text>\n   * );\n   * assertEqual(\n   *   element.getPreviousTextByPath([0]),\n   *   null\n   * );\n   * ```\n   */\n  public getPreviousTextByPath(path: Path) {\n    let previous = this.getPreviousNodeByPath(path);\n    while (previous?.isElement() && !previous.nodes.length) {\n      const previousPath = this.getPath(previous.key);\n      if (!previousPath) {\n        return null;\n      }\n      previous = this.getPreviousNodeByPath(previousPath);\n    }\n    if (!previous) {\n      return null;\n    }\n    return previous.getLastText();\n  }\n\n  /**\n   * 获取下一个文本节点，若不存在，将返回 null\n   * @param key\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *     </block>\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"world-block\">World</block>\n   *       <block type=\"paragraph\" key=\"cangjie-block\">Cangjie</block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getNextText('hello-block'),\n   *   <text>World</text>\n   * );\n   * assertEqual(\n   *   element.getNextText('cangjie-block'),\n   *   null\n   * );\n   * ```\n   */\n  public getNextText(key: string) {\n    const path = this.getPath(key);\n    if (!path || !path.length) {\n      return null;\n    }\n    return this.getNextTextByPath(path);\n  }\n\n  /**\n   * 获取下一个文本节点，若不存在，将返回 null\n   * @param path\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *     </block>\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"world-block\">World</block>\n   *       <block type=\"paragraph\" key=\"cangjie-block\">Cangjie</block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getNextTextByPath([0,0]),\n   *   <text>World</text>\n   * );\n   * assertEqual(\n   *   element.getNextTextByPath([1,1]),\n   *   null\n   * );\n   * ```\n   */\n  public getNextTextByPath(path: Path) {\n    let next = this.getNextNodeByPath(path);\n    while (next?.isElement() && !next.nodes.length) {\n      const nextPath = this.getPath(next.key);\n      if (!nextPath) {\n        return null;\n      }\n      next = this.getNextNodeByPath(nextPath);\n    }\n    if (!next) {\n      return null;\n    }\n    return next.getFirstText();\n  }\n\n  /**\n   * 获取上一个 block，若不存在，将返回 null\n   * @param key\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *       <block type=\"paragraph\" key=\"world-block\">World</block>\n   *     </block>\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"cangjie-block\">Cangjie</block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getPreviousBlock('cangjie-block'),\n   *   <block type=\"paragraph\" key=\"world-block\">World</block>\n   * );\n   * assertEqual(\n   *   element.getPreviousBlock('hello-block'),\n   *   null\n   * );\n   * ```\n   */\n  public getPreviousBlock(key: string) {\n    const child = this.getNode(key);\n    if (!child) {\n      return null;\n    }\n\n    let first: Text | null;\n    if (Block.isBlock(child)) {\n      first = child.getFirstText();\n    } else {\n      const block = this.getClosestBlock(key)!;\n      first = block.getFirstText();\n    }\n\n    const previous = first && this.getPreviousText(first.key);\n    if (!previous) {\n      return null;\n    }\n\n    return this.getClosestBlock(previous.key);\n  }\n\n  /**\n   * 获取下一个 block，若不存在，将返回 null\n   * @param key\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *     </block>\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"world-block\">World</block>\n   *       <block type=\"paragraph\" key=\"cangjie-block\">Cangjie</block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getNextBlock('hello-block'),\n   *   <block type=\"paragraph\" key=\"world-block\">World</block>\n   * );\n   * assertEqual(\n   *   element.getNextBlock('cangjie-block'),\n   *   null\n   * );\n   * ```\n   */\n  public getNextBlock(key: string) {\n    const child = this.getNode(key);\n    if (!child) {\n      return null;\n    }\n    let last;\n\n    if (Block.isBlock(child)) {\n      last = child.getLastText();\n    } else {\n      const block = this.getClosestBlock(key);\n      last = block!.getLastText();\n    }\n    if (!last) return null;\n\n    const next = this.getNextText(last.key);\n    if (!next) return null;\n\n    const closest = this.getClosestBlock(next.key);\n    return closest;\n  }\n\n  /**\n   * 获取节点 Key-to-Path 的映射表\n   *\n   * @example\n   * ```ts\n   * const element = (\n   *   <block type=\"container\" key=\"container\">\n   *     <block type=\"paragraph\" key=\"world-block\">\n   *       <text key=\"world\">World</text>\n   *     </block>\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       <text key=\"hello\">Hello</text>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * const table = element.getKeysToEdgesTable();\n   * assertEqual(\n   *   table,\n   *   {\n   *     'world-block': ['container', 0],\n   *     'world':       ['world-block', 0],\n   *     'hello-block': ['container', 1],\n   *     'hello':       ['hello-block', 0]\n   *   }\n   * );\n   * ```\n   */\n  public getKeysToEdgesTable() {\n    if (!KEYS_TO_EDGES_TABLE_CACHE.has(this)) {\n      const { key, nodes } = this;\n      const { length } = nodes;\n      const table: KeysToEdgesTable = Object.create(null);\n      for (let i = 0; i < length; i += 1) {\n        const node = nodes[i];\n        table[node.key] = [key, i];\n        if (!Element.isElement(node)) {\n          continue;\n        }\n\n        const nested = node.getKeysToEdgesTable();\n        // PERF\n        node.forEachDescendant((n) => {\n          table[n.key] = nested[n.key];\n        });\n      }\n      KEYS_TO_EDGES_TABLE_CACHE.set(this, table);\n    }\n    return KEYS_TO_EDGES_TABLE_CACHE.get(this)!;\n  }\n\n  /**\n   * 获取节点下的文本\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *     </block>\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"world-block\">World</block>\n   *       <block type=\"paragraph\" key=\"cangjie-block\">Cangjie</block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(element.text, 'HelloWorldCangjie');\n   * ```\n   */\n  public get text() {\n    return this.getTexts().reduce((str, { text }) => `${str}${text}`, '');\n  }\n\n  /**\n   * 获得最远的满足 `predicate` 断言的祖先节点\n   * @param key\n   * @param predicate\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"container\" key=\"container-1\">\n   *       <block type=\"container\" key=\"container-2\">\n   *         <block type=\"paragraph\">\n   *           <text key=\"hello\">Hello</text>\n   *         </block>\n   *       </block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getFurthsest('hello', (node) => node.type === 'container'),\n   *   <block type=\"container\" key=\"container-1\" />\n   * );\n   * ```\n   */\n  public getFurthsest(key: string, predicate: Predicate<Element>) {\n    const path = this.getPath(key);\n    if (!path) {\n      return null;\n    }\n    return this.getFurthsestByPath(path, predicate);\n  }\n\n  /**\n   * 获得最远的满足 `predicate` 断言的祖先节点\n   *\n   * @param path\n   * @param predicate\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"container\" key=\"container-1\">\n   *       <block type=\"container\" key=\"container-2\">\n   *         <block type=\"paragraph\">\n   *           <text key=\"hello\">Hello</text>\n   *         </block>\n   *       </block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getFurthsestByPath([0,0,0,0], (node) => node.type === 'container'),\n   *   <block type=\"container\" key=\"container-1\" />\n   * );\n   * ```\n   */\n  public getFurthsestByPath(path: Path, predicate: Predicate<Element>) {\n    const ancestors = this.getAncestorsByPath(path);\n    if (!ancestors || !ancestors.length) {\n      return null;\n    }\n\n    const fursest = ancestors.find((node, index) => {\n      if (node === this) {\n        return false;\n      }\n      return predicate(node, index);\n    }, []);\n    return fursest || null;\n  }\n\n  /**\n   * 获得最远的 Inline 祖先\n   * @param key\n   * @param returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <inline type=\"inline-block\">\n   *       <inline type=\"link\">\n   *         <text key=\"hello\">Hello</text>\n   *       </inline>\n   *     </inline>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getFurthsestInline('hello'),\n   *   <inline type=\"inline-block\" />\n   * );\n   * ```\n   */\n  public getFurthsestInline(key: string): Inline | null {\n    const node = this.getFurthsest(key, (n) => Inline.isInline(n));\n    if (node?.isElement() && node.isInline()) {\n      return node;\n    }\n    return null;\n  }\n\n  /**\n   * 获得最远的 Block 祖先\n   * @param key\n   * @param returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"container\" key=\"container-1\">\n   *       <block type=\"container\" data={{highlight: true}} key=\"container-2\">\n   *         <block type=\"paragraph\">\n   *           <text key=\"hello\">Hello</text>\n   *         </block>\n   *       </block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getFurthsestBlock('hello'),\n   *   <block type=\"container\" key=\"container-1\" />\n   * );\n   * ```\n   */\n  public getFurthsestBlock(key: string): Block | null {\n    const node = this.getFurthsest(key, (n) => Block.isBlock(n));\n    if (node?.isElement() && node.isBlock()) {\n      return node;\n    }\n    return null;\n  }\n\n  /**\n   * 获得最远的、仅含有一个子孙的祖先\n   * @param key\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"container\" key=\"multiple-child\">\n   *       <block type=\"container\" key=\"only-child\">\n   *         <block type=\"paragraph\">\n   *           <text key=\"hello\">Hello</text>\n   *         </block>\n   *       </block>\n   *       <block type=\"paragraph\">World</block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getFurthestOnlyChildAncestor('hello'),\n   *   <block type=\"container\" key=\"only-child\" />\n   * );\n   * ```\n   */\n  public getFurthestOnlyChildAncestor(key: string) {\n    const path = this.getPath(key);\n    if (!path) {\n      return null;\n    }\n    return this.getFurthestOnlyChildAncestorByPath(path);\n  }\n\n  /**\n   * 获得最远的、仅含有一个子孙的祖先\n   * @param path\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"container\" key=\"multiple-child\">\n   *       <block type=\"container\" key=\"only-child\">\n   *         <block type=\"paragraph\">\n   *           <text key=\"hello\">Hello</text>\n   *         </block>\n   *       </block>\n   *       <block type=\"paragraph\">World</block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getFurthestOnlyChildAncestorByPath([0,0,0,0]),\n   *   (<block type=\"container\" key=\"only-child\" />)\n   * );\n   * ```\n   */\n  public getFurthestOnlyChildAncestorByPath(path: Path) {\n    const ancestors = this.getAncestorsByPath(path);\n    if (!ancestors) {\n      return null;\n    }\n\n    const furthest = ancestors\n      .slice(1) // ignore self\n      .find((node) => node instanceof Element && node.nodes.length === 1);\n\n    return furthest || null;\n  }\n\n  /**\n   * 获得节点所有的祖先\n   * @param key\n   * @returns 祖先序列\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\">\n   *     <block type=\"paragraph\">\n   *       <text key=\"hello\">Hello</text>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getAncestors('hello'),\n   *   [\n   *     <block type=\"container\" />,\n   *     <block type=\"paragraph\" />\n   *   ]\n   * )\n   * ```\n   */\n  public getAncestors(key: string): Element[] {\n    const path = this.getPath(key);\n    return this.getAncestorsByPath(path);\n  }\n\n  /**\n   * 获得节点所有的祖先\n   * @param path\n   * @returns 祖先序列\n   *\n   * @example\n   *\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\">\n   *     <block type=\"paragraph\">\n   *       <text key=\"hello\">Hello</text>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getAncestorsByPath([0,0]),\n   *   [\n   *     <block type=\"container\" />,\n   *     <block type=\"paragraph\" />\n   *   ]\n   * )\n   * ```\n   */\n  public getAncestorsByPath(path: Path | null): Element[] {\n    if (!path || !this.getNodeByPath(path)) {\n      return [];\n    }\n    const ancestors: Element[] = [];\n\n    path.forEach((_, index) => {\n      const subPath = path.slice(0, index);\n      const ancestor = this.getNodeByPath(subPath);\n      if (ancestor?.isElement()) {\n        ancestors.push(ancestor);\n      }\n    });\n\n    return ancestors;\n  }\n\n  /**\n   * 获得最近的满足 `predicate` 断言的祖先，祖先不包含当前节点\n   * @param key\n   * @param predicate\n   * @returns\n   *\n   * @example\n   *\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\" key=\"container-1\">\n   *    <block type=\"container\" key=\"container-2\">\n   *      <block type=\"paragraph\">\n   *        <text key=\"hello\">Hello</text>\n   *       </block>\n   *    </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getClosest('hello', (node) => node.type === 'container'),\n   *   <block type=\"container\" key=\"container-2\" />,\n   * );\n   *\n   * assertEqual(\n   *   element.getClosest('hello', (node) => node.key === 'container-1'),\n   *   null,\n   * );\n   * ```\n   */\n  public getClosest(key: string, predicate: Predicate<Element>) {\n    const path = this.getPath(key);\n    return this.getClosestByPath(path, predicate);\n  }\n\n  /**\n   * 获得最近的满足 `predicate` 断言的祖先，祖先不包含当前节点\n   * @param key\n   * @param predicate\n   * @returns\n   *\n   * @example\n   *\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\" key=\"container-1\">\n   *    <block type=\"container\" key=\"container-2\">\n   *      <block type=\"paragraph\">\n   *        <text key=\"hello\">Hello</text>\n   *       </block>\n   *    </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getClosestByPath([0,0,0], (node) => node.type === 'container'),\n   *   <block type=\"container\" key=\"container-2\" />,\n   * );\n   * assertEqual(\n   *   element.getClosestByPath([0,0,0], (node) => node.key === 'container-1'),\n   *   null,\n   * );\n   * ```\n   */\n  public getClosestByPath(\n    path: Path | null,\n    predicate: Predicate<Element>,\n  ): Element | null {\n    if (!path) {\n      return null;\n    }\n    const ancestors = this.getAncestorsByPath(path);\n    const closest = ancestors.reverse().find((node, index, self) => {\n      if (node === this) return false;\n      return predicate(node, index, self);\n    });\n    return closest || null;\n  }\n\n  /**\n   * 获得最近的 Inline\n   * @param key\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\">\n   *    <inline type=\"highlight\">\n   *      <inline type=\"link\">\n   *        <text key=\"hello\">Hello</text>\n   *       </inline>\n   *    </inline>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getClosestInline('hello'),\n   *   <inline type=\"link\" />,\n   * );\n   * ```\n   */\n  public getClosestInline(key: string): Inline | null {\n    const path = this.getPath(key);\n    if (!path) {\n      return null;\n    }\n    return this.getClosestInlineByPath(path);\n  }\n\n  /**\n   * 获得最近的 Inline\n   * @param path\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\">\n   *    <inline type=\"highlight\">\n   *      <inline type=\"link\">\n   *        <text key=\"hello\">Hello</text>\n   *       </inline>\n   *    </inline>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getClosestInlineByPath([0,0,0]),\n   *   <inline type=\"link\" />,\n   * );\n   * ```\n   */\n  public getClosestInlineByPath(path: Path): Inline | null {\n    const closest = this.getClosestByPath(path, (n) => Inline.isInline(n));\n    if (closest?.isElement() && closest.isInline()) {\n      return closest;\n    }\n    return null;\n  }\n\n  /**\n   * 获取最近的 block 祖先\n   * @param key\n   * @returns\n   * @throws NodeNotFoundError 若节点不存在，抛错\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\" key=\"container-1\">\n   *    <block type=\"container\" key=\"container-2\">\n   *      <block type=\"paragraph\">\n   *        <text key=\"hello\">Hello</text>\n   *       </block>\n   *    </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.assertClosestBlock('hello'),\n   *   <block type=\"paragraph\" />\n   * );\n   * assert(() =>element.assertClosestBlock('hello')).toThrow();\n   * ```\n   */\n  public assertClosestBlock(key: string): Block {\n    const block = this.getClosestBlock(key);\n    return assertBlock(block, 'assertClosestBlock', key);\n  }\n\n  /**\n   * 获取最近的 block 祖先\n   * @param key\n   * @param returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\" key=\"container-1\">\n   *    <block type=\"container\" key=\"container-2\">\n   *      <block type=\"paragraph\">\n   *        <text key=\"hello\">Hello</text>\n   *       </block>\n   *    </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getClosestBlock('hello'),\n   *   <block type=\"paragraph\" />\n   * );\n   * assertEqual(\n   *   element.getClosestBlock('hello'),\n   *   null\n   * );\n   * ```\n   */\n  public getClosestBlock(key: string): Block | null {\n    const path = this.getPath(key);\n    return path ? this.getClosestBlockByPath(path) : null;\n  }\n\n  /**\n   * 获取最近的 block 祖先\n   * @param path\n   * @param returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\" key=\"container-1\">\n   *    <block type=\"container\" key=\"container-2\">\n   *      <block type=\"paragraph\">\n   *        <text key=\"hello\">Hello</text>\n   *       </block>\n   *    </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getClosestBlockByPath([0,0,0]),\n   *   <block type=\"paragraph\" />\n   * );\n   * assertEqual(\n   *   element.getClosestBlockByPath([]),\n   *   null\n   * );\n   * ```\n   */\n  public getClosestBlockByPath(path: Path): Block | null {\n    const closest = this.getClosestByPath(path, (n) => Block.isBlock(n));\n    if (closest?.isElement() && closest.isBlock()) {\n      return closest;\n    }\n    return null;\n  }\n\n  /**\n   * 获取最近的 block 祖先，如果节点本身就是 block，则返回节点\n   * @param key\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\" key=\"container-1\">\n   *    <block type=\"container\" key=\"container-2\">\n   *      <block type=\"paragraph\" key=\"hello-block\">\n   *        <text key=\"hello\">Hello</text>\n   *       </block>\n   *    </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getClosestBlockFromPoint('hello-block'),\n   *   <block type=\"paragraph\" />\n   * );\n   * assertEqual(\n   *   element.getClosestBlockFromPoint('hello'),\n   *   <block type=\"paragraph\" />\n   * );\n   * ```\n   */\n  public getClosestBlockFromPoint(key: string): Block | null {\n    const node = this.getNode(key);\n    if (node && node.isElement() && node.isBlock()) {\n      return node;\n    }\n    return this.getClosestBlock(key);\n  }\n\n  /**\n   * 获得最远的祖先\n   * @param key\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\" key=\"container-1\">\n   *    <block type=\"container\" key=\"container-2\">\n   *      <block type=\"paragraph\" key=\"paragraph\">\n   *        <text key=\"hello\">Hello</text>\n   *       </block>\n   *    </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getFurthestAncestor('hello'),\n   *   <block type=\"container\" key=\"container-2\" />\n   * );\n   * assertEqual(\n   *   element.getFurthestAncestor('container-1'),\n   *   null,\n   * );\n   * ```\n   */\n  public getFurthestAncestor(key: string): Node | null {\n    const childPath = this.getPath(key);\n    if (!childPath || !childPath.length) {\n      return null;\n    }\n    const node = this.nodes[childPath[0]];\n    return node;\n  }\n\n  /**\n   * 获得最远的祖先\n   * @param key\n   * @throws NodeNotFoundError 节点不存在时，抛错\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\" key=\"container-1\">\n   *    <block type=\"container\" key=\"container-2\">\n   *      <block type=\"paragraph\" key=\"paragraph\">\n   *        <text key=\"hello\">Hello</text>\n   *       </block>\n   *    </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.assertFurthestAncestor('hello'),\n   *   <block type=\"container\" key=\"container-2\" />\n   * );\n   * assert(\n   *   () =>element.assertFurthestAncestor('container-1'),\n   * ).toThrow();\n   * ```\n   */\n  public assertFurthestAncestor(key: string): Node {\n    const node = this.getFurthestAncestor(key);\n    return assertNode(node, 'assertFurthestAncestor', key);\n  }\n\n  /**\n   * 获得节点的偏移位置，以文本为单位测算\n   * @param key\n   * @returns\n   * @throws NodeNotFoundError 节点不存在时，抛错\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\" key=\"container-1\">\n   *    <block type=\"paragraph\" key=\"world-block\">World</block>\n   *    <block type=\"container\" key=\"container-2\">\n   *      <block type=\"paragraph\" key=\"hello-block\">\n   *        <text key=\"hello\">Hello</text>\n   *       </block>\n   *    </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(element.getOffset('hello'), 5);\n   * assertEqual(element.getOffset('hello-block'), 5);\n   * assertEqual(element.getOffset('world-block'), 0);\n   * ```\n   */\n  public getOffset(key: string): number {\n    this.assertNode(key);\n\n    // Calculate the offset of the nodes before the highest child.\n    const child = this.getFurthestAncestor(key);\n    if (!child) {\n      return 0;\n    }\n    const childIndex = this.nodes.findIndex((n) => n === child);\n    const offset = this.nodes\n      .slice(0, childIndex)\n      .reduce((memo, n) => memo + n.text.length, 0);\n\n    return key === child.key\n      ? offset\n      : offset + (child.isElement() ? child.getOffset(key) : 0);\n  }\n\n  /**\n   * 获取父节点\n   * @param key\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\" key=\"container-1\">\n   *    <block type=\"container\" key=\"container-2\">\n   *      <block type=\"paragraph\" key=\"paragraph\">\n   *        <text key=\"hello\">Hello</text>\n   *       </block>\n   *    </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getParent('hello'),\n   *   <block type=\"paragraph\" />\n   * );\n   *\n   * assertEqual(\n   *   element.getParent('container-1'),\n   *   null,\n   * );\n   * ```\n   */\n  public getParent(key: string) {\n    const path = this.getPath(key);\n    return this.getParentByPath(path);\n  }\n\n  /**\n   * 获取父节点\n   * @param key\n   * @returns\n   * @throws NodeNotFoundError 节点不存在时，抛错\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\" key=\"container-1\">\n   *    <block type=\"container\" key=\"container-2\">\n   *      <block type=\"paragraph\" key=\"paragraph\">\n   *        <text key=\"hello\">Hello</text>\n   *       </block>\n   *    </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.assertParent('hello'),\n   *   <block type=\"paragraph\" />\n   * );\n   * assert(() => element.assertParent('container-1')).toThrow();\n   * ```\n   */\n  public assertParent(key: string) {\n    const element = this.getParent(key);\n    return assertElement(element, 'assertParent', key);\n  }\n\n  /**\n   * 获取父节点\n   * @param path\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\" key=\"container-1\">\n   *    <block type=\"container\" key=\"container-2\">\n   *      <block type=\"paragraph\" key=\"paragraph\">\n   *        <text key=\"hello\">Hello</text>\n   *       </block>\n   *    </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getParentByPath([0,0,0]),\n   *   <block type=\"paragraph\" />\n   * );\n   *\n   * assertEqual(\n   *   element.getParentByPath([]),\n   *   null,\n   * );\n   * ```\n   */\n  public getParentByPath(path: Path | null): Element | null {\n    if (!path || !path.length || !this.getNodeByPath(path)) {\n      return null;\n    }\n    const node = this.getNodeByPath(path.slice(0, -1));\n    if (node?.isElement()) {\n      return node;\n    }\n    return null;\n  }\n\n  /**\n   * 获取公共祖先\n   * @param a\n   * @param b\n   * @throws NodeNotFoundError 节点不存在，抛错\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\" key=\"container\">\n   *    <block type=\"paragraph\" key=\"hello\">Hello</block>\n   *    <block type=\"container\">\n   *      <block type=\"paragraph\" key=\"world\">World</block>\n   *    </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.assertCommonAncestor('hello', 'world'),\n   *   <block type=\"container\" key=\"container\" />\n   * );\n   * assertEqual(\n   *   element.assertCommonAncestor('container', 'world'),\n   *   <block type=\"container\" key=\"container\" />\n   * );\n   * assertEqual(\n   *   () => element.assertCommonAncestor('not-exists', 'hello'),\n   * ).toThrow();\n   * ```\n   */\n  public assertCommonAncestor(a: string, b: string) {\n    const element = this.getCommonAncestor(a, b);\n    return assertElement(element, 'assertCommonAncestor', `[${a}, ${b}]`);\n  }\n\n  /**\n   * 获取公共祖先\n   * @param a\n   * @param b\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\" key=\"container\">\n   *    <block type=\"paragraph\" key=\"hello\">Hello</block>\n   *    <block type=\"container\">\n   *      <block type=\"paragraph\" key=\"world\">World</block>\n   *    </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getCommonAncestor('hello', 'world'),\n   *   <block type=\"container\" key=\"container\" />\n   * );\n   * assertEqual(\n   *   element.getCommonAncestor('container', 'world'),\n   *   <block type=\"container\" key=\"container\" />\n   * );\n   * assertEqual(\n   *   element.getCommonAncestor('not-exists', 'hello'),\n   *   null,\n   * );\n   * ```\n   */\n  public getCommonAncestor(a: string, b: string) {\n    const aPath = this.getPath(a);\n    const bPath = this.getPath(b);\n    if (!aPath || !bPath) {\n      return null;\n    }\n    const node = this.getNodeByPath(Path.common(aPath, bPath));\n    return node?.isElement() ? node : null;\n  }\n\n  /**\n   * 获取 [`startKey`, `endKey`] 之间的所有 text\n   * @param startKey 起始 text key\n   * @param endKey   结束 text key\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\" key=\"container\">\n   *    <block type=\"paragraph\">\n   *      <text key=\"hello\">Hello</text>\n   *    </block>\n   *    <block type=\"paragraph\">\n   *      <text key=\"world\">World</text>\n   *    </block>\n   *    <block type=\"container\">\n   *      <block type=\"paragraph\">\n   *        <text key=\"cangjie\">Cangjie</text>\n   *      </block>\n   *    </block>\n   *    <block type=\"paragraph\">\n   *      <text key=\"footer\">Footer</text>\n   *    </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getTextsBetweenPositions('hello', 'cangjie'),\n   *   [\n   *     <text key=\"hello\">Hello</text>,\n   *     <text key=\"world\">World</text>,\n   *     <text key=\"cangjie\">Cangjie</text>,\n   *   ]\n   * );\n   * ```\n   */\n  public getTextsBetweenPositions(startKey: string, endKey: string): Text[] {\n    const startText = this.getNode(startKey);\n    if (!startText?.isText()) {\n      return [];\n    }\n    if (startKey === endKey) return [startText];\n    const endText = this.getNode(endKey);\n    if (!endText?.isText()) {\n      return [];\n    }\n\n    const texts = this.getTexts();\n    const start = texts.indexOf(startText);\n    const end = texts.indexOf(endText, start);\n    const result = texts.slice(start, end + 1);\n    return result;\n  }\n\n  /**\n   * 获取节点树下所有 text\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\" key=\"container\">\n   *    <block type=\"paragraph\">\n   *      <text key=\"hello\">Hello</text>\n   *    </block>\n   *    <block type=\"paragraph\">\n   *      <text key=\"world\">World</text>\n   *    </block>\n   *    <block type=\"container\">\n   *      <block type=\"paragraph\">\n   *        <text key=\"cangjie\">Cangjie</text>\n   *      </block>\n   *    </block>\n   *    <block type=\"paragraph\">\n   *      <text key=\"footer\">Footer</text>\n   *    </block>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getTexts(),\n   *   [\n   *     <text key=\"hello\">Hello</text>,\n   *     <text key=\"world\">World</text>,\n   *     <text key=\"cangjie\">Cangjie</text>,\n   *     <text key=\"footer\">Footer</text>\n   *   ]\n   * );\n   * ```\n   */\n  public getTexts(): Text[] {\n    const texts: Text[] = [];\n    this.forEachDescendant((node) => {\n      if (Text.isText(node)) {\n        texts.push(node);\n      }\n    });\n    return texts;\n  }\n\n  /**\n   * 获取节点树下所有 inline\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\" key=\"container\">\n   *    <inline type=\"link\">www.dingtalk.com</inline>\n   *    <block type=\"paragraph\">\n   *      <inline type=\"link\">www.dingding.com</inline>\n   *    </block>\n   *    <inline type=\"mention\" data={{name: 'john'}}/>\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getInlines(),\n   *   [\n   *     <inline type=\"link\">www.dingtalk.com</inline>,\n   *     <inline type=\"link\">www.dingding.com</type=\"link\">,\n   *     <inline type=\"mention\" data={{name: 'john'}}/>,\n   *   ]\n   * );\n   * ```\n   */\n  public getInlines() {\n    const inlines: Inline[] = [];\n    this.forEachDescendant((node) => {\n      if (Inline.isLeafInline(node)) {\n        inlines.push(node);\n      }\n    });\n    return inlines;\n  }\n\n  /**\n   * 获得节点树下所有类型为 `type` 的 inline\n   * @param type\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\" key=\"container\">\n   *    <inline type=\"link\">www.dingtalk.com</inline>\n   *    <block type=\"paragraph\">\n   *      <inline type=\"link\">www.dingding.com</inline>\n   *    </block>\n   *    <inline type=\"mention\" data={{name: 'john'}} />\n   *   </block>\n   * );\n   *\n   * assertEqual(\n   *   element.getInlinesByType('link'),\n   *   [\n   *     <inline type=\"link\">www.dingtalk.com</inline>,\n   *     <inline type=\"link\">www.dingding.com</type=\"link\">,\n   *   ]\n   * );\n   * ```\n   */\n  public getInlinesByType(type: string) {\n    const inlines: Inline[] = [];\n    this.forEachDescendant((node) => {\n      if (Inline.isLeafInline(node) && node.type === type) {\n        inlines.push(node);\n      }\n    });\n    return inlines;\n  }\n\n  /**\n   * Map 节点树的所有子孙\n   * @param map 节点映射函数\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\">\n   *     <block type=\"paragraph\">Hello</block>\n   *     <block type=\"code\">const foo = 'bar';</block>\n   *     <block type=\"paragraph\">World</block>\n   *   </block>\n   * );\n   *\n   * const newElement = element.mapDescendants(node => {\n   *   if (node.isElement() && node.type === \"paragraph\") {\n   *     return node.set('data', { highlight: true });\n   *   }\n   *   return node;\n   * })\n   *\n   * assertEqual(\n   *   newElement,\n   *   <block type=\"container\">\n   *     <block type=\"paragraph\" data={{ highlight: true }}>Hello</block>\n   *     <block type=\"code\">const foo = 'bar';</block>\n   *     <block type=\"paragraph\" data={{ highlight: true }}>World</block>\n   *   </block>\n   * )\n   * ```\n   */\n  public mapDescendants(map: Iterator<Node, Node>) {\n    const newNodes = this.nodes.map((node) => {\n      let ret: Element | Node = node;\n      if (Element.isElement(ret)) {\n        ret = ret.mapDescendants(map);\n      }\n      return map(ret);\n    });\n\n    return this.set('nodes', newNodes);\n  }\n\n  /**\n   * 遍历自身树下所有子节点：遍历顺序为前序遍历\n   * @param iterator 遍历函数；如果返回 `false`，则停止遍历当前节点的子孙，防止冗余遍历引起的性能开销\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\">\n   *     <block type=\"paragraph\">Hello</block>\n   *     <block type=\"code\">const foo = 'bar';</block>\n   *     <block type=\"paragraph\">World</block>\n   *   </block>\n   * );\n   *\n   * const paragraphs: Block[] = [];\n   * element.forEachDescendant(node => {\n   *   if (node.isElement()) {\n   *     if (node.type === \"paragraph\") {\n   *       paragraphs.push(node);\n   *     } else if (node.type === \"code\"){\n   *       // code 下不再有 paragraph，可以提前终止对 code 的遍历\n   *       return false;\n   *     }\n   *   }\n   * });\n   *\n   * assertEqual(\n   *   paragraphs,\n   *   <block type=\"paragraph\">Hello</block>\n   *   <block type=\"paragraph\">World</block>\n   * )\n   * ```\n   */\n  public forEachDescendant(iterator: Iterator<Node | Element, boolean | void>) {\n    let ret: boolean | null = null;\n\n    this.nodes.forEach((child) => {\n      if (iterator(child) === false) {\n        ret = false;\n        return;\n      }\n      if (Element.isElement(child)) {\n        ret = child.forEachDescendant(iterator);\n      }\n    });\n    return ret;\n  }\n\n  /**\n   * 判断子孙节点中，是否有符合条件的节点\n   * @param predicate 遍历函数, 相比 forEachDescendant 会降低节点遍历开销\n   * @returns {boolean}\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\">\n   *     <block type=\"paragraph\">Hello</block>\n   *     <block type=\"code\">const foo = 'bar';</block>\n   *     <block type=\"paragraph\">World</block>\n   *   </block>\n   * );\n   *\n   * const hasCode = element.someDescendants(node => {\n   *   return node.isElement() && node.type === 'code';\n   * });\n   *\n   * const hasCard = element.someDescendants(node => {\n   *  return node.isElement() && node.type === 'card';\n   * })\n   *\n   * assertEqual(hasCode, true);\n   * assertEqual(hasCard, false);\n   * );\n   * ```\n   */\n  public someDescendant(predicate: Iterator<Node | Element, boolean | void>) {\n    return this.nodes.some((child) => {\n      if (predicate(child)) {\n        return true;\n      }\n      if (Element.isElement(child)) {\n        return child.someDescendant(predicate);\n      }\n      return false;\n    });\n  }\n  /**\n   * 过滤子孙，仅保留符合 `predicate` 断言的节点\n   * @param predicate\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\">\n   *     <block type=\"paragraph\">Hello</block>\n   *     <block type=\"code\">const foo = 'bar';</block>\n   *     <block type=\"paragraph\">World</block>\n   *   </block>\n   * );\n   *\n   * const filtered = element.filterDescendants(node => {\n   *   return node.isElement() && node.type !== 'code';\n   * });\n   *\n   * assertEqual(\n   *   filtered,\n   *   [\n   *     <block type=\"paragraph\">Hello</block>,\n   *     <block type=\"paragraph\">World</block>\n   *   ]\n   * );\n   * ```\n   */\n  public filterDescendants(\n    predicate: Iterator<Node | Element, boolean>,\n  ): Node[] {\n    const descendants: Node[] = [];\n    this.nodes.forEach((node) => {\n      if (predicate(node)) {\n        descendants.push(node);\n      }\n      if (node instanceof Element) {\n        descendants.push(...node.filterDescendants(predicate));\n      }\n    });\n    return descendants;\n  }\n\n  /**\n   * 查找节点树满足 `predicate` 断言的子孙\n   * @param predicate\n   * @returns\n\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\">\n   *     <block type=\"paragraph\">Hello</block>\n   *     <block type=\"code\">const foo = 'bar';</block>\n   *     <block type=\"paragraph\">World</block>\n   *   </block>\n   * );\n   *\n   * const code = element.findDescendant(node => {\n   *   return node.isElement() && node.type === 'code'\n   * });\n   *\n   * assertEqual(\n   *   code,\n   *   <block type=\"code\">const foo = 'bar';</block>\n   * );\n   * ```\n   */\n  public findDescendant(\n    predicate: Iterator<Node | Element, boolean>,\n  ): Node | null {\n    let found: Node | null = null;\n    this.forEachDescendant((node) => {\n      // if the node has been found, then don't assign value to it.\n      if (predicate(node) && !found) {\n        found = node;\n        return false;\n      }\n      return true;\n    });\n    return found;\n  }\n\n  /**\n   * 是否 `node` 位于节点子孙中\n   * @param node\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block type=\"container\">\n   *     <block type=\"paragraph\" key=\"hello\">Hello</block>\n   *   </block>\n   * );\n   *\n   * const hello = element.assertNode('hello');\n   * const root = element.assertNodeByPath([]);\n   * const cangjie = <block type=\"paragraph\">World</block>;\n   *\n   * assertTrue(element.contains(hello));\n   * assertFalse(element.contains(root));\n   * assertFlase(element.contains(cangjie));\n   * ```\n   */\n  public contains(node?: Node | null): boolean {\n    if (node) {\n      const found = this.findDescendant((child) => child === node);\n      if (found) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * 替换节点子树中 `path` 位置的节点为 `node`\n   * @param path\n   * @param node\n   * @param noSpacialEffect 是否操作将影响空间，若不影响空间，将不进行 Key-to-Path Table 的重构\n   * @throws NodeNotFoundError 如果节点路径错误，将抛错\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       <text key=\"hello\">Hello</text>\n   *     </block>\n   *     <block type=\"paragraph\" key=\"world-block\">\n   *       <text key=\"world\">World</text>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * const newElement = element.replaceNode(\n   *   [1],\n   *   <block type=\"paragraph\" key=\"cangjie-block\">Cangjie</block>\n   * );\n   *\n   * assertEqual(newElement, (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       <text key=\"hello\">Hello</text>\n   *     </block>\n   *     <block type=\"paragraph\" key=\"cangjie-block\">Cangjie</block>\n   *   </block>\n   * ));\n   * ```\n   */\n  public replaceNode(path: Path, node: Node, noSpacialEffect = false): this {\n    let p = path;\n    let n = node;\n\n    if (noSpacialEffect && Element.isElement(node)) {\n      linkKeysToEdgesTable(this.getNodeByPath(path)! as Element, node);\n    }\n    while (p.length) {\n      const index = p[p.length - 1];\n      p = p.slice(0, -1);\n      const maybeParent = this.getNodeByPath(p);\n      const parent = assertElement(maybeParent, 'Element.replaceNode', p);\n      const nodes = [...parent.nodes];\n      nodes[index] = n;\n      n = parent.set('nodes', nodes);\n      if (noSpacialEffect) {\n        linkKeysToEdgesTable(parent, n as Element);\n      }\n    }\n\n    return n as this;\n  }\n\n  /**\n   * 在对应 `path` 的 text 节点的 `offset` 位置，为长度为 `length` 的区间添加 `mark`\n   *\n   * @param path\n   * @param offset 偏移位置\n   * @param length 文本区间长度\n   * @param mark\n   * @throws NodeNotFoundError 如果节点路径错误，将抛错\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       <text key=\"hello\">HelloWorld</text>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * const newElement = element.addMark(\n   *   [0, 0],\n   *   5,\n   *   5,\n   *   Mark.craete('bold')\n   * );\n   *\n   * assertEqual(newElement, (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       <text key=\"hello\">Hello<m type=\"world\">World</m></text>\n   *     </block>\n   *   </block>\n   * ));\n   * ```\n   */\n  public addMark(path: Path, offset: number, length: number, mark: Mark) {\n    const maybeNode = this.getNodeByPath(path);\n    const node = assertText(maybeNode, 'Element.addMark', path);\n    return this.replaceNode(path, node.addMark(offset, length, mark), true);\n  }\n\n  /**\n   * 在对应 `path` 的 text 节点的 `offset` 位置，为长度为 `length` 的区间删除 `mark`\n   * @param path\n   * @param offset\n   * @param length\n   * @param mark\n   * @throws NodeNotFoundError 如果节点路径错误，将抛错\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *        <text key=\"hello\">Hello<m type=\"world\">World</m></text>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * const newElement = element.removeMark(\n   *   [0, 0],\n   *   5,\n   *   5,\n   *   Mark.craete('bold')\n   * );\n   *\n   * assertEqual(newElement, (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       <text key=\"hello\">HelloWorld</text>\n   *     </block>\n   *   </block>\n   * ));\n   * ```\n   */\n  public removeMark(path: Path, offset: number, length: number, mark: Mark) {\n    const maybeTextNode = this.getNodeByPath(path);\n    const textNode = assertText(maybeTextNode, 'Element.addMark', path);\n    return this.replaceNode(\n      path,\n      textNode.removeMark(offset, length, mark),\n      true,\n    );\n  }\n\n  /**\n   * 在对应 `path` 的 text 节点的 `offset` 位置，为长度为 `length` 的区间设置 mark data\n   * @param path\n   * @param offset\n   * @param length\n   * @param mark\n   * @param properties\n   * @throws NodeNotFoundError 如果节点路径错误，将抛错\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *        <text key=\"hello\">Hello\n   *          <m type=\"world\" data={{ weight: 500 }}>World</m>\n   *        </text>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * const newElement = element.setMark(\n   *   [0, 0],\n   *   5,\n   *   5,\n   *   Mark.craete('bold'),\n   *   { data: { weight: 700 } }\n   * );\n   *\n   * assertEqual(newElement, (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *        <text key=\"hello\">Hello\n   *          <m type=\"world\" data={{ weight: 700 }}>World</m>\n   *        </text>\n   *     </block>\n   *   </block>\n   * ));\n   * ```\n   */\n  public setMark(\n    path: Path,\n    offset: number,\n    length: number,\n    mark: Mark,\n    properties: Partial<MarkProperties>,\n  ) {\n    const maybeText = this.getNodeByPath(path);\n    const text = assertText(maybeText, 'Element.setMark', path);\n    return this.replaceNode(\n      path,\n      text.setMark(offset, length, mark, properties),\n      true,\n    );\n  }\n\n  /**\n   * 在对应 `path` 的 text 节点的 `offset` 位置，插入文本 `text`，并指定这段文本的 `marks`\n   * @param path\n   * @param offset\n   * @param text\n   * @param marks\n   * @throws NodeNotFoundError 如果节点路径错误，将抛错\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *   </block>\n   * );\n   *\n   * const newElement = element.insertText(\n   *   [0, 0],\n   *   5,\n   *   'World',\n   *   [Mark.craete('bold'), Mark.create('italic)],\n   * );\n   *\n   * assertEqual(newElement, (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       Hello\n   *       <m type=\"bold\"><m type=\"italic\">World</m></m>\n   *     </block>\n   *   </block>\n   * ));\n   * ```\n   */\n  public insertText(path: Path, offset: number, text: string, marks: Mark[]) {\n    const maybeNode = this.getNodeByPath(path);\n    const node = assertText(maybeNode, 'Element.insertText', path);\n    return this.replaceNode(path, node.insertText(offset, text, marks), true);\n  }\n\n  /**\n   * 在对应 `path` 的 text 节点的 `offset` 位置，删除指定的文本 `text`\n   * @param path\n   * @param offset\n   * @param text\n   * @throws NodeNotFoundError 如果节点路径错误，将抛错\n   * @returns\n   *\n   * @exmple\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">HelloWorld</block>\n   *   </block>\n   * );\n   *\n   * const newElement = element.removeText(\n   *   [0, 0],\n   *   5,\n   *   'World'\n   * );\n   *\n   * assertEqual(newElement, (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *   </block>\n   * ));\n   * ```\n   */\n  public removeText(path: Path, offset: number, text: string) {\n    const maybeTextNode = this.getNodeByPath(path);\n    const textNode = assertText(maybeTextNode, 'Element.removeText', path);\n    return this.replaceNode(path, textNode.removeText(offset, text), true);\n  }\n\n  /**\n   * 在 `path` 位置插入节点 `node`\n   * @param path\n   * @param node\n   * @throws NodeNotFoundError 如果节点路径错误，将抛错\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       <text key=\"hello\">Hello</text>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * const newElement = element.insertNode(\n   *   [1],\n   *   <block type=\"paragraph\" key=\"world\">World</block>\n   * );\n   *\n   * assertEqual(newElement, (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       <text key=\"hello\">Hello</text>\n   *     </block>\n   *     <block type=\"paragraph\" key=\"world\">World</block>\n   *   </block>\n   * ));\n   * ```\n   */\n  public insertNode(path: Path, node: Node) {\n    const index = path[path.length - 1];\n    const parentPath = path.slice(0, -1);\n    const maybeParent = this.getNodeByPath(parentPath);\n    const parent = assertElement(maybeParent, 'Element.insertNode', path);\n    const nodes = [...parent.nodes];\n    nodes.splice(index, 0, node);\n    return this.replaceNode(parentPath, parent.set('nodes', nodes));\n  }\n\n  /**\n   * 删除节点子树中 `path` 位置的节点\n   * @param path\n   * @throws NodeNotFoundError 如果节点路径错误，将抛错\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *     <block type=\"container\" key=\"container\">\n   *        <block type=\"paragraph\" key=\"world-block\">World</block>\n   *        <block type=\"paragraph\" key=\"cangjie-block\">Cangjie</block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * const newElement = element.removeNode([1,0]);\n   *\n   * assertEqual(newElement, (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *     <block type=\"container\" key=\"container\">\n   *       <block type=\"paragraph\" key=\"cangjie-block\">Cangjie</block>\n   *     </block>\n   *   </block>\n   * ));\n   * ```\n   */\n  public removeNode(path: Path) {\n    const node = this.getNodeByPath(path);\n    assertNode(node, 'Element.removeNode', path);\n\n    const index = path[path.length - 1];\n    const parentPath = path.slice(0, -1);\n    const maybeParent = this.getNodeByPath(parentPath);\n    const parent = assertElement(maybeParent, 'Element.insertNode', path);\n\n    const nodes = [...parent.nodes];\n    nodes.splice(index, 1);\n    return this.replaceNode(parentPath, parent.set('nodes', nodes));\n  }\n\n  /**\n   * 将 `path` 位置的节点，合并到其前一个兄弟节点\n   * @param path\n   * @throws NodeNotFoundError 如果节点路径错误，将抛错\n   * @throws Error 如果节点与兄弟节点类型不一致，将抛错\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *     <block type=\"paragraph\" key=\"world-block\">World</block>\n   *   </block>\n   * );\n   *\n   * const newElement = element.mergeNode([1]);\n   *\n   * assertEqual(newElement, (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">\n   *       HelloWorld\n   *     </block>\n   *   </block>\n   * ));\n   * ```\n   */\n  public mergeNode(path: Path) {\n    const maybeB = this.getNodeByPath(path);\n    const b = assertNode(maybeB, 'Element.mergeNode', path);\n\n    const lastIndex = path[path.length - 1];\n    if (lastIndex === 0) {\n      throw new Error(\n        `Unable to merge node because it has no previous sibling: ${b}`,\n      );\n    }\n\n    const withPath = Path.decrement(path);\n    const maybeA = this.getNodeByPath(withPath);\n    const aNode = assertNode(maybeA, 'Element.mergeNode', withPath);\n    const a = aNode.toSubType();\n\n    if (a.constructor !== b.constructor) {\n      throw new Error(\n        `Unable to merge two different kinds of nodes: ${a} and ${b}`,\n      );\n    }\n\n    const newNode = a.isText()\n      ? a.mergeText(b as Text)\n      : a.set('nodes', [...a.nodes, ...(b as Element).nodes]);\n\n    return this.removeNode(path).replaceNode(withPath, newNode);\n  }\n\n  /**\n   * 对指定 `path` 位置的节点在 `position` 处进行拆分\n   * @param path\n   * @param position 拆分位置。如果是 text 节点，代表文字的偏移量；如果是 element 节点，代表子节点 index\n   * @param properties 拆分 element 后，为拆分的节点设置 properties\n   * @throws NodeNotFoundError 如果节点路径错误，将抛错\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block>\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *       <block type=\"paragraph\" key=\"world-block\">World</block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * // Split Element\n   * const elementSplitted = element.splitNode([0], 1, { data: { highlight: true } });\n   *\n   * assertEqual(newElement, (\n   *   <block>\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *     </block>\n   *     <block type=\"container\" data={{ highlight: true }}>\n   *       <block type=\"paragraph\" key=\"world-block\">World</block>\n   *     </block>\n   *   </block>\n   * ));\n   *\n   * // Split Text\n   * const textSplitted = element.splitNode([0,0], 3);\n   *\n   * assertEqual(newElement, (\n   *   <block>\n   *     <block type=\"container\">\n   *       <block type=\"paragraph\" key=\"hello-block\">\n   *         <text>Hel</text><text>lo</text></block>\n   *       </block>\n   *     <block type=\"paragraph\" key=\"world-block\">World</block>\n   *   </block>\n   * ));\n   * ```\n   */\n  public splitNode(\n    path: Path,\n    position: number,\n    properties?: Partial<ElementProperties<D, N>>,\n  ) {\n    const maybeNode = this.getNodeByPath(path);\n    const n = assertNode(maybeNode, 'Element.splitNode', path);\n    const node = n.toSubType();\n\n    let a;\n    let b;\n    if (node.isText()) {\n      [a, b] = node.splitText(position);\n    } else {\n      const element = node;\n      const befores = element.nodes.slice(0, position);\n      const afters = element.nodes.slice(position);\n      a = element.set('nodes', befores);\n      b = element.set('nodes', afters).regenerateKey();\n    }\n\n    if (properties && !Text.isText(node)) {\n      b = b.merge(properties);\n    }\n    return this.removeNode(path).insertNode(path, b).insertNode(path, a);\n  }\n\n  /**\n   * 将 `path` 位置的节点移动到新的位置 `newPath`\n   * @param path\n   * @param newPath\n   * @throws NodeNotFoundError 如果节点路径错误，将抛错\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *     <block type=\"container\" key=\"container\">\n   *        <block type=\"paragraph\" key=\"world-block\">World</block>\n   *        <block type=\"paragraph\" key=\"cangjie-block\">Cangjie</block>\n   *     </block>\n   *   </block>\n   * );\n   *\n   * const newElement = element.moveNode([1,0], [1]);\n   *\n   * assertEqual(newElement, (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\">Hello</block>\n   *     <block type=\"paragraph\" key=\"world-block\">World</block>\n   *     <block type=\"container\" key=\"container\">\n   *       <block type=\"paragraph\" key=\"cangjie-block\">Cangjie</block>\n   *     </block>\n   *   </block>\n   * ));\n   * ```\n   */\n  public moveNode(path: Path, newPath: Path) {\n    const maybeNode = this.getNodeByPath(path);\n    const node = assertNode(maybeNode, 'Element.moveNode', path);\n\n    const newParentPath = newPath.slice(0, -1);\n    const newParent = this.getNodeByPath(newParentPath);\n    assertElement(newParent, 'Element.moveNode', path);\n\n    const isYounger = Path.isYounger(path, newPath);\n    const isSibling = Path.isSibling(path, newPath);\n\n    // If the old path ends above and before a node in the new path, then\n    // removing it will alter the target, so we need to adjust the new path.\n    if (isYounger && !isSibling) {\n      // eslint-disable-next-line no-param-reassign\n      newPath = Path.decrement(newPath, 1, path.length - 1);\n    }\n\n    return this.removeNode(path).insertNode(newPath, node);\n  }\n\n  /**\n   * 对指定 `path` 位置的节点设置属性\n   * @param path\n   * @param properties\n   * @throws NodeNotFoundError 如果节点路径错误，将抛错\n   * @returns\n   *\n   * @example\n   * ```tsx\n   * const element = (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\" data={{ highlight: true }}>Hello</block>\n   *     <block type=\"paragraph\" key=\"world-block\">World</block>\n   *   </block>\n   * );\n   *\n   * const newElement = element.setNode([0], { data: { highlight: false } });\n   *\n   * assertEqual(newElement, (\n   *   <block key=\"own\">\n   *     <block type=\"paragraph\" key=\"hello-block\" data={{ highlight: false }}>Hello</block>\n   *     <block type=\"paragraph\" key=\"world-block\">World</block>\n   *   </block>\n   * ));\n   * ```\n   */\n  public setNode(path: Path, properties: Partial<ElementProperties<D, N>>) {\n    const maybeElement = this.getNodeByPath(path);\n    let element = assertElement(maybeElement, 'Element.setNode', path);\n    element = element.merge(properties);\n    return this.replaceNode(path, element, true);\n  }\n}\n","/**\n * @packageDocumentation\n * @module Models\n */\nimport isPlainObject from 'is-plain-object';\nimport Element, { ElementProperties } from './element';\nimport Text, { TextJSON } from './text';\nimport { SerializeOptions } from '../interfaces/serializable';\nimport Data from '../interfaces/data';\nimport keyUtils from '../utils/keyUtils';\n\n/**\n * @ignore\n */\nexport type InlineChildren = (Inline | Text)[];\n\nexport interface InlineProperties extends ElementProperties {\n  type: string;\n  nodes?: InlineChildren;\n}\n\nexport interface InlineJSON {\n  klass: 'inline';\n  key?: string;\n  type: string;\n  data?: Data;\n  nodes?: (TextJSON | InlineJSON)[];\n}\n\nexport default class Inline extends Element {\n  static create(properties: Inline | InlineProperties | string): Inline {\n    if (Inline.isInline(properties)) {\n      return properties as Inline;\n    }\n\n    let props = properties;\n    if (typeof props === 'string') {\n      props = { type: props };\n    }\n\n    if (isPlainObject(props)) {\n      const {\n        type,\n        key = keyUtils.create(),\n        data = {},\n        nodes = [Text.create()],\n      } = props;\n\n      if (typeof type !== 'string') {\n        throw new Error('`Inline.create` requires a `type` string.');\n      }\n\n      return new Inline({\n        type,\n        key,\n        data,\n        nodes,\n      });\n    }\n\n    throw new Error(\n      `\\`Inline.create\\` only accepts objects, string or blocks, but you passed it: ${props}`,\n    );\n  }\n\n  static childFromJSON(node: InlineJSON | TextJSON) {\n    const { klass } = node;\n    if (klass === 'inline') {\n      return Inline.fromJSON(node as InlineJSON);\n    }\n    if (klass === 'text') {\n      return Text.fromJSON(node as TextJSON);\n    }\n\n    throw new Error(\n      '`Inline.childFromJSON` requires a valid `klass`(inline|text) string.',\n    );\n  }\n\n  static fromJSON(json: InlineJSON): Inline {\n    const { nodes } = json;\n    return Inline.create({\n      ...json,\n      nodes: nodes ? nodes.map(Inline.childFromJSON) : undefined,\n    });\n  }\n\n  static isInline(maybeInline: any): maybeInline is Inline {\n    return maybeInline instanceof Inline;\n  }\n\n  /**\n   * 是否是叶子inline\n   */\n  static isLeafInline(maybeLeafInline: any): maybeLeafInline is Inline {\n    if (!this.isInline(maybeLeafInline)) {\n      return false;\n    }\n    for (const child of maybeLeafInline.nodes) {\n      if (child.isElement()) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  protected constructor(props: Required<InlineProperties>) {\n    super(props);\n    const { type, nodes } = props;\n    this.type = type;\n    this.nodes = nodes;\n    this.freeze();\n  }\n\n  public readonly type: string;\n\n  public readonly nodes: InlineChildren;\n\n  public merge(props: Partial<InlineProperties>) {\n    return new Inline({\n      type: this.type,\n      key: this.key,\n      data: this.data,\n      nodes: this.nodes,\n      ...props,\n    });\n  }\n\n  public set<T extends keyof InlineProperties>(\n    key: T,\n    value: Required<InlineProperties>[T],\n  ) {\n    return this.merge({\n      [key]: value,\n    });\n  }\n\n  public toJSON(options?: SerializeOptions) {\n    const object: InlineJSON = {\n      klass: 'inline',\n      type: this.type,\n      data: { ...this.data },\n      nodes: this.nodes.map((node) => node.toJSON(options)),\n    };\n    if (options?.preserveKeys) {\n      object.key = this.key;\n    }\n    return object;\n  }\n}\n","/**\n * @packageDocumentation\n * @module Models\n */\n\n/**\n * Models中存在循环引用，需要保证子类import在前，父类import在后\n * 依赖：Block -> Inline -> Element -> Text -> Node\n * import顺序： Inline -> Element -> Text -> Node\n */\nimport isPlainObject from 'is-plain-object';\nimport Inline, { InlineJSON } from './inline';\nimport Element, { ElementProperties } from './element';\nimport Text, { TextJSON } from './text';\nimport Node from './node';\nimport { SerializeOptions } from '../interfaces/serializable';\nimport Data from '../interfaces/data';\nimport keyUtils from '../utils/keyUtils';\n\nexport type BlockChild = Block | Inline | Text;\n\nexport type BlockChildren = BlockChild[];\n\nexport type BlockChildrenJSON = BlockJSON[] | Array<InlineJSON | TextJSON>;\n\nexport interface BlockProperties<D = Data, N extends Node[] = BlockChildren> extends ElementProperties<D, N> {\n  type: string;\n  nodes?: N;\n}\n\nexport interface BlockJSON<T = Data, N = BlockChildrenJSON> {\n  klass: 'block';\n  key?: string;\n  type: string;\n  data?: T;\n  nodes?: N;\n}\n\nexport default class Block<D = Data, N extends Node[] = BlockChildren> extends Element<D, N> {\n  static readonly DEFAULT_TYPE = 'paragraph';\n\n  static create<SD = Data, SN extends BlockChildren = BlockChildren>(\n    properties: Block<SD, SN> | BlockProperties<SD, SN> | string,\n  ) {\n    if (Block.isBlock(properties)) {\n      return properties;\n    }\n\n    const props: BlockProperties<SD, SN> = typeof properties === 'string' ? { type: properties } : properties;\n\n    if (isPlainObject(props)) {\n      const {\n        type,\n        key = keyUtils.create(),\n        data,\n        nodes = [Text.create()] as SN,\n      } = props;\n\n      if (typeof type !== 'string') {\n        throw new Error('`Block.create` requires a `type` string.');\n      }\n\n      return new Block<SD, SN>({\n        type,\n        key,\n        data: data as SD,\n        nodes,\n      });\n    }\n\n    throw new Error(\n      `\\`Block.create\\` only accepts objects, string or blocks, but you passed it: ${props}`,\n    );\n  }\n\n  static childFromJSON(node: BlockJSON | InlineJSON | TextJSON) {\n    const { klass } = node;\n    if (klass === 'block') {\n      return Block.fromJSON(node as BlockJSON);\n    }\n    return Inline.childFromJSON(node as InlineJSON | TextJSON);\n  }\n\n  static fromJSON(json: BlockJSON) {\n    const { nodes } = json;\n    return Block.create({\n      ...json,\n      // @ts-ignore\n      nodes: nodes ? nodes.map(Block.childFromJSON) : nodes,\n    });\n  }\n\n  static isBlock(maybeBlock: any): maybeBlock is Block {\n    return maybeBlock instanceof Block;\n  }\n\n  static isBlocks(maybeBlocks: any[]): maybeBlocks is Block[] {\n    return maybeBlocks.every(Block.isBlock);\n  }\n\n  /**\n   * 是否是叶子 block\n   */\n  static isLeafBlock(maybeLeafBlock: any): boolean {\n    const { nodes } = maybeLeafBlock;\n\n    if (!this.isBlock(maybeLeafBlock)) {\n      return false;\n    }\n\n    if (!nodes.length) {\n      return true;\n    }\n\n    const first = nodes[0];\n    return !this.isBlock(first);\n  }\n\n  /**\n   * 循环获取所有的叶子 block 节点\n   */\n  public static getBlocks(nodes: Node[]): Block[] {\n    return nodes.reduce((array, child) => {\n      if (!Block.isBlock(child)) {\n        return array;\n      }\n      if (!Block.isLeafBlock(child)) {\n        return array.concat(child.getBlocks());\n      }\n      array.push(child);\n\n      return array;\n    }, [] as Block[]);\n  }\n\n  /**\n   * 循环获取所有的满足指定 type 的叶子 block 节点\n   */\n  public static getBlocksByType(nodes: Node[], type: string): Block[] {\n    return nodes.reduce((array: Block[], node: Node) => {\n      if (!Block.isBlock(node)) {\n        return array;\n      } else if (Block.isLeafBlock(node) && node.type === type) {\n        array.push(node as Block);\n        return array;\n      } else {\n        return array.concat(node.getBlocksByType(type));\n      }\n    }, []);\n  }\n\n  protected constructor(props: Required<BlockProperties<D, N>>) {\n    super(props);\n    const { type } = props;\n    this.type = type;\n    this.freeze();\n  }\n\n  public readonly type: string;\n\n  public merge(props: Partial<BlockProperties<D, N>>) {\n    return new Block<D, N>({\n      type: this.type,\n      key: this.key,\n      data: this.data,\n      nodes: this.nodes,\n      ...props,\n    });\n  }\n\n  public set<T extends keyof BlockProperties<D, N>>(\n    key: T,\n    value: Required<BlockProperties<D, N>>[T],\n  ) {\n    return this.merge({\n      [key]: value,\n    });\n  }\n\n  /**\n   * 自身的 nodes 中，是否有 block 类型的节点\n   */\n  public hasBlockChildren() {\n    return this.nodes.some((b) => Block.isBlock(b));\n  }\n\n  /**\n   * 获取自身树下所有的叶子 block 节点\n   */\n  public getBlocks(): Block[] {\n    return Block.getBlocks(this.nodes);\n  }\n\n  /**\n   * 循环获取所有的满足指定 type 的叶子 block 节点\n   */\n  public getBlocksByType(type: string): Block[] {\n    return Block.getBlocksByType(this.nodes, type);\n  }\n\n  public toJSON(options?: SerializeOptions) {\n    const object: BlockJSON = {\n      klass: 'block',\n      type: this.type,\n      data: { ...this.data },\n      nodes: this.nodes.map((node) => node.toJSON(options)),\n    };\n\n    if (options?.preserveKeys) {\n      object.key = this.key;\n    }\n    return object;\n  }\n}\n","/**\n * @packageDocumentation\n * @module Controller\n */\nimport Change from './change';\nimport Plugin from './plugin';\nimport { ContextMenuLocale } from '../locale/contextMenu';\nimport Value, { ValueProperties } from '../models/value';\nimport { FlushType } from '../utils/flushtask';\nimport Operation from '../models/operation';\nimport { PendingQueueProps } from '../controller/pendingQueue';\nimport Selection from '../models/selection';\nimport { VirtualizeOptions } from '../virtualize/interface';\nimport { UUIDConfig } from '../plugins/uuid/types';\n\n/**\n * @ignore\n */\nexport interface ControllerConfigs {\n  /**\n   * 编辑器内核的 plugins 选项\n   */\n  plugins?: {\n    /**\n     * 右键菜单的国际化文案。\n     */\n    contextMenu?: ContextMenuLocale;\n    /**\n     * 移动端插件配置（选择菜单、放大镜）\n     */\n    mobile?: {\n      enableZoomer: boolean;\n    };\n  };\n  history?: {\n    /**\n     * undo 队列最大长度\n     */\n    maxHistorySize?: number;\n  };\n}\n\n/**\n * @ignore\n */\nexport type ChangeEventHandler = (change: Change) => void;\n\nexport interface ControllerProperties {\n  /**\n   * 业务ID。业务方自行通过constructor设置、自行使用\n   */\n  biz?: string;\n  /**\n   * 展示相应 uid 下的用户数据\n   */\n  dataUid?: string | number | undefined;\n  /**\n   * 插件集合\n   */\n  plugins?: Plugin[];\n  /**\n   * 文档的数据[[Value]]对象\n   */\n  value: Value;\n  /**\n   * onChange回调。业务方需要手动设置新的value到Provider中，调用编辑器重新渲染，用户才可以看到UI改变。\n   */\n  onChange?: ChangeEventHandler;\n  /**\n   * 是否是只读模式\n   */\n  readOnly?: boolean;\n  /**\n   * 是否禁用拷贝（仅在只读模式生效）\n   */\n  canCopy?: boolean;\n  /**\n   * 是否自动获取焦点\n   */\n  autoFocus?: boolean;\n  /**\n   * Controller 调度 flush 的方法\n   * - microtask: 使用微任务（Promise.then）进行调度\n   * - frametask: 使用浏览器 animationFrame 进行调度\n   * - idletask: 使用浏览器 idleCallback 进行调度\n   *\n   * WARN: Sometimes request idle callback in Safari will never be called! Please use frametask instead of idletask.\n   * @description 使用不同的调度类型会产生不同的上屏效果，microtask 执行的速度最快，但是在连续输入场景可能会出现时间阻塞，使用 idletask 可以获得\n   * 最佳的输入上屏体验。根据浏览器的支持程度，会对 flushType 进行降级，默认使用 microtask。\n   * @default 'microtask'\n   */\n  flushType?: FlushType;\n  /**\n   * 编辑器配置\n   *\n   * 目前提供的配置：移动端「复制粘贴」气泡的国际化文案配置\n   */\n  configs?: ControllerConfigs;\n  /**\n   * 编辑器 busy 状态变化\n   */\n  onBusyStateChange?: (isBusy: boolean) => void;\n  /**\n   * 变更进入 Pending 之后\n   */\n  onPending?: (value: Value) => void;\n}\n\nexport interface ControllerOptions {\n  normalize?: boolean;\n  enablePending?: EnablePendingConfig;\n  /** WARN: Test only */\n  __pendingQueue__?: Partial<PendingQueueProps>;\n  /** blur 时不显示所有 selection, 优先级低于 showCaret */\n  hideSelectionOnBlur?: boolean;\n  showCaret?: ShowCaretConfig;\n  /** uuid 配置 */\n  uuid?: UUIDConfig,\n  /** 虚拟化配置 */\n  virtualize?: VirtualizeOptions;\n}\n\nexport interface ShowCaretConfig {\n  onBlur?: boolean;\n  onReadOnly?: boolean;\n}\n\nexport enum PendingType {\n  input = 'input',\n  selection = 'selection',\n}\n\nexport type EnablePending = Partial<Record<PendingType, boolean>>;\n\nexport enum PendingConfigType {\n  input = 'input',\n  selection = 'selection',\n}\nexport type EnablePendingConfig = Partial<Record<PendingConfigType, boolean>> | boolean;\n\nexport interface OperationWithValue<T extends keyof ValueProperties = keyof ValueProperties> {\n  /** 若为 null，则为 `setValue` 全量变更 */\n  operation: Operation | null;\n  /** 变更前的 value */\n  value: Value;\n  /** 变更后的 value */\n  newValue: Value;\n  /** 设置的 value 属性 key */\n  key?: T;\n}\n\nexport interface Terminal {\n  range: Selection;\n}\n","import React, { useEffect, useCallback } from 'react';\nimport { Hot } from '../interfaces/hot';\nimport { Controller } from '..';\nimport { PendingType } from '../interfaces/controller';\n\n/**\n * 消费变更产生的热区\n * @param controller\n * @param onHots\n * @param pendingType\n * @param disabled 是否禁用监听 \n */\nexport default function useHots(\n  controller: Controller,\n  onHots: (hots: Hot[]) => void,\n  pendingType?: PendingType,\n  disabled?: boolean\n) {\n  useEffect(() => {\n    if (!controller.enableHots || disabled) {\n      return () => {};\n    }\n\n    const handleOnHots = (hots) => {\n      if (pendingType && controller.pendingType !== pendingType) {\n        return;\n      }\n\n      onHots(hots);\n    };\n\n    const sub = controller.hots$.subscribe(handleOnHots);\n    return () => {\n      sub.unsubscribe();\n    };\n  }, [controller, onHots, pendingType, disabled]);\n}\n\n/**\n * 在下一帧时，消费变更产生的热区。当我们期望在热区重渲完成时，再消费热区信息时，可以使用这个 Hook.\n *\n * ## Example\n *\n * ```tsx\n * const Toolbar = props => {\n *   // 假设我们期望热区重渲完成后，获得热区对布局的影响\n *   const onHotsNextFrame = React.useCallback((hots) => {\n *     if (hots.find(hot => hot.node?.type === 'table-cell')) {\n *        const rects = getBoundingClientRect(domRef.current);\n *        // ...\n *     }\n *   }, []);\n *\n *   useHotsAtTheStartOfNextFrame(controller, onHotsNextFrame);\n * }\n * ```\n * @param controller\n * @param onHotsNextFrame\n * @param pendingType\n * @param disabled\n */\nexport function useHotsAtTheStartOfNextFrame(\n  controller: Controller,\n  onHotsNextFrame: (hots: Hot[]) => void,\n  pendingType?: PendingType,\n  disabled?: boolean,\n) {\n  const animId = React.useRef<number | null>(null);\n  const onHots = useCallback(\n    (hots: Hot[]) => {\n      animId.current = window.requestAnimationFrame(() => {\n        onHotsNextFrame(hots);\n      });\n    },\n    [onHotsNextFrame],\n  );\n\n  React.useEffect(() => {\n    return () => {\n      if (animId.current) {\n        window.cancelAnimationFrame(animId.current);\n      }\n    };\n  }, []);\n\n  useHots(controller, onHots, pendingType, disabled);\n}\n\n/**\n * 消费选区 Pending 的热区 \n * @param controller \n * @param onHots \n */\nexport function useSelectingHots(\n  controller: Controller,\n  onHots: (hots: Hot[]) => void,\n) {\n  useHots(controller, onHots, PendingType.selection);\n}\n\n/**\n * 在下一帧消费选区 Pending 的热区  \n * @param controller \n * @param onHotsNextFrame \n */\nexport function useSelectingHotsAtTheStartOfNextFrame(\n  controller: Controller,\n  onHotsNextFrame: (hots: Hot[]) => void,\n) {\n  useHotsAtTheStartOfNextFrame(controller, onHotsNextFrame, PendingType.selection);\n}\n\n/**\n * 消费输入 Pending 的热区 \n * @param controller \n * @param onHots \n */\nexport function useInputingHots(\n  controller: Controller,\n  onHots: (hots: Hot[]) => void,\n) {\n  useHots(controller, onHots, PendingType.input);\n}\n\n/**\n * 在下一帧消费输入 Pending 的热区 \n * @param controller \n * @param onHotsNextFrame \n */\nexport function useInputingHotsAtTheStartOfNextFrame(\n  controller: Controller,\n  onHotsNextFrame: (hots: Hot[]) => void,\n) {\n  useHotsAtTheStartOfNextFrame(controller, onHotsNextFrame, PendingType.input);\n}\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport * as React from 'react';\nimport { debounce, noop } from 'lodash-es';\nimport { ControllerContext } from './index';\nimport Value from '../models/value';\nimport useHots from '../hooks/useHots';\n\nconst isSupportProxy = typeof Proxy !== 'undefined';\n\ninterface UseControllerOptions {\n  /** 最大延迟渲染周期，指定这个参数用来控制消费了 `useController` hook 的组件，跟随编辑器内容渲染的频度 */\n  maxPending?: number;\n}\n\n/**\n * 获得 Controller 实例，如果组件严格期望在编辑器内容变更后，不进行重渲，仅消费 Controller 实例，请使用 `useControllerStatic`\n * @param options \n * @returns \n */\nexport default function useController(options?: UseControllerOptions) {\n  const { maxPending = 0 } = options || {};\n  const context = React.useContext(ControllerContext);\n  if (!context) {\n    throw new Error(\n      \"The `useController` hook must be used inside the <Cangjie.Provider> component's context.\",\n    );\n  }\n\n  const isRendering = React.useRef(true);\n  isRendering.current = true;\n  React.useLayoutEffect(() => {\n    isRendering.current = false;\n  });\n\n  const [, forceRender] = React.useReducer((s) => s + 1, 0);\n  const hasConsumedValue = React.useRef(false);\n  const lastConsumedValue = React.useRef<Value | null>(null);\n  const controller = React.useMemo(() =>\n    !isSupportProxy\n      ? context.controller\n      : new Proxy(context.controller, {\n          get(ctrl, prop) {\n            if (prop === 'value' && isRendering.current) {\n              hasConsumedValue.current = true;\n              lastConsumedValue.current = ctrl[prop];\n            }\n            return ctrl[prop];\n          },\n        }),\n    [context.controller],\n  );\n\n  const debouncedRerender = React.useMemo(() => {\n    if (Number.isFinite(maxPending)) {\n       return debounce(forceRender, maxPending);\n    }\n    return noop;\n  }, [maxPending]);\n\n\n  React.useEffect(() => {\n    const sub = context.subject.subscribe(() => {\n      if (\n        (!isSupportProxy || hasConsumedValue.current)\n          && context.controller.value !== lastConsumedValue.current\n      ) {\n        forceRender();\n      }\n    });\n    return sub.unsubscribe;\n  }, [context]);\n\n  useHots(controller, debouncedRerender);\n\n  return controller;\n}\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport * as React from 'react';\nimport Controller from '.';\nimport useController from './useController';\n\ninterface InjectedProps {\n  controller: Controller;\n}\n\nexport default function connectController<P extends InjectedProps>(\n  Component: React.ComponentType<P>,\n) {\n  return (props: Omit<P, 'controller'>) => {\n    const controller = useController();\n    // @ts-ignore\n    return <Component {...props} controller={controller} />;\n  };\n}\n","/**\n * @packageDocumentation\n * @module Models\n */\nimport Selection from '../models/selection';\nimport Data from '../interfaces/data';\nimport Path from './path';\nimport Node from './node';\nimport Mark from './mark';\n\nexport interface Properties {\n  type?: string;\n  data?: Data;\n}\n\nexport enum OperationType {\n  AddMark = 'add_mark',\n  InsertNode = 'insert_node',\n  InsertText = 'insert_text',\n  MergeNode = 'merge_node',\n  MoveNode = 'move_node',\n  RemoveMark = 'remove_mark',\n  RemoveNode = 'remove_node',\n  RemoveText = 'remove_text',\n  SetMark = 'set_mark',\n  SetNode = 'set_node',\n  SetSelection = 'set_selection',\n  SplitNode = 'split_node',\n}\n\ninterface OperationWithContext {\n  context?: string;\n}\n\nexport interface AddMarkOperation extends OperationWithContext {\n  type: OperationType.AddMark;\n  path: Path;\n  offset: number;\n  length: number;\n  mark: Mark;\n}\n\nexport interface InsertNodeOperation extends OperationWithContext {\n  type: OperationType.InsertNode;\n  path: Path;\n  node: Node;\n}\n\nexport interface InsertTextOperation extends OperationWithContext {\n  type: OperationType.InsertText;\n  path: Path;\n  offset: number;\n  text: string;\n  marks?: Mark[];\n}\n\nexport interface MergeNodeOperation extends OperationWithContext {\n  type: OperationType.MergeNode;\n  path: Path;\n  position: number;\n  properties: Properties;\n}\n\nexport interface MoveNodeOperation extends OperationWithContext {\n  type: OperationType.MoveNode;\n  path: Path;\n  newPath: Path;\n}\n\nexport interface RemoveMarkOperation extends Omit<AddMarkOperation, 'type'> {\n  type: OperationType.RemoveMark;\n}\n\nexport interface RemoveNodeOperation extends Omit<InsertNodeOperation, 'type'> {\n  type: OperationType.RemoveNode;\n}\n\nexport interface RemoveTextOperation extends Omit<InsertTextOperation, 'type'> {\n  type: OperationType.RemoveText;\n}\n\nexport interface SetMarkOperation extends OperationWithContext {\n  type: OperationType.SetMark;\n  path: Path;\n  offset: number;\n  length: number;\n  mark: Mark;\n  properties: Properties;\n}\n\nexport interface SetNodeOperation extends OperationWithContext {\n  type: OperationType.SetNode;\n  path: Path;\n  properties: Properties;\n  prevProperties: Properties;\n}\n\nexport interface SetSelectionOperation extends OperationWithContext {\n  type: OperationType.SetSelection;\n  selection: Selection;\n  prevSelection: Selection;\n}\n\nexport interface SplitNodeOperation extends Omit<MergeNodeOperation, 'type'> {\n  type: OperationType.SplitNode;\n}\n\ntype Operation =\n  | AddMarkOperation\n  | InsertNodeOperation\n  | InsertTextOperation\n  | MergeNodeOperation\n  | MoveNodeOperation\n  | RemoveMarkOperation\n  | RemoveNodeOperation\n  | RemoveTextOperation\n  | SetMarkOperation\n  | SetNodeOperation\n  | SetSelectionOperation\n  | SplitNodeOperation;\n\nexport type NonSetSelectionOperation = Exclude<\n  Operation,\n  SetSelectionOperation\n>;\n\n/**\n * op取反\n *\n * move_node 路径矫正说明：\n *\n * Given the document tree:\n * ```txt\n *         []\n *        / \\\n *     [0]   [1]\n *            |\n *          [1,0]\n *            |\n *         [1,0,0]\n *         __/ \\__\n * [1,0,0,0]      [1,0,0,1]\n * ```\n * case one:\n * ```ts\n * op.path = [0]\n * op.newPath = [1,0,0,1]\n * Path.isYounger([0], [1,0,0,1])   // true\n * // when path is been moved, the new path should decrement\n * Path.decrement([1,0,0,1], 1, 0) // [0,0,0,1]\n * // final inverted op: [0,0,0,1] -> [0]\n * ```\n * case two:\n * ```ts\n * op.path = [1,0,0,1]\n * op.newPath = [1]\n * Path.isAncestor([1], [1,0,0,1])   // true\n * // when move node to it's ancestor, the new path should increment\n * Path.increment([1,0,0,1], 1, 0) // [2,0,0,1]\n * // final inverted op: [2,0,0,1] -> [1]\n * ```\n */\nfunction invert(operation: Operation): Operation {\n  const { type } = operation;\n  if (type === 'add_mark') {\n    return {\n      ...operation,\n      type: 'remove_mark',\n    } as RemoveMarkOperation;\n  }\n  if (type === 'insert_node') {\n    return {\n      ...operation,\n      type: 'remove_node',\n    } as RemoveNodeOperation;\n  }\n  if (type === 'insert_text') {\n    return {\n      ...operation,\n      type: 'remove_text',\n    } as RemoveTextOperation;\n  }\n  if (type === 'merge_node') {\n    const { path } = operation as MergeNodeOperation;\n    const invertedPath = Path.decrement(path);\n    return {\n      ...operation,\n      type: 'split_node',\n      path: invertedPath,\n    } as SplitNodeOperation;\n  }\n  if (type === 'move_node') {\n    const { path, newPath } = operation as MoveNodeOperation;\n    if (Path.isEqual(path, newPath)) {\n      return operation;\n    }\n\n    let invertedPath = newPath;\n    let invertedNewPath = path;\n\n    const isSibling = Path.isSibling(path, newPath);\n    // If the node's old position was a left sibling of an ancestor of\n    // its new position, we need to adjust part of the path by -1.\n    // If the node's new position is an ancestor of the old position,\n    // or a left sibling of an ancestor of its old position, we need\n    // to adjust part of the path by 1.\n    if (!isSibling) {\n      const isYounger = Path.isYounger(path, newPath);\n      const isInvertedYounger = Path.isYounger(invertedPath, invertedNewPath);\n      const isInvertedAncestor = Path.isAncestor(invertedPath, invertedNewPath);\n\n      if (isYounger) {\n        invertedPath = Path.decrement(newPath, 1, path.length - 1);\n      } else if (isInvertedYounger || isInvertedAncestor) {\n        invertedNewPath = Path.increment(path, 1, newPath.length - 1);\n      }\n    }\n\n    return {\n      ...operation,\n      path: invertedPath,\n      newPath: invertedNewPath,\n    } as MoveNodeOperation;\n  }\n  if (type === 'remove_mark') {\n    return {\n      ...operation,\n      type: 'add_mark',\n    } as AddMarkOperation;\n  }\n  if (type === 'remove_node') {\n    return {\n      ...operation,\n      type: 'insert_node',\n    } as InsertNodeOperation;\n  }\n  if (type === 'remove_text') {\n    return {\n      ...operation,\n      type: 'insert_text',\n    } as InsertTextOperation;\n  }\n  if (type === 'set_mark') {\n    const { mark, properties } = operation as SetMarkOperation;\n    const invertedMark = mark.merge(properties);\n    const invertedProperties = Object.keys(properties).reduce(\n      (p, key) => ({ ...p, [key]: mark[key] }),\n      {},\n    );\n    return {\n      ...operation,\n      mark: invertedMark,\n      properties: invertedProperties,\n    } as SetMarkOperation;\n  }\n  if (type === 'set_node') {\n    const { properties, prevProperties } = operation as SetNodeOperation;\n    return {\n      ...operation,\n      properties: prevProperties || {},\n      prevProperties: properties,\n    } as SetNodeOperation;\n  }\n  if (type === 'set_selection') {\n    const { selection, prevSelection } = operation as SetSelectionOperation;\n    return {\n      ...operation,\n      selection: prevSelection,\n      prevSelection: selection,\n    } as SetSelectionOperation;\n  }\n  if (type === 'split_node') {\n    const { path } = operation as SplitNodeOperation;\n    const invertedPath = Path.increment(path);\n    return {\n      ...operation,\n      type: 'merge_node',\n      path: invertedPath,\n    } as MergeNodeOperation;\n  }\n  throw new Error(`Unknown operation type: \"${type}\".`);\n}\n\nconst Operation = {\n  invert,\n};\n\n// eslint-disable-next-line no-undef\nexport default Operation;\n","/**\n * @packageDocumentation\n * @module Models\n */\nimport isPlainObject from 'is-plain-object';\nimport ImmutableRecord from './immutableRecord';\nimport Node from './node';\nimport Document from './document';\nimport Path from './path';\nimport { Serializable, SerializeOptions } from '../interfaces/serializable';\n\nexport interface PointProperties {\n  key: string;\n}\n\nexport interface PointJSON {\n  klass?: 'point';\n  key?: string;\n}\n\nexport interface TextPointProperties extends PointProperties {\n  offset: number;\n}\n\nexport interface TextPointJSON extends PointJSON {\n  offset: number;\n}\n\nexport interface EdgePointProperties extends PointProperties {\n  edge: PointEdge;\n}\n\nexport interface EdgePointJSON extends PointJSON {\n  edge: PointEdge;\n}\n\nexport type PointEdge = 'before' | 'after';\n\nconst PATH_CACHE = new WeakMap<Point, WeakMap<Document, Path | null>>();\n\nexport default abstract class Point extends ImmutableRecord\n  implements Serializable<PointJSON> {\n  static createFromParams(key: string, where: number | PointEdge) {\n    if (typeof where === 'number') {\n      return TextPoint.create({\n        key,\n        offset: where,\n      });\n    } else {\n      return EdgePoint.create({\n        key,\n        edge: where,\n      });\n    }\n  }\n\n  static create(props: PointProperties | Point) {\n    if (props instanceof Point) {\n      return props.toSubType();\n    }\n    if ('edge' in props) {\n      return EdgePoint.create(props as EdgePointProperties);\n    } else {\n      return TextPoint.create(props as TextPointProperties);\n    }\n  }\n\n  static fromJSON(json: TextPointJSON | EdgePointJSON) {\n    if ('offset' in json) {\n      return TextPoint.fromJSON(json as TextPointJSON);\n    }\n    return EdgePoint.fromJSON(json as EdgePointJSON);\n  }\n\n  public readonly key: string;\n\n  public abstract get viewKey(): string;\n\n  constructor(props: PointProperties) {\n    super();\n    const { key } = props;\n    this.key = key;\n  }\n\n  /**\n   * 创建一个新的 Point，并移到 node 的第一个子节点的起始位置\n   */\n  public moveToStartOfNode(node: Node) {\n    const firstNode = node.getFirstNode();\n    return TextPoint.create({\n      key: firstNode.key,\n      offset: 0,\n    });\n  }\n\n  /**\n   * 创建一个新的 Point，并移到 node 的最后一个子节点的终点位置\n   */\n  public moveToEndOfNode(node: Node) {\n    const lastNode = node.getLastNode();\n    return TextPoint.create({\n      key: lastNode.key,\n      offset: lastNode.text.length,\n    });\n  }\n\n  /**\n   * 是否在 node 的第一个节点的起始位置\n   */\n  public abstract isAtStartOfNode(node: Node): boolean;\n\n  /**\n   * 是否在 node 的最后一个节点的终点位置\n   */\n  public abstract isAtEndOfNode(node: Node): boolean;\n\n  public isTextPoint(): this is TextPoint {\n    return this instanceof TextPoint;\n  }\n\n  public isEdgePoint(): this is EdgePoint {\n    return this instanceof EdgePoint;\n  }\n\n  public moveBackward(): TextPoint | EdgePoint {\n    return this.toSubType();\n  }\n\n  public moveForward(): TextPoint | EdgePoint {\n    return this.toSubType();\n  }\n\n  private toSubType(): TextPoint | EdgePoint {\n    if (this.isTextPoint()) {\n      return this;\n    } else if (this.isEdgePoint()) {\n      return this;\n    }\n    throw new Error(`Target is not a valid point: ${this}`);\n  }\n\n  public convertToTextPoint(document: Document) {\n    const point = this.toSubType();\n    if (point.isTextPoint()) {\n      return point;\n    }\n    const node = document.getNode(this.key);\n    let textNode: Node | null | undefined =\n      point.edge === EdgePoint.BEFORE\n        ? node?.getFirstText()\n        : node?.getLastText();\n    if (!textNode) {\n      textNode =\n        point.edge === EdgePoint.BEFORE\n          ? document.getFirstNode()\n          : document.getLastNode();\n    }\n    const { key } = textNode;\n    const offset = point.edge === EdgePoint.BEFORE ? 0 : textNode?.text.length;\n    return TextPoint.create({\n      key,\n      offset,\n    });\n  }\n\n  /**\n   * 是否在 node 内部\n   */\n  public isInNode(node: Node) {\n    if (node.isText() && node.key === this.key) return true;\n    if (node.isElement() && node.getNode(this.key)) return true;\n    return false;\n  }\n\n  // NOTE: point.getPathIn(document) === document.getPath(point.key)\n  // PERF: ~5ms in Huge Document story\n  //       Why do not memoize `document.getPath`? Node's path will not be re-get frequently, but Point's path does.\n  public getPathIn(document: Document) {\n    if (!PATH_CACHE.has(this)) {\n      PATH_CACHE.set(this, new WeakMap());\n    }\n    const DOCUMENT_TO_PATH_CACHE = PATH_CACHE.get(this)!;\n    if (!DOCUMENT_TO_PATH_CACHE.has(document)) {\n      DOCUMENT_TO_PATH_CACHE.set(document, document.getPath(this.key));\n    }\n    return DOCUMENT_TO_PATH_CACHE.get(document)!;\n  }\n\n  public abstract toJSON(options?: SerializeOptions): PointJSON;\n}\n\nexport class TextPoint extends Point {\n  static create(props: TextPoint | TextPointProperties): TextPoint {\n    if (props instanceof TextPoint) {\n      return props;\n    }\n\n    if (isPlainObject(props)) {\n      const { key, offset } = props;\n      return new TextPoint({\n        key,\n        offset,\n      });\n    }\n\n    throw new Error(\n      `\\`Point.create\\` only accepts objects or points, but you passed it: ${props}`,\n    );\n  }\n\n  static fromJSON(json: TextPointJSON) {\n    return TextPoint.create({\n      ...json,\n      key: json.key || 'NONE',\n    });\n  }\n\n  public readonly offset: number;\n\n  public get viewKey() {\n    return `${this.key}-${this.offset}`;\n  }\n\n  private constructor(props: TextPointProperties) {\n    super(props);\n    const { offset } = props;\n    this.offset = offset;\n    this.freeze();\n  }\n\n  /**\n   * 把 offset 加 n，并返回一个新的 Point。\n   * @n 移动的个数，可以为正/负值，默认为 1；如果 n=0，则返回自身。\n   */\n  public moveForward(n = 1): TextPoint {\n    if (n === 0) {\n      return this;\n    }\n    if (n < 0) {\n      return this.moveBackward(-n);\n    }\n    return this.set('offset', this.offset + n);\n  }\n\n  /**\n   * 把 offset 减 n，并返回一个新的 Point。\n   * @n 移动的个数，可以为正/负值，默认为 1；如果 n=0，则返回自身。\n   */\n  public moveBackward(n = 1): TextPoint {\n    if (n === 0) {\n      return this;\n    }\n    if (n < 0) {\n      return this.moveForward(-n);\n    }\n    return this.set('offset', this.offset - n);\n  }\n\n  /**\n   * 创建一个新的 Point\n   * @offset 默认是 0\n   */\n  public moveTo(key: string, offset = 0) {\n    return this.merge({\n      key,\n      offset,\n    });\n  }\n\n  /**\n   * 是否在 node 的第一个节点的起始位置\n   */\n  public isAtStartOfNode(node: Node) {\n    if (this.offset !== 0) return false;\n\n    const first = node.getFirstNode();\n    return this.key === first.key;\n  }\n\n  /**\n   * 是否在 node 的最后一个节点的终点位置\n   */\n  public isAtEndOfNode(node: Node) {\n    const last = node.getLastNode();\n    return this.key === last.key && this.offset === last.text.length;\n  }\n\n  public merge(props: Partial<TextPointProperties>) {\n    return new TextPoint({\n      key: this.key,\n      offset: this.offset,\n      ...props,\n    });\n  }\n\n  public set<T extends keyof TextPointProperties>(\n    key: T,\n    value: TextPointProperties[T],\n  ) {\n    return this.merge({\n      [key]: value,\n    });\n  }\n\n  public toJSON(options?: SerializeOptions) {\n    const object: TextPointJSON = {\n      klass: 'point',\n      offset: this.offset,\n    };\n\n    if (options?.preserveKeys) {\n      object.key = this.key;\n    }\n\n    return object;\n  }\n}\n\nexport class EdgePoint extends Point {\n  static readonly BEFORE = 'before';\n\n  static readonly AFTER = 'after';\n\n  static create(props: EdgePoint | EdgePointProperties): EdgePoint {\n    if (props instanceof EdgePoint) {\n      return props;\n    }\n\n    if (isPlainObject(props)) {\n      const { key, edge } = props;\n      return new EdgePoint({\n        key,\n        edge,\n      });\n    }\n\n    throw new Error(\n      `\\`Point.create\\` only accepts objects or points, but you passed it: ${props}`,\n    );\n  }\n\n  static fromJSON(json: EdgePointJSON) {\n    return EdgePoint.create({\n      ...json,\n      key: json.key || 'NONE',\n    });\n  }\n\n  public readonly edge: PointEdge;\n\n  public get viewKey() {\n    return `${this.key}-${this.edge}`;\n  }\n\n  private constructor(props: EdgePointProperties) {\n    super(props);\n    const { edge } = props;\n    this.edge = edge;\n    this.freeze();\n  }\n\n  /**\n   * 是否在 node 的第一个节点的起始位置\n   */\n  public isAtStartOfNode(node: Node) {\n    return this.key === node.key && this.edge === EdgePoint.BEFORE;\n  }\n\n  /**\n   * 是否在 node 的最后一个节点的终点位置\n   */\n  public isAtEndOfNode(node: Node) {\n    return this.key === node.key && this.edge === EdgePoint.AFTER;\n  }\n\n  public merge(props: Partial<EdgePointProperties>) {\n    return new EdgePoint({\n      key: this.key,\n      edge: this.edge,\n      ...props,\n    });\n  }\n\n  public set<T extends keyof EdgePointProperties>(\n    key: T,\n    value: EdgePointProperties[T],\n  ) {\n    return this.merge({\n      [key]: value,\n    });\n  }\n\n  public toJSON(options?: SerializeOptions) {\n    const object: EdgePointJSON = {\n      klass: 'point',\n      edge: this.edge,\n    };\n\n    if (options?.preserveKeys) {\n      object.key = this.key;\n    }\n\n    return object;\n  }\n}\n","/**\n * @packageDocumentation\n * @ignore\n */\nexport default {\"trie\":\"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\",\"classes\":{\"Other\":0,\"Prepend\":1,\"CR\":2,\"LF\":3,\"Control\":4,\"Extend\":5,\"Regional_Indicator\":6,\"SpacingMark\":7,\"L\":8,\"V\":9,\"T\":10,\"LV\":11,\"LVT\":12,\"ZWJ\":13,\"ExtPict\":14}}","/**\n * @packageDocumentation\n * @ignore\n */\nimport UnicodeTrie from 'unicode-trie';\nimport classesmjs from './classes-v13.0.0';\n\nconst {\n  trie,\n} = classesmjs;\nconst {\n  Other,\n  Prepend,\n  CR,\n  LF,\n  Control,\n  Extend,\n  Regional_Indicator,\n  SpacingMark,\n  L,\n  V,\n  T,\n  LV,\n  LVT,\n  ZWJ,\n  ExtPict,\n} = classesmjs.classes;\n\nlet data: ArrayBuffer | null = null;\nif (typeof window !== 'undefined') {\n  const bin = window.atob(trie);\n  data = new Uint8Array(bin.length);\n  for (let i = 0; i < bin.length; i++) data[i] = bin.charCodeAt(i);\n} else {\n  data = Buffer.from(trie, 'base64');\n}\n// console.log(data, data.length)\nconst classTrie = new UnicodeTrie(data);\n\nconst codePointAt = function (str, idx) { // different from String#codePointAt with low surrogate\n  const code = str.charCodeAt(idx);\n  // High surrogate\n  if (code >= 0xD800 && code <= 0xDBFF) {\n    const hi = code;\n    const low = str.charCodeAt(idx + 1);\n    if ((low >= 0xDC00 && low <= 0xDFFF)) {\n      return ((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000;\n    }\n    return hi;\n  }\n  // Low surrogate\n  if (code >= 0xDC00 && code <= 0xDFFF) {\n    const hi = str.charCodeAt(idx - 1);\n    const low = code;\n    if ((hi >= 0xD800 && hi <= 0xDBFF)) {\n      return ((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000;\n    }\n    return low;\n  }\n  return code;\n};\n\nconst isSurrogate = function (str, pos) {\n  let ref;\n  let ref1;\n  // eslint-disable-next-line no-return-assign\n  return ((ref = str.charCodeAt(pos)) >= 0xd800 && ref <= 0xdbff) && ((ref1 = str.charCodeAt(pos + 1)) >= 0xdc00 && ref1 <= 0xdfff);\n};\n\nconst BreakType = {\n  NotBreak: 0,\n  BreakStart: 1,\n  Break: 2,\n  BreakLastRegional: 3,\n  BreakPenultimateRegional: 4,\n};\n\n// Returns whether a break is allowed within a sequence of grapheme breaking classes\nconst shouldBreak = function (reverse, start, mid, end) {\n  const all = [start].concat(mid).concat([end]);\n  const previous = reverse ? start : all[all.length - 2];\n  const next = reverse ? all[1] : end;\n\n  // Lookahead terminator for:\n  // GB12. ^ (RI RI)* RI × RI\n  // GB13. [^RI] (RI RI)* RI × RI\n  const rIIndex = all.lastIndexOf(Regional_Indicator);\n  if (rIIndex > 0 && all.slice(1, rIIndex).every(c => c === Regional_Indicator) && (previous !== Prepend && previous !== Regional_Indicator)) {\n    if (all.filter(c => c === Regional_Indicator).length % 2 === 1) {\n      return BreakType.BreakLastRegional;\n    }\n    return BreakType.BreakPenultimateRegional;\n\n  }\n  // GB3. CR X LF\n  if (previous === CR && next === LF) {\n    return BreakType.NotBreak;\n  }\n  // GB4. (Control|CR|LF) ÷\n  if (previous === Control || previous === CR || previous === LF) {\n    // return BreakType.BreakStart\n    if (next !== Extend && mid.every(c => c === Extend)) {\n      return BreakType.Break;\n    }\n    return BreakType.BreakStart;\n\n  }\n  // GB5. ÷ (Control|CR|LF)\n  if (next === Control || next === CR || next === LF) {\n    return BreakType.BreakStart;\n  }\n  // GB6. L X (L|V|LV|LVT)\n  if (previous === L && (next === L || next === V || next === LV || next === LVT)) {\n    return BreakType.NotBreak;\n  }\n  // GB7. (LV|V) X (V|T)\n  if ((previous === LV || previous === V) && (next === V || next === T)) {\n    return BreakType.NotBreak;\n  }\n  // GB8. (LVT|T) X (T)\n  if ((previous === LVT || previous === T) && next === T) {\n    return BreakType.NotBreak;\n  }\n  // GB9.0 X (Extend|ZWJ)\n  if (reverse) {\n    if (next === Extend) {\n      return BreakType.NotBreak;\n    }\n    if (next === ZWJ) {\n      if (previous == Other && mid.length > 0 && mid[0] == ZWJ) {\n        return end != ExtPict ? BreakType.BreakStart : BreakType.Break;\n      }\n      return BreakType.NotBreak;\n    }\n  } else if (next === Extend || next === ZWJ) {\n    return BreakType.NotBreak;\n  }\n  // GB9.1 X SpacingMark\n  if (next === SpacingMark) {\n    return BreakType.NotBreak;\n  }\n  // GB9.2 Prepend X\n  if (previous === Prepend) {\n    return BreakType.NotBreak;\n  }\n  // GB11.0 ExtPict Extend * ZWJ × ExtPict\n  if (reverse) {\n    if (previous == ZWJ && next == ExtPict && (start == ZWJ || start == Other)) {\n      return BreakType.NotBreak;\n    }\n  } else if (start == ExtPict && previous == ZWJ && next == ExtPict) {\n    return BreakType.NotBreak;\n  }\n\n  // GB12. ^ (RI RI)* RI × RI\n  // GB13. [^RI] (RI RI)* RI × RI\n  if (!reverse && mid.indexOf(Regional_Indicator) >= 0) {\n    return BreakType.Break;\n  }\n  if (previous === Regional_Indicator && next === Regional_Indicator) {\n    return BreakType.NotBreak;\n  }\n  // GB999. Any ÷ Any\n  return BreakType.BreakStart;\n};\n\nconst getUnicodeByteOffset = function (str, start, unicodeOffset) {\n  while (unicodeOffset--) {\n    start += isSurrogate(str, start) ? 2 : 1;\n  }\n  return start;\n};\n\n// Returns the next grapheme break in the string after the given index\nfunction nextBreak(string, index = 0) {\n  if (index < 0) {\n    return 0;\n  }\n  if (index >= string.length - 1) {\n    return string.length;\n  }\n  const prev = classTrie.get(string.codePointAt(index));\n  const mid: any[] = [];\n  let i;\n  let j;\n  let ref;\n  // eslint-disable-next-line no-multi-assign\n  for (i = j = index + 1, ref = string.length; j < ref; i = j += 1) {\n    if (isSurrogate(string, i - 1)) {\n      // check for already processed low surrogates\n      continue;\n    }\n    const next = classTrie.get(string.codePointAt(i));\n    if (shouldBreak(false, prev, mid, next)) {\n      return i;\n    }\n    mid.push(next);\n  }\n  return string.length;\n}\n\n// Returns the next grapheme break in the string before the given index\nfunction previousBreak(string, index = string.length) {\n  if (index > string.length) {\n    return string.length;\n  }\n  if (index <= 1) {\n    return 0;\n  }\n  index--;\n  const mid: any[] = [];\n  const next = classTrie.get(codePointAt(string, index));\n  let i;\n  let j;\n  // eslint-disable-next-line no-multi-assign\n  for (i = j = index - 1; j >= -1; i = j += -1) {\n    if (isSurrogate(string, i)) {\n      // check for already processed high surrogates\n      continue;\n    }\n    const prev = classTrie.get(codePointAt(string, i));\n    switch (shouldBreak(true, prev, mid, next)) {\n      case BreakType.Break:\n        return i + mid.length + 1;\n      case BreakType.BreakStart:\n        return i + 1;\n      case BreakType.BreakLastRegional:\n        // eslint-disable-next-line no-case-declarations\n        const offset = getUnicodeByteOffset(string, i, mid.concat(next).lastIndexOf(Regional_Indicator) + 1);\n        return offset;\n      case BreakType.BreakPenultimateRegional:\n        return getUnicodeByteOffset(string, i, mid.concat(next).lastIndexOf(Regional_Indicator));\n    }\n    mid.unshift(prev);\n  }\n}\n\n// Breaks the given string into an array of grapheme cluster strings\nfunction breaks(str) {\n  const res: any[] = [];\n  let index = 0;\n  let brk;\n  // eslint-disable-next-line no-cond-assign\n  while ((brk = nextBreak(str, index)) < str.length) {\n    res.push(str.slice(index, brk));\n    index = brk;\n  }\n  if (index < str.length) {\n    res.push(str.slice(index));\n  }\n  return res;\n}\n\n// Returns the number of grapheme clusters there are in the given string\nfunction countBreaks(str) {\n  let count = 0;\n  let index = 0;\n  let brk;\n  // eslint-disable-next-line no-cond-assign\n  while ((brk = nextBreak(str, index)) < str.length) {\n    index = brk;\n    count++;\n  }\n  if (index < str.length) {\n    count++;\n  }\n  return count;\n}\n\nexport default {\n  nextBreak,\n  previousBreak,\n  break: breaks,\n  countBreaks,\n};","/**\n * @packageDocumentation\n * @ignore\n */\nimport GraphemeBreaker from './grapheme/GraphemeBreaker';\n\nconst SURROGATE_START = 0xd800;\nconst SURROGATE_END = 0xdfff;\nconst SPACE = /\\s/;\n/**\n * 标点的定义各家不统一\n * 部分常用标点可以在 https://www.ascii-code.com/ 上查看\n * 目前至少确保标准键盘能输入的标点\n */\nconst PUNCTUATION = /[\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E\\u00A1-\\u00A7\\u00AB\\u00B6\\u00B7\\u00BB\\u00BF\\u037E\\u0387\\u055A-\\u055F\\u0589\\u058A\\u05BE\\u05C0\\u05C3\\u05C6\\u05F3\\u05F4\\u0609\\u060A\\u060C\\u060D\\u061B\\u061E\\u061F\\u066A-\\u066D\\u06D4\\u0700-\\u070D\\u07F7-\\u07F9\\u0830-\\u083E\\u085E\\u0964\\u0965\\u0970\\u0AF0\\u0DF4\\u0E4F\\u0E5A\\u0E5B\\u0F04-\\u0F12\\u0F14\\u0F3A-\\u0F3D\\u0F85\\u0FD0-\\u0FD4\\u0FD9\\u0FDA\\u104A-\\u104F\\u10FB\\u1360-\\u1368\\u1400\\u166D\\u166E\\u169B\\u169C\\u16EB-\\u16ED\\u1735\\u1736\\u17D4-\\u17D6\\u17D8-\\u17DA\\u1800-\\u180A\\u1944\\u1945\\u1A1E\\u1A1F\\u1AA0-\\u1AA6\\u1AA8-\\u1AAD\\u1B5A-\\u1B60\\u1BFC-\\u1BFF\\u1C3B-\\u1C3F\\u1C7E\\u1C7F\\u1CC0-\\u1CC7\\u1CD3\\u2010-\\u2027\\u2030-\\u2043\\u2045-\\u2051\\u2053-\\u205E\\u207D\\u207E\\u208D\\u208E\\u2329\\u232A\\u2768-\\u2775\\u27C5\\u27C6\\u27E6-\\u27EF\\u2983-\\u2998\\u29D8-\\u29DB\\u29FC\\u29FD\\u2CF9-\\u2CFC\\u2CFE\\u2CFF\\u2D70\\u2E00-\\u2E2E\\u2E30-\\u2E3B\\u3001-\\u3003\\u3008-\\u3011\\u3014-\\u301F\\u3030\\u303D\\u30A0\\u30FB\\uA4FE\\uA4FF\\uA60D-\\uA60F\\uA673\\uA67E\\uA6F2-\\uA6F7\\uA874-\\uA877\\uA8CE\\uA8CF\\uA8F8-\\uA8FA\\uA92E\\uA92F\\uA95F\\uA9C1-\\uA9CD\\uA9DE\\uA9DF\\uAA5C-\\uAA5F\\uAADE\\uAADF\\uAAF0\\uAAF1\\uABEB\\uFD3E\\uFD3F\\uFE10-\\uFE19\\uFE30-\\uFE52\\uFE54-\\uFE61\\uFE63\\uFE68\\uFE6A\\uFE6B\\uFF01-\\uFF03\\uFF05-\\uFF0A\\uFF0C-\\uFF0F\\uFF1A\\uFF1B\\uFF1F\\uFF20\\uFF3B-\\uFF3D\\uFF3F\\uFF5B\\uFF5D\\uFF5F-\\uFF65\\uFFE5]/;\n\nfunction isChineseChar(char: string) {\n  return /[\\u3400-\\u9FBF]/.test(char);\n}\n\nfunction isValidString(str: string) {\n  return typeof str === 'string' && str !== '';\n}\n\nfunction isPunc(char: string) {\n  return PUNCTUATION.test(char);\n}\n\n// 当满足以下条件时，认为是同一类型：\n// 1. 都是「标点/SPACE」或都不是「标点/SPACE」\n// 2. 都是中文或都不是中文\nfunction isSameCharType(charA: string, charB: string) {\n  return isValidString(charA) &&\n    isValidString(charB) &&\n    isWord(charA) === isWord(charB) &&\n    isChineseChar(charA) === isChineseChar(charB);\n}\n\nfunction getNextLetter(str: string, i: number, reverse?: boolean): string {\n  let nextBreak: number;\n  if (!str || i < 0 || i > str.length) return '';\n\n  if (reverse) {\n    nextBreak = GraphemeBreaker.previousBreak(str, i);\n    return str.substring(nextBreak, i);\n  }\n\n  nextBreak = GraphemeBreaker.nextBreak(str, i);\n  return str.substring(i, nextBreak);\n}\n\nfunction countBreaks(str: string, i: number, reverse?: boolean): number {\n  if (!str || i < 0 || i > str.length) return 0;\n  const start = reverse ? i : 0;\n  const end = reverse ? str.length : i;\n  const text = str.substring(start, end);\n  return GraphemeBreaker.countBreaks(text);\n}\n\nfunction isSurrogate(code: number) {\n  return SURROGATE_START <= code && code <= SURROGATE_END;\n}\n\nfunction isWord(char: string) {\n  if (SPACE.test(char)) {\n    return false;\n  }\n\n  if (PUNCTUATION.test(char)) {\n    return false;\n  }\n\n  return true;\n}\n\nfunction getCharOffset(text: string, offset: number, reverse?: boolean) {\n  return getNextLetter(text, offset, reverse).length;\n}\n\nfunction getCharOffsetBackward(text: string, offset: number) {\n  return getNextLetter(text, offset, true).length || 1;\n}\n\nfunction getCharOffsetForward(text: string, offset: number) {\n  return getNextLetter(text, offset).length || 1;\n}\n\n// 在搜索结果处处理Unicode，避免光标focus到Unicode中间\nfunction getCharRange(text: string, offset: number): [number, number] {\n  let start = 0;\n  while (start <= offset) {\n    const end = start + getCharOffsetForward(text, start);\n    if (end > offset) {\n      return [start, end];\n    }\n    start = end;\n  }\n  return [start, start + Math.min(text.length, 1)];\n}\n\nfunction getWordRange(text: string, offset: number) {\n  if (!text) {\n    return [0, 0];\n  }\n\n  // eslint-disable-next-line no-param-reassign\n  offset = Math.min(offset, text.length);\n\n  const charAtOffset = text[offset];\n  const lastChar = text[offset - 1];\n  const nextChar = text[offset + 1];\n  let end = 0;\n  let start = 0;\n\n  // 当前字符不为空时，至少选中该字符\n  if (isValidString(charAtOffset)) {\n    end = 1;\n  }\n\n  // 当前字符为空时，说明在文本末尾需要 backward 遍历\n  // backward 遍历，找到词的后半部分的长度\n  if (\n    !isValidString(charAtOffset) ||\n    isSameCharType(lastChar, charAtOffset)\n  ) {\n    start = getWordOffsetBackward(text, offset);\n  }\n\n  // 当前字符为空或当前字符和前一字符同类型时\n  // forward 遍历，找到词的前半部分的长度\n  if (isSameCharType(nextChar, charAtOffset)) {\n    end = getWordOffsetForward(text, offset);\n  }\n\n  return [offset - start, offset + end];\n}\n\nfunction getWordOffset(text: string, offset: number, reverse?: boolean) {\n  let length = 0;\n  let i = offset;\n  let char = getNextLetter(text, i, reverse);\n  const curChar = char;\n\n  while (isSameCharType(char, curChar)) {\n    length += char.length;\n    if (reverse) {\n      i -= char.length;\n    } else {\n      i += char.length;\n    }\n    char = getNextLetter(text, i, reverse);\n  }\n\n  // 如果没有迭代到字符，至少保证选中前一个字符\n  return length || char.length;\n}\n\n// 计算光标以 word 为单位时移动的偏移量\nfunction getMoveWordOffset(text: string, offset: number, reverse?: boolean) {\n  let char = getNextLetter(text, offset, reverse);\n  if (!isValidString(char)) {\n    return 0;\n  }\n\n  let delta = 0;\n  let i = offset;\n\n  // 参考原生实现: 直接跳过光标附近的 SPACE\n  while (SPACE.test(char)) {\n    if (reverse) {\n      i -= char.length;\n      delta -= 1;\n    } else {\n      i += char.length;\n      delta += 1;\n    }\n    char = getNextLetter(text, i, reverse);\n  }\n\n  return Math.abs(delta) + getWordOffset(text, offset + delta, reverse);\n}\n\nfunction getWordOffsetBackward(text: string, offset: number) {\n  const o = getWordOffset(text, offset, true);\n  return o;\n}\n\nfunction getWordOffsetForward(text: string, offset: number) {\n  const o = getWordOffset(text, offset);\n  return o;\n}\n\nfunction graphemesBreak(text: string): string[] {\n  return GraphemeBreaker.break(text);\n}\n\n\nconst NEWLINE = '\\n';\nconst SECLINE = '\\r';\nconst SIMPLE_SPACE = String.fromCharCode(32);\nexport const spaceUniCode = {\n  nbsp: '\\u00a0',\n  zwnj: '\\u200c',\n  zwj: '\\u200d',\n}\n/**\n *  处理字符串中的特殊字符\n * \n *  1. 单独 \\r 或 \\r\\n 效果类似 \\n ，有折行效果\n *     \\r\\r 或 \\n\\n， 有隔行效果\n *  2. &nbsp; 替换成普通空格，移除 &zwnj;、&zwj 零宽字符\n * */\nexport function normalizeText(text: string): string {\n  let result = '';\n  for (let i = text.length - 1; i >= 0; i--) {\n    if (text[i] === NEWLINE) {\n      if (text[i - 1] === SECLINE) {\n        i--;\n      }\n      result = NEWLINE + result;\n      continue;\n    }\n    if (text[i] === SECLINE) {\n      result = NEWLINE + result;\n      continue;\n    }\n    if (text[i] === spaceUniCode.nbsp) {\n      result = SIMPLE_SPACE + result;\n      continue;\n    }\n    if (text[i] === spaceUniCode.zwnj || text[i] === spaceUniCode.zwj) {\n      continue;\n    }\n    result = text[i] + result;\n  }\n  return result;\n}\n\nexport default {\n  countBreaks,\n  getNextLetter,\n  getCharOffset,\n  getCharOffsetBackward,\n  getCharOffsetForward,\n  getCharRange,\n  getWordRange,\n  getWordOffset,\n  getMoveWordOffset,\n  getWordOffsetBackward,\n  getWordOffsetForward,\n  isSurrogate,\n  isWord,\n  isPunc,\n  isChineseChar,\n  graphemesBreak,\n  normalizeText,\n};\n","function isValidElement(el: Element | Node | null): el is Element {\n  return (el !== null &&\n  el.nodeType === Node.ELEMENT_NODE &&\n  !(el as Element).getAttribute('data-cangjie-content'));\n}\n\n/**\n * Find closest ancestor\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/closest\n * @returns\n */\nexport default function findClosestInContent(el: Element | Node | null, selector: string): Element | null {\n  do {\n    if (Element.prototype.matches.call(el, selector)) return el as Element;\n    el = el!.parentElement || el!.parentNode;\n  } while (\n   isValidElement(el)\n  );\n  return null;\n}\n","/**\n * @packageDocumentation\n * @module constants\n */\n\nexport const CUSTOM_MIME_TYPES = {\n  FRAGMENT: 'application/x-cangjie-fragment',\n  PACKAGE: 'application/x-cangjie-fragment-pack',\n  SYNC: 'application/x-hetu-sync',\n  DOCKEY: 'application/x-doc-key',\n  REFBLOCK: 'application/x-refblock',\n  ENCRYPTION: 'application/x-cangjie-encryption',\n  APPLICATION_VSCODE: 'vscode-editor-data',\n}\n\nexport const MIME_TYPES = {\n  HTML: 'text/html',\n  TEXT: 'text/plain',\n  ...CUSTOM_MIME_TYPES,\n};\n\nexport const EVENTS = [\n  'onAction',\n  'onChange',\n  'onCangjieFocus',\n  'onCangjieBlur',\n  'onCangjieInput',\n  'onCangjieSelect',\n  'onCangjieCopy',\n  'onCangjieCut',\n  'onCangjiePaste',\n  'onCangjieComposingChange',\n  'onClick',\n  'onCopy',\n  'onCut',\n  'onPaste',\n  'onKeyDown',\n  'onKeyUp',\n  'onMouseDown',\n  'onMouseMove',\n  'onMouseUp',\n  'onTouchStart',\n  'onTouchMove',\n  'onTouchEnd',\n  'onContextMenu',\n  'onDragStart',\n  'onDragOver',\n  'onDrop',\n  'onDragEnter',\n];\n\n/**\n * 光标宽度\n */\nexport const CURSOR_WIDTH = 2;\n\n/**\n * Edge 光标的最大高度\n */\nexport const CURSOR_EDGE_MAX_HEIGHT = 21;\n\n/**\n * Edge 光标和元素之间的偏移量\n */\nexport const CURSOR_EDGE_OFFSET = 1;\n\nexport const CANGJIE_EMPTY = '\\uFEFF';\n\n/**\n * 选区颜色\n */\nexport const CANGJIE_SELECTION_COLOR = 'rgba(1, 134, 251, 0.3)';\n\n/**\n * 空行时最小宽度\n */\nexport const CANGJIE_SELECTION_EMPTY_WIDTH = 4;\n\n/**\n * Blur的选区颜色\n */\nexport const CANGJIE_SELECTION_INACTIVE_COLOR = 'rgba(136, 136, 136, 0.3)';\n\nexport const Z_INDEX_CONTEXTMENU = 10000;\n\nexport const Selector = {\n  key: 'data-cangjie-key',\n  content: 'data-cangjie-content',\n  edgeSelectable: 'data-cangjie-edge-selectable',\n  editable: 'data-cangjie-editable',\n  void: 'data-cangjie-void',\n  leaf: 'data-cangjie-leaf',\n  leafBlock: 'data-cangjie-leaf-block',\n  nonSelect: 'data-cangjie-non-select',\n  notEditable: 'data-cangjie-not-editable',\n  dockey: 'data-cangjie-dockey',\n  selectionLayer: 'data-cangjie-selection-layer',\n  selectionWrapper: 'data-cangjie-selection-wrapper',\n  groupBlock: 'data-cangjie-group-block',\n  groupKey: 'data-cangjie-group-key',\n  hoverWrapper: 'data-hover-box',\n  uuid: 'data-block-uuid',\n};\n\n/**\n * 默认 undo 队列最大长度限制\n */\nexport const MAX_HISTORY_SIZE = 100;\n\n/** 仓颉 Group 折叠 key */\nexport const GROUP_COLLAPSED_KEY = 'cangjieGroupCollpased';\n","/**\n * @packageDocumentation\n * @module domUtils\n */\nimport Controller from '../../controller/index';\nimport { TextPoint } from '../../models/point';\nimport { CANGJIE_EMPTY, Selector } from '../../constants';\nimport keyUtils from '../keyUtils';\nimport findClosestInContent from './findClosestInContent';\n\n/**\n * 根据浏览器的节点和位置获取仓颉对应的 Point。\n */\nfunction findPoint(\n  nativeNode: Node | null,\n  nativeOffset: number,\n  controller: Controller,\n) {\n  if (!nativeNode) {\n    return null;\n  }\n\n  const node =\n    nativeNode instanceof Text\n      ? nativeNode.parentElement\n      : nativeNode;\n  if (!(node instanceof Element)) {\n    return null;\n  }\n\n  const { document } = controller.value;\n\n  let leaf: Element | null;\n  if (node.getAttribute(Selector.void)) {\n    // 原本这里有一层「判断 node 内部是否存在 leaf 节点，不存在才继续」的逻辑\n    // 由于 hetu 等插件内部可能嵌套了编辑器，且 key 不可控，可能与宿主重复，造成问题（选区异常 or 页面奔溃）\n    // 因此这里去掉 `!isLeaf` 判断\n    const key = node.getAttribute(Selector.key);\n    if (!key) {\n      return null;\n    }\n    const voidNode = document.getNode(key);\n    if (!voidNode) {\n      return null;\n    }\n    const text = voidNode.getFirstText();\n    if (!text) {\n      return null;\n    }\n    return TextPoint.create({\n      key: text.key,\n      offset: 0,\n    });\n  } else {\n    leaf = node.getAttribute(`[${Selector.leaf}]`)\n      ? node\n      : findClosestInContent(node, `[${Selector.leaf}]`);\n  }\n\n  if (!leaf) {\n    return null;\n  }\n\n  const [key, offset] = keyUtils.parse(\n    leaf.getAttribute(Selector.key) || '',\n  );\n\n  const text = document.getNode(key);\n  if (!text) {\n    return null;\n  }\n  // NOTE: what if user data has just one `CANGJIE_EMPTY` character?\n  const nativeText = leaf.textContent && leaf.textContent !== CANGJIE_EMPTY\n    ? leaf.textContent.slice(0, nativeOffset)\n    : '';\n  return TextPoint.create({\n    key,\n    offset: offset + nativeText.length,\n  });\n}\n\nexport default findPoint;\n","/**\n * @packageDocumentation\n * @module domUtils\n */\nimport Controller from '../../controller/index';\nimport Selection from '../../models/selection';\nimport findPoint from './findPoint';\n\n/**\n * 根据浏览器的 Range 获取仓颉的 Selection\n */\nfunction findRange(native: Range, controller: Controller) {\n  const {\n    startContainer,\n    startOffset,\n    endContainer,\n    endOffset,\n    collapsed,\n  } = native;\n  const start = findPoint(startContainer, startOffset, controller);\n  const end = collapsed\n    ? start\n    : findPoint(endContainer, endOffset, controller);\n  if (!start || !end) {\n    return null;\n  }\n  return Selection.create({ anchor: start, focus: end });\n}\n\nexport default findRange;\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport findClosestInContent from './findClosestInContent';\nimport textUtils from '../textUtils';\nimport findRange from './findRange';\nimport Controller from '../../controller';\nimport Selection from '../../models/selection';\nimport Point, { EdgePoint } from '../../models/point';\nimport { CANGJIE_EMPTY, Selector } from '../../constants';\n\ninterface ClosestRect {\n  contentNode: Element;\n  contentRect: DOMRect;\n}\n\nconst isPointOnLeftOfRect = (x: number, _, rect: DOMRect) => x < rect.left;\nconst isPointOnRightOfRect = (x: number, _, rect: DOMRect) => x > rect.right;\nconst isPointOnTopOfRect = (_, y: number, rect: DOMRect) => y < rect.top;\nconst isPointOnBottomOfRect = (_, y: number, rect: DOMRect) => y > rect.bottom;\nconst isPointHorzInsideRect = (x: number, _, rect: DOMRect) =>\n  x >= rect.left && x <= rect.right;\nconst isPointVertInsideRect = (_, y: number, rect: DOMRect) =>\n  y >= rect.top && y <= rect.bottom;\nconst isPointInsideRect = (x: number, y: number, rect: DOMRect) => {\n  return isPointHorzInsideRect(x, y, rect) && isPointVertInsideRect(x, y, rect);\n};\n\nconst isPointOnRightOfRectNonStrict = (x, _, rect) => x > rect.left;\nconst isPointOnLeftOfRectNonStrict = (x, _, rect) => x < rect.right;\n\n// 认为是同一行的阈值：重叠部分占矮的高度的百分比（magic number: 上下标的重叠比例）\nconst SAME_LINE_THRESHOLD = 0.4;\nexport const isRectOnSameLineOfRect = (newRect: Pick<DOMRect, 'bottom' | 'top' | 'height'>, rect: Pick<DOMRect, 'bottom' | 'top' | 'height'>) => {\n  // 底边对齐\n  if (newRect.bottom === rect.bottom) {\n    return true;\n  }\n  // 无交集\n  if (newRect.top > rect.bottom || rect.top > newRect.bottom) {\n    return false;\n  }\n\n  // 重叠部分\n  // eg. 表情 + 文字：可能是包含 or 部分重叠关系\n  const smallerHeight = Math.min(rect.height, newRect.height);\n  const overlap = Math.min(newRect.bottom, rect.bottom) - Math.max(newRect.top, rect.top);\n  return smallerHeight === 0 || overlap / smallerHeight > SAME_LINE_THRESHOLD;\n};\n\nconst APPROXIMATE_THEREHOLD = 1e-5; // 近似相等的阈值，误差小于此则认为相等\nconst approximateEqual = (a: number, b: number) => Math.abs(a - b) < APPROXIMATE_THEREHOLD;\n\n// 此类都是非严格判断，只检测同一个方位的边界\nconst isRectOnLeftOfRect = (\n  newRect: DOMRect,\n  newContentNode: Element,\n  prevClosestRect: ClosestRect,\n) => {\n  return (\n    newRect.left < prevClosestRect.contentRect.left ||\n    (newRect.left === prevClosestRect.contentRect.left &&\n      newContentNode.compareDocumentPosition(prevClosestRect.contentNode) ===\n        Node.DOCUMENT_POSITION_FOLLOWING)\n  );\n};\nconst isRectOnRightOfRect = (\n  newRect: DOMRect,\n  newContentNode: Element,\n  prevClosestRect: ClosestRect,\n) => {\n  // 某些 win 触屏机下，inline 元素与右侧的空 Text 渲染的位置有重叠，存在细微的误差\n  // https://aone.alibaba-inc.com/v2/project/897543/bug/41731721#\n  return (\n    newRect.right > prevClosestRect.contentRect.right + APPROXIMATE_THEREHOLD ||\n    (approximateEqual(newRect.right, prevClosestRect.contentRect.right) &&\n      newContentNode.compareDocumentPosition(prevClosestRect.contentNode) ===\n        Node.DOCUMENT_POSITION_PRECEDING)\n  );\n};\n\nconst isRectOnTopOfRect = (\n  newRect: DOMRect,\n  newContentNode: Element,\n  prevClosestRect: ClosestRect,\n) => {\n  return (\n    newRect.top < prevClosestRect.contentRect.top ||\n    (newRect.top === prevClosestRect.contentRect.top &&\n      newContentNode.compareDocumentPosition(prevClosestRect.contentNode) ===\n        Node.DOCUMENT_POSITION_FOLLOWING)\n  );\n};\n\nconst isRectOnBottomOfRect = (\n  newRect: DOMRect,\n  newContentNode: Element,\n  prevClosestRect: ClosestRect,\n) => {\n  return (\n    newRect.bottom > prevClosestRect.contentRect.bottom ||\n    (newRect.top === prevClosestRect.contentRect.bottom &&\n      newContentNode.compareDocumentPosition(prevClosestRect.contentNode) ===\n        Node.DOCUMENT_POSITION_PRECEDING)\n  );\n};\n\nconst getHorzDistance = (x, _, rect) => {\n  return Math.min(Math.abs(x - rect.left), Math.abs(x - rect.right));\n};\n\nfunction getClosestAncestorWithBiggerHorizontalRect(element: Element) {\n  const rect = element.getBoundingClientRect();\n  let parent = element.parentElement;\n  while (parent) {\n    const parentRect = parent.getBoundingClientRect();\n    if (parentRect.left < rect.left && parentRect.right > rect.right) {\n      return parent;\n    }\n    parent = parent.getAttribute(Selector.content)\n      ? null\n      : parent.parentElement;\n  }\n  return null;\n}\n\nfunction* getSeletableBlocksFromElement(element: Element) {\n  const edgeSelectableAncestor = element.closest(`[${Selector.edgeSelectable}]`);\n  if (edgeSelectableAncestor) {\n    yield edgeSelectableAncestor;\n  }\n  const edgeSelectableDescendants = element.querySelectorAll(`[${Selector.edgeSelectable}]`);\n  if (!edgeSelectableDescendants) {\n    return;\n  }\n  for (const descendant of Array.from(edgeSelectableDescendants)) {\n    yield descendant;\n  }\n}\n\nfunction* getRectsFromElement(element: Element) {\n  // TODO: 处理点击 content 外元素时的定位逻辑，后续有更好的方案可移除\n  const isNonSelect = element.getAttribute(Selector.nonSelect);\n  const elementParent = findClosestInContent(element, `[${Selector.leafBlock}]`) || element.parentElement || element;\n  const targetElement = isNonSelect ? elementParent : element;\n  const cangjieLeafs = targetElement.querySelectorAll(`span[${Selector.leaf}]`);\n\n  for (let i = 0; i < cangjieLeafs.length; i += 1) {\n    const cangjieLeaf = cangjieLeafs[i];\n    yield {\n      contentNode: cangjieLeaf,\n      contentRects: Array.from(cangjieLeaf.getClientRects()),\n    };\n  }\n  const cangjieVoids = targetElement.querySelectorAll(`[${Selector.void}]`);\n  for (let i = 0; i < cangjieVoids.length; i += 1) {\n    const cangjieVoid = cangjieVoids[i];\n    yield {\n      contentNode: cangjieVoid,\n      contentRects: [cangjieVoid.getBoundingClientRect()],\n    };\n  }\n}\n\nfunction findClosestRectsInElement(element: Element, x: number, y: number) {\n  let closestBelow: ClosestRect | null = null;\n  let closestLeft: ClosestRect | null = null;\n  let closestRight: ClosestRect | null = null;\n  let closestTop: ClosestRect | null = null;\n\n  for (const rect of getRectsFromElement(element)) {\n    const { contentNode } = rect;\n    for (let index = 0; index < rect.contentRects.length; index++) {\n      const contentRect = rect.contentRects[index];\n      if (!contentRect) {\n        continue;\n      }\n      if (isPointInsideRect(x, y, contentRect)) {\n        return { exactTarget: contentNode };\n      }\n      if (isPointOnTopOfRect(x, y, contentRect)) {\n        let found = false;\n        // 现在左下、正下、右下都算 closestBelow\n        // 多个 rect 都符合 closestBelow 条件的时候，需要取我们最需要的那个\n        if (!closestBelow) {\n          // 之前没有 closestBelow 的时候，没有对比，设置它为 closestBelow\n          found = true;\n        } else if (isRectOnSameLineOfRect(contentRect, closestBelow.contentRect)) {\n          // 之前的 closestBelow 和现在的 rect 处于同一条直线上时\n          // 通过检查左右距离确定最终取哪个\n          const prevExactBelow = isPointHorzInsideRect(\n            x,\n            y,\n            closestBelow.contentRect,\n          );\n          const newExactBelow = isPointHorzInsideRect(x, y, contentRect);\n          const prevDistance = getHorzDistance(x, y, closestBelow.contentRect);\n          const newDistance = getHorzDistance(x, y, contentRect);\n\n          // 原先处于正下方，就是同行最优先的结果，不用再更新\n          // 原先不处于正下方，现在处于正下方，需要更新\n          // 两次都不处于正下方，使用距离更短的那个作为最终结果\n          if (\n            !prevExactBelow &&\n            (newExactBelow || newDistance < prevDistance)\n          ) {\n            found = true;\n          }\n        } else if (isRectOnTopOfRect(contentRect, contentNode, closestBelow)) {\n          // 之前的 closestBelow 和现在的 rect 不处于同一条直线上时\n          // 取位置更高的，即纵向上更靠近的作为 closestBelow\n          found = true;\n        }\n        if (found) {\n          closestBelow = {\n            contentRect,\n            contentNode,\n          };\n        }\n      } else if (isPointOnBottomOfRect(x, y, contentRect)) {\n        let found = false;\n        if (!closestTop) {\n          found = true;\n        } else if (isRectOnSameLineOfRect(contentRect, closestTop.contentRect)) {\n          const prevExactTop = isPointHorzInsideRect(\n            x,\n            y,\n            closestTop.contentRect,\n          );\n          const newExactTop = isPointHorzInsideRect(x, y, contentRect);\n          const prevDistance = getHorzDistance(x, y, closestTop.contentRect);\n          const newDistance = getHorzDistance(x, y, contentRect);\n\n          if (!prevExactTop && (newExactTop || newDistance < prevDistance)) {\n            found = true;\n          }\n        } else if (isRectOnBottomOfRect(contentRect, contentNode, closestTop)) {\n          found = true;\n        }\n        if (found) {\n          closestTop = {\n            contentRect,\n            contentNode,\n          };\n        }\n      } else if (\n        isPointVertInsideRect(x, y, contentRect) &&\n        isPointOnRightOfRectNonStrict(x, y, contentRect) &&\n        (!closestLeft ||\n          isRectOnRightOfRect(contentRect, contentNode, closestLeft))\n      ) {\n        closestLeft = {\n          contentRect,\n          contentNode,\n        };\n      } else if (\n        isPointVertInsideRect(x, y, contentRect) &&\n        isPointOnLeftOfRectNonStrict(x, y, contentRect) &&\n        (!closestRight ||\n          isRectOnLeftOfRect(contentRect, contentNode, closestRight))\n      ) {\n        closestRight = {\n          contentRect,\n          contentNode,\n        };\n      }\n    }\n  }\n\n  return {\n    closestBelow,\n    closestLeft,\n    closestRight,\n    closestTop,\n  };\n}\n\nfunction binarySearchOffset(\n  textNode: Text,\n  mouseX: number,\n  mouseY: number,\n  rangeStart: number,\n  rangeEnd: number,\n  textLength: number,\n) {\n  const range = document.createRange();\n  if (rangeEnd - rangeStart > 1) {\n    const offset = Math.floor((rangeStart + rangeEnd) / 2);\n    try {\n      range.setStart(textNode, offset);\n      range.setEnd(textNode, Math.max(Math.min(offset, textLength), 0));\n    } catch (error) {\n      return rangeStart;\n    }\n\n    // getClientBoundingRect不保险，在iOS10下结果不对\n    const rect = range.getClientRects()[0];\n    if (!rect) {\n      return rangeStart;\n    }\n    if (mouseY < rect.top) {\n      return binarySearchOffset(\n        textNode,\n        mouseX,\n        mouseY,\n        rangeStart,\n        offset,\n        textLength,\n      );\n    }\n    if (mouseY > rect.bottom) {\n      return binarySearchOffset(\n        textNode,\n        mouseX,\n        mouseY,\n        offset,\n        rangeEnd,\n        textLength,\n      );\n    }\n    if (mouseX <= rect.left + rect.width) {\n      return binarySearchOffset(\n        textNode,\n        mouseX,\n        mouseY,\n        rangeStart,\n        offset,\n        textLength,\n      );\n    }\n    return binarySearchOffset(\n      textNode,\n      mouseX,\n      mouseY,\n      offset,\n      rangeEnd,\n      textLength,\n    );\n  }\n\n  const [offsetStart, offsetEnd] = textUtils.getCharRange(\n    textNode.textContent!,\n    rangeStart,\n  );\n  try {\n    range.setStart(textNode, offsetStart);\n    range.setEnd(textNode, Math.max(Math.min(offsetEnd, textLength), 0));\n  } catch (error) {\n    return offsetStart;\n  }\n\n  const rangeRects = Array.from(range.getClientRects());\n  const rect = rangeRects.find((r) => r.width > 0) || rangeRects[0];\n  if (!rect) {\n    return offsetStart;\n  }\n  if (mouseY < rect.top) {\n    return offsetStart;\n  }\n  if (mouseY > rect.bottom) {\n    return offsetEnd;\n  }\n  if (mouseX <= rect.left + rect.width / 2) {\n    return offsetStart;\n  }\n  return offsetEnd;\n}\n\nfunction caretPointFromTargetAndCoord({\n  eventTarget,\n  mouseX,\n  mouseY,\n  adjustedX,\n  adjustedY,\n}: {\n  eventTarget: Element;\n  mouseX: number;\n  mouseY: number;\n  adjustedX: number;\n  adjustedY: number;\n}) {\n  let target = eventTarget;\n  let [x, y] = [adjustedX, adjustedY];\n  for (const node of getSeletableBlocksFromElement(target)) {\n    const rect = node.getBoundingClientRect();\n    const parent = getClosestAncestorWithBiggerHorizontalRect(node);\n    // 检查 eventTarget 是否在 node 的左侧和右侧\n    if (\n      !parent ||\n      isPointHorzInsideRect(mouseX, mouseY, rect) ||\n      !isPointVertInsideRect(mouseX, mouseY, rect)\n    ) {\n      continue;\n    }\n    // 如果 eventTarget 在父元素内部，才算命中（处理表格等情况）\n    const parentRect = parent.getBoundingClientRect();\n    const parentStyle = window.getComputedStyle(parent);\n    // 父元素的 margin 也需要计算在内（排版等情况，用的是 margin）\n    const parentLeft = parentRect.left - parseInt(parentStyle.marginLeft, 10);\n    const parentRight = parentRect.right + parseInt(parentStyle.marginRight, 10);\n    if (x >= parentLeft && x <= parentRight) {\n      const edge = x > rect.left ? EdgePoint.AFTER : EdgePoint.BEFORE;\n      return {\n        node,\n        edge,\n      };\n    }\n  }\n\n  let closestLeftEdge: number | undefined;\n  let closestRightEdge: number | undefined;\n  if (\n    !findClosestInContent(target, `span[${Selector.leaf}]`) &&\n    !findClosestInContent(target, `[${Selector.void}]`)\n  ) {\n    const {\n      exactTarget,\n      closestBelow,\n      closestLeft,\n      closestRight,\n      closestTop,\n    } = findClosestRectsInElement(target, x, y);\n    closestLeftEdge = closestLeft?.contentRect.right;\n    closestRightEdge = closestRight?.contentRect.left;\n\n    if (exactTarget) {\n      target = exactTarget;\n    } else if (closestBelow && closestLeft) {\n      if (isRectOnSameLineOfRect(closestBelow.contentRect, closestLeft.contentRect)) {\n        y = closestBelow.contentRect.top;\n        target = closestBelow.contentNode;\n      } else {\n        x = closestLeft.contentRect.right;\n        target = closestLeft.contentNode;\n      }\n    } else if (closestBelow && closestRight) {\n      if (\n        isRectOnSameLineOfRect(closestBelow.contentRect, closestRight.contentRect)\n      ) {\n        y = closestBelow.contentRect.top;\n        target = closestBelow.contentNode;\n      } else {\n        x = closestRight.contentRect.left;\n        target = closestRight.contentNode;\n      }\n    } else if (closestLeft) {\n      x = closestLeft.contentRect.right;\n      target = closestLeft.contentNode;\n    } else if (closestRight) {\n      x = closestRight.contentRect.left;\n      target = closestRight.contentNode;\n    } else if (closestBelow) {\n      // 如果不是正下方，是左下方或者右下方\n      // 则x坐标需要进行左移或者右移\n      if (isPointOnLeftOfRect(x, y, closestBelow.contentRect)) {\n        x = closestBelow.contentRect.left;\n      } else if (isPointOnRightOfRect(x, y, closestBelow.contentRect)) {\n        x = closestBelow.contentRect.right;\n      }\n      y = closestBelow.contentRect.top;\n      target = closestBelow.contentNode;\n    } else if (closestTop) {\n      if (isPointOnLeftOfRect(x, y, closestTop.contentRect)) {\n        x = closestTop.contentRect.left;\n      } else if (isPointOnRightOfRect(x, y, closestTop.contentRect)) {\n        x = closestTop.contentRect.right;\n      }\n      y = closestTop.contentRect.bottom;\n      target = closestTop.contentNode;\n    }\n  }\n\n  if (!(target instanceof Element)) {\n    return null;\n  }\n\n  if (findClosestInContent(target, `[${Selector.void}]`)) {\n    const node = findClosestInContent(target, `[${Selector.void}]`);\n    let textNode: Text | null = null;\n    let offset = 0;\n    if (closestLeftEdge && Math.round(x) === Math.round(closestLeftEdge)) {\n      const nextTextNode = node?.nextElementSibling?.querySelector(`span[${Selector.leaf}]`)?.firstChild;\n      textNode = nextTextNode instanceof Text ? nextTextNode : null;\n    } else if (closestRightEdge && Math.round(x) === Math.round(closestRightEdge)) {\n      const nextTextNode = node?.previousElementSibling?.querySelector(`span[${Selector.leaf}]`)?.firstChild;\n      textNode = nextTextNode instanceof Text ? nextTextNode : null;\n      offset = textNode?.textContent?.length || 0;\n    }\n    return {\n      node: textNode || node,\n      offset,\n    };\n  }\n  if (findClosestInContent(target, `span[${Selector.leaf}]`)) {\n    const leafContent = target.getAttribute(Selector.leaf)\n      ? target\n      : target.querySelector(`span[${Selector.leaf}]`);\n    const textNode = leafContent && leafContent.firstChild;\n    if (textNode instanceof Text && textNode.textContent === CANGJIE_EMPTY) {\n      return {\n        node: textNode,\n        offset: 0,\n      };\n    }\n    if (textNode instanceof Text && textNode.textContent) {\n      const offset = binarySearchOffset(\n        textNode,\n        x,\n        y,\n        0,\n        textNode.textContent.length,\n        textNode.textContent.length,\n      );\n      return {\n        node: textNode,\n        offset,\n      };\n    }\n    return null;\n  }\n  return null;\n}\n\nexport default function caretRangeFromTargetAndCoord(\n  eventTarget: EventTarget,\n  mouseX: number,\n  mouseY: number,\n  controller: Controller,\n) {\n  let target: any = eventTarget;\n  if (target instanceof Text) {\n    target = target.parentNode;\n  } else if (target.shadowRoot) {\n    target = target.shadowRoot.querySelector(`[${Selector.content}]`);\n  }\n  if (!target || !(target instanceof Element)) {\n    return null;\n  }\n\n  let [x, y] = [mouseX, mouseY];\n  if (target.getAttribute(Selector.content)) {\n    const editable = target.querySelector(`[${Selector.editable}]`);\n    if (editable) {\n      const editableRect = editable.getBoundingClientRect();\n      if (x < editableRect.left) {\n        x = editableRect.left;\n      } else if (x > editableRect.right) {\n        x = editableRect.right - 1;\n      }\n      if (y < editableRect.top) {\n        y = editableRect.top;\n      } else if (y > editableRect.bottom) {\n        y = editableRect.bottom - 1;\n      }\n      // ref: https://developer.mozilla.org/en-US/docs/Web/API/Node/getRootNode\n      const root = target.getRootNode() as unknown as DocumentOrShadowRoot;\n      const adjustedTarget = typeof root.elementFromPoint === 'function'\n        ? root.elementFromPoint(x, y)\n        : null;\n      if (adjustedTarget) {\n        target = adjustedTarget;\n      }\n    }\n  }\n\n  const point = caretPointFromTargetAndCoord({\n    eventTarget: target as Element,\n    adjustedX: x,\n    adjustedY: y,\n    mouseX,\n    mouseY,\n  });\n  if (!point || !point.node) {\n    return null;\n  }\n\n  const nodeKey =\n    point.node instanceof Element\n      ? point.node.getAttribute(Selector.key)\n      : null;\n  if (point.edge && nodeKey) {\n    const pointProperties = {\n      key: nodeKey,\n      edge: point.edge,\n    };\n    const anchor = Point.create(pointProperties);\n    return Selection.create({\n      anchor,\n      focus: anchor,\n    });\n  }\n  const native = document.createRange();\n  try {\n    native.setStart(point.node, point.offset);\n    native.setEnd(point.node, Math.max(point.offset, 0));\n  } catch (error) {\n    return null;\n  }\n  return native && findRange(native, controller);\n}\n","import Controller from '../../controller';\nimport { Selector } from '../../constants';\n\nexport const ROOT_TO_CONTROLLER = new WeakMap<Element | Document, Controller>();\nexport const CONTROLLER_TO_KEY_DOM = new WeakMap<Controller, Map<string, HTMLElement>>();\n/**\n * 这里原先作用应该是提供缓存命中率，由于内存泄露问题，暂时中断GLOBAL_KEY_DOM的缓存\n * 不确定什么场景下CONTROLLER_TO_KEY_DOM会失效，需要用到GLOBAL_KEY_DOM\n * 如果需要继续维持的话，这里也可以通过documentKey的维度进行缓存，类似：\n * const GLOBAL_KEY_DOM = new Map<string, Map<string, HTMLElement>>();\n */\nexport const GLOBAL_KEY_DOM = new Map<string, HTMLElement>();\n\nfunction getElementByCangjieKey(key: string, root: Element | Document): HTMLElement | null {\n  let KEY_DOM;\n  const controller = ROOT_TO_CONTROLLER.get(root);\n  if (controller) {\n    if (!CONTROLLER_TO_KEY_DOM.has(controller)) {\n      CONTROLLER_TO_KEY_DOM.set(controller, new Map());\n    }\n    KEY_DOM = CONTROLLER_TO_KEY_DOM.get(controller)!;\n  }\n\n  if (KEY_DOM && KEY_DOM.has(key)) {\n    return KEY_DOM.get(key)!;\n  }\n  if (root instanceof Element && key === root.getAttribute(Selector.key)) {\n    return root as HTMLElement;\n  }\n  return root.querySelector<HTMLElement>(`[${Selector.key}=\"${key}\"]`);\n}\n\nexport default getElementByCangjieKey;\n","/**\n * @packageDocumentation\n * @module domUtils\n */\nimport getElementByCangjieKey from './getElementByCangjieKey';\n\n/**\n * 根据节点的 key 查找对应的 DOM 节点。如果找不到，就返回 null\n */\nexport function findDOMNodeSafely(\n  key: string,\n  root: Window | Element = window,\n) {\n  const node =\n    root !== window\n      ? getElementByCangjieKey(key, root as Element)\n      : getElementByCangjieKey(key, root.document);\n  return node || undefined;\n}\n\n/**\n * 根据节点的 key 查找对应的 DOM 节点。如果找不到，就 throw error。\n * 类似的 API：domUtils.findDOMNodeSafely\n */\nfunction findDOMNode(key: string, root: Window | Element = window) {\n  const node = findDOMNodeSafely(key, root);\n  if (!node) {\n    throw new Error(\n      `Unable to find a DOM node for \"${key}\". This is often because of forgetting to add \\`props.attributes\\` to a custom component.`,\n    );\n  }\n  return node;\n}\n\nexport default findDOMNode;\n","import { Selector } from '../../constants';\nimport getElementByCangjieKey from './getElementByCangjieKey';\n\nfunction findDOMLeaves(key: string, root: Window | Element = window) {\n  const element = root instanceof Element ? root : root.document;\n  const firstLeaf = getElementByCangjieKey(`${key}:0`, element);\n  const leafBlock = firstLeaf?.closest(`[${Selector.leafBlock}]`);\n  return leafBlock ? Array.from(leafBlock.querySelectorAll<HTMLElement>(`[${Selector.key}^=\"${key}:\"]`)) : [];\n}\n\nexport default findDOMLeaves;","/**\n * @packageDocumentation\n * @module domUtils\n */\nimport { TextPoint } from '../../models/point';\nimport findDOMLeaves from './findDOMLeaves';\n\n/**\n * 根据 Point 来获取浏览器的 HTML 节点、offset。\n */\nfunction findDOMPoint(point: TextPoint, root: Window | Element = window) {\n  const leaves = findDOMLeaves(point.key, root);\n\n  let start = 0;\n  // eslint-disable-next-line no-restricted-syntax\n  for (const leaf of leaves) {\n    const node = leaf.firstChild;\n    const length = node && node.textContent ? node.textContent.length : 0;\n    const end = start + length;\n    if (point.offset <= end) {\n      const offset = point.offset - start;\n      return { node, offset };\n    }\n    start = end;\n  }\n  return null;\n}\n\nexport default findDOMPoint;\n","/* eslint-disable react/no-find-dom-node */\n/**\n * @packageDocumentation\n * @module domUtils\n */\nimport Controller from '../../controller/index';\nimport Selection from '../../models/selection';\nimport findDOMNode from './findDOMNode';\nimport findDOMPoint from './findDOMPoint';\n\n/**\n * 根据仓颉的 RangeSelection 获取浏览器的 Range。\n */\nfunction findDOMRange(\n  range: Selection,\n  controller: Controller,\n  root: Window | HTMLElement = window,\n) {\n  const { document } = controller.value;\n  const { isCollapsed } = range;\n  const { start, end } = range.convertToTextPoints(document);\n  // @ts-ignore\n  const r = ('document' in root ? root.document : root.ownerDocument).createRange();\n  const domStart = findDOMPoint(start, root);\n  const domEnd = isCollapsed ? domStart : findDOMPoint(end, root);\n\n  // 查找 Range 时，首先查找文字选区，若文字选区不存在，则判断是否存在 void 选区\n  try {\n    if (domStart && domStart.node) {\n      r.setStart(domStart.node, domStart.offset);\n    } else {\n      const startVoidNode = document.getClosestVoid(start.key, controller);\n      if (startVoidNode) {\n        const domNode = findDOMNode(startVoidNode.key, root);\n        r.setStartBefore(domNode);\n      } else {\n        return null;\n      }\n    }\n\n    if (domEnd && domEnd.node) {\n      r.setEnd(domEnd.node, domEnd.offset);\n    } else {\n      const endVoidNode = document.getClosestVoid(end.key, controller);\n      if (endVoidNode) {\n        const domNode = findDOMNode(endVoidNode.key, root);\n        r.setEndAfter(domNode);\n      } else {\n        return null;\n      }\n    }\n  } catch (error) {\n    console.error(error);\n    return null;\n  }\n\n  return r;\n}\n\nexport default findDOMRange;\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport Point from '../../models/point';\nimport findDOMPoint from '../dom/findDOMPoint';\n\nexport function getAroundRects(point: Point) {\n  if (!point.isTextPoint()) {\n    return [];\n  }\n  const prevPoint = point.moveBackward();\n  const nextPoint = point.moveForward();\n\n  if (prevPoint.offset < 0) {\n    return [];\n  }\n\n  let domPoint: ReturnType<typeof findDOMPoint> = null;\n  let prevDomPoint: ReturnType<typeof findDOMPoint> = null;\n  let nextDomPoint: ReturnType<typeof findDOMPoint> = null;\n\n  try {\n    domPoint = findDOMPoint(point);\n    prevDomPoint = findDOMPoint(prevPoint);\n    nextDomPoint = findDOMPoint(nextPoint);\n  } catch (error) {\n    // ignore\n  }\n\n  if (\n    !domPoint ||\n    !domPoint.node ||\n    !prevDomPoint ||\n    !prevDomPoint.node ||\n    !nextDomPoint ||\n    !nextDomPoint.node\n  ) {\n    return [];\n  }\n\n  const firstRange = window.document.createRange();\n  const secondRange = window.document.createRange();\n  try {\n    firstRange.setStart(prevDomPoint.node, prevDomPoint.offset);\n    firstRange.setEnd(domPoint.node, domPoint.offset);\n    secondRange.setStart(domPoint.node, domPoint.offset);\n    secondRange.setEnd(nextDomPoint.node, nextDomPoint.offset);\n  } catch (error) {\n    return [];\n  }\n\n  const firstRects = Array.from(firstRange.getClientRects()).filter(\n    (r) => r.width > 0,\n  );\n  const secondRects = Array.from(secondRange.getClientRects()).filter(\n    (r) => r.width > 0,\n  );\n  const firstRect = firstRects[firstRects.length - 1];\n  const secondRect = secondRects[0];\n  return [firstRect, secondRect];\n}\n\nexport function findRectsInEdgePoint(point: Point) {\n  const [firstRect, secondRect] = getAroundRects(point);\n  if (!firstRect || !secondRect || typeof DOMRect === 'undefined') {\n    return [];\n  }\n  return [\n    new DOMRect(firstRect.right, firstRect.top, 0, firstRect.height),\n    new DOMRect(secondRect.left, secondRect.top, 0, secondRect.height),\n  ];\n}\n\nexport default function isPointAtEdge(point: Point) {\n  const [firstRect, secondRect] = getAroundRects(point);\n  if (!firstRect || !secondRect) {\n    return false;\n  }\n\n  /**\n   * The comparsion was secondRect.left < firstRect.right, but it's 0.xx px\n   * incorrect for adjusting bold mark.\n   */\n  return secondRect.left < firstRect.left;\n}\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport Controller from '../../controller/index';\nimport Selection from '../../models/selection';\nimport Point from '../../models/point';\nimport findDOMRange from './findDOMRange';\nimport isPointAtEdge, { findRectsInEdgePoint } from './isPointAtEdge';\nimport findDOMNode from './findDOMNode';\n\nexport default function findRectFromPoint(\n  point: Point,\n  isHanging: boolean,\n  controller: Controller,\n) {\n  if (!point.isTextPoint()) {\n    // eslint-disable-next-line react/no-find-dom-node\n    const node = findDOMNode(point.key);\n    return node.getBoundingClientRect();\n  }\n  const { document } = controller.value;\n  const text = document.getNode(point.key)?.text;\n  const isAfterNewLine = text && text[point.offset - 1] === '\\n';\n  const isAtEdge = isPointAtEdge(point);\n  if (isAtEdge) {\n    const edgeRects = findRectsInEdgePoint(point);\n    return isHanging ? edgeRects[edgeRects.length - 1] : edgeRects[0];\n  }\n  const domRange = findDOMRange(\n    Selection.create({\n      anchor: point,\n      focus: point,\n    }),\n    controller,\n  );\n  if (!domRange) {\n    return null;\n  }\n  const rangeRects = domRange.getClientRects();\n  // choose last rect when the point is hanging or after \\n\n  return (isHanging || isAfterNewLine) ? rangeRects[rangeRects.length - 1] : rangeRects[0];\n}\n","import Controller from '../../controller';\nimport type { CaretAppearance } from '../../components/selection/types';\n\nconst cache = new WeakMap<Controller, { caret: CaretAppearance; wrapper: HTMLDivElement }>();\n\nexport const cacheLocalCaret = (controller: Controller, position: CaretAppearance, wrapper: HTMLDivElement) => {\n  cache.set(controller, { caret: position, wrapper });\n}\n\nexport const getLocalCaretPos = (controller: Controller) => {\n  return cache.get(controller)?.caret;\n}\n\nexport const getLocalCaretPosDetail = (controller: Controller) => {\n  return cache.get(controller);\n}","/**\n * @packageDocumentation\n * @ignore\n */\nimport Controller from '../../controller/index';\nimport findDOMNode from './findDOMNode';\nimport Point, { EdgePoint } from '../../models/point';\nimport { getAroundRects } from './isPointAtEdge';\nimport { getLocalCaretPos } from './localCaretPos';\n\n/**\n * 从 from 垂直变到 to 点时，新的点是否为 isHanging\n * @param from 起始 Point\n * @param to 目标 Point\n * @returns isHanging\n */\nexport function shouldBeHangingByVertically(from: Point, to: Point, controller: Controller) {\n  if (to.isEdgePoint()) {\n    return false;\n  }\n  const [firstRect, secondRect] = getAroundRects(to);\n  if (!firstRect || !secondRect) {\n    return false;\n  }\n\n  if (from.isEdgePoint()) {\n    return secondRect.left < firstRect.left && from.edge === EdgePoint.BEFORE;\n  }\n\n  const fromPos = getLocalCaretPos(controller);\n  if (!fromPos || secondRect.left >= firstRect.left) {\n    return false;\n  }\n\n  // to 在边界点上，且起点更靠近 secondRect.left 时，应为 isHanging\n  return (fromPos.left - secondRect.left) < (firstRect.right - fromPos.left);\n}\n\nexport function isCoordAtLeftSide(\n  clientX: number,\n  controller: Controller,\n) {\n  const { document } = controller.value;\n  // eslint-disable-next-line react/no-find-dom-node\n  const articleDom = findDOMNode(document.key);\n  if (!articleDom) {\n    return false;\n  }\n  const rect = articleDom.getBoundingClientRect();\n  return clientX < rect.left + rect.width / 2;\n}\n","/* eslint-disable react/no-find-dom-node */\n/**\n * @packageDocumentation\n * @ignore\n */\nimport Controller from '../controller/index';\nimport Node from '../models/node';\nimport Element from '../models/element';\nimport Point, {\n  EdgePoint,\n  TextPoint,\n  TextPointProperties,\n  EdgePointProperties,\n} from '../models/point';\nimport Document from '../models/document';\nimport textUtils from '../utils/textUtils';\n\nimport caretRangeFromTargetAndCoord from '../utils/dom/caretRangeFromTargetAndCoord';\nimport findDOMNode from '../utils/dom/findDOMNode';\nimport findRectFromPoint from '../utils/dom/findRectFromPoint';\nimport { isCoordAtLeftSide, shouldBeHangingByVertically } from '../utils/dom/caretHanging';\nimport { Selector } from '../constants';\n\nexport type MoveUnit = 'offset' | 'word';\n\n/**\n *\n * move point out of inline IF it's located at inline edges\n *\n * Optimizition for non-void inlines (e.g. <Link> elements) for better experience\n *\n * Before: <link>[anchor]www.dingtalk.com[focus]</link>\n * After: [anchor]<link>www.dingtalk.com</link>[focus]\n */\nexport const correctPointInsideInlineOrBlock = (\n  controller: Controller,\n  point: TextPoint,\n) => {\n  const { document } = controller.value;\n  const parent = document.getClosestInline(point.key);\n  if (!parent || controller.query('isVoid', parent) || controller.query('isInlineBlock', parent)) {\n    return point;\n  }\n  if (point.offset === 0) {\n    const textNode = document.getPreviousText(point.key);\n    if (textNode) {\n      const { key } = textNode;\n      const offset = textNode.text.length;\n      return TextPoint.create({ key, offset });\n    }\n  } else if (point.offset === parent.text.length) {\n    const textNode = document.getNextText(point.key);\n    if (textNode) {\n      const { key } = textNode;\n      const offset = 0;\n      return TextPoint.create({ key, offset });\n    }\n  }\n  return point;\n};\n\nfunction* iterateTextNodesFromPoint(\n  document: Document,\n  at: Point,\n  reverse?: boolean,\n): Iterable<Node> {\n  const atNode = document.getNode(at.key);\n  if (!atNode) {\n    return;\n  }\n  if (atNode.isText()) {\n    yield atNode;\n  }\n\n  const next = (key: string) => {\n    return reverse ? document.getPreviousText(key) : document.getNextText(key);\n  };\n\n  const startText = (element: Element) => {\n    return reverse ? element.getLastText() : element.getFirstText();\n  };\n\n  const goDeep =\n    at.isEdgePoint() &&\n    ((at.edge === EdgePoint.BEFORE && !reverse) || (at.edge === EdgePoint.AFTER && reverse));\n\n  let node =\n    goDeep && atNode.isElement() ? startText(atNode) : next(atNode.key);\n  while (node) {\n    yield node;\n    node = next(node.key);\n  }\n}\n\nfunction* iteratePositionsFromPoint(\n  controller: Controller,\n  at: Point,\n  unit: MoveUnit,\n  reverse?: boolean,\n): Iterable<TextPointProperties | EdgePointProperties> {\n  const { document } = controller.value;\n\n  const step = (t: string, o: number) => {\n    if (unit === 'offset') {\n      const nextCharStep = textUtils.getCharOffset(t, o, reverse);\n      return nextCharStep || 1;\n    }\n    const count = textUtils.getMoveWordOffset(t, o, reverse);\n    return Math.max(count, 1);\n  };\n\n  // We ignore the start point by default, since the start point is the same\n  // point as the end point of the previous text\n  let shouldCountStartPoint = false;\n  let lastBlock = document.getClosestBlock(at.key);\n  let offset = 0;\n\n  function getEdgePoint(\n    nodeKey: string,\n    isAtEntrance: boolean,\n  ): EdgePointProperties | null {\n    const closestBlock = document.getClosestSelectableBlock(\n      nodeKey,\n      controller,\n    );\n    if (!closestBlock) {\n      return null;\n    }\n    const firstText = closestBlock.getFirstText();\n    const lastText = closestBlock.getLastText();\n    let edgeText = firstText;\n    if (isAtEntrance) {\n      // alway skip the entrance WHEN started at a selectable inside node\n      if (closestBlock.getNode(at.key)) {\n        return null;\n      }\n      edgeText = reverse ? lastText : firstText;\n    } else {\n      edgeText = reverse ? firstText : lastText;\n    }\n\n    const isTextAtEdge = edgeText?.key === nodeKey;\n    if (!isTextAtEdge) {\n      return null;\n    }\n    const { key } = closestBlock;\n    const edge =\n      (reverse && isAtEntrance) || (!reverse && !isAtEntrance)\n        ? EdgePoint.AFTER\n        : EdgePoint.BEFORE;\n    return { key, edge };\n  }\n\n  for (const node of iterateTextNodesFromPoint(document, at, reverse)) {\n    const { text, key } = node;\n    const closestBlock = document.getClosestBlock(key);\n\n    let nodePoint = getEdgePoint(key, true);\n    if (nodePoint) {\n      yield nodePoint;\n    }\n    // skip the void elements and count the next start point\n    if (document.getClosestVoid(node.key, controller)) {\n      nodePoint = getEdgePoint(key, false);\n      if (nodePoint) {\n        yield nodePoint;\n      }\n      shouldCountStartPoint = true;\n      continue;\n    }\n\n    // it's another block, count the next start point\n    if (lastBlock !== closestBlock) {\n      lastBlock = closestBlock;\n      shouldCountStartPoint = true;\n    }\n\n    // calculate the start point (offset)\n    if (at.isTextPoint() && node.key === at.key) {\n      // special case: first text\n      offset = reverse\n        ? at.offset - step(text, at.offset)\n        : at.offset + step(text, at.offset);\n    } else if (shouldCountStartPoint) {\n      // special case: count the start point\n      offset = reverse ? text.length : 0;\n      shouldCountStartPoint = false;\n    } else {\n      offset = reverse ? text.length - step(text, text.length) : step(text, 0);\n    }\n\n    // now iterate the text node\n    while (offset <= text.length && offset >= 0) {\n      yield { key, offset };\n      reverse ? (offset -= step(text, offset)) : (offset += step(text, offset));\n    }\n\n    nodePoint = getEdgePoint(key, false);\n    if (nodePoint) {\n      yield nodePoint;\n    }\n  }\n}\n\nexport function pointAtDistance(\n  controller: Controller,\n  at: Point,\n  distance = 1,\n  unit: MoveUnit = 'offset',\n) {\n  const { document } = controller.value;\n  const reverse = distance < 0;\n  let remaining = Math.abs(distance);\n\n  if (unit === 'word' && at.isEdgePoint()) {\n    const { key } = at;\n    if (reverse && at.edge === EdgePoint.AFTER) {\n      return EdgePoint.create({ key, edge: EdgePoint.BEFORE });\n    }\n    if (!reverse && at.edge === EdgePoint.BEFORE) {\n      return EdgePoint.create({ key, edge: EdgePoint.AFTER });\n    }\n  }\n\n  for (const pt of iteratePositionsFromPoint(controller, at, unit, reverse)) {\n    remaining -= 1;\n    if (remaining <= 0) {\n      return Point.create(pt);\n    }\n  }\n  return controller.query(pointAtNodeEdge, document, reverse ? 'start' : 'end');\n}\n\nexport function pointAtStartOfNode(controller: Controller, node: Node) {\n  return controller.query(pointAtNodeEdge, node, 'start');\n}\n\nexport function pointAtEndOfNode(controller: Controller, node: Node) {\n  return controller.query(pointAtNodeEdge, node, 'end');\n}\n\nfunction pointAtNodeEdge(\n  controller: Controller,\n  node: Node,\n  where: 'start' | 'end',\n) {\n  const { document } = controller.value;\n  const targetNode =\n    where === 'start' ? node.getFirstNode() : node.getLastNode();\n  // 获取 node 下距离 targetNode 最远的可 edgeSelectable 的 block 节点\n  const furthestBlock = document.getFurthestSelectableBlock(\n    targetNode.key,\n    node.key,\n    controller,\n  );\n  // 若存在 furthestBlock 则返回该 block 的 edge point\n  if (furthestBlock) {\n    const { key } = furthestBlock;\n    const edge = where === 'start' ? EdgePoint.BEFORE : EdgePoint.AFTER;\n    return EdgePoint.create({ key, edge });\n  }\n  // 否则返回 targetNode 内 的 text point\n  const { key } = targetNode;\n  const offset = where === 'start' ? 0 : targetNode.text.length;\n  return TextPoint.create({ key, offset });\n}\n\nfunction getTrueRectFromPoint(controller, point, isHanging) {\n  const { document } = controller.value;\n  const node = document.assertNode(point.key);\n  const closestVoid = controller.query('isVoid', node)\n    ? node\n    : document.getClosestVoid(point.key, controller);\n  let rangeRect: DOMRect | null = null;\n  if (closestVoid) {\n    rangeRect = findDOMNode(closestVoid.key).getBoundingClientRect();\n  } else {\n    rangeRect = findRectFromPoint(point, isHanging, controller);\n  }\n  if (!rangeRect) {\n    return null;\n  }\n  return rangeRect;\n}\n\nexport function getUpsidePoint(\n  controller: Controller,\n  point: Point,\n  isHanging: boolean,\n  lockedX?: number,\n) {\n  const { value } = controller;\n  const { document } = value;\n\n  const rangeRect = getTrueRectFromPoint(controller, point, isHanging);\n  if (!rangeRect) {\n    return null;\n  }\n\n  const rectX = point.isEdgePoint() && point.edge === EdgePoint.AFTER ? rangeRect.right : rangeRect.left;\n\n  const x = typeof lockedX === 'number' ? lockedX : rectX;\n  let y = rangeRect.top;\n\n  let currentBlock = document.getClosestBlockFromPoint(point.key);\n  let currentBlockDOM: globalThis.Element | null = null;\n  let currentLeafDOMs: globalThis.Element[];\n  let found = false;\n  while (!found) {\n    if (!currentBlock) {\n      return null;\n    }\n    const closestBlock = document.getClosestSelectableBlock(currentBlock.key, controller);\n    if ((closestBlock && closestBlock.key !== point.key && !closestBlock.getNode(point.key))) {\n      const { key } = closestBlock;\n      const edge = isCoordAtLeftSide(x, controller) ? EdgePoint.BEFORE : EdgePoint.AFTER;\n      return EdgePoint.create({ key, edge });\n    }\n    try {\n      currentBlockDOM = findDOMNode(currentBlock.key, window);\n    } catch (e) {\n      currentBlock = document.getPreviousBlock(currentBlock.key);\n      continue;\n    }\n\n    currentLeafDOMs = Array.from(\n      currentBlockDOM!.querySelectorAll(`span[${Selector.leaf}]`),\n    ).reverse();\n\n    // eslint-disable-next-line no-restricted-syntax\n    for (const leafDOM of currentLeafDOMs) {\n      if (found) {\n        break;\n      }\n\n      const blockRects = Array.from(leafDOM.getClientRects())\n        .filter((rect) => rect.height > 0);\n\n      const blockRectsLength = blockRects.length;\n\n      // eslint-disable-next-line no-plusplus\n      for (let i = blockRectsLength - 1; i >= 0; i--) {\n        const blockRect = blockRects[i];\n        if (blockRect.bottom <= y) {\n          found = true;\n          y = blockRect.bottom - blockRect.height / 2;\n          break;\n        }\n      }\n    }\n    currentBlock = document.getPreviousBlock(currentBlock.key);\n  }\n\n  const range =\n    currentBlockDOM && caretRangeFromTargetAndCoord(currentBlockDOM, x, y, controller);\n  if (!range) {\n    return null;\n  }\n  return range.anchor;\n}\n\nexport function getUpsideRange(controller: Controller) {\n  const { value } = controller;\n  const { document, selection } = value;\n  if (!selection) {\n    return null;\n  }\n  const start = selection.getStart(document);\n  const { isHanging } = selection;\n\n  const point = getUpsidePoint(controller, start, isHanging);\n  if (!point) {\n    return selection.moveToStartOfDocument(controller);\n  }\n\n  const nextIsHanging = shouldBeHangingByVertically(start, point, controller);\n\n  const newRange = selection\n    .moveAnchorTo(point.key, point.isEdgePoint() ? point.edge : point.offset)\n    .moveToAnchor()\n    .setHanging(nextIsHanging);\n\n  return newRange;\n}\n\nexport function getDownsidePoint(\n  controller: Controller,\n  point: Point,\n  isHanging: boolean,\n  lockedX?: number,\n) {\n  const { value } = controller;\n  const { document } = value;\n  const rangeRect = getTrueRectFromPoint(controller, point, isHanging);\n  if (!rangeRect) {\n    return null;\n  }\n\n  const rectX = point.isEdgePoint() && point.edge === EdgePoint.AFTER ? rangeRect.right : rangeRect.left;\n\n  const x = typeof lockedX === 'number' ? lockedX : rectX;\n  let y = rangeRect.bottom;\n\n  let currentBlock = document.getClosestBlockFromPoint(point.key);\n  let currentBlockDOM: globalThis.Element | null = null;\n  let currentLeafDOMs: globalThis.Element[];\n\n  let found = false;\n  while (!found) {\n    if (!currentBlock) {\n      return null;\n    }\n    const closestBlock = document.getClosestSelectableBlock(currentBlock.key, controller);\n    if (closestBlock && closestBlock.key !== point.key && !closestBlock.getNode(point.key)) {\n      const { key } = closestBlock;\n      const edge = isCoordAtLeftSide(x, controller) ? EdgePoint.BEFORE : EdgePoint.AFTER;\n      return EdgePoint.create({ key, edge });\n    }\n    try {\n      currentBlockDOM = findDOMNode(currentBlock.key, window);\n    } catch (e) {\n      currentBlock = document.getNextBlock(currentBlock.key);\n      continue;\n    }\n    currentLeafDOMs = Array.from(\n      currentBlockDOM.querySelectorAll(`span[${Selector.leaf}]`),\n    );\n\n    // eslint-disable-next-line no-restricted-syntax\n    for (const leafDOM of currentLeafDOMs) {\n      if (found) {\n        break;\n      }\n\n      const blockRects = Array.from(leafDOM.getClientRects())\n        .filter((rect) => rect.height > 0);\n\n      const blockRectsLength = blockRects.length;\n\n      // eslint-disable-next-line no-plusplus\n      for (let i = 0; i <= blockRectsLength - 1; i++) {\n        const blockRect = blockRects[i];\n        if (blockRect.top >= y) {\n          found = true;\n          y = blockRect.top + blockRect.height / 2;\n          break;\n        }\n      }\n    }\n    currentBlock = document.getNextBlock(currentBlock.key);\n  }\n\n  const range =\n    currentBlockDOM && caretRangeFromTargetAndCoord(currentBlockDOM, x, y, controller);\n  if (!range) {\n    return null;\n  }\n  return range.anchor;\n}\n\nexport function getDownsideRange(controller: Controller) {\n  const { value } = controller;\n  const { document, selection } = value;\n  if (!selection) {\n    return null;\n  }\n  const start = selection.getStart(document);\n  const { isHanging } = selection;\n\n  const point = getDownsidePoint(controller, start, isHanging);\n  if (!point) {\n    return selection.moveToEndOfDocument(controller);\n  }\n\n  const nextIsHanging = shouldBeHangingByVertically(start, point, controller);\n\n  const newRange = selection\n    .moveAnchorTo(point.key, point.isEdgePoint() ? point.edge : point.offset)\n    .moveToAnchor()\n    .setHanging(nextIsHanging);\n\n  return newRange;\n}\n","/**\n * @packageDocumentation\n * @module Models\n */\nimport equal from 'fast-deep-equal';\nimport isPlainObject from 'is-plain-object';\nimport ImmutableRecord from './immutableRecord';\nimport Path from './path';\nimport Point, {\n  EdgePoint,\n  TextPoint,\n  TextPointJSON,\n  EdgePointJSON,\n  PointEdge,\n} from './point';\nimport Node from './node';\nimport Document from './document';\nimport { Serializable, SerializeOptions } from '../interfaces/serializable';\nimport Data from '../interfaces/data';\nimport Mark, { MarkJSON } from './mark';\nimport Controller from '../controller';\nimport { pointAtStartOfNode, pointAtEndOfNode } from '../queries/selection';\nimport textUtils from '../utils/textUtils';\nimport Block from './block';\n\n/**\n * @ignore\n */\nexport type SupportEdge = 'start' | 'end';\n\nexport type SupportPointName = 'anchor' | 'focus' | 'start' | 'end';\n/**\n * @ignore\n */\nexport type SupportSide = 'previous' | 'next';\n/**\n * @ignore\n */\nexport type SupportKlass = 'block' | 'inline' | 'text';\n\nexport enum SelectionTrigger {\n  Selecting = 'selecting',\n  SelectStart = 'selectStart',\n  SelectAll = 'selectAll',\n  MoveUpward = 'moveUpward',\n  MoveDownward = 'moveDownward',\n  MoveBackward = 'moveBackward',\n  MoveForward = 'moveForward',\n  MultipleClick = 'multipleClick',\n}\n\nexport interface SelectionProperties {\n  data?: Data;\n  anchor: TextPoint | EdgePoint;\n  focus: TextPoint | EdgePoint;\n  marks?: Mark[] | null;\n}\n\nexport type RangeSelectionProperties = SelectionProperties;\n\nexport interface SelectionJSON {\n  data?: Data;\n  anchor: TextPointJSON | EdgePointJSON;\n  focus: TextPointJSON | EdgePointJSON;\n  marks?: MarkJSON[] | null;\n}\n\nexport type RangeSelectionJSON = SelectionJSON;\n\ntype Mover = (selection: Selection) => Selection;\n\ntype PointMoverCreator = (pn: SupportPointName, n: number) => Mover;\n\nconst IS_COLLAPSED_CACHE = new WeakMap<Selection, boolean>();\nconst IS_FORWARD_CACHE = new WeakMap<Selection, WeakMap<Document, boolean>>();\n\nexport default class Selection extends ImmutableRecord\n  implements Serializable<SelectionJSON> {\n  static create(\n    props: Selection | SelectionProperties,\n  ): Selection {\n    if (Selection.isSelection(props)) {\n      return props;\n    }\n\n    if (isPlainObject(props)) {\n      const { data = {}, anchor, focus, marks } = props;\n      return new Selection({\n        data,\n        anchor: Point.create(anchor),\n        focus: Point.create(focus),\n        marks: marks ? marks.map(mark => Mark.create(mark)) : null,\n      });\n    }\n\n    throw new Error(\n      `\\`Selection.create\\` only accepts objects or range selections, but you passed it: ${props}`,\n    );\n  }\n\n  /**\n   * 调整range的开始位置和结束位置，使其\"收缩\"到最小的位置， 如果ignoreEnd的值为true，则忽略对结束位置的调整\n   * @param document\n   * @param ignoreEnd 如果ignoreEnd的值为true，则忽略对结束位置的调整\n   * @example\n   * before:1234<anchor/><link>56<focus/>78</link>90\n   * after:1234<link><anchor/>56<focus/>78</link>90\n   */\n  public shrinkBoundary(document: Document, ignoreEnd?: boolean) {\n    const start = this.getStart(document);\n    const end = this.getEnd(document);\n    if (!start.isTextPoint() || !end.isTextPoint()) {\n      return this;\n    }\n    const isForward = this.isForward(document);\n    let targetRange: Selection = this;\n    if (!ignoreEnd && end.offset === 0) {\n      const targetEndText = document.getPreviousText(end.key);\n      if (targetEndText) {\n        targetRange = targetRange.set(\n          isForward ? 'focus' : 'anchor',\n          TextPoint.fromJSON({\n            key: targetEndText.key,\n            offset: targetEndText.text.length,\n          }),\n        );\n      }\n    }\n\n    const beforeStartText = document.getNode(start.key);\n    if (beforeStartText && start.offset === beforeStartText.text.length) {\n      const targetStartText = document.getNextText(start.key);\n      if (targetStartText) {\n        targetRange = targetRange.set(\n          isForward ? 'anchor' : 'focus',\n          Point.fromJSON({ key: targetStartText.key, offset: 0 }),\n        );\n      }\n    }\n    return targetRange;\n  }\n\n  static fromJSON(json: SelectionJSON) {\n    const { data, anchor, focus, marks } = json;\n    return Selection.create({\n      data,\n      anchor: Point.fromJSON(anchor),\n      focus: Point.fromJSON(focus),\n      marks: marks ? marks.map(mark => Mark.fromJSON(mark)) : null,\n    });\n  }\n\n  static isSelection(\n    maybeSelection: any,\n  ): maybeSelection is Selection {\n    return maybeSelection instanceof Selection;\n  }\n\n  static isRangeSelection(\n    maybeSelection: any,\n  ): maybeSelection is Selection {\n    return Selection.isSelection(maybeSelection);\n  }\n\n  static isValidSelection(document: Document, selection: any) {\n    if (!Selection.isSelection(selection)) {\n      return false;\n    }\n    const { anchor, focus } = selection;\n    const anchorNode = document.getNode(anchor.key);\n    const focusNode = document.getNode(focus.key);\n    if (!anchorNode || !focusNode) {\n      return false;\n    }\n    const isAnchorValid =\n      (anchor.isTextPoint() &&\n        anchor.offset >= 0 &&\n        anchor.offset <= anchorNode.text.length) ||\n      anchor.isEdgePoint();\n    const isFocusValid =\n      (focus.isTextPoint() &&\n        focus.offset >= 0 &&\n        focus.offset <= focusNode.text.length) ||\n      focus.isEdgePoint();\n    return isAnchorValid && isFocusValid;\n  }\n\n  static isValidRangeSelection(document: Document, selection: any) {\n    return Selection.isValidSelection(document, selection);\n  }\n\n  static selectWordAtPoint(document: Document, point: TextPoint | EdgePoint) {\n    if (point.isEdgePoint()) {\n      return Selection.create({\n        anchor: point.set('edge', EdgePoint.BEFORE),\n        focus: point.set('edge', EdgePoint.AFTER),\n      });\n    }\n    const text = document.getNode(point.key);\n    if (!text) {\n      return null;\n    }\n\n    const [start, end] = textUtils.getWordRange(text.text, point.offset);\n    return Selection.create({\n      anchor: point.set('offset', start),\n      focus: point.set('offset', end),\n    });\n  }\n\n  static isEqual(rangSelection: Selection, target: Selection) {\n    return (\n      equal(rangSelection.anchor, target.anchor) &&\n      equal(rangSelection.focus, target.focus)\n    );\n  }\n\n  public readonly data: Data;\n\n  public readonly anchor: TextPoint | EdgePoint;\n\n  public readonly focus: TextPoint | EdgePoint;\n\n  public readonly marks: Mark[] | null;\n\n  protected constructor(props: Required<SelectionProperties>) {\n    super();\n    const { data, anchor, focus, marks = null } = props;\n    this.data = data;\n    this.anchor = anchor;\n    this.focus = focus;\n    this.marks = marks;\n    this.freeze();\n  }\n\n  /**\n   * 选区是否指向同一个位置（caret）\n   */\n  public get isCollapsed() {\n    if (!IS_COLLAPSED_CACHE.has(this)) {\n      const { anchor, focus } = this;\n      IS_COLLAPSED_CACHE.set(this, equal(anchor, focus));\n    }\n    return IS_COLLAPSED_CACHE.get(this)!;\n  }\n\n  /**\n   * 选区是否是扩展\n   */\n  public get isExpanded() {\n    return !this.isCollapsed;\n  }\n\n  public get viewKey() {\n    const keyStr = `${this.anchor.viewKey}_${this.focus.viewKey}`;\n    try {\n      return `${keyStr}_${JSON.stringify(this.data)}`;\n    } catch (error) {\n      return keyStr;\n    }\n  }\n\n  public get plainViewKey() {\n    return `${this.anchor.viewKey}_${this.focus.viewKey}`;\n  }\n\n  public merge(props: Partial<SelectionProperties>) {\n    return new Selection({\n      data: this.data,\n      anchor: this.anchor,\n      focus: this.focus,\n      marks: this.marks,\n      ...props,\n    });\n  }\n\n  public set<T extends keyof SelectionProperties>(\n    key: T,\n    value: SelectionProperties[T],\n  ) {\n    return this.merge({\n      [key]: value,\n    });\n  }\n\n  private isForwardInDocument(document: Document) {\n    const { anchor, focus } = this;\n    // same node\n    if (anchor.key === focus.key) {\n      if (anchor.isEdgePoint()) {\n        return anchor.edge === EdgePoint.BEFORE;\n      }\n      if (focus.isEdgePoint()) {\n        return focus.edge === EdgePoint.AFTER;\n      }\n      return anchor.offset <= focus.offset;\n    }\n\n    // parent-child\n    if (anchor.isEdgePoint()) {\n      const anchorNode = document.getNode(anchor.key);\n      if (anchorNode?.isElement() && anchorNode.getNode(focus.key)) {\n        return anchor.edge === EdgePoint.BEFORE;\n      }\n    }\n    if (focus.isEdgePoint()) {\n      const focusNode = document.getNode(focus.key);\n      if (focusNode?.isElement() && focusNode.getNode(anchor.key)) {\n        return focus.edge === EdgePoint.AFTER;\n      }\n    }\n\n    // other relationship\n    const anchorPath = anchor.getPathIn(document);\n    const focusPath = focus.getPathIn(document);\n    return Boolean(anchorPath && focusPath && Path.isBefore(anchorPath, focusPath));\n  }\n\n  /**\n   * 选区是不是正序的（anchor在前，focus在后）\n   */\n  public isForward(document: Document) {\n    if (!IS_FORWARD_CACHE.has(this)) {\n      IS_FORWARD_CACHE.set(this, new WeakMap());\n    }\n    const DOCUMENT_TO_IS_FORWARD_CACHE = IS_FORWARD_CACHE.get(this)!;\n    if (!DOCUMENT_TO_IS_FORWARD_CACHE.has(document)) {\n      DOCUMENT_TO_IS_FORWARD_CACHE.set(document, this.isForwardInDocument(document));\n    }\n    return DOCUMENT_TO_IS_FORWARD_CACHE.get(document)!;\n  }\n\n  /**\n   * 选区是不是倒序的（anchor在后，focus在前）\n   */\n  public isBackward(document: Document) {\n    return !this.isForward(document);\n  }\n\n  /**\n   * 获取start point\n   */\n  public getStart(document: Document) {\n    return this.isForward(document) ? this.anchor : this.focus;\n  }\n\n  /**\n   * 获取end point\n   */\n  public getEnd(document: Document) {\n    return this.isBackward(document) ? this.anchor : this.focus;\n  }\n\n  /**\n   * 根据PointName，获取point\n   */\n  public getPoint(pointName: SupportPointName, document: Document) {\n    if (pointName === 'start') {\n      return this.getStart(document);\n    } else if (pointName === 'end') {\n      return this.getEnd(document);\n    } else {\n      return this[pointName];\n    }\n  }\n\n  /**\n   * 同时获取start point、end point\n   */\n  public sort(document: Document) {\n    return {\n      start: this.getStart(document),\n      end: this.getEnd(document),\n    };\n  }\n\n  /**\n   * 把当前的数据选区的 Points 转换成 TextPoints。\n   */\n  public convertToTextPoints(document: Document) {\n    let { start, end } = this.sort(document);\n    if (this.isCollapsed) {\n      const point = start.convertToTextPoint(document);\n      return { anchor: point, focus: point, start: point, end: point };\n    }\n    if (start.isEdgePoint()) {\n      if (start.edge === EdgePoint.BEFORE) {\n        start = start.convertToTextPoint(document);\n      } else {\n        const startNode = document.getNextText(start.key) || document.getFirstNode();\n        start = TextPoint.create({\n          key: startNode.key,\n          offset: 0,\n        });\n      }\n    }\n    if (end.isEdgePoint()) {\n      if (end.edge === EdgePoint.AFTER) {\n        end = end.convertToTextPoint(document);\n      } else {\n        const endNode = document.getPreviousText(end.key) || document.getLastNode();\n        end = TextPoint.create({\n          key: endNode.key,\n          offset: endNode.text.length,\n        });\n      }\n    }\n    const isForward = this.isForward(document);\n    const anchor = isForward ? start : end;\n    const focus = isForward ? end : start;\n    return { anchor, focus, start, end };\n  }\n\n  /**\n   * 获得当前选区所处的 Node\n   * @param document\n   */\n  public getClosestNode(document: Document) {\n    const { start, end } = this.convertToTextPoints(document);\n    const aPath = document.getPath(start.key);\n    const bPath = document.getPath(end.key);\n    if (!aPath || !bPath) {\n      return null;\n    }\n    const node = document.getNodeByPath(Path.common(aPath, bPath));\n    if (node?.isText()) {\n      return document.getClosestBlock(node.key);\n    }\n    return node as Block | null;\n  }\n\n  /**\n   * 选区是否在Hanging状态\n   */\n  public get isHanging() {\n    return Boolean(this.data.isHanging);\n  }\n\n  public get isCollapsedAtEdge() {\n    return this.isCollapsed && this.anchor.isEdgePoint();\n  }\n\n  /**\n   * 拷贝出一个新的选区，并设置选区的Haning状态\n   */\n  public setHanging(isHanging: boolean) {\n    if (this.data.isHanging !== isHanging) {\n      return this.merge({\n        data: {\n          ...this.data,\n          isHanging,\n        },\n      });\n    }\n    return this;\n  }\n\n  /**\n   * 拷贝出一个新的选区，并把start point移到end point的位置\n   */\n  public moveToEnd(document: Document) {\n    if (this.isBackward(document)) {\n      return this.merge({\n        focus: this.getEnd(document),\n      });\n    }\n    return this.merge({\n      anchor: this.getEnd(document),\n    });\n  }\n\n  public moveStartToStartOfNode(node: Node, controller: Controller) {\n    const { document } = controller.value;\n    if (this.isForward(document)) {\n      return this.moveAnchorToStartOfNode(node, controller);\n    } else {\n      return this.moveFocusToStartOfNode(node, controller);\n    }\n  }\n\n  public moveStartToEndOfNode(node: Node, controller: Controller) {\n    const { document } = controller.value;\n    if (this.isForward(document)) {\n      return this.moveAnchorToEndOfNode(node, controller);\n    } else {\n      return this.moveFocusToEndOfNode(node, controller);\n    }\n  }\n\n  public moveEndToStartOfNode(node: Node, controller: Controller) {\n    const { document } = controller.value;\n    if (this.isForward(document)) {\n      return this.moveFocusToStartOfNode(node, controller);\n    } else {\n      return this.moveAnchorToStartOfNode(node, controller);\n    }\n  }\n\n  public moveEndToEndOfNode(node: Node, controller: Controller) {\n    const { document } = controller.value;\n    if (this.isForward(document)) {\n      return this.moveFocusToEndOfNode(node, controller);\n    } else {\n      return this.moveAnchorToEndOfNode(node, controller);\n    }\n  }\n\n  public moveAnchorToStartOfNode(node: Node, controller: Controller) {\n    return this.set('anchor', controller.query(pointAtStartOfNode, node));\n  }\n\n  public moveAnchorToEndOfNode(node: Node, controller: Controller) {\n    return this.set('anchor', controller.query(pointAtEndOfNode, node));\n  }\n\n  public moveFocusToStartOfNode(node: Node, controller: Controller) {\n    return this.set('focus', controller.query(pointAtStartOfNode, node));\n  }\n\n  public moveFocusToEndOfNode(node: Node, controller: Controller) {\n    return this.set('focus', controller.query(pointAtEndOfNode, node));\n  }\n\n  public moveAnchorTo(key: string, where: number | PointEdge) {\n    return this.set('anchor', Point.createFromParams(key, where));\n  }\n\n  public moveFocusTo(key: string, where: number | PointEdge) {\n    return this.set('focus', Point.createFromParams(key, where));\n  }\n\n  public moveToStartOfNode(node: Node, controller: Controller) {\n    const anchor = controller.query(pointAtStartOfNode, node);\n    const focus = anchor;\n    return this.merge({ anchor, focus });\n  }\n\n  public moveToEndOfNode(node: Node, controller: Controller) {\n    const anchor = controller.query(pointAtEndOfNode, node);\n    const focus = anchor;\n    return this.merge({ anchor, focus });\n  }\n\n  /**\n   * 拷贝出一个新的选区，并把anchor和focus调换位置\n   */\n  public flip() {\n    return this.merge({\n      anchor: this.focus,\n      focus: this.anchor,\n    });\n  }\n\n  public moveAnchorBackward(n = 1, mover?: PointMoverCreator) {\n    return mover\n      ? mover('anchor', n)(this)\n      : this.set('anchor', this.anchor.moveBackward(n));\n  }\n\n  public moveAnchorForward(n = 1, mover?: PointMoverCreator) {\n    return mover\n      ? mover('anchor', n)(this)\n      : this.set('anchor', this.anchor.moveForward(n));\n  }\n\n  public moveFocusBackward(n = 1, mover?: PointMoverCreator) {\n    return mover\n      ? mover('focus', n)(this)\n      : this.set('focus', this.focus.moveBackward(n));\n  }\n\n  public moveFocusForward(n = 1, mover?: PointMoverCreator) {\n    return mover\n      ? mover('focus', n)(this)\n      : this.set('focus', this.focus.moveForward(n));\n  }\n\n  public moveToFocus() {\n    return this.set('anchor', this.focus);\n  }\n\n  public moveToAnchor() {\n    return this.set('focus', this.anchor);\n  }\n\n  public moveToStart(document: Document) {\n    const start = this.getStart(document);\n    return this.merge({\n      anchor: start,\n      focus: start,\n    });\n  }\n\n  public moveToRangeOfNode(node: Node, controller: Controller) {\n    return this.moveAnchorToStartOfNode(node, controller).moveFocusToEndOfNode(\n      node,\n      controller,\n    );\n  }\n\n  public moveForward(n = 1, mover?: PointMoverCreator) {\n    if (!mover) {\n      return this.updatePoints((point: TextPoint | EdgePoint) => {\n        return point.isTextPoint() ? point.moveForward(n) : point;\n      });\n    }\n    return this.moveAnchorForward(n, mover).moveFocusForward(n, mover);\n  }\n\n  public moveStartBackward(document: Document, n: number) {\n    if (this.isForward(document)) {\n      return this.moveAnchorBackward(n);\n    }\n    return this.moveFocusBackward(n);\n  }\n\n  public moveStartForward(document: Document, n: number) {\n    return this.moveStartBackward(document, -n);\n  }\n\n  public moveEndBackward(document: Document, n: number) {\n    if (this.isForward(document)) {\n      return this.moveFocusBackward(n);\n    }\n    return this.moveAnchorBackward(n);\n  }\n\n  public moveEndForward(document: Document, n: number) {\n    return this.moveEndBackward(document, -n);\n  }\n\n  public moveBackward(n = 1, mover?: PointMoverCreator) {\n    if (!mover) {\n      return this.updatePoints((point: TextPoint | EdgePoint) => {\n        return point.isTextPoint() ? point.moveBackward(n) : point;\n      });\n    }\n    return this.moveAnchorBackward(n, mover).moveFocusBackward(n, mover);\n  }\n\n  public move(mover: Mover) {\n    return mover(this);\n  }\n\n  public moveToStartOfDocument(controller: Controller) {\n    return this.moveToStartOfNode(controller.value.document, controller);\n  }\n\n  public moveToEndOfDocument(controller: Controller) {\n    return this.moveToEndOfNode(controller.value.document, controller);\n  }\n\n  public movePointEdgeKlass(\n    controller: Controller,\n    pointName: SupportPointName,\n    edge: SupportEdge,\n    klass: SupportKlass,\n  ) {\n    const { document } = controller.value;\n    const PName = pointName.slice(0, 1).toUpperCase() + pointName.slice(1);\n    const Edge = edge.slice(0, 1).toUpperCase() + edge.slice(1);\n    const Object = klass.slice(0, 1).toUpperCase() + klass.slice(1);\n    const method = `move${PName}To${Edge}OfNode`;\n    const getNode = klass === 'text' ? 'getNode' : `getClosest${Object}`;\n    const p = this.getPoint(pointName, document);\n    const node = p.isTextPoint() ? document[getNode](p.key) : document.getNode(p.key);\n    if (!node) {\n      return this;\n    }\n    const newSelection = this[method](node, controller) as Selection;\n    return newSelection;\n  }\n\n  public movePointEdgeSideKlass(\n    controller: Controller,\n    pointName: SupportPointName,\n    edge: SupportEdge,\n    side: SupportSide,\n    klass: SupportKlass,\n  ) {\n    const { document } = controller.value;\n    const PName = pointName.slice(0, 1).toUpperCase() + pointName.slice(1);\n    const Edge = edge.slice(0, 1).toUpperCase() + edge.slice(1);\n    const Side = side.slice(0, 1).toUpperCase() + side.slice(1);\n    const Klass = klass.slice(0, 1).toUpperCase() + klass.slice(1);\n    const method = `move${PName}To${Edge}OfNode`;\n    const getNode = klass === 'text' ? 'getNode' : `getClosest${Klass}`;\n    const getDirectionNode = `get${Side}${Klass}`;\n    const p = this.getPoint(pointName, document);\n\n    const node = document[getNode](p.key);\n    if (!node) {\n      return this;\n    }\n    const target = document[getDirectionNode](node.key);\n    if (!target) {\n      return this;\n    }\n    const newSelection = this[method](target, controller) as Selection;\n    return newSelection;\n  }\n\n  public updatePoints(\n    updater: (point: TextPoint | EdgePoint) => TextPoint | EdgePoint,\n  ) {\n    let { anchor, focus } = this;\n    anchor = updater(anchor);\n    focus = updater(focus);\n    return this.merge({ anchor, focus });\n  }\n\n  public toJSON(options?: SerializeOptions) {\n    return {\n      klass: 'selection',\n      anchor: this.anchor.toJSON(options),\n      focus: this.focus.toJSON(options),\n      marks: this.marks ? this.marks.map(m => m.toJSON()) : null,\n    };\n  }\n}\n","/**\n * @packageDocumentation\n * @module Models\n */\nimport isPlainObject from 'is-plain-object';\nimport Element, { ElementProperties } from './element';\nimport Node from './node';\nimport Block, { BlockJSON } from './block';\nimport Inline from './inline';\nimport Text from './text';\nimport Mark from './mark';\nimport Path from './path';\nimport Selection from './selection';\nimport Controller from '../controller/index';\nimport { SerializeOptions } from '../interfaces/serializable';\nimport Data from '../interfaces/data';\nimport setUtils from '../utils/setUtils';\nimport keyUtils from '../utils/keyUtils';\nimport { EdgePoint } from './point';\n\nexport interface DocumentProperties extends ElementProperties {\n  nodes?: Block[];\n}\n\nexport interface DocumentJSON {\n  klass?: 'document';\n  key?: string;\n  data?: Data;\n  nodes?: BlockJSON[];\n}\n\nexport default class Document extends Element {\n  static create(props: Document | DocumentProperties = {}): Document {\n    if (Document.isDocument(props)) {\n      return props;\n    }\n\n    if (isPlainObject(props)) {\n      const {\n        key = keyUtils.create(),\n        data = {},\n        nodes = [],\n      } = props;\n      return new Document({\n        key,\n        data,\n        nodes,\n      });\n    }\n\n    throw new Error(\n      `\\`Document.create\\` only accepts objects or documents, but you passed it: ${props}`,\n    );\n  }\n\n  static fromJSON(json: DocumentJSON) {\n    return Document.create({\n      ...json,\n      nodes: json.nodes ? json.nodes.map(Block.fromJSON) : [],\n    });\n  }\n\n  static isDocument(maybeDocument: any): maybeDocument is Document {\n    return maybeDocument instanceof Document;\n  }\n\n  protected constructor(props: Required<DocumentProperties>) {\n    super(props);\n    const { nodes } = props;\n    this.nodes = nodes;\n  }\n\n  public readonly type: string = 'document';\n\n  public readonly nodes: Block[];\n\n  public merge(props: Partial<DocumentProperties>) {\n    return new Document({\n      key: this.key,\n      data: this.data,\n      nodes: this.nodes,\n      ...props,\n    });\n  }\n\n  public set<T extends keyof DocumentProperties>(\n    key: T,\n    value: Required<DocumentProperties>[T],\n  ) {\n    return this.merge({\n      [key]: value,\n    });\n  }\n\n  /**\n   * 获取selection内对应的所有marks\n   */\n  public getMarksAtRange(range: Selection) {\n    if (range.isCollapsed && range.anchor.isEdgePoint()) {\n      return [];\n    }\n    const { start, end } = range.convertToTextPoints(this);\n    if (range.isCollapsed) {\n      return this.getMarksAtPosition(start.key, start.offset);\n    }\n\n    if (start.key === end.key) {\n      const startText = this.getNode(start.key);\n      return Text.isText(startText)\n        ? startText.getMarksBetweenOffsets(start.offset, end.offset)\n        : [];\n    }\n\n    const texts = this.getTextsBetweenPositions(start.key, end.key);\n    return texts.reduce<Mark[]>((marks, text) => {\n      if (text.key === start.key) {\n        return setUtils.union(\n          marks,\n          text.getMarksBetweenOffsets(start.offset, text.text.length),\n        );\n      }\n      if (text.key === end.key) {\n        return setUtils.union(\n          marks,\n          text.getMarksBetweenOffsets(0, end.offset),\n        );\n      }\n      return setUtils.union(marks, text.getMarks());\n    }, []);\n  }\n\n  /**\n   * 获取selection内对应的所有公共marks\n   */\n  public getActiveMarksAtRange(range: Selection) {\n    if (range.isCollapsed && range.anchor.isEdgePoint()) {\n      return [];\n    }\n    if (!Selection.isValidSelection(this, range)) {\n      return [];\n    }\n    const { start, end } = range.convertToTextPoints(this);\n    if (range.isCollapsed) {\n      return this.getMarksAtPosition(start.key, start.offset);\n    }\n\n    const startNode = this.getNode(start.key);\n    let startText = startNode?.isText() ? startNode : null;\n    if (!startText) {\n      return [];\n    }\n\n    let startKey = start.key;\n    let startOffset = start.offset;\n    let endKey = end.key;\n    let endOffset = end.offset;\n\n    if (startKey === endKey) {\n      return startText.getActiveMarksBetweenOffsets(startOffset, endOffset);\n    }\n\n    while (startKey !== endKey && endOffset === 0) {\n      const endText = this.getPreviousText(endKey);\n      if (!endText) {\n        return [];\n      }\n      endKey = endText.key;\n      endOffset = endText.text.length;\n    }\n\n    while (startKey !== endKey && startOffset === startText.text.length) {\n      startText = this.getNextText(startKey);\n      if (!startText) {\n        return [];\n      }\n      startKey = startText.key;\n      startOffset = 0;\n    }\n\n    const startMarks = startText.getActiveMarksBetweenOffsets(\n      startOffset,\n      startText.text.length,\n    );\n    if (startMarks.length === 0) return [];\n    const endText = this.getNode(endKey);\n    const endMarks = endText?.isText()\n      ? endText.getActiveMarksBetweenOffsets(0, endOffset)\n      : [];\n    let marks = setUtils.intersect(startMarks, endMarks);\n    // If marks is already empty, the active marks is empty\n    if (marks.length === 0) return marks;\n\n    if (startKey === endKey) return marks;\n\n    let text = this.getNextText(startKey);\n\n    while (text && text.key !== endKey) {\n      if (text.text.length !== 0) {\n        marks = setUtils.intersect(marks, text.getActiveMarks());\n        if (marks.length === 0) return [];\n      }\n\n      text = this.getNextText(text.key);\n    }\n    return marks;\n  }\n\n  public getMarksAtPosition(key: string, offset: number) {\n    const text = this.getNode(key);\n    const currentMarks = !text?.isText() ? [] : text.getMarksAtIndex(offset);\n    if (offset !== 0) {\n      return currentMarks;\n    }\n\n    const closestBlock = this.getClosestBlock(key);\n    if (!closestBlock || closestBlock.text === '') {\n      // Insert mark for empty block; the empty block are often created by split node or add marks in a range including empty blocks\n      return currentMarks;\n    }\n\n    const previous = this.getPreviousText(key);\n    if (previous && closestBlock.getNode(previous.key)) {\n      return previous.getMarksAtIndex(previous.text.length);\n    }\n\n    return currentMarks;\n  }\n\n  /**\n   * 获取插入点对应的marks\n   * 如果选区是collapse的，返回插入位置的marks;\n   * 如果插入位置在新的text节点，则尝试获取同一block的前一个text对应的mark；\n   * 如果选区是expand，则返回start位置对应的marks\n   */\n  public getInsertMarksAtRange(range: Selection) {\n    if (range.isCollapsed && range.anchor.isEdgePoint()) {\n      return [];\n    }\n    const { start } = range.convertToTextPoints(this);\n    if (range.isCollapsed) {\n      return this.getMarksAtPosition(start.key, start.offset);\n    }\n\n    const text = this.getNode(start.key);\n    return !text?.isText() ? [] : text.getMarksAtIndex(start.offset + 1);\n  }\n\n  public getNodesAtRange(range?: Selection) {\n    if (!range) {\n      return [];\n    }\n    const doc = this;\n    const start = range.getStart(doc);\n    const end = range.getEnd(doc);\n\n    const startPath = this.getPath(start.key)!;\n    const endPath = this.getPath(end.key)!;\n\n    const startIndex = startPath[0];\n    const endIndex = endPath[0];\n    const startBlock = this.nodes[startIndex];\n    const endBlock = this.nodes[endIndex];\n\n    const result: Node[] = [];\n\n    function push(node: Node) {\n      result.push(node);\n      if (Block.isBlock(node) || Inline.isInline(node)) {\n        node.nodes.forEach(push);\n      }\n    }\n\n    function pushEdgeNode(node: Node) {\n      const path = doc.getPath(node.key)!;\n\n      if (\n        Path.isEqual(path, startPath) ||\n        Path.isAncestor(path, startPath) ||\n        Path.isAncestor(startPath, path) ||\n        Path.isEqual(path, endPath) ||\n        Path.isAncestor(path, endPath) ||\n        Path.isAncestor(endPath, path) ||\n        (!range!.isCollapsed &&\n          Path.isAfter(path, startPath) &&\n          Path.isBefore(path, endPath))\n      ) {\n        result.push(node);\n        if (Block.isBlock(node) || Inline.isInline(node)) {\n          node.nodes.forEach(pushEdgeNode);\n        }\n      }\n    }\n\n    // Push the nodes in start path\n    result.push(startBlock);\n    startBlock.nodes.forEach(pushEdgeNode);\n\n    if (startIndex === endIndex) {\n      return result;\n    }\n\n    // Push the nodes between start and end\n    this.nodes.slice(startIndex + 1, endIndex).forEach((node) => {\n      push(node);\n    });\n\n    // Push the nodes in end path\n    result.push(endBlock);\n    endBlock.nodes.forEach(pushEdgeNode);\n    return result;\n  }\n\n  /**\n   * 获取最近的支持 edge 选择的 block 节点。\n   * 如果 key 对应的节点满足条件，会直接返回此节点。\n   */\n  public getClosestSelectableBlock(key: string, controller: Controller) {\n    let ans = this.getAncestors(key);\n    const n = this.getNode(key);\n    if (n?.isElement()) {\n      ans.push(n);\n    }\n    ans = ans.reverse();\n    for (const node of ans) {\n      if (controller.query('isEdgeSelectable', node)) {\n        return node;\n      } else if (node.isBlock() && controller.query('isVoid', node)) {\n        return node;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * 获取 rootKey 节点下距离 key 最远的支持 edge 选择的 block 节点。\n   * 如果 key 对应的节点满足条件，也会返回此节点。\n   */\n  public getFurthestSelectableBlock(key: string, rootKey: string, controller: Controller) {\n    const ans = this.getAncestors(key);\n    const n = this.getNode(key);\n    if (n?.isElement()) {\n      ans.push(n);\n    }\n    const rootIndex = ans.findIndex((node) => node.key === rootKey);\n    if (rootIndex === -1) {\n      return null;\n    }\n    for (let i = rootIndex; i < ans.length; i++) {\n      const node = ans[i];\n      if (controller.query('isEdgeSelectable', node)) {\n        return node;\n      } else if (node.isBlock() && controller.query('isVoid', node)) {\n        return node;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * 获取最近的Void父节点\n   */\n  public getClosestVoid(key: string, controller: Controller) {\n    const path = this.getPath(key);\n    if (!path) {\n      return null;\n    }\n\n    return this.getClosestVoidByPath(path, controller);\n  }\n\n  /**\n   * 获取最近的Void父节点\n   */\n  private getClosestVoidByPath(path: Path, controller: Controller) {\n    return this.getClosestByPath(path, (node) => {\n      return controller.query('isVoid', node) as boolean;\n    });\n  }\n\n  /**\n   * 是否有一个Void父节点\n   */\n  public hasVoidParent(key: string, controller: Controller) {\n    const path = this.getPath(key);\n    if (!path) {\n      return false;\n    }\n    return this.hasVoidParentByPath(path, controller);\n  }\n\n  private hasVoidParentByPath(path: Path, controller: Controller) {\n    const closest = this.getClosestVoidByPath(path, controller);\n    return !!closest;\n  }\n\n  /**\n   * 获取最顶层的一个Void节点\n   */\n  public getFurthsestVoid(key: string, controller: Controller) {\n    return this.getFurthsest(\n      key,\n      (node) => controller.query('isVoid', node) as boolean,\n    );\n  }\n\n  /**\n   * 根据选区，获取一个fragment\n   */\n  public getFragmentAtRange(range: Selection, controller?: Controller) {\n    const { start, end } = range.convertToTextPoints(this);\n    const startTextPath = this.getPath(start.key);\n    const endTextPath = this.getPath(end.key);\n    if (!startTextPath || !endTextPath) {\n      return Document.create();\n    }\n    const startVoid =\n      controller && this.getClosestVoidByPath(startTextPath, controller);\n    const endVoid =\n      controller && this.getClosestVoidByPath(endTextPath, controller);\n    const startPath = startVoid\n      ? this.assertPath(startVoid.key)\n      : startTextPath;\n    const endPath = endVoid ? this.assertPath(endVoid.key) : endTextPath;\n\n    let node = this;\n    let targetPath = endPath;\n    let targetPosition = endVoid ? endVoid.nodes.length : end.offset;\n    let mode = 'end';\n    while (targetPath.length) {\n      const index = targetPath[targetPath.length - 1];\n      node = node.splitNode(targetPath, targetPosition);\n      targetPath = Path.parent(targetPath);\n      targetPosition = index + 1;\n\n      if (!targetPath.length && mode === 'end') {\n        targetPath = startPath;\n        targetPosition = startVoid ? 0 : start.offset;\n        mode = 'start';\n      }\n    }\n\n    const startIndex = startPath[0] + 1;\n    const endIndex = endPath[0] + 2;\n    const nodes = node.nodes.slice(startIndex, endIndex);\n    // @ts-ignore\n    return Document.create({ nodes });\n  }\n\n  /**\n   * 获取特定区间的所有叶子block\n   */\n  public getLeafBlocksAtRange(range: Selection): Block[] {\n    const { start, end } = range.convertToTextPoints(this);\n    const startBlock = this.getClosestBlockFromPoint(start.key);\n\n    // PERF: the most common case is when the range is in a single block node,\n    // where we can avoid a lot of iterating of the tree.\n    if (start.key === end.key) {\n      return [startBlock!];\n    }\n\n    const endBlock = this.getClosestBlockFromPoint(end.key);\n    const blocks = this.getBlocks();\n    const startIndex = blocks.indexOf(startBlock!);\n    const endIndex = blocks.indexOf(endBlock!);\n    return blocks.slice(startIndex, endIndex + 1);\n  }\n\n  /**\n   * 循环获取document下的所有叶子blocks节点\n   */\n  public getBlocks() {\n    return Block.getBlocks(this.nodes);\n  }\n\n  /**\n   * 循环获取document下的所有叶子blocks节点\n   */\n  public getBlocksByType(type: string) {\n    return Block.getBlocksByType(this.nodes, type);\n  }\n\n  /**\n   * 循环获取document下的特定区间内的全部blocks节点\n   */\n  public getRootBlocksAtRange(range?: Selection): Block[] {\n    if (!range) {\n      return [];\n    }\n    const { start, end } = range.convertToTextPoints(this);\n\n    const startBlock = this.getFurthsestBlock(start.key);\n    if (!startBlock) {\n      return [];\n    }\n    if (start.key === end.key) {\n      return [startBlock];\n    }\n\n    const endBlock = this.getFurthsestBlock(end.key);\n    if (!endBlock) {\n      return [];\n    }\n    return this.nodes.slice(\n      this.nodes.indexOf(startBlock),\n      this.nodes.indexOf(endBlock) + 1,\n    );\n  }\n\n  /**\n   * 判断节点是否在Selection之内\n   */\n  public isNodeInRange(key: string, range: Selection) {\n    const path = this.getPath(key);\n    if (!path) {\n      return false;\n    }\n    return this.isNodeInRangeByPath(path, range);\n  }\n\n  /**\n   * 判断节点是否在Selection之内\n   */\n  public isNodeInRangeByPath(path: Path, range: Selection) {\n    if (!range || range.isCollapsedAtEdge) {\n      return false;\n    }\n    const { start, end } = range.sort(this);\n    const startPath = start.getPathIn(this);\n    const endPath = end.getPathIn(this);\n\n    // we cannot trust the selection\n    if (!startPath || !endPath) {\n      return false;\n    }\n\n    // edge cases\n    if (\n      start.isEdgePoint() &&\n      start.edge === EdgePoint.AFTER &&\n      (Path.isEqual(startPath, path) || Path.isAncestor(startPath, path))\n    ) {\n      return false;\n    }\n    if (\n      end.isEdgePoint() &&\n      end.edge === EdgePoint.BEFORE &&\n      (Path.isEqual(endPath, path) || Path.isAncestor(endPath, path))\n    ) {\n      return false;\n    }\n\n    const isBeforeStart = Path.compare(path, startPath) === -1;\n    const isAfterEnd = Path.compare(path, endPath) === 1;\n    return !isBeforeStart && !isAfterEnd;\n  }\n\n  /**\n   * 获取Selection内所有的Text节点\n   */\n  public getTextsAtRange(range: Selection): Text[] {\n    const { start, end } = range.convertToTextPoints(this);\n    return this.getTextsBetweenPositions(start.key, end.key);\n  }\n\n  /**\n   * 获取Selection内所有的叶子Inline节点\n   */\n  public getLeafInlinesAtRange(range: Selection): Inline[] {\n    const array = this.getTextsAtRange(range)\n      .map((text) => this.getClosestInline(text.key))\n      .filter((exists): exists is Inline => Boolean(exists));\n\n    return array;\n  }\n\n  /**\n   * 获取Selection内的所有最远Inline节点\n   */\n  public getRootInlinesAtRange(range?: Selection): Inline[] {\n    if (!range) {\n      return [];\n    }\n\n    const array = this.getTextsAtRange(range)\n      .map((text) => this.getFurthsestInline(text.key))\n      /* eslint-disable @typescript-eslint/indent */\n      .reduce<Inline[]>((inlines, inline) => {\n        if (inline && !inlines.includes(inline)) {\n          inlines.push(inline);\n        }\n        return inlines;\n      }, []);\n    /* eslint-enable @typescript-eslint/indent */\n\n    return array;\n  }\n\n  public toJSON(options?: SerializeOptions) {\n    const object: DocumentJSON = {\n      klass: 'document',\n      data: { ...this.data },\n      nodes: this.nodes.map((node) => node.toJSON(options)),\n    };\n\n    if (options?.preserveKeys) {\n      object.key = this.key;\n    }\n\n    return object;\n  }\n}\n","/**\n * @packageDocumentation\n * @module Models\n */\nimport isPlainObject from 'is-plain-object';\nimport Data from '../interfaces/data';\nimport ImmutableRecord from './immutableRecord';\nimport Node from './node';\nimport Element from './element';\n\nfunction defaultMergeData(a: Data, b: Data): Data {\n  return { ...a, ...b };\n}\n\nexport interface InjectionProperties<T extends Data = Data> {\n  key: string;\n  data: T;\n  mergeData?: typeof defaultMergeData;\n}\n\nexport interface InjectionJSON<T extends Data = Data> {\n  key: string;\n  data: T;\n}\n\nexport default class Injection<D extends Data = Data> extends ImmutableRecord {\n  static create<T extends Data = Data>(props: Injection<T> | InjectionProperties<T>) {\n    if (Injection.isInjection(props)) {\n      return props;\n    }\n\n    if (isPlainObject(props)) {\n      const { key, data, mergeData } = props;\n      return new Injection({\n        key,\n        data,\n        mergeData,\n      });\n    }\n\n    throw new Error(\n      `\\`Injection.create\\` only accepts objects or injections, but you passed it: ${props}`,\n    );\n  }\n\n  static isInjection(maybeInjection: any): maybeInjection is Injection {\n    return maybeInjection instanceof Injection;\n  }\n\n  static injectIntoNode(injections: Injection[], node: Node) {\n    if (!injections.length || !Element.isElement(node)) {\n      return node;\n    }\n    return injections.reduce((n, injection) => {\n      if (injection.key !== n.key) {\n        return n;\n      }\n      const { mergeData } = injection;\n      return n.set('data', mergeData(n.data, injection.data));\n    }, node);\n  }\n\n  static fromJSON(json: InjectionJSON) {\n    const { key, data } = json;\n    return Injection.create({\n      key, data,\n    });\n  }\n\n  constructor(props: InjectionProperties<D>) {\n    super();\n    const { key, data, mergeData = defaultMergeData } = props;\n    this.key = key;\n    this.data = data;\n    this.mergeData = mergeData;\n    this.freeze();\n  }\n\n  public readonly key: string;\n\n  public readonly data: D;\n\n  public readonly mergeData: typeof defaultMergeData;\n\n  public merge(props: Partial<InjectionProperties<D>>) {\n    return new Injection({\n      key: this.key,\n      data: this.data,\n      mergeData: this.mergeData,\n      ...props,\n    });\n  }\n\n  public set<T extends keyof InjectionProperties<D>>(\n    key: T,\n    value: InjectionProperties<D>[T],\n  ) {\n    return this.merge({\n      [key]: value,\n    });\n  }\n\n  public toJSON() {\n    return {\n      key: this.key,\n      data: this.data,\n    };\n  }\n}\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport { curry } from 'lodash-es';\nimport Controller from '../controller/index';\nimport Selection, { SupportPointName } from '../models/selection';\nimport Node from '../models/node';\nimport Element from '../models/element';\nimport Document from '../models/document';\nimport Path from '../models/path';\nimport { pointAtDistance, MoveUnit } from '../queries/selection';\n\nexport const movePointForward = curry(\n  (\n    controller: Controller,\n    pn: SupportPointName,\n    distance: number,\n    unit: MoveUnit,\n  ) => {\n    return (selection: Selection) => {\n      if (distance === 0) {\n        return selection;\n      }\n\n      const { document } = controller.value;\n\n      let pointName = pn;\n      if (pointName === 'start') {\n        pointName = selection.isForward(document) ? 'anchor' : 'focus';\n      } else if (pointName === 'end') {\n        pointName = selection.isForward(document) ? 'focus' : 'anchor';\n      }\n      const at = pointName === 'anchor' ? selection.anchor : selection.focus;\n\n      const point = controller.query(pointAtDistance, at, distance, unit);\n      return selection.set(pointName, point);\n    };\n  },\n);\n\nexport const movePointBackward = curry(\n  (\n    controller: Controller,\n    pn: SupportPointName,\n    distance: number,\n    unit: MoveUnit,\n  ) => {\n    return (selection: Selection) => {\n      const mover = movePointForward(controller, pn, -distance, unit);\n      return mover(selection);\n    };\n  },\n);\n\nexport const movePointWordBackward = movePointBackward(\n  curry.placeholder,\n  curry.placeholder,\n  1,\n  'word',\n);\n\nexport const movePointWordForward = movePointForward(\n  curry.placeholder,\n  curry.placeholder,\n  1,\n  'word',\n);\n\n/**\n * 选区是否包含整个 Element\n */\nexport const isSelectionContainsElement = (\n  selection: Selection | null,\n  element: Element,\n) => {\n  if (!selection || selection.isCollapsed) {\n    return false;\n  }\n  const { anchor, focus } = selection;\n  const anchorNode = element.getNode(anchor.key);\n  if (anchorNode && anchorNode !== element) return false;\n  const focusNode = element.getNode(focus.key);\n  if (focusNode && focusNode !== element) return false;\n  return true;\n};\n\n/**\n * 判断 `selection` 是否完全在 `node` 内部\n * @param node\n * @param document\n * @param selection\n * @returns\n */\n\nexport const isSelectionInNode = (\n  node: Node,\n  document: Document,\n  selection: Selection,\n) => {\n  const { start, end } = selection.sort(document);\n  if (Element.isElement(node)) {\n    if (\n      (start.isEdgePoint() && start.key === node.key) ||\n      (end.isEdgePoint() && end.key === node.key)\n    ) {\n      return false;\n    } else {\n      const { start: startText, end: endText } =\n        selection.convertToTextPoints(document);\n      return node.hasNode(startText.key) && node.hasNode(endText.key);\n    }\n  } else {\n    // Node is Text\n    return (\n      start.isTextPoint() &&\n      end.isTextPoint() &&\n      start.key === node.key &&\n      end.key === node.key\n    );\n  }\n};\n\nfunction getFirstDataElementPath(\n  document: Document,\n  view: Document,\n  viewElement: Element,\n): Path {\n  let start = viewElement.nodes[0];\n  while (!document.hasNode(start.key)) {\n    start = view.assertElement(start.key).nodes[0];\n  }\n\n  return document.assertPath(start.key);\n}\n\nfunction getLastDataElementPath(\n  document: Document,\n  view: Document,\n  viewElement: Element,\n): Path {\n  let end = viewElement.nodes[viewElement.nodes.length - 1];\n  while (!document.hasNode(end.key)) {\n    const endElement = view.assertElement(end.key);\n    end = endElement.nodes[endElement.nodes.length - 1];\n  }\n\n  return document.assertPath(end.key);\n}\n\n/**\n * 获得裁剪后的选区\n * @param controller\n * @param selection\n * @param visibles\n */\nexport function getCroppedSelection(\n  controller: Controller,\n  selection: Selection,\n  visibles: string[],\n): Selection | null {\n  if (!controller.enableVirtualize) {\n    return selection;\n  }\n  const { document } = controller.value;\n  const view = controller.view;\n  const validVisibles = visibles.filter(\n    (visible) => document.hasNode(visible) || view.hasNode(visible),\n  );\n\n  if (!validVisibles.length) {\n    return null;\n  } else {\n    const { start, end } = selection.convertToTextPoints(document);\n    const selectionStartPath = document.getPath(start.key);\n    const selectionEndPath = document.getPath(end.key);\n    if (!selectionStartPath || !selectionEndPath) {\n      return null;\n    } \n    const visibleStartKey = validVisibles[0]!;\n    const visibleEndKey = validVisibles[validVisibles.length - 1];\n\n    let visibleStart: number;\n    let visibleEnd: number;\n    if (document.hasNode(visibleStartKey)) {\n      visibleStart = document.assertPath(visibleStartKey)[0];\n    } else {\n      const viewElement = view.assertElement(visibleStartKey);\n      visibleStart = getFirstDataElementPath(document, view, viewElement)[0];\n    }\n\n    if (document.hasNode(visibleEndKey)) {\n      visibleEnd = document.assertPath(visibleEndKey)[0];\n    } else {\n      const viewElement = view.assertElement(visibleEndKey);\n      visibleEnd = getLastDataElementPath(document, view, viewElement)[0];\n    }\n\n    const selectionStart = selectionStartPath[0];\n    const selectionEnd = selectionEndPath[0];\n\n    if (selectionStart > visibleEnd || selectionEnd < visibleStart) {\n      return null;\n    }\n\n    let sel = selection;\n    if (selectionStart < visibleStart) {\n      sel = sel.moveStartToStartOfNode(\n        document.assertNodeByPath([visibleStart]),\n        controller,\n      );\n    }\n\n    if (selectionEnd > visibleEnd) {\n      sel = sel.moveEndToEndOfNode(\n        document.assertNodeByPath([visibleEnd]),\n        controller,\n      );\n    }\n\n    return sel;\n  }\n}\n","/* eslint-disable no-restricted-syntax */\n/**\n * @packageDocumentation\n * @module Commands\n */\nimport equal from 'fast-deep-equal';\nimport Controller from '../controller/index';\nimport Selection from '../models/selection';\nimport Node from '../models/node';\nimport Inline from '../models/inline';\nimport { EdgePoint, TextPoint } from '../models/point';\nimport Path from '../models/path';\nimport {\n  movePointBackward,\n  movePointWordForward,\n  movePointWordBackward,\n  movePointForward,\n} from '../utils/selection';\nimport { MoveUnit } from '../queries/selection';\nimport { OperationType } from '../models/operation';\n\nfunction getSiblingTextPoint(\n  controller: Controller,\n  key: string,\n  isPrev: boolean,\n) {\n  const { document } = controller.value;\n  const textNode = isPrev\n    ? document.getPreviousText(key)\n    : document.getNextText(key);\n  if (textNode) {\n    const { key } = textNode;\n    const offset = isPrev ? textNode.text.length : 0;\n    return TextPoint.create({ key, offset });\n  }\n  return undefined;\n}\n\n/**\n *\n * move point out of inline IF it's located at inline edges\n *\n * ### Normal Inline\n * Before: `<link><anchor/>www.dingtalk.com<focus/></link>`\n *\n * After: `<anchor/><link>www.dingtalk.com</link><focus/>`\n *\n * ### Side selectable Inline\n * Before: `<anchor/><ins>www.dingtalk.com</ins><focus/>`\n *\n * After: `<ins><anchor/>www.dingtalk.com<focus/></ins>`\n */\nconst correctPointAtInlineEdge = (\n  controller: Controller,\n  point: TextPoint | EdgePoint,\n) => {\n  if (point.isEdgePoint()) {\n    return point;\n  }\n  if (controller.query('disableCorrectPointAtInnerEdge', point)) {\n    return point;\n  }\n  const { document } = controller.value;\n  const { key, offset } = point;\n  const text = document.getNode(key);\n  const parent = document.getParent(key);\n\n  // 若当前选中点为 text 起始，则试探前一个节点是否为可选 inline\n  if (offset === 0) {\n    const node = document.getPreviousSibling(key);\n    if (node && Inline.isInline(node) && controller.query('isSideSelectable', node)) {\n      return getSiblingTextPoint(controller, key, true) || point;\n    }\n  }\n\n  // 若当前选中点为 text 末尾，则试探后一个节点是否为可选 inline\n  if (text && offset === text.text.length) {\n    const node = document.getNextSibling(key);\n    if (node && Inline.isInline(node) && controller.query('isSideSelectable', node)) {\n      return getSiblingTextPoint(controller, key, false) || point;\n    }\n  }\n\n  if (!parent || !parent.isInline() || controller.query('isVoid', parent) || controller.query('isSideSelectable', parent)) {\n    return point;\n  }\n  if (offset !== 0 && offset !== parent.text.length) {\n    return point;\n  }\n  return getSiblingTextPoint(controller, key, offset === 0) || point;\n};\n\n/**\n *\n * move point out of void\n *\n * Before: <img>[anchor]</img>cangjie[focus]\n * After: [anchor]<img></img>cangjie[focus]\n */\nconst correctPointInVoid = (\n  controller: Controller,\n  point: TextPoint | EdgePoint,\n  isStart: boolean,\n) => {\n  if (point.isEdgePoint()) {\n    return point;\n  }\n  const { document } = controller.value;\n  const { key } = point;\n  const parent = document.getClosestInline(key);\n  if (!parent || !controller.query('isVoid', parent)) {\n    return point;\n  }\n  return getSiblingTextPoint(controller, key, isStart) || point;\n};\n\nexport function focus(controller: Controller) {\n  if (!controller.value.isFocused) {\n    return controller.setIsFocused(true);\n  }\n  return controller;\n}\n\nexport function blur(controller: Controller) {\n  if (controller.value.isFocused) {\n    return controller.setIsFocused(false);\n  }\n  return controller;\n}\n\nexport function select(controller: Controller, selection: Selection) {\n  const { selection: prevSelection } = controller.value;\n  if (equal(selection, prevSelection)) {\n    return controller;\n  }\n\n  return controller.applyOperation({\n    type: OperationType.SetSelection,\n    selection: Selection.create(selection),\n    prevSelection,\n  });\n}\n\n/**\n *\n * differences between `select` and `userSelect`:\n *\n * `select` will set exactly what you passed;\n * `userSelect` may adjust the selection to make the user feel expected.\n */\nexport function userSelect(controller: Controller, selection: Selection) {\n  const { selection: prevSelection, document } = controller.value;\n  if (equal(selection, prevSelection)) {\n    return controller;\n  }\n\n  const { anchor: paramAnchor, focus: paramFocus } = selection;\n  let anchor = correctPointAtInlineEdge(controller, paramAnchor);\n  let focus = correctPointAtInlineEdge(controller, paramFocus);\n  if (selection.isExpanded) {\n    const isForward = selection.isForward(document);\n    anchor = correctPointInVoid(controller, anchor, isForward);\n    focus = correctPointInVoid(controller, focus, !isForward);\n  }\n  const correctedSelection = selection\n    .set('anchor', anchor)\n    .set('focus', focus);\n\n  return controller.applyOperation({\n    type: OperationType.SetSelection,\n    selection: correctedSelection,\n    prevSelection,\n  });\n}\n\nexport function selectWordAtPoint(\n  controller: Controller,\n  point: TextPoint | EdgePoint,\n) {\n  const { document } = controller.value;\n\n  const selection = Selection.selectWordAtPoint(document, point);\n  return selection ? controller.command(select, selection) : controller;\n}\n\nexport function moveAnchorBackward(\n  controller: Controller,\n  n = 1,\n  unit?: MoveUnit,\n) {\n  const { selection } = controller.value;\n  const mover = movePointBackward(controller, 'anchor', n, unit || 'offset');\n  return controller.command(userSelect, mover(selection));\n}\n\nexport function moveAnchorForward(\n  controller: Controller,\n  n = 1,\n  unit?: MoveUnit,\n) {\n  const { selection } = controller.value;\n  const mover = movePointForward(controller, 'anchor', n, unit || 'offset');\n  const newSelection = mover(selection);\n  return controller.command(userSelect, newSelection);\n}\n\nexport function moveAnchorTo(\n  controller: Controller,\n  path: Path,\n  offset: number,\n) {\n  const { selection, document } = controller.value;\n  const { key } = document.assertNodeByPath(path);\n  const newSelection = selection.moveAnchorTo(key, offset);\n  return controller.command(select, newSelection);\n}\n\nexport function moveAnchorToKey(\n  controller: Controller,\n  key: string,\n  offset: number,\n) {\n  const path = controller.value.document.assertPath(key);\n  return controller.command(moveAnchorTo, path, offset);\n}\n\nexport function moveAnchorToStartOfBlock(controller: Controller) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.movePointEdgeKlass(controller, 'anchor', 'start', 'block'),\n  );\n}\n\nexport function moveAnchorToStartOfPreviousBlock(controller: Controller) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.movePointEdgeSideKlass(\n      controller,\n      'anchor',\n      'start',\n      'previous',\n      'block',\n    ),\n  );\n}\n\nexport function moveAnchorToEndOfNextBlock(controller: Controller) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.movePointEdgeSideKlass(\n      controller,\n      'anchor',\n      'end',\n      'next',\n      'block',\n    ),\n  );\n}\n\nexport function moveFocusTo(\n  controller: Controller,\n  path: Path,\n  offset: number,\n) {\n  const { selection, document } = controller.value;\n  const { key } = document.assertNodeByPath(path);\n  const newSelection = selection.moveFocusTo(key, offset);\n  return controller.command(select, newSelection);\n}\n\nexport function moveFocusToKey(\n  controller: Controller,\n  key: string,\n  offset: number,\n) {\n  const path = controller.value.document.assertPath(key);\n  return controller.command(moveFocusTo, path, offset);\n}\n\nexport function moveTo(controller: Controller, path: Path, offset: number) {\n  return controller\n    .command(moveAnchorTo, path, offset)\n    .command(moveFocusTo, path, offset);\n}\n\nexport function moveToKey(controller: Controller, key: string, offset: number) {\n  const path = controller.value.document.assertPath(key);\n  return controller.command(moveTo, path, offset);\n}\n\nexport function moveFocusBackward(controller: Controller, n = 1) {\n  const { selection } = controller.value;\n  const mover = movePointBackward(controller, 'focus', n, 'offset');\n  return controller.command(select, mover(selection));\n}\n\nexport function moveFocusForward(controller: Controller, n = 1) {\n  const { selection } = controller.value;\n  const mover = movePointForward(controller, 'focus', n, 'offset');\n  return controller.command(select, mover(selection));\n}\n\nexport function moveFocusWordBackward(controller: Controller) {\n  const { selection } = controller.value;\n  const mover = movePointBackward(controller, 'focus', 1, 'word');\n  return controller.command(select, mover(selection));\n}\n\nexport function moveFocusWordForward(controller: Controller) {\n  const { selection } = controller.value;\n  const mover = movePointForward(controller, 'focus', 1, 'word');\n  return controller.command(select, mover(selection));\n}\n\nexport function moveFocusToEndOfText(controller: Controller) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.movePointEdgeKlass(controller, 'focus', 'end', 'text'),\n  );\n}\n\nexport function moveFocusToStartOfBlock(controller: Controller) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.movePointEdgeKlass(controller, 'focus', 'start', 'block'),\n  );\n}\n\nexport function moveFocusToEndOfBlock(controller: Controller) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.movePointEdgeKlass(controller, 'focus', 'end', 'block'),\n  );\n}\n\nexport function moveFocusToStartOfDocument(controller: Controller) {\n  const { document } = controller.value;\n  return controller.command(moveFocusToStartOfNode, document);\n}\n\nexport function moveFocusToEndOfDocument(controller: Controller) {\n  const { document } = controller.value;\n  return controller.command(moveFocusToEndOfNode, document);\n}\n\nexport function moveStartBackward(controller: Controller, n = 1) {\n  const { selection } = controller.value;\n  const mover = movePointBackward(controller, 'start', n, 'offset');\n  return controller.command(select, mover(selection));\n}\n\nexport function moveStartForward(controller: Controller, n = 1) {\n  const { selection } = controller.value;\n  const mover = movePointForward(controller, 'start', n, 'offset');\n  return controller.command(select, mover(selection));\n}\n\nexport function moveEndBackward(controller: Controller, n = 1) {\n  const { selection } = controller.value;\n  const mover = movePointBackward(controller, 'end', n, 'offset');\n  return controller.command(select, mover(selection));\n}\n\nexport function moveEndForward(controller: Controller, n = 1) {\n  const { selection } = controller.value;\n  const mover = movePointForward(controller, 'end', n, 'offset');\n  return controller.command(select, mover(selection));\n}\n\nexport function moveBackward(controller: Controller, n = 1) {\n  return controller\n    .command(moveAnchorBackward, n)\n    .command(moveFocusBackward, n);\n}\n\nexport function moveForward(controller: Controller, n = 1) {\n  return controller.command(moveAnchorForward, n).command(moveFocusForward, n);\n}\n\nexport function moveToEndOfPreviousBlock(controller: Controller) {\n  return controller.command(moveStartToEndOfPreviousBlock).command(moveToStart);\n}\n\nexport function moveToEndOfNextBlock(controller: Controller) {\n  return controller.command(moveEndToEndOfNextBlock).command(moveToEnd);\n}\n\nexport function moveToEndOfInline(controller: Controller) {\n  return controller.command(moveEndToEndOfInline).command(moveToEnd);\n}\n\nexport function moveToAnchor(controller: Controller) {\n  const { selection } = controller.value;\n  return controller.command(select, selection.moveToAnchor());\n}\n\nexport function moveToFocus(controller: Controller) {\n  const { selection } = controller.value;\n  return controller.command(select, selection.moveToFocus());\n}\n\nexport function moveToRangeOfDocument(controller: Controller) {\n  return controller.command(moveToRangeOfNode, controller.value.document);\n}\n\nexport function moveToRangeOfNode(controller: Controller, node: Node) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.moveToRangeOfNode(node, controller),\n  );\n}\n\nexport function moveToStart(controller: Controller) {\n  const { document, selection } = controller.value;\n  return controller.command(select, selection.moveToStart(document));\n}\n\nexport function moveToEnd(controller: Controller) {\n  const { document, selection } = controller.value;\n  return controller.command(select, selection.moveToEnd(document));\n}\n\nexport function moveToEndOfDocument(controller: Controller) {\n  return controller\n    .command(moveEndToEndOfNode, controller.value.document)\n    .command(moveToEnd);\n}\n\nexport function moveToStartOfInline(controller: Controller) {\n  return controller.command(moveStartToStartOfInline).command(moveToStart);\n}\n\nexport function moveToStartOfBlock(controller: Controller) {\n  return controller.command(moveStartToStartOfBlock).command(moveToStart);\n}\n\nexport function moveToEndOfBlock(controller: Controller) {\n  return controller.command(moveEndToEndOfBlock).command(moveToEnd);\n}\n\nexport function moveToEndOfNode(controller: Controller, node: Node) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.moveToEndOfNode(node, controller),\n  );\n}\n\nexport function moveStartToStartOfInline(controller: Controller) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.movePointEdgeKlass(controller, 'start', 'start', 'inline'),\n  );\n}\n\nexport function moveStartToStartOfBlock(controller: Controller) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.movePointEdgeKlass(controller, 'start', 'start', 'block'),\n  );\n}\n\nexport function moveStartToStartOfPreviousBlock(controller: Controller) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.movePointEdgeSideKlass(\n      controller,\n      'start',\n      'start',\n      'previous',\n      'block',\n    ),\n  );\n}\n\nexport function moveEndToEndOfBlock(controller: Controller) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.movePointEdgeKlass(controller, 'end', 'end', 'block'),\n  );\n}\n\nexport function moveToStartOfDocument(controller: Controller) {\n  const { document, selection } = controller.value;\n  return controller.command(\n    select,\n    selection.moveFocusToStartOfNode(document, controller).moveToFocus(),\n  );\n}\n\nexport function moveStartToEndOfNode(controller: Controller, node: Node) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.moveStartToEndOfNode(node, controller),\n  );\n}\n\nexport function moveAnchorToStartOfNode(controller: Controller, node: Node) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.moveAnchorToStartOfNode(node, controller),\n  );\n}\n\nexport function moveAnchorToEndOfNode(controller: Controller, node: Node) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.moveAnchorToEndOfNode(node, controller),\n  );\n}\n\nexport function moveFocusToStartOfNode(controller: Controller, node: Node) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.moveFocusToStartOfNode(node, controller),\n  );\n}\n\nexport function moveFocusToEndOfNode(controller: Controller, node: Node) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.moveFocusToEndOfNode(node, controller),\n  );\n}\n\nexport function moveToEndOfPreviousText(controller: Controller) {\n  return controller.command(moveStartToEndOfPreviousText).command(moveToStart);\n}\n\nexport function moveToStartOfNextText(controller: Controller) {\n  return controller.command(moveEndToStartOfNextText).command(moveToEnd);\n}\n\nexport function moveToStartOfPreviousBlock(controller: Controller) {\n  return controller\n    .command(moveStartToStartOfPreviousBlock)\n    .command(moveToStart);\n}\n\nexport function moveToStartOfNextBlock(controller: Controller) {\n  return controller.command(moveEndToStartOfNextBlock).command(moveToEnd);\n}\n\nexport function moveToStartOfNode(controller: Controller, node: Node) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.moveToStartOfNode(node, controller),\n  );\n}\n\nexport function moveStartToStartOfNode(controller: Controller, node: Node) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.moveStartToStartOfNode(node, controller),\n  );\n}\n\nexport function moveEndToStartOfNode(controller: Controller, node: Node) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.moveEndToStartOfNode(node, controller),\n  );\n}\n\nexport function moveEndToEndOfNode(controller: Controller, node: Node) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.moveEndToEndOfNode(node, controller),\n  );\n}\n\nexport function moveStartToEndOfPreviousText(controller: Controller) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.movePointEdgeSideKlass(\n      controller,\n      'start',\n      'end',\n      'previous',\n      'text',\n    ),\n  );\n}\n\nexport function moveStartToEndOfPreviousBlock(controller: Controller) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.movePointEdgeSideKlass(\n      controller,\n      'start',\n      'end',\n      'previous',\n      'block',\n    ),\n  );\n}\n\nexport function moveEndToEndOfInline(controller: Controller) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.movePointEdgeKlass(controller, 'end', 'end', 'inline'),\n  );\n}\n\nexport function moveEndToStartOfNextText(controller: Controller) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.movePointEdgeSideKlass(\n      controller,\n      'end',\n      'start',\n      'next',\n      'text',\n    ),\n  );\n}\n\nexport function moveEndToStartOfNextBlock(controller: Controller) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.movePointEdgeSideKlass(\n      controller,\n      'end',\n      'start',\n      'next',\n      'block',\n    ),\n  );\n}\n\nexport function moveEndToEndOfNextBlock(controller: Controller) {\n  const { selection } = controller.value;\n  return controller.command(\n    select,\n    selection.movePointEdgeSideKlass(controller, 'end', 'end', 'next', 'block'),\n  );\n}\n\nexport function moveWordBackward(controller: Controller) {\n  const { selection } = controller.value;\n  const mover = movePointWordBackward(controller, 'focus');\n  return controller.command(select, mover(selection)).command(moveToFocus);\n}\n\nexport function moveWordForward(controller: Controller) {\n  const { selection } = controller.value;\n  const mover = movePointWordForward(controller, 'focus');\n  return controller.command(select, mover(selection)).command(moveToFocus);\n}\n","/**\n * @packageDocumentation\n * @module Commands\n */\nimport { select } from './selection';\nimport Controller from '../controller/index';\nimport Path from '../models/path';\nimport { OperationType, RemoveTextOperation } from '../models/operation';\nimport { EdgePoint, TextPoint } from '../models/point';\nimport { pointAtEndOfNode, pointAtStartOfNode } from '../queries/selection';\nimport Selection from '../models/selection';\n\n/**\n * 删除指定位置的节点。\n * 1. 如果传入无效的节点，会抛异常。\n */\nexport function removeNodeByKey(controller: Controller, key: string) {\n  const { value } = controller;\n  const { document } = value;\n  const path = document.assertPath(key);\n  return controller.command(removeNodeByPath, path);\n}\n\n/**\n * 删除指定位置的节点。\n * 1. 如果传入无效的节点，会抛异常。\n */\nexport function removeNodeByPath(controller: Controller, path: Path) {\n  const { document: oldDoc } = controller.value;\n  const node = oldDoc.assertNodeByPath(path);\n\n  const { selection, document } = controller.value;\n  const prev = document.getPreviousNodeByPath(path);\n  const next = document.getNextNodeByPath(path);\n  const mapPoint = (point: TextPoint | EdgePoint) => {\n    if (node.key === point.key || (node.isElement() && node.hasNode(point.key))) {\n      if (prev) {\n        return controller.query(pointAtEndOfNode, prev);\n      }\n      if (next) {\n        return controller.query(pointAtStartOfNode, next);\n      }\n    }\n    return point;\n  };\n  let newSelection = selection;\n  if (prev || next) {\n    // 为什么在这里调整选区？\n    // 需要根据 controller 来获取 pointAtStartOfNode / pointAtEndOfNode。如果放到 Value 的\n    // applyOperation 中调整，value 没有感知到 controller 的存在，就无法获取 edge point。\n    const anchor = mapPoint(selection.anchor);\n    const focus = mapPoint(selection.focus);\n    newSelection = Selection.create({\n      anchor,\n      focus,\n    });\n  }\n  // 调用select是方便后续撤销时恢复选区，表格选区不恢复可能会跑到隐藏单元格触发bug\n  controller.command(select, newSelection);\n  controller.applyOperation({\n    type: OperationType.RemoveNode,\n    path,\n    node: node!,\n  });\n  if (newSelection !== selection) {\n    return controller.command(select, newSelection);\n  }\n  return controller;\n}\n\n/**\n * 删除指定位置的文字。\n * 1. 如果传入无效的节点，会抛异常。\n */\nexport function removeTextByKey(\n  controller: Controller,\n  key: string,\n  offset: number,\n  text: string,\n) {\n  const { value } = controller;\n  const { document } = value;\n  const path = document.assertPath(key);\n  return controller.command(removeTextByPath, path, offset, text);\n}\n\n/**\n * 删除指定位置的文字。\n * 1. 如果传入无效的节点，会抛异常。\n * @text 删除的文字；如果长度大于可用长度，按照可用长度计算\n */\nexport function removeTextByPath(\n  controller: Controller,\n  path: Path,\n  offset: number,\n  text: string,\n) {\n  const { value } = controller;\n  const { decorations, document } = value;\n  const node = document.assertTextByPath(path);\n\n  let updated = false;\n  const { key, leaves } = node;\n  const from = offset;\n  const to = offset + text.length;\n\n  // filter atomic decorations\n  const decs = decorations.filter((dec) => {\n    const { start, end, mark } = dec;\n    const isAtomic = controller.query('isAtomic', mark);\n    if (!isAtomic) return true;\n    if (start.key !== key) return true;\n\n    if (start.offset < from && (end.key !== key || end.offset > from)) {\n      updated = true;\n      return false;\n    }\n\n    if (start.offset < to && (end.key !== key || end.offset > to)) {\n      updated = true;\n      return null;\n    }\n\n    return true;\n  });\n\n  if (updated) {\n    controller.setDecorations(decs);\n  }\n\n  const removals: RemoveTextOperation[] = [];\n  let cursor = 0;\n\n  leaves.forEach((leaf) => {\n    const startCursor = cursor;\n    const endCursor = cursor + leaf.text.length;\n\n    cursor += leaf.text.length;\n\n    // Skip the leaf which is not overlapped\n    if (endCursor < from || to < startCursor) return;\n\n    // Remove the leaf text\n    const start = Math.max(startCursor, from);\n    const end = Math.min(endCursor, to);\n    const string = node.text.slice(start, end);\n\n    removals.push({\n      type: OperationType.RemoveText,\n      path,\n      offset: start,\n      text: string,\n      marks: leaf.marks,\n    });\n  });\n\n  controller.command(select, value.selection);\n  removals.reverse().forEach((op) => controller.applyOperation(op));\n  return controller;\n}\n","/**\n * @packageDocumentation\n * @module Commands\n */\nimport Controller from '../controller/index';\nimport { OperationType } from '../models/operation';\nimport Path from '../models/path';\n\n/**\n * 删除指定位置的Node，并添加到parentPath的第index处\n * 1. 如果传入无效的节点，会抛异常。\n */\nexport function moveNodeByKey(\n  controller: Controller,\n  key: string,\n  parentKey: string,\n  index: number,\n) {\n  const { value } = controller;\n  const { document } = value;\n  const path = document.assertPath(key);\n  const parentPath = document.assertPath(parentKey);\n  return controller.command(moveNodeByPath, path, parentPath, index);\n}\n\n/**\n * 删除指定位置的Node，并添加到parentPath的第index处\n * 1. 如果传入无效的节点，会抛异常。\n */\nexport function moveNodeByPath(\n  controller: Controller,\n  path: Path,\n  parentPath: Path,\n  index: number,\n) {\n  if (Path.isEqual(path, parentPath)) {\n    return controller;\n  }\n\n  const newPath = parentPath.concat(index);\n\n  if (Path.isEqual(path, newPath)) {\n    return controller;\n  }\n\n  return controller.applyOperation({\n    type: OperationType.MoveNode,\n    path,\n    newPath,\n  });\n}\n","/* eslint-disable no-param-reassign */\n/**\n * @packageDocumentation\n * @ignore\n */\nimport Controller from '../controller/index';\nimport Selection from '../models/selection';\nimport { del } from './delete';\n\nexport function deleteExpanded(controller: Controller) {\n  const { value } = controller;\n  const { selection } = value;\n\n  if (selection.isExpanded) {\n    controller.command(del);\n  }\n}\n\n/**\n * 删除选区的内容；返回一个拷贝选区，并定位到原选区的start位置\n */\nexport function deleteExpandedAtRange(\n  controller: Controller,\n  range: Selection,\n): Selection {\n  const { value } = controller;\n  const { document } = value;\n  const { start, end } = range.sort(document);\n  if (range.isExpanded) {\n    controller.command('deleteAtRange', range);\n  }\n\n  const { document: newDocument } = controller.value;\n  if (newDocument.getNode(start.key)) {\n    range = range.merge({\n      anchor: start,\n      focus: start,\n    });\n  } else {\n    const point = end.isTextPoint() ? end.set('offset', 0) : end;\n    range = range.merge({\n      anchor: point,\n      focus: point,\n    });\n  }\n\n  return range;\n}\n","import Path from '../models/path';\nimport Node from '../models/node';\nimport Operation, { OperationType } from '../models/operation';\n\nconst PREFIX = 'cj/cmd/split_';\n\nexport const splitTpl = (node: Node, path: Path, position: number) =>\n  `${PREFIX}${node.isText() ? 'text' : 'node'}(${JSON.stringify([\n    path,\n    position,\n  ])}`;\n\n/**\n * 是否是分裂 Element Operation \n * @param op \n * @returns \n */\nexport const isSplitElementOp = (op: Operation) => {\n  return op.type === OperationType.InsertNode && op.context?.startsWith(`${PREFIX}node`);\n}\n","/* eslint-disable no-param-reassign */\n/* eslint-disable no-plusplus */\n/* eslint-disable prefer-destructuring */\n/**\n * @packageDocumentation\n * @module Commands\n */\nimport { dropWhile } from 'lodash-es';\nimport equal from 'fast-deep-equal';\nimport Controller from '../controller/index';\nimport Element from '../models/element';\nimport Selection from '../models/selection';\nimport Path from '../models/path';\nimport Inline from '../models/inline';\nimport { Properties } from '../models/operation';\nimport { select } from './selection';\nimport { deleteExpandedAtRange, deleteExpanded } from './utils';\nimport { EdgePoint } from '../models/point';\nimport { insertNodeByPath, insertEmptyBlock } from './insert';\nimport { removeTextByPath } from './remove';\nimport { moveNodeByPath } from './move';\nimport { splitTpl } from '../contexts/split';\n\n/**\n * 从指定文本位置开始拆分节点子树\n * @param controller\n * @param key 节点子树的 root key\n * @param textKey 待拆分的文本 key\n * @param textOffset 待拆分的文本 offset\n * @returns\n * @example\n * ```ts\n * // \n * //   ┌───────┐                      ┌───────┐   \n * //   │ root  │                      │ root  │   \n * //   └───────┘                      └───────┘   \n * //       │                         ┌─────────┐  \n * //       ▼                         ▼         ▼  \n * //     ┌───┐                     ┌───┐     ┌───┐\n * //     │ A │                     │ A │     │A1 │\n * //     └───┘                     └───┘     └───┘\n * //       │         ──split─▶       │         │  \n * //       ▼                         ▼         ▼  \n * //     ┌───┐                     ┌───┐     ┌───┐\n * //     │ B │                     │ B │     │B1 │\n * //     └───┘                     └───┘     └───┘\n * //       │                         │         │  \n * //      │▼                         ▼         ▼  \n * //   ┌──┼────┐                   ┌───┐     ┌───┐\n * //   │'a│bc' │                   │'a'│     │'bc│\n * //   └──┼────┘                   └───┘     └───┘\n * //      │                                       \n * //   offset=1                                    \n * //\n * \n * const newDocument = controller.commands('splitDescendantsByKey', document.key, text.key, 1);\n*                                                       \n * ```\n */\nexport function splitDescendantsByKey(\n  controller: Controller,\n  key: string,\n  textKey: string,\n  textOffset: number,\n) {\n  const { value } = controller;\n  const { document } = value;\n  const path = document.assertPath(key);\n  const textPath = document.assertPath(textKey);\n  return controller.command(\n    'splitDescendantsByPath',\n    path,\n    textPath,\n    textOffset,\n  );\n}\n\n/**\n * 从指定文本位置开始拆分节点子树\n * @param controller\n * @param path 节点子树的 path\n * @param textPath 待拆分的文本 path\n * @param textOffset 待拆分的文本 offset\n * @returns\n * @example\n * ```ts\n * // \n * //   ┌───────┐                      ┌───────┐   \n * //   │ root  │                      │ root  │   \n * //   └───────┘                      └───────┘   \n * //       │                         ┌─────────┐  \n * //       ▼                         ▼         ▼  \n * //     ┌───┐                     ┌───┐     ┌───┐\n * //     │ A │                     │ A │     │A1 │\n * //     └───┘                     └───┘     └───┘\n * //       │         ──split─▶       │         │  \n * //       ▼                         ▼         ▼  \n * //     ┌───┐                     ┌───┐     ┌───┐\n * //     │ B │                     │ B │     │B1 │\n * //     └───┘                     └───┘     └───┘\n * //       │                         │         │  \n * //      │▼                         ▼         ▼  \n * //   ┌──┼────┐                   ┌───┐     ┌───┐\n * //   │'a│bc' │                   │'a'│     │'bc│\n * //   └──┼────┘                   └───┘     └───┘\n * //      │                                       \n * //   offset=1                                    \n * //\n * \n * const newDocument = controller.commands('splitDescendantsByPath', [], [0,0,0], 1);\n *                                                     \n * ```\n */\nexport function splitDescendantsByPath(\n  controller: Controller,\n  path: Path,\n  textPath: Path,\n  textOffset,\n) {\n  if (equal(path, textPath)) {\n    controller.command(splitNodeByPath, textPath, textOffset);\n    return controller;\n  }\n\n  const { value } = controller;\n  const { document } = value;\n  // 从待拆分文本 `text` 开始，自底向上逐个拆分节点，直到到达拆分节点 `node`\n  const node = document.assertNodeByPath(path);\n  const text = document.assertNodeByPath(textPath);\n  const ancestors = document.getAncestorsByPath(textPath);\n  let elements = ancestors.slice();\n  elements = dropWhile(elements, (a) => a.key !== node!.key).reverse();\n\n  return controller.withoutNormalizing(() => {\n    controller.command(splitNodeByKey, text.key, textOffset);\n    let previous = text;\n    elements.forEach((element) => {\n      controller.command(\n        splitNodeByKey,\n        element.key,\n        element.nodes.indexOf(previous) + 1,\n      );\n      previous = element;\n    });\n  });\n}\n\n/**\n * 对目标节点进行拆分\n *\n * ```txt\n * Split Text:\n *\n *       position=5                    Text      Text\n *          │                        ┌───────┐ ┌───────┐\n *     Hello│World     ─split─────▶  │ Hello │ │ World │\n *          │                        └───────┘ └───────┘\n *\n * Split Element:\n *\n *          position=1\n *             │\n * ┌───────────┼───────────┐                ┌─────────────┐   ┌─────────────┐\n * │ Element   │           │                │ Element     │   │ Element     │\n * │  ┌───────┐│┌───────┐  │                │  ┌───────┐  │   │  ┌───────┐  │\n * │  │ Hello │││ World │  │────split─────▶ │  │ Hello │  │   │  │ World │  │\n * │  └───────┘│└───────┘  │                │  └───────┘  │   │  └───────┘  │\n * └───────────┼───────────┘                └─────────────┘   └─────────────┘\n *             │\n *             │\n *\n * ```\n * @key 待拆分节点 key\n * @position 拆分位置。如果是 Text 节点，代表文字的偏移量；如果 Element节点，代表子节点 index。\n */\nexport function splitNodeByKey(\n  controller: Controller,\n  key: string,\n  position: number,\n) {\n  const { value } = controller;\n  const { document } = value;\n  const path = document.assertPath(key);\n  return controller.command(splitNodeByPath, path, position);\n}\n\n/**\n * 对目标节点进行拆分\n * ```txt\n * Split Text:\n *\n *       position=5                    Text      Text\n *          │                        ┌───────┐ ┌───────┐\n *     Hello│World     ─split─────▶  │ Hello │ │ World │\n *          │                        └───────┘ └───────┘\n *\n * Split Element:\n *\n *          position=1\n *             │\n * ┌───────────┼───────────┐                ┌─────────────┐   ┌─────────────┐\n * │ Element   │           │                │ Element     │   │ Element     │\n * │  ┌───────┐│┌───────┐  │                │  ┌───────┐  │   │  ┌───────┐  │\n * │  │ Hello │││ World │  │────split─────▶ │  │ Hello │  │   │  │ World │  │\n * │  └───────┘│└───────┘  │                │  └───────┘  │   │  └───────┘  │\n * └───────────┼───────────┘                └─────────────┘   └─────────────┘\n *             │\n *             │\n *                                                      \n * ```\n * @path 待拆分节点 path\n * @position 拆分位置。如果是 Text 节点，代表文字的偏移量；如果 Element节点，代表子节点 index。\n */\nexport function splitNodeByPath(\n  controller: Controller,\n  path: Path,\n  position: number,\n) {\n  const { value } = controller;\n  const { document } = value;\n  const node = document.assertNodeByPath(path);\n  const parentPath = path.slice(0, -1);\n  const parent = document.getNodeByPath(parentPath) as Element;\n  const index = parent.nodes.indexOf(node);\n  const properties: Properties = {};\n  if (Element.isElement(node)) {\n    properties.type = node.type;\n    properties.data = node.data;\n  }\n\n  controller.withOpContext(\n    splitTpl(node, path, position),\n    () => {\n      controller.withoutTracking(() => {\n        controller.withoutNormalizing(() => {\n          if (node.isText()) {\n            /**\n             * Split Text为：\n             *\n             * 1. 删除分裂位置后的文本\n             * 2. 在分裂节点之后，插入新的文本节点（其内容为分裂位置后的文本）\n             * ```txt\n             *\n             *        position=4\n             *            │\n             * ┌──────────┼────────┐                ┌──────┐                     ┌──────┐┌──────┐\n             * │      ABCD│EF      │─remove 'EF'──▶ │ ABCD │─insert Text('EF')─▶ │ ABCD ││  EF  │\n             * └──────────┼────────┘                └──────┘                     └──────┘└──────┘\n             *            │\n             * ```\n             */\n            const [, after] = node.splitText(position);\n            const { selection, decorations } = controller.value;\n            controller\n              .command(removeTextByPath, path, position, after.text)\n              .command(insertNodeByPath, parentPath, index + 1, after);\n            /**\n             * 上面从 split op 换成 remove + insert 之后，updatePoints 无法处理，导致 selection\n             * 和 decorations 都会失效。\n             *\n             * 这里取之前的 selection 和 decorations，主动调用 updatePoints 来矫正位置，模拟之前的\n             * split op 处理方式。\n             */\n            const valueToUpdate = controller.value\n              .set('decorations', decorations)\n              .set('selection', selection);\n            const updatedValue = valueToUpdate.updatePoints(\n              valueToUpdate.document,\n              (point) => {\n                if (point.key === node.key && position <= point.offset) {\n                  return point.merge({\n                    key: after.key,\n                    offset: point.offset - position,\n                  });\n                }\n                return point;\n              },\n            );\n            controller.setValue(updatedValue, { clearOperations: false });\n          } else {\n            /**\n             * Split Element：\n             *\n             * 1. 在分裂位置后，插入空节点\n             * 2. 将分裂位置后的节点移入这个空间点\n             * 2. 在分裂节点之后，插入新的文本节点（其内容为分裂位置后的文本）\n             * ```txt\n             *     position=1\n             *         │\n             * ┌───────┼────────────────┐                      ┌────────────────────────┐ ┌─────────┐                ┌─────────┐ ┌────────────────┐\n             * │ Elemen│                │                      │ Element                │ │ Element │                │ Element │ │ Element        │\n             * │  ┌───┐│┌───┐┌───┐┌───┐ │                      │  ┌───┐ ┌───┐┌───┐┌───┐ │ │         │                │  ┌───┐  │ │┌───┐┌───┐┌───┐ │\n             * │  │ A │││ B ││ C ││ D │ │───insert container──▶│  │ A │ │ B ││ C ││ D │ │ │         │──move afters──▶│  │ A │  │ ││ B ││ C ││ D │ │\n             * │  └───┘│└───┘└───┘└───┘ │                      │  └───┘ └───┘└───┘└───┘ │ │         │                │  └───┘  │ │└───┘└───┘└───┘ │\n             * └───────┼────────────────┘                      └────────────────────────┘ └─────────┘                └─────────┘ └────────────────┘\n             *         │\n             *\n             * ```\n             */\n            const element = node as Element;\n            const insertNode = element.set('nodes', []).regenerateKey();\n            const afters = element.nodes.slice(position);\n            const at = index + 1;\n            controller.command(insertNodeByPath, parentPath, at, insertNode);\n            const insertNodePath = parentPath.concat(at);\n            const moveNodePath = path.concat(position);\n            afters.forEach((_, idx) => {\n              controller.command(\n                moveNodeByPath,\n                moveNodePath,\n                insertNodePath,\n                idx,\n              );\n            });\n          }\n        });\n      });\n    },\n  );\n  return controller;\n}\n\n/**\n * 在当前选区拆分 Block\n * \n * @param controller\n * @param depth 对于嵌套结构，可以指定拆分深度，默认拆分深度为 1 ，即只拆分距选区最近的 Block\n * @returns\n * @example\n * \n * ```ts\n * // \n * //   ┌───────┐                      ┌───────┐   \n * //   │ root  │                      │ root  │   \n * //   └───────┘                      └───────┘   \n * //       │                              │       \n * //       ▼                              ▼       \n * //     ┌───┐                          ┌───┐     \n * //     │ A │                          │ A │     \n * //     └───┘                          └───┘     \n * //       │       ──depth=3─▶            │       \n * //       ▼                         ┌─────────┐  \n * //     ┌───┐                     ┌───┐     ┌───┐\n * //     │ B │                     │ B │     │B1 │\n * //     └───┘                     └───┘     └───┘\n * //       │                         │         │  \n * //      │▼                         ▼         ▼  \n * //   ┌──┼────┐                   ┌───┐     ┌───┐\n * //   │'a│bc' │                   │'a'│     │'bc│\n * //   └──┼────┘                   └───┘     └───┘\n * //      │                                       \n * //   cursor                                    \n * //\n * \n * const newDocument = controller.commands('splitBlock');\n * \n *  * // \n * //   ┌───────┐                      ┌───────┐   \n * //   │ root  │                      │ root  │   \n * //   └───────┘                      └───────┘   \n * //       │                         ┌─────────┐  \n * //       ▼                         ▼         ▼  \n * //     ┌───┐                     ┌───┐     ┌───┐\n * //     │ A │                     │ A │     │A1 │\n * //     └───┘                     └───┘     └───┘\n * //       │       ──depth=3─▶       │         │  \n * //       ▼                         ▼         ▼  \n * //     ┌───┐                     ┌───┐     ┌───┐\n * //     │ B │                     │ B │     │B1 │\n * //     └───┘                     └───┘     └───┘\n * //       │                         │         │  \n * //      │▼                         ▼         ▼  \n * //   ┌──┼────┐                   ┌───┐     ┌───┐\n * //   │'a│bc' │                   │'a'│     │'bc│\n * //   └──┼────┘                   └───┘     └───┘\n * //      │                                       \n * //   cursor                                    \n * //\n * \n * const newDocument = controller.commands('splitBlock', 3);\n *                                                      \n * ```\n */\nexport function splitBlock(controller: Controller, depth = 1) {\n  deleteExpanded(controller);\n\n  const { value } = controller;\n  const { selection, document } = value;\n  const marks = selection.marks || document.getInsertMarksAtRange(selection);\n  controller.command('splitBlockAtRange', selection, depth);\n  const range = controller.value.selection;\n  let newRange = range.moveToEnd(document);\n  if (marks.length || selection.marks) {\n    // 允许清除样式后 selection.marks = [] 继承到下一行\n    newRange = range.merge({\n      marks: marks.length ? marks : selection.marks,\n    });\n  }\n  return controller.command(select, newRange);\n}\n\n/**\n * 在指定选区区间拆分 Block\n * @param controller\n * @param selection\n * @param depth 对于嵌套结构，可以指定拆分深度，默认拆分深度为 1 ，即只拆分距选区最近的 Block\n * @returns\n * @example\n * \n * ```ts\n * // \n * //   ┌───────┐                      ┌───────┐   \n * //   │ root  │                      │ root  │   \n * //   └───────┘                      └───────┘   \n * //       │                              │       \n * //       ▼                              ▼       \n * //     ┌───┐                          ┌───┐     \n * //     │ A │                          │ A │     \n * //     └───┘                          └───┘     \n * //       │       ──depth=3─▶            │       \n * //       ▼                         ┌─────────┐  \n * //     ┌───┐                     ┌───┐     ┌───┐\n * //     │ B │                     │ B │     │B1 │\n * //     └───┘                     └───┘     └───┘\n * //       │                         │         │  \n * //      │▼                         ▼         ▼  \n * //   ┌──┼────┐                   ┌───┐     ┌───┐\n * //   │'a│bc' │                   │'a'│     │'bc│\n * //   └──┼────┘                   └───┘     └───┘\n * //      │                                       \n * //   cursor                                    \n * //\n * \n * const newDocument = controller.commands('splitBlockAtRange', cursor);\n * \n * //   ┌───────┐                      ┌───────┐   \n * //   │ root  │                      │ root  │   \n * //   └───────┘                      └───────┘   \n * //       │                         ┌─────────┐  \n * //       ▼                         ▼         ▼  \n * //     ┌───┐                     ┌───┐     ┌───┐\n * //     │ A │                     │ A │     │A1 │\n * //     └───┘                     └───┘     └───┘\n * //       │       ──depth=3─▶       │         │  \n * //       ▼                         ▼         ▼  \n * //     ┌───┐                     ┌───┐     ┌───┐\n * //     │ B │                     │ B │     │B1 │\n * //     └───┘                     └───┘     └───┘\n * //       │                         │         │  \n * //      │▼                         ▼         ▼  \n * //   ┌──┼────┐                   ┌───┐     ┌───┐\n * //   │'a│bc' │                   │'a'│     │'bc│\n * //   └──┼────┘                   └───┘     └───┘\n * //      │                                       \n * //   cursor                                    \n * //\n * \n * const newDocument = controller.commands('splitBlockAtRange', cursor, 3);\n *                                                      \n * ```\n */\nexport function splitBlockAtRange(\n  controller: Controller,\n  selection: Selection,\n  depth = 1,\n) {\n  let range = selection;\n  let { value } = controller;\n  let { document } = value;\n  if (range.isCollapsed && range.anchor.isEdgePoint()) {\n    // 对于 edge selection，做特殊处理。\n    const point = range.anchor;\n    const isAtBefore = point.edge === EdgePoint.BEFORE;\n    controller.command(insertEmptyBlock, point);\n    if (isAtBefore) {\n      controller.command(select, range);\n    }\n    return controller;\n  }\n\n  range = deleteExpandedAtRange(controller, range);\n\n  const { start, end } = range.convertToTextPoints(document);\n  let node = document.assertNode(start.key);\n  let parent = document.getClosestBlock(node!.key);\n  let d = 0;\n\n  while (parent && d < depth) {\n    node = parent;\n    parent = document.getClosestBlock(parent.key);\n    d++;\n  }\n\n  return controller.withoutNormalizing(() => {\n    controller.command(\n      splitDescendantsByKey,\n      node!.key,\n      start.key,\n      start.offset,\n    );\n\n    value = controller.value;\n    document = value.document;\n\n    if (range.isExpanded) {\n      if (range.isBackward(document)) range = range.flip();\n      const nextBlock = document.getNextBlock(node!.key)!;\n      range = range.moveAnchorToStartOfNode(nextBlock, controller);\n\n      if (start.key === end.key) {\n        range = range.moveFocusTo(\n          range.anchor.key,\n          end.offset! - start.offset!,\n        );\n      }\n\n      controller.command('deleteAtRange', range);\n    }\n  });\n}\n\n/**\n * 在当前选区拆分 Inline\n * \n * @param controller\n * @param depth 对于嵌套结构，可以指定拆分深度，默认拆分深度为 1 ，即只拆分距选区最近的 Inline\n * @returns\n * @example\n * \n * ```ts\n * // \n * //   ┌───────┐                      ┌───────┐   \n * //   │ root  │                      │ root  │   \n * //   └───────┘                      └───────┘   \n * //       │                              │       \n * //       ▼                              ▼       \n * //     ┌───┐                          ┌───┐     \n * //     │ A │                          │ A │     \n * //     └───┘                          └───┘     \n * //       │       ──depth=3─▶            │       \n * //       ▼                         ┌─────────┐  \n * //     ┌───┐                     ┌───┐     ┌───┐\n * //     │ B │                     │ B │     │B1 │\n * //     └───┘                     └───┘     └───┘\n * //       │                         │         │  \n * //      │▼                         ▼         ▼  \n * //   ┌──┼────┐                   ┌───┐     ┌───┐\n * //   │'a│bc' │                   │'a'│     │'bc│\n * //   └──┼────┘                   └───┘     └───┘\n * //      │                                       \n * //   cursor                                    \n * //\n * \n * const newDocument = controller.commands('splitInline');\n * \n *  * // \n * //   ┌───────┐                      ┌───────┐   \n * //   │ root  │                      │ root  │   \n * //   └───────┘                      └───────┘   \n * //       │                         ┌─────────┐  \n * //       ▼                         ▼         ▼  \n * //     ┌───┐                     ┌───┐     ┌───┐\n * //     │ A │                     │ A │     │A1 │\n * //     └───┘                     └───┘     └───┘\n * //       │       ──depth=3─▶       │         │  \n * //       ▼                         ▼         ▼  \n * //     ┌───┐                     ┌───┐     ┌───┐\n * //     │ B │                     │ B │     │B1 │\n * //     └───┘                     └───┘     └───┘\n * //       │                         │         │  \n * //      │▼                         ▼         ▼  \n * //   ┌──┼────┐                   ┌───┐     ┌───┐\n * //   │'a│bc' │                   │'a'│     │'bc│\n * //   └──┼────┘                   └───┘     └───┘\n * //      │                                       \n * //   cursor                                    \n * //\n * \n * const newDocument = controller.commands('splitInline', 3);\n *                                                      \n * ```\n */\nexport function splitInline(controller: Controller, depth = 1) {\n  deleteExpanded(controller);\n  const { selection } = controller.value;\n  return controller.command(splitInlineAtRange, selection, depth);\n}\n\n/**\n * 在指定选区区间拆分 Inline\n * @param controller\n * @param selection\n * @param depth 对于嵌套结构，可以指定拆分深度，默认拆分深度为 Infinity ，即从根节点开始拆分 Inline\n * @returns\n * @example\n * \n * ```ts\n * //\n * //   ┌───────┐                      ┌───────┐   \n * //   │ root  │                      │ root  │   \n * //   └───────┘                      └───────┘   \n * //       │                         ┌─────────┐  \n * //       ▼                         ▼         ▼  \n * //     ┌───┐                     ┌───┐     ┌───┐\n * //     │ A │                     │ A │     │A1 │\n * //     └───┘                     └───┘     └───┘\n * //       │   ──depth=Infinity─▶    │         │  \n * //       ▼                         ▼         ▼  \n * //     ┌───┐                     ┌───┐     ┌───┐\n * //     │ B │                     │ B │     │B1 │\n * //     └───┘                     └───┘     └───┘\n * //       │                         │         │  \n * //      │▼                         ▼         ▼  \n * //   ┌──┼────┐                   ┌───┐     ┌───┐\n * //   │'a│bc' │                   │'a'│     │'bc│\n * //   └──┼────┘                   └───┘     └───┘\n * //      │                                       \n * //   cursor                                    \n * // \n * \n * const newDocument = controller.commands('splitInlineAtRange', cursor);\n * \n * // \n * //   ┌───────┐                      ┌───────┐   \n * //   │ root  │                      │ root  │   \n * //   └───────┘                      └───────┘   \n * //       │                              │       \n * //       ▼                              ▼       \n * //     ┌───┐                          ┌───┐     \n * //     │ A │                          │ A │     \n * //     └───┘                          └───┘     \n * //       │       ──depth=1─▶            │       \n * //       ▼                         ┌─────────┐  \n * //     ┌───┐                     ┌───┐     ┌───┐\n * //     │ B │                     │ B │     │B1 │\n * //     └───┘                     └───┘     └───┘\n * //       │                         │         │  \n * //      │▼                         ▼         ▼  \n * //   ┌──┼────┐                   ┌───┐     ┌───┐\n * //   │'a│bc' │                   │'a'│     │'bc│\n * //   └──┼────┘                   └───┘     └───┘\n * //      │                                       \n * //   cursor                                    \n * \n * const newDocument = controller.commands('splitInlineAtRange', cursor, 1);\n *                                                      \n * ```\n */\nfunction splitInlineAtRange(controller: Controller, range, depth = Infinity) {\n  range = deleteExpandedAtRange(controller, range);\n  const { value } = controller;\n  const { document } = value;\n  const start = range.getStart(document);\n\n  let node = document.assertNode(start.key);\n  let parent = document.getClosestInline(node!.key);\n  let d = 0;\n\n  while (parent && Inline.isInline(parent) && d < depth) {\n    node = parent;\n    parent = document.getClosestInline(parent.key);\n    d++;\n  }\n\n  return controller.command(\n    splitDescendantsByKey,\n    node!.key,\n    start.key,\n    start.offset,\n  );\n}\n","import Path from \"../models/path\";\n\nexport const insertBlockTpl = () => 'cj/cmd/insblock';\nexport const insertInlineTpl = () => 'cj/cmd/insinline';\nexport const insertTpl = (path: Path) => `cj/cmd/ins(${JSON.stringify(path)})`\n","/* eslint-disable no-param-reassign */\n/**\n * @packageDocumentation\n * @module Commands\n */\nimport { splitDescendantsByKey, splitNodeByKey } from './split';\nimport {\n  moveToEndOfNode,\n  select,\n  moveToStart,\n  moveToStartOfNode,\n  moveBackward,\n  moveToStartOfNextBlock,\n} from './selection';\nimport Selection from '../models/selection';\nimport Controller from '../controller/index';\nimport Block, { BlockChild, BlockProperties } from '../models/block';\nimport Node from '../models/node';\nimport Path from '../models/path';\nimport Mark from '../models/mark';\nimport Document from '../models/document';\nimport Element from '../models/element';\nimport Inline, { InlineProperties } from '../models/inline';\nimport Text from '../models/text';\nimport { TextPoint, EdgePoint } from '../models/point';\nimport { deleteExpanded, deleteExpandedAtRange } from './utils';\nimport { moveNodeByKey } from './move';\nimport { removeNodeByKey } from './remove';\nimport listUtils from '../utils/listUtils';\nimport GraphemesBreaker from '../utils/grapheme/GraphemeBreaker';\nimport { insertBlockTpl, insertInlineTpl, insertTpl } from '../contexts/insert';\nimport { OperationType } from '../models/operation';\n\n/**\n * 在指定位置，插入一个node\n * @key 插入目标节点\n * @index 插入后在目标节点的顺序\n */\nexport function insertNodeByKey(\n  controller: Controller,\n  key: string,\n  index: number,\n  node: Node,\n) {\n  const { value } = controller;\n  const { document } = value;\n  const path = document.assertPath(key);\n  return controller.command(insertNodeByPath, path, index, node);\n}\n\n/**\n * 在指定位置，插入一个node\n * @path 插入目标节点\n * @index 插入后在目标节点的顺序\n */\nexport function insertNodeByPath(\n  controller: Controller,\n  path: Path,\n  index: number,\n  node: Node,\n) {\n  const insertPath = [...path, index];\n  return controller.withOpContext(insertTpl(insertPath), () => {\n    return controller.applyOperation({\n      type: OperationType.InsertNode,\n      path: insertPath,\n      node,\n    });\n  });\n}\n\nfunction isBlockEmpty(controller: Controller, block: Block) {\n  return (\n    !controller.query('isVoid', block) &&\n    controller.query('isEmpty', block) &&\n    block.text === '' &&\n    !block.findDescendant((n) => controller.query('isVoid', n))\n  );\n}\n\n/**\n * 在当前选区插入一段文字，并附带marks。\n * 1. marks：会从参数里获取；如果参数没有提供，会尝试从当前selection获取；如果依然没有，就从当前的插入位置获取\n */\nexport function insertText(controller: Controller, text: string, ms?: Mark[]) {\n  const { value } = controller;\n  const { document, selection } = value;\n  if (!selection) {\n    return controller;\n  }\n  const marks =\n    ms || selection.marks || document.getInsertMarksAtRange(selection);\n  return controller.command(insertTextAtRange, selection, text, marks);\n}\n\n/**\n * 在 EdgePoint 的 before 或者 after 位置，插入一个空白的段落。\n */\nexport function insertEmptyBlock(controller: Controller, at: EdgePoint) {\n  let { document } = controller.value;\n  const block = document.getNode(at.key);\n  const parent = document.getParent(at.key);\n  const isAtBefore = at.edge === EdgePoint.BEFORE;\n  if (!block || !parent || !block.isElement() || !block.isBlock()) {\n    return controller;\n  }\n  const index = parent.nodes.indexOf(block);\n  const newBlock = Block.create(Block.DEFAULT_TYPE);\n  const insertIndex = isAtBefore ? index : index + 1;\n  controller.command(insertNodeByKey, parent.key, insertIndex, newBlock);\n  document = controller.value.document;\n  const node = newBlock.getFirstNode();\n  const anchor = TextPoint.create({ key: node.key, offset: 0 });\n  const focus = anchor;\n  return controller.command(select, Selection.create({ anchor, focus }));\n}\n\n/**\n * 在目标位置插入一段文字，并附带marks。\n * 1. 目标位置需要对应一个Text节点，否则会抛出异常\n * 2. marks：会从参数里获取；如果参数没有提供，会尝试从当前的插入位置获取\n */\nexport function insertTextAtRange(\n  controller: Controller,\n  r: Selection,\n  text: string,\n  marks?: Mark[],\n) {\n  if (r.isCollapsed && r.anchor.isEdgePoint()) {\n    controller.command(insertEmptyBlock, r.anchor);\n    const textNode = controller.value.focusText;\n    if (!textNode) {\n      return controller;\n    }\n    return controller.command(insertTextByKey, textNode.key, 0, text, marks);\n  }\n  const range = r.isExpanded ? deleteExpandedAtRange(controller, r) : r;\n  const { value } = controller;\n  const { document } = value;\n  const { start } = range.convertToTextPoints(document);\n  const parent = document.getParent(start.key);\n  if (controller.query('isVoid', parent)) {\n    return controller;\n  }\n\n  return controller.command(\n    insertTextByKey,\n    start.key,\n    start.offset,\n    text,\n    marks,\n  );\n}\n\n/**\n * 在目标位置插入一段文字，并附带marks。\n * 1. 目标位置需要对应一个Text节点，否则会抛出异常\n * 2. marks：会从参数里获取；如果参数没有提供，会尝试从当前的插入位置获取\n */\nexport function insertTextByKey(\n  controller: Controller,\n  key: string,\n  offset: number,\n  text: string,\n  marks?: Mark[],\n) {\n  const { value } = controller;\n  const { document } = value;\n  const path = document.assertPath(key);\n  return controller.command(insertTextByPath, path, offset, text, marks);\n}\n\n/**\n * 在目标位置插入一段文字，并附带marks。\n * 1. 目标位置需要对应一个Text节点，否则会抛出异常\n * 2. marks：会从参数里获取；如果参数没有提供，会尝试从当前的插入位置获取\n */\nexport function insertTextByPath(\n  controller: Controller,\n  path: Path,\n  offset: number,\n  text: string,\n  ms?: Mark[],\n) {\n  const { value } = controller;\n  const { document, decorations } = value;\n  const node = document.assertNodeByPath(path);\n  if (!node.isText()) {\n    throw new Error(\n      `Commands.insertText, target([${path.join(',')}] type: ${\n        (node as Element).type\n      }) is not a Text node`,\n    );\n  }\n  const marks = ms || node.getMarksAtIndex(offset);\n\n  let updated = false;\n  const decs = decorations.filter((dec) => {\n    const { start, end, mark } = dec;\n    const isAtomic = controller.query('isAtomic', mark);\n    if (!isAtomic) {\n      return true;\n    }\n\n    const startPath = document.getPath(start.key);\n    if (!startPath) {\n      updated = true;\n      return false;\n    }\n    if (!Path.isEqual(startPath, path)) {\n      return true;\n    }\n\n    const endPath = document.getPath(end.key);\n    if (!endPath) {\n      updated = true;\n      return false;\n    }\n    if (\n      start.offset < offset &&\n      (!Path.isEqual(endPath, path) || end.offset > offset)\n    ) {\n      updated = true;\n      return false;\n    }\n\n    return true;\n  });\n  if (updated) {\n    controller.setValue(value.set('decorations', decs), { normalize: false });\n  }\n\n  return controller.applyOperation({\n    type: OperationType.InsertText,\n    path,\n    offset,\n    text: text || '',\n    marks: marks.map(Mark.create),\n  });\n}\n\n/**\n * 在指定的选区的start位置，插入一个block。\n * 1. 如果start节点在开始/结束位置，或者start节点是个空block，则直接插入；否则先split，后插入\n */\nexport function insertBlockAtRange(\n  controller: Controller,\n  range: Selection,\n  block: Block,\n) {\n  const newRange = deleteExpandedAtRange(controller, range);\n  const { value } = controller;\n  const { document } = value;\n\n  const { start } = newRange.convertToTextPoints(document);\n  let { key: startKey, offset: startOffset } = start;\n  const startBlock = document.getClosestBlock(startKey)!;\n  const startInline = document.getClosestInline(startKey);\n  const parent = document.getParent(startBlock.key)!;\n  const index = parent.nodes.indexOf(startBlock);\n\n  controller.withOpContext(insertBlockTpl(), () => {\n    if (newRange.anchor.isEdgePoint()) {\n      // If we insert block at edge point.\n      controller.command(\n        insertNodeByKey,\n        parent.key,\n        index + (newRange.anchor.edge === 'before' ? 0 : 1),\n        block,\n      );\n    } else if (!startInline && startBlock.text === '') {\n      // if we insert block at an empty block\n      controller.command(insertNodeByKey, parent.key, index + 1, block);\n    } else if (start.isAtStartOfNode(startBlock)) {\n      controller.command(insertNodeByKey, parent.key, index, block);\n    } else if (start.isAtEndOfNode(startBlock)) {\n      controller.command(insertNodeByKey, parent.key, index + 1, block);\n    } else {\n      // If we're in the middle of a block, we should consider split it first\n\n      // If we're in a void inline, we should move cursor to the sibliting text of the inline before spliting\n      if (startInline && controller.query('isVoid', startInline)) {\n        const atEnd = start.isAtEndOfNode(startInline);\n        const siblingText = atEnd\n          ? document.getNextText(startKey)\n          : document.getPreviousText(startKey);\n\n        const splitRange = atEnd\n          ? newRange.moveToStartOfNode(siblingText!, controller)\n          : newRange.moveToEndOfNode(siblingText!, controller);\n\n        const { anchor } = splitRange.convertToTextPoints(\n          controller.value.document,\n        );\n        startKey = anchor.key;\n        startOffset = anchor.offset;\n      }\n\n      controller.withoutNormalizing(() => {\n        controller.command(\n          splitDescendantsByKey,\n          startBlock.key,\n          startKey,\n          startOffset,\n        );\n        controller.command(insertNodeByKey, parent.key, index + 1, block);\n      });\n    }\n  });\n\n  return controller;\n}\n\n/**\n * 在当前选区位置，插入一个block。\n * 1. 如果当前选区是expand，会先执行删除选区操作。\n * 2. 如果start节点在开始/结束位置，或者start节点是个空block，则直接插入；否则先split，后插入\n * @blockProps block或者block参数，会传递给Block.create来创建一个block\n */\nexport function insertBlock(\n  controller: Controller,\n  blockProps: BlockProperties | Block | string,\n) {\n  const { selection } = controller.value;\n  const block = Block.create(blockProps);\n  controller.command(\n    insertBlockAtRange,\n    deleteExpandedAtRange(controller, selection),\n    block,\n  );\n\n  // move to end of inserted block\n  const node = controller.value.document.getNode(block.key);\n  if (node) {\n    controller.command(moveToEndOfNode, node);\n  }\n\n  return controller;\n}\n\n/**\n * 在当前选区位置，插入一个inline。\n * 1. 如果当前选区是expand，会先执行删除选区操作。\n */\nexport function insertInlineAtRange(\n  controller: Controller,\n  range: Selection,\n  inline: Inline,\n) {\n  controller.withOpContext(insertInlineTpl(), () => {\n    controller.withoutNormalizing(() => {\n      const point = deleteExpandedAtRange(controller, range).anchor;\n      if (range.isCollapsed && point.isEdgePoint()) {\n        controller.command(insertEmptyBlock, point);\n      }\n\n      const { document, selection } = controller.value;\n      const { start } = selection.convertToTextPoints(document);\n      const parent = document.getParent(start.key)!;\n      const startText = document.assertNode(start.key);\n      const index = parent.nodes.indexOf(startText);\n\n      if (controller.query('isVoid', parent)) return;\n\n      controller.command(splitNodeByKey, start.key, start.offset);\n      controller.command(insertNodeByKey, parent.key, index + 1, inline);\n    });\n  });\n  return controller;\n}\n\n/**\n * 在当前选区位置，插入一个inline。\n * 1. 如果当前选区是expand，会先执行删除选区操作。\n */\nexport function insertInline(\n  controller: Controller,\n  inlineProps: InlineProperties | Inline | string,\n) {\n  const { selection } = controller.value;\n  const inline = Inline.create(inlineProps);\n\n  controller.command(insertInlineAtRange, selection, inline);\n\n  // move to end of inserted block\n  const node = controller.value.document.getNode(inline.key);\n  if (node) {\n    controller.command(moveToEndOfNode, node);\n  }\n\n  return controller;\n}\n\n// If the fragment is wrapped by/nested in blocks, and the nesting pattern\n// already exists at the range, we meld the fragment contents into the\n// document’s existing nesting pattern as much as possible\n\n// Given a `fragment`, `document`, and `startKey`, it returns a Node from the\n// `fragment` to be inserted into the document. By default, the node returned\n// will be the `fragment`, but if a common nesting pattern is detected, a\n// sub-node of the fragment will be returned.\n\n// The detection algorithm is as follows:\n// 1. Ensure the fragment has a single child node, call it `fragmentInner`\n// 2. Find the furthest document ancestor of the `startKey` matching\n//    `fragmentInner.type`. Call this `documentInner`\n// 3. Drill into both `documentInner` and `fragmentInner` as long as each has\n//    a single child node and their types match. The stopping point for the\n//    fragment is the sub-node to insert into the document.\nconst findInsertionNode = (\n  fragment: Document,\n  document: Document,\n  startKey: string,\n) => {\n  const hasSingleNode = (object: Node): boolean => {\n    if (!object || Text.isText(object)) {\n      return false;\n    }\n    return (object as Element).nodes.length === 1;\n  };\n\n  const firstNode = (object: Element) => object && (object.nodes[0] as Element);\n  let node: Element = fragment;\n\n  if (hasSingleNode(fragment)) {\n    let fragmentInner = firstNode(fragment);\n\n    let documentInner = document.getFurthsest(startKey, (documentNode) => {\n      if (document instanceof Element) {\n        return (documentNode as Element).type === fragmentInner.type;\n      }\n      return false;\n    }) as Element;\n\n    if (documentInner === document.getParent(startKey)) {\n      node = fragmentInner;\n    }\n\n    while (\n      hasSingleNode(fragmentInner) &&\n      hasSingleNode(documentInner as Node)\n    ) {\n      fragmentInner = firstNode(fragmentInner);\n      documentInner = firstNode(documentInner);\n      if (fragmentInner.type === documentInner.type) {\n        node = fragmentInner;\n      } else {\n        break;\n      }\n    }\n  }\n  return node;\n};\n\n/**\n * 在目标位置插入一个fragment\n * 1. 内部遍历fragment的每一个node，然后调用Commands.insertNode\n * 2. 如果针对复制粘贴等上层场景，需要考虑key重新生成等逻辑，请使用Commands.insertFragment\n */\nexport function insertFragmentByKey(\n  controller: Controller,\n  key: string,\n  index: number,\n  fragment: Document,\n) {\n  const { value } = controller;\n  const { document } = value;\n  const path = document.assertPath(key);\n  return controller.command(insertFragmentByPath, path, index, fragment);\n}\n\n/**\n * 在目标位置插入一个fragment\n * 1. 内部遍历fragment的每一个node，然后调用Commands.insertNode\n * 2. 如果针对复制粘贴等上层场景，需要考虑key重新生成等逻辑，请使用Commands.insertFragment\n */\nexport function insertFragmentByPath(\n  controller: Controller,\n  path: Path,\n  index: number,\n  fragment: Document,\n) {\n  fragment.nodes.forEach((node, i) => {\n    controller.command(insertNodeByPath, path, index + i, node);\n  });\n  return controller;\n}\n\n/**\n * 在当前插入一个fragment\n * 1. 内部会处理插入点、插入后的光标行为，以符合用户直觉\n */\nexport function insertFragment(controller: Controller, fragment: Document) {\n  if (!fragment.nodes.length) {\n    return controller;\n  }\n\n  // pre-step, delete the selection is it's expanded\n  deleteExpanded(controller);\n\n  // save the values before insert\n  let { value } = controller;\n  let { document } = value;\n  let { selection } = value;\n  if (!selection) {\n    return controller;\n  }\n\n  // 获取插入位置祖先 Block 元素, 非容器节点插入祖先为 Document、Block, 容器节点插入祖先为 Document、Block、Block...\n  const startAncestors = document.getAncestors(selection.anchor.key);\n  const lastText = fragment.getLastText();\n  if (!lastText) {\n    return controller;\n  }\n\n  const { start, end } = selection.sort(document);\n  const { startText, endText } = value;\n  const keys = document.getTexts().map((text) => text.key);\n\n  // perform insert\n  controller.command(insertFragmentAtRange, selection, fragment);\n\n  // get the new values after insert\n  ({ value } = controller);\n  ({ document } = value);\n  selection = value.selection;\n\n  const updatedTexts = document.getTexts();\n  const newTexts = updatedTexts.filter((n) => !keys.includes(n.key));\n  const lastNewText = newTexts[newTexts.length - 1];\n\n  // selection - take the selection back if it's removed (e.g. the last one block is deleted)\n  if (!selection && updatedTexts.length) {\n    const firstText = updatedTexts[0];\n    const point = TextPoint.create({ key: firstText.key, offset: 0 });\n    controller.command(\n      select,\n      Selection.create({ anchor: point, focus: point }),\n    );\n  }\n\n  /**\n   * 插入 fragment 后移动光标的位置：\n   * 1. 首先判断本次插入操作是否有产生新的 text，如果没有产生新 text 节点，则为纯文字的插入，光标会自动校正，不需要处理\n   * 2. 若产生了新的 text 节点，则先移动至 lastText 的 end 点\n   * 3. 如果插入的过程中产生了对一段文字的后半段做 split 操作，则需要做偏移校正，校正的距离为插入前光标距离末尾的偏移量\n   */\n  if (lastNewText) {\n    controller.command(moveToEndOfNode, lastNewText);\n    const blockParent = document.getClosestBlock(lastNewText.key);\n    const nextText = blockParent?.getNextText(lastNewText.key);\n    // lastText 节点的 nextText 节点与插入 fragment 前的 endText 相等\n    // 这种状况是由于在段落的行首插入一个 inline 元素不会触发 split 操作，这种情况不需要校正偏移量，直接移动至 next 的首位\n    if (nextText && nextText.key === end.key) {\n      controller.command(moveToStartOfNode, nextText);\n    } else if (endText && end.isTextPoint()) {\n      // 如果 nextText 节点不相等，则说明出现了文字截断，此时要做偏移位校正，校正时需要先从光标点位和字符串中取分割的文字串，然后再计算字数\n      // 注意这里有个小问题：Point 的 offset 表示的是字符的偏移量，但是 moveBackward 方法是做的字偏移，所以要计算 Unicode 字\n      // 关于 Unicode 的一个小问题：存在一种组合 Unicode 会导致字数计算有偏差，例如【👩‍ 🦱】，如果将空格删除，则两个 emoji 会合并，这种组合性的 emoji 在\n      // 字数计算的时候会被拆分出来成 2 个字\n      const subText = endText.text.substring(end.offset);\n      const offsetToEnd = GraphemesBreaker.countBreaks(subText);\n\n      const firstChildHasBlockChildren = fragment.nodes[0].hasBlockChildren();\n      const startBlock = startText && document.getClosestBlock(startText.key) as Block;\n      const isAtStartOfUnEmptyNode = startBlock && start.isAtStartOfNode(startBlock);\n      if (firstChildHasBlockChildren && isAtStartOfUnEmptyNode) {\n        // 不做光标移动\n      } else {\n        controller.command(moveBackward, offsetToEnd);\n      }\n      const subRoot = document.getAncestors(lastNewText.key)[1];\n\n      // 插入 Void Block 节点时，光标移到 Block 节点外部\n      if (\n        // 根据祖先元素长度判断是否在容器节点内插入内容, 如果根节点下插入容器节点，插入后光标最后移出容器\n        // 如果在容器内插入普通节点，光标保持在容器内部\n        startAncestors.length <= 2 &&\n        controller.query('isEdgeSelectable', subRoot) &&\n        subRoot.getLastText() === lastNewText\n      ) {\n        controller.command(moveToStartOfNextBlock);\n      }\n    }\n    if (controller.value.selection.isExpanded) {\n      controller.command(moveToStart);\n    }\n  }\n  return controller;\n}\n\n/**\n * 在指定的选区插入一个fragment\n * 1. 如果选区是expand，会先删除选区\n */\nexport function insertFragmentAtRange(\n  controller: Controller,\n  range: Selection,\n  fragment: Document,\n) {\n  if (!fragment.nodes.length) {\n    return controller;\n  }\n  return controller.withoutNormalizing(() => {\n    range = deleteExpandedAtRange(controller, range);\n    if (range.isCollapsed && range.anchor.isEdgePoint()) {\n      controller.command(insertEmptyBlock, range.anchor);\n      range = controller.value.selection;\n    }\n\n    fragment = fragment.mapDescendants((child) => child.regenerateKey());\n\n    // NOTE: 这里调用 command key 试插件 onCommand 时间触发，主要用于图片的复制转存逻辑\n    // TODO: 在 model 增加一个可以不计入 asl 的 attributes，用于存储 key\n    controller.command('insertFragmentWithRealKeyAtRange', range, fragment);\n  });\n}\n\n/**\n * 在指定的选区插入一个fragment\n * 1. fragment必须包含有效的无冲突的key\n */\nexport function insertFragmentWithRealKeyAtRange(\n  controller: Controller,\n  range: Selection,\n  fragment: Document,\n) {\n  const { value } = controller;\n  let { document } = value;\n\n  // checking the start point\n  const { start, end } = range.convertToTextPoints(document);\n  let startText = document.getNode(start.key) as Node;\n  let startBlock = document.getClosestBlock(startText.key) as Block;\n  let startChild = startBlock.getFurthestAncestor(startText.key) as Element;\n  const isAtStart = start.isAtStartOfNode(startBlock);\n  const isAtEnd = end.isAtEndOfNode(startBlock);\n  let parent = document.getParent(startBlock.key) as Element;\n  const index = parent.nodes.indexOf(startBlock);\n\n  const blocks = fragment.getBlocks();\n  if (blocks.length === 0) {\n    return controller;\n  }\n\n  const firstChild = fragment.nodes[0] as Block;\n  const lastChild = fragment.nodes[fragment.nodes.length - 1] as Block;\n  const firstBlock = blocks[0];\n  const lastBlock = blocks[blocks.length - 1];\n\n  const insertionNode = findInsertionNode(fragment, document, startBlock.key);\n\n  // 设置用户数据\n  controller.userData.mergeUserData(fragment);\n\n  // If the new fragment only contains a void block, use `insertBlockAtRange`\n  if (\n    firstBlock === lastBlock &&\n    controller.query('isVoid', firstBlock) &&\n    !controller.query('isContainer', insertionNode)\n  ) {\n    controller.command(insertBlockAtRange, range, firstBlock);\n    return controller;\n  }\n\n  // If the new fragment starts or ends with a single nested block,\n  // e.g. a table, use `insertBlockAtRange`\n  const firstChildHasBlockChildren = firstChild.hasBlockChildren();\n  const lastChildHasBlockChildren = lastChild.hasBlockChildren();\n  if (\n    insertionNode === fragment &&\n    (firstChildHasBlockChildren || lastChildHasBlockChildren)\n  ) {\n    // 如果插入的第一个节点是一个容器节点：\n    //\n    // Fragment:\n    // ```tsx\n    // <document>\n    //   <block>\n    //     <block>Hello</block>\n    //     <block>World</block>\n    //   </block>\n    //   <block>Cangjie</block>\n    // </document>\n    // ```\n    //\n    // 插入到光标位置\n    // ```tsx\n    // <document>\n    //   <block>Intro<cursor />123</block>\n    //   <block>Command</block>\n    // </document>\n    // ```\n    //\n    // 期望是\n    // ```tsx\n    // <document>\n    //   <block>Intro</block>\n    //   <block>\n    //     <block>Hello</block>\n    //     <block>World</block>\n    //   </block>\n    //   <block>Cangjie</block>\n    //   <block>123</block>\n    //   <block>Command</block>\n    // </document>\n    // ```\n    //\n    if (firstChildHasBlockChildren) {\n      // 非空节点插入内容，不需要进行 reverse\n      const isAtStartOfUnEmptyNode = start.isAtStartOfNode(startBlock);\n      const nodes = isAtStartOfUnEmptyNode ? fragment.nodes : [...fragment.nodes].reverse();\n      nodes.forEach((node) => {\n        controller.command(insertBlockAtRange, range, node as Block);\n      });\n      return controller;\n    }\n\n    // 如果插入的最后一个节点是一个容器节点：\n    //\n    // Fragment:\n    // ```tsx\n    // <document>\n    //   <block>Cangjie</block>\n    //   <block>\n    //     <block>Hello</block>\n    //     <block>World</block>\n    //   </block>\n    // </document>\n    // ```\n    //\n    // 插入到光标位置\n    // ```tsx\n    // <document>\n    //   <block>Intro<cursor />123</block>\n    // </document>\n    // ```\n    //\n    // 期望是\n    // ```tsx\n    // <document>\n    //   <block>IntroCangjie</block>\n    //   <block>\n    //     <block>Hello</block>\n    //     <block>World</block>\n    //   </block>\n    //   <block>123</block>\n    // </document>\n    // ```\n    //\n    if (lastChildHasBlockChildren) {\n      // 插入最后一个节点，再在原位置插入剩余节点\n      controller.command(insertBlockAtRange, range, lastChild);\n      const rest = fragment.removeNode([fragment.nodes.length - 1]);\n      if (rest.nodes.length) {\n        controller.command(insertFragmentWithRealKeyAtRange, range, rest);\n      }\n    }\n    return controller;\n  }\n\n  // If the first and last block aren't the same, we need to insert all of the\n  // nodes after the insertion node's first block at the index.\n  if (firstBlock !== lastBlock) {\n    const lonelyParent = insertionNode.getFurthsest(\n      firstBlock.key,\n      (p) => (p as Block).nodes.length === 1,\n    );\n    const lonelyChild = lonelyParent || firstBlock;\n\n    const startIndex = parent.nodes.indexOf(startBlock);\n    const excludingLonelyChild = insertionNode.removeNode(\n      insertionNode.assertPath(lonelyChild.key),\n    );\n\n    excludingLonelyChild.nodes.forEach((node, i) => {\n      const newIndex = startIndex + i + 1;\n      controller.command(insertNodeByKey, parent.key, newIndex, node);\n    });\n  }\n\n  // Check if we need to split the node.\n  if (start.offset !== 0) {\n    controller.command(\n      splitDescendantsByKey,\n      startChild.key,\n      start.key,\n      start.offset,\n    );\n  }\n\n  ({ document } = controller.value);\n  startText = document.getNode(start.key) as Node;\n  startBlock = document.getClosestBlock(start.key) as Block;\n  parent = document.getParent(startBlock.key) as Element;\n  startChild = startBlock.getFurthestAncestor(startText.key) as Element;\n\n  if (firstBlock !== lastBlock) {\n    const nextChild = isAtStart\n      ? startChild\n      : startBlock.getNextSibling(startChild.key);\n    const nextNodes = nextChild\n      ? listUtils.skipUntil(startBlock.nodes, (n) => n.key === nextChild.key)\n      : [];\n    const block = document.assertElement(lastBlock.key);\n\n    if (!controller.query('isVoid', block)) {\n      // 如果插入的最后一个节点是非 void block，则 split 后的 nodes 可以追加到 block 末尾\n      // Fragment:\n      // ```ts\n      // <document>\n      //   <block>Hello</block>\n      //   <block>World</block>\n      // </document>\n      // ```\n      //\n      // 在如下光标位置插入:\n      // ```ts\n      // <document>\n      //   <block>123<cursor />45</block>\n      // </document>\n      // ```\n      //\n      // 期望的插入结果是:\n      // ```ts\n      // <document>\n      //   <block>123Hello</block>\n      //   <block>World45</block>\n      // </document>\n      // ```\n      const moveTo = block.nodes.length;\n      nextNodes.forEach((node, i) => {\n        const newIndex = moveTo + i;\n        controller.command(moveNodeByKey, node.key, block.key, newIndex);\n      });\n    } else {\n      // 如果插入的最后一个节点是 void block，则 split 后的 nodes 可以插入到 block 之后\n      // Fragment:\n      // ```ts\n      // <document>\n      //   <block>Hello</block>\n      //   <void-block />\n      // </document>\n      // ```\n      //\n      // 在如下光标位置插入:\n      // ```ts\n      //   <document>\n      //     <block>123<cursor />45</block>\n      //   </document>\n      // ```\n      //\n      // 期望的插入结果为:\n      // ```ts\n      //   <document>\n      //     <block>123Hello</block>\n      //     <void-block />\n      //     <block>45</block>\n      //   </document>\n      // ```\n      const insertAt =\n        document.assertElement(parent.key).nodes.indexOf(block) + 1;\n      nextNodes.forEach((node) => {\n        controller.command(removeNodeByKey, node.key);\n      });\n      // 新插入的节点继承原 block 的属性\n      const restBlock = startBlock\n        .set('nodes', nextNodes)\n        .regenerateKey() as Block;\n      if (!isAtEnd) {\n        controller.command(insertNodeByKey, parent.key, insertAt, restBlock);\n      }\n    }\n  }\n\n  if (isBlockEmpty(controller, startBlock)) {\n    // 如果 start block 为空，则直接替换 start block 为待插入的 first block\n    // 是否为空的断言需要插件实现 `isEmpty`，即由插件决定某个元素是否可以被判定为空，且被替换\n    // Fragment:\n    // ```ts\n    //   <document>\n    //     <block>Hello</block>\n    //     <block>World</block>\n    //   </document>\n    // ```\n    //\n    // 在如下光标位置插入:\n    // ```ts\n    //   <document>\n    //     <block><cursor /></block>\n    //   </document>\n    // ```\n    //\n    // 期望的插入结果是:\n    // ```ts\n    // <document>\n    //   <block>Hello</block>\n    //   <block>World</block>\n    // </document>\n    // ```\n    controller\n      .command(insertNodeByKey, parent.key, index, firstBlock)\n      .command(removeNodeByKey, startBlock.key);\n  } else {\n    // 否则，保留 start block，并在 start block 的分裂位置插入 first block 的子孙\n    // 1. first block is non-void\n    // Fragment:\n    // ```ts\n    // <document>\n    //   <block>Hello</block>\n    //   <block>World</block>\n    // </document>\n    // ```\n    //\n    // 在如下光标位置插入:\n    // ```ts\n    // <document>\n    //   <block>Cangjie<cursor /></block>\n    // </document>\n    // ```\n    //\n    // 期望的插入结果是:\n    // ```ts\n    // <document>\n    //   <block>CangjieHello</block>\n    //   <block>World</block>\n    // </document>\n    // ```\n    //\n    // 2. first block is void\n    // Fragment:\n    // ```ts\n    // <document>\n    //   <void-block />\n    //   <block>World</block>\n    // </document>\n    // ```\n    //\n    // 在如下光标位置插入:\n    // ```ts\n    // <document>\n    //   <block>Cangjie<cursor /></block>\n    // </document>\n    // ```\n    //\n    // 期望的插入结果是:\n    // ```ts\n    // <document>\n    //   <block>Cangjie</block>\n    //   <void-block />\n    //   <block>World</block>\n    // </document>\n    // ```\n    // 否则，保留 start block，并在 start block 的分裂位置插入 first block 的子孙\n    const inlineChild = startBlock.getFurthestAncestor(\n      startText.key,\n    ) as BlockChild;\n    const inlineIndex = startBlock.nodes.indexOf(inlineChild);\n    if (controller.query('isVoid', firstBlock)) {\n      const insertAt = parent.nodes.indexOf(startBlock) + 1;\n      controller.command(insertNodeByKey, parent.key, insertAt, firstBlock);\n    } else {\n      firstBlock.nodes.forEach((inline, i) => {\n        const o = start.offset === 0 ? 0 : 1;\n        const newIndex = inlineIndex + i + o;\n        controller.command(insertNodeByKey, startBlock.key, newIndex, inline);\n      });\n    }\n  }\n  return controller;\n}\n","import Node from '../models/node';\nimport Path from '../models/path';\n\nexport const mergeTpl = (node: Node, path: Path) =>\n  `cj/cmd/merge_${node.isElement() ? 'node' : 'text'}(${JSON.stringify(path)})`;\n","/**\n * @packageDocumentation\n * @module Commands\n */\nimport Controller from '../controller/index';\nimport Path from '../models/path';\nimport Text from '../models/text';\nimport { removeNodeByPath } from './remove';\nimport { moveNodeByPath } from './move';\nimport { insertTextByPath } from './insert';\nimport { mergeTpl } from '../contexts/merge';\n\n/**\n * 把目标 path 的 Node，合并到其上一个 Sibling 上。\n * 1. 必须满足 Node 和上一个 Sibling 是同一种类型。\n * 2. 如果没有上一个 Sibling，直接抛异常。\n */\nexport function mergeNodeByKey(controller: Controller, key: string) {\n  const { value } = controller;\n  const { document } = value;\n  const path = document.assertPath(key);\n  return controller.command(mergeNodeByPath, path);\n}\n\n/**\n * 把目标 path 的 Node，合并到其上一个 Sibling 上。\n * 1. 必须满足 Node 和上一个 Sibling 是同一种类型。\n * 2. 如果没有上一个 Sibling，直接抛异常。\n */\nexport function mergeNodeByPath(controller: Controller, path: Path) {\n  const { value } = controller;\n  const { document } = value;\n  const original = document.getNodeByPath(path)!;\n  const previous = original ? document.getPreviousSibling(original.key) : null;\n\n  if (!previous) {\n    throw new Error(\n      `Unable to merge node with path \"${path}\", because it has no previous sibling.`,\n    );\n  }\n  if (previous.constructor !== original.constructor) {\n    throw new Error(\n      `Unable to merge two different kinds of nodes: ${previous} and ${original}`,\n    );\n  }\n\n  const previousPath = document.getPath(previous.key)!;\n  const previousNode = previous.toSubType();\n\n  const position = previousNode.isText()\n    ? previousNode.text.length\n    : previousNode.nodes.length;\n\n  controller.withOpContext(mergeTpl(original, path), () => {\n    controller.withoutNormalizing(() => {\n      if (original.isElement()) {\n        const moveNodePath = [...path, 0];\n        original.nodes.forEach((node, index) => {\n          controller.command(\n            moveNodeByPath,\n            moveNodePath,\n            previousPath,\n            position + index,\n          );\n        });\n        controller.command(removeNodeByPath, path);\n      } else {\n        const { leaves } = original as Text;\n        let offset = previousNode.text.length;\n        const { selection, decorations } = controller.value;\n        leaves.forEach((leaf) => {\n          controller.command(\n            insertTextByPath,\n            previousPath,\n            offset,\n            leaf.text,\n            leaf.marks,\n          );\n          offset += leaf.text.length;\n        });\n        controller.command(removeNodeByPath, path);\n        // 处理 updatePoints 的问题；具体请参考 split 中同样的处理\n        const valueToUpdate = controller.value\n          .set('decorations', decorations)\n          .set('selection', selection);\n        const updatedValue = valueToUpdate.updatePoints(\n          valueToUpdate.document,\n          (point) => {\n            if (point.key === original.key) {\n              return point.merge({\n                key: previousNode.key,\n                offset: point.offset + position,\n              });\n            }\n            return point;\n          },\n        );\n        controller.setValue(updatedValue, { clearOperations: false });\n      }\n    });\n  });\n\n  return controller;\n}\n","/**\n * @packageDocumentation\n * @module Commands\n */\nimport Controller from '../controller/index';\nimport Mark from '../models/mark';\nimport Selection from '../models/selection';\nimport Text from '../models/text';\nimport Path from '../models/path';\nimport setUtils from '../utils/setUtils';\nimport { OperationType } from '../models/operation';\n\n/**\n * 在当前选区，添加mark\n * 1. 如果选区是expand，会设置当前选中内容的mark\n * 2. 如果选区是collapse，会把m和当前的选区的marks，一起合并到当前selection内\n */\nexport function addMark(controller: Controller, m: Mark) {\n  const mark = Mark.create(m);\n  const { value } = controller;\n  const { document, selection } = value;\n\n  if (selection.isExpanded) {\n    controller.command(addMarkAtRange, selection, mark);\n  } else {\n    const activeMarks =\n      selection.marks || document.getActiveMarksAtRange(selection);\n    const sel = selection.set('marks', setUtils.add(activeMarks, mark));\n    controller.command('select', sel);\n  }\n\n  return controller;\n}\n\n/**\n * 对指定的选区内，增加mark\n * 1. 如果选区是collapse，则什么都不做\n */\nexport function addMarkAtRange(\n  controller: Controller,\n  range: Selection,\n  mark: Mark,\n) {\n  if (range.isCollapsed) return controller;\n\n  const { value } = controller;\n  const { document } = value;\n  const { start, end } = range.convertToTextPoints(document);\n  const texts = document.getTextsAtRange(range);\n  controller.withoutNormalizing(() => {\n    texts.forEach((node) => {\n      const { key } = node;\n      let offset = 0;\n      let { length } = node.text;\n\n      if (key === start.key) ({ offset } = start);\n      if (key === end.key) length = end.offset;\n      if (key === start.key && key === end.key) {\n        length = end.offset - start.offset;\n      }\n\n      controller.command(addMarkByKey, key, offset, length, mark);\n    });\n  });\n  return controller;\n}\n\n/**\n * 对指定的选区内，增加mark\n * 1. 如果选区是collapse，则什么都不做\n */\nexport function addMarkByKey(\n  controller: Controller,\n  key: string,\n  offset: number,\n  length: number,\n  mark: Mark,\n) {\n  const { value } = controller;\n  const { document } = value;\n  const path = document.assertPath(key);\n  return controller.command(addMarkByPath, path, offset, length, mark);\n}\n\n/**\n * 对一个text节点的一部分文字，增加mark\n * 1. 如果目标无效，或者不是一个text，则什么都不做\n */\nexport function addMarkByPath(\n  controller: Controller,\n  path: Path,\n  offset: number,\n  length: number,\n  mark: Mark,\n) {\n  const node = controller.value.document.getNodeByPath(path);\n  if (!node || !Text.isText(node)) return controller;\n\n  // Text start offset\n  const bx = offset;\n  // Text end offset\n  const by = offset + length;\n  // Current Leaf start offset\n  let o = 0;\n\n  node.leaves.forEach((leaf) => {\n    // Leaf start offset\n    const ax = o;\n    // Leaf end offset\n    const ay = ax + leaf.text.length;\n    // 叠加偏移量\n    o += leaf.text.length;\n\n    // If the leaf doesn't overlap with the operation, continue on.\n    if (ay < bx || by < ax) return;\n\n    // If the leaf already has the mark, continue on.\n    if (leaf.marks.find((m) => m.isEqual(mark))) return;\n\n    // Otherwise, determine which offset and characters overlap.\n    const start = Math.max(ax, bx);\n    const end = Math.min(ay, by);\n\n    controller.applyOperation({\n      type: OperationType.AddMark,\n      path,\n      offset: start,\n      length: end - start,\n      mark,\n    });\n  });\n\n  return controller;\n}\n\n/**\n * 在当前选区，添加marks\n * 1. 如果选区是expand，会设置当前选中内容的marks\n * 2. 如果选区是collapse，会把marks和当前的选区的marks，一起合并到当前selection内\n */\nexport function addMarks(controller: Controller, marks: Mark[]) {\n  marks.forEach((mark) => controller.command(addMark, mark));\n  return controller;\n}\n\n/**\n * 对指定的选区内，增加marks\n * 1. 如果选区是collapse，则什么都不做\n */\nexport function addMarksAtRange(\n  controller: Controller,\n  range: Selection,\n  marks: Mark[],\n) {\n  marks.forEach((mark) => controller.command(addMarkAtRange, range, mark));\n  return controller;\n}\n\n/**\n * 在当前的选区内，toggleMark\n * 1. 如果选区是expand，会设置到当前选中内容\n * 2. 如果选区是collapse，会设置到当前的selection\n */\nexport function toggleMark(controller: Controller, m: Mark) {\n  const mark = Mark.create(m);\n  const { value } = controller;\n  const { selection, document } = value;\n\n  if (selection.isExpanded) {\n    return controller.command(toggleMarkAtRange, selection, mark);\n  }\n  const activeMarks =\n    selection.marks || document.getActiveMarksAtRange(selection);\n  const newMarks = setUtils.has(activeMarks, mark)\n    ? setUtils.remove(activeMarks, mark)\n    : setUtils.add(activeMarks, mark);\n\n  const sel = selection.set('marks', newMarks);\n  return controller.command('select', sel);\n}\n\n/**\n * 在指定的选区内，toggleMark\n * 1. 如果选区是collapse，什么都不做\n */\nexport function toggleMarkAtRange(\n  controller: Controller,\n  range: Selection,\n  m: Mark,\n) {\n  if (range.isCollapsed) {\n    return controller;\n  }\n\n  const mark = Mark.create(m);\n  const { value } = controller;\n  const { document } = value;\n  const activeMarks = document.getActiveMarksAtRange(range);\n  if (setUtils.has(activeMarks, mark)) {\n    controller.command(removeMarkAtRange, range, mark);\n  } else {\n    controller.command(addMarkAtRange, range, mark);\n  }\n  return controller;\n}\n\n/**\n * 在当前的选区内，删除mark\n * 1. 如果选区是expand，会设删除当前选中内容的mark\n * 2. 如果选区是collapse，会删除当前的selection的mark\n */\nexport function removeMark(controller: Controller, m: Mark) {\n  const mark = Mark.create(m);\n  const { value } = controller;\n  const { document, selection } = value;\n\n  if (selection.isExpanded) {\n    return controller.command(removeMarkAtRange, selection, mark);\n  }\n  const activeMarks =\n    selection.marks || document.getActiveMarksAtRange(selection);\n  const sel = selection.set('marks', setUtils.remove(activeMarks, mark));\n  return controller.command('select', sel);\n}\n\n/**\n * 在指定的选区内，删除mark\n * 1. 如果选区是collapse，什么都不做\n */\nexport function removeMarkAtRange(\n  controller: Controller,\n  range: Selection,\n  mark: Mark,\n) {\n  if (range.isCollapsed) return controller;\n\n  const { value } = controller;\n  const { document } = value;\n  const { start, end } = range.convertToTextPoints(document);\n  const texts = document.getTextsAtRange(range);\n  controller.withoutNormalizing(() => {\n    texts.forEach((node) => {\n      const { key } = node;\n      let offset = 0;\n      let { length } = node.text;\n\n      if (key === start.key) ({ offset } = start);\n      if (key === end.key) length = end.offset;\n      if (key === start.key && key === end.key) {\n        length = end.offset - start.offset;\n      }\n\n      controller.command(removeMarkByKey, key, offset, length, mark);\n    });\n  });\n  return controller;\n}\n\n/**\n * 对指定的节点，删除mark\n * 1. 如果指定的节点无效，会抛异常\n */\nexport function removeMarkByKey(\n  controller: Controller,\n  key: string,\n  offset: number,\n  length: number,\n  mark: Mark,\n) {\n  const { value } = controller;\n  const { document } = value;\n  const path = document.assertPath(key);\n  return controller.command(removeMarkByPath, path, offset, length, mark);\n}\n\n/**\n * 对指定的节点，删除mark\n * 1. 如果指定的节点无效，会抛异常\n */\nexport function removeMarkByPath(\n  controller: Controller,\n  path: Path,\n  offset: number,\n  length: number,\n  mark: Mark,\n) {\n  const text = controller.value.document.getNodeByPath(path) as Text;\n  let totalOffset = 0;\n  text.leaves.forEach(leaf => {\n    // current start offset\n    const o = totalOffset;\n    const leafLength = leaf.text.length;\n    totalOffset += leafLength;\n\n    if (o + leafLength < offset || o > offset + length) return;\n\n    if (!setUtils.has(leaf.marks, mark)) return;\n\n    const start = Math.max(offset, o);\n    const end = Math.min(offset + length, o + leafLength);\n    controller.applyOperation({\n      type: OperationType.RemoveMark,\n      path,\n      offset: start,\n      length: end - start,\n      mark,\n    });\n  });\n  return controller;\n}\n\n/**\n * 对指定的节点，替换或者添加mark\n * 1. 如果指定的节点无效，会抛异常\n */\nexport function replaceMark(\n  controller: Controller,\n  oldMark: Mark,\n  newMark: Mark,\n) {\n  return controller.command(removeMark, oldMark).command(addMark, newMark);\n}\n","/* eslint-disable prefer-destructuring */\n/**\n * @packageDocumentation\n * @module Commands\n */\nimport { takeRightWhile } from 'lodash-es';\nimport Controller from '../controller/index';\nimport Node from '../models/node';\nimport Selection from '../models/selection';\nimport Block from '../models/block';\nimport Text from '../models/text';\nimport { removeNodeByKey, removeTextByKey } from './remove';\nimport { mergeNodeByKey } from './merge';\nimport { moveNodeByKey } from './move';\nimport {\n  select,\n  moveAnchorBackward,\n  moveToAnchor,\n  moveToStartOfNextBlock,\n} from './selection';\nimport {\n  MoveUnit,\n  pointAtEndOfNode,\n  pointAtStartOfNode,\n  pointAtDistance,\n} from '../queries/selection';\nimport textUtils from '../utils/textUtils';\nimport { insertEmptyBlock } from './insert';\nimport { EdgePoint, TextPoint } from '../models/point';\nimport { removeMarkByKey } from './mark';\n\n/**\n * 删除 Selection 内的所有内容\n */\nexport function deleteAtRange(controller: Controller, range: Selection) {\n  const { value } = controller;\n  let { document } = value;\n\n  let { start, end } = range.sort(document);\n\n  // edge point - shim them for hanging positions\n  if (start.isEdgePoint() && start.edge === EdgePoint.AFTER) {\n    start = controller.query(pointAtDistance, start, 1);\n  }\n  if (end.isEdgePoint() && end.edge === EdgePoint.BEFORE) {\n    end = controller.query(pointAtDistance, end, -1);\n  }\n\n  const detectSelection = Selection.create({ anchor: start, focus: end });\n  if (\n    detectSelection.isCollapsedAtEdge ||\n    detectSelection.isBackward(document)\n  ) {\n    return controller;\n  }\n\n  // edge point - delete them\n  if (start.isEdgePoint()) {\n    const node = controller.value.document.getNode(start.key);\n    controller\n      .command(insertEmptyBlock, start)\n      .command(removeNodeByKey, start.key);\n    if (start.key === end.key || (node?.isElement() && node.hasNode(end.key))) {\n      return controller;\n    }\n    // selection is focused to the new text point\n    start = controller.value.selection.anchor as TextPoint;\n  }\n  if (end.isEdgePoint()) {\n    const node = controller.value.document.getNode(end.key);\n    controller.command(insertEmptyBlock, end).command(removeNodeByKey, end.key);\n    if (node?.isElement() && node.hasNode(start.key)) {\n      return controller;\n    }\n    // selection is focused to the new text point\n    end = controller.value.selection.anchor as TextPoint;\n  }\n  document = controller.value.document;\n\n  // now [start, end] are text points\n  let startOffset = start.offset;\n  let endOffset = end.offset;\n  let startKey = start.key;\n  let endKey = end.key;\n  const startText = document.assertNode(start.key);\n  const endText = document.assertNode(end.key);\n\n  let startBlock = document.assertClosestBlock(startKey);\n  let endBlock = document.assertClosestBlock(endKey);\n\n  const isCrossBlock = startBlock.key !== endBlock.key;\n\n  const isStartVoid = document.hasVoidParent(startKey, controller);\n  const isEndVoid = document.hasVoidParent(endKey, controller);\n\n  // BACKGROUND: Hanging Selection\n  // If we select from one paragraph start point to another paragraph start point.\n  // The selected content user sees is the first paragraph.\n  // If we do a delete on hanging selection, we should delete selection that user sees.\n  const isHanging =\n    startOffset === 0 &&\n    endOffset === 0 &&\n    isStartVoid === false &&\n    isEndVoid === false &&\n    startKey === startBlock.getFirstNode().key &&\n    endKey === endBlock.getFirstNode().key &&\n    startKey !== endKey;\n\n  // Remove all text nodes between start block & end block\n  controller.withoutNormalizing(() => {\n    const removeNode = (node: Node) => {\n      controller.command(removeNodeByKey, node.key);\n    };\n\n    // In a single text node\n    if (startKey === endKey && !isHanging && !isStartVoid) {\n      controller.command(\n        removeTextByKey,\n        startKey,\n        startOffset,\n        startText.text.slice(startOffset, endOffset),\n      );\n      return controller;\n    }\n\n    // Remove selected text in start text node\n    if (startText && startText.text.length - startOffset > 0) {\n      controller.command(\n        removeTextByKey,\n        startKey,\n        startOffset,\n        startText.text.slice(startOffset),\n      );\n    }\n\n    // Remove selected text in end text node\n    if (endText && endOffset > 0) {\n      controller.command(\n        removeTextByKey,\n        endKey,\n        0,\n        endText.text.slice(0, endOffset),\n      );\n    }\n\n    if (startKey !== endKey) {\n      // Remove nodes between start text and end text\n      const ancestor = document.assertCommonAncestor(startKey, endKey);\n      const ancestorNodes = ancestor.nodes;\n      const startChild = ancestor.assertFurthestAncestor(startKey);\n      const endChild = ancestor.assertFurthestAncestor(endKey);\n\n      // Remove nodes from bottom to top in start child\n      let child = startText;\n\n      while (child.key !== startChild.key) {\n        const parent = document.assertParent(child.key);\n        const afters = parent.nodes.slice(parent.nodes.indexOf(child) + 1);\n        afters.forEach(removeNode);\n        child = parent;\n      }\n\n      // Remove nodes between start child & end child\n      const middles = ancestorNodes.slice(\n        ancestorNodes.indexOf(startChild) + 1,\n        ancestorNodes.indexOf(endChild),\n      );\n\n      middles.forEach(removeNode);\n\n      // Remove nodes from top to bottom in end child\n      child = endText;\n\n      while (child.key !== endChild.key) {\n        const parent = document.assertParent(child.key);\n        const befores = parent.nodes.slice(0, parent.nodes.indexOf(child));\n        befores.forEach(removeNode);\n        child = parent;\n      }\n    }\n\n    document = controller.value.document;\n\n    // Find and remove furthest void ancestor\n    if (isStartVoid) {\n      const startVoidAncestor = document.getFurthsestVoid(\n        startKey,\n        controller,\n      )!;\n      const nextText = document.getNextText(startVoidAncestor.key);\n      removeNode(startVoidAncestor);\n      if (startKey === endKey) {\n        return controller;\n      }\n      // Move start to the start of next text\n      if (!nextText) {\n        // If we can't find the next text, we're done\n        return controller;\n      }\n      startKey = nextText.key;\n      startOffset = 0;\n      document = controller.value.document;\n    }\n\n    if (isEndVoid) {\n      const endVoidAncestor = document.getFurthsestVoid(endKey, controller)!;\n      const prevText = document.getPreviousText(endVoidAncestor.key);\n      removeNode(endVoidAncestor);\n      // Move end to the end of previous text\n      if (!prevText) {\n        return controller;\n      }\n      if (startKey === endKey) {\n        // endKey is removed!\n        startKey = prevText.key;\n        startOffset = prevText.text.length;\n      }\n      endKey = prevText.key;\n      endOffset = prevText.text.length;\n      document = controller.value.document;\n    }\n    startBlock = document.getClosestBlock(startKey)!;\n    endBlock = document.getClosestBlock(endKey)!;\n\n    if (endKey === startKey) {\n      if (isHanging) {\n        return removeNode(startBlock);\n      }\n\n      if (isCrossBlock && document.getPreviousSibling(endBlock.key)) {\n        return controller.command(mergeNodeByKey, endBlock.key);\n      }\n    }\n\n    if (!startBlock) {\n      return controller;\n    }\n\n    const startParent = document.getParent(startBlock.key)!;\n    const startParentIndex = startParent.nodes.indexOf(startBlock);\n    const endParentIndex = startParent.nodes.indexOf(endBlock);\n\n    // Move the end block into start block and merge them\n    if (startBlock.key !== endBlock.key) {\n      // If end block's ancestor is empty after merge, we should remove it\n      const ancestors = document.getAncestors(endBlock.key);\n      const lonely = ancestors\n        ? takeRightWhile(\n            // Ignore document\n            ancestors.slice(1),\n            (node) => node.nodes.length <= 1,\n          )[0]\n        : null;\n\n      // Put end block under the start block\n      if (endParentIndex !== startParentIndex + 1) {\n        controller.command(\n          moveNodeByKey,\n          endBlock.key,\n          startParent.key,\n          startParentIndex + 1,\n        );\n      }\n\n      // If selection is hanging, we should remove start block(what user sees)\n      if (isHanging) {\n        removeNode(startBlock);\n      } else {\n        controller.command(mergeNodeByKey, endBlock.key);\n      }\n\n      if (lonely) {\n        removeNode(lonely);\n      }\n    }\n\n    return controller;\n  });\n\n  document = controller.value.document;\n\n  const { start: rangeStart } =\n    controller.value.selection.convertToTextPoints(document);\n  const closest = document.getClosestBlock(rangeStart.key);\n  const isEmptyParagraph =\n    Text.isTextList(closest?.nodes) && closest?.text === '';\n\n  return controller.withoutNormalizing(() => {\n    const nextStart = document.getNode(startKey);\n    const nextEnd = document.getNode(endKey);\n    if (!nextStart && !nextEnd) return;\n\n    if (!nextStart || !nextEnd || nextStart.key === nextEnd.key) {\n      // only one or same\n      const nextNode = nextStart || nextEnd;\n      if (!isEmptyParagraph && Text.isText(nextNode) && nextNode.text === '') {\n        // don't keep empty text node with marks in non-empty paragraph\n        nextNode.marks.forEach((mark) => {\n          controller.command(removeMarkByKey, nextNode.key, 0, 1, mark);\n        });\n      }\n      return;\n    }\n    const isSibling =\n      document.getNextSibling(nextStart.key)?.key === nextEnd.key;\n    // start and end is not sibling when one of them in inline node\n    if (!isSibling) return;\n\n    if (Text.isText(nextEnd) && nextEnd.text === '') {\n      // empty end text node is useless\n      controller.command(removeNodeByKey, nextEnd.key);\n    }\n\n    if (!isEmptyParagraph && Text.isText(nextStart) && nextStart.text === '') {\n      // don't keep empty text node with marks in non-empty paragraph\n      nextStart.marks.forEach((mark) => {\n        controller.command(removeMarkByKey, nextStart.key, 0, 1, mark);\n      });\n    }\n  });\n}\n\n/**\n * 删除当前Selection内的所有内容\n * 1. 将选区开头的样式设置到 selection.marks 中\n */\nexport function del(controller: Controller) {\n  const { selection, document } = controller.value;\n  const { start } = selection.convertToTextPoints(document);\n  const startNode = document.getNode(start.key);\n  const startMarks = Text.isText(startNode)\n    ? document.getMarksAtPosition(start.key, start.offset + 1)\n    : [];\n  controller.command('deleteAtRange', selection);\n  let range = controller.value.selection;\n\n  // set selection.marks to make sure inherit marks from deleted text\n  range = range.set('marks', startMarks);\n  return controller.command(select, range.moveToFocus());\n}\n\n/**\n * 在指定selection上，进行往后删除。\n * @range 如果是expand选区，会删除选区内的内容，并忽略掉后续参数；否则从anchor点往后计算n个unit进行删除\n */\nexport function deleteBackwardAtRange(\n  controller: Controller,\n  range: Selection,\n  n = 1,\n  unit?: MoveUnit,\n) {\n  const { document } = controller.value;\n  if (range.isExpanded) {\n    return controller.command(del);\n  }\n  let { anchor } = range;\n  if (anchor.isEdgePoint()) {\n    const isBackward = n >= 0;\n    const point = anchor;\n    const deleteEdge = isBackward ? EdgePoint.AFTER : EdgePoint.BEFORE;\n    const isToDelete = point.edge === deleteEdge;\n    if (isToDelete) {\n      // 在 edge block 的后面。直接删除掉，并插入新的段落\n      return controller\n        .command(insertEmptyBlock, point)\n        .command(removeNodeByKey, point.key);\n    } else {\n      // 在 edge block 的非删除边缘。需要看前/后一个 block。\n      // 如果前/后一个 block 是空的，直接删掉；否则移动到末尾。\n      const siblingBlock = isBackward\n        ? document.getPreviousBlock(point.key)\n        : document.getNextBlock(point.key);\n      if (!siblingBlock) {\n        return controller;\n      }\n      const closestBlock = document.getClosestSelectableBlock(\n        siblingBlock.key,\n        controller,\n      );\n      anchor = point;\n      if (closestBlock || siblingBlock.text || siblingBlock.nodes.length > 1) {\n        anchor = controller.query(\n          isBackward ? pointAtEndOfNode : pointAtStartOfNode,\n          siblingBlock,\n        );\n      } else {\n        controller.command(removeNodeByKey, siblingBlock.key);\n      }\n      const focus = anchor;\n      return controller.command(select, Selection.create({ anchor, focus }));\n    }\n  }\n  // if we're in a void block, remove it\n  const voidParent = document.getClosestVoid(anchor.key, controller);\n  if (voidParent) {\n    if (document.nodes.length === 1 && document.nodes[0] === voidParent) {\n      controller.command(\n        insertEmptyBlock,\n        EdgePoint.create({\n          key: voidParent.key,\n          edge: EdgePoint.BEFORE,\n        }),\n      );\n    }\n    return controller.command(removeNodeByKey, voidParent.key);\n  }\n\n  // if we're in a empty block, remove it\n  const block = document.getClosestBlock(anchor.key);\n  if (\n    document.nodes.length !== 1 &&\n    block &&\n    block.text === '' &&\n    block.nodes.length === 1\n  ) {\n    controller.command(removeNodeByKey, block.key);\n    // 向后删除时，光标移动到删除段落的下一段\n    if (n === -1) {\n      controller.command(moveToStartOfNextBlock);\n    }\n    return controller;\n  }\n  controller.command(moveAnchorBackward, n, unit);\n  const { selection: updatedSelection } = controller.value;\n  const updatedAnchor = updatedSelection?.anchor;\n  if (updatedAnchor?.isEdgePoint()) {\n    return controller.command(moveToAnchor);\n  }\n  return controller.command(del);\n}\n\n/**\n * 在指定selection上，进行往前删除。\n * @range 如果是expand选区，会删除选区内的内容，并忽略掉后续参数；否则从anchor点往前计算n个unit进行删除\n */\nexport function deleteForwardAtRange(\n  controller: Controller,\n  range: Selection,\n  n = 1,\n  unit?: MoveUnit,\n) {\n  return deleteBackwardAtRange(controller, range, -n, unit);\n}\n\n/**\n * 从所有当前选区的位置，往后删除n个offset\n */\nexport function deleteBackward(controller: Controller, n = 1) {\n  const { selection } = controller.value;\n  return controller.command(deleteBackwardAtRange, selection, n);\n}\n\n/**\n * 从所有当前选区的位置，往前删除n个offset\n */\nexport function deleteForward(controller: Controller, n = 1) {\n  return controller.command(deleteBackward, -n);\n}\n\nfunction createDeleteBoundry(dir: 'backward' | 'forward') {\n  return function deleteBoundray(\n    controller: Controller,\n    getBoundaryOrIteratePositionsFromPoint:\n      | ((block: Block, offset: number) => number)\n      | number,\n    unit?: MoveUnit,\n  ) {\n    const isBackward = dir === 'backward';\n    const { selection } = controller.value;\n\n    const defaultBoundary = 1;\n    let boundary =\n      typeof getBoundaryOrIteratePositionsFromPoint === 'number'\n        ? getBoundaryOrIteratePositionsFromPoint\n        : defaultBoundary;\n    if (selection.anchor.isTextPoint()) {\n      const { document } = controller.value;\n      const { anchor } = selection;\n      const block = document.getClosestBlock(anchor.key)!;\n      if (!block) {\n        return controller;\n      }\n      const offset = block.getOffset(anchor.key);\n      if (typeof getBoundaryOrIteratePositionsFromPoint === 'function') {\n        boundary = getBoundaryOrIteratePositionsFromPoint(\n          block,\n          offset + anchor.offset,\n        );\n      }\n    }\n    return controller.command(\n      isBackward ? deleteBackwardAtRange : deleteForwardAtRange,\n      selection,\n      boundary,\n      unit,\n    );\n  };\n}\n\n/**\n * @ignore\n */\nexport const deleteBoundrayBackward = createDeleteBoundry('backward');\n\n/**\n * @ignore\n */\nexport const deleteBoundrayForward = createDeleteBoundry('forward');\n\n/**\n * 从所有当前选区的位置，往后删除1个文字（大多情况下，1个文字等于1个offset，但是1个emoji可能对应多个offset）\n */\nexport function deleteCharBackward(controller: Controller) {\n  return controller.command(deleteBoundrayBackward, 1);\n}\n\n/**\n * 从所有当前选区的位置，往前删除1个文字（大多情况下，1个文字等于1个offset，但是1个emoji可能对应多个offset）\n */\nexport function deleteCharForward(controller: Controller) {\n  return controller.command(deleteBoundrayForward, 1);\n}\n\n/**\n * 从所有当前选区的位置，往后删除1个词\n */\nexport function deleteWordBackward(controller: Controller) {\n  return controller.command(deleteBoundrayBackward, 1, 'word');\n}\n\n/**\n * 从所有当前选区的位置，往前删除1个词\n */\nexport function deleteWordForward(controller: Controller) {\n  return controller.command(deleteBoundrayForward, 1, 'word');\n}\n\n/**\n * 从所有当前选区的位置，往后删除1行文字\n */\nexport function deleteLineBackward(controller: Controller) {\n  return controller.command(deleteBoundrayBackward, (startBlock, offset) => {\n    return textUtils.countBreaks(startBlock.text, offset);\n  });\n}\n\n/**\n * 从所有当前选区的位置，往前删除1行文字\n */\nexport function deleteLineForward(controller: Controller) {\n  return controller.command(deleteBoundrayForward, (startBlock, offset) => {\n    return textUtils.countBreaks(startBlock.text, offset, true);\n  });\n}\n","/**\n * @packageDocumentation\n * @module Commands\n */\nimport Controller from '../controller/index';\nimport Mark from '../models/mark';\nimport Path from '../models/path';\nimport Selection from '../models/selection';\nimport { TextPoint } from '../models/point';\nimport { removeTextByPath, removeNodeByPath } from './remove';\nimport { insertTextByPath, insertNodeByPath } from './insert';\nimport setUtils from '../utils/setUtils';\nimport Node from '../models/node';\n\n/**\n * 在指定的位置上，替换node\n */\nexport function replaceNodeByKey(\n  controller: Controller,\n  key: string,\n  newNode: Node,\n) {\n  const { document } = controller.value;\n  const path = document.getPath(key);\n  if (!path) {\n    return controller;\n  }\n  return controller.command(replaceNodeByPath, path, newNode);\n}\n\n/**\n * 在指定的位置上，替换node\n */\nexport function replaceNodeByPath(\n  controller: Controller,\n  path: Path,\n  newNode: Node,\n) {\n  const index = path[path.length - 1];\n  const parentPath = Path.parent(path);\n\n  return controller.withoutNormalizing(() => {\n    controller\n      .command(removeNodeByPath, path)\n      .command(insertNodeByPath, parentPath, index, newNode);\n  });\n}\n\n/**\n * 在指定的位置上，替换文本，并附加marks\n * 1. 提过oldText长度大于可用长度，按照可用长度计算\n */\nexport function replaceTextByKey(\n  controller: Controller,\n  key: string,\n  offset: number,\n  oldText: string,\n  text: string,\n  marks?: Mark[],\n) {\n  const { value } = controller;\n  const { document } = value;\n\n  const path = document.assertPath(key);\n  return controller.command(\n    replaceTextByPath,\n    path,\n    offset,\n    oldText,\n    text,\n    marks,\n  );\n}\n\n/**\n * 在指定的位置上，替换文本，并附加marks\n * 1. 提过oldText长度大于可用长度，按照可用长度计算\n */\nexport function replaceTextByPath(\n  controller: Controller,\n  path: Path,\n  offset: number,\n  oldText: string,\n  text: string,\n  marks: Mark[] = [],\n) {\n  const { value } = controller;\n  const { document } = value;\n\n  const node = document.assertNodeByPath(path);\n  const activeMarks = document.getActiveMarksAtRange(\n    Selection.create({\n      anchor: TextPoint.create({ key: node.key, offset }),\n      focus: TextPoint.create({ key: node.key, offset: offset + oldText.length }),\n    }),\n  );\n  const mergedMarks = setUtils.union(\n    marks,\n    activeMarks,\n    (a, b) => a.type === b.type,\n  );\n\n  return controller.withoutNormalizing(() => {\n    controller\n      .command(removeTextByPath, path, offset, oldText)\n      .command(\n        insertTextByPath,\n        path,\n        offset,\n        text,\n        mergedMarks.map(Mark.create),\n      );\n  });\n}\n","/**\n * @packageDocumentation\n * @module Commands\n */\nimport Controller from '../controller/index';\nimport Path from '../models/path';\nimport Node from '../models/node';\nimport { OperationType, Properties } from '../models/operation';\nimport Element from '../models/element';\nimport Selection from '../models/selection';\nimport Mark, { MarkProperties } from '../models/mark';\nimport { replaceTextByPath } from './replace';\n\nexport function setNodeByKey(\n  controller: Controller,\n  key: string,\n  properties: Properties,\n) {\n  const { value } = controller;\n  const { document } = value;\n\n  const path = document.assertPath(key);\n  return controller.command(setNodeByPath, path, properties);\n}\n\nexport function setNodeByPath(\n  controller: Controller,\n  path: Path,\n  properties: Properties,\n) {\n  const prevNode = controller.value.document.assertNodeByPath(path);\n  const prevProperties = Element.isElement(prevNode)\n    ? { type: prevNode.type, data: prevNode.data }\n    : {};\n\n  return controller.applyOperation({\n    type: OperationType.SetNode,\n    path: [...path],\n    properties: Node.createProperties(properties),\n    prevProperties,\n  });\n}\n\nexport function setBlocks(controller: Controller, properties: Properties) {\n  const { selection } = controller.value;\n  return controller.command(setBlocksAtRange, selection, properties);\n}\n\nexport function setBlocksAtRange(\n  controller: Controller,\n  selection: Selection,\n  properties: Properties,\n) {\n  const { value } = controller;\n  const { document } = value;\n\n  const { start, end } = selection.convertToTextPoints(document);\n\n  const hasVoidParent = document.hasVoidParent(start.key, controller);\n  const startBlock = document.getClosestBlock(start.key);\n  const endBlock = document.getClosestBlock(end.key);\n\n  const startNodeKey = startBlock ? startBlock.getFirstNode().key : null;\n  const endNodeKey = endBlock ? endBlock.getLastNode().key : null;\n\n  // Check the \"Hanging Selection\" case for UX reasons.\n  // For more detail, go read the comments in [deleteAtRange]\n  const isHanging =\n    selection.isCollapsed === false &&\n    hasVoidParent === false &&\n    start.offset === 0 &&\n    end.offset === 0 &&\n    start.key === startNodeKey &&\n    end.key === endNodeKey &&\n    start.key !== end.key;\n\n  const allBlocks = document.getLeafBlocksAtRange(selection);\n  const blocks = isHanging ? allBlocks.slice(0, -1) : allBlocks;\n\n  return controller.withoutNormalizing(() => {\n    blocks.forEach((block) => {\n      controller.command('setNodeByKey', block.key, properties);\n    });\n  });\n}\n\nexport function setInlines(controller: Controller, properties: Properties) {\n  const { selection } = controller.value;\n  return controller.command(setInlinesAtRange, selection, properties);\n}\n\nexport function setInlinesAtRange(\n  controller: Controller,\n  selection: Selection,\n  properties: Properties,\n) {\n  const { value } = controller;\n  const { document } = value;\n\n  return controller.withoutNormalizing(() => {\n    const inlines = document.getLeafInlinesAtRange(selection);\n    inlines.forEach((inline) => {\n      controller.command('setNodeByKey', inline.key, properties);\n    });\n  });\n}\n\nexport function setMarkByKey(\n  controller: Controller,\n  key: string,\n  offset: number,\n  length: number,\n  mark: Mark | MarkProperties | string,\n  properties: Properties,\n) {\n  const { value } = controller;\n  const { document } = value;\n  const path = document.assertPath(key);\n  return controller.command(\n    setMarkByPath,\n    path,\n    offset,\n    length,\n    mark,\n    properties,\n  );\n}\n\nexport function setMarkByPath(\n  controller: Controller,\n  path: Path,\n  offset: number,\n  length: number,\n  m: Mark | MarkProperties | string,\n  properties: Properties,\n) {\n  const mark = Mark.create(m);\n\n  return controller.applyOperation({\n    type: OperationType.SetMark,\n    path,\n    offset,\n    length,\n    mark,\n    properties,\n  });\n}\n\nexport function setTextByKey(\n  controller: Controller,\n  key: string,\n  text: string,\n  marks?: Mark[],\n) {\n  const { value } = controller;\n  const { document } = value;\n\n  const path = document.assertPath(key);\n  return controller.command(setTextByPath, path, text, marks);\n}\n\nexport function setTextByPath(\n  controller: Controller,\n  path: Path,\n  text: string,\n  marks?: Mark[],\n) {\n  const { value } = controller;\n  const { document } = value;\n\n  const node = document.assertNodeByPath(path);\n  return controller.command(replaceTextByPath, path, 0, node.text, text, marks);\n}\n","export const wrapInlineTpl = () => 'cj/cmd/wrapinline';\n","/**\n * @packageDocumentation\n * @module Commands\n */\nimport Controller from '../controller/index';\nimport Block, { BlockChild, BlockProperties } from '../models/block';\nimport Inline, { InlineProperties } from '../models/inline';\nimport Path from '../models/path';\nimport Selection from '../models/selection';\nimport { TextPoint } from '../models/point';\nimport {\n  insertTextAtRange,\n  insertNodeByKey,\n  insertNodeByPath,\n  insertInlineAtRange,\n} from './insert';\nimport { select } from './selection';\nimport { moveNodeByKey, moveNodeByPath } from './move';\nimport listUtils from '../utils/listUtils';\nimport { splitDescendantsByKey } from './split';\nimport { wrapInlineTpl } from '../contexts/wrap';\n\n/**\n * 在当前选区的start和end位置，插入一些文字，并更新选区位置。\n * 1. 不区分range是否是collapse\n */\nexport function wrapText(\n  controller: Controller,\n  prefix: string,\n  suffix = prefix,\n) {\n  const { value } = controller;\n  const { selection, document } = value;\n\n  controller.command(wrapTextAtRange, selection, prefix, suffix);\n\n  let sel = controller.value.selection;\n  if (selection.isCollapsed) {\n    sel = sel.moveStartBackward(document, prefix.length);\n  }\n\n  // Adding the suffix will have pushed the end of the selection further on, so\n  // we need to move it back to account for this.\n  sel = sel.moveEndBackward(document, suffix.length);\n\n  return controller.command(select, sel);\n}\n\n/**\n * 在选区的start和end位置，插入一些文字\n * 1. 不区分range是否是collapse\n * 2. 此方法不会更新选区位置\n */\nexport function wrapTextAtRange(\n  controller: Controller,\n  range: Selection,\n  prefix: string,\n  suffix: string = prefix,\n) {\n  const { value } = controller;\n  const { document } = value;\n  const startRange = range.moveToStart(document);\n  const endRange = range.moveToEnd(document);\n\n  controller.withoutNormalizing(() => {\n    controller.command(insertTextAtRange, endRange, suffix);\n    controller.command(insertTextAtRange, startRange, prefix);\n  });\n  return controller;\n}\n\n/**\n * 在range的公共父节点上插入block，然后把range对应的nodes都转到block中\n */\nexport function wrapBlock(\n  controller: Controller,\n  block: Block | BlockProperties | string,\n) {\n  const { selection } = controller.value;\n  return controller.command(wrapBlockAtRange, selection, block);\n}\n\n/**\n * 在range的公共父节点上插入block，然后把range对应的nodes都转到block中\n */\nexport function wrapBlockAtRange(\n  controller: Controller,\n  range: Selection,\n  b: Block | BlockProperties | string,\n) {\n  let block = Block.create(b);\n  block = block.set('nodes', []);\n\n  const { value } = controller;\n  const { document } = value;\n\n  const blocks = document.getLeafBlocksAtRange(range);\n  const firstblock = blocks[0];\n  const lastblock = blocks[blocks.length - 1];\n  let parent;\n  let siblings;\n  let index;\n\n  if (blocks.length === 1) {\n    parent = document.getParent(firstblock.key);\n    siblings = blocks;\n  } else {\n    parent = document.getCommonAncestor(firstblock.key, lastblock.key);\n  }\n\n  // If no shared parent could be found then the parent is the document.\n  if (parent == null) {\n    parent = document;\n  }\n\n  // Create a list of direct children siblings of parent that fall in the\n  // selection.\n  if (siblings == null) {\n    const indexes = parent.nodes.reduce((ind, node, i) => {\n      // eslint-disable-next-line no-param-reassign\n      if (node === firstblock || node.getNode(firstblock.key)) ind[0] = i;\n      // eslint-disable-next-line no-param-reassign\n      if (node === lastblock || node.getNode(lastblock.key)) ind[1] = i;\n      return ind;\n    }, []);\n\n    [index] = indexes;\n    siblings = parent.nodes.slice(indexes[0], indexes[1] + 1);\n  }\n\n  // Get the index to place the new wrapped node at.\n  if (index == null) {\n    index = parent.nodes.indexOf(siblings[0]);\n  }\n\n  controller.withoutNormalizing(() => {\n    // Inject the new block node into the parent.\n    controller.command(insertNodeByKey, parent.key, index, block);\n\n    // Move the sibling nodes into the new block node.\n    siblings.forEach((node, i) => {\n      controller.command(moveNodeByKey, node.key, block.key, i);\n    });\n  });\n  return controller;\n}\n\n/**\n * 把目标节点插入到一个新的block节点中，并把block放到原来的节点的位置\n */\nexport function wrapBlockByKey(\n  controller: Controller,\n  key: string,\n  block: Block | BlockProperties | string,\n) {\n  const { value } = controller;\n  const { document } = value;\n  const path = document.assertPath(key);\n  return controller.command(wrapBlockByPath, path, Block.create(block));\n}\n\n/**\n * 把目标节点插入到一个新的block节点中，并把block放到原来的节点的位置\n */\nexport function wrapBlockByPath(\n  controller: Controller,\n  path: Path,\n  b: Block | BlockProperties | string,\n) {\n  const block = Block.create(b).set('nodes', []);\n  const parentPath = Path.parent(path);\n  const index = path[path.length - 1];\n  const newPath = Path.increment(path);\n\n  controller.withoutNormalizing(() => {\n    controller.command(insertNodeByPath, parentPath, index, block);\n    controller.command(moveNodeByPath, newPath, path, 0);\n  });\n  return controller;\n}\n\n/**\n * 把当前选区wrap一个inline\n * 1. 如果range是collapse，则把对应节点的最近void inline节点进行wrap；\n * 如果没有最近的void inline，则什么都不做\n * 2. 如果选区里有block，会在每个block内部进行wrap inline操作\n */\nexport function wrapInline(\n  controller: Controller,\n  inline: Inline | InlineProperties | string,\n) {\n  const { selection } = controller.value;\n  return controller.command(wrapInlineAtRange, selection, inline);\n}\n\n/**\n * 把当前选区wrap一个inline\n * 1. 如果range是collapse，则把对应节点的最近void inline节点进行wrap；\n * 如果没有最近的void inline，则什么都不做\n * 2. 如果选区里有block，会在每个block内部进行wrap inline操作\n */\nexport function wrapInlineAtRange(\n  controller: Controller,\n  range: Selection,\n  i: Inline | InlineProperties | string,\n) {\n  const { value } = controller;\n  let { document } = value;\n  const { start, end } = range.convertToTextPoints(document);\n\n  let inline = Inline.create(i);\n  if (range.isCollapsed) {\n    // Wrapping an inline void\n    const inlineParent = document.getClosestInline(start.key);\n\n    if (!inlineParent) {\n      return controller;\n    }\n\n    if (!controller.query('isVoid', inlineParent)) {\n      return controller;\n    }\n\n    return controller.command(wrapInlineByKey, inlineParent.key, inline);\n  }\n\n  inline = inline.set('nodes', []);\n\n  const blocks = document.getLeafBlocksAtRange(range);\n  let startBlock = document.getClosestBlock(start.key);\n  let endBlock = document.getClosestBlock(end.key);\n  const startInline = document.getClosestInline(start.key);\n  const endInline = document.getClosestInline(end.key);\n  let startChild = startBlock!.getFurthestAncestor(start.key)! as BlockChild;\n  let endChild = endBlock!.getFurthestAncestor(end.key)! as BlockChild;\n\n  controller.withOpContext(wrapInlineTpl(), () => {\n    controller.withoutNormalizing(() => {\n      if (!startInline || startInline !== endInline) {\n        controller.command(\n          splitDescendantsByKey,\n          endChild.key,\n          end.key,\n          end.offset,\n        );\n        controller.command(\n          splitDescendantsByKey,\n          startChild.key,\n          start.key,\n          start.offset,\n        );\n      }\n  \n      ({ document } = controller.value);\n      startBlock = document.getNode(startBlock!.key) as Block;\n      endBlock = document.getNode(endBlock!.key) as Block;\n      startChild = startBlock!.getFurthestAncestor(start.key)! as BlockChild;\n      endChild = endBlock!.getFurthestAncestor(end.key)! as BlockChild;\n      const startIndex = startBlock.nodes.indexOf(startChild);\n      const endIndex = endBlock.nodes.indexOf(endChild);\n  \n      if (startInline && startInline === endInline) {\n        const text = document\n          .getTextsAtRange(range)[0]\n          .splitText(start.offset)[1]\n          .splitText(end.offset - start.offset)[0];\n  \n        inline = inline.set('nodes', [text]);\n        controller.command(insertInlineAtRange, range, inline);\n  \n        const inlinekey = text.key;\n        const anchor = TextPoint.create({\n          key: inlinekey,\n          offset: 0,\n        });\n        const focus = TextPoint.create({\n          key: inlinekey,\n          offset: end.offset - start.offset,\n        });\n        const rng = Selection.create({\n          anchor,\n          focus,\n        });\n        controller.command(select, rng);\n      } else if (startBlock === endBlock) {\n        ({ document } = controller.value);\n        startBlock = document.getClosestBlock(start.key)!;\n        startChild = startBlock!.getFurthestAncestor(start.key)! as BlockChild;\n  \n        const startInner = document.getNextSibling(startChild.key) as BlockChild;\n        const startInnerIndex = startBlock!.nodes.indexOf(startInner!);\n        const endInner =\n          start.key === end.key\n            ? startInner\n            : startBlock.getFurthestAncestor(end.key) as BlockChild;\n  \n        let inlines = listUtils.skipUntil(\n          startBlock.nodes,\n          (n) => n === startInner,\n        );\n        inlines = listUtils.takeUntil(inlines, (n) => n === endInner);\n        inlines.push(endInner!);\n  \n        const node = inline.regenerateKey();\n  \n        controller.command(\n          insertNodeByKey,\n          startBlock.key,\n          startInnerIndex,\n          node,\n        );\n  \n        inlines.forEach((child, idx) => {\n          controller.command(moveNodeByKey, child.key, node.key, idx);\n        });\n      } else {\n        const startInlines = startBlock.nodes.slice(startIndex + 1);\n        const endInlines = endBlock.nodes.slice(0, endIndex + 1);\n        const startNode = inline.regenerateKey();\n        const endNode = inline.regenerateKey();\n  \n        controller.command(\n          insertNodeByKey,\n          startBlock.key,\n          startIndex + 1,\n          startNode,\n        );\n        controller.command(insertNodeByKey, endBlock.key, endIndex, endNode);\n  \n        startInlines.forEach((child, idx) => {\n          controller.command(moveNodeByKey, child.key, startNode.key, idx);\n        });\n  \n        endInlines.forEach((child, idx) => {\n          controller.command(moveNodeByKey, child.key, endNode.key, idx);\n        });\n  \n        blocks.slice(1, -1).forEach((block) => {\n          const node = inline.regenerateKey();\n          controller.command(insertNodeByKey, block.key, 0, node);\n  \n          block.nodes.forEach((child, idx) => {\n            controller.command(moveNodeByKey, child.key, node.key, idx);\n          });\n        });\n      }\n    });\n  });\n  \n  return controller;\n}\n\n/**\n * 把目标节点插入到一个新的inline节点中，并把inline放到原来的节点的位置\n */\nexport function wrapInlineByKey(\n  controller: Controller,\n  key: string,\n  inline: Inline,\n) {\n  const { value } = controller;\n  const { document } = value;\n  const path = document.assertPath(key);\n  return controller.command(wrapInlineByPath, path, inline);\n}\n\n/**\n * 把目标节点插入到一个新的inline节点中，并把inline放到原来的节点的位置\n */\nexport function wrapInlineByPath(\n  controller: Controller,\n  path: Path,\n  i: Inline,\n) {\n  const inline = Inline.create(i).set('nodes', []);\n  const parentPath = Path.parent(path);\n  const index = path[path.length - 1];\n  const newPath = Path.increment(path);\n\n  controller.withoutNormalizing(() => {\n    controller.command(insertNodeByPath, parentPath, index, inline);\n    controller.command(moveNodeByPath, newPath, path, 0);\n  });\n  return controller;\n}\n","export const unwrapBlockTpl = () => 'cj/cmd/unwrapblock';\nexport const unwrapTpl = () => 'cj/cmd/unwrapnode';\n","/**\n * @packageDocumentation\n * @module Commands\n */\nimport Controller from '../controller/index';\nimport Selection from '../models/selection';\nimport { Properties } from '../models/operation';\nimport { TextPoint } from '../models/point';\nimport Path from '../models/path';\nimport Block from '../models/block';\nimport Element from '../models/element';\nimport Inline from '../models/inline';\nimport setUtils from '../utils/setUtils';\nimport listUtils from '../utils/listUtils';\nimport { removeNodeByKey, removeNodeByPath } from './remove';\nimport { moveNodeByKey, moveNodeByPath } from './move';\nimport { splitDescendantsByKey, splitNodeByPath } from './split';\nimport { unwrapBlockTpl, unwrapTpl } from '../contexts/unwrap';\n\nexport function unwrapBlock(controller: Controller, p: Properties | string) {\n  const { selection } = controller.value;\n\n  const properties = typeof p === 'string' ? { type: p } : p;\n  return controller.command(unwrapBlockAtRange, selection, properties);\n}\n\nexport function unwrapBlockAtRange(\n  controller: Controller,\n  range: Selection,\n  properties: Properties,\n) {\n  const { value } = controller;\n  let { document } = value;\n  const blocks = document.getLeafBlocksAtRange(range);\n  const wraps = blocks\n    .map((block) => {\n      return document.getClosest(block.key, (parent) => {\n        if (!Block.isBlock(parent)) {\n          return false;\n        }\n        if (properties.type != null && parent.type !== properties.type) {\n          return false;\n        }\n        if (\n          properties.data != null &&\n          !setUtils.isSuperSet(\n            Object.values(parent.data),\n            Object.values(properties.data),\n          )\n        ) {\n          return false;\n        }\n        return true;\n      });\n    });\n  const wrappers = wraps.filter((exists): exists is Block => {\n    return Boolean(exists?.isElement() && exists.isBlock());\n  });\n\n  controller.withOpContext(unwrapBlockTpl(), () => {\n    controller.withoutNormalizing(() => {\n      setUtils.removeDuplicate(wrappers).forEach((block) => {\n        const first = block.nodes[0];\n        const last = block.nodes[block.nodes.length - 1];\n        const parent = controller.value.document.getParent(block.key)!;\n        const index = parent.nodes.indexOf(block);\n  \n        const children = block.nodes.filter((child) => {\n          return blocks.some(\n            (b) => child === b || (child.isElement() && child.getNode(b.key)),\n          );\n        });\n  \n        const firstMatch = children[0];\n        const lastMatch = children[children.length - 1];\n  \n        if (first === firstMatch && last === lastMatch) {\n          block.nodes.forEach((child, idx) => {\n            controller.command(moveNodeByKey, child.key, parent.key, index + idx);\n          });\n  \n          controller.command(removeNodeByKey, block.key);\n        } else if (last === lastMatch) {\n          listUtils\n            .skipUntil(block.nodes, (n) => n === firstMatch)\n            .forEach((child, i) => {\n              controller.command(\n                moveNodeByKey,\n                child.key,\n                parent.key,\n                index + 1 + i,\n              );\n            });\n        } else if (first === firstMatch) {\n          const nodes = listUtils.takeUntil(block.nodes, (n) => n === lastMatch);\n          nodes.push(lastMatch);\n          nodes.forEach((child, i) => {\n            controller.command(moveNodeByKey, child.key, parent.key, index + i);\n          });\n        } else {\n          const firstText = firstMatch.getFirstText();\n          controller.command(splitDescendantsByKey, block.key, firstText!.key, 0);\n  \n          ({ document } = controller.value);\n  \n          children.forEach((child, i) => {\n            let newChild = child;\n            if (i === 0) {\n              const extra = newChild;\n              newChild = document.getNextBlock(child.key)!;\n              controller.command(removeNodeByKey, extra.key);\n            }\n  \n            controller.command(\n              moveNodeByKey,\n              newChild.key,\n              parent.key,\n              index + 1 + i,\n            );\n          });\n        }\n      });\n    });\n  });\n\n  return controller;\n}\n\nexport function unwrapBlockByKey(\n  controller: Controller,\n  key: string,\n  p: Properties | string,\n) {\n  const { value } = controller;\n  const { document } = value;\n  const path = document.assertPath(key);\n  const properties = typeof p === 'string' ? { type: p } : p;\n\n  return controller.command(unwrapBlockByPath, path, properties);\n}\n\nexport function unwrapBlockByPath(\n  controller: Controller,\n  path: Path,\n  properties: Properties,\n) {\n  const { value } = controller;\n  const { document } = value;\n  const node = document.assertNodeByPath(path);\n  const first = node.getFirstText()!;\n  const last = node.getLastText()!;\n\n  const anchor = TextPoint.create({\n    key: first.key,\n    offset: 0,\n  });\n  const focus = TextPoint.create({\n    key: last.key,\n    offset: last.text.length,\n  });\n  const range = Selection.create({ anchor, focus });\n\n  return controller.command(unwrapBlockAtRange, range, properties);\n}\n\nexport function unwrapInline(controller: Controller, p: Properties | string) {\n  const { selection } = controller.value;\n\n  const properties = typeof p === 'string' ? { type: p } : p;\n  return controller.command(unwrapInlineAtRange, selection, properties);\n}\n\nexport function unwrapInlineAtRange(\n  controller: Controller,\n  range: Selection,\n  properties: Properties,\n) {\n  const { value } = controller;\n  const { document } = value;\n  const texts = document.getTextsAtRange(range);\n  const inlines = texts\n    .map((text) => document.getClosest(text.key, (parent) => {\n      if (!Inline.isInline(parent)) return false;\n      if (properties.type != null && parent.type !== properties.type) {\n        return false;\n      }\n      if (\n        properties.data != null &&\n        !setUtils.isSuperSet(\n          Object.values(parent.data),\n          Object.values(properties.data),\n        )\n      ) {\n        return false;\n      }\n      return true;\n    }))\n    .filter((exists) => exists);\n\n  controller.withoutNormalizing(() => {\n    setUtils.removeDuplicate(inlines as Inline[]).forEach((inline) => {\n      const parent = controller.value.document.getParent(inline.key)!;\n      const index = parent.nodes.indexOf(inline);\n\n      inline.nodes.forEach((child, i) => {\n        controller.command(moveNodeByKey, child.key, parent.key, index + i);\n      });\n\n      controller.command(removeNodeByKey, inline.key);\n    });\n  });\n\n  return controller;\n}\n\nexport function unwrapInlineByKey(\n  controller: Controller,\n  key: string,\n  p: Properties | string,\n) {\n  const { value } = controller;\n  const { document } = value;\n  const path = document.assertPath(key);\n  const properties = typeof p === 'string' ? { type: p } : p;\n  return controller.command(unwrapInlineByPath, path, properties);\n}\n\nexport function unwrapInlineByPath(\n  controller: Controller,\n  path: Path,\n  properties: Properties,\n) {\n  const { value } = controller;\n  const { document } = value;\n  const node = document.assertNodeByPath(path);\n  const first = node.getFirstText()!;\n  const last = node.getLastText()!;\n\n  const anchor = TextPoint.create({\n    key: first.key,\n    offset: 0,\n  });\n  const focus = TextPoint.create({\n    key: last.key,\n    offset: last.text.length,\n  });\n  const range = Selection.create({ anchor, focus });\n\n  return controller.command(unwrapInlineAtRange, range, properties);\n}\n\nexport function unwrapNodeByKey(controller: Controller, key: string) {\n  const { value } = controller;\n  const { document } = value;\n  const path = document.assertPath(key);\n  return controller.command(unwrapNodeByPath, path);\n}\n\nexport function unwrapNodeByPath(controller: Controller, path: Path) {\n  const { value } = controller;\n  const { document } = value;\n  document.assertNodeByPath(path);\n\n  const parentPath = Path.parent(path);\n  const parent = document.assertNodeByPath(parentPath) as Element;\n  const index = path[path.length - 1];\n  const parentIndex = parentPath[parentPath.length - 1];\n  const grandPath = Path.parent(parentPath);\n  const isFirst = index === 0;\n  const isLast = index === parent.nodes.length - 1;\n\n  controller.withOpContext(unwrapTpl(), () => {\n    controller.withoutNormalizing(() => {\n      if (parent.nodes.length === 1) {\n        controller.command(moveNodeByPath, path, grandPath, parentIndex + 1);\n        controller.command(removeNodeByPath, parentPath);\n      } else if (isFirst) {\n        controller.command(moveNodeByPath, path, grandPath, parentIndex);\n      } else if (isLast) {\n        controller.command(moveNodeByPath, path, grandPath, parentIndex + 1);\n      } else {\n        let updatedPath = Path.increment(path, 1, parentPath.length - 1);\n        updatedPath = updatedPath\n          .map((p, idx) => (idx === updatedPath.length - 1 ? 0 : p));\n        controller.command(splitNodeByPath, parentPath, index);\n        controller.command(\n          moveNodeByPath,\n          updatedPath,\n          grandPath,\n          parentIndex + 1,\n        );\n      }\n    });\n  });\n\n  return controller;\n}\n","/**\n * @packageDocumentation\n * @ignore\n */\nexport * from './delete';\nexport * from './insert';\nexport * from './merge';\nexport * from './move';\nexport * from './selection';\nexport * from './mark';\nexport * from './split';\nexport * from './remove';\nexport * from './replace';\nexport * from './set';\nexport * from './wrap';\nexport * from './unwrap';\n","export const DATA_CLIPBORAD_CANGJIE = 'data-clipboard-cangjie';\n\nexport const SLASH_PLACEHOLDER = '__slash__';\n","import CangjieDataTransfer from '../models/dataTransfer';\nimport { DATA_CLIPBORAD_CANGJIE, SLASH_PLACEHOLDER } from '../mo/utils/constants';\n\nexport function isFileMimeType(mime_type: string) {\n  return /^(image)|(audio)|(video)\\//.test(mime_type);\n}\n\n/**\n * @description 从 html 中读取自定义数据\n */\nexport function readClipboardDataFromHtml(html: string) {\n  const domparser = new DOMParser();\n  const root = domparser.parseFromString(html, 'text/html');    \n  const clipboardDataNode = root.querySelector(`[${DATA_CLIPBORAD_CANGJIE}]`) as HTMLElement;\n  const clipboardData: [string, string][] = [];\n  if (clipboardDataNode && root.body.firstElementChild === clipboardDataNode) {\n    Object.values(clipboardDataNode.attributes).forEach((item) => {\n      if (item.nodeName.startsWith('data-identifier-') && item.textContent) {\n        const mimeType = item.nodeName.slice('data-identifier-'.length).replace(new RegExp(SLASH_PLACEHOLDER, 'gm'), '/');        \n        clipboardData.push([mimeType, item.textContent]);\n      }\n    })\n  }\n  return clipboardData;\n}\n\n/**\n * @description 获取剪切板权限并读取内容\n */\nexport async function getClipboardData() {\n  try {\n    const dataTransfer = CangjieDataTransfer.create();\n    // 作为 any 类型处理，防止构建报错: Property 'read' does not exist on type 'Clipboard'.\n    const nav = window.navigator as any;\n    if (!nav?.clipboard?.read) {\n      return Promise.reject(\n        new Error(\n          'Your browser does not support navigator.clipboard.read method.',\n        ),\n      );\n    }\n    const clipboardItems = await nav.clipboard.read();\n    for (const clipboardItem of clipboardItems) {\n      for (const type of clipboardItem.types) {\n        const blob = await clipboardItem.getType(type);\n        if (isFileMimeType(type)) {\n          const file = new window.File([blob], '', { type });\n          dataTransfer.setData(type, file);\n        } else {\n          const text = await blob.text();\n          dataTransfer.setData(type, text);\n          if (type === 'text/html') {\n            const customData = readClipboardDataFromHtml(text);\n            customData.forEach(([type, data]) => {\n              dataTransfer.setData(type, data);\n            })\n          }\n        }\n      }\n    }\n    return Promise.resolve(dataTransfer);\n  } catch (err) {\n    return Promise.reject(err);\n  }\n}\n","import { isFileMimeType } from '../utils/getClipboardData';\n\nclass CustomDataTransfer {\n  private data: { dragX?: string; dragY?: string };\n\n  private dropEffect: string;\n\n  private effectAllowed: string;\n\n  public files: any[];\n\n  private img: string;\n\n  public items: any[];\n\n  public types: any[];\n\n  private xOffset: number;\n\n  private yOffset: number;\n\n  constructor() {\n    this.data = { dragX: '', dragY: '' };\n    this.dropEffect = 'none';\n    this.effectAllowed = 'all';\n    this.files = [];\n    this.img = '';\n    this.items = [];\n    this.types = [];\n    this.xOffset = 0;\n    this.yOffset = 0;\n  }\n\n  clearData() {\n    this.data = {};\n    this.items = [];\n    this.types = [];\n  }\n\n  getData(format: string) {\n    return this.data[format];\n  }\n\n  setData(format: string, data: string | File) {\n    const toAdd = {\n      kind: 'string',\n      type: format,\n    }\n    if (\n      !this.items.some((i) => {\n        i.kind === toAdd.kind && i.type === toAdd.type;\n      })\n    ) {\n      this.items.push(toAdd);\n    }\n    if (isFileMimeType(format) && data instanceof Blob) {\n      this.data[format] = '';\n      if (!this.types.includes('Files')) {\n        this.types.push('Files');\n      }\n      this.files.push(data);\n    } else {\n      this.data[format] = data;\n      if (!this.types.includes(format)) {\n        this.types.push(format);\n      }\n    }\n  }\n\n  setDragImage(img: string, xOffset: number, yOffset: number) {\n    this.img = img;\n    this.xOffset = xOffset;\n    this.yOffset = yOffset;\n  }\n}\n\nexport default CustomDataTransfer;\n","import PolyfillDataTransfer from '../events/dataTransfer';\nimport { MIME_TYPES } from '../constants';\n\n// TODO: merge PolyfillDataTransfer & CangjieDataTransfer into one model\nexport default class CangjieDataTransfer extends PolyfillDataTransfer {\n  static create(clipboardData?: DataTransfer) {\n    return new CangjieDataTransfer(clipboardData);\n  }\n\n  private constructor(clipboardData?: DataTransfer) {\n    super();\n    if (!clipboardData) {\n      return this;\n    }\n\n    // 仅复制剪切板里基础类型数据，防止文件过大导致内存溢出，需要消费 File、Img 类型数据直接从 nativeEvent 上获取\n    for (const type of Object.values(MIME_TYPES)) {\n      if (!clipboardData.types.includes(type)) {\n        continue;\n      }\n      const data = clipboardData.getData(type);\n      super.setData(type, data);\n    }\n\n    return this;\n  }\n\n  public setData(type: string, data: string | File): CangjieDataTransfer {\n    super.setData(type, data);\n    return Object.create(this, {\n      clearData: {\n        value() {\n          Object.getPrototypeOf(this).clearData();\n        }\n      },\n      getData: {\n        value(t) {\n          return Object.getPrototypeOf(this).getData(t);\n        },\n      },\n    });\n  }\n}\n","/**\n * @packageDocumentation\n * @module Events\n */\nimport CangjieDataTransfer from '../models/dataTransfer';\n\ntype CangjieClipboardEventType = 'cangjieCopy' | 'cangjieCut' | 'cangjiePaste';\n\ninterface CangjieClipboardEventOption {\n  nativeEvent?: ClipboardEvent;\n  clipboardData?: DataTransfer;\n}\n\ninterface CangjieClipboardEvent extends CustomEvent {\n  readonly nativeEvent: ClipboardEvent;\n  readonly clipboardData?: CangjieDataTransfer;\n  setClipboardData(clipboardData: CangjieDataTransfer): CangjieClipboardEvent;\n}\n\n/**\n * 剪切板事件\n */\nfunction CangjieClipboardEvent(\n  type: CangjieClipboardEventType,\n  { nativeEvent, clipboardData }: CangjieClipboardEventOption = {},\n): CangjieClipboardEvent {\n  const event = new CustomEvent(type);\n  \n  /**\n   * https://bugs.webkit.org/show_bug.cgi?id=49739\n   * webkit bug, safari 10 及以下会报 ERROR: Attempted to assign to readonly property.\n   */\n  if (clipboardData) {\n    // @ts-ignore\n    event.clipboardData = CangjieDataTransfer.create(clipboardData)\n  }\n  // @ts-ignore\n  return Object.assign(event, {\n    nativeEvent,\n    setClipboardData(clipboardData: CangjieDataTransfer) {\n      // @ts-ignore\n      event.clipboardData = clipboardData;\n      return Object.create(this, {\n        clipboardData: {\n          value: clipboardData,\n        },\n      });\n    },\n  });\n}\n\nexport default CangjieClipboardEvent;\n","/**\n * @packageDocumentation\n * @module Events\n */\nimport Selection from '../models/selection';\n\ninterface CangjieSelectDetail {\n  selection: Selection;\n  trigger?: string;\n}\n\ntype CangjieSelectEvent = CustomEvent<CangjieSelectDetail>;\n\nfunction CangjieSelectEvent(detail: CangjieSelectDetail) {\n  return new CustomEvent('cangjieSelect', { detail });\n}\n\nexport default CangjieSelectEvent;\n","/**\n * @packageDocumentation\n * @ignore\n */\nexport const defaultLocale = {\n  copy: '复制',\n  cut: '剪切',\n  select: '选择',\n  selectAll: '全选',\n  paste: '粘贴',\n  pasteTips: '请用快捷键',\n};\n\nexport type ContextMenuLocale = typeof defaultLocale;\n","/**\n * @packageDocumentation\n * @module transferUtils\n */\nimport * as React from 'react';\nimport ClipboardManager from '@ali/clipboard-manager';\nimport Controller from '../controller/index';\nimport Document from '../models/document';\nimport CangjieClipboardEvent from '../events/cangjieClipboard';\nimport { MIME_TYPES } from '../constants';\nimport { isFileMimeType } from './getClipboardData';\n\nfunction getTransferType(data) {\n  if (data.fragment) {\n    return 'fragment';\n  }\n  if (data.files && data.files.length) {\n    return 'files';\n  }\n  if (data.html) {\n    return 'html';\n  }\n  if (data.text) {\n    return 'text';\n  }\n  return 'unknown';\n}\n\nexport function getEventTransfer(\n  event: React.ClipboardEvent | React.DragEvent | CangjieClipboardEvent,\n  controller: Controller,\n) {  \n  const clipboardData =\n    'dataTransfer' in event ? event.dataTransfer : event.clipboardData;\n  if (!clipboardData) {\n    return { files: [], fragment: null, html: '', text: '' };\n  }\n\n  const html = clipboardData.getData(MIME_TYPES.HTML);\n  const text = clipboardData.getData(MIME_TYPES.TEXT) || '';\n  const encodedFragment = clipboardData.getData(MIME_TYPES.FRAGMENT);\n  let fragment: Document | null = null;\n  if (encodedFragment) {\n    try {\n      fragment = decodeFragment(encodedFragment);\n    } catch (e) {\n      // do nothing\n    }\n  }\n  if (!fragment && html && ~html.indexOf(` data-${controller.biz}-fragment=\"`)) {\n    const FRAGMENT_MATCHER = new RegExp(\n      ` data-${controller.biz}-fragment=\"([^\\\\s\"]+)\"`,\n    );\n    const matches = FRAGMENT_MATCHER.exec(html);\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    const [_, encoded] = matches || [];\n    if (encoded) {\n      fragment = decodeFragment(encoded);\n    }\n  }\n\n  let files: File[] = [];\n  try {\n    if (clipboardData.items && clipboardData.items.length) {\n      files = Array.from(clipboardData.items).reduce((fs, item) => {\n        if (item.kind === 'file') {\n          const file = item.getAsFile();\n          if (file) {\n            return [...fs, file];\n          }\n        }\n        return fs;\n      }, [] as File[]);\n    } else if (clipboardData.files && clipboardData.files.length) {\n      files = Array.from(clipboardData.files);\n    }\n  } catch (err) {\n    if (clipboardData.files && clipboardData.files.length) {\n      files = Array.from(clipboardData.files);\n    }\n  }\n\n  const data = { files, fragment, html, text };\n  return {\n    ...data,\n    type: getTransferType(data),\n  };\n}\n\n/**\n * 编码 fragment\n * @param fragment\n */\nexport function encodeFragment(fragment: Document) {\n  const string = JSON.stringify(fragment.toJSON());\n  const encoded = window.btoa(encodeURIComponent(string));\n  return encoded;\n}\n\n/**\n * 解码 fragment\n * @param text\n */\nexport function decodeFragment(text: string): Document {\n  const decoded = decodeURIComponent(window.atob(text));\n  const json = JSON.parse(decoded);\n  const fragment = Document.fromJSON(json);\n  return fragment;\n}\n\nlet clip: ClipboardManager;\n\nconst createClip = () => {\n  if (clip) return clip;\n  const target = document.createElement('div');\n  target.setAttribute('style', '-webkit-user-select: text !important');\n  clip = new ClipboardManager({ target });\n  return clip;\n};\n/**\n * 数据写入系统剪切板\n * @param event\n * @param data\n * @param callback\n */\nfunction setClipboardData(\n  event: CangjieClipboardEvent,\n  data: Record<string, string>,\n  callback?: () => void,\n) {\n  const isFileData = Object.keys(data).some((type) => type.startsWith('image'));\n  if (event.nativeEvent?.clipboardData) {\n    const dataEntries = Object.entries(data);\n    dataEntries.forEach((item) => {\n      const [mimeType, content] = item;\n      if (!isFileMimeType(mimeType)) {\n        event.nativeEvent?.clipboardData?.setData(mimeType, content);\n      }\n    });\n    if (isFileData) {\n      const clipManager = createClip();\n      clipManager.writeFile(data, {\n        succeeded: true,\n        action: 'copy',\n        text: '',\n      }).finally(() => {\n        if (callback) {\n          callback();\n        }\n      });\n    } else if (callback) {\n      callback();\n    }\n  } else {\n    const clipManager = createClip();\n    clipManager.write(data, false);\n    window.requestAnimationFrame(() => {\n      if (callback) {\n        callback();\n      }\n    });\n  }\n}\n\nexport function copyFragment(\n  event: CangjieClipboardEvent,\n  callback?: () => void,\n) {\n  const encodedFragment = event.clipboardData?.getData(MIME_TYPES.FRAGMENT);\n  const text = event.clipboardData?.getData(MIME_TYPES.TEXT)\n    || (encodedFragment && decodeFragment(encodedFragment).text)\n    || '';\n  const html = event.clipboardData?.getData(MIME_TYPES.HTML) || text;\n  const data = {\n    [MIME_TYPES.FRAGMENT]: encodedFragment,\n    [MIME_TYPES.HTML]: html,\n    [MIME_TYPES.TEXT]: text,\n  };\n\n  const imageTypes = event.clipboardData?.types.filter((type) =>\n    type.startsWith('image'));\n  imageTypes?.forEach((type) => {\n    const imgData = event.clipboardData?.getData(type);\n    if (imgData) {\n      data[type] = imgData;\n    }\n  });\n  setClipboardData(event, data, callback);\n}","import { isPlainObject, isEmpty, omitBy, isArray, forOwn, isObject } from 'lodash-es';\n\nexport function isEmptyObj (value) {\n  if (isPlainObject(value) || isArray(value)) {\n    return isEmpty(value)\n  }\n  return false\n}\n\nexport function omitEmptyObj (obj: object) {\n  return omitBy(obj, isEmptyObj);\n}\n\nexport function omitDeepBy (obj: object, predicate: (o) => boolean) {\n  let nextObj = obj;\n  forOwn(obj, (value, key) => {\n    if (isObject(value)) {\n      nextObj = {\n        ...nextObj,\n        [key]: omitDeepBy(value, predicate)\n      }\n    }\n  })\n  return omitBy(nextObj, predicate);\n}\n","import Value from '../models/value';\nimport CangjieDataTransfer from '../models/dataTransfer';\nimport { MIME_TYPES } from '../constants';\nimport { encodeFragment } from './transfer';\nimport Document from '../models/document';\nimport Element from '../models/element';\nimport { isEmptyObj, omitDeepBy } from './omitEmpty';\nimport Controller from '../controller';\nimport { UserData } from '../controller/userData';\n\nexport default function createClipboardDataFromSelection(controller: Controller) {\n  const { value, uid } = controller;\n  const { document, selection } = value;\n  let fragment = document.getFragmentAtRange(selection); \n  fragment = withUserData(fragment, document.data?.userData, uid);\n  const dataTransfer = CangjieDataTransfer.create();\n  const text = fragment.nodes.reduce((acc, node) => {\n    return `${acc}\\n${node.text}`;\n  }, '').slice(1);\n  \n  return dataTransfer\n    .setData(MIME_TYPES.FRAGMENT, encodeFragment(fragment))\n    .setData(MIME_TYPES.TEXT, text);\n}\n\n/**\n * 将节点的用户数据复制到 fragment 中\n * @param fragment \n * @param userData \n * @param uid \n * @returns \n */\nexport function withUserData (fragment: Document, userData?: UserData, uid?: string) {\n  const originData = uid && userData?.[uid];\n  if (originData) {\n    const nextData = {};\n    // 遍历 fragment 子节点，取出所有子节点的用户数据\n    fragment.forEachDescendant((node) => {\n      const uuid = Element.isElement(node) ? node.data?.uuid : null;\n      if (uuid && originData?.[uuid]) {\n        nextData[uuid] = originData?.[uuid];\n      }\n    })\n    // 用户数据复制到 fragment 中\n    if (Object.keys(nextData).length > 0) {\n      return fragment.set('data', omitDeepBy({\n        ...fragment.data,\n        userData: { [uid]: nextData },\n      }, isEmptyObj))\n    }\n  }\n  return fragment;\n}\n","import React from 'react';\n\nexport function Copy() {\n  return (\n    <svg\n      className=\"icon\"\n      width=\"24px\"\n      height=\"24px\"\n      viewBox=\"0 0 1024 1024\"\n      version=\"1.1\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        fill=\"#ffffff\"\n        d=\"M192 160a10.666667 10.666667 0 0 0-10.666667 10.666667v554.666666c0 5.888 4.778667 10.666667 10.666667 10.666667h42.666667v64h-42.666667A74.666667 74.666667 0 0 1 117.333333 725.333333V170.666667c0-41.216 33.450667-74.666667 74.666667-74.666667h469.333333c41.216 0 74.666667 33.450667 74.666667 74.666667v42.666666h-64V170.666667a10.666667 10.666667 0 0 0-10.666667-10.666667h-469.333333zM288 341.333333c0-41.216 33.450667-74.666667 74.666667-74.666666h469.333333c41.216 0 74.666667 33.450667 74.666667 74.666666v512a74.666667 74.666667 0 0 1-74.666667 74.666667h-469.333333A74.666667 74.666667 0 0 1 288 853.333333V341.333333z m74.666667-10.666666a10.666667 10.666667 0 0 0-10.666667 10.666666v512c0 5.888 4.778667 10.666667 10.666667 10.666667h469.333333a10.666667 10.666667 0 0 0 10.666667-10.666667V341.333333a10.666667 10.666667 0 0 0-10.666667-10.666666h-469.333333z\"\n      />\n    </svg>\n  );\n}\n\nexport function Cut() {\n  return (\n    <svg\n      className=\"icon\"\n      width=\"24px\"\n      height=\"24px\"\n      viewBox=\"0 0 1024 1024\"\n      version=\"1.1\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        fill=\"#ffffff\"\n        d=\"M553.301333 484.48l259.712-318.378667-49.578666-40.448L384.426667 590.250667a160 160 0 1 0 46.208 44.586666L512 535.04l81.365333 99.754667a160 160 0 1 0 46.208-44.586667l-86.272-105.813333zM298.666667 629.333333c18.901333 0 36.565333 5.461333 51.413333 14.933334l17.621333 14.336A96 96 0 1 1 298.666667 629.333333zM210.986667 166.101333l182.058666 223.189334 41.216-50.773334-173.653333-212.906666-49.621333 40.490666zM673.92 644.266667a96 96 0 1 1-17.578667 14.336l17.578667-14.336z\"\n      />\n    </svg>\n  );\n}\n\nexport function Paste() {\n  return (\n    <svg\n      className=\"icon\"\n      width=\"24px\"\n      height=\"24px\"\n      viewBox=\"0 0 1024 1024\"\n      version=\"1.1\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        fill=\"#ffffff\"\n        d=\"M352 106.666667A32 32 0 0 1 384 74.666667h170.666667a32 32 0 0 1 32 32v32H640a32 32 0 0 1 32 32v10.666666H725.333333c41.216 0 74.666667 33.450667 74.666667 74.666667v85.333333h-64V256a10.666667 10.666667 0 0 0-10.666667-10.666667h-53.333333V298.666667a32 32 0 0 1-32 32H298.666667A32 32 0 0 1 266.666667 298.666667V245.333333H213.333333a10.666667 10.666667 0 0 0-10.666666 10.666667v554.666667c0 5.888 4.778667 10.666667 10.666666 10.666666h213.333334v64H213.333333A74.666667 74.666667 0 0 1 138.666667 810.666667V256c0-41.216 33.450667-74.666667 74.666666-74.666667h53.333334V170.666667A32 32 0 0 1 298.666667 138.666667h53.333333V106.666667z m64 32V170.666667a32 32 0 0 1-32 32H330.666667v64h277.333333v-64H554.666667a32 32 0 0 1-32-32v-32h-106.666667z m106.666667 352c0-41.216 33.450667-74.666667 74.666666-74.666667h256c41.216 0 74.666667 33.450667 74.666667 74.666667v341.333333A74.666667 74.666667 0 0 1 853.333333 906.666667h-256a74.666667 74.666667 0 0 1-74.666666-74.666667v-341.333333z m74.666666-10.666667a10.666667 10.666667 0 0 0-10.666666 10.666667v341.333333c0 5.888 4.778667 10.666667 10.666666 10.666667h256a10.666667 10.666667 0 0 0 10.666667-10.666667v-341.333333a10.666667 10.666667 0 0 0-10.666667-10.666667h-256z\"\n      />\n    </svg>\n  );\n}\nexport function Select() {\n  return (\n    <svg\n      className=\"icon\"\n      width=\"24px\"\n      height=\"24px\"\n      viewBox=\"0 0 1024 1024\"\n      version=\"1.1\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        fill=\"#ffffff\"\n        d=\"M237.525333 187.178667a32 32 0 0 1 33.706667-1.962667l597.333333 324.266667a32 32 0 0 1-11.904 59.946666l-308.181333 32.426667-162.56 276.224a32 32 0 0 1-59.221333-11.221333L224.426667 218.325333a32 32 0 0 1 13.141333-31.146666z m60.16 85.205333l78.336 496.341333 125.44-213.205333a32 32 0 0 1 24.277334-15.616l221.781333-23.338667L297.728 272.384z\"\n      />\n    </svg>\n  );\n}\n\nexport function SelectAll() {\n  return (\n    <svg\n      className=\"icon\"\n      width=\"24px\"\n      height=\"24.00px\"\n      viewBox=\"0 0 1024 1024\"\n      version=\"1.1\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        fill=\"#ffffff\"\n        d=\"M142.037333 154.965333l9.130667-3.797333 3.84-9.130667 9.130667 3.754667 7.424-3.072c6.357333-2.602667 13.226667-4.053333 20.437333-4.053333h85.333333v64H202.666667V277.333333h-64v-85.333333c0-7.168 1.450667-14.08 4.053333-20.437333l3.072-7.424-3.754667-9.173334zM352 138.666667H320v64h170.666667v-64H352z m213.333333 0h-32v64h170.666667v-64h-138.666667z m213.333334 0h-32v64h74.666666V277.333333h64v-85.333333c0-7.168-1.450667-14.08-4.053333-20.437333l-3.114667-7.424 3.84-9.173334-9.173333-3.797333-3.84-9.130667-9.130667 3.754667-7.424-3.072a53.248 53.248 0 0 0-20.437333-4.053333h-53.333333z m-576 213.333333V320h-64v170.666667h64V352z m682.666666 0V320h-64v170.666667h64V352z m-682.666666 213.333333v138.666667h-64v-170.666667h64v32z m682.666666 0v-32h-64v170.666667h64v-138.666667z m-682.666666 213.333334v-32h-64v85.333333c0 7.168 1.450667 14.08 4.053333 20.437333l3.072 7.424-3.754667 9.173334 9.130667 3.797333 3.84 9.173333 9.130667-3.84 7.424 3.114667c6.357333 2.602667 13.226667 4.053333 20.437333 4.053333h85.333333v-64H202.666667v-42.666666z m682.666666 0v-32h-64v74.666666H746.666667v64h85.333333c7.168 0 14.08-1.450667 20.437333-4.053333l7.424-3.114667 9.173334 3.84 3.797333-9.173333 9.173333-3.84-3.84-9.130667 3.114667-7.424a53.333333 53.333333 0 0 0 4.053333-20.437333v-53.333333z m-533.333333 42.666666H320v64h170.666667v-64H352z m213.333333 0h-32v64h170.666667v-64h-138.666667zM392.533333 580.181333L483.413333 298.666667h67.2l90.837334 281.514666 51.2 145.152h-67.84l-36.352-102.912h-142.933334L409.173333 725.333333H341.333333l51.2-145.152z m124.458667-177.28l-50.176 155.52h100.352l-50.176-155.52z\"\n      />\n    </svg>\n  );\n}\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport Controller from '../controller/index';\nimport * as Commands from '../commands/index';\nimport CangjieClipboardEvent from '../events/cangjieClipboard';\nimport CangjieSelectEvent from '../events/cangjieSelect';\nimport CangjieDataTransfer from '../models/dataTransfer';\nimport { ContextMenuItem } from '../interfaces/contextMenu';\nimport { defaultLocale, ContextMenuLocale } from '../locale/contextMenu';\nimport { ControllerConfigs } from '../interfaces/controller';\nimport createClipboardDataFromSelection from '../utils/createClipboardDataFromSelection';\nimport { IS_IOS, IS_MOBILE } from '../utils/environment';\nimport { getClipboardData, readClipboardDataFromHtml } from '../utils/getClipboardData';\nimport { Copy, Cut, Paste, Select, SelectAll } from '../components/mobile/icons';\n\nexport const ACTION_COPY = Symbol('ACTION_COPY');\nexport const ACTION_COPY_FAIL = Symbol('ACTION_COPY_FAIL');\nexport const ACTION_CUT = Symbol('ACTION_CUT');\nexport const ACTION_CUT_FAIL = Symbol('ACTION_CUT_FAIL');\nexport const ACTION_PASTE = Symbol('ACTION_PASTE');\nexport const ACTION_PASTE_FAIL = Symbol('ACTION_PASTE_FAIL');\nexport const ACTION_SELECT = Symbol('ACTION_SELECT');\nexport const ACTION_SELECT_ALL = Symbol('ACTION_SELECT_ALL');\n\n\nfunction execCommandPolyfill(command: string) {\n  const maybeHiddenTextArea = window.document.activeElement;\n  let hiddenTextAreaOriginValue = '';\n  let hiddenTextAreaOriginStart = 0;\n  let hiddenTextAreaOriginEnd = 0;\n  if (maybeHiddenTextArea instanceof HTMLTextAreaElement) {\n    hiddenTextAreaOriginValue = maybeHiddenTextArea.value;\n    hiddenTextAreaOriginStart = maybeHiddenTextArea.selectionStart;\n    hiddenTextAreaOriginEnd = maybeHiddenTextArea.selectionEnd;\n    // NOTE: `execCommand` will not trigger onCopy & onCut on Safari if selection is collapsed.\n    maybeHiddenTextArea.value = ' ';\n    maybeHiddenTextArea.selectionStart = 0;\n    maybeHiddenTextArea.selectionEnd = maybeHiddenTextArea.value.length;\n  }\n  window.document.execCommand(command);\n  if (maybeHiddenTextArea instanceof HTMLTextAreaElement) {\n    maybeHiddenTextArea.value = hiddenTextAreaOriginValue;\n    maybeHiddenTextArea.selectionStart = hiddenTextAreaOriginStart;\n    maybeHiddenTextArea.selectionEnd = hiddenTextAreaOriginEnd;\n  }\n}\n\nfunction execCommand(command: string, controller: Controller) {\n  if (controller.value.isBlurred) {\n    // 手动调用 flush, 触发 仓颉 HiddenTextarea 聚焦\n    controller.command(Commands.focus).flush();\n    requestAnimationFrame(() => {\n      execCommandPolyfill(command);\n    });\n  } else {\n    execCommandPolyfill(command);\n  }\n}\n\nconst pasteMenu = (\n  locale: ContextMenuLocale,\n): ContextMenuItem => {\n  return {\n    name: locale.paste,\n    action: {\n      type: ACTION_PASTE,\n    },\n    key: 'paste',\n    role: 'paste',\n    icon: Paste,\n    options: {\n      hotKey: 'mod+v',\n      mobile: true,\n    },\n  };\n};\n// [defaultLocale] is the same as [configs.plugins.contextMenu]\nfunction contextMenu(configs?: ControllerConfigs) {\n  const locale = configs?.plugins?.contextMenu || defaultLocale;\n  return function (\n    controller: Controller,\n    next: () => ContextMenuItem[] | null,\n  ) {\n    const menus: ContextMenuItem[] = [];\n    const { readOnly, canCopy } = controller;\n    const { selection, document } = controller.value;\n    const isReadMode = Boolean(readOnly || controller.query('isQuickPreview'));\n    const hasVoidParent =\n      selection?.isCollapsed &&\n      document.hasVoidParent(selection.anchor.key, controller);\n    if (hasVoidParent) {\n      // 图片等暂不支持ContextMenu\n    } else if (selection?.isExpanded) {\n      const items: ContextMenuItem[] = [\n        {\n          name: locale.cut,\n          action: {\n            type: ACTION_CUT,\n          },\n          key: 'cut',\n          role: 'cut',\n          icon: Cut,\n          options: {\n            hotKey: 'mod+x',\n            mobile: true,\n            disable: isReadMode,\n          },\n        },\n        {\n          name: locale.copy,\n          action: {\n            type: ACTION_COPY,\n          },\n          key: 'copy',\n          role: 'copy',\n          icon: Copy,\n          options: {\n            disable: isReadMode && !canCopy,\n            hotKey: 'mod+c',\n            mobile: true,\n          },\n        },\n      ];\n      if (!isReadMode) {\n        items.push(pasteMenu(locale));\n      }\n      menus.push(...items);\n    } else if (selection?.isCollapsed && !selection.data.isByTable) {\n      menus.push(\n        {\n          name: locale.select,\n          action: {\n            type: ACTION_SELECT,\n          },\n          key: 'select',\n          icon: Select,\n          options: {\n            mobile: true,\n            group: 10,\n          },\n        },\n        {\n          name: locale.selectAll,\n          action: {\n            type: ACTION_SELECT_ALL,\n          },\n          key: 'select-all',\n          icon: SelectAll,\n          options: {\n            hotKey: 'mod+a',\n            mobile: true,\n            group: 10,\n          },\n        },\n      );\n      menus.push(\n        {\n          name: locale.cut,\n          action: {\n            type: ACTION_CUT,\n          },\n          key: 'cut',\n          role: 'cut',\n          options: {\n            hotKey: 'mod+x',\n            disable: true,\n          },\n        },\n        {\n          name: locale.copy,\n          action: {\n            type: ACTION_COPY,\n          },\n          key: 'copy',\n          role: 'copy',\n          options: {\n            hotKey: 'mod+c',\n            disable: true,\n          },\n        },\n      );\n      if (!isReadMode) {\n        menus.push(pasteMenu(locale));\n      }\n    }\n    const others = next() || [];\n    return [...menus, ...others];\n  };\n}\n\nfunction handleAction(action, controller: Controller, next) {\n  const { type } = action;\n\n  if (type === ACTION_COPY) {\n    if (IS_MOBILE) {\n      // 移动端 document.activeElement 非 hiddenTextarea, 无法通过 execCommand 触发 copy 事件\n      const event = CangjieClipboardEvent('cangjieCopy');\n      try {\n        controller.run('onCangjieCopy', event.setClipboardData(createClipboardDataFromSelection(controller)));\n      } catch (error) {\n        controller.run('onAction', { type: ACTION_COPY_FAIL, payload: { error } });\n        throw (error);\n      }\n    } else {\n      execCommand('copy', controller);\n    }\n  } else if (type === ACTION_CUT) {\n    if (IS_MOBILE) {\n      const event = CangjieClipboardEvent('cangjieCut');\n      try {\n        controller.run('onCangjieCut', event.setClipboardData(createClipboardDataFromSelection(controller)));\n      } catch (error) {\n        controller.run('onAction', { type: ACTION_CUT_FAIL, payload: { error } });\n        throw (error);\n      }\n    } else {\n      execCommand('cut', controller);\n    }\n  } else if (type === ACTION_PASTE) {\n    const event = CangjieClipboardEvent('cangjiePaste');\n    if (IS_MOBILE) {\n      const customEvent = event.setClipboardData(CangjieDataTransfer.create());\n      const html = event.clipboardData?.getData('text/html');\n      if (html) {\n        const customData = readClipboardDataFromHtml(html);\n        customData.forEach(([dataType, data]) => {\n          customEvent.clipboardData?.setData(dataType, data);\n        });\n      }\n      try {\n        controller.run('onCangjiePaste', customEvent);\n      } catch (error) {\n        controller.run('onAction', { type: ACTION_PASTE_FAIL, payload: { isShortcut: false, error } });\n        throw (error);\n      }\n    } else {\n      const isPasteEnable = window.document.execCommand('paste');\n      if (!isPasteEnable) {\n        getClipboardData().then((clipboardData) => {\n          controller.run('onCangjiePaste', event.setClipboardData(clipboardData));\n        }, (error) => {\n          controller.run('onAction', { type: ACTION_PASTE_FAIL, payload: { isShortcut: false, error } });\n          console.error(error);\n        });\n      }\n    }\n  } else if (type === ACTION_SELECT) {\n    // Select\n    const { selection } = controller.value;\n    selection &&\n      controller.command(Commands.selectWordAtPoint, selection.anchor);\n  } else if (type === ACTION_SELECT_ALL) {\n    // Select All\n    const { document, selection } = controller.value;\n    selection &&\n      controller.run(\n        'onCangjieSelect',\n        CangjieSelectEvent({\n          selection: selection.moveToRangeOfNode(document, controller),\n        }),\n      );\n  }\n  return next();\n}\nexport default (configs?: ControllerConfigs) => ({\n  contextMenu: contextMenu(configs),\n  onAction: handleAction,\n  models: [],\n});\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport * as React from 'react';\n\nexport function useScroll({ onStart, onEnd }) {\n  React.useEffect(() => {\n    let timeout: number | null = null;\n    let isStarted = false;\n    const handleScrollEvent = () => {\n      timeout && clearTimeout(timeout);\n      onStart();\n      isStarted = true;\n      timeout = window.setTimeout(() => {\n        onEnd();\n        isStarted = false;\n      }, 300);\n    };\n    window.addEventListener('scroll', handleScrollEvent, true);\n    return () => {\n      if (isStarted) {\n        onEnd();\n        isStarted = false;\n      }\n      timeout && clearTimeout(timeout);\n      window.removeEventListener('scroll', handleScrollEvent, true);\n    };\n  });\n}\n","/**\n * @packageDocumentation\n * @module domUtils\n */\nimport keyUtils from '../../utils/keyUtils';\nimport {\n  CURSOR_WIDTH,\n  CURSOR_EDGE_OFFSET,\n  CURSOR_EDGE_MAX_HEIGHT,\n  Selector,\n} from '../../constants';\nimport { EdgePoint, TextPoint } from '../../models/point';\nimport { SupportEdge } from '../../models/selection';\nimport { findDOMNodeSafely } from './findDOMNode';\nimport findDOMLeaves from './findDOMLeaves';\n\nexport interface PointLocation {\n  node: HTMLElement;\n  /**\n   * top offset in the window\n   */\n  clientTop: number;\n  /**\n   * left offset in the window\n   */\n  clientLeft: number;\n  /**\n   * caret height\n   */\n  height: number;\n}\n\nfunction isAfterNewLine(leaf: HTMLElement, offset: number) {\n  return (\n    leaf.firstChild?.textContent &&\n    leaf.firstChild.textContent[offset - 1] === '\\n'\n  );\n}\n\n/**\n *\n * Caret Hanging Optimization\n *\n * By default, the [caret] is inserted **after the charactor**:\n *\n *   [charactor][caret][may-be-a-line-break][next charactor].\n *\n * For multi-lines paragraph, the start of the non-first line cannot be focused\n * by this behaviour. Then we optimize the caret insert position to **before\n * the last characotr** if the user is clicking/touching the very left side:\n *\n *   [charactor][may-be-a-line-break][caret][next charactor]\n *\n */\n\n// If the caret can hanging, return the position; otheriwse return null\nfunction findHangingPosition(node: Node, offset: number, originLength: number) {\n  /**\n   * Detect is it can hanging.\n   *\n   * we get the rects of the newRange, whose offset is [originOffset + 1]\n   * if the newRange have one more rect than the old one, then we know that\n   * there is a line break between [offset, offset + 1]\n   */\n  const detectRange = window.document.createRange();\n  try {\n    detectRange.setStart(node, 0);\n    detectRange.setEnd(node, Math.max(offset, 0));\n  } catch (error) {\n    return null;\n  }\n\n  const detectRects = detectRange.getClientRects();\n  const { length } = detectRects;\n  if (length > originLength && length > 1) {\n    // the newRange has more rects than the old range\n    const secondLastRect = detectRects[length - 2];\n    const lastRect = detectRects[length - 1];\n    // skip is it's still in same line\n    if (lastRect.left >= secondLastRect.right) {\n      return null;\n    }\n    // it's a new line, binggo!\n    const { top, left, height } = lastRect;\n    return { top, left, height };\n  }\n  return null;\n}\n\nfunction getTextContentLength(childNode: ChildNode) {\n  return childNode.textContent ? childNode.textContent.length : 0;\n}\n\nfunction findTextNodeAtOffset(element: Element | ChildNode, offset: number) {\n  let remainedOffset = offset;\n  const { childNodes } = element;\n  for (let i = 0; i < childNodes.length; i += 1) {\n    const childNode = childNodes[i];\n    const textContentLength = getTextContentLength(childNode);\n    if (childNode.nodeType === Node.TEXT_NODE) {\n      if (textContentLength >= remainedOffset) {\n        return [childNode, remainedOffset];\n      }\n    } else if (childNode.nodeType === Node.ELEMENT_NODE) {\n      if (textContentLength >= remainedOffset) {\n        return findTextNodeAtOffset(childNode, remainedOffset);\n      }\n    }\n    // Ignore other Node.TYPE\n    remainedOffset -= textContentLength;\n  }\n  return findTextNodeAtOffset(element, getTextContentLength(element));\n}\n\nexport function findEdgePointPosition(\n  point: EdgePoint,\n  root: Window | Element = window,\n  maxEdgeHeight = CURSOR_EDGE_MAX_HEIGHT,\n  zoom = 1,\n) {\n  const { key } = point;\n  // eslint-disable-next-line react/no-find-dom-node\n  const node = findDOMNodeSafely(key, root);\n  if (!node) {\n    return undefined;\n  }\n  const { edge } = point;\n  const rect = node.getBoundingClientRect();\n  const height = Math.min(Math.round(rect.height), maxEdgeHeight);\n  const heightWithZoom = height > maxEdgeHeight ? height / zoom : height;\n  const clientLeft =\n    edge === EdgePoint.BEFORE ? rect.left - CURSOR_EDGE_OFFSET - CURSOR_WIDTH : rect.right + CURSOR_EDGE_OFFSET;\n  return {\n    node,\n    clientTop: rect.bottom / zoom - heightWithZoom,\n    clientLeft: clientLeft / zoom,\n    height: heightWithZoom,\n  };\n}\n\nexport function findTextPointPosition(\n  point: TextPoint,\n  preferredEdge?: SupportEdge,\n  root: Window | Element = window,\n  zoom = 1,\n) {\n  const isHanging = preferredEdge === 'start';\n  const leaves = findDOMLeaves(point.key, root);\n  if (!leaves.length) {\n    return undefined;\n  }\n  /**\n   * Step 1, find the leaf DOM node\n   */\n  const { offset } = point;\n  const leaf = leaves.find((_, index) => {\n    const nextLeaf = leaves[index + 1];\n    if (!nextLeaf) {\n      return true;\n    }\n    const leafKey = nextLeaf.getAttribute(Selector.key);\n    const startOffset = leafKey ? keyUtils.parse(leafKey)[1] : null;\n    if (!startOffset) {\n      return false;\n    }\n    return startOffset >= offset;\n  });\n  if (!leaf || !leaf.firstChild) {\n    return undefined;\n  }\n  const leafKey = leaf.getAttribute(Selector.key);\n  const startOffset = leafKey ? keyUtils.parse(leafKey)[1] : null;\n\n  if (!startOffset && startOffset !== 0) {\n    return undefined;\n  }\n\n  /**\n   * Step 2, calculate the rects\n   */\n  const range = window.document.createRange();\n  try {\n    range.setStart.apply(range, findTextNodeAtOffset(leaf, 0));\n    range.setEnd.apply(range, findTextNodeAtOffset(leaf, offset - startOffset));\n  } catch (error) {\n    return undefined;\n  }\n\n  // example: <span leaf-content key=`key:startOffset`>TEXT [offset] TEXT</span>\n  const rangeRects = Array.from(range.getClientRects());\n  const firstRangeRect = rangeRects[0];\n  const lastRangeRect = rangeRects[rangeRects.length - 1];\n  if (!firstRangeRect || !lastRangeRect) {\n    return undefined;\n  }\n\n  /**\n   * Step 3, detect hanging\n   */\n  const textContent = leaf.firstChild.textContent || '';\n  let hangingPosition: ReturnType<typeof findHangingPosition> = null;\n  const detectOffset = offset - startOffset + 1;\n  if (isHanging && textContent.length >= detectOffset) {\n    hangingPosition = findHangingPosition(\n      leaf.firstChild,\n      detectOffset,\n      rangeRects.length,\n    );\n  }\n\n  let { top, height } = lastRangeRect;\n  let left = lastRangeRect.right;\n\n  /**\n   * Step 4, detect soft line break\n   */\n  // if the point is after \\n\n  // calculate the following bounding rect (offset, offset + 1)\n  // and choose left side of following bounding rect\n  if (isAfterNewLine(leaf as HTMLElement, offset)) {\n    try {\n      range.setStart(leaf.firstChild, offset - startOffset);\n      range.setEnd(\n        leaf.firstChild,\n        Math.max(Math.min(detectOffset, textContent.length), 0),\n      );\n    } catch (error) {\n      return undefined;\n    }\n    const rects = range.getClientRects();\n    const followingRect = rects[rects.length - 1];\n\n    if (followingRect) {\n      ({ left, top, height } = followingRect);\n    }\n  }\n\n  // then we have the final position\n  if (hangingPosition) {\n    ({ left, top, height } = hangingPosition);\n  }\n  const [clientLeft, clientTop] = [left, top];\n\n  return {\n    node: leaf,\n    clientTop: clientTop / zoom,\n    clientLeft: clientLeft / zoom - CURSOR_WIDTH / 2,\n    height: height / zoom,\n  };\n}\n\nexport function findCaretPosition(\n  point: TextPoint | EdgePoint,\n  preferredEdge?: SupportEdge,\n  root: Window | Element = window,\n  maxEdgeHeight = CURSOR_EDGE_MAX_HEIGHT,\n  // 缩放比例\n  zoom = 1,\n): PointLocation | undefined {\n  return point.isEdgePoint()\n    ? findEdgePointPosition(point, root, maxEdgeHeight, zoom)\n    : findTextPointPosition(point, preferredEdge, root, zoom);\n}\n","import Selection from '../../models/selection';\nimport findDOMRange from '../../utils/dom/findDOMRange';\nimport Controller from '../../controller/index';\nimport { findCaretPosition } from '../../utils/dom/findCaretPosition';\nimport { findDOMNodeSafely } from '../../utils/dom/findDOMNode';\n\nconst ARROW_SIZE = 10;\nconst POPUP_MIN_SPACE = 6;\nconst TOP_SAFE_SPACE = 42;\n\nexport type PopupPosition = {\n  x: number; // client x\n  y: number; // client y\n  isTop: boolean; // is on top of the selection\n  arrowOffset: number; // arrow offset x\n};\n\nfunction getSelectionRect(selection: Selection, controller: Controller) {\n  let range: Range | null = null;\n  try {\n    // get the dom rectangles from the selction\n    range = findDOMRange(selection, controller);\n  } catch (_) {\n    return null;\n  }\n  if (!range) {\n    return null;\n  }\n  const domRects = Array.from(range.getClientRects());\n\n  if (!domRects.length) {\n    return null;\n  }\n\n  const { left, right, top, bottom } = domRects[0];\n  // compute the rectangle area\n  const rect = Array.from(domRects).reduce(\n    (obj, item) => {\n      obj.left = Math.min(item.left, obj.left);\n      obj.top = Math.min(item.top, obj.top);\n      obj.right = Math.max(item.right, obj.right);\n      obj.bottom = Math.max(item.bottom, obj.bottom);\n      return obj;\n    },\n    { left, right, top, bottom },\n  );\n  return rect;\n}\n\nfunction getCaretRect(selection: Selection, root?: Element) {\n  const preferredEdge = selection.isHanging ? 'start' : 'end';\n  const position = findCaretPosition(selection.anchor, preferredEdge, root);\n  if (!position) {\n    return null;\n  }\n  const { clientLeft: left, clientTop: top, height } = position;\n  const right = left;\n  const bottom = top + height;\n  return {\n    left,\n    right,\n    top,\n    bottom,\n  };\n}\n\nexport const getPopupPosition = (\n  selection: Selection,\n  controller: Controller,\n  popupWidth: number,\n  popupHeight: number,\n  defaultTop = true,\n): PopupPosition | null => {\n  const { document } = controller.value;\n  const root = findDOMNodeSafely(document.key);\n  const rect = selection.isCollapsed\n    ? getCaretRect(selection, root)\n    : getSelectionRect(selection, controller);\n  if (!rect) {\n    return null;\n  }\n  // default position is on top of selection\n  let isTop = defaultTop;\n  // move to bottom if the top is reaching out of screen\n  if (rect.top - (popupHeight + POPUP_MIN_SPACE) < TOP_SAFE_SPACE) {\n    isTop = false;\n  }\n  // special case when the user select very long text that exceed screen bottom\n  if (rect.bottom + (popupHeight + POPUP_MIN_SPACE) > window.innerHeight) {\n    isTop = true;\n  }\n\n  // default arrow is at the middle\n  let arrowOffset = popupWidth / 2 - ARROW_SIZE / 2;\n  let x = (rect.left + rect.right) / 2 - popupWidth / 2;\n  let y = isTop\n    ? rect.top - popupHeight - ARROW_SIZE\n    : rect.bottom + ARROW_SIZE;\n\n  // if popup is exceed the left/right edge, move it by the [offsetX] value\n  let offsetX = 0;\n  if (x < POPUP_MIN_SPACE) {\n    offsetX = POPUP_MIN_SPACE - x;\n  }\n  if (x + popupWidth > window.innerWidth - POPUP_MIN_SPACE) {\n    offsetX = window.innerWidth - x - popupWidth - POPUP_MIN_SPACE;\n  }\n  if (offsetX !== 0) {\n    x += offsetX;\n    arrowOffset -= offsetX;\n  }\n\n  arrowOffset = Math.min(\n    popupWidth - ARROW_SIZE * 2,\n    Math.max(ARROW_SIZE, arrowOffset),\n  );\n\n  y = Math.max(y, TOP_SAFE_SPACE);\n\n  return { x, y, isTop, arrowOffset };\n};\n","import React from 'react';\nimport Selection from '../models/selection';\nimport { Observable, Observer } from '../models/observable';\n\nexport type SelectionData = {\n  range: Selection;\n  blocksKeys: Set<string>;\n  isHideSelection: boolean;\n};\n\nexport function useSelectionData(\n  selectionData$: Observable<SelectionData>,\n  key: string | null,\n  onSelectionData: Observer<Omit<SelectionData, 'blocksKeys'> & { isSelected: boolean | null }>,\n  deps: any[],\n) {\n  React.useEffect(() => {\n    const subs = selectionData$.subscribe(({ range, blocksKeys, isHideSelection }) => {\n      const isSelected = key === null ? null : blocksKeys.has(key);\n      onSelectionData({\n        range,\n        isSelected,\n        isHideSelection,\n      });\n    });\n    return subs.unsubscribe;\n  }, [key, onSelectionData, ...deps]);\n}\n\nexport function useSelectionDataAtTheStartOfNextFrame(\n  selectionData$: Observable<SelectionData>,\n  key: string | null,\n  onSelectionDataNextFrame: Observer<Omit<SelectionData, 'blocksKeys'> & { isSelected: boolean | null }>,\n  deps: any[],\n) {\n  const animId = React.useRef<number | null>(null);\n  const onSelectionData = React.useCallback(\n    (pendingData) => {\n      animId.current = window.requestAnimationFrame(() => {\n        onSelectionDataNextFrame(pendingData);\n      });\n    },\n    [onSelectionDataNextFrame],\n  );\n\n  React.useEffect(() => {\n    return () => {\n      if (animId.current) {\n        window.cancelAnimationFrame(animId.current);\n      }\n    };\n  }, []);\n\n  useSelectionData(selectionData$, key, onSelectionData, deps);\n}\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport * as React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport Selection from '../../models/selection';\nimport Controller from '../../controller/index';\nimport { useScroll } from '../../hooks/useScroll';\nimport { ContextMenuItem } from '../../interfaces/contextMenu';\nimport { getPopupPosition, PopupPosition } from './popupPosition';\nimport { useSelectionData } from '../../hooks/useSelectionData';\nimport { Z_INDEX_CONTEXTMENU } from '../../constants';\nimport { IS_MOBILE } from '../../utils/environment';\n\nconst ITEM_HEIGHT = 54;\nconst POPUP_HEIGHT = ITEM_HEIGHT + 8 * 2;\nconst POPUP_BOTTOM_EXTRA_HEIGHT = 20;\n\nexport type ContextMenuProps = {\n  selection: Selection;\n  controller: Controller;\n  hidePopup?: (controller: Controller) => void;\n};\n\nconst wrapperStyle: React.CSSProperties = {\n  position: 'fixed',\n  zIndex: Z_INDEX_CONTEXTMENU,\n  backgroundColor: '#585A5C',\n  padding: '8px 4px',\n  borderRadius: '8px',\n  display: 'flex',\n  flexDirection: 'row',\n  opacity: '0',\n  transition: 'opacity 0.3s',\n};\n\nconst itemStyle: React.CSSProperties = {\n  height: `${ITEM_HEIGHT}px`,\n  lineHeight: '16px',\n  color: 'white',\n  minWidth: '56px',\n  width: '56px',\n  fontSize: '10px',\n  display: 'flex',\n  alignItems: 'center',\n  justifyContent: 'center',\n  flexDirection: 'column',\n  whiteSpace: 'nowrap',\n  overflow: 'hidden',\n};\n\nconst iconStyle: React.CSSProperties = {\n  width: '24px',\n  height: '24px',\n  marginBottom: '2px',\n};\n\nconst arrowStyle: React.CSSProperties = {\n  position: 'absolute',\n  bottom: '-4px',\n  width: '10px',\n  height: '10px',\n  backgroundColor: '#585A5C',\n  transform: 'rotate(45deg)',\n};\n\nconst arrowStyleTop: React.CSSProperties = {\n  ...arrowStyle,\n  bottom: 'inherit',\n  top: '-4px',\n};\nfunction ContextMenu(props: ContextMenuProps) {\n  const { selection, controller, hidePopup } = props;\n\n  const [position, setPosition] = React.useState<PopupPosition | null>(null);\n  const rootRef = React.useRef<HTMLDivElement>(null);\n\n  const updatePosition = () => {\n    if (rootRef.current) {\n      const { width } = rootRef.current.getBoundingClientRect();\n      const pos = getPopupPosition(\n        selection,\n        controller,\n        width,\n        POPUP_HEIGHT,\n        IS_MOBILE,\n      );\n      setPosition(pos);\n    }\n  };\n  React.useEffect(updatePosition, [selection]);\n\n  const setNodeVisible = React.useCallback((visible) => {\n    const node = rootRef.current;\n    if (selection.isCollapsed) {\n      hidePopup && hidePopup(controller)\n    } else if (node) {\n      node.style.opacity = visible ? '1' : '0';\n    }\n  }, [selection, hidePopup]);\n\n  useSelectionData(\n    controller.selectionData$,\n    null,\n    ({ range }) => {\n      if (range.isExpanded && selection.isCollapsed) {\n        setNodeVisible(false);\n      }\n    },\n    [],\n  );\n\n  useScroll({\n    onStart: () => {\n      setNodeVisible(false);\n    },\n    onEnd: () => {\n      updatePosition();\n      setNodeVisible(true);\n    },\n  });\n\n  let buttons = controller\n    .run('contextMenu')\n    .filter((b) => Boolean(b.options?.mobile));\n  buttons = buttons.sort((a, b) => {\n    const groupA = a.options?.group || 0;\n    const groupB = b.options?.group || 0;\n    return groupA - groupB;\n  });\n\n  const styleForWrapper = position\n    ? {\n        ...wrapperStyle,\n        left: position.x,\n        top: position.isTop\n          ? position.y\n          : position.y + POPUP_BOTTOM_EXTRA_HEIGHT,\n        opacity: 1,\n      }\n    : wrapperStyle;\n\n  const handleAction = (button: ContextMenuItem) => {\n    return (event: React.MouseEvent | TouchEvent | React.TouchEvent) => {\n      event.stopPropagation();\n      event.preventDefault();\n      controller.run('onAction', button.action);\n    };\n  };\n\n  const availableButtons = buttons.filter((btn) => {\n    if (btn.options && btn.options.disable) {\n      return false;\n    }\n    return true;\n  });\n\n  // 如果可用的 buttons 数为 0，则不渲染\n  if (availableButtons.length <= 0) {\n    return null;\n  }\n\n  const styleForArrow = position\n    ? {\n        ...(position.isTop ? arrowStyle : arrowStyleTop),\n        left: position.arrowOffset,\n      }\n    : arrowStyle;\n\n  return (\n    <div\n      data-role=\"mobileContextMenu\"\n      ref={rootRef}\n      className=\"cangjieContextMenu\"\n      style={styleForWrapper}\n    >\n      {availableButtons.map((button, index) => {\n        const { name, role, icon: Icon } = button;\n        return (\n          <div\n            key={name}\n            data-role={role || ''}\n            onMouseDown={handleAction(button)}\n            onTouchEnd={handleAction(button)}\n            style={itemStyle}\n          >\n            {typeof Icon !== 'function' && (\n              <img\n                style={iconStyle}\n                src={\n                  Icon ||\n                  'https://gw.alicdn.com/imgextra/i4/O1CN011xit6C1NdBJNUvlF9_!!6000000001592-55-tps-24-24.svg'\n                }\n              />\n            )}\n            {typeof Icon === 'function' && <Icon />}\n            <div>{name}</div>\n          </div>\n        );\n      })}\n      <span style={styleForArrow} />\n    </div>\n  );\n}\n\nexport default (props: ContextMenuProps) =>\n  ReactDOM.createPortal(<ContextMenu {...props} />, document.body);\n","/**\n * @packageDocumentation\n * @module Hooks\n */\nimport * as React from 'react';\n\n/**\n * @ignore\n */\nexport const ZoomContext = React.createContext<number>(1);\n\n/**\n * @ignore\n */\nexport const ExternalZoomContext = React.createContext<number>(1);\n\n/**\n * @ignore\n */\nexport const ZoomContainerContext = React.createContext<HTMLElement | null>(null);\n\nexport function useZoom() {\n  return React.useContext(ZoomContext);\n}\n\n/**\n * @ignore\n *\n * TODO: external zoom 是为了感知上层业务自行实现的缩放，但是这个设计是不合理的，上层业务从使\n * 用上看，没必要自行实现缩放功能，应该使用 cangjie 自带的缩放设计。后续希望移除此部分的 API。\n *\n * 目前已知的业务自行实现的缩放场景：PC 演示模式、生成长图\n * 2021-0222 新加：缩放状态下的评论\n */\nexport function useExternalZoom() {\n  return React.useContext(ExternalZoomContext);\n}\n\nexport function useZoomContainer() {\n  return React.useContext(ZoomContainerContext);\n}\n","import * as React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport Selection from '../../models/selection';\nimport { EdgePoint, TextPoint } from '../../models/point';\nimport { useZoomContainer } from '../../hooks/useZoom';\nimport useController from '../../controller/useController';\nimport findDOMNode from '../../utils/dom/findDOMNode';\nimport { getPopupPosition } from './popupPosition';\nimport { findCaretPosition } from '../../utils/dom/findCaretPosition';\nimport { Selector } from '../../constants';\n\nconst WIDTH = 160;\nconst HEIGHT = 128;\nconst ZOOM = 1.8;\nconst POPUP_EXTRA_TOP = -4;\nconst POPUP_EXTRA_BOTTOM = 52;\n\nconst rootStyle: React.CSSProperties = {\n  position: 'fixed',\n  overflow: 'hidden',\n  left: '50px',\n  top: '50px',\n  zIndex: 10000,\n  background: 'white',\n  width: WIDTH,\n  height: HEIGHT,\n  border: '1px solid rgba(17,31,44,0.12)',\n  boxShadow:\n    '0 4px 8px 0 rgba(0,0,0,0.08), inset 0 10px 20px 0 rgba(0,0,0,0.08)',\n  borderRadius: '8px',\n  opacity: 0,\n};\n\nconst blockContainerStyle: React.CSSProperties = {\n  backfaceVisibility: 'hidden',\n  transformOrigin: 'top left',\n};\n\ntype ZoomerProps = {\n  point: TextPoint | EdgePoint;\n  isHanging: boolean;\n};\n\n// remove all the *cangjie* attributes\nfunction cleanNode(node: Element) {\n  Array.from(node.attributes).forEach((attr) => {\n    if (attr.name.indexOf('cangjie') >= 0) {\n      node.removeAttribute(attr.name);\n    }\n  });\n  Array.from(node.children).forEach((child) => {\n    cleanNode(child);\n  });\n}\n\nfunction clearNode(node?: Element) {\n  while (node && node.lastChild) {\n    node.removeChild(node.lastChild);\n  }\n}\n\nfunction Zoomer(pros: ZoomerProps) {\n  const controller = useController();\n  const container = useZoomContainer();\n  const { point, isHanging } = pros;\n  const [cachedBlocks] = React.useState(new WeakMap<Element, Element>());\n  const blockRef = React.useRef<HTMLDivElement>(null);\n  const rootRef = React.useRef<HTMLDivElement>(null);\n  React.useEffect(() => {\n    const blockNode = blockRef.current;\n    const { document, selection } = controller.value;\n    const { start } = selection.sort(document);\n    const preferredEdge = point === start ? 'start' : 'end';\n    const pointPosition = findCaretPosition(\n      point,\n      preferredEdge,\n      container || window,\n    );\n    if (!blockNode || !pointPosition) {\n      return;\n    }\n\n    // Get the DOM elements\n    // eslint-disable-next-line react/no-find-dom-node\n\n    const ancestor = document.getAncestors(point.key)[0];\n    const dom = findDOMNode(ancestor.key);\n    const maybePrevDom = dom.previousElementSibling as HTMLElement;\n    const prevDom =\n      maybePrevDom && !maybePrevDom.getAttribute('data-cangjie-hidden')\n        ? maybePrevDom\n        : null;\n    const nextDom: HTMLElement = dom.nextElementSibling as HTMLElement;\n\n    // Clone the DOM elements and cache them if necessary\n    const prevArticleBlock = prevDom\n      ? cachedBlocks.get(prevDom) || (prevDom.cloneNode(true) as Element)\n      : null;\n    const nextArticleBlock = nextDom\n      ? cachedBlocks.get(nextDom) || (nextDom.cloneNode(true) as Element)\n      : null;\n    if (prevDom && prevArticleBlock && !cachedBlocks.get(prevDom)) {\n      cleanNode(prevArticleBlock);\n      cachedBlocks.set(prevDom, prevArticleBlock);\n    }\n    if (nextDom && nextArticleBlock && !cachedBlocks.get(nextDom)) {\n      cleanNode(nextArticleBlock);\n      cachedBlocks.set(nextDom, nextArticleBlock);\n    }\n\n    // We never cache the focused DOM element\n    const articleBlock = dom.cloneNode(true) as Element;\n    cleanNode(articleBlock);\n\n    // Calculate the offset positions\n    const domRect = dom.getBoundingClientRect();\n    const marginTop = parseInt(window.getComputedStyle(dom).marginTop, 10) || 0;\n    const offsetX = pointPosition.clientLeft - domRect.left - WIDTH / ZOOM / 2;\n    let offsetY =\n      pointPosition.clientTop +\n      pointPosition.height / 2 -\n      domRect.top +\n      marginTop -\n      HEIGHT / ZOOM / 2;\n    if (prevDom && prevArticleBlock) {\n      const prevStyle = window.getComputedStyle(prevDom);\n      const prevMarginTop = parseInt(prevStyle.marginTop, 10) || 0;\n      const prevMarginBottom = parseInt(prevStyle.marginBottom, 10) || 0;\n      offsetY +=\n        prevDom.getBoundingClientRect().height +\n        prevMarginTop +\n        prevMarginBottom;\n    }\n\n    const focusedSelection = Selection.create({\n      anchor: point,\n      focus: point,\n    }).setHanging(isHanging);\n    const popupPosition = getPopupPosition(\n      focusedSelection,\n      controller,\n      WIDTH,\n      HEIGHT,\n    );\n\n    // Attach the DOM elements and apply all positions\n    clearNode(blockNode);\n    if (prevArticleBlock) {\n      blockNode.appendChild(prevArticleBlock);\n    }\n    blockNode.appendChild(articleBlock);\n    if (nextArticleBlock) {\n      blockNode.appendChild(nextArticleBlock);\n    }\n    if (rootRef.current && popupPosition) {\n      const { isTop, x, y } = popupPosition;\n      const extraOffset = isTop ? POPUP_EXTRA_TOP : POPUP_EXTRA_BOTTOM;\n      rootRef.current.style.left = `${x}px`;\n      rootRef.current.style.top = `${y + extraOffset}px`;\n      rootRef.current.style.opacity = '1';\n    }\n    blockNode.style.width = `${domRect.width}px`;\n    blockNode.style.transform = `translate(${-offsetX * ZOOM}px, ${\n      -offsetY * ZOOM\n    }px) scale(${ZOOM})`;\n  }, [cachedBlocks, container, controller, point]);\n\n  return (\n    <div data-cangjie-mobile-zoomer style={rootStyle} ref={rootRef}>\n      <div style={blockContainerStyle} ref={blockRef} />\n    </div>\n  );\n}\n\nexport default (props: ZoomerProps) => {\n  const container = useZoomContainer();\n  const attachNode = container?.querySelector('[data-cangjie-zoomer]');\n  if (!attachNode) {\n    return null;\n  }\n  return ReactDOM.createPortal(<Zoomer {...props} />, attachNode);\n};\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport Controller from '../../controller/index';\nimport Selection from '../../models/selection';\nimport findDOMRange from './findDOMRange';\nimport findDOMNode, { findDOMNodeSafely } from './findDOMNode';\nimport { EdgePoint } from '../../models/point';\nimport { findCaretPosition, PointLocation } from './findCaretPosition';\nimport { CURSOR_WIDTH } from '../../constants';\nimport { IS_MOBILE } from '../environment';\n\n// 避免 smooth 滚动的滚动距离阈值\n// 参考 mac 下最大字号 72pt * 1.7 行高 = 163px 设置的 magic number\nconst MAX_LINE_HEIGHT = 150;\n\n// 往上滚动时，底部预留额外距离。参考竞品 (G Docs)，移动端间距会大一些 (一行 + 4px)\nconst EXTRA_BOTTOM_OFFSET = IS_MOBILE ? 66 : 12;\n\nexport function findScrollableContainer(el, window) {\n  if (!el) {\n    return null;\n  }\n\n  let scroller;\n  let parent = el.parentNode;\n  while (!scroller) {\n    if (!parent.parentNode) break;\n\n    const style = window.getComputedStyle(parent);\n    const { overflowY } = style;\n\n    if (['auto', 'overlay', 'scroll'].includes(overflowY)) {\n      scroller = parent;\n      break;\n    }\n\n    parent = parent.parentNode;\n  }\n\n  // COMPAT: Because Chrome does not allow doucment.body.scrollTop, we're\n  // assuming that window.scrollTo() should be used if the scrollable element\n  // turns out to be document.body or document.documentElement. This will work\n  // unless body is intentionally set to scrollable by restricting its height\n  // (e.g. height: 100vh).\n  if (!scroller) {\n    return window.document.body;\n  }\n\n  return scroller;\n}\n\nexport function getScrollableContainerInfo(scroller: Window | HTMLElement) {\n  const isWindow =\n    scroller === window ||\n    scroller === window.document.body ||\n    scroller === window.document.documentElement;\n\n  // @ts-ignore\n  const { innerHeight, visualViewport, _visualHeight } = window;\n\n  let width;\n  let height;\n  let yOffset;\n  let xOffset;\n  let scrollerTop = 0;\n  let scrollerLeft = 0;\n  let scrollerBordersY = 0;\n  let scrollerBordersX = 0;\n  let scrollerPaddingTop = 0;\n  let scrollerPaddingBottom = 0;\n  let scrollerPaddingLeft = 0;\n  let scrollerPaddingRight = 0;\n\n  // iOS 13/14 Safari浏览器，去除键盘高度后的视口高度\n  let viewportHeight: number = visualViewport ? visualViewport.height : innerHeight;\n  // 底部工具条弹出时，下面区域视为 viewport 之外\n  if (typeof _visualHeight === 'number' && _visualHeight > 0) {\n    viewportHeight = _visualHeight;\n  }\n\n  if (isWindow) {\n    // @ts-ignore\n    const { innerWidth, pageYOffset, pageXOffset } = window;\n    width = innerWidth;\n    height = innerHeight;\n    yOffset = pageYOffset;\n    xOffset = pageXOffset;\n  } else {\n    const { offsetWidth, offsetHeight, scrollTop, scrollLeft } = scroller as HTMLElement;\n    const {\n      borderTopWidth,\n      borderBottomWidth,\n      borderLeftWidth,\n      borderRightWidth,\n      paddingTop,\n      paddingBottom,\n      paddingLeft,\n      paddingRight,\n    } = window.getComputedStyle(scroller as HTMLElement);\n\n    const scrollerRect = (scroller as HTMLElement).getBoundingClientRect();\n    width = offsetWidth;\n    height = offsetHeight;\n    scrollerTop = scrollerRect.top + parseInt(borderTopWidth, 10);\n    scrollerLeft = scrollerRect.left + parseInt(borderLeftWidth, 10);\n\n    scrollerBordersY =\n      parseInt(borderTopWidth, 10) + parseInt(borderBottomWidth, 10);\n\n    scrollerBordersX =\n      parseInt(borderLeftWidth, 10) + parseInt(borderRightWidth, 10);\n\n    scrollerPaddingTop = parseInt(paddingTop, 10);\n    scrollerPaddingBottom = parseInt(paddingBottom, 10);\n    scrollerPaddingLeft = parseInt(paddingLeft, 10);\n    scrollerPaddingRight = parseInt(paddingRight, 10);\n    yOffset = scrollTop;\n    xOffset = scrollLeft;\n  }\n\n  return {\n    isWindow,\n    width,\n    height,\n    viewportHeight,\n    scrollerTop,\n    scrollerLeft,\n    xOffset,\n    yOffset,\n    scrollerPaddingLeft,\n    scrollerPaddingRight,\n    scrollerPaddingTop,\n    scrollerPaddingBottom,\n    scrollerBordersX,\n    scrollerBordersY,\n  };\n}\n\nexport function getDOMRectFromSelection(selection: Selection, content: HTMLElement, controller: Controller) {\n  const collapsedSelection = selection.moveToFocus();\n  if (!collapsedSelection) {\n    return null;\n  }\n\n  const { anchor } = collapsedSelection;\n  if (anchor.isEdgePoint()) {\n    let node: Element | null = null;\n    try {\n      // eslint-disable-next-line react/no-find-dom-node\n      node = findDOMNode(anchor.key);\n    } catch (error) {\n      // ignore\n    }\n    if (!node) {\n      return null;\n    }\n    const domRect = node.getBoundingClientRect();\n    const { top, height } = domRect;\n    const left = anchor.edge === EdgePoint.BEFORE ? domRect.left : domRect.right;\n    return typeof DOMRect !== 'undefined' ? new DOMRect(left, top, 1, height) : null;\n  }\n\n  let range: Range | null = null;\n  try {\n    range = findDOMRange(collapsedSelection, controller, content);\n  } catch (e) {\n    return null;\n  }\n  if (!range) {\n    return null;\n  }\n  const cursorRect = range.getClientRects()[0];\n  if (!cursorRect) {\n    return null;\n  }\n  return cursorRect;\n}\n\nexport function scrollToSelection(selection: Selection, content: HTMLElement, scroller: HTMLElement, controller: Controller) {\n  const inline = controller.value.document.getClosestInline(selection.focus.key);\n  let rect: PointLocation | undefined;\n  // 光标在 inline 元素内部\n  if (inline) {\n    const inlineDOM = findDOMNodeSafely(inline.key);\n    if (!inlineDOM) {\n      return;\n    }\n    const inlineRect = inlineDOM.getBoundingClientRect();\n    rect = {\n      node: inlineDOM,\n      clientLeft: inlineRect.left + inlineRect.width / 2,\n      clientTop: inlineRect.top,\n      height: inlineRect.height, // 以 inline 的尺寸为准\n    };\n  } else {\n    rect = findCaretPosition(selection.focus, selection.isHanging ? 'start' : 'end', content, Infinity);\n  }\n\n  if (!rect) {\n    return;\n  }\n\n  const {\n    isWindow,\n    width,\n    height,\n    viewportHeight,\n    scrollerTop,\n    scrollerLeft,\n    xOffset,\n    yOffset,\n    scrollerPaddingLeft,\n    scrollerPaddingRight,\n    scrollerPaddingTop,\n    scrollerPaddingBottom,\n    scrollerBordersX,\n    scrollerBordersY,\n  } = getScrollableContainerInfo(scroller);\n\n  const cursorTop = rect.clientTop + yOffset - scrollerTop;\n  const cursorLeft = rect.clientLeft + xOffset - scrollerLeft;\n\n  let x = xOffset;\n  let y = yOffset;\n  let inView = true;\n\n  if (cursorLeft < xOffset) {\n    // selection to the left of viewport\n    x = cursorLeft - scrollerPaddingLeft;\n    inView = false;\n  } else if (\n    cursorLeft + CURSOR_WIDTH + scrollerBordersX >\n    xOffset + width\n  ) {\n    // selection to the right of viewport\n    x = cursorLeft + scrollerBordersX + scrollerPaddingRight - width;\n    inView = false;\n  }\n\n  if (cursorTop < yOffset) {\n    // selection above viewport\n    y = cursorTop - scrollerPaddingTop;\n    inView = false;\n  } else if (\n    cursorTop + rect.height + scrollerBordersY >\n    yOffset + height - EXTRA_BOTTOM_OFFSET\n    // 此条件为被iOS键盘遮挡\n    // iOS弹出键盘只会改变 visualViewport，不会影响其他任何地方\n    || rect.clientTop + rect.height > viewportHeight - EXTRA_BOTTOM_OFFSET\n  ) {\n    // selection below viewport\n    y = Math.max(\n      cursorTop +\n      scrollerBordersY +\n      scrollerPaddingBottom +\n      rect.height -\n      height,\n      // 此数值为避免被iOS键盘遮挡\n      scrollerTop +\n      cursorTop +\n      rect.height -\n      viewportHeight,\n    );\n    y += EXTRA_BOTTOM_OFFSET;\n    inView = false;\n  }\n\n  // 对于大元素（超过 1/2 屏幕高度以上），特殊处理一下。\n  const quaterHeight = height / 4;\n  const isHugeElement = rect.height > quaterHeight * 2;\n  // 如果大元素已经大部分在视图内（1/4 以上），就不要滚动了。\n  const partInView =\n    rect.clientTop < scrollerTop + quaterHeight * 3 &&\n    rect.clientTop + rect.height > scrollerTop + quaterHeight;\n  if (isHugeElement && partInView) {\n    inView = true;\n  }\n\n  if (inView) {\n    return;\n  }\n\n  const deltaY = Math.abs(y - scroller.scrollTop);\n\n  (isWindow ? window : scroller).scrollTo({\n    left: x,\n    top: y,\n    // 纵向滚动距离小于 Min(视口高度/4, 特定高度) 时，采用顺滑滚动\n    //    > 一般用于输入文字导致的换行到视口外，然后滚动进视口\n    // 否则滚动距离过大就直接跳转到指定位置，避免滚动动画时间过长，体感不好\n    behavior: deltaY < Math.min(quaterHeight, MAX_LINE_HEIGHT) ? 'smooth' : 'auto',\n  });\n}\n","import { throttle } from 'lodash-es';\nimport Controller from '../../controller';\nimport { IS_MOBILE } from '../environment';\n\nimport { getScrollableContainerInfo } from './scrollToSelection';\n\ntype StartParams = {\n  scroller: HTMLElement;\n  controller: Controller;\n};\n\ntype ScheduleParams = {\n  controller: Controller;\n  isWindow: boolean;\n  scroller: HTMLElement;\n  left: number;\n  from: number;\n  isTop: boolean;\n  speed: number;\n};\n\ntype ScrollState = {\n  timer?: any;\n  isStarted: boolean;\n};\n\nconst stateMap = new WeakMap<Controller, ScrollState>();\n\n// 检测 move 事件的 Throttle\nconst THROTTLE_MOVE = 300;\n// 用户每移动这么多 pixel，就加一个速度\nconst SPEED_PIXEL = 20;\n// 用户最大速度（最小是 1）\nconst MAX_SPEED = 6;\n// 底部热区大一些，提前就滚动\nconst BOTTOM_EXTRA_HOT_SIZE = IS_MOBILE ? 100 : 50;\n// 移动端顶部热区大一些，提前滚动\nconst TOP_EXTRA_HOT_SIZE = IS_MOBILE ? 100 : 0;\n\nconst scheduleScroll = (params: ScheduleParams) => {\n  const { controller, isWindow, scroller, left, from, speed, isTop } = params;\n  const state = stateMap.get(controller);\n  if (!state || !state.isStarted) {\n    return;\n  }\n  cancelSchedule(controller);\n  // step 从用户体验角度，做了指数加速，一般是：2, 6, 12, 20, 30, ... 72\n  const px = speed * (speed + 1);\n  const step = isTop ? -px : px;\n  const top = Math.round(from + step);\n  if (isWindow) {\n    window.scrollTo(left, top);\n  } else {\n    scroller.scrollTop = top;\n  }\n  const newSpeed = Math.min(MAX_SPEED, speed + 0.1);\n  state.timer = requestAnimationFrame(() => {\n    scheduleScroll({ ...params, from: top, speed: newSpeed });\n  });\n};\n\nconst cancelSchedule = (controller: Controller) => {\n  const state = stateMap.get(controller);\n  if (state?.timer) {\n    cancelAnimationFrame(state.timer);\n    state.timer = undefined;\n  }\n};\n\nexport const startScroll = ({ scroller, controller }: StartParams) => {\n  stopScroll(controller);\n  stateMap.set(controller, {\n    isStarted: true,\n  });\n  return throttle((event: MouseEvent | PointerEvent | TouchEvent) => {\n    // PC Safari 下，不支持 TouchEvent\n    const { clientY } = (\n      typeof TouchEvent === 'function' && event instanceof TouchEvent\n        ? event.touches[0]\n        : event as (MouseEvent | PointerEvent)\n    );\n    const {\n      isWindow,\n      scrollerTop: top,\n      height,\n      xOffset,\n      yOffset,\n    } = getScrollableContainerInfo(scroller);\n    const bottom = top + height;\n    const topOffset = top - clientY + SPEED_PIXEL + TOP_EXTRA_HOT_SIZE;\n    const bottomOffset = clientY - bottom + SPEED_PIXEL + BOTTOM_EXTRA_HOT_SIZE;\n    if (topOffset <= 0 && bottomOffset <= 0) {\n      cancelSchedule(controller);\n      return;\n    }\n    const isTop = topOffset > 0;\n\n    // speed 一般是：1 - 8\n    const speed = Math.max(\n      1,\n      Math.min(\n        MAX_SPEED,\n        Math.round(\n          isTop ? topOffset / SPEED_PIXEL : bottomOffset / SPEED_PIXEL,\n        ),\n      ),\n    );\n\n    scheduleScroll({\n      controller,\n      isWindow,\n      scroller,\n      left: xOffset,\n      from: yOffset,\n      isTop,\n      speed,\n    });\n  }, THROTTLE_MOVE);\n};\n\nexport const stopScroll = (controller: Controller) => {\n  const state = stateMap.get(controller);\n  if (!state || !state.isStarted) {\n    return;\n  }\n  cancelSchedule(controller);\n  state.isStarted = false;\n};\n\nexport const isScrolling = (controller: Controller) => {\n  const state = stateMap.get(controller);\n  return Boolean(state?.isStarted && state.timer);\n};\n","import { createContext, useContext } from 'react';\n\nexport const ScrollableContainerContext = createContext<HTMLElement | Window | null>(\n  typeof window !== 'undefined' ? window : null,\n);\n\n/**\n * 滚动container，默认是window\n */\n export function useScrollableContainer() {\n  return useContext(ScrollableContainerContext);\n}\n","/* eslint-disable implicit-arrow-linebreak */\n// eslint-disable-next-line import/no-extraneous-dependencies\n/**\n * @packageDocumentation\n * @ignore\n */\nimport * as React from 'react';\nimport ReactDOM from 'react-dom';\nimport equal from 'fast-deep-equal';\n\nimport Controller from '../../controller/index';\nimport * as Commands from '../../commands/index';\nimport Selection from './../../models/selection';\nimport caretRangeFromTargetAndCoord from '../../utils/dom/caretRangeFromTargetAndCoord';\nimport ContextMenu from './contextMenu';\nimport { useScroll } from '../../hooks/useScroll';\nimport Zoomer from './Zoomer';\nimport { TextPoint, EdgePoint } from '../../models/point';\nimport findDOMNode, { findDOMNodeSafely } from '../../utils/dom/findDOMNode';\nimport { pointAtDistance } from '../../queries/selection';\nimport { useSelectionData } from '../../hooks/useSelectionData';\nimport {\n  PointLocation,\n  findCaretPosition,\n} from '../../utils/dom/findCaretPosition';\nimport { Selector } from '../../constants';\nimport CangjieSelectEvent from '../../events/cangjieSelect';\nimport { startScroll, stopScroll } from '../../utils/dom/outsideScroller';\nimport { useScrollableContainer } from '../ScrollableContainer';\n\ninterface HandlesProps {\n  selection: Selection;\n  enableZoomer: boolean;\n  controller: Controller;\n}\n\ninterface HandleProps {\n  style: object;\n  onDrag: (type: DraggingType, event: TouchEvent) => void;\n  type: DraggingType;\n  onDragStart: (type: DraggingType) => void;\n  onDragEnd: (type: DraggingType) => void;\n  isHidden?: boolean;\n}\n\n// handle needle width\nconst HANDLE_WIDTH = 2;\n// handle round dot size\nconst HANDLE_DOT_SIZE = 10;\n// handle touchable rect size\nconst HANDLE_TOUCH_SIZE = 30;\n\nconst TYPE_START = 'start';\nconst TYPE_END = 'end';\ntype DraggingType = 'start' | 'end' | null;\n\nconst cursorStyle: React.CSSProperties = {\n  position: 'fixed',\n  background: '#0089ff',\n  opacity: 1,\n  width: `${HANDLE_WIDTH}px`,\n};\n\nconst handleRectStyle: React.CSSProperties = {\n  position: 'absolute',\n  width: `${HANDLE_TOUCH_SIZE}px`,\n  height: `${HANDLE_TOUCH_SIZE}px`,\n  left: `-${HANDLE_TOUCH_SIZE / 2 - HANDLE_WIDTH / 2}px`,\n  bottom: `-${HANDLE_TOUCH_SIZE / 2 + HANDLE_DOT_SIZE / 2}px`,\n  display: 'flex',\n  justifyContent: 'center',\n  alignItems: 'center',\n};\n\nconst handleRectTop: React.CSSProperties = {\n  left: `-${HANDLE_TOUCH_SIZE / 2}px`,\n  top: `-${HANDLE_TOUCH_SIZE / 2}px`,\n  bottom: 'auto',\n};\n\nconst handleRoundDotStyle: React.CSSProperties = {\n  background: '#0089ff',\n  width: `${HANDLE_DOT_SIZE}px`,\n  height: `${HANDLE_DOT_SIZE}px`,\n  borderRadius: `${HANDLE_DOT_SIZE}px`,\n};\n\nconst handleRectTopStyle: React.CSSProperties = {\n  ...handleRectStyle,\n  ...handleRectTop,\n};\n\nconst isPointVisible = ({ node, clientLeft }: PointLocation) => {\n  let visible = true;\n  let pElement: HTMLElement | null = node.parentElement;\n  while (pElement && !pElement.getAttribute(`[${Selector.content}]`)) {\n    if (pElement.scrollWidth > pElement.offsetWidth) {\n      const pRect = pElement.getBoundingClientRect();\n      if (clientLeft < pRect.left || clientLeft > pRect.right) {\n        visible = false;\n        break;\n      }\n    }\n    pElement = pElement.parentElement;\n  }\n  return visible;\n};\n\nconst updateHandlePosition = (node: HTMLElement, loc: PointLocation) => {\n  node.style.top = `${loc.clientTop}px`;\n  node.style.left = `${loc.clientLeft}px`;\n  node.style.height = `${loc.height}px`;\n};\n\nconst blockEvent = (e: Event | React.TouchEvent) => {\n  e.preventDefault();\n  e.stopPropagation();\n};\n\n// get a range from a client point (x, y)\nconst caretRangeFromPoint = (x: number, y: number, controller: Controller) => {\n  const { key } = controller.value.document;\n  const docNode = findDOMNodeSafely(key);\n  const ele = docNode?.closest(`[${Selector.content}]`);\n  if (!ele) {\n    return null;\n  }\n  return caretRangeFromTargetAndCoord(ele, x, y, controller);\n};\n\n// Handle component\nconst Handle = React.forwardRef<HTMLElement, HandleProps>(\n  ({ style, onDrag, onDragStart, onDragEnd, type, isHidden = false }, ref) => {\n    // prevent page scroll when dragging\n    const handleTouchStart = (e: React.TouchEvent) => {\n      blockEvent(e);\n      e.nativeEvent.stopImmediatePropagation();\n      onDragStart(type);\n    };\n    const handleTouchEnd = (e: React.TouchEvent) => {\n      blockEvent(e);\n      e.nativeEvent.stopImmediatePropagation();\n      onDragEnd(type);\n    };\n\n    const handleDrag = React.useCallback(\n      (event: TouchEvent) => {\n        onDrag(type, event);\n      },\n      [type, onDrag],\n    );\n\n    const touchMoveRef = React.useRef<HTMLDivElement>(null);\n    React.useEffect(() => {\n      const element = touchMoveRef ? touchMoveRef.current : null;\n      if (element !== null) {\n        element.addEventListener('touchmove', handleDrag, {\n          passive: false,\n          capture: true,\n        });\n      }\n      return () => {\n        if (element !== null) {\n          element.removeEventListener('touchmove', handleDrag, {\n            capture: true,\n          });\n        }\n      };\n    }, [handleDrag]);\n\n    return (\n      <span\n        ref={ref}\n        data-testid=\"mobile-range-handle\"\n        style={isHidden ? { ...cursorStyle, opacity: 0 } : cursorStyle}\n      >\n        <span\n          ref={touchMoveRef}\n          onTouchStart={handleTouchStart}\n          onTouchEnd={handleTouchEnd}\n          style={style}\n        >\n          <span style={handleRoundDotStyle} />\n        </span>\n      </span>\n    );\n  },\n);\n\n// Handles component, contains two handles at start and end of a selection\nfunction Handles({ selection, controller, enableZoomer }: HandlesProps) {\n  const { document } = controller.value;\n  const scrollableContainer = useScrollableContainer();\n\n  const startRef = React.useRef<HTMLSpanElement>(null);\n  const endRef = React.useRef<HTMLSpanElement>(null);\n  const outsideScoller = React.useRef<ReturnType<typeof startScroll> | null>(null);\n\n  const { start, end } = selection.sort(document);\n\n  const setNodeVisible = React.useCallback(\n    (nodeRef: React.RefObject<HTMLSpanElement>, visible: boolean) => {\n      const node = nodeRef.current;\n      if (node) {\n        node.style.visibility = visible ? 'unset' : 'hidden';\n      }\n    },\n    [],\n  );\n\n  const updatePosition = () => {\n    const root = findDOMNodeSafely(document.key);\n    const posStart = findCaretPosition(start, 'start', root);\n    const posEnd = findCaretPosition(end, 'end', root);\n    const pairs: Array<[\n      PointLocation | undefined,\n      React.RefObject<HTMLSpanElement>,\n    ]> = [\n      [posStart, startRef],\n      [posEnd, endRef],\n    ];\n    pairs.forEach(([position, ref]) => {\n      if (position && isPointVisible(position) && ref.current) {\n        setNodeVisible(ref, true);\n        updateHandlePosition(ref.current, position);\n      } else {\n        setNodeVisible(ref, false);\n      }\n    });\n  };\n\n  React.useEffect(updatePosition);\n  useScroll({\n    onStart: () => {\n      setNodeVisible(startRef, false);\n      setNodeVisible(endRef, false);\n    },\n    onEnd: () => {\n      updatePosition();\n    },\n  });\n\n  const optimizeVerticalPosition = React.useCallback(\n    (isStart: boolean, orginalY: number) => {\n      const friendNode = isStart ? endRef.current : startRef.current;\n      if (friendNode) {\n        const friendRect = friendNode.getBoundingClientRect();\n        const friendY = friendRect.top + friendRect.height / 2;\n        return isStart\n          ? Math.min(friendY, orginalY)\n          : Math.max(friendY, orginalY);\n      }\n      return orginalY;\n    },\n    [],\n  );\n\n  // update the selection when the user drags the handle bar\n  const handleDrag = React.useCallback(\n    (type: DraggingType, event: TouchEvent) => {\n      blockEvent(event);\n      outsideScoller.current && outsideScoller.current(event);\n\n      const isStart = type === TYPE_START;\n      event.stopImmediatePropagation();\n      const touchPoint = event.touches[0];\n      const { clientX, clientY } = touchPoint;\n      const x = clientX;\n      const orginalY = isStart\n        ? clientY + HANDLE_TOUCH_SIZE\n        : clientY - HANDLE_TOUCH_SIZE;\n      const y = optimizeVerticalPosition(isStart, orginalY);\n\n      const range = caretRangeFromPoint(x, y, controller);\n      const { document: doc, selection } = controller.value;\n      if (!range) {\n        return;\n      }\n\n      let { focus: targetPoint } = range;\n      const voidParent = document.getClosestVoid(targetPoint.key, controller);\n      if (voidParent) {\n        // Handle Drag will skip the point inside void elements\n        try {\n          // eslint-disable-next-line react/no-find-dom-node\n          const voidNode = findDOMNode(voidParent.key);\n          const voidRect = voidNode.getBoundingClientRect();\n          const voidCenterX = voidRect.x + voidRect.width / 2;\n          const distance = clientX > voidCenterX ? 1 : -1;\n          targetPoint = controller.query(pointAtDistance, targetPoint, distance);\n        } catch (error) {\n          // ignore\n        }\n      }\n\n      const newSelection = selection.set('anchor', targetPoint);\n\n      if (\n        newSelection.isCollapsed ||\n        newSelection.isBackward(doc) !== selection.isBackward(doc) ||\n        equal(newSelection, selection)\n      ) {\n        return;\n      }\n      controller.run(\n        'onCangjieSelect',\n        CangjieSelectEvent({\n          selection: newSelection,\n          trigger: 'dragging',\n        }),\n      );\n    },\n    [controller],\n  );\n  const [dragging, setDragging] = React.useState<DraggingType>(null);\n  const onDragStart = React.useCallback((type: DraggingType) => {\n    /**\n     * Some android devices scroll to the HiddenTextArea after drag, it\n     * use 'anchor' point for positioning. So we make sure the user always\n     * drag the 'anchor' point here.\n     */\n    const isBackward = selection.isBackward(document);\n    // if we're dragging the 'focus' point, flip the selection\n    if ((type === TYPE_START && isBackward) || (type === TYPE_END && !isBackward)) {\n      const newSelection = selection.merge({\n        anchor: selection.focus,\n        focus: selection.anchor,\n      });\n      controller.run(\n        'onCangjieSelect',\n        CangjieSelectEvent({\n          selection: newSelection,\n          trigger: 'dragging',\n        }),\n      );\n    }\n    setDragging(type);\n    if (scrollableContainer) {\n      outsideScoller.current = startScroll({\n        scroller: scrollableContainer as HTMLElement,\n        controller,\n      });\n    }\n  }, [controller, document, selection]);\n  const onDragEnd = React.useCallback(() => {\n    setDragging(null);\n    if (outsideScoller.current) {\n      outsideScoller.current.cancel();\n      outsideScoller.current = null;\n    }\n    stopScroll(controller);\n  }, []);\n\n  React.useEffect(() => {\n    return () => {\n      if (outsideScoller.current) {\n        outsideScoller.current.cancel();\n        outsideScoller.current = null;\n      }\n    };\n  }, [controller]);\n\n  const dragProps = { onDragStart, onDragEnd };\n\n  let draggingPoint: TextPoint | EdgePoint | null = null;\n  if (dragging === TYPE_START) {\n    draggingPoint = start;\n  } else if (dragging === TYPE_END) {\n    draggingPoint = end;\n  }\n\n  return (\n    <React.Fragment>\n      <Handle\n        {...dragProps}\n        type={TYPE_START}\n        isHidden={enableZoomer && dragging === TYPE_END}\n        onDrag={handleDrag}\n        ref={startRef}\n        style={handleRectTopStyle}\n      />\n      <Handle\n        {...dragProps}\n        type={TYPE_END}\n        isHidden={enableZoomer && dragging === TYPE_START}\n        onDrag={handleDrag}\n        ref={endRef}\n        style={handleRectStyle}\n      />\n      {enableZoomer && draggingPoint && (\n        <Zoomer isHanging={dragging === TYPE_START} point={draggingPoint} />\n      )}\n      {!dragging && (\n        <ContextMenu selection={selection} controller={controller} />\n      )}\n    </React.Fragment>\n  );\n}\n\nexport default (props: HandlesProps) => {\n  const { selection: propsSelection, controller } = props;\n  const [selection, setSelection] = React.useState(propsSelection);\n\n  React.useMemo(() => {\n    setSelection(propsSelection);\n  }, [propsSelection]);\n\n  useSelectionData(controller.selectionData$, null, ({ range }) => {\n    setSelection(range);\n  }, []);\n  if (selection.isCollapsed) {\n    return null;\n  }\n  return ReactDOM.createPortal(<Handles {...props} selection={selection} />, document.body);\n};\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport * as React from 'react';\nimport Controller from '../controller/index';\nimport ContextMenu from '../components/mobile/contextMenu';\nimport Handles from '../components/mobile/handles';\nimport Selection from '../models/selection';\nimport caretRangeFromTargetAndCoord from '../utils/dom/caretRangeFromTargetAndCoord';\nimport { IS_TOUCH_DEVICE, IS_MOBILE } from '../utils/environment';\nimport { ControllerConfigs } from '../interfaces/controller';\n\nexport const ACTION_CLEAR_MOBILE_MENU = Symbol('ACTION_CLEAR_MOBILE_MENU');\n\n\nfunction getDraggingSelection(controller: Controller) {\n  // eslint-disable-next-line no-underscore-dangle\n  return controller.value.data._mobileDraggingSelection;\n}\n\nfunction hidePopup(controller) {\n  showPopup(controller, undefined);\n}\n\nfunction showPopup(controller: Controller, selection?: Selection) {\n  const { data } = controller.value;\n  const prevRange = getPopupSelection(controller);\n  const focusedSelection =\n    prevRange && selection && Selection.isEqual(prevRange, selection)\n      ? undefined\n      : selection;\n  controller.setData({\n    ...data,\n    _mobileFocusedSelection: focusedSelection,\n  });\n}\n\nfunction getPopupSelection(controller: Controller) {\n  // eslint-disable-next-line no-underscore-dangle\n  return controller.value.data._mobileFocusedSelection;\n}\n\n/**\n * 兼容 鼠标 + 触屏 场景\n *\n * 背景：\n * touch 事件会触发 onTouchStart 和 onMouseDown\n * mouse 事件会触发 onMouseDown\n *\n * 方案：\n * touch 事件，touchCount 值重置为 2\n * mouse 事件，touchCount 值减 1\n *\n * 结果：\n * 用户使用了 mouse：touchCount <= 0\n * 用户使用了 touch：touchCount === 1\n */\nlet touchCount = 0;\n\nexport default function createMobilePlugin(configs?: ControllerConfigs) {\n  const { enableZoomer = false } = configs?.plugins?.mobile || {};\n  function onTouchStart(event: React.TouchEvent, controller: Controller, next) {\n    const { selection, isFocused } = controller.value;\n    const { isCollapsed } = selection;\n    if (isFocused && isCollapsed) {\n      const { target, clientX, clientY } = event.touches[0];\n      const range = caretRangeFromTargetAndCoord(\n        target,\n        clientX,\n        clientY,\n        controller,\n      );\n      if (range && Selection.isEqual(selection, range)) {\n        showPopup(controller, selection);\n      } else if (range && getPopupSelection(controller)) {\n        hidePopup(controller);\n      }\n    }\n    touchCount = 2;\n    return next();\n  }\n\n  function onMouseDown(event: React.MouseEvent, controller: Controller, next) {\n    touchCount = touchCount > 0 ? touchCount - 1 : 0;\n    return next();\n  }\n\n  function renderContent(_, controller: Controller, next) {\n    const { value, readOnly } = controller;\n    const { selection, isFocused } = value;\n    const { contextData } = value.data;\n    const focusedSelection = getPopupSelection(controller);\n    const shouldRenderH5Controls = Boolean(\n      isFocused || controller.query('shouldRenderH5Controls'),\n    );\n    // 鼠标 + 触屏 场景，如果是鼠标触发的，就不显示菜单\n    const isDisabled = !IS_MOBILE && IS_TOUCH_DEVICE && touchCount === 0;\n\n    const isInFocusedSelection =\n      focusedSelection && Selection.isEqual(focusedSelection, selection);\n    // 当处于 focusedSelection 或者 插件允许的区域，可以渲染 contextMenu\n    const isInRenableSelection =\n      isInFocusedSelection || controller.query('shouldRenderContextMenu');\n\n    const shouldRenderContextMenu = Boolean(\n      shouldRenderH5Controls &&\n        !contextData &&\n        !isDisabled &&\n        isInRenableSelection,\n    );\n\n    const shouldRenderHandles =\n      shouldRenderH5Controls && !contextData && !isDisabled && !controller.query('isHideSelection');\n    return (\n      <React.Fragment>\n        {next()}\n        {selection.isCollapsed && shouldRenderContextMenu && (\n          <ContextMenu selection={selection} controller={controller} hidePopup={hidePopup} />\n        )}\n        {shouldRenderHandles && (\n          <Handles\n            enableZoomer={enableZoomer}\n            selection={selection}\n            controller={controller}\n          />\n        )}\n        {/* {shouldRenderHoldAndMove && (\n          <HoldAndMove\n            setDraggingSelection={setDraggingSelection}\n            setFocusedSelection={setFocusedSelection}\n            getDraggingSelection={getDraggingSelection}\n          />\n        )} */}\n      </React.Fragment>\n    );\n  }\n\n  function renderCaret(props, controller: Controller, next) {\n    const caret = next();\n    if (!caret) {\n      return null;\n    }\n    const isDragging = getDraggingSelection(controller);\n    const mode = isDragging ? 'placeholder' : 'caret';\n    return React.cloneElement(caret, { mode });\n  }\n\n  function onAction(action, controller: Controller, next) {\n    if (action.type === ACTION_CLEAR_MOBILE_MENU) {\n      const { data } = controller.value;\n      // eslint-disable-next-line no-underscore-dangle\n      if (data._mobileFocusedSelection) {\n        controller.setData({\n          ...data,\n          _mobileFocusedSelection: undefined,\n        });\n      }\n    }\n    return next();\n  }\n\n  return {\n    onAction,\n    onTouchStart,\n    onMouseDown,\n    renderContent,\n    renderCaret,\n    models: [],\n  };\n}\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport Controller from '../controller/index';\nimport Query from '../interfaces/query';\nimport QueryEvent from '../interfaces/queryEvent';\n\nexport default function createQueriesPlugin(\n  qrys: Record<string, Query> = {},\n) {\n  // PERF: drop prototype\n  const queries = Object.assign(Object.create(null), qrys);\n  function onQuery(qry: QueryEvent, controller: Controller, next) {\n    const { type, args } = qry;\n    const query = queries[type];\n    if (!query) {\n      return next();\n    }\n    const ret = query(controller, ...args);\n    return ret === undefined ? next() : ret;\n  }\n\n  return {\n    models: [],\n    onQuery,\n  };\n}\n","/**\n * @packageDocumentation\n * @ignore\n */\n import RenderNode from '../interfaces/renderNode';\n\n export default function createRenderNodePlugin(\n   renders: Record<string, RenderNode[]> = {},\n ) {\n  // PERF: drop prototype\n  const renderNodes: Record<string, RenderNode[]> = Object.assign(Object.create(null), renders);\n\n  // @ts-ignore\n  const renderNode: RenderNode = (props, controller, n) => {\n    // @ts-ignore\n    const renders = renderNodes[props.node?.type];\n    if (!renders) {\n      return n();\n    }\n\n    let prevArgs = [props, controller, n];\n    let i = 0;\n\n    function next(...as) {\n      const currentArgs =\n        as.length === 0 ? prevArgs : [...as, ...prevArgs.slice(as.length)];\n      prevArgs = currentArgs;\n\n      const fn = renders[i];\n      if (!fn) {\n        return null;\n      }\n      i += 1;\n      return fn(currentArgs[0], controller, next);\n    }\n\n    return next();\n  }\n\n  return {\n    models: [],\n    renderNode,\n  };\n}\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport Controller from '../controller/index';\nimport Command from '../interfaces/command';\nimport CommandEvent from '../interfaces/commandEvent';\n\nexport default function createCommandsPlugin(\n  cmds: Record<string, Command> = {},\n) {\n  // PERF: drop prototype\n  const commands = Object.assign(Object.create(null), cmds);\n  function onCommand(cmd: CommandEvent, controller: Controller, next) {\n    const { type, args } = cmd;\n    const command = commands[type];\n    if (!command) {\n      return next();\n    }\n    return command(controller, ...args);\n  }\n\n  return {\n    models: [],\n    onCommand,\n  };\n}\n","/* eslint-disable no-continue */\n/* eslint-disable no-restricted-syntax */\n/**\n * @packageDocumentation\n * @ignore\n */\nimport Controller from '../controller/index';\nimport * as Commands from '../commands/index';\nimport Node from '../models/node';\nimport Element from '../models/element';\nimport Document from '../models/document';\nimport Block from '../models/block';\nimport Inline from '../models/inline';\nimport Text from '../models/text';\nimport Mark from '../models/mark';\n\nexport interface Rule {\n  match?: Rule | Rule[];\n  klass?: string | ((type: string) => boolean);\n  type?: string | ((type: string) => boolean);\n  first?: Rule | Rule[];\n  last?: Rule[];\n  nodes?: Rule[];\n  min?: number;\n  max?: number;\n  parent?: Rule[];\n  previous?: Rule[];\n  next?: Rule[];\n  normalize?: (controller: Controller, error) => void;\n}\n\nconst klassToIsType = {\n  document: Document.isDocument,\n  block: Block.isBlock,\n  inline: Inline.isInline,\n  text: Text.isText,\n  mark: Mark.isMark,\n};\nfunction validateKlass(node: Node | Mark, rule: Rule) {\n  if (!rule.klass) {\n    return null;\n  }\n  // FIXME: remove `.toJSON()`\n  if (typeof rule.klass === 'function' && rule.klass(node.toJSON().klass)) {\n    return null;\n  }\n  const isType = klassToIsType[rule.klass as string];\n  if (isType && isType(node)) {\n    return null;\n  }\n  return { code: 'node_klass_invalid', rule, node };\n}\n\nfunction validateType(node: Block | Inline, rule: Rule) {\n  if (!rule.type) {\n    return null;\n  }\n  if (rule.type === node.type) {\n    return null;\n  }\n  if (typeof rule.type === 'function' && rule.type(node.type)) {\n    return null;\n  }\n  return { code: 'node_type_invalid', rule, node };\n}\n\nfunction validateFirst(node: Element, rule: Rule) {\n  if (!rule.first) {\n    return null;\n  }\n  const first = node.nodes[0];\n  if (!first) {\n    return null;\n  }\n  const error = validateRules(first, rule.first);\n  if (!error) {\n    return null;\n  }\n  return Object.assign({}, error, {\n    rule,\n    node,\n    child: first,\n    code: error.code.replace('node_', 'first_child_'),\n  });\n}\n\nfunction validateLast(node: Element, rule: Rule) {\n  if (!rule.last) {\n    return null;\n  }\n  const last = node.nodes[node.nodes.length - 1];\n  if (!last) {\n    return null;\n  }\n  const error = validateRules(last, rule.last);\n  if (!error) {\n    return null;\n  }\n  // PERF\n  return Object.assign({}, error, {\n    rule,\n    node,\n    child: last,\n    code: error.code.replace('node_', 'last_child_'),\n  });\n}\n\nfunction validateParent(node: Element, child: Node, rules: Rule[]) {\n  // PERF: For loop is faster than for of.\n  const { length } = rules;\n  for (let i = 0; i < length; i++) {\n    const rule = rules[i];\n    if (!rule.parent) {\n      continue;\n    }\n    if (rule.match && !testRules(child, rule.match)) {\n      continue;\n    }\n    const error = validateRules(node, rule.parent);\n    if (!error) {\n      continue;\n    }\n    // PERF\n    return Object.assign({}, error, {\n      rule,\n      parent: node,\n      node: child,\n      code: error.code.replace('node_', 'parent_'),\n    });\n  }\n  return null;\n}\n\nfunction validatePrevious(\n  node: Element,\n  child: Node,\n  previous: Node | null,\n  index: number,\n  rules: Rule[],\n) {\n  if (!previous) {\n    return null;\n  }\n  // PERF: For loop is faster than for of.\n  const { length } = rules;\n  for (let i = 0; i < length; i++) {\n    const rule = rules[i];\n    if (!rule.previous) {\n      continue;\n    }\n    if (rule.match && !testRules(child, rule.match)) {\n      continue;\n    }\n    const error = validateRules(previous, rule.previous);\n    if (!error) {\n      continue;\n    }\n    // PERF\n    return Object.assign({}, error, {\n      rule,\n      node,\n      child,\n      index,\n      previous,\n      code: error.code.replace('node_', 'previous_sibling_'),\n    });\n  }\n  return null;\n}\n\nfunction validateNext(\n  node: Element,\n  child: Node,\n  next: Node | null,\n  index: number,\n  rules: Rule[],\n) {\n  if (!next) {\n    return null;\n  }\n  // PERF: For loop is faster than for of.\n  const { length } = rules;\n  for (let i = 0; i < length; i++) {\n    const rule = rules[i];\n    if (!rule.next) {\n      continue;\n    }\n    if (rule.match && !testRules(child, rule.match)) {\n      continue;\n    }\n    const error = validateRules(next, rule.next);\n    if (!error) {\n      continue;\n    }\n    // PERF\n    return Object.assign({}, error, {\n      rule,\n      node,\n      child,\n      index,\n      next,\n      code: error.code.replace('node_', 'next_sibling_'),\n    });\n  }\n  return null;\n}\n\nfunction validateNodes(node: Element, rule: Rule, rules: Rule[] = []) {\n  if (!node.nodes) {\n    return null;\n  }\n\n  const children = node.nodes;\n  const defs = rule.nodes ? [...rule.nodes] : [];\n\n  let count = 0;\n  let lastCount = 0;\n  let min: number | null = null;\n  let index = -1;\n  let def: Rule | null = null;\n  let max: number | null = null;\n  let child: Node | null = null;\n  let previous: Node | null = null;\n  let next: Node | null = null;\n\n  function nextDef() {\n    if (defs.length === 0) {\n      return false;\n    }\n    def = defs.shift() as Rule;\n    lastCount = count;\n    count = 0;\n    min = def.min || null;\n    max = def.max || null;\n    return true;\n  }\n\n  function nextChild() {\n    index += 1;\n    previous = child;\n    child = children[index] || null;\n    next = children[index + 1] || null;\n    if (!child) {\n      return false;\n    }\n    lastCount = count;\n    count += 1;\n    return true;\n  }\n\n  function rewind() {\n    if (index > 0) {\n      index -= 1;\n      count = lastCount;\n    }\n  }\n\n  if (rule.nodes) {\n    nextDef();\n  }\n\n  while (nextChild()) {\n    const error =\n      validateParent(node, child!, rules) ||\n      validatePrevious(node, child!, previous, index, rules) ||\n      validateNext(node, child!, next, index, rules);\n    if (error) {\n      return error;\n    }\n    if (rule.nodes) {\n      if (!def) {\n        return { code: 'child_unknown', rule, node, child, index };\n      }\n      if ((def as Rule).match) {\n        // @ts-ignore\n        const err = validateRules(child!, def.match);\n        if (err) {\n          // Since we want to report overflow on last matching child we don't\n          // immediately check for count > max, but instead do so once we find\n          // a child that doesn't match.\n          if (max !== null && count - 1 > max) {\n            rewind();\n            return {\n              code: 'child_max_invalid',\n              rule,\n              node,\n              index,\n              child: children[index],\n              count,\n              limit: max,\n            };\n          }\n\n          const lastMin = min;\n          // If there are more groups after this one then child might actually\n          // be valid.\n          if (nextDef()) {\n            // If we've already satisfied the minimum for the current group,\n            // then we can rewind and proceed to the next group.\n            if (lastMin === null || lastCount - 1 >= lastMin) {\n              index -= 1;\n              continue;\n            }\n\n            // Otherwise we know that current value is underflowing. There are\n            // three possible causes for this...\n\n            // 1. There might just not be enough elements for current group, and\n            // current child is in fact the first of the next group. If so, the\n            // next def will not report errors, in which case we can rewind and\n            // report an minimum error.\n            // @ts-ignore\n            if (validateRules(child!, def.match) === null) {\n              rewind();\n              return {\n                code: 'child_min_invalid',\n                rule,\n                node,\n                index,\n                count: lastCount - 1,\n                limit: lastMin,\n              };\n            }\n\n            // 2. The current group is underflowing, but there is also an\n            // invalid child before the next group.\n            // 3. Or the current group is not underflowing but it appears so\n            // because there's an invalid child between its members.\n            // It's either the second or third case. If it's the second then\n            // we could report an underflow, but presence of an invalid child\n            // is arguably more important, so we report it first. It also lets\n            // us avoid checking for which case exactly is it.\n            // PERF\n            return Object.assign({}, err, {\n              rule,\n              node,\n              child,\n              index,\n              code: err.code.replace('node_', 'child_'),\n            });\n          }\n\n          // Otherwise either we exhausted the last group, in which case it's\n          // an unknown child, ...\n          if (max != null && count > max) {\n            return {\n              code: 'child_unknown',\n              rule,\n              node,\n              child,\n              index,\n            };\n          }\n          return Object.assign({}, err, {\n            rule,\n            node,\n            child,\n            index,\n            code: err.code.replace('node_', 'child_'),\n          });\n        }\n      }\n    }\n  }\n\n  // Since we want to report overflow on last matching child we don't\n  // immediately check for count > max, but do so after processing all nodes.\n  if (max !== null && count > max) {\n    return {\n      code: 'child_max_invalid',\n      rule,\n      node,\n      index: index - 1,\n      count,\n      child: children[index - 1],\n      limit: max,\n    };\n  }\n  if (rule.nodes) {\n    do {\n      if (min !== null && count < min) {\n        return {\n          code: 'child_min_invalid',\n          rule,\n          node,\n          index,\n          count,\n          limit: min,\n        };\n      }\n    } while (nextDef());\n  }\n  return null;\n}\n\nfunction validateRules(\n  object: Node | Mark,\n  rule: Rule | Rule[],\n  rules?: Rule[],\n  options: { every?: boolean } = {},\n) {\n  const { every = false } = options;\n  if (Array.isArray(rule)) {\n    const array = rule.length ? rule : [{}];\n\n    let first = null;\n    // PERF: For loop is faster than for of.\n    const { length } = array;\n    for (let i = 0; i < length; i++) {\n      const r = array[i];\n      const error = validateRules(object, r, rules);\n      first = first || error;\n      if (every && error) {\n        return error;\n      }\n      if (!every && !error) {\n        return null;\n      }\n    }\n    return first;\n  }\n\n  return (\n    validateKlass(object, rule) ||\n    // @ts-ignore\n    validateType(object, rule) ||\n    // @ts-ignore\n    validateFirst(object, rule) ||\n    // @ts-ignore\n    validateLast(object, rule) ||\n    // @ts-ignore\n    validateNodes(object, rule, rules)\n  );\n}\n\nfunction testRules(object: Node | Mark, rules: Rule | Rule[]) {\n  return !validateRules(object, rules);\n}\n\nfunction defaultNormalize(controller: Controller, error) {\n  const { code, node, child, next, previous } = error;\n\n  switch (code) {\n    case 'child_max_invalid':\n    case 'child_klass_invalid':\n    case 'child_type_invalid':\n    case 'child_unknown':\n    case 'first_child_klass_invalid':\n    case 'first_child_type_invalid':\n    case 'last_child_klass_invalid':\n    case 'last_child_type_invalid': {\n      return Text.isText(child) &&\n        Block.isBlock(node) &&\n        node.nodes.length === 1\n        ? controller.command(Commands.removeNodeByKey, node.key)\n        : controller.command(Commands.removeNodeByKey, child.key);\n    }\n\n    case 'previous_sibling_klass_invalid':\n    case 'previous_sibling_type_invalid': {\n      return Text.isText(previous) &&\n        Block.isBlock(node) &&\n        node.nodes.length === 1\n        ? controller.command(Commands.removeNodeByKey, node.key)\n        : controller.command(Commands.removeNodeByKey, previous.key);\n    }\n\n    case 'next_sibling_klass_invalid':\n    case 'next_sibling_type_invalid': {\n      return Text.isText(next) && Block.isBlock(node) && node.nodes.length === 1\n        ? controller.command(Commands.removeNodeByKey, node.key)\n        : controller.command(Commands.removeNodeByKey, next.key);\n    }\n\n    case 'child_min_invalid':\n    case 'parent_klass_invalid':\n    case 'parent_type_invalid': {\n      return Document.isDocument(node)\n        ? node.nodes.forEach((n) => controller.command(Commands.removeNodeByKey, n.key))\n        : controller.command(Commands.removeNodeByKey, node.key);\n    }\n\n    default: {\n      return controller.command(Commands.removeNodeByKey, node.key);\n    }\n  }\n}\n\ninterface ElementRule extends Omit<Rule, 'match'> {\n  isVoid?: boolean | ((controller: Controller, node: Node) => boolean);\n  isEdgeSelectable?: boolean;\n  /**\n   * Inline 内边缘是否可选中\n   */\n  isSideSelectable?: boolean;\n}\n\nfunction isOnlyContainsVoidAndEdgeSelectable(rule: ElementRule) {\n  return !Object.keys(rule)\n    .filter(key => key !== 'isVoid' && key !== 'isEdgeSelectable')\n    .length;\n}\n\ninterface MarkRule extends Omit<Rule, 'match'> {\n  isAtomic?: boolean;\n}\n\nfunction isOnlyContainsAtomic(rule: MarkRule) {\n  return !Object.keys(rule)\n    .filter(key => key !== 'isAtomic')\n    .length;\n}\n\nexport interface Schema {\n  rules?: Rule[];\n  document?: Omit<Rule, 'match'>;\n  blocks?: Record<string, ElementRule>;\n  inlines?: Record<string, ElementRule>;\n  marks?: Record<string, MarkRule>;\n}\n\nexport default function createNormalizationPlugin(schema: Schema) {\n  const {\n    rules = [],\n    document,\n    blocks = {},\n    inlines = {},\n    marks = {},\n  } = schema;\n\n  const schemaRules = [...rules];\n  if (document) {\n    schemaRules.push({\n      match: [{ klass: 'document' }],\n      ...document,\n    });\n  }\n  Object.keys(blocks)\n    .filter((type) => !isOnlyContainsVoidAndEdgeSelectable(blocks[type]))\n    .forEach((type) => {\n      schemaRules.push({\n        match: [{ klass: 'block', type }],\n        ...blocks[type],\n      });\n    });\n  Object.keys(inlines)\n    .filter((type) => !isOnlyContainsVoidAndEdgeSelectable(inlines[type]))\n    .forEach((type) => {\n      schemaRules.push({\n        match: [{ klass: 'inline', type }],\n        ...inlines[type],\n      });\n    });\n  Object.keys(marks)\n    .filter((type) => isOnlyContainsAtomic(marks[type]))\n    .forEach((type) => {\n      schemaRules.push({\n        match: [{ klass: 'mark', type }],\n        ...marks[type],\n      });\n    });\n\n  // Check if a `mark` is atomic\n  const isAtomicDict: Record<string, boolean> = Object.create(null);\n  Object.keys(marks).forEach(type => {\n    if ('isAtomic' in marks[type]) {\n      isAtomicDict[type] = marks[type].isAtomic!;\n    }\n  });\n  function isAtomic(_, mark): boolean | undefined {\n    return isAtomicDict[mark.type];\n  }\n\n  const isVoidDict = {\n    block: Object.create(null),\n    inline: Object.create(null),\n  };\n  const isEdgeSelectableDict = {\n    block: Object.create(null),\n    inline: Object.create(null),\n  };\n  const isSideSelectableDict = Object.create(null);\n  Object.keys(blocks).forEach(type => {\n    if ('isVoid' in blocks[type]) {\n      isVoidDict.block[type] = blocks[type].isVoid;\n    }\n    if ('isEdgeSelectable' in blocks[type]) {\n      isEdgeSelectableDict.block[type] = blocks[type].isEdgeSelectable;\n    }\n  });\n  Object.keys(inlines).forEach(type => {\n    if ('isVoid' in inlines[type]) {\n      isVoidDict.inline[type] = inlines[type].isVoid;\n    }\n    if ('isEdgeSelectable' in inlines[type]) {\n      isEdgeSelectableDict.inline[type] = inlines[type].isEdgeSelectable;\n    }\n    if ('isSideSelectable' in inlines[type]) {\n      isSideSelectableDict[type] = inlines[type].isSideSelectable;\n    }\n  });\n  // Check if a `node` is void.\n  function isVoid(controller: Controller, node: Node): boolean | undefined {\n    let klass = '';\n    if (Block.isBlock(node)) {\n      klass = 'block';\n    }\n    if (Inline.isInline(node)) {\n      klass = 'inline';\n    }\n    if (!klass) {\n      return undefined;\n    }\n    const predict = isVoidDict[klass][(node as Element).type];\n    return typeof predict === 'function'\n      ? predict(controller, node)\n      : predict;\n  }\n\n  // Check if the side of `node` is selectable\n  function isSideSelectable(controller: Controller, node: Node): boolean | undefined {\n    if (Inline.isInline(node)) {\n      return isSideSelectableDict[node.type];\n    }\n    return undefined;\n  }\n\n  // Check if a `node` is selectable.\n  function isEdgeSelectable(_, node: Node): boolean | undefined {\n    let klass = '';\n    if (Block.isBlock(node)) {\n      klass = 'block';\n    }\n    if (Inline.isInline(node)) {\n      klass = 'inline';\n    }\n    if (!klass) {\n      return undefined;\n    }\n    return isEdgeSelectableDict[klass][(node as Element).type];\n  }\n\n  function validateNode(node: Node, controller: Controller, next) {\n    const matches = schemaRules.filter(\n      (r) => r.match && testRules(node, r.match),\n    );\n    const error = validateRules(node, matches, schemaRules, { every: true });\n    if (!error) {\n      return next();\n    }\n    return error;\n  }\n\n  function normalizeNode(node: Node, controller: Controller, next) {\n    const error = validateNode(node, controller, () => null);\n    if (!error) {\n      return next();\n    }\n    return () => {\n      const { rule } = error;\n      const { document: $document } = controller.value;\n      if (rule.normalize) {\n        rule.normalize(controller, error);\n      }\n      if (controller.value.document === $document) {\n        defaultNormalize(controller, error);\n      }\n    };\n  }\n\n  return {\n    models: [],\n    queries: { isAtomic, isVoid, isEdgeSelectable, isSideSelectable },\n    validateNode,\n    normalizeNode,\n  };\n}\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport Controller from '../controller/index';\nimport * as Commands from '../commands/index';\nimport Node from '../models/node';\nimport Document from '../models/document';\nimport Block from '../models/block';\nimport Inline from '../models/inline';\nimport Text from '../models/text';\n\nfunction isInlineOrText(node: Node) {\n  return Inline.isInline(node) || Text.isText(node);\n}\n\nfunction normalizeNode(node: Node, controller: Controller, next) {\n  if (Document.isDocument(node)) {\n    // Only allow block nodes in documents.\n    const length = node.nodes.length;\n    for (let i = 0; i < length; i += 1) {\n      const child = node.nodes[i];\n      if (!Block.isBlock(child)) {\n        return () => controller.command(Commands.removeNodeByKey, (child as Node)!.key);\n      }\n    }\n  } else if (Block.isBlock(node) || Inline.isInline(node)) {\n    const length = node.nodes.length;\n    // Ensure that block and inline nodes have at least one text child.\n    if (length < 1) {\n      return () => controller.command(Commands.insertNodeByKey, node.key, 0, Text.create());\n    }\n\n    // 1. Only allow block nodes or inline and text nodes in blocks.\n    // 2. Only allow inline and text nodes in inlines.\n    const predicate = Block.isBlock(node) && Block.isBlock(node.nodes[0])\n      ? Block.isBlock\n      : isInlineOrText;\n    for (let i = 0; i < length; i += 1) {\n      const child = node.nodes[i];\n      if (!predicate(child)) {\n        return () => controller.command(Commands.removeNodeByKey, child.key);\n      }\n\n      // Ensure that inline nodes are surrounded by text nodes.\n      if (i === 0 && Inline.isInline(child)) {\n        return () => controller.command(Commands.insertNodeByKey, node.key, 0, Text.create());\n      }\n      const next = node.nodes[i + 1];\n      if (Inline.isInline(child)) {\n        if (!Text.isText(next)) {\n          return () => controller.command(Commands.insertNodeByKey, node.key, i + 1, Text.create());\n        }\n      } else if (Text.isText(child)) {\n        // Merge adjacent text nodes.\n        if (Text.isText(next)) {\n          return () => controller.command(Commands.mergeNodeByKey, next.key);\n        }\n      }\n    }\n  }\n  return next();\n}\n\nexport default function createCoreSchemaPlugin() {\n  return {\n    normalizeNode,\n  };\n}\n","/**\n * @packageDocumentation\n * @module Models\n */\n\nimport { MAX_HISTORY_SIZE } from '../constants';\nimport ImmutableRecord from './immutableRecord';\nimport Operation, { OperationType } from './operation';\nimport Path from './path';\n\nconst BATCH_UNDO_MERGE_TIME = 1000;\n\nfunction shouldClear(op: Operation) {\n  return op.type !== OperationType.SetSelection;\n}\n\nfunction shouldMerge(op: Operation, prevOp: Operation) {\n  if (!prevOp) return false;\n\n  return (\n    (op.type === OperationType.InsertText &&\n      prevOp.type === OperationType.InsertText &&\n      op.offset === prevOp.offset + prevOp.text.length &&\n      Path.isEqual(op.path, prevOp.path)) ||\n    (op.type === OperationType.RemoveText &&\n      prevOp.type === OperationType.RemoveText &&\n      op.offset + op.text.length === prevOp.offset &&\n      Path.isEqual(op.path, prevOp.path))\n  );\n}\n\nfunction shouldOverwrite(op: Operation, prevOp: Operation | undefined) {\n  return prevOp && op.type === OperationType.SetSelection && prevOp.type === OperationType.SetSelection;\n}\n\nexport interface HistoryProperties {\n  redos: Operation[][];\n  undos: Operation[][];\n}\n\nexport default class History extends ImmutableRecord {\n  static create(params?: { maxHistorySize?: number }) {\n    return new History(params);\n  }\n\n  private constructor(props: Partial<HistoryProperties & {\n    lastUndoCreatedTime: number;\n    maxHistorySize?: number;\n  }> = {}) {\n    super();\n    const {\n      redos = [],\n      undos = [],\n      lastUndoCreatedTime = 0,\n      maxHistorySize = MAX_HISTORY_SIZE,\n    } = props;\n    this.redos = redos;\n    this.undos = undos.slice(-maxHistorySize);\n    this.lastUndoCreatedTime = lastUndoCreatedTime;\n    this.maxHistorySize = maxHistorySize;\n    this.freeze();\n  }\n\n  public readonly redos: Operation[][];\n\n  public readonly undos: Operation[][];\n\n  private readonly lastUndoCreatedTime: number = 0;\n\n  private readonly maxHistorySize: number;\n\n  public merge(props: Partial<HistoryProperties>) {\n    return new History({\n      redos: this.redos,\n      undos: this.undos,\n      maxHistorySize: this.maxHistorySize,\n      ...props,\n      lastUndoCreatedTime: this.lastUndoCreatedTime,\n    });\n  }\n\n  public set<T extends keyof HistoryProperties>(\n    key: T,\n    value: Required<HistoryProperties>[T],\n  ) {\n    return this.merge({\n      [key]: value,\n    });\n  }\n\n  public moveLastRedoRecordToUndos() {\n    const { redos } = this;\n    if (!redos.length) {\n      return this;\n    }\n    const newRedos = redos.slice(0, -1);\n    const lastRedoRecord = redos[redos.length - 1];\n    const newUndos = [...this.undos, lastRedoRecord];\n    return this.merge({\n      undos: newUndos,\n      redos: newRedos,\n    });\n  }\n\n  public moveLastUndoRecordToRedos(undoRecord?: Operation[]) {\n    const { undos } = this;\n    if (!undos.length) {\n      return this;\n    }\n\n    const newUndos = undos.slice(0, -1);\n    const lastUndoRecord = undoRecord || undos[undos.length - 1];\n    const newRedos = [...this.redos, lastUndoRecord];\n    return this.merge({\n      undos: newUndos,\n      redos: newRedos,\n    });\n  }\n\n  public mergeToLastUndoIfNeed(operation: Operation, forceMerge: boolean) {\n    let undos = [...this.undos];\n    let lastBatch = undos[undos.length - 1];\n    const lastOp = lastBatch && lastBatch[lastBatch.length - 1];\n    const overwrite = shouldOverwrite(operation, lastOp);\n    const merge = !!lastBatch\n      && (this.lastUndoCreatedTime === 0 || Date.now() - this.lastUndoCreatedTime <= BATCH_UNDO_MERGE_TIME)\n      && (shouldMerge(operation, lastOp) || overwrite);\n\n    if (lastBatch && (merge || forceMerge)) {\n      if (overwrite) {\n        lastBatch = lastBatch.slice(0, -1);\n      }\n      lastBatch = [...lastBatch, operation];\n      undos = [...undos.slice(0, -1), lastBatch];\n    } else {\n      const batch = [operation];\n      undos = [...undos, batch];\n    }\n\n    return this.merge({\n      undos,\n      redos: shouldClear(operation) ? [] : this.redos,\n    });\n  }\n}\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport { isKeyHotkey } from 'is-hotkey';\nimport { IS_MAC } from './environment';\nimport React from 'react';\n\nconst HOTKEYS = {\n  bold: 'mod+b',\n  compose: [\n    'left',\n    'right',\n    'down',\n    'up',\n    'space',\n    'shift?+backspace',\n    'shift?+enter',\n    'shift?+delete',\n    'shift?+tab',\n  ],\n  moveBackward: 'left',\n  moveForward: 'right',\n  moveUpward: 'up',\n  moveDownward: 'down',\n  deleteBackward: 'shift?+backspace',\n  deleteForward: 'shift?+delete',\n  extendBackward: 'shift+left',\n  extendForward: 'shift+right',\n  extendUpward: 'shift+up',\n  extendDownward: 'shift+down',\n  italic: 'mod+i',\n  splitBlock: 'shift?+enter',\n  undo: 'mod+z',\n  space: 'space',\n  enter: 'enter',\n  tab: 'tab',\n  copy: 'mod+c',\n  cut: 'mod+x',\n  paste: 'mod+v',\n};\n\n// https://support.apple.com/en-us/HT201236\nconst APPLE_HOTKEYS = {\n  selectAll: 'cmd+a',\n  moveBackward: 'ctrl+b',\n  moveForward: 'ctrl+f',\n  moveUpward: 'ctrl+p',\n  moveDownward: 'ctrl+n',\n  moveWordBackward: 'opt+left',\n  moveWordForward: 'opt+right',\n  moveLineBackward: ['cmd+left', 'home'],\n  moveLineForward: ['cmd+right', 'end'],\n  moveBlockBackward: ['opt+up', 'ctrl+a'],\n  moveBlockForward: ['opt+down', 'ctrl+e'],\n  moveToDocumentStart: 'cmd+up',\n  moveToDocumentEnd: 'cmd+down',\n  deleteBackward: ['ctrl+backspace'],\n  deleteForward: ['ctrl+delete', 'ctrl+d', 'fn+delete'],\n  deleteLineBackward: 'cmd+shift?+backspace',\n  deleteLineForward: ['cmd+shift?+delete', 'ctrl+k'],\n  deleteWordBackward: 'opt+shift?+backspace',\n  deleteWordForward: 'opt+shift?+delete',\n  extendWordBackward: 'opt+shift+left',\n  extendWordForward: 'opt+shift+right',\n  extendLineBackward: 'cmd+shift+left',\n  extendLineForward: 'cmd+shift+right',\n  extendBlockBackward: ['opt+shift+up', 'ctrl+shift+a'],\n  extendBlockForward: ['opt+shift+down', 'ctrl+shift+e'],\n  extendToDocumentStart: ['cmd+shift+up', 'fn+left'],\n  extendToDocumentEnd: ['cmd+shift+down', 'fn+right'],\n  splitBlock: 'ctrl+o',\n  redo: 'cmd+shift+z',\n  transposeCharacter: 'ctrl+t',\n};\n\n// https://support.microsoft.com/en-us/help/12445/windows-keyboard-shortcuts\nconst WINDOWS_HOTKEYS = {\n  moveWordBackward: 'ctrl+left',\n  moveWordForward: 'ctrl+right',\n  moveLineBackward: 'home',\n  moveLineForward: 'end',\n  moveBlockBackward: 'ctrl+up',\n  moveBlockForward: 'ctrl+down',\n  moveToDocumentStart: 'ctrl+home',\n  moveToDocumentEnd: 'ctrl+end',\n  extendWordBackward: 'ctrl+shift+left',\n  extendWordForward: 'ctrl+shift+right',\n  extendLineBackward: 'shift+home',\n  extendLineForward: 'shift+end',\n  extendBlockBackward: 'ctrl+shift+up',\n  extendBlockForward: 'ctrl+shift+down',\n  selectAll: 'ctrl+a',\n  deleteWordBackward: 'ctrl+shift?+backspace',\n  deleteWordForward: 'ctrl+shift?+delete',\n  redo: ['ctrl+y', 'ctrl+shift+z'],\n};\n\nconst create = (key: string) => {\n  const generic = HOTKEYS[key];\n  const apple = APPLE_HOTKEYS[key];\n  const windows = WINDOWS_HOTKEYS[key];\n  const isGeneric = generic && isKeyHotkey(generic);\n  const isApple = apple && isKeyHotkey(apple);\n  const isWindows = windows && isKeyHotkey(windows);\n\n  return (event: React.KeyboardEvent | KeyboardEvent) => {\n    if (isGeneric && isGeneric(event)) {\n      return true;\n    }\n    if (IS_MAC && isApple && isApple(event)) {\n      return true;\n    }\n    if (!IS_MAC && isWindows && isWindows(event)) {\n      return true;\n    }\n    return false;\n  };\n};\n\nexport default {\n  isBold: create('bold'),\n  isCompose: create('compose'),\n  isSelectAll: create('selectAll'),\n  isMoveBackward: create('moveBackward'),\n  isMoveForward: create('moveForward'),\n  isMoveUpward: create('moveUpward'),\n  isMoveDownward: create('moveDownward'),\n  isDeleteBackward: create('deleteBackward'),\n  isDeleteForward: create('deleteForward'),\n  isDeleteLineBackward: create('deleteLineBackward'),\n  isDeleteLineForward: create('deleteLineForward'),\n  isDeleteWordBackward: create('deleteWordBackward'),\n  isDeleteWordForward: create('deleteWordForward'),\n  isExtendBackward: create('extendBackward'),\n  isExtendForward: create('extendForward'),\n  isExtendUpward: create('extendUpward'),\n  isExtendDownward: create('extendDownward'),\n  isExtendWordBackward: create('extendWordBackward'),\n  isExtendWordForward: create('extendWordForward'),\n  isExtendLineBackward: create('extendLineBackward'),\n  isExtendLineForward: create('extendLineForward'),\n  isExtendBlockBackward: create('extendBlockBackward'),\n  isExtendBlockForward: create('extendBlockForward'),\n  isExtendToDocumentStart: create('extendToDocumentStart'),\n  isExtendToDocumentEnd: create('extendToDocumentEnd'),\n  isItalic: create('italic'),\n  isMoveWordBackward: create('moveWordBackward'),\n  isMoveWordForward: create('moveWordForward'),\n  isMoveLineBackward: create('moveLineBackward'),\n  isMoveLineForward: create('moveLineForward'),\n  isMoveBlockBackward: create('moveBlockBackward'),\n  isMoveBlockForward: create('moveBlockForward'),\n  isMoveToDocumentStart: create('moveToDocumentStart'),\n  isMoveToDocumentEnd: create('moveToDocumentEnd'),\n  isRedo: create('redo'),\n  isSplitBlock: create('splitBlock'),\n  isTransposeCharacter: create('transposeCharacter'),\n  isUndo: create('undo'),\n  isSpace: create('space'),\n  isEnter: create('enter'),\n  isCopy: create('copy'),\n  isCut: create('cut'),\n  isPaste: create('paste'),\n};\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport Controller from '../controller/index';\nimport { ControllerConfigs } from '../interfaces/controller';\nimport History from '../models/history';\nimport Operation, { OperationType, SetSelectionOperation } from '../models/operation';\nimport Document from '../models/document';\nimport Selection, { SelectionJSON } from '../models/selection';\nimport hotkeys from '../utils/hotkeys';\n\nconst SUPRESS_WITHOUT_SAVING_ERROR = { __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED: true };\n\nfunction deserializeSelection(document: Document, selection: SelectionJSON) {\n  const { anchor, focus } = selection;\n  return Selection.fromJSON({\n    anchor: {\n      ...anchor,\n      // @ts-ignore\n      key: anchor.path ? document.assertNodeByPath(anchor.path).key : anchor.key,\n    },\n    focus: {\n      ...focus,\n      // @ts-ignore\n      key: focus.path ? document.assertNodeByPath(focus.path).key : focus.key,\n    },\n  });\n}\n\nfunction deserializeOperation(document: Document, operation: Operation) {\n  if (operation.type !== OperationType.SetSelection) {\n    return operation;\n  }\n  const selection = deserializeSelection(document, operation.selection);\n  const prevSelection = deserializeSelection(document, operation.prevSelection);\n  return {\n    ...operation,\n    selection,\n    prevSelection,\n  } as SetSelectionOperation;\n}\n\nfunction serializeSelection(document: Document, selection: Selection) {\n  const { anchor, focus } = selection;\n  return {\n    anchor: {\n      ...anchor.toJSON(),\n      path: document.getPath(anchor.key),\n    },\n    focus: {\n      ...focus.toJSON(),\n      path: document.getPath(focus.key),\n    },\n  };\n}\n\nexport default function createHistoryPlugin(configs?: ControllerConfigs) {\n  const maxHistorySize = configs?.history?.maxHistorySize;\n\n  function redo(controller: Controller) {\n    const { value } = controller;\n    const history: History = value.data.history || History.create({ maxHistorySize });\n    const { redos } = history;\n    if (!redos.length) {\n      return controller;\n    }\n\n    const batch = redos[redos.length - 1];\n    controller.withoutNormalizing(() => {\n      controller.withoutSaving(() => {\n        batch.forEach(op => {\n          controller.applyOperation(deserializeOperation(controller.value.document, op));\n        });\n      }, SUPRESS_WITHOUT_SAVING_ERROR);\n    });\n    const newHistory = history.moveLastRedoRecordToUndos();\n    return controller.setData({\n      ...value.data,\n      history: newHistory,\n    });\n  }\n\n  function undo(controller: Controller) {\n    const { value } = controller;\n    const history: History = value.data.history || History.create({ maxHistorySize });\n    const { undos } = history;\n    if (!undos.length) {\n      return controller;\n    }\n\n    const undoRecord: Operation[] = [];\n    controller.withoutNormalizing(() => {\n      controller.withoutSaving(() => {\n        const reversed = [...undos[undos.length - 1]].reverse();\n        reversed.forEach(op => {\n          undoRecord.unshift(undoOperation(controller, op));\n          controller.applyOperation(deserializeOperation(controller.value.document, Operation.invert(op)));\n        });\n      }, SUPRESS_WITHOUT_SAVING_ERROR);\n    });\n    const newHistory = history.moveLastUndoRecordToRedos(undoRecord);\n    return controller.setData({\n      ...value.data,\n      history: newHistory,\n    });\n  }\n\n  function undoOperation(controller: Controller, operation: Operation) {\n    if (operation.type === OperationType.InsertNode) {\n      const { document } = controller.value;\n      return {\n        ...operation,\n        node: document.assertNodeByPath(operation.path),\n      };\n    }\n    return operation;\n  }\n\n  function onConstruct(controller: Controller, next) {\n    // @ts-ignore\n    const privateApplyOperation = controller.privateApplyOperation;\n    // @ts-ignore\n    controller.privateApplyOperation = (op: Operation) => {\n      // @ts-ignore\n      if (controller.flag.saving) {\n        const { value, operations } = controller;\n        const { document, data } = value;\n\n        // @ts-ignore\n        const operation: Operation = op.type === OperationType.SetSelection\n          ? {\n            ...op,\n            selection: serializeSelection(document, op.selection),\n            prevSelection: serializeSelection(document, op.prevSelection),\n          }\n          : op;\n\n        const history: History = data.history || History.create({ maxHistorySize });\n        const newHistory = history.mergeToLastUndoIfNeed(operation, operations.length !== 0);\n        const newValue = value.set('data', {\n          ...value.data,\n          history: newHistory,\n        });\n        controller.setValue(newValue, {\n          clearOperations: false,\n          normalize: false,\n          clearHots: false,\n        });\n      }\n      return privateApplyOperation.call(controller, op);\n    };\n    return next();\n  }\n\n  function onKeyDown(event: React.KeyboardEvent, controller: Controller, next) {\n    if (hotkeys.isRedo(event as any)) {\n      event.preventDefault();\n      return controller.withoutPending((ctrl) => {\n        return ctrl.command('redo');\n      });\n    }\n    if (hotkeys.isUndo(event as any)) {\n      event.preventDefault();\n      return controller.withoutPending((ctrl) => {\n        return ctrl.command('undo');\n      });\n    }\n    return next();\n  }\n\n  return {\n    commands: {\n      redo,\n      undo,\n    },\n    onConstruct,\n    onKeyDown,\n    models: [],\n  };\n}\n","// eslint-disable-next-line import/no-extraneous-dependencies\n/**\n * @packageDocumentation\n * @ignore\n */\nimport * as React from 'react';\nimport Selection from '../../../models/selection';\nimport { CURSOR_WIDTH } from '../../../constants';\nimport Controller from '../../../controller';\nimport { PendingType } from '../../../interfaces/controller';\n\ntype CaretMode = 'placeholder' | 'caret';\n\nconst CURSOR_BLINK_ANIMATION_TIME = 530;\n\nconst CURSOR_STYLE: React.CSSProperties = {\n  position: 'absolute',\n  top: 0,\n  left: 0,\n  width: CURSOR_WIDTH,\n  opacity: 1,\n  zIndex: 1,\n  pointerEvents: 'none',\n  willChange: 'transform,height,opacity',\n};\n\nfunction useBlinkAnimation(\n  cursorRef: React.RefObject<HTMLSpanElement>,\n  pointStr: string,\n  controller: Controller,\n  // Placeholder Mode: disable the blink animation and add an opacity style\n  mode?: CaretMode,\n) {\n  const isVisible = React.useRef(true);\n  const timeout = React.useRef<number | null>(null);\n  const prevPoint = React.useRef<string | null>(null);\n\n  React.useLayoutEffect(() => {\n    const caretNode = cursorRef.current;\n    if (!caretNode || !pointStr) {\n      return undefined;\n    }\n\n    if (mode === 'placeholder') {\n      caretNode.style.opacity = '0.5';\n      return undefined;\n    }\n\n    function toggleBackgroundColor() {\n      if (caretNode) {\n        // 输入过程中不闪烁\n        if (controller.isPending && controller.pendingType === PendingType.input) {\n          caretNode.style.opacity = '1';\n        } else {\n          const visible = prevPoint.current !== pointStr || isVisible.current;\n          caretNode.style.opacity = visible ? '1' : '0';\n          isVisible.current = !visible;\n        }\n      }\n      timeout.current = window.setTimeout(\n        toggleBackgroundColor,\n        CURSOR_BLINK_ANIMATION_TIME,\n      );\n    }\n    toggleBackgroundColor();\n    prevPoint.current = pointStr;\n\n    return () => {\n      if (timeout.current) {\n        clearTimeout(timeout.current);\n      }\n    };\n  }, [pointStr, mode, controller]);\n}\n\ninterface LocalCaretProps {\n  controller: Controller;\n  selection: Selection;\n  color: string;\n  position: {\n    top: number;\n    left: number;\n    height: number;\n  };\n  style?: React.CSSProperties;\n  mode?: CaretMode;\n}\n\nexport default function LocalCaret(props: LocalCaretProps) {\n  const ref = React.useRef<HTMLSpanElement>(null);\n\n  const { position, color, style, mode, controller, selection } = props;\n\n  /* https://aone.alibaba-inc.com/v2/bug/35876239# 《【0730闪会BugBash】左侧 edge selection 定位到高亮条外面去了》 */\n  // 外部无法通过样式直接影响选区，需要通过 query 指定自定义偏移量\n  const { left = 0, top = 0 } = React.useMemo(() => {\n    if (selection.isExpanded) {\n      return {};\n    }\n    return controller.query('getCaretOffset', selection) || {};\n  }, [selection, controller]);\n\n  const point = selection.anchor;\n  const pointStr = selection.isCollapsed ? point.viewKey : '';\n  const where = point.isTextPoint()\n    ? point.offset + controller.value.composing.length\n    : point.edge;\n  const cursorStyle: React.CSSProperties = {\n    ...CURSOR_STYLE,\n    backgroundColor: color,\n    height: position.height,\n    ...(style || {}),\n    transform: `translateX(${position.left + left}px) translateY(${position.top + top}px)`,\n  };\n\n  useBlinkAnimation(ref, pointStr, controller, mode);\n\n  return (\n    <span\n      ref={ref}\n      data-testid=\"cangjie-caret\"\n      data-cangjie-caret=\"true\"\n      data-cangjie-point={pointStr}\n      key={pointStr}\n      data-where={where}\n      style={cursorStyle}\n    />\n  );\n}\n","import * as React from 'react';\nimport equal from 'fast-deep-equal';\nimport Controller from '../../../controller';\nimport Selection from '../../../models/selection';\nimport LocalCaret from './caret';\nimport { CaretAppearance } from '../types';\n\nexport { LocalCaret };\n\ninterface CaretProps {\n  controller: Controller;\n  selection: Selection;\n  isRemote: boolean;\n  isFocused: boolean;\n  position: CaretAppearance;\n  color?: string;\n}\n\nconst isComponentPropsEqual = (prevProps: CaretProps, nextProps: CaretProps) => {\n  return (\n    prevProps.isFocused === nextProps.isFocused\n    && prevProps.isRemote === nextProps.isRemote\n    && prevProps.color === nextProps.color\n    && prevProps.selection === nextProps.selection\n    && equal(prevProps.position, nextProps.position)\n  );\n};\n\n// eslint-disable-next-line prefer-arrow-callback\nexport default React.memo(function Caret(props: CaretProps) {\n  const { controller, isRemote, isFocused, selection, color, position } = props;\n  const { onBlur: showCaretOnBlur, onReadOnly: showCaretOnReadOnly } = controller.showCaret || {};\n\n  if (selection.isExpanded) {\n    return null;\n  }\n\n  if (\n    // 大多数情况，focused && 编辑态\n    (isFocused && !controller.readOnly) ||\n    // blur 时，配置 showCaretOnBlur 时可以显示远程光标\n    (!isFocused && isRemote && showCaretOnBlur) ||\n    // 只读时，配置 showCaretOnReadOnly 时可以显示远程光标\n    (controller.readOnly && isRemote && showCaretOnReadOnly)\n  ) {\n    return (\n      <>\n        {isRemote\n          ? controller.run('renderRemoteCaret', { selection, position })\n          : controller.run('renderCaret', { position, color: color! })\n        }\n      </>\n    );\n  }\n\n  return null;\n}, isComponentPropsEqual);\n","/**\n * @packageDocumentation\n * @module Events\n */\ninterface CangjieInputDetail {\n  type: string;\n  data: string | null;\n};\n\ninterface CangjieInputEvent extends CustomEvent<CangjieInputDetail> {}\n\nfunction CangjieInputEvent(detail: CangjieInputDetail) {\n  return new CustomEvent('cangjieInput', { detail });\n}\n\nexport default CangjieInputEvent;\n","/**\n * @packageDocumentation\n * @module domUtils\n */\nimport Controller from '../../controller/index';\nimport { Selector } from '../../constants';\nimport findClosestInContent from './findClosestInContent';\n\n/**\n * 根据浏览器的 HTML Element 获取仓颉的 Node。\n */\nfunction findNode(element: Element, controller: Controller) {\n  const closest = findClosestInContent(element, `[${Selector.key}]`);\n  if (!closest) return null;\n\n  const key = closest.getAttribute(Selector.key);\n  if (!key) return null;\n\n  const { value } = controller;\n  const { document } = value;\n  const node = document.getNode(key);\n  return node || null;\n}\n\nexport default findNode;\n","import Controller from '../controller/index';\nimport Node from '../models/node';\nimport { EdgePoint, TextPoint } from '../models/point';\nimport { select } from '../commands/selection';\nimport CangjieSelectEvent from '../events/cangjieSelect';\n\n/**\n * Detect if the cursor should be moved inside when deleting/moving at void edges\n */\nexport default function shoudStopInsideVoid(\n  controller: Controller,\n  direciton: 'moveBackward' | 'moveForward',\n) {\n  const isBackward = direciton === 'moveBackward';\n  const { selection, document } = controller.value;\n  const { anchor } = selection;\n  const node = document.getNode(anchor.key);\n  if (selection.isExpanded || !node) {\n    return false;\n  }\n  let voidNode: Node | null = null;\n  if (anchor.isEdgePoint()) {\n    // edge point cases, current node maybe void block\n    const isBackwardCase = isBackward && anchor.edge === EdgePoint.AFTER;\n    const isForwardCase = !isBackward && anchor.edge === EdgePoint.BEFORE;\n    const directionHit = isBackwardCase || isForwardCase;\n    const isVoid = controller.query('isVoid', node);\n    voidNode = isVoid && directionHit ? node : null;\n  } else if (isBackward && node.isText() && anchor.offset === 0) {\n    // text cases, previous node maybe void inline\n    const prev = document.getPreviousText(anchor.key);\n    const parent = prev && document.getParent(prev.key);\n    const isVoid = parent && controller.query('isVoid', parent);\n    voidNode =\n      isVoid && parent?.isElement() && parent.isInline() ? parent : null;\n  } else if (\n    !isBackward &&\n    node.isText() &&\n    node.text.length === anchor.offset\n  ) {\n    // text cases, next node maybe void inline\n    const next = document.getNextText(anchor.key);\n    const parent = next && document.getParent(next.key);\n    const isVoid = parent && controller.query('isVoid', parent);\n    voidNode =\n      isVoid && parent?.isElement() && parent.isInline() ? parent : null;\n  }\n\n  const point = voidNode && voidNode.getFirstText();\n  if (!point) {\n    return false;\n  }\n\n  // now we found the void, move inside!\n  const newPoint = TextPoint.create({ key: point.key, offset: 0 });\n  const newSelection = selection.set('anchor', newPoint).moveToAnchor();\n  controller.run(\n    'onCangjieSelect',\n    CangjieSelectEvent({ selection: newSelection, trigger: direciton }),\n  );\n  return true;\n}\n","export function perfMark(key: string) {\n  if (typeof performance.mark === 'function') {\n    performance.mark(key);\n  }\n}\n\nexport function perfMeasure(name: string, start: string, end: string) {\n  if (typeof performance.measure === 'function') {\n    performance.measure(name, start, end);\n  }\n}\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport * as React from 'react';\nimport equal from 'fast-deep-equal';\nimport Debug from 'debug';\nimport Controller from '../controller/index';\nimport * as Commands from '../commands/index';\nimport Plugin from '../interfaces/plugin';\nimport RenderEditableProps from '../interfaces/renderEditableProps';\nimport Selection, { SelectionTrigger } from '../models/selection';\nimport { EdgePoint } from '../models/point';\nimport Block from '../models/block';\nimport CangjieDataTransfer from '../models/dataTransfer';\nimport { LocalCaret } from '../components/selection/caret';\nimport CangjieClipboardEvent from '../events/cangjieClipboard';\nimport CangjieInputEvent from '../events/cangjieInput';\nimport CangjieSelectEvent from '../events/cangjieSelect';\nimport createClipboardDataFromSelection from '../utils/createClipboardDataFromSelection';\nimport { getEventTransfer, copyFragment } from '../utils/transfer';\nimport hotKeys from '../utils/hotkeys';\nimport findNode from '../utils/dom/findNode';\nimport * as environment from '../utils/environment';\nimport { CANGJIE_SELECTION_COLOR, CANGJIE_SELECTION_INACTIVE_COLOR, MIME_TYPES } from '../constants';\nimport shoudStopInsideVoid from '../utils/shouldStopInsideVoid';\nimport { PerfType } from '../interfaces/perf';\nimport { perfMark } from '../utils/perf';\nimport { ACTION_COPY, ACTION_CUT, ACTION_COPY_FAIL, ACTION_CUT_FAIL, ACTION_PASTE_FAIL } from './contextMenu';\nimport Operation from '../models/operation';\nimport { CaretAppearance } from '../components/selection';\nimport { CONTROLLER_TO_KEY_DOM } from '../utils/dom/getElementByCangjieKey';\nimport { Group } from '../interfaces/group';\n\nconst warn = Debug('EDITOR:CANGJIE:PLUGIN');\nif (typeof console !== 'undefined') {\n  warn.log = console.warn.bind(console);\n}\n\nconst IS_TOUCH_MOBILE = environment.IS_MOBILE || environment.IS_TOUCH_DEVICE;\n\nexport default function createCorePlugin(): Plugin {\n  function decorateNode() {\n    return [];\n  }\n\n  function injectToNode() {\n    return [];\n  }\n\n  function onApplyOperation(op: Operation, controller: Controller) {\n    return controller.applyOperation(op);\n  }\n\n  function groupNodes([ start, end ], { parent }): ReturnType<Required<Plugin>['groupNodes']> {\n    const { nodes } = parent;\n    return { node: nodes[start], remainedRange: [start + 1, end] };\n  }\n\n  function onCopy(event: React.ClipboardEvent, controller: Controller) {\n    event.preventDefault();\n    if (controller.readOnly && !controller.canCopy) {\n      warn('Copy command is prohibited.');\n      return;\n    }\n    const cangjieCopyEvent = CangjieClipboardEvent('cangjieCopy', {\n      nativeEvent: event.nativeEvent,\n    });\n    try {\n      controller.run(\n        'onCangjieCopy',\n        cangjieCopyEvent.setClipboardData(createClipboardDataFromSelection(controller)),\n      );\n    } catch (error) {\n      controller.run('onAction', { type: ACTION_COPY_FAIL, payload: { error } });\n      throw (error);\n    }\n  }\n\n  function onCut(event: React.ClipboardEvent, controller: Controller) {\n    event.preventDefault();\n    if (controller.readOnly && !controller.canCopy) {\n      warn('Cut command is prohibited.');\n      return;\n    }\n    const cangjieCutEvent = CangjieClipboardEvent('cangjieCut', {\n      nativeEvent: event.nativeEvent,\n    });\n    try {\n      controller.run(\n        'onCangjieCut',\n        cangjieCutEvent.setClipboardData(createClipboardDataFromSelection(controller)),\n      );\n    } catch (error) {\n      controller.run('onAction', { type: ACTION_CUT_FAIL, payload: { error } });\n      throw (error);\n    }\n  }\n\n  function onPaste(event: React.ClipboardEvent, controller: Controller) {\n    event.preventDefault();\n    const cangjiePasteEvent = CangjieClipboardEvent('cangjiePaste', {\n      nativeEvent: event.nativeEvent,\n    });\n    try {\n      controller.run('onCangjiePaste', cangjiePasteEvent.setClipboardData(CangjieDataTransfer.create(event.clipboardData)));\n    } catch (error) {\n      controller.run('onAction', { type: ACTION_PASTE_FAIL, payload: { isShortcut: true, error } });\n      throw (error);\n    }\n  }\n\n  function onCangjieFocus(controller: Controller) {\n    return controller.command(Commands.focus);\n  }\n\n  function onCangjieBlur(controller: Controller) {\n    return controller.command(Commands.blur);\n  }\n\n  function onCangjieInput(e: CangjieInputEvent, controller: Controller, next) {\n    const { document, selection } = controller.value;\n    const { detail } = e;\n    const { type, data } = detail;\n    if (type === 'insertText' && data) {\n      // 在这里 flush 会导致 Android 联想状态回车后续的 splitBlock 无效\n      // 但不 flush 会导致桌面端中文输入选词失效\n      return controller.command(Commands.insertText, data);\n    }\n    if (type === 'compositionStart') {\n      perfMark('compositionStart');\n      if (selection?.isExpanded) {\n        return controller.command('del');\n      }\n      if (\n        selection?.isCollapsed\n        && document.hasVoidParent(selection.anchor.key, controller)\n      ) {\n        return controller.command(Commands.moveToStartOfNextText);\n      }\n    }\n    if (type === 'deleteContentBackward') {\n      if (!selection) {\n        return next();\n      }\n      const length = (data || '').length;\n      return controller.command(Commands.deleteBackwardAtRange, selection, length);\n    }\n    if (type === 'insertParagraph') {\n      if (selection?.isCollapsed && document.hasVoidParent(selection.anchor.key, controller)) {\n        const parent = document.getClosestVoid(selection.anchor.key, controller);\n        if (document.getLastNode().key === selection.anchor.key && parent) {\n          return controller.command(Commands.insertEmptyBlock, EdgePoint.create({\n            key: parent.key,\n            edge: EdgePoint.AFTER,\n          }));\n        }\n        const nextText = document.getNextText(selection.focus.key);\n        if (nextText) {\n          const newRange = selection\n            .moveAnchorTo(nextText.key, 0)\n            .moveToAnchor();\n          return controller.run(\n            'onCangjieSelect',\n            CangjieSelectEvent({ selection: newRange }),\n          );\n        }\n      }\n      return controller.command(Commands.splitBlock);\n    }\n    return next();\n  }\n\n  function onCangjieSelect(event: CangjieSelectEvent, controller: Controller) {\n    const { detail } = event;\n    const { selection, trigger } = detail;\n    const { document, selection: prevSelection } = controller.value;\n\n    if (!Selection.isValidSelection(document, selection)) {\n      const selectionJSONString = JSON.stringify(\n        selection.toJSON({ preserveKeys: true }),\n        null,\n        2,\n      );\n      throw new Error(\n        `Core[onCangjieSelect] receive invalid selection: ${selectionJSONString}`,\n      );\n    }\n\n    // 发现selection除mark外没变化则不设置\n    // 这里是行为层，不是command层，做这种处理是安全的\n    if (\n      equal(prevSelection.data, selection.data)\n      && equal(prevSelection.anchor, selection.anchor)\n      && equal(prevSelection.focus, selection.focus)\n    ) {\n      return controller;\n    }\n\n    if (trigger) {\n      const selectionWithData = trigger === SelectionTrigger.Selecting\n        ? selection.merge({ data: { ...selection.data, trigger } })\n        : selection;\n      return controller.command(Commands.userSelect, selectionWithData);\n    }\n\n    return controller.command(Commands.select, selection);\n  }\n\n  function onCangjieCopy(event: CangjieClipboardEvent, controller: Controller) {\n    if (!controller.canCopy) {\n      warn('Copy command is prohibited.');\n      return;\n    }\n    copyFragment(event, () => {\n      if (environment.IS_MOBILE || environment.IS_TOUCH_DEVICE) {\n        controller.command(Commands.moveToEnd);\n      }\n    });\n  }\n\n  function onCangjieCut(event: CangjieClipboardEvent, controller: Controller) {\n    const { selection } = controller.value;\n    if (!controller.canCopy) {\n      warn('Cut command is prohibited.');\n      return;\n    }\n    copyFragment(event, () => {\n      // 修复移动端点击触发 copy 后，仓颉选区 collapsed，造成无法删除（iOS 12 系列及 iOS 14.6 ）\n      controller.command(Commands.select, selection).command(Commands.del);\n    });\n  }\n\n  function onCangjieComposingChange(composing = '', controller: Controller) {\n    if (!composing.length) {\n      perfMark('compositionEnd');\n    }\n    controller.setComposing(composing);\n  }\n\n  function onCangjiePaste(event: CangjieClipboardEvent, controller: Controller) {\n    if (!event.clipboardData) {\n      throw new Error('`event` is invalid, please pass clipbaord data with event.');\n    }\n\n    const transfer = getEventTransfer(event, controller);\n    if (transfer.fragment) {\n      controller.command(Commands.insertFragment, transfer.fragment);\n      return;\n    }\n    if (!transfer.text) {\n      return;\n    }\n    const texts = transfer.text.split('\\n');\n    texts.forEach((line, index) => {\n      if (index !== 0) {\n        controller.command(Commands.splitBlock);\n      }\n      controller.command(Commands.insertText, line);\n    });\n  }\n\n  function onClick(e: React.MouseEvent, controller: Controller, next) {\n    const { value } = controller;\n    const { document } = value;\n    const node = findNode(e.target as Element, controller);\n    if (!node) return next();\n    const ancestors = document.getAncestors(node.key);\n    const isVoid =\n      node &&\n      (controller.query('isVoid', node) ||\n        ancestors!.some((a) => controller.query('isVoid', a)));\n    const firstText = node.getFirstText();\n    if (isVoid && firstText) {\n      const selection = value.selection\n        .moveAnchorTo(firstText.key, 0)\n        .moveToAnchor();\n      controller.run('onCangjieSelect', CangjieSelectEvent({ selection }));\n    }\n    return next();\n  }\n  function onKeyDown(event: React.KeyboardEvent, controller: Controller, next) {\n    const { selection, document } = controller.value;\n    if (!selection) {\n      return next();\n    }\n    if (hotKeys.isSplitBlock(event)) {\n      event.preventDefault();\n      // 如果光标在一个 void 元素中，则不进行 split 操作，直接移动光标到下一个 Text 节点\n      // 这个行为主要用于处理 image/mention 等 inline 元素的断行问题\n      return controller.run('onCangjieInput', CangjieInputEvent({\n        type: 'insertParagraph',\n        data: null,\n      }));\n    }\n    if (hotKeys.isDeleteBackward(event)) {\n      if (environment.IS_MOBILE) {\n        // 移动端由于删除事件不准确，这里不 preventDefault，走 onChange 路径\n        return;\n      }\n      const isProceeded = shoudStopInsideVoid(controller, 'moveBackward');\n      event.preventDefault();\n      if (isProceeded) {\n        return controller;\n      }\n      return controller.command(Commands.deleteCharBackward);\n    }\n    if (hotKeys.isDeleteForward(event)) {\n      const isProceeded = shoudStopInsideVoid(controller, 'moveForward');\n      event.preventDefault();\n      if (isProceeded) {\n        return controller;\n      }\n      return controller.command(Commands.deleteCharForward);\n    }\n    if (hotKeys.isDeleteLineBackward(event)) {\n      event.preventDefault();\n      return controller.command(Commands.deleteLineBackward);\n    }\n    if (hotKeys.isDeleteLineForward(event)) {\n      event.preventDefault();\n      return controller.command(Commands.deleteLineForward);\n    }\n    if (hotKeys.isDeleteWordBackward(event)) {\n      event.preventDefault();\n      return controller.command(Commands.deleteWordBackward);\n    }\n    if (hotKeys.isDeleteWordForward(event)) {\n      event.preventDefault();\n      return controller.command(Commands.deleteWordForward);\n    }\n    if (hotKeys.isMoveBlockBackward(event)) {\n      event.preventDefault();\n      const newSelection = selection\n        .movePointEdgeKlass(controller, 'start', 'start', 'block')\n        .moveToStart(document);\n      return controller.command(Commands.select, newSelection);\n    }\n    if (hotKeys.isMoveBlockForward(event)) {\n      event.preventDefault();\n      const newSelection = selection\n        .movePointEdgeKlass(controller, 'end', 'end', 'block')\n        .moveToEnd(document);\n      return controller.command(Commands.select, newSelection);\n    }\n    if (hotKeys.isExtendBlockBackward(event)) {\n      event.preventDefault();\n      const newSelection = selection\n        .movePointEdgeKlass(controller, 'focus', 'start', 'block');\n      return controller.command(Commands.select, newSelection);\n    }\n    if (hotKeys.isExtendBlockForward(event)) {\n      event.preventDefault();\n      const newSelection = selection\n        .movePointEdgeKlass(controller, 'focus', 'end', 'block');\n      return controller.command(Commands.select, newSelection);\n    }\n    if (hotKeys.isCopy(event) && IS_TOUCH_MOBILE) {\n      controller.run('onAction', { type: ACTION_COPY });\n      return controller;\n    }\n    if (hotKeys.isCut(event) && IS_TOUCH_MOBILE) {\n      controller.run('onAction', { type: ACTION_CUT });\n      return controller;\n    }\n    return next();\n  }\n\n  function renderEditable(props: RenderEditableProps) {\n    const { children } = props;\n    return children();\n  }\n\n  function renderNode(props, _, next) {\n    const { attributes, node, children } = props;\n    const Tag = Block.isBlock(node) ? 'div' : 'span';\n    const result = next();\n    if (result === null) {\n      return <Tag {...attributes}>{children()}</Tag>;\n    }\n    return result;\n  }\n\n  function renderMark(props) {\n    const { children } = props;\n    return children();\n  }\n\n  function renderCaret({ position, color }: { position: CaretAppearance, color: string }, controller: Controller) {\n    const { value } = controller;\n    const { document, selection } = value;\n\n    if (!selection) {\n      return null;\n    }\n    if (document.getClosest(selection.focus.key, (node) => controller.query('isVoid', node))) {\n      return null;\n    }\n\n    return (\n      <LocalCaret\n        data-cangjie-selection={selection.viewKey}\n        controller={controller}\n        selection={selection}\n        position={position}\n        color={color}\n      />\n    );\n  }\n\n  function selectionColor(controller: Controller) {\n    const { isFocused } = controller.value;\n    return isFocused\n      ? CANGJIE_SELECTION_COLOR\n      : CANGJIE_SELECTION_INACTIVE_COLOR;\n  }\n\n  function isEditorBusy(controller: Controller) {\n    // OP Pending 或热区过程中\n    if (controller.isPending) {\n      return true;\n    }\n\n    // 输入法输入过程中\n    if (controller.value.composing) {\n      return true;\n    }\n\n    return false;\n  }\n\n  function onCleanup(controller, next) {\n    if (CONTROLLER_TO_KEY_DOM.has(controller)) {\n      // weakmap的value是map,引用到了dom\n      const map = CONTROLLER_TO_KEY_DOM.get(controller);\n      map && Object.keys(map).forEach((key) => {\n        map?.delete(key);\n      });\n      CONTROLLER_TO_KEY_DOM.delete(controller);\n    }\n    return next();\n  }\n\n  function mapOperation(op) {\n    return op;\n  }\n\n  function isElementInGroup(controller: Controller, element: Element, group: Group) {\n    return true;\n  }\n\n  return {\n    queries: {\n      selectionColor,\n      isEditorBusy,\n      isElementInGroup,\n    },\n    decorateNode,\n    injectToNode,\n    groupNodes,\n    onApplyOperation,\n    onCangjieFocus,\n    onCangjieBlur,\n    onCangjieInput,\n    onCangjieSelect,\n    onCangjieCopy,\n    onCangjieCut,\n    onCangjiePaste,\n    onCangjieComposingChange,\n    onClick,\n    onCopy,\n    onCut,\n    onKeyDown,\n    onPaste,\n    onCleanup,\n    renderEditable,\n    renderContent: renderEditable,\n    renderNode,\n    renderMark,\n    renderCaret,\n    mapOperation,\n    models: [],\n  };\n}\n","import { match, P } from 'ts-pattern';\nimport Document from '../../models/document';\nimport Element from '../../models/element';\nimport Operation, {\n  InsertNodeOperation,\n  OperationType,\n  RemoveNodeOperation,\n  SetNodeOperation,\n} from '../../models/operation';\nimport { UUIDConfig, UUIDMap, UUIDSDiff } from './types';\n\ntype OPAdjuster<T extends Operation> = (\n  op: T,\n  document: Document,\n) => { op: T; diff: UUIDSDiff };\n\nconst createMapOperations = (\n  gen: UUIDConfig['gen'],\n  uuidKey: string,\n  getUUIDs: () => UUIDMap,\n) => {\n  function generateUUID(node: Element, diff: UUIDSDiff) {\n    const uuids = getUUIDs();\n    const uuid = node.data[uuidKey];\n    // 如果无 UUID，或者 UUID 重复，则需要重新创建 UUID\n    if (!uuid || uuids[uuid]) {\n      const newUUID = gen();\n      uuids[newUUID] = node.key;\n      diff.adds.push({ uuid: newUUID, key: node.key });\n      return node.merge({\n        data: {\n          ...node.data,\n          [uuidKey]: newUUID,\n        },\n      });\n    }\n    return node;\n  }\n\n  const genUUIDForTree: (root: Element, diff: UUIDSDiff) => Element = (\n    root,\n    diff,\n  ) => {\n    const newRoot = root.mapDescendants((n) => {\n      if (n.isElement()) {\n        return generateUUID(n, diff);\n      }\n      return n;\n    });\n    return generateUUID(newRoot, diff);\n  };\n\n  const adjustSetNodeOperation: OPAdjuster<SetNodeOperation> = (\n    op,\n    document,\n  ) => {\n    const uuids = getUUIDs();\n    const { properties, prevProperties, path } = op;\n    const node = document.assertElementByPath(path);\n    /* istanbul ignore next */\n    const data = properties.data || {};\n    /* istanbul ignore next */\n    const prevData = prevProperties.data || {};\n    const theUUID = data[uuidKey] as string | undefined;\n    const thePrevUUID = prevData[uuidKey] as string | undefined;\n    return (\n      match({\n        uuid: theUUID,\n        prevUUID: thePrevUUID,\n        reset: theUUID !== thePrevUUID,\n      })\n        .with(\n          // 若设置节点时，丢失 UUID，则写回 UUID\n          { uuid: P.nullish, prevUUID: P.not(P.nullish) },\n          ({ prevUUID }) => ({\n            op: {\n              ...op,\n              properties: {\n                ...properties,\n                data: {\n                  ...data,\n                  [uuidKey]: prevUUID,\n                },\n              },\n            },\n            diff: {\n              adds: [],\n              removes: [],\n              updates: [],\n            },\n          }),\n        )\n        .with(\n          // 若设置节点时，UUID 不重复，则允许生成\n          {\n            uuid: P.when((id) => id && !uuids[id]),\n            prevUUID: P.not(P.nullish),\n            reset: true,\n          },\n          ({ uuid, prevUUID }) => {\n            return {\n              op,\n              diff: {\n                adds: [],\n                removes: [],\n                updates: [{ oldUUID: prevUUID, newUUID: uuid }],\n              },\n            };\n          },\n        )\n        .with(\n          // 若设置节点时，UUID 重复，则重新生成 UUID\n          {\n            uuid: P.when((id) => id && uuids[id] !== node.key),\n            prevUUID: P.not(P.nullish),\n            reset: true,\n          },\n          ({ prevUUID }) => {\n            const newUUID = gen();\n            return {\n              op: {\n                ...op,\n                properties: {\n                  ...properties,\n                  data: {\n                    ...data,\n                    [uuidKey]: newUUID,\n                  },\n                },\n              },\n              diff: {\n                adds: [],\n                removes: [],\n                updates: [{ oldUUID: prevUUID, newUUID }],\n              },\n            };\n          },\n        )\n        .with(\n          // 设置不含有 UUID 的节点时，若新的属性缺失 UUID，则生成 UUID\n          { uuid: P.nullish, prevUUID: P.nullish },\n          // 设置不含有 UUID 的节点时，若新的属性有 UUID，但重复，则生成 UUIID\n          {\n            uuid: P.when((id) => uuids[id] && uuids[id] !== node.key),\n            prevUUID: P.nullish,\n          },\n          () => {\n            const newUUID = gen();\n            return {\n              op: {\n                ...op,\n                properties: {\n                  ...properties,\n                  data: {\n                    ...data,\n                    [uuidKey]: newUUID,\n                  },\n                },\n              },\n              diff: {\n                adds: [{ uuid: newUUID, key: node.key }],\n                removes: [],\n                updates: [],\n              },\n            };\n          },\n        )\n        .with(\n          // 设置不含有 UUID 的节点时，若新的属性中含有不重复的 UUID，允许生成\n          { uuid: P.when((id) => id && !uuids[id]), prevUUID: P.nullish },\n          ({ uuid }) => {\n            return {\n              op,\n              diff: {\n                adds: [{ uuid, key: node.key }],\n                removes: [],\n                updates: [],\n              },\n            };\n          },\n        )\n        /* istanbul ignore next */\n        .otherwise(() => ({ op, diff: { adds: [], removes: [], updates: [] } }))\n    );\n  };\n\n  const adjustRemoveNodeOperation: OPAdjuster<RemoveNodeOperation> = (op) => {\n    const { node } = op;\n    if (node.isElement() && node.data[uuidKey]) {\n      const uuid = node.data[uuidKey];\n      return { op, diff: { adds: [], removes: [uuid], updates: [] } };\n    }\n    return { op, diff: { adds: [], removes: [], updates: [] } };\n  };\n\n  const adjustInsertNodeOperation: OPAdjuster<InsertNodeOperation> = (op) => {\n    const { node } = op;\n    const diff = { adds: [], removes: [], updates: [] };\n    if (node.isElement()) {\n      return { op: { ...op, node: genUUIDForTree(node, diff) }, diff };\n    }\n    return { op, diff };\n  };\n\n  return function mapOperation(\n    operation: Operation,\n    document: Document,\n  ): { op: Operation; diff: UUIDSDiff } {\n    return match(operation)\n      .with({ type: OperationType.RemoveNode }, (op) =>\n        adjustRemoveNodeOperation(op, document))\n      .with({ type: OperationType.SetNode }, (op) =>\n        adjustSetNodeOperation(op, document))\n      .with({ type: OperationType.InsertNode }, (op) =>\n        adjustInsertNodeOperation(op, document))\n      .otherwise((op) => ({\n        op,\n        diff: { adds: [], removes: [], updates: [] },\n      }));\n  };\n};\n\nexport default createMapOperations;\n","import Element from '../../models/element';\nimport { UUIDMap } from './types';\nimport Query, { ConvertToPluginQueries } from '../../interfaces/query';\n\nexport const createUUIDQuery = (uuidKey: string) => (_, node: Element) => {\n  return node.data[uuidKey];\n};\n\nexport const createAnchorQuery = (uuidKey: string) => (_, node: Element) => {\n  return node.data[uuidKey];\n};\n\nexport function createGetNodeKeyByUUID(getUUIDS: () => UUIDMap) {\n  const getNodeKeyByUUID: Query = (_, uuid: string) => {\n    const uuids = getUUIDS();\n    return uuids[uuid];\n  };\n  return getNodeKeyByUUID;\n}\n\ndeclare module '@ali/4ever-cangjie' {\n  /** type combination for commands、queries、actions */\n  interface PluginQueries\n    extends ConvertToPluginQueries<{\n      uuid: ReturnType<typeof createUUIDQuery>;\n      anchor: ReturnType<typeof createAnchorQuery>;\n      getNodeKeyByUUID: ReturnType<typeof createGetNodeKeyByUUID>;\n    }> {}\n}\n","import Document from '../../models/document';\nimport { NodeKey, UUID, UUIDMap, UUIDSDiff } from './types';\n\nexport function getUUIDSFromDocument(document: Document, uuidKey) {\n  const uuids: UUIDMap = {};\n  const duplications: string[] = [];\n  document.forEachDescendant((desendant) => {\n    if (desendant.isElement() && desendant.data[uuidKey]) {\n      const uuid = desendant.data[uuidKey];\n      if (uuids[uuid]) {\n        duplications.push(desendant.key);\n      } else {\n        uuids[uuid] = desendant.key;\n      }\n    }\n  });\n  return { uuids, duplications };\n}\n\nfunction toKeyUUIDMap(map: UUIDMap): Record<NodeKey, UUID> {\n  return Object.keys(map).reduce((ret, uuid) => {\n    ret[map[uuid]] = uuid;\n    return ret;\n  }, {});\n}\n\nexport function diffUUIDS(a: UUIDMap, b: UUIDMap): UUIDSDiff {\n  const aKeyToUUIDMap = toKeyUUIDMap(a);\n  const bKeyToUUIDMap = toKeyUUIDMap(b);\n\n  const diff: UUIDSDiff = {\n    adds: [],\n    removes: [],\n    updates: [],\n  };\n\n  Object.keys(aKeyToUUIDMap).forEach((nodeKey) => {\n    const aUUID = aKeyToUUIDMap[nodeKey];\n    const bUUID = bKeyToUUIDMap[nodeKey];\n    if (aUUID !== bUUID) {\n      diff.updates.push({ oldUUID: aUUID, newUUID: bUUID });\n    }\n    if (!bKeyToUUIDMap[nodeKey]) {\n      diff.removes.push(aUUID);\n    }\n  });\n\n  Object.keys(bKeyToUUIDMap).forEach((nodeKey) => {\n    if (!aKeyToUUIDMap[nodeKey]) {\n      diff.adds.push({ uuid: bKeyToUUIDMap[nodeKey], key: nodeKey });\n    }\n  });\n\n  return diff;\n}\n\nexport function isEmptyDiff(diff: UUIDSDiff) {\n  return !diff.adds.length && !diff.removes.length && !diff.updates.length;\n}\n","import Action, {\n  ConvertToPluginActionCreators,\n  ConvertToPluginActionPredicates,\n} from '../../interfaces/action';\nimport Element from '../../models/element';\nimport { UUIDMap, UUIDSDiff } from './types';\n\nexport const UPDATE_UUIDS = Symbol('update_uuids');\nexport const GENERATE_UUID = Symbol('generate_uuid');\nexport interface UpdateUUIDsPayload {\n  /** 最新的 UUID Map */\n  uuids: UUIDMap;\n  diff: UUIDSDiff;\n}\n\nexport interface UpdateUUIDsAction {\n  type: typeof UPDATE_UUIDS;\n  payload: UpdateUUIDsPayload;\n}\n\nexport interface GenerateUUIDPayload {\n  node: Element;\n}\nexport interface GenerateUUIDAction {\n  type: typeof GENERATE_UUID;\n  payload: GenerateUUIDPayload;\n}\n\nexport function updateUUIDs(payload: UpdateUUIDsPayload): UpdateUUIDsAction {\n  return {\n    type: UPDATE_UUIDS,\n    payload,\n  };\n}\n\nexport function isUpdateUUIDs(action: Action): action is UpdateUUIDsAction {\n  return action.type === UPDATE_UUIDS;\n}\n\nexport function generateUUID(payload: GenerateUUIDPayload) {\n  return {\n    type: GENERATE_UUID,\n    payload,\n  };\n}\n\nexport function isGenerateUUID(action: Action): action is GenerateUUIDAction {\n  return action.type === GENERATE_UUID;\n}\n\nexport const actions = {\n  updateUUIDs,\n  generateUUID,\n};\n\nexport const isActions = {\n  isUpdateUUIDs,\n  isGenerateUUID,\n};\n\ndeclare module '@ali/4ever-cangjie' {\n  /** type combination for commands、queries、actions */\n  interface PluginActionCreators\n    extends ConvertToPluginActionCreators<typeof actions> {}\n  interface PluginActionPredicates\n    extends ConvertToPluginActionPredicates<typeof isActions> {}\n}\n","import Controller from '../../controller';\nimport { ConvertToPluginCommands } from '../../interfaces/command';\nimport Node from '../../models/node';\nimport Element from '../../models/element';\n\nexport function setNodeUUID(\n  controller: Controller,\n  node: Element,\n  uuid: string,\n  uuidKey: string,\n) {\n  return controller.withoutSaving(() => {\n    controller.command('setNodeByKey', node.key, {\n      type: node.type,\n      data: { ...node.data, [uuidKey]: uuid },\n    });\n  });\n}\n\nexport function createGenerateUUID(gen: () => string, uuidKey: string) {\n  return function generateUUID(controller: Controller, node: Node) {\n    if (node.isElement() && !node.data[uuidKey]) {\n      const uuid = gen();\n      controller.command(setNodeUUID, node, uuid, uuidKey);\n    }\n    return controller;\n  };\n}\n\ndeclare module '@ali/4ever-cangjie' {\n  /** type combination for commands、queries、actions */\n  interface PluginCommands\n    extends ConvertToPluginCommands<{\n      generateUUID: ReturnType<typeof createGenerateUUID>;\n    }> {}\n}\n","import Controller from '../../controller';\nimport Action from '../../interfaces/action';\n\nexport default function onAction(\n  action: Action,\n  controller: Controller,\n  next: () => void,\n) {\n  const isGenerateUUID = controller.isActionFactory('isGenerateUUID');\n  if (isGenerateUUID?.(action)) {\n    return controller.command('generateUUID', action.payload.node);\n  }\n  return next();\n}\n","export const DEFAULT_UUID_KEY = '__uuid__';\n","import Controller from '../../controller';\nimport Plugin from '../../interfaces/plugin';\nimport createMapOperation from './createMapOperation';\nimport { createGetNodeKeyByUUID, createUUIDQuery } from './queries';\nimport { UUIDMap, UUIDConfig } from './types';\nimport { diffUUIDS, getUUIDSFromDocument, isEmptyDiff } from './utils';\nimport { actions, isActions } from './actions';\nimport Value from '../../models/value';\nimport { createGenerateUUID, setNodeUUID } from './commands';\nimport onAction from './onAction';\nimport { DEFAULT_UUID_KEY } from './constants';\n\nexport default function createUUIDPlugin(config: UUIDConfig): Plugin {\n  // 初始化 UUID 映射\n  let uuids: UUIDMap = {};\n\n  function getUUIDS() {\n    return uuids;\n  }\n\n  const uuidKey = config.uuidKey || DEFAULT_UUID_KEY;\n\n  function regenerateDuplicateUUIDS(controller: Controller, value: Value) {\n    const befores = { ...getUUIDS() };\n    const ret = getUUIDSFromDocument(value.document, uuidKey);\n    // 为重复的 id 重新生成 uuid\n    const newUUIDS = ret.duplications.reduce((ids, key) => {\n      const element = value.document.assertElement(key);\n      const uuid = config.gen();\n      controller.command(setNodeUUID, element, uuid, uuidKey);\n      ids[uuid] = key;\n      return ids;\n    }, ret.uuids);\n    const diff = diffUUIDS(befores, newUUIDS);\n    if (!isEmptyDiff(diff)) {\n      uuids = newUUIDS;\n      controller.dispatch('updateUUIDs', {\n        // Immutable，防止外部改动了 uuid\n        uuids: { ...newUUIDS },\n        diff,\n      });\n    }\n  }\n\n  const mapOperation = createMapOperation(config.gen, uuidKey, getUUIDS);\n\n  return {\n    actions,\n    isActions,\n    commands: {\n      generateUUID: createGenerateUUID(config.gen, uuidKey),\n    },\n    onConstruct: (controller, next) => {\n      regenerateDuplicateUUIDS(controller, controller.value);\n      return next();\n    },\n    onResetValue: (value, _, controller, next) => {\n      regenerateDuplicateUUIDS(controller, value);\n      return next();\n    },\n    onAction,\n    mapOperation: (operation, controller, next) => {\n      const { op, diff } = mapOperation(operation, controller.value.document);\n      if (isEmptyDiff(diff)) {\n        return op;\n      }\n      diff.removes.forEach((uuid) => {\n        delete uuids[uuid];\n      });\n      diff.adds.forEach(({ uuid, key }) => {\n        uuids[uuid] = key;\n      });\n      diff.updates.forEach(({ oldUUID, newUUID }) => {\n        const nodeKey = uuids[oldUUID];\n        uuids[newUUID] = nodeKey;\n        delete uuids[oldUUID];\n      });\n      controller.dispatch('updateUUIDs', {\n        // Immutable，防止外部改动了 uuid\n        uuids: { ...uuids },\n        diff,\n      });\n      return next(op);\n    },\n    queries: {\n      uuid: createUUIDQuery(uuidKey),\n      anchor: createUUIDQuery(uuidKey),\n      getNodeKeyByUUID: createGetNodeKeyByUUID(getUUIDS),\n    },\n  };\n}\n","export const TOGGLE_GROUP_FOLD = Symbol('toggleGroupFold');\nexport const FOLD_GROUP = Symbol('fold');\nexport const EXPAND_GROUP = Symbol('expand');\n\nexport interface SetGroupFoldPayload {\n  key: string;\n}\n\n/**\n * 折叠/展开分组\n * @param key\n * @returns\n */\nexport function toggleGroupFold(key: string) {\n  return {\n    type: TOGGLE_GROUP_FOLD,\n    payload: { key } as SetGroupFoldPayload,\n  };\n}\n\n/**\n * 折叠分组\n * @param key\n * @returns\n */\nexport function fold(key: string) {\n  return {\n    type: FOLD_GROUP,\n    payload: { key } as SetGroupFoldPayload,\n  };\n}\n\n/**\n * 展开分组\n * @param key\n * @returns\n */\nexport function expand(key: string) {\n  return {\n    type: EXPAND_GROUP,\n    payload: { key } as SetGroupFoldPayload,\n  };\n}\n","import { GROUP_COLLAPSED_KEY } from '../../constants';\nimport Plugin from '../../interfaces/plugin';\nimport {\n  SetGroupFoldPayload,\n  TOGGLE_GROUP_FOLD,\n  FOLD_GROUP,\n  EXPAND_GROUP,\n} from './actions';\n\nconst onAction: Plugin['onAction'] = (action, controller, next) => {\n  const { type, payload } = action;\n  const { groupManager } = controller;\n  if (\n    type === TOGGLE_GROUP_FOLD ||\n    type === FOLD_GROUP ||\n    type === EXPAND_GROUP\n  ) {\n    const { key } = payload as SetGroupFoldPayload;\n    const group = groupManager.getGroup(key);\n    if (group) {\n      if (type === TOGGLE_GROUP_FOLD) {\n        groupManager.mergeGroupData(key, {\n          [GROUP_COLLAPSED_KEY]: !group.data[GROUP_COLLAPSED_KEY],\n        });\n        return controller;\n      } else {\n        groupManager.mergeGroupData(key, {\n          [GROUP_COLLAPSED_KEY]: type === FOLD_GROUP,\n        });\n        return controller;\n      }\n    }\n  }\n  return next();\n};\n\nexport default onAction;\n","import * as React from 'react';\nimport RenderNode from '../../interfaces/renderNode';\nimport ElementInGroup from './ElementInGroup';\n\nconst renderNode: RenderNode = (props, controller, next) => {\n  return next();\n}\n\nexport default renderNode;\n","import * as React from 'react';\nimport RenderGroup from '../../interfaces/renderGroup';\nimport ElementInGroup from './ElementInGroup';\n\nconst renderGroup: RenderGroup = (props, controller, next) => {\n  const group = next();\n  return group;\n};\n\nexport default renderGroup;\n","import Plugin from '../../interfaces/plugin';\n\nconst onResetValue: Plugin['onResetValue'] = (\n  _value,\n  _controllerValue,\n  controller,\n  next,\n) => {\n  controller.groupManager.generateAllGroups().notifyNewGroups();\n  return next();\n};\n\nexport default onResetValue;\n","import Plugin from \"../../interfaces/plugin\";\nimport onAction  from \"./onAction\";\nimport renderNode from './renderNode';\nimport renderGroup from './renderGroup';\nimport onResetValue from './onResetValue';\n\nconst createGroupPlugin: () => Plugin = () => ({\n  onAction,\n  renderNode,\n  renderGroup,\n  onResetValue,\n})\n\nexport default createGroupPlugin;\n","/**\n * @packageDocumentation\n * @ignore\n */\nexport enum Status {\n  Idle = 'Idle',\n  Pending = 'Pending',\n  Canceled = 'Canceled',\n  Done = 'Done',\n}\n\n/**\n * WARN: Sometimes request idle callback in Safari will never be called!\n */\nexport type FlushType = 'microtask' | 'frametask' | 'idletask';\n\n/**\n * 默认的 flush 类型\n */\nconst DEFAULT_FLUSH_TYPE: FlushType = 'microtask';\n\n/**\n * flush 最大等待时间（100ms 是为了保证常规情况下反馈不会过长，同时大文档在连续情况下每隔 100ms 做一次渲染也能保障流畅度）\n * @description 浏览器的调度有时候会将线程长时间闲置，导致 flush 延迟过高\n * @example 一个典型的例子是当滚动区域触发一个滑动后，光标的再次点击，使浏览器的线程调度闲置（具体原因还在研究中）\n */\nconst FLUSH_MAX_WAIT = 100;\n\nexport interface FlushTaskOptions {\n  flushType?: FlushType;\n}\n\n/**\n * 是否支持 idleCallback\n */\nconst IS_SUPPORT_IDLE_TASK = typeof window === 'object' &&\n  'requestIdleCallback' in window && 'cancelIdleCallback' in window;\n\n/**\n * 是否支持 animationFrame\n */\nconst IS_SUPPORT_FRAME_TASK = typeof window === 'object' &&\n  'requestAnimationFrame' in window && 'cancelAnimationFrame' in window;\n\n/**\n * 决议能够使用的 flushType\n * @param flushType 需要的 flushType\n */\nfunction resolveSupportedType(flushType: FlushType): FlushType {\n  if (flushType === 'microtask') {\n    return 'microtask';\n  }\n  if (flushType === 'idletask') {\n    if (IS_SUPPORT_IDLE_TASK) {\n      return 'idletask';\n    } else if (IS_SUPPORT_FRAME_TASK) {\n      return 'frametask';\n    }\n  }\n  if (flushType === 'frametask' && IS_SUPPORT_FRAME_TASK) {\n    return 'frametask';\n  }\n  return 'microtask';\n}\n\nclass FlushTask {\n  static create(task: Function, options?: FlushTaskOptions) {\n    return new FlushTask(task, options);\n  }\n\n  /**\n   * 等待执行的微任务\n   */\n  private task: Function;\n\n  /**\n   * 当前任务的状态\n   */\n  private status = Status.Idle;\n\n  /**\n   * 是否已经 resolved，保障一个任务只执行一次函数\n   */\n  private resolved = false;\n\n  /**\n   * 原始的 flushType\n   */\n  private flushType: FlushType;\n\n  /**\n   * 当前支持的 flushType\n   */\n  private supportedFlushType: FlushType;\n\n  private taskId = -1;\n\n  private constructor(task: Function, options: FlushTaskOptions = {}) {\n    this.task = task;\n    const {\n      flushType = DEFAULT_FLUSH_TYPE,\n    } = options;\n    this.flushType = flushType;\n    this.supportedFlushType = resolveSupportedType(flushType);\n  }\n\n  start(): FlushTask {\n    this.status = Status.Pending;\n    if (!this.resolved) {\n      this.requestTask();\n      this.resolved = true;\n    }\n    return this;\n  }\n\n  cancel(): FlushTask {\n    this.status = Status.Canceled;\n    this.cancelTask();\n    return this;\n  }\n\n  getStatus(): Status {\n    return this.status;\n  }\n\n  private requestTask() {\n    if (this.supportedFlushType === 'idletask') {\n      this.taskId = window.requestIdleCallback(() => this.run(), { timeout: FLUSH_MAX_WAIT });\n    } else if (this.supportedFlushType === 'frametask') {\n      this.taskId = window.requestAnimationFrame(() => this.run());\n    } else {\n      Promise.resolve().then(() => this.run());\n    }\n  }\n\n  private cancelTask() {\n    if (this.supportedFlushType === 'idletask') {\n      window.cancelIdleCallback(this.taskId);\n    } else if (this.supportedFlushType === 'frametask') {\n      window.cancelAnimationFrame(this.taskId);\n    }\n  }\n\n  private run() {\n    if (this.status === Status.Pending && typeof this.task === 'function') {\n      this.task.call(null);\n      this.status = Status.Done;\n    }\n  }\n}\n\nexport default FlushTask;\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport Node from '../models/node';\nimport Document from '../models/document';\nimport Element from '../models/element';\nimport Decoration from '../models/decoration';\nimport Selection from '../models/selection';\nimport Point, { EdgePoint } from '../models/point';\nimport Path from '../models/path';\n\ninterface OrderedItem {\n  order: number;\n}\n\ninterface RangeStart<T> extends OrderedItem {\n  start: true;\n  range: T;\n}\n\ninterface RangeEnd<T> extends OrderedItem {\n  end: true;\n  range: T;\n}\n\ninterface Child extends OrderedItem {\n  child: Node;\n}\n\ntype OrderItem<T> = Child | RangeStart<T> | RangeEnd<T>;\n\nfunction isChild<T>(item: OrderItem<T>): item is Child {\n  return 'child' in item;\n}\n\nfunction isRangeStart<T>(item: OrderItem<T>): item is RangeStart<T> {\n  return 'start' in item;\n}\n\nfunction isRangeEnd<T>(item: OrderItem<T>): item is RangeEnd<T> {\n  return 'end' in item;\n}\n\nfunction isEdgeAfter(edgePoint: Point, edgePath: Path, nodePath: Path) {\n  return edgePoint.isEdgePoint() &&\n    edgePoint.edge === EdgePoint.AFTER &&\n    (Path.isEqual(edgePath, nodePath) || Path.isAncestor(edgePath, nodePath));\n}\n\nfunction isEdgeBefore(edgePoint: Point, edgePath: Path, nodePath: Path) {\n  return edgePoint.isEdgePoint() &&\n    edgePoint.edge === EdgePoint.BEFORE &&\n    (Path.isEqual(edgePath, nodePath) || Path.isAncestor(edgePath, nodePath));\n}\n\nfunction sort<T>(a: OrderItem<T>, b: OrderItem<T>) {\n  if (a.order > b.order) {\n    return 1;\n  } else if (a.order === b.order) {\n    return isRangeEnd(b) ? 1 : -1;\n  }\n  return -1;\n}\n\nexport function getChildrenDecorations(\n  document: Document,\n  node: Element,\n  decorations: Decoration[],\n) {\n  const childrenDecorations: Decoration[][] = [];\n\n  // 初始化排序数组，先放入节点子孙\n  const orderArray: OrderItem<Decoration>[] = node.nodes.map((child, index) => ({\n    child,\n    order: index,\n  }));\n\n  const nodePath = document.assertPath(node.key);\n  const depth = nodePath.length;\n  const last = node.nodes.length - 1;\n  // 遍历 decorations，将其放入排序数组\n  decorations.forEach((decoration) => {\n    const { start: startPoint, end: endPoint } = decoration;\n    const startPath = document.getPath(startPoint.key);\n    const endPath = document.getPath(endPoint.key);\n\n    if (!startPath || !endPath) {\n      return;\n    }\n    if (Path.isAfter(startPath, nodePath) || Path.isBefore(endPath, nodePath)) {\n      return;\n    }\n\n    // 获得 decoration 相对于 node children 的起始位置\n    const start = Path.isBefore(startPath, nodePath) ? 0 : startPath[depth];\n    const end = Path.isAfter(endPath, nodePath) ? last : endPath[depth];\n\n    orderArray.push({\n      start: true,\n      range: decoration,\n      order: start - 0.5,\n    });\n\n    orderArray.push({\n      end: true,\n      range: decoration,\n      order: end + 0.5,\n    });\n  });\n\n  const activeDecorations = new Set<Decoration>();\n  orderArray.sort(sort).forEach(item => {\n    if (isRangeStart(item)) {\n      activeDecorations.add(item.range);\n    } else if (isRangeEnd(item)) {\n      activeDecorations.delete(item.range);\n    } else if (isChild(item)) {\n      childrenDecorations.push(Array.from(activeDecorations));\n    }\n  });\n  return childrenDecorations;\n}\n\nexport function getChildrenIsSelected(\n  document: Document,\n  node: Element,\n  selection: Selection,\n) {\n  const childrenIsSelected: boolean[] = node.nodes.map(() => false);\n  if (selection.isCollapsedAtEdge) {\n    return childrenIsSelected;\n  }\n\n  const { start: startPoint, end: endPoint } = selection.sort(document);\n  const startPath = document.getPath(startPoint.key);\n  const endPath = document.getPath(endPoint.key);\n  if (!startPath || !endPath) {\n    return childrenIsSelected;\n  }\n\n  const nodePath = document.assertPath(node.key);\n  if (\n    Path.isAfter(startPath, nodePath)\n      || isEdgeAfter(startPoint, startPath, nodePath)\n  ) {\n    return childrenIsSelected;\n  }\n  if (\n    Path.isBefore(endPath, nodePath)\n      || isEdgeBefore(endPoint, endPath, nodePath)\n  ) {\n    return childrenIsSelected;\n  }\n\n  const depth = nodePath.length;\n  const last = node.nodes.length - 1;\n  const start = Path.isBefore(startPath, nodePath) || isEdgeBefore(startPoint, startPath, nodePath)\n    ? 0\n    : startPath[depth];\n  const end = Path.isAfter(endPath, nodePath) || isEdgeAfter(endPoint, endPath, nodePath)\n    ? last\n    : endPath[depth];\n\n  for (let i = start; i <= end; i += 1) {\n    childrenIsSelected[i] = true;\n  }\n  return childrenIsSelected;\n}\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport Element from '../models/element';\nimport Document from '../models/document';\nimport Injection from '../models/injection';\n\nexport default function getChildrenInjections(\n  document: Document,\n  node: Element,\n  injections: Injection[],\n) {\n  const nodePath = document.assertPath(node.key);\n  const depth = nodePath.length;\n\n  const childInjections: Injection[][] = node.nodes.map(() => []);\n\n  injections.forEach((injection) => {\n    const path = document.getPath(injection.key);\n    if (path) {\n      const index = path[depth];\n      const injects = childInjections[path[depth]];\n      if (index >= 0 && injects) {\n        injects.push(injection);\n      }\n    }\n  });\n\n  return childInjections;\n}\n","export const CONTEXT_SPLIT = '@';\n\nexport function getContexts(context?: string) {\n  return context ? context.split(CONTEXT_SPLIT) : [];\n}\n\nexport function getContextMeta<T>(context?: string) {\n  if (typeof context !== 'string') {\n    return null;\n  }\n\n  const matched = context.match(/\\((.*?)\\)$/);\n\n  if (matched) {\n    try {\n      return JSON.parse(matched[1]) as T;\n    } catch {\n      return null;\n    }\n  }\n\n  return null;\n}\n","export interface Subscription {\n  unsubscribe: () => void;\n}\n\nexport type Observer<T> = (data: T) => void;\n\ninterface Link<T> {\n  next: Link<T> | null;\n  prev: Link<T> | null;\n  element: T;\n}\n\nexport class Observable<T> {\n  private linkHead: Link<Observer<T>> | null = null;\n\n  public subscribe(observer: Observer<T>): Subscription {\n    const link: Link<Observer<T>> = {\n      next: this.linkHead,\n      prev: null,\n      element: observer,\n    };\n    if (this.linkHead) {\n      this.linkHead.prev = link;\n    }\n    this.linkHead = link;\n    return {\n      unsubscribe: () => {\n        if (link.next) {\n          link.next.prev = link.prev\n        }\n        if (link.prev) {\n          link.prev.next = link.next\n        } else {\n          this.linkHead = link.next\n        }\n      }\n    }\n  }\n\n  protected onData(data: T) {\n    let link = this.linkHead;\n    while (link) {\n      link.element(data);\n      link = link.next;\n    }\n  }\n}\n\nexport class Subject<T> extends Observable<T> {\n  constructor() {\n    super();\n  }\n\n  next(data: T) {\n    this.onData(data);\n  }\n}\n\n\nexport class ReplaySubject<T> extends Observable<T> {\n  private replays: T[] = []; \n  private readonly max: number; \n\n  constructor(max = 1) {\n    super();\n    this.max = max;\n  }\n\n  public subscribe(observer: Observer<T>): Subscription {\n    const sub = super.subscribe(observer);\n    this.replays.forEach(data => {\n      observer(data);\n    });\n    return sub;\n  }\n\n  next(data: T) {\n    this.onData(data);\n    if (this.replays.length === this.max) {\n      this.replays.shift();\n    }\n    this.replays.push(data);\n  }\n}\n","import Controller from '../../controller';\nimport { PendingType } from '../../interfaces/controller';\nimport { PendingPattern, PendingPredicate, PendingGetter } from '../../interfaces/pending';\nimport { OperationType } from '../../models/operation';\n\nconst isSetSelection = ({ operation }) => (\n  operation && operation.type === OperationType.SetSelection\n);\n\nexport function getSelectionData(controller: Controller) {\n  const { document, selection } = controller.value;\n\n  const blocks = (\n    selection.isCollapsedAtEdge\n      ? [document.getNode(selection.anchor.key)!]\n      : document.getLeafBlocksAtRange(selection)\n  );\n  const isHideSelection = controller.query(\n    'isHideSelection',\n  )!;\n  return { range: selection, blocksKeys: new Set(blocks.map((b) => b.key)), isHideSelection };\n}\n\nexport const isSelect: PendingPredicate = (params) => {\n  const { ops, controller } = params;\n\n  if (ops.length === 0) {\n    return false;\n  }\n\n  // 从 blur 状态开始选区（点选/拖选），会有个先 focus 再 set_selction 的过程，可以 pending\n  return ops.every((op, index) => {\n    if (index === 0) {\n      return (op.key === 'isFocused' && controller.value.isFocused) || isSetSelection(op);\n    }\n    return isSetSelection(op);\n  });\n};\n\nexport const getPending: PendingGetter<null> = ({ controller }) => ({\n  type: PendingType.selection,\n  effect: () => {\n    controller.selectionData$.next(getSelectionData(controller));\n  },\n});\n\nconst pattern: PendingPattern<null> = [\n  isSelect,\n  getPending,\n];\n\nexport default pattern;\n","import { last } from 'lodash-es';\nimport { OperationWithValue, PendingType } from '../../interfaces/controller';\nimport {\n  ShouldAppend,\n  PendingPattern,\n  PendingPredicate,\n  PendingGetter,\n} from '../../interfaces/pending';\nimport Operation, {\n  InsertTextOperation,\n  OperationType,\n  RemoveTextOperation,\n  SetSelectionOperation,\n} from '../../models/operation';\nimport { TextPoint } from '../../models/point';\nimport Path from '../../models/path';\nimport Text from '../../models/text';\nimport { getSelectionData } from './selection';\n\nexport interface TextInputContext {\n  /** 输入作用的 text node key */\n  key: string;\n  /** 输入开始的 path */\n  startPath: Path;\n  /** 输入开始的偏移 */\n  startOffset: number;\n}\n\nfunction isInsertTextOperation(\n  op: Operation | null,\n): op is InsertTextOperation {\n  return op !== null && op.type === OperationType.InsertText;\n}\n\nfunction isRemoveTextOperation(\n  op: Operation | null,\n): op is RemoveTextOperation {\n  return op !== null && op.type === OperationType.RemoveText;\n}\n\nfunction isInsertOrRemove(operation: Operation) {\n  return (\n    (isInsertTextOperation(operation) || isRemoveTextOperation(operation)) &&\n    operation.text.length === 1\n  );\n}\n\nfunction isSetSelectionOperation(\n  op: Operation | null,\n): op is SetSelectionOperation {\n  return op !== null && op.type === OperationType.SetSelection;\n}\n\nfunction isContinuousOp(prevOp: Operation, operation: Operation) {\n  // @ts-ignore\n  if (!Path.isEqual(operation.path, prevOp.path)) {\n    return false;\n  }\n  if (isInsertTextOperation(prevOp) && isInsertTextOperation(operation)) {\n    return operation.offset === prevOp.offset + prevOp.text.length;\n  } else if (\n    isInsertTextOperation(prevOp) &&\n    isRemoveTextOperation(operation)\n  ) {\n    return (\n      operation.offset ===\n      prevOp.offset + prevOp.text.length - operation.text.length\n    );\n  } else if (\n    isRemoveTextOperation(prevOp) &&\n    isInsertTextOperation(operation)\n  ) {\n    return operation.offset === prevOp.offset;\n  } else if (\n    isRemoveTextOperation(prevOp) &&\n    isRemoveTextOperation(operation)\n  ) {\n    return operation.offset === prevOp.offset - operation.text.length;\n  }\n  return false;\n}\n\nfunction isContinuousInput(ops: OperationWithValue[]) {\n  const operations = ops.filter(\n    ({ operation }) => !operation || !isSetSelectionOperation(operation),\n  );\n  if (!operations.length) {\n    return false;\n  }\n  const operationsWithoutComposing = operations.filter(({ key }) => key !== 'composing');\n  return operationsWithoutComposing.every(({ operation }, index) => {\n    if (!isInsertOrRemove(operation!)) {\n      return false;\n    }\n    if (index === 0) {\n      return true;\n    }\n\n    const { operation: prevOp } = operationsWithoutComposing[index - 1];\n    return !prevOp || isContinuousOp(prevOp, operation!);\n  });\n}\n/**\n * 是否为连续输入\n * @param params\n * @returns\n */\nconst isTextInput: PendingPredicate = (params) => {\n  const { ops } = params;\n  return isContinuousInput(ops);\n};\n\nexport const shouldAppend: ShouldAppend = (prevOps, ops) => {\n  // 找到最后一个非 set_selection op，做连续性比较\n  const { operation: prevOp } = last(\n    prevOps.filter(({ key, operation }) => key !== 'composing' && !isSetSelectionOperation(operation)),\n  ) || {};\n  const { operation } = ops.find(\n    ({ key, operation }) => key !== 'composing' && !isSetSelectionOperation(operation),\n  ) || {};\n\n  return !prevOp || !operation || isContinuousOp(prevOp, operation);\n};\n\nconst getPending: PendingGetter<TextInputContext> = ({ controller }) => ({\n  type: PendingType.input,\n  decorate: (ops) => {\n    const { operation, value } = ops.find(\n      ({ operation }) => !isSetSelectionOperation(operation),\n    )!;\n    if (operation === null) {\n      // NOTE: operation is composing, need to get meta from controller.value\n      const { selection, document } = controller.value;\n      const { key, offset } = selection.focus as TextPoint;\n      return {\n        key,\n        startOffset: offset,\n        startPath: document.getPath(key)!,\n      };\n    }\n    const { path, offset } = operation as InsertTextOperation;\n    const text = value.document.getNodeByPath(path)! as Text;\n    return {\n      key: text.key,\n      startPath: path,\n      startOffset: offset,\n    };\n  },\n  effect: (ops, ctx) => {\n    ops.forEach(({ operation }) => {\n      // send input op\n      if (isSetSelectionOperation(operation)) {\n        return;\n      }\n      controller.inputData$.next({\n        key: ctx.key,\n        startPath: ctx.startPath,\n        startOffset: ctx.startOffset,\n      });\n    });\n    controller.selectionData$.next(getSelectionData(controller));\n  },\n  shouldAppend,\n});\n\nconst pattern: PendingPattern<TextInputContext> = [isTextInput, getPending];\n\nexport default pattern;\n","import { cond } from 'lodash-es';\nimport { stubTrue } from 'lodash-es';\nimport { GetPendingParams, Pending } from '../../interfaces/pending';\nimport textInputPattern from './textinput';\nimport selectionPattern from './selection';\n\nexport default cond<GetPendingParams, Pending<any> | null>([\n  textInputPattern,\n  selectionPattern,\n  [stubTrue, () => null],\n]);\n","import { debounce } from 'lodash-es';\nimport Controller from './index';\nimport { EnablePendingConfig, EnablePending, PendingType, OperationWithValue } from '../interfaces/controller';\nimport {\n  GetPendingParams,\n  Pending,\n  PendingGetter,\n} from '../interfaces/pending';\nimport Value from '../models/value';\nimport getPending from './pendings';\n\nexport interface PendingQueueProps {\n  controller: Controller;\n  debounceTime: number;\n  pendingGetter?: PendingGetter<any>;\n  enablePending: EnablePendingConfig;\n}\n\nexport default class PendingQueue {\n  public static create(props: PendingQueueProps) {\n    return new PendingQueue(props);\n  }\n\n  private operations: OperationWithValue[] = [];\n  private pending: Pending<any> | null = null;\n  private ctx: any;\n  private pendingGetter: PendingGetter<any>;\n  private debouncedFlush: ReturnType<typeof debounce>;\n  private controller: Controller;\n  public value: Value | null = null;\n  public enablePending: EnablePending;\n\n  constructor(props: PendingQueueProps) {\n    const {\n      debounceTime,\n      controller,\n      pendingGetter = getPending,\n      enablePending,\n    } = props;\n\n    this.pendingGetter = pendingGetter;\n    this.controller = controller;\n    this.debouncedFlush = debounce(this.flush, debounceTime);\n\n    if (typeof enablePending === 'boolean') {\n      this.enablePending = Object.values(PendingType).reduce((result, key) => {\n        result[key] = enablePending;\n        return result;\n      }, {});\n    } else {\n      this.enablePending = enablePending;\n    }\n  }\n\n  private get shouldDebouncedFlush() {\n    // 需要周期性倾倒 pending queue 需满足以下条件之一：\n    // 1. 如果驻留有 operation\n    // 2. 如果驻留有堆 isFocused 的设置\n    return this.operations.some(({ operation, key }) => (\n      operation !== null\n      || key === 'isFocused'\n    ));\n  }\n\n  private run(operations: OperationWithValue[]) {\n    const { effect } = this.pending!;\n    this.value = this.controller.value;\n    effect(operations, this.ctx);\n    if (this.shouldDebouncedFlush) {\n      this.debouncedFlush();\n    }\n  }\n\n  private flush = () => {\n    this.controller.flush();\n    this.clear();\n  };\n\n  private isType(type: string) {\n    return this.pending?.type === type;\n  }\n\n  public get type() {\n    return this.pending?.type;\n  }\n\n  public queue(operations: OperationWithValue[]) {\n    const params: GetPendingParams = {\n      controller: this.controller,\n      ops: operations,\n    };\n    const pending = this.pendingGetter(params);\n    if (!pending || !this.enablePending[pending.type]) {\n      // 若 operations 不可 pending，则立即倾倒\n      this.flush();\n      this.controller.dispatchPendingTerminal();\n    } else {\n      const { decorate = () => null, shouldAppend = () => true, type } = pending;\n      if (this.isType(type) && shouldAppend(this.operations, operations)) {\n        // 如果是同类型且可合并的 pending，则合并\n        Array.prototype.push.apply(this.operations, operations);\n        this.run(operations);\n      } else if (!this.pending) {\n        // 如果 pending queue 不存在 pending 对象，则创建\n        this.pending = pending;\n        this.ctx = decorate(operations);\n        this.operations = operations;\n        this.run(operations);\n      } else {\n        // 若产生了不能合并的 pending，则立即倾倒 pending queue\n        this.flush();\n        this.controller.dispatchPendingTerminal();\n      }\n    }\n    return this;\n  }\n\n  public clear() {\n    this.pending = null;\n    this.operations = [];\n    this.debouncedFlush.cancel();\n    return this;\n  }\n\n  public isEmpty() {\n    return this.size() === 0;\n  }\n\n  public size() {\n    return this.operations.length;\n  }\n}\n","import { Injection, Controller, Node } from '../';\nimport { isEmpty, omit } from 'lodash-es';\n\nexport function setInjection (controller: Controller, node: Node, data) {\n  const { injections } = controller.value;\n  const curInjection = injections.find(inj => inj.key === node.key) || {} as Injection;\n  const injection = Injection.create({\n    key: node.key,\n    data: {\n      ...(curInjection.data || {}),\n      ...data,\n    },\n  });\n\n  controller.setInjections([\n    ...injections.filter(inj => inj.key !== node.key),\n    injection,\n  ]);\n};\n\nexport function deleteInjection (controller: Controller, node: Node, keys: string[]) {\n  const { injections } = controller.value;\n  const curInjection = injections.find(inj => inj.key === node.key) || {} as Injection;\n  const nextData = omit(curInjection.data, keys)\n  const nextInjections = injections.filter(inj => inj.key !== node.key)\n  if (!isEmpty(nextData)) {\n    const injection = Injection.create({\n      key: node.key,\n      data: nextData,\n    });\n    nextInjections.push(injection);\n  }\n\n  controller.setInjections(nextInjections);\n};\n","import { isEqual, omit } from 'lodash-es';\nimport * as Commands from '../commands/index';\nimport Element from '../models/element';\nimport Node from '../models/node';\nimport Controller from './index';\nimport { Subject } from '../models/observable';\nimport Operation from '../models/operation';\nimport Document from '../models/document';\nimport { isEmptyObj, omitDeepBy } from '../utils/omitEmpty';\nimport { setInjection, deleteInjection } from '../utils/setInjection';\n\ntype uid = string\ntype uuid = string\nexport type UserData = Record<\n  uid, \n  Record<uuid, UserDataContent>\n>\n\nexport interface UserDataContent {}\n\nexport default class UserDataManager {\n  public update$ = new Subject<{ uuid: string }>();\n\n  private controller: Controller;\n\n  private localData: UserData = {};\n\n  constructor(controller: Controller) {\n    this.controller = controller;\n  }\n\n  public get <T extends keyof UserDataContent>(\n    node: Node | null,\n    key: T,\n  ): UserDataContent[T] | undefined {\n    if (Element.isElement(node)) {\n      const { uid } = this.controller;\n      const uuid: string | undefined = node.data?.uuid;\n      const nData = node.data[key];\n      if (uid && uuid) {\n        const { userData } = this.controller.value.document.data;\n        const uData = userData?.[uid]?.[uuid]?.[key];\n        const lData = this.localData?.[uid]?.[uuid]?.[key];\n        return lData ?? uData ?? nData;\n      }\n      return nData;\n    }\n    return undefined;\n  }\n\n  public set <T extends keyof UserDataContent>(\n    node: Node | null,\n    properties: Record<T, UserDataContent[T]>,\n  ) {\n    if (Element.isElement(node)) {\n      const { uid, value } = this.controller;\n      const { document } = value;\n      const { userData }= document.data;\n      const uuid: string | undefined = node.data?.uuid;\n      if (uid && uuid) {\n        // 有 uid 和 uuid，设置用户数据\n        const data = omitDeepBy({\n          ...document.data,\n          userData: this.mergeProperties(\n            userData,\n            uid,\n            uuid,\n            properties,\n          ),\n        }, isEmptyObj);\n        if (data.userData !== document.data.userData) {\n          return this.controller.withOpContext(`userdata/${uid}/${uuid}`, () => {\n            this.controller.command(Commands.setNodeByKey, document.key, { data });\n          });\n        }\n      } else {\n        // 设置 node.data 数据\n        const n = document.getNode(node?.key);\n        if (n && Element.isElement(n)) {\n          const data = {\n            ...n.data,\n            ...properties,\n          };\n          if (!isEqual(data, n.data)) {\n            return this.controller.withOpContext(`userdata`, () => {\n              this.controller.command(Commands.setNodeByKey, n.key, { data });\n            });\n          }\n        }\n      }\n    }\n    return this.controller;\n  }\n\n  public setLocal <T extends keyof UserDataContent>(\n    node: Node | null,\n    properties: Record<T, UserDataContent[T]>,\n  ) {\n    if (Element.isElement(node)) {\n      const { uid } = this.controller;\n      const uuid: string | undefined = node.data?.uuid;\n      if (uid && uuid) {\n        this.localData = this.mergeProperties(\n          this.localData,\n          uid,\n          uuid,\n          properties,\n        );\n        this.update$.next({ uuid });\n      } else {\n        setInjection(this.controller, node, properties);\n      }\n    }\n    return this.controller;\n  }\n\n  public delete <T extends keyof UserDataContent>(\n    node: Node | null,\n    keys: T[],\n  ) {\n    if (Element.isElement(node)) {\n      const uuid: string | undefined = node.data?.uuid;\n      const { uid, value } = this.controller;\n      const { document } = value;\n      const { userData }= document.data;\n      if (uid && uuid) {\n        const data = omitDeepBy({\n          ...document.data,\n          userData: this.deleteProperties(\n            userData,\n            uid,\n            uuid,\n            keys,\n          ),\n        }, isEmptyObj);\n        if (data.userData !== document.data.userData) {\n          return this.controller.withOpContext(`userdata/${uid}/${uuid}`, () => {\n            this.controller.command(Commands.setNodeByKey, document.key, { data });\n          });\n        }\n      } else {\n        // 删除 node.data 数据\n        const n = document.getNode(node?.key);\n        if (n && Element.isElement(n)) {\n          const data = omit(n.data, keys)\n          if (!isEqual(data, n.data)) {\n            return this.controller.withOpContext(`userdata`, () => {\n              this.controller.command(Commands.setNodeByKey, n.key, { data });\n            });\n          }\n        }\n      }\n    }\n    return this.controller;\n  }\n\n  public deleteLocal <T extends keyof UserDataContent>(\n    node: Node | null,\n    keys: T[],\n  ) {\n    if (Element.isElement(node)) {\n      const { uid } = this.controller;\n      const uuid: string | undefined = node.data?.uuid;\n      if (uid && uuid) {\n        this.localData = this.deleteProperties(\n          this.localData,\n          uid,\n          uuid,\n          keys,\n        )\n        this.update$.next({ uuid });\n      } else {\n        deleteInjection(this.controller, node, keys);\n      }\n    }\n    return this.controller;\n  }\n\n  public flush = (ops: Operation[]) => {\n    this.updateNodes(ops);\n    this.refreshData(ops);\n  }\n\n  public mergeUserData = (target: Document) => {\n    const { uid, value } = this.controller;\n    const { document } = value;\n    const { userData }= document.data;\n    const { userData: targetData } = target.data;\n    if (uid && targetData?.[uid]) {\n      const uuids = Object.keys(targetData[uid]);\n      if (uuids.length > 0) {\n        const data = omitDeepBy({\n          ...document.data,\n          userData: {\n            ...userData || {},\n            [uid]: {\n              ...userData?.[uid] || {},\n              ...targetData[uid],\n            }\n          }\n        }, isEmptyObj)\n        if (data.userData !== document.data.userData) {\n          return this.controller.withOpContext(`userdata/${uid}/${uuids.join(',')}`, () => {\n            this.controller.command(Commands.setNodeByKey, document.key, { data });\n          });\n        }\n      }\n    }\n    return this.controller;\n  }\n\n  private refreshData (ops: Operation[]) {\n    // 根据 OP 类型，刷新 document.data 上数据\n    const { value } = this.controller;\n    const { document } = value;\n    const { userData: originData }= document.data;\n    const uuids: string[] = [];\n    const uids = Object.keys(originData || {});\n    let userData = originData;\n\n    ops.forEach((op) => {\n      // op 是删除节点，将 document.data 中对应数据也删除\n      if (\n        op.type === 'remove_node' &&\n        Element.isElement(op.node) &&\n        !/merge_node|split_node/.test(op.context || '')\n      ) {\n        // 遍历节点及子节点\n        const iterator = (node) => {\n          const uuid = (node as any).data?.uuid;\n          if (Element.isElement(node) && uuid) {\n            uids.forEach((uid) => {\n              userData = this.deleteData(userData, uid, uuid);\n            })\n            if (userData !== originData) {\n              uuids.push(uuid);\n            }\n          }\n        }\n        iterator(op.node);\n        op.node.forEachDescendant(iterator);\n      }\n    });\n\n    // 批量更新\n    if (uuids.length) {\n      const data = omitDeepBy({ ...document.data, userData }, isEmptyObj);\n      this.controller.withOpContext(`userdata/*/${uuids.join(',')}`, () => {\n        this.controller.command(Commands.setNodeByKey, document.key, { data });\n      });\n    }\n  }\n\n  private updateNodes (ops: Operation[]) {\n    ops.forEach((op) => {\n      // update$.next 刷新节点视图\n      const { context } = op;\n      if (op.type === 'set_node') {\n        const matched = context?.match(/userdata\\/(.*)\\/(.*)/);\n        if (matched) {\n          // context 上携带此次修改用户数据的 uid 和块 uuid\n          const uid = matched[1];\n          const uuids = matched[2].split(',');\n          if (uid === this.controller.uid || uid === '*') {\n            uuids.forEach((uuid) => uuid && this.update$.next({ uuid }));\n          }\n        }\n      }\n    })\n  }\n\n  private mergeProperties (\n    data: UserData | undefined,\n    uid: string,\n    uuid: string,\n    properties: Record<string, any>,\n  ): UserData {\n    return {\n      ...data || {},\n      [uid]: {\n        ...data?.[uid] || {},\n        [uuid]: {\n          ...data?.[uid]?.[uuid] || {},\n          ...properties,\n        }\n      }\n    };\n  }\n\n  private deleteData (\n    data: UserData | undefined,\n    uid: string,\n    uuid: string,\n  ): UserData {\n    if (data?.[uid]?.[uuid] !== undefined) {\n      // 删除对应 uuid 下所有数据\n      return {\n        ...data,\n        [uid]: omit(data?.[uid], uuid)\n      }; \n    }\n    return data || {};\n  }\n\n  private deleteProperties (\n    data: UserData | undefined,\n    uid: string,\n    uuid: string,\n    keys: string[],\n  ): UserData {\n    if (typeof data?.[uid]?.[uuid] === 'object') {\n      // 对应 block uuid 下有数据，去除相应 keys 属性\n      return {\n        ...data,\n        [uid]: {\n          ...data?.[uid],\n          [uuid]: omit(data?.[uid]?.[uuid], keys),\n        },\n      }; \n    }\n    return data || {};\n  }\n}\n","export enum PerfType {\n  input = 'input',\n  composing = 'composing',\n  selection = 'selection'\n}\n","/**\n * @packageDocumentation\n * @module Events\n */\ninterface CangjiePerfDetail {\n  /** 性能统计类型 */\n  type: string;\n  /** 耗时 */\n  duration: number;\n  /** 是否掉帧 */\n  dropped?: boolean;\n}\n\ninterface CangjiePerfEvent extends CustomEvent<CangjiePerfDetail> {}\n\nfunction CangjiePerfEvent(detail: CangjiePerfDetail) {\n  return new CustomEvent('cangjiePerf', {\n    detail: {\n      dropped: false,\n      ...detail,\n    },\n  });\n}\n\nexport default CangjiePerfEvent;\n","import { cond } from 'lodash-es';\nimport { stubTrue } from 'lodash-es';\nimport { difference } from 'lodash-es';\nimport { OperationWithValue, PendingType } from '../interfaces/controller';\nimport Operation, {\n  OperationType,\n  InsertTextOperation,\n  SetNodeOperation,\n  InsertNodeOperation,\n  MoveNodeOperation,\n  NonSetSelectionOperation,\n} from '../models/operation';\nimport Path from '../models/path';\nimport Document from '../models/document';\nimport Block from '../models/block';\nimport Node from '../models/node';\nimport Element from '../models/element';\nimport Selection from '../models/selection';\nimport Value from '../models/value';\nimport Controller from '../controller';\nimport { Hot } from '../interfaces/hot';\n\nfunction isTextOp(operation: Operation): operation is InsertTextOperation {\n  return [\n    OperationType.InsertText,\n    OperationType.RemoveText,\n    OperationType.AddMark,\n    OperationType.RemoveMark,\n    OperationType.SetMark,\n  ].includes(operation.type as OperationType);\n}\n\nfunction getHotAmongNodes(\n  srcNodes: (Node | null | string)[],\n  newDoc: Document,\n): Hot[] {\n  return srcNodes\n    .map((srcNode) => {\n      if (!srcNode) {\n        return null;\n      }\n      // 如果操作节点在新的内容无法找到，则不继续查找其热区\n      const node = newDoc.getNode(\n        typeof srcNode === 'string' ? srcNode : srcNode.key,\n      );\n      if (!node) {\n        return null;\n      }\n      return Block.isBlock(node)\n        ? node\n        : newDoc.getClosest(node.key, (node) => Block.isBlock(node));\n    })\n    .filter((node) => !!node)\n    .map((node) => ({\n      node: node as Block,\n      path: newDoc.assertPath(node!.key),\n    }));\n}\n\nfunction getHotsAtRange(\n  range: Selection,\n  afterChangeDoc: Document,\n  ancestorPath: Path = [],\n): Hot[] {\n  let blocks: Block[] = [];\n  if (Path.isRoot(ancestorPath)) {\n    blocks = afterChangeDoc.getRootBlocksAtRange(range);\n  } else {\n    const ancestor = afterChangeDoc.assertNodeByPath(ancestorPath) as Element;\n    const { start, end } = range.convertToTextPoints(afterChangeDoc);\n\n    const startBlock = ancestor.getFurthsest(\n      start.key,\n      Block.isBlock,\n    ) as Block | null;\n    if (!startBlock) {\n      return [];\n    }\n    if (start.key === end.key) {\n      return [\n        {\n          node: startBlock,\n          path: afterChangeDoc.assertPath(startBlock.key),\n        },\n      ];\n    }\n\n    const endBlock = ancestor.getFurthsest(end.key, Block.isBlock);\n    if (!endBlock) {\n      return [];\n    }\n    blocks = ancestor.nodes.slice(\n      ancestor.nodes.indexOf(startBlock),\n      ancestor.nodes.indexOf(endBlock) + 1,\n    ) as Block[];\n  }\n\n  return blocks.map((node) => {\n    return {\n      node,\n      path: afterChangeDoc.assertPath(node.key),\n    };\n  });\n}\n\nfunction getOpHots(\n  op: OperationWithValue,\n  controller: Controller,\n): Hot[] | 'ignore' {\n  const { operation, key, value, newValue } = op;\n  const { document: beforeChangeDoc } = value;\n  const { document: afterChangeDoc } = newValue;\n  const { document: newDoc } = controller.value;\n\n  /* 增量变更热区 */\n  if (operation) {\n    // 文本类型的操作，热区为当前文本所在容器\n    if (isTextOp(operation)) {\n      const { path } = operation;\n      const text = beforeChangeDoc.assertNodeByPath(path);\n      const newText = newDoc.getNode(text.key);\n      return getHotAmongNodes([newText], newDoc);\n    }\n    // 节点子孙的变更：插入/删除/分裂/合并，热区为变更所在的节点\n    else if (\n      operation.type === OperationType.InsertNode ||\n      operation.type === OperationType.RemoveNode ||\n      operation.type === OperationType.SplitNode ||\n      operation.type === OperationType.MergeNode\n    ) {\n      const { path } = operation as InsertNodeOperation;\n      const parent = beforeChangeDoc.assertNodeByPath(Path.parent(path));\n      return getHotAmongNodes([parent], newDoc);\n    }\n    // 设置节点\n    // 1. 若改变节点内容\n    //   a. 若变更不影响分组，则热区为被设置的节点\n    //   b. 若变更影响分组，则热区设置为上游节点\n    // 2. 若改变节点类型，可能影响上游分组，热区为设置节点的 parent\n    else if (operation.type === OperationType.SetNode) {\n      const {\n        path,\n        properties,\n        prevProperties,\n      } = operation as SetNodeOperation;\n      if (\n        properties.type !== prevProperties.type\n      ) {\n        return getHotAmongNodes(\n          [beforeChangeDoc.assertNodeByPath(Path.parent(path))],\n          newDoc,\n        );\n      }\n      return getHotAmongNodes([beforeChangeDoc.assertNodeByPath(path)], newDoc);\n    }\n    // 移动节点，热区为：\n    // 1. 起始节点的 parent\n    // 2. 结束节点的 parent\n    else if (operation.type === OperationType.MoveNode) {\n      const { path, newPath } = operation as MoveNodeOperation;\n      return getHotAmongNodes(\n        [\n          beforeChangeDoc.assertNodeByPath(Path.parent(path)),\n          beforeChangeDoc.assertNodeByPath(Path.parent(newPath)),\n        ],\n        newDoc,\n      );\n    }\n    // 设置选区，热区为跨越选区的所有最高层 block\n    else if (operation.type === OperationType.SetSelection) {\n      const { selection, prevSelection } = operation;\n      return getHotsAtRange(prevSelection, afterChangeDoc).concat(\n        getHotsAtRange(selection, afterChangeDoc),\n      );\n    }\n  } else {\n    /* 全量变更热区 */\n\n    // 输入法的热区为输入法所在文本的容器\n    if (key === 'composing') {\n      return getHotAmongNodes([value.startText], newDoc);\n    }\n\n    // focus 状态不影响热区\n    if (key === 'isFocused') {\n      return 'ignore';\n    }\n\n    // injections 变更，找到变更前后的受影响的节点所在的热区\n    if (key === 'injections') {\n      return getHotAmongNodes(\n        [\n          ...difference(newValue.injections, value.injections),\n          ...difference(value.injections, newValue.injections),\n        ].map((inj) => inj.key),\n        newDoc,\n      );\n    }\n\n    // decorations 变更，找到变更前后受影响的区间所在的热区\n    if (key === 'decorations') {\n      return [\n        ...difference(newValue.decorations, value.decorations),\n        ...difference(value.decorations, newValue.decorations),\n      ]\n        .map((decoration) =>\n          Selection.create({\n            anchor: decoration.start,\n            focus: decoration.end,\n          }),\n        )\n        .reduce<Hot[]>((hots, range) => {\n          hots.push(...getHotsAtRange(range, afterChangeDoc));\n          return hots;\n        }, []);\n    }\n  }\n\n  return [];\n}\n\n/**\n * 如果在 hots 找到祖先或者自己，则不再添加\n * @param path\n * @returns\n */\nfunction isExistedHot(path: Path, searchTable: Set<string>) {\n  const ancestorsAndSelf = Path.ancestors(path).slice(1);\n  ancestorsAndSelf.push(path);\n  return ancestorsAndSelf.some((p) => searchTable.has(p.join(',')));\n}\n\n/**\n * 获得变更热区\n * @param srcOps\n * @param controller\n * @returns\n */\nexport function getHots(\n  srcOps: OperationWithValue[],\n  controller: Controller,\n): Hot[] {\n  try {\n    const ops = srcOps.filter(\n      ({ operation }) => !operation || operation.type !== 'set_selection',\n    );\n\n    // 所有热区\n    const all: Hot[] = [];\n    // 去重热区，仅保留最高级祖先\n    const uniq: Hot[] = [];\n    /**\n     * 用于 hots 去重的查找表\n     * ```\n     * {\n     *   '0,1,0': true,\n     *   '1,0': true,\n     * }\n     * ```\n     */\n    const searchTable = new Set<string>();\n\n    for (let i = 0; i < ops.length; i++) {\n      const op = ops[i];\n      const hots = getOpHots(op, controller);\n      if (hots === 'ignore') {\n        continue;\n      }\n      // 如果任意 op 未找到热区，即变更影响了全局，提前返回\n      if (!hots.length) {\n        return [];\n      }\n\n      all.push(...hots);\n    }\n\n    const {\n      selection: prevSelection,\n      document: prevDocument,\n    } = srcOps[0].value;\n    const { selection, document } = controller.value;\n\n    // 选区发生变更时，计算热区\n    if (prevSelection !== selection) {\n      // 获得变更前选区所在的节点\n      const prevSelectionIn = prevSelection.getClosestNode(prevDocument)!;\n      const prevSelectionInPath = prevDocument.assertPath(prevSelectionIn.key);\n      const selectionIn = selection.getClosestNode(document)!;\n      const selectionInPath = document.assertPath(selectionIn.key);\n\n      const ancestor = Path.common(prevSelectionInPath, selectionInPath);\n      // 如果在同节点移动，热区仅放入新选区所在的节点\n      if (Path.isEqual(prevSelectionInPath, selectionInPath)) {\n        all.push({\n          node: selectionIn,\n          path: selectionInPath,\n        });\n      }\n      // 如果是平层移动，放入老/新选区所在的节点\n      else if (Path.isSibling(prevSelectionInPath, selectionInPath)) {\n        all.push({\n          node: prevSelectionIn,\n          path: prevSelectionInPath,\n        });\n        all.push({\n          node: selectionIn,\n          path: selectionInPath,\n        });\n      }\n      // 否则放入新老选区各自所在的，直到公共祖先的节点，保证节点子树每个节点的选中态都符合预期\n      else {\n        all.push(...getHotsAtRange(prevSelection, document, ancestor));\n        all.push(...getHotsAtRange(selection, document, ancestor));\n      }\n    }\n\n    all.sort((a, b) => a.path.length - b.path.length);\n    all.forEach((hot) => {\n      if (!isExistedHot(hot.path, searchTable)) {\n        uniq.push(hot);\n        searchTable.add(hot.path.join(','));\n      }\n    });\n\n    return uniq;\n  } catch (_e) {\n    // 热区计算失败时，清空热区\n    return [];\n  }\n}\n\ninterface FlushContext {\n  operations: OperationWithValue[];\n  value: Value;\n}\n\nconst FIELD_SHOULD_NOT_BREAK_PENDING = [\n  'decorations',\n  'injections',\n  'remoteSelections',\n  'selection'\n];\n\n/**\n * 是否是文本输入\n * @param context\n * @returns\n */\nexport function isInputing(context: FlushContext) {\n  const { operations, value } = context;\n  if (value.selection.isExpanded) {\n    return false;\n  }\n  const rest = operations.filter(operation => {\n    return operation.operation || !FIELD_SHOULD_NOT_BREAK_PENDING.includes(operation.key as string) \n  });\n\n  if (!rest.length) {\n    return false;\n  }\n\n  // PERF: for-loop\n  const opsLen = rest.length;\n  let path: Path | null = null;\n  for (let i = 0; i < opsLen; i++) {\n    const { operation } = rest[i];\n    if (!operation) {\n      return false;\n    }\n    if (operation.type === 'set_selection') {\n      continue;\n    }\n    const op = operation as NonSetSelectionOperation;\n    if (!path) {\n      path = op.path;\n    }\n    // 在同一个文本连续输入/删除时，可以 pending\n    if (\n      (op.type !== 'insert_text' && op.type !== 'remove_text') ||\n      !Path.isEqual(path, op.path)\n    ) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * 是否是设置选区\n * @param context\n * @returns\n */\nexport function isSelecting(context: FlushContext) {\n  return context.operations.every(({ operation, key }, index) => {\n    if (index === 0 && !operation) {\n      return key === 'isFocused' && context.value.isFocused;\n    }\n\n    return operation && operation.type === 'set_selection';\n  });\n}\n\n/**\n * 是否在输入法\n * @param context\n * @returns\n */\nexport function isComposing(context: FlushContext) {\n  const { composing } = context.value;\n  return !!composing.length;\n}\n\n/**\n * 对于需要以动画速率运行的变更，周期性倾倒：\n * 1. 输入/删除文本\n * 2. 拖动选区\n *\n * ```plaintext\n *    +-------+       +-------+      +-------+     +-------+     +-------+\n *    |   h   |       |   e   |      |   l   |     |   l   |     |   o   |\n *    +-------+       +-------+      +-------+     +-------+     +-------+\n *        |               |              |             |             |\n *        v               v              v             v             v\n *    .-------.       .-------.      .-------.     .-------.     .-------.\n *   (  flush  )     (  flush  )    (  flush  )   (  flush  )   (  flush  )\n *    `-------'       `-------'      `-------'     `-------'     `-------'\n *\n *                                        |\n *                                        |\n *                                 debounced flush\n *                                        |\n *                                        v\n * + - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +\n *    +-------+       +-------+      +-------+     +-------+     +-------+\n * |  |   h   |       |   e   |      |   l   |     |   l   |     |   o   | |\n *    +-------+       +-------+      +-------+     +-------+     +-------+\n * + - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +\n *                                                                   |\n *                                                                   v\n *                                                               .-------.\n *                                                              (  flush  )\n *                                                               `-------'\n * ```\n * @param context\n * @returns\n */\nexport const shouldDebounceFlush = cond<FlushContext, PendingType | null>([\n  [isSelecting, () => PendingType.selection],\n  [isInputing, () => PendingType.input],\n  [stubTrue, () => null],\n]);\n\n/**\n * 对于输入法等类型的临时变更，不进行 flush\n *\n * ```plaintext\n *  +-------+      +-------+     +-------+\n *  |   n   |      |   i   |     |   你   |\n *  +-------+      +-------+     +-------+\n *      |              |             |\n *      v              v             v\n *  .-------.      .-------.     .-------.\n * (  flush  )    (  flush  )   (  flush  )\n *  `-------'      `-------'     `-------'\n *\n *                      |\n *                      |\n *               suppress flush\n *                      |\n *                      v\n *                  +-------+\n *                  |   你   |\n *                  +-------+\n *                      |\n *                      v\n *                  .-------.\n *                 (  flush  )\n *                  `-------'\n * ```\n * @param context\n * @returns\n */\nexport const shouldSuppressFlush = cond<FlushContext, PendingType | null>([\n  [isComposing, () => PendingType.input],\n  [stubTrue, () => null],\n]);\n","import { EVENTS } from '../../constants'\n\nconst EVENTS_SET = new Set(EVENTS);\nexport default function isEventHandler(name: string) {\n  return EVENTS_SET.has(name);\n}","export const DEFAULT_BUFFER_RANGE = 500;\nexport const BLOCK_DEFAULT_MIN_HEIGHT = 25;\nexport const DEFAULT_SCROLL_THROTTLE_INTERVAL = 50;\nexport const DEFAULT_FIRST_PAINT_BLOCK_SIZE = 10;","export type QueryFunc = () => Element | null;\n\n/**\n * 循环查询元素\n * @param selector query 函数\n * @param remain 剩余时间\n */\n export function waitForElementByAnimationFrame(\n    selector: QueryFunc | string,\n    remain = 1000,\n  ) { \n    const start = Date.now();\n    return new Promise<Element>((resolve, reject) => {\n      if (remain < 0) {\n        if (typeof selector === 'function') {\n          return reject(`waitForElementByAnimationFrame: element wait timeout`);\n        }\n        return reject(`waitForElementByAnimationFrame： ${selector} wait timeout`);\n      }\n      const element = typeof selector === 'function' ? selector() : window.document.querySelector(selector);\n      if (element) {\n        return resolve(element);\n      } else {\n        window.requestAnimationFrame(() => {\n          const cost = Date.now() - start;\n          const nextRemain = remain - cost;\n          waitForElementByAnimationFrame(selector, nextRemain)\n            .then(resolve)\n            .catch(reject);\n        });\n      }\n    });\n  }\n\n  export function scrollContainerIsTop(scrollContainer: HTMLElement | Window | Document) {\n    return scrollContainer === document.body || scrollContainer === document.documentElement || scrollContainer === window\n  }\n\n  export function checkArrayAHasElementNotIncludedInArrayB(arrayA: string[], arrayB: string[]) {\n    return arrayA.some((arrayAElement) => {\n      return !arrayB.includes(arrayAElement);\n    });\n  }","import { BLOCK_DEFAULT_MIN_HEIGHT } from \"./constants\";\nimport NodeManager from \"./nodeManager\";\nimport Document from '../models/document';\nimport { LayoutInfoResult } from \"./interface\";\nimport { scrollContainerIsTop } from \"./virtualizeUtils\";\n\nfunction formatMarginFromStyle(margin: string) {\n  const result = parseFloat(margin);\n  if (isNaN(result)) {\n    return 0;\n  }\n  return result;\n}\n\nexport function measureBlockInfo(element: HTMLElement) {\n  // offsetHeight 一定是正数, boundingClientRect 可能是小数，和 mutationObserver 的对应\n  const boundingClientRect = element.getBoundingClientRect();\n  const computedStyle = window.getComputedStyle(element);\n  // TODO: 专门为节点搞一个隐藏态，隐藏前的高度也记录，而非直接变 0\n  const isVisible = computedStyle.display !== 'none';\n\n  return {\n    height: isVisible ? boundingClientRect.height : 0,\n    marginTop: isVisible ? formatMarginFromStyle(computedStyle?.marginTop) : 0,\n    marginBottom: isVisible ? formatMarginFromStyle(computedStyle?.marginBottom) : 0,\n  }\n}\n\ninterface DiffResult {\n  type: 'equal' | 'changed' | 'translation';\n  offset?: number;\n}\n\nexport function calculateViewPort(\n  scrollElement: HTMLElement,\n  scrollContainer: HTMLElement,\n  bufferRange: number,\n  editorContainerToScrollContainerDistance: number,\n  _viewPortStartY?: number,\n) {\n  let { scrollTop } = scrollElement;\n  if (scrollContainer === document.documentElement && scrollTop === 0 && document.body.scrollTop > 0) {\n    scrollTop = document.body.scrollTop;\n  }\n  const viewPortStartY = typeof _viewPortStartY === 'number' ? _viewPortStartY : scrollTop - editorContainerToScrollContainerDistance;\n  const viewPortEndY = viewPortStartY + (scrollContainerIsTop(scrollContainer) ? window.innerHeight : scrollContainer.offsetHeight);\n  const bufferStartY = Math.max(0, viewPortStartY - bufferRange);\n  const bufferEndY = viewPortEndY + bufferRange;\n\n  return {\n    viewPortStartY,\n    viewPortEndY,\n    bufferStartY,\n    bufferEndY,\n  };\n}\n\n/**\n * 计算编辑器容器到最近的滚动容器的距离\n * 编辑器容器是各种计算的原点，而视口是基于滚动容器\n * 在滚动容器高度发生变化时需要重算，典型场景是 插入封面\n * 检测这个变化非常难，目前想到两种方案，一是开发者手动触发，二是 scrollContainer 下包一层大容器，监听这个容器高度的变化\n */\nexport function calculateEditorContainerToScrollContainerDistance(\n  editorContainer: HTMLElement,\n  scrollContainer: HTMLElement,\n  scrollElement: HTMLElement,\n  scrollContainerIsBody: boolean,\n) {\n  const editorContainerRect = editorContainer.getBoundingClientRect();\n  const scrollContainerRect = scrollElement.getBoundingClientRect();\n  const editorContainerStyle = window.getComputedStyle(editorContainer);\n  const editorContainerToScrollContainerDistance = scrollContainerIsBody ?\n    editorContainerRect.top - scrollContainerRect.top :\n    editorContainerRect.top - scrollContainerRect.top + scrollElement.scrollTop;\n  return editorContainerToScrollContainerDistance + formatMarginFromStyle(editorContainerStyle.paddingTop) + formatMarginFromStyle(editorContainerStyle.borderTopWidth);\n}\n\nexport function calculateExpectedLayoutInfo(\n  bufferStartY: number,\n  bufferEndY: number,\n  viewStartY: number,\n  view: Document,\n  nodeManager: NodeManager,\n): LayoutInfoResult {\n  const nodeSize = view.nodes.length;\n  let accHeight = 0;\n  let lastMarginBottom = 0;\n\n  let expectedBufferStartBlockFound = false;\n  let expectedViewStartBlockFound = false;\n  let expectedBufferEndBlockFound = false;\n  let expectedBufferStartBlockOffset = 0;\n  let expectedViewStartBlockOffset = 0;\n  let expectedBufferEndBlockOffset = nodeSize - 1;\n  let expectedBufferStartBlockY = 0;\n  let expectedViewStartBlockY = 0;\n  let expectedBufferEndBlockY = 0;\n\n  for (let i = 0; i < nodeSize; i++) {\n    const block = view.nodes[i];\n    const cachedBlockProps = nodeManager.getCachedBlockPropsByKey(block.key);\n    const {\n      height: inputHeight,\n      marginTop: inputMarginTop,\n      marginBottom: inputMarginBottom\n    } = cachedBlockProps || {};\n    const marginTop = typeof inputMarginTop === 'number' ? (\n      inputMarginTop > lastMarginBottom ? inputMarginTop - lastMarginBottom : 0\n    ) : 0;\n    const height = typeof inputHeight === 'number' ? inputHeight : BLOCK_DEFAULT_MIN_HEIGHT;\n    const marginBottom = typeof inputMarginBottom === 'number' ? inputMarginBottom : 0;\n\n    lastMarginBottom = marginBottom;\n    const lastAccHeight = accHeight;\n    accHeight += marginTop + height + marginBottom;\n    if (\n      !expectedBufferStartBlockFound &&\n      (lastAccHeight < bufferStartY || i === 0) && accHeight >= bufferStartY\n    ) {\n      expectedBufferStartBlockFound = true;\n      expectedBufferStartBlockOffset = i;\n      expectedBufferStartBlockY = lastAccHeight;\n    }\n    if (\n      !expectedViewStartBlockFound &&\n      (lastAccHeight < viewStartY || i === 0) && accHeight >= viewStartY\n    ) {\n      expectedViewStartBlockFound = true;\n      expectedViewStartBlockOffset = i;\n      expectedViewStartBlockY = lastAccHeight;\n    }\n    if (\n      !expectedBufferEndBlockFound &&\n      lastAccHeight < bufferEndY && accHeight >= bufferEndY\n    ) {\n      expectedBufferEndBlockFound = true;\n      expectedBufferEndBlockOffset = i;\n      expectedBufferEndBlockY = accHeight;\n    }\n  }\n\n  if (!expectedBufferEndBlockFound) {\n    expectedBufferEndBlockY = accHeight;\n    expectedBufferEndBlockOffset = nodeSize;\n  }\n\n  if (!expectedViewStartBlockFound) {\n    expectedViewStartBlockOffset = nodeSize - 1;\n  }\n\n  // 极端情况，例如划到评论框，远远超出视口范围\n  if (!expectedBufferEndBlockFound && !expectedBufferStartBlockFound) {\n    if (bufferEndY < 0) {\n      expectedBufferEndBlockOffset = -1;\n      expectedBufferStartBlockOffset = -1;\n      expectedBufferStartBlockY = 0;\n      expectedBufferEndBlockY = 0;\n    } else {\n      expectedBufferEndBlockOffset = nodeSize;\n      expectedBufferStartBlockOffset = nodeSize;\n      expectedBufferStartBlockY = accHeight;\n      expectedBufferEndBlockY = accHeight;\n    }\n  }\n\n  return {\n    expectedBufferStartBlockOffset,\n    expectedViewStartBlockOffset,\n    expectedBufferEndBlockOffset,\n    expectedBufferStartBlockY,\n    expectedViewStartBlockY,\n    expectedBufferEndBlockY,\n    accHeight,\n  }\n}\n\nexport function calculateBlockStartYByBlockIndex(\n  blockIndex: number,\n  view: Document,\n  nodeManager: NodeManager,\n  includeLastMarginBottom = false,\n) {\n  let accHeight = 0;\n  let lastMarginBottom = 0;\n\n  for (let i = 0; i < blockIndex; i++) {\n    const block = view.nodes[i];\n    const cachedBlockProps = nodeManager.getCachedBlockPropsByKey(block.key);\n    const {\n      height: inputHeight,\n      marginTop: inputMarginTop,\n      marginBottom: inputMarginBottom\n    } = cachedBlockProps || {};\n    const marginTop = typeof inputMarginTop === 'number' ? (\n      inputMarginTop > lastMarginBottom ? inputMarginTop - lastMarginBottom : 0\n    ) : 0;\n    const height = typeof inputHeight === 'number' ? inputHeight : BLOCK_DEFAULT_MIN_HEIGHT;\n    const marginBottom = typeof inputMarginBottom === 'number' ? inputMarginBottom : 0;\n\n    lastMarginBottom = marginBottom;\n    accHeight += marginTop + height + ((includeLastMarginBottom || (i < blockIndex - 1)) ? marginBottom : 0);\n  }\n\n  return accHeight;\n}\n\nexport const fastDiffOnValueChange = ((\n  prevView: Document,\n  currView: Document,\n  startBlockKey: string,\n  startBlockOffset: number,\n  endBlockOffset: number,\n): DiffResult => {\n  if (prevView === currView) {\n    return {\n      type: 'equal',\n    };\n  }\n  const oldStartKeyNewPath = currView.getPath(startBlockKey);\n  if (!(oldStartKeyNewPath && oldStartKeyNewPath.length === 1)) {\n    return {\n      type: 'changed',\n    };\n  }\n  const startKeyOffsetChange = oldStartKeyNewPath[0] - startBlockOffset;\n  for (let i = startBlockOffset + 1; i <= endBlockOffset; i++) {\n    const prevBlock = prevView.nodes[i];\n    const currBlock = currView.nodes[i + startKeyOffsetChange];\n    if (prevBlock?.key !== currBlock?.key) {\n      return {\n        type: 'changed',\n      };\n    }\n  }\n\n  if (startKeyOffsetChange === 0) {\n    if (endBlockOffset >= prevView.nodes.length - 1 && currView.nodes[endBlockOffset + 1]) {\n      return {\n        type: 'changed',\n      };\n    }\n    return {\n      type: 'equal',\n    }\n  }\n\n  // 用户视口在顶端，且在文章之前插入节点的情况\n  if (startBlockOffset === 0 && startKeyOffsetChange > 0) {\n    return {\n      type: 'changed',\n    };\n  }\n\n  return {\n    type: 'translation',\n    offset: startKeyOffsetChange,\n  }\n})\n\n\nexport function calculateBlockKeysNeedToMeasure(\n  view: Document,\n  _prevView: Document,\n  layoutInfoResult: LayoutInfoResult,\n  prevLayoutInfoResult?: LayoutInfoResult | null,\n) {\n  const {\n    expectedBufferStartBlockOffset,\n    expectedBufferEndBlockOffset,\n  } = layoutInfoResult;\n  const prevView = _prevView || view;\n  if (!prevLayoutInfoResult) {\n    return view.nodes.map((node) => node.key).slice(expectedBufferStartBlockOffset, expectedBufferEndBlockOffset + 1);\n  }\n  const {\n    expectedBufferStartBlockOffset: prevExpectedBufferStartBlockOffset,\n    expectedBufferEndBlockOffset: prevExpectedBufferEndBlockOffset,\n  } = prevLayoutInfoResult;\n  // 当内容没有变化时，使用更快的算法\n  if (prevView === view) {\n    if (expectedBufferStartBlockOffset < prevExpectedBufferStartBlockOffset) {\n      const endIndex = Math.min(expectedBufferEndBlockOffset + 1, prevExpectedBufferStartBlockOffset);\n      return view.nodes.map((node) => node.key).slice(expectedBufferStartBlockOffset, endIndex);\n    } else if (expectedBufferEndBlockOffset > prevExpectedBufferEndBlockOffset) {\n      const startIndex = Math.max(expectedBufferStartBlockOffset, prevExpectedBufferEndBlockOffset + 1);\n      return view.nodes.map((node) => node.key).slice(startIndex, expectedBufferEndBlockOffset + 1);\n    }\n    return [];\n  } else {\n    const prevVisibleKeys = prevView.nodes.slice(prevExpectedBufferStartBlockOffset, prevExpectedBufferEndBlockOffset + 1).map((node) => node.key);\n    const currentVisibleKeys = view.nodes.slice(expectedBufferStartBlockOffset, expectedBufferEndBlockOffset + 1).map((node) => node.key);\n    const newBlockKeys: string[] = [];\n    currentVisibleKeys.forEach((key) => {\n      if (!prevVisibleKeys.includes(key)) {\n        newBlockKeys.push(key);\n      }\n    });\n    return newBlockKeys;\n  }\n}\n","import Controller from '../controller';\nimport Block from '../models/block';\nimport type { MeasureBlocksResult, BlockInfo } from './interface';\n\nexport interface NodeManagerOption {\n  controller: Controller;\n}\n\nexport default class NodeManager {\n  private controller: Controller;\n  private blockCacheByKey: Map<string, BlockInfo> = new Map();\n  private blockKeyQueue: string[] = [];\n\n  constructor(options: NodeManagerOption) {\n    const { controller } = options;\n    this.controller = controller;\n  }\n\n  public getCachedBlockPropsByKey(key: string) {\n    return this.blockCacheByKey.get(key);\n  }\n\n  public gc() {\n    const { view } = this.controller;\n    const viewTopBlockLength = view.nodes.length;\n    if (this.blockKeyQueue.length > viewTopBlockLength) {\n      const gcBlockKeyQueue = this.blockKeyQueue.splice(0, this.blockKeyQueue.length - viewTopBlockLength);\n      gcBlockKeyQueue.forEach((key) => {\n        this.blockCacheByKey.delete(key);\n      });\n    }\n  }\n\n  public setCachedBlockPropsByKey(key: string, blockInfo: BlockInfo) {\n    const prevBlockInfo = this.blockCacheByKey.get(key);\n    this.blockCacheByKey.set(key, {\n      ...prevBlockInfo,\n      ...blockInfo,\n    });\n    \n    var index = this.blockKeyQueue.indexOf(key);\n    if (index !== -1) {\n      this.blockKeyQueue.splice(index, 1);\n    }\n    this.blockKeyQueue.push(key);\n    this.gc();\n    return;\n  }\n\n  public loadMeasureResult(measureResults: MeasureBlocksResult) {\n    const document = this.controller.view;\n    for (const key in measureResults) {\n      const prevBlockInfo: BlockInfo = this.blockCacheByKey.get(key) || {\n        key,\n        persistStateNode: [],\n      };\n      const measureResult = measureResults[key];\n      const block = document.getNode(key) as Block;\n      const blockInfo: BlockInfo = {\n        ...prevBlockInfo,\n        ...measureResult, \n        key,\n        uuid: block?.data?.uuid,\n      };\n      this.setCachedBlockPropsByKey(key, blockInfo);\n    }\n  }\n\n  public getVirtualizePersistState(key: string) {\n    const blockCache = this.blockCacheByKey.get(key);\n    if (!blockCache?.persistStateNode) {\n      return [];\n    }\n    return blockCache.persistStateNode;\n  }\n\n  public updateVirtualizePersistState(key: string, topBlockKey: string, shouldPersistState: boolean) {\n    const blockCache = this.getCachedBlockPropsByKey(topBlockKey);\n    const persistStateNode = blockCache?.persistStateNode?.slice() || [];\n    const keyIndex = persistStateNode.indexOf(key);\n    if (shouldPersistState && keyIndex === -1) {\n      persistStateNode.push(key);\n    }\n    if (!shouldPersistState && keyIndex >= 0) {\n      persistStateNode.splice(keyIndex, 1);\n    }\n\n    this.setCachedBlockPropsByKey(topBlockKey, {\n      ...blockCache,\n      key: topBlockKey,\n      persistStateNode,\n    });\n  }\n\n}","import Document from \"../models/document\";\nimport Controller from \"../controller\";\nimport Block from \"../models/block\";\nimport NodeManager from \"./nodeManager\";\n\nimport { BLOCK_DEFAULT_MIN_HEIGHT, DEFAULT_FIRST_PAINT_BLOCK_SIZE } from './constants';\nimport { LayoutInfoResult, BlockFinalVisibleState, VisiblesResult } from \"./interface\";\n\ninterface OutputManagerOptions {\n  controller: Controller;\n  nodeManager: NodeManager;\n  firstPaintBlockSize?: number;\n}\n\n\nexport default class OutputManager {\n  private controller: Controller;\n  private nodeManager: NodeManager;\n  private firstPaintBlockSize: number;\n\n  // 暂时以 offset 为标准\n  public startBlockOffset!: number;\n  public endBlockOffset!: number;\n  public startBlockKey?: string;\n  public endBlockKey?: string;\n\n  public startViewBlockOffset = 0;\n\n  public beforePlaceholderHeight = 0;\n  public afterPlaceholderHeight = 0;\n\n  constructor(options: OutputManagerOptions) {\n    const { nodeManager, controller, firstPaintBlockSize } = options;\n    this.controller = controller;\n    this.nodeManager = nodeManager;\n    this.firstPaintBlockSize = typeof firstPaintBlockSize === 'number' ? firstPaintBlockSize : DEFAULT_FIRST_PAINT_BLOCK_SIZE;\n    this.setStartEndInfoByOffset(0, this.firstPaintBlockSize - 1);\n    this.setPlaceholderHeight();\n  }\n\n  public precheckOutputByLayoutInfo(layoutInfoResult: LayoutInfoResult) {\n    const {\n      expectedBufferStartBlockOffset,\n      expectedBufferEndBlockOffset,\n      expectedBufferStartBlockY,\n      expectedBufferEndBlockY,\n      accHeight,\n    } = layoutInfoResult;\n    const {\n      beforePlaceholderHeight,\n      afterPlaceholderHeight,\n    } = this.calculatePlaceholderHeight(expectedBufferStartBlockY, expectedBufferEndBlockY, accHeight);\n\n    const visibles = this.calculateVisibles(expectedBufferStartBlockOffset, expectedBufferEndBlockOffset);\n    return {\n      beforePlaceholderHeight,\n      afterPlaceholderHeight,\n      visibles,\n    };\n  }\n\n  public loadCalculateLayoutInfo(layoutInfoResult: LayoutInfoResult) {\n    const {\n      expectedBufferStartBlockOffset,\n      expectedBufferEndBlockOffset,\n      expectedBufferStartBlockY,\n      expectedBufferEndBlockY,\n      expectedViewStartBlockOffset,\n      accHeight,\n    } = layoutInfoResult;\n    this.setStartEndInfoByOffset(expectedBufferStartBlockOffset, expectedBufferEndBlockOffset);\n    this.setPlaceholderHeight(expectedBufferStartBlockY, expectedBufferEndBlockY, accHeight);\n    this.startViewBlockOffset = expectedViewStartBlockOffset;\n  }\n\n  private calculatePlaceholderHeight(expectedBlockStartY?: number, expectedBlockEndY?: number, accHeight?: number) {\n    if (typeof expectedBlockStartY === 'number' && typeof expectedBlockEndY === 'number' && typeof accHeight === 'number') {\n      return {\n        beforePlaceholderHeight: expectedBlockStartY,\n        afterPlaceholderHeight: accHeight - expectedBlockEndY,\n      };\n    }\n\n    return {\n      beforePlaceholderHeight: 0,\n      afterPlaceholderHeight: Math.max(0, this.controller.view.nodes.length - this.firstPaintBlockSize) * BLOCK_DEFAULT_MIN_HEIGHT,\n    };\n  }\n\n  public setPlaceholderHeight(expectedBlockStartY?: number, expectedBlockEndY?: number, accHeight?: number) {\n    if (typeof expectedBlockStartY === 'number' && typeof expectedBlockEndY === 'number' && typeof accHeight === 'number') {\n      this.beforePlaceholderHeight = expectedBlockStartY;\n      this.afterPlaceholderHeight = accHeight - expectedBlockEndY;\n      return;\n    }\n\n    this.afterPlaceholderHeight = Math.max(0, this.controller.view.nodes.length - this.firstPaintBlockSize) * BLOCK_DEFAULT_MIN_HEIGHT;\n    return;\n  }\n\n  public setStartEndInfoByOffset(startOffset: number, endOffset: number) {\n    const view = this.controller.view;\n    this.startBlockOffset = startOffset;\n    this.endBlockOffset = endOffset;\n    const startBlock = view.getNodeByPath([startOffset]) as Block;\n    const endBlock = view.getNodeByPath([endOffset]) as Block;\n    this.startBlockKey = startBlock?.key;\n    this.endBlockKey = endBlock?.key;\n  }\n\n  private calculateVisibles(startBlockOffset: number, endBlockOffset: number) {\n    const { view } = this.controller;\n    const visibleBlockKeys: string[] = [];\n    const blockFinalVisibleStates = view.nodes.map((node, index) => {\n      if (index < startBlockOffset || index > endBlockOffset) {\n        const cachedBlockProps = this.nodeManager.getCachedBlockPropsByKey(node.key);\n        if (cachedBlockProps?.persistStateNode && cachedBlockProps.persistStateNode.length > 0) {\n          return 'hide';\n        }\n        return 'destroy';\n      }\n      visibleBlockKeys.push(node.key);\n      return 'show';\n    });\n    return {\n      blockFinalVisibleStates,\n      visibleBlockKeys,\n    }\n  }\n\n  // todo: cache\n  get visibles(): VisiblesResult {\n    const result = this.calculateVisibles(this.startBlockOffset, this.endBlockOffset);\n    return result;\n  }\n\n}","/**\n * @packageDocumentation\n * @module domUtils\n */\n\n/**\n * 查找 node 节点下 first/last 的 Text 节点\n * @param node 查找的节点\n * @param order 遍历的顺序 pre-前序遍历 post-后序遍历\n */\nfunction findTextNode(node: Node, order: 'pre' | 'post' = 'pre'): Text | null {\n  const childNodes =\n    order === 'post' ? Array.from(node.childNodes).reverse() : node.childNodes;\n  for (let i = 0; i < childNodes.length; i += 1) {\n    const child = childNodes[i];\n    if (child instanceof Text) {\n      return child;\n    }\n    const text = findTextNode(child, order);\n    if (text instanceof Text) {\n      return text;\n    }\n  }\n  return null;\n}\n\n/**\n * 获取 DOM 的真实选区\n * @param root\n * @description 由于编辑器层没有浏览器的选区，所以使用 mark 的方式自行构造选区\n */\nexport default function findCurrentDOMRange(\n  root: HTMLElement | Document = window.document,\n): Range | null {\n  const nodes = root.querySelectorAll('[data-cangjie-range');\n  if (nodes.length <= 0) {\n    return null;\n  }\n  const range = document.createRange();\n  const start = nodes[0];\n  const end = nodes[nodes.length - 1];\n  const anchor = findTextNode(start, 'pre');\n  const focus = findTextNode(end, 'post');\n  if (!anchor || !focus) {\n    return null;\n  }\n  try {\n    range.setStart(anchor, 0);\n    range.setEnd(focus, Math.max(focus.length, 0));\n  } catch (error) {\n    return null;\n  }\n  return range;\n}\n","/**\n * @packageDocumentation\n * @module domUtils\n */\nimport Controller from '../../controller/index';\nimport caretRangeFromTargetAndCoord from './caretRangeFromTargetAndCoord';\n\n/**\n * 根据用户的 click 或 touch 事件获取仓颉的 Selection\n */\nfunction findRangeByEvent(\n  event: { x: number; y: number; target: EventTarget },\n  controller: Controller,\n) {\n  const { target, x, y } = event;\n  return caretRangeFromTargetAndCoord(target, x, y, controller);\n}\n\nexport default findRangeByEvent;\n","import { Selector } from '../../constants';\n\nexport type Rect = {\n  left: number;\n  top: number;\n  width: number;\n  height: number;\n};\n\ntype RectRow = {\n  top: number;\n  height: number;\n};\n\n/**\n * 遍历节点内的每一个 cangjie content 节点，获取 getClientRects 列表\n */\nfunction getDOMRects(node: Element) {\n  const rects: Rect[] = [];\n  const leafContents = node.querySelectorAll(`[${Selector.leaf}]`);\n  const voidContents = node.querySelectorAll(`[${Selector.void}]`);\n  // TODO：代码块特殊处理，后期需要移除\n  const specialCodes = node.querySelectorAll('.CodeMirror');\n\n  const addRect = (rect?: DOMRect) => {\n    if (rect) {\n      const { left, top, width, height } = rect;\n      rects.push({ left, top, width, height });\n    }\n  }\n\n  Array.from(leafContents).forEach(leaf => {\n    if (!leaf.closest(`[${Selector.void}]`)) {\n      Array.from(leaf.getClientRects()).forEach(addRect);\n    }\n  });\n  Array.from(voidContents).forEach(voidNode => {\n    const rect = voidNode.getBoundingClientRect();\n    addRect(rect);\n  });\n  Array.from(specialCodes).forEach(codeNode => {\n    const rect = codeNode.closest(`[${Selector.leafBlock}]`)?.getBoundingClientRect();\n    addRect(rect);\n  });\n  return rects;\n}\n\n/**\n * 获取分行。`rows` 构建了分行的结构，每一个 row 表示一行\n */\nexport function splitRows(blockDOMNode: Element, extendToFill = false) {\n  const parentRect = blockDOMNode.getBoundingClientRect();\n  const linesRects = getDOMRects(blockDOMNode);\n  const newRow = (rect: Rect) => {\n    const { top, height } = rect;\n    return { top, height };\n  };\n  const rows: RectRow[] = [];\n  const sortIntoRows = (rect: Rect) => {\n    if (!rows.length) {\n      rows.push(newRow(rect));\n      return;\n    }\n    // 尝试找到插入行（如果 rect 的 top 比某一行的 bottom 小，就算插入行）\n    const insertRow = rows.find(row => rect.top < row.top + row.height);\n\n    // 没有插入行的话，就创建一个\n    if (!insertRow) {\n      rows.push(newRow(rect));\n      return;\n    }\n\n    // rect 的 bottom 比插入行的 top 小，则 rect 可以重新创建一行了\n    if (rect.top + rect.height <= insertRow.top) {\n      rows.splice(rows.indexOf(insertRow), 0, newRow(rect));\n      return;\n    }\n\n    // rect 属于某个 row，更新一下 row\n    if (rect.top < insertRow.top) {\n      insertRow.top = rect.top;\n    }\n    if (rect.top + rect.height > insertRow.top + insertRow.height) {\n      insertRow.height = rect.top + rect.height - insertRow.top;\n    }\n  };\n  // 对 block DOM 的所有 rects 进行分行\n  linesRects.forEach(sortIntoRows);\n  if (!rows.length) {\n    rows.push(newRow(parentRect));\n  }\n\n  if (!extendToFill) {\n    return rows;\n  }\n\n  const first = rows[0];\n  const last = rows[rows.length - 1];\n  first.height += first.top - parentRect.top;\n  first.top = parentRect.top;\n  last.height = parentRect.bottom - last.top;\n  // extendToFill：扩展行高，填充行之间的空隙\n  for (let i = 1; i < rows.length; i++) {\n    const prev = rows[i - 1];\n    const now = rows[i];\n    const margin = now.top - prev.top - prev.height;\n    prev.height += margin / 2;\n    now.height += margin / 2;\n    now.top -= margin / 2;\n  }\n  return rows;\n}\n\n/**\n * 选区、色块抗锯齿优化，调整 rect 的高度，使属于同一行的 rect 高度相同。\n */\nexport function fitRows(rows: RectRow[], rects: Rect[], offsetRect: Rect) {\n  const newRects: Rect[] = [];\n\n  rects.forEach(rect => {\n    // 尝试找到插入行（如果 rect 的 top 比某一行的 bottom 小，就算插入行）\n    const insertRow = rows.find(row => rect.top < row.top + row.height);\n\n    // 如果没有找到，或者 rect 的 bottom 比插入行的 top 还要小，就不返回\n    if (!insertRow || rect.top + rect.height < insertRow.top) {\n      return;\n    }\n\n    const { height, top } = insertRow;\n    const { left, width } = rect;\n\n    newRects.push({\n      left: left - offsetRect.left,\n      top: top - offsetRect.top,\n      height,\n      width,\n    });\n  });\n\n  return newRects;\n}\n\n/**\n * 相邻的 rect 进行合并，避免碎片化的色块\n */\nexport function mergeRects(rects: Rect[]) {\n  const sortedRects = rects.sort((l, r) => {\n    if (l.top !== r.top) {\n      return l.top - r.top;\n    }\n    return l.left - r.left;\n  });\n  // 左右相邻的 rects 合并成一个\n  const newRects: Rect[] = [];\n  sortedRects.forEach(rect => {\n    const prev = newRects[newRects.length - 1];\n    let { left, width } = rect;\n    const { top, height } = rect;\n    if (\n      prev &&\n      Math.round(prev.top) === Math.round(top) &&\n      // top 相等且 prev.right >= left，此 rect 可以和前一个合并\n      Math.round(prev.left + prev.width) >= Math.round(left)\n    ) {\n      // right 取最大值\n      const right = Math.max(prev.left + prev.width, left + width);\n      left = prev.left;\n      width = right - left;\n      newRects.pop();\n      newRects.push({ left, top, width, height });\n    } else {\n      newRects.push(rect);\n    }\n  });\n  return newRects;\n}\n","import { Selector } from \"../../constants\";\nimport { findDOMNodeSafely } from './findDOMNode';\n\n/**\n * 查找指定节点下的选区容器\n * @param root 查询的根节点\n * @param layerFor 查找的指定容器的 selection-layer，若为空则不指定具体值\n */\nexport function getSelectionLayers(root = window.document.body, layerFor = '') {\n  const selector = layerFor ? `[${Selector.selectionLayer}=\"${layerFor}\"]` : `[${Selector.selectionLayer}]`;\n  return root.querySelectorAll(selector) || [];\n}\n\n/**\n * 获取本地光标 DOM\n * @param root\n * @returns\n */\nexport function getCaretDom(root = window.document.body) {\n  const layers = getSelectionLayers(root);\n  for (let i = layers.length - 1; i >= 0; i--) {\n    const layer = layers[i];\n    const target = layer.shadowRoot\n      ? layer.shadowRoot.querySelector('[data-cangjie-caret=\"true\"]')\n      : layer.querySelector('[data-cangjie-caret=\"true\"]');\n\n    if (target) {\n      return target;\n    }\n  }\n  return undefined;\n}\n\n/**\n * 查找归属于特定 data-cangjie-key 的容器 DOM 节点内的选区根节点\n * @param containerKey 指定容器 key\n * @returns\n */\nexport function findSelectionSlot(containerKey: string): HTMLDivElement | null | undefined {\n  const containerDOM = findDOMNodeSafely(containerKey);\n  try {\n    const selectionLayer = getSelectionLayers(containerDOM, containerKey)[0];\n    const wrapper = selectionLayer.shadowRoot\n      ? selectionLayer.shadowRoot.querySelector('div')\n      : selectionLayer.querySelector('div');\n    return wrapper;\n  } catch (e) {\n    console.warn(`[Selection] Get selection slot dom for [${containerKey}] failed`, e);\n  }\n  return null;\n}\n","import Controller from \"../../controller\";\nimport type Path from \"../../models/path\";\nimport Block from \"../../models/block\";\nimport Text from \"../../models/text\";\nimport { waitForElementByAnimationFrame } from \"../../virtualize/virtualizeUtils\";\nimport { findDOMNodeSafely } from \"./findDOMNode\";\n\nexport async function scrollToNodeByPath(\n  path: Path,\n  controller: Controller,\n  preventScrollWhenNodeIsVisible = false,\n  doNothingWhenVirtualizeDisabled = false,\n) {\n  // 这里加上 Block 调用，避免被干掉，引 Block 为了规避循环引用\n  Block;\n  const node = controller.view.getNodeByPath(path);\n  if (!node) {\n    return;\n  }\n  if (!controller.enableVirtualize && doNothingWhenVirtualizeDisabled) {\n    return;\n  }\n  const key = node.key;\n  const index = path[0];\n  const topBlock = controller.view.getNodeByPath([index]);\n\n  const targetNode = Text.isText(node) ? controller.view.getParent(key) : node;\n\n  if (targetNode?.key && preventScrollWhenNodeIsVisible) {\n    const dom = findDOMNodeSafely(targetNode.key);\n    if (dom) {\n      return;\n    }\n  }\n\n  if (controller.enableVirtualize && controller.virtualizeManager && topBlock && !controller.isNodeVisible(topBlock)) {\n    const { virtualizeManager } = controller;\n    if (!virtualizeManager.viewInitialized) {\n      await virtualizeManager.waitUntilViewInitialized;\n    }\n    await virtualizeManager.workflowToScrollToNode(index);\n  }\n\n\n  if (targetNode) {\n    try {\n      const selector = `[data-cangjie-key=\"${targetNode.key}\"]`;\n      const nodeElement = await waitForElementByAnimationFrame(selector);\n      if (nodeElement && typeof nodeElement.scrollIntoView === 'function') {\n        nodeElement.scrollIntoView();\n      }\n    } catch (e) {\n      console.warn(`Failed to scrollToNodeByPath`);\n    }\n  }\n\n}\n\nexport async function scrollToNodeByKey(\n  key: string,\n  controller: Controller,\n  preventScrollWhenNodeIsVisible = false,\n  doNothingWhenVirtualizeDisabled = false,\n) {\n  const path = controller.view.getPath(key);\n  if (!path) {\n    return;\n  }\n  await scrollToNodeByPath(path, controller, preventScrollWhenNodeIsVisible, doNothingWhenVirtualizeDisabled);\n  return;\n}","/**\n * @packageDocumentation\n * @ignore\n */\nexport { default as findNode } from './findNode';\n\nexport { default as findPoint } from './findPoint';\n\nexport { default as findRange } from './findRange';\n\nexport { default as findDOMNode, findDOMNodeSafely } from './findDOMNode';\n\nexport { default as findDOMPoint } from './findDOMPoint';\n\nexport { default as findDOMRange } from './findDOMRange';\n\nexport { default as findCurrentDOMRange } from './findCurrentDOMRange';\n\nexport { default as findRangeByEvent } from './findRangeByEvent';\n\nexport { default as caretRangeFromTargetAndCoord } from './caretRangeFromTargetAndCoord';\n\nexport { findCaretPosition } from './findCaretPosition';\n\nexport { splitRows, fitRows, mergeRects } from './optimizeRectsToFitLineHeight';\n\nexport { default as findClosestInContent } from './findClosestInContent';\n\nexport { getLocalCaretPos, getLocalCaretPosDetail } from './localCaretPos';\n\nexport * from './scrollToSelection';\n\nexport * from './selection';\n\nexport { scrollToNodeByPath, scrollToNodeByKey } from './scrollToNode';\n","import { throttle, debounce } from 'lodash-es';\nimport NodeManager from './nodeManager';\nimport CDocument from \"../models/document\";\nimport { DEFAULT_BUFFER_RANGE, DEFAULT_SCROLL_THROTTLE_INTERVAL } from './constants';\nimport { findDOMNodeSafely } from '../utils/dom';\nimport { calculateBlockStartYByBlockIndex, calculateEditorContainerToScrollContainerDistance, calculateExpectedLayoutInfo, calculateViewPort, measureBlockInfo } from './calculateUtils';\nimport type { MeasureBlocksResult, BlockMeasureInfo, LayoutInfoResult } from './interface';\nimport { scrollContainerIsTop, waitForElementByAnimationFrame } from './virtualizeUtils';\nimport { Selector } from '../constants';\n\nconst RESIZE_DEBOUNCE_TIME = 150;\n\ninterface ViewManagerOption {\n  editorContainer: HTMLElement;\n  scrollContainer: HTMLElement;\n  scrollHandler: () => void;\n  resizeHandler: (entries: ResizeObserverEntry[]) => void;\n  scrollInterval?: number;\n  bufferRange?: number;\n  nodeManager: NodeManager;\n  triggerViewUpdate: (string) => void;\n}\n\ninterface scrollHistory {\n  timestamp: number;\n  viewPortStartY: number;\n}\n\nexport default class ViewManager {\n  private nodeManager: NodeManager;\n\n  private editorContainer: HTMLElement;\n  private scrollContainer: HTMLElement;\n  private scrollElement: HTMLElement;\n  private scrollListenerElement: HTMLElement | Document;\n  private scrollHandler: () => void;\n  private scrollInterval: number;\n  private resizeHandler: (elements: ResizeObserverEntry[]) => void;\n  private resizeObserver: ResizeObserver | null = null;\n  private bufferRange: number;\n  private editorContainerToScrollContainerDistance!: number;\n\n  private scrollHistoryArray: scrollHistory[] = [];\n\n  private throttledScrollListener: () => void;\n  public triggerViewUpdate?: (id: number) => void;\n\n  private viewPortStartY!: number;\n  private viewPortEndY!: number;\n  private bufferStartY!: number;\n  private bufferEndY!: number;\n  private prevViewPortStartY = 0;\n\n  // 暂时没用到的方法 未来可能用到 注释掉避免影响覆盖率\n  // get viewPort() {\n  //   return {\n  //     viewPortStartY: this.viewPortStartY,\n  //     viewPortEndY: this.viewPortEndY,\n  //     bufferStartY: this.bufferStartY,\n  //     bufferEndY: this.bufferEndY,\n  //   }\n  // }\n\n  constructor(options: ViewManagerOption) {\n    const {\n      editorContainer,\n      scrollContainer,\n      scrollHandler,\n      scrollInterval,\n      resizeHandler,\n      bufferRange,\n      triggerViewUpdate,\n      nodeManager,\n    } = options;\n\n    this.nodeManager = nodeManager;\n\n    this.editorContainer = editorContainer;\n    this.scrollContainer = scrollContainer;\n    this.scrollHandler = scrollHandler;\n    this.resizeHandler = resizeHandler;\n\n    this.bufferRange = bufferRange || DEFAULT_BUFFER_RANGE;\n    this.scrollElement =\n      scrollContainerIsTop(this.scrollContainer) ? document.documentElement : scrollContainer;\n\n    this.scrollListenerElement =\n      scrollContainerIsTop(this.scrollContainer) ? document : scrollContainer;\n    this.scrollInterval = typeof scrollInterval === 'number' ? scrollInterval : DEFAULT_SCROLL_THROTTLE_INTERVAL;\n\n    this.triggerViewUpdate = triggerViewUpdate;\n\n    this.updateEditorContainerToScrollContainerDistance();\n    this.updateViewPort();\n\n    this.throttledScrollListener = throttle(this.scrollListener, this.scrollInterval);\n  }\n\n  public updateEditorContainerToScrollContainerDistance() {\n    this.editorContainerToScrollContainerDistance =\n      calculateEditorContainerToScrollContainerDistance(\n        this.editorContainer,\n        this.scrollContainer,\n        this.scrollElement,\n        scrollContainerIsTop(this.scrollContainer),\n      );\n  }\n\n  public calculateViewPort(_viewPortStartY?: number) {\n    return calculateViewPort(this.scrollElement, this.scrollContainer, this.bufferRange, this.editorContainerToScrollContainerDistance, _viewPortStartY);\n  }\n\n  public updateViewPort() {\n    this.prevViewPortStartY = this.viewPortStartY;\n    const { viewPortStartY, viewPortEndY, bufferStartY, bufferEndY } = this.calculateViewPort();\n    this.viewPortStartY = viewPortStartY;\n    this.viewPortEndY = viewPortEndY;\n    this.bufferStartY = bufferStartY;\n    this.bufferEndY = bufferEndY;\n\n    // const gap = this.viewPortStartY - this.prevViewPortStartY;\n    return;\n  }\n\n  public scrollListener = () => {\n    const { viewPortStartY } = this.calculateViewPort();\n    const timestamp = new Date().valueOf();\n    const value = {\n      timestamp,\n      viewPortStartY,\n    };\n    const index = this.scrollHistoryArray.findIndex((scrollHistory) => {\n      return scrollHistory.viewPortStartY === viewPortStartY && (timestamp - scrollHistory.timestamp < 1000);\n    });\n\n    if (index >= 0) {\n      return;\n    }\n    this.scrollHistoryArray.push(value);\n    if (this.scrollHistoryArray.length > 2) {\n      this.scrollHistoryArray.shift();\n    }\n\n    this.scrollHandler();\n  }\n\n  public initScrollListener() {\n    this.scrollListenerElement.addEventListener('scroll', this.throttledScrollListener);\n  }\n\n  public destroyScrollListener() {\n    this.scrollListenerElement.removeEventListener('scroll', this.throttledScrollListener);\n  }\n\n  public initResizeObserver() {\n    if (typeof ResizeObserver === 'undefined') {\n      return;\n    }\n    const handleResize = debounce((entries: ResizeObserverEntry[]) => {\n      this.resizeHandler(entries);\n    }, RESIZE_DEBOUNCE_TIME);\n    const resizeObserver = new ResizeObserver(handleResize);\n    this.resizeObserver = resizeObserver;\n  }\n\n  public detroyResizeObserver() {\n    this.resizeObserver = null;\n  }\n\n  public addResizeObserverByKeys(blockKeys: string[]) {\n    if (!this.resizeObserver) {\n      return;\n    }\n    blockKeys.forEach((blockKey) => {\n      const blockElement = findDOMNodeSafely(blockKey);\n      if (!blockElement) {\n        return;\n      }\n      this.addResizeObserver(blockElement);\n    });\n  }\n\n  public addResizeObserver(element: HTMLElement) {\n    if (!this.resizeObserver) {\n      return;\n    }\n    this.resizeObserver.observe(element);\n  }\n\n  public removeResizeObserver(element: HTMLElement) {\n    if (!this.resizeObserver) {\n      return;\n    }\n    this.resizeObserver.unobserve(element);\n  }\n\n  /**\n   * 测量所有当前上屏节点的高度\n   * @returns Object, key 为节点 key, value 为高度\n   */\n  public measureCurrentViewBlocks(documentKey: string): MeasureBlocksResult {\n    const documentElement = findDOMNodeSafely(documentKey);\n    const result: MeasureBlocksResult = {};\n    documentElement?.childNodes.forEach((childNode) => {\n      const element = childNode as HTMLElement;\n      const cangjieKey = element.getAttribute(Selector.key);\n      if (cangjieKey) {\n        const measuredInfo = measureBlockInfo(element);\n        result[cangjieKey] = measuredInfo;\n      }\n    });\n    return result;\n  }\n\n  public async measureBlocksByKeys(blockKeys: string[]): Promise<MeasureBlocksResult> {\n    const result: MeasureBlocksResult = {};\n    const measureTasks = blockKeys.map((blockKey) => {\n      const promise: Promise<BlockMeasureInfo> = Promise.resolve().then(() => {\n        const blockElement = findDOMNodeSafely(blockKey);\n        if (!blockElement) {\n          return {};\n        }\n        const measuredInfo = measureBlockInfo(blockElement);\n        result[blockKey] = measuredInfo;\n        return measuredInfo;\n      });\n      return promise;\n    });\n    await Promise.all(measureTasks);\n    return result;\n  }\n\n  public calculateExpectedLayoutInfo(\n    view: CDocument,\n    bufferStartY?: number,\n    bufferEndY?: number,\n    viewStartY?: number,\n  ) {\n    const result = calculateExpectedLayoutInfo(\n      typeof bufferStartY === 'number' ? bufferStartY : this.bufferStartY,\n      typeof bufferEndY === 'number' ? bufferEndY : this.bufferEndY,\n      typeof viewStartY === 'number' ? viewStartY : this.viewPortStartY,\n      view,\n      this.nodeManager,\n    );\n\n    return result;\n  }\n\n  public calculateBlockStartYByBlockIndex(index: number, view: CDocument, includeLastMarginBottom = false) {\n    return calculateBlockStartYByBlockIndex(index, view, this.nodeManager, includeLastMarginBottom);\n  }\n\n  // 这里仅仅是滚最外层\n  public scrollToNodeByIndex(index: number, view: CDocument) {\n    // this.updateEditorContainerToScrollContainerDistance();\n    const startY = calculateBlockStartYByBlockIndex(index, view, this.nodeManager);\n    const totalStartY = startY + this.editorContainerToScrollContainerDistance;\n    this.scrollElement.scrollTo(this.scrollElement.scrollLeft, totalStartY);\n  }\n\n}","import equal from \"fast-deep-equal\";\nimport Controller from \"../controller\";\nimport CDocument from \"../models/document\";\nimport { calculateBlockKeysNeedToMeasure, fastDiffOnValueChange } from \"./calculateUtils\";\nimport { LayoutInfoResult, VirtualizeOptions, ViewRelatedOptions, WorkflowResult } from \"./interface\";\nimport NodeManager from \"./nodeManager\";\nimport OutputManager from \"./outputManager\";\nimport ViewManager from \"./viewManager\";\nimport { checkArrayAHasElementNotIncludedInArrayB, waitForElementByAnimationFrame } from \"./virtualizeUtils\";\n\nexport default class VirtualizeManager {\n  // active 状态，用于运行时关闭虚拟化\n  private _isActive = false;\n  // 虚拟化配置项\n  public options: VirtualizeOptions;\n  // 节点缓存管理器，用于缓存节点的测量结果等，并提供了一些方便使用的加载测量结果的方法\n  public nodeManager: NodeManager;\n  // 输出管理器，通过加载测算结果，生成节点是否可视等输出信息，Cangjie 渲染时 useVirtualize 依赖\n  public outputManager: OutputManager;\n  // 视图管理器，所有跟 视图、DOM 相关的逻辑均收敛到这里\n  public viewManager?: ViewManager;\n\n  // 虚拟化 id，为虚拟化流程执行次数的标记，同时用于触发虚拟化流程导致的视图重渲；为 -1 时代表虚拟化关闭\n  public virtualizeId = 0;\n  // 当前正忙的虚拟化 id，用于禁止其他流程的进行\n  private currentLockedVirtualizeId: number | null = null;\n\n  // 虚拟化的当前测算结果与上次测算结果，outputManager load 此结果后才会改变输出\n  public prevLayoutInfoResult?: LayoutInfoResult;\n  public layoutInfoResult?: LayoutInfoResult;\n\n  // 虚拟化视图是否初始化，这里提供一个 Promise，在虚拟化初始化后，此 Promise 会 resolve\n  public viewInitialized = false;\n  private setViewInitialized = () => { };\n  public waitUntilViewInitialized: Promise<void>;\n\n  // 当前的 Controller\n  private controller: Controller;\n  // 之前的 view\n  private prevView: CDocument;\n  // 配置的 buffer 范围\n  private bufferRange?: number;\n\n  // 虚拟化是否在正常运行态\n  get isActive() {\n    return this._isActive;\n  }\n\n  /**\n   * 虚拟化控制器初始化逻辑，在仓颉新建 Controller 时触发\n   * @returns void\n   */\n  constructor(controller: Controller, options: VirtualizeOptions) {\n    const {\n      bufferRange,\n      firstPaintBlockSize,\n    } = options;\n\n    this.options = options;\n    this.bufferRange = bufferRange;\n    this.controller = controller;\n    this.prevView = controller.view;\n\n    this.waitUntilViewInitialized = new Promise((resolve) => {\n      this.setViewInitialized = resolve;\n    });\n\n    this.nodeManager = new NodeManager({\n      controller,\n    });\n\n    this.outputManager = new OutputManager({\n      controller,\n      firstPaintBlockSize,\n      nodeManager: this.nodeManager,\n    });\n\n    this.controller.setVirtualize('visibles', this.outputManager.visibles.visibleBlockKeys);\n  }\n\n  /**\n   * 在仓颉首屏渲染后的 Effect 中触发的逻辑，用于初始化 View/DOM 相关逻辑，如建立滚动事件监听\n   * @returns void\n   */\n  public initView(InitViewOptions: ViewRelatedOptions) {\n    const {\n      editorContainer,\n      scrollContainer,\n      scrollInterval,\n      triggerViewUpdate,\n    } = InitViewOptions;\n\n    this.viewManager = new ViewManager({\n      editorContainer,\n      scrollContainer,\n      scrollInterval,\n      scrollHandler: this.scrollHandler,\n      resizeHandler: this.resizeHandler,\n      triggerViewUpdate,\n      nodeManager: this.nodeManager,\n      bufferRange: this.bufferRange,\n    });\n\n    this.initViewWorkflow();\n\n    this.viewInitialized = true;\n    this.setViewInitialized();\n  }\n\n  /**\n   * 启动虚拟化流程\n   * @param flush 是否主动触发重渲\n   * @returns void\n   */\n  public start(flush = false) {\n    if (!this.viewInitialized) {\n      console.error('VirtualizeManager error: start invoked before UI Related Manager initialization');\n    }\n    if (!this.isActive) {\n      this.viewManager!.initScrollListener();\n      this.viewManager!.initResizeObserver();\n    }\n    if (flush) {\n      this.flushVirtualize(this.virtualizeId + 1, true);\n    }\n    this._isActive = true;\n  }\n\n  /**\n   * 关闭虚拟化流程\n   * @param flush 是否主动触发重渲，如外界未触发重渲，需要主动触发重渲来显示所有节点\n   * @returns void\n   */\n  public stop(flush = false) {\n    if (!this.viewInitialized) {\n      console.error('VirtualizeManager error: stop invoked before UI Related Manager initialization');\n    }\n    if (this.isActive) {\n      this.viewManager!.destroyScrollListener();\n      this.viewManager!.detroyResizeObserver();\n    }\n    if (flush) {\n      // virtualizeId 归零\n      this.flushVirtualize(-1, true);\n    }\n    this._isActive = false;\n  }\n\n  /**\n   * 为某个虚拟化工作流增加 busy 状态位，此时可以阻止其他虚拟化工作流的发起\n   * @param virtualizeId 虚拟化 id\n   * @returns virtualizeId 虚拟化 id\n   */\n  private lock(virtualizeId: number) {\n    if (this.currentLockedVirtualizeId !== null) {\n      console.warn('warning: current has virtualizeId locked, unlock it first');\n      return this.currentLockedVirtualizeId;\n    }\n    this.currentLockedVirtualizeId = virtualizeId;\n    return virtualizeId;\n  }\n\n  /**\n   * 为某个虚拟化工作流移除 busy 状态位\n   * @param virtualizeId 虚拟化 id\n   * @returns boolean 是否成功移除\n   */\n  private unlock(virtualizeId: number) {\n    if (this.currentLockedVirtualizeId === virtualizeId) {\n      this.currentLockedVirtualizeId = null;\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * 检查是否存在 busy 状态位\n   * @param virtualizeId 虚拟化 id\n   * @returns boolean 是否存在 busy 状态位\n   */\n  private checkLocked(virtualizeId: number) {\n    if (this.currentLockedVirtualizeId !== null && virtualizeId !== this.currentLockedVirtualizeId) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * 更新虚拟化 id，刷新虚拟化结果（可选是否主动强制重渲）\n   * @param virtualizeId 虚拟化 id\n   * @param triggerReRenderActively 是否主动强制重渲\n   * @returns 保存后的虚拟化 id\n   */\n  public flushVirtualize(virtualizeId: number, triggerReRenderActively = true) {\n    this.virtualizeId = virtualizeId;\n    if (triggerReRenderActively) {\n      this.viewManager?.triggerViewUpdate?.(this.virtualizeId);\n    }\n    return this.virtualizeId;\n  }\n\n  /**\n   * 在 Cangjie 首屏渲染后执行的工作流，会测量首屏渲染的结果 (固定节点数，也不是全量节点)，并根据测量结果适当收缩节点数量\n   * 最简单的虚拟化工作流，可以用于入门流程\n   * @returns void\n   */\n  private initViewWorkflow = async () => {\n    const { view } = this.controller;\n    const currentVirtualizeId = this.virtualizeId + 1;\n    // Step 1：视图管理器测量所有已上屏节点\n    const measureResult = this.viewManager!.measureCurrentViewBlocks(view.key);\n    // Step 2：节点管理器保存测量结果\n    this.nodeManager.loadMeasureResult(measureResult);\n\n    // Step 3：根据当前视窗和 Step 2 保存的节点测量结果\n    // 进行计算流程，计算当前的布局，并保存。同时会记录上一次的布局信息\n    this.prevLayoutInfoResult = this.layoutInfoResult;\n    const layoutInfoResult = this.viewManager!.calculateExpectedLayoutInfo(view);\n    this.layoutInfoResult = layoutInfoResult;\n\n    // Step 4：输出管理器加载布局计算结果，输出管理器控制着最后的输出，只有加载测算结果才会影响输出\n    this.outputManager.loadCalculateLayoutInfo(layoutInfoResult);\n\n    // Step 5：更新虚拟化模型控制器中的当前可见节点，触发模型重算\n    const { visibles } = this.outputManager;\n    this.controller.setVirtualize('visibles', visibles.visibleBlockKeys);\n\n    // Step 6：刷新虚拟化结果，触发重渲\n    const virtualizeId = this.flushVirtualize(currentVirtualizeId);\n\n\n    if (visibles.visibleBlockKeys.length === 0) {\n      return;\n    }\n    // Step 7: 等待此次虚拟化结果重渲上屏\n    await waitForElementByAnimationFrame(`[data-virtualize-id=\"${virtualizeId}\"]`);\n\n    // Step 8: 为渲染上屏的节点添加 resizeObserver\n    this.viewManager!.addResizeObserverByKeys(visibles.visibleBlockKeys);\n\n    // Step 9: 测量渲染上屏的节点的高度并保存，结束\n    const nextMeasureResult = await this.viewManager!.measureBlocksByKeys(visibles.visibleBlockKeys);\n    this.nodeManager.loadMeasureResult(nextMeasureResult);\n  }\n\n  /**\n   * 虚拟化粒度最小的核心工作流，一般通过其他具体业务场景的工作流调用，也可以被循环调用\n   * 窗口滚动、滚动到节点、节点变化都依赖了次此工作流，initViewWorkflow 其实也可以复用，后续修改\n   * \n   * @param triggerReRenderActively 是否主动强制重渲\n   * @param measureOnly 只上屏并测量，不触发后续流程\n   * @param shouldAddLock 是否为流程设置 Busy 状态位\n   * @returns 保存后的虚拟化 id\n   */\n  private coreWorkflow = async (\n    triggerReRenderActively = true,\n    measureOnly = false,\n    shouldAddLock = false,\n  ): Promise<WorkflowResult> => {\n\n    // Step 1: 前置流程，递增 virtualizeId，检查是否状态忙，状态忙则终止流程\n    const currentVirtualizeId = this.virtualizeId + 1;\n    if (this.checkLocked(currentVirtualizeId)) {\n      return {\n        layoutInfoResult: null,\n        needToReRender: false,\n        needToStartNextWorkflow: false,\n      }\n    }\n\n    // Step 2：加载上一次的测算结果\n    // 上个流程测算结束后，测算结果会保存，但不会直接改变输出 (不会 load 进 OutputManager)\n    // 会简单判断是否需要开启下一个流程后，交给下一个虚拟化流程去重渲\n    this.outputManager.loadCalculateLayoutInfo(this.layoutInfoResult!);\n\n    const { afterPlaceholderHeight, beforePlaceholderHeight, visibles } = this.outputManager;\n    // Step 2.1：根据上一次的测算结果，改变虚拟化模型中的可见节点\n    this.controller.setVirtualize('visibles', visibles.visibleBlockKeys);\n\n    const { view } = this.controller;\n\n    // Step 3：根据上一次的测算结果（即将上屏的节点）和之前的测算结果（已经上屏的节点）\n    // 判断新增了哪些节点，稍后只测量新增的节点，以提高性能\n    const newBlockKeys = calculateBlockKeysNeedToMeasure(\n      view,\n      this.prevView,\n      this.layoutInfoResult!,\n      this.prevLayoutInfoResult,\n    );\n\n    // Step 4：根据传入参数，决定是否需要设置 busy 状态\n    if (shouldAddLock) {\n      this.lock(currentVirtualizeId);\n    }\n\n    // Step 5：保存新虚拟化 id；触发重渲，上屏根据上次测算结果得到的新节点\n    this.flushVirtualize(currentVirtualizeId, triggerReRenderActively);\n\n    // Step 6：等待重渲完毕，测量新上屏的节点并保存节点测量结果到 nodeManager\n    // 如果因为被其他流程覆盖等原因等不到此虚拟化 id，则放弃此流程\n    // 同时为新增的节点增加 resizeObserver\n    if (newBlockKeys.length > 0) {\n      try {\n        await waitForElementByAnimationFrame(`[data-virtualize-id=\"${currentVirtualizeId}\"]`);\n      } catch (e) {\n        this.unlock(currentVirtualizeId);\n        return {\n          layoutInfoResult: null,\n          needToReRender: false,\n          needToStartNextWorkflow: false,\n        };\n      }\n\n      this.viewManager!.addResizeObserverByKeys(newBlockKeys);\n      const nextMeasureResult = await this.viewManager!.measureBlocksByKeys(newBlockKeys);\n      this.nodeManager.loadMeasureResult(nextMeasureResult);\n    }\n\n    // Step 7：解除 busy 状态\n    this.unlock(currentVirtualizeId);\n\n    // 对只需要测量的流程，结束流程\n    if (measureOnly) {\n      return {\n        layoutInfoResult: null,\n        needToReRender: false,\n        needToStartNextWorkflow: false,\n      };\n    }\n\n    // Step 8：根据测量的结果，进行对布局的计算\n    const layoutInfoResult = this.viewManager!.calculateExpectedLayoutInfo(view);\n\n    // Step 9: 根据布局的结果，进行对节点详细布局情况和 placeholder 高度的计算\n    // 使用 precheckOutputByLayoutInfo 意味着这个计算结果不会影响最终输出，只供 Step 10 的判断\n    const {\n      afterPlaceholderHeight: newAfterPlaceholderHeight,\n      beforePlaceholderHeight: newBeforePlaceholderHeight,\n      visibles: newVisibles,\n    } = this.outputManager.precheckOutputByLayoutInfo(layoutInfoResult);\n\n    // Step 10: 根据 Step 9 的计算结果，判断是否要发起下一个虚拟化工作流，或者是否需要重渲 Placeholder\n    // 如果需要上屏的节点有变化，则需要发起下一个工作流，在下一个工作流中上屏这些节点（并测量与计算）\n    // 如果需要上屏的节点没有变化，但 Placeholder 高度发生了变化，直接触发重渲即可\n    let needToReRender = false;\n    let needToStartNextWorkflow = false;\n\n    // 节点还是那些老的，没有变化\n    if (equal(visibles, newVisibles)) {\n      // 但是 placeholder 高度有变化，要重渲\n      if (afterPlaceholderHeight !== newAfterPlaceholderHeight || beforePlaceholderHeight !== newBeforePlaceholderHeight) {\n        needToReRender = true;\n      }\n    // 出现新节点\n    } else {\n      needToReRender = true;\n      if (checkArrayAHasElementNotIncludedInArrayB(newVisibles.visibleBlockKeys, visibles.visibleBlockKeys)) {\n        needToStartNextWorkflow = true;\n      }\n    }\n\n    return {\n      layoutInfoResult,\n      needToReRender,\n      needToStartNextWorkflow,\n    };\n\n  }\n\n  /**\n   * 根据当前浏览器视口位置，决定需要渲染哪些节点，以及 Placeholder 需要渲染多高的工作流\n   * 浏览器的 scroll 事件会触发此工作流\n   * 这个工作流的特点是会递归调用自己，直到得到最终的结果\n   */\n  private workflowByCurrentViewPort = async () => {\n    const { view } = this.controller;\n\n    // Step 1: 根据当前视口情况，更新视口位置信息，根据视口位置信息和过去缓存的节点测量高度，算出一个新的布局结果\n    // 同时储存上一次计算的布局结果\n    this.prevLayoutInfoResult = this.layoutInfoResult;\n    this.viewManager!.updateViewPort();\n    this.layoutInfoResult = this.viewManager!.calculateExpectedLayoutInfo(view);\n\n    // Step 2: 执行 coreWorkflow，Step 1 中的新的布局结果会上屏并进行测算\n    // 根据新的测算结果，可能需要补充节点，或者剔除节点（needToStartNextWorkflow），出现这种情况需要发起下个工作流\n    // 根据新的测算结果，placeholder 高度也可能发生变化，需要重渲一下\n    const {\n      needToStartNextWorkflow,\n      needToReRender,\n      layoutInfoResult,\n    } = await this.coreWorkflow();\n\n    // Step 3: 根据新测算结果需要补充节点，或者剔除节点，则需要发起下一个工作流；\n    // Placeholder 有变化则需要 rerender 则重渲；\n    // 否则流程结束\n    if (needToStartNextWorkflow) {\n      await this.workflowByCurrentViewPort();\n    } else if (needToReRender) {\n      this.prevLayoutInfoResult = this.layoutInfoResult;\n      this.outputManager.loadCalculateLayoutInfo(layoutInfoResult!);\n      this.layoutInfoResult = layoutInfoResult!;\n\n      const { visibles } = this.outputManager;\n      this.controller.setVirtualize('visibles', visibles.visibleBlockKeys);\n\n      const newVirtualizeId = this.virtualizeId + 1;\n      this.flushVirtualize(newVirtualizeId);\n      return;\n    }\n  }\n\n  /**\n   * 根据指定的节点 index，跳转到此节点的工作流\n   * 供大纲等跳转场景使用\n   * @param nodeIndex Cangjie 节点在文档内的 index\n   */\n  public workflowToScrollToNode = async (nodeIndex: number) => {\n    const { view } = this.controller;\n    this.viewManager!.updateEditorContainerToScrollContainerDistance();\n\n    // Step 1：通过节点的 index，根据当前的测算结果，得到视口滚动到恰好显示此节点时，视口的 y 坐标\n    // 指定 y 坐标是本工作流与其他工作流最大的不同之处，上面的工作流是通过视口位置得到 y 坐标\n    const startY = this.viewManager!.calculateBlockStartYByBlockIndex(nodeIndex, view);\n    const { bufferStartY, bufferEndY, viewPortStartY } = this.viewManager!.calculateViewPort(startY);\n\n    // Step 2：假设视口滚动到此 y 坐标时，根据当前缓存的测算结果，计算布局信息\n    this.prevLayoutInfoResult = this.layoutInfoResult;\n    const layoutInfoResult = this.viewManager!.calculateExpectedLayoutInfo(view, bufferStartY, bufferEndY, viewPortStartY);\n    this.layoutInfoResult = layoutInfoResult;\n\n    // Step 3：发起 coreWorkflow，上屏布局信息中需要上屏的节点，并测量\n    await this.coreWorkflow(true, true, true);\n\n    // Step 4: 触发一次滚动，将视口滚动到指定 y 坐标处，此时浏览器会触发 scroll 时事件，引发 workflowByCurrentViewPort 工作流\n    this.viewManager!.scrollToNodeByIndex(nodeIndex, view);\n  }\n\n  /**\n   * 节点变化时触发的工作流\n   */\n  public workflowOnValueChange = async () => {\n    const prevView = this.prevView;\n    const currView = this.controller.view;\n    const view = this.controller.view;\n    const { startBlockOffset, startBlockKey, endBlockOffset } = this.outputManager;\n    const diffResult = fastDiffOnValueChange(prevView, currView, startBlockKey!, startBlockOffset, endBlockOffset);\n\n    if (diffResult.type === 'changed') {\n      // Step 1：如果 diff 发现节点发生了变化，且不是平移，会根据最新的 viewModel 和视口信息，以及之前缓存的测量结果，计算布局信息\n      this.prevLayoutInfoResult = this.layoutInfoResult;\n      const layoutInfoResult = this.viewManager!.calculateExpectedLayoutInfo(view);\n      this.layoutInfoResult = layoutInfoResult;\n\n      // Step 2: 发起 coreWorkflow，可能这里直接发起 workflowByCurrentViewPort 更好，后续修改\n      await this.coreWorkflow(false);\n    }\n\n    this.prevView = currView;\n  }\n\n  /**\n   * scroll 事件触发的工作流\n   */\n  private scrollHandler = () => {\n    this.workflowByCurrentViewPort();\n  }\n\n  /**\n   * resizeObserver 触发的工作流\n   * 节点高度变化时，会触发 resizeObserver 回调，这里检查发现高度确实变化了，则会触发后续工作流\n   * 详细注释后续再补充\n   */\n  private resizeHandler = async (entries: ResizeObserverEntry[]) => {\n    const { view } = this.controller;\n    const {\n      afterPlaceholderHeight,\n      beforePlaceholderHeight,\n      visibles,\n    } = this.outputManager;\n    const { visibleBlockKeys } = visibles;\n\n    const resizedNodeEntries = entries.filter((entry) => {\n      const { target, contentRect } = entry;\n      const key = target.getAttribute('data-cangjie-key');\n      const parent = view.getParent(key!);\n      if (!(parent && CDocument.isDocument(parent))) {\n        return false;\n      }\n      const hidden = (target as HTMLElement).style.display === 'none';\n      if (!key || !view.nodes.some(node => node.key === key)) {\n        return false;\n      }\n      if (hidden && !visibleBlockKeys.includes(key)) {\n        return false;\n      }\n      const nodeProp = this.nodeManager.getCachedBlockPropsByKey(key);\n      // 这里出于性能考虑暂不判断 marginTop 和 marginBottom\n      if (nodeProp?.height !== contentRect.height) {\n        return true;\n      }\n      return false;\n    });\n    const resizedBlockKeys = resizedNodeEntries.map((entry) => {\n      const { target } = entry;\n      return target.getAttribute('data-cangjie-key')!;\n    });\n\n    const nextMeasureResult = await this.viewManager!.measureBlocksByKeys(resizedBlockKeys);\n    this.nodeManager.loadMeasureResult(nextMeasureResult);\n\n    const layoutInfoResult = this.viewManager!.calculateExpectedLayoutInfo(view);\n\n    if (resizedBlockKeys.length > 0) {\n      const {\n        afterPlaceholderHeight: newAfterPlaceholderHeight,\n        beforePlaceholderHeight: newBeforePlaceholderHeight,\n        visibles: newVisibles,\n      } = this.outputManager.precheckOutputByLayoutInfo(layoutInfoResult);\n\n      let needToReRender = false;\n      let needToStartNextWorkflow = false;\n\n      if (equal(visibles, newVisibles)) {\n        // 还是老节点，但是 placeholder 要变\n        if (afterPlaceholderHeight !== newAfterPlaceholderHeight || beforePlaceholderHeight !== newBeforePlaceholderHeight) {\n          needToReRender = true;\n        }\n        // 根据新结果，应出现新节点，通常有个东西高度大幅缩小了\n      } else {\n        needToReRender = true;\n        if (checkArrayAHasElementNotIncludedInArrayB(newVisibles.visibleBlockKeys, visibles.visibleBlockKeys)) {\n          needToStartNextWorkflow = true;\n        }\n      }\n\n      if (needToStartNextWorkflow) {\n        this.workflowByCurrentViewPort();\n      } else if (needToReRender) {\n        this.prevLayoutInfoResult = this.layoutInfoResult;\n        this.outputManager.loadCalculateLayoutInfo(layoutInfoResult);\n        this.layoutInfoResult = layoutInfoResult;\n\n        const { visibles } = this.outputManager;\n        this.controller.setVirtualize('visibles', visibles.visibleBlockKeys);\n\n        const currentVirtualizeId = this.virtualizeId + 1;\n        this.flushVirtualize(currentVirtualizeId);\n      }\n    }\n  }\n}","import { omit } from 'lodash-es';\nimport Controller from '.';\nimport { GROUP_COLLAPSED_KEY } from '../constants';\nimport { OperationWithValue } from '../interfaces/controller';\nimport { Group, GroupWithKey } from '../interfaces/group';\nimport Element from '../models/element';\nimport { ReplaySubject } from '../models/observable';\nimport Operation, { OperationType } from '../models/operation';\nimport Node from '../models/node';\n\ntype Groups = Record<string, Group>;\n\n/**\n * 模型分组管理\n */\nclass GroupManager {\n  private groups: {\n    current: Groups;\n    prev: Groups;\n  } = {\n    current: {},\n    prev: {},\n  };\n\n  public groups$ = new ReplaySubject<typeof this.groups['current']>();\n\n  private controller: Controller;\n\n  private CACHE = {\n    NODE_GROUP: new Map<string, string>(),\n  };\n\n  constructor(controller: Controller) {\n    this.controller = controller;\n  }\n\n  /**\n   * 清理 group manager 内存占用\n   */\n  public cleanup() {\n    this.groups = { current: {}, prev: {} };\n    this.CACHE.NODE_GROUP.clear();\n  }\n\n  /**\n   * 获得指定 key 的分组\n   * @param key\n   * @returns\n   */\n  public getGroup(key: string) {\n    return this.groups.current[key];\n  }\n\n  /**\n   * 获得所有分组\n   * @returns\n   */\n  public getGroups() {\n    return this.groups.current;\n  }\n\n  /**\n   * 向订阅节点通知最新的分组信息\n   * @param force\n   * @returns\n   */\n  public notifyNewGroups(force = false): this {\n    if (force || this.groups.current !== this.groups.prev) {\n      this.groups.prev = this.groups.current;\n      this.groups$.next(this.groups.current);\n    }\n    return this;\n  }\n\n  /**\n   * 设置分组数据\n   * @param key\n   * @param data\n   * @returns\n   */\n  public setGroupData<T = {}>(key: string, data: T) {\n    const group = this.getGroup(key);\n    this.groups.current = {\n      ...this.groups.current,\n      [key]: {\n        ...group,\n        data: {\n          ...data,\n          [GROUP_COLLAPSED_KEY]: group.data[GROUP_COLLAPSED_KEY],\n        },\n      },\n    };\n    this.notifyNewGroups();\n    return this;\n  }\n\n  /**\n   * 融合分组数据\n   * @param key\n   * @param data\n   * @returns\n   */\n  public mergeGroupData<T = {}>(key: string, data: Partial<T>) {\n    const group = this.getGroup(key);\n    this.groups.current = {\n      ...this.groups.current,\n      [key]: { ...group, data: { ...group.data, ...data } },\n    };\n    this.notifyNewGroups();\n    return this;\n  }\n\n  /**\n   * 生成全文所有的 Groups\n   */\n  public generateAllGroups(): this {\n    this.controller.value.document.forEachDescendant((node) => {\n      if (node.isElement()) {\n        this.generateGroup(node);\n      }\n    });\n    return this;\n  }\n\n  public initGroups(groups: Groups): this {\n    if (groups) {\n      this.groups.current = groups;\n      this.groups.prev = groups;\n    }\n    return this;\n  }\n\n  /**\n   * 获得节点所在的分组序列\n   * @param node\n   * @returns\n   */\n  public getNodeGroups(node: Element): GroupWithKey[] {\n    const { document } = this.controller.value;\n    const groups: GroupWithKey[] = [];\n    const elementGroup = this.getGroup(node.key);\n    if (elementGroup) {\n      groups.push({ key: node.key, ...elementGroup });\n    }\n    let groupKey = this.CACHE.NODE_GROUP.get(node.key);\n    while (groupKey !== undefined) {\n      const group = this.getGroup(groupKey);\n      if (group) {\n        groups.push({ key: groupKey, ...group });\n      }\n      let groupElement = document.getNode(groupKey);\n      if (!groupElement) {\n        break;\n      }\n\n      groupKey = this.CACHE.NODE_GROUP.get(groupElement.key);\n      while (\n        groupKey === undefined &&\n        groupElement &&\n        groupElement !== document\n      ) {\n        const parent = document.assertParent(groupElement.key);\n        groupKey = this.CACHE.NODE_GROUP.get(parent.key);\n        groupElement = parent;\n      }\n    }\n    return groups;\n  }\n\n  /**\n   * 针对特殊变更，重新分组\n   * @param operationWithValue\n   */\n  public regenerateGroup(\n    operationWithValue: OperationWithValue & { operation: Operation },\n  ): this {\n    const { operation, value, newValue } = operationWithValue;\n    if (\n      operation.type === OperationType.RemoveNode &&\n      operation.node.isElement()\n    ) {\n      const prevGroup = this.getGroup(operation.node.key);\n      // 节点删除后，对应删除其分组\n      this.removeGroup(operation.node.key);\n      // 从删除节点前一个节点开始重新分组\n      this.regenerateGroupFrom(\n        value.document.getPreviousSibling(operation.node.key),\n        prevGroup?.data[GROUP_COLLAPSED_KEY] || false,\n      );\n    } else if (\n      operation.type === OperationType.InsertNode &&\n      operation.node.isElement()\n    ) {\n      const node = newValue.document.assertNodeByPath(operation.path);\n      const prevNode = newValue.document.getPreviousSibling(node.key);\n      const prevGroup = prevNode && this.getGroup(prevNode.key);\n      // 从当前重新节点进行分组\n      this.regenerateGroupFrom(\n        operation.node,\n        prevGroup?.data[GROUP_COLLAPSED_KEY] || false,\n      );\n      // 对新插入节点的子节点进行分组\n      operation.node.forEachDescendant((n) => {\n        if (n.isElement()) {\n          this.generateGroup(n, prevGroup?.data[GROUP_COLLAPSED_KEY] || false);\n        }\n      });\n    } else if (operation.type === OperationType.SetNode) {\n      // 删除节点原来的分组\n      const node = newValue.document.assertNodeByPath(operation.path);\n      const oldNode = value.document.assertNodeByPath(operation.path);\n      const prevGroup = this.getGroup(node.key);\n      const prevOldGroup = this.getGroup(oldNode.key);\n      this.removeGroup(node.key);\n      // 从当前节点开始，重新分组\n      this.regenerateGroupFrom(\n        node,\n        prevGroup?.data[GROUP_COLLAPSED_KEY] || false,\n      );\n    } else if (operation.type === OperationType.MergeNode) {\n      const node = value.document.assertNodeByPath(operation.path);\n      const prevGroup = this.getGroup(node.key);\n      if (node.isElement()) {\n        // 删除节点所在分组\n        this.removeGroup(node.key);\n        // 从合并到的节点开始重新分组\n        this.regenerateGroupFrom(\n          newValue.document.getPreviousSiblingByPath(operation.path),\n          prevGroup?.data[GROUP_COLLAPSED_KEY] || false\n        );\n      }\n    } else if (operation.type === OperationType.SplitNode) {\n      const node = value.document.assertNodeByPath(operation.path);\n      if (node.isElement()) {\n        const prevGroup = this.getGroup(node.key);\n        // 删除节点所在分组\n        this.removeGroup(node.key);\n        // 从合并到的节点开始重新分组\n        this.regenerateGroupFrom(\n          newValue.document.getNextSiblingByPath(operation.path),\n          prevGroup?.data[GROUP_COLLAPSED_KEY] || false\n        );\n      }\n    } else if (operation.type === OperationType.MoveNode) {\n      // 从移动起点开始重新分组\n      const node = value.document.assertNodeByPath(operation.path);\n      this.regenerateGroupFrom(value.document.getPreviousSibling(node.key));\n      // 从移动终点开始重新分组\n      this.regenerateGroupFrom(node);\n    }\n    return this;\n  }\n\n  private removeGroup(key: string | null) {\n    if (!key) {\n      return this;\n    }\n    this.groups.current = omit(this.groups.current, key);\n    this.CACHE.NODE_GROUP.delete(key);\n    return this;\n  }\n\n  private generateGroup(element: Element, isCollapsed = false) {\n    const group = this.controller.run('generateGroup', element);\n    const currentGroup = this.getGroup(element.key);\n    // 如果分组已经不存在，则分组列表中丢弃该分组\n    if (!group && currentGroup) {\n      this.groups.current = omit(this.groups.current, element.key);\n    }\n    // 若产生了新的分组，则添加该分组\n    else if (group) {\n      // 如果分组类型变更，则新建分组\n      if (currentGroup?.type !== group.type) {\n        this.groups.current = {\n          ...this.groups.current,\n          [element.key]: {\n            ...group,\n            data: { ...group.data, [GROUP_COLLAPSED_KEY]: isCollapsed },\n          },\n        };\n      }\n      const nodesInGroup = this.getNodesInGroup(\n        element,\n        this.getGroup(element.key),\n      );\n      nodesInGroup.forEach((n) => {\n        this.CACHE.NODE_GROUP.set(n.key, element.key);\n      });\n    }\n    return this;\n  }\n\n  private getNodesInGroup(node: Element, group: Group) {\n    const { document } = this.controller.value;\n    let next = document.getNextSibling(node.key);\n    const nodes: Element[] = [];\n    const groups = [group];\n    let closestGroup: Group | undefined = group;\n    while (next && next.isElement() && closestGroup) {\n      const isElementInGroup = this.controller.query(\n        'isElementInGroup',\n        next,\n        closestGroup,\n      );\n      if (isElementInGroup !== false) {\n        if (closestGroup === group) {\n          nodes.push(next);\n        }\n      } else {\n        groups.pop();\n        closestGroup = groups[groups.length - 1];\n        continue;\n      }\n\n      const maybeGroup = this.getGroup(next.key);\n      if (maybeGroup) {\n        groups.push(maybeGroup);\n        closestGroup = maybeGroup;\n      }\n\n      next = document.getNextSibling(next.key);\n    }\n    return nodes;\n  }\n\n  private regenerateGroupFrom(node: Node | null, isCollapsed = false): this {\n    if (!node || !node.isElement()) {\n      return this;\n    }\n\n    const { document } = this.controller.value;\n    // 对变更节点所在的前序分组进行重新分组\n    while (node) {\n      this.generateGroup(node as Element, isCollapsed);\n      node = document.getPreviousSibling(node.key);\n    }\n    return this;\n  }\n}\n\nexport default GroupManager;\n","import { takeWhile, takeRightWhile } from 'lodash-es';\nimport Document from '../models/document';\nimport Element from '../models/element';\n\n/**\n * 获得不可见节点序列，按照距离可见节点的次序排序\n *\n * ```ts\n * // document.nodes: ['1', '2', '3', '4', '5', '6', '7'];\n *\n * const invisibles = getInvisibles(document, ['3', '4']);\n * // invisibles: ['7', '6', '1', '5',  '2']\n * ```\n * @param document\n * @param visibles\n * @returns\n */\nexport function getInsivibleNodes(\n  document: Document,\n  visibles: string[],\n): Element[] {\n  if (!visibles.length) {\n    return [];\n  }\n  const invisibles: Element[] = [];\n  const start = visibles[0];\n  const end = visibles[visibles.length - 1];\n  const topHalfInvisibles = takeWhile(document.nodes, (n) => n.key !== start);\n  const bottomHalfInvisibles = takeRightWhile(\n    document.nodes,\n    (n) => n.key !== end,\n  ).reverse();\n  while (topHalfInvisibles.length || bottomHalfInvisibles.length) {\n    if (topHalfInvisibles.length) {\n      invisibles.push(topHalfInvisibles.pop()!);\n    }\n    if (bottomHalfInvisibles.length) {\n      invisibles.push(bottomHalfInvisibles.pop()!);\n    }\n  }\n\n  return invisibles.reverse();\n}\n","import {\n  JsonMLWithAttrs,\n  JsonMLWithoutAttrs,\n  JsonML,\n} from '../type';\nimport createTextWithString from './createTextWithString';\n\nexport type {\n  JsonMLWithAttrs,\n  JsonMLWithoutAttrs,\n  JsonML,\n}\n\ninterface DescInputOption {\n  maxParagraph?: number;\n  ignore?: string[];\n}\n\nexport function jsonMLGetDescription(asl: JsonML, options?: DescInputOption): JsonML {\n  // 仅最外层会用到currParagraph\n  let currParagraph: number | null = asl[0] === 'root' ? 0 : null;\n  const children = jsonMLGetChildren(asl);\n  const validChildren: JsonML[] = [];\n\n  if (!Array.isArray(children)) {\n    return asl;\n  }\n\n  for (const childAsl of children) {\n    if (typeof currParagraph === 'number') {\n      currParagraph++;\n      if (options && typeof options.maxParagraph === 'number'\n        && currParagraph > options.maxParagraph) {\n        break;\n      }\n    }\n    if (!(options && Array.isArray(options.ignore)\n      && options.ignore.includes(childAsl[0]))) {\n      validChildren.push(jsonMLGetDescription(childAsl, options));\n    }\n  }\n  return [...jsonMLGetTagNameAndAttributes(asl), ...validChildren] as any as JsonML;\n}\n\nexport function jsonMLGetTagName(elem: JsonML) {\n  return elem[0] || '';\n}\n\nfunction isElement(maybeElem: any) {\n  return (Array.isArray(maybeElem) && typeof maybeElem[0] === 'string')\n    || typeof maybeElem === 'string';\n}\n\nfunction isAttributes(maybeAttrs: any) {\n  return !!maybeAttrs && typeof maybeAttrs === 'object' && !Array.isArray(maybeAttrs);\n}\n\nexport function jsonMLGetLastChild(node: JsonML): JsonML | null {\n  const children = jsonMLGetChildren(node);\n  return children.length ? children[children.length - 1] : null;\n}\n\nexport function JsonMLHasAttributes(maybeElem: any): maybeElem is JsonMLWithAttrs {\n  return isElement(maybeElem) && isAttributes(maybeElem[1]);\n}\n\nexport function jsonMLGetAttributes<T = any>(elem: JsonML): T | null {\n  return JsonMLHasAttributes(elem) ? elem[1] as unknown as T : null;\n}\n\nfunction jsonMLGetTagNameAndAttributes(elem: JsonML) {\n  return (JsonMLHasAttributes(elem) ? elem.slice(0, 2) : elem.slice(0, 1)) as JsonML[];\n}\n\nexport function jsonMLGetChildren(elem: JsonML): JsonML[] {\n  return (JsonMLHasAttributes(elem) ? elem.slice(2) : elem.slice(1)) as JsonML[];\n}\n\nexport function jsonMLAppend(elem: JsonML, ...children: JsonML[]): JsonML {\n  return [...elem.slice(0), ...children.slice(0)] as unknown as JsonML;\n}\n\nexport function jsonMLAppendAt(elem: JsonML, index: number, ...children: JsonML[]): JsonML {\n  const meta = JsonMLHasAttributes(elem) ? elem.slice(0, 2) : elem.slice(0, 1);\n  const ch = jsonMLGetChildren(elem);\n  ch.splice(index, 0, ...children);\n  return [...meta, ...ch] as unknown as JsonML;\n}\n\nexport function jsonMLIsEmptyContent(content: JsonML): boolean {\n  const children = jsonMLGetChildren(content);\n  if (children.length > 1) {\n    return false;\n  }\n\n  const child = children[0];\n  if (!child) {\n    return true;\n  }\n\n  if (jsonMLGetTagName(child) !== 'p') {\n    return false;\n  }\n\n  const grandChildren = jsonMLGetChildren(child);\n  if (grandChildren.length > 1) {\n    return false;\n  }\n\n  const grandChild = grandChildren[0];\n  const grandChildAttrs = jsonMLGetAttributes(grandChild);\n  if (grandChildAttrs && grandChildAttrs['data-type'] !== 'text') {\n    return false;\n  }\n\n  const grandGrandChildren = jsonMLGetChildren(grandChild);\n  if (grandGrandChildren.length > 1) {\n    return false;\n  }\n\n  const grandGrandChild = grandGrandChildren[0];\n  if (grandGrandChild) {\n    const grandGrandChildAttrs = jsonMLGetAttributes(grandGrandChild);\n    if (grandGrandChildAttrs && grandGrandChildAttrs['data-type'] !== 'leaf') {\n      return false;\n    }\n\n    if (jsonMLGetChildren(grandGrandChild).join('')) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/**\n * 读取 asl 中的纯文本（leaf 节点）\n * @param jsonML\n */\nexport function jsonMLGetText(jsonML: JsonML): string {\n  // 如果当前节点是叶子节点，则直接返回字符串\n  const attrs = jsonMLGetAttributes(jsonML);\n  if (attrs && attrs['data-type'] === 'leaf') {\n    return jsonML[2] as string || '';\n  }\n  // 遍历孩子节点\n  const children = jsonMLGetChildren(jsonML);\n  return children.reduce((text, child) => {\n    return text + jsonMLGetText(child);\n  }, '');\n}\n\nexport function jsonMLIsText(node: JsonML): boolean {\n  return (\n    jsonMLGetTagName(node) === 'span' && jsonMLGetAttributes(node)?.['data-type'] === 'text'\n  );\n}\n","import { Text, Node, Inline, Block, Element, Document } from '../../';\nimport type { JsonML } from '../type';\nimport { jsonMLGetAttributes, jsonMLGetTagName } from './jsonml';\n\n/* *************************************\n *             JsonML Type\n ************************************** */\n\nexport function isTextJsonML(node: JsonML): boolean {\n  const tag = jsonMLGetTagName(node);\n  const attrs = jsonMLGetAttributes(node);\n  return tag === 'span' && !!attrs && attrs['data-type'] === 'text';\n}\n\nexport function isInlineJsonML(node: JsonML): boolean {\n  const tagName = jsonMLGetTagName(node);\n  return tagName === 'a' || tagName === 'img';\n}\n\n/* *************************************\n *             Value Type\n ************************************** */\n\nexport function isTextValue(node: Node): node is Text {\n  return Text.isText(node);\n}\n\nexport function isElementValue(node: Node): node is Element {\n  return Element.isElement(node);\n}\n\nexport function isInlineValue(node: Node): node is Inline {\n  return Inline.isInline(node);\n}\n\nexport function isBlockValue(node: Node): node is Block {\n  return Block.isBlock(node);\n}\n\nexport function isDocumentValue(node: Node): node is Document {\n  return Document.isDocument(node);\n}\n","import { camelCase, trim } from 'lodash-es';\n\n/**\n * @export\n * @param {NamedNodeMap} attrs\n * @description 将 Node 节点的 attributes 属性转成 JSON 对象\n */\nexport function nodeMapToObject(attrs: NamedNodeMap) {\n  const obj: Record<string, any> = {\n    styleObj: {},\n  };\n  for (let i = attrs.length - 1; i >= 0; i--) {\n    if (attrs[i].value !== '') {\n      obj[attrs[i].name] = attrs[i].value;\n    }\n  }\n  return obj;\n}\n\n/**\n * @export\n * @param {string} [styleStr='']\n * @return {*}  {Partial<CSSStyleDeclaration>}\n * @description 将 inlineStyle 字符串转为 驼峰格式的 JSON 对象\n */\nexport function toStyleObject(styleStr = ''): Partial<CSSStyleDeclaration> {\n  if (!styleStr) {\n    return {};\n  }\n\n  const output: Partial<CSSStyleDeclaration> = {};\n  const style = styleStr.split(';');\n  for (let i = style.length - 1; i >= 0; i--) {\n    const rule = style[i];\n    if (rule) {\n      const kv = rule.split(':');\n      output[camelCase(trim(kv[0] || '')) as any] = trim(kv[1] || '');\n    }\n  }\n  return output;\n}\n\n/**\n * @export\n * @param {string} str\n * @return {*}\n */\nexport function normalizeSpacesInHTML(str: string) {\n  return str.replace(/\\s*\\n\\s*/g, '');\n}\n","import { JsonML } from '../type';\n\nexport default function createTextWithString(text: string): JsonML {\n  return [\n    'span',\n    { 'data-type': 'text' },\n    ['span', { 'data-type': 'leaf' }, text],\n  ] as JsonML;\n}\n\nexport const createEmptyText = () => createTextWithString('');\n","import { JsonML } from '../type';\nimport createTextWithString from './createTextWithString';\n\nexport default function createEmptyParagraph(type = 'p'): JsonML {\n  return [type, createTextWithString('')];\n}\n","import { Controller, Value, Schema } from '../../';\nimport { jsonMLGetChildren, jsonMLAppend } from '../utils/jsonml';\nimport createJsonMLToNode from './jsonMLToNode';\nimport { isDocumentValue } from '../utils';\nimport type { JsonMLToValueOptions, JsonML } from '../type';\nimport createEmptyParagraph from '../utils/createEmptyParagraph';\n\nexport default function createJsonMLToValue(\n  jsonMLToNode: ReturnType<typeof createJsonMLToNode>,\n  strictSchema: Schema,\n) {\n  /**\n   * 序列化整个 ASL 文档\n   * @param jsonML content ASL\n   * @param options 序列化参数\n   */\n  function jsonMLToValue(jsonML: JsonML, options: JsonMLToValueOptions = {}): Value {\n    const children = jsonMLGetChildren(jsonML);\n    let newJsonML = jsonML;\n    if (!(children && children.length > 0)) {\n      newJsonML = jsonMLAppend(jsonML, createEmptyParagraph());\n    }\n\n    const document = jsonMLToNode(newJsonML);\n    // 非 document 节点直接抛错\n    if (!isDocumentValue(document)) {\n      throw new Error(`Invalid jsonML, expect a document at the root of jsonML, but received ${JSON.stringify(jsonML, null, 2)}`);\n    }\n\n    const value = Value.create({\n      document,\n    });\n\n    const { normalize = true, strict = false } = options;\n    const toNormalize = normalize || strict;\n    if (!toNormalize) return value;\n\n    // 加载一个 scheme plugin 对 value 进行 normalize\n    const schemaPlugin = strict ? [{ schema: strictSchema, models: [] }] : [];\n    const controller = Controller.create({ value, plugins: schemaPlugin });\n    return controller.value;\n  }\n\n  return jsonMLToValue;\n}\n","import type { Value } from '../../';\nimport type { JsonML } from '../type';\nimport createNodeToJsonML, { createAsyncNodeToJsonML } from './nodeToJsonML';\n\n\nexport function createAsyncValueToJsonML(asyncNodeToJsonML: ReturnType<typeof createAsyncNodeToJsonML>) {\n  /**\n   * 序列化 value to ASL\n   * @param value\n   */\n  async function valueToJsonML(value: Value) {\n    return asyncNodeToJsonML(value.document);\n  }\n\n  return valueToJsonML;\n}\n\nexport default function createValueToJsonML(nodeToJsonML: ReturnType<typeof createNodeToJsonML>) {\n  /**\n   * 序列化 value to ASL\n   * @param value\n   */\n  function valueToJsonML(value: Value): JsonML {\n    return nodeToJsonML(value.document);\n  }\n\n  return valueToJsonML;\n}\n","import type { Node } from '../../';\nimport { jsonMLGetChildren } from '../utils/jsonml';\nimport type { MoSerializationPlugin, JsonML } from '../type';\nimport { isElementValue } from '../utils';\n\nexport default function createJsonMLToNode(plugins: MoSerializationPlugin[]) {\n  const rules = plugins\n    .map((plugin) => plugin.jsonMLToValue!)\n    .filter((rule) => !!rule);\n\n  return function jsonMLToNode(jsonML: JsonML, parent?: JsonML): Node {\n    const rule = rules.find((r) => r.match(jsonML, parent));\n    if (!rule) {\n      throw new Error(`Cannot find any rule which match ${JSON.stringify(jsonML, null, 2)}`);\n    }\n\n    let node = rule.convert(jsonML, parent);\n\n    // Only element value has nodes children\n    if (isElementValue(node)) {\n      const children = jsonMLGetChildren(jsonML);\n      node = node.merge({ nodes: children.map((c) => jsonMLToNode(c, jsonML)) });\n    }\n\n    node = rule.decorate ? rule.decorate(node) : node;\n\n    return node;\n  };\n}\n","import { Node, environment } from '../../';\nimport { jsonMLAppend } from '../utils/jsonml';\nimport type { MoSerializationPlugin, JsonML } from '../type';\nimport { isElementValue } from '../utils';\n\nfunction safeAppend(elem: JsonML, children: JsonML[]) {\n  // BACKGROUND: Safari 下，`...children` 结果可能出现 null child\n  if (environment.IS_SAFARI) {\n    return (elem.slice(0).concat(children.slice(0)) as unknown) as JsonML;\n  }\n  return jsonMLAppend(elem, ...children);\n}\n\nexport function createAsyncNodeToJsonML(plugins: MoSerializationPlugin[]) {\n  const rules = plugins\n    .map((plugin) => plugin.valueToJsonML!)\n    .filter((rule) => !!rule);\n\n  /**\n   * 序列化 node to jsonML\n   * @param node\n   */\n  async function nodeToJsonML(node: Node): Promise<JsonML> {\n    const rule = rules.find((r) => r.match(node));\n    if (!rule) {\n      const { klass, type } = node.toJSON();\n      throw new Error(\n        `Cannot find any rule which match ${JSON.stringify({ klass, type })}`,\n      );\n    }\n\n    const decorated = rule.decorate ? rule.decorate(node) : node;\n    let jsonML: JsonML | undefined;\n    if (rule.asyncConvert) {\n      jsonML = await rule.asyncConvert(decorated);\n    } else {\n      jsonML = rule.convert(decorated);\n    }\n\n    if (!jsonML) {\n      const { klass, type } = node.toJSON();\n      throw new Error(\n        `Invalid JsonML! JsonML is ${JSON.stringify({ klass, type })}`,\n      );\n    }\n\n    // Only element value has nodes children\n    if (isElementValue(decorated)) {\n      const children = await Promise.all(decorated.nodes.map((child) => nodeToJsonML(child)));\n      return safeAppend(jsonML, children);\n    }\n\n    return jsonML;\n  }\n\n  return nodeToJsonML;\n}\n\nexport default function createNodeToJsonML(plugins: MoSerializationPlugin[]) {\n  const rules = plugins\n    .map((plugin) => plugin.valueToJsonML!)\n    .filter((rule) => !!rule);\n\n  /**\n   * 序列化 node to jsonML\n   * @param node\n   */\n  function nodeToJsonML(node: Node): JsonML {\n    const rule = rules.find((r) => r.match(node));\n    if (!rule) {\n      const { klass, type } = node.toJSON();\n      throw new Error(\n        `Cannot find any rule which match ${JSON.stringify({ klass, type })}`,\n      );\n    }\n\n    const decorated = rule.decorate ? rule.decorate(node) : node;\n    const jsonML = rule.convert(decorated);\n\n    if (!jsonML) {\n      const { klass, type } = node.toJSON();\n      throw new Error(\n        `Invalid JsonML! JsonML is ${JSON.stringify({ klass, type })}`,\n      );\n    }\n\n    // Only element value has nodes children\n    if (isElementValue(decorated)) {\n      const children = decorated.nodes.map((child) => nodeToJsonML(child));\n      return safeAppend(jsonML, children);\n    }\n\n    return jsonML;\n  }\n\n  return nodeToJsonML;\n}\n","import { v1 as uuidv1 } from 'uuid';\nimport { nodeMapToObject, normalizeSpacesInHTML } from '../../utils/parseHtml';\nimport type State from './State';\nimport type { ParserOptions } from '../../type';\n\ninterface IHtmlParserProps {\n  onOpenTag: Function;\n  onText: Function;\n  onCloseTag: Function;\n}\n\nconst MeasureStyle: any = {\n  left: '-999px',\n  position: 'absolute',\n  visibility: 'hidden',\n  whiteSpace: 'nowrap',\n  zIndex: -999,\n};\n\nexport const createIframe = () => {\n  const iframe = document.createElement('iframe');\n  for (const type in MeasureStyle) {\n    iframe.style[type] = MeasureStyle[type];\n  }\n  // 开启沙盒模式，防止 xss 攻击\n  iframe.setAttribute('sandbox', 'allow-same-origin');\n  return iframe;\n}\n\nclass DomParser {\n  private readonly domParser = new DOMParser();\n\n  private doc?: Document | null;\n\n  private readonly skipTags = ['HEAD', 'STYLE'];\n\n  private state?: State;\n\n  private onOpenTag?: Function | null;\n\n  private onText?: Function | null;\n\n  private onCloseTag?: Function | null;\n\n  private iframe = createIframe();\n\n  init = (callback: IHtmlParserProps, options: ParserOptions) => {\n    const { onOpenTag, onText, onCloseTag } = callback;\n    this.onOpenTag = onOpenTag;\n    this.onText = onText;\n    this.onCloseTag = onCloseTag;\n    this.state = options.state;\n  };\n\n  write = (chunk: string) => {\n    document.body.appendChild(this.iframe!);\n    this.doc = this.iframe!.contentDocument as Document;\n    if (this.doc.body) {\n      this.doc.body.innerHTML = chunk;\n    }\n    if (this.state) {\n      this.state.htmlDom = this.doc.body;\n    }\n    this.traverse(this.doc.body);\n\n    document.body.removeChild(this.iframe!);\n\n  };\n\n  end = () => {\n    this.doc = null;\n    this.onOpenTag = null;\n    this.onText = null;\n    this.onCloseTag = null;\n  };\n\n  private readonly traverse = (node: Node) => {\n    if (!this.onText || !this.onOpenTag || !this.onCloseTag) {\n      return;\n    }\n    if (node.nodeType === Node.TEXT_NODE) {\n      if (node.textContent && normalizeSpacesInHTML(node.textContent)) {\n        this.onText(node.textContent);\n      }\n      return;\n    }\n    if (\n      [\n        Node.ELEMENT_NODE,\n        Node.DOCUMENT_NODE,\n        Node.DOCUMENT_FRAGMENT_NODE,\n      ].includes(node.nodeType)\n    ) {\n      const { tagName: originTagName, attributes } = node as HTMLElement;\n      if (this.skipTags.includes(originTagName)) {\n        return;\n      }\n      const traverseChildNodes = () => {\n        Array.from(node.childNodes || []).forEach((child) => {\n          this.traverse(child);\n        });\n      };\n      if (originTagName) {\n        const tagName = originTagName.toLowerCase();\n        const attrs = nodeMapToObject(attributes);\n        const element = node as HTMLElement;\n        attrs.styleObj = window.getComputedStyle(element);\n        const id = uuidv1();\n        if (this.state) {\n          this.state.currentDom = element;\n        }\n        this.onOpenTag(tagName, attrs, id);\n        traverseChildNodes();\n        this.onCloseTag(tagName, attrs, id);\n      } else {\n        traverseChildNodes();\n      }\n    }\n  };\n}\n\nexport default DomParser;\n","import {\n  jsonMLGetTagName,\n} from '../../utils/jsonml';\n\nimport type { JsonML } from '../../type';\n\nexport default class State {\n  private readonly root: JsonML = ['root'];\n\n  private current: JsonML = this.root;\n\n  private readonly stack: JsonML[] = [];\n\n  private marksList: Array<Record<string, any>> = [];\n\n  private readonly listsList: string[] = [];\n\n  htmlDom!: Element;\n\n  currentDom?: HTMLElement;\n\n  currentListId: string | null = null;\n\n  // 这里用于记录zhi渲染的list的level, TODO 需要和getListLevel统一\n  currentListLevel: number | null = null;\n\n  constructor(props: {\n    htmlDom?: Element;\n  }) {\n    if (props.htmlDom) {\n      this.htmlDom = props.htmlDom;\n    }\n  }\n\n  addMarks(marks: Record<string, any>): void {\n    this.marksList.push(marks);\n  }\n\n  removeMarks(marks: Record<string, any>): void {\n    this.marksList = this.marksList.filter((m) => m.id !== marks.id);\n  }\n\n  getMarks(): Record<string, any> {\n    return this.marksList.reduce<Record<string, any>>(\n      (attrs, marks: Record<string, any>) => ({\n        ...attrs,\n        ...marks.value,\n      }),\n      {},\n    );\n  }\n\n  wrapList(type: string): void {\n    this.listsList.push(type);\n  }\n\n  unwrapList(): void {\n    this.listsList.pop();\n  }\n\n  isParentOrderedList(): boolean {\n    return this.listsList[this.listsList.length - 1] === 'ordered-list';\n  }\n\n  getListItemLevel(): number {\n    return this.listsList.length - 1;\n  }\n\n  append(...nodes: JsonML[]): void {\n    nodes.forEach((node: JsonML): void => {\n      this.current.push(node);\n    });\n  }\n\n  push(node: JsonML): void {\n    this.stack.push(this.current);\n    this.current = node;\n  }\n\n  pop(): JsonML {\n    const node = this.current;\n    this.current = this.stack.pop() || this.root;\n    return node;\n  }\n\n  peek(): JsonML {\n    return this.current;\n  }\n\n  closest(type: string): JsonML | null {\n    if (jsonMLGetTagName(this.current) === type) {\n      return this.current;\n    }\n\n    for (let i = this.stack.length - 1; i >= 0; i -= 1) {\n      if (jsonMLGetTagName(this.stack[i]) === type) {\n        return this.stack[i];\n      }\n    }\n    return null;\n  }\n\n  isStackEmpty() {\n    return this.stack.length === 0;\n  }\n\n  getParent(): JsonML | null {\n    return this.stack.length > 0 ? this.stack[this.stack.length - 1] : null;\n  }\n\n  getJsonML(): JsonML {\n    return this.root;\n  }\n}\n","/* eslint-disable guard-for-in */\n/* eslint-disable @typescript-eslint/member-ordering */\nimport DomParser, { createIframe } from './DomParser';\nimport State from './State';\nimport type { MoSerializationPlugin, MoHtmlParser, JsonML } from '../../type';\n\ntype Event = 'onOpenTag' | 'onText' | 'onCloseTag';\nconst MeasureStyle: any = {\n  left: '-999px',\n  position: 'absolute',\n  visibility: 'hidden',\n  whiteSpace: 'nowrap',\n  zIndex: -999,\n};\n\nexport default class Deserializer {\n  private readonly plugins: MoSerializationPlugin[];\n  private readonly htmlFrom: string;\n  private readonly parser: MoHtmlParser;\n  private iframe = createIframe();\n\n  constructor(options: Record<string, any>) {\n    this.plugins = options.plugins;\n    this.htmlFrom = options.htmlFrom;\n    this.parser = options.parser || new DomParser();\n  }\n\n  private isDomParser() {\n    return this.parser instanceof DomParser\n  }\n\n  deserialize(html: string, configs: Record<string, any> = {}): JsonML {\n    const state = new State({ });\n\n    if (!this.isDomParser()) {\n      document.body.appendChild(this.iframe!);\n      const { body: htmlDom } = this.iframe!.contentDocument as Document;\n      if (htmlDom) {\n        htmlDom.innerHTML = html;\n      }\n      state.htmlDom = htmlDom;\n    }    \n\n    let rules = this.plugins\n      .map((plugin) => {\n        const { htmlToJsonML } = plugin;\n        if (htmlToJsonML) {\n          return typeof htmlToJsonML === 'function'\n            ? htmlToJsonML(this.htmlFrom)\n            : htmlToJsonML;\n        }\n        return null;\n      })\n      .filter((rule) => !!rule);\n\n    rules = rules.map((rule) => {\n      if (!!rule!.name && rule!.name in configs) {\n        rule = {\n          ...rule,\n          ...configs[rule!.name],\n        };\n      }\n      return rule;\n    });\n\n    function onEvent(event: Event, ...args: any[]): void {\n      for (let i = 0; i < rules.length; i += 1) {\n        const rule = rules[i]![event];\n        if (!rule) {\n          continue; // eslint-disable-line no-continue\n        }\n        // @ts-ignore\n        const ok = rule(state, ...args);\n        if (ok) break;\n      }\n    }\n\n    this.parser.init(\n      {\n        onOpenTag(...args: any[]) {\n          onEvent('onOpenTag', ...args);\n        },\n        onText(...args: any[]) {\n          onEvent('onText', ...args);\n        },\n        onCloseTag(...args: any[]) {\n          onEvent('onCloseTag', ...args);\n        },\n      },\n      {\n        decodeEntities: true,\n        state,\n      },\n    );\n    this.parser.write(html);\n    this.parser.end();\n    if (!this.isDomParser()) {\n      document.body.removeChild(this.iframe!);\n    }\n    return state.getJsonML();\n  }\n}\n","export const MS_WORD = 'MS_WORD';\nexport const MS_EXCEL = 'MS_EXCEL';\n// word、excel 以外的 office\nexport const MS_OFFICE = 'MS_OFFICE';\nexport const MS_OFFICES = [MS_WORD, MS_EXCEL, MS_OFFICE];\nexport const YUQUE = 'YUQUE';\n\n// 以下复制来源，保留所有样式\nexport const REMAIN_STYLE_SOURCES = [MS_WORD, MS_EXCEL, MS_OFFICE, YUQUE];\n\nexport function isMicrosoftWord(html: string): boolean {\n  return Boolean(\n    html?.includes('xmlns:w=\"urn:schemas-microsoft-com:office:word\"'),\n  );\n}\n\nexport function isMicrosoftExcel(html: string): boolean {\n  return Boolean(\n    html?.includes('xmlns:x=\"urn:schemas-microsoft-com:office:excel\"'),\n  );\n}\n\nexport function isMicrosoftOffice(html: string): boolean {\n  return Boolean(html?.includes('xmlns:x=\"urn:schemas-microsoft-com\"'));\n}\n\nexport function isYuqueDocs(html: string): boolean {\n  return Boolean(\n    html?.includes('<meta name=\"source\" content=\"lake\"/>') ||\n    html?.includes('class=\"lake-content\"'),\n  );\n}\n\nexport function getHtmlFrom(html: string): string {\n  if (isMicrosoftWord(html)) {\n    return MS_WORD;\n  }\n  if (isMicrosoftExcel(html)) {\n    return MS_EXCEL;\n  }\n  if (isMicrosoftOffice(html)) {\n    return MS_OFFICE;\n  }\n  if (isYuqueDocs(html)) {\n    return YUQUE;\n  }\n  return 'web';\n}\n","import Deserializer from './Deserializer';\nimport { MoSerializationPlugin } from '../../type';\nimport { DATA_CLIPBORAD_CANGJIE } from '../../utils/constants';\nimport { getHtmlFrom } from './htmlFrom';\nimport type { MoHtmlParser, JsonML } from '../../type';\n\nfunction getJsonMLFromAttr(root: Document): JsonML | null {\n  const clipboardDataNode = root.querySelector(`[${DATA_CLIPBORAD_CANGJIE}]`);\n\n  /**\n   * 需要判断数据节点是否是第一个，防止一些 html 夹杂着无用的 data-clipboard-data 节点，导致误解析\n   */\n  if (clipboardDataNode && root.body.firstElementChild === clipboardDataNode) {\n    const clipboardData = clipboardDataNode.getAttribute(\n      DATA_CLIPBORAD_CANGJIE,\n    );\n    try {\n      return JSON.parse(clipboardData as string);\n    } catch (e) {\n      // @ali/4ever-logger 依赖库里面有浏览器环境依赖，导致 server cp 脚本无法运行\n      console.error(e);\n    }\n  }\n  return null;\n}\n\nexport default function createHtmlToJsonML(plugins: MoSerializationPlugin[], parser?: MoHtmlParser) {\n  return function htmlToJsonML(html: string, configs: {} = {}) {\n    const htmlFrom = getHtmlFrom(html);\n    const domParser = new DOMParser();\n    const parsedDocument = domParser.parseFromString(html, 'text/html');\n    const domJsonML = getJsonMLFromAttr(parsedDocument);\n    if (domJsonML) return domJsonML;\n    const deserializer = new Deserializer({ plugins, htmlFrom, parser });\n    const parsedHTML = parsedDocument.lastElementChild!;\n    return deserializer.deserialize(parsedHTML.outerHTML, configs);\n  };\n}\n","/* eslint-disable max-len */\nimport * as React from 'react';\nimport * as ReactDOMServer from 'react-dom/server';\n\nimport type { MoSerializationPlugin, JsonMLToHTMLRule, ConvertFunc, JsonML } from '../type';\nimport { jsonMLGetChildren } from '../utils/jsonml';\n\ninterface JsonMLToHTMLProps {\n  /**\n   * 完整的 JsonML content\n   */\n  content: JsonML;\n  /**\n   * 序列化插件\n   */\n  rules: JsonMLToHTMLRule[];\n}\n\nfunction jsonMLToHTML(props: JsonMLToHTMLProps, node: JsonML, path: number[] = []): JSX.Element | null {\n  const { rules } = props;\n  let rule = rules.find((r) => r.match(node));\n  if (!rule) {\n    rule = {\n      name: 'default',\n      match: () => false,\n      convert(node, key = [], convert) {\n        const children = jsonMLGetChildren(node).map((child, index) => convert(child, [...key, index]));\n        return (\n          <>\n            {children}\n          </>\n        );\n      },\n    }\n  }\n\n  const convert: ConvertFunc = (...args) => {\n    return jsonMLToHTML(props, ...args);\n  };\n\n  const element = rule.convert(node, path, convert);\n  if (!element) return null;\n\n  const elementWithKey = React.isValidElement<{ 'path'?: number[] }>(element)\n    ? React.cloneElement(element, { key: (element.props.path || []).toString() })\n    : element;\n\n  return elementWithKey;\n}\n\ninterface HTMLProviderProps {\n  content: JsonML;\n  rules: JsonMLToHTMLRule[];\n}\n\nfunction HTMLProvider(props: HTMLProviderProps): React.ReactElement | null {\n  const { content, rules, ...rest } = props;\n  const elem = jsonMLToHTML(props, content);\n  if (!elem) return null;\n  return React.cloneElement(elem, rest);\n}\n\nexport default function createJsonMLToHTML(plugins: MoSerializationPlugin[]) {\n  // 遍历取出 jsonMLToHTML 插件\n  const defaultRules = plugins\n    .map((plugin) => plugin.jsonMLToHTML!)\n    .filter((rule) => !!rule);\n\n  /**\n   * 序列化 JsonML to HTML，主要适用于富文本拷贝导出\n   * @param content JsonML 内容\n   * @param configs 自定义插件，如果插件名已经存在，则会覆盖原插件的方法\n   */\n  function contentJsonMLToHTML(content: JsonML, configs: Record<string, Partial<JsonMLToHTMLRule>> = {}): string {\n    // 加载 configs 中的插件\n    const rules = defaultRules.map((rule) => {\n      if (rule.name in configs) {\n        return {\n          ...rule,\n          ...configs[rule.name],\n        };\n      }\n      return rule;\n    });\n\n    const before = plugins\n      .map((p) => p.jsonMLToHTML?.hooks?.before)\n      .filter((p): p is NonNullable<NonNullable<NonNullable<MoSerializationPlugin['jsonMLToHTML']>['hooks']>['before']> => !!p)\n      .reduce((acc, p) => (value: JsonML) => p(acc(value)), (value: JsonML) => value);\n\n    const elem = React.createElement(HTMLProvider, {\n      content: before(content),\n      rules,\n    });\n    return ReactDOMServer.renderToStaticMarkup(elem);\n  }\n\n  return contentJsonMLToHTML;\n}\n","import { jsonMLAppend } from '../utils/jsonml';\nimport createTextWithString from '../utils/createTextWithString';\nimport { normalizeText } from '../../utils/textUtils';\nimport { MoSerializationPlugin, JsonML } from '../type';\n\nconst NEWLINE = '\\n';\n\nexport default function createTextToJsonML(plugins: MoSerializationPlugin[]) {\n  const rules = plugins\n    .map((plugin) => plugin.textToJsonML!)\n    .filter((rule) => !!rule);\n\n  /**\n   * 纯文本序列化成 ASL\n   * @param text\n   */\n  function textToJsonML(text: string): JsonML {\n    return normalizeText(text).split(NEWLINE).reduce(\n      (jsonML: JsonML, line: string): JsonML => {\n        const rule = rules.find((r) => r.match(line));\n        let children: JsonML[];\n        if (rule) {\n          children = rule.convert(line) || [];\n        } else {\n          children = [createTextWithString(line)];\n        }\n        const paragraph = jsonMLAppend(['p'], ...children);\n        return jsonMLAppend(jsonML, paragraph);\n      },\n      ['root'],\n    );\n  }\n\n  return textToJsonML;\n}\n","import type { MoSerializationPlugin } from '../type';\nimport type { Node } from '../../';\nimport Block from '../../models/block';\n\nfunction createNodeToText(plugins: MoSerializationPlugin[]) {\n  const rules = plugins.map((plugin) => plugin.valueToText!).filter((rule) => !!rule);\n\n  function nodeToText(node: Node): string {\n    let rule = rules.find((item) => item.match(node));\n\n    if (!rule) {\n      rule = {\n        name: 'default',\n        match: () => false,\n        convert: (n) => {\n          const { text } = n;\n          // 块级元素在末尾追加换行\n          if (Block.isBlock(node)) {\n            return `${text }\\n`;\n          }\n          return text;\n        },\n      };\n    }\n\n    const text = rule.convert(node, nodeToText);\n\n    return text;\n  }\n\n  return nodeToText;\n}\n\nexport default createNodeToText;\n","import type { Value } from '../../';\nimport createNodeToText from './nodeToText';\n\nfunction createValueToText(\n  nodeToText: ReturnType<typeof createNodeToText>,\n  injectValueData: (v: Value) => Value = (v) => v,\n) {\n  function valueToText(value: Value): string {\n    // 计算好 injection\n    const injectedValue = injectValueData(value);\n\n    const texts = injectedValue.document.nodes.map((node) => {\n      return nodeToText(node);\n    });\n\n    let text = texts.join('');\n    // 末尾处的断行要移除掉\n    // block 节点会附带一个 \\n，但是用户选区中的断行需要保留，所以这里只移除一个 \\n\n    if (text.endsWith('\\n')) {\n      text = text.substring(0, text.length - 1);\n    }\n    /**\n     * 从 Excel 中复制表格，纯文本粘贴会附带 \\t,当 \\t 足够多时会造成渲染性能问题。\n     * https://notes.dingtalk.com/doc/E0Vzg7l3wnjKAzJe?orgId=16872003&dd_progress=false&showmenu=false\n     * */\n    text = text.replace(/\\t+/g, '    ');\n    return text;\n  }\n\n  return valueToText;\n}\n\nexport default createValueToText;\n","import type Renderer from 'markdown-it/lib/renderer';\nimport type { MoSerializationPlugin, MarkdownRuleName, MarkdownToHTMLRule } from '../type';\n\nconst markdownRuleNameMap: Record<MarkdownRuleName, string[]> = {\n  table: ['table'],\n  code: ['code', 'fence'],\n  blockquote: ['blockquote'],\n  hr: ['hr'],\n  list: ['list'],\n  heading: ['heading', 'lheading'],\n  codespan: ['backticks'],\n  strikethrough: ['strikethrough'],\n  emphasis: ['emphasis'],\n  link: ['link', 'autolink'],\n  image: ['image'],\n  html: ['html_block', 'html_inline']\n};\n\nexport default async function createMarkdownToHTML(plugins: MoSerializationPlugin[]) {\n  const rules = plugins\n    .map((plugin) => plugin.markdownToHTML!)\n    .filter((rule) => !!rule);\n\n  // default，从原 basic 插件迁移\n  rules.push({\n    ruleName: 'html',\n    options: {\n      html: true,\n      xhtmlOut: true,\n    },\n  });\n\n  // async loading markdown-it\n  const MarkdownIt = (await import(/* webpackChunkName: 'cangjie-lib-markdown-it'*/'markdown-it')).default;\n  const md = new MarkdownIt('zero');\n\n  // 应用 rule 到 md\n  const summary = {\n    names: [] as string[],\n    options: {},\n    rewrite: {} as Record<string, { renderer?: Renderer.RenderRule }>,\n    uses: [] as NonNullable<MarkdownToHTMLRule['uses']>\n  };\n  rules.forEach((rule) => {\n    if (rule.ruleName) {\n      summary.names.push(...markdownRuleNameMap[rule.ruleName]);\n    }\n    if (rule.options) {\n      summary.options = { ...summary.options, ...rule.options };\n    }\n    if (rule.rewrite) {\n      rule.rewrite.forEach(({ name, createRenderer }) => {\n        if (createRenderer) {\n          summary.rewrite[name] = { renderer: createRenderer(md) };\n        }\n      })\n    }\n    if (rule.uses) {\n      summary.uses.push(...rule.uses);\n    }\n  });\n\n  md.enable(summary.names)\n    .set(summary.options);\n\n  for (let name in summary.rewrite) {\n    if (md.renderer.rules[name] && summary.rewrite[name].renderer) {\n      md.renderer.rules[name] = summary.rewrite[name].renderer;\n    }\n  }\n\n  for (let { plugin: pluginLoader, data } of summary.uses) {\n    const plugin = await pluginLoader();\n    const d = (typeof data === 'function') ? await data() : data;\n    md.use(plugin.default, ...(d || []));\n  }\n\n  function markdownToHTML(markdown: string): string {\n    const res = md.render(markdown);\n    return res;\n  }\n\n  return markdownToHTML;\n}\n","import { pick, isEmpty } from 'lodash-es';\nimport type { MoSerializationPlugin, HTMLToMarkdownRule } from '../type';\n\nexport default async function createHtmlToMarkdown(plugins: MoSerializationPlugin[]) {\n  const rules = plugins\n    .map((plugin) => plugin.htmlToMarkdown!)\n    .filter((rule) => !!rule);\n\n  const Turndown = (await import(/* webpackChunkName: 'cangjie-lib-turndown'*/'turndown')).default;\n  const turndownService = new Turndown({\n    headingStyle: 'atx',\n  });\n  rules.forEach(rule => {\n    const pluginRule = pick(rule, ['filter', 'replacement']);\n    if (!isEmpty(pluginRule)) {\n      turndownService.addRule(rule.name, pluginRule);\n    }\n    if (rule.use) {\n      turndownService.use(rule.use);\n    }\n  })\n  return (html: string) => {\n    return turndownService.turndown(html);\n  }\n}\n","import * as React from 'react';\nimport type { JsonML, ConvertFunc } from \"../../type\";\nimport { jsonMLGetChildren, jsonMLGetTagName } from '../../utils/jsonml';\n\nexport default {\n  name: 'root',\n\n  match(node: JsonML): boolean {\n    return jsonMLGetTagName(node) === 'root';\n  },\n\n  convert(node: JsonML, key: number[] = [], convert: ConvertFunc): React.ReactElement {\n    const children = jsonMLGetChildren(node)\n      .map((child, index: number) => convert(child, [...key, index]));\n    return (\n      <article className=\"4ever-article\">{children}</article>\n    );\n  },\n};\n","import Document from \"../../../models/document\";\nimport type { JsonML } from \"../../type\";\nimport { jsonMLGetAttributes, jsonMLGetTagName } from \"../../utils/jsonml\";\n\nexport default {\n  name: 'document',\n\n  match(node: JsonML): boolean {\n    return jsonMLGetTagName(node) === 'root';\n  },\n\n  convert(node: JsonML): Document {\n    return Document.create({\n      data: jsonMLGetAttributes(node) || {},\n    });\n  },\n};\n","import Document from \"../../../models/document\";\nimport type Node from \"../../../models/node\";\nimport type { JsonML } from \"../../type\";\n\nexport default {\n  match(node: Node): boolean {\n    return Document.isDocument(node);\n  },\n\n  convert(node: Document): JsonML {\n    return ['root', node.data];\n  },\n};\n","import { insertNodeByKey } from \"../../../commands/insert\";\nimport Block from \"../../../models/block\";\nimport { Schema } from \"../../../plugins/normalization\";\n\nexport const schema: Schema = {\n  document: {\n    nodes: [{ min: 1 }],\n    normalize: (controller, error) => {\n      const { code, node } = error;\n      if (code === 'child_min_invalid' && !node.nodes.length) {\n        let defaultBlock = controller.query('getDefaultBlock');\n        if (!defaultBlock) {\n          defaultBlock = Block.create({\n            type: Block.DEFAULT_TYPE\n          });\n        }\n        if (defaultBlock) {\n          controller.command(\n            insertNodeByKey,\n            node.key,\n            0,\n            defaultBlock,\n          );\n        } else {\n          throw Error('normalize error in document plugin schema, no plugin implement getDefaultBlock query');\n        }\n      }\n    },\n  }\n}\n","import type { MoSerializationPlugin } from '../../type';\nimport jsonMLToHTML from './jsonMLToHTML';\nimport jsonMLToValue from './jsonMLToValue';\nimport valueToJsonML from './valueToJsonML';\n\nexport const createSerializerPlugin = (): MoSerializationPlugin => ({\n  jsonMLToHTML,\n  jsonMLToValue,\n  valueToJsonML,\n});\n\nexport { schema as documentSchema } from './schema';\n","import { Commands, Block } from '../..';\nimport type { Schema } from '../../plugins/normalization';\nimport type { MoPlugin } from '../type/moPlugin';\nimport type Controller from '../../controller/index';\nimport { documentSchema } from '../plugins/document';\n\nexport function createSchema(plugins: MoPlugin[]): Schema {\n  const s = plugins.reduce<Schema>((prevSchema, plugin) => {\n    if (!plugin.schemas) {\n      return prevSchema;\n    }\n    const schemas = Array.isArray(plugin.schemas) ? plugin.schemas : [plugin.schemas];\n    schemas.forEach((schema) => {\n      // document 是内部插件, 用到特殊定义，在内部处理\n      const { type, isBlock, isVoid, isEdgeSelectable, schema: oldSchema } = schema;\n      let val: any = {};\n      if (['boolean', 'function'].includes(typeof isVoid)) {\n        val.isVoid = isVoid;\n      }\n      if (typeof isEdgeSelectable === 'boolean') {\n        val.isEdgeSelectable = isEdgeSelectable;\n      }\n      if (oldSchema) {\n        val = {\n          ...val,\n          ...oldSchema,\n        }\n      }\n\n      if (type === 'document') {\n        prevSchema['document'] = {\n          ...prevSchema['document'],\n          ...val,\n        };\n      } else {\n        prevSchema[(isBlock || isBlock === undefined) ? 'blocks' : 'inlines']![type] = val;\n      }\n    });\n\n    return prevSchema;\n  }, {\n    ...documentSchema,\n    blocks: {},\n    inlines: {},\n  });\n\n  return s;\n}\n\n/**\n * 兼容原先 strictSchema 定义。新增的规则都在插件中指定，schema 和 strictSchema 都支持。\n * \n * 1. document 下只能是已注册的 block type\n * 2. heading1-5, paragraph 下只能是已注册的 inline type\n * 3. table 的 schema 跟 @一辙 讨论了下， 考虑存量数据兼容，还是不在 table 里指定，保留在 strictSchema 中。\n */\n\nexport function createStrictSchema(plugins: MoPlugin[]): Schema {\n  const schema = createSchema(plugins);\n  const blockTypes = Object.keys(schema.blocks!);\n  const inlineTypes = Object.keys(schema.inlines!);\n\n  schema.document = {\n    ...schema.document,\n    nodes: [{ match: blockTypes.map(t => ({ type: t })), min: 1 }],\n  };\n\n  ['paragraph', 'heading-1', 'heading-2', 'heading-3', 'heading-4', 'heading-5', 'heading-6'].forEach((type) => {\n    if (schema.blocks?.[type]) {\n      schema.blocks[type] = {\n        ...schema.blocks[type],\n        nodes: [\n          { match: [...inlineTypes.map(t => ({ type: t })), { klass: 'text' }] },\n        ],\n        normalize: (controller, error) => {\n          const { code, child, node } = error;\n          if (code === 'child_type_invalid' && blockTypes.includes(child.type)) {\n            const parent = controller.value.document.getParent(node.key);\n            if (parent) {\n              const index = parent.nodes.indexOf(node.key);\n              controller.command(Commands.moveNodeByKey, child.key, parent.key, index);\n            }\n          }\n        },\n      }\n    }\n  });\n\n  // 指定 table 插件时的特殊处理\n  if(schema.blocks?.['table']) {\n    const extra = {\n      'table': {\n        isEdgeSelectable: true,\n        nodes: [{ match: { type: 'table-row' }, min: 1 }],\n      },\n      'table-row': {\n        nodes: [{ match: { type: 'table-cell' }, min: 1 }],\n      },\n      'table-cell': {\n        nodes: [{ match: blockTypes.map((t) => ({ type: t })), min: 1 }],\n        normalize: (controller: Controller, error) => {\n          const { code, child, node } = error;\n          if (code === 'child_type_invalid' && node.nodes.length === 1) {\n            controller.command(Commands.removeNodeByKey, child.key)\n\n            let defaultBlock = controller.query('getDefaultBlock', node.nodes);\n            if (!defaultBlock) {\n              if (!defaultBlock) {\n                defaultBlock = Block.create({\n                  type: Block.DEFAULT_TYPE\n                });\n              }\n            }\n            controller.command(\n              Commands.insertNodeByKey,\n              node.key,\n              0,\n              defaultBlock,\n            );\n          } else if (!node.nodes.length) {\n            let defaultBlock = Block.create({\n              type: 'paragraph',\n            });\n            if (!defaultBlock) {\n              defaultBlock = Block.create({\n                type: Block.DEFAULT_TYPE\n              });\n            }\n            controller.command(\n              Commands.insertNodeByKey,\n              node.key,\n              0,\n              defaultBlock,\n            );\n          } else {\n            controller.command(Commands.removeNodeByKey, child.key);\n            const index = node.nodes.indexOf(child);\n            for (let i = index + 1; i < node.nodes.length - 1; i++) {\n              const c = node.nodes[i];\n              if (!blockTypes.includes(c.type)) {\n                controller.command(Commands.removeNodeByKey, c.key);\n              }\n            }\n          }\n        },\n      },\n    };\n    Object.keys(extra).forEach((type => {\n      schema.blocks![type] = {\n        ...(schema.blocks![type] || {}),\n        ...extra[type],\n      }\n    }));\n  }\n\n  return schema;\n}\n","import equal from 'fast-deep-equal';\nimport {\n  jsonMLGetAttributes,\n  jsonMLGetLastChild,\n  jsonMLGetTagName,\n  jsonMLGetText,\n  jsonMLIsText,\n} from '../../utils/jsonml';\nimport type {\n  JsonML,\n} from '../../type/jsonml';\n\nimport {\n  MS_OFFICES,\n  REMAIN_STYLE_SOURCES,\n  MoState as State,\n  MoAttributes as Attributes,\n  HTMLToJsonMLRule,\n  createTextWithString,\n  TextMark,\n  LeafRule,\n} from '../../index';\nimport { omit, isEmpty } from 'lodash-es';\nimport { normalizeText as normalizeTextUtil } from '../../../utils/textUtils'\n\n/**\n * 一般使用的有两种空白符，空格敲击的空白符（Simple space）码点是 32，Non-breaking space 的码点是 160\n * 在 Word 的规范中，32 码点的字符会被裁剪掉，160 码点会保留，裁剪规则如下：\n * - 文字头端的所有连续 32 码点空白符会被全部裁剪（同时也包括了 \\n 符号）；\n * - 文字中端和尾端的所有连续 32 码点空白符会合并（Collapse）成一个空白符；\n * @see https://stackoverflow.com/questions/11984029/difference-between-32-and-nbsp\n */\nconst SIMPLE_SPACE_CODE = 32;\n\n// \\n 符号\nconst BREAK_CODE = 10;\n\n// 需要被替换为\\n的字符\nconst BR_REPLACE_BREAK_MATCH = [/\\n\\r/g, /\\r\\n/g, /\\r/g];\n\nconst HEAD_TAG_REG = /^h\\d$/i;\n\n// TODO: 兼容原 text 插件逻辑，待重构\nconst paragraphTags: Record<string, string> = {\n  h1: 'h1',\n  h2: 'h2',\n  h3: 'h3',\n  h4: 'h4',\n  h5: 'h5',\n  h6: 'h6',\n  p: 'p',\n  div: 'p',\n  section: 'p',\n};\n\n// 解析非文档 html, 使用仓颉默认的字体大小等样式\nfunction normalizeMarks(tagName: string, marks: Record<string, any>) {\n  if (HEAD_TAG_REG.test(tagName)) {\n    return omit(marks, ['vertAlign', 'sz', 'szUnit']);\n  }\n  return marks;\n}\n\n/**\n * Normalize 一行文本，剔除文本前面的空白符\n * @note 注意 Word 的规范中只会对 text/html 中的空白符进行裁剪，text/plain 中的空白符会保留\n * @param text\n */\nfunction normalizeText(text: string): string {\n  let index = 0;\n  for (; index < text.length; index++) {\n    const code = text.charCodeAt(index);\n    if (\n      code === SIMPLE_SPACE_CODE || // 空格符号过滤\n      code === BREAK_CODE // 断行符号过滤\n    ) {\n      continue;\n    }\n    break;\n  }\n  // 裁剪头端所有的空格符和断行符\n  text = text.slice(index, text.length);\n  // 合并中端和尾端的空格符\n  text = text.replace(/ +/g, String.fromCharCode(SIMPLE_SPACE_CODE));\n\n  return normalizeTextUtil(text);\n}\n\nexport function createHTMLToJsonML(htmlToAttrs: Array<LeafRule['htmlToJsonMLAttrs']>) {\n  const enableBr = false; // FIX: 禁用对 br 的处理\n\n  const converts = htmlToAttrs.filter((f): f is NonNullable<LeafRule['htmlToJsonMLAttrs']> => !!f);\n\n  function generateMarks(tag: string, attrs: Attributes): TextMark | null {\n    let marks: TextMark = converts.reduce((prev, convert) => {\n      return convert(tag, { ...attrs }, { ...prev })\n    }, {});\n\n    return isEmpty(marks) ? null : marks;\n  }\n\n  return function (pasteFrom): HTMLToJsonMLRule {\n    return {\n      name: 'text',\n\n      onOpenTag: (\n        state: State,\n        name: string,\n        attrs: Attributes,\n        id: string,\n      ) => {\n        const marks = generateMarks(name, attrs);\n        if (marks) {\n          state.addMarks({ id, value: marks });\n          // fall through\n        }\n        return false;\n      },\n\n      onText: (state: State, text: string): boolean => {\n        let texts = [text];\n        // ['p']\n        let parent = state.peek();\n        // ['span', { 'data-type': 'text' }]\n        let prevSibling = jsonMLGetLastChild(parent);\n        const parentTagName = jsonMLGetTagName(parent);\n        // TODO 待改造\n        if (\n          !paragraphTags[parentTagName] &&\n          parentTagName !== 'a' &&\n          parentTagName !== 'inlineCode'\n        ) {\n          if (!prevSibling || !(prevSibling as any).isPhantom) {\n            const phantom: JsonML = ['p'];\n            (phantom as any).isPhantom = true;\n            parent = phantom;\n            prevSibling = null;\n            state.append(phantom);\n          } else {\n            parent = prevSibling;\n            prevSibling = jsonMLGetLastChild(parent);\n          }\n        }\n        // \\n 只有出现在 a 及 p 中才被转换\n        if (\n          enableBr &&\n          (paragraphTags[parentTagName] || parentTagName === 'a')\n        ) {\n          const breakStr = String.fromCharCode(BREAK_CODE);\n          // 先统一处理成 \\n\n          const onlyBreakText = BR_REPLACE_BREAK_MATCH.reduce(\n            (result, match) => result.replace(match, breakStr),\n            text,\n          );\n          texts = onlyBreakText.split(breakStr).filter((a) => !!a);\n        } else if (MS_OFFICES.includes(pasteFrom)) {\n          // office 中的 \\n 没有包含在 white-space: pre 中，统一作空格字符串使用\n          texts = texts.map((txt) => txt.replace(/\\n/g, ' '));\n        }\n\n        let marks = state.getMarks();\n        const parentType = parent[0];\n        if (\n          HEAD_TAG_REG.test(parentType) &&\n          !REMAIN_STYLE_SOURCES.includes(pasteFrom)\n        ) {\n          marks = normalizeMarks(parentType, marks);\n        }\n\n        const leafAttrs = {\n          ...marks,\n          'data-type': 'leaf',\n        };\n\n        // 如果 p 下面没有 text 节点\n        if (!prevSibling || !jsonMLIsText(prevSibling)) {\n          prevSibling = ['span', { 'data-type': 'text' }];\n          parent.push(prevSibling);\n        }\n\n        texts.forEach((txt, index) => {\n          if (enableBr && index > 0) {\n            parent.push([\n              'br',\n              { type: 'textWrapping', data: {} },\n              createTextWithString(''),\n            ]);\n            prevSibling = ['span', { 'data-type': 'text' }];\n            parent.push(prevSibling);\n          }\n          const prevLeaf =\n            enableBr && prevSibling![0] === 'br'\n              ? null\n              : jsonMLGetLastChild(prevSibling!);\n\n          // 如果是空段落，则 normalize text\n          if (!prevLeaf || jsonMLGetText(parent) === '') {\n            txt = normalizeText(txt);\n          }\n\n          const leaf = ['span', leafAttrs, txt];\n\n          // 如果是空 text 或者与上一个 leaf 属性不匹配，则 push\n          if (!prevLeaf || !equal(leafAttrs, jsonMLGetAttributes(prevLeaf))) {\n            prevSibling!.push(leaf);\n          } else {\n            // 相同属性的 leaf 则 concat\n            prevLeaf[prevLeaf.length - 1] += txt;\n          }\n        });\n\n        return false;\n      },\n\n      onCloseTag: (\n        state: State,\n        name: string,\n        attrs: Attributes,\n        id: string,\n      ) => {\n        state.removeMarks({ id });\n        // fall through\n        return false;\n      },\n    };\n  };\n}\n","import type { MarkProperties, default as Mark } from './../../../models/mark';\nimport type { JsonMLToValueRule, LeafRule, TextMark } from './../../type/rules';\nimport Text from '../../../models/text';\nimport {\n  JsonML,\n  jsonMLGetAttributes,\n  jsonMLGetChildren,\n  jsonMLIsText,\n} from '../../utils/jsonml';\n\nfunction attrsToMarks(attrs: TextMark, converts: Array<NonNullable<LeafRule['jsonMLAttrsToMarks']>>): Array<MarkProperties | Mark> {\n  const handledKeys: Set<string> = new Set();\n  const marks: Array<MarkProperties | Mark> = converts.reduce<Array<MarkProperties | Mark>>((prev, convert) => {\n    const rst = convert(attrs);\n    if (!rst) return [...prev];\n\n    const { keys, marks } = rst;\n    keys.forEach(k => handledKeys.add(k));\n    return [\n      ...prev,\n      ...marks,\n    ];\n  }, []);\n\n  const restKeys = Object.keys(attrs).filter(k => k !== 'data-type' && !handledKeys.has(k));\n\n  restKeys.forEach((key) => {\n    const data = attrs[key];\n    let markData: string | object = data;\n    const isObj = typeof data === 'object' && !!data && !Array.isArray(data);\n    if (!isObj) {\n      // not a object\n      markData = { value: data };\n    }\n    marks.push({ type: key, data: markData as Record<string, any> });\n  });\n\n  return marks;\n}\n\nexport function createJsonMLToValue(attrToMarks: Array<LeafRule['jsonMLAttrsToMarks']>): JsonMLToValueRule {\n  const converts = attrToMarks.filter((f): f is NonNullable<LeafRule['jsonMLAttrsToMarks']> => !!f)\n\n  const rule: JsonMLToValueRule = {\n    name: 'text',\n  \n    match: (node: JsonML): boolean => {\n      return jsonMLIsText(node);\n    },\n  \n    convert: (node: JsonML): Text => {\n      return Text.create({\n        // @ts-ignore \n        leaves: jsonMLGetChildren(node).map((leaf: JsonML) => {\n          const marks = attrsToMarks(jsonMLGetAttributes(leaf)! as TextMark, converts)\n          return {\n            text: String(jsonMLGetChildren(leaf)[0]),\n            marks\n          }\n        }),\n      });\n    },\n  }\n  return rule;\n}\n","import * as React from 'react';\nimport { jsonMLGetTagName, jsonMLGetAttributes, jsonMLGetChildren, jsonMLIsText } from '../../utils/jsonml';\nimport type { JsonML } from '../../type/jsonml';\nimport type { JsonMLToHTMLRule, LeafRule, TextMark } from '../../type';\n\n/**\n * 在 Word 的 CCP 导出规范中，文档中的空白符（Simple space）在 text/html 中会全部替换成 &nbsp;（码点 160）\n * 在导出 text/plain 中，则会保留 Simple space 的码点（32）\n */\nconst NON_BREAKING_SPACE_CODE = 160;\n\nfunction normalizeText(text: string): string {\n  text = text.replace(/ /g, String.fromCharCode(NON_BREAKING_SPACE_CODE));\n  return text;\n}\n\nfunction createLeafToElement(jsonMLAttrsToStyles: Array<NonNullable<LeafRule['jsonMLAttrsToStyle']>>) {\n  return (leaf: JsonML, key: number[]): React.ReactElement => {\n    const attrs: TextMark = jsonMLGetAttributes(leaf) || {};\n    const style: React.CSSProperties = jsonMLAttrsToStyles.reduce((prev, attrToStyle) => {\n      return attrToStyle({\n        ...attrs,\n      }, {\n        ...prev\n      });\n    }, {});\n\n    // dataType 不需要透出给插件处理，兼容一下旧的 inlineCode\n    const dataType = (attrs as any).inlineCode ? 'inlineCode' : 'text';\n\n    const text = normalizeText(jsonMLGetChildren(leaf)[0] as unknown as string);\n\n    return (\n      <span data-type={dataType} style={style} key={key.toString()}>\n        {text}\n      </span>\n    );\n  }\n}\n\nexport function createJsonMLToHTML(jsonMLAttrsToStyles: Array<LeafRule['jsonMLAttrsToStyle']>): JsonMLToHTMLRule {\n  const leafToElement = createLeafToElement(jsonMLAttrsToStyles.filter((f): f is NonNullable<LeafRule['jsonMLAttrsToStyle']> => !!f));\n\n  return {\n    name: 'text',\n\n    match: (node: JsonML): boolean => {\n      return jsonMLIsText(node);\n    },\n\n    convert: (node: JsonML, key: number[]): React.ReactElement => {\n      const children = jsonMLGetChildren(node).map((leaf, index) =>\n        leafToElement(leaf, [...key, index]),\n      );\n      return <React.Fragment>{children}</React.Fragment>;\n    },\n  };\n}\n","import type { Attributes, LeafRule, TextMark, ValueToJsonMLRule } from './../../type/rules';\nimport Text from '../../../models/text';\nimport type Node from '../../../models/node';\nimport type Leaf from '../../../models/leaf';\nimport type Mark from '../../../models/mark';\nimport type { JsonML } from '../../utils/jsonml';\n\nexport function marksToAttrs(marks: Mark[], converts: Array<NonNullable<LeafRule['markToJsonMLAttrs']>>): Attributes {\n  return marks.reduce((attrs: Attributes, mark: Mark) => {\n    let textMark: TextMark | undefined;\n    for (let i = 0, len = converts.length; i < len; i++) {\n      const m = converts[i](mark);\n      if (m) {\n        textMark = m;\n        break;\n      }\n    }\n    if (!textMark) {\n      textMark = { [mark.type]: mark.data };\n    }\n\n    return {\n      ...attrs,\n      ...textMark,\n    }\n  }, {} as Attributes);\n}\n\nexport function createValueToJsonML(markToAttrs: Array<LeafRule['markToJsonMLAttrs']>): ValueToJsonMLRule {\n  const converts = markToAttrs.filter((f): f is NonNullable<LeafRule['markToJsonMLAttrs']> => !!f)\n\n  const rule = {\n    match: (node: Node): boolean => {\n      return Text.isText(node);\n    },\n  \n    convert: (node: Text): JsonML => {\n      return [\n        'span',\n        { 'data-type': 'text' },\n        // @ts-ignore\n        ...node.leaves.reduce((acc: JsonML[], leaf: Leaf) => ([\n          ...acc,\n          [\n            'span',\n            {\n              ...marksToAttrs(leaf.marks!, converts),\n              'data-type': 'leaf',\n            },\n            leaf.text,\n          ],\n        ]), []),\n      ];\n    },\n  }\n  return rule;\n}\n","import Text from '../../../models/text';\nimport type { ValueToTextRule } from './../../type/rules';\n\nconst valueToText: ValueToTextRule = {\n  name: 'text',\n\n  match(node) {\n    return Text.isText(node);\n  },\n\n  convert(node) {\n    return node.text;\n  },\n};\n\nexport function createValueToText() {\n  return valueToText;\n}\n","import type { MoSerializationPlugin } from \"../../type\"\nimport { createHTMLToJsonML } from \"./createHTMLToJsonML\";\nimport { createJsonMLToValue } from \"./createJsonMLToValue\";\nimport { createJsonMLToHTML } from \"./createJsonToHtml\";\nimport { createValueToJsonML } from \"./createValueToJsonMl\";\nimport { createValueToText } from \"./createValueToText\";\n\nexport const createSerializerPlugin = (plugins: MoSerializationPlugin[]): MoSerializationPlugin => {\n  return {\n    htmlToJsonML: createHTMLToJsonML(plugins.map(p => p.leaf?.htmlToJsonMLAttrs)),\n    jsonMLToHTML: createJsonMLToHTML(plugins.map(p => p.leaf?.jsonMLAttrsToStyle)),\n    jsonMLToValue: createJsonMLToValue(plugins.map(p => p.leaf?.jsonMLAttrsToMarks)),\n    valueToJsonML: createValueToJsonML(plugins.map(p => p.leaf?.markToJsonMLAttrs)),\n    valueToText: createValueToText(),\n  }\n}\n","/**\n * @packageDocumentation\n * @module Serializer\n */\nimport type { Value, Schema } from '../../';\nimport type { MoSerializationPlugin as Plugin, MoHtmlParser, Mo, MoPlugin, BaseMo, HtmlMo, TextMo, MarkdownMo, AsyncMo, JsonML } from '../type';\nimport createJsonMLToValue from './jsonMLToValue';\nimport createValueToJsonML, { createAsyncValueToJsonML } from './valueToJsonML';\nimport createJsonMLToNode from './jsonMLToNode';\nimport createNodeToJsonML, { createAsyncNodeToJsonML } from './nodeToJsonML';\nimport createHtmlToJsonML from './htmlToJsonML';\nimport createJsonMLToHTML from './jsonMLToHTML';\nimport createTextToJsonML from './textToJsonML';\nimport createNodeToText from './nodeToText';\nimport createValueToText from './valueToText';\nimport createMarkdownToHTML from './markdownToHTML';\nimport createHtmlToMarkdown from './htmlToMarkdown';\nimport { createSchema } from '../schema/createSchema';\nimport { createSerializerPlugin as documentFactory } from '../plugins/document';\nimport { createSerializerPlugin as textFactory } from '../plugins/text';\n\n\nfunction createBase(p: Plugin[], schema: Schema): BaseMo {\n  const plugins = [documentFactory(), textFactory(p), ...p];\n  const jsonMLToNode = createJsonMLToNode(plugins);\n  const jsonMLToValue = createJsonMLToValue(jsonMLToNode, schema);\n  const nodeToJsonML = createNodeToJsonML(plugins);\n  const valueToJsonML = createValueToJsonML(nodeToJsonML);\n\n  return {\n    // 反序列化 ASL\n    jsonMLToValue,\n    // 序列化 ASL\n    valueToJsonML,\n\n    // 主要用于 operation 序列化、反序列化\n    jsonMLToNode,\n    nodeToJsonML,\n  };\n}\n\nfunction createText(p: Plugin[], base: BaseMo): TextMo {\n  const plugins = [textFactory(p), ...p, documentFactory()];\n\n  const beforeValueToText = plugins\n    .map((p) => p.valueToText?.hooks?.before)\n    .filter((p) => !!p)\n    .reduce((acc, p) => (value: Value) => p!(acc!(value)), (value: Value) => value);\n\n  const textToJsonML = createTextToJsonML(plugins);\n  const nodeToText = createNodeToText(plugins);\n  const valueToText = createValueToText(nodeToText, beforeValueToText);\n\n  return {\n    // 纯文本粘贴\n    textToJsonML,\n    textToValue: function textToValue(text: string): Value {\n      return base.jsonMLToValue(textToJsonML(text));\n    },\n\n    // 纯文本导出\n    valueToText,\n  }\n}\n\nfunction createHtml(p: Plugin[], base: BaseMo, parser?: MoHtmlParser): HtmlMo {\n  const plugins = [textFactory(p), ...p, documentFactory()];\n  \n  const htmlToJsonML = createHtmlToJsonML(plugins, parser);\n  const jsonMLToHTML = createJsonMLToHTML(plugins);\n\n  return {\n    // 富文本粘贴\n    htmlToJsonML,\n    htmlToValue: function htmlToValue(html: string): Value {\n      return base.jsonMLToValue(htmlToJsonML(html), { strict: true });\n    },\n\n    // 输出 HTML\n    jsonMLToHTML,\n    valueToHTML: function valueToHTML(value: Value): string {\n      return jsonMLToHTML(base.valueToJsonML(value));\n    },\n  };\n}\n\nfunction createAsync(p: Plugin[]): AsyncMo {\n  const plugins = [textFactory(p), ...p, documentFactory()];\n  const asyncNodeToJsonML = createAsyncNodeToJsonML(plugins);\n  const asyncValueToJsonML = createAsyncValueToJsonML(asyncNodeToJsonML);\n  return {\n    asyncValueToJsonML,\n  };\n}\n\nfunction createMarkdown(p: Plugin[], base: BaseMo, hs: HtmlMo): MarkdownMo {\n  const plugins = [textFactory(p), ...p, documentFactory()];\n  const markdownToJsonML = async (markdown: string) => {\n    const markdownToHTML = await createMarkdownToHTML(plugins);\n    const html = markdownToHTML(markdown);\n    return hs.htmlToJsonML(html);\n  }\n\n\n  const jsonMLToMarkdown = async(jsonML: JsonML) => {\n    const jsonMLToHTML = createJsonMLToHTML(plugins);\n    const htmlToMarkdown = await createHtmlToMarkdown(plugins);\n    return htmlToMarkdown(jsonMLToHTML(jsonML));\n  }\n\n  return {\n    // markdown 粘贴\n    markdownToJsonML,\n    markdownToValue: async (markdown: string) => {\n      const jsonML = await markdownToJsonML(markdown);\n      return base.jsonMLToValue(jsonML);\n    },\n    jsonMLToMarkdown,\n  }\n}\n\nfunction create(\n  plugins: Plugin[], schema: Schema, parser?: MoHtmlParser,\n): Mo {\n  const baseSerialzer = createBase(plugins, schema);\n  const textSerializer = createText(plugins, baseSerialzer);\n  const htmlSerializer = createHtml(plugins, baseSerialzer, parser);\n  const mdSerializer = createMarkdown(plugins, baseSerialzer, htmlSerializer);\n  const asyncSerializer = createAsync(plugins);\n\n  return {\n    ...baseSerialzer,\n    ...textSerializer,\n    ...htmlSerializer,\n    ...mdSerializer,\n    ...asyncSerializer,\n  }\n}\n\nfunction getSchemaAndPluginsFromMoPlugins(\n  plugins: MoPlugin[],\n) {\n  const schema = createSchema(plugins);\n  const serializerPlugins = plugins.map(p => p.serializer).filter((s): s is Plugin => !!s);\n\n  return {\n    schema, serializerPlugins,\n  }\n}\n\n/**\n * @deprecated create serializer with `serializations plugins`\n * @returns serializer\n */\nexport const createSerializerOld = create;\n\n/**\n * create serializer only support jsonMl <=> value\n * @param plugins mo plugins\n * @returns serializer\n */\nexport function createBaseSerializer(\n  plugins: MoPlugin[],\n) {\n  const { schema, serializerPlugins } = getSchemaAndPluginsFromMoPlugins(plugins);\n  return createBase(serializerPlugins, schema);\n}\n\n/**\n * create serializer with jsonMl、html、text、markdown\n * @param plugins mo plugins\n * @param parser optional html parser\n * @returns serializer\n */\nexport function createSerializer(\n  plugins: MoPlugin[], parser?: MoHtmlParser,\n) {\n  const { schema, serializerPlugins } = getSchemaAndPluginsFromMoPlugins(plugins);\n  return create(serializerPlugins, schema, parser);\n}\n","import { createHtmlParser } from '@ali/cangjie-lib-for-tree-shaking';\nimport { v1 as uuidv1 } from 'uuid';\nimport { toStyleObject, normalizeSpacesInHTML } from '../../utils/parseHtml';\nimport type { ParserOptions } from '../../type';\n\ninterface TagMeta {\n  name: string;\n  attrs: object;\n  id: string;\n}\n\ninterface ParserCallbacks {\n  onOpenTag: (name: string, attrs: object, id: string) => void;\n  onText: (text: string) => void;\n  onCloseTag: (name: string, attrs: object, id: string) => void;\n}\n\nexport default class Parser {\n  private readonly skipTags: string[] = ['head', 'style'];\n\n  private isInSkipTag = false;\n\n  private readonly stack: TagMeta[] = [];\n\n  private callbacks?: ParserCallbacks;\n\n  private parser?: ReturnType<typeof createHtmlParser>;\n\n  init = (callbacks: ParserCallbacks, options: ParserOptions) => {\n    this.callbacks = callbacks;\n\n    this.parser = createHtmlParser(\n      {\n        onopentag: this.onOpenTag,\n        ontext: this.onText,\n        // @ts-ignore\n        onclosetag: this.onCloseTag,\n      },\n      options,\n    );\n  };\n\n  onOpenTag = (name: string, attrs: object): void => {\n    if (this.skipTags.includes(name)) {\n      this.isInSkipTag = true;\n      return;\n    }\n\n    if (this.isInSkipTag) return;\n\n    // @ts-ignore\n    attrs.styleObj = toStyleObject(attrs.style);\n\n    const id = uuidv1();\n    this.callbacks?.onOpenTag(name, attrs, id);\n    this.stack.push({ name, attrs, id });\n  };\n\n  onText = (text: string): void => {\n    if (this.isInSkipTag || !normalizeSpacesInHTML(text)) return;\n    this.callbacks?.onText(text);\n  };\n\n  onCloseTag = (name: string): void => {\n    if (this.skipTags.includes(name)) {\n      this.isInSkipTag = false;\n      return;\n    }\n\n    if (this.isInSkipTag) return;\n\n    const open = this.stack.pop();\n    if (!open || open.name !== name) {\n      throw new Error(`htmlparser2 doesn't close tag(${name}) correctly!`);\n    }\n    this.callbacks?.onCloseTag(name, open.attrs, open.id);\n  };\n\n  write(chunk: string): void {\n    this.parser?.write(chunk);\n  }\n\n  end(): void {\n    this.parser?.end();\n  }\n}\n","\n/**\n * 边框样式枚举\n */\nexport enum BorderStyleEnum {\n  Single = 'single',\n  Thick = 'thick',\n  Double = 'double',\n  Dotted = 'dotted',\n  Dashed = 'dashed',\n  DotDash = 'dotDash',\n  DotDotDash = 'dotDotDash',\n  Triple = 'triple',\n  ThinThickSmallGap = 'thinThickSmallGap',\n  ThickThinSmallGap = 'thickThinSmallGap',\n  ThinThickThinSmallGap = 'thinThickThinSmallGap',\n  ThinThickMediumGap = 'thinThickMediumGap',\n  ThickThinMediumGap = 'thickThinMediumGap',\n  ThinThickThinMediumGap = 'thinThickThinMediumGap',\n  ThinThickLargeGap = 'thinThickLargeGap',\n  ThickThinLargeGap = 'thickThinLargeGap',\n  ThinThickThinLargeGap = 'thinThickThinLargeGap',\n  Wave = 'wave',\n  DoubleWave = 'doubleWave',\n  DashSmallGap = 'dashSmallGap',\n  DashDotStroked = 'dashDotStroked',\n  ThreeDEmboss = 'threeDEmboss',\n  ThreeDEngrave = 'threeDEngrave',\n  Outset = 'outset',\n  Inset = 'inset',\n  Apples = 'apples',\n  ArchedScallops = 'archedScallops',\n  BabyPacifier = 'babyPacifier',\n  BabyRattle = 'babyRattle',\n  Balloons3Colors = 'balloons3Colors',\n  BalloonsHotAir = 'balloonsHotAir',\n  BasicBlackDashes = 'basicBlackDashes',\n  BasicBlackDots = 'basicBlackDots',\n  BasicBlackSquares = 'basicBlackSquares',\n  BasicThinLines = 'basicThinLines',\n  BasicWhiteDashes = 'basicWhiteDashes',\n  BasicWhiteDots = 'basicWhiteDots',\n  BasicWhiteSquares = 'basicWhiteSquares',\n  BasicWideInline = 'basicWideInline',\n  BasicWideMidline = 'basicWideMidline',\n  BasicWideOutline = 'basicWideOutline',\n  Bats = 'bats',\n  Birds = 'birds',\n  BirdsFlight = 'birdsFlight',\n  Cabins = 'cabins',\n  CakeSlice = 'cakeSlice',\n  CandyCorn = 'candyCorn',\n  CelticKnotwork = 'celticKnotwork',\n  CertificateBanner = 'certificateBanner',\n  ChainLink = 'chainLink',\n  ChampagneBottle = 'champagneBottle',\n  CheckedBarBlack = 'checkedBarBlack',\n  CheckedBarColor = 'checkedBarColor',\n  Checkered = 'checkered',\n  ChristmasTree = 'christmasTree',\n  CirclesLines = 'circlesLines',\n  CirclesRectangles = 'circlesRectangles',\n  ClassicalWave = 'classicalWave',\n  Clocks = 'clocks',\n  Compass = 'compass',\n  Confetti = 'confetti',\n  ConfettiGrays = 'confettiGrays',\n  ConfettiOutline = 'confettiOutline',\n  ConfettiStreamers = 'confettiStreamers',\n  ConfettiWhite = 'confettiWhite',\n  CornerTriangles = 'cornerTriangles',\n  CouponCutoutDashes = 'couponCutoutDashes',\n  CouponCutoutDots = 'couponCutoutDots',\n  CrazyMaze = 'crazyMaze',\n  CreaturesButterfly = 'creaturesButterfly',\n  CreaturesFish = 'creaturesFish',\n  CreaturesInsects = 'creaturesInsects',\n  CreaturesLadyBug = 'creaturesLadyBug',\n  CrossStitch = 'crossStitch',\n  Cup = 'cup',\n  DecoArch = 'decoArch',\n  DecoArchColor = 'decoArchColor',\n  DecoBlocks = 'decoBlocks',\n  DiamondsGray = 'diamondsGray',\n  DoubleD = 'doubleD',\n  DoubleDiamonds = 'doubleDiamonds',\n  Earth1 = 'earth1',\n  Earth2 = 'earth2',\n  EclipsingSquares1 = 'eclipsingSquares1',\n  EclipsingSquares2 = 'eclipsingSquares2',\n  EggsBlack = 'eggsBlack',\n  Fans = 'fans',\n  Film = 'film',\n  Firecrackers = 'firecrackers',\n  FlowersBlockPrint = 'flowersBlockPrint',\n  FlowersDaisies = 'flowersDaisies',\n  FlowersModern1 = 'flowersModern1',\n  FlowersModern2 = 'flowersModern2',\n  FlowersPansy = 'flowersPansy',\n  FlowersRedRose = 'flowersRedRose',\n  FlowersRoses = 'flowersRoses',\n  FlowersTeacup = 'flowersTeacup',\n  FlowersTiny = 'flowersTiny',\n  Gems = 'gems',\n  GingerbreadMan = 'gingerbreadMan',\n  Gradient = 'gradient',\n  Handmade1 = 'handmade1',\n  Handmade2 = 'handmade2',\n  HeartBalloon = 'heartBalloon',\n  HeartGray = 'heartGray',\n  Hearts = 'hearts',\n  HeebieJeebies = 'heebieJeebies',\n  Holly = 'holly',\n  HouseFunky = 'houseFunky',\n  Hypnotic = 'hypnotic',\n  IceCreamCones = 'iceCreamCones',\n  LightBulb = 'lightBulb',\n  Lightning1 = 'lightning1',\n  Lightning2 = 'lightning2',\n  MapPins = 'mapPins',\n  MapleLeaf = 'mapleLeaf',\n  MapleMuffins = 'mapleMuffins',\n  Marquee = 'marquee',\n  MarqueeToothed = 'marqueeToothed',\n  Moons = 'moons',\n  Mosaic = 'mosaic',\n  MusicNotes = 'musicNotes',\n  Northwest = 'northwest',\n  Ovals = 'ovals',\n  Packages = 'packages',\n  PalmsBlack = 'palmsBlack',\n  PalmsColor = 'palmsColor',\n  PaperClips = 'paperClips',\n  Papyrus = 'papyrus',\n  PartyFavor = 'partyFavor',\n  PartyGlass = 'partyGlass',\n  Pencils = 'pencils',\n  People = 'people',\n  PeopleWaving = 'peopleWaving',\n  PeopleHats = 'peopleHats',\n  Poinsettias = 'poinsettias',\n  PostageStamp = 'postageStamp',\n  Pumpkin1 = 'pumpkin1',\n  PushPinNote2 = 'pushPinNote2',\n  PushPinNote1 = 'pushPinNote1',\n  Pyramids = 'pyramids',\n  PyramidsAbove = 'pyramidsAbove',\n  Quadrants = 'quadrants',\n  Rings = 'rings',\n  Safari = 'safari',\n  Sawtooth = 'sawtooth',\n  SawtoothGray = 'sawtoothGray',\n  ScaredCat = 'scaredCat',\n  Seattle = 'seattle',\n  ShadowedSquares = 'shadowedSquares',\n  SharksTeeth = 'sharksTeeth',\n  ShorebirdTracks = 'shorebirdTracks',\n  Skyrocket = 'skyrocket',\n  SnowflakeFancy = 'snowflakeFancy',\n  Snowflakes = 'snowflakes',\n  Sombrero = 'sombrero',\n  Southwest = 'southwest',\n  Stars = 'stars',\n  StarsTop = 'starsTop',\n  Stars3d = 'stars3d',\n  StarsBlack = 'starsBlack',\n  StarsShadowed = 'starsShadowed',\n  Sun = 'sun',\n  Swirligig = 'swirligig',\n  TornPaper = 'tornPaper',\n  TornPaperBlack = 'tornPaperBlack',\n  Trees = 'trees',\n  TriangleParty = 'triangleParty',\n  Triangles = 'triangles',\n  Tribal1 = 'tribal1',\n  Tribal2 = 'tribal2',\n  Tribal3 = 'tribal3',\n  Tribal4 = 'tribal4',\n  Tribal5 = 'tribal5',\n  Tribal6 = 'tribal6',\n  TwistedLines1 = 'twistedLines1',\n  TwistedLines2 = 'twistedLines2',\n  Vine = 'vine',\n  Waveline = 'waveline',\n  WeavingAngles = 'weavingAngles',\n  WeavingBraid = 'weavingBraid',\n  WeavingRibbon = 'weavingRibbon',\n  WeavingStrips = 'weavingStrips',\n  WhiteFlowers = 'whiteFlowers',\n  Woodwork = 'woodwork',\n  XIllusions = 'xIllusions',\n  ZanyTriangles = 'zanyTriangles',\n  ZigZag = 'zigZag',\n  ZigZagStitch = 'zigZagStitch',\n}\n\nexport enum PageBorderDisplay {\n  ALL_PAGES = 'allPages',\n  FIRST_PAGE = 'firstPage',\n  NOT_FIRST_PAGE = 'notFirstPage',\n}\nexport enum PageBorderOffsetFrom {\n  PAGE = 'page',\n  TEXT = 'text',\n}\nexport enum PageBorderZOrder {\n  BACK = 'back',\n  FRONT = 'front',\n}\n","import { useContext } from 'react';\nimport { ControllerContext } from \"./index\";\n\n/**\n * 获得 Controller 实例，使用 `useControllerStatic` hook 的组件，不会随着编辑器内容的变化而发生重渲\n * @returns \n */\nexport default function useControllerStatic() {\n  const context = useContext(ControllerContext);\n  if (!context) {\n    throw new Error(\n      \"The `useControllerStatic` hook must be used inside the <Cangjie.Provider> component's context.\",\n    );\n  }\n  return context.controller;\n}\n","/* eslint-disable max-lines */\n/**\n * @packageDocumentation\n * @module Controller\n */\nimport * as React from 'react';\nimport warning from 'tiny-warning';\nimport { isEmpty, debounce, noop } from 'lodash-es';\nimport equal from 'fast-deep-equal';\nimport useController from './useController';\nimport connectController from './connectController';\nimport Command, {\n  PluginCommandArgs,\n  PluginCommandName,\n  PluginCommands,\n} from '../interfaces/command';\nimport type {\n  default as Query,\n  PluginQueryArgs,\n  PluginQueryName,\n  PluginQueryReturn,\n  PluginQueries,\n} from '../interfaces/query';\nimport Plugin from '../interfaces/plugin';\nimport Data from '../interfaces/data';\nimport RenderNode from '../interfaces/renderNode';\nimport Operation, {\n  MoveNodeOperation,\n  OperationType,\n} from '../models/operation';\nimport Document from '../models/document';\nimport Path from '../models/path';\nimport Value, { ValueProperties } from '../models/value';\nimport Injection from '../models/injection';\nimport Decoration from '../models/decoration';\nimport Node from '../models/node';\nimport Element from '../models/element';\nimport Block from '../models/block';\nimport Text from '../models/text';\nimport Selection from '../models/selection';\nimport Mark from '../models/mark';\nimport Leaf from '../models/leaf';\nimport createContextMenuPlugin from '../plugins/contextMenu';\nimport createMobilePlugin from '../plugins/mobile';\nimport createQueriesPlugin from '../plugins/queries';\nimport createRenderNodePlugin from '../plugins/renderNode';\nimport createCommandsPlugin from '../plugins/commands';\nimport * as Commands from '../commands/index';\nimport createNormalizationPlugin, { Schema } from '../plugins/normalization';\nimport createCoreSchemaPlugin from '../plugins/coreSchema';\nimport createHistoryPlugin from '../plugins/history';\nimport createCorePlugin from '../plugins/core';\nimport createUUIDPlugin from '../plugins/uuid';\nimport createGroupPlugin from '../plugins/group';\nimport { IS_MOBILE, IS_TOUCH_DEVICE } from '../utils/environment';\nimport {\n  ChangeEventHandler,\n  ControllerOptions,\n  ControllerProperties,\n  OperationWithValue,\n  PendingType,\n  ShowCaretConfig,\n  Terminal,\n} from '../interfaces/controller';\nimport FlushTask, { FlushType } from '../utils/flushtask';\nimport { getChildrenDecorations } from '../utils/getChildrenOverlaps';\nimport getChildrenInjections from '../utils/getChildrenInjections';\nimport { CONTEXT_SPLIT } from '../utils/opContext';\nimport Change from '../interfaces/change';\nimport { Subject } from '../models/observable';\nimport { InputData } from '../interfaces/input';\nimport { SelectionData } from '../hooks/useSelectionData';\nimport PendingQueue from './pendingQueue';\nimport UserDataManager from './userData';\nimport { PerfType } from '../interfaces/perf';\nimport CangjiePerfEvent from '../events/cangjiePerf';\nimport { perfMark, perfMeasure } from '../utils/perf';\nimport { Hot } from '../interfaces/hot';\nimport { getHots, shouldDebounceFlush, shouldSuppressFlush } from './hots';\nimport isEventHandler from './utils/isEventHandler';\nimport VirtualizeManager from '../virtualize/virtualizeManager';\nimport { VirtualizeOptions } from '../virtualize/interface';\nimport type { RestParameters, RunParameters } from '../interfaces/utility';\nimport { Group } from '../interfaces/group';\nimport type {\n  ActionCreator,\n  ActionPredicate,\n  PluginActionCreators,\n  PluginActionPredicates,\n} from '../interfaces/action';\nimport GroupManager from './groupManager';\nimport { getInsivibleNodes } from '../utils/virtualize';\nimport { DEFAULT_BUFFER_RANGE, DEFAULT_FIRST_PAINT_BLOCK_SIZE } from '../virtualize/constants';\nimport { BaseMo, createBaseSerializer, createSerializer, Mo } from '../mo';\nimport { createSchema, createStrictSchema } from '../mo/schema/createSchema';\nimport useControllerStatic from './useControllerStatic';\nimport { UUIDConfig } from '../plugins/uuid/types';\n\nconst FieldsNotAffectSpace: Array<keyof ValueProperties> = [\n  'composing',\n  'isFocused',\n  'decorations',\n  'selection',\n  'remoteSelections',\n];\n\nconst OperationsNotAffectSpace: string[] = [\n  OperationType.InsertText,\n  OperationType.RemoveText,\n  OperationType.SetMark,\n  OperationType.AddMark,\n  OperationType.RemoveMark,\n  OperationType.SetSelection,\n];\n\nfunction isSetValueNotAffectSpace(key: keyof ValueProperties) {\n  return FieldsNotAffectSpace.includes(key);\n}\n\nfunction isOperationNotAffectSpace(operation: Operation) {\n  return OperationsNotAffectSpace.includes(operation.type);\n}\n\nexport function getDirtyKeysFromOperation(value: Value, operation: Operation) {\n  const {\n    type,\n    // @ts-ignore\n    path,\n    // @ts-ignore\n    node,\n  } = operation;\n  const { document } = value;\n  const opNode = node || document.getNodeByPath(path);\n  const opNodeKey = opNode?.key;\n\n  switch (type) {\n    // PERF: Cangjie does not support normalizing `text.text` `leaf.marks`, just ignore changes for performance(~10ms in Huge Document story)\n    // PERF: 🚫🚫🚫 No [...xxx]. Spread syntax will affect performance when huge node changed.\n    // Ref: packages/cangjie/src/plugins/schema.ts\n    // case 'add_mark':\n    // case 'insert_text':\n    // case 'remove_mark':\n    // case 'remove_text':\n    // case 'set_mark':\n    case OperationType.SetNode: {\n      const ancestors = document.getAncestorsByPath(path).map((n) => n?.key);\n      ancestors.push(opNodeKey);\n      return ancestors;\n    }\n\n    case OperationType.InsertNode: {\n      const table = Text.isText(node)\n        ? {}\n        : (node as Element).getKeysToEdgesTable();\n      const ancestors = document.getAncestorsByPath(path).map((n) => n?.key);\n      ancestors.push(node.key);\n      Array.prototype.push.apply(ancestors, Object.keys(table));\n      return ancestors;\n    }\n\n    case OperationType.SplitNode: {\n      const ancestors = document.getAncestorsByPath(path).map((n) => n?.key);\n      // @ts-ignore\n      const nextKey = document.getNextNodeByPath(path).key;\n      ancestors.push(opNodeKey, nextKey);\n      return ancestors;\n    }\n\n    case OperationType.MergeNode: {\n      const ancestors = Path.ancestors(path);\n      const previousPath = Path.decrement(path);\n      ancestors.push(previousPath);\n      return ancestors.map((p) => document.getNodeByPath(p)).map((n) => n?.key);\n    }\n\n    case OperationType.MoveNode: {\n      // Path is more accurate than key when node moved.\n      const { newPath } = operation as MoveNodeOperation;\n      if (Path.isEqual(path, newPath)) {\n        return [];\n      }\n\n      let parentPath = Path.parent(path);\n      let newParentPath = Path.parent(newPath);\n\n      // HACK: this clause only exists because the `move_path` logic isn't\n      // consistent when it deals with siblings.\n      if (!Path.isSibling(path, newPath)) {\n        if (newParentPath.length && Path.isYounger(path, newPath)) {\n          newParentPath = Path.decrement(newParentPath, 1, path.length - 1);\n        }\n        if (\n          parentPath.length &&\n          (Path.isYounger(newPath, path) || Path.isAncestor(newPath, path))\n        ) {\n          parentPath = Path.increment(parentPath, 1, newPath.length - 1);\n        }\n      }\n\n      const oldAncestors = Path.ancestors(parentPath);\n      const newAncestors = Path.ancestors(newParentPath);\n      oldAncestors.push(parentPath);\n      Array.prototype.push.apply(oldAncestors, newAncestors);\n      oldAncestors.push(newParentPath);\n      return oldAncestors\n        .map((p) => document.getNodeByPath(p))\n        .map((n) => n?.key);\n    }\n\n    case OperationType.RemoveNode: {\n      // The node has been deleted, ancestors connot be getted by \"document.getAncestors\"\n      const ancestors = Path.ancestors(path);\n      return ancestors.map((p) => document.getNodeByPath(p)).map((n) => n?.key);\n    }\n\n    default: {\n      return [];\n    }\n  }\n}\n\n/**\n * diff比较（严格：顺序改变算diff）\n * @param element\n * @param prevElement\n * @param curIndexKey\n * @param preIndexKey\n * @deprecated\n */\nexport function getDirtyKeysFromElementDiffStrictly(\n  element: Node,\n  prevElement: Node | null,\n  curIndexKey?: string,\n  preIndexKey?: string,\n) {\n  const dirtyKeys: string[] = [];\n  if (element === prevElement && curIndexKey === preIndexKey) {\n    return dirtyKeys;\n  }\n  dirtyKeys.push(element.key);\n  if (!Element.isElement(element)) {\n    return dirtyKeys;\n  }\n  if (!Element.isElement(prevElement)) {\n    return Object.keys(element.getKeysToEdgesTable()).concat(element.key);\n  }\n  for (let i = 0; i < element.nodes.length; i += 1) {\n    const child = element.nodes[i];\n    const prevChild = prevElement.getNode(child.key);\n    const preChildIndexKey = prevElement?.nodes[i]?.key;\n    if (child !== prevChild || child.key !== preChildIndexKey) {\n      dirtyKeys.push(\n        ...getDirtyKeysFromElementDiffStrictly(\n          child,\n          prevChild,\n          child.key,\n          preChildIndexKey,\n        ),\n      );\n    }\n  }\n  return dirtyKeys;\n}\n\nfunction getDirtyKeysFromElementDiff(element: Node, prevElement: Node | null) {\n  const dirtyKeys: string[] = [];\n  if (element === prevElement) {\n    return dirtyKeys;\n  }\n  dirtyKeys.push(element.key);\n  if (!Element.isElement(element)) {\n    return dirtyKeys;\n  }\n  if (!Element.isElement(prevElement)) {\n    return Object.keys(element.getKeysToEdgesTable()).concat(element.key);\n  }\n  for (let i = 0; i < element.nodes.length; i += 1) {\n    const child = element.nodes[i];\n    const prevChild = prevElement.getNode(child.key);\n    if (child !== prevChild) {\n      getDirtyKeysFromElementDiff(child, prevChild).forEach((key) =>\n        dirtyKeys.push(key));\n    }\n  }\n  return dirtyKeys;\n}\n\ninterface ViewData {\n  decorations: Decoration[];\n  injections: Injection[];\n}\n\nconst composingMark = Mark.create('cangjieComposing');\n\ninterface PerfStart {\n  timestamp: number;\n  type: PerfType;\n  subtype: string;\n  ignore?: boolean; // 是否需要忽略不计该数据\n}\n\ninterface Perf {\n  /** 输入开始的 timestamp */\n  [PerfType.input]: PerfStart[];\n  /** 输入法更新时的 timestamp */\n  [PerfType.composing]: PerfStart[];\n  /** 选区事件开始时的 timestamp */\n  [PerfType.selection]: PerfStart[];\n}\n\ntype ScrollType =\n  | /** default: 跟随选区滚动 */\n  'toSelection'\n  /** 保持当前滚动位置稳定，一般是一次性的，消费过该数据后应置回 default 值 */\n  | 'maintain';\n\nexport const defaultScrollType: ScrollType = 'toSelection';\n\ninterface Virtualize {\n  /** 当前可见的元素集合 */\n  visibles: string[];\n  /** 当前正在调度的不可见节点模型计算 */\n  invisibleCalculationId: null | number;\n}\n\ninterface Flag {\n  normalizing: boolean;\n  pending: boolean;\n  saving: boolean;\n  /**\n   * 编辑器 OP 跟踪\n   */\n  tracking: boolean;\n  withCommand: boolean;\n  destroyed: boolean;\n  perf: Perf;\n  /**\n   * 页面滚动方式\n   * BACKGROUND:\n   * 1. 本地用户操作时，需要跟随选区滚动\n   * 2. 协同数据应用后，需要保持本地状态稳定\n   */\n  scrollType: ScrollType;\n  // 标记有关联关系的 OPs，解决 undo/redo 多次问题\n  // 一般使可用 node.key 作为 relatedId\n  opRelatedId: string | null;\n}\n\nexport function insertComposingIntoLeaves(\n  leaves: Leaf[],\n  offset: number,\n  composing: string,\n  selection: Selection,\n  decorations: Decoration[],\n) {\n  const [before, after] = Leaf.splitLeaves(leaves, offset);\n  const beforeLastLeaf = before[before.length - 1];\n  const beforeLastMarks = beforeLastLeaf ? beforeLastLeaf.marks : [];\n  let marks: Mark[] | null = null;\n  if (selection.marks) {\n    const decorationsMarks = decorations.map(({ mark }) => mark);\n    const activeDecorationsMarks = beforeLastMarks.filter((mark) =>\n      decorationsMarks.some((m) => equal(m, mark)));\n    marks = [...activeDecorationsMarks, ...selection.marks];\n  } else {\n    marks = beforeLastMarks;\n  }\n\n  const middle = Leaf.create({\n    text: composing,\n    marks: [...marks, composingMark],\n  });\n  const shouldConcatBefore = before.length > 1 || before[0]?.text;\n  const shouldConcatAfter = after.length > 1 || after[0]?.text;\n  return [\n    ...(shouldConcatBefore ? before : []),\n    middle,\n    ...(shouldConcatAfter ? after : []),\n  ];\n}\n\nconst DEFAULT_VIRTUALIZE_OPTIONS: Required<VirtualizeOptions> = {\n  enable: false,\n  enableOnDemandViewCalculation: true,\n  pendingDebounceTime: 500,\n  invisibleCalculationDebounceTime: 500,\n  maxOPsForHotsAnalyze: 10,\n  bufferRange: DEFAULT_BUFFER_RANGE,\n  firstPaintBlockSize: DEFAULT_FIRST_PAINT_BLOCK_SIZE,\n  disableViewVirtualize: false,\n};\n\nexport default class Controller {\n  static useController = useController;\n  static useControllerStatic = useControllerStatic;\n\n  /**\n   * 内部使用了[[Controller.useController]]，把Wrapper封装为一个高阶组件，并传入controller\n   */\n  static connectController = connectController;\n\n  /**\n   * 构建一个新的Controller对象\n   * @param props 构建参数\n   * @param options 构建选项\n   */\n  static create(props: ControllerProperties, options?: ControllerOptions) {\n    return new Controller(props, options);\n  }\n\n  private flag: Flag = {\n    normalizing: true,\n    pending: true,\n    saving: true,\n    /**\n     * @experimental\n     */\n    tracking: true,\n    withCommand: false,\n    destroyed: false,\n    perf: {\n      input: [],\n      composing: [],\n      selection: [],\n    },\n    scrollType: defaultScrollType,\n    opRelatedId: null,\n  };\n\n  private readonly VIEW_CACHE = {\n    /** 内存模型缓存 */\n    VALUE: new WeakSet<Value>(),\n    /** 节点视图模型缓存，若节点的视图数据不变，则复用缓存，避免计算 */\n    ELEMENT: new WeakMap<\n    Element,\n    // 视图模型、decorations，injections，composing\n    [Element, Decoration[], Injection[], string]\n    >(),\n    /** 已装饰的节点，key 为节点数据模型，value 为视图数据 */\n    DECORATED_ELEMENT: new WeakMap<Element, [Element, ViewData]>(),\n    /** 已注入数据的节点缓存，key 为分组节点，value 为 [注入数据的节点，节点被注入的 injections] */\n    INJECTED_ELEMENT: new WeakMap<Element, [Element, Injection[]]>(),\n    /** 分组节点缓存，key 装饰后的及节点视图，value 为分组节点 */\n    GROUPED_ELEMENT: new WeakMap<Element, Element>(),\n    /** 文本节点缓存 */\n    TEXT: new WeakMap<Text, [Text, Leaf[]]>(),\n    /** 叶子节点缓存 */\n    LEAVES: new WeakMap<Leaf[], [Leaf[], Decoration[]]>(),\n    /** 数据节点调用 `decorateNode` 结果缓存 */\n    DECORATE_NODE: new WeakMap<Element, Decoration[]>(),\n    /** 数据节点调用 `injectToNode` 结果缓存 */\n    INJECT_TO_NODE: new WeakMap<Element, Injection[]>(),\n    /** 节点视图模型缓存 */\n    DATA: new WeakMap<Node, ViewData>(),\n    /** 视图节点最终被注入的 injections, decorations 缓存  */\n    INJECT_TO_VIEW_ELEMENT: new WeakMap<\n    Element,\n    { decorations: Decoration[]; injections: Injection[] }\n    >(),\n    /** 视图文本节点最终被注入的 decorations 缓存 */\n    INJECT_TO_VIEW_TEXT: new WeakMap<Text, { decorations: Decoration[] }>(),\n    /** 节点选中态计算缓存 */\n    IS_SELECTED: new Set<string>(),\n    /** 为计算过视图模型的节点 */\n    VIEW_NEVER_CALCULATED: new Set<string>(),\n  };\n\n  private readonly dirtyKeys: Set<string> = new Set();\n\n  private readonly context: string[] = [];\n\n  /**\n   * 业务ID。业务方自行通过constructor设置、自行使用\n   */\n  public readonly biz: string;\n\n  /**\n   * 展示相应 uid 下的用户数据\n   */\n  public uid?: string;\n\n  /**\n   * 用户数据\n   */\n  public userData = new UserDataManager(this);\n\n  /**\n   * 输入数据流\n   */\n  public inputData$ = new Subject<InputData>();\n\n  /**\n   * 选区变化数据流\n   */\n  public selectionData$ = new Subject<SelectionData>();\n\n  /**\n   * hots 流\n   */\n  public hots$ = new Subject<Hot[]>();\n\n  /**\n   * pending 停止信号\n   */\n  public terminal$ = new Subject<Terminal | null>();\n\n  public virtualizeManager: VirtualizeManager | null = null;\n  /** serializer */\n  public readonly serializer: Mo;\n  public readonly baseSerializer: BaseMo;\n\n  /** schema */\n  public readonly schema: Schema;\n  public readonly strictSchema: Schema;\n\n  // @ts-ignore\n  private $value: Value = null;\n\n  private $viewDoc: Document | null = null;\n\n  private $scrollableContainer: Window | HTMLElement | null = null;\n\n  /**\n   * 文档的数据[[Value]]对象，参照[[ControllerProperties]]\n   */\n  public get value() {\n    return this.$value;\n  }\n\n  private $operations: Operation[] = [];\n\n  private $operationWithValues: OperationWithValue[] = [];\n\n  /**\n   * 获取当前的历史operations\n   */\n  public get operations() {\n    return this.$operations;\n  }\n\n  private readonly onChange: ChangeEventHandler;\n\n  private commands: Record<string, Command> = {};\n  private queries: Record<string, Query> = {};\n  private actions: Record<string, ActionCreator> = {};\n  private isActions: Record<string, ActionPredicate> = {};\n  private handlers: Record<string, Function[]> = {};\n  private renderNodes: Record<string, RenderNode[]> = {};\n\n  /**\n   * flush 的调度方法\n   */\n  private readonly flushType: FlushType;\n\n  /**\n   * flush 任务，这个方法主要处理一些需要手动 flush 的场景，手动 flush 会取消当前正在 pending 中的 task，防止二次 flush\n   */\n  private flushTask: FlushTask | null = null;\n\n  /**\n   * Only disable copy on readOnly mode\n   */\n  public canCopy: boolean;\n\n  public readonly readOnly: boolean;\n\n  public readonly autoFocus: boolean;\n\n  public hideSelectionOnBlur?: boolean;\n\n  public showCaret?: ShowCaretConfig;\n\n  public testType?: PendingType;\n\n  private readonly onBusyStateChange?: (isBusy: boolean) => void;\n\n  private readonly pendingQueue: PendingQueue;\n\n  private virtualizeOptions: VirtualizeOptions;\n\n  private debouncedFlush: ReturnType<typeof debounce>;\n\n  private debouncedStartInvisibleCalculationScheduler: ReturnType<\n    typeof debounce\n  >;\n\n  public groupManager = new GroupManager(this);\n\n  private readonly onPending: (value: Value) => void;\n\n  private readonly uuidConfig: Pick<UUIDConfig, 'enable'>;\n\n  /** 热区 */\n  public hots: {\n    /** 热区序列 */\n    hots: Hot[];\n    /** PERF: 保存热区节点 key，加快热区判定效率 */\n    keys: Record<string, true>;\n    /** 存在 Pending 的变更时，被 Pending 的操作类型 */\n    pendingType: PendingType | null;\n    /** 上一次 pending 的 op 规模 */\n    lengthOfPending: number;\n    /** 必须重新计算 node view */\n    forceRecalculate: boolean;\n  } = {\n    hots: [],\n    keys: {},\n    pendingType: null,\n    lengthOfPending: 0,\n    forceRecalculate: false,\n  };\n\n  private virtualize: Virtualize = {\n    visibles: [],\n    invisibleCalculationId: null,\n  };\n\n  public visibles$ = new Subject<string[]>();\n\n  private registerPlugin(plugin: Plugin | Plugin[]) {\n    if (Array.isArray(plugin)) {\n      plugin.forEach((p) => this.registerPlugin(p));\n      return;\n    }\n\n    const {\n      commands: cmds,\n      actions,\n      isActions,\n      queries,\n      renderNode,\n      schema: pluginSchema,\n      ...rest\n    } = plugin;\n    if (cmds) {\n      // NOTE: `commands` which has registered will have higher priority.\n      this.commands = Object.assign({}, cmds, this.commands);\n    }\n    if (actions) {\n      this.actions = Object.assign({}, actions, this.actions);\n    }\n    if (isActions) {\n      this.isActions = Object.assign({}, isActions, this.isActions);\n    }\n    if (queries) {\n      // NOTE: `queries` which has registered will have higher priority.\n      Object.keys(queries).forEach((query) => {\n        const prevQuery = this.queries[query];\n        const nextQuery = queries[query];\n        if (!prevQuery) {\n          this.queries[query] = nextQuery;\n          return;\n        }\n        this.queries[query] = (...args) => {\n          const ret = prevQuery(...args);\n          return ret === undefined ? nextQuery(...args) : ret;\n        };\n      });\n    }\n    if (renderNode) {\n      if (typeof renderNode === 'function') {\n        if (!this.handlers.renderNode) {\n          this.handlers.renderNode = [];\n        }\n        this.handlers.renderNode.push(renderNode);\n      } else {\n        Object.keys(renderNode).forEach((nodeType) => {\n          if (!this.renderNodes[nodeType]) {\n            this.renderNodes[nodeType] = [renderNode[nodeType]];\n          } else {\n            this.renderNodes[nodeType].push(renderNode[nodeType]);\n          }\n        });\n      }\n    }\n    if (pluginSchema) {\n      this.registerPlugin(createNormalizationPlugin(pluginSchema));\n    }\n\n    Object.keys(rest).forEach((key) => {\n      if (!this.handlers[key]) {\n        this.handlers[key] = [];\n      }\n      this.handlers[key].push(plugin[key]);\n    });\n  }\n\n  private constructor(\n    props: ControllerProperties,\n    options?: ControllerOptions,\n  ) {\n    const {\n      biz = 'cangjie',\n      dataUid,\n      plugins = [],\n      value,\n      onChange = () => { },\n      readOnly,\n      canCopy = true,\n      autoFocus,\n      flushType = 'microtask',\n      configs,\n      onBusyStateChange,\n      onPending,\n    } = props;\n    this.biz = biz;\n    this.setUid(dataUid);\n    this.onChange = (change: Change) => {\n      onChange(change);\n    };\n\n    this.readOnly = !!readOnly;\n    this.autoFocus = !!autoFocus;\n    this.showCaret = options?.showCaret;\n    this.canCopy = canCopy;\n    this.flushType = flushType;\n    this.onBusyStateChange = onBusyStateChange;\n    this.onPending = onPending || noop;\n\n    let {\n      enablePending = false,\n      virtualize = DEFAULT_VIRTUALIZE_OPTIONS,\n    } = options || {};\n    // 虚拟化和 OP Pending 互斥\n    if (virtualize.enable) {\n      enablePending = false;\n    }\n    if (enablePending) {\n      virtualize.enable = false;\n    }\n    const { __pendingQueue__ = {}, hideSelectionOnBlur = false, uuid = { enable: false } } =\n      options || {};\n    this.hideSelectionOnBlur = hideSelectionOnBlur;\n    this.pendingQueue = PendingQueue.create({\n      debounceTime: 500,\n      ...__pendingQueue__,\n      controller: this,\n      enablePending,\n    });\n    this.virtualizeOptions = virtualize;\n    this.virtualizeOptions = {\n      ...DEFAULT_VIRTUALIZE_OPTIONS,\n      ...virtualize,\n    };\n    this.debouncedFlush = debounce(this.flush, this.virtualizeOptions.pendingDebounceTime);\n    this.debouncedStartInvisibleCalculationScheduler = debounce(\n      this.startInvisibleCalculationScheduler,\n      this.virtualizeOptions.invisibleCalculationDebounceTime,\n    );\n\n    if (IS_MOBILE || IS_TOUCH_DEVICE) {\n      this.registerPlugin(createMobilePlugin(configs));\n    }\n\n    if (uuid.enable && !uuid.gen) {\n      throw new Error('[Cangjie-UUID]: Missing uuid generator');\n    }\n\n    this.uuidConfig = {\n      enable: uuid.enable,\n    };\n\n    // Step 1: collect `commands` & `queries` from `plugins`.\n    this.registerPlugin([\n      createCoreSchemaPlugin(),\n      createGroupPlugin(),\n      ...plugins,\n      (uuid.enable && !!uuid.gen) ? createUUIDPlugin(uuid) : {},\n      createHistoryPlugin(configs),\n      createCorePlugin(),\n      createContextMenuPlugin(configs),\n    ]);\n    // Step 2: wrap `commands` & `queries` into `onCommand` & `onQuery` respectively.\n    this.registerPlugin([\n      createCommandsPlugin({ ...Commands, ...this.commands }),\n      createQueriesPlugin({\n        isAtomic: () => false,\n        isEmpty: (_, block) => isEmpty(block),\n        isVoid: () => false,\n        ...this.queries,\n      }),\n      createRenderNodePlugin(this.renderNodes),\n    ]);\n    /**\n     * schema and serializer: used by other plugins(like clipboard) to deal with model normalize and serialization\n     */\n    // step 3: create serializer\n    this.serializer = createSerializer(plugins as any); // 迁移期间，原 Plugin 定义不能加 key，待迁移完成再去掉 as any\n    this.baseSerializer = createBaseSerializer(plugins as any);\n\n    // step 4: create schema\n    this.schema = createSchema(plugins as any);\n    this.strictSchema = createStrictSchema(plugins as any);\n\n    this.setValue(value, options);\n    if (virtualize.enable && !virtualize.disableViewVirtualize) {\n      this.virtualizeManager = new VirtualizeManager(this, virtualize as unknown as VirtualizeOptions);\n    }\n    this.run('onConstruct');\n  }\n\n  public setReadOnly(readOnly: boolean) {\n    // @ts-ignore Internal set only\n    this.readOnly = readOnly;\n  }\n\n  /**\n   * 设置一个新的value对象\n   * @param value 新的value对象\n   * @param options 设置选项\n   */\n  public setValue(\n    value: Value,\n    options?: ControllerOptions & {\n      clearOperations?: boolean;\n      clearHots?: boolean;\n    },\n  ) {\n    const {\n      clearOperations = true,\n      clearHots = true,\n      normalize = value !== this.value,\n    } = options || {};\n\n    // this.value 初始值为 null\n    const prevDocument = this.value?.document;\n    const prevSelection = this.value?.selection;\n\n    this.$value = value;\n    if (clearOperations) {\n      this.$operations = [];\n    }\n\n    if (clearHots) {\n      this.clearHots();\n    }\n\n    // Next Value\n    const { document, selection } = this.value;\n\n    // document 变更\n    if (normalize && !equal(document, prevDocument)) {\n      const dirtyKeys = prevDocument\n        ? getDirtyKeysFromElementDiff(document, prevDocument)\n        : Object.keys(document.getKeysToEdgesTable()).concat(document.key);\n      dirtyKeys.forEach((key) => {\n        this.dirtyKeys.add(key);\n      });\n      this.withoutTracking(() => this.normalizeDirtyKeys());\n    }\n\n    // selection 变更\n    if (normalize && !equal(selection, prevSelection)) {\n      this.normalizeSelection();\n    }\n    return this;\n  }\n\n  private setValueField<T extends keyof ValueProperties>(\n    key: T,\n    value: Required<ValueProperties>[T],\n  ) {\n    const beforeSetValue = this.value;\n    // @ts-ignore\n    this.setValue(this.value.set(key, value), {\n      normalize: false,\n      clearOperations: false,\n      clearHots: false,\n    });\n    this.$operationWithValues.push({\n      operation: null,\n      key,\n      value: beforeSetValue,\n      newValue: this.value,\n    });\n    this.scheduleFlush();\n    return this;\n  }\n\n  /**\n   * 重置编辑器的 value，服务于受控组件的 `props.value` 变化时\n   * `controller.resetValue(value)` 内部将驱动各个插件在重置 value 时所要完成的任务或者副作用\n   * @param value\n   * @param options\n   */\n  public resetValue(value: Value, options?: ControllerOptions) {\n    const controllerValue = this.value;\n    this.setValue(value, options);\n    this.run('onResetValue', value, controllerValue);\n  }\n\n  /**\n   * 1. 设置Value的data字段\n   * 2. 并更新Value\n   * 3. 调用flush刷新\n   */\n  public setData(data: Data) {\n    return this.setValueField('data', data);\n  }\n\n  /**\n   * 1. 设置Value的injection字段\n   * 2. 并更新Value\n   * 3. 调用flush刷新\n   */\n  public setInjections(injections: Injection[]) {\n    return this.setValueField('injections', injections);\n  }\n\n  /**\n   * 1. 设置Value的decoration字段\n   * 2. 并更新Value\n   * 3. 调用flush刷新\n   */\n  public setDecorations(decorations: Decoration[]) {\n    return this.setValueField('decorations', decorations);\n  }\n\n  public setComposing = (composing: string) => {\n    return this.setValueField('composing', composing);\n  };\n\n  public setIsFocused = (isFocused: boolean) => {\n    return this.setValueField('isFocused', isFocused);\n  };\n\n  /**\n   * 依次调用所有plugin的key字段，并传入下方的args字段，以及controller和next\n   * @param key 对应plugin的key字段\n   * @param args 传入plugin的参数\n   */\n  run<\n    K extends keyof Omit<\n    Plugin,\n    | 'commands'\n    | 'actions'\n    | 'isActions'\n    | 'queries'\n    | 'schema'\n    | 'models'\n    | 'toolbar'\n    >,\n  >(\n    key: K,\n    ...args: RunParameters<Required<Plugin>[K]>\n  ): ReturnType<\n    Required<Omit<Plugin, 'renderNode'> & { renderNode: RenderNode }>[K]\n    > {\n    const fns = this.handlers[key];\n\n    if (!fns) {\n      // @ts-ignore\n      return null;\n    }\n\n    const controller = this;\n\n    let i = 0;\n    let prevArgs = args;\n    function next(...as) {\n      // PERF\n      const currentArgs =\n        as.length === 0 ? prevArgs : [...as, ...prevArgs.slice(as.length)];\n      // @ts-ignore\n      prevArgs = currentArgs;\n\n      const fn = fns[i];\n      if (!fn) {\n        return null;\n      }\n      i += 1;\n      // PERF\n      switch (currentArgs.length) {\n        case 0:\n          return fn(controller, next);\n        case 1:\n          return fn(currentArgs[0], controller, next);\n        case 2:\n          return fn(currentArgs[0], currentArgs[1], controller, next);\n        default:\n          return fn(...currentArgs, controller, next);\n      }\n    }\n\n    if (isEventHandler(key)) {\n      const prevWithCommand = this.flag.withCommand;\n      this.flag.withCommand = true;\n      const ret = next();\n      this.flag.withCommand = prevWithCommand;\n      return ret;\n    }\n    return next();\n  }\n\n  /**\n   * 执行刷新操作。这里会调用normalize，并执行onChange Plugin和onChange回调\n   */\n  public flush() {\n    if (this.flag.destroyed) {\n      return this;\n    }\n    this.run('onChange');\n    this.normalizeSelection();\n    const { value, operations } = this;\n    const change = { value, operations };\n    this.$operations = [];\n    this.pendingQueue.clear();\n    this.hots.lengthOfPending = 0;\n    this.perfClearAll();\n    this.hots.pendingType = null;\n    this.debouncedFlush.cancel();\n\n    // 先取消 task，再置空\n    if (this.flushTask) {\n      this.flushTask.cancel();\n      this.flushTask = null;\n    }\n    this.$operationWithValues = [];\n    this.onChange(change);\n    this.onBusyStateChange?.(!!this.query('isEditorBusy'));\n    this.groupManager.notifyNewGroups();\n    return this;\n  }\n\n  /**\n   * 调度执行 flush，在微任务中执行\n   */\n  private scheduleFlush() {\n    // 如果 task 不存在则创建\n    if (!this.flushTask) {\n      this.flushTask = FlushTask.create(\n        () => {\n          // 在下一次任务调度时，判断 operations 是否需要 pending 或 hots\n          // 重置 flush task，使下一个周期内的 operations 能被 pending 判定\n          if (this.flushTask) {\n            this.flushTask!.cancel();\n            this.flushTask = null;\n          }\n\n          // 获得 flush task 周期内产生的热区\n          if (this.enableHots) {\n            const flushContext = {\n              operations: this.$operationWithValues,\n              value: this.$value,\n            };\n\n            const suppressed = shouldSuppressFlush(flushContext);\n            const debounced = !suppressed\n              ? shouldDebounceFlush(flushContext)\n              : null;\n            if (suppressed) {\n              // 是否抑制 Flush\n              // PERF：更新时沿用计算好的热区\n              this.setHots(\n                this.hots.pendingType === suppressed && this.hots.hots.length\n                  ? this.hots.hots\n                  : getHots(this.$operationWithValues, this),\n                suppressed,\n              );\n              this.onPending(this.$value);\n            } else if (debounced) {\n              // 是否 Debounce Flush\n              this.setHots(\n                getHots(\n                  this.$operationWithValues.slice(this.hots.lengthOfPending),\n                  this,\n                ),\n                debounced,\n              );\n              this.onPending(this.$value);\n              this.debouncedFlush();\n            } else {\n              this.setHots([], null);\n              this.flush();\n            }\n          } else if (this.isPendingEnable) {\n            // 需要 pending\n            this.pendingQueue.queue(\n              this.$operationWithValues.slice(this.pendingQueue.size()),\n            );\n          } else {\n            // 不需要 pending，立即 flush 堆积的 operations\n            this.flush();\n          }\n          this.onBusyStateChange?.(!!this.query('isEditorBusy'));\n        },\n        {\n          flushType: this.flushType,\n        },\n      ).start();\n    }\n  }\n\n  private transformDirtyKey(operation: Operation) {\n    if (operation.type === 'split_node') {\n      // @ts-ignore\n      const { node, path } = operation;\n      const operationNode = node || this.value.document.getNodeByPath(path);\n      if (this.dirtyKeys.has(operationNode?.key)) {\n        const extraDirty = this.value.document.getNodeByPath(\n          Path.increment(path),\n        );\n        if (extraDirty) {\n          this.dirtyKeys.add(extraDirty.key);\n        }\n      }\n    }\n  }\n\n  /**\n   * Apply operation directly\n   * @param operation\n   * @returns\n   */\n  private privateApplyOperation(op: Operation) {\n    // PERF: 无 Context 时，不向 OP 注入 `context`\n    const opWithContext = this.context.length ? {\n      ...op,\n      context: this.context.join(CONTEXT_SPLIT),\n    } : op;\n    const operation = this.run('mapOperation', opWithContext);\n    const beforeApplyValue = this.value;\n\n    this.$value = this.value.applyOperation(operation);\n    const operationWithValue = {\n      operation,\n      value: beforeApplyValue,\n      newValue: this.value,\n    };\n    this.$operationWithValues.push(operationWithValue);\n    this.groupManager.regenerateGroup(operationWithValue);\n    this.operations.push(operation);\n    const dirtyKeysFromOp = getDirtyKeysFromOperation(this.value, operation);\n    dirtyKeysFromOp.forEach((key) => {\n      if (key) {\n        this.dirtyKeys.add(key);\n      }\n    });\n    this.transformDirtyKey(operation);\n    this.scheduleFlush();\n    this.userData.flush([operation]);\n\n    return this;\n  }\n\n  /**\n   * 执行单个Operation\n   * @param operation 需要执行的operation\n   */\n  public applyOperation(operation: Operation) {\n    if (this.flag.tracking) {\n      // 插件内部不允许嵌套执行\n      this.withoutTracking(() => this.run('onApplyOperation', operation));\n      return this;\n    }\n    return this.privateApplyOperation(operation);\n  }\n\n  private normalizeNodeByKey(key: string) {\n    let node = this.value.document.getNode(key);\n    if (!node) return;\n\n    let iterations = 0;\n\n    let childrenLength = 1;\n    if (!Text.isText(node)) {\n      if (Element.isElement(node)) {\n        childrenLength = node.nodes.length;\n      } else {\n        throw new Error(\n          'Unknown node, this is probably caused by multiple instances of Cangjie.',\n        );\n      }\n    }\n\n    const max = 100 + childrenLength;\n    while (node) {\n      const fn = this.run('normalizeNode', node);\n      if (!fn) {\n        break;\n      }\n      this.withCommand(fn);\n\n      const newValue = this.value;\n      const newDocument = newValue.document;\n      let found = newDocument.getNode(node.key);\n      if (found && found.key === node.key) {\n        node = found;\n      } else {\n        found = newDocument.getNode(node.key);\n        if (found) {\n          node = found;\n        } else {\n          break;\n        }\n      }\n\n      // eslint-disable-next-line no-plusplus\n      iterations++;\n\n      if (iterations > max) {\n        throw new Error(\n          'A schema rule could not be normalized after sufficient iterations. This is usually due to a `rule.normalize` or `plugin.normalizeNode` function of a schema being incorrectly written, causing an infinite loop.',\n        );\n      }\n    }\n  }\n\n  private normalizeDirtyKeys() {\n    if (!this.flag.normalizing || !this.dirtyKeys.size) {\n      return;\n    }\n\n    this.withoutNormalizing((self) => {\n      while (self.dirtyKeys.size) {\n        self.dirtyKeys.forEach((key) => {\n          self.dirtyKeys.delete(key);\n          this.normalizeNodeByKey(key!);\n        });\n      }\n    });\n  }\n\n  private normalizeSelection() {\n    const { document, selection } = this.value;\n    const { anchor, focus } = selection;\n    const anchorNode = document.getNode(anchor.key);\n    const focusNode = document.getNode(focus.key);\n    if (!anchorNode || !focusNode) {\n      this.command(Commands.moveToStartOfDocument);\n    } else {\n      if (anchor.isTextPoint() && anchor.offset > anchorNode.text.length) {\n        this.command(Commands.moveAnchorToEndOfNode, anchorNode);\n      }\n      if (focus.isTextPoint() && focus.offset > focusNode.text.length) {\n        this.command(Commands.moveFocusToEndOfNode, focusNode);\n      }\n    }\n  }\n\n  private groupNodes(\n    range: [number, number],\n    parent: Document | Block,\n    groups: Block[] = [],\n  ) {\n    const groupedNodes: Block[] = [];\n    let remainedRange = range;\n    let isChildrenGrouped = false;\n    while (remainedRange[0] < remainedRange[1]) {\n      const [start] = remainedRange;\n      const first = parent.nodes[start];\n      const { node, remainedRange: remained } = this.run(\n        'groupNodes',\n        remainedRange,\n        { parent, groups },\n      );\n      if (node !== first) {\n        isChildrenGrouped = true;\n        const maybeNestedGroup = node.merge({\n          nodes: this.groupNodes([start, remained[0]], parent, [\n            ...groups,\n            node,\n          ]),\n        });\n        groupedNodes.push(maybeNestedGroup);\n        if (\n          !maybeNestedGroup.nodes[0] &&\n          process.env.NODE_ENV === 'development'\n        ) {\n          throw new Error(\n            'Cangjie.Plugin[groupNodes] expect return non-empty group.',\n          );\n        }\n      } else {\n        groupedNodes.push(node);\n      }\n      remainedRange = remained;\n    }\n    const lastGroup = groups[groups.length - 1] || parent;\n    if (isChildrenGrouped) {\n      // 如果分组可见，需保证分组下的不可见节点的视图模型被成功计算\n      if (this.enableOnDemandViewCalculation) {\n        return groupedNodes.map(node => this.calculateViewInVisibleNode(node));\n      }\n      return groupedNodes;\n    }\n    return isChildrenGrouped ? groupedNodes : lastGroup.nodes;\n  }\n\n  private toViewText(text: Text, decorations: Decoration[]) {\n    this.VIEW_CACHE.VIEW_NEVER_CALCULATED.delete(text.key);\n    const { selection, composing } = this.value;\n    const { anchor: point } = selection;\n    const isCollapsedInText =\n      selection.isCollapsed && point.isTextPoint() && point.key === text.key;\n    if (!decorations.length && (!isCollapsedInText || !composing)) {\n      return text;\n    }\n\n    // split leaves\n    let { leaves } = text;\n    if (decorations.length) {\n      const [cachedViewLeaves, cachedDepDecorations] =\n        this.VIEW_CACHE.LEAVES.get(leaves) || [];\n      if (cachedViewLeaves && equal(cachedDepDecorations, decorations)) {\n        leaves = cachedViewLeaves;\n      } else {\n        const viewLeaves = text.getLeaves(decorations);\n        this.VIEW_CACHE.LEAVES.set(leaves, [viewLeaves, decorations]);\n        leaves = viewLeaves;\n      }\n    }\n    if (isCollapsedInText && composing && point.isTextPoint()) {\n      const hasComposingLeaf = leaves.some((leaf) =>\n        leaf.marks.some((mark) => mark.type === 'cangjieComposing'));\n      if (!hasComposingLeaf) {\n        leaves = insertComposingIntoLeaves(\n          leaves,\n          point.offset,\n          composing,\n          selection,\n          decorations,\n        );\n      }\n    }\n\n    const [cachedViewText, cachedDepLeaves] =\n      this.VIEW_CACHE.TEXT.get(text) || [];\n    if (cachedViewText && equal(cachedDepLeaves, leaves)) {\n      return cachedViewText;\n    }\n    const viewText = text.set('leaves', leaves);\n    this.VIEW_CACHE.TEXT.set(text, [viewText, leaves]);\n    this.VIEW_CACHE.DATA.set(viewText, { decorations, injections: [] });\n    this.VIEW_CACHE.INJECT_TO_VIEW_TEXT.set(viewText, { decorations });\n    return viewText;\n  }\n\n  private toViewElement(\n    element: Element,\n    decorations: Decoration[],\n    injections: Injection[],\n    /** 若当前节点可见，则其子孙节点也被认为可见 */\n    isNodeVisible = false,\n  ) {\n    this.VIEW_CACHE.VIEW_NEVER_CALCULATED.delete(element.key);\n    const { document, selection, composing } = this.value;\n    const { anchor: point } = selection;\n    const isCollapsedInElement =\n      selection.isCollapsed &&\n      point.isTextPoint() &&\n      !!element.getKeysToEdgesTable()[point.key];\n    const isCollapsedInEmptyElement = isCollapsedInElement && element.isEmpty();\n    const computedComposing = isCollapsedInElement ? composing : '';\n    const [viewElement, prevDecorations, prevInjections, prevComposing] =\n      this.VIEW_CACHE.ELEMENT.get(element) || [];\n    if (\n      viewElement &&\n      equal(decorations, prevDecorations) &&\n      equal(injections, prevInjections) &&\n      computedComposing === prevComposing &&\n      !isCollapsedInEmptyElement\n    ) {\n      return viewElement;\n    }\n\n    let nodeDecorations = this.VIEW_CACHE.DECORATE_NODE.get(element);\n    if (isCollapsedInEmptyElement || !nodeDecorations) {\n      nodeDecorations = this.run('decorateNode', element);\n    }\n    this.VIEW_CACHE.DECORATE_NODE.set(element, nodeDecorations);\n    const allDecorations = nodeDecorations.length\n      ? nodeDecorations.concat(decorations)\n      : decorations;\n\n    let nodeInjections = this.VIEW_CACHE.INJECT_TO_NODE.get(element);\n    if (isCollapsedInEmptyElement || !nodeInjections) {\n      nodeInjections = this.run('injectToNode', element);\n    }\n    this.VIEW_CACHE.INJECT_TO_NODE.set(element, nodeInjections);\n    const allInjections = nodeInjections.length\n      ? nodeInjections.concat(injections)\n      : injections;\n\n    const selfInjections: Injection[] = [];\n    const descendantsInjections: Injection[] = [];\n    allInjections.forEach((injection) => {\n      if (injection.key === element.key) {\n        selfInjections.push(injection);\n      } else {\n        descendantsInjections.push(injection);\n      }\n    });\n\n    let decoratedElement = element;\n    const [cachedDecoratedElement, cachedDepsData] =\n      this.VIEW_CACHE.DECORATED_ELEMENT.get(element) || [];\n    const depsData = {\n      decorations: allDecorations,\n      injections: descendantsInjections,\n      composing: computedComposing,\n    };\n    if (cachedDecoratedElement && equal(cachedDepsData, depsData)) {\n      decoratedElement = cachedDecoratedElement;\n    } else {\n      // delegate view data to children\n      const childrenDecorations = allDecorations.length\n        ? getChildrenDecorations(document, element, allDecorations)\n        : null;\n      const childrenInjections = descendantsInjections.length\n        ? getChildrenInjections(document, element, descendantsInjections)\n        : null;\n      let isChildrenDecorated = false;\n      const decoratedNodes = element.nodes.map((child, index) => {\n        const decoratedChild = this.toView(\n          child,\n          childrenDecorations ? childrenDecorations[index] : [],\n          childrenInjections ? childrenInjections[index] : [],\n          isNodeVisible,\n        );\n        isChildrenDecorated = isChildrenDecorated || decoratedChild !== child;\n        return decoratedChild;\n      });\n      const decorated = isChildrenDecorated\n        ? element.set('nodes', decoratedNodes)\n        : element;\n      this.VIEW_CACHE.DECORATED_ELEMENT.set(element, [decorated, depsData]);\n      decoratedElement = decorated;\n    }\n\n    let groupedElement = decoratedElement;\n    const cachedGroupedElement =\n      this.VIEW_CACHE.GROUPED_ELEMENT.get(decoratedElement);\n    if (cachedGroupedElement) {\n      groupedElement = cachedGroupedElement;\n    } else {\n      const groupedNodes = Block.isBlocks(decoratedElement.nodes)\n        ? this.groupNodes(\n          [0, decoratedElement.nodes.length],\n          decoratedElement as Document | Block,\n        )\n        : decoratedElement.nodes;\n      groupedElement =\n        groupedNodes === decoratedElement.nodes\n          ? decoratedElement\n          : decoratedElement.set('nodes', groupedNodes);\n\n      this.VIEW_CACHE.GROUPED_ELEMENT.set(decoratedElement, groupedElement);\n    }\n\n    const [cachedViewElement, cachedDepInjections] =\n      this.VIEW_CACHE.INJECTED_ELEMENT.get(groupedElement) || [];\n    if (cachedViewElement && equal(cachedDepInjections, selfInjections)) {\n      return cachedViewElement;\n    }\n    const injectedElement = Injection.injectIntoNode(\n      selfInjections,\n      groupedElement,\n    ) as Element;\n\n    this.VIEW_CACHE.INJECTED_ELEMENT.set(groupedElement, [\n      injectedElement,\n      selfInjections,\n    ]);\n    this.VIEW_CACHE.ELEMENT.set(element, [\n      injectedElement,\n      decorations,\n      injections,\n      composing,\n    ]);\n    this.VIEW_CACHE.DATA.set(injectedElement, depsData);\n    this.VIEW_CACHE.INJECT_TO_VIEW_ELEMENT.set(injectedElement, {\n      decorations,\n      injections,\n    });\n    return injectedElement;\n  }\n\n  /**\n   * 将 Data Model 上的节点转换为 View Model 的节点\n   * @param node\n   * @param data\n   */\n  public toView(\n    node: Node,\n    decorations: Decoration[],\n    injections: Injection[],\n    isNodeVisible = false,\n  ): Node {\n    const n = node.toSubType();\n    // 开启视图模型的按需重算后，节点视图模型将根据其可见与否决定是否重算\n    if (this.enableOnDemandViewCalculation) {\n      if (Document.isDocument(n)) {\n        return this.toViewElement(n, decorations, injections);\n      }\n      if (isNodeVisible || this.isNodeVisible(node)) {\n        return n.isText()\n          ? this.toViewText(n, decorations)\n          : this.toViewElement(n, decorations, injections, true);\n      } else {\n        if (n.isText()) {\n          const [viewCache] = this.VIEW_CACHE.TEXT.get(n) || [];\n          if (!viewCache) {\n            this.VIEW_CACHE.VIEW_NEVER_CALCULATED.add(n.key);\n          }\n          return viewCache || n;\n        } else {\n          const [viewCache] = this.VIEW_CACHE.ELEMENT.get(n) || [];\n          if (!viewCache) {\n            this.VIEW_CACHE.VIEW_NEVER_CALCULATED.add(n.key);\n          }\n          return viewCache || n;\n        }\n      }\n    } else {\n      return n.isText()\n        ? this.toViewText(n, decorations)\n        : this.toViewElement(n, decorations, injections);\n    }\n  }\n\n  /**\n   * 热区计算时，获得应当注入 Hot View Node 的 View Data\n   * 根据当前变更判断是否需要重算 View Data\n   * 1. 若需要：则携带（1）parent node 的被分发的视图数据（2） Top-Level(`controller.value.injections`, `controller.value.decorations`) 的视图数据， 重新为 node 分发视图数据\n   * 2. 否则，使用缓存的视图数据\n   * @param viewNode\n   * @param dataNode\n   * @returns\n   */\n  private getInjectedViewData(viewNode: Node, dataNode: Node) {\n    if (Document.isDocument(dataNode)) {\n      return {\n        decorations: this.value.decorations,\n        injections: this.value.injections,\n      };\n    }\n    const { document } = this.value;\n    const parent = document.assertParent(dataNode.key);\n    const firstOp = this.$operationWithValues[0];\n    const cacheKey = Element.isElement(viewNode) ? viewNode : parent;\n    const cache = this.VIEW_CACHE.INJECT_TO_VIEW_ELEMENT.get(cacheKey);\n    const deps = {\n      decorations: [],\n      injections: [],\n      ...(cache || {}),\n    };\n\n    // 当上一次注入的 cache 无法获取时，也需要重新分发\n    const decorationsChanged =\n      !cache ||\n      (firstOp && firstOp.value.decorations !== this.$value.decorations);\n    const injectionsChanged =\n      !cache ||\n      (firstOp && firstOp.value.injections !== this.$value.injections);\n\n    let injectedDecorations: Decoration[] = deps.decorations;\n    let injectedInjections: Injection[] = deps.injections;\n\n    // 获得缓存的 deps\n    if (decorationsChanged) {\n      const { decorations: parentDecorations = [] } =\n        this.VIEW_CACHE.INJECT_TO_VIEW_ELEMENT.get(parent) || {};\n      injectedDecorations = parent\n        ? getChildrenDecorations(\n          document,\n          parent,\n          this.value.decorations.concat(parentDecorations),\n        )[parent.nodes.indexOf(dataNode)]\n        : this.value.decorations;\n    }\n\n    if (injectionsChanged) {\n      const { injections: parentInjections = [] } =\n        this.VIEW_CACHE.INJECT_TO_VIEW_ELEMENT.get(parent) || {};\n      // BACKGGROUND: 部分插件 `injectToNode` 的实现有 anti-pattern，\n      // 并非从当前节点测算，而从顶层节点（`document`）测算，因而其 injections 会写入顶层节点缓存\n      // 故而这里要并入顶层节点的 injections 重新分发\n      const docInjects = this.VIEW_CACHE.INJECT_TO_NODE.get(document) || [];\n      injectedInjections = parent\n        ? getChildrenInjections(\n          document,\n          parent,\n          this.value.injections.concat(parentInjections).concat(docInjects),\n        )[parent.nodes.indexOf(dataNode)]\n        : this.value.injections;\n    }\n\n    // 重新计算后，更新缓存\n    this.VIEW_CACHE.INJECT_TO_VIEW_ELEMENT.set(cacheKey, {\n      injections: injectedInjections,\n      decorations: injectedDecorations,\n    });\n\n    return { decorations: injectedDecorations, injections: injectedInjections };\n  }\n\n  /**\n   * 重新计算热区中的视图模型\n   * @param viewNode\n   * @returns\n   */\n  public recalculateView(viewNode: Node) {\n    const cachedViewNode = this.$viewDoc!.assertNode(viewNode.key);\n    const dataNode = this.value.document.getNode(viewNode.key);\n    // 诸如分组节点这样不存在与数据模型上的视图节点，不会被热区计算考虑，直接返回\n    if (!dataNode) {\n      return {\n        node: viewNode,\n        document: this.$viewDoc!,\n      };\n    }\n    let newViewNode: Node = cachedViewNode;\n    let newViewDoc: Document = this.$viewDoc!;\n    // 2. 结合最新的依赖，重算视图模型\n    if (Element.isElement(viewNode)) {\n      const { decorations, injections } = this.getInjectedViewData(\n        viewNode,\n        dataNode,\n      );\n      newViewNode = this.toViewElement(\n        dataNode as Element,\n        decorations,\n        injections,\n        true,\n      );\n      const path = this.$viewDoc!.assertPath(newViewNode.key);\n      newViewDoc = this.$viewDoc!.replaceNode(\n        path,\n        newViewNode,\n        this.noSpacialEffect(),\n      );\n    }\n    // 3. 刷新视图模型缓存，并返回重新计算得到的 Node 和 Document 视图\n    this.$viewDoc = newViewDoc;\n    return {\n      node: newViewNode,\n      document: newViewDoc,\n    };\n  }\n\n  /**\n   * 是否当前未产生节点空间的影响\n   * 1. 协同变更无法评估是否对空间有影响\n   * 2. 非协同变更：\n   *   * Pending 时，无空间影响\n   *   * 非 Pending 时，判断累积的操作是否有空间影响\n   * @returns\n   */\n  private noSpacialEffect() {\n    return (\n      !this.hots.forceRecalculate &&\n      (this.isPending ||\n        this.$operationWithValues!.every((op) => {\n          const { operation, key } = op;\n          if (!operation) {\n            return isSetValueNotAffectSpace(key!);\n          }\n          return isOperationNotAffectSpace(operation);\n        }))\n    );\n  }\n\n  /**\n   * 获得热区状态下的视图\n   * @param node\n   * @param document\n   * @param shouldRecalculate\n   * @returns\n   */\n  public getView(node: Node, document: Document, shouldRecalculate: boolean) {\n    if (this.hots.forceRecalculate) {\n      return this.recalculateView(node);\n    }\n\n    if (shouldRecalculate && this.pendingType !== PendingType.selection) {\n      return this.recalculateView(node);\n    }\n\n    // 如果没有变更，直接返回缓存的计算结果\n    if (this.hasHots()) {\n      const view = this.$viewDoc!.assertNode(node.key);\n      return {\n        node: view,\n        document: this.$viewDoc!,\n      };\n    }\n    return { node, document };\n  }\n\n  /**\n   * 执行一个函数，并在执行过程中，禁止任何的 normalize\n   * @param fn 执行函数\n   */\n  public withoutNormalizing(fn: (self: Controller) => void) {\n    const prevNormalizing = this.flag.normalizing;\n    this.flag.normalizing = false;\n    fn(this);\n    this.flag.normalizing = prevNormalizing;\n    return this;\n  }\n\n  /**\n   * 执行一个函数，并在执行过程中，禁止任何的 pending\n   * @param fn 执行函数\n   * @returns\n   */\n  public withoutPending(fn: (self: Controller) => void) {\n    const prevPending = this.flag.pending;\n    this.flag.pending = false;\n    fn(this);\n    this.flag.pending = prevPending;\n    return this;\n  }\n\n  /**\n   * 执行一个函数，并在执行过程中，不记录 undo stack\n   * @param fn 执行函数\n   * @returns\n   */\n  public withoutSaving(\n    fn: (self: Controller) => void,\n    {\n      __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,\n    }: { __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED?: boolean } = {},\n  ) {\n    const prevSaving = this.flag.saving;\n    this.flag.saving = false;\n    let nextOperationIndex = this.operations.length;\n    this.withOpContext('cj/history/withoutsaving', () => fn(this));\n    if (!__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED) {\n      while (nextOperationIndex < this.operations.length) {\n        const operation = this.operations[nextOperationIndex];\n        const operationType = operation.type;\n        if (\n          operationType !== 'set_node' &&\n          operationType !== 'set_mark' &&\n          operationType !== 'add_mark' &&\n          operationType !== 'remove_mark' &&\n          operationType !== 'set_selection'\n        ) {\n          throw new Error(\n            'Cangjie.Controller.withoutSaving only support Operation[type=set_node|set_mark|add_mark|remove_mark|set_selection].',\n          );\n        }\n        nextOperationIndex += 1;\n      }\n    }\n    this.flag.saving = prevSaving;\n    return this;\n  }\n\n  /**\n   * 执行一个函数，并在执行过程中禁止 op tracking\n   * @param fn 执行函数\n   * @returns\n   */\n  public withoutTracking(fn: (self: Controller) => void) {\n    const prevTracking = this.flag.tracking;\n    this.flag.tracking = false;\n    fn(this);\n    this.flag.tracking = prevTracking;\n    return this;\n  }\n\n  public withCommand(fn: (self: Controller) => void) {\n    const prevWithCommand = this.flag.withCommand;\n    this.flag.withCommand = true;\n    fn(this);\n    this.flag.withCommand = prevWithCommand;\n    return this;\n  }\n\n  public withOpContext(\n    context: string,\n    fn: (self: Controller) => void,\n    meta?: any[],\n  ) {\n    if (meta) {\n      this.context.push(`${context}(${JSON.stringify(meta)})`);\n    } else {\n      this.context.push(context);\n    }\n    fn(this);\n    this.context.pop();\n    return this;\n  }\n\n  /**\n   * 执行一个command\n   * @param cmd command函数或者字符串。传入函数会直接执行，字符串则会调用所有插件的onCommand中对应的处理函数\n   * @param args command的参数\n   */\n  public command<T extends keyof PluginCommands | Command | string>(\n    cmd: T extends keyof PluginCommands ? PluginCommandName<T> : T,\n    ...args: T extends Command\n      ? RestParameters<T>\n      : T extends keyof PluginCommands\n        ? PluginCommandArgs<T>\n        : any[]\n  ) {\n    if (process.env.NODE_ENV === 'development') {\n      warning(\n        this.flag.withCommand,\n        'Should not use Cangjie.Controller.command out of handlers or normalizer.',\n      );\n    }\n    if (typeof cmd === 'function') {\n      cmd(this, ...args);\n    } else {\n      this.run('onCommand', { type: cmd as string, args });\n    }\n\n    this.withoutTracking(() => this.normalizeDirtyKeys());\n    return this;\n  }\n\n  /**\n   * 执行一个query\n   * @param qry query函数或者字符串。传入函数会直接执行，字符串则会调用所有插件的onQuery中对应的处理函数\n   * @param args query的参数\n   */\n  public query<T extends keyof PluginQueries | Query | string>(\n    qry: T extends keyof PluginQueries ? PluginQueryName<T> : T,\n    ...args: T extends Query\n      ? RestParameters<T>\n      : T extends keyof PluginQueries\n        ? PluginQueryArgs<T>\n        : any[]\n  ): T extends Query\n      ? ReturnType<T>\n      : T extends keyof PluginQueries\n        ? PluginQueryReturn<T>\n        : any {\n    if (typeof qry === 'function') {\n      return qry(this, ...args);\n    }\n    return this.run('onQuery', { type: qry as string, args });\n  }\n\n  /**\n   * 触发一个插件的 action\n   * @param name string action 名称\n   * @param args  action 调用参数\n   *\n   * TODO: 插件迁移完成后，删掉 string 的定义\n   */\n  public dispatch<\n    T extends keyof PluginActionCreators | string = keyof PluginActionCreators,\n  >(\n    name: T,\n    ...args: T extends keyof PluginActionCreators\n      ? Parameters<PluginActionCreators[T]>\n      : any[]\n  ) {\n    const creator = this.actions[name];\n    if (creator) {\n      this.run('onAction', creator(...args));\n    }\n  }\n\n  /**\n   * 获取 action 判断函数。 返回的结果用于判断入参是否是某种 action, 支持 type predicate\n   * @param name action Name: 插件基于 PluginActionPredicates 注册\n   * @returns (action: any): action is SomeAction\n   *\n   * TODO: 插件迁移完成后，删掉 string 的定义\n   */\n  public isActionFactory<\n    T extends\n    | keyof PluginActionPredicates\n    | string = keyof PluginActionPredicates,\n  >(\n    name: T,\n  ): T extends keyof PluginActionPredicates\n      ? PluginActionPredicates[T] | undefined\n      : ((action: any) => boolean) | undefined {\n    return this.isActions[name] as any;\n  }\n\n  /**\n   * 销毁当前 controller 实例\n   */\n  public destroy() {\n    this.flag.destroyed = true;\n    this.groupManager.cleanup();\n    if (this.virtualize.invisibleCalculationId) {\n      window.cancelIdleCallback(this.virtualize.invisibleCalculationId);\n    }\n    this.debouncedFlush.cancel();\n    this.debouncedStartInvisibleCalculationScheduler.cancel();\n    this.cleanup();\n  }\n\n  /**\n   * 清理编辑器以及插件的cache\n   */\n  public cleanup() {\n    this.run('onCleanup');\n  }\n\n  /**\n   * 获得当前编辑器的视图模型\n   */\n  public get view() {\n    if (this.hasHots() && this.$viewDoc) {\n      return this.$viewDoc;\n    }\n    const { document, decorations, injections } = this.value;\n    if (this.VIEW_CACHE.VALUE.has(this.value)) {\n      const [decoratedDocument] =\n        this.VIEW_CACHE.DECORATED_ELEMENT.get(document) || [];\n      if (decoratedDocument) {\n        const groupedDocument =\n          this.VIEW_CACHE.GROUPED_ELEMENT.get(decoratedDocument);\n        if (groupedDocument) {\n          const [viewDocument] =\n            this.VIEW_CACHE.INJECTED_ELEMENT.get(groupedDocument) || [];\n          if (viewDocument) {\n            return viewDocument as Document;\n          }\n        }\n      }\n    }\n\n    this.VIEW_CACHE.VALUE.add(this.value);\n    const viewDoc = this.toView(document, decorations, injections) as Document;\n    this.$viewDoc = viewDoc;\n    return viewDoc;\n  }\n\n  /**\n   * 获得 `node`  的视图数据\n   * @param node\n   */\n  public getViewData(node: Node): ViewData {\n    return (\n      this.VIEW_CACHE.DATA.get(node) || {\n        decorations: [],\n        injections: [],\n      }\n    );\n  }\n\n  public setOpRelatedId(id: string | null) {\n    this.flag.opRelatedId = id;\n    return this;\n  }\n\n  public get opRelatedId() {\n    return this.flag.opRelatedId;\n  }\n\n  public get shouldResumePosition() {\n    return this.flag.scrollType === 'maintain';\n  }\n\n  public get shouldScrollToSelection() {\n    return this.flag.scrollType === 'toSelection';\n  }\n\n  public setScrollType(type: ScrollType) {\n    this.flag.scrollType = type;\n  }\n\n  public get isPending() {\n    // OP Pending 或热区过程中\n    return !!this.pendingQueue.type || !!this.hots.pendingType;\n  }\n\n  public get enablePending() {\n    return this.pendingQueue.enablePending;\n  }\n\n  public get isPendingEnable() {\n    return (\n      Object.values(this.pendingQueue.enablePending).some((s) => !!s) &&\n      this.flag.pending\n    );\n  }\n\n  public get pendingType() {\n    // 热区 debounce 时，pending type\n    if (this.hasHots()) {\n      return this.hots.pendingType;\n    }\n    return this.pendingQueue.type || this.testType;\n  }\n\n  public get isTracking() {\n    return this.flag.tracking;\n  }\n\n  // 通知 pending 结束事件\n  public dispatchPendingTerminal() {\n    this.terminal$.next(null);\n  }\n\n  public perfStart(payload: { type: PerfType; subtype?: string }) {\n    const { type, subtype } = payload;\n    const perf = this.flag.perf[type];\n    const timestamp = performance.now();\n    perf.push({\n      type,\n      subtype: subtype || type,\n      timestamp,\n    });\n    perfMark(`cangjie-perf-${subtype || type}-start-${timestamp}`);\n  }\n\n  public perfEnd(type: PerfType, dropped = false) {\n    const perf = this.flag.perf[type];\n    const start = perf.shift();\n    if (!start) {\n      return;\n    }\n\n    const { subtype, timestamp } = start;\n    const endKey = `cangjie-perf-${subtype || type}-end-${timestamp}`;\n    const startKey = `cangjie-perf-${subtype || type}-start-${timestamp}`;\n    perfMark(endKey);\n\n    if (start.ignore) {\n      perfMeasure('cangjie-perf-ignore', startKey, endKey);\n      return;\n    }\n\n    perfMeasure(`cangjie-perf-${subtype}`, startKey, endKey);\n\n    // 计算准确时间\n    const current = performance.now();\n    let duration = current - timestamp;\n\n    if (perf.length > 0) {\n      duration -= current - perf[0].timestamp;\n    }\n\n    this.run(\n      'onCangjiePerf',\n      CangjiePerfEvent({\n        type: subtype,\n        duration,\n        dropped,\n      }),\n    );\n  }\n\n  /**\n   * 丢弃 perf 数据\n   * @description BACKGROUND:\n   * 通常 perf 队列遵循 **先进先出** 的原则，每一次入队都意味着一次交互事件的产生，正常出队的时机是在渲染后的 setTimeout 任务里（通过 perfEnd 出队）。\n   * - 有些情况下我们不需要记录此次 perf 值（eg. 交互事件后未触发视图改变），所以通过 `perfDrop(type)` 异步地丢弃之；\n   * - 特殊情况下，如果在正常出队前发现数据无效（eg. 丢帧：marcoTask 先于渲染执行）需要丢弃，则通过 `perfDrop(type, true)` 同步地丢弃之。\n   * @param type PerfType\n   * @param immediately 是否立即丢弃\n   */\n  public perfDrop(type: PerfType, immediately = false) {\n    if (immediately) {\n      const { subtype, timestamp } = this.flag.perf[type].shift() || {};\n      const endKey = `cangjie-perf-${subtype}-end-${timestamp}`;\n      subtype && perfMark(endKey);\n      return;\n    }\n\n    // 延迟丢弃时，先标记该数据 ignore\n    const lastIndex = this.flag.perf[type].length - 1;\n    if (lastIndex >= 0 && this.flag.perf[type][lastIndex]) {\n      this.flag.perf[type][lastIndex].ignore = true;\n      setTimeout(() => {\n        const { subtype, timestamp } = this.flag.perf[type].shift() || {};\n        const endKey = `cangjie-perf-${subtype}-end-${timestamp}`;\n        subtype && perfMark(endKey);\n      });\n    }\n  }\n\n  private perfClearAll() {\n    Object.keys(this.flag.perf).forEach((type) => {\n      this.flag.perf[type] = [];\n    });\n  }\n\n  private setUid(dataUid: string | number | undefined) {\n    this.uid = dataUid === undefined ? undefined : String(dataUid);\n  }\n\n  public switchUid(dataUid: string | number | undefined) {\n    this.setUid(dataUid);\n    this.userData.update$.next({ uuid: '*' });\n  }\n\n  public getHots() {\n    if (this.$operationWithValues.length <= (this.virtualizeOptions.maxOPsForHotsAnalyze || 0)) {\n      return getHots(this.$operationWithValues, this);\n    }\n    return [];\n  }\n\n  public setHots(\n    hots: Hot[],\n    pendingType: PendingType | null,\n    forceRecalculate = false,\n  ) {\n    this.hots = {\n      hots,\n      keys: hots.reduce((ret, hot) => {\n        ret[hot.node.key] = true;\n        return ret;\n      }, {}),\n      pendingType,\n      lengthOfPending: pendingType ? this.$operationWithValues.length : 0,\n      forceRecalculate,\n    };\n    if (hots.length) {\n      this.hots$.next(hots);\n    }\n    return this;\n  }\n\n  public clearHots() {\n    this.hots = {\n      hots: [],\n      keys: {},\n      pendingType: null,\n      lengthOfPending: 0,\n      forceRecalculate: false,\n    };\n    return this;\n  }\n\n  public hasHots() {\n    return this.hots.hots.length > 0;\n  }\n\n  /** 是否开启热区 */\n  public get enableHots() {\n    const { enable, pendingDebounceTime } = this.virtualizeOptions;\n    return enable && typeof pendingDebounceTime === 'number' && pendingDebounceTime > 0;\n  }\n\n  /**\n   * 当前节点视图是否热\n   * @param viewNode\n   * @returns\n   */\n  public isViewHot(viewNode: Node) {\n    if (!this.enableHots) {\n      return false;\n    }\n    return (\n      !!this.hots.keys[viewNode.key] &&\n      this.$value.document.hasNode(viewNode.key)\n    );\n  }\n\n  public addIsSelected(key: string) {\n    this.VIEW_CACHE.IS_SELECTED.add(key);\n  }\n\n  public getIsSelected(key: string) {\n    return this.VIEW_CACHE.IS_SELECTED.has(key);\n  }\n\n  public removeIsSelected(key: string) {\n    this.VIEW_CACHE.IS_SELECTED.delete(key);\n  }\n\n  /**\n   * 1. 若配置了闪享光标，则 blur 时需要显示远程光标\n   * 2. 否则，根据配置项 hideSelectionOnBlur 决定是否需要隐藏\n   * @returns 是否需要不显示选区\n   */\n  public shouldHideSelectionOnBlur() {\n    return !this.showCaret?.onBlur && this.hideSelectionOnBlur;\n  }\n\n  /**\n   * 是否开启虚拟化\n   */\n  public get enableVirtualize() {\n    return this.virtualizeOptions.enable;\n  }\n\n  /**\n   * 是否开启模型虚拟化以及视图虚拟化\n   */\n  public get enableVirtualizeView() {\n    return this.virtualizeOptions.enable && !this.virtualizeOptions.disableViewVirtualize;\n  }\n\n  /** 是否开启按需计算 */\n  public get enableOnDemandViewCalculation() {\n    return !!this.virtualizeOptions.enable && this.virtualizeOptions.enableOnDemandViewCalculation;\n  }\n\n  /**\n   * 虚拟化时，是否节点可见\n   * @param node\n   * @returns\n   */\n  public isNodeVisible(node: Node) {\n    if (!Element.isElement(node)) {\n      return false;\n    }\n    const { visibles } = this.virtualize;\n    return visibles.some((visible) => {\n      if (node.key === visible) {\n        return true;\n      }\n      // 如果可见节点是视图模型上的节点，则判断节点是否在视图模型上\n      if (!this.value.document.hasNode(visible)) {\n        const viewElement = this.$viewDoc?.getNode(visible);\n        return viewElement?.isElement() && viewElement.hasNode(node.key);\n      }\n      return false;\n    });\n  }\n\n  /**\n   * 是否 visibles 中存在未计算过视图模型的节点\n   * 当节点被认为不可见后，它的视图模型不会被计算，那么下一次可见时：\n   * - 节点本身可见\n   * - 节点所在分组可见\n   * 此时，需要保证节点的视图模型能够被正确计算\n   * @param visibles\n   * @returns\n   */\n  private hasViewNeverCalculatedInVisibles(visibles: string[]) {\n    return visibles.some((visible) => {\n      if (this.VIEW_CACHE.VIEW_NEVER_CALCULATED.has(visible)) {\n        return true;\n      }\n      if (!this.value.document.hasNode(visible)) {\n        const viewElement = this.$viewDoc?.assertElement(visible);\n        return !!viewElement?.findDescendant(\n          (node) =>\n            node.isElement() &&\n            this.VIEW_CACHE.VIEW_NEVER_CALCULATED.has(node.key),\n        );\n      }\n      return false;\n    });\n  }\n\n  /**\n   * 设置虚拟化的可见节点集合\n   * @param visibles\n   */\n  public setVirtualize<T extends keyof Virtualize>(\n    key: T,\n    value: Virtualize[T],\n  ) {\n    const { document } = this.value;\n    if (key === 'visibles' && !equal(this.virtualize[key], value)) {\n      const visibles = value as Virtualize['visibles'];\n      this.virtualize.visibles = visibles;\n      // 如果 visible 中存在未计算过视图模型的节点，则需要重算视图模型\n      if (this.hasViewNeverCalculatedInVisibles(visibles)) {\n        //清理视图缓存，避免节点可见后，取到旧的视图模型缓存\n        this.clearHots();\n        this.VIEW_CACHE.VALUE.delete(this.value);\n        this.VIEW_CACHE.ELEMENT.delete(document);\n        this.VIEW_CACHE.DECORATED_ELEMENT.delete(document);\n        this.VIEW_CACHE.INJECTED_ELEMENT.delete(document);\n        this.VIEW_CACHE.GROUPED_ELEMENT.delete(document);\n        this.view;\n      }\n      this.visibles$.next(visibles);\n      // 每当可视节点发生变化，则重新开始调度不可见节点的计算\n      this.debouncedStartInvisibleCalculationScheduler(visibles);\n    } else {\n      this.virtualize[key] = value;\n    }\n    return this;\n  }\n\n  private startInvisibleCalculationScheduler = (\n    visibles: Virtualize['visibles'],\n  ) => {\n    /** 若浏览器不支持 requestIdleCallback，则不开启闲时计算 */\n    if (typeof window.requestIdleCallback !== 'function') {\n      return;\n    }\n    if (this.virtualize.invisibleCalculationId) {\n      window.cancelIdleCallback(this.virtualize.invisibleCalculationId);\n    }\n    const invisibles = getInsivibleNodes(this.value.document, visibles);\n    this.scheduleInvisibleCalculation(invisibles);\n  };\n\n  private scheduleInvisibleCalculation = (invisibles: Element[]) => {\n    this.virtualize.invisibleCalculationId = window.requestIdleCallback(\n      (deadline) => this.runInvisibleViewCalculation(deadline, invisibles),\n    );\n  };\n\n  private runInvisibleViewCalculation = (\n    deadline: IdleDeadline,\n    invisibles: Element[],\n  ) => {\n    while (\n      (deadline.timeRemaining() > 0 || deadline.didTimeout) &&\n      invisibles.length\n    ) {\n      // 每次取出一个不可见节点计算\n      this.calculateInvisibleView(invisibles.pop()!);\n    }\n\n    if (invisibles.length) {\n      // 继续下一个计算\n      this.scheduleInvisibleCalculation(invisibles);\n    } else {\n      this.virtualize.invisibleCalculationId = null;\n    }\n  };\n\n  private calculateInvisibleView = (invisible: Element) => {\n    const { injections, decorations, document } = this.value;\n    const docInjections = this.VIEW_CACHE.INJECT_TO_NODE.get(document) || [];\n    const docDecorations = this.VIEW_CACHE.DECORATE_NODE.get(document) || [];\n\n    const viewElement = this.toViewElement(\n      invisible,\n      decorations.concat(docDecorations),\n      injections.concat(docInjections),\n    );\n    if (!this.VIEW_CACHE.ELEMENT.get(document)) {\n      const { decorations, injections } = this.value;\n      this.toView(document, decorations, injections);\n    }\n    const [viewDocument, prevDecorations, prevInjections, prevComposing] =\n      this.VIEW_CACHE.ELEMENT.get(document)!;\n    const newViewDocument = viewDocument.replaceNode(\n      this.view.assertPath(viewElement.key),\n      viewElement,\n      /** 重新 toView，会带来新的视图子树，因此需要重构 key-to-path table */\n      false,\n    ) as Document;\n    this.VIEW_CACHE.ELEMENT.set(document, [\n      newViewDocument,\n      prevDecorations,\n      prevInjections,\n      prevComposing,\n    ]);\n    this.VIEW_CACHE.VALUE.delete(this.value);\n    this.$viewDoc = newViewDocument;\n    return viewElement;\n  };\n\n  /**\n   * 计算可见节点子树下的未被计算的视图模型\n   * @param node\n   * @returns\n   */\n  private calculateViewInVisibleNode = (\n    node: Element,\n    parentVisible = false,\n  ) => {\n    const { document } = this.value;\n    // 如果是视图模型节点，递归计算其子树下未被计算过的视图模型\n    if (!document.hasNode(node.key) && this.isNodeVisible(node)) {\n      return node.mapDescendants((descendant) => {\n        return descendant.isElement()\n          ? this.calculateViewInVisibleNode(descendant, true)\n          : descendant;\n      });\n    }\n    // 如果可见节点下，存在未被计算的视图模型，则计算之保证可见节点的视图正确\n    else if (\n      document.hasNode(node.key) &&\n      parentVisible &&\n      this.VIEW_CACHE.VIEW_NEVER_CALCULATED.has(node.key)\n    ) {\n      return this.calculateInvisibleView(node);\n    }\n    return node;\n  };\n\n  public get visibleBlocks() {\n    return this.virtualize.visibles;\n  }\n\n  public set scrollableContainer(scrollableContainer: Window | HTMLElement | null) {\n    this.$scrollableContainer = scrollableContainer;\n  }\n\n  public get scrollableContainer() {\n    return this.$scrollableContainer || window;\n  }\n\n  public get enableUUID() {\n    return this.uuidConfig.enable;\n  }\n}\n\n/**\n * @ignore\n */\nexport const ControllerContext =\n  React.createContext<{\n    controller: Controller;\n    subject: Subject<Value>;\n  } | null>(null);\n","/**\n * @packageDocumentation\n * @module Hooks\n */\nimport React from 'react';\nimport Node from '../models/node';\nimport Block from '../models/block';\nimport Controller from '../controller';\n\ninterface DocStyleData {\n  rPr?: Record<string, any>;\n  pPr?: Record<string, any>;\n}\n\nexport interface DocStyle {\n  docDefaults?: {\n    data: DocStyleData;\n    name: string;\n    type: string;\n    default?: number;\n  };\n  tableHeader?: Record<string, any>;\n}\n\nexport interface RenderNodeStyleProps {\n  /**\n   * 节点\n   */\n  node: Node;\n  /**\n   * 文档样式表\n   */\n  docStyle?: DocStyle;\n}\n\nexport type RenderContentStyleProps = Omit<RenderNodeStyleProps, 'node'>;\n\n/**\n * 样式 context\n */\nexport const StyleContext = React.createContext<DocStyle | undefined>(undefined);\n\nexport function useStyle() {\n  return React.useContext(StyleContext);\n}\n\n/**\n * 获取节点样式\n * @returns React.CSSProperties\n */\nexport function useNodeStyle(\n  controller: Controller,\n  node: Node,\n  visible = true,\n) {\n  const docStyle = React.useContext(StyleContext);\n  // 非 block 元素不消费 style，return 以提高性能\n  if (!Block.isBlock(node)) return {};\n  const style: React.CSSProperties = controller.run('getNodeStyle', {\n    node,\n    docStyle,\n  }) || {};\n  if (visible === false) {\n    style.display = 'none';\n  }\n  return style;\n}\n\n/**\n * 获取全局默认文本样式\n * @returns React.CSSProperties\n */\nexport function useContentStyle(controller: Controller) {\n  const docStyle = React.useContext(StyleContext);\n  const style: React.CSSProperties = controller.run('getContentStyle', {\n    docStyle,\n  }) || {};\n  return style;\n}\n","/**\n * @packageDocumentation\n * @module Controller\n */\nimport * as React from 'react';\nimport warning from 'tiny-warning';\nimport { noop } from 'lodash-es';\nimport {\n  ControllerProperties,\n  ControllerOptions,\n} from '../interfaces/controller';\nimport { focus } from '../commands/index';\nimport Controller, { ControllerContext } from './index';\nimport Value from '../models/value';\nimport { StyleContext, DocStyle } from '../hooks/useStyle';\nimport { Subject } from '../models/observable';\nimport { IS_DEV } from '../utils/environment';\n\nexport interface ProviderProps extends ControllerProperties {\n  /**\n   * 编辑器Controller引用的回调函数\n   */\n  controllerRef?: (controller: Controller) => void;\n  /**\n   * 编辑器参数\n   */\n  options?: ControllerOptions;\n  /**\n   * children\n   */\n  children: React.ReactNode;\n  /**\n   * 文档样式表\n   */\n  docStyle?: DocStyle;\n  onFirstRender?: (controller: Controller) => void;\n}\n\nexport default function Provider(props: ProviderProps) {\n  const {\n    biz,\n    dataUid,\n    plugins,\n    value,\n    onChange = noop,\n    controllerRef = noop,\n    children,\n    readOnly = false,\n    autoFocus = false,\n    canCopy,\n    options,\n    flushType,\n    configs,\n    onBusyStateChange,\n    onFirstRender,\n    docStyle,\n    onPending = noop,\n  } = props;\n\n  const pluginsRef = React.useRef<ProviderProps['plugins']>();\n  const onChangeRef = React.useRef<ProviderProps['onChange']>();\n  const prevValueRef = React.useRef<Value>(value);\n  const controller = React.useMemo(() => {\n    const controllerIns = Controller.create(\n      {\n        biz,\n        dataUid,\n        plugins,\n        value,\n        onChange,\n        readOnly,\n        autoFocus,\n        canCopy,\n        flushType,\n        configs,\n        onBusyStateChange,\n        onPending,\n      },\n      options,\n    );\n\n    pluginsRef.current = plugins;\n    onChangeRef.current = onChange;\n\n    controllerIns.groupManager.generateAllGroups();\n\n    return controllerIns;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  React.useLayoutEffect(() => {\n    if (onFirstRender) {\n      onFirstRender(controller);\n    }\n  }, []);\n\n  React.useEffect(() => {\n    controller.showCaret = options?.showCaret;\n  }, [options?.showCaret?.onBlur, options?.showCaret?.onReadOnly]);\n\n  // 因 canCopy 而重新生成 controller 会导致后续的交互出 BUG\n  React.useEffect(() => {\n    if (typeof canCopy === 'boolean') {\n      controller.canCopy = canCopy;\n    }\n  }, [controller, canCopy]);\n\n  React.useEffect(() => {\n    if (process.env.NODE_ENV === 'development') {\n      warning(\n        plugins === pluginsRef.current,\n        \"Cangjie.Provider will ignore `plugins`'s change.\",\n      );\n      warning(\n        onChange === onChangeRef.current,\n        \"Cangjie.Provider will ignore `onChange`'s change.\",\n      );\n    }\n  }, [plugins, onChange]);\n\n  React.useEffect(() => {\n    // uid 变化，刷新用户数据\n    controller.switchUid(dataUid);\n  }, [dataUid]);\n\n  controllerRef(controller);\n\n  if (readOnly !== controller.readOnly) {\n    controller.setReadOnly(readOnly);\n  }\n\n  if (controller.enableVirtualize && controller.virtualizeManager?.viewInitialized) {\n    controller.virtualizeManager.workflowOnValueChange();\n  }\n\n  // Note: This action will trigger normalize\n  if (\n    value !== prevValueRef.current &&\n    value !== controller.value\n  ) {\n    controller.resetValue(value, options);\n  }\n\n  prevValueRef.current = value;\n\n  const context = React.useMemo(() => {\n    const subject = new Subject<Value>();\n    return {\n      controller,\n      subject,\n    };\n  }, [controller]);\n\n  // Note: Force re-render except first mount.\n  const didMountRef = React.useRef(false);\n  React.useEffect(() => {\n    if (didMountRef.current) {\n      context.subject.next(value);\n    } else {\n      didMountRef.current = true;\n    }\n  }, [value]);\n\n  React.useEffect(() => {\n    if (autoFocus) {\n      controller.command(focus).flush();\n    }\n  }, [controller, autoFocus]);\n\n  React.useEffect(() => {\n    // 首次渲染完成，刷新分组信息\n    controller.groupManager.notifyNewGroups(true);\n    return () => {\n      controller.destroy();\n    };\n  }, [controller]);\n\n  React.useEffect(() => {\n    if (IS_DEV) {\n      const [main] = React.version.split('.');\n      warning(\n        Number(main) < 18,\n        'React > 17 is not fully supported, editor will have some weird problems.',\n      );\n    }\n  }, []);\n\n  return (\n    <ControllerContext.Provider value={context}>\n      <StyleContext.Provider value={docStyle}>{children}</StyleContext.Provider>\n    </ControllerContext.Provider>\n  );\n}\n","/**\n * @packageDocumentation\n * @module Models\n */\nimport isPlainObject from 'is-plain-object';\nimport { Serializable, SerializeOptions } from '../interfaces/serializable';\nimport ImmutableRecord from './immutableRecord';\nimport { TextPointJSON, TextPoint } from './point';\nimport Mark, { MarkJSON } from './mark';\n\nexport interface DecorationProperties {\n  start: TextPoint;\n  end: TextPoint;\n  mark: Mark;\n}\n\nexport interface DecorationJSON {\n  start: TextPointJSON;\n  end: TextPointJSON;\n  mark: MarkJSON;\n}\n\nexport default class Decoration extends ImmutableRecord\n  implements Serializable<DecorationJSON> {\n  static create(props: Decoration | DecorationProperties): Decoration {\n    if (Decoration.isDecoration(props)) {\n      return props;\n    }\n\n    if (isPlainObject(props)) {\n      const { start, end, mark } = props;\n      return new Decoration({\n        start: TextPoint.create(start),\n        end: TextPoint.create(end),\n        mark: Mark.create(mark),\n      });\n    }\n\n    throw new Error(\n      `\\`Decoration.create\\` only accepts objects or decorations, but you passed it: ${props}`,\n    );\n  }\n\n  static fromJSON(json: DecorationJSON) {\n    const { start, end, mark } = json;\n    return Decoration.create({\n      start: TextPoint.fromJSON(start),\n      end: TextPoint.fromJSON(end),\n      mark: Mark.fromJSON(mark),\n    });\n  }\n\n  static isDecoration(maybeDecoration: any): maybeDecoration is Decoration {\n    return maybeDecoration instanceof Decoration;\n  }\n\n  /**\n   * Decoration的start point\n   */\n  public readonly start: TextPoint;\n\n  /**\n   * Decoration的end point\n   */\n  public readonly end: TextPoint;\n\n  /**\n   * Decoration的mark\n   */\n  public readonly mark: Mark;\n\n  private constructor(props: DecorationProperties) {\n    super();\n    const { start, end, mark } = props;\n    this.start = start;\n    this.end = end;\n    this.mark = mark;\n    this.freeze();\n  }\n\n  public merge(props: Partial<DecorationProperties>) {\n    return new Decoration({\n      start: this.start,\n      end: this.end,\n      mark: this.mark,\n      ...props,\n    });\n  }\n\n  public set<T extends keyof DecorationProperties>(\n    key: T,\n    value: DecorationProperties[T],\n  ) {\n    return this.merge({\n      [key]: value,\n    });\n  }\n\n  public toJSON(options?: SerializeOptions) {\n    return {\n      start: this.start.toJSON(options),\n      end: this.end.toJSON(options),\n      mark: this.mark.toJSON(),\n    };\n  }\n}\n","import { omit, union } from 'lodash-es';\nimport { isEmptyObj, omitDeepBy } from '../utils/omitEmpty';\nimport { SetNodeOperation } from './operation';\nimport Value from './value';\n\nexport function mergeUserProperties (\n  value: Value,\n  operation: SetNodeOperation\n) {\n  const { path, properties, context } = operation;\n  // 将当前 OP 中用户数据与 value 上的合并\n  // 避免协同编辑下，不同用户/不同段落 OP 数据相互覆盖\n  const matched = context?.match(/userdata\\/(.*)\\/(.*)/);\n  const targetData = properties?.data?.userData || {};\n  if (matched && path?.length === 0 && targetData) {\n    let mergedData = value.document.data?.userData || {};\n    // context 上携带此次修改用户数据的 uid 和块 uuid\n    const mUid = matched[1];\n    let uids: string[] = [];\n    if (mUid === '*') {\n      uids = union(Object.keys(mergedData), Object.keys(targetData));\n    } else if (mUid) {\n      uids = [mUid];\n    }\n    const uuids = matched[2].split(',');\n    uids.forEach((uid) => {\n      uuids.forEach((uuid) => {\n        const target = targetData?.[uid]?.[uuid];\n        if (uuid) {\n          if (target === undefined) {\n            // 删除数据\n            mergedData = {\n              ...mergedData,\n              [uid]: omit(mergedData?.[uid], uuid)\n            };\n          } else {\n            // 用 op 中 uuid 对应数据覆盖 document 上对应的\n            mergedData = {\n              ...mergedData,\n              [uid]: {\n                ...mergedData?.[uid],\n                [uuid]: target,\n              }\n            }\n          }\n        } \n      })\n    })\n    return {\n      ...properties,\n      data: omitDeepBy({\n        ...properties.data,\n        userData: mergedData\n      }, isEmptyObj),\n    };\n  }\n  return properties;\n}","/* eslint-disable no-dupe-class-members */\n/**\n * @packageDocumentation\n * @module Models\n */\nimport equal from 'fast-deep-equal';\nimport isPlainObject from 'is-plain-object';\nimport { noop, once } from 'lodash-es';\nimport ImmutableRecord from './immutableRecord';\nimport Path from './path';\nimport Injection, { InjectionJSON } from './injection';\nimport Decoration, { DecorationJSON } from './decoration';\nimport Selection, { SelectionJSON, SupportPointName } from './selection';\nimport { TextPoint, EdgePoint } from './point';\nimport Node from './node';\nimport { ElementProperties, ElementTypeName } from './element';\nimport Document, { DocumentJSON } from './document';\nimport Block from './block';\nimport Inline from './inline';\nimport Text from './text';\nimport Mark, { MarkProperties } from './mark';\nimport Operation, {\n  OperationType,\n  AddMarkOperation,\n  InsertNodeOperation,\n  InsertTextOperation,\n  MergeNodeOperation,\n  MoveNodeOperation,\n  RemoveMarkOperation,\n  RemoveNodeOperation,\n  RemoveTextOperation,\n  SetMarkOperation,\n  SetNodeOperation,\n  SetSelectionOperation,\n  SplitNodeOperation,\n} from './operation';\nimport { Serializable, SerializeOptions } from '../interfaces/serializable';\nimport { mergeUserProperties } from './userData';\n\n// eslint-disable-next-line no-console\nconst warning =\n  typeof console !== 'undefined'\n    ? once(console.warn.bind(console) || (() => {}))\n    : noop;\n\nfunction getDefaultSelection(document: Document) {\n  const firstNode = document.getFirstNode();\n  if (Text.isText(firstNode)) {\n    const point = TextPoint.create({ key: firstNode.key, offset: 0 });\n    return Selection.create({ anchor: point, focus: point });\n  }\n  const point = EdgePoint.create({ key: document.key, edge: EdgePoint.BEFORE });\n  return Selection.create({ anchor: point, focus: point });\n}\n\nexport interface ValueProperties {\n  data?: Record<string, any>;\n  document?: Document;\n  selection?: Selection;\n  remoteSelections?: Selection[];\n  injections?: Injection[];\n  decorations?: Decoration[];\n  composing?: string;\n  isFocused?: boolean;\n}\n\nexport interface ValueJSON {\n  data?: Record<string, any>;\n  klass?: 'value';\n  document?: DocumentJSON;\n  selection?: SelectionJSON;\n  remoteSelections?: SelectionJSON[];\n  decorations?: DecorationJSON[];\n  injections?: InjectionJSON[];\n}\n\nexport default class Value extends ImmutableRecord\n  implements Serializable<ValueJSON> {\n  static create(props: Value | ValueProperties = {}): Value {\n    if (Value.isValue(props)) {\n      return props;\n    }\n\n    if (isPlainObject(props)) {\n      const {\n        data = {},\n        document: doc = {},\n        selection,\n        remoteSelections = [],\n        injections = [],\n        decorations = [],\n        composing = '',\n        isFocused = false,\n      } = props;\n      const document = Document.create(doc);\n      return new Value({\n        data,\n        document,\n        selection: selection || getDefaultSelection(document),\n        remoteSelections,\n        injections,\n        decorations,\n        composing,\n        isFocused,\n      });\n    }\n\n    throw new Error(\n      `\\`Value.create\\` only accepts objects or values, but you passed it: ${props}`,\n    );\n  }\n\n  static fromJSON(json: ValueJSON) {\n    const {\n      document = {},\n      injections,\n      selection,\n      remoteSelections,\n      decorations,\n    } = json;\n    const documentValue = Document.fromJSON(document);\n    return Value.create({\n      ...json,\n      injections: injections ? injections.map(Injection.fromJSON) : undefined,\n      document: documentValue,\n      selection: selection\n        ? Selection.fromJSON(selection)\n        : getDefaultSelection(documentValue),\n      remoteSelections: remoteSelections\n        ? remoteSelections.map(Selection.fromJSON)\n        : undefined,\n      decorations: decorations\n        ? decorations.map(Decoration.fromJSON)\n        : undefined,\n    });\n  }\n\n  static isValue(maybeValue: any): maybeValue is Value {\n    return maybeValue instanceof Value;\n  }\n\n  /**\n   * value 的 injections 数组\n   */\n  public readonly injections: Injection[];\n\n  /**\n   * value 的 decoration 数组\n   */\n  public readonly decorations: Decoration[];\n\n  /**\n   * 是否是focus状态\n   */\n  public readonly isFocused: boolean;\n\n  /**\n   * value 的内存数据\n   */\n  public readonly data: Record<string, any>;\n\n  /**\n   * 根文档对象\n   */\n  public readonly document: Document;\n\n  /**\n   * 当前的选区\n   */\n  public readonly selection: Selection;\n\n  /**\n   * 当前的选区\n   */\n  public get rangeSelection() {\n    if ('development' === process.env.NODE_ENV) {\n      warning(\n        '`Value.rangeSelection` is deprecated, please use `Value.selection`',\n      );\n    }\n    return this.selection;\n  }\n\n  /**\n   * 远程选区\n   */\n  public readonly remoteSelections: Selection[] = [];\n\n  /**\n   * 输入法 composing 但是没有确认的文字\n   */\n  public readonly composing: string = '';\n\n  protected constructor(props: Required<ValueProperties>) {\n    super();\n    const {\n      data,\n      document,\n      selection,\n      remoteSelections,\n      injections,\n      decorations,\n      composing,\n      isFocused,\n    } = props;\n    this.data = { ...data };\n    this.document = document;\n    this.selection = selection;\n    this.remoteSelections = remoteSelections;\n    this.injections = injections;\n    this.decorations = decorations;\n    this.composing = composing;\n    this.isFocused = isFocused;\n    this.freeze();\n  }\n\n  /**\n   * 获取当前选中的blocks\n   */\n  public get blocks() {\n    return !this.selection\n      ? []\n      : this.document.getLeafBlocksAtRange(this.selection);\n  }\n\n  /**\n   * 获取当前选中的inlines\n   */\n  public get inlines(): Inline[] {\n    return !this.selection\n      ? []\n      : this.document.getLeafInlinesAtRange(this.selection);\n  }\n\n  private getElement(pointName: SupportPointName, type: 'block'): Block | null;\n\n  private getElement(\n    pointName: SupportPointName,\n    type: 'inline',\n  ): Inline | null;\n\n  private getElement(pointName: SupportPointName, type: 'text'): Node | null;\n\n  private getElement(pointName: SupportPointName, type: ElementTypeName) {\n    const { document, selection } = this;\n    if (!selection) {\n      return null;\n    }\n    const point = selection.getPoint(pointName, document);\n    if (type === 'block') {\n      return document.getClosestBlockFromPoint(point.key);\n    } else if (type === 'inline') {\n      return document.getClosestInline(point.key);\n    } else {\n      return document.getNode(point.key);\n    }\n  }\n\n  /**\n   * 获取当前选中的anchor位置对应的block\n   */\n  public get anchorBlock() {\n    return this.getElement('anchor', 'block');\n  }\n\n  /**\n   * 获取当前选中的focus位置对应的block\n   */\n  public get focusBlock() {\n    return this.getElement('focus', 'block');\n  }\n\n  /**\n   * 获取当前选中的start位置对应的block\n   */\n  public get startBlock() {\n    return this.getElement('start', 'block');\n  }\n\n  /**\n   * 获取当前选中的end位置对应的block\n   */\n  public get endBlock() {\n    return this.getElement('end', 'block');\n  }\n\n  /**\n   * 获取当前选中的anchor位置对应的inline\n   */\n  public get anchorInline() {\n    return this.getElement('anchor', 'inline');\n  }\n\n  /**\n   * 获取当前选中的focus位置对应的inline\n   */\n  public get focusInline() {\n    return this.getElement('focus', 'inline');\n  }\n\n  /**\n   * 获取当前选中的start位置对应的inline\n   */\n  public get startInline() {\n    return this.getElement('start', 'inline');\n  }\n\n  /**\n   * 获取当前选中的end位置对应的inline\n   */\n  public get endInline() {\n    return this.getElement('end', 'inline');\n  }\n\n  /**\n   * 获取当前选中的anchor位置对应的text\n   */\n  public get anchorText() {\n    return this.getElement('anchor', 'text');\n  }\n\n  /**\n   * 获取当前选中的focus位置对应的text\n   */\n  public get focusText() {\n    return this.getElement('focus', 'text');\n  }\n\n  /**\n   * 获取当前选中的start位置对应的text\n   */\n  public get startText() {\n    return this.getElement('start', 'text');\n  }\n\n  /**\n   * 获取当前选中的end位置对应的text\n   */\n  public get endText() {\n    return this.getElement('end', 'text');\n  }\n\n  /**\n   * 获取当前选中位置对应的marks。\n   * 如果用户设置了正在编辑的样式，返回用户的设置Marks；否则返回当前文字的Marks。\n   */\n  public get activeMarks() {\n    if (!this.selection) {\n      return [];\n    }\n    return (\n      this.selection.marks ||\n      this.document.getActiveMarksAtRange(this.selection)\n    );\n  }\n\n  /**\n   * 是否是blur状态\n   */\n  public get isBlurred() {\n    return !this.isFocused;\n  }\n\n  /**\n   * 获取当前选区对应的fragment\n   */\n  public get fragment() {\n    const { selection, document } = this;\n    return selection\n      ? document.getFragmentAtRange(selection)\n      : Document.create();\n  }\n\n  public merge(props: Partial<ValueProperties>) {\n    return new Value({\n      data: this.data,\n      document: this.document,\n      selection: this.selection,\n      remoteSelections: this.remoteSelections,\n      injections: this.injections,\n      decorations: this.decorations,\n      composing: this.composing,\n      isFocused: this.isFocused,\n      ...props,\n    });\n  }\n\n  public set<T extends keyof ValueProperties>(\n    key: T,\n    value: Required<ValueProperties>[T],\n  ) {\n    return this.merge({\n      [key]: value,\n    });\n  }\n\n  public updatePoints(\n    document: Document,\n    map: (point: TextPoint) => TextPoint | null,\n    removed?: Node,\n  ) {\n    const updateSelections = (selections, selection) => {\n      if (!Selection.isSelection(selection)) {\n        return [...selections, selection];\n      }\n      let { anchor, focus } = selection;\n      if (anchor.isEdgePoint() || focus.isEdgePoint()) {\n        ({ anchor, focus } = selection.convertToTextPoints(document));\n      }\n      const newAnchor = map(anchor);\n      const newFocus = map(focus);\n      if (!newAnchor || !newFocus) {\n        return selections;\n      }\n      if (\n        equal(newAnchor, anchor) &&\n        equal(newFocus, focus) &&\n        Selection.isValidSelection(document, selection)\n      ) {\n        // 如果选区没有任何变化，返回原选区即可\n        return [...selections, selection];\n      }\n      return [\n        ...selections,\n        selection.merge({\n          anchor: newAnchor,\n          focus: newFocus,\n        }),\n      ];\n    };\n\n    // FIXME: 当 Document 内没有 Text 节点时，无法被 focus，等价于废档\n    const selections = [this.selection].reduce<Selection[]>(\n      updateSelections,\n      [],\n    );\n    const remoteSelections = this.remoteSelections.reduce<Selection[]>(\n      updateSelections,\n      [],\n    );\n\n    const decorations = this.decorations.reduce<Decoration[]>((decs, dec) => {\n      const { start, end } = dec;\n      const newStart = map(start);\n      const newEnd = map(end);\n      if (!newStart || !newEnd) {\n        return decs;\n      }\n      const startText = document.getNode(newStart.key);\n      const endText = document.getNode(newEnd.key);\n      if (!startText || !endText) {\n        return decs;\n      }\n\n      if (\n        removed &&\n        Block.isBlock(removed) &&\n        [start, end].every((n) => removed.getNode(n.key))\n      ) {\n        // 删除 Block 节点时, 内部包含的 decoration 清空掉\n        return decs;\n      } \n\n      if (equal(newStart, newEnd) && startText.text) {\n        return decs;\n      }\n      return [\n        ...decs,\n        dec.merge({\n          start: newStart,\n          end: newEnd,\n        }),\n      ];\n    }, []);\n    return this.merge({\n      selection: selections[0] || getDefaultSelection(document),\n      remoteSelections,\n      decorations,\n    });\n  }\n\n  private addMark(path: Path, offset: number, length: number, mark: Mark) {\n    let { document } = this;\n    document = document.addMark(path, offset, length, mark);\n    return this.set('document', document);\n  }\n\n  private insertNode(path: Path, node: Node) {\n    let { document } = this;\n    document = document.insertNode(path, node);\n    return this.set('document', document);\n  }\n\n  private insertText(path: Path, offset: number, text: string, marks: Mark[]) {\n    const { document: prevDoc } = this;\n    const document = prevDoc.insertText(path, offset, text, marks);\n    // node must be Text if .insertText works.\n    const node = prevDoc.assertTextByPath(path);\n    return this.updatePoints(document, (point) => {\n      // 若在当前选区之前插入文本，则需要后移选区\n      // insert 'e'\n      //   │    cursor\n      //   ▼     │\n      //  HlloWor│ld\n      //         │\n      //\n      //     │\n      //     │ inserted\n      //     ▼\n      //\n      //          │\n      //  HelloWor│d\n      //          │\n      //        cursor\n      if (node.key === point.key && offset <= point.offset) {\n        return point.moveForward(text.length);\n      }\n      return point;\n    }).set('document', document);\n  }\n\n  private mergeNode(path: Path) {\n    const { document: prevDoc, injections: prevInject } = this;\n    const document = prevDoc.mergeNode(path);\n    const injections = prevInject.filter(({ key }) => {\n      const injectTargetPath = prevDoc.getPath(key);\n      return injectTargetPath && !Path.isEqual(injectTargetPath, path);\n    });\n    // prev & node could not be null if .mergeNode works.\n    const prev = prevDoc.getPreviousSiblingByPath(path)!;\n    const node = prevDoc.getNodeByPath(path)!;\n    return this.updatePoints(document, (point) => {\n      // 如果选区所在的文本被 merge，则需要将光标移动到合并后的文本，并且修正光标起点\n      //     ┌─────────┐  cursor\n      //     │         │ │\n      // ┌───▼───┐ ┌───┴─┼────┐\n      // │ Hello │ │ Worl│d   │\n      // └───────┘ └─────┼────┘\n      //                 │\n      //        │\n      //        │ merged\n      //        │\n      //        ▼  \n      //\n      //           │\n      // ┌─────────┼──┐\n      // │HelloWorl│d │\n      // └─────────┼──┘\n      //           │\n      //          cursor\n      if (Text.isText(node) && point.key === node.key) {\n        return point.merge({\n          key: prev.key,\n          offset: prev.text.length + point.offset,\n        });\n      }\n      return point;\n    }).merge({ document, injections });\n  }\n\n  private moveNode(path: Path, newPath: Path) {\n    if (equal(path, newPath)) {\n      return this;\n    }\n\n    let { document } = this;\n    document = document.moveNode(path, newPath);\n    return this.set('document', document);\n  }\n\n  private removeMark(path: Path, offset: number, length: number, mark: Mark) {\n    let { document } = this;\n    document = document.removeMark(path, offset, length, mark);\n    return this.set('document', document);\n  }\n\n  private removeNode(path: Path) {\n    const { document: prevDoc, injections: prevInject } = this;\n    const node = prevDoc.assertNodeByPath(path);\n    const prev = prevDoc.getPreviousNodeByPath(path);\n    const next = prevDoc.getNextNodeByPath(path);\n\n    const document = prevDoc.removeNode(path);\n    const injections = prevInject.filter(({ key }) => {\n      const injectTargetPath = prevDoc.getPath(key);\n      return injectTargetPath && !Path.isEqual(injectTargetPath, path);\n    });\n\n    // `document.nodes` is empty.\n    if (!prev && !next) {\n      return this.merge({\n        document,\n        selection: getDefaultSelection(document),\n        remoteSelections: [],\n        injections: [],\n        decorations: [],\n        composing: '',\n      });\n    }\n\n    return this.updatePoints(document, (point) => {\n      if (node.key === point.key || (node.isElement() && node.hasNode(point.key))) {\n        // 若删除选区所在的节点或者其父节点，则要么移动选区到上一节点末，要么移动选区到下一节点开头\n        //              cursor\n        // ┌───────┐ ┌────┼───┐\n        // │ Hello │ │ Wor│ld │\n        // └───────┘ └────┼───┘\n        //\n        //          │\n        //          │ removed\n        //          ▼\n        //\n        // ┌──────┼┐\n        // │ Hello││\n        // └──────┼┘\n        //      cursor\n        if (prev) {\n          const lastText = prev.getLastText();\n          if (lastText) {\n            return point.moveToEndOfNode(lastText);\n          }\n        }\n        //       cursor\n        //       │\n        //  ┌────┼───┐ ┌───────┐\n        //  │ Wor│ld │ │ Hello │\n        //  └────┼───┘ └───────┘\n        //       │\n\n        //         │\n        //         │ removed\n        //         ▼\n        //   │\n        //  ┌┼──────┐\n        //  ││Hello │\n        //  └┼──────┘\n        //   │\n        // cursor\n\n        if (next) {\n          const firstText = next.getFirstText();\n          if (firstText) {\n            return point.moveToStartOfNode(firstText);\n          }\n        }\n        return null;\n      }\n      return point;\n    }, node).merge({ document, injections });\n  }\n\n  private removeText(path: Path, offset: number, text: string) {\n    const { document: prevDoc } = this;\n    const document = prevDoc.removeText(path, offset, text);\n    // node must be Text if .insertText works.\n    const node = prevDoc.assertTextByPath(path);\n    const start = offset;\n    const end = start + text.length;\n    return this.updatePoints(document, (point) => {\n      if (node.key === point.key) {\n        // 若当前选区在删除文本之后，则需要前移选区\n        //          cursor\n        //   ┌────┐   │\n        //  H│ello│Wor│d\n        //   └────┘   │\n        //\n        //       │\n        //       │      removed\n        //       ▼\n        //\n        //      │\n        //  HWor│d\n        //      │\n        //    cursor\n        if (point.offset >= end) {\n          return point.moveBackward(text.length);\n        }\n        // 若当前选区在删除文本起点之后，则前移选区到删除起点\n        //   ┌────┐\n        //  H│ello│World\n        //   └────┘\n        //      ──────  selection\n        //\n        //      │\n        //      │      removed\n        //      ▼\n        //\n        //   HWorld\n        //    ──── selection\n        if (point.offset > start) {\n          return point.set('offset', start);\n        }\n      }\n      return point;\n    }).set('document', document);\n  }\n\n  private setMark(\n    path: Path,\n    offset: number,\n    length: number,\n    mark: Mark,\n    properties: Partial<MarkProperties>,\n  ) {\n    let { document } = this;\n    document = document.setMark(path, offset, length, mark, properties);\n    return this.set('document', document);\n  }\n\n  private setNode(path: Path, properties: Partial<ElementProperties>) {\n    let { document } = this;\n    document = document.setNode(path, properties);\n    return this.set('document', document);\n  }\n\n  /**\n   * 拷贝出一个新value，并设置选区字段\n   */\n  public setSelection(selection: Selection) {\n    return this.set('selection', selection);\n  }\n\n  private splitNode(\n    path: Path,\n    position: number,\n    properties: Partial<ElementProperties>,\n  ) {\n    const { document: prevDoc } = this;\n    const document = prevDoc.splitNode(path, position, properties);\n    // node could not be null if .splitNode works.\n    const node = prevDoc.getNodeByPath(path)!;\n    return this.updatePoints(document, (point) => {\n      // 如果在当前文本进行分裂，则需要调整选区到分裂后的文本\n      //   position\n      //       │    cursor\n      //       │   │\n      //  Hello│Wor│ld\n      //       │   │\n      //       │\n      //\n      //        │  split node\n      //        ▼\n      //\n      //  Hello\n      //  Wor│ld\n      //    cursor\n      if (\n        Text.isText(node) &&\n        point.key === node.key &&\n        position <= point.offset\n      ) {\n        // next is just create by .splitNode\n        const next = document.getNextSiblingByPath(path)!;\n        return point.merge({\n          key: next.key,\n          offset: point.offset - position,\n        });\n      }\n      return point;\n    }).set('document', document);\n  }\n\n  /**\n   * 应用operation，并返回一个新value\n   */\n  public applyOperation(operation: Operation) {\n    let value: Value | null = null;\n    const { type } = operation;\n    if (type === OperationType.AddMark) {\n      const { path, offset, length, mark } = operation as AddMarkOperation;\n      value = this.addMark(path, offset, length, mark);\n    } else if (type === OperationType.InsertNode) {\n      const { path, node } = operation as InsertNodeOperation;\n      value = this.insertNode(path, node);\n    } else if (type === OperationType.InsertText) {\n      const {\n        path,\n        offset,\n        text,\n        marks = [],\n      } = operation as InsertTextOperation;\n      value = this.insertText(path, offset, text, marks);\n    } else if (type === OperationType.MergeNode) {\n      const { path } = operation as MergeNodeOperation;\n      value = this.mergeNode(path);\n    } else if (type === OperationType.MoveNode) {\n      const { path, newPath } = operation as MoveNodeOperation;\n      value = this.moveNode(path, newPath);\n    } else if (type === OperationType.RemoveMark) {\n      const { path, offset, length, mark } = operation as RemoveMarkOperation;\n      value = this.removeMark(path, offset, length, mark);\n    } else if (type === OperationType.RemoveNode) {\n      const { path } = operation as RemoveNodeOperation;\n      value = this.removeNode(path);\n    } else if (type === OperationType.RemoveText) {\n      const { path, offset, text } = operation as RemoveTextOperation;\n      value = this.removeText(path, offset, text);\n    } else if (type === OperationType.SetMark) {\n      const {\n        path,\n        offset,\n        length,\n        mark,\n        properties,\n      } = operation as SetMarkOperation;\n      value = this.setMark(path, offset, length, mark, properties);\n    } else if (type === OperationType.SetNode) {\n      const { path } = operation as SetNodeOperation;\n      const properties = mergeUserProperties(this, operation);\n      value = this.setNode(path, properties);\n    } else if (type === OperationType.SetSelection) {\n      const { selection } = operation as SetSelectionOperation;\n      value = this.setSelection(selection);\n    } else if (type === OperationType.SplitNode) {\n      const { path, position, properties } = operation as SplitNodeOperation;\n      value = this.splitNode(path, position, properties);\n    } else {\n      throw new Error(`Unknown operation type: \"${type}\".`);\n    }\n    if (value.selection.anchor.key === value.document.key) {\n      const selection = getDefaultSelection(value.document);\n      return value.setSelection(selection);\n    }\n    return value;\n  }\n\n  public toJSON(options?: SerializeOptions) {\n    const object: ValueJSON = {\n      klass: 'value',\n      document: this.document.toJSON(options),\n    };\n    if (options?.preserveDecorations) {\n      object.decorations = this.decorations.map((decotation) => {\n        const { start, end, mark } = decotation.toJSON(options);\n        return {\n          mark,\n          start: {\n            ...start,\n            path: this.document.getPath(decotation.start.key),\n          },\n          end: {\n            ...end,\n            path: this.document.getPath(decotation.end.key),\n          },\n        };\n      });\n    }\n    if (options?.preserveSelections) {\n      const { selection } = this;\n      const { anchor, focus } = selection.toJSON(options);\n      object.selection = {\n        anchor: {\n          ...anchor,\n          // @ts-ignore\n          path: this.document.getPath(selection.anchor.key),\n        },\n        focus: {\n          ...focus,\n          // @ts-ignore\n          path: this.document.getPath(selection.focus.key),\n        },\n      };\n    }\n    if (options?.preserveInjections) {\n      object.injections = this.injections.map((injection) =>\n        injection.toJSON(),\n      );\n    }\n    return object;\n  }\n}\n","/* eslint-disable no-continue */\n/* eslint-disable no-restricted-syntax */\n/**\n * @packageDocumentation\n * @ignore\n */\n\nexport * from './selection';\n","import React from 'react';\nimport { Observable, Observer } from '../models/observable';\nimport { Terminal } from '../interfaces/controller';\nexport function usePendingTerminal(\n  terminal$: Observable<Terminal | null>,\n  onTerminate: Observer<Terminal | null>,\n) {\n  React.useEffect(() => {\n    const subs = terminal$.subscribe(onTerminate);\n    return subs.unsubscribe;\n  }, [onTerminate, terminal$]);\n}\n","/**\n * @packageDocumentation\n * @module Plugin-PlaceHolder\n */\nimport * as React from 'react';\nimport Controller from '../controller/index';\nimport Decoration from '../models/decoration';\nimport { TextPoint } from '../models/point';\nimport Node from '../models/node';\nimport Element from '../models/element';\nimport Text from '../models/text';\nimport Mark, { MarkProperties } from '../models/mark';\nimport RenderMarkProps from '../interfaces/renderMarkProps';\nimport { useSelectionData } from '../hooks/useSelectionData';\nimport { usePendingTerminal } from '../hooks/usePendingTerminal';\nimport * as environment from '../utils/environment';\nimport { useSelectingHots } from '../hooks/useHots';\n\nconst placeholderMarkType = 'cangjiePlaceholder';\nconst defaultPlaceholerSymbol = Symbol();\n\nconst placeholderStyle: React.CSSProperties = {\n  pointerEvents: 'none',\n  userSelect: 'none',\n  WebkitUserSelect: 'none',\n  position: 'relative',\n};\n\n// 用于外部宽度没有撑开的情况\nconst innerStyleWithWidth: React.CSSProperties = {\n  width: 'fit-content',\n  whiteSpace: 'nowrap',\n  color: 'rgba(23,26,29, 0.4)',\n};\n\nconst innerStyle: React.CSSProperties = {\n  position: 'absolute',\n  ...innerStyleWithWidth,\n};\n\nconst ContentPlaceholderContext = React.createContext<React.MutableRefObject<string | React.ReactElement> | null>(null);\nfunction useContentPlaceholder() {\n  return React.useContext(ContentPlaceholderContext);\n}\n\ninterface PlaceholderProps {\n  controller: Controller;\n  node: Node;\n  mark: Mark;\n  children: React.ReactNode;\n}\n\n/**\n* 目前需要支持两种配置方式\n* 1.自定义展示placeholder配置\n* 2.支持从各个插件读取placeholder配置\n* todo: 排版模式下不支持\n*/\ninterface PlaceholderConfig {\n  text: string | Symbol | ((controller: Controller, node: Node) => string);\n  when: (controller: Controller, node: Node) => boolean;\n  // 满足条件后禁用\n  disable?: boolean;\n  // 是否在当前行显示\n  focusMode?: boolean;\n  needWidth?: boolean;\n}\ninterface PlaceholderPluginConfig {\n  isPlaceholderVisible?: (controller: Controller, node: Node) => boolean;\n}\n\nfunction blockEvent(event: React.TouchEvent | React.MouseEvent) {\n  event.preventDefault();\n  event.stopPropagation();\n}\n\nconst defaultPx = '14.667';\nconst FONTSIZE_BIGGER = environment.IS_MOBILE ? 1.06 : 1;\n// 并不需要精确计算placeholder的fontsize，目前只在非排版下使用\nfunction formatFontSize(mark?: MarkProperties) {\n  if (mark?.data?.value) {\n    const { value, szUnit } = mark.data;\n    const unit = szUnit || 'px';\n    if (unit === 'pt') {\n      // word等转换的pt数据依然需要格式化\n      return `${value * FONTSIZE_BIGGER}pt`\n    } else if (unit === 'px' && mark.data.value === 14) {\n      // 特殊处理默认字号：稍微放大至11pt(14.667px)\n      return `${defaultPx}px`\n    }\n  }\n  return '';\n}\n\nfunction PlaceholderProvider({ placeholder = '', children }) {\n  const placeholderRef = React.useRef(placeholder);\n  placeholderRef.current = placeholder;\n  return (\n    <ContentPlaceholderContext.Provider value={placeholderRef}>\n      {children}\n    </ContentPlaceholderContext.Provider>\n  );\n}\n\nfunction Placeholder(props: PlaceholderProps) {\n  const [, forceUpdate] = React.useReducer((c) => !c, false);\n  const contentPlaceholderRef = useContentPlaceholder();\n\n  // 逻辑收敛到Placeholder组件\n  const { controller, node, mark, children } = props;\n  const { selection, isFocused, composing } = controller.value;\n  const focusKey = selection?.focus?.key;\n  const { config, block } = mark.data;\n  const disable = !config || config.disable || composing;\n  const { text, needWidth, focusMode, when } = config as PlaceholderConfig;\n  const isDefaultPlaceholder = defaultPlaceholerSymbol === text;\n\n  const showDefaultPlaceholder = React.useMemo(() => {\n    // 这里需要对默认placeholder做一个特殊的处理，默认placeholder是需要关心全文的，而不是上下文就可以了\n    if (!isDefaultPlaceholder) return false;\n    return when(controller, block);\n  }, [controller.value, block, isDefaultPlaceholder, when]);\n\n  const noRender = disable ||\n  (\n    focusMode && (!isFocused || !focusKey || node.key !== focusKey || controller.value.selection.isExpanded)\n  )\n;\n\n  const innerPlaceholderStyle = React.useMemo(() => {\n    const style = needWidth ? innerStyleWithWidth : innerStyle;\n    const leave = (node as Text).leaves?.length === 1 ? (node as Text).leaves[0] : null;\n    const size = leave?.marks?.find((m) => m.type === 'sz');\n    if (size) {\n      const fontSize = formatFontSize(size);\n      if (fontSize) {\n        return {\n          ...style,\n          fontSize,\n        }\n      }\n    }\n    return style;\n  }, [node, needWidth]);\n\n  const handlePendingSelectionChange = React.useCallback(() => {\n    if (\n      !disable &&\n      focusKey !== controller.value.selection?.focus?.key &&\n      (node.key === focusKey || node.key === controller.value.selection?.focus?.key)\n    ) {\n      forceUpdate();\n    }\n  }, [controller, focusKey, node, disable]);\n\n  const handlePendingTerminate = React.useCallback(() => {\n    if (\n      node.key !== controller.value.selection?.focus?.key &&\n      !noRender\n    ) {\n      forceUpdate();\n    }\n  }, [noRender, node, controller]);\n\n  usePendingTerminal(controller.terminal$, handlePendingTerminate);\n  useSelectionData(controller.selectionData$, null, handlePendingSelectionChange, []);\n  // 当监听到热区时，也要重渲 placeholder，避免 placeholder 不消失\n  useSelectingHots(controller, handlePendingSelectionChange);\n\n  if (noRender || (isDefaultPlaceholder && !showDefaultPlaceholder)) return <>{children}</>;\n\n  const textContent = typeof text === 'function' ? text(controller, node) : text;\n  return (\n    <>\n      {children}\n      <span\n        onTouchStart={blockEvent}\n        onMouseDown={blockEvent}\n        style={placeholderStyle}\n        data-testid=\"cangjie-placeholder\"\n        data-cangjie-placeholder\n      >\n        <span style={innerPlaceholderStyle}>\n          {isDefaultPlaceholder ? contentPlaceholderRef?.current : textContent}\n        </span>\n      </span>\n    </>\n  );\n}\n\nexport default function createPlaceholderPlugin(config: PlaceholderPluginConfig = {}) {\n  const { isPlaceholderVisible } = config;\n\n  // HACK: use `Symbol` as placeholder before getting placholder from `Cangjie.Content`.\n  const contentPlaceholderConfig: PlaceholderConfig | null = isPlaceholderVisible\n    ? { when: isPlaceholderVisible, text: defaultPlaceholerSymbol }\n    : null;\n  let placeholdersConfig: PlaceholderConfig[] | null = null;\n\n  function decorateNode(node: Element, controller: Controller, next) {\n    if (!node.isEmpty()) {\n      return next();\n    }\n\n    // 读取placeholder配置\n    if (!placeholdersConfig) {\n      placeholdersConfig = [];\n      if (contentPlaceholderConfig) {\n        // 内置空白行placeholder逻辑\n        placeholdersConfig.push(contentPlaceholderConfig);\n      }\n      // @ts-ignore\n      const { placeholder } = controller.handlers;\n      placeholder?.forEach((item) => {\n        if (Array.isArray(item)) {\n          placeholdersConfig!.push(...item);\n        } else {\n          // @ts-ignore\n          placeholdersConfig!.push(item);\n        }\n      });\n      placeholdersConfig = placeholdersConfig.filter(({ text, disable }) => !!(text || disable));\n    }\n\n    const match = placeholdersConfig.find(({ when }) => when(controller, node));\n    if (!match) {\n      return next();\n    }\n\n    const first = node.getFirstText();\n    const last = node.getLastText();\n    if (!first || !last) {\n      return next();\n    }\n\n    const start = TextPoint.create({\n      key: first.key,\n      offset: 0,\n    });\n    const end = TextPoint.create({\n      key: last.key,\n      offset: last.text.length,\n    });\n    return [Decoration.create({\n      start,\n      end,\n      mark: Mark.create({ type: placeholderMarkType, data: { config: match, block: node } }),\n    }), ...next()];\n  }\n\n  function renderEditable(props, _, next) {\n    return (\n      <PlaceholderProvider {...props}>\n        {next()}\n      </PlaceholderProvider>\n    );\n  }\n\n  function renderMark(props: RenderMarkProps, controller: Controller, next) {\n    const { parent, node, mark, children } = props;\n    if (mark.type !== placeholderMarkType) {\n      return next();\n    }\n    return (\n      <Placeholder\n        key={`${parent.key}_placeholder`}\n        controller={controller}\n        node={node}\n        mark={mark}\n      >\n        {children()}\n      </Placeholder>\n    );\n  }\n\n  return {\n    decorateNode,\n    renderEditable,\n    renderMark,\n  };\n}\n","import * as React from 'react';\n\nexport const hasIntersectionObserver = process.env.NODE_ENV === 'test'\n  || (typeof window !== 'undefined' && 'IntersectionObserver' in window);\n\ntype IntersectionChangeHandler = (entry: IntersectionObserverEntry) => void;\n\nclass IntersectionObserver {\n  private static instance: IntersectionObserver | null = null;\n  public static getInstance() {\n    if (!IntersectionObserver.instance) {\n      IntersectionObserver.instance = new IntersectionObserver();\n    }\n    return IntersectionObserver.instance;\n  }\n\n  private elementToHandler: WeakMap<Element, IntersectionChangeHandler>;\n  private nativeIO: globalThis.IntersectionObserver | null;\n  private constructor() {\n    this.elementToHandler = new WeakMap();\n    this.nativeIO = hasIntersectionObserver\n      ? new window.IntersectionObserver(this.handleIntersectionChange)\n      : null;\n  }\n  private handleIntersectionChange = (entries: IntersectionObserverEntry[]) => {\n    entries.forEach(entry => {\n      const handler = this.elementToHandler.get(entry.target);\n      if (handler) {\n        handler(entry);\n      }\n    });\n  }\n\n  public observe(element: Element, handler: IntersectionChangeHandler) {\n    this.elementToHandler.set(element, handler);\n    this.nativeIO?.observe(element);\n  }\n  public unobserve(element: Element) {\n    this.elementToHandler.delete(element);\n    this.nativeIO?.unobserve(element);\n  }\n}\n\nexport default function useElementVisibility(\n  elementRef: React.MutableRefObject<HTMLElement | null>,\n  defaultVisible: boolean = false,\n): [boolean, () => void] {\n  const [visible, setVisible] = React.useState(defaultVisible);\n  const unobserve = () => {\n    if (elementRef.current) {\n      IntersectionObserver.getInstance().unobserve(elementRef.current);\n    }\n  };\n  React.useLayoutEffect(() => {\n    if (elementRef.current) {\n      IntersectionObserver.getInstance().observe(\n        elementRef.current,\n        (entry: IntersectionObserverEntry) => setVisible(entry.isIntersecting),\n      );\n      return unobserve;\n    }\n    return undefined;\n  }, []);\n  return [visible, unobserve];\n}","import * as React from 'react';\nimport Controller from '../../controller';\nimport Selection from '../../models/selection';\nimport Node from '../../models/node';\nimport RenderNodeProps from '../../interfaces/renderNodeProps';\nimport { useZoom } from '../../hooks/useZoom';\nimport { useSelectionData } from '../../hooks/useSelectionData';\nimport { useSelectingHots } from '../../hooks/useHots';\nimport * as domUtils from '../../utils/dom';\nimport useElementVisibility, { hasIntersectionObserver } from './useElementVisibility';\n\nexport enum LazyRenderStrategyType {\n  LazyLoad = 'lazyload',\n  Pruning = 'pruning',\n}\n\ninterface LazyRenderStrategy {\n  type?: LazyRenderStrategyType;\n  forceVisible?: boolean;\n  placeholder?: React.ReactElement | null;\n  size?: {\n    width: number;\n    height: number;\n  };\n}\n\ninterface LazyLoadWrapperProps {\n  node: Node;\n  placeholder?: React.ReactElement | null;\n  size?: {\n    height: number;\n    width?: number;\n  };\n  children: React.ReactElement;\n}\nfunction LazyLoadWrapper({ node, placeholder = null, size, children }: LazyLoadWrapperProps) {\n  const placeholderRef = React.useRef<HTMLDivElement | null>(null);\n  const [visible, unobserve] = useElementVisibility(placeholderRef);\n  if (visible) {\n    unobserve();\n  }\n  if (!visible) {\n    return (\n      <div\n        ref={placeholderRef}\n        data-cangjie-key={node.key}\n        data-cangjie-lazy-load\n        style={size}\n      >\n        {placeholder}\n      </div>\n    );\n  }\n  return children;\n}\n\ninterface PruningManagerProps {\n  controller: Controller;\n  children: React.ReactElement;\n}\nfunction PruningManager({ controller, children }: PruningManagerProps) {\n  const selectionUpdator = React.useCallback(\n    ({ range }: { range: Selection }) => {\n      if (range.isExpanded) {\n        return;\n      }\n      const point = range.focus;\n      const key = point.isTextPoint() ? `${point.key}:0` : point.key;\n      const dom = domUtils.findDOMNodeSafely(key);\n      if (dom) {\n        showPrunedElements(dom);\n      }\n    },\n    [controller],\n  );\n\n  const onHots = React.useCallback(() => {\n    selectionUpdator({ range: controller.value.selection });\n  }, [controller, selectionUpdator]);\n\n  useSelectionData(controller.selectionData$, null, selectionUpdator, []);\n  useSelectingHots(controller, onHots);\n\n  return children;\n}\n\ninterface PruningWrapperProps {\n  controller: Controller;\n  node: Node;\n  isSelected: boolean;\n  forceVisible: boolean;\n  children: React.ReactElement;\n}\nfunction PruningWrapper(props: PruningWrapperProps) {\n  const zoom = useZoom();\n  const { controller, node, forceVisible, children } = props;\n  const [isSelected, setIsSelected] = React.useState(props.isSelected);\n  const placeholderRef = React.useRef<HTMLDivElement | null>(null);\n  const [placeholderStyle, setPlaceholderStyle] = React.useState<React.CSSProperties | undefined>();\n  const [isElementVisible] = useElementVisibility(placeholderRef, true);\n  const visible = isElementVisible || isSelected || forceVisible;\n  const prevVisible = React.useRef<boolean>(visible);\n\n  const onHots = React.useCallback(() => {\n    const { selection } = controller.value;\n    setIsSelected(controller.view.isNodeInRange(node.key, selection));\n  }, [controller, node.key]);\n\n  useSelectionData(controller.selectionData$, null, onHots, []);\n  useSelectingHots(controller, onHots);\n\n  React.useLayoutEffect(() => {\n    if (prevVisible.current === visible) {\n      return;\n    }\n\n    if (prevVisible.current && !visible) {\n      const placeholder = placeholderRef.current;\n      if (!placeholder) {\n        return;\n      }\n      const placeholderClientRect = placeholder.getBoundingClientRect();\n      // HACK: `IntersectionObserver` cannot detect zero height element in Safari iframe.\n      const height = placeholderClientRect.height || 1;\n      // FIX: thrashing\n      //   1. When placeholder is visible\n      //   2. Remove `display: none` of placeholder\n      //   3. Descendant's margin will push placeholder out of view\n      // So placeholder will thrash if `margin-top` & `margin-bottom` is incorrect.\n      const marginTop = placeholder.previousElementSibling\n        ? placeholderClientRect.top - placeholder.previousElementSibling.getBoundingClientRect().bottom\n        : 0;\n      const marginBottom = placeholder.nextElementSibling\n        ? placeholder.nextElementSibling.getBoundingClientRect().top - placeholderClientRect.bottom\n        : 0;\n      setPlaceholderStyle({\n        height: height / zoom,\n        marginTop: marginTop / zoom,\n        marginBottom: marginBottom / zoom,\n      });\n    } else { // !prevVisible.current && visible\n      setPlaceholderStyle(undefined);\n    }\n    prevVisible.current = visible;\n  }, [visible, zoom]);\n\n  return (\n    <div\n      ref={placeholderRef}\n      data-cangjie-perf-pruning={!visible}\n      style={placeholderStyle}\n    >\n      <div\n        style={placeholderStyle && { display: 'none' }}\n      >\n        {children}\n      </div>\n    </div>\n  );\n}\n\nconst DATA_CANGJIE_PERF_PRUNING = 'data-cangjie-perf-pruning';\nfunction showPrunedElements(target: Element) {\n  const ancestorsWithPruning: Element[] = [];\n  let ancestor: Element | null | undefined = target;\n  while (ancestor) {\n    if (ancestor.getAttribute(DATA_CANGJIE_PERF_PRUNING) === 'true') {\n      ancestorsWithPruning.push(ancestor);\n    }\n    ancestor = ancestor.parentElement;\n  }\n  ancestorsWithPruning.forEach((node) => {\n    if (node instanceof HTMLElement) {\n      node.style.height = '';\n      node.style.marginTop = '';\n      node.style.marginBottom = '';\n      node.setAttribute(DATA_CANGJIE_PERF_PRUNING, 'false');\n    }\n    const { firstElementChild } = node;\n    if (firstElementChild instanceof HTMLElement) {\n      firstElementChild.style.display = '';\n    }\n  });\n}\n\ninterface PerfLazyRenderPluginConfig {\n  lazyRenderStrategy?: (controller: Controller, node: Node) => LazyRenderStrategy;\n}\nfunction createPerfLazyRenderPlugin(config: PerfLazyRenderPluginConfig = {}) {\n  if (!hasIntersectionObserver) {\n    return {};\n  }\n\n  function renderEditable(_, controller: Controller, next) {\n    return (\n      <PruningManager controller={controller}>\n        {next()}\n      </PruningManager>\n    );\n  }\n\n  function renderNode({ node, isSelected }: RenderNodeProps, controller: Controller, next) {\n    const strategy = controller.query('lazyRenderStrategy', node) as LazyRenderStrategy || {};\n    const { type = LazyRenderStrategyType.LazyLoad } = strategy;\n    if (controller.enableVirtualize) {\n      return next();\n    }\n    if (type === LazyRenderStrategyType.LazyLoad && (strategy.placeholder || strategy.size)) {\n      const size = !strategy.size ? undefined : {\n        width: strategy.size.width,\n        // HACK: `IntersectionObserver` cannot detect zero height element in Safari iframe.\n        height: strategy.size.height || 1,\n      };\n      return (\n        <LazyLoadWrapper\n          node={node}\n          placeholder={strategy.placeholder}\n          size={size}\n        >\n          {next()}\n        </LazyLoadWrapper>\n      );\n    }\n    if (type === LazyRenderStrategyType.Pruning) {\n      return (\n        <PruningWrapper\n          controller={controller}\n          node={node}\n          isSelected={isSelected}\n          forceVisible={strategy.forceVisible || false}\n        >\n          {next()}\n        </PruningWrapper>\n      );\n    }\n    return next();\n  }\n\n  if (config.lazyRenderStrategy) {\n    return {\n      queries: { lazyRenderStrategy: config.lazyRenderStrategy },\n      renderEditable,\n      renderNode,\n    };\n  }\n  return {\n    renderEditable,\n    renderNode,\n  };\n}\ncreatePerfLazyRenderPlugin.factory = (defaultConfig = {}) => (config = {}) =>\n  createPerfLazyRenderPlugin({ ...defaultConfig, ...config });\ncreatePerfLazyRenderPlugin.LazyRenderStrategyType = LazyRenderStrategyType;\ncreatePerfLazyRenderPlugin.showPrunedElements = showPrunedElements;\ncreatePerfLazyRenderPlugin.useElementVisibility = useElementVisibility;\n\nexport default createPerfLazyRenderPlugin;\n","import * as React from 'react';\nimport Controller from '../controller';\nimport RenderNodeProps from '../interfaces/renderNodeProps';\nimport Node from '../models/node';\nimport { Subject } from '../models/observable';\n\ninterface FirstRenderContextValue {\n  animationFrameSubject: Subject<undefined>;\n  delayRenderSlices: Set<string>;\n}\nconst FirstRenderContext =\n  React.createContext<FirstRenderContextValue | null>(null);\n\ninterface FirstRenderManagerProps {\n  controller: Controller;\n  isFirstRenderSlice: (node: Node) => boolean;\n  firstFrameSize: number;\n  children: React.ReactNode;\n}\nfunction FirstRenderManager({\n  controller,\n  isFirstRenderSlice,\n  firstFrameSize,\n  children,\n}: FirstRenderManagerProps) {\n  const animationFrameSubject = React.useMemo(\n    () => new Subject<undefined>(),\n    [],\n  );\n\n  const delayRenderSlices = React.useMemo(() => {\n    const delays = new Set<string>();\n\n    let remained = firstFrameSize;\n    const document = controller.view;\n    document.forEachDescendant((node) => {\n      if (remained <= 0 && isFirstRenderSlice(node)) {\n        delays.add(node.key);\n      }\n      remained -= 1;\n    });\n\n    return delays;\n  }, []);\n\n  const context = React.useMemo(\n    () => ({\n      animationFrameSubject,\n      delayRenderSlices,\n    }),\n    [animationFrameSubject, delayRenderSlices],\n  );\n\n  React.useEffect(() => {\n    let raf: number | null = null;\n    function loop() {\n      if (!delayRenderSlices.size) {\n        return;\n      }\n      raf = window.requestAnimationFrame(() => {\n        context.animationFrameSubject.next(undefined);\n        loop();\n      });\n    }\n    loop();\n    return () => {\n      if (raf) {\n        window.cancelAnimationFrame(raf);\n      }\n    };\n  }, []);\n\n  return (\n    <FirstRenderContext.Provider value={context}>\n      {children}\n    </FirstRenderContext.Provider>\n  );\n}\n\nfunction useShouldMount(node: Node) {\n  const context = React.useContext(FirstRenderContext);\n  if (!context) {\n    throw new Error(\n      \"The `useShouldMount` hook must be used inside the <FirstRenderManager> component's context.\",\n    );\n  }\n\n  const [shouldMount, setShouldMount] = React.useState(\n    !context.delayRenderSlices.has(node.key),\n  );\n\n  React.useEffect(() => {\n    if (shouldMount) {\n      return undefined;\n    }\n    const subscription = context.animationFrameSubject.subscribe(() => {\n      subscription.unsubscribe();\n      context.delayRenderSlices.delete(node.key);\n      setShouldMount(true);\n    });\n    return subscription.unsubscribe;\n  }, []);\n\n  return shouldMount;\n}\n\ninterface FirstRenderSliceProps {\n  node: Node;\n  children: React.ReactElement;\n}\nfunction FirstRenderSlice({ node, children }: FirstRenderSliceProps) {\n  const shouldMount = useShouldMount(node);\n  return shouldMount ? children : null;\n}\n\ninterface PerfFirstRenderPluginConfig {\n  isFirstRenderSlice: (node: Node) => boolean;\n  firstFrameSize?: number;\n}\nfunction createPerfFirstRenderPlugin(config: PerfFirstRenderPluginConfig) {\n  const { isFirstRenderSlice, firstFrameSize = 1000 } = config;\n\n  function renderEditable(_, controller: Controller, next) {\n    return (\n      <FirstRenderManager\n        controller={controller}\n        isFirstRenderSlice={isFirstRenderSlice}\n        firstFrameSize={firstFrameSize}\n      >\n        {next()}\n      </FirstRenderManager>\n    );\n  }\n\n  function renderNode(props: RenderNodeProps, _, next) {\n    const { node } = props;\n    if (!isFirstRenderSlice(node)) {\n      return next();\n    }\n    return <FirstRenderSlice node={node}>{next()}</FirstRenderSlice>;\n  }\n\n  return {\n    renderEditable,\n    renderNode,\n  };\n}\ncreatePerfFirstRenderPlugin.factory =\n  (defaultConfig: PerfFirstRenderPluginConfig) =>\n  (config: Partial<PerfFirstRenderPluginConfig>) =>\n    createPerfFirstRenderPlugin({ ...defaultConfig, ...config });\n\nexport default createPerfFirstRenderPlugin;\n","import React from 'react';\nimport Decoration from '../../models/decoration';\nimport Document from '../../models/document';\nimport Injection from '../../models/injection';\n\nexport interface RelativeRect extends Pick<DOMRect, 'top' | 'left' | 'width' | 'height'> {\n  scrollLeft: number;\n}\n\n/**\n * 用于选区定位的依赖项\n *\n * @export\n * @interface SelectionContext\n */\nexport interface SelectionContext {\n  contentRect?: DOMRect;\n  // 选区相对定位的目标元素容器的 Rect，一般用于 scrollable 元素\n  relativeRect?: RelativeRect;\n  // 缩放比例（eg. 通过缩放工具栏可改变其值）\n  zoom: number;\n  // 纸张尺寸变化的标志（eg. 通过浏览器自带缩放功能可改变其值）\n  resizeFlag: number;\n\n  // 其他选区重渲的依赖项\n  document: Document;\n  injections: Injection[];\n  decorations: Decoration[];\n}\n\nexport const Context = React.createContext<SelectionContext | null>(null);\n\n/**\n * @deprecated\n */\nexport function useSelectionContext(): SelectionContext {\n  const context = React.useContext(Context);\n\n  if (!context) {\n    throw new Error('SelectionContext not found.');\n  }\n\n  return context;\n}\n","/**\n * @packageDocumentation\n * @module Hooks\n */\nimport * as React from 'react';\nimport { SelectionContext, useSelectionContext } from '../components/selection/context';\nimport { CURSOR_WIDTH, Selector } from '../constants';\nimport { EdgePoint, PointEdge, TextPoint } from '../models/point';\nimport {\n  findEdgePointPosition,\n  findTextPointPosition,\n} from '../utils/dom/findCaretPosition';\n\nfunction updatePosition(\n  caret: HTMLSpanElement,\n  point: EdgePoint | TextPoint,\n  selectionContext: SelectionContext,\n  zoom = 1,\n  isHanging = false,\n) {\n  const root = caret.closest(`[${Selector.content}]`) || undefined;\n  const { relativeRect: nodeRect } = selectionContext;\n  const relativeRect = nodeRect || caret.parentElement?.getBoundingClientRect();\n\n  let position: any = null;\n  if (point.isEdgePoint()) {\n    position = findEdgePointPosition(point, root);\n  } else {\n    const preferredEdge = isHanging ? 'start' : 'end';\n    position = findTextPointPosition(point, preferredEdge, root);\n  }\n\n  if (!position || !relativeRect) {\n    return;\n  }\n  const { clientTop, clientLeft, height } = position;\n  // 有相对定位的容器就以提供的相对定位为准，否则以光标的父节点为准\n  const relativeLeft = nodeRect ? nodeRect.left - nodeRect.scrollLeft : relativeRect.left;\n  const left = clientLeft - relativeLeft;\n  const top = clientTop - relativeRect.top;\n  caret.style.top = `${top / zoom}px`;\n  caret.style.left = point.isTextPoint() ? `${left / zoom - CURSOR_WIDTH / 2}px` : `${left / zoom + CURSOR_WIDTH / 2}px`;\n  caret.style.height = `${height / zoom}px`;\n}\n\n/**\n * @deprecated\n * 已废弃\n */\nexport function useOffsetPosition(\n  caretRef: React.RefObject<HTMLSpanElement>,\n  pointStr: string,\n  where: number | PointEdge,\n  zoom = 1,\n  isHanging = false,\n  deps: any[] = [], // 其他会引起光标位置变化的依赖\n) {\n  const selectionContext = useSelectionContext();\n  React.useLayoutEffect(() => {\n    const caret = caretRef.current;\n    if (!caret || !pointStr) {\n      return;\n    }\n\n    const offsetSeperatorIndex = pointStr?.lastIndexOf('-');\n    const key = pointStr?.substring(0, offsetSeperatorIndex);\n    if (!key) {\n      return;\n    }\n    let point: EdgePoint | TextPoint | undefined;\n    if (typeof where === 'number') {\n      point = TextPoint.create({\n        key,\n        offset: where,\n      });\n    } else {\n      point = EdgePoint.create({\n        key,\n        edge: where,\n      });\n    }\n    updatePosition(caret, point, selectionContext, zoom, isHanging);\n  }, [pointStr, where, zoom, isHanging, caretRef, selectionContext, ...deps]);\n}\n","import * as React from 'react';\nimport { throttle } from 'lodash-es';\nimport { Selector } from '../constants';\n\nconst THROTTLE_TIME_RESIZE = 300;\n\n/**\n * 在 ref 上层对应的 leaf block 尺寸变动时，调用 updator。内置了 throttle。\n */\nexport default function useLeafBlockResizer(\n  ref: React.RefObject<Element>,\n  updator: Function,\n  deps?: any[],\n) {\n  React.useEffect(() => {\n    const node = ref.current?.closest(`[${Selector.leafBlock}]`);\n    if (!node) {\n      return undefined;\n    }\n    const callback = throttle(() => {\n      updator();\n    }, THROTTLE_TIME_RESIZE);\n    // @ts-ignore\n    if (typeof ResizeObserver !== 'undefined') {\n      // @ts-ignore\n      const observer = new ResizeObserver(callback);\n      observer.observe(node);\n      return () => {\n        callback.cancel();\n        observer.unobserve(node);\n      };\n    }\n\n    window.addEventListener('resize', callback);\n    return () => {\n      callback.cancel();\n      window.removeEventListener('resize', callback);\n    };\n  }, deps || []);\n}\n","import { noop } from 'lodash-es';\nimport { useState, useEffect } from 'react';\nimport useControllerStatic from '../controller/useControllerStatic';\nimport { UserDataContent } from '../controller/userData';\nimport Element from '../models/element';\n\n/**\n * 获取用户数据\n * @param node \n * @param key \n * @returns \n */\nexport function useUserData<T extends keyof UserDataContent>(\n  node: Element,\n  key: T,\n) {\n  const controller = useControllerStatic();\n  const { uid } = controller;\n  const initValue = controller.userData.get(node, key);\n  const { uuid } = node.data;\n  const [data, setData] = useState(initValue);\n\n  useEffect(() => {\n    if (uid && uuid) {\n      // 订阅用户数据 update$ 更新（uid 和 uuid 存在的情况，存储在 document.data）\n      const sub = controller.userData.update$.subscribe((event) => {\n        const { uuid: euuid } = event;\n        if (euuid === uuid || euuid === '*') {\n          // 同一个节点，用户数据发生改变\n          const cNode = controller.value.document.getNode(node.key.split('-')[0]);\n          if (cNode && Element.isElement(cNode)) {\n            const nextData = controller.userData.get(cNode, key);\n            setData(nextData);\n          }\n        }\n      });\n      return () => sub.unsubscribe();\n    } else {\n      // 观察节点 node 变化（uid 或 uuid 不存在的情况，存储在 node.data）\n      const nextData = node.data?.[key];\n      if (nextData !== data) {\n        setData(nextData);\n      }\n      return noop;\n    }\n  }, [controller, node, uuid, uid, key, data]);\n\n  return data;\n}\n","import { useState, useEffect, useRef } from 'react';\nimport useControllerStatic from '../controller/useControllerStatic';\nimport { GroupWithKey } from '../interfaces/group';\nimport Element from '../models/element';\nimport Node from '../models/node';\nimport { Subscription } from '../models/observable';\n\nexport type GroupDataSelector<T = any> = (groups: GroupWithKey[]) => T;\n\n/**\n * 获得所在分组的数据 \n * @param node \n * @param selector \n * @param defaultValue \n * @returns \n * \n * @example\n * ```tsx\n * const Element = props => {\n *   const hidden = useGroupData(groups => groups.some(group => group.hidden));\n * \n *   // ...\n * }\n * ```\n */\nexport default function useGroupData<T>(\n  node: Node,\n  selector: GroupDataSelector<T>,\n  defaultValue: T,\n) {\n  let finalNode: Node | null = node;\n  const controller = useControllerStatic();\n\n  // 兼容老 Group 的代码\n  const legacyGroupIndex = node.key.indexOf('-group');\n  if (legacyGroupIndex > -1) {\n    const nodeKey = node.key.split('-group')[0];\n    const originalNode = controller.view.getNode(nodeKey);\n    if (originalNode) {\n      finalNode = originalNode;\n    }\n  }\n\n  const groups = controller.groupManager.getNodeGroups(finalNode as Element);\n\n  const selectorRef = useRef(selector);\n  selectorRef.current = selector;\n\n  // default state 就要取实际值，否则数据有延迟，有延迟就对虚拟化不友好\n  const defaultData = selectorRef.current(groups) || defaultValue;\n  const [data, setData] = useState<T>(defaultData);\n\n  // 响应上游的分组信息变更\n  useEffect(() => {\n    let sub: Subscription | null = null;\n    if ((finalNode && Element.isElement(finalNode))) {\n      sub = controller.groupManager.groups$.subscribe((groupsMap) => {\n        const groups = controller.groupManager.getNodeGroups(finalNode as Element);\n        setData(selectorRef.current(groups));\n      });\n    }\n    return () => {\n      if (sub) {\n        sub.unsubscribe();\n      }\n    };\n  }, [controller, finalNode]);\n\n  return data;\n}\n","import { Selector } from '../../constants';\nimport { SupportEdge } from '../../models/selection';\n\n/**\n *\n * If the HTML node is hide behind a horizontal scroll container, make it\n * visible\n */\nexport default function makeElementVisible(\n  /**\n   * dom node\n   */\n  domNode: HTMLElement,\n  /**\n   * which edge should be visible.\n   * options: start edge | end edge | all edges\n   */\n  edge: SupportEdge | 'all',\n  /**\n   * extra space added to the domNode's edge\n   */\n  extra: number,\n) {\n  const { left, right } = domNode.getBoundingClientRect();\n  let leftEdge = edge === 'end' ? right : left;\n  let rightEdge = edge === 'start' ? left : right;\n  leftEdge -= extra;\n  rightEdge += extra;\n  let node: HTMLElement | null = domNode;\n  while (node && !node.getAttribute(Selector.content)) {\n    if (node.scrollWidth > node.offsetWidth) {\n      const rect = node.getBoundingClientRect();\n      const offsetLeft = leftEdge - rect.left;\n      const offsetRight = rightEdge - rect.right;\n      if (offsetLeft < 0 || offsetRight > 0) {\n        const horizonOffset = offsetLeft < 0 ? offsetLeft : offsetRight;\n        node.scrollLeft += horizonOffset;\n        break;\n      }\n    }\n    node = node.parentElement;\n  }\n}\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport * as React from 'react';\nimport Controller from '../controller';\nimport CangjieInputEvent from '../events/cangjieInput';\nimport Selection from '../models/selection';\nimport hotkeys from '../utils/hotkeys';\nimport { IS_IOS, IS_MOBILE, IS_TOUCH_DEVICE, IS_SAFARI, IS_IPAD } from '../utils/environment';\nimport { debounce } from 'lodash-es';\n\n// PC: no prefix/surfix by default\nlet EMPTY_PREFIX = '';\nlet EMPTY_SURFIX = '';\n\nif (IS_IOS) {\n  // iOS / Mac - Safari: will ignore the only space in textarea.\n  EMPTY_PREFIX = '\\n.';\n  EMPTY_SURFIX = ' \\n';\n} else if (IS_MOBILE) {\n  // Android: will toggle between uppercase and lowercase\n  // while deleting with dot as the only character in textarea.\n  EMPTY_PREFIX = ' ';\n  // Android: Arrow buttons will not trigger any keyboard event when caret is at the edge of textarea value\n  // eg1. textarea value is: ' <cursor />', keydown event will not triggered by ArrowRight/ArrowDown\n  // eg2. textarea value is: '<cursor />', keydown event will not triggered by ArrowRight/ArrowDown/ArrowUp/ArrowLeft\n  EMPTY_SURFIX = ' ';\n}\n\nconst IS_TOUCH_MOBILE = IS_MOBILE || IS_TOUCH_DEVICE;\n\nexport const getEmptyValue = (t: string) =>\n  `${EMPTY_PREFIX}${t}${EMPTY_SURFIX}`;\n\nconst EMPTY_TEXT_AREA_VALUE = getEmptyValue('');\n\nexport const CHARACTERS_LENGTH_AFTER_USER_INPUT = EMPTY_SURFIX.length;\n\nfunction resetTextAreaValue(\n  textAreaRef: React.MutableRefObject<HTMLTextAreaElement | null>,\n  textAreaCacheRef: React.MutableRefObject<string>,\n) {\n  textAreaCacheRef.current = EMPTY_TEXT_AREA_VALUE;\n  const defaultCaretPosition =\n    EMPTY_TEXT_AREA_VALUE.length - CHARACTERS_LENGTH_AFTER_USER_INPUT;\n  // BACKGROUND:\n  //   Android 中，点击非工具栏区域 blur 后，再 focus 回编辑器\n  //   会出现 textarea.value === ' ' && textarea.selectionStart === 0 的情况\n  //   导致无法删除文字，输入文字后会吞掉光标前一个字\n  if (\n    textAreaRef.current && (\n      textAreaRef.current.value !== EMPTY_TEXT_AREA_VALUE ||\n      textAreaRef.current.selectionStart !== defaultCaretPosition ||\n      textAreaRef.current.selectionEnd !== defaultCaretPosition\n    )\n  ) {\n    textAreaRef.current.value = EMPTY_TEXT_AREA_VALUE;\n    textAreaRef.current.selectionStart = defaultCaretPosition;\n    textAreaRef.current.selectionEnd = defaultCaretPosition;\n  }\n}\n\nfunction diffTextAreaValue(prevTextAreaValue: string, textAreaValue: string) {\n  const prevValueCaretPosition =\n    prevTextAreaValue.length - CHARACTERS_LENGTH_AFTER_USER_INPUT;\n  const currentValueCaretPosition =\n    textAreaValue.length - CHARACTERS_LENGTH_AFTER_USER_INPUT;\n  const minValueCaretPosition = Math.min(\n    prevValueCaretPosition,\n    currentValueCaretPosition,\n  );\n\n  let leftDiffOffset = 0;\n  while (leftDiffOffset < minValueCaretPosition) {\n    if (prevTextAreaValue[leftDiffOffset] !== textAreaValue[leftDiffOffset]) {\n      break;\n    }\n    leftDiffOffset += 1;\n  }\n\n  return {\n    range: [leftDiffOffset, prevValueCaretPosition],\n    text: textAreaValue.slice(leftDiffOffset, currentValueCaretPosition),\n  };\n}\n\nfunction insertText(controller: Controller, rawData: string) {\n  // Safari 空格会发出 CharCode 为 160 的空格，这里抹平浏览器差异\n  // convert <CharCode 160: &nbsp;> to <CharCode 32: space>\n  const data = rawData.replace(/\\xA0/g, ' ');\n  const cangjieInput = CangjieInputEvent({ type: 'insertText', data });\n  controller.run('onCangjieInput', cangjieInput);\n}\n\nfunction removeText(controller: Controller, data: string) {\n  controller.run(\n    'onCangjieInput',\n    CangjieInputEvent({\n      type: 'deleteContentBackward',\n      data,\n    }),\n  );\n}\n\nfunction updateComposing(controller: Controller, composing: string) {\n  controller.run('onCangjieComposingChange', composing);\n}\n\nexport default function useInputDetector(\n  controller: Controller,\n  textAreaRef: React.MutableRefObject<HTMLTextAreaElement | null>,\n) {\n  const { selection, isBlurred } = controller.value;\n  const isComposing = React.useRef(false);\n\n  const prevSelectionAfterInput = React.useRef<Selection | null>(null);\n  const resetTimer = React.useRef<any>(null);\n  const composingData = React.useRef('');\n  const prevTextAreaValue = React.useRef(EMPTY_TEXT_AREA_VALUE);\n  const reset = React.useCallback(() => {\n    resetTextAreaValue(textAreaRef, prevTextAreaValue);\n  }, [textAreaRef]);\n\n  React.useEffect(() => {\n    // 仅当选区的位置变化才需要 reset textarea 结束 composing 状态，不应受其它因素影响\n    // eg. 分页模式下用输入法输入，首字母输入后仅 selection.data.isHanging 会变为 true（https://code.aone.alibaba-inc.com/alidocs/we-word/codereview/7664706）\n    //     这种情况下只影响选区渲染的位置，不应该打断输入\n    if (prevSelectionAfterInput.current?.plainViewKey === selection.plainViewKey) {\n      return;\n    }\n    // 分页模式下，会将 dataSelection 转为 viewSelection，并将原始 selection 放到 data 中\n    // 因此可以通过 dataSelection 来判断是否为同一个位置，避免因排版将 composing 部分放到下一行导致选区变化，从而中断输入法\n    // eg.\n    //    Line 1: xxxxxxxxxxx<cursor/>[n]    <-- before：输入法输入时，光标和 composing 部分在行尾\n    //    Line 2: <cursor/>[ni]xxxxxxxxxxx   <-- after：输入法输入时，光标和 composing 部分被放到下一行首\n    //    此时，不应执行 reset\n    const dataSelection = selection.data.dataSelection;\n    const prevDataSelection = prevSelectionAfterInput.current?.data.dataSelection;\n    if (\n      isComposing &&\n      dataSelection &&\n      prevDataSelection &&\n      prevDataSelection.plainViewKey === dataSelection.plainViewKey\n    ) {\n      return;\n    }\n    // BACKGROUND:\n    // iOS 下，reset() 中设置 selectionStart/selectionEnd 的行为会造成 textarea 自动 focus\n    // 导致编辑器的 autoFocus 配置失效\n    // 因此需要人为控制 blur 状态下不执行 reset\n    if (isBlurred) {\n      return;\n    }\n    reset();\n  }, [reset, selection, isBlurred]);\n\n  React.useEffect(() => {\n    return () => {\n      resetTimer.current && clearTimeout(resetTimer.current);\n    };\n  }, []);\n\n  return React.useMemo(\n    () => ({\n      reset,\n      onChange(event: React.ChangeEvent<HTMLTextAreaElement>) {\n        let { value } = event.target;\n        // Safari 空格会发出 CharCode 为 160 的空格，这里抹平浏览器差异\n        // 避免 diffTextAreaValue 时 offset 算错\n        value = value.replace(/\\xA0/g, ' ')\n        const { range, text } = diffTextAreaValue(\n          prevTextAreaValue.current,\n          value,\n        );\n\n        const [rangeStartIndex, rangeEndIndex] = range;\n        let mismatchLength = rangeEndIndex - rangeStartIndex;\n        const composing = composingData.current;\n        // console.info(`onchange, value=[${value}], range=${range}, text=[${text}], composing=[${composing}]`);\n        if (mismatchLength > 0 && composing.length > 0) {\n          const delLength = Math.min(mismatchLength, composing.length);\n          composingData.current = composing.slice(\n            0,\n            composing.length - delLength,\n          );\n          mismatchLength -= delLength;\n          updateComposing(controller, composingData.current);\n        }\n        if (mismatchLength > 0) {\n          const data = prevTextAreaValue.current.slice(\n            rangeStartIndex,\n            rangeStartIndex + mismatchLength,\n          );\n          removeText(controller, data);\n        }\n\n        let newText = text;\n        if (isComposing.current && newText) {\n          composingData.current += newText;\n          updateComposing(controller, composingData.current);\n          newText = '';\n        }\n\n        if (newText) {\n          insertText(controller, newText);\n        }\n        if (value.length < EMPTY_TEXT_AREA_VALUE.length) {\n          mismatchLength <= 0 && removeText(controller, ' ');\n          composingData.current = '';\n          resetTimer.current = setTimeout(reset, 0);\n        }\n        prevTextAreaValue.current = value;\n\n        prevSelectionAfterInput.current = controller.value.selection;\n      },\n      onCompositionStart() {\n        isComposing.current = true;\n        prevSelectionAfterInput.current = controller.value.selection;\n      },\n      onCompositionEnd() {\n        isComposing.current = false;\n        if (composingData.current) {\n          insertText(controller, composingData.current);\n          updateComposing(controller, '');\n          composingData.current = '';\n        }\n        prevSelectionAfterInput.current = controller.value.selection;\n      },\n      // 返回值意义: shouldContinue other keydown handlers\n      onKeyDown(event: React.KeyboardEvent) {\n        if (IS_TOUCH_MOBILE && (hotkeys.isCopy(event) || hotkeys.isCut(event))) {\n          // Background: iOS + Safari + 外接键盘的情况下，用中文输入法输入 cmd + C 等快捷键，会出现\n          //             keydown 后触发 compositionStart -> onChange 的情况\n          // Hack: https://stackoverflow.com/questions/63204395/how-can-i-reliably-cancel-a-compositionstart-event\n          // Ref: https://alidocs.dingtalk.com/i/nodes/2m0X9MnDA3QJwww90al4JqklwBK7RezY\n          if (IS_IPAD) {\n            controller.run('onCangjieBlur');\n            setTimeout(() => controller.run('onCangjieFocus'), 100);\n          }\n          return true;\n        }\n        if (IS_SAFARI) {\n          // BACKGROUND: Safari 下输入法输入 abc，然后逐个删除，到最后会把 abc 之前的文字删掉\n          // 正常情况下，事件触发顺序为 onKeydown -> onChange -> onCompositionEnd；\n          // 而 Safari 下是 onChange -> onCompositionEnd -> onKeydown，标志位就失去了参考价值\n          // http://gwiki.cn/2019/02/js%E7%9A%84%E7%BC%96%E8%BE%91%E4%BA%8B%E4%BB%B6\n          // https://developer.mozilla.org/en-US/docs/Web/Events/keydown\n          // 利用 event 事件信息，使输入法处理过程中，忽略 onKeydown\n          // @ts-ignore\n          if (event.isComposing || event.keyCode === 229) {\n            return false;\n          }\n        }\n        return (\n          !isComposing.current ||\n          (!hotkeys.isCompose(event) &&\n            !hotkeys.isUndo(event) &&\n            !hotkeys.isRedo(event))\n        );\n      },\n    }),\n    [controller, textAreaRef],\n  );\n}\n","/* eslint-disable react/no-find-dom-node */\n/**\n * @packageDocumentation\n * @ignore\n */\nimport * as React from 'react';\nimport equal from 'fast-deep-equal';\nimport { curry, omit } from 'lodash-es';\nimport Controller from '../controller/index';\nimport Selection, { SelectionTrigger, SupportEdge } from '../models/selection';\nimport { TextPoint, EdgePoint } from '../models/point';\nimport CangjieSelectEvent from '../events/cangjieSelect';\nimport caretRangeFromTargetAndCoord from '../utils/dom/caretRangeFromTargetAndCoord';\nimport findDOMRange from '../utils/dom/findDOMRange';\nimport findDOMNode from '../utils/dom/findDOMNode';\nimport hotKeys from '../utils/hotkeys';\nimport { CURSOR_WIDTH } from '../constants';\nimport scrollToVisible from '../utils/dom/scrollToVisible';\nimport isPointAtEdge, {\n  findRectsInEdgePoint,\n} from '../utils/dom/isPointAtEdge';\nimport {\n  isCoordAtLeftSide,\n} from '../utils/dom/caretHanging';\nimport {\n  movePointForward,\n  movePointBackward,\n  movePointWordBackward,\n  movePointWordForward,\n} from '../utils/selection';\nimport {\n  getUpsidePoint,\n  getUpsideRange,\n  getDownsidePoint,\n  getDownsideRange,\n  pointAtDistance,\n} from '../queries/selection';\nimport { CHARACTERS_LENGTH_AFTER_USER_INPUT } from './useInputDetector';\nimport { IS_IOS, IS_MAC, IS_MOBILE, IS_SAFARI } from '../utils/environment';\nimport shoudStopInsideVoid from '../utils/shouldStopInsideVoid';\nimport { startScroll, stopScroll } from '../utils/dom/outsideScroller';\nimport { PerfType } from '../interfaces/perf';\nimport Data from '../interfaces/data';\n\nconst MULTIPLE_CLICK_DELAY = 500;\nconst TAP_HOLD_DELAY = 600;\n// 方向键需要快速响应，目前暂未发现明显问题\nconst CARET_MOVE_GAP_TIME = 0;\nconst MULTIPLE_CLICK_RANGE = 10;\n\nfunction getWordSelection(\n  controller: Controller,\n  target: HTMLElement,\n  x: number,\n  y: number,\n) {\n  const r = caretRangeFromTargetAndCoord(target, x, y, controller);\n  if (!r) {\n    return null;\n  }\n  const { document } = controller.value;\n  return Selection.selectWordAtPoint(document, r.anchor);\n}\n\n// get a new selection at Line Start or Line End of the current selection.\nfunction getSelectionAtLine(\n  where: SupportEdge,\n  controller: Controller,\n  selection: Selection | null,\n) {\n  const { value } = controller;\n  const { document } = value;\n  if (!selection) {\n    return null;\n  }\n  const isStart = where === 'start';\n  const { focus, isHanging } = selection;\n  if (focus.isEdgePoint()) {\n    const edge = isStart ? EdgePoint.BEFORE : EdgePoint.AFTER;\n    const anchor = EdgePoint.create({ key: focus.key, edge });\n    return Selection.create({ anchor, focus: anchor });\n  }\n  let range: Range | null = null; // selection's range\n  let blockDomNode: Element | null = null; // selection's closest block node\n  try {\n    const block = document.getClosestBlock(focus.key);\n    range = findDOMRange(selection, controller);\n    if (block) {\n      blockDomNode = findDOMNode(block.key);\n    }\n  } catch (_) {\n    return null;\n  }\n  if (!range || !blockDomNode) {\n    return null;\n  }\n\n  // selection's rect\n  const rects = range.getClientRects();\n  if (!rects.length) {\n    return null;\n  }\n  let rect = rects[isHanging ? rects.length - 1 : 0];\n  const edgeRects = isPointAtEdge(focus) ? findRectsInEdgePoint(focus) : [];\n  if (edgeRects && edgeRects.length) {\n    rect = edgeRects[isHanging ? edgeRects.length - 1 : 0];\n  }\n  // selection's closest block's rect\n  scrollToVisible(blockDomNode as HTMLElement, where, CURSOR_WIDTH);\n  const blockRect = blockDomNode.getBoundingClientRect();\n\n  // target selection's position\n  const position = {\n    x: where === 'start' ? blockRect.left + 1 : blockRect.right - 1,\n    y: rect.top + rect.height / 2,\n  };\n\n  const newRange = caretRangeFromTargetAndCoord(\n    blockDomNode,\n    position.x,\n    position.y,\n    controller,\n  );\n\n  if (!newRange) {\n    return null;\n  }\n\n  let { anchor: point } = newRange;\n\n  // if the target point is inside a void element, take the next point\n  const parent = document.getParent(point.key);\n  if (parent && controller.query('isVoid', parent)) {\n    point = controller.query(pointAtDistance, point, isStart ? -1 : 1);\n  }\n  const newSelection = Selection.create({\n    anchor: point,\n    focus: point,\n  });\n  return newSelection;\n}\n\nfunction shouldSelectOnRightClick(targetPoint: TextPoint | EdgePoint, controller: Controller) {\n  const { selection, document } = controller.value;\n\n  if (!selection || selection.isCollapsed) {\n    return true;\n  }\n\n  const { start, end } = selection.sort(document);\n  const rangeStart = Selection.create({\n    anchor: targetPoint,\n    focus: start,\n  });\n  const rangeEnd = Selection.create({\n    anchor: end,\n    focus: targetPoint,\n  });\n  const isBeforeStart = rangeStart.isExpanded && rangeStart.isForward(document);\n  const isAfterEnd = rangeEnd.isExpanded && rangeEnd.isForward(document);\n  return isBeforeStart || isAfterEnd;\n}\n\nexport default function useSelectionCalculator(\n  controller: Controller,\n  textAreaRef: React.MutableRefObject<HTMLTextAreaElement | null>,\n  scrollableContainerRef: React.MutableRefObject<HTMLDivElement | null>,\n) {\n  const isJustTapHold = React.useRef(false);\n\n  const tapHoldTimer = React.useRef<number | null>(null);\n\n  const outsideScoller = React.useRef<ReturnType<typeof startScroll> | null>(null);\n\n  const lastSingleClick = React.useRef<{ time: number; x: number; y: number }>({\n    time: 0,\n    x: 0,\n    y: 0,\n  });\n  const lastDoubleClick = React.useRef<{ time: number; x: number; y: number }>({\n    time: 0,\n    x: 0,\n    y: 0,\n  });\n\n  const lastCaretMoveTime = React.useRef(0);\n  const prevSelectionRef = React.useRef<Selection | null>(null);\n\n  const onCangjieSelect = React.useCallback(\n    (selection: Selection, trigger?: SelectionTrigger) => {\n      const { composing, isFocused } = controller.value;\n      if (composing && selection.isExpanded) {\n        return;\n      }\n      if (!isFocused) {\n        controller.run('onCangjieFocus');\n      }\n\n      const newSelection = selection.marks === null ? selection : selection.set('marks', null);\n      const subtypeTriggerMap = {\n        selectStart: 'focusText',\n        selecting: 'selectText',\n        selectAll: 'selectAll',\n      };\n      if (!trigger || !subtypeTriggerMap[trigger] || equal(prevSelectionRef.current, newSelection)) {\n        // 需要 delay 丢弃的 perf 事件\n        controller.perfDrop(PerfType.selection);\n      }\n      prevSelectionRef.current = newSelection;\n      return controller.run(\n        'onCangjieSelect',\n        CangjieSelectEvent({\n          selection: newSelection,\n          trigger: trigger || 'userSelect',\n        }),\n      );\n    },\n    [controller],\n  );\n\n  const moveUpward = () => {\n    const now = Date.now();\n    const isGapTimeTooShort =\n      now - lastCaretMoveTime.current < CARET_MOVE_GAP_TIME;\n    if (isGapTimeTooShort) {\n      return;\n    }\n    lastCaretMoveTime.current = now;\n\n    const newRange = controller.query(getUpsideRange);\n\n    if (!newRange) {\n      return;\n    }\n    onCangjieSelect(\n      newRange,\n      SelectionTrigger.MoveUpward,\n    );\n  };\n\n  const moveDownward = () => {\n    const now = Date.now();\n    const isGapTimeTooShort =\n      now - lastCaretMoveTime.current < CARET_MOVE_GAP_TIME;\n    if (isGapTimeTooShort) {\n      return;\n    }\n    lastCaretMoveTime.current = now;\n    const newRange = controller.query(getDownsideRange);\n\n    if (!newRange) {\n      return;\n    }\n    onCangjieSelect(\n      newRange,\n      SelectionTrigger.MoveDownward,\n    );\n  };\n\n  const moveBackward = () => {\n    const { document, selection } = controller.value;\n    if (selection.isExpanded) {\n      const isAtEdge = isPointAtEdge(selection.getStart(document));\n      onCangjieSelect(\n        selection.moveToStart(document).setHanging(isAtEdge),\n      );\n      return;\n    }\n\n    const isProceeded = shoudStopInsideVoid(controller, 'moveBackward');\n    if (isProceeded) {\n      return;\n    }\n\n    const isAtEdge = isPointAtEdge(selection.anchor);\n    if (isAtEdge && selection.isHanging) {\n      onCangjieSelect(selection.setHanging(false));\n      return;\n    }\n\n    const now = Date.now();\n    const isGapTimeTooShort =\n      now - lastCaretMoveTime.current < CARET_MOVE_GAP_TIME;\n    if (isGapTimeTooShort) {\n      return;\n    }\n    const newSelection = selection\n      .moveAnchorBackward(\n        1,\n        movePointBackward(\n          controller,\n          curry.placeholder,\n          curry.placeholder,\n          'offset',\n        ),\n      )\n      .moveToAnchor();\n    const isNextPointAtEdge = isPointAtEdge(newSelection.anchor);\n    lastCaretMoveTime.current = now;\n    onCangjieSelect(\n      newSelection.setHanging(isNextPointAtEdge),\n      SelectionTrigger.MoveBackward,\n    );\n  };\n\n  const moveForward = () => {\n    const { document, selection } = controller.value;\n    if (selection.isExpanded) {\n      onCangjieSelect(selection.moveToEnd(document));\n      return;\n    }\n    const isProceeded = shoudStopInsideVoid(controller, SelectionTrigger.MoveForward);\n    if (isProceeded) {\n      return;\n    }\n    const isAtEdge = isPointAtEdge(selection.anchor);\n    if (isAtEdge && !selection.isHanging) {\n      onCangjieSelect(selection.setHanging(true));\n      return;\n    }\n\n    const now = Date.now();\n    const isGapTimeTooShort =\n      now - lastCaretMoveTime.current < CARET_MOVE_GAP_TIME;\n    if (isGapTimeTooShort) {\n      return;\n    }\n    lastCaretMoveTime.current = now;\n    onCangjieSelect(\n      selection\n        .moveAnchorForward(\n          1,\n          movePointForward(\n            controller,\n            curry.placeholder,\n            curry.placeholder,\n            'offset',\n          ),\n        )\n        .moveToAnchor(),\n      SelectionTrigger.MoveForward,\n    );\n  };\n\n  const handleNativeSelectionChange = () => {\n    if (!textAreaRef.current || document.activeElement !== textAreaRef.current) {\n      return;\n    }\n\n    // iOS - Voice Input will try to select all words when finished\n    // ref: https://aone.alibaba-inc.com/v2/project/585561/bug/32431619\n    if (textAreaRef.current.selectionStart !== textAreaRef.current.selectionEnd) {\n      return;\n    }\n    // Detect users move selection by external keyboard arrow keys under iOS@<13\n    // Ref: https://bugs.webkit.org/show_bug.cgi?id=149054\n    const defaultCaretPosition = textAreaRef.current.value.length - CHARACTERS_LENGTH_AFTER_USER_INPUT;\n    const newCaretPosition = textAreaRef.current.selectionStart;\n\n    if (IS_IOS) {\n      // Mobile 3rd IME will delete to beginning when choosing english suggestion\n      // In this case both `newCaretPosition` and `defaultCaretPosition` is 0\n      // We handle this case by adding `defaultCaretPosition !== 0`\n      if (newCaretPosition === 0 && defaultCaretPosition !== 0) {\n        moveUpward();\n      } else if (newCaretPosition === textAreaRef.current.value.length) {\n        moveDownward();\n      } else if (newCaretPosition - defaultCaretPosition < 0) {\n        moveBackward();\n      } else if (newCaretPosition - defaultCaretPosition > 0) {\n        moveForward();\n      }\n    }\n\n    // Reset selection to end of textarea while users change it.\n    // e.g. Users move selection by 3D touch.\n    // Note: selectionStart is offset of characters and works fine with emoji.\n    if (textAreaRef.current.selectionStart !== defaultCaretPosition) {\n      textAreaRef.current.selectionStart = defaultCaretPosition;\n    }\n    if (textAreaRef.current.selectionEnd !== defaultCaretPosition) {\n      textAreaRef.current.selectionEnd = defaultCaretPosition;\n    }\n  };\n  React.useEffect(() => {\n    if (IS_MOBILE) {\n      document.addEventListener('selectionchange', handleNativeSelectionChange);\n      return () => {\n        document.removeEventListener('selectionchange', handleNativeSelectionChange);\n      };\n    }\n    return undefined;\n  }, [controller]);\n\n  React.useEffect(() => {\n    return () => {\n      if (outsideScoller.current) {\n        outsideScoller.current.cancel();\n        outsideScoller.current = null;\n      }\n    };\n  }, [controller]);\n\n  return React.useMemo(\n    () => ({\n      onKeyDown(event: React.KeyboardEvent | KeyboardEvent) {\n        const { value, readOnly } = controller;\n        const { document, selection } = value;\n        if (!selection) {\n          return;\n        }\n\n        const now = Date.now();\n        const isGapTimeTooShort =\n          now - lastCaretMoveTime.current < CARET_MOVE_GAP_TIME;\n\n        if (hotKeys.isSelectAll(event)) {\n          controller.perfStart({ type: PerfType.selection, subtype: 'selectAll' });\n          event.preventDefault();\n          onCangjieSelect(selection.moveToRangeOfNode(document, controller), SelectionTrigger.SelectAll);\n          return;\n        }\n        if (hotKeys.isMoveBackward(event)) {\n          event.preventDefault();\n          moveBackward();\n          return;\n        }\n        if (hotKeys.isMoveForward(event)) {\n          event.preventDefault();\n          moveForward();\n          return;\n        }\n        if (hotKeys.isMoveUpward(event)) {\n          if (readOnly && selection.isCollapsed) {\n            return;\n          }\n          event.preventDefault();\n          moveUpward();\n          return;\n        }\n        if (hotKeys.isMoveDownward(event)) {\n          if (readOnly && selection.isCollapsed) {\n            return;\n          }\n          event.preventDefault();\n          moveDownward();\n          return;\n        }\n        if (hotKeys.isMoveWordBackward(event)) {\n          event.preventDefault();\n          if (isGapTimeTooShort) {\n            return;\n          }\n          lastCaretMoveTime.current = now;\n          onCangjieSelect(\n            selection\n              .move(movePointWordBackward(controller, 'focus'))\n              .moveToFocus(),\n          );\n          return;\n        }\n        if (hotKeys.isMoveWordForward(event)) {\n          event.preventDefault();\n          if (isGapTimeTooShort) {\n            return;\n          }\n          lastCaretMoveTime.current = now;\n          onCangjieSelect(\n            selection\n              .move(movePointWordForward(controller, 'focus'))\n              .moveToFocus(),\n          );\n          return;\n        }\n        if (hotKeys.isMoveLineBackward(event)) {\n          event.preventDefault();\n          const range = getSelectionAtLine('start', controller, selection);\n          if (range) {\n            const isAtEdge = isPointAtEdge(range.anchor);\n            onCangjieSelect(range.setHanging(isAtEdge));\n          }\n          return;\n        }\n        if (hotKeys.isMoveLineForward(event)) {\n          event.preventDefault();\n          const range = getSelectionAtLine('end', controller, selection);\n          if (range) {\n            onCangjieSelect(range);\n          }\n          return;\n        }\n        if (hotKeys.isMoveToDocumentStart(event)) {\n          event.preventDefault();\n          onCangjieSelect(selection.moveToStartOfDocument(controller));\n          return;\n        }\n        if (hotKeys.isMoveToDocumentEnd(event)) {\n          event.preventDefault();\n          onCangjieSelect(selection.moveToEndOfDocument(controller));\n          return;\n        }\n        if (hotKeys.isExtendBackward(event)) {\n          event.preventDefault();\n          if (isGapTimeTooShort) {\n            return;\n          }\n          lastCaretMoveTime.current = now;\n          onCangjieSelect(\n            selection.moveFocusBackward(\n              1,\n              movePointBackward(\n                controller,\n                curry.placeholder,\n                curry.placeholder,\n                'offset',\n              ),\n            ),\n          );\n          return;\n        }\n        if (hotKeys.isExtendForward(event)) {\n          event.preventDefault();\n          if (isGapTimeTooShort) {\n            return;\n          }\n          lastCaretMoveTime.current = now;\n          onCangjieSelect(\n            selection.moveFocusForward(\n              1,\n              movePointForward(\n                controller,\n                curry.placeholder,\n                curry.placeholder,\n                'offset',\n              ),\n            ),\n          );\n          return;\n        }\n        if (hotKeys.isExtendUpward(event)) {\n          event.preventDefault();\n          if (isGapTimeTooShort || !selection) {\n            return;\n          }\n          lastCaretMoveTime.current = now;\n          const point = getUpsidePoint(\n            controller,\n            selection.focus,\n            selection.isHanging,\n          );\n          const { focus, anchor } = selection;\n          onCangjieSelect(\n            Selection.create({\n              anchor,\n              focus: point || focus.moveToStartOfNode(document),\n            }),\n          );\n          return;\n        }\n        if (hotKeys.isExtendDownward(event)) {\n          event.preventDefault();\n          if (isGapTimeTooShort || !selection) {\n            return;\n          }\n          lastCaretMoveTime.current = now;\n          const { focus, anchor, isHanging } = selection;\n          const point = getDownsidePoint(controller, focus, isHanging);\n          onCangjieSelect(\n            Selection.create({\n              anchor,\n              focus: point || focus.moveToEndOfNode(document),\n            }),\n          );\n          return;\n        }\n        if (hotKeys.isExtendWordBackward(event)) {\n          event.preventDefault();\n          if (isGapTimeTooShort) {\n            return;\n          }\n          lastCaretMoveTime.current = now;\n          onCangjieSelect(\n            selection.move(movePointWordBackward(controller, 'focus')),\n          );\n          return;\n        }\n        if (hotKeys.isExtendWordForward(event)) {\n          event.preventDefault();\n          if (isGapTimeTooShort) {\n            return;\n          }\n          lastCaretMoveTime.current = now;\n          onCangjieSelect(\n            selection.move(movePointWordForward(controller, 'focus')),\n          );\n          return;\n        }\n        if (hotKeys.isExtendLineBackward(event)) {\n          event.preventDefault();\n          const range = getSelectionAtLine('start', controller, selection);\n          if (range) {\n            onCangjieSelect(\n              Selection.create({\n                anchor: selection.anchor,\n                focus: range.focus,\n              }),\n            );\n          }\n          return;\n        }\n        if (hotKeys.isExtendToDocumentStart(event)) {\n          event.preventDefault();\n          onCangjieSelect(selection.moveFocusToStartOfNode(document, controller));\n          return;\n        }\n        if (hotKeys.isExtendToDocumentEnd(event)) {\n          event.preventDefault();\n          onCangjieSelect(selection.moveFocusToEndOfNode(document, controller));\n          return;\n        }\n        if (hotKeys.isExtendLineForward(event)) {\n          event.preventDefault();\n          const range = getSelectionAtLine('end', controller, selection);\n          if (range) {\n            onCangjieSelect(\n              Selection.create({\n                anchor: selection.anchor,\n                focus: range.focus,\n              }),\n            );\n          }\n        }\n      },\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      onKeyUp(event: React.KeyboardEvent | KeyboardEvent) {\n        lastCaretMoveTime.current = 0;\n      },\n      onMultipleClick(event: React.MouseEvent<Element>) {\n        const now = Date.now();\n        if (event.button === 2) {\n          return;\n        }\n        if (\n          now - lastDoubleClick.current.time < MULTIPLE_CLICK_DELAY &&\n          Math.abs(event.clientY - lastDoubleClick.current.y) <\n            MULTIPLE_CLICK_RANGE &&\n          Math.abs(event.clientX - lastDoubleClick.current.x) <\n            MULTIPLE_CLICK_RANGE\n        ) {\n          lastDoubleClick.current = { time: 0, x: 0, y: 0 };\n          lastSingleClick.current = { time: 0, x: 0, y: 0 };\n          const range = caretRangeFromTargetAndCoord(\n            event.target,\n            event.clientX,\n            event.clientY,\n            controller,\n          );\n          if (!range) {\n            return;\n          }\n          const { value } = controller;\n          const { document, selection } = value;\n          const anchorBlock = document.getClosestBlock(range.anchor.key);\n          if (selection && anchorBlock) {\n            onCangjieSelect(\n              selection!.moveToRangeOfNode(anchorBlock, controller),\n              SelectionTrigger.MultipleClick,\n            );\n          }\n          return;\n        }\n\n        if (controller.query('isQuickPreview')) {\n          return;\n        }\n\n        if (\n          now - lastSingleClick.current.time > MULTIPLE_CLICK_DELAY ||\n          Math.abs(event.clientY - lastSingleClick.current.y) >\n            MULTIPLE_CLICK_RANGE ||\n          Math.abs(event.clientX - lastSingleClick.current.x) >\n            MULTIPLE_CLICK_RANGE\n        ) {\n          lastSingleClick.current = {\n            time: now,\n            x: event.clientX,\n            y: event.clientY,\n          };\n          lastDoubleClick.current = {\n            time: 0,\n            x: event.clientX,\n            y: event.clientY,\n          };\n          return;\n        }\n\n        lastSingleClick.current = { time: 0, x: 0, y: 0 };\n        lastDoubleClick.current = {\n          time: now,\n          x: event.clientX,\n          y: event.clientY,\n        };\n        const range = getWordSelection(\n          controller,\n          event.target as HTMLElement,\n          event.clientX,\n          event.clientY,\n        );\n        if (range) {\n          onCangjieSelect(\n            range,\n            SelectionTrigger.MultipleClick,\n          );\n        }\n      },\n      onSelectStart(event: React.MouseEvent) {\n        let isSelecting = false;\n        function onSelectUpdate(e: MouseEvent) {\n          controller.perfStart({ type: PerfType.selection, subtype: 'selectText' });\n          if (!scrollableContainerRef.current) {\n            controller.perfDrop(PerfType.selection);\n            return;\n          }\n\n          outsideScoller.current && outsideScoller.current(e);\n          const { target } = e;\n          const x = e.clientX;\n          const y = e.clientY;\n          if (!target) {\n            controller.perfDrop(PerfType.selection);\n            return;\n          }\n          const range = caretRangeFromTargetAndCoord(target, x, y, controller);\n          if (!range) {\n            controller.perfDrop(PerfType.selection);\n            return;\n          }\n\n          const { selection } = controller.value;\n          if (!selection || equal(range, selection)) {\n            controller.perfDrop(PerfType.selection);\n            return;\n          }\n          isSelecting = true;\n          onCangjieSelect(selection.set('focus', range.focus), SelectionTrigger.Selecting);\n        }\n\n        function onSelectEnd() {\n          if (outsideScoller.current) {\n            outsideScoller.current.cancel();\n            outsideScoller.current = null;\n          }\n          stopScroll(controller);\n          if (isSelecting) {\n            const { selection } = controller.value;\n            onCangjieSelect(\n              selection.set('data', omit(selection.data, 'trigger')),\n            );\n          }\n          window.document.removeEventListener('mousemove', onSelectUpdate);\n          window.document.removeEventListener('mouseup', onSelectEnd);\n          window.document.removeEventListener('mouseleave', onSelectEnd);\n        }\n\n        controller.perfStart({ type: PerfType.selection, subtype: 'focusText' });\n\n        if (isJustTapHold.current) {\n          controller.perfDrop(PerfType.selection);\n          isJustTapHold.current = false;\n          return;\n        }\n\n        const rawRange = caretRangeFromTargetAndCoord(\n          event.target,\n          event.clientX,\n          event.clientY,\n          controller,\n        );\n\n        const isClickAtLeftSide = isCoordAtLeftSide(event.clientX, controller);\n\n        if (!rawRange) {\n          controller.perfDrop(PerfType.selection);\n          return;\n        }\n\n        const range = rawRange.setHanging(\n          isClickAtLeftSide && isPointAtEdge(rawRange.anchor),\n        );\n\n        // HACK: Safari + third-party IME + MacOS checked TapToHold option\n        // sometimes mouseup event triggers before mousedown in a click progress\n        // Ref: https://github.com/facebook/react/issues/20787\n        if (IS_MAC && IS_SAFARI && event.buttons === 0) { // in this backgound, event.buttons is 0\n          const { selection } = controller.value;\n          if (event.shiftKey) {\n            onCangjieSelect(selection.set('focus', range.focus), SelectionTrigger.SelectStart);\n          } else {\n            onCangjieSelect(range, SelectionTrigger.SelectStart);\n          }\n          return;\n        }\n\n        // Right button clicked.\n        // Ref: https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/button\n        if (event.button === 2) {\n          const shouldSelect = shouldSelectOnRightClick(range.focus, controller);\n          if (shouldSelect) {\n            onCangjieSelect(range);\n            return;\n          }\n          controller.perfDrop(PerfType.selection);\n          if (!controller.value.isFocused) {\n            controller.run('onCangjieFocus');\n          }\n          return;\n        }\n\n        if (scrollableContainerRef.current) {\n          outsideScoller.current = startScroll({\n            scroller: scrollableContainerRef.current,\n            controller,\n          });\n        }\n\n        window.document.addEventListener('mousemove', onSelectUpdate);\n        window.document.addEventListener('mouseup', onSelectEnd);\n        window.document.addEventListener('mouseleave', onSelectEnd);\n\n        const { selection } = controller.value;\n        if (event.shiftKey) {\n          onCangjieSelect(selection.set('focus', range.focus), SelectionTrigger.SelectStart);\n        } else {\n          onCangjieSelect(range, SelectionTrigger.SelectStart);\n        }\n      },\n      onTapHoldStart(event: React.TouchEvent) {\n        if (tapHoldTimer.current) {\n          clearTimeout(tapHoldTimer.current);\n        }\n\n        const { target, clientX, clientY } = event.touches[0];\n        tapHoldTimer.current = window.setTimeout(() => {\n          isJustTapHold.current = true;\n          const range = getWordSelection(\n            controller,\n            target as HTMLElement,\n            clientX,\n            clientY,\n          );\n          if (range) {\n            onCangjieSelect(range);\n          }\n        }, TAP_HOLD_DELAY);\n      },\n      onTapHoldEnd() {\n        if (tapHoldTimer.current) {\n          clearTimeout(tapHoldTimer.current);\n          tapHoldTimer.current = null;\n        }\n      },\n    }),\n    [controller, scrollableContainerRef, onCangjieSelect],\n  );\n}\n","/**\n * @packageDocumentation\n * @module Events\n * @description Prevent clipboard data from being destroyed when asynchronous retrieval of data\n */\ninterface PasteInputDetail {\n  clipboardData?: DataTransfer\n}\n\ntype PasteInputEvent = CustomEvent<PasteInputDetail>;\n\nfunction PasteInputEvent(detail: PasteInputDetail) {\n  return new CustomEvent('pasteInput', { detail });\n}\n\nexport default PasteInputEvent;\n","// eslint-disable-next-line import/no-extraneous-dependencies\n/**\n * @packageDocumentation\n * @ignore\n */\nimport * as React from 'react';\nimport ReactDOM from 'react-dom';\nimport useController from '../controller/useController';\nimport { TextPoint, EdgePoint } from '../models/point';\nimport Selection from '../models/selection';\nimport { useZoom, useZoomContainer } from '../hooks/useZoom';\nimport { IS_IOS, IS_IPAD, IS_MOBILE } from '../utils/environment';\nimport { findCaretPosition } from '../utils/dom/findCaretPosition';\nimport { pointAtDistance } from '../queries/selection';\nimport { Selector } from '../constants';\n\nconst SHOULD_FOLLOW_CARET = !IS_IOS || IS_IPAD;\n\nconst textAreaProps = IS_MOBILE ? {} : { spellCheck: false };\n\nconst commonStyle: React.CSSProperties = {\n  position: 'fixed',\n  overflow: 'hidden',\n  width: 1,\n  height: 1,\n  lineHeight: 1,\n  whiteSpace: 'pre-wrap',\n  zIndex: -1,\n  opacity: 0,\n  background: 'transparent',\n  color: 'transparent',\n  outline: 'none',\n  caretColor: 'transparent',\n  willChange: 'left,top',\n};\n\n//@ts-ignore\nif (process.env.NODE_ENV !== 'uitest') {\n  // https://developer.mozilla.org/en-US/docs/Web/CSS/contain\n  commonStyle.contain = 'strict';\n}\n\nconst wrapperStyle: React.CSSProperties = SHOULD_FOLLOW_CARET ? commonStyle : {\n  ...commonStyle,\n  top: 0,\n  left: -99,\n  // 修复iOS we-web下输入文字时滚动问题\n  // height: 'auto',\n};\n\nconst textAreaStyle: React.CSSProperties = {\n  fontSize: 'inherit',\n  lineHeight: 1,\n  padding: 0,\n  border: 'none',\n\n  // [IMPORTANT]\n  // 1. iOS@<13 need to preserve `\\n` to detect `moveUpward` & `moveDownward`,\n  //    see: cangjie/src/hooks/useSelectionCalculator.ts\n  // 2. Desktop need `nowrap` to prevent that IME positioning incorrectly\n  whiteSpace: IS_IOS ? 'pre-wrap' : 'nowrap',\n\n  // [IMPORTANT]\n  // 1. Textarea will enlarge ancestors' rectangle when width is `auto`.\n  // 2. `useInputDetector` will treat inputting as deleting if width is smaller than `1em`.\n  width: '1em',\n};\n\nfunction usePointPosition(\n  textareaWrapperRef: React.RefObject<HTMLDivElement>,\n  point: EdgePoint | TextPoint | undefined,\n  zoom: number,\n) {\n  const controller = useController();\n  const container = useZoomContainer();\n  React.useEffect(() => {\n    if (!SHOULD_FOLLOW_CARET || !point) {\n      return;\n    }\n    const textareaWrapper = textareaWrapperRef.current;\n    if (!textareaWrapper) {\n      return;\n    }\n    if (!container) {\n      return;\n    }\n    const { isHanging } = controller.value.selection;\n    const preferredEdge = isHanging ? 'start' : 'end';\n    const rect = findCaretPosition(point, preferredEdge, container);\n    if (!rect) {\n      return;\n    }\n    const { clientLeft, clientTop } = rect;\n    textareaWrapper.style.top = `${clientTop}px`;\n    textareaWrapper.style.left = `${clientLeft}px`;\n    textareaWrapper.style.fontSize = `${rect.height / zoom}px`;\n  });\n}\n\ninterface HiddenTextAreaProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {\n  selection: Selection;\n}\n\nconst HiddenTextArea = React.forwardRef<\n  HTMLTextAreaElement,\n  HiddenTextAreaProps\n>((props, ref) => {\n  const { selection, ...rest } = props;\n  const wrapperRef = React.createRef<HTMLDivElement>();\n  const zoom = useZoom();\n  const controller = useController();\n\n  let { anchor: point } = selection;\n\n  // if the target point is inside a void element, take the previous point\n  const { document } = controller.value;\n  const parentNode = document.getParent(point.key);\n  if (parentNode && controller.query('isVoid', parentNode)) {\n    point = controller.query(pointAtDistance, point, -1);\n  }\n\n  usePointPosition(wrapperRef, point, zoom);\n\n  const children = (\n    <div ref={wrapperRef} style={wrapperStyle} data-cangjie-hidden>\n      <textarea\n        {...rest}\n        {...textAreaProps}\n        ref={ref}\n        rows={1}\n        style={textAreaStyle}\n        data-cangjie-input\n        // https://aone.alibaba-inc.com/v2/project/585561/bug/45423783#\n        // iOS 15+ 有时会出现输入英文时页面 crash 然后 reload\n        // 从现象上看，若关闭了系统输入法的「自动改正」开关，就不会出现\n        // 因此这里加个 Non-standard Attribute 做个防御\n        autoCorrect=\"off\"\n      />\n    </div>\n  );\n  return ReactDOM.createPortal(children, window.document.body);\n});\n\nexport default HiddenTextArea;\n","/* eslint-disable prefer-arrow-callback */\nimport * as React from 'react';\nimport Controller, { defaultScrollType } from '../controller/index';\nimport Selection from '../models/selection';\nimport { getDOMRectFromSelection } from '../utils/dom/scrollToSelection';\n\nexport function useResumePosition(\n  scrollableContainerRef: React.MutableRefObject<HTMLDivElement | null>,\n  containerRef: React.MutableRefObject<HTMLElement | null>,\n  controller: Controller,\n) {\n  // 缓存用户最近一次的光标位置，以实现多人协同时，内容变动，固定用户视角\n  const snapshotCursorY = React.useRef<number | null>(null);\n  const snapshotScrollTop = React.useRef(0);\n  const prevSelectionRef = React.useRef<Selection | null>(null);\n\n  const { document, selection, injections } = controller.value;\n\n  React.useMemo(function snapshotCursorPos() {\n    if (!controller.shouldResumePosition || controller.enableVirtualizeView) {\n      return;\n    }\n    // 记录选区数据发生变化，DOM 尚未变更时，DOM 光标的位置\n    // BACKGROUND：DOM 更新后，若选区数据（key）未发生变化，而选区对应的空间（Path）变化，则光标差异源于协同编辑，需要做滚动调整\n    // HACK：`getSnapshotBeforeUpdate` 没有等价实现，使用 React.memo 实现 DOM 变更前的 Snapshot\n    const val = controller.value;\n\n    if (val.isFocused && scrollableContainerRef.current && prevSelectionRef.current) {\n      snapshotScrollTop.current = scrollableContainerRef.current.scrollTop;\n      const cursorRect = getDOMRectFromSelection(\n        prevSelectionRef.current || val.selection,\n        containerRef.current!,\n        controller,\n      );\n      if (cursorRect) {\n        const cursorY = scrollableContainerRef.current!.scrollTop + cursorRect!.top;\n        snapshotCursorY.current = cursorY;\n      }\n    } else {\n      snapshotCursorY.current = null;\n    }\n  }, [document, selection, injections]);\n\n  React.useEffect(function scrollback() {\n    if (!controller.shouldResumePosition || controller.enableVirtualizeView) {\n      return;\n    }\n    const val = controller.value;\n    if (val.isFocused && snapshotCursorY.current !== null && scrollableContainerRef.current) {\n      // 当 DOM 更新后:\n      // 如果选区所在的空间发生了变化，即当前选区的空间，不等于最近一次单人编辑时缓存的空间\n      // 则认为选区因协同数据而发生了变化，此时需要做滚回操作\n      const cursorRect = getDOMRectFromSelection(\n        val.selection,\n        containerRef.current!,\n        controller,\n      );\n      if (!cursorRect) {\n        snapshotCursorY.current = null;\n      } else {\n        const cursorY = scrollableContainerRef.current!.scrollTop + cursorRect!.top;\n        const offset = cursorY - snapshotCursorY.current;\n        if (offset !== 0) {\n          scrollableContainerRef.current!.scrollTop = snapshotScrollTop.current + offset;\n        }\n        // 刷新 DOM 光标位置\n        snapshotCursorY.current = cursorY;\n      }\n    }\n    // 消费后重置回默认值\n    controller.setScrollType(defaultScrollType);\n  }, [document, selection, injections]);\n\n  React.useEffect(() => {\n    prevSelectionRef.current = selection;\n  }, [selection]);\n}\n","import React from 'react';\nimport equal from 'fast-deep-equal';\nimport { debounce } from 'lodash-es';\nimport Controller from '../controller';\nimport Selection from '../models/selection';\nimport { TextPoint } from '../models/point';\nimport { scrollToSelection } from '../utils/dom';\nimport { IS_MOBILE } from '../utils/environment';\nimport { isScrolling } from '../utils/dom/outsideScroller';\nimport { pointAtStartOfNode, pointAtEndOfNode } from '../queries';\n\nconst DEBOUNCE_TIME_SCROLL_BY_SELECTION = 60;\n\nexport function useScrollBySelection(\n  scrollableContainerRef: React.MutableRefObject<HTMLDivElement | null>,\n  contentRef: React.MutableRefObject<HTMLDivElement | null>,\n  controller: Controller,\n) {\n  const { selection, composing } = controller.value;\n  const scrollDepsRef = React.useRef<{ selection: Selection | null; composing: string }>({ selection: null, composing: '' });\n\n  const scrollBySelection = React.useMemo(\n    () => debounce((targetSelection: Selection, targetComposing: string) => {\n      if (\n        (targetSelection.isExpanded || !controller.readOnly) && // 拖选时 or 编辑态下的光标 可触发滚动\n        controller.value.isFocused &&\n        contentRef.current &&\n        scrollableContainerRef.current &&\n        (!equal(targetSelection, scrollDepsRef.current.selection) || targetComposing !== scrollDepsRef.current.composing)\n      ) {\n        scrollDepsRef.current = {\n          selection: targetSelection,\n          composing,\n        };\n\n        // 移动端：选区 Expand 时候，没必要每次渲染都进行 scroll，不然会导致无法跨段落选择\n        if (IS_MOBILE && targetSelection.isExpanded) {\n          return;\n        }\n\n        // 表格设置的选区，禁止 scroll\n        if (targetSelection.data.isByTable) {\n          return;\n        }\n\n        if (isScrolling(controller)) {\n          return;\n        }\n\n        // 全选状态下，就不要scroll了。\n        const { document: latestDocument, selection: latestSelection } = controller.value;\n        const { start, end } = latestSelection.sort(latestDocument);\n        const startPoint = controller.query(pointAtStartOfNode, latestDocument);\n        const endPoint = controller.query(pointAtEndOfNode, latestDocument);\n\n        const skipScroll = equal(start, startPoint) && equal(end, endPoint);\n        if (skipScroll) {\n          return;\n        }\n\n        const target = (\n          composing\n            ? Selection.create({\n              ...targetSelection,\n              focus: TextPoint.create({\n                ...targetSelection.focus,\n                offset: (targetSelection.focus as TextPoint).offset + targetComposing.length,\n              }),\n            })\n            : targetSelection\n        );\n\n        scrollToSelection(\n          target,\n          contentRef.current,\n          scrollableContainerRef.current,\n          controller,\n        );\n      }\n    }, DEBOUNCE_TIME_SCROLL_BY_SELECTION),\n    [contentRef, scrollableContainerRef, controller],\n  );\n\n  // 根据选区变化滚动页面\n  React.useEffect(() => {\n    // 排除渲染后需要滚回至原位置而非选区所在位置的情况\n    // BACKGROUND: 协同编辑时，若协同者在同一段落的本地选区之前编辑，会导致本地选区变化\n    if (controller.shouldScrollToSelection) {\n      scrollBySelection(selection, composing);\n    }\n    return () => {\n      scrollBySelection.cancel();\n    };\n    // 这里不能加 document 依赖，因为可能会导致多人协同的时候，异常滚动。\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [controller, selection, composing]);\n}\n","import * as React from 'react';\nimport equal from 'fast-deep-equal';\nimport { Rect } from './utils/antiAliasingRects';\nimport { CANGJIE_SELECTION_INACTIVE_COLOR, Selector } from '../../constants';\nimport Selection from '../../models/selection';\nimport Controller from '../../controller';\n\ninterface RangeProps {\n  rects: Rect[];\n  isFocused: boolean;\n  isRemote: boolean;\n  selection: Selection;\n  controller: Controller;\n}\n\nconst attrbiute = {\n  [Selector.nonSelect]: true,\n};\n\nconst style: React.CSSProperties = {\n  pointerEvents: 'none',\n};\n\nconst isComponentPropsEqual = (prevProps: RangeProps, nextProps: RangeProps) => {\n  return (\n    prevProps.isFocused === nextProps.isFocused\n    && prevProps.isRemote === nextProps.isRemote\n    && equal(prevProps.rects, nextProps.rects)\n    && equal(prevProps.selection, nextProps.selection)\n  );\n};\n\n/**\n * 负责渲染 expanded selection\n */\nconst Range = React.memo((props: RangeProps) => {\n  const { rects, controller, isFocused, isRemote, selection } = props;\n\n  const color = React.useMemo(() => controller.query(\n    'selectionColor',\n    selection,\n    !isRemote,\n  // isFocused 在 query 内部会消费掉\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  ), [controller, selection, isRemote, isFocused]);\n\n  return (\n    <div data-cangjie-selection={selection.viewKey} style={style} data-testid=\"cangjie-range\" className='cangjie-range'>\n      {rects.map((rect) => {\n        const position = 'absolute';\n        const { left, top, width, height } = rect;\n        const key = `${left}-${top}-${width}-${height}`;\n        const style: React.CSSProperties = {\n          position,\n          left,\n          top,\n          width,\n          height,\n          backgroundColor: color || CANGJIE_SELECTION_INACTIVE_COLOR,\n        };\n        return <div key={key} {...attrbiute} style={style} />;\n      })}\n    </div>\n  );\n}, isComponentPropsEqual);\n\nexport default Range;\n","/* eslint-disable prefer-arrow-callback */\nimport { useEffect } from 'react';\nimport Controller from '../controller';\nimport { PendingType } from '../interfaces/controller';\nimport { PerfType } from '../interfaces/perf';\nimport Selection from '../models/selection';\n\nfunction isDelayed(selection: Selection, controller: Controller) {\n  return selection !== controller.value.selection;\n}\n\nfunction usePerf(controller: Controller, noTrack?: boolean) {\n  /********************************************************************************************\\\n  * 正常绘制流程                                                                                 *\n  *                 +---------+    +---------+   +---------+   +---------+   +----------+      *\n  *  ---------------+ keydown +----+ render  +---+   rAF   +---+  paint  +---+setTimeout+----> *\n  * Timeline        +---------+    +---------+   +---------+   +---------+   +----------+      *\n  *                                                                                            *\n  \\********************************************************************************************/\n\n  /*************************************************************************************************************\\\n  * 丢帧场景                                                                                                     *\n  *                                +--------------+                                                             *\n  *                          +---->| 未被绘制，丢帧 |                                                             *\n  *                          |     +--------------+                                                             *\n  *                          |                                                                                  *\n  *            +--------------------------+                                                                     *\n  *            | +---------+  +---------+ | +----------+  +---------+  +---------+ +---------+  +---------+     *\n  *  ----------+-+ keydown +--+ render  +-+-+setTimeout+--+ keydown +--+ render  +-+   rAF   +--+  paint  +---> *\n  * Timeline   | +---------+  +---------+ | +----------+  +---------+  +---------+ +---------+  +---------+     *\n  *            +--------------------------+                                                                     *\n  *                                                                                                             *\n  \\*************************************************************************************************************/\n  useEffect(() => {\n    if (noTrack) {\n      return;\n    }\n    // 如果是 pending 期间的选区更新，进行输入统计\n    const { pendingType } = controller;\n    if (\n      pendingType === PendingType.input ||\n      pendingType === PendingType.selection\n    ) {\n      const { selection } = controller.value;\n      let dropped = true;\n      window.requestAnimationFrame(function preparePaint() {\n        // 在下一次 repaint 发生前，若光标不再等于组件 update 时的光标，则认为丢帧\n        dropped = isDelayed(selection, controller);\n        const perfType =\n          pendingType === PendingType.input\n            ? controller.value.composing\n              ? PerfType.composing\n              : PerfType.input\n            : PerfType.selection;\n        controller.perfEnd(perfType, dropped);\n      });\n    }\n  });\n}\n\nexport default usePerf;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Controller from '../../controller';\nimport Selection from '../../models/selection';\nimport Caret from './caret';\nimport Range from './range';\nimport { CaretAppearance } from './types';\nimport { Rect } from './utils/antiAliasingRects';\nimport usePerf from '../../hooks/usePerf';\n\nexport interface Appearance {\n  // 是否为远程选区\n  isRemote: boolean;\n  // 原始 selection\n  selection: Selection;\n  // selection 对应的某一部分的外观\n  appearance: CaretAppearance | Rect[];\n  // 本地光标颜色\n  // perf: 由于本地光标颜色计算依赖于目标 dom 的背景色，所以需要在计算位置时计算\n  color?: string;\n}\n\nexport type SelectionAppearances = Map<\n  HTMLDivElement,\n  Appearance[]\n>\n\ninterface SelectionRendererProps {\n  appearances: SelectionAppearances;\n  isFocused: boolean;\n  controller: Controller;\n}\n\nconst SelectionRenderer = React.memo((props: SelectionRendererProps) => {\n  const { appearances, isFocused, controller } = props;\n  const prevSelectionRef = React.useRef<Selection | null>(null);\n  const [globalStyle, setGlobalStyle] = React.useState<string | null>(null);\n\n  usePerf(controller, prevSelectionRef.current === controller.value.selection);\n\n  React.useEffect(() => {\n    const style = controller.query('selectionGlobalStyle');\n    setGlobalStyle(style);\n  }, []);\n\n  const wrappers = Array.from(appearances.keys());\n  return (\n    <>\n      {wrappers.map((wrapper) => {\n        if (!wrapper) {\n          return null;\n        }\n        const info = appearances.get(wrapper)!;\n        let hasRemote = false;\n        const content = (\n          <>\n            {info.map(({ appearance, isRemote, selection, color }, index) => {\n              hasRemote = hasRemote || isRemote;\n              return (\n                Array.isArray(appearance)\n                ? (\n                  <Range\n                    key={`range-${index}`}\n                    rects={appearance}\n                    isRemote={isRemote}\n                    isFocused={isFocused}\n                    controller={controller}\n                    selection={selection}\n                  />\n                ) : (\n                  <Caret\n                    key={`caret-${index}`}\n                    color={color}\n                    isRemote={isRemote}\n                    isFocused={isFocused}\n                    controller={controller}\n                    selection={selection}\n                    position={appearance}\n                  />\n                )\n              )\n            })}\n            {hasRemote && <style>{globalStyle}</style>}\n          </>\n        );\n        return ReactDOM.createPortal(content, wrapper);\n      })}\n    </>\n  )\n});\n\nexport default SelectionRenderer;\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport { EdgePoint, TextPoint } from '..';\nimport { Selector } from '../constants';\nimport findDOMLeaves from './dom/findDOMLeaves';\n\nconst RE_RGB = /^rgba?\\((.+)\\)/i;\nconst ALPHA_THRESHOLD = 0.5;\nconst LUMINANCE_THRESHOLD = 0.5;\n\ntype RGBATuple = [number, number, number, number];\n\nfunction isCoordInsideDOMRect(x: number, y: number, rect: DOMRect) {\n  const { left, right, top, bottom } = rect;\n  return x >= left && x <= right && y >= top && y <= bottom;\n}\n\n/**\n * @deprecated\n * 获取当前元素的显示背景色。\n * 从此元素的 parent 依次向上，知道找到一个设置背景色的 element 为止。\n * 如果一直没找到，则返回白色。\n */\nexport function getBackgroundColor(at: Element, caretContainer: Element | null): RGBATuple {\n  let element: Element | null = caretContainer;\n\n  // check if it's inside a caret contaienr\n  if (caretContainer) {\n    const overlayBlocks = caretContainer.querySelectorAll(`[${Selector.nonSelect}]`);\n    const { left, width, top, height } = at.getBoundingClientRect();\n    const x = left + width / 2;\n    const y = top + height / 2;\n    const block = Array.from(overlayBlocks).find(b => {\n      return isCoordInsideDOMRect(x, y, b.getBoundingClientRect());\n    });\n    if (block) {\n      element = block as HTMLElement;\n    }\n  }\n\n  // default get background color logic\n  while (element) {\n    const color = window.getComputedStyle(element).backgroundColor;\n    const rgba = rgbaFromString(color);\n    if (rgba && rgba[3] > ALPHA_THRESHOLD && element.getBoundingClientRect().width > 0) {\n      return rgba;\n    }\n    element = element.parentElement;\n  }\n  return [255, 255, 255, 1];\n}\n\nexport function getBgColor(targetBlock: HTMLElement, at: { top: number, left: number, height: number }, point: TextPoint | EdgePoint): RGBATuple {\n  let element: HTMLElement | null = targetBlock;\n  if (point.isTextPoint()) {\n    const leaves = targetBlock.querySelectorAll<HTMLElement>(`[${Selector.key}^=\"${point.key}:\"]`);\n    const target = Array.from(leaves).find(b => {\n      return isCoordInsideDOMRect(at.left, at.top + at.height / 2, b.getBoundingClientRect());\n    });\n    if (target) {\n      element = target;\n    }\n  }\n\n  while (element) {\n    const color = window.getComputedStyle(element).backgroundColor;\n    const rgba = rgbaFromString(color);\n    if (rgba && rgba[3] > ALPHA_THRESHOLD && element.getBoundingClientRect().width > 0) {\n      return rgba;\n    }\n    element = element.parentElement;\n  }\n  return [255, 255, 255, 1];\n}\n\n/**\n * rgba 字符串转为 rgba 数组。\n * 'rgba(0,0,0,0.88)' => [0,0,0,0.88]\n * 'RGB(0,0,0)' => [0,0,0,1]\n */\nfunction rgbaFromString(str: string): RGBATuple | null {\n  const rgb = RE_RGB.exec(str) || [];\n  const rgbs = (rgb[1] || '').split(',');\n  if (rgbs.length < 3) {\n    return null;\n  } else if (rgbs.length === 3) {\n    rgbs.push('1');\n  }\n  const rgba: RGBATuple = [0, 0, 0, 0];\n  rgba[0] = parseInt(rgbs[0], 10);\n  rgba[1] = parseInt(rgbs[1], 10);\n  rgba[2] = parseInt(rgbs[2], 10);\n  rgba[3] = parseFloat(rgbs[3]);\n  return rgba;\n}\n\n/**\n * 获取相对的 luminance。\n * https://www.w3.org/TR/2008/REC-WCAG20-20081211/#relativeluminancedef\n */\nfunction getLuminance(rgba: RGBATuple): number {\n  const a: number[] = [];\n  for (let i = 0; i < 3; i++) {\n    const x = rgba[i] / 255;\n    a[i] = x <= 0.03928 ? x / 12.92 : Math.pow((x + 0.055) / 1.055, 2.4);\n  }\n  return 0.2126 * a[0] + 0.7152 * a[1] + 0.0722 * a[2];\n}\n\n/**\n * 根据背景色，获取光标的颜色。\n */\nexport function getCaretColor(backgroundColor: RGBATuple) {\n  const luminance = getLuminance(backgroundColor);\n  return luminance > LUMINANCE_THRESHOLD ? 'black' : 'white';\n}\n","import Document from '../../../models/document';\nimport Selection from '../../../models/selection';\nimport { Selector } from '../../../constants';\n\n/**\n * 从 cangjie-leaf 中获取 rects\n */\nexport function getRectsFromLeaf(\n  element: HTMLElement,\n  selection: Selection,\n  document: Document,\n): DOMRect[] {\n  const { start, end } = selection.convertToTextPoints(document);\n  const [keyStr, leafOffsetStr] =\n    element.getAttribute(Selector.key)?.split(':') || [];\n  const textNode = element.firstChild;\n  if (!keyStr || !leafOffsetStr || !textNode) {\n    return [];\n  }\n\n  // 检测 leaf 所在的 text 是否在选区内\n  if (!document.isNodeInRange(keyStr, selection)) {\n    return [];\n  }\n\n  const textLength = textNode.textContent?.length || 0;\n  const leafOffset = parseInt(leafOffsetStr, 10);\n\n  // 检测 leaf 是否在选区内\n  if (keyStr === start.key && start.offset > leafOffset + textLength) {\n    return [];\n  }\n  if (keyStr === end.key && end.offset < leafOffset) {\n    return [];\n  }\n\n  // 是否是一半的 leaf\n  let startOffset = -1;\n  let endOffset = -1;\n  if (\n    keyStr === start.key &&\n    start.offset >= leafOffset &&\n    start.offset <= leafOffset + textLength\n  ) {\n    startOffset = start.offset - leafOffset;\n  }\n  if (\n    keyStr === end.key &&\n    end.offset >= leafOffset &&\n    end.offset <= leafOffset + textLength\n  ) {\n    endOffset = end.offset - leafOffset;\n  }\n  if (startOffset >= 0 || endOffset >= 0) {\n    try {\n      const range = window.document.createRange();\n      range.setStart(textNode, Math.max(startOffset, 0));\n      range.setEnd(textNode, endOffset < 0 ? textLength : endOffset);\n      return Array.from(range.getClientRects());\n    } catch (error) {\n      return [];\n    }\n  }\n\n  // 到这里，肯定是完整的 leaf\n  return Array.from(element.getClientRects());\n}\n","export function getDOMPath(dom: HTMLElement, root = window.document.body) {\n  const path: HTMLElement[] = [];\n  let current: HTMLElement | null = dom;\n  while (current && current !== root) {\n    path.push(current);\n    current = current.parentElement;\n  }\n  return path.reverse();\n}\n\nexport function getTraverseRootsByDOMPath(\n  path1: HTMLElement[],\n  path2: HTMLElement[]\n): [HTMLElement, HTMLElement, HTMLElement[]] {\n  const length = Math.min(path1.length, path2.length);\n  let current = 0;\n  for (; current < length; current++) {\n    if (path1[current] !== path2[current]) {\n      break;\n    }\n  }\n  if (current === length) {\n    return [path1[length - 1], path1[length - 1], path1.slice(0, length)];\n  }\n  return [path1[current], path2[current], current > 0 ? path1.slice(0, current) : []];\n}\n","import { merge } from 'lodash-es';\nimport { getTraverseRootsByDOMPath } from './dom';\n\nexport interface TraverseNodeContext {\n  scrollableKey?: string;\n  gapLabel?: string;\n  /**\n   * 排版模式下，不同 line 内的 span 可能重叠，需要增加 lineId 标识以避免被识别为同一行\n   */\n  lineId?: string;\n  /**\n   * 当前节点下叶子节点(leaf or void)是否只有一个\n   */\n  onlyLeafChild?: boolean;\n}\n\nexport type TraverseNodeHandler = (decesdant: HTMLElement, context?: TraverseNodeContext) => {\n  stopTraverse: boolean;\n  context?: TraverseNodeContext;\n};\n\ninterface TraverseOptions {\n  /**\n   * start block DOM 的 Path：自顶向下排列\n   */\n  startPath: HTMLElement[];\n  /**\n   * end block DOM 的 Path：自顶向下排列\n   */\n  endPath: HTMLElement[];\n  /**\n   * 当前节点的 DOM Path\n   */\n  rootPath: HTMLElement[];\n  /**\n   * 是否已遍历到 start block DOM\n   */\n  isStarted: boolean;\n  /**\n   * 是否已遍历到 end block DOM\n   */\n  isEnded: boolean;\n}\n\nexport function traverseDOMTree(\n  root: HTMLElement,\n  callback: TraverseNodeHandler,\n  parentContext: TraverseNodeContext = {},\n  options: TraverseOptions,\n) {\n  let { isStarted, isEnded } = options;\n  const { stopTraverse, context } = callback(root, parentContext);\n  if (stopTraverse) {\n    return { isStarted, isEnded };\n  }\n  const childContext = merge({ ...parentContext }, context);\n  const { startPath, endPath, rootPath } = options;\n  for (const ele of root.children) {\n    const path = rootPath.concat(ele as HTMLElement);\n    const [,, commonStartPath] = getTraverseRootsByDOMPath(startPath, path);\n    const [,, commonEndPath] = getTraverseRootsByDOMPath(endPath, path);\n\n    // 未遍历到 start dom 且在遍历 start dom 的祖先节点\n    if (!isStarted && commonStartPath.length === path.length) {\n      const started = commonStartPath.length === startPath.length;\n      const newOpt = traverseDOMTree(\n        ele as HTMLElement,\n        callback,\n        childContext,\n        {\n          startPath,\n          endPath,\n          rootPath: path,\n          isStarted: started,\n          isEnded,\n        },\n      );\n      isStarted = newOpt.isStarted;\n      isEnded = newOpt.isEnded;\n    } else if (isStarted && (!isEnded || commonEndPath.length === endPath.length)) {\n      // 已到过 start dom 且未遍历完 end dom tree\n      const ended = commonEndPath.length === endPath.length;\n      const newOpt = traverseDOMTree(\n        ele as HTMLElement,\n        callback,\n        childContext,\n        {\n          startPath,\n          endPath,\n          rootPath: path,\n          isStarted,\n          isEnded: ended,\n        },\n      );\n      isStarted = newOpt.isStarted;\n      isEnded = newOpt.isEnded;\n    } else if (isEnded && commonEndPath.length < endPath.length){\n      // 已遍历完 end dom tree\n      break;\n    }\n  }\n  return { isStarted, isEnded };\n}\n\n/**\n * 情况一：startAncestor, endAncestor 为相同节点\n * startAncestor/endAncestor/commonPath\n *                / \\\n *               /   \\\n *             void  block\n *                     /\\\n *                    /  \\\n *                 leaf  leaf\n *\n * 情况二：startAncestor, endAncestor 为兄弟节点\n *             commonPath\n *             /    |    \\\n *            /     |     \\\n *  startAncestor  ...  endAncestor\n *     / \\               /    \\\n *    /   \\             /      \\\n * void    block      block     block\n *          /\\         /\\        /\\\n *         /  \\       /  \\      /  \\\n *      leaf  leaf leaf  leaf leaf leaf\n * (startPath)              (endPath)\n *\n * 情况三：startAncestor, endAncestor 为兄弟节点，且 startPath = startAncestor or endPath = endAncestor\n *             commonPath\n *             /    |    \\\n *            /     |     \\\n *  startAncestor  ...  endAncestor\n * (startPath/void)       /    \\\n *                       /      \\\n *                     block     block\n *                      / \\       / \\\n *                     /   \\     /   \\\n *                   leaf  leaf leaf leaf\n *                                 (endPath)\n */\nexport function traverseDOMForest(\n  startPath: HTMLElement[],\n  endPath: HTMLElement[],\n  callback: TraverseNodeHandler,\n) {\n  const [startAncestor, endAncestor, commonPath] = getTraverseRootsByDOMPath(startPath, endPath);\n\n  let root: HTMLElement | null = commonPath.length === startPath.length ? startPath[startPath.length - 1] : startAncestor;\n  let { isStarted, isEnded } = {\n    isStarted: commonPath.length === startPath.length,\n    isEnded: commonPath.length === endPath.length,\n  };\n  while (root) {\n    const opt = traverseDOMTree(\n      root,\n      callback,\n      {},\n      {\n        startPath,\n        endPath,\n        rootPath: [...commonPath, root],\n        isStarted: isStarted || (commonPath.length + 1 === startPath.length && root === startPath[startPath.length - 1]),\n        isEnded : isEnded || (commonPath.length + 1 === endPath.length && root === endPath[endPath.length - 1]),\n      },\n    );\n    isStarted = opt.isStarted;\n    isEnded = opt.isEnded;\n    if (root === endAncestor) {\n      break;\n    }\n    root = root.nextElementSibling as (HTMLElement | null);\n  }\n}\n","import { isRectOnSameLineOfRect } from '../../../utils/dom/caretRangeFromTargetAndCoord';\nimport { mergeRects } from '../../../utils/dom/optimizeRectsToFitLineHeight';\n\nexport interface Rect {\n  left: number;\n  top: number;\n  width: number;\n  height: number;\n}\n\nexport interface DOMRectWithLine extends DOMRect {\n  lineId?: string;\n}\n\ninterface LineSize {\n  top: number;\n  bottom: number;\n}\n\n// 复用选区定位逻辑中对同一行的判断来进行分行\nconst isOverlapped = (a: LineSize, b: LineSize) => {\n  return isRectOnSameLineOfRect({\n    ...a,\n    height: a.bottom - a.top,\n  }, {\n    ...b,\n    height: b.bottom - b.top,\n  });\n};\n\nconst getMaxLineSize = (a: LineSize, b: LineSize) => ({\n  top: Math.min(a.top, b.top),\n  bottom: Math.max(a.bottom, b.bottom),\n});\n\n// 扩展行高，填充行之间的空隙\nfunction extendToFillBetweenLines(lines: LineSize[], startRects: LineSize[] = [], endRects: LineSize[] = []) {\n  const length = lines.length;\n  if (length === 0) {\n    return [];\n  }\n  let first = lines[0];\n  let last = lines[length - 1];\n  // 用选区 start 所在 block 的 rects 扩展第一行的高度\n  for (const rect of startRects) {\n    if (rect && isOverlapped(rect, first)) {\n      first = getMaxLineSize(rect, first);\n    }\n  }\n  // 用选区 end 所在 block 的 rects 扩展最后一行的高度\n  for (const rect of endRects) {\n    if (rect && isOverlapped(rect, last)) {\n      last = getMaxLineSize(rect, last);\n    }\n  }\n\n  const filled = [first, ...lines.slice(1, length - 1), last];\n\n  for (let i = 1; i < length; i++) {\n    const prev = filled[i - 1];\n    const now = filled[i];\n    const margin = now.top - prev.bottom;\n    prev.bottom += margin / 2;\n    now.top -= margin / 2;\n  }\n  return filled;\n}\n\nfunction splitRectsIntoLines(rects: DOMRectWithLine[]): [DOMRectWithLine[][], LineSize[]] {\n  // 将 rects 以从上到下、从左到右排序 - O(NlogN)\n  const sortedRects = rects.filter((v) => v.width).sort((a, b) => (a.top - b.top) || (a.left - b.left));\n  const lines: DOMRectWithLine[][] = [];\n  const lineSizes: LineSize[] = [];\n  // 将 sortedRects 按顺序归纳到每一行中，并记录每行的尺寸 - O(N)\n  let currentIndex = 0;\n  sortedRects.forEach((rect) => {\n    if (lines.length === 0) {\n      lines.push([rect]);\n      lineSizes.push({ top: rect.top, bottom: rect.bottom });\n      return;\n    }\n\n    // 新的一行\n    if (!isOverlapped(rect, lineSizes[currentIndex]) || rect.lineId !== lines[currentIndex][0].lineId) {\n      lines.push([rect]);\n      lineSizes.push({ top: rect.top, bottom: rect.bottom });\n      currentIndex += 1;\n      return;\n    }\n    // 属于当前行\n    lines[currentIndex].push(rect);\n    lineSizes[currentIndex] = getMaxLineSize(rect, lineSizes[currentIndex]);\n  });\n  return [lines, lineSizes];\n}\n\nexport function antiAliasingRects(rects: DOMRectWithLine[], startRects: DOMRect[] = [], endRects: DOMRect[] = []) {\n  // 将 rects 以从上到下、从左到右排序，并记录每行的尺寸 - O(NlogN)（N 为 rect 个数）\n  const [lines, lineSizes] = splitRectsIntoLines(rects);\n  const startSizes = extendToFillBetweenLines(splitRectsIntoLines(startRects)[1]);\n  const endSizes = extendToFillBetweenLines(splitRectsIntoLines(endRects)[1]);\n\n  // 填充行之间的空隙：获得每行填充后的尺寸 - O(M)（M 为行数）\n  const filledSizes = extendToFillBetweenLines(lineSizes, startSizes, endSizes);\n\n  // 填充行之间的空隙：将 rects 更新为填充后的尺寸并合并相邻的 - ~O(N)\n  const result: Rect[] = [];\n  lines.forEach((lineRects, index) => {\n    const top = filledSizes[index].top;\n    const height = filledSizes[index].bottom - top;\n    const fitted = lineRects.map((rect) => ({\n      top,\n      height,\n      left: rect.left,\n      width: rect.width,\n    }));\n    const merged = mergeRects(fitted);\n    result.push(...merged);\n  });\n  return result;\n}","import { uniqueId } from 'lodash-es';\nimport Controller from '../../../controller';\nimport Selection from '../../../models/selection';\nimport { CANGJIE_SELECTION_EMPTY_WIDTH, Selector } from '../../../constants';\nimport { findDOMNodeSafely } from '../../../utils/dom/findDOMNode';\nimport Path from '../../../models/path';\nimport Document from '../../../models/document';\nimport { getRectsFromLeaf } from './getRectsFromLeaf';\nimport { traverseDOMForest, TraverseNodeHandler, traverseDOMTree, TraverseNodeContext } from './traverse';\nimport { antiAliasingRects, DOMRectWithLine, Rect } from './antiAliasingRects';\nimport { getDOMPath } from './dom';\n\nconst isEdgeSelectable = (dom: HTMLElement) => dom.getAttribute(Selector.edgeSelectable) === 'true';\nconst isLeaf = (dom: HTMLElement) => dom.getAttribute(Selector.leaf) === 'true';\nconst isVoid = (dom: HTMLElement) => dom.getAttribute(Selector.void) === 'true';\nconst isFloatInlineBox = (dom: HTMLElement) => dom.getAttribute('data-type') === 'float-inline-box';\nconst isFloatBlockBox = (dom: HTMLElement) => dom.getAttribute('data-type') === 'float-block-box';\nconst isLine = (dom: HTMLElement) => dom.getAttribute('data-type') === 'line';\n// const isGroupBlock = (dom: HTMLElement) => dom.getAttribute(Selector.groupBlock) === 'true';\nconst isPage = (dom: HTMLElement) => dom.getAttribute('data-type') === 'page';\nconst isTableCell = (dom: HTMLElement) => dom.getAttribute('data-type') === 'table-cell';\nconst isFullyContained = (key: string, voidElement: boolean, selection: Selection, document: Document) => {\n  const { start, end } = selection.sort(document);\n  const startPath = document.getPath(start.key);\n  const endPath = document.getPath(end.key);\n  const targetPath = document.getPath(key);\n  if (!startPath || !endPath || !targetPath) {\n    return false;\n  }\n\n  if (Path.isAncestor(targetPath, startPath) || Path.isAncestor(targetPath, endPath)) {\n    // eg. 目标节点为 [0, 1]，start/end 为 [0, 1, 0]\n    // => 目标节点若为 void 元素，则选区包含了目标\n    // => 目标节点若非 void，则选区未完全包含目标\n    return voidElement;\n  }\n\n  return document.isNodeInRange(key, selection);\n};\n\nexport const GlobalGroupKey = 'global-group';\nexport const DefaultGapLabel = 'default-gap-label';\n\nconst getGapLabel = (decesdant: HTMLElement) => {\n  const conditions = [\n    // isGroupBlock, // TODO FIXME: groupNodes 隔开的上下的全局段落，会被分组到一起做空隙填充，需要再对每个连续的全局区块单独命名\n    isPage,\n    isTableCell,\n    isFloatInlineBox, // 浮动元素单独为一组，不参与普通 Rect 的间隙填充逻辑\n    isFloatBlockBox, // eg. 首字下沉\n  ];\n  const shouldGap = conditions.find((cond) => cond(decesdant));\n  return shouldGap ? (decesdant.getAttribute(Selector.key) || DefaultGapLabel) : undefined;\n};\n\n/**\n * 判断当前节点的子节点中是否仅有一个 leaf/void 节点\n * @param decesdant\n * @returns\n */\nconst hasOnlyLeafChild = (decesdant: HTMLElement) => {\n  let count = 0;\n  const len = decesdant.children.length;\n  for (let i = 0; i < len; i++) {\n    if (isLeaf(decesdant.children[i] as HTMLElement) || isVoid(decesdant.children[i] as HTMLElement)) {\n      count++;\n    }\n    // perf: 找到超过 1 个符合要求的，就提前 return\n    if (count > 1) {\n      return false;\n    }\n  }\n  return count === 1;\n}\n\nconst addLineIdToRect = (rect: DOMRect, lineId?: string): DOMRectWithLine => {\n  return { ...(rect.toJSON ? rect.toJSON() : rect), lineId };\n}\n\nconst addToRectGroupWithGap = (rects: DOMRectWithLine[], target: RectGroupWithGap, context: TraverseNodeContext = {}) => {\n  const key = context.scrollableKey || GlobalGroupKey;\n  const label = context.gapLabel || DefaultGapLabel;\n  if (!target[key]) {\n    target[key] = {};\n  }\n  if (!target[key][label]) {\n    target[key][label] = [];\n  }\n  target[key][label].push(...rects);\n};\n\nexport type RectGroupWithGap = Record<string, Record<string, DOMRect[]>>;\nexport type RectGroup = Record<string, DOMRect[]>;\n\nexport function getRectsFromSelection(selection: Selection, contentDOM: HTMLElement, controller: Controller) {\n  const { document } = controller.value;\n  const { start, end } = selection.sort(document);\n  const startBlock = start.isEdgePoint() ? document.getNode(start.key) : document.getClosestBlock(start.key);\n  const endBlock = end.isEdgePoint() ? document.getNode(end.key) : document.getClosestBlock(end.key);\n  const startPath = document.getPath(start.key);\n  const endPath = document.getPath(end.key);\n  const startBlockPath = startBlock && document.getPath(startBlock.key);\n  const endBlockPath = endBlock && document.getPath(endBlock.key);\n  if (!startBlock || !endBlock || !startPath || !endPath || !startBlockPath || !endBlockPath) {\n    throw new Error('start/end block or path is empty');\n  }\n\n  const selectionRects: RectGroupWithGap = {};\n  const startRects: RectGroupWithGap = {};\n  const endRects: RectGroupWithGap = {};\n\n  // 遍历过程中的 DOM 节点处理逻辑\n  const traverseHandler: TraverseNodeHandler = (decesdant, context = {}) => {\n    const domKey = decesdant.getAttribute(Selector.key);\n    if (!domKey) {\n      return { stopTraverse: false };\n    }\n\n    const voidDOM = isVoid(decesdant);\n    const leafDOM = isLeaf(decesdant);\n    const lineDOM = isLine(decesdant);\n    const edgeSelectableDOM = isEdgeSelectable(decesdant);\n\n    // 记录 start/end 所在 block 的所有 rects，用于后续修正选区边界的 rect\n    if (voidDOM || leafDOM) {\n      const path = document.getPath(domKey.split(':')[0]) || [];\n      if (Path.isAncestor(startBlockPath, path)) {\n        addToRectGroupWithGap(\n          Array.from(decesdant.getClientRects()).map((v) => addLineIdToRect(v, context.lineId)),\n          startRects,\n          context\n        );\n      }\n      if (Path.isAncestor(endBlockPath, path)) {\n        addToRectGroupWithGap(\n          Array.from(decesdant.getClientRects()).map((v) => addLineIdToRect(v, context.lineId)),\n          endRects,\n          context\n        );\n      }\n    }\n\n    if ((edgeSelectableDOM || voidDOM)) {\n      if (isFullyContained(domKey!, voidDOM, selection, document)) {\n        const rect = decesdant.getBoundingClientRect();\n        addToRectGroupWithGap([addLineIdToRect(rect, context.lineId)], selectionRects, context);\n        return { stopTraverse: true }; // 不再继续递归\n      }\n      if (voidDOM) {\n        return { stopTraverse: true };\n      }\n    }\n\n    if (leafDOM) {\n      let newRects = getRectsFromLeaf(decesdant, selection, document);\n      if (context.onlyLeafChild && newRects.length === 1 && newRects[0].width < 1) {\n        const { left, top, height } = newRects[0];\n        const width = CANGJIE_SELECTION_EMPTY_WIDTH;\n        newRects = [{ ...newRects[0].toJSON(), left, top, width, height }];\n      }\n\n      addToRectGroupWithGap(newRects.map((v) => addLineIdToRect(v, context.lineId)), selectionRects, context);\n\n      return { stopTraverse: true };\n    }\n\n    const gapLabel = getGapLabel(decesdant) || context.gapLabel;\n    return { stopTraverse: false, context: { gapLabel, lineId: lineDOM ? domKey : undefined, onlyLeafChild: hasOnlyLeafChild(decesdant) } };\n  };\n\n  const commonAncestorNode = document.getNodeByPath(Path.common(startPath, endPath));\n  if (!commonAncestorNode) {\n    throw new Error('commonAncestorNode is empty');\n  }\n  const commonAncestor = (commonAncestorNode.isElement() ? commonAncestorNode : document.getClosestBlock(commonAncestorNode.key)) || document;\n\n  // 由于 view 或 实际 DOM 树与 document 结构并非一致，所以通过查找 DOM 树上需遍历的子树根结点来做\n  let startBlockDOM = findDOMNodeSafely(startBlock.key, contentDOM);\n  let endBlockDOM = findDOMNodeSafely(endBlock.key, contentDOM);\n\n  // 分页模式下存在虚拟化，若找不到 DOM 则全量遍历已有 DOM\n  if (!startBlockDOM || !endBlockDOM) {\n    const commonAncestorDOM = findDOMNodeSafely(commonAncestor.key, contentDOM);\n    startBlockDOM = startBlockDOM || commonAncestorDOM?.firstElementChild as HTMLElement;\n    endBlockDOM = endBlockDOM || commonAncestorDOM?.lastElementChild as HTMLElement;\n  }\n  // 仍找不到则报错\n  if (!startBlockDOM || !endBlockDOM) {\n    throw new Error('start/end block DOM is empty');\n  }\n\n  const startDOMPath = getDOMPath(startBlockDOM, contentDOM);\n  const endDOMPath = getDOMPath(endBlockDOM, contentDOM);\n\n  // 以遍历森林的方式遍历 [startDOMPath, endDOMPath] 之间的节点\n  traverseDOMForest(startDOMPath, endDOMPath, traverseHandler);\n\n  const res: Rect[] = [];\n  Object.keys(selectionRects).forEach((groupKey) => {\n    // res[groupKey] = [];\n    Object.keys(selectionRects[groupKey]).forEach((gapLabel) => {\n      // TO BE SOLVED: 1. 存在上下 margin 的 block 元素在跨 block 选区时高度会不稳定\n      const lines = antiAliasingRects(selectionRects[groupKey][gapLabel], startRects[groupKey]?.[gapLabel], endRects[groupKey]?.[gapLabel]);\n      res.push(...lines);\n    });\n  });\n\n  return res;\n}\n","import Controller from '../../../controller';\nimport Node from '../../../models/node';\nimport Element from '../../../models/element';\nimport Document from '../../../models/document';\nimport Leaf from '../../../models/leaf';\nimport { TextPoint } from '../../../models/point';\nimport { CURSOR_WIDTH } from '../../../constants';\nimport { getBgColor, getCaretColor } from '../../../utils/caretColor';\nimport { findCaretPosition, findDOMNodeSafely } from '../../../utils/dom';\nimport { Appearance, SelectionAppearances } from '../renderer';\nimport { getRectsFromSelection } from './getRectsFromSelection';\nimport { SelectionWrapperMap } from '../types';\nimport { cacheLocalCaret } from '../../../utils/dom/localCaretPos';\n\nfunction addToResult(\n  result: SelectionAppearances,\n  wrapper: HTMLDivElement,\n  data: Appearance,\n) {\n  if (!result.get(wrapper)) {\n    result.set(wrapper, []);\n  }\n  const targetGroup = result.get(wrapper)!;\n  targetGroup.push(data)\n}\n\nconst getComposingLeaf = (node: Node | null) => (\n  node?.isText()\n    ? node.leaves.find((leaf) =>\n      leaf.marks.some((mark) => mark.type === 'cangjieComposing'),\n    )\n    : undefined\n);\n\n/**\n * 输入法输入时，找到光标实际所在的 point\n *\n * @param anchor\n * @param composingLen\n * @param document 包含 composing mark 的 document\n * @returns\n * - composing leaf 未跨 Text 时，修正 offset 到 anchor.offset + composingLen\n * - composing leaf 跨 Text 时，修正到 composing 末尾所在的 Text 内，offset 为最后一个 Text 内的 composing 部分长度\n */\nexport const findComposingPoint = (anchor: TextPoint, composingLen: number, document: Document) => {\n  let len = 0;\n  let composingEndLeaf: Leaf | undefined;\n  const startText = document.getNode(anchor.key);\n  let textNode = startText;\n\n  // 分页模式下，document 上存在 composing mark，则继续向后找到 composing 末尾；否则使用 startText 即可\n  if (getComposingLeaf(startText)) {\n    const pointAncestor: Element | null = document.getFurthestOnlyChildAncestor(anchor.key);\n    while (len < composingLen && textNode?.isText()) {\n      composingEndLeaf = getComposingLeaf(textNode);\n      len += composingEndLeaf?.text.length || 0;\n      if (len < composingLen) {\n        textNode = pointAncestor ? pointAncestor.getNextText(textNode.key) : null;\n      }\n    }\n  }\n\n  if (textNode) {\n    return TextPoint.create({\n      key: textNode.key,\n      offset: (startText !== textNode && composingEndLeaf) ? composingEndLeaf.text.length : anchor.offset + composingLen,\n    });\n  }\n\n  // 兜底使用原值\n  return anchor;\n}\n\nexport function getSelectionAppearance(\n  selectionWrapperMap: SelectionWrapperMap,\n  zoom: number,\n  isRemote: boolean,\n  contentRef: React.MutableRefObject<HTMLDivElement | null>,\n  controller: Controller,\n): SelectionAppearances {\n  const result: SelectionAppearances = new Map();\n  if (!contentRef.current) {\n    return result;\n  }\n\n  if (controller.shouldHideSelectionOnBlur() && controller.value.isBlurred) {\n    return result;\n  }\n\n  const wrapperRectCache = new WeakMap<HTMLDivElement, DOMRect>();\n  const composingLen = controller.value.composing.length;\n\n  selectionWrapperMap.forEach(({ wrapper, originSelection }, selection) => {\n    if (!wrapper) {\n      return;\n    }\n\n    const offsetRect = wrapperRectCache.get(wrapper) || wrapper.getBoundingClientRect();\n    wrapperRectCache.set(wrapper, offsetRect);\n\n    if (originSelection.isCollapsed) {\n      const preferredEdge = originSelection.isHanging ? 'start' : 'end';\n      let point = selection.anchor;\n      if (!isRemote && point.isTextPoint() && composingLen) {\n        point = findComposingPoint(point, composingLen, controller.value.document);\n      }\n\n      let targetBlockDOM: HTMLElement | null | undefined = null;\n      try {\n        // 存在 selection 先更新而 document 后更新，导致找不到 block 的情况，需要 catch 住，下次更新即可正常渲染\n        const block = controller.value.document.getClosestBlockFromPoint(point.key);\n        targetBlockDOM = block ? findDOMNodeSafely(block.key, contentRef.current || undefined) : null;\n      } catch (e) {\n        // ignore\n      }\n      if (!targetBlockDOM) {\n        return;\n      }\n\n      // 计算位置\n      const { clientLeft, clientTop, height } = findCaretPosition(point, preferredEdge, targetBlockDOM, undefined, zoom) || {};\n      if (typeof clientLeft === 'undefined' || typeof clientTop === 'undefined' || typeof height === 'undefined') {\n        return;\n      }\n\n      const correctedPosition = {\n        top: clientTop - offsetRect.top / zoom,\n        left: clientLeft - offsetRect.left / zoom,\n        height,\n      };\n      if (!isRemote) {\n        cacheLocalCaret(controller, correctedPosition, wrapper);\n      }\n\n      let color: string | undefined;\n      // 为本地光标计算颜色\n      if (!isRemote) {\n        const backgroundColor = getBgColor(targetBlockDOM, { top: clientTop, left: clientLeft, height }, point);\n        color = getCaretColor(backgroundColor);\n      }\n\n      const data: Appearance = {\n        isRemote,\n        color,\n        selection: originSelection,\n        appearance: correctedPosition,\n      };\n      addToResult(result, wrapper, data);\n      return;\n    }\n\n    try {\n      const rects = getRectsFromSelection(selection, contentRef.current!, controller);\n      const data: Appearance = {\n        isRemote,\n        selection: originSelection,\n        appearance: rects.map((rc) => ({\n          top: (rc.top - offsetRect.top) / zoom,\n          left: (rc.left - offsetRect.left) / zoom,\n          height: rc.height / zoom,\n          width: rc.width / zoom,\n        })),\n      }\n      addToResult(result, wrapper, data);\n    } catch (err) {\n      console.warn('[Selection] Failed to get rects from expanded selection', err);\n    }\n\n  });\n\n  return result;\n}","import React from 'react';\nimport root from 'react-shadow';\n\nlet nativeSupport = false\n// 仓颉代码会执行在 node 里，这里做一下防护\nif (typeof Element !== 'undefined' && typeof Element.prototype !== 'undefined') {\n  nativeSupport = 'attachShadow' in Element.prototype && typeof Element.prototype.attachShadow === 'function';\n}\n\ninterface ShadowDomProps {\n  attributes?: Record<string, any>;\n}\n\nexport function ShadowRoot(props: React.PropsWithChildren<ShadowDomProps>) {\n  if (!nativeSupport) {\n    return (\n      <div {...props.attributes}>\n        {props.children}\n      </div>\n    );\n  }\n  return (\n    <root.div {...props.attributes}>\n      {props.children}\n    </root.div>\n  );\n}\n","import React from 'react';\nimport { ShadowRoot } from '../shadowDom';\nimport { Selector } from '../../constants';\n\ntype SelectionSlotProps = React.PropsWithChildren<{\n  // 属于哪个节点的 selection\n  layerFor: string;\n}>;\n\nconst slotStyle: React.CSSProperties = {\n  position: 'absolute',\n  zIndex: 10,\n  // 相对于顶部定位，避免折叠/展开等操作引起的选区定位不稳定\n  top: 0,\n};\n\nexport const SelectionSlot = React.forwardRef<HTMLDivElement, SelectionSlotProps>((props, slotRef) => {\n  return (\n    <ShadowRoot attributes={{\n      [Selector.selectionLayer]: props.layerFor,\n      'data-testid': 'cangjie-selection-layer',\n      style: { position: 'absolute', left: 0, top: 0 }\n    }}>\n      <div ref={slotRef} style={slotStyle} />\n      {props.children}\n    </ShadowRoot>\n  );\n});\n","import Controller from '../../../controller';\nimport Selection from '../../../models/selection';\nimport { SelectionWrapperMap } from '../types';\n\nexport function splitSelectionAndGetWrapper(\n  controller: Controller,\n  selection: Selection,\n  globalRef: React.MutableRefObject<HTMLDivElement | null>\n) {\n  const wrappers: SelectionWrapperMap = controller.query('getSelectionContainers', {\n    selection: selection,\n    defaultWrapper: globalRef.current!\n  }) || new Map();\n  if (wrappers.size < 1) {\n    wrappers.set(selection, { wrapper: globalRef.current!, originSelection: selection });\n    return wrappers;\n  }\n  const res: SelectionWrapperMap = new Map();\n  wrappers.forEach((v, k) => {\n    res.set(k, { ...v, wrapper: v.wrapper || globalRef.current! });\n  });\n  return res;\n}","import React from 'react';\nimport Controller from '../../../controller';\nimport Selection from '../../../models/selection';\nimport { splitSelectionAndGetWrapper } from './splitSelectionAndGetWrapper';\nimport { SelectionWrapperMap } from '../types';\nimport { getCroppedSelection } from '../../../utils/selection';\n\n/**\n * 计算选区应该分布的根节点\n *\n * A. 对于单个原始 selection\n * 1. 若为 collapsed，则返回值的 key 为该 selection，value 为它应渲染目标宿主节点 + originSelection\n * 2. 若为 expanded，则返回值 key 为该 selection 按需切割的子 selection，value 为其对应渲染的目标宿主节点 + originSelection\n *\n * B. remoteSelections 会分别将每一项按上面的规则分割并聚合到一个 Map 中\n *\n * @param controller Controller\n * @param globalWrapperRef 渲染在全局的根节点\n * @returns [local, remotes]: [SelectionWrapperMap, SelectionWrapperMap]\n */\nexport function useSelectionWrappers(controller: Controller, globalWrapperRef: React.MutableRefObject<HTMLDivElement | null>) {\n  const { remoteSelections, selection, document } = controller.value;\n  const prevSelection = React.useRef<Selection | null>(null);\n  const [visibles, setVisibles] = React.useState<string[]>([]);\n\n  const getWrappersBySelection = React.useCallback((sel: Selection) => {\n    const wrappers = splitSelectionAndGetWrapper(controller, sel, globalWrapperRef);\n    return wrappers;\n  }, [document, controller]);\n\n  const local: SelectionWrapperMap = React.useMemo(() => {\n    const isHideSelection = controller.query(\n      'isHideSelection',\n      { selection },\n    );\n\n    const croppedSelection = getCroppedSelection(controller, selection, controller.visibleBlocks);\n\n    // 不显示本地选区时 or 首次渲染 globalWrapperRef 仍为空时\n    if (isHideSelection || !globalWrapperRef.current || !croppedSelection) {\n      return new Map();\n    }\n\n    return getWrappersBySelection(croppedSelection);\n    // 首次渲染出 globalWrapperRef 后，使其重新计算一下以得到选区 appearance\n  }, [selection, document, controller, globalWrapperRef.current, visibles]);\n\n  const remotes = React.useMemo(() => {\n    const map: SelectionWrapperMap = new Map();\n    remoteSelections.forEach((sel) => {\n      const croppedSelection = getCroppedSelection(controller, sel, controller.visibleBlocks);\n      if (croppedSelection) {\n        const wrappers = getWrappersBySelection(croppedSelection);\n        wrappers.forEach((v, key) =>\n          map.set(key, v)\n        );\n      }\n    });\n    return map;\n  }, [remoteSelections, document, controller, visibles]);\n\n  React.useEffect(() => {\n    prevSelection.current = selection;\n  }, [selection, document]);\n\n  React.useEffect(() => {\n    const sub = controller.visibles$.subscribe(visibles => {\n      setVisibles(visibles);\n    });\n    return () => {\n      sub.unsubscribe();\n    }\n  }, [controller]);\n\n  return [local, remotes];\n}\n","import React from 'react';\nimport equal from 'fast-deep-equal';\nimport { throttle } from 'lodash-es';\nimport Controller from '../../controller';\nimport Selection from '../../models/selection';\nimport Node from '../../models/node';\nimport { useSelectionDataAtTheStartOfNextFrame } from '../../hooks/useSelectionData';\nimport { useZoom } from '../../hooks/useZoom';\nimport { useResumePosition } from '../../hooks/useResumePosition';\nimport { useScrollBySelection } from '../../hooks/useScrollBySelection';\nimport SelectionRenderer, { SelectionAppearances } from './renderer';\nimport { getSelectionAppearance } from './utils/getSelectionAppearance';\nimport { SelectionSlot } from './slot';\nimport { useSelectionWrappers } from './utils/useSelectionWrappers';\nimport {\n  useInputingHots,\n  useSelectingHotsAtTheStartOfNextFrame,\n} from '../../hooks/useHots';\n\nexport { SelectionSlot } from './slot';\nexport type { SelectionWrapperMap, CaretAppearance } from './types';\n\nconst THROTTLE_TIME_RESIZE = 300;\n\ninterface SelectionLayerProps {\n  controller: Controller;\n  // content 的 dom ref\n  contentRef: React.MutableRefObject<HTMLDivElement | null>;\n  scrollableContainerRef: React.MutableRefObject<HTMLDivElement | null>;\n}\n\nconst SelectionLayer = (props: SelectionLayerProps) => {\n  const { controller, contentRef, scrollableContainerRef } = props;\n  const {\n    composing,\n    isFocused,\n    selection,\n    document,\n    injections,\n    decorations,\n  } = controller.value;\n\n  const zoom = useZoom() || 1;\n  const [_, forceUpdate] = React.useReducer((c) => c + 1, 0);\n  const [resizeFlag, setResizeFlag] = React.useState(0);\n  const globalWrapperRef = React.useRef<HTMLDivElement | null>(null);\n  const isUnmountedRef = React.useRef(false);\n\n  // 本地选区外观\n  const [local, setLocal] = React.useState<SelectionAppearances>(new Map());\n  // 远程选区外观\n  const [remotes, setRemotes] = React.useState<SelectionAppearances>(new Map());\n\n  const localDepsRef = React.useRef<{\n    composing: string;\n    selection: Selection;\n    node: Node | null;\n  }>({\n    composing,\n    selection,\n    node: null,\n  });\n\n  React.useEffect(() => {\n    isUnmountedRef.current = false;\n    return () => {\n      isUnmountedRef.current = true;\n    };\n  }, []);\n\n  React.useEffect(() => {\n    if (!contentRef.current) {\n      return undefined;\n    }\n    const resizeUpdator = throttle(() => {\n      if (controller.shouldHideSelectionOnBlur() && controller.value.isBlurred) {\n        return;\n      }\n      setResizeFlag((val) => (val + 1) % 2); // 这里无需读取真实的 size 造成 reflow，只需要可以感知到变化即可\n    }, THROTTLE_TIME_RESIZE);\n\n    if (typeof ResizeObserver !== 'undefined') {\n      const observer = new ResizeObserver(resizeUpdator);\n      observer.observe(contentRef.current);\n      return () => {\n        resizeUpdator.cancel();\n        if (contentRef.current) {\n          observer.unobserve(contentRef.current);\n        }\n      };\n    }\n\n    window.addEventListener('resize', resizeUpdator);\n    return () => {\n      resizeUpdator.cancel();\n      window.removeEventListener('resize', resizeUpdator);\n    };\n  }, []);\n\n  React.useEffect(() => {\n    localDepsRef.current.node = selection.isCollapsed\n      ? document.getPreviousNode(selection.anchor.key)\n      : null;\n  }, [selection, document]);\n\n  const shouldForceUpdate = React.useCallback(\n    (range: Selection) => {\n      if (\n        equal(range, selection) &&\n        controller.value.composing === localDepsRef.current.composing\n      ) {\n        // 仅 focus 发生变化时，需要及时 rerender 选区\n        if (isFocused !== controller.value.isFocused) {\n          return true;\n        }\n\n        // BACKGROUND: 在文本型链接的最后 delete 时，链接文字变少了，但选区不会发生变化\n        // 所以需要在这种情况下 force re-render\n        if (range.isCollapsed) {\n          const prevNode = controller.value.document.getPreviousNode(\n            range.anchor.key,\n          );\n          if (!equal(prevNode, localDepsRef.current.node)) {\n            return true;\n          }\n        }\n        return false;\n      }\n      return true;\n    },\n    [controller, isFocused, selection],\n  );\n\n  const selectionUpdator = React.useCallback(\n    ({ range }: { range: Selection }) => {\n      if (shouldForceUpdate(range)) {\n        localDepsRef.current.composing = controller.value.composing;\n        localDepsRef.current.selection = range;\n        forceUpdate();\n      }\n    },\n    [controller, shouldForceUpdate],\n  );\n\n  const onHots = React.useCallback(() => {\n    selectionUpdator({ range: controller.value.selection });\n  }, [controller, selectionUpdator]);\n\n  const onInputingHots = React.useCallback(() => {\n    // 保证节点完成渲染之后才计算和绘制选区\n    Promise.resolve().then(onHots);\n  }, [onHots]);\n\n  useSelectionDataAtTheStartOfNextFrame(controller.selectionData$, null, selectionUpdator, []);\n  useSelectingHotsAtTheStartOfNextFrame(controller, onHots);\n  useInputingHots(controller, onInputingHots);\n\n  // 根据本地选区变化滚动页面\n  useScrollBySelection(scrollableContainerRef, contentRef, controller);\n\n  useResumePosition(scrollableContainerRef, contentRef, controller);\n\n  // 计算选区渲染所分布的根节点\n  const [localWrappersMap, remoteWrappersMap] = useSelectionWrappers(\n    controller,\n    globalWrapperRef,\n  );\n\n  // 选区需保证 node 渲染完成后再更新\n  React.useLayoutEffect(() => {\n    const appearance = getSelectionAppearance(\n      localWrappersMap,\n      zoom,\n      false,\n      contentRef,\n      controller,\n    );\n    setLocal(appearance);\n  }, [\n    localWrappersMap,\n    composing,\n    zoom,\n    // BACKGROUND: https://aone.alibaba-inc.com/v2/project/897543/bug/41787750#\n    isFocused,\n    controller,\n    resizeFlag,\n    injections,\n    decorations,\n  ]);\n\n  React.useLayoutEffect(() => {\n    const appearance = getSelectionAppearance(\n      remoteWrappersMap,\n      zoom,\n      true,\n      contentRef,\n      controller,\n    );\n    setRemotes(appearance);\n  }, [\n    remoteWrappersMap,\n    controller,\n    zoom,\n    isFocused,\n    resizeFlag,\n    document,\n    injections,\n    decorations,\n  ]);\n\n  return (\n    <SelectionSlot ref={globalWrapperRef} layerFor=\"global\">\n      <SelectionRenderer\n        appearances={local}\n        isFocused={isFocused}\n        controller={controller}\n      />\n      <SelectionRenderer\n        appearances={remotes}\n        isFocused={isFocused}\n        controller={controller}\n      />\n    </SelectionSlot>\n  );\n};\n\nexport default SelectionLayer;\n","import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { ControllerContext } from '../controller';\nimport { CONTROLLER_TO_KEY_DOM } from '../utils/dom/getElementByCangjieKey';\n\nexport default function useCangjieKeyBindingRef<T extends HTMLElement>(key: string) {\n  const ref = React.useRef<T>(null);\n  const { controller } = React.useContext(ControllerContext)!;\n  React.useLayoutEffect(() => {\n    if (!CONTROLLER_TO_KEY_DOM.has(controller)) {\n      CONTROLLER_TO_KEY_DOM.set(controller, new Map());\n    }\n    const KEY_DOM = CONTROLLER_TO_KEY_DOM.get(controller)!;\n    if (ref.current) {\n      const dom = ReactDOM.findDOMNode(ref.current) as HTMLElement;\n      KEY_DOM.set(key, dom);\n    } else {\n      KEY_DOM.delete(key);\n    }\n  });\n  return ref;\n}\n","import { GROUP_COLLAPSED_KEY } from '../../constants';\nimport Controller from '../../controller';\nimport { Group, GroupWithKey } from '../../interfaces/group';\nimport Element from '../../models/element';\n\n/**\n * 是否分组被折叠 \n * @param group \n * @returns \n */\nexport function isGroupCollapsed(group: Group) {\n  return group.data[GROUP_COLLAPSED_KEY];\n}\n\n/**\n * 是否分组为空 \n * @param controller \n * @param group \n * @returns \n */\nexport function isGroupEmpty(controller: Controller, group: GroupWithKey) {\n  const { document } = controller.value;\n  const next = document.getNextSibling(group.key);\n  if (next?.isElement() && controller.query('isElementInGroup', next, group) !== false) {\n    return false;\n  }\n  return true;\n}\n","/**\n * @packageDocumentation\n * @ignore\n */\nimport React from 'react';\nimport RenderNodeProps from '../interfaces/renderNodeProps';\nimport Block from '../models/block';\nimport { useNodeStyle } from '../hooks/useStyle';\nimport { Selector } from '../constants';\nimport useGroupData from '../hooks/useGroupData';\nimport { isGroupCollapsed } from '../plugins/group/utils';\nimport { useUserData } from '../hooks/useUserData';\n\nconst blockStyle: React.CSSProperties = {\n  position: 'relative',\n};\n\nconst inlineStyle: React.CSSProperties = {\n  ...blockStyle,\n  display: 'inline-block',\n  textIndent: 'initial',\n  // 设置行高后，使void 节点的高度不变\n  lineHeight: 'initial',\n  maxWidth: '100%',\n};\n\nconst voidStyle: React.CSSProperties = {\n  ...inlineStyle,\n};\n\nconst VoidInlineWrapper: React.FC<Omit<RenderNodeProps, 'children'>> = ({\n  attributes,\n  children,\n}) => {\n  return (\n    <span\n      data-cangjie-void\n      style={voidStyle}\n      {...attributes}\n    >\n      <span style={inlineStyle} >\n        {children}\n      </span>\n    </span>\n  );\n};\n\nconst VoidBlockWrapper: React.FC<Omit<RenderNodeProps, 'children'>> = ({\n  attributes,\n  node,\n  children,\n  controller,\n  visible,\n}) => {\n  const seletableAttrs = { [Selector.edgeSelectable]: true };\n  // @ts-ignore\n  const fold = Block.isBlock(node) ? (useUserData(node, 'fold') || false): false;\n  const hidden = useGroupData<boolean>(\n    node,\n    (groups) => {\n      return groups.some(\n        (group) => isGroupCollapsed(group) && group.key !== node.key,\n      );\n    },\n    fold,\n  );\n  // 合并虚拟化的 visible 与 flattenGroup 的 visible\n  const finalVisible = visible !== false && !hidden;\n  const nodeStyle = useNodeStyle(controller, node, finalVisible);\n\n  return (\n    <div\n      data-cangjie-void\n      data-block-uuid={(node as Block).data.uuid}\n      style={nodeStyle}\n      {...attributes}\n      {...seletableAttrs}\n    >\n      {children}\n    </div>\n  );\n};\n\nconst VoidWrapper: React.FC<Omit<RenderNodeProps, 'children'>> = (props) => {\n  const isBlock = Block.isBlock(props.node);\n  return (\n    isBlock ? (\n      <VoidBlockWrapper {...props} />\n    ) : (\n      <VoidInlineWrapper {...props} />\n    )\n  );\n};\n\nexport default VoidWrapper;\n","import * as React from 'react';\nimport useCangjieKeyBindingRef from '../hooks/useCangjieKeyBindingRef';\n\nexport interface LeafComponentProps {\n  leafKey: string;\n  style?: React.CSSProperties;\n}\n\nconst LeafComponent: React.FC<LeafComponentProps> = (props) => {\n  const { leafKey, style, children } = props;\n  const ref = useCangjieKeyBindingRef<HTMLSpanElement>(leafKey);\n\n  return (\n    <span\n      ref={ref}\n      data-cangjie-key={leafKey}\n      data-cangjie-leaf\n      data-cangjie-mark={props['data-cangjie-mark']}\n      style={style}\n      data-testid={leafKey}\n    >\n      {children}\n    </span>\n  );\n};\n\nexport default LeafComponent;\n","import Element from '../models/element';\nimport Node from '../models/node';\nimport Path from '../models/path';\n\nexport function replaceNodeIntoElement(\n  origin: Element,\n  path: Path | null | undefined,\n  node: Node,\n) {\n  // invalid path\n  if (!path) {\n    return origin;\n  }\n\n  // path 指向自身\n  if (!path.length) {\n    return node;\n  }\n\n  const { nodes } = origin;\n  const offset = path[0];\n  let target: Node = node;\n  // 递归找到目标位置\n  if (path.length > 1) {\n    const parent = nodes[offset];\n    if (parent && parent.isElement()) {\n      target = replaceNodeIntoElement(parent, path.slice(1), node);\n    } else {\n      target = parent;\n    }\n  }\n  // 替换目标节点\n  if (\n    nodes[offset] &&\n    nodes[offset] !== target\n  ) {\n    const next = nodes.slice(0);\n    next[offset] = target;\n    return origin.set('nodes', next);\n  }\n  return origin;\n}\n","import { useEffect, useCallback } from 'react';\nimport { noop } from 'lodash-es';\nimport { Observable, Observer } from '../models/observable';\nimport Path from '../models/path';\nimport Node from '../models/node';\nimport Document from '../models/document';\nimport Block from '../models/block';\nimport Decoration from '../models/decoration';\nimport { TextPoint } from '../models/point';\nimport { InputData } from '../interfaces/input';\nimport Controller from '../controller';\nimport { replaceNodeIntoElement } from '../utils/replaceNodeIntoElement';\n\nexport interface PendingElements {\n  document: Document;\n  node: Node;\n}\n\nexport function useInputPending<T extends InputData>(\n  elements: PendingElements,\n  nodePath: Path,\n  controller: Controller,\n  enablePending: boolean | undefined,\n  pending$: Observable<T>,\n  updateElements: (elements: PendingElements) => void,\n) {\n  const { node, document } = elements;\n  // 根据最新 node，使用 toView 局部重算 view node\n  const pendingHandler: Observer<T> = useCallback((data) => {\n    const { startPath: textPath, startOffset, key: textKey } = data;\n    // 判断当前编辑的 text 节点是否在 node 中\n    const oldViewText = Block.isBlock(node) ? node.getNode(textKey) : null;\n    if (Block.isBlock(node) && oldViewText) {\n      // 获取最新 text 和缓存的 view data\n      const text = controller.value.document.getNodeByPath(textPath);\n      if (text && oldViewText) {\n        const viewData = controller.getViewData(oldViewText);\n        const { injections } = viewData;\n        // 推算出新的 decorations\n        const decorations = viewData.decorations.slice(0);\n        decorations.forEach((d, i) => {\n          if (Decoration.isDecoration(d)) {\n            const { key } = text;\n            const { start, end } = d;\n            if (start.key === key && end.key === key) {\n              const delta = text.text.length - oldViewText.text.length;\n              if (delta && startOffset <= start.offset) {\n                // 在 decoration 前面增删文字\n                const tmp = d.set(\n                  'start',\n                  TextPoint.create({ key, offset: start.offset + delta }),\n                );\n                decorations[i] = tmp.set(\n                  'end',\n                  TextPoint.create({ key, offset: end.offset + delta }),\n                );\n              } else if (delta && startOffset <= end.offset) {\n                // 在 decoration 里面增删文字\n                decorations[i] = d.set(\n                  'end',\n                  TextPoint.create({ key, offset: end.offset + delta }),\n                );\n              }\n            }\n          }\n        });\n\n        const viewText = controller.toView(text, decorations, injections);\n        // 替换 view node 中的 text 节点\n        let rPath: Path | null = textPath.slice(nodePath.length);\n        if (node.getNodeByPath(rPath)?.key !== viewText.key) {\n          rPath = node.getPath(viewText.key);\n        }\n        const viewNode = replaceNodeIntoElement(\n          node,\n          rPath,\n          viewText,\n        );\n        // 替换 view document 中的 node 节点\n        let dPath: Path | null = nodePath;\n        if (document.getNodeByPath(dPath)?.key !== viewNode.key) {\n          dPath = document.getPath(viewNode.key);\n        }\n        const documentView = replaceNodeIntoElement(document, dPath, viewNode) as Document;\n        updateElements({\n          node: viewNode,\n          document: documentView,\n        });\n      }\n    }\n  }, [controller, document, node, nodePath, updateElements]);\n\n  useEffect(() => {\n    // 只在 leaf block 监听 pending 流\n    if (Block.isLeafBlock(node) && enablePending) {\n      const sub = pending$.subscribe(pendingHandler);\n      return () => sub.unsubscribe();\n    }\n    return noop;\n  }, [\n    pending$,\n    pendingHandler,\n    node,\n    enablePending,\n  ]);\n}\n","import { useCallback, useReducer, useRef } from 'react';\nimport { Controller, Node, Document } from '..';\nimport { PendingType } from '../interfaces/controller';\nimport Block from '../models/block';\nimport { isSelectionInNode } from '../utils/selection';\nimport useHots from './useHots';\n\n/**\n * 开启热区时，使用热区视图模型\n * @param controller\n * @param viewNode\n * @param viewDocument\n * @returns\n */\nfunction useView<T extends Node>(\n  controller: Controller,\n  viewNode: T,\n  viewDocument: Document,\n  isSelected,\n) {\n  /**************************************************************************************\\\n  *                                                                                      *\n  *                                                                                      *\n  *         Render with hots$                                  Render with props         *\n  *                                                                                      *\n  *           +------------+                                     +------------+          *\n  *           |    hot$    |                                     |   props    |          *\n  *           |  +-------+ |                                     |            |          *\n  *           |  |  hot  | |                                     | +--------+ |          *\n  *           |  +-------+ |                                     | |document| |          *\n  *           |  +-------+ |             .-------.               | +--------+ |          *\n  *           |  |  hot  | |<--observe--( <Node/> )<---inject----|            |          *\n  *           |  +-------+ |             `-------'               | +--------+ |          *\n  *           |  +-------+ |                                     | |  node  | |          *\n  *           |  |  hot  | |                                     | +--------+ |          *\n  *           |  +-------+ |                                     |            |          *\n  *           +------------+                                     +------------+          *\n  *                  |                                                  |                *\n  *                  |                                                  |                *\n  *                  v                                                  v                *\n  *            .-----------.                                      .-----------.          *\n  *      +----( isViewHot?  )-----+                      +---Y---(  hasHots?   )--+      *\n  *      N     `-----------'      Y                      |        `-----------'   |      *\n  *      |                        |                      |                        |      *\n  *      v                        v                      v                        |      *\n  * +--------+            +--------------+         .-----------.                  |      *\n  * |        |            |              |   +----(isInsideHot? )                 |      *\n  * | silent |            |recalculateView|   |     `-----------'                  |      *\n  * |        |            |              |   |           |                        |      *\n  * +--------+            +--------------+   |           N                        N      *\n  *                               |          Y           v                        |      *\n  *                               v          |      +--------+                    |      *\n  *                      +------------------+|      |        |                    |      *\n  *                      | {node, document} ||      | silent |                    |      *\n  *                      +------------------+|      |        |                    |      *\n  *                                |         |      +--------+                    |      *\n  *                                v         v                                    |      *\n  *                             +------------------------+                        |      *\n  *                             |                        |                        |      *\n  *                             | render(node, document) |<-----------------------+      *\n  *                             |                        |                               *\n  *                             +------------------------+                               *\n  *                                                                                      *\n  \\**************************************************************************************/\n  const [, forceUpdate] = useReducer((c) => !c, false);\n  const selectedRef = useRef(isSelected);\n\n  const onHots = useCallback(() => {\n    if (controller.isViewHot(viewNode)) {\n      // 若正在框选节点，其选中态未发生变化，则不重渲\n      if (\n        controller.pendingType === PendingType.selection &&\n        controller.value.selection.isExpanded\n      ) {\n        const prevSelected = selectedRef.current;\n        const { node, document } = controller.getView(\n          viewNode,\n          viewDocument,\n          false,\n        );\n        selectedRef.current = isSelectionInNode(\n          node,\n          document,\n          controller.value.selection,\n        );\n        if (prevSelected === selectedRef.current) {\n          return;\n        }\n      }\n      forceUpdate();\n    }\n  }, [controller, viewNode, viewDocument, isSelected, forceUpdate]);\n\n  useHots(controller, onHots, undefined, !Block.isBlock(viewNode));\n\n  if (!controller.hasHots()) {\n    return {\n      node: viewNode,\n      document: viewDocument,\n      isSelected,\n    };\n  }\n\n  controller.removeIsSelected(viewNode.key);\n\n  // 重渲时，若节点为热区节点，需要重算其视图模型\n  if (controller.isViewHot(viewNode)) {\n    const { node, document } = controller.getView(viewNode, viewDocument, true);\n\n    let selected = false;\n    if (controller.pendingType === PendingType.input) {\n      selected = true;\n    } else if (\n      controller.pendingType === PendingType.selection &&\n      controller.value.selection.isExpanded\n    ) {\n      // 这种情况已经计算完成，直接使用缓存\n      selected = selectedRef.current;\n    } else {\n      selected = isSelectionInNode(node, document, controller.value.selection);\n    }\n\n    selectedRef.current = selected;\n\n    if (selected) {\n      controller.addIsSelected(viewNode.key);\n    }\n\n    return {\n      node,\n      document,\n      isSelected: selected,\n    };\n  }\n\n  // 重渲时，若节点非热区，则返回缓存的视图模型\n  const { node, document } = controller.getView(viewNode, viewDocument, false);\n  selectedRef.current = isSelected;\n  return {\n    node,\n    document,\n    isSelected,\n  };\n}\n\nexport default useView;\n","import * as React from 'react';\nimport { GROUP_COLLAPSED_KEY } from '../constants';\nimport useGroupData from '../hooks/useGroupData';\nimport RenderGroupProps from '../interfaces/renderGroupProps';\nimport Element from '../models/element';\n\ninterface WrapperProps {\n  node: Element;\n}\n\nconst GroupWrapper: React.FC<WrapperProps> = (props) => {\n  const { children, node } = props;\n  const isCollapsed = useGroupData(\n    node,\n    (groups) => {\n      const group = groups.find((g) => g.key === node.key);\n      return group?.data[GROUP_COLLAPSED_KEY];\n    },\n    false,\n  );\n\n  return React.cloneElement(children as React.ReactElement, {\n    isCollapsed,\n  });\n};\n\nexport default GroupWrapper;\n","/* eslint-disable function-paren-newline */\n/* eslint-disable implicit-arrow-linebreak */\n/**\n * @packageDocumentation\n * @ignore\n */\nimport * as React from 'react';\nimport memoizeOne from 'memoize-one';\nimport equal from 'fast-deep-equal';\nimport warning from 'tiny-warning';\nimport NodeProps from '../interfaces/nodeProps';\nimport Controller from '../controller/index';\nimport Path from '../models/path';\nimport Value from '../models/value';\nimport Node from '../models/node';\nimport Element from '../models/element';\nimport Document from '../models/document';\nimport Block from '../models/block';\nimport Text from '../models/text';\nimport Leaf from '../models/leaf';\nimport Mark from '../models/mark';\nimport Selection from '../models/selection';\nimport { getChildrenIsSelected } from '../utils/getChildrenOverlaps';\nimport useCangjieKeyBindingRef from '../hooks/useCangjieKeyBindingRef';\nimport { CANGJIE_EMPTY, Selector } from '../constants';\nimport VoidWrapper from './voidWrapper';\nimport LeafComponent from './leaf';\nimport { useInputPending, PendingElements } from '../hooks/useInputPending';\nimport { InputData } from '../interfaces/input';\nimport { PendingType } from '../interfaces/controller';\nimport { useNodeStyle } from '../hooks/useStyle';\nimport useView from '../hooks/useView';\nimport GroupWrapper from './groupWrapper';\nimport { isGroupCollapsed, isGroupEmpty } from '../plugins/group/utils';\nimport useGroupData from '../hooks/useGroupData';\nimport { useUserData } from '../hooks/useUserData';\n\nfunction isComposingMark({ type }: Mark) {\n  return type === 'cangjieComposing';\n}\n\nfunction isNotComposingMark(mark: Mark) {\n  return !isComposingMark(mark);\n}\n\nconst checkRerenderNodesBySelectionChange = memoizeOne((\n  prevSelection: Selection, \n  selection: Selection,\n  prevDocument: Document,\n  document: Document,\n) => {\n  const shouldRenderNodeKeys = new Set<string>();\n  const { start, end } = selection.convertToTextPoints(document);\n  const { start: prevStart, end: prevEnd } = prevSelection.convertToTextPoints(document);\n  if (selection === prevSelection) {\n    return shouldRenderNodeKeys;\n  }\n\n  if (start !== prevStart) {\n    shouldRenderNodeKeys.add(start.key);\n    const startAnchestors = document.getAncestors(start.key);\n    startAnchestors.forEach((anchestor) => {\n      shouldRenderNodeKeys.add(anchestor.key);\n    });\n    shouldRenderNodeKeys.add(prevStart.key);\n    const prevStartAnchestors = document.getAncestors(prevStart.key);\n    prevStartAnchestors.forEach((anchestor) => {\n      shouldRenderNodeKeys.add(anchestor.key);\n    });\n  }\n\n  if (end !== prevEnd) {\n    shouldRenderNodeKeys.add(end.key);\n    const endAnchestors = document.getAncestors(end.key);\n    endAnchestors.forEach((anchestor) => {\n      shouldRenderNodeKeys.add(anchestor.key);\n    });\n    shouldRenderNodeKeys.add(prevEnd.key);\n    const prevEndAnchestors = document.getAncestors(prevEnd.key);\n    prevEndAnchestors.forEach((anchestor) => {\n      shouldRenderNodeKeys.add(anchestor.key);\n    });\n  }\n\n  return shouldRenderNodeKeys;\n});\n\n// TODO: 等 selectionLayer 提到 content，修改这里的判断逻辑\nfunction shouldComponentUpdate(prevProps: NodeProps, nextProps: NodeProps) {\n  const { controller } = prevProps;\n\n  const shouldUpdate = controller.run(\n    'shouldNodeComponentUpdate',\n    prevProps,\n    nextProps,\n  );\n  const n = nextProps;\n  const p = prevProps;\n\n  if (shouldUpdate !== null) {\n    if (shouldUpdate) {\n      return true;\n    }\n\n    if (process.env.NODE_ENV === 'development') {\n      warning(\n        shouldUpdate !== false,\n        \"Returning false in `shouldNodeComponentUpdate` does not disable Cangjie's internal `shouldComponentUpdate` logic. If you want to prevent updates, use React's `shouldComponentUpdate` instead.\",\n      );\n    }\n  }\n\n  if (n.node !== p.node) {\n    return true;\n  }\n\n  if (n.visible !== p.visible) {\n    return true;\n  }\n\n  const isSelectionPending = controller.pendingType === PendingType.selection;\n  // 当存在 Hots & Pending 时，节点的重渲会存在两个诱因：\n  // 1. 外部 Props 重渲\n  // 2. 内部受 Hots & Pending 的控制重渲\n  //\n  // 假定节点树为：\n  // ```tsx\n  //   <value>\n  //   <document>\n  //     <block type=\"paragrah\" key=\"p0\">\n  //       <block type=\"paragraph\" key=\"hello\">\n  //         <text key=\"hello-text\">Hello</text>\n  //       </block>\n  //       <block type=\"paragraph\" key=\"world\">\n  //         <text key=\"world-text\">World</text>\n  //         <cursor />\n  //       </block>\n  //     </block>\n  //     <block type=\"paragraph\" key=\"p1\">\n  //       <block type=\"paragraph\" key=\"cangjie\">\n  //         <text key=\"cangjie-text\">Cangjie</text>\n  //       </block>\n  //     </block>\n  //   </document>\n  // </value>\n  //```\n  //\n  // 1. 当光标从 `world-text` 移动到 `hello-text`：计算热区为 ['world', 'hello']，且开始选区 Pending\n  //   1.1 Hots 驱动 `world` 组件树重渲：`world` 未选中\n  //     * `world-text` 因为 props 变更而重渲 `prevProps.isSelected !== nextProps.isSelected`\n  //   1.2 Hots 驱动 `hello` 组件树重渲：`hello` 选中\n  //     * `hello-text` 因为 props 变更而重渲 `prevProps.isSelected !== nextProps.isSelected`\n  //\n  // 2. 当光标从 `hello-text` 移动到 `cangjie-text`：计算热区为 ['p0', 'p1']\n  //    2.1 Hots 驱动 `p0` 组件树重渲：`p0` 节点树取消选中\n  //      * `hello` 重渲，且 `prevProps.isSelected === nextProps.isSelectd === false`，但由于 `hello` 在 pending 期间被选中，因此 `hello` 应重渲以取消选中态\n  //      * `hello` 组件树重渲...\n  //    2.2 Hots 驱动 `p1` 组件树重渲：`p1` 节点树选中\n  //      * `cangjie` 重渲，且 `prevProps.isSelectd !== nextProps.isSelected`，因此 `cangjie 重渲`\n  //      * `cangjie` 组件树重渲..\n  //\n  if (isSelectionPending) {\n    const pendingSelected = controller.getIsSelected(n.node.key);\n    if (p.isSelected === n.isSelected) {\n      return p.isSelected !== pendingSelected;\n    }\n  }\n\n  // 1. 考虑节点树及其选中态为：\n  // ```tsx\n  // <value>\n  //   <document>\n  //     <block key=\"container\" type=\"container\" isSelected={true}>\n  //       <block key=\"hello\" type=\"paragraph\" isSelected={true}>Hello</block>\n  //       <block key=\"world\" type=\"paragraph\" isSelected={false}>World</block>\n  //       <block key=\"cangjie\" type=\"paragprah\">Cangjie</block>\n  //     </block>\n  //   </document>\n  // </value>\n  // ```\n  // 当选区从 `hello` 移动到 `world` 时，节点重渲的顺序为\n  //   * `container` 因为选中态而重渲：为了保证其内部发生的选区变化也能响应，因此重渲 `container`\n  //   * `hello` 选中态变化，重渲 `hello`\n  //   * `world` 选中态变化，重渲 `world`\n  //   * `cangjie` 选中态未变化，不重渲\n  // ```tsx\n  // <value>\n  //   <document>\n  //     <block key=\"container\" type=\"container\" isSelected={true}>\n  //       <block key=\"hello\" type=\"paragraph\" isSelected={true}>Hello</block>\n  //       <block key=\"world\" type=\"paragraph\">World</block>\n  //       <block key=\"cangjie\" type=\"paragraph\">Cangjie</block>\n  //     </block>\n  //   </document>\n  // </value>\n  // ```\n  // \n  // 2. 考虑节点树及其选中态为：\n  // ```tsx\n  // <value>\n  //   <document>\n  //     <block key=\"container1\" type=\"container\" isSelected={true}>\n  //       <block key=\"hello\" type=\"paragraph\" isSelected={true}>Hello</block>\n  //       <block key=\"world\" type=\"paragraph\"}>World</block>\n  //     </block>\n  //     <block key=\"container2\" type=\"container\">\n  //       <block key=\"cangjie\" type=\"paragraph\">Cangjie</block>\n  //     </block>\n  //   </document>\n  // </value>\n  // ```\n  // 当选区从 `container1` 移动到 `cangjie` 时，节点重渲的顺序为\n  //   * `container1` 因为要取消选中而重渲：为了保证取消选中后，其内部节点的选中态也能取消，因此重渲 `container1`\n  //     * `hello` 选中态变化，重渲 `hello`\n  //     * `world` 选中态未变化，不重渲 `world`\n  //   * `container2` 因为选中态变化重渲：为了保证其内部发生的选区变化也能响应，因此重渲 `container`\n  //     * `cangjie` 因为选中态变化而重渲\n  // ```tsx\n  // <value>\n  //   <document>\n  //     <block key=\"container\" type=\"container\" isSelected={true}>\n  //       <block key=\"hello\" type=\"paragraph\" isSelected={true}>Hello</block>\n  //       <block key=\"world\" type=\"paragraph\" isSelected={false}>World</block>\n  //       <block key=\"cangjie\" type=\"paragprah\">Cangjie</block>\n  //     </block>\n  //   </document>\n  // </value>\n  // ```\n  if (n.prevValue?.selection) {\n    const shouldRenderSets = checkRerenderNodesBySelectionChange(n.prevValue.selection, n.value.selection, p.document, n.document);\n    if (shouldRenderSets.has(n.node.key)) {\n      return true;\n    }\n  }\n  if (n.prevValue?.isFocused !== n.value.isFocused) {\n    return n.isSelected !== p.isSelected || n.isSelected || p.isSelected;\n  }\n  return n.isSelected !== p.isSelected;\n}\n\nfunction renderLeaves(parent: Node, node: Text, controller: Controller) {\n  const { value } = controller;\n  const { composing } = value;\n  const { leaves } = node;\n  const ls: React.ReactNode[] = [];\n\n  let nextStartOffset = 0;\n  for (let i = 0; i < leaves.length; i += 1) {\n    const leaf = leaves[i];\n    const startOffset = nextStartOffset;\n    nextStartOffset += leaf.text.length;\n    const hasComposingMark = leaf.marks.some(isComposingMark);\n    const text = leaf.text || CANGJIE_EMPTY;\n    const children: React.ReactNode[] = [\n      hasComposingMark ? <u data-cangjie-composing>{text}</u> : text,\n    ];\n    if (composing) {\n      const marks = leaf.marks.filter(isNotComposingMark);\n      while (i + 1 < leaves.length) {\n        const nextLeaf = leaves[i + 1];\n        const nextHasComposingMark = nextLeaf.marks.some(isComposingMark);\n        const marksWithoutComposing = nextHasComposingMark\n          ? nextLeaf.marks.filter(isNotComposingMark)\n          : nextLeaf.marks;\n        if (!equal(marks, marksWithoutComposing)) {\n          break;\n        }\n        i += 1;\n        nextStartOffset += nextLeaf.text.length;\n        children.push(\n          nextHasComposingMark ? (\n            <u data-cangjie-composing>{nextLeaf.text}</u>\n          ) : (\n            nextLeaf.text\n          ),\n        );\n      }\n    }\n    ls.push(\n      renderLeaf(\n        controller,\n        parent,\n        node,\n        leaf,\n        <React.Fragment>{children}</React.Fragment>,\n        startOffset,\n      ),\n    );\n  }\n\n  return ls;\n}\n\nconst NodeComponent = React.memo(\n  (props: NodeProps): JSX.Element | null => {\n    const { controller, parent, path, composing, prevValue, visible = true } = props;\n    const { value, enablePending, virtualizeManager } = controller;\n    const { selection } = value;\n    let { node, document } = props;\n    const ref = useCangjieKeyBindingRef<HTMLDivElement>(node.key);\n    const [pendingElements, updatePendingElements] =\n      React.useState<PendingElements>({ document, node });\n\n    // @ts-ignore\n    const fold = Block.isBlock(node) ? (useUserData(node, 'fold') || false): false;\n\n    const hidden = useGroupData<boolean>(\n      node,\n      (groups) => {\n        return groups.some(\n          (group) => isGroupCollapsed(group) && group.key !== node.key,\n        );\n      },\n      fold,\n    );\n\n    const finalVisible = visible !== false && !hidden;\n    const {\n      node: view,\n      document: viewDocument,\n      isSelected,\n    } = useView(controller, node, document, props.isSelected);\n    const { inputData$ } = controller;\n\n    // 监听输入缓冲数据流\n    useInputPending<InputData>(\n      { node, document },\n      path,\n      controller,\n      enablePending.input,\n      inputData$,\n      updatePendingElements,\n    );\n\n    if (controller.enableVirtualize && virtualizeManager) {\n      const { nodeManager: virtualizeNodeManager } = virtualizeManager;\n      const path = document.getPath(node.key);\n      if (path) {\n        const topPath = path.slice(0, 1);\n        const topBlock = document.getNodeByPath(topPath) as Block;\n        // 是顶层节点\n        if (node === topBlock) {\n          const virtualizePersistState = virtualizeNodeManager.getVirtualizePersistState(topBlock.key);\n          virtualizePersistState.forEach((childNodeKey) => {\n            const childNode = document.getNode(childNodeKey);\n            if (topBlock.hasNode(childNodeKey) && childNode && controller.query('shouldPersistState', { node: childNode })) {\n              virtualizeNodeManager.updateVirtualizePersistState(childNodeKey, topBlock.key, true);\n            } else {\n              virtualizeNodeManager.updateVirtualizePersistState(childNodeKey, topBlock.key, false);\n            }\n          });\n        }\n        const shouldPersistState = controller.query('shouldPersistState', { node });\n        if (shouldPersistState) {\n          virtualizeNodeManager.updateVirtualizePersistState(node.key, topBlock.key, true);\n        }\n      }\n    }\n\n    // 输入缓冲开始，使用 pending node\n    if (\n      Block.isLeafBlock(props.node) &&\n      controller.isPending &&\n      controller.pendingType === PendingType.input\n    ) {\n      node = pendingElements.node;\n      document = pendingElements.document;\n    }\n\n    // 如果使用热区技术，使用热区重算的模型\n    if (controller.enableHots) {\n      node = view;\n      document = viewDocument;\n    }\n\n    const blockStyle = useNodeStyle(controller, node, finalVisible);\n\n    const children = () => {\n      const n = node.toSubType();\n      if (n.isElement()) {\n        const childrenIsSelected = getChildrenIsSelected(\n          document,\n          n,\n          selection,\n        );\n        const renderedChildren = n.nodes.map((n: Node, i: number) =>\n          renderNode(\n            controller,\n            value,\n            document,\n            node,\n            n,\n            path.concat(i),\n            childrenIsSelected[i],\n            finalVisible,\n            prevValue,\n          ),\n        );\n        return renderedChildren;\n      }\n      return renderLeaves(parent, n, controller);\n    };\n\n    if (Text.isText(node)) {\n      if (process.env.NODE_ENV === 'test') {\n        // 服务于 Test 环境下对 text 渲染的监听\n        controller.run('renderText', { node });\n      }\n      return <>{children()}</>;\n    }\n\n    const isVoid = controller.query('isVoid', node);\n    const isNonEmptyBlock = Block.isBlock(node) && !!node.nodes.length;\n    const isLeafBlock = isNonEmptyBlock && Block.isLeafBlock(node);\n    const isSelectable =\n      isNonEmptyBlock && controller.query('isEdgeSelectable', node);\n    const binding = {\n      ref,\n      [Selector.key]: node.key,\n    };\n    const attributes = {\n      key: node.key,\n    };\n    const attributesWithBinding = { ...attributes, ...binding };\n\n    let nonVoidAttributes: Record<string, any> = attributesWithBinding;\n    if (isLeafBlock) {\n      nonVoidAttributes = {\n        ...nonVoidAttributes,\n        style: blockStyle,\n        [Selector.leafBlock]: true,\n        [Selector.uuid]: controller.query('anchor', node as Element),\n      };\n    }\n    if (isSelectable) {\n      nonVoidAttributes = {\n        ...nonVoidAttributes,\n        style: blockStyle,\n        [Selector.uuid]: controller.query('anchor', node as Element),\n        [Selector.edgeSelectable]: true,\n      };\n    }\n    const element = controller.run('renderNode', {\n      controller,\n      attributes: isVoid ? attributes : nonVoidAttributes,\n      composing,\n      isSelected,\n      parent,\n      node,\n      path,\n      children,\n      visible: finalVisible,\n    });\n    if (element === null) {\n      return null;\n    }\n    if (isVoid) {\n      return (\n        <VoidWrapper {...props} attributes={attributesWithBinding}>\n          {element}\n        </VoidWrapper>\n      );\n    }\n    if (node.isElement()) {\n      const group = controller.groupManager.getGroup(node.key);\n      if (group) {\n        const props = {\n          controller,\n          node,\n          path,\n          group,\n          isCollapsed: false,\n          isEmpty: isGroupEmpty(controller, { ...group, key: node.key }),\n          attributes: {\n            [Selector.groupKey]: node.key,\n          } as const,\n          children: () => element,\n          visible: finalVisible,\n        };\n        const groupElement = controller.run('renderGroup', props);\n        if (groupElement) {\n          return <GroupWrapper node={node}>{groupElement}</GroupWrapper>;\n        }\n      }\n    }\n    return element;\n  },\n  (prevProps, nextProps) => !shouldComponentUpdate(prevProps, nextProps),\n);\n\nfunction renderLeaf(\n  controller: Controller,\n  parent: Node,\n  text: Text,\n  leaf: Leaf,\n  child: React.ReactNode,\n  offset: number,\n) {\n  const { composing } = controller.value;\n  const leafKey = `${text.key}:${offset}`;\n  const initialChild = (\n    <LeafComponent key={leafKey} leafKey={leafKey}>\n      {child}\n    </LeafComponent>\n  );\n\n  const children = leaf.marks.reduce(\n    (child: React.ReactNode, mark) =>\n      controller.run('renderMark', {\n        parent,\n        node: text,\n        offset,\n        composing,\n        mark,\n        marks: leaf.marks,\n        text: leaf.text,\n        children: () => child,\n      }),\n    initialChild,\n  );\n\n  return children;\n}\n\nexport function renderNode(\n  controller: Controller,\n  value: Value,\n  document: Document,\n  parent: Node,\n  node: Node,\n  path: Path,\n  isSelected: boolean,\n  visible = true,\n  prevValue?: Value,\n) {\n  const { composing } = value;\n\n  const comp = (\n    <NodeComponent\n      key={node.key}\n      controller={controller}\n      value={value}\n      document={document}\n      parent={parent}\n      node={node}\n      path={path}\n      composing={composing}\n      isSelected={isSelected}\n      visible={visible}\n      prevValue={prevValue}\n    />\n  );\n  \n  return comp;\n}\n\nexport default NodeComponent;\n","import React from 'react';\n\ninterface VirtualizePlaceholderProps {\n  height?: number;\n}\n\nexport const VirtualizePlaceholder = (props: VirtualizePlaceholderProps) => {\n  const { height = 0 } = props;\n  return (\n    <div data-cangjie-virualize-placeholder style={{ height }} />\n  );\n};","import React, { useEffect, useState } from 'react';\nimport Controller from '../../controller';\nimport { VirtualizeResult } from '../interface';\n\n\nexport default function useVirtualize(\n  controller: Controller,\n  containerRef: React.MutableRefObject<HTMLElement | null>,\n  getScrollableContainer: () => Window | HTMLElement | null,\n) {\n  const { virtualizeManager, enableVirtualizeView } = controller;\n  const [virtualizeId, setVirtualizeId] = useState(0);\n  useEffect(() => {\n    if (!virtualizeManager) {\n      return;\n    }\n    if (enableVirtualizeView) {\n      virtualizeManager.initView({\n        scrollContainer: getScrollableContainer() as HTMLElement,\n        editorContainer: containerRef.current!,\n        triggerViewUpdate: setVirtualizeId,\n      });\n      virtualizeManager.start();\n    } else {\n      virtualizeManager.stop();\n    }\n    return;\n  }, [enableVirtualizeView, virtualizeManager]);\n\n  if (!enableVirtualizeView || !virtualizeManager) {\n    return null;\n  }\n\n  const { outputManager } = virtualizeManager;\n\n  const { beforePlaceholderHeight, afterPlaceholderHeight, visibles } = outputManager;\n\n  const virtualizeResult: VirtualizeResult = {\n    virtualizeId: typeof virtualizeManager.virtualizeId === 'number' ? virtualizeManager.virtualizeId : virtualizeId,\n    beforePlaceholderHeight,\n    afterPlaceholderHeight,\n    visibles,\n  }\n  return [virtualizeResult, setVirtualizeId] as const;\n}\n","import * as React from 'react';\nimport equal from 'fast-deep-equal';\nimport Controller from '../controller/index';\nimport Document from '../models/document';\nimport Value from '../models/value';\nimport Selection from '../models/selection';\nimport { getChildrenIsSelected } from '../utils/getChildrenOverlaps';\nimport useCangjieKeyBindingRef from '../hooks/useCangjieKeyBindingRef';\nimport { renderNode } from './node';\nimport { Selector } from '../constants';\nimport { VirtualizePlaceholder } from '../virtualize/components/VirtualizePlaceholder';\nimport useVirtualize from '../virtualize/hooks/useVirtualize';\n\nexport interface EditableContentProps {\n  controller: Controller;\n  contentRef: React.MutableRefObject<HTMLDivElement | null> | ((instance: HTMLDivElement | null) => void);\n  containerRef: React.MutableRefObject<HTMLElement | null>;\n  getScrollableContainer: () => Window | HTMLElement | null,\n  isFocused: boolean;\n  selection: Selection;\n  document: Document;\n}\n\nconst arePropsEqual = (prevProps: EditableContentProps, nextProps: EditableContentProps) => {\n  const { selection: prevSelection, document: prevView, isFocused: prevIsFocused } = prevProps;\n  const { selection: nextSelection, document: nextView, isFocused: nextIsFocused, controller } = nextProps;\n\n  // 有热区时，不更新，内容交给节点子树自行更新\n  if (controller.hasHots()) {\n    return true;\n  }\n\n  return (\n    equal(prevSelection, nextSelection) &&\n    prevView === nextView &&\n    prevIsFocused === nextIsFocused\n  );\n};\n\nconst EditableContent = React.memo((props) => {\n  const { controller, contentRef: ref, getScrollableContainer, selection, document } = props;\n  const { value } = controller;\n  const prevValue = React.useRef<Value>();\n  React.useEffect(() => {\n    prevValue.current = value;\n  }, [value]);\n  const childrenIsSelected = getChildrenIsSelected(document, document, selection);\n\n  const editableRef = useCangjieKeyBindingRef<HTMLDivElement>(props[Selector.key]);\n  // HACK: use `useCombinedRefs` will break `useCangjieKeyBindingRef`.\n  React.useLayoutEffect(() => {\n    if (!ref) {\n      return;\n    }\n    if (typeof ref === 'function') {\n      ref(editableRef.current);\n    } else {\n      ref.current = editableRef.current;\n    }\n  });\n\n  const useVirtualizeResult = useVirtualize(controller, editableRef, getScrollableContainer);\n\n  const {\n    virtualizeId = -1,\n    beforePlaceholderHeight = 0,\n    afterPlaceholderHeight = 0,\n    visibles = null,\n  } = useVirtualizeResult ? useVirtualizeResult[0] : {};\n\n  const virtualizeAttr = React.useMemo(() => {\n    return controller.enableVirtualize ? {\n      \"data-virtualize-id\": virtualizeId,\n    } : {};\n  }, [controller.enableVirtualize, virtualizeId]);\n\n  // 因为任何原因拿不到虚拟化结果，走非虚拟化分支\n  if (useVirtualizeResult === null || virtualizeId === -1) {\n    const children = document.nodes.map((child, index) =>\n      renderNode(controller, value, document, document, child, [index], childrenIsSelected[index], true, prevValue.current)\n    );\n    return (\n      <>\n        <div\n          ref={editableRef}\n          data-cangjie-key={document.key}\n          data-cangjie-editable\n        >\n          {children}\n        </div>\n      </>\n    );\n  }\n\n  const { blockFinalVisibleStates } = visibles!;\n\n  const children = document.nodes.map((child, index) => {\n    const blockFinalVisibleState = blockFinalVisibleStates[index];\n    const visible = blockFinalVisibleState === 'show';\n    if (blockFinalVisibleState === 'destroy') {\n      return null;\n    }\n    return renderNode(controller, value, document, document, child, [index], childrenIsSelected[index], visible, prevValue.current);\n  });\n\n  return (\n    <>\n      <div\n        ref={editableRef}\n        data-cangjie-key={document.key}\n        data-cangjie-editable\n        {...virtualizeAttr}\n      >\n        {controller.enableVirtualize ? <VirtualizePlaceholder height={beforePlaceholderHeight} /> : null}\n        {children}\n        {controller.enableVirtualize ? <VirtualizePlaceholder height={afterPlaceholderHeight} /> : null}\n      </div>\n    </>\n  );\n}, arePropsEqual);\n\nexport default EditableContent;\n","/* eslint-disable @typescript-eslint/consistent-type-definitions */\nimport React from 'react';\n\n// 移动端弹键盘时，兼容浏览器在 delay 此时间后滚动到光标位置\nconst FOCUS_SCROLL_DELAY = 300;\n// 移动端弹键盘时，等待 visual viewport change 的最大时间\nconst MAX_VIEWPORT_WAIT_TIME = 3000;\n\ntype ScrollParams = {\n  callback: Function;\n  waitTimer: ReturnType<typeof setTimeout>;\n};\n\n/**\n * 移动端处理「点击后，滚动视口到光标」的逻辑\n * 这里需要等待键盘弹出后，才能计算跳转，因此依赖了 visual viewbox\n * 如果不支持 visual viewbox，就用 setTimeout\n */\nexport default function useClickToScroll() {\n  const scrollerRef = React.useRef<ScrollParams | null>(null);\n\n  // resize 事件发生。这里看如果有 scrollerRef，就开始滚动\n  const handleResize = React.useCallback(() => {\n    if (scrollerRef.current) {\n      const { callback, waitTimer } = scrollerRef.current;\n      callback();\n      clearTimeout(waitTimer);\n      scrollerRef.current = null;\n    }\n  }, []);\n\n  // 注册 visual box 事件\n  React.useEffect(() => {\n    if (!window.visualViewport) {\n      return undefined;\n    }\n    window.visualViewport.addEventListener('resize', handleResize);\n    return () => {\n      window.visualViewport.removeEventListener('resize', handleResize);\n    };\n  }, [handleResize]);\n\n  const scheduler = React.useCallback((callback: Function) => {\n    if (scrollerRef.current) {\n      clearTimeout(scrollerRef.current.waitTimer);\n    }\n    if (window.visualViewport) {\n      // 如果支持 visualViewport 就开始检测 size 变化\n      const fallbackCall = () => {\n        scrollerRef.current = null;\n      };\n      const waitTimer = setTimeout(fallbackCall, MAX_VIEWPORT_WAIT_TIME);\n      scrollerRef.current = { callback, waitTimer };\n    } else {\n      // 不支持的话，就用 setTimeout\n      setTimeout(callback, FOCUS_SCROLL_DELAY);\n    }\n  }, []);\n\n  return scheduler;\n}\n","import { createContext, useContext } from 'react';\n\nexport const ScrollableContentContext = createContext<HTMLElement | null>(null);\n\n/**\n * 滚动内容，默认是body\n */\n export function useScrollableContent() {\n  return useContext(ScrollableContentContext);\n}\n","/* eslint-disable prefer-arrow-callback */\n// eslint-disable-next-line import/no-extraneous-dependencies\n/**\n * @packageDocumentation\n * @module Components\n */\nimport React, { useRef } from 'react';\nimport Controller from '../controller/index';\nimport useSelectionCalculator from '../hooks/useSelectionCalculator';\nimport useInputDetector from '../hooks/useInputDetector';\nimport { ZoomContext, ZoomContainerContext, useExternalZoom } from '../hooks/useZoom';\nimport { useContentStyle } from '../hooks/useStyle';\nimport {\n  scrollToSelection,\n  getDOMRectFromSelection,\n} from '../utils/dom/scrollToSelection';\nimport { findClosestInContent } from '../utils/dom';\nimport { ROOT_TO_CONTROLLER } from '../utils/dom/getElementByCangjieKey';\nimport { IS_MOBILE, IS_ANDROID } from '../utils/environment';\nimport CangjieSelectEvent from '../events/cangjieSelect';\nimport pasteInput from '../events/pasteInput';\nimport PolyfillDataTransfer from '../events/dataTransfer';\nimport { Selector, MIME_TYPES } from '../constants';\nimport HiddenTextArea from './hiddenTextArea';\nimport SelectionLayer from './selection';\nimport { PerfType } from '../interfaces/perf';\nimport { PendingType } from '../interfaces/controller';\nimport hotkeys from '../utils/hotkeys';\nimport EditableContent from './editableContent';\nimport useClickToScroll from '../hooks/useClickToScroll';\nimport { ScrollableContainerContext, useScrollableContainer } from './ScrollableContainer';\nimport { ScrollableContentContext } from './ScrollableContent';\nimport useController from '../controller/useController';\n\nconst EVENT_HANDLERS = ['onDrop', 'onMouseMove'];\n\nconst editorStyle: React.CSSProperties = {\n  position: 'relative',\n  whiteSpace: 'pre-wrap',\n  wordWrap: 'break-word',\n  cursor: 'text',\n  userSelect: 'none',\n  WebkitUserSelect: 'none',\n  WebkitTapHighlightColor: 'transparent',\n};\n\nconst CLIPBOARD_IDENTIFIER = '<article class=\"4ever-article\" data-clipboard-cangjie';\n\nfunction useWindowEvent(type: string, handler) {\n  React.useEffect(() => {\n    window.addEventListener(type, handler);\n    return () => window.removeEventListener(type, handler);\n  }, [handler, type]);\n}\n\nexport interface ContentOwnProps {\n  /**\n   * 根节点的CSS样式class\n   */\n  className?: string;\n  /**\n   * 根节点的HTML Tag名字，默认是div\n   */\n  tagName?: string;\n  /**\n   * 根节点的tabIndex，默认0\n   */\n  tabIndex?: number;\n  /**\n   * 缩放倍数\n   */\n  zoom?: number;\n  /**\n   * 根节点 CSS custom style\n   * style.transform 在 zoom 时会被覆盖\n   */\n  style?: React.CSSProperties;\n  /**\n   * 根节点的默认样式\n   */\n  defaultStyle?: React.CSSProperties;\n  /**\n   * 编辑器根节点为空时的占位符\n   */\n  placeholder?: string | React.ReactElement;\n\n  /**\n   * 滚动container，默认是window\n   */\n  getScrollableContainer?: () => HTMLElement | Window;\n  /**\n  * 滚动内容，默认是body\n  */\n  getScrollableContent?: () => HTMLElement;\n}\n\n/**\n * 其它的自定义内容；在调用renderContent插件时，props会做一个浅拷贝传入到参数里\n */\nexport type ContentProps = ContentOwnProps & Record<string, any>;\n\n// 多编辑器实例需要共享\nlet touchStartFlag = false;\n\n/**\n * 是否 Event 不需要被拦截\n * @param target\n */\nfunction isNotEditable(\n  target: React.BaseSyntheticEvent<HTMLElement>['target'],\n) {\n  let el: HTMLElement | null;\n\n  try {\n    // COMPAT: 兼容在某些 Firefox 下，target 无法获取 `.closet()` 方法导致 crash\n    if (target.nodeType === 8) {\n      return true;\n    }\n\n    // COMPAT: 如果 event target 是 Text Node，则判断其父节点\n    el = target.nodeType === 3 ? (target.parentNode as HTMLElement) : target;\n  } catch (err) {\n    return true;\n  }\n\n  return !el || findClosestInContent(el, `[${Selector.notEditable}]`);\n}\n\n/**\n * target 是否一个 Input 或者 TextArea\n */\nfunction isInputTarget(target: any) {\n  return target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement;\n}\n\nfunction useCombinedRefs(...refs) {\n  const targetRef = React.useRef()\n\n  React.useLayoutEffect(() => {\n    refs.forEach(ref => {\n      if (!ref) return\n\n      if (typeof ref === 'function') {\n        ref(targetRef.current)\n      } else {\n        ref.current = targetRef.current\n      }\n    })\n  }, [refs])\n\n  return targetRef\n}\n\n// 避免没有意义的复制、剪切\nconst isValidCopyOrCut = (controller: Controller) => {\n  const { selection, document } = controller.value;\n  if (selection.isExpanded) {\n    return true;\n  }\n  const node = document.getParent(selection.focus.key);\n  if (!node) {\n    return false;\n  }\n  const isVoid = controller.query('isVoid', node);\n  return Boolean(isVoid);\n}\n\nconst Content: React.FC<ContentProps> = React.forwardRef((props, ref) => {\n  const containerRef = React.useRef<HTMLElement | null>(null);\n  const combinedContainerRef: any = useCombinedRefs(containerRef, ref);\n  const contentRef = React.useRef<HTMLDivElement | null>(null);\n  const scrollableContainerRef = React.useRef<HTMLDivElement | null>(null);\n  const textareaRef = React.useRef<HTMLTextAreaElement | null>(null);\n  const prevWindowHeight = React.useRef<number>(window.innerHeight);\n  const prevWindowWidth = React.useRef<number>(window.innerWidth);\n  const [isTextareaDisabled, setIsTextareaDisabled] = React.useState(false);\n\n  const controller = useController();\n  const { readOnly, value, autoFocus } = controller;\n  const docStyle = useContentStyle(controller);\n\n  const { selection, isFocused } = value;\n\n  const document = controller.view;\n\n  const {\n    className,\n    tagName: Container = 'div',\n    tabIndex = 0,\n    zoom = 1,\n    style: customStyle = {},\n    defaultStyle,\n    getScrollableContainer = () => window,\n  } = props;\n\n  const handlers = EVENT_HANDLERS.reduce(\n    (hdls, type: any) => ({\n      ...hdls,\n      [type]: (event) => controller.run(type, event),\n    }),\n    {},\n  );\n\n  // CSS transform只允许内部设置，禁止外部设置\n  let zoomStyle: React.CSSProperties = {};\n  if (typeof zoom === 'number' && zoom !== 1) {\n    zoomStyle = {\n      transform: `scale(${zoom})`,\n      transformOrigin: '0 0',\n    };\n  }\n\n  // 移动端的 textarea focus 会触发视图的滚动，且 preventScroll not working，在 readonly 模式下禁止 focus\n  // TODO: 关于 textarea 的滚动控制可以参考 Google Docs 的 iframe 方案\n  const disableNativeFocus = readOnly && IS_MOBILE;\n\n  const selectionCalculator = useSelectionCalculator(\n    controller,\n    textareaRef,\n    scrollableContainerRef,\n  );\n\n  const inputDetector = useInputDetector(controller, textareaRef);\n\n  const handleClickToFocus = (event: React.MouseEvent) => {\n    if (isNotEditable(event.target) && event.target === window.document.activeElement) {\n      // 不干扰节点自己的 focus 逻辑\n      return;\n    }\n    if (!readOnly) {\n      controller.run('onCangjieFocus');\n    }\n    const textarea = textareaRef.current;\n    if (controller.value.isFocused && !disableNativeFocus) {\n      // HACK: `.focus` only works in mouse event handler on mobile.\n      textarea?.focus({\n        preventScroll: true,\n      });\n    }\n    controller.run('onClick', event);\n  };\n\n  const handleMouseDown = (event: React.MouseEvent) => {\n    if (isNotEditable(event.target)) return;\n    controller.run('onMouseDown', event);\n    if (!event.defaultPrevented) {\n      event.preventDefault();\n      inputDetector.onCompositionEnd();\n      selectionCalculator.onSelectStart(event);\n      selectionCalculator.onMultipleClick(event);\n    }\n  };\n\n  const handleMouseUp = (event: React.MouseEvent) => {\n    if (isNotEditable(event.target)) return;\n    controller.run('onMouseUp', event);\n  };\n\n  const handleKeyDown = (event: React.KeyboardEvent) => {\n    if (isNotEditable(event.target)) return;\n    if (!readOnly) {\n      if (controller.value.composing) {\n        controller.perfStart({ type: PerfType.composing });\n      } else if (controller.pendingType === PendingType.input) {\n        const payload =\n          hotkeys.isDeleteBackward(event) || hotkeys.isDeleteForward(event)\n            ? { type: PerfType.input, subtype: 'delete' }\n            : { type: PerfType.input };\n        controller.perfStart(payload);\n      }\n      const shouldContinue = inputDetector.onKeyDown(event);\n      if (shouldContinue === false) {\n        return;\n      }\n      // 目前许多的编辑行为在 onKeyDown 事件中，所以暂时禁止掉\n      // TODO: 将编辑行为的 onKeyDown 事件和选区交互行为分离 @展炤\n      controller.run('onKeyDown', event);\n    }\n    if (!event.defaultPrevented) {\n      selectionCalculator.onKeyDown(event);\n    }\n  };\n\n  const handleKeyUp = (event: React.KeyboardEvent) => {\n    if (isNotEditable(event.target)) return;\n    selectionCalculator.onKeyUp(event);\n    controller.run('onKeyUp', event);\n  };\n\n  const handleTouchStart = (event: React.TouchEvent) => {\n    if (isNotEditable(event.target)) return;\n    selectionCalculator.onTapHoldStart(event);\n    controller.run('onTouchStart', event);\n  };\n\n  const handleTouchMove = (event: React.TouchEvent) => {\n    if (isNotEditable(event.target)) return;\n    selectionCalculator.onTapHoldEnd();\n    controller.run('onTouchMove', event);\n  };\n\n  const handleTouchEnd = (event: React.TouchEvent) => {\n    if (isNotEditable(event.target)) return;\n    selectionCalculator.onTapHoldEnd();\n    controller.run('onTouchEnd', event);\n  };\n\n  const handleTouchStartCapture = () => {\n    touchStartFlag = true;\n  };\n\n  const handleTouchEndCapture = () => {\n    touchStartFlag = false;\n  };\n\n  const handleContextMenu = (event: React.MouseEvent) => {\n    if (isNotEditable(event.target) || isInputTarget(event.target)) {\n      return;\n    }\n    const { isCollapsed } = controller.value.selection;\n    if (!readOnly) {\n      controller.run('onCangjieFocus');\n    }\n    if (isCollapsed) {\n      controller.run('onClick', event);\n    }\n    controller.run('onContextMenu', event);\n  };\n\n  const handleDragStart = (event: React.DragEvent) => {\n    if (isNotEditable(event.target)) return;\n    controller.run('onDragStart', event);\n  };\n\n  const handleDragOver = (event: React.DragEvent) => {\n    // PERF: just allow drop\n    if (!event.defaultPrevented) {\n      event.preventDefault();\n    }\n  };\n\n  const handleDrop = (event: React.DragEvent) => {\n    if (isNotEditable(event.target)) return;\n    controller.run('onDrop', event);\n  };\n\n  const handleDragEnter = (event: React.DragEvent) => {\n    if (isNotEditable(event.target)) return;\n    controller.run('onDragEnter', event);\n  };\n\n  const handleCopy = React.useCallback((event: React.ClipboardEvent) => {\n    if (!isValidCopyOrCut(controller)) {\n      event.preventDefault();\n      return;\n    }\n    controller.run('onCopy', event);\n  }, [controller]);\n\n  const handleCut = React.useCallback((event: React.ClipboardEvent) => {\n    if (!isValidCopyOrCut(controller)) {\n      event.preventDefault();\n      return;\n    }\n    controller.run('onCut', event);\n  }, [controller]);\n\n  const scheduleScroll = useClickToScroll();\n\n  const handleFocus = React.useCallback(() => {\n    controller.run('onCangjieFocus');\n\n    // BACKGROUND:\n    //   Android 中，点击非工具栏区域 blur 后，再 focus 回编辑器\n    //   会出现 textarea.value === ' ' && textarea.selectionStart === 0 的情况\n    //   导致无法删除文字，输入文字后会吞掉光标前一个字\n    // 所以必须要在 focus 时 reset，而不是 blur 时\n    inputDetector.reset(); // Should reset `textarea` to **EMPTY**.\n\n    if (!IS_MOBILE) {\n      return;\n    }\n\n    const scrollToCaret = () => {\n      const { selection: currentSelection } = controller.value;\n      if (\n        !currentSelection ||\n        !containerRef.current ||\n        !scrollableContainerRef.current ||\n        readOnly\n      ) {\n        return;\n      }\n      scrollToSelection(\n        currentSelection,\n        containerRef.current,\n        scrollableContainerRef.current,\n        controller,\n      );\n    };\n    scheduleScroll(scrollToCaret);\n  }, [controller, inputDetector, readOnly, scheduleScroll]);\n\n  const handleBlur = () => {\n    const textarea = textareaRef.current;\n    if (touchStartFlag && textarea) {\n      textarea.focus({\n        preventScroll: true,\n      });\n      touchStartFlag = false;\n      return;\n    }\n    // 此处是浏览器 bug，blur 时没有触发 compositionend，要手动触发\n    // https://w3c.github.io/uievents/#compositionend\n    // 由于 disabled 会导致切换应用后无法自动 focus\n    // 所以只在 composing 期间才执行 compositionEnd\n    if (value.composing) {\n      triggerCompositionEnd();\n    }\n    // 只读模式下，如果用户在同页面点了其它内容，则先取消选区\n    if (readOnly && window.document.activeElement !== textarea) {\n      const newSelection = controller.value.selection.moveToFocus();\n      controller.run(\n        'onCangjieSelect',\n        CangjieSelectEvent({ selection: newSelection }),\n      );\n    }\n    controller.run('onCangjieBlur');\n  };\n\n  // 安卓下通过返回键/收起键 收起的键盘，不会触发失焦，再点击也不会触发focus\n  // 不过失焦触发的键盘收起仍然能通过 iOS 逻辑 handle\n  // 其余只能通过 resize 事件监听键盘的弹起\n  // 安卓下分屏模式、折叠屏机很常见，也经常横竖屏切换，很大程度不能保证 resize 是键盘引发\n  // 符合以下两个条件再触发滚动最大程度保证行为符合用户预期：\n  // 1、resize 只是高度发生减小宽度未变 2、之前光标在视野内，resize 后不在视野内了\n\n  const handleWindowResize = () => {\n    const { selection: rs, isBlurred } = controller.value;\n    if (\n      isBlurred ||\n      !rs ||\n      !containerRef.current ||\n      !scrollableContainerRef.current\n    ) {\n      return;\n    }\n    const height = window.innerHeight;\n    const width = window.innerWidth;\n    const previousHeight = prevWindowHeight.current;\n    const previousWidth = prevWindowWidth.current;\n    prevWindowHeight.current = height;\n    prevWindowWidth.current = width;\n    if (!IS_ANDROID || height >= previousHeight || previousWidth !== width) {\n      return;\n    }\n    const rect = getDOMRectFromSelection(rs, containerRef.current, controller);\n    if (!rect) {\n      return;\n    }\n    if (rect.top < previousHeight && rect.bottom >= height) {\n      scrollToSelection(\n        rs,\n        containerRef.current,\n        scrollableContainerRef.current,\n        controller,\n      );\n    }\n  };\n\n  // 设置 disabled 并异步取消 disabled 以取消 composing\n  // 不能用 Promose.resolve() micro task 方式，会导致多编辑器互相切换时异常\n  const triggerCompositionEnd = React.useCallback(() => {\n    setIsTextareaDisabled(true);\n    setTimeout(() => {\n      setIsTextareaDisabled(false);\n    });\n    inputDetector.onCompositionEnd();\n  }, [inputDetector]);\n\n  useWindowEvent('resize', handleWindowResize);\n\n  React.useLayoutEffect(() => {\n    const textarea = textareaRef.current;\n    if (!textarea) {\n      return;\n    }\n    const isNativeFocused = window.document.activeElement === textarea;\n    const isFocusedNow = controller.value.isFocused;\n    if (isFocusedNow && !isNativeFocused && !disableNativeFocus) {\n      textarea.focus({\n        preventScroll: true,\n      });\n    }\n    if (!isFocused && isNativeFocused && window.document.hasFocus()) {\n      textarea.blur();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isFocused]);\n\n  React.useLayoutEffect(() => {\n    if (containerRef.current) {\n      ROOT_TO_CONTROLLER.set(containerRef.current, controller);\n    }\n  }, [controller]);\n\n  React.useLayoutEffect(() => {\n    if (!scrollableContainerRef.current) {\n      scrollableContainerRef.current = getScrollableContainer() as HTMLDivElement | null;\n      controller.scrollableContainer = scrollableContainerRef.current;\n    }\n  });\n\n  React.useEffect(() => {\n    return () => {\n      if (containerRef.current && ROOT_TO_CONTROLLER.has(containerRef.current)) {\n        ROOT_TO_CONTROLLER.delete(containerRef.current);\n      }\n    };\n  }, []);\n\n  // 移动端只读场景下，无法监听到键盘事件，因此这里将事件绑定在 document 上\n  // Ref: https://aone.alibaba-inc.com/v2/project/897543/bug/45864425#\n  const isReadMode = Boolean(readOnly || controller.query('isQuickPreview'));\n  React.useEffect(() => {\n    const handleReadOnlyKeyDown = (event: KeyboardEvent) => {\n      if (isNotEditable(event.target)) return;\n      selectionCalculator.onKeyDown(event);\n    };\n\n    const handleReadOnlyKeyUp = (event: KeyboardEvent) => {\n      if (isNotEditable(event.target)) return;\n      selectionCalculator.onKeyUp(event);\n    };\n\n    if (isReadMode && IS_MOBILE) {\n      window.document.addEventListener('keydown', handleReadOnlyKeyDown);\n      window.document.addEventListener('keyup', handleReadOnlyKeyUp);\n    }\n    return () => {\n      if (isReadMode && IS_MOBILE) {\n        window.document.removeEventListener('keydown', handleReadOnlyKeyDown);\n        window.document.removeEventListener('keyup', handleReadOnlyKeyUp);\n      }\n    };\n  }, [readOnly, selectionCalculator, isReadMode]);\n\n  // 编辑模式下 textarea 监听输入行为\n  const editableListeners: React.HTMLAttributes<HTMLTextAreaElement> = readOnly\n    ? {}\n    : {\n      onChange: inputDetector.onChange,\n      onCompositionStart: inputDetector.onCompositionStart,\n      onCompositionEnd: inputDetector.onCompositionEnd,\n      onCut: handleCut,\n      onPaste: (event: React.ClipboardEvent) => {\n        event.preventDefault();\n        const { clipboardData } = event;\n\n        // perf: clipboardData.files 读取耗费性能，减少读取次数\n        // TODO 优化 win 上\n        const isCangjie =\n          clipboardData.types.includes(MIME_TYPES.FRAGMENT) ||\n          (clipboardData.getData(MIME_TYPES.HTML) || '').includes(\n            CLIPBOARD_IDENTIFIER,\n          );\n        const isFile = clipboardData.types.includes('Files') && !isCangjie;\n\n        /**\n         * 支持异步读取 native event 对象上的数据\n         * React 16 及更早版本需要调用 event.persist 方法， 参考：https://reactjs.org/docs/legacy-event-pooling.html\n         * React 17 以上版本 event pool 被移除，默认支持异步读取， 参考：https://reactjs.org/blog/2020/08/10/react-v17-rc.html#no-event-pooling\n         */\n        if (event.persist) {\n          event.persist();\n        }\n\n        // 粘贴的是文件，走同步事件，其他类型走异步事件\n        if (window.DataTransfer && !isFile) {\n          let cloneData;\n          try {\n            cloneData = new DataTransfer();\n          } catch (e) {\n            // 兼容chrome 60以下不支持的DataTransfer构造函数的版本\n            cloneData = new PolyfillDataTransfer();\n          }\n          const pasteInputEvent = pasteInput({});\n          for (const { type, kind } of clipboardData.items) {\n            if (kind === 'file') {\n              continue;\n            }\n            const data = clipboardData.getData(type);\n            cloneData.setData(type, data);\n          }\n          // @ts-ignore\n          pasteInputEvent.clipboardData = cloneData;\n          // @ts-ignore\n          controller.run('onPaste', pasteInputEvent);\n        } else {\n          controller.run('onPaste', event);\n        }\n      },\n    };\n\n  const textareaKeys = {\n    [Selector.dockey]: document.key,\n  };\n\n  // TODO: 在 Safari 下阅读模式会丢失内容焦点，导致键盘事件和CCP事件全部失效\n  // Use jsx will lose type check\n  const content = React.createElement(\n    Container,\n    {\n      ...handlers,\n      ref: combinedContainerRef,\n      [Selector.content]: true,\n      'data-zoom': zoom,\n      className,\n      style: {\n        /**\n         * 优先级（从低到高）：\n         * editorStyle: 用于设置一些编辑器通用的样式\n         * defaultStyle: 排版相关默认样式，仓颉不耦合具体排版样式，此字段仅对 bi/zhi 开放，不对外\n         * docStyle: 默认全局样式，从 provider 传入的配置解析\n         * customStyle: 外部传入的任意样式\n         * zoomStyle: 放大时作用，因此优先级最高\n         */\n        ...editorStyle,\n        ...defaultStyle,\n        ...docStyle,\n        ...customStyle,\n        ...zoomStyle,\n      },\n      onClick: handleClickToFocus,\n      onMouseDown: handleMouseDown,\n      onMouseUp: handleMouseUp,\n      onKeyDown: handleKeyDown,\n      onKeyUp: handleKeyUp,\n      onTouchStart: handleTouchStart,\n      onTouchMove: handleTouchMove,\n      onTouchEnd: handleTouchEnd,\n      onTouchStartCapture: handleTouchStartCapture,\n      onTouchEndCapture: handleTouchEndCapture,\n      onContextMenu: handleContextMenu,\n      onDragOver: handleDragOver,\n      onDrop: handleDrop,\n      onDragEnter: handleDragEnter,\n      onDragStart: handleDragStart,\n    },\n    IS_MOBILE ? <div data-cangjie-hidden data-cangjie-zoomer /> : null,\n    /**\n     * 阅读模式为什么要挂载 textarea 节点？\n     * user-select: none 时浏览器由于丢失了原生选区，无法触发 onCopy 事件，所以这里挂载一个 readOnly 的 textarea 节点用于获取\n     * 浏览器的焦点。\n     */\n    <HiddenTextArea\n      /**\n       * readonly mode disable composition and input\n       * @see https://developer.mozilla.org/en-US/docs/Web/HTML/Element/textarea\n       */\n      readOnly={readOnly}\n      autoFocus={autoFocus && !readOnly}\n      ref={textareaRef}\n      tabIndex={tabIndex}\n      selection={selection}\n      onCopy={handleCopy}\n      onFocus={handleFocus}\n      onBlur={handleBlur}\n      disabled={isTextareaDisabled}\n      {...textareaKeys}\n      {...editableListeners}\n    />,\n    controller.run('renderEditable', {\n      ...props,\n      contentRef,\n      children: () => (\n        <EditableContent\n          document={document}\n          selection={selection}\n          isFocused={isFocused}\n          controller={controller}\n          contentRef={contentRef}\n          containerRef={containerRef}\n          getScrollableContainer={getScrollableContainer}\n        />\n      )\n    }),\n    <SelectionLayer\n      controller={controller}\n      contentRef={combinedContainerRef}\n      scrollableContainerRef={scrollableContainerRef}\n    />,\n  );\n\n  const externalZoom = useExternalZoom();\n\n  return (\n    <ZoomContainerContext.Provider value={containerRef.current}>\n      <ZoomContext.Provider value={zoom * externalZoom}>\n        {controller.run('renderContent', {\n          ...props,\n          contentRef,\n          children: () => content,\n        })}\n      </ZoomContext.Provider>\n    </ZoomContainerContext.Provider>\n  );\n});\n\n/**\n * Cangjie Content 组件\n * (new plugin 修改)scollbaleContainer 和 scrollableContent 属于 cangjie 本身的职责，从 bi/zhi 移动到 cangjie 中\n * @returns\n */\nfunction ContentWithContext(props: ContentProps) {\n  const contentRef = useRef<HTMLDivElement>(null);\n  const {\n    getScrollableContainer = () => window,\n    getScrollableContent = () => contentRef.current || window.document.body,\n    ...rest\n  } = props;\n\n  return (\n    <ScrollableContainerContext.Provider value={getScrollableContainer()}>\n      <ScrollableContentContext.Provider value={getScrollableContent()}>\n        <Content\n          {...rest}\n          ref={contentRef}\n          getScrollableContent={getScrollableContent}\n          getScrollableContainer={getScrollableContainer}\n        />\n      </ScrollableContentContext.Provider>\n    </ScrollableContainerContext.Provider>\n  );\n}\n\nContent.displayName = 'CangjieContent';\n\nexport default ContentWithContext;\n","import { PendingConfigType, EnablePendingConfig } from '../interfaces/controller';\n\nexport default (config?: EnablePendingConfig): Record<PendingConfigType, boolean> => {\n  let input = false;\n  let selection = false;\n  if (typeof config === 'boolean' || !config) {\n    // @ts-ignore typing narrow error ????\n    input = config || false;\n    // @ts-ignore typing narrow error\n    selection = config || false;\n  } else {\n    input = config.input || false;\n    selection = config.selection || false;\n  }\n  return { input, selection };\n};\n","/** \n * 插件 action 创建快捷方法，解决 action 的 typing 问题\n */\n\n import type { default as Action } from '../interfaces/action';\n \n // utils handler for createAction and judgeAction\n export const createActionHandlers = <P extends {\n   [key: string]: any;\n } = {}>(type: symbol): [\n     (payload?: P) => Action<P>,\n     (action: Action<any>) => action is NonNullable<Action<P>>\n   ] => {\n   const createAction = (\n     payload: P = {} as any,\n   ): Action<P> => ({\n     type,\n     payload,\n   });\n   \n   const isAction = (\n     action: Action<any>,\n   ): action is Action<P> => action?.type === type;\n \n   return [createAction, isAction];\n };\n","import Element from '../models/element';\nimport Document from '../models/document';\nimport Node from '../models/node';\n\nexport function getUserData (\n  document: Document,\n  node: Node | null,\n  uid: string | undefined,\n  key: string,\n) {\n  if (!Element.isElement(node)) {\n    return undefined;\n  }\n  const uuid: string | undefined = node.data?.uuid;\n  const nData = node.data[key];\n  if (uid && uuid) {\n    const uData = document.data.userData?.[uid]?.[uuid]?.[key];\n    return uData || nData;\n  }\n  return nData;\n}\n","/* eslint-disable import/first */\n/**\n * @packageDocumentation\n * @ignore\n */\n\n/**\n * Models中存在循环引用，需要保证子类import在前，父类import在后.\n * 详情请参照models/block.ts头部注释。\n */\nimport { default as Block } from './models/block';\nimport Element from './models/element';\nimport Inline from './models/inline';\nimport Text from './models/text';\nimport Node from './models/node';\nimport Controller, {\n  getDirtyKeysFromElementDiffStrictly,\n} from './controller/index';\nimport Provider from './controller/provider';\nimport Value from './models/value';\nimport Document from './models/document';\nimport Leaf from './models/leaf';\nimport Mark from './models/mark';\nimport Injection from './models/injection';\nimport Decoration from './models/decoration';\nimport Selection from './models/selection';\nimport Point, { TextPoint, EdgePoint } from './models/point';\nimport Path from './models/path';\nimport History from './models/history';\nimport ImmutableRecord from './models/immutableRecord';\nimport Operation, { OperationType } from './models/operation';\nimport * as Commands from './commands/index';\nimport * as Queries from './queries/index';\nimport createPlaceholderPlugin from './plugins/placeholder';\nimport createPerfLazyRenderPlugin from './plugins/perfLazyRender';\nimport createPerfFirstRenderPlugin from './plugins/perfFirstRender';\nimport { useOffsetPosition } from './hooks/useOffsetPosition';\nimport {\n  useZoom,\n  useZoomContainer,\n  ExternalZoomContext,\n  useExternalZoom,\n} from './hooks/useZoom';\nimport useLeafBlockResizer from './hooks/useLeafBlockResizer';\nimport { useSelectionData } from './hooks/useSelectionData';\nimport { useUserData } from './hooks/useUserData';\nimport useHots, {\n  useHotsAtTheStartOfNextFrame,\n  useSelectingHots,\n  useInputingHots,\n  useSelectingHotsAtTheStartOfNextFrame,\n  useInputingHotsAtTheStartOfNextFrame,\n} from './hooks/useHots';\nimport useGroupData from './hooks/useGroupData';\nimport { useScroll } from './hooks/useScroll';\nimport Content from './components/content';\nimport { useScrollableContainer } from './components/ScrollableContainer';\nimport { useScrollableContent, ScrollableContentContext } from './components/ScrollableContent';\nimport { ShadowRoot } from './components/shadowDom';\nimport CangjieDataTransfer from './models/dataTransfer';\nimport CangjieClipboardEvent from './events/cangjieClipboard';\nimport CangjieInputEvent from './events/cangjieInput';\nimport CangjieSelectEvent from './events/cangjieSelect';\nimport * as constants from './constants';\nimport * as environment from './utils/environment';\nimport hotkeys from './utils/hotkeys';\nimport * as domUtils from './utils/dom/index';\nimport keyUtils from './utils/keyUtils';\nimport * as transferUtils from './utils/transfer';\nimport textUtils from './utils/textUtils';\nimport setUtils from './utils/setUtils';\nimport FlushTask from './utils/flushtask';\nimport * as opContextUtils from './utils/opContext';\nimport normalizePendingConfig from './utils/normalizePendingConfig';\nimport { createActionHandlers } from './utils/createAction';\nimport { getUserData } from './utils/getUserData';\nimport { omitEmptyObj } from './utils/omitEmpty';\n\nexport type {\n  DocStyle,\n  RenderNodeStyleProps,\n  RenderContentStyleProps,\n} from './hooks/useStyle';\nexport {\n  useStyle,\n  useContentStyle,\n  useNodeStyle,\n  StyleContext,\n} from './hooks/useStyle';\nexport { SelectionSlot } from './components/selection';\nexport type { SelectionWrapperMap } from './components/selection';\n\nexport type { FlushType } from './utils/flushtask';\n// Interfaces\nexport type {\n  ControllerProperties,\n  ControllerConfigs,\n  ControllerOptions,\n  EnablePendingConfig,\n} from './interfaces/controller';\nexport type { ProviderProps } from './controller/provider';\nexport type { UserDataContent } from './controller/userData'\nexport type { ContentProps, ContentOwnProps } from './components/content';\nexport type { ValueProperties, ValueJSON } from './models/value';\nexport type { DocumentProperties, DocumentJSON } from './models/document';\nexport type { ElementProperties } from './models/element';\nexport type { BlockChild, BlockProperties, BlockJSON } from './models/block';\nexport type {\n  InlineProperties,\n  InlineJSON,\n  InlineChildren,\n} from './models/inline';\nexport type { TextProperties, TextJSON } from './models/text';\nexport type { LeafProperties, LeafJSON } from './models/leaf';\nexport type { MarkProperties, MarkJSON } from './models/mark';\nexport type { InjectionProperties } from './models/injection';\nexport type { DecorationProperties, DecorationJSON } from './models/decoration';\nexport type {\n  SelectionProperties,\n  RangeSelectionProperties,\n  SelectionJSON,\n  RangeSelectionJSON,\n} from './models/selection';\nexport type { PointProperties, PointJSON, PointEdge } from './models/point';\nexport type { BlockChildren } from './models/block';\n\nexport type {\n  AddMarkOperation,\n  InsertNodeOperation,\n  InsertTextOperation,\n  MergeNodeOperation,\n  MoveNodeOperation,\n  RemoveMarkOperation,\n  RemoveNodeOperation,\n  RemoveTextOperation,\n  SetMarkOperation,\n  SetNodeOperation,\n  SetSelectionOperation,\n  SplitNodeOperation,\n  Properties,\n} from './models/operation';\n\nexport type { Observer, Subscription } from './models/observable';\n\nexport * as ContextMenu from './plugins/contextMenu';\nexport { ACTION_CLEAR_MOBILE_MENU } from './plugins/mobile';\nimport * as groupActions from './plugins/group/actions';\nimport * as groupUtils from './plugins/group/utils';\nexport const GroupPlugin = {\n  actions: groupActions,\n  utils: groupUtils, \n}\n\nexport type { default as Action, ConvertToPluginActionCreators, PluginActionCreators, ConvertToPluginActionPredicates, PluginActionPredicates } from './interfaces/action';\nexport type { default as Command, ConvertToPluginCommands, PluginCommands } from './interfaces/command';\nexport type { default as Change } from './interfaces/change';\nexport type { default as Plugin } from './interfaces/plugin';\nexport type { default as Query, QueryNext, ConvertToPluginQueries, PluginQueries, isHideSelectionQuery } from './interfaces/query';\nexport type { Schema } from './plugins/normalization';\nexport type { ContextMenuItem } from './interfaces/contextMenu';\nexport type { default as RenderContentProps } from './interfaces/renderEditableProps';\nexport type { default as RenderEditableProps } from './interfaces/renderEditableProps';\nexport type { default as RenderNodeProps } from './interfaces/renderNodeProps';\nexport type { default as RenderMarkProps } from './interfaces/renderMarkProps';\nexport type { default as Data } from './interfaces/data';\nexport type { InputData } from './interfaces/input';\nexport type { Hot } from './interfaces/hot';\nexport type { NodeSelectToolbarItem, NodeSelectToolbarActionPayload } from './interfaces/nodeSelectToolbar';\nexport type { IsDataChangeAffectParentQueryParams } from './queries/hots';\nexport type { SnippetConfig, SnippetConfigs, SnippetItemBase } from './interfaces/snippet';\nexport { PendingType } from './interfaces/controller';\nexport type { Group } from './interfaces/group';\n\nclass RangeSelection extends Selection {}\n\nexport {\n  // Controller\n  Controller,\n  Provider,\n  // Models\n  Value,\n  Node,\n  Element,\n  Document,\n  Block,\n  Inline,\n  Text,\n  Leaf,\n  Mark,\n  Injection,\n  Decoration,\n  Selection,\n  RangeSelection,\n  Point,\n  TextPoint,\n  EdgePoint,\n  Path,\n  History,\n  ShadowRoot,\n  ImmutableRecord,\n  Operation,\n  // Operations & Commands & Plugins\n  OperationType,\n  Commands,\n  Queries,\n  createPlaceholderPlugin,\n  createPerfLazyRenderPlugin,\n  createPerfFirstRenderPlugin,\n  // Hooks\n  useOffsetPosition,\n  useZoom,\n  useZoomContainer,\n  useExternalZoom,\n  ExternalZoomContext,\n  useLeafBlockResizer,\n  useSelectionData,\n  useUserData,\n  useHots,\n  useSelectingHots,\n  useInputingHots,\n  useHotsAtTheStartOfNextFrame,\n  useSelectingHotsAtTheStartOfNextFrame,\n  useInputingHotsAtTheStartOfNextFrame,\n  useGroupData,\n  useScroll,\n  // Views & Events\n  Content,\n  useScrollableContainer,\n  useScrollableContent,\n  ScrollableContentContext,\n  CangjieDataTransfer,\n  CangjieClipboardEvent,\n  CangjieInputEvent,\n  CangjieSelectEvent,\n  // Miscs\n  constants,\n  environment,\n  hotkeys,\n  domUtils,\n  keyUtils,\n  textUtils,\n  setUtils,\n  transferUtils,\n  FlushTask,\n  opContextUtils,\n  createActionHandlers,\n  getUserData,\n  omitEmptyObj,\n  normalizePendingConfig,\n  getDirtyKeysFromElementDiffStrictly,\n};\n\nexport { createSchema, createStrictSchema } from './mo/schema/createSchema'\n\n// mo base\nexport * from './mo/index';\nexport type { MoPluginSchema } from './mo/type'\n\n// new plugin interface\nexport type { BiPlugin, BiFactory, MobileBiFactory } from './interfaces/plugin/bi';\nexport type { ZhiPlugin, ZhiFactory, MobileZhiFactory } from './interfaces/plugin/zhi';\nexport type { MoPluginConfig, BiPluginConfig, ZhiPluginConfig, MobileBiPluginConfig, MobileZhiPluginConfig } from './interfaces/plugin/base';\n"],"names":["IS_IOS","navigator","window","test","userAgent","MSStream","IS_ANDROID","IS_MOBILE","IS_TOUCH_DEVICE","maxTouchPoints","IS_IPAD","IS_MAC","IS_WINDOWS","IS_FIREFOX","IS_SAFARI","vendor","IS_DEV","process","env","NODE_ENV","IS_NODE","versions","node","getChromeVersion","raw","match","parseInt","isFrozen","obj","Object","deepFreeze","propNames","getOwnPropertyNames","key","value","freeze","ImmutableRecord","Node","createProperties","attrs","type","isPlainObject","Error","constructor","props","toSubType","Text","Element","isText","isElement","getFirstNode","nodes","length","getLastNode","getFirstText","getLastText","Mark","create","properties","isMark","data","fromJSON","json","maybeMark","merge","set","isEqual","mark","equal","toJSON","klass","skipUntil","as","func","index","findIndex","a","slice","takeUntil","hasSameMembers","b","every","aElem","find","bElem","has","some","union","bs","reduce","merged","except","filter","Leaf","isLeaf","text","marks","map","undefined","maybeLeaf","normalizeLeaves","leaves","invalid","normalized","reduceRight","ls","leaf","next","listUtils","unshift","splitLeaves","offset","endOffset","left","right","startOffset","splittedIndex","searchLeafAtOffset","found","addMark","addMarks","removeMark","setMark","newMark","newMarks","m","localCount","cangjieKeyGen","hasWindow","keyUtils","keyStr","parse","k","o","split","resetGenerator","add","newAs","splice","push","remove","intersect","removeDuplicate","isSuperSet","SUPRESS_NORMALIZE","normalize","TEXTS","WeakMap","maybeText","isEmptyText","isTextList","maybeTextList","Array","isArray","options","get","t","join","getMarks","getTexts","regenerateKey","getLeaves","decorations","firstLeaf","d","forEach","dec","start","end","hasStart","hasEnd","before","bundle","middle","after","concat","l","setUtils","getActiveMarks","firstMarks","getMarksBetweenOffsets","result","leafEnd","leafStart","getActiveMarksBetweenOffsets","foundNoMarks","getMarksAtIndex","leafObj","first","newFirst","insertText","delta","beforeText","afterText","newLeaves","newLeaf","removeText","newText","mergeText","other","splitText","position","befores","afters","object","preserveKeys","Path","compare","path","target","Math","min","i","pv","tv","crop","size","ca","cb","decrement","n","increment","newPath","link","ancestor","subPath","isAncestor","p","isDescendant","isBefore","isAfter","isSibling","parent","isPrevSibling","isYounger","pl","tl","isDeeper","isParent","isChild","last","previous","ancestors","common","av","bv","relative","transform","operation","pIndex","pEqual","pYounger","pAbove","np","npIndex","npEqual","npYounger","npAbove","isRoot","whereToStr","where","NodeNotFoundError","createAssertNotFoundError","ofType","assertNotFound","maybeNode","method","setPrototypeOf","prototype","PathNotFoundError","KEYS_TO_EDGES_TABLE_CACHE","linkKeysToEdgesTable","src","table","assertNode","assertElement","assertText","assertBlock","Block","maybeElement","isInline","Inline","isBlock","getNode","assertPath","assertNodeByPath","getNodeByPath","assertTextByPath","assertElementByPath","getPath","hasNode","Boolean","getKeysToEdgesTable","isEmpty","idx","keysToEdgesTable","parentKey","reverse","getPreviousSibling","getPreviousSiblingByPath","lastIndex","getNextSibling","getNextSiblingByPath","getPreviousNode","getPreviousNodeByPath","previousNode","parentPath","parentPrevSibling","getNextNode","getNextNodeByPath","nextNode","parentNextSibling","assertPreviousText","getPreviousText","getPreviousTextByPath","previousPath","getNextText","getNextTextByPath","nextPath","getPreviousBlock","child","block","getClosestBlock","getNextBlock","closest","nested","forEachDescendant","str","getFurthsest","predicate","getFurthsestByPath","getAncestorsByPath","fursest","getFurthsestInline","getFurthsestBlock","getFurthestOnlyChildAncestor","getFurthestOnlyChildAncestorByPath","furthest","getAncestors","_","getClosest","getClosestByPath","self","getClosestInline","getClosestInlineByPath","assertClosestBlock","getClosestBlockByPath","getClosestBlockFromPoint","getFurthestAncestor","childPath","assertFurthestAncestor","getOffset","childIndex","memo","getParent","getParentByPath","assertParent","element","assertCommonAncestor","getCommonAncestor","aPath","bPath","getTextsBetweenPositions","startKey","endKey","startText","endText","texts","indexOf","getInlines","inlines","isLeafInline","getInlinesByType","mapDescendants","newNodes","ret","iterator","someDescendant","filterDescendants","descendants","findDescendant","contains","replaceNode","noSpacialEffect","maybeParent","maybeTextNode","textNode","insertNode","removeNode","mergeNode","maybeB","withPath","maybeA","aNode","newNode","splitNode","moveNode","newParentPath","newParent","setNode","childFromJSON","maybeInline","maybeLeafInline","maybeBlock","isBlocks","maybeBlocks","isLeafBlock","maybeLeafBlock","getBlocks","array","getBlocksByType","hasBlockChildren","DEFAULT_TYPE","PendingType","PendingConfigType","useHots","controller","onHots","pendingType","disabled","useEffect","enableHots","handleOnHots","hots","sub","hots$","subscribe","unsubscribe","useHotsAtTheStartOfNextFrame","onHotsNextFrame","animId","React","useRef","useCallback","current","requestAnimationFrame","cancelAnimationFrame","useSelectingHots","selection","useSelectingHotsAtTheStartOfNextFrame","useInputingHots","input","useInputingHotsAtTheStartOfNextFrame","isSupportProxy","Proxy","useController","maxPending","context","useContext","ControllerContext","isRendering","useLayoutEffect","forceRender","useReducer","s","hasConsumedValue","lastConsumedValue","useMemo","ctrl","prop","debouncedRerender","Number","isFinite","debounce","noop","subject","connectController","Component","_createElement","_extends","OperationType","invert","invertedPath","invertedNewPath","isInvertedYounger","isInvertedAncestor","invertedMark","invertedProperties","keys","prevProperties","prevSelection","Operation","PATH_CACHE","Point","createFromParams","TextPoint","EdgePoint","edge","moveToStartOfNode","firstNode","moveToEndOfNode","lastNode","isTextPoint","isEdgePoint","moveBackward","moveForward","convertToTextPoint","document","point","BEFORE","isInNode","getPathIn","DOCUMENT_TO_PATH_CACHE","viewKey","moveTo","isAtStartOfNode","isAtEndOfNode","AFTER","trie","classesmjs","Other","Prepend","CR","LF","Control","Extend","Regional_Indicator","SpacingMark","L","V","T","LV","LVT","ZWJ","ExtPict","classes","bin","atob","Uint8Array","charCodeAt","Buffer","from","classTrie","UnicodeTrie","codePointAt","code","hi","low","isSurrogate","pos","ref","ref1","BreakType","NotBreak","BreakStart","Break","BreakLastRegional","BreakPenultimateRegional","shouldBreak","mid","all","rIIndex","lastIndexOf","c","getUnicodeByteOffset","unicodeOffset","nextBreak","string","prev","j","previousBreak","breaks","res","brk","countBreaks","count","break","SURROGATE_START","SURROGATE_END","SPACE","PUNCTUATION","isChineseChar","char","isValidString","isPunc","isSameCharType","charA","charB","isWord","getNextLetter","GraphemeBreaker","substring","getCharOffset","getCharOffsetBackward","getCharOffsetForward","getCharRange","getWordRange","charAtOffset","lastChar","nextChar","getWordOffsetBackward","getWordOffsetForward","getWordOffset","curChar","getMoveWordOffset","abs","graphemesBreak","NEWLINE","SECLINE","SIMPLE_SPACE","String","fromCharCode","spaceUniCode","nbsp","zwnj","zwj","normalizeText","isValidElement","el","nodeType","ELEMENT_NODE","getAttribute","findClosestInContent","selector","matches","call","parentElement","parentNode","CUSTOM_MIME_TYPES","FRAGMENT","PACKAGE","SYNC","DOCKEY","REFBLOCK","ENCRYPTION","APPLICATION_VSCODE","MIME_TYPES","HTML","TEXT","EVENTS","CURSOR_WIDTH","CURSOR_EDGE_MAX_HEIGHT","CURSOR_EDGE_OFFSET","CANGJIE_EMPTY","CANGJIE_SELECTION_COLOR","CANGJIE_SELECTION_EMPTY_WIDTH","CANGJIE_SELECTION_INACTIVE_COLOR","Z_INDEX_CONTEXTMENU","Selector","content","edgeSelectable","editable","void","leafBlock","nonSelect","notEditable","dockey","selectionLayer","selectionWrapper","groupBlock","groupKey","hoverWrapper","uuid","MAX_HISTORY_SIZE","GROUP_COLLAPSED_KEY","findPoint","nativeNode","nativeOffset","voidNode","nativeText","textContent","findRange","native","startContainer","endContainer","collapsed","Selection","anchor","focus","isPointOnLeftOfRect","x","rect","isPointOnRightOfRect","isPointOnTopOfRect","y","top","isPointOnBottomOfRect","bottom","isPointHorzInsideRect","isPointVertInsideRect","isPointInsideRect","isPointOnRightOfRectNonStrict","isPointOnLeftOfRectNonStrict","SAME_LINE_THRESHOLD","isRectOnSameLineOfRect","newRect","smallerHeight","height","overlap","max","APPROXIMATE_THEREHOLD","approximateEqual","isRectOnLeftOfRect","newContentNode","prevClosestRect","contentRect","compareDocumentPosition","contentNode","DOCUMENT_POSITION_FOLLOWING","isRectOnRightOfRect","DOCUMENT_POSITION_PRECEDING","isRectOnTopOfRect","isRectOnBottomOfRect","getHorzDistance","getClosestAncestorWithBiggerHorizontalRect","getBoundingClientRect","parentRect","getSeletableBlocksFromElement","edgeSelectableAncestor","edgeSelectableDescendants","querySelectorAll","descendant","getRectsFromElement","isNonSelect","elementParent","targetElement","cangjieLeafs","cangjieLeaf","contentRects","getClientRects","cangjieVoids","cangjieVoid","findClosestRectsInElement","closestBelow","closestLeft","closestRight","closestTop","exactTarget","prevExactBelow","newExactBelow","prevDistance","newDistance","prevExactTop","newExactTop","binarySearchOffset","mouseX","mouseY","rangeStart","rangeEnd","textLength","range","createRange","floor","setStart","setEnd","error","width","offsetStart","offsetEnd","textUtils","rangeRects","r","caretPointFromTargetAndCoord","eventTarget","adjustedX","adjustedY","parentStyle","getComputedStyle","parentLeft","marginLeft","parentRight","marginRight","closestLeftEdge","closestRightEdge","round","nextTextNode","nextElementSibling","querySelector","firstChild","previousElementSibling","leafContent","caretRangeFromTargetAndCoord","shadowRoot","editableRect","root","getRootNode","adjustedTarget","elementFromPoint","nodeKey","pointProperties","ROOT_TO_CONTROLLER","CONTROLLER_TO_KEY_DOM","getElementByCangjieKey","KEY_DOM","Map","findDOMNodeSafely","findDOMNode","findDOMLeaves","findDOMPoint","findDOMRange","isCollapsed","convertToTextPoints","ownerDocument","domStart","domEnd","startVoidNode","getClosestVoid","domNode","setStartBefore","endVoidNode","setEndAfter","console","getAroundRects","prevPoint","nextPoint","domPoint","prevDomPoint","nextDomPoint","firstRange","secondRange","firstRects","secondRects","firstRect","secondRect","findRectsInEdgePoint","DOMRect","isPointAtEdge","findRectFromPoint","isHanging","isAfterNewLine","isAtEdge","edgeRects","domRange","cache","cacheLocalCaret","wrapper","caret","getLocalCaretPos","getLocalCaretPosDetail","shouldBeHangingByVertically","to","fromPos","isCoordAtLeftSide","clientX","articleDom","correctPointInsideInlineOrBlock","query","iterateTextNodesFromPoint","at","atNode","goDeep","iteratePositionsFromPoint","unit","step","nextCharStep","shouldCountStartPoint","lastBlock","getEdgePoint","isAtEntrance","closestBlock","getClosestSelectableBlock","firstText","lastText","edgeText","isTextAtEdge","nodePoint","pointAtDistance","distance","remaining","pt","pointAtNodeEdge","pointAtStartOfNode","pointAtEndOfNode","targetNode","furthestBlock","getFurthestSelectableBlock","getTrueRectFromPoint","closestVoid","rangeRect","getUpsidePoint","lockedX","rectX","currentBlock","currentBlockDOM","currentLeafDOMs","e","leafDOM","blockRects","blockRectsLength","blockRect","getUpsideRange","getStart","moveToStartOfDocument","nextIsHanging","newRange","moveAnchorTo","moveToAnchor","setHanging","getDownsidePoint","getDownsideRange","moveToEndOfDocument","SelectionTrigger","IS_COLLAPSED_CACHE","IS_FORWARD_CACHE","isSelection","shrinkBoundary","ignoreEnd","getEnd","isForward","targetRange","targetEndText","beforeStartText","targetStartText","maybeSelection","isRangeSelection","isValidSelection","anchorNode","focusNode","isAnchorValid","isFocusValid","isValidRangeSelection","selectWordAtPoint","rangSelection","isExpanded","JSON","stringify","plainViewKey","isForwardInDocument","anchorPath","focusPath","DOCUMENT_TO_IS_FORWARD_CACHE","isBackward","getPoint","pointName","sort","startNode","endNode","getClosestNode","isCollapsedAtEdge","moveToEnd","moveStartToStartOfNode","moveAnchorToStartOfNode","moveFocusToStartOfNode","moveStartToEndOfNode","moveAnchorToEndOfNode","moveFocusToEndOfNode","moveEndToStartOfNode","moveEndToEndOfNode","moveFocusTo","flip","moveAnchorBackward","mover","moveAnchorForward","moveFocusBackward","moveFocusForward","moveToFocus","moveToStart","moveToRangeOfNode","updatePoints","moveStartBackward","moveStartForward","moveEndBackward","moveEndForward","move","movePointEdgeKlass","PName","toUpperCase","Edge","newSelection","movePointEdgeSideKlass","side","Side","Klass","getDirectionNode","updater","Document","isDocument","maybeDocument","getMarksAtRange","getMarksAtPosition","getActiveMarksAtRange","startMarks","endMarks","currentMarks","getInsertMarksAtRange","getNodesAtRange","doc","startPath","endPath","startIndex","endIndex","startBlock","endBlock","pushEdgeNode","ans","rootKey","rootIndex","getClosestVoidByPath","hasVoidParent","hasVoidParentByPath","getFurthsestVoid","getFragmentAtRange","startTextPath","endTextPath","startVoid","endVoid","targetPath","targetPosition","mode","getLeafBlocksAtRange","blocks","getRootBlocksAtRange","isNodeInRange","isNodeInRangeByPath","isBeforeStart","isAfterEnd","getTextsAtRange","getLeafInlinesAtRange","exists","getRootInlinesAtRange","inline","includes","defaultMergeData","Injection","isInjection","mergeData","maybeInjection","injectIntoNode","injections","injection","movePointForward","curry","pn","movePointBackward","movePointWordBackward","placeholder","movePointWordForward","isSelectionInNode","getFirstDataElementPath","view","viewElement","getLastDataElementPath","endElement","getCroppedSelection","visibles","enableVirtualize","validVisibles","visible","selectionStartPath","selectionEndPath","visibleStartKey","visibleEndKey","visibleStart","visibleEnd","selectionStart","selectionEnd","sel","getSiblingTextPoint","isPrev","correctPointAtInlineEdge","correctPointInVoid","isStart","isFocused","setIsFocused","blur","select","applyOperation","SetSelection","userSelect","paramAnchor","paramFocus","correctedSelection","command","moveAnchorToKey","moveAnchorToStartOfBlock","moveAnchorToStartOfPreviousBlock","moveAnchorToEndOfNextBlock","moveFocusToKey","moveToKey","moveFocusWordBackward","moveFocusWordForward","moveFocusToEndOfText","moveFocusToStartOfBlock","moveFocusToEndOfBlock","moveFocusToStartOfDocument","moveFocusToEndOfDocument","moveToEndOfPreviousBlock","moveStartToEndOfPreviousBlock","moveToEndOfNextBlock","moveEndToEndOfNextBlock","moveToEndOfInline","moveEndToEndOfInline","moveToRangeOfDocument","moveToStartOfInline","moveStartToStartOfInline","moveToStartOfBlock","moveStartToStartOfBlock","moveToEndOfBlock","moveEndToEndOfBlock","moveStartToStartOfPreviousBlock","moveToEndOfPreviousText","moveStartToEndOfPreviousText","moveToStartOfNextText","moveEndToStartOfNextText","moveToStartOfPreviousBlock","moveToStartOfNextBlock","moveEndToStartOfNextBlock","moveWordBackward","moveWordForward","removeNodeByKey","removeNodeByPath","oldDoc","mapPoint","RemoveNode","removeTextByKey","removeTextByPath","updated","decs","isAtomic","setDecorations","removals","cursor","startCursor","endCursor","RemoveText","op","moveNodeByKey","moveNodeByPath","MoveNode","deleteExpanded","del","deleteExpandedAtRange","newDocument","PREFIX","splitTpl","splitDescendantsByKey","textKey","textOffset","textPath","splitDescendantsByPath","splitNodeByPath","elements","dropWhile","withoutNormalizing","splitNodeByKey","withOpContext","withoutTracking","insertNodeByPath","valueToUpdate","updatedValue","setValue","clearOperations","insertNodePath","moveNodePath","splitBlock","depth","splitBlockAtRange","isAtBefore","insertEmptyBlock","nextBlock","splitInline","splitInlineAtRange","Infinity","insertBlockTpl","insertInlineTpl","insertTpl","insertNodeByKey","insertPath","InsertNode","isBlockEmpty","ms","insertTextAtRange","newBlock","insertIndex","focusText","insertTextByKey","insertTextByPath","InsertText","insertBlockAtRange","startInline","atEnd","siblingText","splitRange","insertBlock","blockProps","insertInlineAtRange","insertInline","inlineProps","findInsertionNode","fragment","hasSingleNode","fragmentInner","documentInner","documentNode","insertFragmentByKey","insertFragmentByPath","insertFragment","startAncestors","insertFragmentAtRange","updatedTexts","newTexts","lastNewText","blockParent","nextText","subText","offsetToEnd","GraphemesBreaker","firstChildHasBlockChildren","isAtStartOfUnEmptyNode","subRoot","insertFragmentWithRealKeyAtRange","startChild","isAtStart","isAtEnd","lastChild","firstBlock","insertionNode","userData","mergeUserData","lastChildHasBlockChildren","rest","lonelyParent","lonelyChild","excludingLonelyChild","newIndex","nextChild","nextNodes","insertAt","restBlock","inlineChild","inlineIndex","mergeTpl","mergeNodeByKey","mergeNodeByPath","original","addMarkAtRange","activeMarks","addMarkByKey","addMarkByPath","bx","by","ax","ay","AddMark","addMarksAtRange","toggleMark","toggleMarkAtRange","removeMarkAtRange","removeMarkByKey","removeMarkByPath","totalOffset","leafLength","RemoveMark","replaceMark","oldMark","deleteAtRange","detectSelection","isCrossBlock","isStartVoid","isEndVoid","ancestorNodes","endChild","middles","startVoidAncestor","endVoidAncestor","prevText","startParent","startParentIndex","endParentIndex","lonely","takeRightWhile","isEmptyParagraph","nextStart","nextEnd","deleteBackwardAtRange","deleteEdge","isToDelete","siblingBlock","voidParent","updatedSelection","updatedAnchor","deleteForwardAtRange","deleteBackward","deleteForward","createDeleteBoundry","dir","deleteBoundray","getBoundaryOrIteratePositionsFromPoint","defaultBoundary","boundary","deleteBoundrayBackward","deleteBoundrayForward","deleteCharBackward","deleteCharForward","deleteWordBackward","deleteWordForward","deleteLineBackward","deleteLineForward","replaceNodeByKey","replaceNodeByPath","replaceTextByKey","oldText","replaceTextByPath","mergedMarks","setNodeByKey","setNodeByPath","prevNode","SetNode","setBlocks","setBlocksAtRange","startNodeKey","endNodeKey","allBlocks","setInlines","setInlinesAtRange","setMarkByKey","setMarkByPath","SetMark","setTextByKey","setTextByPath","wrapInlineTpl","wrapText","prefix","suffix","wrapTextAtRange","startRange","endRange","wrapBlock","wrapBlockAtRange","firstblock","lastblock","siblings","indexes","ind","wrapBlockByKey","wrapBlockByPath","wrapInline","wrapInlineAtRange","inlineParent","wrapInlineByKey","endInline","inlinekey","rng","startInner","startInnerIndex","endInner","startInlines","endInlines","wrapInlineByPath","unwrapBlockTpl","unwrapTpl","unwrapBlock","unwrapBlockAtRange","wraps","values","wrappers","children","firstMatch","lastMatch","newChild","extra","unwrapBlockByKey","unwrapBlockByPath","unwrapInline","unwrapInlineAtRange","unwrapInlineByKey","unwrapInlineByPath","unwrapNodeByKey","unwrapNodeByPath","parentIndex","grandPath","isFirst","isLast","updatedPath","DATA_CLIPBORAD_CANGJIE","SLASH_PLACEHOLDER","isFileMimeType","mime_type","readClipboardDataFromHtml","html","domparser","DOMParser","parseFromString","clipboardDataNode","clipboardData","body","firstElementChild","attributes","item","nodeName","startsWith","mimeType","replace","RegExp","getClipboardData","dataTransfer","CangjieDataTransfer","nav","clipboard","read","Promise","reject","clipboardItems","clipboardItem","types","blob","getType","file","File","setData","customData","resolve","err","CustomDataTransfer","dropEffect","effectAllowed","files","img","items","xOffset","yOffset","dragX","dragY","clearData","getData","format","toAdd","kind","Blob","setDragImage","PolyfillDataTransfer","getPrototypeOf","CangjieClipboardEvent","nativeEvent","event","CustomEvent","assign","setClipboardData","CangjieSelectEvent","detail","defaultLocale","copy","cut","selectAll","paste","pasteTips","getTransferType","getEventTransfer","encodedFragment","decodeFragment","biz","FRAGMENT_MATCHER","exec","encoded","fs","getAsFile","encodeFragment","btoa","encodeURIComponent","decoded","decodeURIComponent","clip","createClip","createElement","setAttribute","ClipboardManager","callback","isFileData","dataEntries","entries","clipManager","writeFile","succeeded","action","finally","write","copyFragment","imageTypes","imgData","isEmptyObj","omitEmptyObj","omitBy","omitDeepBy","nextObj","forOwn","isObject","createClipboardDataFromSelection","uid","withUserData","acc","originData","nextData","_ref","Copy","Cut","Paste","Select","SelectAll","ACTION_COPY","Symbol","ACTION_COPY_FAIL","ACTION_CUT","ACTION_CUT_FAIL","ACTION_PASTE","ACTION_PASTE_FAIL","ACTION_SELECT","ACTION_SELECT_ALL","execCommandPolyfill","maybeHiddenTextArea","activeElement","hiddenTextAreaOriginValue","hiddenTextAreaOriginStart","hiddenTextAreaOriginEnd","HTMLTextAreaElement","execCommand","isBlurred","Commands","flush","pasteMenu","locale","name","role","icon","hotKey","mobile","contextMenu","configs","plugins","menus","readOnly","canCopy","isReadMode","disable","isByTable","group","others","handleAction","run","payload","customEvent","dataType","isShortcut","isPasteEnable","then","onAction","models","useScroll","onStart","onEnd","timeout","isStarted","handleScrollEvent","clearTimeout","setTimeout","addEventListener","removeEventListener","findHangingPosition","originLength","detectRange","detectRects","secondLastRect","lastRect","getTextContentLength","childNode","findTextNodeAtOffset","remainedOffset","childNodes","textContentLength","TEXT_NODE","findEdgePointPosition","maxEdgeHeight","zoom","heightWithZoom","clientLeft","clientTop","findTextPointPosition","preferredEdge","nextLeaf","leafKey","apply","firstRangeRect","lastRangeRect","hangingPosition","detectOffset","rects","followingRect","findCaretPosition","ARROW_SIZE","POPUP_MIN_SPACE","TOP_SAFE_SPACE","getSelectionRect","domRects","getCaretRect","getPopupPosition","popupWidth","popupHeight","defaultTop","isTop","innerHeight","arrowOffset","offsetX","innerWidth","useSelectionData","selectionData$","onSelectionData","deps","subs","blocksKeys","isHideSelection","isSelected","useSelectionDataAtTheStartOfNextFrame","onSelectionDataNextFrame","pendingData","ITEM_HEIGHT","POPUP_HEIGHT","POPUP_BOTTOM_EXTRA_HEIGHT","wrapperStyle","zIndex","backgroundColor","padding","borderRadius","display","flexDirection","opacity","transition","itemStyle","lineHeight","color","minWidth","fontSize","alignItems","justifyContent","whiteSpace","overflow","iconStyle","marginBottom","arrowStyle","arrowStyleTop","ContextMenu","hidePopup","setPosition","useState","rootRef","updatePosition","setNodeVisible","style","buttons","groupA","groupB","styleForWrapper","button","stopPropagation","preventDefault","availableButtons","btn","styleForArrow","Icon","ReactDOM","createPortal","ZoomContext","createContext","ExternalZoomContext","ZoomContainerContext","useZoom","useExternalZoom","useZoomContainer","WIDTH","HEIGHT","ZOOM","POPUP_EXTRA_TOP","POPUP_EXTRA_BOTTOM","rootStyle","background","border","boxShadow","blockContainerStyle","backfaceVisibility","transformOrigin","cleanNode","attr","removeAttribute","clearNode","removeChild","Zoomer","pros","container","cachedBlocks","blockRef","blockNode","pointPosition","dom","maybePrevDom","prevDom","nextDom","prevArticleBlock","cloneNode","nextArticleBlock","articleBlock","domRect","marginTop","offsetY","prevStyle","prevMarginTop","prevMarginBottom","focusedSelection","popupPosition","appendChild","extraOffset","attachNode","MAX_LINE_HEIGHT","EXTRA_BOTTOM_OFFSET","findScrollableContainer","scroller","overflowY","getScrollableContainerInfo","isWindow","documentElement","visualViewport","_visualHeight","scrollerTop","scrollerLeft","scrollerBordersY","scrollerBordersX","scrollerPaddingTop","scrollerPaddingBottom","scrollerPaddingLeft","scrollerPaddingRight","viewportHeight","pageYOffset","pageXOffset","offsetWidth","offsetHeight","scrollTop","scrollLeft","borderTopWidth","borderBottomWidth","borderLeftWidth","borderRightWidth","paddingTop","paddingBottom","paddingLeft","paddingRight","scrollerRect","getDOMRectFromSelection","collapsedSelection","cursorRect","scrollToSelection","inlineDOM","inlineRect","cursorTop","cursorLeft","inView","quaterHeight","isHugeElement","partInView","deltaY","scrollTo","behavior","stateMap","THROTTLE_MOVE","SPEED_PIXEL","MAX_SPEED","BOTTOM_EXTRA_HOT_SIZE","TOP_EXTRA_HOT_SIZE","scheduleScroll","params","speed","state","cancelSchedule","px","newSpeed","timer","startScroll","stopScroll","throttle","clientY","TouchEvent","touches","topOffset","bottomOffset","isScrolling","ScrollableContainerContext","useScrollableContainer","HANDLE_WIDTH","HANDLE_DOT_SIZE","HANDLE_TOUCH_SIZE","TYPE_START","TYPE_END","cursorStyle","handleRectStyle","handleRectTop","handleRoundDotStyle","handleRectTopStyle","isPointVisible","pElement","scrollWidth","pRect","updateHandlePosition","loc","blockEvent","caretRangeFromPoint","docNode","ele","Handle","forwardRef","onDrag","onDragStart","onDragEnd","isHidden","handleTouchStart","stopImmediatePropagation","handleTouchEnd","handleDrag","touchMoveRef","passive","capture","Handles","enableZoomer","scrollableContainer","startRef","endRef","outsideScoller","nodeRef","visibility","posStart","posEnd","pairs","optimizeVerticalPosition","orginalY","friendNode","friendRect","friendY","touchPoint","targetPoint","voidRect","voidCenterX","trigger","dragging","setDragging","cancel","dragProps","draggingPoint","propsSelection","setSelection","ACTION_CLEAR_MOBILE_MENU","getDraggingSelection","_mobileDraggingSelection","showPopup","prevRange","getPopupSelection","_mobileFocusedSelection","touchCount","createMobilePlugin","onTouchStart","onMouseDown","renderContent","contextData","shouldRenderH5Controls","isDisabled","isInFocusedSelection","isInRenableSelection","shouldRenderContextMenu","shouldRenderHandles","renderCaret","isDragging","cloneElement","createQueriesPlugin","qrys","queries","onQuery","qry","args","createRenderNodePlugin","renders","renderNodes","renderNode","prevArgs","currentArgs","fn","createCommandsPlugin","cmds","commands","onCommand","cmd","klassToIsType","validateKlass","rule","isType","validateType","validateFirst","validateRules","validateLast","validateParent","rules","testRules","validatePrevious","validateNext","validateNodes","defs","lastCount","def","nextDef","shift","rewind","limit","lastMin","defaultNormalize","isOnlyContainsVoidAndEdgeSelectable","isOnlyContainsAtomic","createNormalizationPlugin","schema","schemaRules","isAtomicDict","isVoidDict","isEdgeSelectableDict","isSideSelectableDict","isVoid","isEdgeSelectable","isSideSelectable","predict","validateNode","normalizeNode","$document","isInlineOrText","createCoreSchemaPlugin","BATCH_UNDO_MERGE_TIME","shouldClear","shouldMerge","prevOp","shouldOverwrite","History","redos","undos","lastUndoCreatedTime","maxHistorySize","moveLastRedoRecordToUndos","newRedos","lastRedoRecord","newUndos","moveLastUndoRecordToRedos","undoRecord","lastUndoRecord","mergeToLastUndoIfNeed","forceMerge","lastBatch","lastOp","overwrite","Date","now","batch","HOTKEYS","bold","compose","moveUpward","moveDownward","extendBackward","extendForward","extendUpward","extendDownward","italic","undo","space","enter","tab","APPLE_HOTKEYS","moveLineBackward","moveLineForward","moveBlockBackward","moveBlockForward","moveToDocumentStart","moveToDocumentEnd","extendWordBackward","extendWordForward","extendLineBackward","extendLineForward","extendBlockBackward","extendBlockForward","extendToDocumentStart","extendToDocumentEnd","redo","transposeCharacter","WINDOWS_HOTKEYS","generic","apple","windows","isGeneric","isKeyHotkey","isApple","isWindows","isBold","isCompose","isSelectAll","isMoveBackward","isMoveForward","isMoveUpward","isMoveDownward","isDeleteBackward","isDeleteForward","isDeleteLineBackward","isDeleteLineForward","isDeleteWordBackward","isDeleteWordForward","isExtendBackward","isExtendForward","isExtendUpward","isExtendDownward","isExtendWordBackward","isExtendWordForward","isExtendLineBackward","isExtendLineForward","isExtendBlockBackward","isExtendBlockForward","isExtendToDocumentStart","isExtendToDocumentEnd","isItalic","isMoveWordBackward","isMoveWordForward","isMoveLineBackward","isMoveLineForward","isMoveBlockBackward","isMoveBlockForward","isMoveToDocumentStart","isMoveToDocumentEnd","isRedo","isSplitBlock","isTransposeCharacter","isUndo","isSpace","isEnter","isCopy","isCut","isPaste","SUPRESS_WITHOUT_SAVING_ERROR","__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","deserializeSelection","deserializeOperation","serializeSelection","createHistoryPlugin","history","withoutSaving","newHistory","reversed","undoOperation","onConstruct","privateApplyOperation","flag","saving","operations","newValue","clearHots","onKeyDown","hotkeys","withoutPending","CURSOR_BLINK_ANIMATION_TIME","CURSOR_STYLE","pointerEvents","willChange","useBlinkAnimation","cursorRef","pointStr","isVisible","caretNode","toggleBackgroundColor","isPending","LocalCaret","composing","isComponentPropsEqual","prevProps","nextProps","isRemote","Caret","onBlur","showCaretOnBlur","onReadOnly","showCaretOnReadOnly","showCaret","CangjieInputEvent","findNode","shoudStopInsideVoid","direciton","isBackwardCase","isForwardCase","directionHit","newPoint","perfMark","performance","perfMeasure","measure","warn","Debug","log","bind","IS_TOUCH_MOBILE","environment","createCorePlugin","decorateNode","injectToNode","onApplyOperation","groupNodes","remainedRange","onCopy","cangjieCopyEvent","onCut","cangjieCutEvent","onPaste","cangjiePasteEvent","onCangjieFocus","onCangjieBlur","onCangjieInput","onCangjieSelect","selectionJSONString","selectionWithData","Selecting","onCangjieCopy","onCangjieCut","onCangjieComposingChange","setComposing","onCangjiePaste","transfer","line","onClick","hotKeys","isProceeded","renderEditable","Tag","renderMark","selectionColor","isEditorBusy","onCleanup","delete","mapOperation","isElementInGroup","createMapOperations","gen","uuidKey","getUUIDs","generateUUID","diff","uuids","newUUID","adds","genUUIDForTree","newRoot","adjustSetNodeOperation","prevData","theUUID","thePrevUUID","prevUUID","reset","with","P","nullish","not","removes","updates","when","id","oldUUID","otherwise","adjustRemoveNodeOperation","adjustInsertNodeOperation","createUUIDQuery","createGetNodeKeyByUUID","getUUIDS","getNodeKeyByUUID","getUUIDSFromDocument","duplications","desendant","toKeyUUIDMap","diffUUIDS","aKeyToUUIDMap","bKeyToUUIDMap","aUUID","bUUID","isEmptyDiff","UPDATE_UUIDS","GENERATE_UUID","updateUUIDs","isUpdateUUIDs","isGenerateUUID","actions","isActions","setNodeUUID","createGenerateUUID","isActionFactory","DEFAULT_UUID_KEY","createUUIDPlugin","config","regenerateDuplicateUUIDS","newUUIDS","ids","dispatch","createMapOperation","onResetValue","TOGGLE_GROUP_FOLD","FOLD_GROUP","EXPAND_GROUP","toggleGroupFold","fold","expand","groupManager","getGroup","mergeGroupData","renderGroup","_value","_controllerValue","generateAllGroups","notifyNewGroups","createGroupPlugin","Status","DEFAULT_FLUSH_TYPE","FLUSH_MAX_WAIT","IS_SUPPORT_IDLE_TASK","IS_SUPPORT_FRAME_TASK","resolveSupportedType","flushType","FlushTask","task","status","Idle","resolved","supportedFlushType","taskId","Pending","requestTask","Canceled","cancelTask","getStatus","requestIdleCallback","cancelIdleCallback","Done","isRangeStart","isRangeEnd","isEdgeAfter","edgePoint","edgePath","nodePath","isEdgeBefore","order","getChildrenDecorations","childrenDecorations","orderArray","decoration","startPoint","endPoint","activeDecorations","Set","getChildrenIsSelected","childrenIsSelected","getChildrenInjections","childInjections","injects","CONTEXT_SPLIT","getContexts","getContextMeta","matched","Observable","linkHead","observer","onData","Subject","ReplaySubject","replays","isSetSelection","getSelectionData","isSelect","ops","getPending","effect","pattern","isInsertTextOperation","isRemoveTextOperation","isInsertOrRemove","isSetSelectionOperation","isContinuousOp","isContinuousInput","operationsWithoutComposing","isTextInput","shouldAppend","prevOps","decorate","ctx","inputData$","cond","textInputPattern","selectionPattern","stubTrue","PendingQueue","pending","pendingGetter","debouncedFlush","enablePending","clear","debounceTime","shouldDebouncedFlush","queue","dispatchPendingTerminal","setInjection","curInjection","inj","setInjections","deleteInjection","omit","nextInjections","UserDataManager","update$","localData","updateNodes","refreshData","targetData","nData","uData","lData","mergeProperties","setLocal","deleteProperties","deleteLocal","uids","deleteData","PerfType","CangjiePerfEvent","dropped","isTextOp","getHotAmongNodes","srcNodes","newDoc","srcNode","getHotsAtRange","afterChangeDoc","ancestorPath","getOpHots","beforeChangeDoc","SplitNode","MergeNode","difference","isExistedHot","searchTable","ancestorsAndSelf","getHots","srcOps","uniq","prevDocument","prevSelectionIn","prevSelectionInPath","selectionIn","selectionInPath","hot","_e","FIELD_SHOULD_NOT_BREAK_PENDING","isInputing","opsLen","isSelecting","isComposing","shouldDebounceFlush","shouldSuppressFlush","EVENTS_SET","isEventHandler","DEFAULT_BUFFER_RANGE","BLOCK_DEFAULT_MIN_HEIGHT","DEFAULT_SCROLL_THROTTLE_INTERVAL","DEFAULT_FIRST_PAINT_BLOCK_SIZE","waitForElementByAnimationFrame","remain","cost","nextRemain","catch","scrollContainerIsTop","scrollContainer","checkArrayAHasElementNotIncludedInArrayB","arrayA","arrayB","arrayAElement","formatMarginFromStyle","margin","parseFloat","isNaN","measureBlockInfo","boundingClientRect","computedStyle","calculateViewPort","scrollElement","bufferRange","editorContainerToScrollContainerDistance","_viewPortStartY","viewPortStartY","viewPortEndY","bufferStartY","bufferEndY","calculateEditorContainerToScrollContainerDistance","editorContainer","scrollContainerIsBody","editorContainerRect","scrollContainerRect","editorContainerStyle","calculateExpectedLayoutInfo","viewStartY","nodeManager","nodeSize","accHeight","lastMarginBottom","expectedBufferStartBlockFound","expectedViewStartBlockFound","expectedBufferEndBlockFound","expectedBufferStartBlockOffset","expectedViewStartBlockOffset","expectedBufferEndBlockOffset","expectedBufferStartBlockY","expectedViewStartBlockY","expectedBufferEndBlockY","cachedBlockProps","getCachedBlockPropsByKey","inputHeight","inputMarginTop","inputMarginBottom","lastAccHeight","calculateBlockStartYByBlockIndex","blockIndex","includeLastMarginBottom","fastDiffOnValueChange","prevView","currView","startBlockKey","startBlockOffset","endBlockOffset","oldStartKeyNewPath","startKeyOffsetChange","prevBlock","currBlock","calculateBlockKeysNeedToMeasure","_prevView","layoutInfoResult","prevLayoutInfoResult","prevExpectedBufferStartBlockOffset","prevExpectedBufferEndBlockOffset","prevVisibleKeys","currentVisibleKeys","newBlockKeys","NodeManager","blockCacheByKey","blockKeyQueue","gc","viewTopBlockLength","gcBlockKeyQueue","setCachedBlockPropsByKey","blockInfo","prevBlockInfo","loadMeasureResult","measureResults","persistStateNode","measureResult","getVirtualizePersistState","blockCache","updateVirtualizePersistState","topBlockKey","shouldPersistState","keyIndex","OutputManager","firstPaintBlockSize","endBlockKey","startViewBlockOffset","beforePlaceholderHeight","afterPlaceholderHeight","setStartEndInfoByOffset","setPlaceholderHeight","precheckOutputByLayoutInfo","calculatePlaceholderHeight","calculateVisibles","loadCalculateLayoutInfo","expectedBlockStartY","expectedBlockEndY","visibleBlockKeys","blockFinalVisibleStates","findTextNode","findCurrentDOMRange","findRangeByEvent","getDOMRects","leafContents","voidContents","specialCodes","addRect","codeNode","splitRows","blockDOMNode","extendToFill","linesRects","newRow","rows","sortIntoRows","insertRow","row","fitRows","offsetRect","newRects","mergeRects","sortedRects","pop","getSelectionLayers","layerFor","getCaretDom","layers","layer","findSelectionSlot","containerKey","containerDOM","scrollToNodeByPath","preventScrollWhenNodeIsVisible","doNothingWhenVirtualizeDisabled","topBlock","virtualizeManager","isNodeVisible","viewInitialized","waitUntilViewInitialized","workflowToScrollToNode","nodeElement","scrollIntoView","scrollToNodeByKey","RESIZE_DEBOUNCE_TIME","ViewManager","scrollListenerElement","scrollHandler","scrollInterval","resizeHandler","resizeObserver","scrollHistoryArray","throttledScrollListener","triggerViewUpdate","prevViewPortStartY","scrollListener","timestamp","valueOf","scrollHistory","updateEditorContainerToScrollContainerDistance","updateViewPort","initScrollListener","destroyScrollListener","initResizeObserver","ResizeObserver","handleResize","detroyResizeObserver","addResizeObserverByKeys","blockKeys","blockKey","blockElement","addResizeObserver","observe","removeResizeObserver","unobserve","measureCurrentViewBlocks","documentKey","cangjieKey","measuredInfo","measureBlocksByKeys","measureTasks","promise","scrollToNodeByIndex","startY","totalStartY","VirtualizeManager","isActive","_isActive","outputManager","viewManager","virtualizeId","currentLockedVirtualizeId","setViewInitialized","initViewWorkflow","currentVirtualizeId","setVirtualize","flushVirtualize","nextMeasureResult","coreWorkflow","triggerReRenderActively","measureOnly","shouldAddLock","checkLocked","needToReRender","needToStartNextWorkflow","lock","unlock","newAfterPlaceholderHeight","newBeforePlaceholderHeight","newVisibles","workflowByCurrentViewPort","newVirtualizeId","nodeIndex","workflowOnValueChange","diffResult","resizedNodeEntries","entry","CDocument","hidden","nodeProp","resizedBlockKeys","initView","InitViewOptions","stop","GroupManager","groups","groups$","CACHE","NODE_GROUP","cleanup","getGroups","force","setGroupData","generateGroup","initGroups","getNodeGroups","elementGroup","groupElement","regenerateGroup","operationWithValue","prevGroup","removeGroup","regenerateGroupFrom","oldNode","currentGroup","nodesInGroup","getNodesInGroup","closestGroup","maybeGroup","getInsivibleNodes","invisibles","topHalfInvisibles","takeWhile","bottomHalfInvisibles","jsonMLGetDescription","asl","currParagraph","jsonMLGetChildren","validChildren","childAsl","maxParagraph","ignore","jsonMLGetTagNameAndAttributes","jsonMLGetTagName","elem","maybeElem","isAttributes","maybeAttrs","jsonMLGetLastChild","JsonMLHasAttributes","jsonMLGetAttributes","jsonMLAppend","jsonMLAppendAt","meta","ch","jsonMLIsEmptyContent","grandChildren","grandChild","grandChildAttrs","grandGrandChildren","grandGrandChild","grandGrandChildAttrs","jsonMLGetText","jsonML","jsonMLIsText","isElementValue","isDocumentValue","nodeMapToObject","styleObj","toStyleObject","styleStr","output","kv","camelCase","trim","normalizeSpacesInHTML","createTextWithString","createEmptyText","createEmptyParagraph","createJsonMLToValue","jsonMLToNode","strictSchema","jsonMLToValue","newJsonML","Value","strict","toNormalize","schemaPlugin","Controller","createAsyncValueToJsonML","asyncNodeToJsonML","valueToJsonML","createValueToJsonML","nodeToJsonML","createJsonMLToNode","plugin","convert","safeAppend","createAsyncNodeToJsonML","decorated","asyncConvert","createNodeToJsonML","MeasureStyle","createIframe","iframe","DomParser","domParser","skipTags","onOpenTag","onText","onCloseTag","init","chunk","contentDocument","innerHTML","htmlDom","traverse","DOCUMENT_NODE","DOCUMENT_FRAGMENT_NODE","tagName","originTagName","traverseChildNodes","toLowerCase","uuidv1","currentDom","State","stack","marksList","listsList","currentListId","currentListLevel","removeMarks","wrapList","unwrapList","isParentOrderedList","getListItemLevel","append","peek","isStackEmpty","getJsonML","Deserializer","htmlFrom","parser","isDomParser","deserialize","htmlToJsonML","onEvent","ok","decodeEntities","MS_WORD","MS_EXCEL","MS_OFFICE","MS_OFFICES","YUQUE","REMAIN_STYLE_SOURCES","isMicrosoftWord","isMicrosoftExcel","isMicrosoftOffice","isYuqueDocs","getHtmlFrom","getJsonMLFromAttr","createHtmlToJsonML","parsedDocument","domJsonML","deserializer","parsedHTML","lastElementChild","outerHTML","jsonMLToHTML","elementWithKey","toString","HTMLProvider","createJsonMLToHTML","defaultRules","contentJsonMLToHTML","hooks","ReactDOMServer","renderToStaticMarkup","createTextToJsonML","textToJsonML","paragraph","createNodeToText","valueToText","nodeToText","createValueToText","injectValueData","v","injectedValue","endsWith","markdownRuleNameMap","blockquote","hr","list","heading","codespan","strikethrough","emphasis","image","createMarkdownToHTML","markdownToHTML","ruleName","xhtmlOut","MarkdownIt","default","md","summary","names","rewrite","uses","createRenderer","renderer","enable","pluginLoader","use","markdown","render","createHtmlToMarkdown","htmlToMarkdown","Turndown","turndownService","headingStyle","pluginRule","pick","addRule","turndown","defaultBlock","createSerializerPlugin","createSchema","prevSchema","schemas","oldSchema","val","documentSchema","createStrictSchema","blockTypes","inlineTypes","SIMPLE_SPACE_CODE","BREAK_CODE","HEAD_TAG_REG","paragraphTags","h1","h2","h3","h4","h5","h6","div","section","normalizeMarks","normalizeTextUtil","createHTMLToJsonML","htmlToAttrs","converts","f","generateMarks","tag","pasteFrom","prevSibling","parentTagName","isPhantom","phantom","txt","parentType","leafAttrs","prevLeaf","attrsToMarks","handledKeys","rst","restKeys","markData","isObj","attrToMarks","NON_BREAKING_SPACE_CODE","createLeafToElement","jsonMLAttrsToStyles","attrToStyle","inlineCode","leafToElement","marksToAttrs","textMark","len","markToAttrs","htmlToJsonMLAttrs","jsonMLAttrsToStyle","jsonMLAttrsToMarks","markToJsonMLAttrs","createBase","documentFactory","textFactory","createText","base","beforeValueToText","textToValue","createHtml","htmlToValue","valueToHTML","createAsync","asyncValueToJsonML","createMarkdown","hs","markdownToJsonML","jsonMLToMarkdown","markdownToValue","baseSerialzer","textSerializer","htmlSerializer","mdSerializer","asyncSerializer","getSchemaAndPluginsFromMoPlugins","serializerPlugins","serializer","createSerializerOld","createBaseSerializer","createSerializer","Parser","isInSkipTag","callbacks","createHtmlParser","onopentag","ontext","onclosetag","open","BorderStyleEnum","PageBorderDisplay","PageBorderOffsetFrom","PageBorderZOrder","useControllerStatic","FieldsNotAffectSpace","OperationsNotAffectSpace","isSetValueNotAffectSpace","isOperationNotAffectSpace","getDirtyKeysFromOperation","opNode","opNodeKey","nextKey","oldAncestors","newAncestors","getDirtyKeysFromElementDiffStrictly","prevElement","curIndexKey","preIndexKey","dirtyKeys","prevChild","preChildIndexKey","getDirtyKeysFromElementDiff","composingMark","defaultScrollType","insertComposingIntoLeaves","beforeLastLeaf","beforeLastMarks","decorationsMarks","activeDecorationsMarks","shouldConcatBefore","shouldConcatAfter","DEFAULT_VIRTUALIZE_OPTIONS","enableOnDemandViewCalculation","pendingDebounceTime","invisibleCalculationDebounceTime","maxOPsForHotsAnalyze","disableViewVirtualize","$value","$operations","registerPlugin","pluginSchema","prevQuery","nextQuery","handlers","normalizing","tracking","withCommand","destroyed","perf","scrollType","opRelatedId","VIEW_CACHE","VALUE","WeakSet","ELEMENT","DECORATED_ELEMENT","INJECTED_ELEMENT","GROUPED_ELEMENT","LEAVES","DECORATE_NODE","INJECT_TO_NODE","DATA","INJECT_TO_VIEW_ELEMENT","INJECT_TO_VIEW_TEXT","IS_SELECTED","VIEW_NEVER_CALCULATED","terminal$","baseSerializer","$viewDoc","$scrollableContainer","$operationWithValues","onChange","flushTask","autoFocus","hideSelectionOnBlur","testType","onBusyStateChange","pendingQueue","virtualizeOptions","debouncedStartInvisibleCalculationScheduler","onPending","uuidConfig","lengthOfPending","forceRecalculate","virtualize","invisibleCalculationId","visibles$","setValueField","startInvisibleCalculationScheduler","scheduleInvisibleCalculation","deadline","runInvisibleViewCalculation","timeRemaining","didTimeout","calculateInvisibleView","invisible","docInjections","docDecorations","toViewElement","toView","viewDocument","prevDecorations","prevInjections","prevComposing","newViewDocument","calculateViewInVisibleNode","parentVisible","dataUid","setUid","change","__pendingQueue__","createContextMenuPlugin","setReadOnly","normalizeDirtyKeys","normalizeSelection","beforeSetValue","scheduleFlush","resetValue","controllerValue","fns","prevWithCommand","perfClearAll","flushContext","suppressed","debounced","setHots","isPendingEnable","transformDirtyKey","operationNode","extraDirty","opWithContext","beforeApplyValue","dirtyKeysFromOp","normalizeNodeByKey","iterations","childrenLength","groupedNodes","isChildrenGrouped","remained","maybeNestedGroup","lastGroup","toViewText","isCollapsedInText","cachedViewLeaves","cachedDepDecorations","viewLeaves","hasComposingLeaf","cachedViewText","cachedDepLeaves","viewText","isCollapsedInElement","isCollapsedInEmptyElement","computedComposing","nodeDecorations","allDecorations","nodeInjections","allInjections","selfInjections","descendantsInjections","decoratedElement","cachedDecoratedElement","cachedDepsData","depsData","childrenInjections","isChildrenDecorated","decoratedNodes","decoratedChild","groupedElement","cachedGroupedElement","cachedViewElement","cachedDepInjections","injectedElement","viewCache","getInjectedViewData","viewNode","dataNode","firstOp","cacheKey","decorationsChanged","injectionsChanged","injectedDecorations","injectedInjections","parentDecorations","parentInjections","docInjects","recalculateView","cachedViewNode","newViewNode","newViewDoc","getView","shouldRecalculate","hasHots","prevNormalizing","prevPending","prevSaving","nextOperationIndex","operationType","prevTracking","warning","creator","destroy","decoratedDocument","groupedDocument","viewDoc","getViewData","setOpRelatedId","shouldResumePosition","shouldScrollToSelection","setScrollType","isTracking","perfStart","subtype","perfEnd","duration","perfDrop","immediately","switchUid","isViewHot","addIsSelected","getIsSelected","removeIsSelected","shouldHideSelectionOnBlur","enableVirtualizeView","hasViewNeverCalculatedInVisibles","visibleBlocks","enableUUID","StyleContext","useStyle","useNodeStyle","docStyle","useContentStyle","Provider","controllerRef","onFirstRender","pluginsRef","onChangeRef","prevValueRef","controllerIns","didMountRef","main","version","Decoration","isDecoration","maybeDecoration","mergeUserProperties","mergedData","mUid","once","getDefaultSelection","isValue","remoteSelections","documentValue","maybeValue","rangeSelection","getElement","anchorBlock","focusBlock","anchorInline","focusInline","anchorText","removed","updateSelections","selections","newAnchor","newFocus","newStart","newEnd","prevDoc","prevInject","injectTargetPath","preserveDecorations","decotation","preserveSelections","preserveInjections","usePendingTerminal","onTerminate","placeholderMarkType","defaultPlaceholerSymbol","placeholderStyle","WebkitUserSelect","innerStyleWithWidth","innerStyle","ContentPlaceholderContext","useContentPlaceholder","defaultPx","FONTSIZE_BIGGER","formatFontSize","szUnit","PlaceholderProvider","placeholderRef","Placeholder","forceUpdate","contentPlaceholderRef","focusKey","needWidth","focusMode","isDefaultPlaceholder","showDefaultPlaceholder","noRender","innerPlaceholderStyle","leave","handlePendingSelectionChange","handlePendingTerminate","createPlaceholderPlugin","isPlaceholderVisible","contentPlaceholderConfig","placeholdersConfig","hasIntersectionObserver","IntersectionObserver","getInstance","instance","elementToHandler","nativeIO","handleIntersectionChange","handler","useElementVisibility","elementRef","defaultVisible","setVisible","isIntersecting","LazyRenderStrategyType","LazyLoadWrapper","PruningManager","selectionUpdator","domUtils","showPrunedElements","PruningWrapper","forceVisible","setIsSelected","setPlaceholderStyle","isElementVisible","prevVisible","placeholderClientRect","DATA_CANGJIE_PERF_PRUNING","ancestorsWithPruning","HTMLElement","createPerfLazyRenderPlugin","strategy","LazyLoad","Pruning","lazyRenderStrategy","factory","defaultConfig","FirstRenderContext","FirstRenderManager","isFirstRenderSlice","firstFrameSize","animationFrameSubject","delayRenderSlices","delays","raf","loop","useShouldMount","shouldMount","setShouldMount","subscription","FirstRenderSlice","createPerfFirstRenderPlugin","Context","useSelectionContext","selectionContext","relativeRect","nodeRect","relativeLeft","useOffsetPosition","caretRef","offsetSeperatorIndex","THROTTLE_TIME_RESIZE","useLeafBlockResizer","updator","useUserData","initValue","euuid","cNode","useGroupData","defaultValue","finalNode","legacyGroupIndex","originalNode","selectorRef","defaultData","groupsMap","makeElementVisible","leftEdge","rightEdge","offsetLeft","offsetRight","horizonOffset","EMPTY_PREFIX","EMPTY_SURFIX","getEmptyValue","EMPTY_TEXT_AREA_VALUE","CHARACTERS_LENGTH_AFTER_USER_INPUT","resetTextAreaValue","textAreaRef","textAreaCacheRef","defaultCaretPosition","diffTextAreaValue","prevTextAreaValue","textAreaValue","prevValueCaretPosition","currentValueCaretPosition","minValueCaretPosition","leftDiffOffset","rawData","cangjieInput","updateComposing","useInputDetector","prevSelectionAfterInput","resetTimer","composingData","dataSelection","prevDataSelection","rangeStartIndex","rangeEndIndex","mismatchLength","delLength","onCompositionStart","onCompositionEnd","keyCode","MULTIPLE_CLICK_DELAY","TAP_HOLD_DELAY","CARET_MOVE_GAP_TIME","MULTIPLE_CLICK_RANGE","getWordSelection","getSelectionAtLine","blockDomNode","scrollToVisible","shouldSelectOnRightClick","useSelectionCalculator","scrollableContainerRef","isJustTapHold","tapHoldTimer","lastSingleClick","time","lastDoubleClick","lastCaretMoveTime","prevSelectionRef","subtypeTriggerMap","selectStart","selecting","isGapTimeTooShort","MoveUpward","MoveDownward","isNextPointAtEdge","MoveBackward","MoveForward","handleNativeSelectionChange","newCaretPosition","onKeyUp","onMultipleClick","MultipleClick","onSelectStart","onSelectUpdate","onSelectEnd","rawRange","isClickAtLeftSide","shiftKey","SelectStart","shouldSelect","onTapHoldStart","onTapHoldEnd","PasteInputEvent","SHOULD_FOLLOW_CARET","textAreaProps","spellCheck","commonStyle","outline","caretColor","contain","textAreaStyle","usePointPosition","textareaWrapperRef","textareaWrapper","HiddenTextArea","wrapperRef","createRef","useResumePosition","containerRef","snapshotCursorY","snapshotScrollTop","snapshotCursorPos","cursorY","scrollback","DEBOUNCE_TIME_SCROLL_BY_SELECTION","useScrollBySelection","contentRef","scrollDepsRef","scrollBySelection","targetSelection","targetComposing","latestDocument","latestSelection","skipScroll","attrbiute","Range","isDelayed","usePerf","noTrack","preparePaint","perfType","SelectionRenderer","appearances","globalStyle","setGlobalStyle","info","hasRemote","appearance","RE_RGB","ALPHA_THRESHOLD","LUMINANCE_THRESHOLD","isCoordInsideDOMRect","getBgColor","targetBlock","rgba","rgbaFromString","rgb","rgbs","getLuminance","pow","getCaretColor","luminance","getRectsFromLeaf","leafOffsetStr","leafOffset","getDOMPath","getTraverseRootsByDOMPath","path1","path2","traverseDOMTree","parentContext","isEnded","stopTraverse","childContext","rootPath","commonStartPath","commonEndPath","started","newOpt","ended","traverseDOMForest","startAncestor","endAncestor","commonPath","opt","isOverlapped","getMaxLineSize","extendToFillBetweenLines","lines","startRects","endRects","filled","splitRectsIntoLines","lineSizes","currentIndex","lineId","antiAliasingRects","startSizes","endSizes","filledSizes","lineRects","fitted","isFloatInlineBox","isFloatBlockBox","isLine","isPage","isTableCell","isFullyContained","voidElement","GlobalGroupKey","DefaultGapLabel","getGapLabel","decesdant","conditions","shouldGap","hasOnlyLeafChild","addLineIdToRect","addToRectGroupWithGap","scrollableKey","label","gapLabel","getRectsFromSelection","contentDOM","startBlockPath","endBlockPath","selectionRects","traverseHandler","domKey","voidDOM","lineDOM","edgeSelectableDOM","onlyLeafChild","commonAncestorNode","commonAncestor","startBlockDOM","endBlockDOM","commonAncestorDOM","startDOMPath","endDOMPath","addToResult","targetGroup","getComposingLeaf","findComposingPoint","composingLen","composingEndLeaf","pointAncestor","getSelectionAppearance","selectionWrapperMap","wrapperRectCache","originSelection","targetBlockDOM","correctedPosition","rc","nativeSupport","attachShadow","ShadowRoot","slotStyle","SelectionSlot","slotRef","splitSelectionAndGetWrapper","globalRef","defaultWrapper","useSelectionWrappers","globalWrapperRef","setVisibles","getWrappersBySelection","local","croppedSelection","remotes","SelectionLayer","resizeFlag","setResizeFlag","isUnmountedRef","setRemotes","localDepsRef","resizeUpdator","shouldForceUpdate","onInputingHots","localWrappersMap","remoteWrappersMap","useCangjieKeyBindingRef","isGroupCollapsed","isGroupEmpty","blockStyle","inlineStyle","textIndent","maxWidth","voidStyle","VoidInlineWrapper","VoidBlockWrapper","seletableAttrs","finalVisible","nodeStyle","VoidWrapper","LeafComponent","replaceNodeIntoElement","origin","useInputPending","pending$","updateElements","pendingHandler","oldViewText","viewData","tmp","rPath","dPath","documentView","useView","selectedRef","prevSelected","selected","GroupWrapper","g","isComposingMark","isNotComposingMark","checkRerenderNodesBySelectionChange","memoizeOne","shouldRenderNodeKeys","prevStart","prevEnd","startAnchestors","anchestor","prevStartAnchestors","endAnchestors","prevEndAnchestors","shouldComponentUpdate","shouldUpdate","isSelectionPending","pendingSelected","prevValue","shouldRenderSets","renderLeaves","nextStartOffset","hasComposingMark","nextHasComposingMark","marksWithoutComposing","renderLeaf","NodeComponent","pendingElements","updatePendingElements","virtualizeNodeManager","topPath","virtualizePersistState","childNodeKey","renderedChildren","isNonEmptyBlock","isSelectable","binding","attributesWithBinding","nonVoidAttributes","initialChild","comp","VirtualizePlaceholder","useVirtualize","getScrollableContainer","setVirtualizeId","virtualizeResult","arePropsEqual","prevIsFocused","nextSelection","nextView","nextIsFocused","EditableContent","editableRef","useVirtualizeResult","virtualizeAttr","blockFinalVisibleState","FOCUS_SCROLL_DELAY","MAX_VIEWPORT_WAIT_TIME","useClickToScroll","scrollerRef","waitTimer","scheduler","fallbackCall","ScrollableContentContext","useScrollableContent","EVENT_HANDLERS","editorStyle","wordWrap","WebkitTapHighlightColor","CLIPBOARD_IDENTIFIER","useWindowEvent","touchStartFlag","isNotEditable","isInputTarget","HTMLInputElement","useCombinedRefs","refs","targetRef","isValidCopyOrCut","Content","combinedContainerRef","textareaRef","prevWindowHeight","prevWindowWidth","isTextareaDisabled","setIsTextareaDisabled","className","Container","tabIndex","customStyle","defaultStyle","hdls","zoomStyle","disableNativeFocus","selectionCalculator","inputDetector","handleClickToFocus","textarea","preventScroll","handleMouseDown","defaultPrevented","handleMouseUp","handleKeyDown","shouldContinue","handleKeyUp","handleTouchMove","handleTouchStartCapture","handleTouchEndCapture","handleContextMenu","handleDragStart","handleDragOver","handleDrop","handleDragEnter","handleCopy","handleCut","handleFocus","scrollToCaret","currentSelection","handleBlur","triggerCompositionEnd","handleWindowResize","rs","previousHeight","previousWidth","isNativeFocused","isFocusedNow","hasFocus","handleReadOnlyKeyDown","handleReadOnlyKeyUp","editableListeners","isCangjie","isFile","persist","DataTransfer","cloneData","pasteInputEvent","pasteInput","textareaKeys","onMouseUp","onTouchMove","onTouchEnd","onTouchStartCapture","onTouchEndCapture","onContextMenu","onDragOver","onDrop","onDragEnter","externalZoom","ContentWithContext","getScrollableContent","displayName","createActionHandlers","createAction","isAction","getUserData","GroupPlugin","groupActions","utils","groupUtils","RangeSelection"],"mappings":"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AAG5C,IAAI,CAAC5I,OAAL,CAAaiK,CAAb,EAAgBnB,IAAhB,CAAf,CAAA;AACA,IAAM2C,MAAAA,QAAQ,GAAG7C,IAAI,CAAC4B,SAAL,CAAeP,CAAf,EAAkBnB,IAAlB,CAAjB,CAAA;AACA,IAAM4C,MAAAA,MAAM,GAAG9C,IAAI,CAACoB,UAAL,CAAgBC,CAAhB,EAAmBnB,IAAnB,CAAf,CAAA;;AAEA,IAAIxK,IAAAA,IAAI,KAAK,aAAb,EAA4B;AAC1B,MAAA,IAAIkN,MAAM,IAAIC,QAAV,IAAsBC,MAA1B,EAAkC;AAChC;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQ,QAAO,OAAA,CAAC9C,IAAI,CAACe,SAAL,CAAeb,IAAf,EAAqB,CAArB,EAAwByC,MAAxB,CAAD,CAAP,CAAA;AACD,OAAA;AACF,KAtDD,MAsDO,IAAIjN,IAAI,KAAK,aAAb,EAA4B;AACjC,MAAA,IAAImN,QAAJ,EAAc;AACZ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQ,QAAO,OAAA,CAAC7C,IAAI,CAACa,SAAL,CAAeX,IAAf,EAAqB,CAArB,EAAwByC,MAAxB,CAAD,CAAP,CAAA;AACD,OAAA;;AACD,MAAIC,IAAAA,MAAM,IAAIE,MAAd,EAAsB;AACpB;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQ,QAAA,OAAO,EAAP,CAAA;AACD,OAAA;AACF,KA7DM,MA6DA,IAAIpN,IAAI,KAAK,YAAb,EAA2B;AAChC,MAAA,IAAI,CAACsK,IAAI,CAACmC,QAAL,CAAcd,CAAd,CAAL,EAAuB;AACrB,QAAO,OAAA,CAACnB,IAAD,CAAP,CAAA;AACD,OAAA;;AACD,MAAI0C,IAAAA,MAAM,IAAIC,QAAd,EAAwB;AACtB;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQ,QAAO,OAAA,CAAC7C,IAAI,CAACa,SAAL,CAAeX,IAAf,EAAqB,CAArB,EAAwByC,MAAxB,CAAD,CAAP,CAAA;AACD,OAAA;;AACD,MAAA,IAAIG,MAAJ,EAAY;AACV;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQ,QAAM,MAAA;AAAEnD,UAAAA,QAAAA;AAAF,SAAA,GAAe+C,SAArB,CAAA;AACA,QAAO,OAAA,CACL1C,IAAI,CAACe,SAAL,CAAef,IAAI,CAACa,SAAL,CAAeX,IAAf,EAAqB,CAArB,EAAwByC,MAAxB,CAAf,EAAgDhD,QAAhD,EAA0DgD,MAAM,GAAG,CAAnE,CADK,CAAP,CAAA;AAGD,OAAA;AACF,KA7EM,MA6EA,IAAIjN,IAAI,KAAK,YAAb,EAA2B;AAChC,MAAA,IAAIkN,MAAJ,EAAY;AACV;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQ,QAAO,OAAA,CAAC1C,IAAD,EAAOF,IAAI,CAACe,SAAL,CAAeb,IAAf,CAAP,CAAP,CAAA;AACD,OAAA;;AACD,MAAA,IAAI2C,QAAJ,EAAc;AACZ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA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I/C,IAAI,CAACyB,SAAL,CAAeJ,CAAf,EAAkB0B,EAAlB,CAA0BI,KAAAA,OAAO,IAAIF,OAArC,CAAJ,EAAmD;AACxD,QAAA,IAAIJ,QAAJ,EAAc;AACZ;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACU,UAAO,OAAA,CAAC7C,IAAI,CAACa,SAAL,CAAeX,IAAf,EAAqB,CAArB,EAAwByC,MAAxB,CAAD,CAAP,CAAA;AACD,SArCD,MAqCO;AACL;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACU,UAAO,OAAA,CAAC3C,IAAI,CAACe,SAAL,CAAeb,IAAf,EAAqB,CAArB,EAAwByC,MAAxB,CAAD,CAAP,CAAA;AACD,SAAA;AACF,OA7EM,MA6EA,IAAIM,OAAO,IAAIC,SAAX,IAAwBC,OAA5B,EAAqC;AAC1C,QAAA,IAAIN,QAAJ,EAAc;AACZ;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEU,UAAO,OAAA,CAAC7C,IAAI,CAACe,SAAL,CAAef,IAAI,CAACa,SAAL,CAAeX,IAAf,EAAqB,CAArB,EAAwByC,MAAxB,CAAf,EAAgD,CAAhD,EAAmDK,OAAnD,CAAD,CAAP,CAAA;AACD,SAAA;AACD;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACQ,QAAO,OAAA,CAAChD,IAAI,CAACe,SAAL,CAAeb,IAAf,EAAqB,CAArB,EAAwB8C,OAAxB,CAAD,CAAP,CAAA;AACD,OAzHM,MAyHA,IAAIH,QAAJ,EAAc;AACnB;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEQ,QAAO,OAAA,CAAC7C,IAAI,CAACa,SAAL,CAAeX,IAAf,EAAqB,CAArB,EAAwByC,MAAxB,CAAD,CAAP,CAAA;AACD,OAAA;AACF,KAAA;;AAED,IAAO,OAAA,CAACzC,IAAD,CAAP,CAAA;AACD,GAAA;AAEC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACE,EAAOkD,OAAAA,MAAP,CAAclD,IAAd,EAA0B;AACxB,IAAA,OAAOA,IAAI,CAAC5J,MAAL,KAAgB,CAAvB,CAAA;AACD,GAAA;;AAxyC6C;;ACbhD,SAAS+M,UAAT,CAAoBC,KAApB,EAA2C;AACzC,EAAA,IAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;AAC7B,IAAQ,OAAA,CAAA,UAAA,EAAYA,KAAM,CAA1B,CAAA,CAAA,CAAA;AACD,GAFD,MAEO,IAAI5G,KAAK,CAACC,OAAN,C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CAAA;AACD,GAAA;;AAWD;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACSqO,EAAAA,QAAP,GAAkC;AAChC,IAAA,OAAO,gBAAgBC,MAAvB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSC,EAAAA,OAAP,GAAgC;AAC9B,IAAA,OAAO,gBAAgBJ,KAAvB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEStH,EAAAA,aAAP,GAAuB;AACrB,IAAO,OAAA,IAAA,CAAK/F,GAAL,CAAS,KAAT,EAAgBgE,QAAQ,CAACxE,MAAT,EAAhB,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSyN,EAAAA,UAAP,CAAkBjP,GAAlB,EAA+B;AAC7B,IAAA,MAAMX,IAAI,GAAG,IAAA,CAAKqQ,OAAL,CAAa1P,GAAb,CAAb,CAAA;AACA,IAAOiP,OAAAA,UAAU,CAAC5P,IAAD,EAAO,oBAAP,EAA6B,IAAA,CAAKsQ,UAAL,CAAgB3P,GAAhB,CAA7B,CAAjB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACS4P,EAAAA,gBAAP,CAAwB7E,IAAxB,EAAoC;AAClC,IAAA,MAAM1L,IAAI,GAAG,IAAA,CAAKwQ,aAAL,CAAmB9E,IAAnB,CAAb,CAAA;AACA,IAAA,OAAOkE,UAAU,CAAC5P,IAAD,EAAO,0BAAP,EAAmC0L,IAAnC,CAAjB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA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ED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACS6F,EAAAA,cAAP,CAAsB5Q,GAAtB,EAAmC;AACjC,IAAA,MAAM+K,IAAI,GAAG,IAAA,CAAKiF,OAAL,CAAahQ,GAAb,CAAb,CAAA;;AACA,IAAI,IAAA,CAAC+K,IAAD,IAASA,IAAI,CAAC5J,MAAL,KAAgB,CAA7B,EAAgC;AAC9B,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,IAAK0P,CAAAA,oBAAL,CAA0B9F,IAA1B,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACS8F,EAAAA,oBAAP,CAA4B9F,IAA5B,EAAwC;AACtC,IAAO,OAAA,IAAA,CAAK8E,aAAL,CAAmBhF,IAAI,CAACe,SAAL,CAAeb,IAAf,CAAnB,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACS+F,EAAAA,eAAP,CAAuB9Q,GAAvB,EAAoC;AAClC,IAAA,MAAM+K,IAAI,GAAG,IAAA,CAAKiF,OAAL,CAAahQ,GAAb,CAAb,CAAA;;AACA,IAAI,IAAA,CAAC+K,IAAL,EAAW;AACT,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,IAAKgG,CAAAA,qBAAL,CAA2BhG,IAA3B,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSgG,EAAAA,qBAAP,CAA6BhG,IAA7B,EAAyC;AACvC,IAAA,IAAIiG,YAAY,GAAG,IAAA,CAAKN,wBAAL,CAA8B3F,IAA9B,CAAnB,CAAA;AACA,IAAA,IAAIkG,UAAU,GAAGpG,IAAI,CAAC0B,MAAL,CAAYxB,IAAZ,CAAjB,CAAA;;AACA,IAAA,OAAO,CAACiG,YAAD,IAAiBC,UAAU,CAAC9P,MAAnC,EAA2C;AACzC,MAAA,MAAM+P,iBAAiB,GAAG,IAAA,CAAKR,wBAAL,CAA8BO,UAA9B,CAA1B,CAAA;AACAD,MAAAA,YAAY,GAAGE,iBAAiB,IAAIA,iBAAiB,CAAC9P,WAAlB,EAApC,CAAA;AACA6P,MAAAA,UAAU,GAAGpG,IAAI,CAAC0B,MAAL,CAAY0E,UAAZ,CAAb,CAAA;AACD,KAAA;;AACD,IAAA,OAAOD,YAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSG,EAAAA,WAAP,CAAmBnR,GAAnB,EAAgC;AAC9B,IAAA,MAAM+K,IAAI,GAAG,IAAA,CAAKiF,OAAL,CAAahQ,GAAb,CAAb,CAAA;;AACA,IAAI,IAAA,CAAC+K,IAAL,EAAW;AACT,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,IAAKqG,CAAAA,iBAAL,CAAuBrG,IAAvB,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSqG,EAAAA,iBAAP,CAAyBrG,IAAzB,EAAqC;AACnC,IAAA,IAAIsG,QAAQ,GAAG,IAAA,CAAKR,oBAAL,CAA0B9F,IAA1B,CAAf,CAAA;AACA,IAAA,IAAIkG,UAAU,GAAGpG,IAAI,CAAC0B,MAAL,CAAYxB,IAAZ,CAAjB,CAAA;;AACA,IAAA,OAAO,CAACsG,QAAD,IAAaJ,UAAU,CAAC9P,MAA/B,EAAuC;AACrC,MAAA,MAAMmQ,iBAAiB,GAAG,IAAA,CAAKT,oBAAL,CAA0BI,UAA1B,CAA1B,CAAA;AACAI,MAAAA,QAAQ,GAAGC,iBAAiB,IAAIA,iBAAiB,CAACrQ,YAAlB,EAAhC,CAAA;AACAgQ,MAAAA,UAAU,GAAGpG,IAAI,CAAC0B,MAAL,CAAY0E,UAAZ,CAAb,CAAA;AACD,KAAA;;AACD,IAAA,OAAOI,QAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSE,EAAAA,kBAAP,CAA0BvR,GAA1B,EAAuC;AACrC,IAAA,MAAM8D,IAAI,GAAG,IAAA,CAAK0N,eAAL,CAAqBxR,GAArB,CAAb,CAAA;AACA,IAAA,OAAOmP,UAAU,CAACrL,IAAD,EAAO,oBAAP,EAA6B9D,GAA7B,CAAjB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSwR,EAAAA,eAAP,CAAuBxR,GAAvB,EAAoC;AAClC,IAAA,MAAM+K,IAAI,GAAG,IAAA,CAAKiF,OAAL,CAAahQ,GAAb,CAAb,CAAA;;AACA,IAAA,IAAI,CAAC+K,IAAD,IAAS,CAACA,IAAI,CAAC5J,MAAnB,EAA2B;AACzB,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,IAAKsQ,CAAAA,qBAAL,CAA2B1G,IAA3B,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACS0G,EAAAA,qBAAP,CAA6B1G,IAA7B,EAAyC;AACvC,IAAA,IAAIiC,QAAQ,GAAG,IAAA,CAAK+D,qBAAL,CAA2BhG,IAA3B,CAAf,CAAA;;AACA,IAAOiC,OAAAA,QAAQ,EAAEhM,SAAV,EAAyB,IAAA,CAACgM,QAAQ,CAAC9L,KAAT,CAAeC,MAAhD,EAAwD;AACtD,MAAMuQ,MAAAA,YAAY,GAAG,IAAK1B,CAAAA,OAAL,CAAahD,QAAQ,CAAChN,GAAtB,CAArB,CAAA;;AACA,MAAI,IAAA,CAAC0R,YAAL,EAAmB;AACjB,QAAA,OAAO,IAAP,CAAA;AACD,OAAA;;AACD1E,MAAAA,QAAQ,GAAG,IAAA,CAAK+D,qBAAL,CAA2BW,YAA3B,CAAX,CAAA;AACD,KAAA;;AACD,IAAI,IAAA,CAAC1E,QAAL,EAAe;AACb,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAOA,OAAAA,QAAQ,CAAC1L,WAAT,EAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSqQ,EAAAA,WAAP,CAAmB3R,GAAnB,EAAgC;AAC9B,IAAA,MAAM+K,IAAI,GAAG,IAAA,CAAKiF,OAAL,CAAahQ,GAAb,CAAb,CAAA;;AACA,IAAA,IAAI,CAAC+K,IAAD,IAAS,CAACA,IAAI,CAAC5J,MAAnB,EAA2B;AACzB,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,IAAKyQ,CAAAA,iBAAL,CAAuB7G,IAAvB,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACS6G,EAAAA,iBAAP,CAAyB7G,IAAzB,EAAqC;AACnC,IAAA,IAAIrG,IAAI,GAAG,IAAA,CAAK0M,iBAAL,CAAuBrG,IAAvB,CAAX,CAAA;;AACA,IAAOrG,OAAAA,IAAI,EAAE1D,SAAN,EAAqB,IAAA,CAAC0D,IAAI,CAACxD,KAAL,CAAWC,MAAxC,EAAgD;AAC9C,MAAM0Q,MAAAA,QAAQ,GAAG,IAAK7B,CAAAA,OAAL,CAAatL,IAAI,CAAC1E,GAAlB,CAAjB,CAAA;;AACA,MAAI,IAAA,CAAC6R,QAAL,EAAe;AACb,QAAA,OAAO,IAAP,CAAA;AACD,OAAA;;AACDnN,MAAAA,IAAI,GAAG,IAAA,CAAK0M,iBAAL,CAAuBS,QAAvB,CAAP,CAAA;AACD,KAAA;;AACD,IAAI,IAAA,CAACnN,IAAL,EAAW;AACT,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAOA,OAAAA,IAAI,CAACrD,YAAL,EAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSyQ,EAAAA,gBAAP,CAAwB9R,GAAxB,EAAqC;AACnC,IAAA,MAAM+R,KAAK,GAAG,IAAA,CAAKrC,OAAL,CAAa1P,GAAb,CAAd,CAAA;;AACA,IAAI,IAAA,CAAC+R,KAAL,EAAY;AACV,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AAED,IAAA,IAAIpI,KAAJ,CAAA;;AACA,IAAA,IAAI0F,KAAK,CAACI,OAAN,CAAcsC,KAAd,CAAJ,EAA0B;AACxBpI,MAAAA,KAAK,GAAGoI,KAAK,CAAC1Q,YAAN,EAAR,CAAA;AACD,KAFD,MAEO;AACL,MAAA,MAAM2Q,KAAK,GAAG,IAAA,CAAKC,eAAL,CAAqBjS,GAArB,CAAd,CAAA;AACA2J,MAAAA,KAAK,GAAGqI,KAAK,CAAC3Q,YAAN,EAAR,CAAA;AACD,KAAA;;AAED,IAAM2L,MAAAA,QAAQ,GAAGrD,KAAK,IAAI,IAAA,CAAK6H,eAAL,CAAqB7H,KAAK,CAAC3J,GAA3B,CAA1B,CAAA;;AACA,IAAI,IAAA,CAACgN,QAAL,EAAe;AACb,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AAED,IAAA,OAAO,KAAKiF,eAAL,CAAqBjF,QAAQ,CAAChN,GAA9B,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSkS,EAAAA,YAAP,CAAoBlS,GAApB,EAAiC;AAC/B,IAAA,MAAM+R,KAAK,GAAG,IAAA,CAAKrC,OAAL,CAAa1P,GAAb,CAAd,CAAA;;AACA,IAAI,IAAA,CAAC+R,KAAL,EAAY;AACV,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,IAAIhF,IAAJ,CAAA;;AAEA,IAAA,IAAIsC,KAAK,CAACI,OAAN,CAAcsC,KAAd,CAAJ,EAA0B;AACxBhF,MAAAA,IAAI,GAAGgF,KAAK,CAACzQ,WAAN,EAAP,CAAA;AACD,KAFD,MAEO;AACL,MAAA,MAAM0Q,KAAK,GAAG,IAAA,CAAKC,eAAL,CAAqBjS,GAArB,CAAd,CAAA;AACA+M,MAAAA,IAAI,GAAGiF,KAAK,CAAE1Q,WAAP,EAAP,CAAA;AACD,KAAA;;AACD,IAAA,IAAI,CAACyL,IAAL,EAAW,OAAO,IAAP,CAAA;AAEX,IAAMrI,MAAAA,IAAI,GAAG,IAAKiN,CAAAA,WAAL,CAAiB5E,IAAI,CAAC/M,GAAtB,CAAb,CAAA;AACA,IAAA,IAAI,CAAC0E,IAAL,EAAW,OAAO,IAAP,CAAA;AAEX,IAAMyN,MAAAA,OAAO,GAAG,IAAKF,CAAAA,eAAL,CAAqBvN,IAAI,CAAC1E,GAA1B,CAAhB,CAAA;AACA,IAAA,OAAOmS,OAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACShC,EAAAA,mBAAP,GAA6B;AAC3B,IAAA,IAAI,CAACtB,yBAAyB,CAACzL,GAA1B,CAA8B,IAA9B,CAAL,EAA0C;AACxC,MAAM,MAAA;AAAEpD,QAAAA,GAAF;AAAOkB,QAAAA,KAAAA;AAAP,OAAA,GAAiB,IAAvB,CAAA;AACA,MAAM,MAAA;AAAEC,QAAAA,MAAAA;AAAF,OAAA,GAAaD,KAAnB,CAAA;AACA,MAAA,MAAM8N,KAAuB,GAAGpP,MAAM,CAAC4B,MAAP,CAAc,IAAd,CAAhC,CAAA;;AACA,MAAA,KAAK,IAAI2J,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGhK,MAApB,EAA4BgK,CAAC,IAAI,CAAjC,EAAoC;AAClC,QAAA,MAAM9L,IAAI,GAAG6B,KAAK,CAACiK,CAAD,CAAlB,CAAA;AACA6D,QAAAA,KAAK,CAAC3P,IAAI,CAACW,GAAN,CAAL,GAAkB,CAACA,GAAD,EAAMmL,CAAN,CAAlB,CAAA;;AACA,QAAA,IAAI,CAACrK,SAAO,CAACE,SAAR,CAAkB3B,IAAlB,CAAL,EAA8B;AAC5B,UAAA,SAAA;AACD,SAAA;;AAED,QAAA,MAAM+S,MAAM,GAAG/S,IAAI,CAAC8Q,mBAAL,EAAf,CAPkC;;AASlC9Q,QAAAA,IAAI,CAACgT,iBAAL,CAAwB1G,CAAD,IAAO;AAC5BqD,UAAAA,KAAK,CAACrD,CAAC,CAAC3L,GAAH,CAAL,GAAeoS,MAAM,CAACzG,CAAC,CAAC3L,GAAH,CAArB,CAAA;AACD,SAFD,CAAA,CAAA;AAGD,OAAA;;AACD6O,MAAAA,yBAAyB,CAAC7M,GAA1B,CAA8B,IAA9B,EAAoCgN,KAApC,CAAA,CAAA;AACD,KAAA;;AACD,IAAA,OAAOH,yBAAyB,CAACnH,GAA1B,CAA8B,IAA9B,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACE,EAAA,IAAW5D,IAAX,GAAkB;AAChB,IAAA,OAAO,KAAKgE,QAAL,EAAA,CAAgBtE,MAAhB,CAAuB,CAAC8O,GAAD,EAAM;AAAExO,MAAAA,IAAAA;AAAF,KAAN,KAAoB,GAAEwO,GAAI,CAAA,EAAExO,IAAK,CAAxD,CAAA,EAA2D,EAA3D,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSyO,EAAAA,YAAP,CAAoBvS,GAApB,EAAiCwS,SAAjC,EAAgE;AAC9D,IAAA,MAAMzH,IAAI,GAAG,IAAA,CAAKiF,OAAL,CAAahQ,GAAb,CAAb,CAAA;;AACA,IAAI,IAAA,CAAC+K,IAAL,EAAW;AACT,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,KAAK0H,kBAAL,CAAwB1H,IAAxB,EAA8ByH,SAA9B,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSC,EAAAA,kBAAP,CAA0B1H,IAA1B,EAAsCyH,SAAtC,EAAqE;AACnE,IAAA,MAAMvF,SAAS,GAAG,IAAA,CAAKyF,kBAAL,CAAwB3H,IAAxB,CAAlB,CAAA;;AACA,IAAA,IAAI,CAACkC,SAAD,IAAc,CAACA,SAAS,CAAC9L,MAA7B,EAAqC;AACnC,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AAED,IAAMwR,MAAAA,OAAO,GAAG1F,SAAS,CAAC/J,IAAV,CAAe,CAAC7D,IAAD,EAAOoD,KAAP,KAAiB;AAC9C,MAAIpD,IAAAA,IAAI,KAAK,IAAb,EAAmB;AACjB,QAAA,OAAO,KAAP,CAAA;AACD,OAAA;;AACD,MAAA,OAAOmT,SAAS,CAACnT,IAAD,EAAOoD,KAAP,CAAhB,CAAA;AACD,KALe,EAKb,EALa,CAAhB,CAAA;AAMA,IAAOkQ,OAAAA,OAAO,IAAI,IAAlB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSC,EAAAA,kBAAP,CAA0B5S,GAA1B,EAAsD;AACpD,IAAA,MAAMX,IAAI,GAAG,IAAKkT,CAAAA,YAAL,CAAkBvS,GAAlB,EAAwB2L,CAAD,IAAO6D,MAAM,CAACD,QAAP,CAAgB5D,CAAhB,CAA9B,CAAb,CAAA;;AACA,IAAItM,IAAAA,IAAI,EAAE2B,SAAN,EAAA,IAAqB3B,IAAI,CAACkQ,QAAL,EAAzB,EAA0C;AACxC,MAAA,OAAOlQ,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSwT,EAAAA,iBAAP,CAAyB7S,GAAzB,EAAoD;AAClD,IAAA,MAAMX,IAAI,GAAG,IAAKkT,CAAAA,YAAL,CAAkBvS,GAAlB,EAAwB2L,CAAD,IAAO0D,KAAK,CAACI,OAAN,CAAc9D,CAAd,CAA9B,CAAb,CAAA;;AACA,IAAItM,IAAAA,IAAI,EAAE2B,SAAN,EAAA,IAAqB3B,IAAI,CAACoQ,OAAL,EAAzB,EAAyC;AACvC,MAAA,OAAOpQ,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSyT,EAAAA,4BAAP,CAAoC9S,GAApC,EAAiD;AAC/C,IAAA,MAAM+K,IAAI,GAAG,IAAA,CAAKiF,OAAL,CAAahQ,GAAb,CAAb,CAAA;;AACA,IAAI,IAAA,CAAC+K,IAAL,EAAW;AACT,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,IAAKgI,CAAAA,kCAAL,CAAwChI,IAAxC,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSgI,EAAAA,kCAAP,CAA0ChI,IAA1C,EAAsD;AACpD,IAAA,MAAMkC,SAAS,GAAG,IAAA,CAAKyF,kBAAL,CAAwB3H,IAAxB,CAAlB,CAAA;;AACA,IAAI,IAAA,CAACkC,SAAL,EAAgB;AACd,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AAED,IAAA,MAAM+F,QAAQ,GAAG/F,SAAS,CACvBrK,KADc,CACR,CADQ,CACL;AADK,KAEdM,IAFc,CAER7D,IAAD,IAAUA,IAAI,YAAYyB,SAAhB,IAA2BzB,IAAI,CAAC6B,KAAL,CAAWC,MAAX,KAAsB,CAFlD,CAAjB,CAAA;AAIA,IAAO6R,OAAAA,QAAQ,IAAI,IAAnB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSC,EAAAA,YAAP,CAAoBjT,GAApB,EAA4C;AAC1C,IAAA,MAAM+K,IAAI,GAAG,IAAA,CAAKiF,OAAL,CAAahQ,GAAb,CAAb,CAAA;AACA,IAAA,OAAO,IAAK0S,CAAAA,kBAAL,CAAwB3H,IAAxB,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACS2H,EAAAA,kBAAP,CAA0B3H,IAA1B,EAAwD;AACtD,IAAI,IAAA,CAACA,IAAD,IAAS,CAAC,KAAK8E,aAAL,CAAmB9E,IAAnB,CAAd,EAAwC;AACtC,MAAA,OAAO,EAAP,CAAA;AACD,KAAA;;AACD,IAAMkC,MAAAA,SAAoB,GAAG,EAA7B,CAAA;AAEAlC,IAAAA,IAAI,CAAC3C,OAAL,CAAa,CAAC8K,CAAD,EAAIzQ,KAAJ,KAAc;AACzB,MAAMuJ,MAAAA,OAAO,GAAGjB,IAAI,CAACnI,KAAL,CAAW,CAAX,EAAcH,KAAd,CAAhB,CAAA;AACA,MAAA,MAAMsJ,QAAQ,GAAG,IAAA,CAAK8D,aAAL,CAAmB7D,OAAnB,CAAjB,CAAA;;AACA,MAAA,IAAID,QAAQ,EAAE/K,SAAV,EAAJ,EAA2B;AACzBiM,QAAAA,SAAS,CAACvG,IAAV,CAAeqF,QAAf,CAAA,CAAA;AACD,OAAA;AACF,KAND,CAAA,CAAA;AAQA,IAAA,OAAOkB,SAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSkG,EAAAA,UAAP,CAAkBnT,GAAlB,EAA+BwS,SAA/B,EAA8D;AAC5D,IAAA,MAAMzH,IAAI,GAAG,IAAA,CAAKiF,OAAL,CAAahQ,GAAb,CAAb,CAAA;AACA,IAAA,OAAO,KAAKoT,gBAAL,CAAsBrI,IAAtB,EAA4ByH,SAA5B,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSY,EAAAA,gBAAP,CACErI,IADF,EAEEyH,SAFF,EAGkB;AAChB,IAAI,IAAA,CAACzH,IAAL,EAAW;AACT,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,MAAMkC,SAAS,GAAG,IAAA,CAAKyF,kBAAL,CAAwB3H,IAAxB,CAAlB,CAAA;AACA,IAAA,MAAMoH,OAAO,GAAGlF,SAAS,CAACuD,OAAV,EAAoBtN,CAAAA,IAApB,CAAyB,CAAC7D,IAAD,EAAOoD,KAAP,EAAc4Q,IAAd,KAAuB;AAC9D,MAAA,IAAIhU,IAAI,KAAK,IAAb,EAAmB,OAAO,KAAP,CAAA;AACnB,MAAA,OAAOmT,SAAS,CAACnT,IAAD,EAAOoD,KAAP,EAAc4Q,IAAd,CAAhB,CAAA;AACD,KAHe,CAAhB,CAAA;AAIA,IAAOlB,OAAAA,OAAO,IAAI,IAAlB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSmB,EAAAA,gBAAP,CAAwBtT,GAAxB,EAAoD;AAClD,IAAA,MAAM+K,IAAI,GAAG,IAAA,CAAKiF,OAAL,CAAahQ,GAAb,CAAb,CAAA;;AACA,IAAI,IAAA,CAAC+K,IAAL,EAAW;AACT,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,IAAKwI,CAAAA,sBAAL,CAA4BxI,IAA5B,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSwI,EAAAA,sBAAP,CAA8BxI,IAA9B,EAAyD;AACvD,IAAA,MAAMoH,OAAO,GAAG,IAAKiB,CAAAA,gBAAL,CAAsBrI,IAAtB,EAA6BY,CAAD,IAAO6D,MAAM,CAACD,QAAP,CAAgB5D,CAAhB,CAAnC,CAAhB,CAAA;;AACA,IAAIwG,IAAAA,OAAO,EAAEnR,SAAT,EAAA,IAAwBmR,OAAO,CAAC5C,QAAR,EAA5B,EAAgD;AAC9C,MAAA,OAAO4C,OAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSqB,EAAAA,kBAAP,CAA0BxT,GAA1B,EAA8C;AAC5C,IAAA,MAAMgS,KAAK,GAAG,IAAA,CAAKC,eAAL,CAAqBjS,GAArB,CAAd,CAAA;AACA,IAAA,OAAOoP,WAAW,CAAC4C,KAAD,EAAQ,oBAAR,EAA8BhS,GAA9B,CAAlB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSiS,EAAAA,eAAP,CAAuBjS,GAAvB,EAAkD;AAChD,IAAA,MAAM+K,IAAI,GAAG,IAAA,CAAKiF,OAAL,CAAahQ,GAAb,CAAb,CAAA;AACA,IAAO+K,OAAAA,IAAI,GAAG,IAAK0I,CAAAA,qBAAL,CAA2B1I,IAA3B,CAAH,GAAsC,IAAjD,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACS0I,EAAAA,qBAAP,CAA6B1I,IAA7B,EAAuD;AACrD,IAAA,MAAMoH,OAAO,GAAG,IAAKiB,CAAAA,gBAAL,CAAsBrI,IAAtB,EAA6BY,CAAD,IAAO0D,KAAK,CAACI,OAAN,CAAc9D,CAAd,CAAnC,CAAhB,CAAA;;AACA,IAAIwG,IAAAA,OAAO,EAAEnR,SAAT,EAAA,IAAwBmR,OAAO,CAAC1C,OAAR,EAA5B,EAA+C;AAC7C,MAAA,OAAO0C,OAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSuB,EAAAA,wBAAP,CAAgC1T,GAAhC,EAA2D;AACzD,IAAA,MAAMX,IAAI,GAAG,IAAA,CAAKqQ,OAAL,CAAa1P,GAAb,CAAb,CAAA;;AACA,IAAIX,IAAAA,IAAI,IAAIA,IAAI,CAAC2B,SAAL,EAAR,IAA4B3B,IAAI,CAACoQ,OAAL,EAAhC,EAAgD;AAC9C,MAAA,OAAOpQ,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,IAAK4S,CAAAA,eAAL,CAAqBjS,GAArB,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACS2T,EAAAA,mBAAP,CAA2B3T,GAA3B,EAAqD;AACnD,IAAA,MAAM4T,SAAS,GAAG,IAAA,CAAK5D,OAAL,CAAahQ,GAAb,CAAlB,CAAA;;AACA,IAAA,IAAI,CAAC4T,SAAD,IAAc,CAACA,SAAS,CAACzS,MAA7B,EAAqC;AACnC,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAM9B,MAAAA,IAAI,GAAG,IAAK6B,CAAAA,KAAL,CAAW0S,SAAS,CAAC,CAAD,CAApB,CAAb,CAAA;AACA,IAAA,OAAOvU,IAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSwU,EAAAA,sBAAP,CAA8B7T,GAA9B,EAAiD;AAC/C,IAAA,MAAMX,IAAI,GAAG,IAAA,CAAKsU,mBAAL,CAAyB3T,GAAzB,CAAb,CAAA;AACA,IAAA,OAAOiP,UAAU,CAAC5P,IAAD,EAAO,wBAAP,EAAiCW,GAAjC,CAAjB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACS8T,EAAAA,SAAP,CAAiB9T,GAAjB,EAAsC;AACpC,IAAA,IAAA,CAAKiP,UAAL,CAAgBjP,GAAhB,CAAA,CADoC;;AAIpC,IAAA,MAAM+R,KAAK,GAAG,IAAA,CAAK4B,mBAAL,CAAyB3T,GAAzB,CAAd,CAAA;;AACA,IAAI,IAAA,CAAC+R,KAAL,EAAY;AACV,MAAA,OAAO,CAAP,CAAA;AACD,KAAA;;AACD,IAAA,MAAMgC,UAAU,GAAG,IAAK7S,CAAAA,KAAL,CAAWwB,SAAX,CAAsBiJ,CAAD,IAAOA,CAAC,KAAKoG,KAAlC,CAAnB,CAAA;AACA,IAAMjN,MAAAA,MAAM,GAAG,IAAA,CAAK5D,KAAL,CACZ0B,KADY,CACN,CADM,EACHmR,UADG,CAAA,CAEZvQ,MAFY,CAEL,CAACwQ,IAAD,EAAOrI,CAAP,KAAaqI,IAAI,GAAGrI,CAAC,CAAC7H,IAAF,CAAO3C,MAFtB,EAE8B,CAF9B,CAAf,CAAA;AAIA,IAAOnB,OAAAA,GAAG,KAAK+R,KAAK,CAAC/R,GAAd,GACH8E,MADG,GAEHA,MAAM,IAAIiN,KAAK,CAAC/Q,SAAN,EAAA,GAAoB+Q,KAAK,CAAC+B,SAAN,CAAgB9T,GAAhB,CAApB,GAA2C,CAA/C,CAFV,CAAA;AAGD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSiU,EAAAA,SAAP,CAAiBjU,GAAjB,EAA8B;AAC5B,IAAA,MAAM+K,IAAI,GAAG,IAAA,CAAKiF,OAAL,CAAahQ,GAAb,CAAb,CAAA;AACA,IAAA,OAAO,IAAKkU,CAAAA,eAAL,CAAqBnJ,IAArB,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSoJ,EAAAA,YAAP,CAAoBnU,GAApB,EAAiC;AAC/B,IAAA,MAAMoU,OAAO,GAAG,IAAA,CAAKH,SAAL,CAAejU,GAAf,CAAhB,CAAA;AACA,IAAA,OAAOkP,aAAa,CAACkF,OAAD,EAAU,cAAV,EAA0BpU,GAA1B,CAApB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSkU,EAAAA,eAAP,CAAuBnJ,IAAvB,EAA0D;AACxD,IAAA,IAAI,CAACA,IAAD,IAAS,CAACA,IAAI,CAAC5J,MAAf,IAAyB,CAAC,IAAK0O,CAAAA,aAAL,CAAmB9E,IAAnB,CAA9B,EAAwD;AACtD,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,MAAM1L,IAAI,GAAG,IAAKwQ,CAAAA,aAAL,CAAmB9E,IAAI,CAACnI,KAAL,CAAW,CAAX,EAAc,CAAC,CAAf,CAAnB,CAAb,CAAA;;AACA,IAAA,IAAIvD,IAAI,EAAE2B,SAAN,EAAJ,EAAuB;AACrB,MAAA,OAAO3B,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSgV,EAAAA,oBAAP,CAA4B1R,CAA5B,EAAuCI,CAAvC,EAAkD;AAChD,IAAMqR,MAAAA,OAAO,GAAG,IAAKE,CAAAA,iBAAL,CAAuB3R,CAAvB,EAA0BI,CAA1B,CAAhB,CAAA;AACA,IAAOmM,OAAAA,aAAa,CAACkF,OAAD,EAAU,sBAAV,EAAmC,CAAA,CAAA,EAAGzR,CAAE,CAAA,EAAA,EAAII,CAAE,CAAA,CAAA,CAA9C,CAApB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSuR,EAAAA,iBAAP,CAAyB3R,CAAzB,EAAoCI,CAApC,EAA+C;AAC7C,IAAA,MAAMwR,KAAK,GAAG,IAAA,CAAKvE,OAAL,CAAarN,CAAb,CAAd,CAAA;AACA,IAAA,MAAM6R,KAAK,GAAG,IAAA,CAAKxE,OAAL,CAAajN,CAAb,CAAd,CAAA;;AACA,IAAA,IAAI,CAACwR,KAAD,IAAU,CAACC,KAAf,EAAsB;AACpB,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,MAAMnV,IAAI,GAAG,IAAKwQ,CAAAA,aAAL,CAAmBhF,IAAI,CAACqC,MAAL,CAAYqH,KAAZ,EAAmBC,KAAnB,CAAnB,CAAb,CAAA;AACA,IAAA,OAAOnV,IAAI,EAAE2B,SAAN,EAAoB3B,GAAAA,IAApB,GAA2B,IAAlC,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSoV,EAAAA,wBAAP,CAAgCC,QAAhC,EAAkDC,MAAlD,EAA0E;AACxE,IAAA,MAAMC,SAAS,GAAG,IAAA,CAAKlF,OAAL,CAAagF,QAAb,CAAlB,CAAA;;AACA,IAAA,IAAI,CAACE,SAAS,EAAE7T,MAAX,EAAL,EAA0B;AACxB,MAAA,OAAO,EAAP,CAAA;AACD,KAAA;;AACD,IAAA,IAAI2T,QAAQ,KAAKC,MAAjB,EAAyB,OAAO,CAACC,SAAD,CAAP,CAAA;AACzB,IAAA,MAAMC,OAAO,GAAG,IAAA,CAAKnF,OAAL,CAAaiF,MAAb,CAAhB,CAAA;;AACA,IAAA,IAAI,CAACE,OAAO,EAAE9T,MAAT,EAAL,EAAwB;AACtB,MAAA,OAAO,EAAP,CAAA;AACD,KAAA;;AAED,IAAA,MAAM+T,KAAK,GAAG,IAAKhN,CAAAA,QAAL,EAAd,CAAA;AACA,IAAA,MAAMQ,KAAK,GAAGwM,KAAK,CAACC,OAAN,CAAcH,SAAd,CAAd,CAAA;AACA,IAAMrM,MAAAA,GAAG,GAAGuM,KAAK,CAACC,OAAN,CAAcF,OAAd,EAAuBvM,KAAvB,CAAZ,CAAA;AACA,IAAMc,MAAAA,MAAM,GAAG0L,KAAK,CAAClS,KAAN,CAAY0F,KAAZ,EAAmBC,GAAG,GAAG,CAAzB,CAAf,CAAA;AACA,IAAA,OAAOa,MAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACStB,EAAAA,QAAP,GAA0B;AACxB,IAAMgN,MAAAA,KAAa,GAAG,EAAtB,CAAA;AACA,IAAKzC,IAAAA,CAAAA,iBAAL,CAAwBhT,IAAD,IAAU;AAC/B,MAAA,IAAIwB,MAAI,CAACE,MAAL,CAAY1B,IAAZ,CAAJ,EAAuB;AACrByV,QAAAA,KAAK,CAACpO,IAAN,CAAWrH,IAAX,CAAA,CAAA;AACD,OAAA;AACF,KAJD,CAAA,CAAA;AAKA,IAAA,OAAOyV,KAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSE,EAAAA,UAAP,GAAoB;AAClB,IAAMC,MAAAA,OAAiB,GAAG,EAA1B,CAAA;AACA,IAAK5C,IAAAA,CAAAA,iBAAL,CAAwBhT,IAAD,IAAU;AAC/B,MAAA,IAAImQ,MAAM,CAAC0F,YAAP,CAAoB7V,IAApB,CAAJ,EAA+B;AAC7B4V,QAAAA,OAAO,CAACvO,IAAR,CAAarH,IAAb,CAAA,CAAA;AACD,OAAA;AACF,KAJD,CAAA,CAAA;AAKA,IAAA,OAAO4V,OAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSE,EAAAA,gBAAP,CAAwB5U,IAAxB,EAAsC;AACpC,IAAM0U,MAAAA,OAAiB,GAAG,EAA1B,CAAA;AACA,IAAK5C,IAAAA,CAAAA,iBAAL,CAAwBhT,IAAD,IAAU;AAC/B,MAAImQ,IAAAA,MAAM,CAAC0F,YAAP,CAAoB7V,IAApB,CAA6BA,IAAAA,IAAI,CAACkB,IAAL,KAAcA,IAA/C,EAAqD;AACnD0U,QAAAA,OAAO,CAACvO,IAAR,CAAarH,IAAb,CAAA,CAAA;AACD,OAAA;AACF,KAJD,CAAA,CAAA;AAKA,IAAA,OAAO4V,OAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSG,EAAAA,cAAP,CAAsBpR,GAAtB,EAAiD;AAC/C,IAAMqR,MAAAA,QAAQ,GAAG,IAAKnU,CAAAA,KAAL,CAAW8C,GAAX,CAAgB3E,IAAD,IAAU;AACxC,MAAIiW,IAAAA,GAAmB,GAAGjW,IAA1B,CAAA;;AACA,MAAA,IAAIyB,SAAO,CAACE,SAAR,CAAkBsU,GAAlB,CAAJ,EAA4B;AAC1BA,QAAAA,GAAG,GAAGA,GAAG,CAACF,cAAJ,CAAmBpR,GAAnB,CAAN,CAAA;AACD,OAAA;;AACD,MAAOA,OAAAA,GAAG,CAACsR,GAAD,CAAV,CAAA;AACD,KANgB,CAAjB,CAAA;AAQA,IAAA,OAAO,KAAKtT,GAAL,CAAS,OAAT,EAAkBqT,QAAlB,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACShD,EAAAA,iBAAP,CAAyBkD,QAAzB,EAA6E;AAC3E,IAAID,IAAAA,GAAmB,GAAG,IAA1B,CAAA;AAEA,IAAA,IAAA,CAAKpU,KAAL,CAAWkH,OAAX,CAAoB2J,KAAD,IAAW;AAC5B,MAAA,IAAIwD,QAAQ,CAACxD,KAAD,CAAR,KAAoB,KAAxB,EAA+B;AAC7BuD,QAAAA,GAAG,GAAG,KAAN,CAAA;AACA,QAAA,OAAA;AACD,OAAA;;AACD,MAAA,IAAIxU,SAAO,CAACE,SAAR,CAAkB+Q,KAAlB,CAAJ,EAA8B;AAC5BuD,QAAAA,GAAG,GAAGvD,KAAK,CAACM,iBAAN,CAAwBkD,QAAxB,CAAN,CAAA;AACD,OAAA;AACF,KARD,CAAA,CAAA;AASA,IAAA,OAAOD,GAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSE,EAAAA,cAAP,CAAsBhD,SAAtB,EAA2E;AACzE,IAAA,OAAO,KAAKtR,KAAL,CAAWmC,IAAX,CAAiB0O,KAAD,IAAW;AAChC,MAAA,IAAIS,SAAS,CAACT,KAAD,CAAb,EAAsB;AACpB,QAAA,OAAO,IAAP,CAAA;AACD,OAAA;;AACD,MAAA,IAAIjR,SAAO,CAACE,SAAR,CAAkB+Q,KAAlB,CAAJ,EAA8B;AAC5B,QAAA,OAAOA,KAAK,CAACyD,cAAN,CAAqBhD,SAArB,CAAP,CAAA;AACD,OAAA;;AACD,MAAA,OAAO,KAAP,CAAA;AACD,KARM,CAAP,CAAA;AASD,GAAA;AACD;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSiD,EAAAA,iBAAP,CACEjD,SADF,EAEU;AACR,IAAMkD,MAAAA,WAAmB,GAAG,EAA5B,CAAA;AACA,IAAA,IAAA,CAAKxU,KAAL,CAAWkH,OAAX,CAAoB/I,IAAD,IAAU;AAC3B,MAAA,IAAImT,SAAS,CAACnT,IAAD,CAAb,EAAqB;AACnBqW,QAAAA,WAAW,CAAChP,IAAZ,CAAiBrH,IAAjB,CAAA,CAAA;AACD,OAAA;;AACD,MAAIA,IAAAA,IAAI,YAAYyB,SAApB,EAA6B;AAC3B4U,QAAAA,WAAW,CAAChP,IAAZ,CAAiB,GAAGrH,IAAI,CAACoW,iBAAL,CAAuBjD,SAAvB,CAApB,CAAA,CAAA;AACD,OAAA;AACF,KAPD,CAAA,CAAA;AAQA,IAAA,OAAOkD,WAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAESC,EAAAA,cAAP,CACEnD,SADF,EAEe;AACb,IAAInN,IAAAA,KAAkB,GAAG,IAAzB,CAAA;AACA,IAAKgN,IAAAA,CAAAA,iBAAL,CAAwBhT,IAAD,IAAU;AAC/B;AACA,MAAA,IAAImT,SAAS,CAACnT,IAAD,CAAT,IAAmB,CAACgG,KAAxB,EAA+B;AAC7BA,QAAAA,KAAK,GAAGhG,IAAR,CAAA;AACA,QAAA,OAAO,KAAP,CAAA;AACD,OAAA;;AACD,MAAA,OAAO,IAAP,CAAA;AACD,KAPD,CAAA,CAAA;AAQA,IAAA,OAAOgG,KAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSuQ,EAAAA,QAAP,CAAgBvW,IAAhB,EAA6C;AAC3C,IAAA,IAAIA,IAAJ,EAAU;AACR,MAAMgG,MAAAA,KAAK,GAAG,IAAA,CAAKsQ,cAAL,CAAqB5D,KAAD,IAAWA,KAAK,KAAK1S,IAAzC,CAAd,CAAA;;AACA,MAAA,IAAIgG,KAAJ,EAAW;AACT,QAAA,OAAO,IAAP,CAAA;AACD,OAAA;AACF,KAAA;;AACD,IAAA,OAAO,KAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSwQ,EAAAA,WAAP,CAAmB9K,IAAnB,EAA+B1L,IAA/B,EAA2CyW,eAAe,GAAG,KAA7D,EAA0E;AACxE,IAAI5J,IAAAA,CAAC,GAAGnB,IAAR,CAAA;AACA,IAAIY,IAAAA,CAAC,GAAGtM,IAAR,CAAA;;AAEA,IAAIyW,IAAAA,eAAe,IAAIhV,SAAO,CAACE,SAAR,CAAkB3B,IAAlB,CAAvB,EAAgD;AAC9CyP,MAAAA,oBAAoB,CAAC,IAAKe,CAAAA,aAAL,CAAmB9E,IAAnB,CAAD,EAAuC1L,IAAvC,CAApB,CAAA;AACD,KAAA;;AACD,IAAO6M,OAAAA,CAAC,CAAC/K,MAAT,EAAiB;AACf,MAAMsB,MAAAA,KAAK,GAAGyJ,CAAC,CAACA,CAAC,CAAC/K,MAAF,GAAW,CAAZ,CAAf,CAAA;AACA+K,MAAAA,CAAC,GAAGA,CAAC,CAACtJ,KAAF,CAAQ,CAAR,EAAW,CAAC,CAAZ,CAAJ,CAAA;AACA,MAAA,MAAMmT,WAAW,GAAG,IAAA,CAAKlG,aAAL,CAAmB3D,CAAnB,CAApB,CAAA;AACA,MAAMK,MAAAA,MAAM,GAAG2C,aAAa,CAAC6G,WAAD,EAAc,qBAAd,EAAqC7J,CAArC,CAA5B,CAAA;AACA,MAAA,MAAMhL,KAAK,GAAG,CAAC,GAAGqL,MAAM,CAACrL,KAAX,CAAd,CAAA;AACAA,MAAAA,KAAK,CAACuB,KAAD,CAAL,GAAekJ,CAAf,CAAA;AACAA,MAAAA,CAAC,GAAGY,MAAM,CAACvK,GAAP,CAAW,OAAX,EAAoBd,KAApB,CAAJ,CAAA;;AACA,MAAA,IAAI4U,eAAJ,EAAqB;AACnBhH,QAAAA,oBAAoB,CAACvC,MAAD,EAASZ,CAAT,CAApB,CAAA;AACD,OAAA;AACF,KAAA;;AAED,IAAA,OAAOA,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSrG,EAAAA,OAAP,CAAeyF,IAAf,EAA2BjG,MAA3B,EAA2C3D,MAA3C,EAA2De,IAA3D,EAAuE;AACrE,IAAA,MAAMsM,SAAS,GAAG,IAAA,CAAKqB,aAAL,CAAmB9E,IAAnB,CAAlB,CAAA;AACA,IAAM1L,MAAAA,IAAI,GAAG8P,UAAU,CAACX,SAAD,EAAY,iBAAZ,EAA+BzD,IAA/B,CAAvB,CAAA;AACA,IAAA,OAAO,KAAK8K,WAAL,CAAiB9K,IAAjB,EAAuB1L,IAAI,CAACiG,OAAL,CAAaR,MAAb,EAAqB3D,MAArB,EAA6Be,IAA7B,CAAvB,EAA2D,IAA3D,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSsD,EAAAA,UAAP,CAAkBuF,IAAlB,EAA8BjG,MAA9B,EAA8C3D,MAA9C,EAA8De,IAA9D,EAA0E;AACxE,IAAA,MAAM8T,aAAa,GAAG,IAAA,CAAKnG,aAAL,CAAmB9E,IAAnB,CAAtB,CAAA;AACA,IAAMkL,MAAAA,QAAQ,GAAG9G,UAAU,CAAC6G,aAAD,EAAgB,iBAAhB,EAAmCjL,IAAnC,CAA3B,CAAA;AACA,IAAA,OAAO,KAAK8K,WAAL,CACL9K,IADK,EAELkL,QAAQ,CAACzQ,UAAT,CAAoBV,MAApB,EAA4B3D,MAA5B,EAAoCe,IAApC,CAFK,EAGL,IAHK,CAAP,CAAA;AAKD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSuD,EAAAA,OAAP,CACEsF,IADF,EAEEjG,MAFF,EAGE3D,MAHF,EAIEe,IAJF,EAKET,UALF,EAME;AACA,IAAA,MAAM0F,SAAS,GAAG,IAAA,CAAK0I,aAAL,CAAmB9E,IAAnB,CAAlB,CAAA;AACA,IAAMjH,MAAAA,IAAI,GAAGqL,UAAU,CAAChI,SAAD,EAAY,iBAAZ,EAA+B4D,IAA/B,CAAvB,CAAA;AACA,IAAA,OAAO,KAAK8K,WAAL,CACL9K,IADK,EAELjH,IAAI,CAAC2B,OAAL,CAAaX,MAAb,EAAqB3D,MAArB,EAA6Be,IAA7B,EAAmCT,UAAnC,CAFK,EAGL,IAHK,CAAP,CAAA;AAKD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSoI,EAAAA,UAAP,CAAkBkB,IAAlB,EAA8BjG,MAA9B,EAA8ChB,IAA9C,EAA4DC,KAA5D,EAA2E;AACzE,IAAA,MAAMyK,SAAS,GAAG,IAAA,CAAKqB,aAAL,CAAmB9E,IAAnB,CAAlB,CAAA;AACA,IAAM1L,MAAAA,IAAI,GAAG8P,UAAU,CAACX,SAAD,EAAY,oBAAZ,EAAkCzD,IAAlC,CAAvB,CAAA;AACA,IAAA,OAAO,KAAK8K,WAAL,CAAiB9K,IAAjB,EAAuB1L,IAAI,CAACwK,UAAL,CAAgB/E,MAAhB,EAAwBhB,IAAxB,EAA8BC,KAA9B,CAAvB,EAA6D,IAA7D,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSoG,EAAAA,UAAP,CAAkBY,IAAlB,EAA8BjG,MAA9B,EAA8ChB,IAA9C,EAA4D;AAC1D,IAAA,MAAMkS,aAAa,GAAG,IAAA,CAAKnG,aAAL,CAAmB9E,IAAnB,CAAtB,CAAA;AACA,IAAMkL,MAAAA,QAAQ,GAAG9G,UAAU,CAAC6G,aAAD,EAAgB,oBAAhB,EAAsCjL,IAAtC,CAA3B,CAAA;AACA,IAAA,OAAO,IAAK8K,CAAAA,WAAL,CAAiB9K,IAAjB,EAAuBkL,QAAQ,CAAC9L,UAAT,CAAoBrF,MAApB,EAA4BhB,IAA5B,CAAvB,EAA0D,IAA1D,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSoS,EAAAA,UAAP,CAAkBnL,IAAlB,EAA8B1L,IAA9B,EAA0C;AACxC,IAAMoD,MAAAA,KAAK,GAAGsI,IAAI,CAACA,IAAI,CAAC5J,MAAL,GAAc,CAAf,CAAlB,CAAA;AACA,IAAM8P,MAAAA,UAAU,GAAGlG,IAAI,CAACnI,KAAL,CAAW,CAAX,EAAc,CAAC,CAAf,CAAnB,CAAA;AACA,IAAA,MAAMmT,WAAW,GAAG,IAAA,CAAKlG,aAAL,CAAmBoB,UAAnB,CAApB,CAAA;AACA,IAAM1E,MAAAA,MAAM,GAAG2C,aAAa,CAAC6G,WAAD,EAAc,oBAAd,EAAoChL,IAApC,CAA5B,CAAA;AACA,IAAA,MAAM7J,KAAK,GAAG,CAAC,GAAGqL,MAAM,CAACrL,KAAX,CAAd,CAAA;AACAA,IAAAA,KAAK,CAACuF,MAAN,CAAahE,KAAb,EAAoB,CAApB,EAAuBpD,IAAvB,CAAA,CAAA;AACA,IAAA,OAAO,IAAKwW,CAAAA,WAAL,CAAiB5E,UAAjB,EAA6B1E,MAAM,CAACvK,GAAP,CAAW,OAAX,EAAoBd,KAApB,CAA7B,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSiV,EAAAA,UAAP,CAAkBpL,IAAlB,EAA8B;AAC5B,IAAA,MAAM1L,IAAI,GAAG,IAAA,CAAKwQ,aAAL,CAAmB9E,IAAnB,CAAb,CAAA;AACAkE,IAAAA,UAAU,CAAC5P,IAAD,EAAO,oBAAP,EAA6B0L,IAA7B,CAAV,CAAA;AAEA,IAAMtI,MAAAA,KAAK,GAAGsI,IAAI,CAACA,IAAI,CAAC5J,MAAL,GAAc,CAAf,CAAlB,CAAA;AACA,IAAM8P,MAAAA,UAAU,GAAGlG,IAAI,CAACnI,KAAL,CAAW,CAAX,EAAc,CAAC,CAAf,CAAnB,CAAA;AACA,IAAA,MAAMmT,WAAW,GAAG,IAAA,CAAKlG,aAAL,CAAmBoB,UAAnB,CAApB,CAAA;AACA,IAAM1E,MAAAA,MAAM,GAAG2C,aAAa,CAAC6G,WAAD,EAAc,oBAAd,EAAoChL,IAApC,CAA5B,CAAA;AAEA,IAAA,MAAM7J,KAAK,GAAG,CAAC,GAAGqL,MAAM,CAACrL,KAAX,CAAd,CAAA;AACAA,IAAAA,KAAK,CAACuF,MAAN,CAAahE,KAAb,EAAoB,CAApB,CAAA,CAAA;AACA,IAAA,OAAO,IAAKoT,CAAAA,WAAL,CAAiB5E,UAAjB,EAA6B1E,MAAM,CAACvK,GAAP,CAAW,OAAX,EAAoBd,KAApB,CAA7B,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSkV,EAAAA,SAAP,CAAiBrL,IAAjB,EAA6B;AAC3B,IAAA,MAAMsL,MAAM,GAAG,IAAA,CAAKxG,aAAL,CAAmB9E,IAAnB,CAAf,CAAA;AACA,IAAMhI,MAAAA,CAAC,GAAGkM,UAAU,CAACoH,MAAD,EAAS,mBAAT,EAA8BtL,IAA9B,CAApB,CAAA;AAEA,IAAM4F,MAAAA,SAAS,GAAG5F,IAAI,CAACA,IAAI,CAAC5J,MAAL,GAAc,CAAf,CAAtB,CAAA;;AACA,IAAIwP,IAAAA,SAAS,KAAK,CAAlB,EAAqB;AACnB,MAAA,MAAM,IAAIlQ,KAAJ,CACH,CAA2DsC,yDAAAA,EAAAA,CAAE,EAD1D,CAAN,CAAA;AAGD,KAAA;;AAED,IAAA,MAAMuT,QAAQ,GAAGzL,IAAI,CAACa,SAAL,CAAeX,IAAf,CAAjB,CAAA;AACA,IAAA,MAAMwL,MAAM,GAAG,IAAA,CAAK1G,aAAL,CAAmByG,QAAnB,CAAf,CAAA;AACA,IAAME,MAAAA,KAAK,GAAGvH,UAAU,CAACsH,MAAD,EAAS,mBAAT,EAA8BD,QAA9B,CAAxB,CAAA;AACA,IAAA,MAAM3T,CAAC,GAAG6T,KAAK,CAAC5V,SAAN,EAAV,CAAA;;AAEA,IAAA,IAAI+B,CAAC,CAACjC,WAAF,KAAkBqC,CAAC,CAACrC,WAAxB,EAAqC;AACnC,MAAM,MAAA,IAAID,KAAJ,CACH,CAAA,8CAAA,EAAgDkC,CAAE,CAAOI,KAAAA,EAAAA,CAAE,EADxD,CAAN,CAAA;AAGD,KAAA;;AAED,IAAA,MAAM0T,OAAO,GAAG9T,CAAC,CAAC5B,MAAF,EAAA,GACZ4B,CAAC,CAAC0H,SAAF,CAAYtH,CAAZ,CADY,GAEZJ,CAAC,CAACX,GAAF,CAAM,OAAN,EAAe,CAAC,GAAGW,CAAC,CAACzB,KAAN,EAAa,GAAI6B,CAAD,CAAe7B,KAA/B,CAAf,CAFJ,CAAA;AAIA,IAAO,OAAA,IAAA,CAAKiV,UAAL,CAAgBpL,IAAhB,CAAA,CAAsB8K,WAAtB,CAAkCS,QAAlC,EAA4CG,OAA5C,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSC,EAAAA,SAAP,CACE3L,IADF,EAEEP,QAFF,EAGE/I,UAHF,EAIE;AACA,IAAA,MAAM+M,SAAS,GAAG,IAAA,CAAKqB,aAAL,CAAmB9E,IAAnB,CAAlB,CAAA;AACA,IAAMY,MAAAA,CAAC,GAAGsD,UAAU,CAACT,SAAD,EAAY,mBAAZ,EAAiCzD,IAAjC,CAApB,CAAA;AACA,IAAA,MAAM1L,IAAI,GAAGsM,CAAC,CAAC/K,SAAF,EAAb,CAAA;AAEA,IAAA,IAAI+B,CAAJ,CAAA;AACA,IAAA,IAAII,CAAJ,CAAA;;AACA,IAAA,IAAI1D,IAAI,CAAC0B,MAAL,EAAJ,EAAmB;AACjB,MAAC4B,CAAAA,CAAD,EAAII,CAAJ,CAAA,GAAS1D,IAAI,CAACkL,SAAL,CAAeC,QAAf,CAAT,CAAA;AACD,KAFD,MAEO;AACL,MAAM4J,MAAAA,OAAO,GAAG/U,IAAhB,CAAA;AACA,MAAMoL,MAAAA,OAAO,GAAG2J,OAAO,CAAClT,KAAR,CAAc0B,KAAd,CAAoB,CAApB,EAAuB4H,QAAvB,CAAhB,CAAA;AACA,MAAME,MAAAA,MAAM,GAAG0J,OAAO,CAAClT,KAAR,CAAc0B,KAAd,CAAoB4H,QAApB,CAAf,CAAA;AACA7H,MAAAA,CAAC,GAAGyR,OAAO,CAACpS,GAAR,CAAY,OAAZ,EAAqByI,OAArB,CAAJ,CAAA;AACA1H,MAAAA,CAAC,GAAGqR,OAAO,CAACpS,GAAR,CAAY,OAAZ,EAAqB0I,MAArB,CAA6B3C,CAAAA,aAA7B,EAAJ,CAAA;AACD,KAAA;;AAED,IAAItG,IAAAA,UAAU,IAAI,CAACZ,MAAI,CAACE,MAAL,CAAY1B,IAAZ,CAAnB,EAAsC;AACpC0D,MAAAA,CAAC,GAAGA,CAAC,CAAChB,KAAF,CAAQN,UAAR,CAAJ,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,KAAK0U,UAAL,CAAgBpL,IAAhB,CAAA,CAAsBmL,UAAtB,CAAiCnL,IAAjC,EAAuChI,CAAvC,EAA0CmT,UAA1C,CAAqDnL,IAArD,EAA2DpI,CAA3D,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSgU,EAAAA,QAAP,CAAgB5L,IAAhB,EAA4Bc,OAA5B,EAA2C;AACzC,IAAA,MAAM2C,SAAS,GAAG,IAAA,CAAKqB,aAAL,CAAmB9E,IAAnB,CAAlB,CAAA;AACA,IAAM1L,MAAAA,IAAI,GAAG4P,UAAU,CAACT,SAAD,EAAY,kBAAZ,EAAgCzD,IAAhC,CAAvB,CAAA;AAEA,IAAM6L,MAAAA,aAAa,GAAG/K,OAAO,CAACjJ,KAAR,CAAc,CAAd,EAAiB,CAAC,CAAlB,CAAtB,CAAA;AACA,IAAA,MAAMiU,SAAS,GAAG,IAAA,CAAKhH,aAAL,CAAmB+G,aAAnB,CAAlB,CAAA;AACA1H,IAAAA,aAAa,CAAC2H,SAAD,EAAY,kBAAZ,EAAgC9L,IAAhC,CAAb,CAAA;AAEA,IAAM0B,MAAAA,SAAS,GAAG5B,IAAI,CAAC4B,SAAL,CAAe1B,IAAf,EAAqBc,OAArB,CAAlB,CAAA;AACA,IAAMS,MAAAA,SAAS,GAAGzB,IAAI,CAACyB,SAAL,CAAevB,IAAf,EAAqBc,OAArB,CAAlB,CATyC;AAYzC;;AACA,IAAA,IAAIY,SAAS,IAAI,CAACH,SAAlB,EAA6B;AAC3B;AACAT,MAAAA,OAAO,GAAGhB,IAAI,CAACa,SAAL,CAAeG,OAAf,EAAwB,CAAxB,EAA2Bd,IAAI,CAAC5J,MAAL,GAAc,CAAzC,CAAV,CAAA;AACD,KAAA;;AAED,IAAO,OAAA,IAAA,CAAKgV,UAAL,CAAgBpL,IAAhB,CAAA,CAAsBmL,UAAtB,CAAiCrK,OAAjC,EAA0CxM,IAA1C,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSyX,EAAAA,OAAP,CAAe/L,IAAf,EAA2BtJ,UAA3B,EAAyE;AACvE,IAAA,MAAM6N,YAAY,GAAG,IAAA,CAAKO,aAAL,CAAmB9E,IAAnB,CAArB,CAAA;AACA,IAAIqJ,IAAAA,OAAO,GAAGlF,aAAa,CAACI,YAAD,EAAe,iBAAf,EAAkCvE,IAAlC,CAA3B,CAAA;AACAqJ,IAAAA,OAAO,GAAGA,OAAO,CAACrS,KAAR,CAAcN,UAAd,CAAV,CAAA;AACA,IAAO,OAAA,IAAA,CAAKoU,WAAL,CAAiB9K,IAAjB,EAAuBqJ,OAAvB,EAAgC,IAAhC,CAAP,CAAA;AACD,GAAA;;AA15FY;;AClEf;AACA;AACA;AACA;AAQA;AACA;AACA;;AAgBe,MAAM5E,MAAN,SAAqB1O,SAArB,CAA6B;AAC1C,EAAOU,OAAAA,MAAP,CAAcC,UAAd,EAAsE;AACpE,IAAA,IAAI+N,MAAM,CAACD,QAAP,CAAgB9N,UAAhB,CAAJ,EAAiC;AAC/B,MAAA,OAAOA,UAAP,CAAA;AACD,KAAA;;AAED,IAAId,IAAAA,KAAK,GAAGc,UAAZ,CAAA;;AACA,IAAA,IAAI,OAAOd,KAAP,KAAiB,QAArB,EAA+B;AAC7BA,MAAAA,KAAK,GAAG;AAAEJ,QAAAA,IAAI,EAAEI,KAAAA;AAAR,OAAR,CAAA;AACD,KAAA;;AAED,IAAA,IAAIH,iCAAa,CAACG,KAAD,CAAjB,EAA0B;AACxB,MAAM,MAAA;AACJJ,QAAAA,IADI;AAEJP,QAAAA,GAAG,GAAGgG,QAAQ,CAACxE,MAAT,EAFF;AAGJG,QAAAA,IAAI,GAAG,EAHH;AAIJT,QAAAA,KAAK,GAAG,CAACL,MAAI,CAACW,MAAL,EAAD,CAAA;AAJJ,OAAA,GAKFb,KALJ,CAAA;;AAOA,MAAA,IAAI,OAAOJ,IAAP,KAAgB,QAApB,EAA8B;AAC5B,QAAA,MAAM,IAAIE,KAAJ,CAAU,2CAAV,CAAN,CAAA;AACD,OAAA;;AAED,MAAO,OAAA,IAAI+O,MAAJ,CAAW;AAChBjP,QAAAA,IADgB;AAEhBP,QAAAA,GAFgB;AAGhB2B,QAAAA,IAHgB;AAIhBT,QAAAA,KAAAA;AAJgB,OAAX,CAAP,CAAA;AAMD,KAAA;;AAED,IAAA,MAAM,IAAIT,KAAJ,CACH,CAA+EE,6EAAAA,EAAAA,KAAM,EADlF,CAAN,CAAA;AAGD,GAAA;;AAED,EAAOoW,OAAAA,aAAP,CAAqB1X,IAArB,EAAkD;AAChD,IAAM,MAAA;AAAEgD,MAAAA,KAAAA;AAAF,KAAA,GAAYhD,IAAlB,CAAA;;AACA,IAAIgD,IAAAA,KAAK,KAAK,QAAd,EAAwB;AACtB,MAAA,OAAOmN,MAAM,CAAC5N,QAAP,CAAgBvC,IAAhB,CAAP,CAAA;AACD,KAAA;;AACD,IAAIgD,IAAAA,KAAK,KAAK,MAAd,EAAsB;AACpB,MAAA,OAAOxB,MAAI,CAACe,QAAL,CAAcvC,IAAd,CAAP,CAAA;AACD,KAAA;;AAED,IAAA,MAAM,IAAIoB,KAAJ,CACJ,sEADI,CAAN,CAAA;AAGD,GAAA;;AAED,EAAOmB,OAAAA,QAAP,CAAgBC,IAAhB,EAA0C;AACxC,IAAM,MAAA;AAAEX,MAAAA,KAAAA;AAAF,KAAA,GAAYW,IAAlB,CAAA;AACA,IAAA,OAAO2N,MAAM,CAAChO,MAAP,CAAc,EACnB,GAAGK,IADgB;AAEnBX,MAAAA,KAAK,EAAEA,KAAK,GAAGA,KAAK,CAAC8C,GAAN,CAAUwL,MAAM,CAACuH,aAAjB,CAAH,GAAqC9S,SAAAA;AAF9B,KAAd,CAAP,CAAA;AAID,GAAA;;AAED,EAAOsL,OAAAA,QAAP,CAAgByH,WAAhB,EAAyD;AACvD,IAAOA,OAAAA,WAAW,YAAYxH,MAA9B,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACE,EAAO0F,OAAAA,YAAP,CAAoB+B,eAApB,EAAqE;AACnE,IAAA,IAAI,CAAC,IAAK1H,CAAAA,QAAL,CAAc0H,eAAd,CAAL,EAAqC;AACnC,MAAA,OAAO,KAAP,CAAA;AACD,KAAA;;AACD,IAAA,KAAK,MAAMlF,KAAX,IAAoBkF,eAAe,CAAC/V,KAApC,EAA2C;AACzC,MAAA,IAAI6Q,KAAK,CAAC/Q,SAAN,EAAJ,EAAuB;AACrB,QAAA,OAAO,KAAP,CAAA;AACD,OAAA;AACF,KAAA;;AACD,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AAESN,EAAAA,WAAV,CAAsBC,KAAtB,EAAyD;AACvD,IAAA,KAAA,CAAMA,KAAN,CAAA,CAAA;AADuD,IAAA,IAAA,CAQzCJ,IARyC,GAAA,KAAA,CAAA,CAAA;AAAA,IAAA,IAAA,CAUzCW,KAVyC,GAAA,KAAA,CAAA,CAAA;AAEvD,IAAM,MAAA;AAAEX,MAAAA,IAAF;AAAQW,MAAAA,KAAAA;AAAR,KAAA,GAAkBP,KAAxB,CAAA;AACA,IAAKJ,IAAAA,CAAAA,IAAL,GAAYA,IAAZ,CAAA;AACA,IAAKW,IAAAA,CAAAA,KAAL,GAAaA,KAAb,CAAA;AACA,IAAA,IAAA,CAAKhB,MAAL,EAAA,CAAA;AACD,GAAA;;AAMM6B,EAAAA,KAAP,CAAapB,KAAb,EAA+C;AAC7C,IAAO,OAAA,IAAI6O,MAAJ,CAAW;AAChBjP,MAAAA,IAAI,EAAE,IAAA,CAAKA,IADK;AAEhBP,MAAAA,GAAG,EAAE,IAAA,CAAKA,GAFM;AAGhB2B,MAAAA,IAAI,EAAE,IAAA,CAAKA,IAHK;AAIhBT,MAAAA,KAAK,EAAE,IAAA,CAAKA,KAJI;AAKhB,MAAGP,GAAAA,KAAAA;AALa,KAAX,CAAP,CAAA;AAOD,GAAA;;AAEMqB,EAAAA,GAAP,CACEhC,GADF,EAEEC,KAFF,EAGE;AACA,IAAO,OAAA,IAAA,CAAK8B,KAAL,CAAW;AAChB,MAAA,CAAC/B,GAAD,GAAOC,KAAAA;AADS,KAAX,CAAP,CAAA;AAGD,GAAA;;AAEMmC,EAAAA,MAAP,CAAcqF,OAAd,EAA0C;AACxC,IAAA,MAAMkD,MAAkB,GAAG;AACzBtI,MAAAA,KAAK,EAAE,QADkB;AAEzB9B,MAAAA,IAAI,EAAE,IAAA,CAAKA,IAFc;AAGzBoB,MAAAA,IAAI,EAAE,EAAE,GAAG,IAAKA,CAAAA,IAAAA;AAAV,OAHmB;AAIzBT,MAAAA,KAAK,EAAE,IAAKA,CAAAA,KAAL,CAAW8C,GAAX,CAAgB3E,IAAD,IAAUA,IAAI,CAAC+C,MAAL,CAAYqF,OAAZ,CAAzB,CAAA;AAJkB,KAA3B,CAAA;;AAMA,IAAIA,IAAAA,OAAO,EAAEmD,YAAb,EAA2B;AACzBD,MAAAA,MAAM,CAAC3K,GAAP,GAAa,KAAKA,GAAlB,CAAA;AACD,KAAA;;AACD,IAAA,OAAO2K,MAAP,CAAA;AACD,GAAA;;AAvHyC;;AC7B5C;AACA;AACA;AACA;AAmCe,MAAM0E,KAAN,SAAgEvO,SAAhE,CAA8E;AAG3F,EAAOU,OAAAA,MAAP,CACEC,UADF,EAEE;AACA,IAAA,IAAI4N,KAAK,CAACI,OAAN,CAAchO,UAAd,CAAJ,EAA+B;AAC7B,MAAA,OAAOA,UAAP,CAAA;AACD,KAAA;;AAED,IAAA,MAAMd,KAA8B,GAAG,OAAOc,UAAP,KAAsB,QAAtB,GAAiC;AAAElB,MAAAA,IAAI,EAAEkB,UAAAA;AAAR,KAAjC,GAAwDA,UAA/F,CAAA;;AAEA,IAAA,IAAIjB,iCAAa,CAACG,KAAD,CAAjB,EAA0B;AACxB,MAAM,MAAA;AACJJ,QAAAA,IADI;AAEJP,QAAAA,GAAG,GAAGgG,QAAQ,CAACxE,MAAT,EAFF;AAGJG,QAAAA,IAHI;AAIJT,QAAAA,KAAK,GAAG,CAACL,MAAI,CAACW,MAAL,EAAD,CAAA;AAJJ,OAAA,GAKFb,KALJ,CAAA;;AAOA,MAAA,IAAI,OAAOJ,IAAP,KAAgB,QAApB,EAA8B;AAC5B,QAAA,MAAM,IAAIE,KAAJ,CAAU,0CAAV,CAAN,CAAA;AACD,OAAA;;AAED,MAAO,OAAA,IAAI4O,KAAJ,CAAkB;AACvB9O,QAAAA,IADuB;AAEvBP,QAAAA,GAFuB;AAGvB2B,QAAAA,IAAI,EAAEA,IAHiB;AAIvBT,QAAAA,KAAAA;AAJuB,OAAlB,CAAP,CAAA;AAMD,KAAA;;AAED,IAAA,MAAM,IAAIT,KAAJ,CACH,CAA8EE,4EAAAA,EAAAA,KAAM,EADjF,CAAN,CAAA;AAGD,GAAA;;AAED,EAAOoW,OAAAA,aAAP,CAAqB1X,IAArB,EAA8D;AAC5D,IAAM,MAAA;AAAEgD,MAAAA,KAAAA;AAAF,KAAA,GAAYhD,IAAlB,CAAA;;AACA,IAAIgD,IAAAA,KAAK,KAAK,OAAd,EAAuB;AACrB,MAAA,OAAOgN,KAAK,CAACzN,QAAN,CAAevC,IAAf,CAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAOmQ,MAAM,CAACuH,aAAP,CAAqB1X,IAArB,CAAP,CAAA;AACD,GAAA;;AAED,EAAOuC,OAAAA,QAAP,CAAgBC,IAAhB,EAAiC;AAC/B,IAAM,MAAA;AAAEX,MAAAA,KAAAA;AAAF,KAAA,GAAYW,IAAlB,CAAA;AACA,IAAA,OAAOwN,KAAK,CAAC7N,MAAN,CAAa,EAClB,GAAGK,IADe;AAElB;AACAX,MAAAA,KAAK,EAAEA,KAAK,GAAGA,KAAK,CAAC8C,GAAN,CAAUqL,KAAK,CAAC0H,aAAhB,CAAH,GAAoC7V,KAAAA;AAH9B,KAAb,CAAP,CAAA;AAKD,GAAA;;AAED,EAAOuO,OAAAA,OAAP,CAAeyH,UAAf,EAAqD;AACnD,IAAOA,OAAAA,UAAU,YAAY7H,KAA7B,CAAA;AACD,GAAA;;AAED,EAAO8H,OAAAA,QAAP,CAAgBC,WAAhB,EAA4D;AAC1D,IAAA,OAAOA,WAAW,CAACpU,KAAZ,CAAkBqM,KAAK,CAACI,OAAxB,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACE,EAAO4H,OAAAA,WAAP,CAAmBC,cAAnB,EAAiD;AAC/C,IAAM,MAAA;AAAEpW,MAAAA,KAAAA;AAAF,KAAA,GAAYoW,cAAlB,CAAA;;AAEA,IAAA,IAAI,CAAC,IAAK7H,CAAAA,OAAL,CAAa6H,cAAb,CAAL,EAAmC;AACjC,MAAA,OAAO,KAAP,CAAA;AACD,KAAA;;AAED,IAAA,IAAI,CAACpW,KAAK,CAACC,MAAX,EAAmB;AACjB,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AAED,IAAA,MAAMwI,KAAK,GAAGzI,KAAK,CAAC,CAAD,CAAnB,CAAA;AACA,IAAA,OAAO,CAAC,IAAA,CAAKuO,OAAL,CAAa9F,KAAb,CAAR,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACE,EAAc4N,OAAAA,SAAd,CAAwBrW,KAAxB,EAAgD;AAC9C,IAAOA,OAAAA,KAAK,CAACsC,MAAN,CAAa,CAACgU,KAAD,EAAQzF,KAAR,KAAkB;AACpC,MAAA,IAAI,CAAC1C,KAAK,CAACI,OAAN,CAAcsC,KAAd,CAAL,EAA2B;AACzB,QAAA,OAAOyF,KAAP,CAAA;AACD,OAAA;;AACD,MAAA,IAAI,CAACnI,KAAK,CAACgI,WAAN,CAAkBtF,KAAlB,CAAL,EAA+B;AAC7B,QAAOyF,OAAAA,KAAK,CAAC1O,MAAN,CAAaiJ,KAAK,CAACwF,SAAN,EAAb,CAAP,CAAA;AACD,OAAA;;AACDC,MAAAA,KAAK,CAAC9Q,IAAN,CAAWqL,KAAX,CAAA,CAAA;AAEA,MAAA,OAAOyF,KAAP,CAAA;AACD,KAVM,EAUJ,EAVI,CAAP,CAAA;AAWD,GAAA;AAED;AACF;AACA;;;AACE,EAAA,OAAcC,eAAd,CAA8BvW,KAA9B,EAA6CX,IAA7C,EAAoE;AAClE,IAAOW,OAAAA,KAAK,CAACsC,MAAN,CAAa,CAACgU,KAAD,EAAiBnY,IAAjB,KAAgC;AAClD,MAAA,IAAI,CAACgQ,KAAK,CAACI,OAAN,CAAcpQ,IAAd,CAAL,EAA0B;AACxB,QAAA,OAAOmY,KAAP,CAAA;AACD,OAFD,MAEO,IAAInI,KAAK,CAACgI,WAAN,CAAkBhY,IAAlB,CAAA,IAA2BA,IAAI,CAACkB,IAAL,KAAcA,IAA7C,EAAmD;AACxDiX,QAAAA,KAAK,CAAC9Q,IAAN,CAAWrH,IAAX,CAAA,CAAA;AACA,QAAA,OAAOmY,KAAP,CAAA;AACD,OAHM,MAGA;AACL,QAAOA,OAAAA,KAAK,CAAC1O,MAAN,CAAazJ,IAAI,CAACoY,eAAL,CAAqBlX,IAArB,CAAb,CAAP,CAAA;AACD,OAAA;AACF,KATM,EASJ,EATI,CAAP,CAAA;AAUD,GAAA;;AAESG,EAAAA,WAAV,CAAsBC,KAAtB,EAA8D;AAC5D,IAAA,KAAA,CAAMA,KAAN,CAAA,CAAA;AAD4D,IAAA,IAAA,CAO9CJ,IAP8C,GAAA,KAAA,CAAA,CAAA;AAE5D,IAAM,MAAA;AAAEA,MAAAA,IAAAA;AAAF,KAAA,GAAWI,KAAjB,CAAA;AACA,IAAKJ,IAAAA,CAAAA,IAAL,GAAYA,IAAZ,CAAA;AACA,IAAA,IAAA,CAAKL,MAAL,EAAA,CAAA;AACD,GAAA;;AAIM6B,EAAAA,KAAP,CAAapB,KAAb,EAAoD;AAClD,IAAO,OAAA,IAAI0O,KAAJ,CAAgB;AACrB9O,MAAAA,IAAI,EAAE,IAAA,CAAKA,IADU;AAErBP,MAAAA,GAAG,EAAE,IAAA,CAAKA,GAFW;AAGrB2B,MAAAA,IAAI,EAAE,IAAA,CAAKA,IAHU;AAIrBT,MAAAA,KAAK,EAAE,IAAA,CAAKA,KAJS;AAKrB,MAAGP,GAAAA,KAAAA;AALkB,KAAhB,CAAP,CAAA;AAOD,GAAA;;AAEMqB,EAAAA,GAAP,CACEhC,GADF,EAEEC,KAFF,EAGE;AACA,IAAO,OAAA,IAAA,CAAK8B,KAAL,CAAW;AAChB,MAAA,CAAC/B,GAAD,GAAOC,KAAAA;AADS,KAAX,CAAP,CAAA;AAGD,GAAA;AAED;AACF;AACA;;;AACSyX,EAAAA,gBAAP,GAA0B;AACxB,IAAA,OAAO,IAAKxW,CAAAA,KAAL,CAAWmC,IAAX,CAAiBN,CAAD,IAAOsM,KAAK,CAACI,OAAN,CAAc1M,CAAd,CAAvB,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACSwU,EAAAA,SAAP,GAA4B;AAC1B,IAAA,OAAOlI,KAAK,CAACkI,SAAN,CAAgB,IAAA,CAAKrW,KAArB,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACSuW,EAAAA,eAAP,CAAuBlX,IAAvB,EAA8C;AAC5C,IAAO8O,OAAAA,KAAK,CAACoI,eAAN,CAAsB,KAAKvW,KAA3B,EAAkCX,IAAlC,CAAP,CAAA;AACD,GAAA;;AAEM6B,EAAAA,MAAP,CAAcqF,OAAd,EAA0C;AACxC,IAAA,MAAMkD,MAAiB,GAAG;AACxBtI,MAAAA,KAAK,EAAE,OADiB;AAExB9B,MAAAA,IAAI,EAAE,IAAA,CAAKA,IAFa;AAGxBoB,MAAAA,IAAI,EAAE,EAAE,GAAG,IAAKA,CAAAA,IAAAA;AAAV,OAHkB;AAIxBT,MAAAA,KAAK,EAAE,IAAKA,CAAAA,KAAL,CAAW8C,GAAX,CAAgB3E,IAAD,IAAUA,IAAI,CAAC+C,MAAL,CAAYqF,OAAZ,CAAzB,CAAA;AAJiB,KAA1B,CAAA;;AAOA,IAAIA,IAAAA,OAAO,EAAEmD,YAAb,EAA2B;AACzBD,MAAAA,MAAM,CAAC3K,GAAP,GAAa,KAAKA,GAAlB,CAAA;AACD,KAAA;;AACD,IAAA,OAAO2K,MAAP,CAAA;AACD,GAAA;;AA9K0F,CAAA;AAAxE0E,MACHsI,eAAe;;ACvCjC;AACA;AACA;AACA;;AAYA;AACA;AACA;;AAyBA;AACA;AACA;AAmFYC,6BAAZ;;WAAYA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,CAAAA,EAAAA,wBAAAA;;AAOZ,IAAYC,iBAAZ,CAAA;;WAAYA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,CAAAA,EAAAA,sBAAAA;;ACjIZ;AACA;AACA;AACA;AACA;AACA;AACA;;AACe,SAASC,OAAT,CACbC,UADa,EAEbC,MAFa,EAGbC,WAHa,EAIbC,QAJa,EAKb;AACAC,EAAAA,eAAS,CAAC,MAAM;AACd,IAAA,IAAI,CAACJ,UAAU,CAACK,UAAZ,IAA0BF,QAA9B,EAAwC;AACtC,MAAO,OAAA,MAAM,EAAb,CAAA;AACD,KAAA;;AAED,IAAMG,MAAAA,YAAY,GAAIC,IAAD,IAAU;AAC7B,MAAA,IAAIL,WAAW,IAAIF,UAAU,CAACE,WAAX,KAA2BA,WAA9C,EAA2D;AACzD,QAAA,OAAA;AACD,OAAA;;AAEDD,MAAAA,MAAM,CAACM,IAAD,CAAN,CAAA;AACD,KAND,CAAA;;AAQA,IAAMC,MAAAA,GAAG,GAAGR,UAAU,CAACS,KAAX,CAAiBC,SAAjB,CAA2BJ,YAA3B,CAAZ,CAAA;AACA,IAAA,OAAO,MAAM;AACXE,MAAAA,GAAG,CAACG,WAAJ,EAAA,CAAA;AACD,KAFD,CAAA;AAGD,GAjBQ,EAiBN,CAACX,UAAD,EAAaC,MAAb,EAAqBC,WAArB,EAAkCC,QAAlC,CAjBM,CAAT,CAAA;AAkBD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASS,4BAAT,CACLZ,UADK,EAELa,eAFK,EAGLX,WAHK,EAILC,QAJK,EAKL;AACA,EAAA,MAAMW,MAAM,GAAGC,yBAAK,CAACC,MAAN,CAA4B,IAA5B,CAAf,CAAA;AACA,EAAA,MAAMf,MAAM,GAAGgB,iBAAW,CACvBV,IAAD,IAAiB;AACfO,IAAAA,MAAM,CAACI,OAAP,GAAiBhb,MAAM,CAACib,qBAAP,CAA6B,MAAM;AAClDN,MAAAA,eAAe,CAACN,IAAD,CAAf,CAAA;AACD,KAFgB,CAAjB,CAAA;AAGD,GALuB,EAMxB,CAACM,eAAD,CANwB,CAA1B,CAAA;AASAE,EAAAA,yBAAK,CAACX,SAAN,CAAgB,MAAM;AACpB,IAAA,OAAO,MAAM;AACX,MAAIU,IAAAA,MAAM,CAACI,OAAX,EAAoB;AAClBhb,QAAAA,MAAM,CAACkb,oBAAP,CAA4BN,MAAM,CAACI,OAAnC,CAAA,CAAA;AACD,OAAA;AACF,KAJD,CAAA;AAKD,GAND,EAMG,EANH,CAAA,CAAA;AAQAnB,EAAAA,OAAO,CAACC,UAAD,EAAaC,MAAb,EAAqBC,WAArB,EAAkCC,QAAlC,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;;AACO,SAASkB,gBAAT,CACLrB,UADK,EAELC,MAFK,EAGL;AACAF,EAAAA,OAAO,CAACC,UAAD,EAAaC,MAAb,EAAqBJ,mBAAW,CAACyB,SAAjC,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;;AACO,SAASC,qCAAT,CACLvB,UADK,EAELa,eAFK,EAGL;AACAD,EAAAA,4BAA4B,CAACZ,UAAD,EAAaa,eAAb,EAA8BhB,mBAAW,CAACyB,SAA1C,CAA5B,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;;AACO,SAASE,eAAT,CACLxB,UADK,EAELC,MAFK,EAGL;AACAF,EAAAA,OAAO,CAACC,UAAD,EAAaC,MAAb,EAAqBJ,mBAAW,CAAC4B,KAAjC,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;;AACO,SAASC,oCAAT,CACL1B,UADK,EAELa,eAFK,EAGL;AACAD,EAAAA,4BAA4B,CAACZ,UAAD,EAAaa,eAAb,EAA8BhB,mBAAW,CAAC4B,KAA1C,CAA5B,CAAA;AACD;;ACtID;AACA;AACA;AACA;AAOA,MAAME,cAAc,GAAG,OAAOC,KAAP,KAAiB,WAAxC,CAAA;;AAOA;AACA;AACA;AACA;AACA;AACe,SAASC,aAAT,CAAuBnS,OAAvB,EAAuD;AACpE,EAAM,MAAA;AAAEoS,IAAAA,UAAU,GAAG,CAAA;AAAf,GAAqBpS,GAAAA,OAAO,IAAI,EAAtC,CAAA;AACA,EAAA,MAAMqS,OAAO,GAAGhB,gBAAK,CAACiB,UAAN,CAAiBC,iBAAjB,CAAhB,CAAA;;AACA,EAAI,IAAA,CAACF,OAAL,EAAc;AACZ,IAAA,MAAM,IAAIrZ,KAAJ,CACJ,0FADI,CAAN,CAAA;AAGD,GAAA;;AAED,EAAA,MAAMwZ,WAAW,GAAGnB,gBAAK,CAACC,MAAN,CAAa,IAAb,CAApB,CAAA;AACAkB,EAAAA,WAAW,CAAChB,OAAZ,GAAsB,IAAtB,CAAA;AACAH,EAAAA,gBAAK,CAACoB,eAAN,CAAsB,MAAM;AAC1BD,IAAAA,WAAW,CAAChB,OAAZ,GAAsB,KAAtB,CAAA;AACD,GAFD,CAAA,CAAA;AAIA,EAAA,MAAM,GAAGkB,WAAH,CAAkBrB,GAAAA,gBAAK,CAACsB,UAAN,CAAkBC,CAAD,IAAOA,CAAC,GAAG,CAA5B,EAA+B,CAA/B,CAAxB,CAAA;AACA,EAAA,MAAMC,gBAAgB,GAAGxB,gBAAK,CAACC,MAAN,CAAa,KAAb,CAAzB,CAAA;AACA,EAAA,MAAMwB,iBAAiB,GAAGzB,gBAAK,CAACC,MAAN,CAA2B,IAA3B,CAA1B,CAAA;AACA,EAAMhB,MAAAA,UAAU,GAAGe,gBAAK,CAAC0B,OAAN,CAAc,MAC/B,CAACd,cAAD,GACII,OAAO,CAAC/B,UADZ,GAEI,IAAI4B,KAAJ,CAAUG,OAAO,CAAC/B,UAAlB,EAA8B;AAC5BrQ,IAAAA,GAAG,CAAC+S,IAAD,EAAOC,IAAP,EAAa;AACd,MAAA,IAAIA,IAAI,KAAK,OAAT,IAAoBT,WAAW,CAAChB,OAApC,EAA6C;AAC3CqB,QAAAA,gBAAgB,CAACrB,OAAjB,GAA2B,IAA3B,CAAA;AACAsB,QAAAA,iBAAiB,CAACtB,OAAlB,GAA4BwB,IAAI,CAACC,IAAD,CAAhC,CAAA;AACD,OAAA;;AACD,MAAOD,OAAAA,IAAI,CAACC,IAAD,CAAX,CAAA;AACD,KAAA;;AAP2B,GAA9B,CAHa,EAYjB,CAACZ,OAAO,CAAC/B,UAAT,CAZiB,CAAnB,CAAA;AAeA,EAAA,MAAM4C,iBAAiB,GAAG7B,gBAAK,CAAC0B,OAAN,CAAc,MAAM;AAC5C,IAAA,IAAII,MAAM,CAACC,QAAP,CAAgBhB,UAAhB,CAAJ,EAAiC;AAC9B,MAAA,OAAOiB,eAAQ,CAACX,WAAD,EAAcN,UAAd,CAAf,CAAA;AACF,KAAA;;AACD,IAAA,OAAOkB,WAAP,CAAA;AACD,GALyB,EAKvB,CAAClB,UAAD,CALuB,CAA1B,CAAA;AAQAf,EAAAA,gBAAK,CAACX,SAAN,CAAgB,MAAM;AACpB,IAAMI,MAAAA,GAAG,GAAGuB,OAAO,CAACkB,OAAR,CAAgBvC,SAAhB,CAA0B,MAAM;AAC1C,MAAA,IACE,CAAC,CAACiB,cAAD,IAAmBY,gBAAgB,CAACrB,OAArC,KACKa,OAAO,CAAC/B,UAAR,CAAmB9X,KAAnB,KAA6Bsa,iBAAiB,CAACtB,OAFtD,EAGE;AACAkB,QAAAA,WAAW,EAAA,CAAA;AACZ,OAAA;AACF,KAPW,CAAZ,CAAA;AAQA,IAAO5B,OAAAA,GAAG,CAACG,WAAX,CAAA;AACD,GAVD,EAUG,CAACoB,OAAD,CAVH,CAAA,CAAA;AAYAhC,EAAAA,OAAO,CAACC,UAAD,EAAa4C,iBAAb,CAAP,CAAA;AAEA,EAAA,OAAO5C,UAAP,CAAA;AACD;;;AClEc,SAASkD,iBAAT,CACbC,SADa,EAEb;AACA,EAAA,OAAQva,KAAD,IAAkC;AACvC,IAAA,MAAMoX,UAAU,GAAG6B,aAAa,EAAhC,CADuC;;AAGvC,IAAO,oBAAAuB,gBAAA,CAAC,SAAD,EAAAC,4BAAA,CAAA,EAAA,EAAeza,KAAf,EAAA;AAAsB,MAAA,UAAU,EAAEoX,UAAAA;AAAlC,KAAP,CAAA,CAAA,CAAA;AACD,GAJD,CAAA;AAKD;;ACpBD;AACA;AACA;AACA;AAYYsD,+BAAZ;;WAAYA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,CAAAA,EAAAA,0BAAAA;;AA+GZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,MAAT,CAAgB/N,SAAhB,EAAiD;AAC/C,EAAM,MAAA;AAAEhN,IAAAA,IAAAA;AAAF,GAAA,GAAWgN,SAAjB,CAAA;;AACA,EAAIhN,IAAAA,IAAI,KAAK,UAAb,EAAyB;AACvB,IAAO,OAAA,EACL,GAAGgN,SADE;AAELhN,MAAAA,IAAI,EAAE,aAAA;AAFD,KAAP,CAAA;AAID,GAAA;;AACD,EAAIA,IAAAA,IAAI,KAAK,aAAb,EAA4B;AAC1B,IAAO,OAAA,EACL,GAAGgN,SADE;AAELhN,MAAAA,IAAI,EAAE,aAAA;AAFD,KAAP,CAAA;AAID,GAAA;;AACD,EAAIA,IAAAA,IAAI,KAAK,aAAb,EAA4B;AAC1B,IAAO,OAAA,EACL,GAAGgN,SADE;AAELhN,MAAAA,IAAI,EAAE,aAAA;AAFD,KAAP,CAAA;AAID,GAAA;;AACD,EAAIA,IAAAA,IAAI,KAAK,YAAb,EAA2B;AACzB,IAAM,MAAA;AAAEwK,MAAAA,IAAAA;AAAF,KAAA,GAAWwC,SAAjB,CAAA;AACA,IAAA,MAAMgO,YAAY,GAAG1Q,IAAI,CAACa,SAAL,CAAeX,IAAf,CAArB,CAAA;AACA,IAAO,OAAA,EACL,GAAGwC,SADE;AAELhN,MAAAA,IAAI,EAAE,YAFD;AAGLwK,MAAAA,IAAI,EAAEwQ,YAAAA;AAHD,KAAP,CAAA;AAKD,GAAA;;AACD,EAAIhb,IAAAA,IAAI,KAAK,WAAb,EAA0B;AACxB,IAAM,MAAA;AAAEwK,MAAAA,IAAF;AAAQc,MAAAA,OAAAA;AAAR,KAAA,GAAoB0B,SAA1B,CAAA;;AACA,IAAI1C,IAAAA,IAAI,CAAC5I,OAAL,CAAa8I,IAAb,EAAmBc,OAAnB,CAAJ,EAAiC;AAC/B,MAAA,OAAO0B,SAAP,CAAA;AACD,KAAA;;AAED,IAAIgO,IAAAA,YAAY,GAAG1P,OAAnB,CAAA;AACA,IAAI2P,IAAAA,eAAe,GAAGzQ,IAAtB,CAAA;AAEA,IAAMuB,MAAAA,SAAS,GAAGzB,IAAI,CAACyB,SAAL,CAAevB,IAAf,EAAqBc,OAArB,CAAlB,CATwB;AAWxB;AACA;AACA;AACA;;AACA,IAAI,IAAA,CAACS,SAAL,EAAgB;AACd,MAAMG,MAAAA,SAAS,GAAG5B,IAAI,CAAC4B,SAAL,CAAe1B,IAAf,EAAqBc,OAArB,CAAlB,CAAA;AACA,MAAM4P,MAAAA,iBAAiB,GAAG5Q,IAAI,CAAC4B,SAAL,CAAe8O,YAAf,EAA6BC,eAA7B,CAA1B,CAAA;AACA,MAAME,MAAAA,kBAAkB,GAAG7Q,IAAI,CAACoB,UAAL,CAAgBsP,YAAhB,EAA8BC,eAA9B,CAA3B,CAAA;;AAEA,MAAA,IAAI/O,SAAJ,EAAe;AACb8O,QAAAA,YAAY,GAAG1Q,IAAI,CAACa,SAAL,CAAeG,OAAf,EAAwB,CAAxB,EAA2Bd,IAAI,CAAC5J,MAAL,GAAc,CAAzC,CAAf,CAAA;AACD,OAFD,MAEO,IAAIsa,iBAAiB,IAAIC,kBAAzB,EAA6C;AAClDF,QAAAA,eAAe,GAAG3Q,IAAI,CAACe,SAAL,CAAeb,IAAf,EAAqB,CAArB,EAAwBc,OAAO,CAAC1K,MAAR,GAAiB,CAAzC,CAAlB,CAAA;AACD,OAAA;AACF,KAAA;;AAED,IAAO,OAAA,EACL,GAAGoM,SADE;AAELxC,MAAAA,IAAI,EAAEwQ,YAFD;AAGL1P,MAAAA,OAAO,EAAE2P,eAAAA;AAHJ,KAAP,CAAA;AAKD,GAAA;;AACD,EAAIjb,IAAAA,IAAI,KAAK,aAAb,EAA4B;AAC1B,IAAO,OAAA,EACL,GAAGgN,SADE;AAELhN,MAAAA,IAAI,EAAE,UAAA;AAFD,KAAP,CAAA;AAID,GAAA;;AACD,EAAIA,IAAAA,IAAI,KAAK,aAAb,EAA4B;AAC1B,IAAO,OAAA,EACL,GAAGgN,SADE;AAELhN,MAAAA,IAAI,EAAE,aAAA;AAFD,KAAP,CAAA;AAID,GAAA;;AACD,EAAIA,IAAAA,IAAI,KAAK,aAAb,EAA4B;AAC1B,IAAO,OAAA,EACL,GAAGgN,SADE;AAELhN,MAAAA,IAAI,EAAE,aAAA;AAFD,KAAP,CAAA;AAID,GAAA;;AACD,EAAIA,IAAAA,IAAI,KAAK,UAAb,EAAyB;AACvB,IAAM,MAAA;AAAE2B,MAAAA,IAAF;AAAQT,MAAAA,UAAAA;AAAR,KAAA,GAAuB8L,SAA7B,CAAA;AACA,IAAA,MAAMoO,YAAY,GAAGzZ,IAAI,CAACH,KAAL,CAAWN,UAAX,CAArB,CAAA;AACA,IAAA,MAAMma,kBAAkB,GAAGhc,MAAM,CAACic,IAAP,CAAYpa,UAAZ,CAAA,CAAwB+B,MAAxB,CACzB,CAAC0I,CAAD,EAAIlM,GAAJ,MAAa,EAAE,GAAGkM,CAAL;AAAQ,MAAA,CAAClM,GAAD,GAAOkC,IAAI,CAAClC,GAAD,CAAA;AAAnB,KAAb,CADyB,EAEzB,EAFyB,CAA3B,CAAA;AAIA,IAAO,OAAA,EACL,GAAGuN,SADE;AAELrL,MAAAA,IAAI,EAAEyZ,YAFD;AAGLla,MAAAA,UAAU,EAAEma,kBAAAA;AAHP,KAAP,CAAA;AAKD,GAAA;;AACD,EAAIrb,IAAAA,IAAI,KAAK,UAAb,EAAyB;AACvB,IAAM,MAAA;AAAEkB,MAAAA,UAAF;AAAcqa,MAAAA,cAAAA;AAAd,KAAA,GAAiCvO,SAAvC,CAAA;AACA,IAAO,OAAA,EACL,GAAGA,SADE;AAEL9L,MAAAA,UAAU,EAAEqa,cAAc,IAAI,EAFzB;AAGLA,MAAAA,cAAc,EAAEra,UAAAA;AAHX,KAAP,CAAA;AAKD,GAAA;;AACD,EAAIlB,IAAAA,IAAI,KAAK,eAAb,EAA8B;AAC5B,IAAM,MAAA;AAAE8Y,MAAAA,SAAF;AAAa0C,MAAAA,aAAAA;AAAb,KAAA,GAA+BxO,SAArC,CAAA;AACA,IAAO,OAAA,EACL,GAAGA,SADE;AAEL8L,MAAAA,SAAS,EAAE0C,aAFN;AAGLA,MAAAA,aAAa,EAAE1C,SAAAA;AAHV,KAAP,CAAA;AAKD,GAAA;;AACD,EAAI9Y,IAAAA,IAAI,KAAK,YAAb,EAA2B;AACzB,IAAM,MAAA;AAAEwK,MAAAA,IAAAA;AAAF,KAAA,GAAWwC,SAAjB,CAAA;AACA,IAAA,MAAMgO,YAAY,GAAG1Q,IAAI,CAACe,SAAL,CAAeb,IAAf,CAArB,CAAA;AACA,IAAO,OAAA,EACL,GAAGwC,SADE;AAELhN,MAAAA,IAAI,EAAE,YAFD;AAGLwK,MAAAA,IAAI,EAAEwQ,YAAAA;AAHD,KAAP,CAAA;AAKD,GAAA;;AACD,EAAA,MAAM,IAAI9a,KAAJ,CAAW,CAA2BF,yBAAAA,EAAAA,IAAK,IAA3C,CAAN,CAAA;AACD,CAAA;;AAED,MAAMyb,SAAS,GAAG;AAChBV,EAAAA,MAAAA;AADgB;;AC3RlB;AACA;AACA;AACA;AAmCA,MAAMW,UAAU,GAAG,IAAI/U,OAAJ,EAAnB,CAAA;AAEe,MAAegV,KAAf,SAA6B/b,eAA7B,CACsB;AACnC,EAAA,OAAOgc,gBAAP,CAAwBnc,GAAxB,EAAqCmO,KAArC,EAAgE;AAC9D,IAAA,IAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;AAC7B,MAAOiO,OAAAA,SAAS,CAAC5a,MAAV,CAAiB;AACtBxB,QAAAA,GADsB;AAEtB8E,QAAAA,MAAM,EAAEqJ,KAAAA;AAFc,OAAjB,CAAP,CAAA;AAID,KALD,MAKO;AACL,MAAOkO,OAAAA,SAAS,CAAC7a,MAAV,CAAiB;AACtBxB,QAAAA,GADsB;AAEtBsc,QAAAA,IAAI,EAAEnO,KAAAA;AAFgB,OAAjB,CAAP,CAAA;AAID,KAAA;AACF,GAAA;;AAED,EAAO3M,OAAAA,MAAP,CAAcb,KAAd,EAA8C;AAC5C,IAAIA,IAAAA,KAAK,YAAYub,KAArB,EAA4B;AAC1B,MAAOvb,OAAAA,KAAK,CAACC,SAAN,EAAP,CAAA;AACD,KAAA;;AACD,IAAI,IAAA,MAAA,IAAUD,KAAd,EAAqB;AACnB,MAAA,OAAO0b,SAAS,CAAC7a,MAAV,CAAiBb,KAAjB,CAAP,CAAA;AACD,KAFD,MAEO;AACL,MAAA,OAAOyb,SAAS,CAAC5a,MAAV,CAAiBb,KAAjB,CAAP,CAAA;AACD,KAAA;AACF,GAAA;;AAED,EAAOiB,OAAAA,QAAP,CAAgBC,IAAhB,EAAqD;AACnD,IAAI,IAAA,QAAA,IAAYA,IAAhB,EAAsB;AACpB,MAAA,OAAOua,SAAS,CAACxa,QAAV,CAAmBC,IAAnB,CAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAOwa,SAAS,CAACza,QAAV,CAAmBC,IAAnB,CAAP,CAAA;AACD,GAAA;;AAMDnB,EAAAA,WAAW,CAACC,KAAD,EAAyB;AAClC,IAAA,KAAA,EAAA,CAAA;AADkC,IAAA,IAAA,CAJpBX,GAIoB,GAAA,KAAA,CAAA,CAAA;AAElC,IAAM,MAAA;AAAEA,MAAAA,GAAAA;AAAF,KAAA,GAAUW,KAAhB,CAAA;AACA,IAAKX,IAAAA,CAAAA,GAAL,GAAWA,GAAX,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACSuc,EAAAA,iBAAP,CAAyBld,IAAzB,EAAqC;AACnC,IAAA,MAAMmd,SAAS,GAAGnd,IAAI,CAAC4B,YAAL,EAAlB,CAAA;AACA,IAAOmb,OAAAA,SAAS,CAAC5a,MAAV,CAAiB;AACtBxB,MAAAA,GAAG,EAAEwc,SAAS,CAACxc,GADO;AAEtB8E,MAAAA,MAAM,EAAE,CAAA;AAFc,KAAjB,CAAP,CAAA;AAID,GAAA;AAED;AACF;AACA;;;AACS2X,EAAAA,eAAP,CAAuBpd,IAAvB,EAAmC;AACjC,IAAA,MAAMqd,QAAQ,GAAGrd,IAAI,CAAC+B,WAAL,EAAjB,CAAA;AACA,IAAOgb,OAAAA,SAAS,CAAC5a,MAAV,CAAiB;AACtBxB,MAAAA,GAAG,EAAE0c,QAAQ,CAAC1c,GADQ;AAEtB8E,MAAAA,MAAM,EAAE4X,QAAQ,CAAC5Y,IAAT,CAAc3C,MAAAA;AAFA,KAAjB,CAAP,CAAA;AAID,GAAA;AAED;AACF;AACA;;;AAQSwb,EAAAA,WAAP,GAAwC;AACtC,IAAA,OAAO,gBAAgBP,SAAvB,CAAA;AACD,GAAA;;AAEMQ,EAAAA,WAAP,GAAwC;AACtC,IAAA,OAAO,gBAAgBP,SAAvB,CAAA;AACD,GAAA;;AAEMQ,EAAAA,YAAP,GAA6C;AAC3C,IAAO,OAAA,IAAA,CAAKjc,SAAL,EAAP,CAAA;AACD,GAAA;;AAEMkc,EAAAA,WAAP,GAA4C;AAC1C,IAAO,OAAA,IAAA,CAAKlc,SAAL,EAAP,CAAA;AACD,GAAA;;AAEOA,EAAAA,SAAR,GAA2C;AACzC,IAAI,IAAA,IAAA,CAAK+b,WAAL,EAAJ,EAAwB;AACtB,MAAA,OAAO,IAAP,CAAA;AACD,KAFD,MAEO,IAAI,IAAKC,CAAAA,WAAL,EAAJ,EAAwB;AAC7B,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,MAAM,IAAInc,KAAJ,CAAW,CAA+B,6BAAA,EAAA,IAAK,EAA/C,CAAN,CAAA;AACD,GAAA;;AAEMsc,EAAAA,kBAAP,CAA0BC,QAA1B,EAA8C;AAC5C,IAAA,MAAMC,KAAK,GAAG,IAAKrc,CAAAA,SAAL,EAAd,CAAA;;AACA,IAAA,IAAIqc,KAAK,CAACN,WAAN,EAAJ,EAAyB;AACvB,MAAA,OAAOM,KAAP,CAAA;AACD,KAAA;;AACD,IAAM5d,MAAAA,IAAI,GAAG2d,QAAQ,CAACtN,OAAT,CAAiB,IAAA,CAAK1P,GAAtB,CAAb,CAAA;AACA,IAAA,IAAIiW,QAAiC,GACnCgH,KAAK,CAACX,IAAN,KAAeD,SAAS,CAACa,MAAzB,GACI7d,IAAI,EAAEgC,YAAN,EADJ,GAEIhC,IAAI,EAAEiC,WAAN,EAHN,CAAA;;AAIA,IAAI,IAAA,CAAC2U,QAAL,EAAe;AACbA,MAAAA,QAAQ,GACNgH,KAAK,CAACX,IAAN,KAAeD,SAAS,CAACa,MAAzB,GACIF,QAAQ,CAAC/b,YAAT,EADJ,GAEI+b,QAAQ,CAAC5b,WAAT,EAHN,CAAA;AAID,KAAA;;AACD,IAAM,MAAA;AAAEpB,MAAAA,GAAAA;AAAF,KAAA,GAAUiW,QAAhB,CAAA;AACA,IAAA,MAAMnR,MAAM,GAAGmY,KAAK,CAACX,IAAN,KAAeD,SAAS,CAACa,MAAzB,GAAkC,CAAlC,GAAsCjH,QAAQ,EAAEnS,IAAV,CAAe3C,MAApE,CAAA;AACA,IAAOib,OAAAA,SAAS,CAAC5a,MAAV,CAAiB;AACtBxB,MAAAA,GADsB;AAEtB8E,MAAAA,MAAAA;AAFsB,KAAjB,CAAP,CAAA;AAID,GAAA;AAED;AACF;AACA;;;AACSqY,EAAAA,QAAP,CAAgB9d,IAAhB,EAA4B;AAC1B,IAAA,IAAIA,IAAI,CAAC0B,MAAL,EAAA,IAAiB1B,IAAI,CAACW,GAAL,KAAa,IAAKA,CAAAA,GAAvC,EAA4C,OAAO,IAAP,CAAA;AAC5C,IAAA,IAAIX,IAAI,CAAC2B,SAAL,EAAA,IAAoB3B,IAAI,CAACqQ,OAAL,CAAa,IAAK1P,CAAAA,GAAlB,CAAxB,EAAgD,OAAO,IAAP,CAAA;AAChD,IAAA,OAAO,KAAP,CAAA;AACD,GAnIkC;AAsInC;AACA;;;AACOod,EAAAA,SAAP,CAAiBJ,QAAjB,EAAqC;AACnC,IAAA,IAAI,CAACf,UAAU,CAAC7Y,GAAX,CAAe,IAAf,CAAL,EAA2B;AACzB6Y,MAAAA,UAAU,CAACja,GAAX,CAAe,IAAf,EAAqB,IAAIkF,OAAJ,EAArB,CAAA,CAAA;AACD,KAAA;;AACD,IAAA,MAAMmW,sBAAsB,GAAGpB,UAAU,CAACvU,GAAX,CAAe,IAAf,CAA/B,CAAA;;AACA,IAAA,IAAI,CAAC2V,sBAAsB,CAACja,GAAvB,CAA2B4Z,QAA3B,CAAL,EAA2C;AACzCK,MAAAA,sBAAsB,CAACrb,GAAvB,CAA2Bgb,QAA3B,EAAqCA,QAAQ,CAAChN,OAAT,CAAiB,IAAKhQ,CAAAA,GAAtB,CAArC,CAAA,CAAA;AACD,KAAA;;AACD,IAAA,OAAOqd,sBAAsB,CAAC3V,GAAvB,CAA2BsV,QAA3B,CAAP,CAAA;AACD,GAAA;;AAjJkC,CAAA;AAsJ9B,MAAMZ,SAAN,SAAwBF,KAAxB,CAA8B;AACnC,EAAO1a,OAAAA,MAAP,CAAcb,KAAd,EAAiE;AAC/D,IAAIA,IAAAA,KAAK,YAAYyb,SAArB,EAAgC;AAC9B,MAAA,OAAOzb,KAAP,CAAA;AACD,KAAA;;AAED,IAAA,IAAIH,iCAAa,CAACG,KAAD,CAAjB,EAA0B;AACxB,MAAM,MAAA;AAAEX,QAAAA,GAAF;AAAO8E,QAAAA,MAAAA;AAAP,OAAA,GAAkBnE,KAAxB,CAAA;AACA,MAAO,OAAA,IAAIyb,SAAJ,CAAc;AACnBpc,QAAAA,GADmB;AAEnB8E,QAAAA,MAAAA;AAFmB,OAAd,CAAP,CAAA;AAID,KAAA;;AAED,IAAA,MAAM,IAAIrE,KAAJ,CACH,CAAsEE,oEAAAA,EAAAA,KAAM,EADzE,CAAN,CAAA;AAGD,GAAA;;AAED,EAAOiB,OAAAA,QAAP,CAAgBC,IAAhB,EAAqC;AACnC,IAAA,OAAOua,SAAS,CAAC5a,MAAV,CAAiB,EACtB,GAAGK,IADmB;AAEtB7B,MAAAA,GAAG,EAAE6B,IAAI,CAAC7B,GAAL,IAAY,MAAA;AAFK,KAAjB,CAAP,CAAA;AAID,GAAA;;AAID,EAAA,IAAWsd,OAAX,GAAqB;AACnB,IAAA,OAAQ,GAAE,IAAKtd,CAAAA,GAAI,CAAG,CAAA,EAAA,IAAA,CAAK8E,MAAO,CAAlC,CAAA,CAAA;AACD,GAAA;;AAEOpE,EAAAA,WAAR,CAAoBC,KAApB,EAAgD;AAC9C,IAAA,KAAA,CAAMA,KAAN,CAAA,CAAA;AAD8C,IAAA,IAAA,CANhCmE,MAMgC,GAAA,KAAA,CAAA,CAAA;AAE9C,IAAM,MAAA;AAAEA,MAAAA,MAAAA;AAAF,KAAA,GAAanE,KAAnB,CAAA;AACA,IAAKmE,IAAAA,CAAAA,MAAL,GAAcA,MAAd,CAAA;AACA,IAAA,IAAA,CAAK5E,MAAL,EAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;;;AACS4c,EAAAA,WAAP,CAAmBnR,CAAC,GAAG,CAAvB,EAAqC;AACnC,IAAIA,IAAAA,CAAC,KAAK,CAAV,EAAa;AACX,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAIA,IAAAA,CAAC,GAAG,CAAR,EAAW;AACT,MAAA,OAAO,IAAKkR,CAAAA,YAAL,CAAkB,CAAClR,CAAnB,CAAP,CAAA;AACD,KAAA;;AACD,IAAO,OAAA,IAAA,CAAK3J,GAAL,CAAS,QAAT,EAAmB,IAAK8C,CAAAA,MAAL,GAAc6G,CAAjC,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;;;AACSkR,EAAAA,YAAP,CAAoBlR,CAAC,GAAG,CAAxB,EAAsC;AACpC,IAAIA,IAAAA,CAAC,KAAK,CAAV,EAAa;AACX,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAIA,IAAAA,CAAC,GAAG,CAAR,EAAW;AACT,MAAA,OAAO,IAAKmR,CAAAA,WAAL,CAAiB,CAACnR,CAAlB,CAAP,CAAA;AACD,KAAA;;AACD,IAAO,OAAA,IAAA,CAAK3J,GAAL,CAAS,QAAT,EAAmB,IAAK8C,CAAAA,MAAL,GAAc6G,CAAjC,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;;;AACS4R,EAAAA,MAAP,CAAcvd,GAAd,EAA2B8E,MAAM,GAAG,CAApC,EAAuC;AACrC,IAAO,OAAA,IAAA,CAAK/C,KAAL,CAAW;AAChB/B,MAAAA,GADgB;AAEhB8E,MAAAA,MAAAA;AAFgB,KAAX,CAAP,CAAA;AAID,GAAA;AAED;AACF;AACA;;;AACS0Y,EAAAA,eAAP,CAAuBne,IAAvB,EAAmC;AACjC,IAAA,IAAI,KAAKyF,MAAL,KAAgB,CAApB,EAAuB,OAAO,KAAP,CAAA;AAEvB,IAAA,MAAM6E,KAAK,GAAGtK,IAAI,CAAC4B,YAAL,EAAd,CAAA;AACA,IAAA,OAAO,IAAKjB,CAAAA,GAAL,KAAa2J,KAAK,CAAC3J,GAA1B,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACSyd,EAAAA,aAAP,CAAqBpe,IAArB,EAAiC;AAC/B,IAAA,MAAM0N,IAAI,GAAG1N,IAAI,CAAC+B,WAAL,EAAb,CAAA;AACA,IAAA,OAAO,IAAKpB,CAAAA,GAAL,KAAa+M,IAAI,CAAC/M,GAAlB,IAAyB,IAAK8E,CAAAA,MAAL,KAAgBiI,IAAI,CAACjJ,IAAL,CAAU3C,MAA1D,CAAA;AACD,GAAA;;AAEMY,EAAAA,KAAP,CAAapB,KAAb,EAAkD;AAChD,IAAO,OAAA,IAAIyb,SAAJ,CAAc;AACnBpc,MAAAA,GAAG,EAAE,IAAA,CAAKA,GADS;AAEnB8E,MAAAA,MAAM,EAAE,IAAA,CAAKA,MAFM;AAGnB,MAAGnE,GAAAA,KAAAA;AAHgB,KAAd,CAAP,CAAA;AAKD,GAAA;;AAEMqB,EAAAA,GAAP,CACEhC,GADF,EAEEC,KAFF,EAGE;AACA,IAAO,OAAA,IAAA,CAAK8B,KAAL,CAAW;AAChB,MAAA,CAAC/B,GAAD,GAAOC,KAAAA;AADS,KAAX,CAAP,CAAA;AAGD,GAAA;;AAEMmC,EAAAA,MAAP,CAAcqF,OAAd,EAA0C;AACxC,IAAA,MAAMkD,MAAqB,GAAG;AAC5BtI,MAAAA,KAAK,EAAE,OADqB;AAE5ByC,MAAAA,MAAM,EAAE,IAAKA,CAAAA,MAAAA;AAFe,KAA9B,CAAA;;AAKA,IAAI2C,IAAAA,OAAO,EAAEmD,YAAb,EAA2B;AACzBD,MAAAA,MAAM,CAAC3K,GAAP,GAAa,KAAKA,GAAlB,CAAA;AACD,KAAA;;AAED,IAAA,OAAO2K,MAAP,CAAA;AACD,GAAA;;AA5HkC,CAAA;AA+H9B,MAAM0R,SAAN,SAAwBH,KAAxB,CAA8B;AAKnC,EAAO1a,OAAAA,MAAP,CAAcb,KAAd,EAAiE;AAC/D,IAAIA,IAAAA,KAAK,YAAY0b,SAArB,EAAgC;AAC9B,MAAA,OAAO1b,KAAP,CAAA;AACD,KAAA;;AAED,IAAA,IAAIH,iCAAa,CAACG,KAAD,CAAjB,EAA0B;AACxB,MAAM,MAAA;AAAEX,QAAAA,GAAF;AAAOsc,QAAAA,IAAAA;AAAP,OAAA,GAAgB3b,KAAtB,CAAA;AACA,MAAO,OAAA,IAAI0b,SAAJ,CAAc;AACnBrc,QAAAA,GADmB;AAEnBsc,QAAAA,IAAAA;AAFmB,OAAd,CAAP,CAAA;AAID,KAAA;;AAED,IAAA,MAAM,IAAI7b,KAAJ,CACH,CAAsEE,oEAAAA,EAAAA,KAAM,EADzE,CAAN,CAAA;AAGD,GAAA;;AAED,EAAOiB,OAAAA,QAAP,CAAgBC,IAAhB,EAAqC;AACnC,IAAA,OAAOwa,SAAS,CAAC7a,MAAV,CAAiB,EACtB,GAAGK,IADmB;AAEtB7B,MAAAA,GAAG,EAAE6B,IAAI,CAAC7B,GAAL,IAAY,MAAA;AAFK,KAAjB,CAAP,CAAA;AAID,GAAA;;AAID,EAAA,IAAWsd,OAAX,GAAqB;AACnB,IAAA,OAAQ,GAAE,IAAKtd,CAAAA,GAAI,CAAG,CAAA,EAAA,IAAA,CAAKsc,IAAK,CAAhC,CAAA,CAAA;AACD,GAAA;;AAEO5b,EAAAA,WAAR,CAAoBC,KAApB,EAAgD;AAC9C,IAAA,KAAA,CAAMA,KAAN,CAAA,CAAA;AAD8C,IAAA,IAAA,CANhC2b,IAMgC,GAAA,KAAA,CAAA,CAAA;AAE9C,IAAM,MAAA;AAAEA,MAAAA,IAAAA;AAAF,KAAA,GAAW3b,KAAjB,CAAA;AACA,IAAK2b,IAAAA,CAAAA,IAAL,GAAYA,IAAZ,CAAA;AACA,IAAA,IAAA,CAAKpc,MAAL,EAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACSsd,EAAAA,eAAP,CAAuBne,IAAvB,EAAmC;AACjC,IAAA,OAAO,IAAKW,CAAAA,GAAL,KAAaX,IAAI,CAACW,GAAlB,IAAyB,IAAA,CAAKsc,IAAL,KAAcD,SAAS,CAACa,MAAxD,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACSO,EAAAA,aAAP,CAAqBpe,IAArB,EAAiC;AAC/B,IAAA,OAAO,IAAKW,CAAAA,GAAL,KAAaX,IAAI,CAACW,GAAlB,IAAyB,IAAA,CAAKsc,IAAL,KAAcD,SAAS,CAACqB,KAAxD,CAAA;AACD,GAAA;;AAEM3b,EAAAA,KAAP,CAAapB,KAAb,EAAkD;AAChD,IAAO,OAAA,IAAI0b,SAAJ,CAAc;AACnBrc,MAAAA,GAAG,EAAE,IAAA,CAAKA,GADS;AAEnBsc,MAAAA,IAAI,EAAE,IAAA,CAAKA,IAFQ;AAGnB,MAAG3b,GAAAA,KAAAA;AAHgB,KAAd,CAAP,CAAA;AAKD,GAAA;;AAEMqB,EAAAA,GAAP,CACEhC,GADF,EAEEC,KAFF,EAGE;AACA,IAAO,OAAA,IAAA,CAAK8B,KAAL,CAAW;AAChB,MAAA,CAAC/B,GAAD,GAAOC,KAAAA;AADS,KAAX,CAAP,CAAA;AAGD,GAAA;;AAEMmC,EAAAA,MAAP,CAAcqF,OAAd,EAA0C;AACxC,IAAA,MAAMkD,MAAqB,GAAG;AAC5BtI,MAAAA,KAAK,EAAE,OADqB;AAE5Bia,MAAAA,IAAI,EAAE,IAAKA,CAAAA,IAAAA;AAFiB,KAA9B,CAAA;;AAKA,IAAI7U,IAAAA,OAAO,EAAEmD,YAAb,EAA2B;AACzBD,MAAAA,MAAM,CAAC3K,GAAP,GAAa,KAAKA,GAAlB,CAAA;AACD,KAAA;;AAED,IAAA,OAAO2K,MAAP,CAAA;AACD,GAAA;;AArFkC,CAAA;AAAxB0R,UACKa,SAAS;AADdb,UAGKqB,QAAQ;;ACjU1B;AACA;AACA;AACA;AACA,iBAAe;AAAC,EAAA,MAAA,EAAO,82FAAR;AAAu3F,EAAU,SAAA,EAAA;AAAC,IAAA,OAAA,EAAQ,CAAT;AAAW,IAAA,SAAA,EAAU,CAArB;AAAuB,IAAA,IAAA,EAAK,CAA5B;AAA8B,IAAA,IAAA,EAAK,CAAnC;AAAqC,IAAA,SAAA,EAAU,CAA/C;AAAiD,IAAA,QAAA,EAAS,CAA1D;AAA4D,IAAA,oBAAA,EAAqB,CAAjF;AAAmF,IAAA,aAAA,EAAc,CAAjG;AAAmG,IAAA,GAAA,EAAI,CAAvG;AAAyG,IAAA,GAAA,EAAI,CAA7G;AAA+G,IAAA,GAAA,EAAI,EAAnH;AAAsH,IAAA,IAAA,EAAK,EAA3H;AAA8H,IAAA,KAAA,EAAM,EAApI;AAAuI,IAAA,KAAA,EAAM,EAA7I;AAAgJ,IAAU,SAAA,EAAA,EAAA;AAA1J,GAAA;AAAj4F,CAAf;;ACJA;AACA;AACA;AACA;AAIA,MAAM;AACJC,EAAAA,IAAAA;AADI,CAAA,GAEFC,UAFJ,CAAA;AAGA,MAAM;AACJC,EAAAA,KADI;AAEJC,EAAAA,OAFI;AAGJC,EAAAA,EAHI;AAIJC,EAAAA,EAJI;AAKJC,EAAAA,OALI;AAMJC,EAAAA,MANI;AAOJC,EAAAA,kBAPI;AAQJC,EAAAA,WARI;AASJC,EAAAA,CATI;AAUJC,EAAAA,CAVI;AAWJC,EAAAA,CAXI;AAYJC,EAAAA,EAZI;AAaJC,EAAAA,GAbI;AAcJC,EAAAA,GAdI;AAeJC,EAAAA,OAAAA;AAfI,CAgBFf,GAAAA,UAAU,CAACgB,OAhBf,CAAA;AAkBA,IAAIjd,IAAwB,GAAG,IAA/B,CAAA;;AACA,IAAI,OAAO1D,MAAP,KAAkB,WAAtB,EAAmC;AACjC,EAAA,MAAM4gB,GAAG,GAAG5gB,MAAM,CAAC6gB,IAAP,CAAYnB,IAAZ,CAAZ,CAAA;AACAhc,EAAAA,IAAI,GAAG,IAAIod,UAAJ,CAAeF,GAAG,CAAC1d,MAAnB,CAAP,CAAA;;AACA,EAAK,KAAA,IAAIgK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG0T,GAAG,CAAC1d,MAAxB,EAAgCgK,CAAC,EAAjC,EAAqCxJ,IAAI,CAACwJ,CAAD,CAAJ,GAAU0T,GAAG,CAACG,UAAJ,CAAe7T,CAAf,CAAV,CAAA;AACtC,CAJD,MAIO;AACLxJ,EAAAA,IAAI,GAAGsd,MAAM,CAACC,IAAP,CAAYvB,IAAZ,EAAkB,QAAlB,CAAP,CAAA;AACD;;;AAED,MAAMwB,SAAS,GAAG,IAAIC,+BAAJ,CAAgBzd,IAAhB,CAAlB,CAAA;;AAEA,MAAM0d,WAAW,GAAG,UAAU/M,GAAV,EAAejC,GAAf,EAAoB;AAAE;AACxC,EAAMiP,MAAAA,IAAI,GAAGhN,GAAG,CAAC0M,UAAJ,CAAe3O,GAAf,CAAb,CADsC;;AAGtC,EAAA,IAAIiP,IAAI,IAAI,MAAR,IAAkBA,IAAI,IAAI,MAA9B,EAAsC;AACpC,IAAMC,MAAAA,EAAE,GAAGD,IAAX,CAAA;AACA,IAAME,MAAAA,GAAG,GAAGlN,GAAG,CAAC0M,UAAJ,CAAe3O,GAAG,GAAG,CAArB,CAAZ,CAAA;;AACA,IAAA,IAAKmP,GAAG,IAAI,MAAP,IAAiBA,GAAG,IAAI,MAA7B,EAAsC;AACpC,MAAQ,OAAA,CAACD,EAAE,GAAG,MAAN,IAAgB,KAAjB,IAA2BC,GAAG,GAAG,MAAjC,CAAA,GAA2C,OAAlD,CAAA;AACD,KAAA;;AACD,IAAA,OAAOD,EAAP,CAAA;AACD,GAVqC;;;AAYtC,EAAA,IAAID,IAAI,IAAI,MAAR,IAAkBA,IAAI,IAAI,MAA9B,EAAsC;AACpC,IAAMC,MAAAA,EAAE,GAAGjN,GAAG,CAAC0M,UAAJ,CAAe3O,GAAG,GAAG,CAArB,CAAX,CAAA;AACA,IAAMmP,MAAAA,GAAG,GAAGF,IAAZ,CAAA;;AACA,IAAA,IAAKC,EAAE,IAAI,MAAN,IAAgBA,EAAE,IAAI,MAA3B,EAAoC;AAClC,MAAQ,OAAA,CAACA,EAAE,GAAG,MAAN,IAAgB,KAAjB,IAA2BC,GAAG,GAAG,MAAjC,CAAA,GAA2C,OAAlD,CAAA;AACD,KAAA;;AACD,IAAA,OAAOA,GAAP,CAAA;AACD,GAAA;;AACD,EAAA,OAAOF,IAAP,CAAA;AACD,CArBD,CAAA;;AAuBA,MAAMG,aAAW,GAAG,UAAUnN,GAAV,EAAeoN,GAAf,EAAoB;AACtC,EAAA,IAAIC,GAAJ,CAAA;AACA,EAAIC,IAAAA,IAAJ,CAFsC;;AAItC,EAAA,OAAQ,CAACD,GAAG,GAAGrN,GAAG,CAAC0M,UAAJ,CAAeU,GAAf,CAAP,KAA+B,MAA/B,IAAyCC,GAAG,IAAI,MAAjD,IAA6D,CAACC,IAAI,GAAGtN,GAAG,CAAC0M,UAAJ,CAAeU,GAAG,GAAG,CAArB,CAAR,KAAoC,MAApC,IAA8CE,IAAI,IAAI,MAA1H,CAAA;AACD,CALD,CAAA;;AAOA,MAAMC,SAAS,GAAG;AAChBC,EAAAA,QAAQ,EAAE,CADM;AAEhBC,EAAAA,UAAU,EAAE,CAFI;AAGhBC,EAAAA,KAAK,EAAE,CAHS;AAIhBC,EAAAA,iBAAiB,EAAE,CAJH;AAKhBC,EAAAA,wBAAwB,EAAE,CAAA;AALV,CAAlB;;AASA,MAAMC,WAAW,GAAG,UAAU3P,OAAV,EAAmBlI,KAAnB,EAA0B8X,GAA1B,EAA+B7X,GAA/B,EAAoC;AACtD,EAAA,MAAM8X,GAAG,GAAG,CAAC/X,KAAD,EAAQQ,MAAR,CAAesX,GAAf,CAAA,CAAoBtX,MAApB,CAA2B,CAACP,GAAD,CAA3B,CAAZ,CAAA;AACA,EAAA,MAAMyE,QAAQ,GAAGwD,OAAO,GAAGlI,KAAH,GAAW+X,GAAG,CAACA,GAAG,CAAClf,MAAJ,GAAa,CAAd,CAAtC,CAAA;AACA,EAAMuD,MAAAA,IAAI,GAAG8L,OAAO,GAAG6P,GAAG,CAAC,CAAD,CAAN,GAAY9X,GAAhC,CAHsD;AAMtD;AACA;;AACA,EAAA,MAAM+X,OAAO,GAAGD,GAAG,CAACE,WAAJ,CAAgBpC,kBAAhB,CAAhB,CAAA;;AACA,EAAA,IAAImC,OAAO,GAAG,CAAV,IAAeD,GAAG,CAACzd,KAAJ,CAAU,CAAV,EAAa0d,OAAb,CAAA,CAAsBtd,KAAtB,CAA4Bwd,CAAC,IAAIA,CAAC,KAAKrC,kBAAvC,CAAf,IAA8EnR,QAAQ,KAAK8Q,OAAb,IAAwB9Q,QAAQ,KAAKmR,kBAAvH,EAA4I;AAC1I,IAAA,IAAIkC,GAAG,CAAC1c,MAAJ,CAAW6c,CAAC,IAAIA,CAAC,KAAKrC,kBAAtB,EAA0Chd,MAA1C,GAAmD,CAAnD,KAAyD,CAA7D,EAAgE;AAC9D,MAAO0e,OAAAA,SAAS,CAACI,iBAAjB,CAAA;AACD,KAAA;;AACD,IAAOJ,OAAAA,SAAS,CAACK,wBAAjB,CAAA;AAED,GAfqD;;;AAiBtD,EAAA,IAAIlT,QAAQ,KAAK+Q,EAAb,IAAmBrZ,IAAI,KAAKsZ,EAAhC,EAAoC;AAClC,IAAO6B,OAAAA,SAAS,CAACC,QAAjB,CAAA;AACD,GAnBqD;;;AAqBtD,EAAI9S,IAAAA,QAAQ,KAAKiR,OAAb,IAAwBjR,QAAQ,KAAK+Q,EAArC,IAA2C/Q,QAAQ,KAAKgR,EAA5D,EAAgE;AAC9D;AACA,IAAA,IAAItZ,IAAI,KAAKwZ,MAAT,IAAmBkC,GAAG,CAACpd,KAAJ,CAAUwd,CAAC,IAAIA,CAAC,KAAKtC,MAArB,CAAvB,EAAqD;AACnD,MAAO2B,OAAAA,SAAS,CAACG,KAAjB,CAAA;AACD,KAAA;;AACD,IAAOH,OAAAA,SAAS,CAACE,UAAjB,CAAA;AAED,GA5BqD;;;AA8BtD,EAAIrb,IAAAA,IAAI,KAAKuZ,OAAT,IAAoBvZ,IAAI,KAAKqZ,EAA7B,IAAmCrZ,IAAI,KAAKsZ,EAAhD,EAAoD;AAClD,IAAO6B,OAAAA,SAAS,CAACE,UAAjB,CAAA;AACD,GAhCqD;;;AAkCtD,EAAI/S,IAAAA,QAAQ,KAAKqR,CAAb,KAAmB3Z,IAAI,KAAK2Z,CAAT,IAAc3Z,IAAI,KAAK4Z,CAAvB,IAA4B5Z,IAAI,KAAK8Z,EAArC,IAA2C9Z,IAAI,KAAK+Z,GAAvE,CAAJ,EAAiF;AAC/E,IAAOoB,OAAAA,SAAS,CAACC,QAAjB,CAAA;AACD,GApCqD;;;AAsCtD,EAAA,IAAI,CAAC9S,QAAQ,KAAKwR,EAAb,IAAmBxR,QAAQ,KAAKsR,CAAjC,MAAwC5Z,IAAI,KAAK4Z,CAAT,IAAc5Z,IAAI,KAAK6Z,CAA/D,CAAJ,EAAuE;AACrE,IAAOsB,OAAAA,SAAS,CAACC,QAAjB,CAAA;AACD,GAxCqD;;;AA0CtD,EAAA,IAAI,CAAC9S,QAAQ,KAAKyR,GAAb,IAAoBzR,QAAQ,KAAKuR,CAAlC,KAAwC7Z,IAAI,KAAK6Z,CAArD,EAAwD;AACtD,IAAOsB,OAAAA,SAAS,CAACC,QAAjB,CAAA;AACD,GA5CqD;;;AA8CtD,EAAA,IAAItP,OAAJ,EAAa;AACX,IAAI9L,IAAAA,IAAI,KAAKwZ,MAAb,EAAqB;AACnB,MAAO2B,OAAAA,SAAS,CAACC,QAAjB,CAAA;AACD,KAAA;;AACD,IAAIpb,IAAAA,IAAI,KAAKga,GAAb,EAAkB;AAChB,MAAA,IAAI1R,QAAQ,IAAI6Q,KAAZ,IAAqBuC,GAAG,CAACjf,MAAJ,GAAa,CAAlC,IAAuCif,GAAG,CAAC,CAAD,CAAH,IAAU1B,GAArD,EAA0D;AACxD,QAAOnW,OAAAA,GAAG,IAAIoW,OAAP,GAAiBkB,SAAS,CAACE,UAA3B,GAAwCF,SAAS,CAACG,KAAzD,CAAA;AACD,OAAA;;AACD,MAAOH,OAAAA,SAAS,CAACC,QAAjB,CAAA;AACD,KAAA;AACF,GAVD,MAUO,IAAIpb,IAAI,KAAKwZ,MAAT,IAAmBxZ,IAAI,KAAKga,GAAhC,EAAqC;AAC1C,IAAOmB,OAAAA,SAAS,CAACC,QAAjB,CAAA;AACD,GA1DqD;;;AA4DtD,EAAIpb,IAAAA,IAAI,KAAK0Z,WAAb,EAA0B;AACxB,IAAOyB,OAAAA,SAAS,CAACC,QAAjB,CAAA;AACD,GA9DqD;;;AAgEtD,EAAI9S,IAAAA,QAAQ,KAAK8Q,OAAjB,EAA0B;AACxB,IAAO+B,OAAAA,SAAS,CAACC,QAAjB,CAAA;AACD,GAlEqD;;;AAoEtD,EAAA,IAAItP,OAAJ,EAAa;AACX,IAAA,IAAIxD,QAAQ,IAAI0R,GAAZ,IAAmBha,IAAI,IAAIia,OAA3B,KAAuCrW,KAAK,IAAIoW,GAAT,IAAgBpW,KAAK,IAAIuV,KAAhE,CAAJ,EAA4E;AAC1E,MAAOgC,OAAAA,SAAS,CAACC,QAAjB,CAAA;AACD,KAAA;AACF,GAJD,MAIO,IAAIxX,KAAK,IAAIqW,OAAT,IAAoB3R,QAAQ,IAAI0R,GAAhC,IAAuCha,IAAI,IAAIia,OAAnD,EAA4D;AACjE,IAAOkB,OAAAA,SAAS,CAACC,QAAjB,CAAA;AACD,GA1EqD;AA6EtD;;;AACA,EAAI,IAAA,CAACtP,OAAD,IAAY4P,GAAG,CAACrL,OAAJ,CAAYoJ,kBAAZ,CAAmC,IAAA,CAAnD,EAAsD;AACpD,IAAO0B,OAAAA,SAAS,CAACG,KAAjB,CAAA;AACD,GAAA;;AACD,EAAA,IAAIhT,QAAQ,KAAKmR,kBAAb,IAAmCzZ,IAAI,KAAKyZ,kBAAhD,EAAoE;AAClE,IAAO0B,OAAAA,SAAS,CAACC,QAAjB,CAAA;AACD,GAnFqD;;;AAqFtD,EAAOD,OAAAA,SAAS,CAACE,UAAjB,CAAA;AACD,CAtFD,CAAA;;AAwFA,MAAMU,oBAAoB,GAAG,UAAUnO,GAAV,EAAehK,KAAf,EAAsBoY,aAAtB,EAAqC;AAChE,EAAOA,OAAAA,aAAa,EAApB,EAAwB;AACtBpY,IAAAA,KAAK,IAAImX,aAAW,CAACnN,GAAD,EAAMhK,KAAN,CAAX,GAA0B,CAA1B,GAA8B,CAAvC,CAAA;AACD,GAAA;;AACD,EAAA,OAAOA,KAAP,CAAA;AACD,CALD;;;AAQA,SAASqY,SAAT,CAAmBC,MAAnB,EAA2Bne,KAAK,GAAG,CAAnC,EAAsC;AACpC,EAAIA,IAAAA,KAAK,GAAG,CAAZ,EAAe;AACb,IAAA,OAAO,CAAP,CAAA;AACD,GAAA;;AACD,EAAA,IAAIA,KAAK,IAAIme,MAAM,CAACzf,MAAP,GAAgB,CAA7B,EAAgC;AAC9B,IAAOyf,OAAAA,MAAM,CAACzf,MAAd,CAAA;AACD,GAAA;;AACD,EAAA,MAAM0f,IAAI,GAAG1B,SAAS,CAACzX,GAAV,CAAckZ,MAAM,CAACvB,WAAP,CAAmB5c,KAAnB,CAAd,CAAb,CAAA;AACA,EAAM2d,MAAAA,GAAU,GAAG,EAAnB,CAAA;AACA,EAAA,IAAIjV,CAAJ,CAAA;AACA,EAAA,IAAI2V,CAAJ,CAAA;AACA,EAAInB,IAAAA,GAAJ,CAXoC;;AAapC,EAAKxU,KAAAA,CAAC,GAAG2V,CAAC,GAAGre,KAAK,GAAG,CAAhB,EAAmBkd,GAAG,GAAGiB,MAAM,CAACzf,MAArC,EAA6C2f,CAAC,GAAGnB,GAAjD,EAAsDxU,CAAC,GAAG2V,CAAC,IAAI,CAA/D,EAAkE;AAChE,IAAIrB,IAAAA,aAAW,CAACmB,MAAD,EAASzV,CAAC,GAAG,CAAb,CAAf,EAAgC;AAC9B;AACA,MAAA,SAAA;AACD,KAAA;;AACD,IAAA,MAAMzG,IAAI,GAAGya,SAAS,CAACzX,GAAV,CAAckZ,MAAM,CAACvB,WAAP,CAAmBlU,CAAnB,CAAd,CAAb,CAAA;;AACA,IAAIgV,IAAAA,WAAW,CAAC,KAAD,EAAQU,IAAR,EAAcT,GAAd,EAAmB1b,IAAnB,CAAf,EAAyC;AACvC,MAAA,OAAOyG,CAAP,CAAA;AACD,KAAA;;AACDiV,IAAAA,GAAG,CAAC1Z,IAAJ,CAAShC,IAAT,CAAA,CAAA;AACD,GAAA;;AACD,EAAOkc,OAAAA,MAAM,CAACzf,MAAd,CAAA;AACD;;;AAGD,SAAS4f,aAAT,CAAuBH,MAAvB,EAA+Bne,KAAK,GAAGme,MAAM,CAACzf,MAA9C,EAAsD;AACpD,EAAA,IAAIsB,KAAK,GAAGme,MAAM,CAACzf,MAAnB,EAA2B;AACzB,IAAOyf,OAAAA,MAAM,CAACzf,MAAd,CAAA;AACD,GAAA;;AACD,EAAIsB,IAAAA,KAAK,IAAI,CAAb,EAAgB;AACd,IAAA,OAAO,CAAP,CAAA;AACD,GAAA;;AACDA,EAAAA,KAAK,EAAA,CAAA;AACL,EAAM2d,MAAAA,GAAU,GAAG,EAAnB,CAAA;AACA,EAAA,MAAM1b,IAAI,GAAGya,SAAS,CAACzX,GAAV,CAAc2X,WAAW,CAACuB,MAAD,EAASne,KAAT,CAAzB,CAAb,CAAA;AACA,EAAA,IAAI0I,CAAJ,CAAA;AACA,EAAI2V,IAAAA,CAAJ,CAXoD;;AAapD,EAAA,KAAK3V,CAAC,GAAG2V,CAAC,GAAGre,KAAK,GAAG,CAArB,EAAwBqe,CAAC,IAAI,CAAC,CAA9B,EAAiC3V,CAAC,GAAG2V,CAAC,IAAI,CAAC,CAA3C,EAA8C;AAC5C,IAAA,IAAIrB,aAAW,CAACmB,MAAD,EAASzV,CAAT,CAAf,EAA4B;AAC1B;AACA,MAAA,SAAA;AACD,KAAA;;AACD,IAAA,MAAM0V,IAAI,GAAG1B,SAAS,CAACzX,GAAV,CAAc2X,WAAW,CAACuB,MAAD,EAASzV,CAAT,CAAzB,CAAb,CAAA;;AACA,IAAQgV,QAAAA,WAAW,CAAC,IAAD,EAAOU,IAAP,EAAaT,GAAb,EAAkB1b,IAAlB,CAAnB;AACE,MAAKmb,KAAAA,SAAS,CAACG,KAAf;AACE,QAAA,OAAO7U,CAAC,GAAGiV,GAAG,CAACjf,MAAR,GAAiB,CAAxB,CAAA;;AACF,MAAK0e,KAAAA,SAAS,CAACE,UAAf;AACE,QAAO5U,OAAAA,CAAC,GAAG,CAAX,CAAA;;AACF,MAAK0U,KAAAA,SAAS,CAACI,iBAAf;AACE;AACA,QAAA,MAAMnb,MAAM,GAAG2b,oBAAoB,CAACG,MAAD,EAASzV,CAAT,EAAYiV,GAAG,CAACtX,MAAJ,CAAWpE,IAAX,CAAiB6b,CAAAA,WAAjB,CAA6BpC,kBAA7B,CAAA,GAAmD,CAA/D,CAAnC,CAAA;AACA,QAAA,OAAOrZ,MAAP,CAAA;;AACF,MAAK+a,KAAAA,SAAS,CAACK,wBAAf;AACE,QAAA,OAAOO,oBAAoB,CAACG,MAAD,EAASzV,CAAT,EAAYiV,GAAG,CAACtX,MAAJ,CAAWpE,IAAX,CAAiB6b,CAAAA,WAAjB,CAA6BpC,kBAA7B,CAAZ,CAA3B,CAAA;AAVJ,KAAA;;AAYAiC,IAAAA,GAAG,CAACxb,OAAJ,CAAYic,IAAZ,CAAA,CAAA;AACD,GAAA;AACF;;;AAGD,SAASG,MAAT,CAAgB1O,GAAhB,EAAqB;AACnB,EAAM2O,MAAAA,GAAU,GAAG,EAAnB,CAAA;AACA,EAAIxe,IAAAA,KAAK,GAAG,CAAZ,CAAA;AACA,EAAIye,IAAAA,GAAJ,CAHmB;;AAKnB,EAAA,OAAO,CAACA,GAAG,GAAGP,SAAS,CAACrO,GAAD,EAAM7P,KAAN,CAAhB,IAAgC6P,GAAG,CAACnR,MAA3C,EAAmD;AACjD8f,IAAAA,GAAG,CAACva,IAAJ,CAAS4L,GAAG,CAAC1P,KAAJ,CAAUH,KAAV,EAAiBye,GAAjB,CAAT,CAAA,CAAA;AACAze,IAAAA,KAAK,GAAGye,GAAR,CAAA;AACD,GAAA;;AACD,EAAA,IAAIze,KAAK,GAAG6P,GAAG,CAACnR,MAAhB,EAAwB;AACtB8f,IAAAA,GAAG,CAACva,IAAJ,CAAS4L,GAAG,CAAC1P,KAAJ,CAAUH,KAAV,CAAT,CAAA,CAAA;AACD,GAAA;;AACD,EAAA,OAAOwe,GAAP,CAAA;AACD;;;AAGD,SAASE,aAAT,CAAqB7O,GAArB,EAA0B;AACxB,EAAI8O,IAAAA,KAAK,GAAG,CAAZ,CAAA;AACA,EAAI3e,IAAAA,KAAK,GAAG,CAAZ,CAAA;AACA,EAAIye,IAAAA,GAAJ,CAHwB;;AAKxB,EAAA,OAAO,CAACA,GAAG,GAAGP,SAAS,CAACrO,GAAD,EAAM7P,KAAN,CAAhB,IAAgC6P,GAAG,CAACnR,MAA3C,EAAmD;AACjDsB,IAAAA,KAAK,GAAGye,GAAR,CAAA;AACAE,IAAAA,KAAK,EAAA,CAAA;AACN,GAAA;;AACD,EAAA,IAAI3e,KAAK,GAAG6P,GAAG,CAACnR,MAAhB,EAAwB;AACtBigB,IAAAA,KAAK,EAAA,CAAA;AACN,GAAA;;AACD,EAAA,OAAOA,KAAP,CAAA;AACD,CAAA;;AAED,uBAAe;AACbT,EAAAA,SADa;AAEbI,EAAAA,aAFa;AAGbM,EAAAA,KAAK,EAAEL,MAHM;AAIbG,eAAAA,aAAAA;AAJa,CAAf;;AC7QA;AACA;AACA;AACA;AAGA,MAAMG,eAAe,GAAG,MAAxB,CAAA;AACA,MAAMC,aAAa,GAAG,MAAtB,CAAA;AACA,MAAMC,KAAK,GAAG,IAAd,CAAA;AACA;AACA;AACA;AACA;AACA;;AACA,MAAMC,WAAW,GAAG,iwCAApB,CAAA;;AAEA,SAASC,aAAT,CAAuBC,IAAvB,EAAqC;AACnC,EAAA,OAAO,iBAAkBzjB,CAAAA,IAAlB,CAAuByjB,IAAvB,CAAP,CAAA;AACD,CAAA;;AAED,SAASC,aAAT,CAAuBtP,GAAvB,EAAoC;AAClC,EAAA,OAAO,OAAOA,GAAP,KAAe,QAAf,IAA2BA,GAAG,KAAK,EAA1C,CAAA;AACD,CAAA;;AAED,SAASuP,MAAT,CAAgBF,IAAhB,EAA8B;AAC5B,EAAA,OAAOF,WAAW,CAACvjB,IAAZ,CAAiByjB,IAAjB,CAAP,CAAA;AACD;AAGD;AACA;;;AACA,SAASG,cAAT,CAAwBC,KAAxB,EAAuCC,KAAvC,EAAsD;AACpD,EAAA,OAAOJ,aAAa,CAACG,KAAD,CAAb,IACLH,aAAa,CAACI,KAAD,CADR,IAELC,MAAM,CAACF,KAAD,CAAN,KAAkBE,MAAM,CAACD,KAAD,CAFnB,IAGLN,aAAa,CAACK,KAAD,CAAb,KAAyBL,aAAa,CAACM,KAAD,CAHxC,CAAA;AAID,CAAA;;AAED,SAASE,aAAT,CAAuB5P,GAAvB,EAAoCnH,CAApC,EAA+CqF,OAA/C,EAA0E;AACxE,EAAA,IAAImQ,SAAJ,CAAA;AACA,EAAA,IAAI,CAACrO,GAAD,IAAQnH,CAAC,GAAG,CAAZ,IAAiBA,CAAC,GAAGmH,GAAG,CAACnR,MAA7B,EAAqC,OAAO,EAAP,CAAA;;AAErC,EAAA,IAAIqP,OAAJ,EAAa;AACXmQ,IAAAA,SAAS,GAAGwB,gBAAe,CAACpB,aAAhB,CAA8BzO,GAA9B,EAAmCnH,CAAnC,CAAZ,CAAA;AACA,IAAA,OAAOmH,GAAG,CAAC8P,SAAJ,CAAczB,SAAd,EAAyBxV,CAAzB,CAAP,CAAA;AACD,GAAA;;AAEDwV,EAAAA,SAAS,GAAGwB,gBAAe,CAACxB,SAAhB,CAA0BrO,GAA1B,EAA+BnH,CAA/B,CAAZ,CAAA;AACA,EAAA,OAAOmH,GAAG,CAAC8P,SAAJ,CAAcjX,CAAd,EAAiBwV,SAAjB,CAAP,CAAA;AACD,CAAA;;AAED,SAASQ,WAAT,CAAqB7O,GAArB,EAAkCnH,CAAlC,EAA6CqF,OAA7C,EAAwE;AACtE,EAAA,IAAI,CAAC8B,GAAD,IAAQnH,CAAC,GAAG,CAAZ,IAAiBA,CAAC,GAAGmH,GAAG,CAACnR,MAA7B,EAAqC,OAAO,CAAP,CAAA;AACrC,EAAA,MAAMmH,KAAK,GAAGkI,OAAO,GAAGrF,CAAH,GAAO,CAA5B,CAAA;AACA,EAAM5C,MAAAA,GAAG,GAAGiI,OAAO,GAAG8B,GAAG,CAACnR,MAAP,GAAgBgK,CAAnC,CAAA;AACA,EAAMrH,MAAAA,IAAI,GAAGwO,GAAG,CAAC8P,SAAJ,CAAc9Z,KAAd,EAAqBC,GAArB,CAAb,CAAA;AACA,EAAA,OAAO4Z,gBAAe,CAAChB,WAAhB,CAA4Brd,IAA5B,CAAP,CAAA;AACD,CAAA;;AAED,SAAS2b,WAAT,CAAqBH,IAArB,EAAmC;AACjC,EAAA,OAAOgC,eAAe,IAAIhC,IAAnB,IAA2BA,IAAI,IAAIiC,aAA1C,CAAA;AACD,CAAA;;AAED,SAASU,MAAT,CAAgBN,IAAhB,EAA8B;AAC5B,EAAA,IAAIH,KAAK,CAACtjB,IAAN,CAAWyjB,IAAX,CAAJ,EAAsB;AACpB,IAAA,OAAO,KAAP,CAAA;AACD,GAAA;;AAED,EAAA,IAAIF,WAAW,CAACvjB,IAAZ,CAAiByjB,IAAjB,CAAJ,EAA4B;AAC1B,IAAA,OAAO,KAAP,CAAA;AACD,GAAA;;AAED,EAAA,OAAO,IAAP,CAAA;AACD,CAAA;;AAED,SAASU,aAAT,CAAuBve,IAAvB,EAAqCgB,MAArC,EAAqD0L,OAArD,EAAwE;AACtE,EAAO0R,OAAAA,aAAa,CAACpe,IAAD,EAAOgB,MAAP,EAAe0L,OAAf,CAAb,CAAqCrP,MAA5C,CAAA;AACD,CAAA;;AAED,SAASmhB,qBAAT,CAA+Bxe,IAA/B,EAA6CgB,MAA7C,EAA6D;AAC3D,EAAOod,OAAAA,aAAa,CAACpe,IAAD,EAAOgB,MAAP,EAAe,IAAf,CAAb,CAAkC3D,MAAlC,IAA4C,CAAnD,CAAA;AACD,CAAA;;AAED,SAASohB,oBAAT,CAA8Bze,IAA9B,EAA4CgB,MAA5C,EAA4D;AAC1D,EAAOod,OAAAA,aAAa,CAACpe,IAAD,EAAOgB,MAAP,CAAb,CAA4B3D,MAA5B,IAAsC,CAA7C,CAAA;AACD;;;AAGD,SAASqhB,YAAT,CAAsB1e,IAAtB,EAAoCgB,MAApC,EAAsE;AACpE,EAAIwD,IAAAA,KAAK,GAAG,CAAZ,CAAA;;AACA,EAAOA,OAAAA,KAAK,IAAIxD,MAAhB,EAAwB;AACtB,IAAMyD,MAAAA,GAAG,GAAGD,KAAK,GAAGia,oBAAoB,CAACze,IAAD,EAAOwE,KAAP,CAAxC,CAAA;;AACA,IAAIC,IAAAA,GAAG,GAAGzD,MAAV,EAAkB;AAChB,MAAA,OAAO,CAACwD,KAAD,EAAQC,GAAR,CAAP,CAAA;AACD,KAAA;;AACDD,IAAAA,KAAK,GAAGC,GAAR,CAAA;AACD,GAAA;;AACD,EAAA,OAAO,CAACD,KAAD,EAAQA,KAAK,GAAG2C,IAAI,CAACC,GAAL,CAASpH,IAAI,CAAC3C,MAAd,EAAsB,CAAtB,CAAhB,CAAP,CAAA;AACD,CAAA;;AAED,SAASshB,YAAT,CAAsB3e,IAAtB,EAAoCgB,MAApC,EAAoD;AAClD,EAAI,IAAA,CAAChB,IAAL,EAAW;AACT,IAAA,OAAO,CAAC,CAAD,EAAI,CAAJ,CAAP,CAAA;AACD,GAHiD;;;AAMlDgB,EAAAA,MAAM,GAAGmG,IAAI,CAACC,GAAL,CAASpG,MAAT,EAAiBhB,IAAI,CAAC3C,MAAtB,CAAT,CAAA;AAEA,EAAA,MAAMuhB,YAAY,GAAG5e,IAAI,CAACgB,MAAD,CAAzB,CAAA;AACA,EAAA,MAAM6d,QAAQ,GAAG7e,IAAI,CAACgB,MAAM,GAAG,CAAV,CAArB,CAAA;AACA,EAAA,MAAM8d,QAAQ,GAAG9e,IAAI,CAACgB,MAAM,GAAG,CAAV,CAArB,CAAA;AACA,EAAIyD,IAAAA,GAAG,GAAG,CAAV,CAAA;AACA,EAAA,IAAID,KAAK,GAAG,CAAZ,CAZkD;;AAelD,EAAA,IAAIsZ,aAAa,CAACc,YAAD,CAAjB,EAAiC;AAC/Bna,IAAAA,GAAG,GAAG,CAAN,CAAA;AACD,GAjBiD;AAoBlD;;;AACA,EAAA,IACE,CAACqZ,aAAa,CAACc,YAAD,CAAd,IACAZ,cAAc,CAACa,QAAD,EAAWD,YAAX,CAFhB,EAGE;AACApa,IAAAA,KAAK,GAAGua,qBAAqB,CAAC/e,IAAD,EAAOgB,MAAP,CAA7B,CAAA;AACD,GA1BiD;AA6BlD;;;AACA,EAAA,IAAIgd,cAAc,CAACc,QAAD,EAAWF,YAAX,CAAlB,EAA4C;AAC1Cna,IAAAA,GAAG,GAAGua,oBAAoB,CAAChf,IAAD,EAAOgB,MAAP,CAA1B,CAAA;AACD,GAAA;;AAED,EAAO,OAAA,CAACA,MAAM,GAAGwD,KAAV,EAAiBxD,MAAM,GAAGyD,GAA1B,CAAP,CAAA;AACD,CAAA;;AAED,SAASwa,aAAT,CAAuBjf,IAAvB,EAAqCgB,MAArC,EAAqD0L,OAArD,EAAwE;AACtE,EAAIrP,IAAAA,MAAM,GAAG,CAAb,CAAA;AACA,EAAIgK,IAAAA,CAAC,GAAGrG,MAAR,CAAA;AACA,EAAI6c,IAAAA,IAAI,GAAGO,aAAa,CAACpe,IAAD,EAAOqH,CAAP,EAAUqF,OAAV,CAAxB,CAAA;AACA,EAAMwS,MAAAA,OAAO,GAAGrB,IAAhB,CAAA;;AAEA,EAAA,OAAOG,cAAc,CAACH,IAAD,EAAOqB,OAAP,CAArB,EAAsC;AACpC7hB,IAAAA,MAAM,IAAIwgB,IAAI,CAACxgB,MAAf,CAAA;;AACA,IAAA,IAAIqP,OAAJ,EAAa;AACXrF,MAAAA,CAAC,IAAIwW,IAAI,CAACxgB,MAAV,CAAA;AACD,KAFD,MAEO;AACLgK,MAAAA,CAAC,IAAIwW,IAAI,CAACxgB,MAAV,CAAA;AACD,KAAA;;AACDwgB,IAAAA,IAAI,GAAGO,aAAa,CAACpe,IAAD,EAAOqH,CAAP,EAAUqF,OAAV,CAApB,CAAA;AACD,GAdqE;;;AAiBtE,EAAA,OAAOrP,MAAM,IAAIwgB,IAAI,CAACxgB,MAAtB,CAAA;AACD;;;AAGD,SAAS8hB,iBAAT,CAA2Bnf,IAA3B,EAAyCgB,MAAzC,EAAyD0L,OAAzD,EAA4E;AAC1E,EAAImR,IAAAA,IAAI,GAAGO,aAAa,CAACpe,IAAD,EAAOgB,MAAP,EAAe0L,OAAf,CAAxB,CAAA;;AACA,EAAA,IAAI,CAACoR,aAAa,CAACD,IAAD,CAAlB,EAA0B;AACxB,IAAA,OAAO,CAAP,CAAA;AACD,GAAA;;AAED,EAAI7X,IAAAA,KAAK,GAAG,CAAZ,CAAA;AACA,EAAA,IAAIqB,CAAC,GAAGrG,MAAR,CAP0E;;AAU1E,EAAA,OAAO0c,KAAK,CAACtjB,IAAN,CAAWyjB,IAAX,CAAP,EAAyB;AACvB,IAAA,IAAInR,OAAJ,EAAa;AACXrF,MAAAA,CAAC,IAAIwW,IAAI,CAACxgB,MAAV,CAAA;AACA2I,MAAAA,KAAK,IAAI,CAAT,CAAA;AACD,KAHD,MAGO;AACLqB,MAAAA,CAAC,IAAIwW,IAAI,CAACxgB,MAAV,CAAA;AACA2I,MAAAA,KAAK,IAAI,CAAT,CAAA;AACD,KAAA;;AACD6X,IAAAA,IAAI,GAAGO,aAAa,CAACpe,IAAD,EAAOqH,CAAP,EAAUqF,OAAV,CAApB,CAAA;AACD,GAAA;;AAED,EAAA,OAAOvF,IAAI,CAACiY,GAAL,CAASpZ,KAAT,CAAkBiZ,GAAAA,aAAa,CAACjf,IAAD,EAAOgB,MAAM,GAAGgF,KAAhB,EAAuB0G,OAAvB,CAAtC,CAAA;AACD,CAAA;;AAED,SAASqS,qBAAT,CAA+B/e,IAA/B,EAA6CgB,MAA7C,EAA6D;AAC3D,EAAMsB,MAAAA,CAAC,GAAG2c,aAAa,CAACjf,IAAD,EAAOgB,MAAP,EAAe,IAAf,CAAvB,CAAA;AACA,EAAA,OAAOsB,CAAP,CAAA;AACD,CAAA;;AAED,SAAS0c,oBAAT,CAA8Bhf,IAA9B,EAA4CgB,MAA5C,EAA4D;AAC1D,EAAA,MAAMsB,CAAC,GAAG2c,aAAa,CAACjf,IAAD,EAAOgB,MAAP,CAAvB,CAAA;AACA,EAAA,OAAOsB,CAAP,CAAA;AACD,CAAA;;AAED,SAAS+c,cAAT,CAAwBrf,IAAxB,EAAgD;AAC9C,EAAA,OAAOqe,gBAAe,CAACd,KAAhB,CAAsBvd,IAAtB,CAAP,CAAA;AACD,CAAA;;AAGD,MAAMsf,SAAO,GAAG,IAAhB,CAAA;AACA,MAAMC,OAAO,GAAG,IAAhB,CAAA;AACA,MAAMC,YAAY,GAAGC,MAAM,CAACC,YAAP,CAAoB,EAApB,CAArB,CAAA;AACO,MAAMC,YAAY,GAAG;AAC1BC,EAAAA,IAAI,EAAE,QADoB;AAE1BC,EAAAA,IAAI,EAAE,QAFoB;AAG1BC,EAAAA,GAAG,EAAE,QAAA;AAHqB,CAArB,CAAA;AAKP;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASC,eAAT,CAAuB/f,IAAvB,EAA6C;AAClD,EAAIsF,IAAAA,MAAM,GAAG,EAAb,CAAA;;AACA,EAAA,KAAK,IAAI+B,CAAC,GAAGrH,IAAI,CAAC3C,MAAL,GAAc,CAA3B,EAA8BgK,CAAC,IAAI,CAAnC,EAAsCA,CAAC,EAAvC,EAA2C;AACzC,IAAA,IAAIrH,IAAI,CAACqH,CAAD,CAAJ,KAAYiY,SAAhB,EAAyB;AACvB,MAAItf,IAAAA,IAAI,CAACqH,CAAC,GAAG,CAAL,CAAJ,KAAgBkY,OAApB,EAA6B;AAC3BlY,QAAAA,CAAC,EAAA,CAAA;AACF,OAAA;;AACD/B,MAAAA,MAAM,GAAGga,SAAO,GAAGha,MAAnB,CAAA;AACA,MAAA,SAAA;AACD,KAAA;;AACD,IAAA,IAAItF,IAAI,CAACqH,CAAD,CAAJ,KAAYkY,OAAhB,EAAyB;AACvBja,MAAAA,MAAM,GAAGga,SAAO,GAAGha,MAAnB,CAAA;AACA,MAAA,SAAA;AACD,KAAA;;AACD,IAAItF,IAAAA,IAAI,CAACqH,CAAD,CAAJ,KAAYsY,YAAY,CAACC,IAA7B,EAAmC;AACjCta,MAAAA,MAAM,GAAGka,YAAY,GAAGla,MAAxB,CAAA;AACA,MAAA,SAAA;AACD,KAAA;;AACD,IAAA,IAAItF,IAAI,CAACqH,CAAD,CAAJ,KAAYsY,YAAY,CAACE,IAAzB,IAAiC7f,IAAI,CAACqH,CAAD,CAAJ,KAAYsY,YAAY,CAACG,GAA9D,EAAmE;AACjE,MAAA,SAAA;AACD,KAAA;;AACDxa,IAAAA,MAAM,GAAGtF,IAAI,CAACqH,CAAD,CAAJ,GAAU/B,MAAnB,CAAA;AACD,GAAA;;AACD,EAAA,OAAOA,MAAP,CAAA;AACD,CAAA;AAED,gBAAe;AACb+X,EAAAA,WADa;AAEbe,EAAAA,aAFa;AAGbG,EAAAA,aAHa;AAIbC,EAAAA,qBAJa;AAKbC,EAAAA,oBALa;AAMbC,EAAAA,YANa;AAObC,EAAAA,YAPa;AAQbM,EAAAA,aARa;AASbE,EAAAA,iBATa;AAUbJ,EAAAA,qBAVa;AAWbC,EAAAA,oBAXa;AAYbrD,EAAAA,WAZa;AAabwC,EAAAA,MAba;AAcbJ,EAAAA,MAda;AAebH,EAAAA,aAfa;AAgBbyB,EAAAA,cAhBa;AAiBbU,iBAAAA,eAAAA;AAjBa,CAAf;;AC9OA,SAASC,cAAT,CAAwBC,EAAxB,EAAkE;AAChE,EAAA,OAAQA,EAAE,KAAK,IAAP,IACRA,EAAE,CAACC,QAAH,KAAgB5jB,IAAI,CAAC6jB,YADb,IAER,CAAEF,EAAD,CAAgBG,YAAhB,CAA6B,sBAA7B,CAFD,CAAA;AAGD,CAAA;AAED;AACA;AACA;AACA;AACA;;;AACe,SAASC,oBAAT,CAA8BJ,EAA9B,EAAyDK,QAAzD,EAA2F;AACxG,EAAG,GAAA;AACD,IAAA,IAAItjB,OAAO,CAAC6N,SAAR,CAAkB0V,OAAlB,CAA0BC,IAA1B,CAA+BP,EAA/B,EAAmCK,QAAnC,CAAJ,EAAkD,OAAOL,EAAP,CAAA;AAClDA,IAAAA,EAAE,GAAGA,EAAE,CAAEQ,aAAJ,IAAqBR,EAAE,CAAES,UAA9B,CAAA;AACD,GAHD,QAICV,cAAc,CAACC,EAAD,CAJf,EAAA;;AAMA,EAAA,OAAO,IAAP,CAAA;AACD;;ACnBD;AACA;AACA;AACA;AAEO,MAAMU,iBAAiB,GAAG;AAC/BC,EAAAA,QAAQ,EAAE,gCADqB;AAE/BC,EAAAA,OAAO,EAAE,qCAFsB;AAG/BC,EAAAA,IAAI,EAAE,yBAHyB;AAI/BC,EAAAA,MAAM,EAAE,uBAJuB;AAK/BC,EAAAA,QAAQ,EAAE,wBALqB;AAM/BC,EAAAA,UAAU,EAAE,kCANmB;AAO/BC,EAAAA,kBAAkB,EAAE,oBAAA;AAPW,CAA1B,CAAA;AAUA,MAAMC,UAAU,GAAG;AACxBC,EAAAA,IAAI,EAAE,WADkB;AAExBC,EAAAA,IAAI,EAAE,YAFkB;AAGxB,EAAGV,GAAAA,iBAAAA;AAHqB,CAAnB,CAAA;AAMA,MAAMW,MAAM,GAAG,CACpB,UADoB,EAEpB,UAFoB,EAGpB,gBAHoB,EAIpB,eAJoB,EAKpB,gBALoB,EAMpB,iBANoB,EAOpB,eAPoB,EAQpB,cARoB,EASpB,gBAToB,EAUpB,0BAVoB,EAWpB,SAXoB,EAYpB,QAZoB,EAapB,OAboB,EAcpB,SAdoB,EAepB,WAfoB,EAgBpB,SAhBoB,EAiBpB,aAjBoB,EAkBpB,aAlBoB,EAmBpB,WAnBoB,EAoBpB,cApBoB,EAqBpB,aArBoB,EAsBpB,YAtBoB,EAuBpB,eAvBoB,EAwBpB,aAxBoB,EAyBpB,YAzBoB,EA0BpB,QA1BoB,EA2BpB,aA3BoB,CAAf,CAAA;AA8BP;AACA;AACA;;AACO,MAAMC,YAAY,GAAG,CAArB,CAAA;AAEP;AACA;AACA;;AACO,MAAMC,sBAAsB,GAAG,EAA/B,CAAA;AAEP;AACA;AACA;;AACO,MAAMC,kBAAkB,GAAG,CAA3B,CAAA;AAEA,MAAMC,aAAa,GAAG,QAAtB,CAAA;AAEP;AACA;AACA;;AACO,MAAMC,uBAAuB,GAAG,wBAAhC,CAAA;AAEP;AACA;AACA;;AACO,MAAMC,6BAA6B,GAAG,CAAtC,CAAA;AAEP;AACA;AACA;;AACO,MAAMC,gCAAgC,GAAG,0BAAzC,CAAA;AAEA,MAAMC,mBAAmB,GAAG,KAA5B,CAAA;AAEA,MAAMC,QAAQ,GAAG;AACtB7lB,EAAAA,GAAG,EAAE,kBADiB;AAEtB8lB,EAAAA,OAAO,EAAE,sBAFa;AAGtBC,EAAAA,cAAc,EAAE,8BAHM;AAItBC,EAAAA,QAAQ,EAAE,uBAJY;AAKtBC,EAAAA,IAAI,EAAE,mBALgB;AAMtBxhB,EAAAA,IAAI,EAAE,mBANgB;AAOtByhB,EAAAA,SAAS,EAAE,yBAPW;AAQtBC,EAAAA,SAAS,EAAE,yBARW;AAStBC,EAAAA,WAAW,EAAE,2BATS;AAUtBC,EAAAA,MAAM,EAAE,qBAVc;AAWtBC,EAAAA,cAAc,EAAE,8BAXM;AAYtBC,EAAAA,gBAAgB,EAAE,gCAZI;AAatBC,EAAAA,UAAU,EAAE,0BAbU;AActBC,EAAAA,QAAQ,EAAE,wBAdY;AAetBC,EAAAA,YAAY,EAAE,gBAfQ;AAgBtBC,EAAAA,IAAI,EAAE,iBAAA;AAhBgB,CAAjB,CAAA;AAmBP;AACA;AACA;;AACO,MAAMC,gBAAgB,GAAG,GAAzB,CAAA;AAEP;;AACO,MAAMC,mBAAmB,GAAG,uBAA5B;;;;;;;;;;;;;;;;;;;;AC9GP;AACA;AACA;AACA;AAOA;AACA;AACA;;AACA,SAASC,SAAT,CACEC,UADF,EAEEC,YAFF,EAGEjP,UAHF,EAIE;AACA,EAAI,IAAA,CAACgP,UAAL,EAAiB;AACf,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AAED,EAAM1nB,MAAAA,IAAI,GACR0nB,UAAU,YAAYlmB,IAAtB,GACIkmB,UAAU,CAACxC,aADf,GAEIwC,UAHN,CAAA;;AAIA,EAAA,IAAI,EAAE1nB,IAAI,YAAYyB,OAAlB,CAAJ,EAAgC;AAC9B,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AAED,EAAM,MAAA;AAAEkc,IAAAA,QAAAA;AAAF,GAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;AAEA,EAAA,IAAIwE,IAAJ,CAAA;;AACA,EAAIpF,IAAAA,IAAI,CAAC6kB,YAAL,CAAkB2B,QAAQ,CAACI,IAA3B,CAAJ,EAAsC;AACpC;AACA;AACA;AACA,IAAMjmB,MAAAA,GAAG,GAAGX,IAAI,CAAC6kB,YAAL,CAAkB2B,QAAQ,CAAC7lB,GAA3B,CAAZ,CAAA;;AACA,IAAI,IAAA,CAACA,GAAL,EAAU;AACR,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,MAAMinB,QAAQ,GAAGjK,QAAQ,CAACtN,OAAT,CAAiB1P,GAAjB,CAAjB,CAAA;;AACA,IAAI,IAAA,CAACinB,QAAL,EAAe;AACb,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,MAAMnjB,IAAI,GAAGmjB,QAAQ,CAAC5lB,YAAT,EAAb,CAAA;;AACA,IAAI,IAAA,CAACyC,IAAL,EAAW;AACT,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAOsY,OAAAA,SAAS,CAAC5a,MAAV,CAAiB;AACtBxB,MAAAA,GAAG,EAAE8D,IAAI,CAAC9D,GADY;AAEtB8E,MAAAA,MAAM,EAAE,CAAA;AAFc,KAAjB,CAAP,CAAA;AAID,GApBD,MAoBO;AACLL,IAAAA,IAAI,GAAGpF,IAAI,CAAC6kB,YAAL,CAAmB,CAAA,CAAA,EAAG2B,QAAQ,CAACphB,IAAK,CAAA,CAAA,CAApC,IACHpF,IADG,GAEH8kB,oBAAoB,CAAC9kB,IAAD,EAAQ,IAAGwmB,QAAQ,CAACphB,IAAK,CAAA,CAAA,CAAzB,CAFxB,CAAA;AAGD,GAAA;;AAED,EAAI,IAAA,CAACA,IAAL,EAAW;AACT,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AAED,EAAA,MAAM,CAACzE,GAAD,EAAM8E,MAAN,CAAgBkB,GAAAA,QAAQ,CAACE,KAAT,CACpBzB,IAAI,CAACyf,YAAL,CAAkB2B,QAAQ,CAAC7lB,GAA3B,CAAA,IAAmC,EADf,CAAtB,CAAA;AAIA,EAAA,MAAM8D,IAAI,GAAGkZ,QAAQ,CAACtN,OAAT,CAAiB1P,GAAjB,CAAb,CAAA;;AACA,EAAI,IAAA,CAAC8D,IAAL,EAAW;AACT,IAAA,OAAO,IAAP,CAAA;AACD,GArDD;;;AAuDA,EAAMojB,MAAAA,UAAU,GAAGziB,IAAI,CAAC0iB,WAAL,IAAoB1iB,IAAI,CAAC0iB,WAAL,KAAqB3B,aAAzC,GACf/gB,IAAI,CAAC0iB,WAAL,CAAiBvkB,KAAjB,CAAuB,CAAvB,EAA0BokB,YAA1B,CADe,GAEf,EAFJ,CAAA;AAGA,EAAO5K,OAAAA,SAAS,CAAC5a,MAAV,CAAiB;AACtBxB,IAAAA,GADsB;AAEtB8E,IAAAA,MAAM,EAAEA,MAAM,GAAGoiB,UAAU,CAAC/lB,MAAAA;AAFN,GAAjB,CAAP,CAAA;AAID;;AC/ED;AACA;AACA;AACA;AAKA;AACA;AACA;;AACA,SAASimB,SAAT,CAAmBC,MAAnB,EAAkCtP,UAAlC,EAA0D;AACxD,EAAM,MAAA;AACJuP,IAAAA,cADI;AAEJpiB,IAAAA,WAFI;AAGJqiB,IAAAA,YAHI;AAIJxiB,IAAAA,SAJI;AAKJyiB,IAAAA,SAAAA;AALI,GAAA,GAMFH,MANJ,CAAA;AAOA,EAAM/e,MAAAA,KAAK,GAAGwe,SAAS,CAACQ,cAAD,EAAiBpiB,WAAjB,EAA8B6S,UAA9B,CAAvB,CAAA;AACA,EAAA,MAAMxP,GAAG,GAAGif,SAAS,GACjBlf,KADiB,GAEjBwe,SAAS,CAACS,YAAD,EAAexiB,SAAf,EAA0BgT,UAA1B,CAFb,CAAA;;AAGA,EAAA,IAAI,CAACzP,KAAD,IAAU,CAACC,GAAf,EAAoB;AAClB,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AACD,EAAOkf,OAAAA,SAAS,CAACjmB,MAAV,CAAiB;AAAEkmB,IAAAA,MAAM,EAAEpf,KAAV;AAAiBqf,IAAAA,KAAK,EAAEpf,GAAAA;AAAxB,GAAjB,CAAP,CAAA;AACD;;AC3BD;AACA;AACA;AACA;;AAcA,MAAMqf,mBAAmB,GAAG,CAACC,CAAD,EAAY3U,CAAZ,EAAe4U,IAAf,KAAiCD,CAAC,GAAGC,IAAI,CAAC9iB,IAAtE,CAAA;;AACA,MAAM+iB,oBAAoB,GAAG,CAACF,CAAD,EAAY3U,CAAZ,EAAe4U,IAAf,KAAiCD,CAAC,GAAGC,IAAI,CAAC7iB,KAAvE,CAAA;;AACA,MAAM+iB,kBAAkB,GAAG,CAAC9U,CAAD,EAAI+U,CAAJ,EAAeH,IAAf,KAAiCG,CAAC,GAAGH,IAAI,CAACI,GAArE,CAAA;;AACA,MAAMC,qBAAqB,GAAG,CAACjV,CAAD,EAAI+U,CAAJ,EAAeH,IAAf,KAAiCG,CAAC,GAAGH,IAAI,CAACM,MAAxE,CAAA;;AACA,MAAMC,qBAAqB,GAAG,CAACR,CAAD,EAAY3U,CAAZ,EAAe4U,IAAf,KAC5BD,CAAC,IAAIC,IAAI,CAAC9iB,IAAV,IAAkB6iB,CAAC,IAAIC,IAAI,CAAC7iB,KAD9B,CAAA;;AAEA,MAAMqjB,qBAAqB,GAAG,CAACpV,CAAD,EAAI+U,CAAJ,EAAeH,IAAf,KAC5BG,CAAC,IAAIH,IAAI,CAACI,GAAV,IAAiBD,CAAC,IAAIH,IAAI,CAACM,MAD7B,CAAA;;AAEA,MAAMG,iBAAiB,GAAG,CAACV,CAAD,EAAYI,CAAZ,EAAuBH,IAAvB,KAAyC;AACjE,EAAA,OAAOO,qBAAqB,CAACR,CAAD,EAAII,CAAJ,EAAOH,IAAP,CAArB,IAAqCQ,qBAAqB,CAACT,CAAD,EAAII,CAAJ,EAAOH,IAAP,CAAjE,CAAA;AACD,CAFD,CAAA;;AAIA,MAAMU,6BAA6B,GAAG,CAACX,CAAD,EAAI3U,CAAJ,EAAO4U,IAAP,KAAgBD,CAAC,GAAGC,IAAI,CAAC9iB,IAA/D,CAAA;;AACA,MAAMyjB,4BAA4B,GAAG,CAACZ,CAAD,EAAI3U,CAAJ,EAAO4U,IAAP,KAAgBD,CAAC,GAAGC,IAAI,CAAC7iB,KAA9D;;;AAGA,MAAMyjB,mBAAmB,GAAG,GAA5B,CAAA;AACO,MAAMC,sBAAsB,GAAG,CAACC,OAAD,EAAsDd,IAAtD,KAA2G;AAC/I;AACA,EAAA,IAAIc,OAAO,CAACR,MAAR,KAAmBN,IAAI,CAACM,MAA5B,EAAoC;AAClC,IAAA,OAAO,IAAP,CAAA;AACD,GAJ8I;;;AAM/I,EAAA,IAAIQ,OAAO,CAACV,GAAR,GAAcJ,IAAI,CAACM,MAAnB,IAA6BN,IAAI,CAACI,GAAL,GAAWU,OAAO,CAACR,MAApD,EAA4D;AAC1D,IAAA,OAAO,KAAP,CAAA;AACD,GAR8I;AAW/I;;;AACA,EAAA,MAAMS,aAAa,GAAG5d,IAAI,CAACC,GAAL,CAAS4c,IAAI,CAACgB,MAAd,EAAsBF,OAAO,CAACE,MAA9B,CAAtB,CAAA;AACA,EAAMC,MAAAA,OAAO,GAAG9d,IAAI,CAACC,GAAL,CAAS0d,OAAO,CAACR,MAAjB,EAAyBN,IAAI,CAACM,MAA9B,CAAwCnd,GAAAA,IAAI,CAAC+d,GAAL,CAASJ,OAAO,CAACV,GAAjB,EAAsBJ,IAAI,CAACI,GAA3B,CAAxD,CAAA;AACA,EAAOW,OAAAA,aAAa,KAAK,CAAlB,IAAuBE,OAAO,GAAGF,aAAV,GAA0BH,mBAAxD,CAAA;AACD,CAfM,CAAA;AAiBP,MAAMO,qBAAqB,GAAG,IAA9B;;AACA,MAAMC,gBAAgB,GAAG,CAACvmB,CAAD,EAAYI,CAAZ,KAA0BkI,IAAI,CAACiY,GAAL,CAASvgB,CAAC,GAAGI,CAAb,CAAkBkmB,GAAAA,qBAArE;;;AAGA,MAAME,kBAAkB,GAAG,CACzBP,OADyB,EAEzBQ,cAFyB,EAGzBC,eAHyB,KAItB;AACH,EAAA,OACET,OAAO,CAAC5jB,IAAR,GAAeqkB,eAAe,CAACC,WAAhB,CAA4BtkB,IAA3C,IACC4jB,OAAO,CAAC5jB,IAAR,KAAiBqkB,eAAe,CAACC,WAAhB,CAA4BtkB,IAA7C,IACCokB,cAAc,CAACG,uBAAf,CAAuCF,eAAe,CAACG,WAAvD,CACEppB,KAAAA,IAAI,CAACqpB,2BAJX,CAAA;AAMD,CAXD,CAAA;;AAYA,MAAMC,mBAAmB,GAAG,CAC1Bd,OAD0B,EAE1BQ,cAF0B,EAG1BC,eAH0B,KAIvB;AACH;AACA;AACA,EAAA,OACET,OAAO,CAAC3jB,KAAR,GAAgBokB,eAAe,CAACC,WAAhB,CAA4BrkB,KAA5B,GAAoCgkB,qBAApD,IACCC,gBAAgB,CAACN,OAAO,CAAC3jB,KAAT,EAAgBokB,eAAe,CAACC,WAAhB,CAA4BrkB,KAA5C,CAAhB,IACCmkB,cAAc,CAACG,uBAAf,CAAuCF,eAAe,CAACG,WAAvD,CACEppB,KAAAA,IAAI,CAACupB,2BAJX,CAAA;AAMD,CAbD,CAAA;;AAeA,MAAMC,iBAAiB,GAAG,CACxBhB,OADwB,EAExBQ,cAFwB,EAGxBC,eAHwB,KAIrB;AACH,EAAA,OACET,OAAO,CAACV,GAAR,GAAcmB,eAAe,CAACC,WAAhB,CAA4BpB,GAA1C,IACCU,OAAO,CAACV,GAAR,KAAgBmB,eAAe,CAACC,WAAhB,CAA4BpB,GAA5C,IACCkB,cAAc,CAACG,uBAAf,CAAuCF,eAAe,CAACG,WAAvD,CACEppB,KAAAA,IAAI,CAACqpB,2BAJX,CAAA;AAMD,CAXD,CAAA;;AAaA,MAAMI,oBAAoB,GAAG,CAC3BjB,OAD2B,EAE3BQ,cAF2B,EAG3BC,eAH2B,KAIxB;AACH,EAAA,OACET,OAAO,CAACR,MAAR,GAAiBiB,eAAe,CAACC,WAAhB,CAA4BlB,MAA7C,IACCQ,OAAO,CAACV,GAAR,KAAgBmB,eAAe,CAACC,WAAhB,CAA4BlB,MAA5C,IACCgB,cAAc,CAACG,uBAAf,CAAuCF,eAAe,CAACG,WAAvD,CACEppB,KAAAA,IAAI,CAACupB,2BAJX,CAAA;AAMD,CAXD,CAAA;;AAaA,MAAMG,eAAe,GAAG,CAACjC,CAAD,EAAI3U,CAAJ,EAAO4U,IAAP,KAAgB;AACtC,EAAO7c,OAAAA,IAAI,CAACC,GAAL,CAASD,IAAI,CAACiY,GAAL,CAAS2E,CAAC,GAAGC,IAAI,CAAC9iB,IAAlB,CAAT,EAAkCiG,IAAI,CAACiY,GAAL,CAAS2E,CAAC,GAAGC,IAAI,CAAC7iB,KAAlB,CAAlC,CAAP,CAAA;AACD,CAFD,CAAA;;AAIA,SAAS8kB,0CAAT,CAAoD3V,OAApD,EAAsE;AACpE,EAAA,MAAM0T,IAAI,GAAG1T,OAAO,CAAC4V,qBAAR,EAAb,CAAA;AACA,EAAA,IAAIzd,MAAM,GAAG6H,OAAO,CAACmQ,aAArB,CAAA;;AACA,EAAA,OAAOhY,MAAP,EAAe;AACb,IAAA,MAAM0d,UAAU,GAAG1d,MAAM,CAACyd,qBAAP,EAAnB,CAAA;;AACA,IAAA,IAAIC,UAAU,CAACjlB,IAAX,GAAkB8iB,IAAI,CAAC9iB,IAAvB,IAA+BilB,UAAU,CAAChlB,KAAX,GAAmB6iB,IAAI,CAAC7iB,KAA3D,EAAkE;AAChE,MAAA,OAAOsH,MAAP,CAAA;AACD,KAAA;;AACDA,IAAAA,MAAM,GAAGA,MAAM,CAAC2X,YAAP,CAAoB2B,QAAQ,CAACC,OAA7B,CACL,GAAA,IADK,GAELvZ,MAAM,CAACgY,aAFX,CAAA;AAGD,GAAA;;AACD,EAAA,OAAO,IAAP,CAAA;AACD,CAAA;;AAED,UAAU2F,6BAAV,CAAwC9V,OAAxC,EAA0D;AACxD,EAAM+V,MAAAA,sBAAsB,GAAG/V,OAAO,CAACjC,OAAR,CAAiB,CAAA,CAAA,EAAG0T,QAAQ,CAACE,cAAe,CAAA,CAAA,CAA5C,CAA/B,CAAA;;AACA,EAAA,IAAIoE,sBAAJ,EAA4B;AAC1B,IAAA,MAAMA,sBAAN,CAAA;AACD,GAAA;;AACD,EAAMC,MAAAA,yBAAyB,GAAGhW,OAAO,CAACiW,gBAAR,CAA0B,CAAA,CAAA,EAAGxE,QAAQ,CAACE,cAAe,CAAA,CAAA,CAArD,CAAlC,CAAA;;AACA,EAAI,IAAA,CAACqE,yBAAL,EAAgC;AAC9B,IAAA,OAAA;AACD,GAAA;;AACD,EAAK,KAAA,MAAME,UAAX,IAAyB/iB,KAAK,CAAC2X,IAAN,CAAWkL,yBAAX,CAAzB,EAAgE;AAC9D,IAAA,MAAME,UAAN,CAAA;AACD,GAAA;AACF,CAAA;;AAED,UAAUC,mBAAV,CAA8BnW,OAA9B,EAAgD;AAC9C;AACA,EAAMoW,MAAAA,WAAW,GAAGpW,OAAO,CAAC8P,YAAR,CAAqB2B,QAAQ,CAACM,SAA9B,CAApB,CAAA;AACA,EAAA,MAAMsE,aAAa,GAAGtG,oBAAoB,CAAC/P,OAAD,EAAW,CAAGyR,CAAAA,EAAAA,QAAQ,CAACK,SAAU,GAAjC,CAApB,IAA4D9R,OAAO,CAACmQ,aAApE,IAAqFnQ,OAA3G,CAAA;AACA,EAAA,MAAMsW,aAAa,GAAGF,WAAW,GAAGC,aAAH,GAAmBrW,OAApD,CAAA;AACA,EAAMuW,MAAAA,YAAY,GAAGD,aAAa,CAACL,gBAAd,CAAgC,CAAA,KAAA,EAAOxE,QAAQ,CAACphB,IAAK,CAAA,CAAA,CAArD,CAArB,CAAA;;AAEA,EAAA,KAAK,IAAI0G,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwf,YAAY,CAACxpB,MAAjC,EAAyCgK,CAAC,IAAI,CAA9C,EAAiD;AAC/C,IAAA,MAAMyf,WAAW,GAAGD,YAAY,CAACxf,CAAD,CAAhC,CAAA;AACA,IAAM,MAAA;AACJqe,MAAAA,WAAW,EAAEoB,WADT;AAEJC,MAAAA,YAAY,EAAEtjB,KAAK,CAAC2X,IAAN,CAAW0L,WAAW,CAACE,cAAZ,EAAX,CAAA;AAFV,KAAN,CAAA;AAID,GAAA;;AACD,EAAMC,MAAAA,YAAY,GAAGL,aAAa,CAACL,gBAAd,CAAgC,CAAA,CAAA,EAAGxE,QAAQ,CAACI,IAAK,CAAA,CAAA,CAAjD,CAArB,CAAA;;AACA,EAAA,KAAK,IAAI9a,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG4f,YAAY,CAAC5pB,MAAjC,EAAyCgK,CAAC,IAAI,CAA9C,EAAiD;AAC/C,IAAA,MAAM6f,WAAW,GAAGD,YAAY,CAAC5f,CAAD,CAAhC,CAAA;AACA,IAAM,MAAA;AACJqe,MAAAA,WAAW,EAAEwB,WADT;AAEJH,MAAAA,YAAY,EAAE,CAACG,WAAW,CAAChB,qBAAZ,EAAD,CAAA;AAFV,KAAN,CAAA;AAID,GAAA;AACF,CAAA;;AAED,SAASiB,yBAAT,CAAmC7W,OAAnC,EAAqDyT,CAArD,EAAgEI,CAAhE,EAA2E;AACzE,EAAIiD,IAAAA,YAAgC,GAAG,IAAvC,CAAA;AACA,EAAIC,IAAAA,WAA+B,GAAG,IAAtC,CAAA;AACA,EAAIC,IAAAA,YAAgC,GAAG,IAAvC,CAAA;AACA,EAAIC,IAAAA,UAA8B,GAAG,IAArC,CAAA;;AAEA,EAAA,KAAK,MAAMvD,IAAX,IAAmByC,mBAAmB,CAACnW,OAAD,CAAtC,EAAiD;AAC/C,IAAM,MAAA;AAAEoV,MAAAA,WAAAA;AAAF,KAAA,GAAkB1B,IAAxB,CAAA;;AACA,IAAA,KAAK,IAAIrlB,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAGqlB,IAAI,CAAC+C,YAAL,CAAkB1pB,MAA9C,EAAsDsB,KAAK,EAA3D,EAA+D;AAC7D,MAAA,MAAM6mB,WAAW,GAAGxB,IAAI,CAAC+C,YAAL,CAAkBpoB,KAAlB,CAApB,CAAA;;AACA,MAAI,IAAA,CAAC6mB,WAAL,EAAkB;AAChB,QAAA,SAAA;AACD,OAAA;;AACD,MAAIf,IAAAA,iBAAiB,CAACV,CAAD,EAAII,CAAJ,EAAOqB,WAAP,CAArB,EAA0C;AACxC,QAAO,OAAA;AAAEgC,UAAAA,WAAW,EAAE9B,WAAAA;AAAf,SAAP,CAAA;AACD,OAAA;;AACD,MAAIxB,IAAAA,kBAAkB,CAACH,CAAD,EAAII,CAAJ,EAAOqB,WAAP,CAAtB,EAA2C;AACzC,QAAA,IAAIjkB,KAAK,GAAG,KAAZ,CADyC;AAGzC;;AACA,QAAI,IAAA,CAAC6lB,YAAL,EAAmB;AACjB;AACA7lB,UAAAA,KAAK,GAAG,IAAR,CAAA;AACD,SAHD,MAGO,IAAIsjB,sBAAsB,CAACW,WAAD,EAAc4B,YAAY,CAAC5B,WAA3B,CAA1B,EAAmE;AACxE;AACA;AACA,UAAMiC,MAAAA,cAAc,GAAGlD,qBAAqB,CAC1CR,CAD0C,EAE1CI,CAF0C,EAG1CiD,YAAY,CAAC5B,WAH6B,CAA5C,CAAA;AAKA,UAAMkC,MAAAA,aAAa,GAAGnD,qBAAqB,CAACR,CAAD,EAAII,CAAJ,EAAOqB,WAAP,CAA3C,CAAA;AACA,UAAMmC,MAAAA,YAAY,GAAG3B,eAAe,CAACjC,CAAD,EAAII,CAAJ,EAAOiD,YAAY,CAAC5B,WAApB,CAApC,CAAA;AACA,UAAMoC,MAAAA,WAAW,GAAG5B,eAAe,CAACjC,CAAD,EAAII,CAAJ,EAAOqB,WAAP,CAAnC,CAVwE;AAaxE;AACA;;AACA,UACE,IAAA,CAACiC,cAAD,KACCC,aAAa,IAAIE,WAAW,GAAGD,YADhC,CADF,EAGE;AACApmB,YAAAA,KAAK,GAAG,IAAR,CAAA;AACD,WAAA;AACF,SArBM,MAqBA,IAAIukB,iBAAiB,CAACN,WAAD,EAAcE,WAAd,EAA2B0B,YAA3B,CAArB,EAA+D;AACpE;AACA;AACA7lB,UAAAA,KAAK,GAAG,IAAR,CAAA;AACD,SAAA;;AACD,QAAA,IAAIA,KAAJ,EAAW;AACT6lB,UAAAA,YAAY,GAAG;AACb5B,YAAAA,WADa;AAEbE,YAAAA,WAAAA;AAFa,WAAf,CAAA;AAID,SAAA;AACF,OAvCD,MAuCO,IAAIrB,qBAAqB,CAACN,CAAD,EAAII,CAAJ,EAAOqB,WAAP,CAAzB,EAA8C;AACnD,QAAIjkB,IAAAA,KAAK,GAAG,KAAZ,CAAA;;AACA,QAAI,IAAA,CAACgmB,UAAL,EAAiB;AACfhmB,UAAAA,KAAK,GAAG,IAAR,CAAA;AACD,SAFD,MAEO,IAAIsjB,sBAAsB,CAACW,WAAD,EAAc+B,UAAU,CAAC/B,WAAzB,CAA1B,EAAiE;AACtE,UAAMqC,MAAAA,YAAY,GAAGtD,qBAAqB,CACxCR,CADwC,EAExCI,CAFwC,EAGxCoD,UAAU,CAAC/B,WAH6B,CAA1C,CAAA;AAKA,UAAMsC,MAAAA,WAAW,GAAGvD,qBAAqB,CAACR,CAAD,EAAII,CAAJ,EAAOqB,WAAP,CAAzC,CAAA;AACA,UAAMmC,MAAAA,YAAY,GAAG3B,eAAe,CAACjC,CAAD,EAAII,CAAJ,EAAOoD,UAAU,CAAC/B,WAAlB,CAApC,CAAA;AACA,UAAMoC,MAAAA,WAAW,GAAG5B,eAAe,CAACjC,CAAD,EAAII,CAAJ,EAAOqB,WAAP,CAAnC,CAAA;;AAEA,UAAI,IAAA,CAACqC,YAAD,KAAkBC,WAAW,IAAIF,WAAW,GAAGD,YAA/C,CAAJ,EAAkE;AAChEpmB,YAAAA,KAAK,GAAG,IAAR,CAAA;AACD,WAAA;AACF,SAbM,MAaA,IAAIwkB,oBAAoB,CAACP,WAAD,EAAcE,WAAd,EAA2B6B,UAA3B,CAAxB,EAAgE;AACrEhmB,UAAAA,KAAK,GAAG,IAAR,CAAA;AACD,SAAA;;AACD,QAAA,IAAIA,KAAJ,EAAW;AACTgmB,UAAAA,UAAU,GAAG;AACX/B,YAAAA,WADW;AAEXE,YAAAA,WAAAA;AAFW,WAAb,CAAA;AAID,SAAA;AACF,OA1BM,MA0BA,IACLlB,qBAAqB,CAACT,CAAD,EAAII,CAAJ,EAAOqB,WAAP,CAArB,IACAd,6BAA6B,CAACX,CAAD,EAAII,CAAJ,EAAOqB,WAAP,CAD7B,KAEC,CAAC6B,WAAD,IACCzB,mBAAmB,CAACJ,WAAD,EAAcE,WAAd,EAA2B2B,WAA3B,CAHrB,CADK,EAKL;AACAA,QAAAA,WAAW,GAAG;AACZ7B,UAAAA,WADY;AAEZE,UAAAA,WAAAA;AAFY,SAAd,CAAA;AAID,OAVM,MAUA,IACLlB,qBAAqB,CAACT,CAAD,EAAII,CAAJ,EAAOqB,WAAP,CAArB,IACAb,4BAA4B,CAACZ,CAAD,EAAII,CAAJ,EAAOqB,WAAP,CAD5B,KAEC,CAAC8B,YAAD,IACCjC,kBAAkB,CAACG,WAAD,EAAcE,WAAd,EAA2B4B,YAA3B,CAHpB,CADK,EAKL;AACAA,QAAAA,YAAY,GAAG;AACb9B,UAAAA,WADa;AAEbE,UAAAA,WAAAA;AAFa,SAAf,CAAA;AAID,OAAA;AACF,KAAA;AACF,GAAA;;AAED,EAAO,OAAA;AACL0B,IAAAA,YADK;AAELC,IAAAA,WAFK;AAGLC,IAAAA,YAHK;AAILC,IAAAA,UAAAA;AAJK,GAAP,CAAA;AAMD,CAAA;;AAED,SAASQ,kBAAT,CACE5V,QADF,EAEE6V,MAFF,EAGEC,MAHF,EAIEC,UAJF,EAKEC,QALF,EAMEC,UANF,EAOE;AACA,EAAA,MAAMC,KAAK,GAAGnP,QAAQ,CAACoP,WAAT,EAAd,CAAA;;AACA,EAAA,IAAIH,QAAQ,GAAGD,UAAX,GAAwB,CAA5B,EAA+B;AAC7B,IAAA,MAAMlnB,MAAM,GAAGmG,IAAI,CAACohB,KAAL,CAAW,CAACL,UAAU,GAAGC,QAAd,IAA0B,CAArC,CAAf,CAAA;;AACA,IAAI,IAAA;AACFE,MAAAA,KAAK,CAACG,QAAN,CAAerW,QAAf,EAAyBnR,MAAzB,CAAA,CAAA;AACAqnB,MAAAA,KAAK,CAACI,MAAN,CAAatW,QAAb,EAAuBhL,IAAI,CAAC+d,GAAL,CAAS/d,IAAI,CAACC,GAAL,CAASpG,MAAT,EAAiBonB,UAAjB,CAAT,EAAuC,CAAvC,CAAvB,CAAA,CAAA;AACD,KAHD,CAGE,OAAOM,KAAP,EAAc;AACd,MAAA,OAAOR,UAAP,CAAA;AACD,KAP4B;;;AAU7B,IAAA,MAAMlE,IAAI,GAAGqE,KAAK,CAACrB,cAAN,EAAA,CAAuB,CAAvB,CAAb,CAAA;;AACA,IAAI,IAAA,CAAChD,IAAL,EAAW;AACT,MAAA,OAAOkE,UAAP,CAAA;AACD,KAAA;;AACD,IAAA,IAAID,MAAM,GAAGjE,IAAI,CAACI,GAAlB,EAAuB;AACrB,MAAA,OAAO2D,kBAAkB,CACvB5V,QADuB,EAEvB6V,MAFuB,EAGvBC,MAHuB,EAIvBC,UAJuB,EAKvBlnB,MALuB,EAMvBonB,UANuB,CAAzB,CAAA;AAQD,KAAA;;AACD,IAAA,IAAIH,MAAM,GAAGjE,IAAI,CAACM,MAAlB,EAA0B;AACxB,MAAA,OAAOyD,kBAAkB,CACvB5V,QADuB,EAEvB6V,MAFuB,EAGvBC,MAHuB,EAIvBjnB,MAJuB,EAKvBmnB,QALuB,EAMvBC,UANuB,CAAzB,CAAA;AAQD,KAAA;;AACD,IAAIJ,IAAAA,MAAM,IAAIhE,IAAI,CAAC9iB,IAAL,GAAY8iB,IAAI,CAAC2E,KAA/B,EAAsC;AACpC,MAAA,OAAOZ,kBAAkB,CACvB5V,QADuB,EAEvB6V,MAFuB,EAGvBC,MAHuB,EAIvBC,UAJuB,EAKvBlnB,MALuB,EAMvBonB,UANuB,CAAzB,CAAA;AAQD,KAAA;;AACD,IAAA,OAAOL,kBAAkB,CACvB5V,QADuB,EAEvB6V,MAFuB,EAGvBC,MAHuB,EAIvBjnB,MAJuB,EAKvBmnB,QALuB,EAMvBC,UANuB,CAAzB,CAAA;AAQD,GAAA;;AAED,EAAA,MAAM,CAACQ,WAAD,EAAcC,SAAd,IAA2BC,SAAS,CAACpK,YAAV,CAC/BvM,QAAQ,CAACkR,WADsB,EAE/B6E,UAF+B,CAAjC,CAAA;;AAIA,EAAI,IAAA;AACFG,IAAAA,KAAK,CAACG,QAAN,CAAerW,QAAf,EAAyByW,WAAzB,CAAA,CAAA;AACAP,IAAAA,KAAK,CAACI,MAAN,CAAatW,QAAb,EAAuBhL,IAAI,CAAC+d,GAAL,CAAS/d,IAAI,CAACC,GAAL,CAASyhB,SAAT,EAAoBT,UAApB,CAAT,EAA0C,CAA1C,CAAvB,CAAA,CAAA;AACD,GAHD,CAGE,OAAOM,KAAP,EAAc;AACd,IAAA,OAAOE,WAAP,CAAA;AACD,GAAA;;AAED,EAAMG,MAAAA,UAAU,GAAGtlB,KAAK,CAAC2X,IAAN,CAAWiN,KAAK,CAACrB,cAAN,EAAX,CAAnB,CAAA;AACA,EAAA,MAAMhD,IAAI,GAAG+E,UAAU,CAAC3pB,IAAX,CAAiB4pB,CAAD,IAAOA,CAAC,CAACL,KAAF,GAAU,CAAjC,KAAuCI,UAAU,CAAC,CAAD,CAA9D,CAAA;;AACA,EAAI,IAAA,CAAC/E,IAAL,EAAW;AACT,IAAA,OAAO4E,WAAP,CAAA;AACD,GAAA;;AACD,EAAA,IAAIX,MAAM,GAAGjE,IAAI,CAACI,GAAlB,EAAuB;AACrB,IAAA,OAAOwE,WAAP,CAAA;AACD,GAAA;;AACD,EAAA,IAAIX,MAAM,GAAGjE,IAAI,CAACM,MAAlB,EAA0B;AACxB,IAAA,OAAOuE,SAAP,CAAA;AACD,GAAA;;AACD,EAAIb,IAAAA,MAAM,IAAIhE,IAAI,CAAC9iB,IAAL,GAAY8iB,IAAI,CAAC2E,KAAL,GAAa,CAAvC,EAA0C;AACxC,IAAA,OAAOC,WAAP,CAAA;AACD,GAAA;;AACD,EAAA,OAAOC,SAAP,CAAA;AACD,CAAA;;AAED,SAASI,4BAAT,CAAsC;AACpCC,EAAAA,WADoC;AAEpClB,EAAAA,MAFoC;AAGpCC,EAAAA,MAHoC;AAIpCkB,EAAAA,SAJoC;AAKpCC,EAAAA,SAAAA;AALoC,CAAtC,EAYG;AACD,EAAIliB,IAAAA,MAAM,GAAGgiB,WAAb,CAAA;AACA,EAAI,IAAA,CAACnF,CAAD,EAAII,CAAJ,IAAS,CAACgF,SAAD,EAAYC,SAAZ,CAAb,CAAA;;AACA,EAAA,KAAK,MAAM7tB,IAAX,IAAmB6qB,6BAA6B,CAAClf,MAAD,CAAhD,EAA0D;AACxD,IAAA,MAAM8c,IAAI,GAAGzoB,IAAI,CAAC2qB,qBAAL,EAAb,CAAA;AACA,IAAA,MAAMzd,MAAM,GAAGwd,0CAA0C,CAAC1qB,IAAD,CAAzD,CAFwD;;AAIxD,IACE,IAAA,CAACkN,MAAD,IACA8b,qBAAqB,CAACyD,MAAD,EAASC,MAAT,EAAiBjE,IAAjB,CADrB,IAEA,CAACQ,qBAAqB,CAACwD,MAAD,EAASC,MAAT,EAAiBjE,IAAjB,CAHxB,EAIE;AACA,MAAA,SAAA;AACD,KAVuD;;;AAYxD,IAAA,MAAMmC,UAAU,GAAG1d,MAAM,CAACyd,qBAAP,EAAnB,CAAA;AACA,IAAMmD,MAAAA,WAAW,GAAGlvB,MAAM,CAACmvB,gBAAP,CAAwB7gB,MAAxB,CAApB,CAbwD;;AAexD,IAAA,MAAM8gB,UAAU,GAAGpD,UAAU,CAACjlB,IAAX,GAAkBvF,QAAQ,CAAC0tB,WAAW,CAACG,UAAb,EAAyB,EAAzB,CAA7C,CAAA;AACA,IAAA,MAAMC,WAAW,GAAGtD,UAAU,CAAChlB,KAAX,GAAmBxF,QAAQ,CAAC0tB,WAAW,CAACK,WAAb,EAA0B,EAA1B,CAA/C,CAAA;;AACA,IAAA,IAAI3F,CAAC,IAAIwF,UAAL,IAAmBxF,CAAC,IAAI0F,WAA5B,EAAyC;AACvC,MAAA,MAAMjR,IAAI,GAAGuL,CAAC,GAAGC,IAAI,CAAC9iB,IAAT,GAAgBqX,SAAS,CAACqB,KAA1B,GAAkCrB,SAAS,CAACa,MAAzD,CAAA;AACA,MAAO,OAAA;AACL7d,QAAAA,IADK;AAELid,QAAAA,IAAAA;AAFK,OAAP,CAAA;AAID,KAAA;AACF,GAAA;;AAED,EAAA,IAAImR,eAAJ,CAAA;AACA,EAAA,IAAIC,gBAAJ,CAAA;;AACA,EACE,IAAA,CAACvJ,oBAAoB,CAACnZ,MAAD,EAAU,CAAO6a,KAAAA,EAAAA,QAAQ,CAACphB,IAAK,CAA/B,CAAA,CAAA,CAArB,IACA,CAAC0f,oBAAoB,CAACnZ,MAAD,EAAU,CAAA,CAAA,EAAG6a,QAAQ,CAACI,IAAK,CAA3B,CAAA,CAAA,CAFvB,EAGE;AACA,IAAM,MAAA;AACJqF,MAAAA,WADI;AAEJJ,MAAAA,YAFI;AAGJC,MAAAA,WAHI;AAIJC,MAAAA,YAJI;AAKJC,MAAAA,UAAAA;AALI,KAAA,GAMFJ,yBAAyB,CAACjgB,MAAD,EAAS6c,CAAT,EAAYI,CAAZ,CAN7B,CAAA;AAOAwF,IAAAA,eAAe,GAAGtC,WAAW,EAAE7B,WAAb,CAAyBrkB,KAA3C,CAAA;AACAyoB,IAAAA,gBAAgB,GAAGtC,YAAY,EAAE9B,WAAd,CAA0BtkB,IAA7C,CAAA;;AAEA,IAAA,IAAIsmB,WAAJ,EAAiB;AACftgB,MAAAA,MAAM,GAAGsgB,WAAT,CAAA;AACD,KAFD,MAEO,IAAIJ,YAAY,IAAIC,WAApB,EAAiC;AACtC,MAAIxC,IAAAA,sBAAsB,CAACuC,YAAY,CAAC5B,WAAd,EAA2B6B,WAAW,CAAC7B,WAAvC,CAA1B,EAA+E;AAC7ErB,QAAAA,CAAC,GAAGiD,YAAY,CAAC5B,WAAb,CAAyBpB,GAA7B,CAAA;AACAld,QAAAA,MAAM,GAAGkgB,YAAY,CAAC1B,WAAtB,CAAA;AACD,OAHD,MAGO;AACL3B,QAAAA,CAAC,GAAGsD,WAAW,CAAC7B,WAAZ,CAAwBrkB,KAA5B,CAAA;AACA+F,QAAAA,MAAM,GAAGmgB,WAAW,CAAC3B,WAArB,CAAA;AACD,OAAA;AACF,KARM,MAQA,IAAI0B,YAAY,IAAIE,YAApB,EAAkC;AACvC,MACEzC,IAAAA,sBAAsB,CAACuC,YAAY,CAAC5B,WAAd,EAA2B8B,YAAY,CAAC9B,WAAxC,CADxB,EAEE;AACArB,QAAAA,CAAC,GAAGiD,YAAY,CAAC5B,WAAb,CAAyBpB,GAA7B,CAAA;AACAld,QAAAA,MAAM,GAAGkgB,YAAY,CAAC1B,WAAtB,CAAA;AACD,OALD,MAKO;AACL3B,QAAAA,CAAC,GAAGuD,YAAY,CAAC9B,WAAb,CAAyBtkB,IAA7B,CAAA;AACAgG,QAAAA,MAAM,GAAGogB,YAAY,CAAC5B,WAAtB,CAAA;AACD,OAAA;AACF,KAVM,MAUA,IAAI2B,WAAJ,EAAiB;AACtBtD,MAAAA,CAAC,GAAGsD,WAAW,CAAC7B,WAAZ,CAAwBrkB,KAA5B,CAAA;AACA+F,MAAAA,MAAM,GAAGmgB,WAAW,CAAC3B,WAArB,CAAA;AACD,KAHM,MAGA,IAAI4B,YAAJ,EAAkB;AACvBvD,MAAAA,CAAC,GAAGuD,YAAY,CAAC9B,WAAb,CAAyBtkB,IAA7B,CAAA;AACAgG,MAAAA,MAAM,GAAGogB,YAAY,CAAC5B,WAAtB,CAAA;AACD,KAHM,MAGA,IAAI0B,YAAJ,EAAkB;AACvB;AACA;AACA,MAAItD,IAAAA,mBAAmB,CAACC,CAAD,EAAII,CAAJ,EAAOiD,YAAY,CAAC5B,WAApB,CAAvB,EAAyD;AACvDzB,QAAAA,CAAC,GAAGqD,YAAY,CAAC5B,WAAb,CAAyBtkB,IAA7B,CAAA;AACD,OAFD,MAEO,IAAI+iB,oBAAoB,CAACF,CAAD,EAAII,CAAJ,EAAOiD,YAAY,CAAC5B,WAApB,CAAxB,EAA0D;AAC/DzB,QAAAA,CAAC,GAAGqD,YAAY,CAAC5B,WAAb,CAAyBrkB,KAA7B,CAAA;AACD,OAAA;;AACDgjB,MAAAA,CAAC,GAAGiD,YAAY,CAAC5B,WAAb,CAAyBpB,GAA7B,CAAA;AACAld,MAAAA,MAAM,GAAGkgB,YAAY,CAAC1B,WAAtB,CAAA;AACD,KAVM,MAUA,IAAI6B,UAAJ,EAAgB;AACrB,MAAIzD,IAAAA,mBAAmB,CAACC,CAAD,EAAII,CAAJ,EAAOoD,UAAU,CAAC/B,WAAlB,CAAvB,EAAuD;AACrDzB,QAAAA,CAAC,GAAGwD,UAAU,CAAC/B,WAAX,CAAuBtkB,IAA3B,CAAA;AACD,OAFD,MAEO,IAAI+iB,oBAAoB,CAACF,CAAD,EAAII,CAAJ,EAAOoD,UAAU,CAAC/B,WAAlB,CAAxB,EAAwD;AAC7DzB,QAAAA,CAAC,GAAGwD,UAAU,CAAC/B,WAAX,CAAuBrkB,KAA3B,CAAA;AACD,OAAA;;AACDgjB,MAAAA,CAAC,GAAGoD,UAAU,CAAC/B,WAAX,CAAuBlB,MAA3B,CAAA;AACApd,MAAAA,MAAM,GAAGqgB,UAAU,CAAC7B,WAApB,CAAA;AACD,KAAA;AACF,GAAA;;AAED,EAAA,IAAI,EAAExe,MAAM,YAAYlK,OAApB,CAAJ,EAAkC;AAChC,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AAED,EAAIqjB,IAAAA,oBAAoB,CAACnZ,MAAD,EAAU,CAAA,CAAA,EAAG6a,QAAQ,CAACI,IAAK,CAA3B,CAAA,CAAA,CAAxB,EAAwD;AACtD,IAAM5mB,MAAAA,IAAI,GAAG8kB,oBAAoB,CAACnZ,MAAD,EAAU,CAAA,CAAA,EAAG6a,QAAQ,CAACI,IAAK,CAAA,CAAA,CAA3B,CAAjC,CAAA;AACA,IAAIhQ,IAAAA,QAAqB,GAAG,IAA5B,CAAA;AACA,IAAInR,IAAAA,MAAM,GAAG,CAAb,CAAA;;AACA,IAAA,IAAI2oB,eAAe,IAAIxiB,IAAI,CAAC0iB,KAAL,CAAW9F,CAAX,CAAkB5c,KAAAA,IAAI,CAAC0iB,KAAL,CAAWF,eAAX,CAAzC,EAAsE;AACpE,MAAA,MAAMG,YAAY,GAAGvuB,IAAI,EAAEwuB,kBAAN,EAA0BC,aAA1B,CAAyC,CAAA,KAAA,EAAOjI,QAAQ,CAACphB,IAAK,CAAA,CAAA,CAA9D,GAAmEspB,UAAxF,CAAA;AACA9X,MAAAA,QAAQ,GAAG2X,YAAY,YAAY/sB,IAAxB,GAA+B+sB,YAA/B,GAA8C,IAAzD,CAAA;AACD,KAHD,MAGO,IAAIF,gBAAgB,IAAIziB,IAAI,CAAC0iB,KAAL,CAAW9F,CAAX,CAAA,KAAkB5c,IAAI,CAAC0iB,KAAL,CAAWD,gBAAX,CAA1C,EAAwE;AAC7E,MAAA,MAAME,YAAY,GAAGvuB,IAAI,EAAE2uB,sBAAN,EAA8BF,aAA9B,CAA6C,CAAA,KAAA,EAAOjI,QAAQ,CAACphB,IAAK,CAAA,CAAA,CAAlE,GAAuEspB,UAA5F,CAAA;AACA9X,MAAAA,QAAQ,GAAG2X,YAAY,YAAY/sB,IAAxB,GAA+B+sB,YAA/B,GAA8C,IAAzD,CAAA;AACA9oB,MAAAA,MAAM,GAAGmR,QAAQ,EAAEkR,WAAV,EAAuBhmB,MAAvB,IAAiC,CAA1C,CAAA;AACD,KAAA;;AACD,IAAO,OAAA;AACL9B,MAAAA,IAAI,EAAE4W,QAAQ,IAAI5W,IADb;AAELyF,MAAAA,MAAAA;AAFK,KAAP,CAAA;AAID,GAAA;;AACD,EAAIqf,IAAAA,oBAAoB,CAACnZ,MAAD,EAAU,CAAA,KAAA,EAAO6a,QAAQ,CAACphB,IAAK,CAA/B,CAAA,CAAA,CAAxB,EAA4D;AAC1D,IAAMwpB,MAAAA,WAAW,GAAGjjB,MAAM,CAACkZ,YAAP,CAAoB2B,QAAQ,CAACphB,IAA7B,CAAA,GAChBuG,MADgB,GAEhBA,MAAM,CAAC8iB,aAAP,CAAsB,QAAOjI,QAAQ,CAACphB,IAAK,CAAA,CAAA,CAA3C,CAFJ,CAAA;AAGA,IAAA,MAAMwR,QAAQ,GAAGgY,WAAW,IAAIA,WAAW,CAACF,UAA5C,CAAA;;AACA,IAAI9X,IAAAA,QAAQ,YAAYpV,IAApB,IAA4BoV,QAAQ,CAACkR,WAAT,KAAyB3B,aAAzD,EAAwE;AACtE,MAAO,OAAA;AACLnmB,QAAAA,IAAI,EAAE4W,QADD;AAELnR,QAAAA,MAAM,EAAE,CAAA;AAFH,OAAP,CAAA;AAID,KAAA;;AACD,IAAA,IAAImR,QAAQ,YAAYpV,IAApB,IAA4BoV,QAAQ,CAACkR,WAAzC,EAAsD;AACpD,MAAMriB,MAAAA,MAAM,GAAG+mB,kBAAkB,CAC/B5V,QAD+B,EAE/B4R,CAF+B,EAG/BI,CAH+B,EAI/B,CAJ+B,EAK/BhS,QAAQ,CAACkR,WAAT,CAAqBhmB,MALU,EAM/B8U,QAAQ,CAACkR,WAAT,CAAqBhmB,MANU,CAAjC,CAAA;AAQA,MAAO,OAAA;AACL9B,QAAAA,IAAI,EAAE4W,QADD;AAELnR,QAAAA,MAAAA;AAFK,OAAP,CAAA;AAID,KAAA;;AACD,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AACD,EAAA,OAAO,IAAP,CAAA;AACD,CAAA;;AAEc,SAASopB,4BAAT,CACblB,WADa,EAEblB,MAFa,EAGbC,MAHa,EAIbhU,UAJa,EAKb;AACA,EAAI/M,IAAAA,MAAW,GAAGgiB,WAAlB,CAAA;;AACA,EAAIhiB,IAAAA,MAAM,YAAYnK,IAAtB,EAA4B;AAC1BmK,IAAAA,MAAM,GAAGA,MAAM,CAACwZ,UAAhB,CAAA;AACD,GAFD,MAEO,IAAIxZ,MAAM,CAACmjB,UAAX,EAAuB;AAC5BnjB,IAAAA,MAAM,GAAGA,MAAM,CAACmjB,UAAP,CAAkBL,aAAlB,CAAiC,CAAGjI,CAAAA,EAAAA,QAAQ,CAACC,OAAQ,GAArD,CAAT,CAAA;AACD,GAAA;;AACD,EAAI,IAAA,CAAC9a,MAAD,IAAW,EAAEA,MAAM,YAAYlK,OAApB,CAAf,EAA6C;AAC3C,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AAED,EAAI,IAAA,CAAC+mB,CAAD,EAAII,CAAJ,IAAS,CAAC6D,MAAD,EAASC,MAAT,CAAb,CAAA;;AACA,EAAI/gB,IAAAA,MAAM,CAACkZ,YAAP,CAAoB2B,QAAQ,CAACC,OAA7B,CAAJ,EAA2C;AACzC,IAAME,MAAAA,QAAQ,GAAGhb,MAAM,CAAC8iB,aAAP,CAAsB,CAAA,CAAA,EAAGjI,QAAQ,CAACG,QAAS,CAAA,CAAA,CAA3C,CAAjB,CAAA;;AACA,IAAA,IAAIA,QAAJ,EAAc;AACZ,MAAA,MAAMoI,YAAY,GAAGpI,QAAQ,CAACgE,qBAAT,EAArB,CAAA;;AACA,MAAA,IAAInC,CAAC,GAAGuG,YAAY,CAACppB,IAArB,EAA2B;AACzB6iB,QAAAA,CAAC,GAAGuG,YAAY,CAACppB,IAAjB,CAAA;AACD,OAFD,MAEO,IAAI6iB,CAAC,GAAGuG,YAAY,CAACnpB,KAArB,EAA4B;AACjC4iB,QAAAA,CAAC,GAAGuG,YAAY,CAACnpB,KAAb,GAAqB,CAAzB,CAAA;AACD,OAAA;;AACD,MAAA,IAAIgjB,CAAC,GAAGmG,YAAY,CAAClG,GAArB,EAA0B;AACxBD,QAAAA,CAAC,GAAGmG,YAAY,CAAClG,GAAjB,CAAA;AACD,OAFD,MAEO,IAAID,CAAC,GAAGmG,YAAY,CAAChG,MAArB,EAA6B;AAClCH,QAAAA,CAAC,GAAGmG,YAAY,CAAChG,MAAb,GAAsB,CAA1B,CAAA;AACD,OAXW;;;AAaZ,MAAA,MAAMiG,IAAI,GAAGrjB,MAAM,CAACsjB,WAAP,EAAb,CAAA;AACA,MAAA,MAAMC,cAAc,GAAG,OAAOF,IAAI,CAACG,gBAAZ,KAAiC,UAAjC,GACnBH,IAAI,CAACG,gBAAL,CAAsB3G,CAAtB,EAAyBI,CAAzB,CADmB,GAEnB,IAFJ,CAAA;;AAGA,MAAA,IAAIsG,cAAJ,EAAoB;AAClBvjB,QAAAA,MAAM,GAAGujB,cAAT,CAAA;AACD,OAAA;AACF,KAAA;AACF,GAAA;;AAED,EAAMtR,MAAAA,KAAK,GAAG8P,4BAA4B,CAAC;AACzCC,IAAAA,WAAW,EAAEhiB,MAD4B;AAEzCiiB,IAAAA,SAAS,EAAEpF,CAF8B;AAGzCqF,IAAAA,SAAS,EAAEjF,CAH8B;AAIzC6D,IAAAA,MAJyC;AAKzCC,IAAAA,MAAAA;AALyC,GAAD,CAA1C,CAAA;;AAOA,EAAA,IAAI,CAAC9O,KAAD,IAAU,CAACA,KAAK,CAAC5d,IAArB,EAA2B;AACzB,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AAED,EAAA,MAAMovB,OAAO,GACXxR,KAAK,CAAC5d,IAAN,YAAsByB,OAAtB,GACImc,KAAK,CAAC5d,IAAN,CAAW6kB,YAAX,CAAwB2B,QAAQ,CAAC7lB,GAAjC,CADJ,GAEI,IAHN,CAAA;;AAIA,EAAA,IAAIid,KAAK,CAACX,IAAN,IAAcmS,OAAlB,EAA2B;AACzB,IAAA,MAAMC,eAAe,GAAG;AACtB1uB,MAAAA,GAAG,EAAEyuB,OADiB;AAEtBnS,MAAAA,IAAI,EAAEW,KAAK,CAACX,IAAAA;AAFU,KAAxB,CAAA;AAIA,IAAA,MAAMoL,MAAM,GAAGxL,KAAK,CAAC1a,MAAN,CAAaktB,eAAb,CAAf,CAAA;AACA,IAAOjH,OAAAA,SAAS,CAACjmB,MAAV,CAAiB;AACtBkmB,MAAAA,MADsB;AAEtBC,MAAAA,KAAK,EAAED,MAAAA;AAFe,KAAjB,CAAP,CAAA;AAID,GAAA;;AACD,EAAA,MAAML,MAAM,GAAGrK,QAAQ,CAACoP,WAAT,EAAf,CAAA;;AACA,EAAI,IAAA;AACF/E,IAAAA,MAAM,CAACiF,QAAP,CAAgBrP,KAAK,CAAC5d,IAAtB,EAA4B4d,KAAK,CAACnY,MAAlC,CAAA,CAAA;AACAuiB,IAAAA,MAAM,CAACkF,MAAP,CAActP,KAAK,CAAC5d,IAApB,EAA0B4L,IAAI,CAAC+d,GAAL,CAAS/L,KAAK,CAACnY,MAAf,EAAuB,CAAvB,CAA1B,CAAA,CAAA;AACD,GAHD,CAGE,OAAO0nB,KAAP,EAAc;AACd,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AACD,EAAA,OAAOnF,MAAM,IAAID,SAAS,CAACC,MAAD,EAAStP,UAAT,CAA1B,CAAA;AACD;;ACrlBM,MAAM4W,kBAAkB,GAAG,IAAIznB,OAAJ,EAA3B,CAAA;AACA,MAAM0nB,qBAAqB,GAAG,IAAI1nB,OAAJ,EAA9B,CAAA;;AASP,SAAS2nB,sBAAT,CAAgC7uB,GAAhC,EAA6CquB,IAA7C,EAA2F;AACzF,EAAA,IAAIS,OAAJ,CAAA;AACA,EAAA,MAAM/W,UAAU,GAAG4W,kBAAkB,CAACjnB,GAAnB,CAAuB2mB,IAAvB,CAAnB,CAAA;;AACA,EAAA,IAAItW,UAAJ,EAAgB;AACd,IAAA,IAAI,CAAC6W,qBAAqB,CAACxrB,GAAtB,CAA0B2U,UAA1B,CAAL,EAA4C;AAC1C6W,MAAAA,qBAAqB,CAAC5sB,GAAtB,CAA0B+V,UAA1B,EAAsC,IAAIgX,GAAJ,EAAtC,CAAA,CAAA;AACD,KAAA;;AACDD,IAAAA,OAAO,GAAGF,qBAAqB,CAAClnB,GAAtB,CAA0BqQ,UAA1B,CAAV,CAAA;AACD,GAAA;;AAED,EAAI+W,IAAAA,OAAO,IAAIA,OAAO,CAAC1rB,GAAR,CAAYpD,GAAZ,CAAf,EAAiC;AAC/B,IAAA,OAAO8uB,OAAO,CAACpnB,GAAR,CAAY1H,GAAZ,CAAP,CAAA;AACD,GAAA;;AACD,EAAA,IAAIquB,IAAI,YAAYvtB,OAAhB,IAA2Bd,GAAG,KAAKquB,IAAI,CAACnK,YAAL,CAAkB2B,QAAQ,CAAC7lB,GAA3B,CAAvC,EAAwE;AACtE,IAAA,OAAOquB,IAAP,CAAA;AACD,GAAA;;AACD,EAAOA,OAAAA,IAAI,CAACP,aAAL,CAAiC,CAAA,CAAA,EAAGjI,QAAQ,CAAC7lB,GAAI,CAAA,EAAA,EAAIA,GAAI,CAAA,EAAA,CAAzD,CAAP,CAAA;AACD;;AC9BD;AACA;AACA;AACA;AAGA;AACA;AACA;;AACO,SAASgvB,iBAAT,CACLhvB,GADK,EAELquB,IAAsB,GAAGpwB,MAFpB,EAGL;AACA,EAAMoB,MAAAA,IAAI,GACRgvB,IAAI,KAAKpwB,MAAT,GACI4wB,sBAAsB,CAAC7uB,GAAD,EAAMquB,IAAN,CAD1B,GAEIQ,sBAAsB,CAAC7uB,GAAD,EAAMquB,IAAI,CAACrR,QAAX,CAH5B,CAAA;AAIA,EAAO3d,OAAAA,IAAI,IAAI4E,SAAf,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;;AACA,SAASgrB,WAAT,CAAqBjvB,GAArB,EAAkCquB,IAAsB,GAAGpwB,MAA3D,EAAmE;AACjE,EAAA,MAAMoB,IAAI,GAAG2vB,iBAAiB,CAAChvB,GAAD,EAAMquB,IAAN,CAA9B,CAAA;;AACA,EAAI,IAAA,CAAChvB,IAAL,EAAW;AACT,IAAA,MAAM,IAAIoB,KAAJ,CACH,CAAiCT,+BAAAA,EAAAA,GAAI,2FADlC,CAAN,CAAA;AAGD,GAAA;;AACD,EAAA,OAAOX,IAAP,CAAA;AACD;;AC7BD,SAAS6vB,aAAT,CAAuBlvB,GAAvB,EAAoCquB,IAAsB,GAAGpwB,MAA7D,EAAqE;AACnE,EAAMmW,MAAAA,OAAO,GAAGia,IAAI,YAAYvtB,OAAhB,GAA0ButB,IAA1B,GAAiCA,IAAI,CAACrR,QAAtD,CAAA;AACA,EAAM9U,MAAAA,SAAS,GAAG2mB,sBAAsB,CAAE,GAAE7uB,GAAI,CAAA,EAAA,CAAR,EAAaoU,OAAb,CAAxC,CAAA;AACA,EAAM8R,MAAAA,SAAS,GAAGhe,SAAS,EAAEiK,OAAX,CAAoB,CAAA,CAAA,EAAG0T,QAAQ,CAACK,SAAU,CAAA,CAAA,CAA1C,CAAlB,CAAA;AACA,EAAOA,OAAAA,SAAS,GAAG3e,KAAK,CAAC2X,IAAN,CAAWgH,SAAS,CAACmE,gBAAV,CAAyC,IAAGxE,QAAQ,CAAC7lB,GAAI,CAAKA,GAAAA,EAAAA,GAAI,KAAlE,CAAX,CAAH,GAAyF,EAAzG,CAAA;AACD;;ACRD;AACA;AACA;AACA;AAIA;AACA;AACA;;AACA,SAASmvB,YAAT,CAAsBlS,KAAtB,EAAwCoR,IAAsB,GAAGpwB,MAAjE,EAAyE;AACvE,EAAMmG,MAAAA,MAAM,GAAG8qB,aAAa,CAACjS,KAAK,CAACjd,GAAP,EAAYquB,IAAZ,CAA5B,CAAA;AAEA,EAAA,IAAI/lB,KAAK,GAAG,CAAZ,CAHuE;;AAKvE,EAAA,KAAK,MAAM7D,IAAX,IAAmBL,MAAnB,EAA2B;AACzB,IAAA,MAAM/E,IAAI,GAAGoF,IAAI,CAACspB,UAAlB,CAAA;AACA,IAAA,MAAM5sB,MAAM,GAAG9B,IAAI,IAAIA,IAAI,CAAC8nB,WAAb,GAA2B9nB,IAAI,CAAC8nB,WAAL,CAAiBhmB,MAA5C,GAAqD,CAApE,CAAA;AACA,IAAA,MAAMoH,GAAG,GAAGD,KAAK,GAAGnH,MAApB,CAAA;;AACA,IAAA,IAAI8b,KAAK,CAACnY,MAAN,IAAgByD,GAApB,EAAyB;AACvB,MAAA,MAAMzD,MAAM,GAAGmY,KAAK,CAACnY,MAAN,GAAewD,KAA9B,CAAA;AACA,MAAO,OAAA;AAAEjJ,QAAAA,IAAF;AAAQyF,QAAAA,MAAAA;AAAR,OAAP,CAAA;AACD,KAAA;;AACDwD,IAAAA,KAAK,GAAGC,GAAR,CAAA;AACD,GAAA;;AACD,EAAA,OAAO,IAAP,CAAA;AACD;;AC1BD;AAUA;AACA;AACA;;AACA,SAAS6mB,YAAT,CACEjD,KADF,EAEEpU,UAFF,EAGEsW,IAA0B,GAAGpwB,MAH/B,EAIE;AACA,EAAM,MAAA;AAAE+e,IAAAA,QAAAA;AAAF,GAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;AACA,EAAM,MAAA;AAAEovB,IAAAA,WAAAA;AAAF,GAAA,GAAkBlD,KAAxB,CAAA;AACA,EAAM,MAAA;AAAE7jB,IAAAA,KAAF;AAASC,IAAAA,GAAAA;AAAT,GAAA,GAAiB4jB,KAAK,CAACmD,mBAAN,CAA0BtS,QAA1B,CAAvB,CAHA;;AAKA,EAAA,MAAM8P,CAAC,GAAG,CAAC,UAAA,IAAcuB,IAAd,GAAqBA,IAAI,CAACrR,QAA1B,GAAqCqR,IAAI,CAACkB,aAA3C,EAA0DnD,WAA1D,EAAV,CAAA;AACA,EAAA,MAAMoD,QAAQ,GAAGL,YAAY,CAAC7mB,KAAD,EAAQ+lB,IAAR,CAA7B,CAAA;AACA,EAAA,MAAMoB,MAAM,GAAGJ,WAAW,GAAGG,QAAH,GAAcL,YAAY,CAAC5mB,GAAD,EAAM8lB,IAAN,CAApD,CAPA;;AAUA,EAAI,IAAA;AACF,IAAA,IAAImB,QAAQ,IAAIA,QAAQ,CAACnwB,IAAzB,EAA+B;AAC7BytB,MAAAA,CAAC,CAACR,QAAF,CAAWkD,QAAQ,CAACnwB,IAApB,EAA0BmwB,QAAQ,CAAC1qB,MAAnC,CAAA,CAAA;AACD,KAFD,MAEO;AACL,MAAM4qB,MAAAA,aAAa,GAAG1S,QAAQ,CAAC2S,cAAT,CAAwBrnB,KAAK,CAACtI,GAA9B,EAAmC+X,UAAnC,CAAtB,CAAA;;AACA,MAAA,IAAI2X,aAAJ,EAAmB;AACjB,QAAME,MAAAA,OAAO,GAAGX,WAAW,CAACS,aAAa,CAAC1vB,GAAf,EAAoBquB,IAApB,CAA3B,CAAA;AACAvB,QAAAA,CAAC,CAAC+C,cAAF,CAAiBD,OAAjB,CAAA,CAAA;AACD,OAHD,MAGO;AACL,QAAA,OAAO,IAAP,CAAA;AACD,OAAA;AACF,KAAA;;AAED,IAAA,IAAIH,MAAM,IAAIA,MAAM,CAACpwB,IAArB,EAA2B;AACzBytB,MAAAA,CAAC,CAACP,MAAF,CAASkD,MAAM,CAACpwB,IAAhB,EAAsBowB,MAAM,CAAC3qB,MAA7B,CAAA,CAAA;AACD,KAFD,MAEO;AACL,MAAMgrB,MAAAA,WAAW,GAAG9S,QAAQ,CAAC2S,cAAT,CAAwBpnB,GAAG,CAACvI,GAA5B,EAAiC+X,UAAjC,CAApB,CAAA;;AACA,MAAA,IAAI+X,WAAJ,EAAiB;AACf,QAAMF,MAAAA,OAAO,GAAGX,WAAW,CAACa,WAAW,CAAC9vB,GAAb,EAAkBquB,IAAlB,CAA3B,CAAA;AACAvB,QAAAA,CAAC,CAACiD,WAAF,CAAcH,OAAd,CAAA,CAAA;AACD,OAHD,MAGO;AACL,QAAA,OAAO,IAAP,CAAA;AACD,OAAA;AACF,KAAA;AACF,GAxBD,CAwBE,OAAOpD,KAAP,EAAc;AACdwD,IAAAA,OAAO,CAACxD,KAAR,CAAcA,KAAd,CAAA,CAAA;AACA,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AAED,EAAA,OAAOM,CAAP,CAAA;AACD;;ACzDD;AACA;AACA;AACA;AAIO,SAASmD,cAAT,CAAwBhT,KAAxB,EAAsC;AAC3C,EAAA,IAAI,CAACA,KAAK,CAACN,WAAN,EAAL,EAA0B;AACxB,IAAA,OAAO,EAAP,CAAA;AACD,GAAA;;AACD,EAAA,MAAMuT,SAAS,GAAGjT,KAAK,CAACJ,YAAN,EAAlB,CAAA;AACA,EAAA,MAAMsT,SAAS,GAAGlT,KAAK,CAACH,WAAN,EAAlB,CAAA;;AAEA,EAAA,IAAIoT,SAAS,CAACprB,MAAV,GAAmB,CAAvB,EAA0B;AACxB,IAAA,OAAO,EAAP,CAAA;AACD,GAAA;;AAED,EAAIsrB,IAAAA,QAAyC,GAAG,IAAhD,CAAA;AACA,EAAIC,IAAAA,YAA6C,GAAG,IAApD,CAAA;AACA,EAAIC,IAAAA,YAA6C,GAAG,IAApD,CAAA;;AAEA,EAAI,IAAA;AACFF,IAAAA,QAAQ,GAAGjB,YAAY,CAAClS,KAAD,CAAvB,CAAA;AACAoT,IAAAA,YAAY,GAAGlB,YAAY,CAACe,SAAD,CAA3B,CAAA;AACAI,IAAAA,YAAY,GAAGnB,YAAY,CAACgB,SAAD,CAA3B,CAAA;AACD,GAJD,CAIE,OAAO3D,KAAP,EAAc;AAEf,GAAA;;AAED,EACE,IAAA,CAAC4D,QAAD,IACA,CAACA,QAAQ,CAAC/wB,IADV,IAEA,CAACgxB,YAFD,IAGA,CAACA,YAAY,CAAChxB,IAHd,IAIA,CAACixB,YAJD,IAKA,CAACA,YAAY,CAACjxB,IANhB,EAOE;AACA,IAAA,OAAO,EAAP,CAAA;AACD,GAAA;;AAED,EAAA,MAAMkxB,UAAU,GAAGtyB,MAAM,CAAC+e,QAAP,CAAgBoP,WAAhB,EAAnB,CAAA;AACA,EAAA,MAAMoE,WAAW,GAAGvyB,MAAM,CAAC+e,QAAP,CAAgBoP,WAAhB,EAApB,CAAA;;AACA,EAAI,IAAA;AACFmE,IAAAA,UAAU,CAACjE,QAAX,CAAoB+D,YAAY,CAAChxB,IAAjC,EAAuCgxB,YAAY,CAACvrB,MAApD,CAAA,CAAA;AACAyrB,IAAAA,UAAU,CAAChE,MAAX,CAAkB6D,QAAQ,CAAC/wB,IAA3B,EAAiC+wB,QAAQ,CAACtrB,MAA1C,CAAA,CAAA;AACA0rB,IAAAA,WAAW,CAAClE,QAAZ,CAAqB8D,QAAQ,CAAC/wB,IAA9B,EAAoC+wB,QAAQ,CAACtrB,MAA7C,CAAA,CAAA;AACA0rB,IAAAA,WAAW,CAACjE,MAAZ,CAAmB+D,YAAY,CAACjxB,IAAhC,EAAsCixB,YAAY,CAACxrB,MAAnD,CAAA,CAAA;AACD,GALD,CAKE,OAAO0nB,KAAP,EAAc;AACd,IAAA,OAAO,EAAP,CAAA;AACD,GAAA;;AAED,EAAMiE,MAAAA,UAAU,GAAGlpB,KAAK,CAAC2X,IAAN,CAAWqR,UAAU,CAACzF,cAAX,EAAX,EAAwCnnB,MAAxC,CAChBmpB,CAAD,IAAOA,CAAC,CAACL,KAAF,GAAU,CADA,CAAnB,CAAA;AAGA,EAAMiE,MAAAA,WAAW,GAAGnpB,KAAK,CAAC2X,IAAN,CAAWsR,WAAW,CAAC1F,cAAZ,EAAX,EAAyCnnB,MAAzC,CACjBmpB,CAAD,IAAOA,CAAC,CAACL,KAAF,GAAU,CADC,CAApB,CAAA;AAGA,EAAMkE,MAAAA,SAAS,GAAGF,UAAU,CAACA,UAAU,CAACtvB,MAAX,GAAoB,CAArB,CAA5B,CAAA;AACA,EAAA,MAAMyvB,UAAU,GAAGF,WAAW,CAAC,CAAD,CAA9B,CAAA;AACA,EAAA,OAAO,CAACC,SAAD,EAAYC,UAAZ,CAAP,CAAA;AACD,CAAA;AAEM,SAASC,oBAAT,CAA8B5T,KAA9B,EAA4C;AACjD,EAAM,MAAA,CAAC0T,SAAD,EAAYC,UAAZ,IAA0BX,cAAc,CAAChT,KAAD,CAA9C,CAAA;;AACA,EAAI,IAAA,CAAC0T,SAAD,IAAc,CAACC,UAAf,IAA6B,OAAOE,OAAP,KAAmB,WAApD,EAAiE;AAC/D,IAAA,OAAO,EAAP,CAAA;AACD,GAAA;;AACD,EAAA,OAAO,CACL,IAAIA,OAAJ,CAAYH,SAAS,CAAC1rB,KAAtB,EAA6B0rB,SAAS,CAACzI,GAAvC,EAA4C,CAA5C,EAA+CyI,SAAS,CAAC7H,MAAzD,CADK,EAEL,IAAIgI,OAAJ,CAAYF,UAAU,CAAC5rB,IAAvB,EAA6B4rB,UAAU,CAAC1I,GAAxC,EAA6C,CAA7C,EAAgD0I,UAAU,CAAC9H,MAA3D,CAFK,CAAP,CAAA;AAID,CAAA;AAEc,SAASiI,aAAT,CAAuB9T,KAAvB,EAAqC;AAClD,EAAM,MAAA,CAAC0T,SAAD,EAAYC,UAAZ,IAA0BX,cAAc,CAAChT,KAAD,CAA9C,CAAA;;AACA,EAAA,IAAI,CAAC0T,SAAD,IAAc,CAACC,UAAnB,EAA+B;AAC7B,IAAA,OAAO,KAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;;;AACE,EAAA,OAAOA,UAAU,CAAC5rB,IAAX,GAAkB2rB,SAAS,CAAC3rB,IAAnC,CAAA;AACD;;ACrFD;AACA;AACA;AACA;AAQe,SAASgsB,iBAAT,CACb/T,KADa,EAEbgU,SAFa,EAGblZ,UAHa,EAIb;AACA,EAAA,IAAI,CAACkF,KAAK,CAACN,WAAN,EAAL,EAA0B;AACxB;AACA,IAAA,MAAMtd,IAAI,GAAG4vB,WAAW,CAAChS,KAAK,CAACjd,GAAP,CAAxB,CAAA;AACA,IAAOX,OAAAA,IAAI,CAAC2qB,qBAAL,EAAP,CAAA;AACD,GAAA;;AACD,EAAM,MAAA;AAAEhN,IAAAA,QAAAA;AAAF,GAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;AACA,EAAM6D,MAAAA,IAAI,GAAGkZ,QAAQ,CAACtN,OAAT,CAAiBuN,KAAK,CAACjd,GAAvB,CAAA,EAA6B8D,IAA1C,CAAA;AACA,EAAA,MAAMotB,cAAc,GAAGptB,IAAI,IAAIA,IAAI,CAACmZ,KAAK,CAACnY,MAAN,GAAe,CAAhB,CAAJ,KAA2B,IAA1D,CAAA;AACA,EAAA,MAAMqsB,QAAQ,GAAGJ,aAAa,CAAC9T,KAAD,CAA9B,CAAA;;AACA,EAAA,IAAIkU,QAAJ,EAAc;AACZ,IAAA,MAAMC,SAAS,GAAGP,oBAAoB,CAAC5T,KAAD,CAAtC,CAAA;AACA,IAAA,OAAOgU,SAAS,GAAGG,SAAS,CAACA,SAAS,CAACjwB,MAAV,GAAmB,CAApB,CAAZ,GAAqCiwB,SAAS,CAAC,CAAD,CAA9D,CAAA;AACD,GAAA;;AACD,EAAA,MAAMC,QAAQ,GAAGjC,YAAY,CAC3B3H,SAAS,CAACjmB,MAAV,CAAiB;AACfkmB,IAAAA,MAAM,EAAEzK,KADO;AAEf0K,IAAAA,KAAK,EAAE1K,KAAAA;AAFQ,GAAjB,CAD2B,EAK3BlF,UAL2B,CAA7B,CAAA;;AAOA,EAAI,IAAA,CAACsZ,QAAL,EAAe;AACb,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AACD,EAAA,MAAMxE,UAAU,GAAGwE,QAAQ,CAACvG,cAAT,EAAnB,CAxBA;;AA0BA,EAAA,OAAQmG,SAAS,IAAIC,cAAd,GAAgCrE,UAAU,CAACA,UAAU,CAAC1rB,MAAX,GAAoB,CAArB,CAA1C,GAAoE0rB,UAAU,CAAC,CAAD,CAArF,CAAA;AACD;;ACvCD,MAAMyE,KAAK,GAAG,IAAIpqB,OAAJ,EAAd,CAAA;AAEO,MAAMqqB,eAAe,GAAG,CAACxZ,UAAD,EAAyBvN,QAAzB,EAAoDgnB,OAApD,KAAgF;AAC7GF,EAAAA,KAAK,CAACtvB,GAAN,CAAU+V,UAAV,EAAsB;AAAE0Z,IAAAA,KAAK,EAAEjnB,QAAT;AAAmBgnB,IAAAA,OAAAA;AAAnB,GAAtB,CAAA,CAAA;AACD,CAFM,CAAA;AAIA,MAAME,gBAAgB,GAAI3Z,UAAD,IAA4B;AAC1D,EAAA,OAAOuZ,KAAK,CAAC5pB,GAAN,CAAUqQ,UAAV,GAAuB0Z,KAA9B,CAAA;AACD,CAFM,CAAA;AAIA,MAAME,sBAAsB,GAAI5Z,UAAD,IAA4B;AAChE,EAAA,OAAOuZ,KAAK,CAAC5pB,GAAN,CAAUqQ,UAAV,CAAP,CAAA;AACD,CAFM;;ACbP;AACA;AACA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;;AACO,SAAS6Z,2BAAT,CAAqC1S,IAArC,EAAkD2S,EAAlD,EAA6D9Z,UAA7D,EAAqF;AAC1F,EAAA,IAAI8Z,EAAE,CAACjV,WAAH,EAAJ,EAAsB;AACpB,IAAA,OAAO,KAAP,CAAA;AACD,GAAA;;AACD,EAAM,MAAA,CAAC+T,SAAD,EAAYC,UAAZ,IAA0BX,cAAc,CAAC4B,EAAD,CAA9C,CAAA;;AACA,EAAA,IAAI,CAAClB,SAAD,IAAc,CAACC,UAAnB,EAA+B;AAC7B,IAAA,OAAO,KAAP,CAAA;AACD,GAAA;;AAED,EAAA,IAAI1R,IAAI,CAACtC,WAAL,EAAJ,EAAwB;AACtB,IAAA,OAAOgU,UAAU,CAAC5rB,IAAX,GAAkB2rB,SAAS,CAAC3rB,IAA5B,IAAoCka,IAAI,CAAC5C,IAAL,KAAcD,SAAS,CAACa,MAAnE,CAAA;AACD,GAAA;;AAED,EAAA,MAAM4U,OAAO,GAAGJ,gBAAgB,CAAC3Z,UAAD,CAAhC,CAAA;;AACA,EAAI,IAAA,CAAC+Z,OAAD,IAAYlB,UAAU,CAAC5rB,IAAX,IAAmB2rB,SAAS,CAAC3rB,IAA7C,EAAmD;AACjD,IAAA,OAAO,KAAP,CAAA;AACD,GAhByF;;;AAmB1F,EAAA,OAAQ8sB,OAAO,CAAC9sB,IAAR,GAAe4rB,UAAU,CAAC5rB,IAA3B,GAAoC2rB,SAAS,CAAC1rB,KAAV,GAAkB6sB,OAAO,CAAC9sB,IAArE,CAAA;AACD,CAAA;AAEM,SAAS+sB,iBAAT,CACLC,OADK,EAELja,UAFK,EAGL;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAA,GAAejF,UAAU,CAAC9X,KAAhC,CADA;;AAGA,EAAA,MAAMgyB,UAAU,GAAGhD,WAAW,CAACjS,QAAQ,CAAChd,GAAV,CAA9B,CAAA;;AACA,EAAI,IAAA,CAACiyB,UAAL,EAAiB;AACf,IAAA,OAAO,KAAP,CAAA;AACD,GAAA;;AACD,EAAA,MAAMnK,IAAI,GAAGmK,UAAU,CAACjI,qBAAX,EAAb,CAAA;AACA,EAAOgI,OAAAA,OAAO,GAAGlK,IAAI,CAAC9iB,IAAL,GAAY8iB,IAAI,CAAC2E,KAAL,GAAa,CAA1C,CAAA;AACD;;AClDD;;AAyBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMyF,+BAA+B,GAAG,CAC7Cna,UAD6C,EAE7CkF,KAF6C,KAG1C;AACH,EAAM,MAAA;AAAED,IAAAA,QAAAA;AAAF,GAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;AACA,EAAMsM,MAAAA,MAAM,GAAGyQ,QAAQ,CAAC1J,gBAAT,CAA0B2J,KAAK,CAACjd,GAAhC,CAAf,CAAA;;AACA,EAAI,IAAA,CAACuM,MAAD,IAAWwL,UAAU,CAACoa,KAAX,CAAiB,QAAjB,EAA2B5lB,MAA3B,CAAX,IAAiDwL,UAAU,CAACoa,KAAX,CAAiB,eAAjB,EAAkC5lB,MAAlC,CAArD,EAAgG;AAC9F,IAAA,OAAO0Q,KAAP,CAAA;AACD,GAAA;;AACD,EAAA,IAAIA,KAAK,CAACnY,MAAN,KAAiB,CAArB,EAAwB;AACtB,IAAMmR,MAAAA,QAAQ,GAAG+G,QAAQ,CAACxL,eAAT,CAAyByL,KAAK,CAACjd,GAA/B,CAAjB,CAAA;;AACA,IAAA,IAAIiW,QAAJ,EAAc;AACZ,MAAM,MAAA;AAAEjW,QAAAA,GAAAA;AAAF,OAAA,GAAUiW,QAAhB,CAAA;AACA,MAAA,MAAMnR,MAAM,GAAGmR,QAAQ,CAACnS,IAAT,CAAc3C,MAA7B,CAAA;AACA,MAAOib,OAAAA,SAAS,CAAC5a,MAAV,CAAiB;AAAExB,QAAAA,GAAF;AAAO8E,QAAAA,MAAAA;AAAP,OAAjB,CAAP,CAAA;AACD,KAAA;AACF,GAPD,MAOO,IAAImY,KAAK,CAACnY,MAAN,KAAiByH,MAAM,CAACzI,IAAP,CAAY3C,MAAjC,EAAyC;AAC9C,IAAM8U,MAAAA,QAAQ,GAAG+G,QAAQ,CAACrL,WAAT,CAAqBsL,KAAK,CAACjd,GAA3B,CAAjB,CAAA;;AACA,IAAA,IAAIiW,QAAJ,EAAc;AACZ,MAAM,MAAA;AAAEjW,QAAAA,GAAAA;AAAF,OAAA,GAAUiW,QAAhB,CAAA;AACA,MAAMnR,MAAAA,MAAM,GAAG,CAAf,CAAA;AACA,MAAOsX,OAAAA,SAAS,CAAC5a,MAAV,CAAiB;AAAExB,QAAAA,GAAF;AAAO8E,QAAAA,MAAAA;AAAP,OAAjB,CAAP,CAAA;AACD,KAAA;AACF,GAAA;;AACD,EAAA,OAAOmY,KAAP,CAAA;AACD,CAzBM,CAAA;;AA2BP,UAAUmV,yBAAV,CACEpV,QADF,EAEEqV,EAFF,EAGE7hB,OAHF,EAIkB;AAChB,EAAM8hB,MAAAA,MAAM,GAAGtV,QAAQ,CAACtN,OAAT,CAAiB2iB,EAAE,CAACryB,GAApB,CAAf,CAAA;;AACA,EAAI,IAAA,CAACsyB,MAAL,EAAa;AACX,IAAA,OAAA;AACD,GAAA;;AACD,EAAA,IAAIA,MAAM,CAACvxB,MAAP,EAAJ,EAAqB;AACnB,IAAA,MAAMuxB,MAAN,CAAA;AACD,GAAA;;AAED,EAAM5tB,MAAAA,IAAI,GAAI1E,GAAD,IAAiB;AAC5B,IAAA,OAAOwQ,OAAO,GAAGwM,QAAQ,CAACxL,eAAT,CAAyBxR,GAAzB,CAAH,GAAmCgd,QAAQ,CAACrL,WAAT,CAAqB3R,GAArB,CAAjD,CAAA;AACD,GAFD,CAAA;;AAIA,EAAM4U,MAAAA,SAAS,GAAIR,OAAD,IAAsB;AACtC,IAAO5D,OAAAA,OAAO,GAAG4D,OAAO,CAAC9S,WAAR,EAAH,GAA2B8S,OAAO,CAAC/S,YAAR,EAAzC,CAAA;AACD,GAFD,CAAA;;AAIA,EAAMkxB,MAAAA,MAAM,GACVF,EAAE,CAACzV,WAAH,EACEyV,KAAAA,EAAE,CAAC/V,IAAH,KAAYD,SAAS,CAACa,MAAtB,IAAgC,CAAC1M,OAAlC,IAA+C6hB,EAAE,CAAC/V,IAAH,KAAYD,SAAS,CAACqB,KAAtB,IAA+BlN,OAD/E,CADF,CAAA;AAIA,EAAA,IAAInR,IAAI,GACNkzB,MAAM,IAAID,MAAM,CAACtxB,SAAP,EAAV,GAA+B4T,SAAS,CAAC0d,MAAD,CAAxC,GAAmD5tB,IAAI,CAAC4tB,MAAM,CAACtyB,GAAR,CADzD,CAAA;;AAEA,EAAA,OAAOX,IAAP,EAAa;AACX,IAAA,MAAMA,IAAN,CAAA;AACAA,IAAAA,IAAI,GAAGqF,IAAI,CAACrF,IAAI,CAACW,GAAN,CAAX,CAAA;AACD,GAAA;AACF,CAAA;;AAED,UAAUwyB,yBAAV,CACEza,UADF,EAEEsa,EAFF,EAGEI,IAHF,EAIEjiB,OAJF,EAKuD;AACrD,EAAM,MAAA;AAAEwM,IAAAA,QAAAA;AAAF,GAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;;AAEA,EAAA,MAAMyyB,IAAI,GAAG,CAAC/qB,CAAD,EAAYvB,CAAZ,KAA0B;AACrC,IAAIqsB,IAAAA,IAAI,KAAK,QAAb,EAAuB;AACrB,MAAME,MAAAA,YAAY,GAAG/F,SAAS,CAACvK,aAAV,CAAwB1a,CAAxB,EAA2BvB,CAA3B,EAA8BoK,OAA9B,CAArB,CAAA;AACA,MAAOmiB,OAAAA,YAAY,IAAI,CAAvB,CAAA;AACD,KAAA;;AACD,IAAMvR,MAAAA,KAAK,GAAGwL,SAAS,CAAC3J,iBAAV,CAA4Btb,CAA5B,EAA+BvB,CAA/B,EAAkCoK,OAAlC,CAAd,CAAA;AACA,IAAA,OAAOvF,IAAI,CAAC+d,GAAL,CAAS5H,KAAT,EAAgB,CAAhB,CAAP,CAAA;AACD,GAPD,CAHqD;AAarD;;;AACA,EAAIwR,IAAAA,qBAAqB,GAAG,KAA5B,CAAA;AACA,EAAIC,IAAAA,SAAS,GAAG7V,QAAQ,CAAC/K,eAAT,CAAyBogB,EAAE,CAACryB,GAA5B,CAAhB,CAAA;AACA,EAAI8E,IAAAA,MAAM,GAAG,CAAb,CAAA;;AAEA,EAAA,SAASguB,YAAT,CACErE,OADF,EAEEsE,YAFF,EAG8B;AAC5B,IAAMC,MAAAA,YAAY,GAAGhW,QAAQ,CAACiW,yBAAT,CACnBxE,OADmB,EAEnB1W,UAFmB,CAArB,CAAA;;AAIA,IAAI,IAAA,CAACib,YAAL,EAAmB;AACjB,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,MAAME,SAAS,GAAGF,YAAY,CAAC3xB,YAAb,EAAlB,CAAA;AACA,IAAA,MAAM8xB,QAAQ,GAAGH,YAAY,CAAC1xB,WAAb,EAAjB,CAAA;AACA,IAAI8xB,IAAAA,QAAQ,GAAGF,SAAf,CAAA;;AACA,IAAA,IAAIH,YAAJ,EAAkB;AAChB;AACA,MAAIC,IAAAA,YAAY,CAACtjB,OAAb,CAAqB2iB,EAAE,CAACryB,GAAxB,CAAJ,EAAkC;AAChC,QAAA,OAAO,IAAP,CAAA;AACD,OAAA;;AACDozB,MAAAA,QAAQ,GAAG5iB,OAAO,GAAG2iB,QAAH,GAAcD,SAAhC,CAAA;AACD,KAND,MAMO;AACLE,MAAAA,QAAQ,GAAG5iB,OAAO,GAAG0iB,SAAH,GAAeC,QAAjC,CAAA;AACD,KAAA;;AAED,IAAA,MAAME,YAAY,GAAGD,QAAQ,EAAEpzB,GAAV,KAAkByuB,OAAvC,CAAA;;AACA,IAAI,IAAA,CAAC4E,YAAL,EAAmB;AACjB,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAM,MAAA;AAAErzB,MAAAA,GAAAA;AAAF,KAAA,GAAUgzB,YAAhB,CAAA;AACA,IAAA,MAAM1W,IAAI,GACP9L,OAAO,IAAIuiB,YAAZ,IAA8B,CAACviB,OAAD,IAAY,CAACuiB,YAA3C,GACI1W,SAAS,CAACqB,KADd,GAEIrB,SAAS,CAACa,MAHhB,CAAA;AAIA,IAAO,OAAA;AAAEld,MAAAA,GAAF;AAAOsc,MAAAA,IAAAA;AAAP,KAAP,CAAA;AACD,GAAA;;AAED,EAAK,KAAA,MAAMjd,IAAX,IAAmB+yB,yBAAyB,CAACpV,QAAD,EAAWqV,EAAX,EAAe7hB,OAAf,CAA5C,EAAqE;AACnE,IAAM,MAAA;AAAE1M,MAAAA,IAAF;AAAQ9D,MAAAA,GAAAA;AAAR,KAAA,GAAgBX,IAAtB,CAAA;AACA,IAAA,MAAM2zB,YAAY,GAAGhW,QAAQ,CAAC/K,eAAT,CAAyBjS,GAAzB,CAArB,CAAA;AAEA,IAAA,IAAIszB,SAAS,GAAGR,YAAY,CAAC9yB,GAAD,EAAM,IAAN,CAA5B,CAAA;;AACA,IAAA,IAAIszB,SAAJ,EAAe;AACb,MAAA,MAAMA,SAAN,CAAA;AACD,KAPkE;;;AASnE,IAAItW,IAAAA,QAAQ,CAAC2S,cAAT,CAAwBtwB,IAAI,CAACW,GAA7B,EAAkC+X,UAAlC,CAAJ,EAAmD;AACjDub,MAAAA,SAAS,GAAGR,YAAY,CAAC9yB,GAAD,EAAM,KAAN,CAAxB,CAAA;;AACA,MAAA,IAAIszB,SAAJ,EAAe;AACb,QAAA,MAAMA,SAAN,CAAA;AACD,OAAA;;AACDV,MAAAA,qBAAqB,GAAG,IAAxB,CAAA;AACA,MAAA,SAAA;AACD,KAhBkE;;;AAmBnE,IAAIC,IAAAA,SAAS,KAAKG,YAAlB,EAAgC;AAC9BH,MAAAA,SAAS,GAAGG,YAAZ,CAAA;AACAJ,MAAAA,qBAAqB,GAAG,IAAxB,CAAA;AACD,KAtBkE;;;AAyBnE,IAAIP,IAAAA,EAAE,CAAC1V,WAAH,EAAoBtd,IAAAA,IAAI,CAACW,GAAL,KAAaqyB,EAAE,CAACryB,GAAxC,EAA6C;AAC3C;AACA8E,MAAAA,MAAM,GAAG0L,OAAO,GACZ6hB,EAAE,CAACvtB,MAAH,GAAY4tB,IAAI,CAAC5uB,IAAD,EAAOuuB,EAAE,CAACvtB,MAAV,CADJ,GAEZutB,EAAE,CAACvtB,MAAH,GAAY4tB,IAAI,CAAC5uB,IAAD,EAAOuuB,EAAE,CAACvtB,MAAV,CAFpB,CAAA;AAGD,KALD,MAKO,IAAI8tB,qBAAJ,EAA2B;AAChC;AACA9tB,MAAAA,MAAM,GAAG0L,OAAO,GAAG1M,IAAI,CAAC3C,MAAR,GAAiB,CAAjC,CAAA;AACAyxB,MAAAA,qBAAqB,GAAG,KAAxB,CAAA;AACD,KAJM,MAIA;AACL9tB,MAAAA,MAAM,GAAG0L,OAAO,GAAG1M,IAAI,CAAC3C,MAAL,GAAcuxB,IAAI,CAAC5uB,IAAD,EAAOA,IAAI,CAAC3C,MAAZ,CAArB,GAA2CuxB,IAAI,CAAC5uB,IAAD,EAAO,CAAP,CAA/D,CAAA;AACD,KApCkE;;;AAuCnE,IAAOgB,OAAAA,MAAM,IAAIhB,IAAI,CAAC3C,MAAf,IAAyB2D,MAAM,IAAI,CAA1C,EAA6C;AAC3C,MAAM,MAAA;AAAE9E,QAAAA,GAAF;AAAO8E,QAAAA,MAAAA;AAAP,OAAN,CAAA;AACA0L,MAAAA,OAAO,GAAI1L,MAAM,IAAI4tB,IAAI,CAAC5uB,IAAD,EAAOgB,MAAP,CAAlB,GAAqCA,MAAM,IAAI4tB,IAAI,CAAC5uB,IAAD,EAAOgB,MAAP,CAA1D,CAAA;AACD,KAAA;;AAEDwuB,IAAAA,SAAS,GAAGR,YAAY,CAAC9yB,GAAD,EAAM,KAAN,CAAxB,CAAA;;AACA,IAAA,IAAIszB,SAAJ,EAAe;AACb,MAAA,MAAMA,SAAN,CAAA;AACD,KAAA;AACF,GAAA;AACF,CAAA;;AAEM,SAASC,eAAT,CACLxb,UADK,EAELsa,EAFK,EAGLmB,QAAQ,GAAG,CAHN,EAILf,IAAc,GAAG,QAJZ,EAKL;AACA,EAAM,MAAA;AAAEzV,IAAAA,QAAAA;AAAF,GAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;AACA,EAAA,MAAMuQ,OAAO,GAAGgjB,QAAQ,GAAG,CAA3B,CAAA;AACA,EAAA,IAAIC,SAAS,GAAGxoB,IAAI,CAACiY,GAAL,CAASsQ,QAAT,CAAhB,CAAA;;AAEA,EAAIf,IAAAA,IAAI,KAAK,MAAT,IAAmBJ,EAAE,CAACzV,WAAH,EAAvB,EAAyC;AACvC,IAAM,MAAA;AAAE5c,MAAAA,GAAAA;AAAF,KAAA,GAAUqyB,EAAhB,CAAA;;AACA,IAAI7hB,IAAAA,OAAO,IAAI6hB,EAAE,CAAC/V,IAAH,KAAYD,SAAS,CAACqB,KAArC,EAA4C;AAC1C,MAAOrB,OAAAA,SAAS,CAAC7a,MAAV,CAAiB;AAAExB,QAAAA,GAAF;AAAOsc,QAAAA,IAAI,EAAED,SAAS,CAACa,MAAAA;AAAvB,OAAjB,CAAP,CAAA;AACD,KAAA;;AACD,IAAI,IAAA,CAAC1M,OAAD,IAAY6hB,EAAE,CAAC/V,IAAH,KAAYD,SAAS,CAACa,MAAtC,EAA8C;AAC5C,MAAOb,OAAAA,SAAS,CAAC7a,MAAV,CAAiB;AAAExB,QAAAA,GAAF;AAAOsc,QAAAA,IAAI,EAAED,SAAS,CAACqB,KAAAA;AAAvB,OAAjB,CAAP,CAAA;AACD,KAAA;AACF,GAAA;;AAED,EAAA,KAAK,MAAMgW,EAAX,IAAiBlB,yBAAyB,CAACza,UAAD,EAAasa,EAAb,EAAiBI,IAAjB,EAAuBjiB,OAAvB,CAA1C,EAA2E;AACzEijB,IAAAA,SAAS,IAAI,CAAb,CAAA;;AACA,IAAIA,IAAAA,SAAS,IAAI,CAAjB,EAAoB;AAClB,MAAA,OAAOvX,KAAK,CAAC1a,MAAN,CAAakyB,EAAb,CAAP,CAAA;AACD,KAAA;AACF,GAAA;;AACD,EAAA,OAAO3b,UAAU,CAACoa,KAAX,CAAiBwB,eAAjB,EAAkC3W,QAAlC,EAA4CxM,OAAO,GAAG,OAAH,GAAa,KAAhE,CAAP,CAAA;AACD,CAAA;AAEM,SAASojB,kBAAT,CAA4B7b,UAA5B,EAAoD1Y,IAApD,EAAgE;AACrE,EAAO0Y,OAAAA,UAAU,CAACoa,KAAX,CAAiBwB,eAAjB,EAAkCt0B,IAAlC,EAAwC,OAAxC,CAAP,CAAA;AACD,CAAA;AAEM,SAASw0B,gBAAT,CAA0B9b,UAA1B,EAAkD1Y,IAAlD,EAA8D;AACnE,EAAO0Y,OAAAA,UAAU,CAACoa,KAAX,CAAiBwB,eAAjB,EAAkCt0B,IAAlC,EAAwC,KAAxC,CAAP,CAAA;AACD,CAAA;;AAED,SAASs0B,eAAT,CACE5b,UADF,EAEE1Y,IAFF,EAGE8O,KAHF,EAIE;AACA,EAAM,MAAA;AAAE6O,IAAAA,QAAAA;AAAF,GAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;AACA,EAAA,MAAM6zB,UAAU,GACd3lB,KAAK,KAAK,OAAV,GAAoB9O,IAAI,CAAC4B,YAAL,EAApB,GAA0C5B,IAAI,CAAC+B,WAAL,EAD5C,CAFA;;AAKA,EAAA,MAAM2yB,aAAa,GAAG/W,QAAQ,CAACgX,0BAAT,CACpBF,UAAU,CAAC9zB,GADS,EAEpBX,IAAI,CAACW,GAFe,EAGpB+X,UAHoB,CAAtB,CALA;;AAWA,EAAA,IAAIgc,aAAJ,EAAmB;AACjB,IAAM,MAAA;AAAE/zB,MAAAA,GAAAA;AAAF,KAAA,GAAU+zB,aAAhB,CAAA;AACA,IAAA,MAAMzX,IAAI,GAAGnO,KAAK,KAAK,OAAV,GAAoBkO,SAAS,CAACa,MAA9B,GAAuCb,SAAS,CAACqB,KAA9D,CAAA;AACA,IAAOrB,OAAAA,SAAS,CAAC7a,MAAV,CAAiB;AAAExB,MAAAA,GAAF;AAAOsc,MAAAA,IAAAA;AAAP,KAAjB,CAAP,CAAA;AACD,GAfD;;;AAiBA,EAAM,MAAA;AAAEtc,IAAAA,GAAAA;AAAF,GAAA,GAAU8zB,UAAhB,CAAA;AACA,EAAA,MAAMhvB,MAAM,GAAGqJ,KAAK,KAAK,OAAV,GAAoB,CAApB,GAAwB2lB,UAAU,CAAChwB,IAAX,CAAgB3C,MAAvD,CAAA;AACA,EAAOib,OAAAA,SAAS,CAAC5a,MAAV,CAAiB;AAAExB,IAAAA,GAAF;AAAO8E,IAAAA,MAAAA;AAAP,GAAjB,CAAP,CAAA;AACD,CAAA;;AAED,SAASmvB,oBAAT,CAA8Blc,UAA9B,EAA0CkF,KAA1C,EAAiDgU,SAAjD,EAA4D;AAC1D,EAAM,MAAA;AAAEjU,IAAAA,QAAAA;AAAF,GAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;AACA,EAAMZ,MAAAA,IAAI,GAAG2d,QAAQ,CAAC/N,UAAT,CAAoBgO,KAAK,CAACjd,GAA1B,CAAb,CAAA;AACA,EAAMk0B,MAAAA,WAAW,GAAGnc,UAAU,CAACoa,KAAX,CAAiB,QAAjB,EAA2B9yB,IAA3B,CAAA,GAChBA,IADgB,GAEhB2d,QAAQ,CAAC2S,cAAT,CAAwB1S,KAAK,CAACjd,GAA9B,EAAmC+X,UAAnC,CAFJ,CAAA;AAGA,EAAIoc,IAAAA,SAAyB,GAAG,IAAhC,CAAA;;AACA,EAAA,IAAID,WAAJ,EAAiB;AACfC,IAAAA,SAAS,GAAGlF,WAAW,CAACiF,WAAW,CAACl0B,GAAb,CAAX,CAA6BgqB,qBAA7B,EAAZ,CAAA;AACD,GAFD,MAEO;AACLmK,IAAAA,SAAS,GAAGnD,iBAAiB,CAAC/T,KAAD,EAAQgU,SAAR,EAAmBlZ,UAAnB,CAA7B,CAAA;AACD,GAAA;;AACD,EAAI,IAAA,CAACoc,SAAL,EAAgB;AACd,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AACD,EAAA,OAAOA,SAAP,CAAA;AACD,CAAA;;AAEM,SAASC,cAAT,CACLrc,UADK,EAELkF,KAFK,EAGLgU,SAHK,EAILoD,OAJK,EAKL;AACA,EAAM,MAAA;AAAEp0B,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAA,GAAe/c,KAArB,CAAA;AAEA,EAAMk0B,MAAAA,SAAS,GAAGF,oBAAoB,CAAClc,UAAD,EAAakF,KAAb,EAAoBgU,SAApB,CAAtC,CAAA;;AACA,EAAI,IAAA,CAACkD,SAAL,EAAgB;AACd,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AAED,EAAMG,MAAAA,KAAK,GAAGrX,KAAK,CAACL,WAAN,EAAuBK,IAAAA,KAAK,CAACX,IAAN,KAAeD,SAAS,CAACqB,KAAhD,GAAwDyW,SAAS,CAAClvB,KAAlE,GAA0EkvB,SAAS,CAACnvB,IAAlG,CAAA;AAEA,EAAM6iB,MAAAA,CAAC,GAAG,OAAOwM,OAAP,KAAmB,QAAnB,GAA8BA,OAA9B,GAAwCC,KAAlD,CAAA;AACA,EAAA,IAAIrM,CAAC,GAAGkM,SAAS,CAACjM,GAAlB,CAAA;AAEA,EAAIqM,IAAAA,YAAY,GAAGvX,QAAQ,CAACtJ,wBAAT,CAAkCuJ,KAAK,CAACjd,GAAxC,CAAnB,CAAA;AACA,EAAIw0B,IAAAA,eAA0C,GAAG,IAAjD,CAAA;AACA,EAAA,IAAIC,eAAJ,CAAA;AACA,EAAIpvB,IAAAA,KAAK,GAAG,KAAZ,CAAA;;AACA,EAAO,OAAA,CAACA,KAAR,EAAe;AACb,IAAI,IAAA,CAACkvB,YAAL,EAAmB;AACjB,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAMvB,MAAAA,YAAY,GAAGhW,QAAQ,CAACiW,yBAAT,CAAmCsB,YAAY,CAACv0B,GAAhD,EAAqD+X,UAArD,CAArB,CAAA;;AACA,IAAA,IAAKib,YAAY,IAAIA,YAAY,CAAChzB,GAAb,KAAqBid,KAAK,CAACjd,GAA3C,IAAkD,CAACgzB,YAAY,CAACtjB,OAAb,CAAqBuN,KAAK,CAACjd,GAA3B,CAAxD,EAA0F;AACxF,MAAM,MAAA;AAAEA,QAAAA,GAAAA;AAAF,OAAA,GAAUgzB,YAAhB,CAAA;AACA,MAAA,MAAM1W,IAAI,GAAGyV,iBAAiB,CAAClK,CAAD,EAAI9P,UAAJ,CAAjB,GAAmCsE,SAAS,CAACa,MAA7C,GAAsDb,SAAS,CAACqB,KAA7E,CAAA;AACA,MAAOrB,OAAAA,SAAS,CAAC7a,MAAV,CAAiB;AAAExB,QAAAA,GAAF;AAAOsc,QAAAA,IAAAA;AAAP,OAAjB,CAAP,CAAA;AACD,KAAA;;AACD,IAAI,IAAA;AACFkY,MAAAA,eAAe,GAAGvF,WAAW,CAACsF,YAAY,CAACv0B,GAAd,EAAmB/B,MAAnB,CAA7B,CAAA;AACD,KAFD,CAEE,OAAOy2B,CAAP,EAAU;AACVH,MAAAA,YAAY,GAAGvX,QAAQ,CAAClL,gBAAT,CAA0ByiB,YAAY,CAACv0B,GAAvC,CAAf,CAAA;AACA,MAAA,SAAA;AACD,KAAA;;AAEDy0B,IAAAA,eAAe,GAAGltB,KAAK,CAAC2X,IAAN,CAChBsV,eAAe,CAAEnK,gBAAjB,CAAmC,QAAOxE,QAAQ,CAACphB,IAAK,CAAxD,CAAA,CAAA,CADgB,EAEhB+L,OAFgB,EAAlB,CAjBa;;AAsBb,IAAA,KAAK,MAAMmkB,OAAX,IAAsBF,eAAtB,EAAuC;AACrC,MAAA,IAAIpvB,KAAJ,EAAW;AACT,QAAA,MAAA;AACD,OAAA;;AAED,MAAMuvB,MAAAA,UAAU,GAAGrtB,KAAK,CAAC2X,IAAN,CAAWyV,OAAO,CAAC7J,cAAR,EAAX,EAChBnnB,MADgB,CACRmkB,IAAD,IAAUA,IAAI,CAACgB,MAAL,GAAc,CADf,CAAnB,CAAA;AAGA,MAAA,MAAM+L,gBAAgB,GAAGD,UAAU,CAACzzB,MAApC,CARqC;;AAWrC,MAAA,KAAK,IAAIgK,CAAC,GAAG0pB,gBAAgB,GAAG,CAAhC,EAAmC1pB,CAAC,IAAI,CAAxC,EAA2CA,CAAC,EAA5C,EAAgD;AAC9C,QAAA,MAAM2pB,SAAS,GAAGF,UAAU,CAACzpB,CAAD,CAA5B,CAAA;;AACA,QAAA,IAAI2pB,SAAS,CAAC1M,MAAV,IAAoBH,CAAxB,EAA2B;AACzB5iB,UAAAA,KAAK,GAAG,IAAR,CAAA;AACA4iB,UAAAA,CAAC,GAAG6M,SAAS,CAAC1M,MAAV,GAAmB0M,SAAS,CAAChM,MAAV,GAAmB,CAA1C,CAAA;AACA,UAAA,MAAA;AACD,SAAA;AACF,OAAA;AACF,KAAA;;AACDyL,IAAAA,YAAY,GAAGvX,QAAQ,CAAClL,gBAAT,CAA0ByiB,YAAY,CAACv0B,GAAvC,CAAf,CAAA;AACD,GAAA;;AAED,EAAA,MAAMmsB,KAAK,GACTqI,eAAe,IAAItG,4BAA4B,CAACsG,eAAD,EAAkB3M,CAAlB,EAAqBI,CAArB,EAAwBlQ,UAAxB,CADjD,CAAA;;AAEA,EAAI,IAAA,CAACoU,KAAL,EAAY;AACV,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AACD,EAAOA,OAAAA,KAAK,CAACzE,MAAb,CAAA;AACD,CAAA;AAEM,SAASqN,cAAT,CAAwBhd,UAAxB,EAAgD;AACrD,EAAM,MAAA;AAAE9X,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAF;AAAY3D,IAAAA,SAAAA;AAAZ,GAAA,GAA0BpZ,KAAhC,CAAA;;AACA,EAAI,IAAA,CAACoZ,SAAL,EAAgB;AACd,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AACD,EAAA,MAAM/Q,KAAK,GAAG+Q,SAAS,CAAC2b,QAAV,CAAmBhY,QAAnB,CAAd,CAAA;AACA,EAAM,MAAA;AAAEiU,IAAAA,SAAAA;AAAF,GAAA,GAAgB5X,SAAtB,CAAA;AAEA,EAAM4D,MAAAA,KAAK,GAAGmX,cAAc,CAACrc,UAAD,EAAazP,KAAb,EAAoB2oB,SAApB,CAA5B,CAAA;;AACA,EAAI,IAAA,CAAChU,KAAL,EAAY;AACV,IAAA,OAAO5D,SAAS,CAAC4b,qBAAV,CAAgCld,UAAhC,CAAP,CAAA;AACD,GAAA;;AAED,EAAMmd,MAAAA,aAAa,GAAGtD,2BAA2B,CAACtpB,KAAD,EAAQ2U,KAAR,EAAelF,UAAf,CAAjD,CAAA;AAEA,EAAMod,MAAAA,QAAQ,GAAG9b,SAAS,CACvB+b,YADc,CACDnY,KAAK,CAACjd,GADL,EACUid,KAAK,CAACL,WAAN,EAAsBK,GAAAA,KAAK,CAACX,IAA5B,GAAmCW,KAAK,CAACnY,MADnD,CAEduwB,CAAAA,YAFc,EAGdC,CAAAA,UAHc,CAGHJ,aAHG,CAAjB,CAAA;AAKA,EAAA,OAAOC,QAAP,CAAA;AACD,CAAA;AAEM,SAASI,gBAAT,CACLxd,UADK,EAELkF,KAFK,EAGLgU,SAHK,EAILoD,OAJK,EAKL;AACA,EAAM,MAAA;AAAEp0B,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAA,GAAe/c,KAArB,CAAA;AACA,EAAMk0B,MAAAA,SAAS,GAAGF,oBAAoB,CAAClc,UAAD,EAAakF,KAAb,EAAoBgU,SAApB,CAAtC,CAAA;;AACA,EAAI,IAAA,CAACkD,SAAL,EAAgB;AACd,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AAED,EAAMG,MAAAA,KAAK,GAAGrX,KAAK,CAACL,WAAN,EAAuBK,IAAAA,KAAK,CAACX,IAAN,KAAeD,SAAS,CAACqB,KAAhD,GAAwDyW,SAAS,CAAClvB,KAAlE,GAA0EkvB,SAAS,CAACnvB,IAAlG,CAAA;AAEA,EAAM6iB,MAAAA,CAAC,GAAG,OAAOwM,OAAP,KAAmB,QAAnB,GAA8BA,OAA9B,GAAwCC,KAAlD,CAAA;AACA,EAAA,IAAIrM,CAAC,GAAGkM,SAAS,CAAC/L,MAAlB,CAAA;AAEA,EAAImM,IAAAA,YAAY,GAAGvX,QAAQ,CAACtJ,wBAAT,CAAkCuJ,KAAK,CAACjd,GAAxC,CAAnB,CAAA;AACA,EAAIw0B,IAAAA,eAA0C,GAAG,IAAjD,CAAA;AACA,EAAA,IAAIC,eAAJ,CAAA;AAEA,EAAIpvB,IAAAA,KAAK,GAAG,KAAZ,CAAA;;AACA,EAAO,OAAA,CAACA,KAAR,EAAe;AACb,IAAI,IAAA,CAACkvB,YAAL,EAAmB;AACjB,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAMvB,MAAAA,YAAY,GAAGhW,QAAQ,CAACiW,yBAAT,CAAmCsB,YAAY,CAACv0B,GAAhD,EAAqD+X,UAArD,CAArB,CAAA;;AACA,IAAA,IAAIib,YAAY,IAAIA,YAAY,CAAChzB,GAAb,KAAqBid,KAAK,CAACjd,GAA3C,IAAkD,CAACgzB,YAAY,CAACtjB,OAAb,CAAqBuN,KAAK,CAACjd,GAA3B,CAAvD,EAAwF;AACtF,MAAM,MAAA;AAAEA,QAAAA,GAAAA;AAAF,OAAA,GAAUgzB,YAAhB,CAAA;AACA,MAAA,MAAM1W,IAAI,GAAGyV,iBAAiB,CAAClK,CAAD,EAAI9P,UAAJ,CAAjB,GAAmCsE,SAAS,CAACa,MAA7C,GAAsDb,SAAS,CAACqB,KAA7E,CAAA;AACA,MAAOrB,OAAAA,SAAS,CAAC7a,MAAV,CAAiB;AAAExB,QAAAA,GAAF;AAAOsc,QAAAA,IAAAA;AAAP,OAAjB,CAAP,CAAA;AACD,KAAA;;AACD,IAAI,IAAA;AACFkY,MAAAA,eAAe,GAAGvF,WAAW,CAACsF,YAAY,CAACv0B,GAAd,EAAmB/B,MAAnB,CAA7B,CAAA;AACD,KAFD,CAEE,OAAOy2B,CAAP,EAAU;AACVH,MAAAA,YAAY,GAAGvX,QAAQ,CAAC9K,YAAT,CAAsBqiB,YAAY,CAACv0B,GAAnC,CAAf,CAAA;AACA,MAAA,SAAA;AACD,KAAA;;AACDy0B,IAAAA,eAAe,GAAGltB,KAAK,CAAC2X,IAAN,CAChBsV,eAAe,CAACnK,gBAAhB,CAAkC,CAAA,KAAA,EAAOxE,QAAQ,CAACphB,IAAK,GAAvD,CADgB,CAAlB,CAhBa;;AAqBb,IAAA,KAAK,MAAMkwB,OAAX,IAAsBF,eAAtB,EAAuC;AACrC,MAAA,IAAIpvB,KAAJ,EAAW;AACT,QAAA,MAAA;AACD,OAAA;;AAED,MAAMuvB,MAAAA,UAAU,GAAGrtB,KAAK,CAAC2X,IAAN,CAAWyV,OAAO,CAAC7J,cAAR,EAAX,EAChBnnB,MADgB,CACRmkB,IAAD,IAAUA,IAAI,CAACgB,MAAL,GAAc,CADf,CAAnB,CAAA;AAGA,MAAA,MAAM+L,gBAAgB,GAAGD,UAAU,CAACzzB,MAApC,CARqC;;AAWrC,MAAA,KAAK,IAAIgK,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAI0pB,gBAAgB,GAAG,CAAxC,EAA2C1pB,CAAC,EAA5C,EAAgD;AAC9C,QAAA,MAAM2pB,SAAS,GAAGF,UAAU,CAACzpB,CAAD,CAA5B,CAAA;;AACA,QAAA,IAAI2pB,SAAS,CAAC5M,GAAV,IAAiBD,CAArB,EAAwB;AACtB5iB,UAAAA,KAAK,GAAG,IAAR,CAAA;AACA4iB,UAAAA,CAAC,GAAG6M,SAAS,CAAC5M,GAAV,GAAgB4M,SAAS,CAAChM,MAAV,GAAmB,CAAvC,CAAA;AACA,UAAA,MAAA;AACD,SAAA;AACF,OAAA;AACF,KAAA;;AACDyL,IAAAA,YAAY,GAAGvX,QAAQ,CAAC9K,YAAT,CAAsBqiB,YAAY,CAACv0B,GAAnC,CAAf,CAAA;AACD,GAAA;;AAED,EAAA,MAAMmsB,KAAK,GACTqI,eAAe,IAAItG,4BAA4B,CAACsG,eAAD,EAAkB3M,CAAlB,EAAqBI,CAArB,EAAwBlQ,UAAxB,CADjD,CAAA;;AAEA,EAAI,IAAA,CAACoU,KAAL,EAAY;AACV,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AACD,EAAOA,OAAAA,KAAK,CAACzE,MAAb,CAAA;AACD,CAAA;AAEM,SAAS8N,gBAAT,CAA0Bzd,UAA1B,EAAkD;AACvD,EAAM,MAAA;AAAE9X,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAF;AAAY3D,IAAAA,SAAAA;AAAZ,GAAA,GAA0BpZ,KAAhC,CAAA;;AACA,EAAI,IAAA,CAACoZ,SAAL,EAAgB;AACd,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AACD,EAAA,MAAM/Q,KAAK,GAAG+Q,SAAS,CAAC2b,QAAV,CAAmBhY,QAAnB,CAAd,CAAA;AACA,EAAM,MAAA;AAAEiU,IAAAA,SAAAA;AAAF,GAAA,GAAgB5X,SAAtB,CAAA;AAEA,EAAM4D,MAAAA,KAAK,GAAGsY,gBAAgB,CAACxd,UAAD,EAAazP,KAAb,EAAoB2oB,SAApB,CAA9B,CAAA;;AACA,EAAI,IAAA,CAAChU,KAAL,EAAY;AACV,IAAA,OAAO5D,SAAS,CAACoc,mBAAV,CAA8B1d,UAA9B,CAAP,CAAA;AACD,GAAA;;AAED,EAAMmd,MAAAA,aAAa,GAAGtD,2BAA2B,CAACtpB,KAAD,EAAQ2U,KAAR,EAAelF,UAAf,CAAjD,CAAA;AAEA,EAAMod,MAAAA,QAAQ,GAAG9b,SAAS,CACvB+b,YADc,CACDnY,KAAK,CAACjd,GADL,EACUid,KAAK,CAACL,WAAN,EAAsBK,GAAAA,KAAK,CAACX,IAA5B,GAAmCW,KAAK,CAACnY,MADnD,CAEduwB,CAAAA,YAFc,EAGdC,CAAAA,UAHc,CAGHJ,aAHG,CAAjB,CAAA;AAKA,EAAA,OAAOC,QAAP,CAAA;AACD;;ACleD;AACA;AACA;AACA;AAqCA,IAAYO,gBAAZ,CAAA;;WAAYA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,CAAAA,EAAAA,qBAAAA;;AAiCZ,MAAMC,kBAAkB,GAAG,IAAIzuB,OAAJ,EAA3B,CAAA;AACA,MAAM0uB,gBAAgB,GAAG,IAAI1uB,OAAJ,EAAzB,CAAA;AAEe,MAAMugB,SAAN,SAAwBtnB,eAAxB,CAC0B;AACvC,EAAOqB,OAAAA,MAAP,CACEb,KADF,EAEa;AACX,IAAA,IAAI8mB,SAAS,CAACoO,WAAV,CAAsBl1B,KAAtB,CAAJ,EAAkC;AAChC,MAAA,OAAOA,KAAP,CAAA;AACD,KAAA;;AAED,IAAA,IAAIH,iCAAa,CAACG,KAAD,CAAjB,EAA0B;AACxB,MAAM,MAAA;AAAEgB,QAAAA,IAAI,GAAG,EAAT;AAAa+lB,QAAAA,MAAb;AAAqBC,QAAAA,KAArB;AAA4B5jB,QAAAA,KAAAA;AAA5B,OAAA,GAAsCpD,KAA5C,CAAA;AACA,MAAO,OAAA,IAAI8mB,SAAJ,CAAc;AACnB9lB,QAAAA,IADmB;AAEnB+lB,QAAAA,MAAM,EAAExL,KAAK,CAAC1a,MAAN,CAAakmB,MAAb,CAFW;AAGnBC,QAAAA,KAAK,EAAEzL,KAAK,CAAC1a,MAAN,CAAammB,KAAb,CAHY;AAInB5jB,QAAAA,KAAK,EAAEA,KAAK,GAAGA,KAAK,CAACC,GAAN,CAAU9B,IAAI,IAAIX,IAAI,CAACC,MAAL,CAAYU,IAAZ,CAAlB,CAAH,GAA0C,IAAA;AAJnC,OAAd,CAAP,CAAA;AAMD,KAAA;;AAED,IAAA,MAAM,IAAIzB,KAAJ,CACH,CAAoFE,kFAAAA,EAAAA,KAAM,EADvF,CAAN,CAAA;AAGD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSm1B,EAAAA,cAAP,CAAsB9Y,QAAtB,EAA0C+Y,SAA1C,EAA+D;AAC7D,IAAA,MAAMztB,KAAK,GAAG,IAAA,CAAK0sB,QAAL,CAAchY,QAAd,CAAd,CAAA;AACA,IAAA,MAAMzU,GAAG,GAAG,IAAA,CAAKytB,MAAL,CAAYhZ,QAAZ,CAAZ,CAAA;;AACA,IAAI,IAAA,CAAC1U,KAAK,CAACqU,WAAN,EAAD,IAAwB,CAACpU,GAAG,CAACoU,WAAJ,EAA7B,EAAgD;AAC9C,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,MAAMsZ,SAAS,GAAG,IAAA,CAAKA,SAAL,CAAejZ,QAAf,CAAlB,CAAA;AACA,IAAIkZ,IAAAA,WAAsB,GAAG,IAA7B,CAAA;;AACA,IAAI,IAAA,CAACH,SAAD,IAAcxtB,GAAG,CAACzD,MAAJ,KAAe,CAAjC,EAAoC;AAClC,MAAMqxB,MAAAA,aAAa,GAAGnZ,QAAQ,CAACxL,eAAT,CAAyBjJ,GAAG,CAACvI,GAA7B,CAAtB,CAAA;;AACA,MAAA,IAAIm2B,aAAJ,EAAmB;AACjBD,QAAAA,WAAW,GAAGA,WAAW,CAACl0B,GAAZ,CACZi0B,SAAS,GAAG,OAAH,GAAa,QADV,EAEZ7Z,SAAS,CAACxa,QAAV,CAAmB;AACjB5B,UAAAA,GAAG,EAAEm2B,aAAa,CAACn2B,GADF;AAEjB8E,UAAAA,MAAM,EAAEqxB,aAAa,CAACryB,IAAd,CAAmB3C,MAAAA;AAFV,SAAnB,CAFY,CAAd,CAAA;AAOD,OAAA;AACF,KAAA;;AAED,IAAMi1B,MAAAA,eAAe,GAAGpZ,QAAQ,CAACtN,OAAT,CAAiBpH,KAAK,CAACtI,GAAvB,CAAxB,CAAA;;AACA,IAAIo2B,IAAAA,eAAe,IAAI9tB,KAAK,CAACxD,MAAN,KAAiBsxB,eAAe,CAACtyB,IAAhB,CAAqB3C,MAA7D,EAAqE;AACnE,MAAMk1B,MAAAA,eAAe,GAAGrZ,QAAQ,CAACrL,WAAT,CAAqBrJ,KAAK,CAACtI,GAA3B,CAAxB,CAAA;;AACA,MAAA,IAAIq2B,eAAJ,EAAqB;AACnBH,QAAAA,WAAW,GAAGA,WAAW,CAACl0B,GAAZ,CACZi0B,SAAS,GAAG,QAAH,GAAc,OADX,EAEZ/Z,KAAK,CAACta,QAAN,CAAe;AAAE5B,UAAAA,GAAG,EAAEq2B,eAAe,CAACr2B,GAAvB;AAA4B8E,UAAAA,MAAM,EAAE,CAAA;AAApC,SAAf,CAFY,CAAd,CAAA;AAID,OAAA;AACF,KAAA;;AACD,IAAA,OAAOoxB,WAAP,CAAA;AACD,GAAA;;AAED,EAAOt0B,OAAAA,QAAP,CAAgBC,IAAhB,EAAqC;AACnC,IAAM,MAAA;AAAEF,MAAAA,IAAF;AAAQ+lB,MAAAA,MAAR;AAAgBC,MAAAA,KAAhB;AAAuB5jB,MAAAA,KAAAA;AAAvB,KAAA,GAAiClC,IAAvC,CAAA;AACA,IAAO4lB,OAAAA,SAAS,CAACjmB,MAAV,CAAiB;AACtBG,MAAAA,IADsB;AAEtB+lB,MAAAA,MAAM,EAAExL,KAAK,CAACta,QAAN,CAAe8lB,MAAf,CAFc;AAGtBC,MAAAA,KAAK,EAAEzL,KAAK,CAACta,QAAN,CAAe+lB,KAAf,CAHe;AAItB5jB,MAAAA,KAAK,EAAEA,KAAK,GAAGA,KAAK,CAACC,GAAN,CAAU9B,IAAI,IAAIX,IAAI,CAACK,QAAL,CAAcM,IAAd,CAAlB,CAAH,GAA4C,IAAA;AAJlC,KAAjB,CAAP,CAAA;AAMD,GAAA;;AAED,EAAO2zB,OAAAA,WAAP,CACES,cADF,EAE+B;AAC7B,IAAOA,OAAAA,cAAc,YAAY7O,SAAjC,CAAA;AACD,GAAA;;AAED,EAAO8O,OAAAA,gBAAP,CACED,cADF,EAE+B;AAC7B,IAAA,OAAO7O,SAAS,CAACoO,WAAV,CAAsBS,cAAtB,CAAP,CAAA;AACD,GAAA;;AAED,EAAA,OAAOE,gBAAP,CAAwBxZ,QAAxB,EAA4C3D,SAA5C,EAA4D;AAC1D,IAAA,IAAI,CAACoO,SAAS,CAACoO,WAAV,CAAsBxc,SAAtB,CAAL,EAAuC;AACrC,MAAA,OAAO,KAAP,CAAA;AACD,KAAA;;AACD,IAAM,MAAA;AAAEqO,MAAAA,MAAF;AAAUC,MAAAA,KAAAA;AAAV,KAAA,GAAoBtO,SAA1B,CAAA;AACA,IAAMod,MAAAA,UAAU,GAAGzZ,QAAQ,CAACtN,OAAT,CAAiBgY,MAAM,CAAC1nB,GAAxB,CAAnB,CAAA;AACA,IAAM02B,MAAAA,SAAS,GAAG1Z,QAAQ,CAACtN,OAAT,CAAiBiY,KAAK,CAAC3nB,GAAvB,CAAlB,CAAA;;AACA,IAAA,IAAI,CAACy2B,UAAD,IAAe,CAACC,SAApB,EAA+B;AAC7B,MAAA,OAAO,KAAP,CAAA;AACD,KAAA;;AACD,IAAMC,MAAAA,aAAa,GAChBjP,MAAM,CAAC/K,WAAP,MACC+K,MAAM,CAAC5iB,MAAP,IAAiB,CADlB,IAEC4iB,MAAM,CAAC5iB,MAAP,IAAiB2xB,UAAU,CAAC3yB,IAAX,CAAgB3C,MAFnC,IAGAumB,MAAM,CAAC9K,WAAP,EAJF,CAAA;AAKA,IAAMga,MAAAA,YAAY,GACfjP,KAAK,CAAChL,WAAN,MACCgL,KAAK,CAAC7iB,MAAN,IAAgB,CADjB,IAEC6iB,KAAK,CAAC7iB,MAAN,IAAgB4xB,SAAS,CAAC5yB,IAAV,CAAe3C,MAFjC,IAGAwmB,KAAK,CAAC/K,WAAN,EAJF,CAAA;AAKA,IAAO+Z,OAAAA,aAAa,IAAIC,YAAxB,CAAA;AACD,GAAA;;AAED,EAAA,OAAOC,qBAAP,CAA6B7Z,QAA7B,EAAiD3D,SAAjD,EAAiE;AAC/D,IAAA,OAAOoO,SAAS,CAAC+O,gBAAV,CAA2BxZ,QAA3B,EAAqC3D,SAArC,CAAP,CAAA;AACD,GAAA;;AAED,EAAA,OAAOyd,iBAAP,CAAyB9Z,QAAzB,EAA6CC,KAA7C,EAA2E;AACzE,IAAA,IAAIA,KAAK,CAACL,WAAN,EAAJ,EAAyB;AACvB,MAAO6K,OAAAA,SAAS,CAACjmB,MAAV,CAAiB;AACtBkmB,QAAAA,MAAM,EAAEzK,KAAK,CAACjb,GAAN,CAAU,MAAV,EAAkBqa,SAAS,CAACa,MAA5B,CADc;AAEtByK,QAAAA,KAAK,EAAE1K,KAAK,CAACjb,GAAN,CAAU,MAAV,EAAkBqa,SAAS,CAACqB,KAA5B,CAAA;AAFe,OAAjB,CAAP,CAAA;AAID,KAAA;;AACD,IAAM5Z,MAAAA,IAAI,GAAGkZ,QAAQ,CAACtN,OAAT,CAAiBuN,KAAK,CAACjd,GAAvB,CAAb,CAAA;;AACA,IAAI,IAAA,CAAC8D,IAAL,EAAW;AACT,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AAED,IAAA,MAAM,CAACwE,KAAD,EAAQC,GAAR,CAAA,GAAeqkB,SAAS,CAACnK,YAAV,CAAuB3e,IAAI,CAACA,IAA5B,EAAkCmZ,KAAK,CAACnY,MAAxC,CAArB,CAAA;AACA,IAAO2iB,OAAAA,SAAS,CAACjmB,MAAV,CAAiB;AACtBkmB,MAAAA,MAAM,EAAEzK,KAAK,CAACjb,GAAN,CAAU,QAAV,EAAoBsG,KAApB,CADc;AAEtBqf,MAAAA,KAAK,EAAE1K,KAAK,CAACjb,GAAN,CAAU,QAAV,EAAoBuG,GAApB,CAAA;AAFe,KAAjB,CAAP,CAAA;AAID,GAAA;;AAED,EAAA,OAAOtG,OAAP,CAAe80B,aAAf,EAAyC/rB,MAAzC,EAA4D;AAC1D,IACE7I,OAAAA,yBAAK,CAAC40B,aAAa,CAACrP,MAAf,EAAuB1c,MAAM,CAAC0c,MAA9B,CAAL,IACAvlB,yBAAK,CAAC40B,aAAa,CAACpP,KAAf,EAAsB3c,MAAM,CAAC2c,KAA7B,CAFP,CAAA;AAID,GAAA;;AAUSjnB,EAAAA,WAAV,CAAsBC,KAAtB,EAA4D;AAC1D,IAAA,KAAA,EAAA,CAAA;AAD0D,IAAA,IAAA,CAR5CgB,IAQ4C,GAAA,KAAA,CAAA,CAAA;AAAA,IAAA,IAAA,CAN5C+lB,MAM4C,GAAA,KAAA,CAAA,CAAA;AAAA,IAAA,IAAA,CAJ5CC,KAI4C,GAAA,KAAA,CAAA,CAAA;AAAA,IAAA,IAAA,CAF5C5jB,KAE4C,GAAA,KAAA,CAAA,CAAA;AAE1D,IAAM,MAAA;AAAEpC,MAAAA,IAAF;AAAQ+lB,MAAAA,MAAR;AAAgBC,MAAAA,KAAhB;AAAuB5jB,MAAAA,KAAK,GAAG,IAAA;AAA/B,KAAA,GAAwCpD,KAA9C,CAAA;AACA,IAAKgB,IAAAA,CAAAA,IAAL,GAAYA,IAAZ,CAAA;AACA,IAAK+lB,IAAAA,CAAAA,MAAL,GAAcA,MAAd,CAAA;AACA,IAAKC,IAAAA,CAAAA,KAAL,GAAaA,KAAb,CAAA;AACA,IAAK5jB,IAAAA,CAAAA,KAAL,GAAaA,KAAb,CAAA;AACA,IAAA,IAAA,CAAK7D,MAAL,EAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACE,EAAA,IAAWmvB,WAAX,GAAyB;AACvB,IAAA,IAAI,CAACsG,kBAAkB,CAACvyB,GAAnB,CAAuB,IAAvB,CAAL,EAAmC;AACjC,MAAM,MAAA;AAAEskB,QAAAA,MAAF;AAAUC,QAAAA,KAAAA;AAAV,OAAA,GAAoB,IAA1B,CAAA;AACAgO,MAAAA,kBAAkB,CAAC3zB,GAAnB,CAAuB,IAAvB,EAA6BG,yBAAK,CAACulB,MAAD,EAASC,KAAT,CAAlC,CAAA,CAAA;AACD,KAAA;;AACD,IAAA,OAAOgO,kBAAkB,CAACjuB,GAAnB,CAAuB,IAAvB,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACE,EAAA,IAAWsvB,UAAX,GAAwB;AACtB,IAAO,OAAA,CAAC,KAAK3H,WAAb,CAAA;AACD,GAAA;;AAED,EAAA,IAAW/R,OAAX,GAAqB;AACnB,IAAA,MAAMrX,MAAM,GAAI,CAAE,EAAA,IAAA,CAAKyhB,MAAL,CAAYpK,OAAQ,CAAA,CAAA,EAAG,IAAKqK,CAAAA,KAAL,CAAWrK,OAAQ,CAA5D,CAAA,CAAA;;AACA,IAAI,IAAA;AACF,MAAQ,OAAA,CAAA,EAAErX,MAAO,CAAA,CAAA,EAAGgxB,IAAI,CAACC,SAAL,CAAe,IAAA,CAAKv1B,IAApB,CAA0B,CAA9C,CAAA,CAAA;AACD,KAFD,CAEE,OAAO6qB,KAAP,EAAc;AACd,MAAA,OAAOvmB,MAAP,CAAA;AACD,KAAA;AACF,GAAA;;AAED,EAAA,IAAWkxB,YAAX,GAA0B;AACxB,IAAQ,OAAA,CAAA,EAAE,IAAKzP,CAAAA,MAAL,CAAYpK,OAAQ,IAAG,IAAKqK,CAAAA,KAAL,CAAWrK,OAAQ,CAApD,CAAA,CAAA;AACD,GAAA;;AAEMvb,EAAAA,KAAP,CAAapB,KAAb,EAAkD;AAChD,IAAO,OAAA,IAAI8mB,SAAJ,CAAc;AACnB9lB,MAAAA,IAAI,EAAE,IAAA,CAAKA,IADQ;AAEnB+lB,MAAAA,MAAM,EAAE,IAAA,CAAKA,MAFM;AAGnBC,MAAAA,KAAK,EAAE,IAAA,CAAKA,KAHO;AAInB5jB,MAAAA,KAAK,EAAE,IAAA,CAAKA,KAJO;AAKnB,MAAGpD,GAAAA,KAAAA;AALgB,KAAd,CAAP,CAAA;AAOD,GAAA;;AAEMqB,EAAAA,GAAP,CACEhC,GADF,EAEEC,KAFF,EAGE;AACA,IAAO,OAAA,IAAA,CAAK8B,KAAL,CAAW;AAChB,MAAA,CAAC/B,GAAD,GAAOC,KAAAA;AADS,KAAX,CAAP,CAAA;AAGD,GAAA;;AAEOm3B,EAAAA,mBAAR,CAA4Bpa,QAA5B,EAAgD;AAC9C,IAAM,MAAA;AAAE0K,MAAAA,MAAF;AAAUC,MAAAA,KAAAA;AAAV,KAAoB,GAAA,IAA1B,CAD8C;;AAG9C,IAAA,IAAID,MAAM,CAAC1nB,GAAP,KAAe2nB,KAAK,CAAC3nB,GAAzB,EAA8B;AAC5B,MAAA,IAAI0nB,MAAM,CAAC9K,WAAP,EAAJ,EAA0B;AACxB,QAAA,OAAO8K,MAAM,CAACpL,IAAP,KAAgBD,SAAS,CAACa,MAAjC,CAAA;AACD,OAAA;;AACD,MAAA,IAAIyK,KAAK,CAAC/K,WAAN,EAAJ,EAAyB;AACvB,QAAA,OAAO+K,KAAK,CAACrL,IAAN,KAAeD,SAAS,CAACqB,KAAhC,CAAA;AACD,OAAA;;AACD,MAAA,OAAOgK,MAAM,CAAC5iB,MAAP,IAAiB6iB,KAAK,CAAC7iB,MAA9B,CAAA;AACD,KAX6C;;;AAc9C,IAAA,IAAI4iB,MAAM,CAAC9K,WAAP,EAAJ,EAA0B;AACxB,MAAM6Z,MAAAA,UAAU,GAAGzZ,QAAQ,CAACtN,OAAT,CAAiBgY,MAAM,CAAC1nB,GAAxB,CAAnB,CAAA;;AACA,MAAA,IAAIy2B,UAAU,EAAEz1B,SAAZ,EAAA,IAA2By1B,UAAU,CAAC/mB,OAAX,CAAmBiY,KAAK,CAAC3nB,GAAzB,CAA/B,EAA8D;AAC5D,QAAA,OAAO0nB,MAAM,CAACpL,IAAP,KAAgBD,SAAS,CAACa,MAAjC,CAAA;AACD,OAAA;AACF,KAAA;;AACD,IAAA,IAAIyK,KAAK,CAAC/K,WAAN,EAAJ,EAAyB;AACvB,MAAM8Z,MAAAA,SAAS,GAAG1Z,QAAQ,CAACtN,OAAT,CAAiBiY,KAAK,CAAC3nB,GAAvB,CAAlB,CAAA;;AACA,MAAA,IAAI02B,SAAS,EAAE11B,SAAX,EAAA,IAA0B01B,SAAS,CAAChnB,OAAV,CAAkBgY,MAAM,CAAC1nB,GAAzB,CAA9B,EAA6D;AAC3D,QAAA,OAAO2nB,KAAK,CAACrL,IAAN,KAAeD,SAAS,CAACqB,KAAhC,CAAA;AACD,OAAA;AACF,KAzB6C;;;AA4B9C,IAAA,MAAM2Z,UAAU,GAAG3P,MAAM,CAACtK,SAAP,CAAiBJ,QAAjB,CAAnB,CAAA;AACA,IAAA,MAAMsa,SAAS,GAAG3P,KAAK,CAACvK,SAAN,CAAgBJ,QAAhB,CAAlB,CAAA;AACA,IAAA,OAAO9M,OAAO,CAACmnB,UAAU,IAAIC,SAAd,IAA2BzsB,IAAI,CAACuB,QAAL,CAAcirB,UAAd,EAA0BC,SAA1B,CAA5B,CAAd,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACSrB,EAAAA,SAAP,CAAiBjZ,QAAjB,EAAqC;AACnC,IAAA,IAAI,CAAC4Y,gBAAgB,CAACxyB,GAAjB,CAAqB,IAArB,CAAL,EAAiC;AAC/BwyB,MAAAA,gBAAgB,CAAC5zB,GAAjB,CAAqB,IAArB,EAA2B,IAAIkF,OAAJ,EAA3B,CAAA,CAAA;AACD,KAAA;;AACD,IAAA,MAAMqwB,4BAA4B,GAAG3B,gBAAgB,CAACluB,GAAjB,CAAqB,IAArB,CAArC,CAAA;;AACA,IAAA,IAAI,CAAC6vB,4BAA4B,CAACn0B,GAA7B,CAAiC4Z,QAAjC,CAAL,EAAiD;AAC/Cua,MAAAA,4BAA4B,CAACv1B,GAA7B,CAAiCgb,QAAjC,EAA2C,IAAKoa,CAAAA,mBAAL,CAAyBpa,QAAzB,CAA3C,CAAA,CAAA;AACD,KAAA;;AACD,IAAA,OAAOua,4BAA4B,CAAC7vB,GAA7B,CAAiCsV,QAAjC,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACSwa,EAAAA,UAAP,CAAkBxa,QAAlB,EAAsC;AACpC,IAAA,OAAO,CAAC,IAAA,CAAKiZ,SAAL,CAAejZ,QAAf,CAAR,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACSgY,EAAAA,QAAP,CAAgBhY,QAAhB,EAAoC;AAClC,IAAO,OAAA,IAAA,CAAKiZ,SAAL,CAAejZ,QAAf,IAA2B,IAAK0K,CAAAA,MAAhC,GAAyC,IAAA,CAAKC,KAArD,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACSqO,EAAAA,MAAP,CAAchZ,QAAd,EAAkC;AAChC,IAAO,OAAA,IAAA,CAAKwa,UAAL,CAAgBxa,QAAhB,IAA4B,IAAK0K,CAAAA,MAAjC,GAA0C,IAAA,CAAKC,KAAtD,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACS8P,EAAAA,QAAP,CAAgBC,SAAhB,EAA6C1a,QAA7C,EAAiE;AAC/D,IAAI0a,IAAAA,SAAS,KAAK,OAAlB,EAA2B;AACzB,MAAA,OAAO,IAAK1C,CAAAA,QAAL,CAAchY,QAAd,CAAP,CAAA;AACD,KAFD,MAEO,IAAI0a,SAAS,KAAK,KAAlB,EAAyB;AAC9B,MAAA,OAAO,IAAK1B,CAAAA,MAAL,CAAYhZ,QAAZ,CAAP,CAAA;AACD,KAFM,MAEA;AACL,MAAO,OAAA,IAAA,CAAK0a,SAAL,CAAP,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;;;AACSC,EAAAA,IAAP,CAAY3a,QAAZ,EAAgC;AAC9B,IAAO,OAAA;AACL1U,MAAAA,KAAK,EAAE,IAAA,CAAK0sB,QAAL,CAAchY,QAAd,CADF;AAELzU,MAAAA,GAAG,EAAE,IAAKytB,CAAAA,MAAL,CAAYhZ,QAAZ,CAAA;AAFA,KAAP,CAAA;AAID,GAAA;AAED;AACF;AACA;;;AACSsS,EAAAA,mBAAP,CAA2BtS,QAA3B,EAA+C;AAC7C,IAAI,IAAA;AAAE1U,MAAAA,KAAF;AAASC,MAAAA,GAAAA;AAAT,KAAA,GAAiB,IAAKovB,CAAAA,IAAL,CAAU3a,QAAV,CAArB,CAAA;;AACA,IAAI,IAAA,IAAA,CAAKqS,WAAT,EAAsB;AACpB,MAAA,MAAMpS,KAAK,GAAG3U,KAAK,CAACyU,kBAAN,CAAyBC,QAAzB,CAAd,CAAA;AACA,MAAO,OAAA;AAAE0K,QAAAA,MAAM,EAAEzK,KAAV;AAAiB0K,QAAAA,KAAK,EAAE1K,KAAxB;AAA+B3U,QAAAA,KAAK,EAAE2U,KAAtC;AAA6C1U,QAAAA,GAAG,EAAE0U,KAAAA;AAAlD,OAAP,CAAA;AACD,KAAA;;AACD,IAAA,IAAI3U,KAAK,CAACsU,WAAN,EAAJ,EAAyB;AACvB,MAAA,IAAItU,KAAK,CAACgU,IAAN,KAAeD,SAAS,CAACa,MAA7B,EAAqC;AACnC5U,QAAAA,KAAK,GAAGA,KAAK,CAACyU,kBAAN,CAAyBC,QAAzB,CAAR,CAAA;AACD,OAFD,MAEO;AACL,QAAA,MAAM4a,SAAS,GAAG5a,QAAQ,CAACrL,WAAT,CAAqBrJ,KAAK,CAACtI,GAA3B,CAAA,IAAmCgd,QAAQ,CAAC/b,YAAT,EAArD,CAAA;AACAqH,QAAAA,KAAK,GAAG8T,SAAS,CAAC5a,MAAV,CAAiB;AACvBxB,UAAAA,GAAG,EAAE43B,SAAS,CAAC53B,GADQ;AAEvB8E,UAAAA,MAAM,EAAE,CAAA;AAFe,SAAjB,CAAR,CAAA;AAID,OAAA;AACF,KAAA;;AACD,IAAA,IAAIyD,GAAG,CAACqU,WAAJ,EAAJ,EAAuB;AACrB,MAAA,IAAIrU,GAAG,CAAC+T,IAAJ,KAAaD,SAAS,CAACqB,KAA3B,EAAkC;AAChCnV,QAAAA,GAAG,GAAGA,GAAG,CAACwU,kBAAJ,CAAuBC,QAAvB,CAAN,CAAA;AACD,OAFD,MAEO;AACL,QAAA,MAAM6a,OAAO,GAAG7a,QAAQ,CAACxL,eAAT,CAAyBjJ,GAAG,CAACvI,GAA7B,CAAA,IAAqCgd,QAAQ,CAAC5b,WAAT,EAArD,CAAA;AACAmH,QAAAA,GAAG,GAAG6T,SAAS,CAAC5a,MAAV,CAAiB;AACrBxB,UAAAA,GAAG,EAAE63B,OAAO,CAAC73B,GADQ;AAErB8E,UAAAA,MAAM,EAAE+yB,OAAO,CAAC/zB,IAAR,CAAa3C,MAAAA;AAFA,SAAjB,CAAN,CAAA;AAID,OAAA;AACF,KAAA;;AACD,IAAA,MAAM80B,SAAS,GAAG,IAAA,CAAKA,SAAL,CAAejZ,QAAf,CAAlB,CAAA;AACA,IAAA,MAAM0K,MAAM,GAAGuO,SAAS,GAAG3tB,KAAH,GAAWC,GAAnC,CAAA;AACA,IAAA,MAAMof,KAAK,GAAGsO,SAAS,GAAG1tB,GAAH,GAASD,KAAhC,CAAA;AACA,IAAO,OAAA;AAAEof,MAAAA,MAAF;AAAUC,MAAAA,KAAV;AAAiBrf,MAAAA,KAAjB;AAAwBC,MAAAA,GAAAA;AAAxB,KAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;;;AACSuvB,EAAAA,cAAP,CAAsB9a,QAAtB,EAA0C;AACxC,IAAM,MAAA;AAAE1U,MAAAA,KAAF;AAASC,MAAAA,GAAAA;AAAT,KAAA,GAAiB,IAAK+mB,CAAAA,mBAAL,CAAyBtS,QAAzB,CAAvB,CAAA;AACA,IAAMzI,MAAAA,KAAK,GAAGyI,QAAQ,CAAChN,OAAT,CAAiB1H,KAAK,CAACtI,GAAvB,CAAd,CAAA;AACA,IAAMwU,MAAAA,KAAK,GAAGwI,QAAQ,CAAChN,OAAT,CAAiBzH,GAAG,CAACvI,GAArB,CAAd,CAAA;;AACA,IAAA,IAAI,CAACuU,KAAD,IAAU,CAACC,KAAf,EAAsB;AACpB,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,MAAMnV,IAAI,GAAG2d,QAAQ,CAACnN,aAAT,CAAuBhF,IAAI,CAACqC,MAAL,CAAYqH,KAAZ,EAAmBC,KAAnB,CAAvB,CAAb,CAAA;;AACA,IAAA,IAAInV,IAAI,EAAE0B,MAAN,EAAJ,EAAoB;AAClB,MAAA,OAAOic,QAAQ,CAAC/K,eAAT,CAAyB5S,IAAI,CAACW,GAA9B,CAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAOX,IAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACE,EAAA,IAAW4xB,SAAX,GAAuB;AACrB,IAAA,OAAO/gB,OAAO,CAAC,IAAA,CAAKvO,IAAL,CAAUsvB,SAAX,CAAd,CAAA;AACD,GAAA;;AAED,EAAA,IAAW8G,iBAAX,GAA+B;AAC7B,IAAA,OAAO,KAAK1I,WAAL,IAAoB,KAAK3H,MAAL,CAAY9K,WAAZ,EAA3B,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACS0Y,EAAAA,UAAP,CAAkBrE,SAAlB,EAAsC;AACpC,IAAA,IAAI,KAAKtvB,IAAL,CAAUsvB,SAAV,KAAwBA,SAA5B,EAAuC;AACrC,MAAO,OAAA,IAAA,CAAKlvB,KAAL,CAAW;AAChBJ,QAAAA,IAAI,EAAE,EACJ,GAAG,KAAKA,IADJ;AAEJsvB,UAAAA,SAAAA;AAFI,SAAA;AADU,OAAX,CAAP,CAAA;AAMD,KAAA;;AACD,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACS+G,EAAAA,SAAP,CAAiBhb,QAAjB,EAAqC;AACnC,IAAA,IAAI,IAAKwa,CAAAA,UAAL,CAAgBxa,QAAhB,CAAJ,EAA+B;AAC7B,MAAO,OAAA,IAAA,CAAKjb,KAAL,CAAW;AAChB4lB,QAAAA,KAAK,EAAE,IAAKqO,CAAAA,MAAL,CAAYhZ,QAAZ,CAAA;AADS,OAAX,CAAP,CAAA;AAGD,KAAA;;AACD,IAAO,OAAA,IAAA,CAAKjb,KAAL,CAAW;AAChB2lB,MAAAA,MAAM,EAAE,IAAKsO,CAAAA,MAAL,CAAYhZ,QAAZ,CAAA;AADQ,KAAX,CAAP,CAAA;AAGD,GAAA;;AAEMib,EAAAA,sBAAP,CAA8B54B,IAA9B,EAA0C0Y,UAA1C,EAAkE;AAChE,IAAM,MAAA;AAAEiF,MAAAA,QAAAA;AAAF,KAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;;AACA,IAAA,IAAI,IAAKg2B,CAAAA,SAAL,CAAejZ,QAAf,CAAJ,EAA8B;AAC5B,MAAA,OAAO,KAAKkb,uBAAL,CAA6B74B,IAA7B,EAAmC0Y,UAAnC,CAAP,CAAA;AACD,KAFD,MAEO;AACL,MAAA,OAAO,KAAKogB,sBAAL,CAA4B94B,IAA5B,EAAkC0Y,UAAlC,CAAP,CAAA;AACD,KAAA;AACF,GAAA;;AAEMqgB,EAAAA,oBAAP,CAA4B/4B,IAA5B,EAAwC0Y,UAAxC,EAAgE;AAC9D,IAAM,MAAA;AAAEiF,MAAAA,QAAAA;AAAF,KAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;;AACA,IAAA,IAAI,IAAKg2B,CAAAA,SAAL,CAAejZ,QAAf,CAAJ,EAA8B;AAC5B,MAAA,OAAO,KAAKqb,qBAAL,CAA2Bh5B,IAA3B,EAAiC0Y,UAAjC,CAAP,CAAA;AACD,KAFD,MAEO;AACL,MAAA,OAAO,KAAKugB,oBAAL,CAA0Bj5B,IAA1B,EAAgC0Y,UAAhC,CAAP,CAAA;AACD,KAAA;AACF,GAAA;;AAEMwgB,EAAAA,oBAAP,CAA4Bl5B,IAA5B,EAAwC0Y,UAAxC,EAAgE;AAC9D,IAAM,MAAA;AAAEiF,MAAAA,QAAAA;AAAF,KAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;;AACA,IAAA,IAAI,IAAKg2B,CAAAA,SAAL,CAAejZ,QAAf,CAAJ,EAA8B;AAC5B,MAAA,OAAO,KAAKmb,sBAAL,CAA4B94B,IAA5B,EAAkC0Y,UAAlC,CAAP,CAAA;AACD,KAFD,MAEO;AACL,MAAA,OAAO,KAAKmgB,uBAAL,CAA6B74B,IAA7B,EAAmC0Y,UAAnC,CAAP,CAAA;AACD,KAAA;AACF,GAAA;;AAEMygB,EAAAA,kBAAP,CAA0Bn5B,IAA1B,EAAsC0Y,UAAtC,EAA8D;AAC5D,IAAM,MAAA;AAAEiF,MAAAA,QAAAA;AAAF,KAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;;AACA,IAAA,IAAI,IAAKg2B,CAAAA,SAAL,CAAejZ,QAAf,CAAJ,EAA8B;AAC5B,MAAA,OAAO,KAAKsb,oBAAL,CAA0Bj5B,IAA1B,EAAgC0Y,UAAhC,CAAP,CAAA;AACD,KAFD,MAEO;AACL,MAAA,OAAO,KAAKsgB,qBAAL,CAA2Bh5B,IAA3B,EAAiC0Y,UAAjC,CAAP,CAAA;AACD,KAAA;AACF,GAAA;;AAEMmgB,EAAAA,uBAAP,CAA+B74B,IAA/B,EAA2C0Y,UAA3C,EAAmE;AACjE,IAAA,OAAO,IAAK/V,CAAAA,GAAL,CAAS,QAAT,EAAmB+V,UAAU,CAACoa,KAAX,CAAiByB,kBAAjB,EAAqCv0B,IAArC,CAAnB,CAAP,CAAA;AACD,GAAA;;AAEMg5B,EAAAA,qBAAP,CAA6Bh5B,IAA7B,EAAyC0Y,UAAzC,EAAiE;AAC/D,IAAA,OAAO,IAAK/V,CAAAA,GAAL,CAAS,QAAT,EAAmB+V,UAAU,CAACoa,KAAX,CAAiB0B,gBAAjB,EAAmCx0B,IAAnC,CAAnB,CAAP,CAAA;AACD,GAAA;;AAEM84B,EAAAA,sBAAP,CAA8B94B,IAA9B,EAA0C0Y,UAA1C,EAAkE;AAChE,IAAA,OAAO,IAAK/V,CAAAA,GAAL,CAAS,OAAT,EAAkB+V,UAAU,CAACoa,KAAX,CAAiByB,kBAAjB,EAAqCv0B,IAArC,CAAlB,CAAP,CAAA;AACD,GAAA;;AAEMi5B,EAAAA,oBAAP,CAA4Bj5B,IAA5B,EAAwC0Y,UAAxC,EAAgE;AAC9D,IAAA,OAAO,IAAK/V,CAAAA,GAAL,CAAS,OAAT,EAAkB+V,UAAU,CAACoa,KAAX,CAAiB0B,gBAAjB,EAAmCx0B,IAAnC,CAAlB,CAAP,CAAA;AACD,GAAA;;AAEM+1B,EAAAA,YAAP,CAAoBp1B,GAApB,EAAiCmO,KAAjC,EAA4D;AAC1D,IAAA,OAAO,IAAKnM,CAAAA,GAAL,CAAS,QAAT,EAAmBka,KAAK,CAACC,gBAAN,CAAuBnc,GAAvB,EAA4BmO,KAA5B,CAAnB,CAAP,CAAA;AACD,GAAA;;AAEMsqB,EAAAA,WAAP,CAAmBz4B,GAAnB,EAAgCmO,KAAhC,EAA2D;AACzD,IAAA,OAAO,IAAKnM,CAAAA,GAAL,CAAS,OAAT,EAAkBka,KAAK,CAACC,gBAAN,CAAuBnc,GAAvB,EAA4BmO,KAA5B,CAAlB,CAAP,CAAA;AACD,GAAA;;AAEMoO,EAAAA,iBAAP,CAAyBld,IAAzB,EAAqC0Y,UAArC,EAA6D;AAC3D,IAAM2P,MAAAA,MAAM,GAAG3P,UAAU,CAACoa,KAAX,CAAiByB,kBAAjB,EAAqCv0B,IAArC,CAAf,CAAA;AACA,IAAMsoB,MAAAA,KAAK,GAAGD,MAAd,CAAA;AACA,IAAO,OAAA,IAAA,CAAK3lB,KAAL,CAAW;AAAE2lB,MAAAA,MAAF;AAAUC,MAAAA,KAAAA;AAAV,KAAX,CAAP,CAAA;AACD,GAAA;;AAEMlL,EAAAA,eAAP,CAAuBpd,IAAvB,EAAmC0Y,UAAnC,EAA2D;AACzD,IAAM2P,MAAAA,MAAM,GAAG3P,UAAU,CAACoa,KAAX,CAAiB0B,gBAAjB,EAAmCx0B,IAAnC,CAAf,CAAA;AACA,IAAMsoB,MAAAA,KAAK,GAAGD,MAAd,CAAA;AACA,IAAO,OAAA,IAAA,CAAK3lB,KAAL,CAAW;AAAE2lB,MAAAA,MAAF;AAAUC,MAAAA,KAAAA;AAAV,KAAX,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACS+Q,EAAAA,IAAP,GAAc;AACZ,IAAO,OAAA,IAAA,CAAK32B,KAAL,CAAW;AAChB2lB,MAAAA,MAAM,EAAE,IAAA,CAAKC,KADG;AAEhBA,MAAAA,KAAK,EAAE,IAAKD,CAAAA,MAAAA;AAFI,KAAX,CAAP,CAAA;AAID,GAAA;;AAEMiR,EAAAA,kBAAP,CAA0BhtB,CAAC,GAAG,CAA9B,EAAiCitB,KAAjC,EAA4D;AAC1D,IAAOA,OAAAA,KAAK,GACRA,KAAK,CAAC,QAAD,EAAWjtB,CAAX,CAAL,CAAmB,IAAnB,CADQ,GAER,KAAK3J,GAAL,CAAS,QAAT,EAAmB,IAAK0lB,CAAAA,MAAL,CAAY7K,YAAZ,CAAyBlR,CAAzB,CAAnB,CAFJ,CAAA;AAGD,GAAA;;AAEMktB,EAAAA,iBAAP,CAAyBltB,CAAC,GAAG,CAA7B,EAAgCitB,KAAhC,EAA2D;AACzD,IAAOA,OAAAA,KAAK,GACRA,KAAK,CAAC,QAAD,EAAWjtB,CAAX,CAAL,CAAmB,IAAnB,CADQ,GAER,KAAK3J,GAAL,CAAS,QAAT,EAAmB,IAAK0lB,CAAAA,MAAL,CAAY5K,WAAZ,CAAwBnR,CAAxB,CAAnB,CAFJ,CAAA;AAGD,GAAA;;AAEMmtB,EAAAA,iBAAP,CAAyBntB,CAAC,GAAG,CAA7B,EAAgCitB,KAAhC,EAA2D;AACzD,IAAOA,OAAAA,KAAK,GACRA,KAAK,CAAC,OAAD,EAAUjtB,CAAV,CAAL,CAAkB,IAAlB,CADQ,GAER,KAAK3J,GAAL,CAAS,OAAT,EAAkB,IAAK2lB,CAAAA,KAAL,CAAW9K,YAAX,CAAwBlR,CAAxB,CAAlB,CAFJ,CAAA;AAGD,GAAA;;AAEMotB,EAAAA,gBAAP,CAAwBptB,CAAC,GAAG,CAA5B,EAA+BitB,KAA/B,EAA0D;AACxD,IAAOA,OAAAA,KAAK,GACRA,KAAK,CAAC,OAAD,EAAUjtB,CAAV,CAAL,CAAkB,IAAlB,CADQ,GAER,KAAK3J,GAAL,CAAS,OAAT,EAAkB,IAAK2lB,CAAAA,KAAL,CAAW7K,WAAX,CAAuBnR,CAAvB,CAAlB,CAFJ,CAAA;AAGD,GAAA;;AAEMqtB,EAAAA,WAAP,GAAqB;AACnB,IAAA,OAAO,KAAKh3B,GAAL,CAAS,QAAT,EAAmB,IAAA,CAAK2lB,KAAxB,CAAP,CAAA;AACD,GAAA;;AAEM0N,EAAAA,YAAP,GAAsB;AACpB,IAAA,OAAO,KAAKrzB,GAAL,CAAS,OAAT,EAAkB,IAAA,CAAK0lB,MAAvB,CAAP,CAAA;AACD,GAAA;;AAEMuR,EAAAA,WAAP,CAAmBjc,QAAnB,EAAuC;AACrC,IAAA,MAAM1U,KAAK,GAAG,IAAA,CAAK0sB,QAAL,CAAchY,QAAd,CAAd,CAAA;AACA,IAAO,OAAA,IAAA,CAAKjb,KAAL,CAAW;AAChB2lB,MAAAA,MAAM,EAAEpf,KADQ;AAEhBqf,MAAAA,KAAK,EAAErf,KAAAA;AAFS,KAAX,CAAP,CAAA;AAID,GAAA;;AAEM4wB,EAAAA,iBAAP,CAAyB75B,IAAzB,EAAqC0Y,UAArC,EAA6D;AAC3D,IAAA,OAAO,IAAKmgB,CAAAA,uBAAL,CAA6B74B,IAA7B,EAAmC0Y,UAAnC,CAA+CugB,CAAAA,oBAA/C,CACLj5B,IADK,EAEL0Y,UAFK,CAAP,CAAA;AAID,GAAA;;AAEM+E,EAAAA,WAAP,CAAmBnR,CAAC,GAAG,CAAvB,EAA0BitB,KAA1B,EAAqD;AACnD,IAAI,IAAA,CAACA,KAAL,EAAY;AACV,MAAA,OAAO,IAAKO,CAAAA,YAAL,CAAmBlc,KAAD,IAAkC;AACzD,QAAOA,OAAAA,KAAK,CAACN,WAAN,EAAsBM,GAAAA,KAAK,CAACH,WAAN,CAAkBnR,CAAlB,CAAtB,GAA6CsR,KAApD,CAAA;AACD,OAFM,CAAP,CAAA;AAGD,KAAA;;AACD,IAAA,OAAO,IAAK4b,CAAAA,iBAAL,CAAuBltB,CAAvB,EAA0BitB,KAA1B,CAAiCG,CAAAA,gBAAjC,CAAkDptB,CAAlD,EAAqDitB,KAArD,CAAP,CAAA;AACD,GAAA;;AAEMQ,EAAAA,iBAAP,CAAyBpc,QAAzB,EAA6CrR,CAA7C,EAAwD;AACtD,IAAA,IAAI,IAAKsqB,CAAAA,SAAL,CAAejZ,QAAf,CAAJ,EAA8B;AAC5B,MAAA,OAAO,IAAK2b,CAAAA,kBAAL,CAAwBhtB,CAAxB,CAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,IAAKmtB,CAAAA,iBAAL,CAAuBntB,CAAvB,CAAP,CAAA;AACD,GAAA;;AAEM0tB,EAAAA,gBAAP,CAAwBrc,QAAxB,EAA4CrR,CAA5C,EAAuD;AACrD,IAAA,OAAO,KAAKytB,iBAAL,CAAuBpc,QAAvB,EAAiC,CAACrR,CAAlC,CAAP,CAAA;AACD,GAAA;;AAEM2tB,EAAAA,eAAP,CAAuBtc,QAAvB,EAA2CrR,CAA3C,EAAsD;AACpD,IAAA,IAAI,IAAKsqB,CAAAA,SAAL,CAAejZ,QAAf,CAAJ,EAA8B;AAC5B,MAAA,OAAO,IAAK8b,CAAAA,iBAAL,CAAuBntB,CAAvB,CAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,IAAKgtB,CAAAA,kBAAL,CAAwBhtB,CAAxB,CAAP,CAAA;AACD,GAAA;;AAEM4tB,EAAAA,cAAP,CAAsBvc,QAAtB,EAA0CrR,CAA1C,EAAqD;AACnD,IAAA,OAAO,KAAK2tB,eAAL,CAAqBtc,QAArB,EAA+B,CAACrR,CAAhC,CAAP,CAAA;AACD,GAAA;;AAEMkR,EAAAA,YAAP,CAAoBlR,CAAC,GAAG,CAAxB,EAA2BitB,KAA3B,EAAsD;AACpD,IAAI,IAAA,CAACA,KAAL,EAAY;AACV,MAAA,OAAO,IAAKO,CAAAA,YAAL,CAAmBlc,KAAD,IAAkC;AACzD,QAAOA,OAAAA,KAAK,CAACN,WAAN,EAAsBM,GAAAA,KAAK,CAACJ,YAAN,CAAmBlR,CAAnB,CAAtB,GAA8CsR,KAArD,CAAA;AACD,OAFM,CAAP,CAAA;AAGD,KAAA;;AACD,IAAA,OAAO,IAAK0b,CAAAA,kBAAL,CAAwBhtB,CAAxB,EAA2BitB,KAA3B,CAAkCE,CAAAA,iBAAlC,CAAoDntB,CAApD,EAAuDitB,KAAvD,CAAP,CAAA;AACD,GAAA;;AAEMY,EAAAA,IAAP,CAAYZ,KAAZ,EAA0B;AACxB,IAAOA,OAAAA,KAAK,CAAC,IAAD,CAAZ,CAAA;AACD,GAAA;;AAEM3D,EAAAA,qBAAP,CAA6Bld,UAA7B,EAAqD;AACnD,IAAO,OAAA,IAAA,CAAKwE,iBAAL,CAAuBxE,UAAU,CAAC9X,KAAX,CAAiB+c,QAAxC,EAAkDjF,UAAlD,CAAP,CAAA;AACD,GAAA;;AAEM0d,EAAAA,mBAAP,CAA2B1d,UAA3B,EAAmD;AACjD,IAAO,OAAA,IAAA,CAAK0E,eAAL,CAAqB1E,UAAU,CAAC9X,KAAX,CAAiB+c,QAAtC,EAAgDjF,UAAhD,CAAP,CAAA;AACD,GAAA;;AAEM0hB,EAAAA,kBAAP,CACE1hB,UADF,EAEE2f,SAFF,EAGEpb,IAHF,EAIEja,KAJF,EAKE;AACA,IAAM,MAAA;AAAE2a,MAAAA,QAAAA;AAAF,KAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;AACA,IAAA,MAAMy5B,KAAK,GAAGhC,SAAS,CAAC90B,KAAV,CAAgB,CAAhB,EAAmB,CAAnB,CAAA,CAAsB+2B,WAAtB,EAAsCjC,GAAAA,SAAS,CAAC90B,KAAV,CAAgB,CAAhB,CAApD,CAAA;AACA,IAAA,MAAMg3B,IAAI,GAAGtd,IAAI,CAAC1Z,KAAL,CAAW,CAAX,EAAc,CAAd,CAAA,CAAiB+2B,WAAjB,EAAiCrd,GAAAA,IAAI,CAAC1Z,KAAL,CAAW,CAAX,CAA9C,CAAA;AACA,IAAA,MAAMhD,MAAM,GAAGyC,KAAK,CAACO,KAAN,CAAY,CAAZ,EAAe,CAAf,CAAA,CAAkB+2B,WAAlB,EAAkCt3B,GAAAA,KAAK,CAACO,KAAN,CAAY,CAAZ,CAAjD,CAAA;AACA,IAAA,MAAM6L,MAAM,GAAI,CAAA,IAAA,EAAMirB,KAAM,CAAA,EAAA,EAAIE,IAAK,CAArC,MAAA,CAAA,CAAA;AACA,IAAMlqB,MAAAA,OAAO,GAAGrN,KAAK,KAAK,MAAV,GAAmB,SAAnB,GAAgC,CAAYzC,UAAAA,EAAAA,MAAO,CAAnE,CAAA,CAAA;AACA,IAAMsM,MAAAA,CAAC,GAAG,IAAKurB,CAAAA,QAAL,CAAcC,SAAd,EAAyB1a,QAAzB,CAAV,CAAA;AACA,IAAM3d,MAAAA,IAAI,GAAG6M,CAAC,CAACyQ,WAAF,EAAkBK,GAAAA,QAAQ,CAACtN,OAAD,CAAR,CAAkBxD,CAAC,CAAClM,GAApB,CAAlB,GAA6Cgd,QAAQ,CAACtN,OAAT,CAAiBxD,CAAC,CAAClM,GAAnB,CAA1D,CAAA;;AACA,IAAI,IAAA,CAACX,IAAL,EAAW;AACT,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAMw6B,MAAAA,YAAY,GAAG,IAAKprB,CAAAA,MAAL,EAAapP,IAAb,EAAmB0Y,UAAnB,CAArB,CAAA;AACA,IAAA,OAAO8hB,YAAP,CAAA;AACD,GAAA;;AAEMC,EAAAA,sBAAP,CACE/hB,UADF,EAEE2f,SAFF,EAGEpb,IAHF,EAIEyd,IAJF,EAKE13B,KALF,EAME;AACA,IAAM,MAAA;AAAE2a,MAAAA,QAAAA;AAAF,KAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;AACA,IAAA,MAAMy5B,KAAK,GAAGhC,SAAS,CAAC90B,KAAV,CAAgB,CAAhB,EAAmB,CAAnB,CAAA,CAAsB+2B,WAAtB,EAAsCjC,GAAAA,SAAS,CAAC90B,KAAV,CAAgB,CAAhB,CAApD,CAAA;AACA,IAAA,MAAMg3B,IAAI,GAAGtd,IAAI,CAAC1Z,KAAL,CAAW,CAAX,EAAc,CAAd,CAAA,CAAiB+2B,WAAjB,EAAiCrd,GAAAA,IAAI,CAAC1Z,KAAL,CAAW,CAAX,CAA9C,CAAA;AACA,IAAA,MAAMo3B,IAAI,GAAGD,IAAI,CAACn3B,KAAL,CAAW,CAAX,EAAc,CAAd,CAAA,CAAiB+2B,WAAjB,EAAiCI,GAAAA,IAAI,CAACn3B,KAAL,CAAW,CAAX,CAA9C,CAAA;AACA,IAAA,MAAMq3B,KAAK,GAAG53B,KAAK,CAACO,KAAN,CAAY,CAAZ,EAAe,CAAf,CAAA,CAAkB+2B,WAAlB,EAAkCt3B,GAAAA,KAAK,CAACO,KAAN,CAAY,CAAZ,CAAhD,CAAA;AACA,IAAA,MAAM6L,MAAM,GAAI,CAAA,IAAA,EAAMirB,KAAM,CAAA,EAAA,EAAIE,IAAK,CAArC,MAAA,CAAA,CAAA;AACA,IAAMlqB,MAAAA,OAAO,GAAGrN,KAAK,KAAK,MAAV,GAAmB,SAAnB,GAAgC,CAAY43B,UAAAA,EAAAA,KAAM,CAAlE,CAAA,CAAA;AACA,IAAA,MAAMC,gBAAgB,GAAI,CAAA,GAAA,EAAKF,IAAK,CAAA,EAAEC,KAAM,CAA5C,CAAA,CAAA;AACA,IAAM/tB,MAAAA,CAAC,GAAG,IAAKurB,CAAAA,QAAL,CAAcC,SAAd,EAAyB1a,QAAzB,CAAV,CAAA;AAEA,IAAM3d,MAAAA,IAAI,GAAG2d,QAAQ,CAACtN,OAAD,CAAR,CAAkBxD,CAAC,CAAClM,GAApB,CAAb,CAAA;;AACA,IAAI,IAAA,CAACX,IAAL,EAAW;AACT,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAM2L,MAAAA,MAAM,GAAGgS,QAAQ,CAACkd,gBAAD,CAAR,CAA2B76B,IAAI,CAACW,GAAhC,CAAf,CAAA;;AACA,IAAI,IAAA,CAACgL,MAAL,EAAa;AACX,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAM6uB,MAAAA,YAAY,GAAG,IAAKprB,CAAAA,MAAL,EAAazD,MAAb,EAAqB+M,UAArB,CAArB,CAAA;AACA,IAAA,OAAO8hB,YAAP,CAAA;AACD,GAAA;;AAEMV,EAAAA,YAAP,CACEgB,OADF,EAEE;AACA,IAAI,IAAA;AAAEzS,MAAAA,MAAF;AAAUC,MAAAA,KAAAA;AAAV,KAAA,GAAoB,IAAxB,CAAA;AACAD,IAAAA,MAAM,GAAGyS,OAAO,CAACzS,MAAD,CAAhB,CAAA;AACAC,IAAAA,KAAK,GAAGwS,OAAO,CAACxS,KAAD,CAAf,CAAA;AACA,IAAO,OAAA,IAAA,CAAK5lB,KAAL,CAAW;AAAE2lB,MAAAA,MAAF;AAAUC,MAAAA,KAAAA;AAAV,KAAX,CAAP,CAAA;AACD,GAAA;;AAEMvlB,EAAAA,MAAP,CAAcqF,OAAd,EAA0C;AACxC,IAAO,OAAA;AACLpF,MAAAA,KAAK,EAAE,WADF;AAELqlB,MAAAA,MAAM,EAAE,IAAKA,CAAAA,MAAL,CAAYtlB,MAAZ,CAAmBqF,OAAnB,CAFH;AAGLkgB,MAAAA,KAAK,EAAE,IAAKA,CAAAA,KAAL,CAAWvlB,MAAX,CAAkBqF,OAAlB,CAHF;AAIL1D,MAAAA,KAAK,EAAE,IAAA,CAAKA,KAAL,GAAa,KAAKA,KAAL,CAAWC,GAAX,CAAe4B,CAAC,IAAIA,CAAC,CAACxD,MAAF,EAApB,CAAb,GAA+C,IAAA;AAJjD,KAAP,CAAA;AAMD,GAAA;;AAjoBsC;;AC7EzC;AACA;AACA;AACA;AA4Be,MAAMg4B,QAAN,SAAuBt5B,SAAvB,CAA+B;AAC5C,EAAA,OAAOU,MAAP,CAAcb,KAAoC,GAAG,EAArD,EAAmE;AACjE,IAAA,IAAIy5B,QAAQ,CAACC,UAAT,CAAoB15B,KAApB,CAAJ,EAAgC;AAC9B,MAAA,OAAOA,KAAP,CAAA;AACD,KAAA;;AAED,IAAA,IAAIH,iCAAa,CAACG,KAAD,CAAjB,EAA0B;AACxB,MAAM,MAAA;AACJX,QAAAA,GAAG,GAAGgG,QAAQ,CAACxE,MAAT,EADF;AAEJG,QAAAA,IAAI,GAAG,EAFH;AAGJT,QAAAA,KAAK,GAAG,EAAA;AAHJ,OAAA,GAIFP,KAJJ,CAAA;AAKA,MAAO,OAAA,IAAIy5B,QAAJ,CAAa;AAClBp6B,QAAAA,GADkB;AAElB2B,QAAAA,IAFkB;AAGlBT,QAAAA,KAAAA;AAHkB,OAAb,CAAP,CAAA;AAKD,KAAA;;AAED,IAAA,MAAM,IAAIT,KAAJ,CACH,CAA4EE,0EAAAA,EAAAA,KAAM,EAD/E,CAAN,CAAA;AAGD,GAAA;;AAED,EAAOiB,OAAAA,QAAP,CAAgBC,IAAhB,EAAoC;AAClC,IAAA,OAAOu4B,QAAQ,CAAC54B,MAAT,CAAgB,EACrB,GAAGK,IADkB;AAErBX,MAAAA,KAAK,EAAEW,IAAI,CAACX,KAAL,GAAaW,IAAI,CAACX,KAAL,CAAW8C,GAAX,CAAeqL,KAAK,CAACzN,QAArB,CAAb,GAA8C,EAAA;AAFhC,KAAhB,CAAP,CAAA;AAID,GAAA;;AAED,EAAOy4B,OAAAA,UAAP,CAAkBC,aAAlB,EAAiE;AAC/D,IAAOA,OAAAA,aAAa,YAAYF,QAAhC,CAAA;AACD,GAAA;;AAES15B,EAAAA,WAAV,CAAsBC,KAAtB,EAA2D;AACzD,IAAA,KAAA,CAAMA,KAAN,CAAA,CAAA;AADyD,IAM3CJ,IAAAA,CAAAA,IAN2C,GAM5B,UAN4B,CAAA;AAAA,IAAA,IAAA,CAQ3CW,KAR2C,GAAA,KAAA,CAAA,CAAA;AAEzD,IAAM,MAAA;AAAEA,MAAAA,KAAAA;AAAF,KAAA,GAAYP,KAAlB,CAAA;AACA,IAAKO,IAAAA,CAAAA,KAAL,GAAaA,KAAb,CAAA;AACD,GAAA;;AAMMa,EAAAA,KAAP,CAAapB,KAAb,EAAiD;AAC/C,IAAO,OAAA,IAAIy5B,QAAJ,CAAa;AAClBp6B,MAAAA,GAAG,EAAE,IAAA,CAAKA,GADQ;AAElB2B,MAAAA,IAAI,EAAE,IAAA,CAAKA,IAFO;AAGlBT,MAAAA,KAAK,EAAE,IAAA,CAAKA,KAHM;AAIlB,MAAGP,GAAAA,KAAAA;AAJe,KAAb,CAAP,CAAA;AAMD,GAAA;;AAEMqB,EAAAA,GAAP,CACEhC,GADF,EAEEC,KAFF,EAGE;AACA,IAAO,OAAA,IAAA,CAAK8B,KAAL,CAAW;AAChB,MAAA,CAAC/B,GAAD,GAAOC,KAAAA;AADS,KAAX,CAAP,CAAA;AAGD,GAAA;AAED;AACF;AACA;;;AACSs6B,EAAAA,eAAP,CAAuBpO,KAAvB,EAAyC;AACvC,IAAIA,IAAAA,KAAK,CAACkD,WAAN,IAAqBlD,KAAK,CAACzE,MAAN,CAAa9K,WAAb,EAAzB,EAAqD;AACnD,MAAA,OAAO,EAAP,CAAA;AACD,KAAA;;AACD,IAAM,MAAA;AAAEtU,MAAAA,KAAF;AAASC,MAAAA,GAAAA;AAAT,KAAA,GAAiB4jB,KAAK,CAACmD,mBAAN,CAA0B,IAA1B,CAAvB,CAAA;;AACA,IAAInD,IAAAA,KAAK,CAACkD,WAAV,EAAuB;AACrB,MAAO,OAAA,IAAA,CAAKmL,kBAAL,CAAwBlyB,KAAK,CAACtI,GAA9B,EAAmCsI,KAAK,CAACxD,MAAzC,CAAP,CAAA;AACD,KAAA;;AAED,IAAA,IAAIwD,KAAK,CAACtI,GAAN,KAAcuI,GAAG,CAACvI,GAAtB,EAA2B;AACzB,MAAM4U,MAAAA,SAAS,GAAG,IAAKlF,CAAAA,OAAL,CAAapH,KAAK,CAACtI,GAAnB,CAAlB,CAAA;AACA,MAAA,OAAOa,MAAI,CAACE,MAAL,CAAY6T,SAAZ,CAAA,GACHA,SAAS,CAACzL,sBAAV,CAAiCb,KAAK,CAACxD,MAAvC,EAA+CyD,GAAG,CAACzD,MAAnD,CADG,GAEH,EAFJ,CAAA;AAGD,KAAA;;AAED,IAAA,MAAMgQ,KAAK,GAAG,IAAKL,CAAAA,wBAAL,CAA8BnM,KAAK,CAACtI,GAApC,EAAyCuI,GAAG,CAACvI,GAA7C,CAAd,CAAA;AACA,IAAO8U,OAAAA,KAAK,CAACtR,MAAN,CAAqB,CAACO,KAAD,EAAQD,IAAR,KAAiB;AAC3C,MAAA,IAAIA,IAAI,CAAC9D,GAAL,KAAasI,KAAK,CAACtI,GAAvB,EAA4B;AAC1B,QAAOgJ,OAAAA,QAAQ,CAAC1F,KAAT,CACLS,KADK,EAELD,IAAI,CAACqF,sBAAL,CAA4Bb,KAAK,CAACxD,MAAlC,EAA0ChB,IAAI,CAACA,IAAL,CAAU3C,MAApD,CAFK,CAAP,CAAA;AAID,OAAA;;AACD,MAAA,IAAI2C,IAAI,CAAC9D,GAAL,KAAauI,GAAG,CAACvI,GAArB,EAA0B;AACxB,QAAA,OAAOgJ,QAAQ,CAAC1F,KAAT,CACLS,KADK,EAELD,IAAI,CAACqF,sBAAL,CAA4B,CAA5B,EAA+BZ,GAAG,CAACzD,MAAnC,CAFK,CAAP,CAAA;AAID,OAAA;;AACD,MAAOkE,OAAAA,QAAQ,CAAC1F,KAAT,CAAeS,KAAf,EAAsBD,IAAI,CAAC+D,QAAL,EAAtB,CAAP,CAAA;AACD,KAdM,EAcJ,EAdI,CAAP,CAAA;AAeD,GAAA;AAED;AACF;AACA;;;AACS4yB,EAAAA,qBAAP,CAA6BtO,KAA7B,EAA+C;AAC7C,IAAIA,IAAAA,KAAK,CAACkD,WAAN,IAAqBlD,KAAK,CAACzE,MAAN,CAAa9K,WAAb,EAAzB,EAAqD;AACnD,MAAA,OAAO,EAAP,CAAA;AACD,KAAA;;AACD,IAAI,IAAA,CAAC6K,SAAS,CAAC+O,gBAAV,CAA2B,IAA3B,EAAiCrK,KAAjC,CAAL,EAA8C;AAC5C,MAAA,OAAO,EAAP,CAAA;AACD,KAAA;;AACD,IAAM,MAAA;AAAE7jB,MAAAA,KAAF;AAASC,MAAAA,GAAAA;AAAT,KAAA,GAAiB4jB,KAAK,CAACmD,mBAAN,CAA0B,IAA1B,CAAvB,CAAA;;AACA,IAAInD,IAAAA,KAAK,CAACkD,WAAV,EAAuB;AACrB,MAAO,OAAA,IAAA,CAAKmL,kBAAL,CAAwBlyB,KAAK,CAACtI,GAA9B,EAAmCsI,KAAK,CAACxD,MAAzC,CAAP,CAAA;AACD,KAAA;;AAED,IAAM8yB,MAAAA,SAAS,GAAG,IAAKloB,CAAAA,OAAL,CAAapH,KAAK,CAACtI,GAAnB,CAAlB,CAAA;AACA,IAAI4U,IAAAA,SAAS,GAAGgjB,SAAS,EAAE72B,MAAX,EAAsB62B,GAAAA,SAAtB,GAAkC,IAAlD,CAAA;;AACA,IAAI,IAAA,CAAChjB,SAAL,EAAgB;AACd,MAAA,OAAO,EAAP,CAAA;AACD,KAAA;;AAED,IAAA,IAAIF,QAAQ,GAAGpM,KAAK,CAACtI,GAArB,CAAA;AACA,IAAA,IAAIkF,WAAW,GAAGoD,KAAK,CAACxD,MAAxB,CAAA;AACA,IAAA,IAAI6P,MAAM,GAAGpM,GAAG,CAACvI,GAAjB,CAAA;AACA,IAAA,IAAI+E,SAAS,GAAGwD,GAAG,CAACzD,MAApB,CAAA;;AAEA,IAAI4P,IAAAA,QAAQ,KAAKC,MAAjB,EAAyB;AACvB,MAAA,OAAOC,SAAS,CAACrL,4BAAV,CAAuCrE,WAAvC,EAAoDH,SAApD,CAAP,CAAA;AACD,KAAA;;AAED,IAAA,OAAO2P,QAAQ,KAAKC,MAAb,IAAuB5P,SAAS,KAAK,CAA5C,EAA+C;AAC7C,MAAA,MAAM8P,OAAO,GAAG,IAAA,CAAKrD,eAAL,CAAqBmD,MAArB,CAAhB,CAAA;;AACA,MAAI,IAAA,CAACE,OAAL,EAAc;AACZ,QAAA,OAAO,EAAP,CAAA;AACD,OAAA;;AACDF,MAAAA,MAAM,GAAGE,OAAO,CAAC7U,GAAjB,CAAA;AACA+E,MAAAA,SAAS,GAAG8P,OAAO,CAAC/Q,IAAR,CAAa3C,MAAzB,CAAA;AACD,KAAA;;AAED,IAAOuT,OAAAA,QAAQ,KAAKC,MAAb,IAAuBzP,WAAW,KAAK0P,SAAS,CAAC9Q,IAAV,CAAe3C,MAA7D,EAAqE;AACnEyT,MAAAA,SAAS,GAAG,IAAA,CAAKjD,WAAL,CAAiB+C,QAAjB,CAAZ,CAAA;;AACA,MAAI,IAAA,CAACE,SAAL,EAAgB;AACd,QAAA,OAAO,EAAP,CAAA;AACD,OAAA;;AACDF,MAAAA,QAAQ,GAAGE,SAAS,CAAC5U,GAArB,CAAA;AACAkF,MAAAA,WAAW,GAAG,CAAd,CAAA;AACD,KAAA;;AAED,IAAA,MAAMw1B,UAAU,GAAG9lB,SAAS,CAACrL,4BAAV,CACjBrE,WADiB,EAEjB0P,SAAS,CAAC9Q,IAAV,CAAe3C,MAFE,CAAnB,CAAA;AAIA,IAAA,IAAIu5B,UAAU,CAACv5B,MAAX,KAAsB,CAA1B,EAA6B,OAAO,EAAP,CAAA;AAC7B,IAAA,MAAM0T,OAAO,GAAG,IAAA,CAAKnF,OAAL,CAAaiF,MAAb,CAAhB,CAAA;AACA,IAAA,MAAMgmB,QAAQ,GAAG9lB,OAAO,EAAE9T,MAAT,EACb8T,GAAAA,OAAO,CAACtL,4BAAR,CAAqC,CAArC,EAAwCxE,SAAxC,CADa,GAEb,EAFJ,CAAA;AAGA,IAAIhB,IAAAA,KAAK,GAAGiF,QAAQ,CAACpC,SAAT,CAAmB8zB,UAAnB,EAA+BC,QAA/B,CAAZ,CAtD6C;;AAwD7C,IAAA,IAAI52B,KAAK,CAAC5C,MAAN,KAAiB,CAArB,EAAwB,OAAO4C,KAAP,CAAA;AAExB,IAAA,IAAI2Q,QAAQ,KAAKC,MAAjB,EAAyB,OAAO5Q,KAAP,CAAA;AAEzB,IAAA,IAAID,IAAI,GAAG,IAAA,CAAK6N,WAAL,CAAiB+C,QAAjB,CAAX,CAAA;;AAEA,IAAA,OAAO5Q,IAAI,IAAIA,IAAI,CAAC9D,GAAL,KAAa2U,MAA5B,EAAoC;AAClC,MAAA,IAAI7Q,IAAI,CAACA,IAAL,CAAU3C,MAAV,KAAqB,CAAzB,EAA4B;AAC1B4C,QAAAA,KAAK,GAAGiF,QAAQ,CAACpC,SAAT,CAAmB7C,KAAnB,EAA0BD,IAAI,CAACmF,cAAL,EAA1B,CAAR,CAAA;AACA,QAAA,IAAIlF,KAAK,CAAC5C,MAAN,KAAiB,CAArB,EAAwB,OAAO,EAAP,CAAA;AACzB,OAAA;;AAED2C,MAAAA,IAAI,GAAG,IAAK6N,CAAAA,WAAL,CAAiB7N,IAAI,CAAC9D,GAAtB,CAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO+D,KAAP,CAAA;AACD,GAAA;;AAEMy2B,EAAAA,kBAAP,CAA0Bx6B,GAA1B,EAAuC8E,MAAvC,EAAuD;AACrD,IAAA,MAAMhB,IAAI,GAAG,IAAA,CAAK4L,OAAL,CAAa1P,GAAb,CAAb,CAAA;AACA,IAAA,MAAM46B,YAAY,GAAG,CAAC92B,IAAI,EAAE/C,MAAN,EAAD,GAAkB,EAAlB,GAAuB+C,IAAI,CAAC2F,eAAL,CAAqB3E,MAArB,CAA5C,CAAA;;AACA,IAAIA,IAAAA,MAAM,KAAK,CAAf,EAAkB;AAChB,MAAA,OAAO81B,YAAP,CAAA;AACD,KAAA;;AAED,IAAA,MAAM5H,YAAY,GAAG,IAAA,CAAK/gB,eAAL,CAAqBjS,GAArB,CAArB,CAAA;;AACA,IAAI,IAAA,CAACgzB,YAAD,IAAiBA,YAAY,CAAClvB,IAAb,KAAsB,EAA3C,EAA+C;AAC7C;AACA,MAAA,OAAO82B,YAAP,CAAA;AACD,KAAA;;AAED,IAAA,MAAM5tB,QAAQ,GAAG,IAAA,CAAKwE,eAAL,CAAqBxR,GAArB,CAAjB,CAAA;;AACA,IAAIgN,IAAAA,QAAQ,IAAIgmB,YAAY,CAACtjB,OAAb,CAAqB1C,QAAQ,CAAChN,GAA9B,CAAhB,EAAoD;AAClD,MAAOgN,OAAAA,QAAQ,CAACvD,eAAT,CAAyBuD,QAAQ,CAAClJ,IAAT,CAAc3C,MAAvC,CAAP,CAAA;AACD,KAAA;;AAED,IAAA,OAAOy5B,YAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;;;AACSC,EAAAA,qBAAP,CAA6B1O,KAA7B,EAA+C;AAC7C,IAAIA,IAAAA,KAAK,CAACkD,WAAN,IAAqBlD,KAAK,CAACzE,MAAN,CAAa9K,WAAb,EAAzB,EAAqD;AACnD,MAAA,OAAO,EAAP,CAAA;AACD,KAAA;;AACD,IAAM,MAAA;AAAEtU,MAAAA,KAAAA;AAAF,KAAA,GAAY6jB,KAAK,CAACmD,mBAAN,CAA0B,IAA1B,CAAlB,CAAA;;AACA,IAAInD,IAAAA,KAAK,CAACkD,WAAV,EAAuB;AACrB,MAAO,OAAA,IAAA,CAAKmL,kBAAL,CAAwBlyB,KAAK,CAACtI,GAA9B,EAAmCsI,KAAK,CAACxD,MAAzC,CAAP,CAAA;AACD,KAAA;;AAED,IAAMhB,MAAAA,IAAI,GAAG,IAAK4L,CAAAA,OAAL,CAAapH,KAAK,CAACtI,GAAnB,CAAb,CAAA;AACA,IAAA,OAAO,CAAC8D,IAAI,EAAE/C,MAAN,EAAD,GAAkB,EAAlB,GAAuB+C,IAAI,CAAC2F,eAAL,CAAqBnB,KAAK,CAACxD,MAAN,GAAe,CAApC,CAA9B,CAAA;AACD,GAAA;;AAEMg2B,EAAAA,eAAP,CAAuB3O,KAAvB,EAA0C;AACxC,IAAI,IAAA,CAACA,KAAL,EAAY;AACV,MAAA,OAAO,EAAP,CAAA;AACD,KAAA;;AACD,IAAM4O,MAAAA,GAAG,GAAG,IAAZ,CAAA;AACA,IAAA,MAAMzyB,KAAK,GAAG6jB,KAAK,CAAC6I,QAAN,CAAe+F,GAAf,CAAd,CAAA;AACA,IAAA,MAAMxyB,GAAG,GAAG4jB,KAAK,CAAC6J,MAAN,CAAa+E,GAAb,CAAZ,CAAA;AAEA,IAAMC,MAAAA,SAAS,GAAG,IAAKhrB,CAAAA,OAAL,CAAa1H,KAAK,CAACtI,GAAnB,CAAlB,CAAA;AACA,IAAMi7B,MAAAA,OAAO,GAAG,IAAKjrB,CAAAA,OAAL,CAAazH,GAAG,CAACvI,GAAjB,CAAhB,CAAA;AAEA,IAAA,MAAMk7B,UAAU,GAAGF,SAAS,CAAC,CAAD,CAA5B,CAAA;AACA,IAAA,MAAMG,QAAQ,GAAGF,OAAO,CAAC,CAAD,CAAxB,CAAA;AACA,IAAA,MAAMG,UAAU,GAAG,IAAA,CAAKl6B,KAAL,CAAWg6B,UAAX,CAAnB,CAAA;AACA,IAAA,MAAMG,QAAQ,GAAG,IAAA,CAAKn6B,KAAL,CAAWi6B,QAAX,CAAjB,CAAA;AAEA,IAAM/xB,MAAAA,MAAc,GAAG,EAAvB,CAAA;;AAEA,IAAS1C,SAAAA,IAAT,CAAcrH,IAAd,EAA0B;AACxB+J,MAAAA,MAAM,CAAC1C,IAAP,CAAYrH,IAAZ,CAAA,CAAA;;AACA,MAAA,IAAIgQ,KAAK,CAACI,OAAN,CAAcpQ,IAAd,CAAA,IAAuBmQ,MAAM,CAACD,QAAP,CAAgBlQ,IAAhB,CAA3B,EAAkD;AAChDA,QAAAA,IAAI,CAAC6B,KAAL,CAAWkH,OAAX,CAAmB1B,IAAnB,CAAA,CAAA;AACD,OAAA;AACF,KAAA;;AAED,IAAS40B,SAAAA,YAAT,CAAsBj8B,IAAtB,EAAkC;AAChC,MAAM0L,MAAAA,IAAI,GAAGgwB,GAAG,CAAC/qB,OAAJ,CAAY3Q,IAAI,CAACW,GAAjB,CAAb,CAAA;;AAEA,MAAA,IACE6K,IAAI,CAAC5I,OAAL,CAAa8I,IAAb,EAAmBiwB,SAAnB,CACAnwB,IAAAA,IAAI,CAACoB,UAAL,CAAgBlB,IAAhB,EAAsBiwB,SAAtB,CADA,IAEAnwB,IAAI,CAACoB,UAAL,CAAgB+uB,SAAhB,EAA2BjwB,IAA3B,CAFA,IAGAF,IAAI,CAAC5I,OAAL,CAAa8I,IAAb,EAAmBkwB,OAAnB,CAHA,IAIApwB,IAAI,CAACoB,UAAL,CAAgBlB,IAAhB,EAAsBkwB,OAAtB,CAJA,IAKApwB,IAAI,CAACoB,UAAL,CAAgBgvB,OAAhB,EAAyBlwB,IAAzB,CALA,IAMC,CAACohB,KAAK,CAAEkD,WAAR,IACCxkB,IAAI,CAACwB,OAAL,CAAatB,IAAb,EAAmBiwB,SAAnB,CADD,IAECnwB,IAAI,CAACuB,QAAL,CAAcrB,IAAd,EAAoBkwB,OAApB,CATJ,EAUE;AACA7xB,QAAAA,MAAM,CAAC1C,IAAP,CAAYrH,IAAZ,CAAA,CAAA;;AACA,QAAA,IAAIgQ,KAAK,CAACI,OAAN,CAAcpQ,IAAd,CAAA,IAAuBmQ,MAAM,CAACD,QAAP,CAAgBlQ,IAAhB,CAA3B,EAAkD;AAChDA,UAAAA,IAAI,CAAC6B,KAAL,CAAWkH,OAAX,CAAmBkzB,YAAnB,CAAA,CAAA;AACD,SAAA;AACF,OAAA;AACF,KA5CuC;;;AA+CxClyB,IAAAA,MAAM,CAAC1C,IAAP,CAAY00B,UAAZ,CAAA,CAAA;AACAA,IAAAA,UAAU,CAACl6B,KAAX,CAAiBkH,OAAjB,CAAyBkzB,YAAzB,CAAA,CAAA;;AAEA,IAAIJ,IAAAA,UAAU,KAAKC,QAAnB,EAA6B;AAC3B,MAAA,OAAO/xB,MAAP,CAAA;AACD,KApDuC;;;AAuDxC,IAAA,IAAA,CAAKlI,KAAL,CAAW0B,KAAX,CAAiBs4B,UAAU,GAAG,CAA9B,EAAiCC,QAAjC,CAAA,CAA2C/yB,OAA3C,CAAoD/I,IAAD,IAAU;AAC3DqH,MAAAA,IAAI,CAACrH,IAAD,CAAJ,CAAA;AACD,KAFD,EAvDwC;;AA4DxC+J,IAAAA,MAAM,CAAC1C,IAAP,CAAY20B,QAAZ,CAAA,CAAA;AACAA,IAAAA,QAAQ,CAACn6B,KAAT,CAAekH,OAAf,CAAuBkzB,YAAvB,CAAA,CAAA;AACA,IAAA,OAAOlyB,MAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;;;AACS6pB,EAAAA,yBAAP,CAAiCjzB,GAAjC,EAA8C+X,UAA9C,EAAsE;AACpE,IAAA,IAAIwjB,GAAG,GAAG,IAAA,CAAKtoB,YAAL,CAAkBjT,GAAlB,CAAV,CAAA;AACA,IAAA,MAAM2L,CAAC,GAAG,IAAA,CAAK+D,OAAL,CAAa1P,GAAb,CAAV,CAAA;;AACA,IAAA,IAAI2L,CAAC,EAAE3K,SAAH,EAAJ,EAAoB;AAClBu6B,MAAAA,GAAG,CAAC70B,IAAJ,CAASiF,CAAT,CAAA,CAAA;AACD,KAAA;;AACD4vB,IAAAA,GAAG,GAAGA,GAAG,CAAC/qB,OAAJ,EAAN,CAAA;;AACA,IAAA,KAAK,MAAMnR,IAAX,IAAmBk8B,GAAnB,EAAwB;AACtB,MAAIxjB,IAAAA,UAAU,CAACoa,KAAX,CAAiB,kBAAjB,EAAqC9yB,IAArC,CAAJ,EAAgD;AAC9C,QAAA,OAAOA,IAAP,CAAA;AACD,OAFD,MAEO,IAAIA,IAAI,CAACoQ,OAAL,EAAkBsI,IAAAA,UAAU,CAACoa,KAAX,CAAiB,QAAjB,EAA2B9yB,IAA3B,CAAtB,EAAwD;AAC7D,QAAA,OAAOA,IAAP,CAAA;AACD,OAAA;AACF,KAAA;;AACD,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;;;AACS20B,EAAAA,0BAAP,CAAkCh0B,GAAlC,EAA+Cw7B,OAA/C,EAAgEzjB,UAAhE,EAAwF;AACtF,IAAA,MAAMwjB,GAAG,GAAG,IAAA,CAAKtoB,YAAL,CAAkBjT,GAAlB,CAAZ,CAAA;AACA,IAAA,MAAM2L,CAAC,GAAG,IAAA,CAAK+D,OAAL,CAAa1P,GAAb,CAAV,CAAA;;AACA,IAAA,IAAI2L,CAAC,EAAE3K,SAAH,EAAJ,EAAoB;AAClBu6B,MAAAA,GAAG,CAAC70B,IAAJ,CAASiF,CAAT,CAAA,CAAA;AACD,KAAA;;AACD,IAAA,MAAM8vB,SAAS,GAAGF,GAAG,CAAC74B,SAAJ,CAAerD,IAAD,IAAUA,IAAI,CAACW,GAAL,KAAaw7B,OAArC,CAAlB,CAAA;;AACA,IAAA,IAAIC,SAAS,KAAK,CAAC,CAAnB,EAAsB;AACpB,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,KAAK,IAAItwB,CAAC,GAAGswB,SAAb,EAAwBtwB,CAAC,GAAGowB,GAAG,CAACp6B,MAAhC,EAAwCgK,CAAC,EAAzC,EAA6C;AAC3C,MAAA,MAAM9L,IAAI,GAAGk8B,GAAG,CAACpwB,CAAD,CAAhB,CAAA;;AACA,MAAI4M,IAAAA,UAAU,CAACoa,KAAX,CAAiB,kBAAjB,EAAqC9yB,IAArC,CAAJ,EAAgD;AAC9C,QAAA,OAAOA,IAAP,CAAA;AACD,OAFD,MAEO,IAAIA,IAAI,CAACoQ,OAAL,EAAkBsI,IAAAA,UAAU,CAACoa,KAAX,CAAiB,QAAjB,EAA2B9yB,IAA3B,CAAtB,EAAwD;AAC7D,QAAA,OAAOA,IAAP,CAAA;AACD,OAAA;AACF,KAAA;;AACD,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACSswB,EAAAA,cAAP,CAAsB3vB,GAAtB,EAAmC+X,UAAnC,EAA2D;AACzD,IAAA,MAAMhN,IAAI,GAAG,IAAA,CAAKiF,OAAL,CAAahQ,GAAb,CAAb,CAAA;;AACA,IAAI,IAAA,CAAC+K,IAAL,EAAW;AACT,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AAED,IAAA,OAAO,KAAK2wB,oBAAL,CAA0B3wB,IAA1B,EAAgCgN,UAAhC,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACU2jB,EAAAA,oBAAR,CAA6B3wB,IAA7B,EAAyCgN,UAAzC,EAAiE;AAC/D,IAAA,OAAO,KAAK3E,gBAAL,CAAsBrI,IAAtB,EAA6B1L,IAAD,IAAU;AAC3C,MAAA,OAAO0Y,UAAU,CAACoa,KAAX,CAAiB,QAAjB,EAA2B9yB,IAA3B,CAAP,CAAA;AACD,KAFM,CAAP,CAAA;AAGD,GAAA;AAED;AACF;AACA;;;AACSs8B,EAAAA,aAAP,CAAqB37B,GAArB,EAAkC+X,UAAlC,EAA0D;AACxD,IAAA,MAAMhN,IAAI,GAAG,IAAA,CAAKiF,OAAL,CAAahQ,GAAb,CAAb,CAAA;;AACA,IAAI,IAAA,CAAC+K,IAAL,EAAW;AACT,MAAA,OAAO,KAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,KAAK6wB,mBAAL,CAAyB7wB,IAAzB,EAA+BgN,UAA/B,CAAP,CAAA;AACD,GAAA;;AAEO6jB,EAAAA,mBAAR,CAA4B7wB,IAA5B,EAAwCgN,UAAxC,EAAgE;AAC9D,IAAM5F,MAAAA,OAAO,GAAG,IAAKupB,CAAAA,oBAAL,CAA0B3wB,IAA1B,EAAgCgN,UAAhC,CAAhB,CAAA;AACA,IAAO,OAAA,CAAC,CAAC5F,OAAT,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACS0pB,EAAAA,gBAAP,CAAwB77B,GAAxB,EAAqC+X,UAArC,EAA6D;AAC3D,IAAA,OAAO,IAAKxF,CAAAA,YAAL,CACLvS,GADK,EAEJX,IAAD,IAAU0Y,UAAU,CAACoa,KAAX,CAAiB,QAAjB,EAA2B9yB,IAA3B,CAFL,CAAP,CAAA;AAID,GAAA;AAED;AACF;AACA;;;AACSy8B,EAAAA,kBAAP,CAA0B3P,KAA1B,EAA4CpU,UAA5C,EAAqE;AACnE,IAAM,MAAA;AAAEzP,MAAAA,KAAF;AAASC,MAAAA,GAAAA;AAAT,KAAA,GAAiB4jB,KAAK,CAACmD,mBAAN,CAA0B,IAA1B,CAAvB,CAAA;AACA,IAAMyM,MAAAA,aAAa,GAAG,IAAK/rB,CAAAA,OAAL,CAAa1H,KAAK,CAACtI,GAAnB,CAAtB,CAAA;AACA,IAAMg8B,MAAAA,WAAW,GAAG,IAAKhsB,CAAAA,OAAL,CAAazH,GAAG,CAACvI,GAAjB,CAApB,CAAA;;AACA,IAAA,IAAI,CAAC+7B,aAAD,IAAkB,CAACC,WAAvB,EAAoC;AAClC,MAAO5B,OAAAA,QAAQ,CAAC54B,MAAT,EAAP,CAAA;AACD,KAAA;;AACD,IAAMy6B,MAAAA,SAAS,GACblkB,UAAU,IAAI,IAAA,CAAK2jB,oBAAL,CAA0BK,aAA1B,EAAyChkB,UAAzC,CADhB,CAAA;AAEA,IAAMmkB,MAAAA,OAAO,GACXnkB,UAAU,IAAI,IAAA,CAAK2jB,oBAAL,CAA0BM,WAA1B,EAAuCjkB,UAAvC,CADhB,CAAA;AAEA,IAAA,MAAMijB,SAAS,GAAGiB,SAAS,GACvB,IAAKtsB,CAAAA,UAAL,CAAgBssB,SAAS,CAACj8B,GAA1B,CADuB,GAEvB+7B,aAFJ,CAAA;AAGA,IAAA,MAAMd,OAAO,GAAGiB,OAAO,GAAG,IAAKvsB,CAAAA,UAAL,CAAgBusB,OAAO,CAACl8B,GAAxB,CAAH,GAAkCg8B,WAAzD,CAAA;AAEA,IAAI38B,IAAAA,IAAI,GAAG,IAAX,CAAA;AACA,IAAI88B,IAAAA,UAAU,GAAGlB,OAAjB,CAAA;AACA,IAAA,IAAImB,cAAc,GAAGF,OAAO,GAAGA,OAAO,CAACh7B,KAAR,CAAcC,MAAjB,GAA0BoH,GAAG,CAACzD,MAA1D,CAAA;AACA,IAAIu3B,IAAAA,IAAI,GAAG,KAAX,CAAA;;AACA,IAAOF,OAAAA,UAAU,CAACh7B,MAAlB,EAA0B;AACxB,MAAMsB,MAAAA,KAAK,GAAG05B,UAAU,CAACA,UAAU,CAACh7B,MAAX,GAAoB,CAArB,CAAxB,CAAA;AACA9B,MAAAA,IAAI,GAAGA,IAAI,CAACqX,SAAL,CAAeylB,UAAf,EAA2BC,cAA3B,CAAP,CAAA;AACAD,MAAAA,UAAU,GAAGtxB,IAAI,CAAC0B,MAAL,CAAY4vB,UAAZ,CAAb,CAAA;AACAC,MAAAA,cAAc,GAAG35B,KAAK,GAAG,CAAzB,CAAA;;AAEA,MAAI,IAAA,CAAC05B,UAAU,CAACh7B,MAAZ,IAAsBk7B,IAAI,KAAK,KAAnC,EAA0C;AACxCF,QAAAA,UAAU,GAAGnB,SAAb,CAAA;AACAoB,QAAAA,cAAc,GAAGH,SAAS,GAAG,CAAH,GAAO3zB,KAAK,CAACxD,MAAvC,CAAA;AACAu3B,QAAAA,IAAI,GAAG,OAAP,CAAA;AACD,OAAA;AACF,KAAA;;AAED,IAAA,MAAMnB,UAAU,GAAGF,SAAS,CAAC,CAAD,CAAT,GAAe,CAAlC,CAAA;AACA,IAAA,MAAMG,QAAQ,GAAGF,OAAO,CAAC,CAAD,CAAP,GAAa,CAA9B,CAAA;AACA,IAAA,MAAM/5B,KAAK,GAAG7B,IAAI,CAAC6B,KAAL,CAAW0B,KAAX,CAAiBs4B,UAAjB,EAA6BC,QAA7B,CAAd,CAnCmE;;AAqCnE,IAAOf,OAAAA,QAAQ,CAAC54B,MAAT,CAAgB;AAAEN,MAAAA,KAAAA;AAAF,KAAhB,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACSo7B,EAAAA,oBAAP,CAA4BnQ,KAA5B,EAAuD;AACrD,IAAM,MAAA;AAAE7jB,MAAAA,KAAF;AAASC,MAAAA,GAAAA;AAAT,KAAA,GAAiB4jB,KAAK,CAACmD,mBAAN,CAA0B,IAA1B,CAAvB,CAAA;AACA,IAAM8L,MAAAA,UAAU,GAAG,IAAA,CAAK1nB,wBAAL,CAA8BpL,KAAK,CAACtI,GAApC,CAAnB,CAFqD;AAKrD;;AACA,IAAA,IAAIsI,KAAK,CAACtI,GAAN,KAAcuI,GAAG,CAACvI,GAAtB,EAA2B;AACzB,MAAO,OAAA,CAACo7B,UAAD,CAAP,CAAA;AACD,KAAA;;AAED,IAAMC,MAAAA,QAAQ,GAAG,IAAK3nB,CAAAA,wBAAL,CAA8BnL,GAAG,CAACvI,GAAlC,CAAjB,CAAA;AACA,IAAA,MAAMu8B,MAAM,GAAG,IAAKhlB,CAAAA,SAAL,EAAf,CAAA;AACA,IAAA,MAAM2jB,UAAU,GAAGqB,MAAM,CAACxnB,OAAP,CAAeqmB,UAAf,CAAnB,CAAA;AACA,IAAA,MAAMD,QAAQ,GAAGoB,MAAM,CAACxnB,OAAP,CAAesmB,QAAf,CAAjB,CAAA;AACA,IAAOkB,OAAAA,MAAM,CAAC35B,KAAP,CAAas4B,UAAb,EAAyBC,QAAQ,GAAG,CAApC,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACS5jB,EAAAA,SAAP,GAAmB;AACjB,IAAA,OAAOlI,KAAK,CAACkI,SAAN,CAAgB,IAAA,CAAKrW,KAArB,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACSuW,EAAAA,eAAP,CAAuBlX,IAAvB,EAAqC;AACnC,IAAO8O,OAAAA,KAAK,CAACoI,eAAN,CAAsB,KAAKvW,KAA3B,EAAkCX,IAAlC,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACSi8B,EAAAA,oBAAP,CAA4BrQ,KAA5B,EAAwD;AACtD,IAAI,IAAA,CAACA,KAAL,EAAY;AACV,MAAA,OAAO,EAAP,CAAA;AACD,KAAA;;AACD,IAAM,MAAA;AAAE7jB,MAAAA,KAAF;AAASC,MAAAA,GAAAA;AAAT,KAAA,GAAiB4jB,KAAK,CAACmD,mBAAN,CAA0B,IAA1B,CAAvB,CAAA;AAEA,IAAM8L,MAAAA,UAAU,GAAG,IAAKvoB,CAAAA,iBAAL,CAAuBvK,KAAK,CAACtI,GAA7B,CAAnB,CAAA;;AACA,IAAI,IAAA,CAACo7B,UAAL,EAAiB;AACf,MAAA,OAAO,EAAP,CAAA;AACD,KAAA;;AACD,IAAA,IAAI9yB,KAAK,CAACtI,GAAN,KAAcuI,GAAG,CAACvI,GAAtB,EAA2B;AACzB,MAAO,OAAA,CAACo7B,UAAD,CAAP,CAAA;AACD,KAAA;;AAED,IAAMC,MAAAA,QAAQ,GAAG,IAAKxoB,CAAAA,iBAAL,CAAuBtK,GAAG,CAACvI,GAA3B,CAAjB,CAAA;;AACA,IAAI,IAAA,CAACq7B,QAAL,EAAe;AACb,MAAA,OAAO,EAAP,CAAA;AACD,KAAA;;AACD,IAAO,OAAA,IAAA,CAAKn6B,KAAL,CAAW0B,KAAX,CACL,IAAK1B,CAAAA,KAAL,CAAW6T,OAAX,CAAmBqmB,UAAnB,CADK,EAEL,KAAKl6B,KAAL,CAAW6T,OAAX,CAAmBsmB,QAAnB,CAA+B,GAAA,CAF1B,CAAP,CAAA;AAID,GAAA;AAED;AACF;AACA;;;AACSoB,EAAAA,aAAP,CAAqBz8B,GAArB,EAAkCmsB,KAAlC,EAAoD;AAClD,IAAA,MAAMphB,IAAI,GAAG,IAAA,CAAKiF,OAAL,CAAahQ,GAAb,CAAb,CAAA;;AACA,IAAI,IAAA,CAAC+K,IAAL,EAAW;AACT,MAAA,OAAO,KAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,KAAK2xB,mBAAL,CAAyB3xB,IAAzB,EAA+BohB,KAA/B,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACSuQ,EAAAA,mBAAP,CAA2B3xB,IAA3B,EAAuCohB,KAAvC,EAAyD;AACvD,IAAA,IAAI,CAACA,KAAD,IAAUA,KAAK,CAAC4L,iBAApB,EAAuC;AACrC,MAAA,OAAO,KAAP,CAAA;AACD,KAAA;;AACD,IAAM,MAAA;AAAEzvB,MAAAA,KAAF;AAASC,MAAAA,GAAAA;AAAT,KAAA,GAAiB4jB,KAAK,CAACwL,IAAN,CAAW,IAAX,CAAvB,CAAA;AACA,IAAA,MAAMqD,SAAS,GAAG1yB,KAAK,CAAC8U,SAAN,CAAgB,IAAhB,CAAlB,CAAA;AACA,IAAM6d,MAAAA,OAAO,GAAG1yB,GAAG,CAAC6U,SAAJ,CAAc,IAAd,CAAhB,CANuD;;AASvD,IAAA,IAAI,CAAC4d,SAAD,IAAc,CAACC,OAAnB,EAA4B;AAC1B,MAAA,OAAO,KAAP,CAAA;AACD,KAXsD;;;AAcvD,IAAA,IACE3yB,KAAK,CAACsU,WAAN,EAAA,IACAtU,KAAK,CAACgU,IAAN,KAAeD,SAAS,CAACqB,KADzB,KAEC7S,IAAI,CAAC5I,OAAL,CAAa+4B,SAAb,EAAwBjwB,IAAxB,CAAA,IAAiCF,IAAI,CAACoB,UAAL,CAAgB+uB,SAAhB,EAA2BjwB,IAA3B,CAFlC,CADF,EAIE;AACA,MAAA,OAAO,KAAP,CAAA;AACD,KAAA;;AACD,IAAA,IACExC,GAAG,CAACqU,WAAJ,EAAA,IACArU,GAAG,CAAC+T,IAAJ,KAAaD,SAAS,CAACa,MADvB,KAECrS,IAAI,CAAC5I,OAAL,CAAag5B,OAAb,EAAsBlwB,IAAtB,CAAA,IAA+BF,IAAI,CAACoB,UAAL,CAAgBgvB,OAAhB,EAAyBlwB,IAAzB,CAFhC,CADF,EAIE;AACA,MAAA,OAAO,KAAP,CAAA;AACD,KAAA;;AAED,IAAM4xB,MAAAA,aAAa,GAAG9xB,IAAI,CAACC,OAAL,CAAaC,IAAb,EAAmBiwB,SAAnB,CAAkC,KAAA,CAAC,CAAzD,CAAA;AACA,IAAM4B,MAAAA,UAAU,GAAG/xB,IAAI,CAACC,OAAL,CAAaC,IAAb,EAAmBkwB,OAAnB,CAAA,KAAgC,CAAnD,CAAA;AACA,IAAA,OAAO,CAAC0B,aAAD,IAAkB,CAACC,UAA1B,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACSC,EAAAA,eAAP,CAAuB1Q,KAAvB,EAAiD;AAC/C,IAAM,MAAA;AAAE7jB,MAAAA,KAAF;AAASC,MAAAA,GAAAA;AAAT,KAAA,GAAiB4jB,KAAK,CAACmD,mBAAN,CAA0B,IAA1B,CAAvB,CAAA;AACA,IAAO,OAAA,IAAA,CAAK7a,wBAAL,CAA8BnM,KAAK,CAACtI,GAApC,EAAyCuI,GAAG,CAACvI,GAA7C,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACS88B,EAAAA,qBAAP,CAA6B3Q,KAA7B,EAAyD;AACvD,IAAM3U,MAAAA,KAAK,GAAG,IAAA,CAAKqlB,eAAL,CAAqB1Q,KAArB,CAAA,CACXnoB,GADW,CACNF,IAAD,IAAU,IAAKwP,CAAAA,gBAAL,CAAsBxP,IAAI,CAAC9D,GAA3B,CADH,CAAA,CAEX2D,MAFW,CAEHo5B,MAAD,IAA8B7sB,OAAO,CAAC6sB,MAAD,CAFjC,CAAd,CAAA;AAIA,IAAA,OAAOvlB,KAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AACSwlB,EAAAA,qBAAP,CAA6B7Q,KAA7B,EAA0D;AACxD,IAAI,IAAA,CAACA,KAAL,EAAY;AACV,MAAA,OAAO,EAAP,CAAA;AACD,KAAA;;AAED,IAAA,MAAM3U,KAAK,GAAG,IAAA,CAAKqlB,eAAL,CAAqB1Q,KAArB,CACXnoB,CAAAA,GADW,CACNF,IAAD,IAAU,IAAK8O,CAAAA,kBAAL,CAAwB9O,IAAI,CAAC9D,GAA7B,CADH,CAAA;AAEZ;AAFY,KAGXwD,MAHW,CAGM,CAACyR,OAAD,EAAUgoB,MAAV,KAAqB;AACrC,MAAIA,IAAAA,MAAM,IAAI,CAAChoB,OAAO,CAACioB,QAAR,CAAiBD,MAAjB,CAAf,EAAyC;AACvChoB,QAAAA,OAAO,CAACvO,IAAR,CAAau2B,MAAb,CAAA,CAAA;AACD,OAAA;;AACD,MAAA,OAAOhoB,OAAP,CAAA;AACD,KARW,EAQT,EARS,CAAd,CAAA;AASA;;AAEA,IAAA,OAAOuC,KAAP,CAAA;AACD,GAAA;;AAEMpV,EAAAA,MAAP,CAAcqF,OAAd,EAA0C;AACxC,IAAA,MAAMkD,MAAoB,GAAG;AAC3BtI,MAAAA,KAAK,EAAE,UADoB;AAE3BV,MAAAA,IAAI,EAAE,EAAE,GAAG,IAAKA,CAAAA,IAAAA;AAAV,OAFqB;AAG3BT,MAAAA,KAAK,EAAE,IAAKA,CAAAA,KAAL,CAAW8C,GAAX,CAAgB3E,IAAD,IAAUA,IAAI,CAAC+C,MAAL,CAAYqF,OAAZ,CAAzB,CAAA;AAHoB,KAA7B,CAAA;;AAMA,IAAIA,IAAAA,OAAO,EAAEmD,YAAb,EAA2B;AACzBD,MAAAA,MAAM,CAAC3K,GAAP,GAAa,KAAKA,GAAlB,CAAA;AACD,KAAA;;AAED,IAAA,OAAO2K,MAAP,CAAA;AACD,GAAA;;AAnkB2C;;AC/B9C;AACA;AACA;AACA;;AAOA,SAASwyB,gBAAT,CAA0Bx6B,CAA1B,EAAmCI,CAAnC,EAAkD;AAChD,EAAO,OAAA,EAAE,GAAGJ,CAAL;AAAQ,IAAGI,GAAAA,CAAAA;AAAX,GAAP,CAAA;AACD,CAAA;;AAac,MAAMq6B,SAAN,SAA+Cj9B,eAA/C,CAA+D;AAC5E,EAAOqB,OAAAA,MAAP,CAAqCb,KAArC,EAAmF;AACjF,IAAA,IAAIy8B,SAAS,CAACC,WAAV,CAAsB18B,KAAtB,CAAJ,EAAkC;AAChC,MAAA,OAAOA,KAAP,CAAA;AACD,KAAA;;AAED,IAAA,IAAIH,iCAAa,CAACG,KAAD,CAAjB,EAA0B;AACxB,MAAM,MAAA;AAAEX,QAAAA,GAAF;AAAO2B,QAAAA,IAAP;AAAa27B,QAAAA,SAAAA;AAAb,OAAA,GAA2B38B,KAAjC,CAAA;AACA,MAAO,OAAA,IAAIy8B,SAAJ,CAAc;AACnBp9B,QAAAA,GADmB;AAEnB2B,QAAAA,IAFmB;AAGnB27B,QAAAA,SAAAA;AAHmB,OAAd,CAAP,CAAA;AAKD,KAAA;;AAED,IAAA,MAAM,IAAI78B,KAAJ,CACH,CAA8EE,4EAAAA,EAAAA,KAAM,EADjF,CAAN,CAAA;AAGD,GAAA;;AAED,EAAO08B,OAAAA,WAAP,CAAmBE,cAAnB,EAAqE;AACnE,IAAOA,OAAAA,cAAc,YAAYH,SAAjC,CAAA;AACD,GAAA;;AAED,EAAA,OAAOI,cAAP,CAAsBC,UAAtB,EAA+Cp+B,IAA/C,EAA2D;AACzD,IAAA,IAAI,CAACo+B,UAAU,CAACt8B,MAAZ,IAAsB,CAACL,SAAO,CAACE,SAAR,CAAkB3B,IAAlB,CAA3B,EAAoD;AAClD,MAAA,OAAOA,IAAP,CAAA;AACD,KAAA;;AACD,IAAOo+B,OAAAA,UAAU,CAACj6B,MAAX,CAAkB,CAACmI,CAAD,EAAI+xB,SAAJ,KAAkB;AACzC,MAAA,IAAIA,SAAS,CAAC19B,GAAV,KAAkB2L,CAAC,CAAC3L,GAAxB,EAA6B;AAC3B,QAAA,OAAO2L,CAAP,CAAA;AACD,OAAA;;AACD,MAAM,MAAA;AAAE2xB,QAAAA,SAAAA;AAAF,OAAA,GAAgBI,SAAtB,CAAA;AACA,MAAA,OAAO/xB,CAAC,CAAC3J,GAAF,CAAM,MAAN,EAAcs7B,SAAS,CAAC3xB,CAAC,CAAChK,IAAH,EAAS+7B,SAAS,CAAC/7B,IAAnB,CAAvB,CAAP,CAAA;AACD,KANM,EAMJtC,IANI,CAAP,CAAA;AAOD,GAAA;;AAED,EAAOuC,OAAAA,QAAP,CAAgBC,IAAhB,EAAqC;AACnC,IAAM,MAAA;AAAE7B,MAAAA,GAAF;AAAO2B,MAAAA,IAAAA;AAAP,KAAA,GAAgBE,IAAtB,CAAA;AACA,IAAOu7B,OAAAA,SAAS,CAAC57B,MAAV,CAAiB;AACtBxB,MAAAA,GADsB;AACjB2B,MAAAA,IAAAA;AADiB,KAAjB,CAAP,CAAA;AAGD,GAAA;;AAEDjB,EAAAA,WAAW,CAACC,KAAD,EAAgC;AACzC,IAAA,KAAA,EAAA,CAAA;AADyC,IAAA,IAAA,CAS3BX,GAT2B,GAAA,KAAA,CAAA,CAAA;AAAA,IAAA,IAAA,CAW3B2B,IAX2B,GAAA,KAAA,CAAA,CAAA;AAAA,IAAA,IAAA,CAa3B27B,SAb2B,GAAA,KAAA,CAAA,CAAA;AAEzC,IAAM,MAAA;AAAEt9B,MAAAA,GAAF;AAAO2B,MAAAA,IAAP;AAAa27B,MAAAA,SAAS,GAAGH,gBAAAA;AAAzB,KAAA,GAA8Cx8B,KAApD,CAAA;AACA,IAAKX,IAAAA,CAAAA,GAAL,GAAWA,GAAX,CAAA;AACA,IAAK2B,IAAAA,CAAAA,IAAL,GAAYA,IAAZ,CAAA;AACA,IAAK27B,IAAAA,CAAAA,SAAL,GAAiBA,SAAjB,CAAA;AACA,IAAA,IAAA,CAAKp9B,MAAL,EAAA,CAAA;AACD,GAAA;;AAQM6B,EAAAA,KAAP,CAAapB,KAAb,EAAqD;AACnD,IAAO,OAAA,IAAIy8B,SAAJ,CAAc;AACnBp9B,MAAAA,GAAG,EAAE,IAAA,CAAKA,GADS;AAEnB2B,MAAAA,IAAI,EAAE,IAAA,CAAKA,IAFQ;AAGnB27B,MAAAA,SAAS,EAAE,IAAA,CAAKA,SAHG;AAInB,MAAG38B,GAAAA,KAAAA;AAJgB,KAAd,CAAP,CAAA;AAMD,GAAA;;AAEMqB,EAAAA,GAAP,CACEhC,GADF,EAEEC,KAFF,EAGE;AACA,IAAO,OAAA,IAAA,CAAK8B,KAAL,CAAW;AAChB,MAAA,CAAC/B,GAAD,GAAOC,KAAAA;AADS,KAAX,CAAP,CAAA;AAGD,GAAA;;AAEMmC,EAAAA,MAAP,GAAgB;AACd,IAAO,OAAA;AACLpC,MAAAA,GAAG,EAAE,IAAA,CAAKA,GADL;AAEL2B,MAAAA,IAAI,EAAE,IAAKA,CAAAA,IAAAA;AAFN,KAAP,CAAA;AAID,GAAA;;AAlF2E;;ACzB9E;AACA;AACA;AACA;AAUO,MAAMg8B,gBAAgB,GAAGC,YAAK,CACnC,CACE7lB,UADF,EAEE8lB,EAFF,EAGErK,QAHF,EAIEf,IAJF,KAKK;AACH,EAAA,OAAQpZ,SAAD,IAA0B;AAC/B,IAAIma,IAAAA,QAAQ,KAAK,CAAjB,EAAoB;AAClB,MAAA,OAAOna,SAAP,CAAA;AACD,KAAA;;AAED,IAAM,MAAA;AAAE2D,MAAAA,QAAAA;AAAF,KAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;AAEA,IAAIy3B,IAAAA,SAAS,GAAGmG,EAAhB,CAAA;;AACA,IAAInG,IAAAA,SAAS,KAAK,OAAlB,EAA2B;AACzBA,MAAAA,SAAS,GAAGre,SAAS,CAAC4c,SAAV,CAAoBjZ,QAApB,CAAA,GAAgC,QAAhC,GAA2C,OAAvD,CAAA;AACD,KAFD,MAEO,IAAI0a,SAAS,KAAK,KAAlB,EAAyB;AAC9BA,MAAAA,SAAS,GAAGre,SAAS,CAAC4c,SAAV,CAAoBjZ,QAApB,CAAA,GAAgC,OAAhC,GAA0C,QAAtD,CAAA;AACD,KAAA;;AACD,IAAA,MAAMqV,EAAE,GAAGqF,SAAS,KAAK,QAAd,GAAyBre,SAAS,CAACqO,MAAnC,GAA4CrO,SAAS,CAACsO,KAAjE,CAAA;AAEA,IAAA,MAAM1K,KAAK,GAAGlF,UAAU,CAACoa,KAAX,CAAiBoB,eAAjB,EAAkClB,EAAlC,EAAsCmB,QAAtC,EAAgDf,IAAhD,CAAd,CAAA;AACA,IAAA,OAAOpZ,SAAS,CAACrX,GAAV,CAAc01B,SAAd,EAAyBza,KAAzB,CAAP,CAAA;AACD,GAjBD,CAAA;AAkBD,CAzBkC,CAA9B,CAAA;AA4BA,MAAM6gB,iBAAiB,GAAGF,YAAK,CACpC,CACE7lB,UADF,EAEE8lB,EAFF,EAGErK,QAHF,EAIEf,IAJF,KAKK;AACH,EAAA,OAAQpZ,SAAD,IAA0B;AAC/B,IAAA,MAAMuf,KAAK,GAAG+E,gBAAgB,CAAC5lB,UAAD,EAAa8lB,EAAb,EAAiB,CAACrK,QAAlB,EAA4Bf,IAA5B,CAA9B,CAAA;AACA,IAAOmG,OAAAA,KAAK,CAACvf,SAAD,CAAZ,CAAA;AACD,GAHD,CAAA;AAID,CAXmC,CAA/B,CAAA;AAcA,MAAM0kB,qBAAqB,GAAGD,iBAAiB,CACpDF,YAAK,CAACI,WAD8C,EAEpDJ,YAAK,CAACI,WAF8C,EAGpD,CAHoD,EAIpD,MAJoD,CAA/C,CAAA;AAOA,MAAMC,oBAAoB,GAAGN,gBAAgB,CAClDC,YAAK,CAACI,WAD4C,EAElDJ,YAAK,CAACI,WAF4C,EAGlD,CAHkD,EAIlD,MAJkD,CAA7C,CAAA;AAyBP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEO,MAAME,iBAAiB,GAAG,CAC/B7+B,IAD+B,EAE/B2d,QAF+B,EAG/B3D,SAH+B,KAI5B;AACH,EAAM,MAAA;AAAE/Q,IAAAA,KAAF;AAASC,IAAAA,GAAAA;AAAT,GAAA,GAAiB8Q,SAAS,CAACse,IAAV,CAAe3a,QAAf,CAAvB,CAAA;;AACA,EAAA,IAAIlc,SAAO,CAACE,SAAR,CAAkB3B,IAAlB,CAAJ,EAA6B;AAC3B,IACGiJ,IAAAA,KAAK,CAACsU,WAAN,EAAA,IAAuBtU,KAAK,CAACtI,GAAN,KAAcX,IAAI,CAACW,GAA3C,IACCuI,GAAG,CAACqU,WAAJ,EAAA,IAAqBrU,GAAG,CAACvI,GAAJ,KAAYX,IAAI,CAACW,GAFzC,EAGE;AACA,MAAA,OAAO,KAAP,CAAA;AACD,KALD,MAKO;AACL,MAAM,MAAA;AAAEsI,QAAAA,KAAK,EAAEsM,SAAT;AAAoBrM,QAAAA,GAAG,EAAEsM,OAAAA;AAAzB,OAAA,GACJwE,SAAS,CAACiW,mBAAV,CAA8BtS,QAA9B,CADF,CAAA;AAEA,MAAA,OAAO3d,IAAI,CAAC4Q,OAAL,CAAa2E,SAAS,CAAC5U,GAAvB,CAA+BX,IAAAA,IAAI,CAAC4Q,OAAL,CAAa4E,OAAO,CAAC7U,GAArB,CAAtC,CAAA;AACD,KAAA;AACF,GAXD,MAWO;AACL;AACA,IACEsI,OAAAA,KAAK,CAACqU,WAAN,EAAA,IACApU,GAAG,CAACoU,WAAJ,EADA,IAEArU,KAAK,CAACtI,GAAN,KAAcX,IAAI,CAACW,GAFnB,IAGAuI,GAAG,CAACvI,GAAJ,KAAYX,IAAI,CAACW,GAJnB,CAAA;AAMD,GAAA;AACF,CA1BM,CAAA;;AA4BP,SAASm+B,uBAAT,CACEnhB,QADF,EAEEohB,IAFF,EAGEC,WAHF,EAIQ;AACN,EAAA,IAAI/1B,KAAK,GAAG+1B,WAAW,CAACn9B,KAAZ,CAAkB,CAAlB,CAAZ,CAAA;;AACA,EAAO,OAAA,CAAC8b,QAAQ,CAAC/M,OAAT,CAAiB3H,KAAK,CAACtI,GAAvB,CAAR,EAAqC;AACnCsI,IAAAA,KAAK,GAAG81B,IAAI,CAAClvB,aAAL,CAAmB5G,KAAK,CAACtI,GAAzB,CAAA,CAA8BkB,KAA9B,CAAoC,CAApC,CAAR,CAAA;AACD,GAAA;;AAED,EAAA,OAAO8b,QAAQ,CAACrN,UAAT,CAAoBrH,KAAK,CAACtI,GAA1B,CAAP,CAAA;AACD,CAAA;;AAED,SAASs+B,sBAAT,CACEthB,QADF,EAEEohB,IAFF,EAGEC,WAHF,EAIQ;AACN,EAAA,IAAI91B,GAAG,GAAG81B,WAAW,CAACn9B,KAAZ,CAAkBm9B,WAAW,CAACn9B,KAAZ,CAAkBC,MAAlB,GAA2B,CAA7C,CAAV,CAAA;;AACA,EAAO,OAAA,CAAC6b,QAAQ,CAAC/M,OAAT,CAAiB1H,GAAG,CAACvI,GAArB,CAAR,EAAmC;AACjC,IAAMu+B,MAAAA,UAAU,GAAGH,IAAI,CAAClvB,aAAL,CAAmB3G,GAAG,CAACvI,GAAvB,CAAnB,CAAA;AACAuI,IAAAA,GAAG,GAAGg2B,UAAU,CAACr9B,KAAX,CAAiBq9B,UAAU,CAACr9B,KAAX,CAAiBC,MAAjB,GAA0B,CAA3C,CAAN,CAAA;AACD,GAAA;;AAED,EAAA,OAAO6b,QAAQ,CAACrN,UAAT,CAAoBpH,GAAG,CAACvI,GAAxB,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASw+B,mBAAT,CACLzmB,UADK,EAELsB,SAFK,EAGLolB,QAHK,EAIa;AAClB,EAAA,IAAI,CAAC1mB,UAAU,CAAC2mB,gBAAhB,EAAkC;AAChC,IAAA,OAAOrlB,SAAP,CAAA;AACD,GAAA;;AACD,EAAM,MAAA;AAAE2D,IAAAA,QAAAA;AAAF,GAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;AACA,EAAA,MAAMm+B,IAAI,GAAGrmB,UAAU,CAACqmB,IAAxB,CAAA;AACA,EAAMO,MAAAA,aAAa,GAAGF,QAAQ,CAAC96B,MAAT,CACnBi7B,OAAD,IAAa5hB,QAAQ,CAAC/M,OAAT,CAAiB2uB,OAAjB,KAA6BR,IAAI,CAACnuB,OAAL,CAAa2uB,OAAb,CADtB,CAAtB,CAAA;;AAIA,EAAA,IAAI,CAACD,aAAa,CAACx9B,MAAnB,EAA2B;AACzB,IAAA,OAAO,IAAP,CAAA;AACD,GAFD,MAEO;AACL,IAAM,MAAA;AAAEmH,MAAAA,KAAF;AAASC,MAAAA,GAAAA;AAAT,KAAA,GAAiB8Q,SAAS,CAACiW,mBAAV,CAA8BtS,QAA9B,CAAvB,CAAA;AACA,IAAM6hB,MAAAA,kBAAkB,GAAG7hB,QAAQ,CAAChN,OAAT,CAAiB1H,KAAK,CAACtI,GAAvB,CAA3B,CAAA;AACA,IAAM8+B,MAAAA,gBAAgB,GAAG9hB,QAAQ,CAAChN,OAAT,CAAiBzH,GAAG,CAACvI,GAArB,CAAzB,CAAA;;AACA,IAAA,IAAI,CAAC6+B,kBAAD,IAAuB,CAACC,gBAA5B,EAA8C;AAC5C,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,MAAMC,eAAe,GAAGJ,aAAa,CAAC,CAAD,CAArC,CAAA;AACA,IAAMK,MAAAA,aAAa,GAAGL,aAAa,CAACA,aAAa,CAACx9B,MAAd,GAAuB,CAAxB,CAAnC,CAAA;AAEA,IAAA,IAAI89B,YAAJ,CAAA;AACA,IAAA,IAAIC,UAAJ,CAAA;;AACA,IAAA,IAAIliB,QAAQ,CAAC/M,OAAT,CAAiB8uB,eAAjB,CAAJ,EAAuC;AACrCE,MAAAA,YAAY,GAAGjiB,QAAQ,CAACrN,UAAT,CAAoBovB,eAApB,CAAqC,CAAA,CAArC,CAAf,CAAA;AACD,KAFD,MAEO;AACL,MAAA,MAAMV,WAAW,GAAGD,IAAI,CAAClvB,aAAL,CAAmB6vB,eAAnB,CAApB,CAAA;AACAE,MAAAA,YAAY,GAAGd,uBAAuB,CAACnhB,QAAD,EAAWohB,IAAX,EAAiBC,WAAjB,CAAvB,CAAqD,CAArD,CAAf,CAAA;AACD,KAAA;;AAED,IAAA,IAAIrhB,QAAQ,CAAC/M,OAAT,CAAiB+uB,aAAjB,CAAJ,EAAqC;AACnCE,MAAAA,UAAU,GAAGliB,QAAQ,CAACrN,UAAT,CAAoBqvB,aAApB,CAAmC,CAAA,CAAnC,CAAb,CAAA;AACD,KAFD,MAEO;AACL,MAAA,MAAMX,WAAW,GAAGD,IAAI,CAAClvB,aAAL,CAAmB8vB,aAAnB,CAApB,CAAA;AACAE,MAAAA,UAAU,GAAGZ,sBAAsB,CAACthB,QAAD,EAAWohB,IAAX,EAAiBC,WAAjB,CAAtB,CAAoD,CAApD,CAAb,CAAA;AACD,KAAA;;AAED,IAAA,MAAMc,cAAc,GAAGN,kBAAkB,CAAC,CAAD,CAAzC,CAAA;AACA,IAAA,MAAMO,YAAY,GAAGN,gBAAgB,CAAC,CAAD,CAArC,CAAA;;AAEA,IAAA,IAAIK,cAAc,GAAGD,UAAjB,IAA+BE,YAAY,GAAGH,YAAlD,EAAgE;AAC9D,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AAED,IAAII,IAAAA,GAAG,GAAGhmB,SAAV,CAAA;;AACA,IAAI8lB,IAAAA,cAAc,GAAGF,YAArB,EAAmC;AACjCI,MAAAA,GAAG,GAAGA,GAAG,CAACpH,sBAAJ,CACJjb,QAAQ,CAACpN,gBAAT,CAA0B,CAACqvB,YAAD,CAA1B,CADI,EAEJlnB,UAFI,CAAN,CAAA;AAID,KAAA;;AAED,IAAIqnB,IAAAA,YAAY,GAAGF,UAAnB,EAA+B;AAC7BG,MAAAA,GAAG,GAAGA,GAAG,CAAC7G,kBAAJ,CACJxb,QAAQ,CAACpN,gBAAT,CAA0B,CAACsvB,UAAD,CAA1B,CADI,EAEJnnB,UAFI,CAAN,CAAA;AAID,KAAA;;AAED,IAAA,OAAOsnB,GAAP,CAAA;AACD,GAAA;AACF;;AC9ND;;AAqBA,SAASC,mBAAT,CACEvnB,UADF,EAEE/X,GAFF,EAGEu/B,MAHF,EAIE;AACA,EAAM,MAAA;AAAEviB,IAAAA,QAAAA;AAAF,GAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;AACA,EAAA,MAAMgW,QAAQ,GAAGspB,MAAM,GACnBviB,QAAQ,CAACxL,eAAT,CAAyBxR,GAAzB,CADmB,GAEnBgd,QAAQ,CAACrL,WAAT,CAAqB3R,GAArB,CAFJ,CAAA;;AAGA,EAAA,IAAIiW,QAAJ,EAAc;AACZ,IAAM,MAAA;AAAEjW,MAAAA,GAAAA;AAAF,KAAA,GAAUiW,QAAhB,CAAA;AACA,IAAMnR,MAAAA,MAAM,GAAGy6B,MAAM,GAAGtpB,QAAQ,CAACnS,IAAT,CAAc3C,MAAjB,GAA0B,CAA/C,CAAA;AACA,IAAOib,OAAAA,SAAS,CAAC5a,MAAV,CAAiB;AAAExB,MAAAA,GAAF;AAAO8E,MAAAA,MAAAA;AAAP,KAAjB,CAAP,CAAA;AACD,GAAA;;AACD,EAAA,OAAOb,SAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,MAAMu7B,wBAAwB,GAAG,CAC/BznB,UAD+B,EAE/BkF,KAF+B,KAG5B;AACH,EAAA,IAAIA,KAAK,CAACL,WAAN,EAAJ,EAAyB;AACvB,IAAA,OAAOK,KAAP,CAAA;AACD,GAAA;;AACD,EAAIlF,IAAAA,UAAU,CAACoa,KAAX,CAAiB,gCAAjB,EAAmDlV,KAAnD,CAAJ,EAA+D;AAC7D,IAAA,OAAOA,KAAP,CAAA;AACD,GAAA;;AACD,EAAM,MAAA;AAAED,IAAAA,QAAAA;AAAF,GAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;AACA,EAAM,MAAA;AAAED,IAAAA,GAAF;AAAO8E,IAAAA,MAAAA;AAAP,GAAA,GAAkBmY,KAAxB,CAAA;AACA,EAAA,MAAMnZ,IAAI,GAAGkZ,QAAQ,CAACtN,OAAT,CAAiB1P,GAAjB,CAAb,CAAA;AACA,EAAMuM,MAAAA,MAAM,GAAGyQ,QAAQ,CAAC/I,SAAT,CAAmBjU,GAAnB,CAAf,CAVG;;AAaH,EAAI8E,IAAAA,MAAM,KAAK,CAAf,EAAkB;AAChB,IAAA,MAAMzF,IAAI,GAAG2d,QAAQ,CAACvM,kBAAT,CAA4BzQ,GAA5B,CAAb,CAAA;;AACA,IAAA,IAAIX,IAAI,IAAImQ,MAAM,CAACD,QAAP,CAAgBlQ,IAAhB,CAAR,IAAiC0Y,UAAU,CAACoa,KAAX,CAAiB,kBAAjB,EAAqC9yB,IAArC,CAArC,EAAiF;AAC/E,MAAOigC,OAAAA,mBAAmB,CAACvnB,UAAD,EAAa/X,GAAb,EAAkB,IAAlB,CAAnB,IAA8Cid,KAArD,CAAA;AACD,KAAA;AACF,GAlBE;;;AAqBH,EAAInZ,IAAAA,IAAI,IAAIgB,MAAM,KAAKhB,IAAI,CAACA,IAAL,CAAU3C,MAAjC,EAAyC;AACvC,IAAA,MAAM9B,IAAI,GAAG2d,QAAQ,CAACpM,cAAT,CAAwB5Q,GAAxB,CAAb,CAAA;;AACA,IAAA,IAAIX,IAAI,IAAImQ,MAAM,CAACD,QAAP,CAAgBlQ,IAAhB,CAAR,IAAiC0Y,UAAU,CAACoa,KAAX,CAAiB,kBAAjB,EAAqC9yB,IAArC,CAArC,EAAiF;AAC/E,MAAOigC,OAAAA,mBAAmB,CAACvnB,UAAD,EAAa/X,GAAb,EAAkB,KAAlB,CAAnB,IAA+Cid,KAAtD,CAAA;AACD,KAAA;AACF,GAAA;;AAED,EAAI,IAAA,CAAC1Q,MAAD,IAAW,CAACA,MAAM,CAACgD,QAAP,EAAZ,IAAiCwI,UAAU,CAACoa,KAAX,CAAiB,QAAjB,EAA2B5lB,MAA3B,CAAjC,IAAuEwL,UAAU,CAACoa,KAAX,CAAiB,kBAAjB,EAAqC5lB,MAArC,CAA3E,EAAyH;AACvH,IAAA,OAAO0Q,KAAP,CAAA;AACD,GAAA;;AACD,EAAInY,IAAAA,MAAM,KAAK,CAAX,IAAgBA,MAAM,KAAKyH,MAAM,CAACzI,IAAP,CAAY3C,MAA3C,EAAmD;AACjD,IAAA,OAAO8b,KAAP,CAAA;AACD,GAAA;;AACD,EAAOqiB,OAAAA,mBAAmB,CAACvnB,UAAD,EAAa/X,GAAb,EAAkB8E,MAAM,KAAK,CAA7B,CAAnB,IAAsDmY,KAA7D,CAAA;AACD,CAtCD,CAAA;AAwCA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,MAAMwiB,kBAAkB,GAAG,CACzB1nB,UADyB,EAEzBkF,KAFyB,EAGzByiB,OAHyB,KAItB;AACH,EAAA,IAAIziB,KAAK,CAACL,WAAN,EAAJ,EAAyB;AACvB,IAAA,OAAOK,KAAP,CAAA;AACD,GAAA;;AACD,EAAM,MAAA;AAAED,IAAAA,QAAAA;AAAF,GAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;AACA,EAAM,MAAA;AAAED,IAAAA,GAAAA;AAAF,GAAA,GAAUid,KAAhB,CAAA;AACA,EAAA,MAAM1Q,MAAM,GAAGyQ,QAAQ,CAAC1J,gBAAT,CAA0BtT,GAA1B,CAAf,CAAA;;AACA,EAAA,IAAI,CAACuM,MAAD,IAAW,CAACwL,UAAU,CAACoa,KAAX,CAAiB,QAAjB,EAA2B5lB,MAA3B,CAAhB,EAAoD;AAClD,IAAA,OAAO0Q,KAAP,CAAA;AACD,GAAA;;AACD,EAAOqiB,OAAAA,mBAAmB,CAACvnB,UAAD,EAAa/X,GAAb,EAAkB0/B,OAAlB,CAAnB,IAAiDziB,KAAxD,CAAA;AACD,CAfD,CAAA;;AAiBO,SAAS0K,KAAT,CAAe5P,UAAf,EAAuC;AAC5C,EAAA,IAAI,CAACA,UAAU,CAAC9X,KAAX,CAAiB0/B,SAAtB,EAAiC;AAC/B,IAAA,OAAO5nB,UAAU,CAAC6nB,YAAX,CAAwB,IAAxB,CAAP,CAAA;AACD,GAAA;;AACD,EAAA,OAAO7nB,UAAP,CAAA;AACD,CAAA;AAEM,SAAS8nB,IAAT,CAAc9nB,UAAd,EAAsC;AAC3C,EAAA,IAAIA,UAAU,CAAC9X,KAAX,CAAiB0/B,SAArB,EAAgC;AAC9B,IAAA,OAAO5nB,UAAU,CAAC6nB,YAAX,CAAwB,KAAxB,CAAP,CAAA;AACD,GAAA;;AACD,EAAA,OAAO7nB,UAAP,CAAA;AACD,CAAA;AAEM,SAAS+nB,MAAT,CAAgB/nB,UAAhB,EAAwCsB,SAAxC,EAA8D;AACnE,EAAM,MAAA;AAAEA,IAAAA,SAAS,EAAE0C,aAAAA;AAAb,GAA+BhE,GAAAA,UAAU,CAAC9X,KAAhD,CAAA;;AACA,EAAA,IAAIkC,yBAAK,CAACkX,SAAD,EAAY0C,aAAZ,CAAT,EAAqC;AACnC,IAAA,OAAOhE,UAAP,CAAA;AACD,GAAA;;AAED,EAAOA,OAAAA,UAAU,CAACgoB,cAAX,CAA0B;AAC/Bx/B,IAAAA,IAAI,EAAE8a,qBAAa,CAAC2kB,YADW;AAE/B3mB,IAAAA,SAAS,EAAEoO,SAAS,CAACjmB,MAAV,CAAiB6X,SAAjB,CAFoB;AAG/B0C,IAAAA,aAAAA;AAH+B,GAA1B,CAAP,CAAA;AAKD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASkkB,UAAT,CAAoBloB,UAApB,EAA4CsB,SAA5C,EAAkE;AACvE,EAAM,MAAA;AAAEA,IAAAA,SAAS,EAAE0C,aAAb;AAA4BiB,IAAAA,QAAAA;AAA5B,GAAyCjF,GAAAA,UAAU,CAAC9X,KAA1D,CAAA;;AACA,EAAA,IAAIkC,yBAAK,CAACkX,SAAD,EAAY0C,aAAZ,CAAT,EAAqC;AACnC,IAAA,OAAOhE,UAAP,CAAA;AACD,GAAA;;AAED,EAAM,MAAA;AAAE2P,IAAAA,MAAM,EAAEwY,WAAV;AAAuBvY,IAAAA,KAAK,EAAEwY,UAAAA;AAA9B,GAAA,GAA6C9mB,SAAnD,CAAA;AACA,EAAA,IAAIqO,MAAM,GAAG8X,wBAAwB,CAACznB,UAAD,EAAamoB,WAAb,CAArC,CAAA;AACA,EAAA,IAAIvY,KAAK,GAAG6X,wBAAwB,CAACznB,UAAD,EAAaooB,UAAb,CAApC,CAAA;;AACA,EAAI9mB,IAAAA,SAAS,CAAC2d,UAAd,EAA0B;AACxB,IAAA,MAAMf,SAAS,GAAG5c,SAAS,CAAC4c,SAAV,CAAoBjZ,QAApB,CAAlB,CAAA;AACA0K,IAAAA,MAAM,GAAG+X,kBAAkB,CAAC1nB,UAAD,EAAa2P,MAAb,EAAqBuO,SAArB,CAA3B,CAAA;AACAtO,IAAAA,KAAK,GAAG8X,kBAAkB,CAAC1nB,UAAD,EAAa4P,KAAb,EAAoB,CAACsO,SAArB,CAA1B,CAAA;AACD,GAAA;;AACD,EAAA,MAAMmK,kBAAkB,GAAG/mB,SAAS,CACjCrX,GADwB,CACpB,QADoB,EACV0lB,MADU,EAExB1lB,GAFwB,CAEpB,OAFoB,EAEX2lB,KAFW,CAA3B,CAAA;AAIA,EAAO5P,OAAAA,UAAU,CAACgoB,cAAX,CAA0B;AAC/Bx/B,IAAAA,IAAI,EAAE8a,qBAAa,CAAC2kB,YADW;AAE/B3mB,IAAAA,SAAS,EAAE+mB,kBAFoB;AAG/BrkB,IAAAA,aAAAA;AAH+B,GAA1B,CAAP,CAAA;AAKD,CAAA;AAEM,SAAS+a,iBAAT,CACL/e,UADK,EAELkF,KAFK,EAGL;AACA,EAAM,MAAA;AAAED,IAAAA,QAAAA;AAAF,GAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;AAEA,EAAMoZ,MAAAA,SAAS,GAAGoO,SAAS,CAACqP,iBAAV,CAA4B9Z,QAA5B,EAAsCC,KAAtC,CAAlB,CAAA;AACA,EAAO5D,OAAAA,SAAS,GAAGtB,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BzmB,SAA3B,CAAH,GAA2CtB,UAA3D,CAAA;AACD,CAAA;AAEM,SAAS4gB,kBAAT,CACL5gB,UADK,EAELpM,CAAC,GAAG,CAFC,EAGL8mB,IAHK,EAIL;AACA,EAAM,MAAA;AAAEpZ,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,MAAM24B,KAAK,GAAGkF,iBAAiB,CAAC/lB,UAAD,EAAa,QAAb,EAAuBpM,CAAvB,EAA0B8mB,IAAI,IAAI,QAAlC,CAA/B,CAAA;AACA,EAAO1a,OAAAA,UAAU,CAACsoB,OAAX,CAAmBJ,UAAnB,EAA+BrH,KAAK,CAACvf,SAAD,CAApC,CAAP,CAAA;AACD,CAAA;AAEM,SAASwf,iBAAT,CACL9gB,UADK,EAELpM,CAAC,GAAG,CAFC,EAGL8mB,IAHK,EAIL;AACA,EAAM,MAAA;AAAEpZ,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,MAAM24B,KAAK,GAAG+E,gBAAgB,CAAC5lB,UAAD,EAAa,QAAb,EAAuBpM,CAAvB,EAA0B8mB,IAAI,IAAI,QAAlC,CAA9B,CAAA;AACA,EAAA,MAAMoH,YAAY,GAAGjB,KAAK,CAACvf,SAAD,CAA1B,CAAA;AACA,EAAA,OAAOtB,UAAU,CAACsoB,OAAX,CAAmBJ,UAAnB,EAA+BpG,YAA/B,CAAP,CAAA;AACD,CAAA;AAEM,SAASzE,YAAT,CACLrd,UADK,EAELhN,IAFK,EAGLjG,MAHK,EAIL;AACA,EAAM,MAAA;AAAEuU,IAAAA,SAAF;AAAa2D,IAAAA,QAAAA;AAAb,GAA0BjF,GAAAA,UAAU,CAAC9X,KAA3C,CAAA;AACA,EAAM,MAAA;AAAED,IAAAA,GAAAA;AAAF,GAAA,GAAUgd,QAAQ,CAACpN,gBAAT,CAA0B7E,IAA1B,CAAhB,CAAA;AACA,EAAM8uB,MAAAA,YAAY,GAAGxgB,SAAS,CAAC+b,YAAV,CAAuBp1B,GAAvB,EAA4B8E,MAA5B,CAArB,CAAA;AACA,EAAA,OAAOiT,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BjG,YAA3B,CAAP,CAAA;AACD,CAAA;AAEM,SAASyG,eAAT,CACLvoB,UADK,EAEL/X,GAFK,EAGL8E,MAHK,EAIL;AACA,EAAMiG,MAAAA,IAAI,GAAGgN,UAAU,CAAC9X,KAAX,CAAiB+c,QAAjB,CAA0BrN,UAA1B,CAAqC3P,GAArC,CAAb,CAAA;AACA,EAAO+X,OAAAA,UAAU,CAACsoB,OAAX,CAAmBjL,YAAnB,EAAiCrqB,IAAjC,EAAuCjG,MAAvC,CAAP,CAAA;AACD,CAAA;AAEM,SAASy7B,wBAAT,CAAkCxoB,UAAlC,EAA0D;AAC/D,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACogB,kBAAV,CAA6B1hB,UAA7B,EAAyC,QAAzC,EAAmD,OAAnD,EAA4D,OAA5D,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAASyoB,gCAAT,CAA0CzoB,UAA1C,EAAkE;AACvE,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAO8X,OAAAA,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACygB,sBAAV,CACE/hB,UADF,EAEE,QAFF,EAGE,OAHF,EAIE,UAJF,EAKE,OALF,CAFK,CAAP,CAAA;AAUD,CAAA;AAEM,SAAS0oB,0BAAT,CAAoC1oB,UAApC,EAA4D;AACjE,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAO8X,OAAAA,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACygB,sBAAV,CACE/hB,UADF,EAEE,QAFF,EAGE,KAHF,EAIE,MAJF,EAKE,OALF,CAFK,CAAP,CAAA;AAUD,CAAA;AAEM,SAAS0gB,WAAT,CACL1gB,UADK,EAELhN,IAFK,EAGLjG,MAHK,EAIL;AACA,EAAM,MAAA;AAAEuU,IAAAA,SAAF;AAAa2D,IAAAA,QAAAA;AAAb,GAA0BjF,GAAAA,UAAU,CAAC9X,KAA3C,CAAA;AACA,EAAM,MAAA;AAAED,IAAAA,GAAAA;AAAF,GAAA,GAAUgd,QAAQ,CAACpN,gBAAT,CAA0B7E,IAA1B,CAAhB,CAAA;AACA,EAAM8uB,MAAAA,YAAY,GAAGxgB,SAAS,CAACof,WAAV,CAAsBz4B,GAAtB,EAA2B8E,MAA3B,CAArB,CAAA;AACA,EAAA,OAAOiT,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BjG,YAA3B,CAAP,CAAA;AACD,CAAA;AAEM,SAAS6G,cAAT,CACL3oB,UADK,EAEL/X,GAFK,EAGL8E,MAHK,EAIL;AACA,EAAMiG,MAAAA,IAAI,GAAGgN,UAAU,CAAC9X,KAAX,CAAiB+c,QAAjB,CAA0BrN,UAA1B,CAAqC3P,GAArC,CAAb,CAAA;AACA,EAAO+X,OAAAA,UAAU,CAACsoB,OAAX,CAAmB5H,WAAnB,EAAgC1tB,IAAhC,EAAsCjG,MAAtC,CAAP,CAAA;AACD,CAAA;AAEM,SAASyY,MAAT,CAAgBxF,UAAhB,EAAwChN,IAAxC,EAAoDjG,MAApD,EAAoE;AACzE,EAAA,OAAOiT,UAAU,CACdsoB,OADI,CACIjL,YADJ,EACkBrqB,IADlB,EACwBjG,MADxB,CAAA,CAEJu7B,OAFI,CAEI5H,WAFJ,EAEiB1tB,IAFjB,EAEuBjG,MAFvB,CAAP,CAAA;AAGD,CAAA;AAEM,SAAS67B,SAAT,CAAmB5oB,UAAnB,EAA2C/X,GAA3C,EAAwD8E,MAAxD,EAAwE;AAC7E,EAAMiG,MAAAA,IAAI,GAAGgN,UAAU,CAAC9X,KAAX,CAAiB+c,QAAjB,CAA0BrN,UAA1B,CAAqC3P,GAArC,CAAb,CAAA;AACA,EAAO+X,OAAAA,UAAU,CAACsoB,OAAX,CAAmB9iB,MAAnB,EAA2BxS,IAA3B,EAAiCjG,MAAjC,CAAP,CAAA;AACD,CAAA;AAEM,SAASg0B,iBAAT,CAA2B/gB,UAA3B,EAAmDpM,CAAC,GAAG,CAAvD,EAA0D;AAC/D,EAAM,MAAA;AAAE0N,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAM24B,MAAAA,KAAK,GAAGkF,iBAAiB,CAAC/lB,UAAD,EAAa,OAAb,EAAsBpM,CAAtB,EAAyB,QAAzB,CAA/B,CAAA;AACA,EAAOoM,OAAAA,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BlH,KAAK,CAACvf,SAAD,CAAhC,CAAP,CAAA;AACD,CAAA;AAEM,SAAS0f,gBAAT,CAA0BhhB,UAA1B,EAAkDpM,CAAC,GAAG,CAAtD,EAAyD;AAC9D,EAAM,MAAA;AAAE0N,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAM24B,MAAAA,KAAK,GAAG+E,gBAAgB,CAAC5lB,UAAD,EAAa,OAAb,EAAsBpM,CAAtB,EAAyB,QAAzB,CAA9B,CAAA;AACA,EAAOoM,OAAAA,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BlH,KAAK,CAACvf,SAAD,CAAhC,CAAP,CAAA;AACD,CAAA;AAEM,SAASunB,qBAAT,CAA+B7oB,UAA/B,EAAuD;AAC5D,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAM24B,MAAAA,KAAK,GAAGkF,iBAAiB,CAAC/lB,UAAD,EAAa,OAAb,EAAsB,CAAtB,EAAyB,MAAzB,CAA/B,CAAA;AACA,EAAOA,OAAAA,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BlH,KAAK,CAACvf,SAAD,CAAhC,CAAP,CAAA;AACD,CAAA;AAEM,SAASwnB,oBAAT,CAA8B9oB,UAA9B,EAAsD;AAC3D,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAM24B,MAAAA,KAAK,GAAG+E,gBAAgB,CAAC5lB,UAAD,EAAa,OAAb,EAAsB,CAAtB,EAAyB,MAAzB,CAA9B,CAAA;AACA,EAAOA,OAAAA,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BlH,KAAK,CAACvf,SAAD,CAAhC,CAAP,CAAA;AACD,CAAA;AAEM,SAASynB,oBAAT,CAA8B/oB,UAA9B,EAAsD;AAC3D,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACogB,kBAAV,CAA6B1hB,UAA7B,EAAyC,OAAzC,EAAkD,KAAlD,EAAyD,MAAzD,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAASgpB,uBAAT,CAAiChpB,UAAjC,EAAyD;AAC9D,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACogB,kBAAV,CAA6B1hB,UAA7B,EAAyC,OAAzC,EAAkD,OAAlD,EAA2D,OAA3D,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAASipB,qBAAT,CAA+BjpB,UAA/B,EAAuD;AAC5D,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACogB,kBAAV,CAA6B1hB,UAA7B,EAAyC,OAAzC,EAAkD,KAAlD,EAAyD,OAAzD,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAASkpB,0BAAT,CAAoClpB,UAApC,EAA4D;AACjE,EAAM,MAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CAAmBlI,sBAAnB,EAA2Cnb,QAA3C,CAAP,CAAA;AACD,CAAA;AAEM,SAASkkB,wBAAT,CAAkCnpB,UAAlC,EAA0D;AAC/D,EAAM,MAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAejF,GAAAA,UAAU,CAAC9X,KAAhC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CAAmB/H,oBAAnB,EAAyCtb,QAAzC,CAAP,CAAA;AACD,CAAA;AAEM,SAASoc,iBAAT,CAA2BrhB,UAA3B,EAAmDpM,CAAC,GAAG,CAAvD,EAA0D;AAC/D,EAAM,MAAA;AAAE0N,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAM24B,MAAAA,KAAK,GAAGkF,iBAAiB,CAAC/lB,UAAD,EAAa,OAAb,EAAsBpM,CAAtB,EAAyB,QAAzB,CAA/B,CAAA;AACA,EAAOoM,OAAAA,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BlH,KAAK,CAACvf,SAAD,CAAhC,CAAP,CAAA;AACD,CAAA;AAEM,SAASggB,gBAAT,CAA0BthB,UAA1B,EAAkDpM,CAAC,GAAG,CAAtD,EAAyD;AAC9D,EAAM,MAAA;AAAE0N,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAM24B,MAAAA,KAAK,GAAG+E,gBAAgB,CAAC5lB,UAAD,EAAa,OAAb,EAAsBpM,CAAtB,EAAyB,QAAzB,CAA9B,CAAA;AACA,EAAOoM,OAAAA,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BlH,KAAK,CAACvf,SAAD,CAAhC,CAAP,CAAA;AACD,CAAA;AAEM,SAASigB,eAAT,CAAyBvhB,UAAzB,EAAiDpM,CAAC,GAAG,CAArD,EAAwD;AAC7D,EAAM,MAAA;AAAE0N,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAM24B,MAAAA,KAAK,GAAGkF,iBAAiB,CAAC/lB,UAAD,EAAa,KAAb,EAAoBpM,CAApB,EAAuB,QAAvB,CAA/B,CAAA;AACA,EAAOoM,OAAAA,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BlH,KAAK,CAACvf,SAAD,CAAhC,CAAP,CAAA;AACD,CAAA;AAEM,SAASkgB,cAAT,CAAwBxhB,UAAxB,EAAgDpM,CAAC,GAAG,CAApD,EAAuD;AAC5D,EAAM,MAAA;AAAE0N,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAM24B,MAAAA,KAAK,GAAG+E,gBAAgB,CAAC5lB,UAAD,EAAa,KAAb,EAAoBpM,CAApB,EAAuB,QAAvB,CAA9B,CAAA;AACA,EAAOoM,OAAAA,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BlH,KAAK,CAACvf,SAAD,CAAhC,CAAP,CAAA;AACD,CAAA;AAEM,SAASwD,YAAT,CAAsB9E,UAAtB,EAA8CpM,CAAC,GAAG,CAAlD,EAAqD;AAC1D,EAAA,OAAOoM,UAAU,CACdsoB,OADI,CACI1H,kBADJ,EACwBhtB,CADxB,CAAA,CAEJ00B,OAFI,CAEIvH,iBAFJ,EAEuBntB,CAFvB,CAAP,CAAA;AAGD,CAAA;AAEM,SAASmR,WAAT,CAAqB/E,UAArB,EAA6CpM,CAAC,GAAG,CAAjD,EAAoD;AACzD,EAAA,OAAOoM,UAAU,CAACsoB,OAAX,CAAmBxH,iBAAnB,EAAsCltB,CAAtC,CAAA,CAAyC00B,OAAzC,CAAiDtH,gBAAjD,EAAmEptB,CAAnE,CAAP,CAAA;AACD,CAAA;AAEM,SAASw1B,wBAAT,CAAkCppB,UAAlC,EAA0D;AAC/D,EAAOA,OAAAA,UAAU,CAACsoB,OAAX,CAAmBe,6BAAnB,CAAkDf,CAAAA,OAAlD,CAA0DpH,WAA1D,CAAP,CAAA;AACD,CAAA;AAEM,SAASoI,oBAAT,CAA8BtpB,UAA9B,EAAsD;AAC3D,EAAOA,OAAAA,UAAU,CAACsoB,OAAX,CAAmBiB,uBAAnB,CAA4CjB,CAAAA,OAA5C,CAAoDrI,SAApD,CAAP,CAAA;AACD,CAAA;AAEM,SAASuJ,iBAAT,CAA2BxpB,UAA3B,EAAmD;AACxD,EAAOA,OAAAA,UAAU,CAACsoB,OAAX,CAAmBmB,oBAAnB,CAAyCnB,CAAAA,OAAzC,CAAiDrI,SAAjD,CAAP,CAAA;AACD,CAAA;AAEM,SAAS3C,YAAT,CAAsBtd,UAAtB,EAA8C;AACnD,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAO8X,OAAAA,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BzmB,SAAS,CAACgc,YAAV,EAA3B,CAAP,CAAA;AACD,CAAA;AAEM,SAAS2D,WAAT,CAAqBjhB,UAArB,EAA6C;AAClD,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAO8X,OAAAA,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BzmB,SAAS,CAAC2f,WAAV,EAA3B,CAAP,CAAA;AACD,CAAA;AAEM,SAASyI,qBAAT,CAA+B1pB,UAA/B,EAAuD;AAC5D,EAAOA,OAAAA,UAAU,CAACsoB,OAAX,CAAmBnH,iBAAnB,EAAsCnhB,UAAU,CAAC9X,KAAX,CAAiB+c,QAAvD,CAAP,CAAA;AACD,CAAA;AAEM,SAASkc,iBAAT,CAA2BnhB,UAA3B,EAAmD1Y,IAAnD,EAA+D;AACpE,EAAM,MAAA;AAAEga,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAAC6f,iBAAV,CAA4B75B,IAA5B,EAAkC0Y,UAAlC,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAASkhB,WAAT,CAAqBlhB,UAArB,EAA6C;AAClD,EAAM,MAAA;AAAEiF,IAAAA,QAAF;AAAY3D,IAAAA,SAAAA;AAAZ,GAA0BtB,GAAAA,UAAU,CAAC9X,KAA3C,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BzmB,SAAS,CAAC4f,WAAV,CAAsBjc,QAAtB,CAA3B,CAAP,CAAA;AACD,CAAA;AAEM,SAASgb,SAAT,CAAmBjgB,UAAnB,EAA2C;AAChD,EAAM,MAAA;AAAEiF,IAAAA,QAAF;AAAY3D,IAAAA,SAAAA;AAAZ,GAA0BtB,GAAAA,UAAU,CAAC9X,KAA3C,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BzmB,SAAS,CAAC2e,SAAV,CAAoBhb,QAApB,CAA3B,CAAP,CAAA;AACD,CAAA;AAEM,SAASyY,mBAAT,CAA6B1d,UAA7B,EAAqD;AAC1D,EAAA,OAAOA,UAAU,CACdsoB,OADI,CACI7H,kBADJ,EACwBzgB,UAAU,CAAC9X,KAAX,CAAiB+c,QADzC,CAAA,CAEJqjB,OAFI,CAEIrI,SAFJ,CAAP,CAAA;AAGD,CAAA;AAEM,SAAS0J,mBAAT,CAA6B3pB,UAA7B,EAAqD;AAC1D,EAAOA,OAAAA,UAAU,CAACsoB,OAAX,CAAmBsB,wBAAnB,CAA6CtB,CAAAA,OAA7C,CAAqDpH,WAArD,CAAP,CAAA;AACD,CAAA;AAEM,SAAS2I,kBAAT,CAA4B7pB,UAA5B,EAAoD;AACzD,EAAOA,OAAAA,UAAU,CAACsoB,OAAX,CAAmBwB,uBAAnB,CAA4CxB,CAAAA,OAA5C,CAAoDpH,WAApD,CAAP,CAAA;AACD,CAAA;AAEM,SAAS6I,gBAAT,CAA0B/pB,UAA1B,EAAkD;AACvD,EAAOA,OAAAA,UAAU,CAACsoB,OAAX,CAAmB0B,mBAAnB,CAAwC1B,CAAAA,OAAxC,CAAgDrI,SAAhD,CAAP,CAAA;AACD,CAAA;AAEM,SAASvb,eAAT,CAAyB1E,UAAzB,EAAiD1Y,IAAjD,EAA6D;AAClE,EAAM,MAAA;AAAEga,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACoD,eAAV,CAA0Bpd,IAA1B,EAAgC0Y,UAAhC,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAAS4pB,wBAAT,CAAkC5pB,UAAlC,EAA0D;AAC/D,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACogB,kBAAV,CAA6B1hB,UAA7B,EAAyC,OAAzC,EAAkD,OAAlD,EAA2D,QAA3D,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAAS8pB,uBAAT,CAAiC9pB,UAAjC,EAAyD;AAC9D,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACogB,kBAAV,CAA6B1hB,UAA7B,EAAyC,OAAzC,EAAkD,OAAlD,EAA2D,OAA3D,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAASiqB,+BAAT,CAAyCjqB,UAAzC,EAAiE;AACtE,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAO8X,OAAAA,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACygB,sBAAV,CACE/hB,UADF,EAEE,OAFF,EAGE,OAHF,EAIE,UAJF,EAKE,OALF,CAFK,CAAP,CAAA;AAUD,CAAA;AAEM,SAASgqB,mBAAT,CAA6BhqB,UAA7B,EAAqD;AAC1D,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACogB,kBAAV,CAA6B1hB,UAA7B,EAAyC,KAAzC,EAAgD,KAAhD,EAAuD,OAAvD,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAASkd,qBAAT,CAA+Bld,UAA/B,EAAuD;AAC5D,EAAM,MAAA;AAAEiF,IAAAA,QAAF;AAAY3D,IAAAA,SAAAA;AAAZ,GAA0BtB,GAAAA,UAAU,CAAC9X,KAA3C,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAAC8e,sBAAV,CAAiCnb,QAAjC,EAA2CjF,UAA3C,CAAuDihB,CAAAA,WAAvD,EAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAASZ,oBAAT,CAA8BrgB,UAA9B,EAAsD1Y,IAAtD,EAAkE;AACvE,EAAM,MAAA;AAAEga,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAAC+e,oBAAV,CAA+B/4B,IAA/B,EAAqC0Y,UAArC,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAASmgB,uBAAT,CAAiCngB,UAAjC,EAAyD1Y,IAAzD,EAAqE;AAC1E,EAAM,MAAA;AAAEga,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAAC6e,uBAAV,CAAkC74B,IAAlC,EAAwC0Y,UAAxC,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAASsgB,qBAAT,CAA+BtgB,UAA/B,EAAuD1Y,IAAvD,EAAmE;AACxE,EAAM,MAAA;AAAEga,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACgf,qBAAV,CAAgCh5B,IAAhC,EAAsC0Y,UAAtC,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAASogB,sBAAT,CAAgCpgB,UAAhC,EAAwD1Y,IAAxD,EAAoE;AACzE,EAAM,MAAA;AAAEga,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAAC8e,sBAAV,CAAiC94B,IAAjC,EAAuC0Y,UAAvC,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAASugB,oBAAT,CAA8BvgB,UAA9B,EAAsD1Y,IAAtD,EAAkE;AACvE,EAAM,MAAA;AAAEga,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACif,oBAAV,CAA+Bj5B,IAA/B,EAAqC0Y,UAArC,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAASkqB,uBAAT,CAAiClqB,UAAjC,EAAyD;AAC9D,EAAOA,OAAAA,UAAU,CAACsoB,OAAX,CAAmB6B,4BAAnB,CAAiD7B,CAAAA,OAAjD,CAAyDpH,WAAzD,CAAP,CAAA;AACD,CAAA;AAEM,SAASkJ,qBAAT,CAA+BpqB,UAA/B,EAAuD;AAC5D,EAAOA,OAAAA,UAAU,CAACsoB,OAAX,CAAmB+B,wBAAnB,CAA6C/B,CAAAA,OAA7C,CAAqDrI,SAArD,CAAP,CAAA;AACD,CAAA;AAEM,SAASqK,0BAAT,CAAoCtqB,UAApC,EAA4D;AACjE,EAAOA,OAAAA,UAAU,CACdsoB,OADI,CACI2B,+BADJ,CAEJ3B,CAAAA,OAFI,CAEIpH,WAFJ,CAAP,CAAA;AAGD,CAAA;AAEM,SAASqJ,sBAAT,CAAgCvqB,UAAhC,EAAwD;AAC7D,EAAOA,OAAAA,UAAU,CAACsoB,OAAX,CAAmBkC,yBAAnB,CAA8ClC,CAAAA,OAA9C,CAAsDrI,SAAtD,CAAP,CAAA;AACD,CAAA;AAEM,SAASzb,iBAAT,CAA2BxE,UAA3B,EAAmD1Y,IAAnD,EAA+D;AACpE,EAAM,MAAA;AAAEga,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACkD,iBAAV,CAA4Bld,IAA5B,EAAkC0Y,UAAlC,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAASkgB,sBAAT,CAAgClgB,UAAhC,EAAwD1Y,IAAxD,EAAoE;AACzE,EAAM,MAAA;AAAEga,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAAC4e,sBAAV,CAAiC54B,IAAjC,EAAuC0Y,UAAvC,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAASwgB,oBAAT,CAA8BxgB,UAA9B,EAAsD1Y,IAAtD,EAAkE;AACvE,EAAM,MAAA;AAAEga,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACkf,oBAAV,CAA+Bl5B,IAA/B,EAAqC0Y,UAArC,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAASygB,kBAAT,CAA4BzgB,UAA5B,EAAoD1Y,IAApD,EAAgE;AACrE,EAAM,MAAA;AAAEga,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACmf,kBAAV,CAA6Bn5B,IAA7B,EAAmC0Y,UAAnC,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAASmqB,4BAAT,CAAsCnqB,UAAtC,EAA8D;AACnE,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAO8X,OAAAA,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACygB,sBAAV,CACE/hB,UADF,EAEE,OAFF,EAGE,KAHF,EAIE,UAJF,EAKE,MALF,CAFK,CAAP,CAAA;AAUD,CAAA;AAEM,SAASqpB,6BAAT,CAAuCrpB,UAAvC,EAA+D;AACpE,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAO8X,OAAAA,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACygB,sBAAV,CACE/hB,UADF,EAEE,OAFF,EAGE,KAHF,EAIE,UAJF,EAKE,OALF,CAFK,CAAP,CAAA;AAUD,CAAA;AAEM,SAASypB,oBAAT,CAA8BzpB,UAA9B,EAAsD;AAC3D,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,OAAO8X,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACogB,kBAAV,CAA6B1hB,UAA7B,EAAyC,KAAzC,EAAgD,KAAhD,EAAuD,QAAvD,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAASqqB,wBAAT,CAAkCrqB,UAAlC,EAA0D;AAC/D,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAO8X,OAAAA,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACygB,sBAAV,CACE/hB,UADF,EAEE,KAFF,EAGE,OAHF,EAIE,MAJF,EAKE,MALF,CAFK,CAAP,CAAA;AAUD,CAAA;AAEM,SAASwqB,yBAAT,CAAmCxqB,UAAnC,EAA2D;AAChE,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAO8X,OAAAA,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACygB,sBAAV,CACE/hB,UADF,EAEE,KAFF,EAGE,OAHF,EAIE,MAJF,EAKE,OALF,CAFK,CAAP,CAAA;AAUD,CAAA;AAEM,SAASupB,uBAAT,CAAiCvpB,UAAjC,EAAyD;AAC9D,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAO8X,OAAAA,UAAU,CAACsoB,OAAX,CACLP,MADK,EAELzmB,SAAS,CAACygB,sBAAV,CAAiC/hB,UAAjC,EAA6C,KAA7C,EAAoD,KAApD,EAA2D,MAA3D,EAAmE,OAAnE,CAFK,CAAP,CAAA;AAID,CAAA;AAEM,SAASyqB,gBAAT,CAA0BzqB,UAA1B,EAAkD;AACvD,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,MAAM24B,KAAK,GAAGmF,qBAAqB,CAAChmB,UAAD,EAAa,OAAb,CAAnC,CAAA;AACA,EAAA,OAAOA,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BlH,KAAK,CAACvf,SAAD,CAAhC,CAAA,CAA6CgnB,OAA7C,CAAqDrH,WAArD,CAAP,CAAA;AACD,CAAA;AAEM,SAASyJ,eAAT,CAAyB1qB,UAAzB,EAAiD;AACtD,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,MAAM24B,KAAK,GAAGqF,oBAAoB,CAAClmB,UAAD,EAAa,OAAb,CAAlC,CAAA;AACA,EAAA,OAAOA,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BlH,KAAK,CAACvf,SAAD,CAAhC,CAAA,CAA6CgnB,OAA7C,CAAqDrH,WAArD,CAAP,CAAA;AACD;;ACjqBD;AACA;AACA;AACA;AASA;AACA;AACA;AACA;;AACO,SAAS0J,eAAT,CAAyB3qB,UAAzB,EAAiD/X,GAAjD,EAA8D;AACnE,EAAM,MAAA;AAAEC,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAA,GAAe/c,KAArB,CAAA;AACA,EAAA,MAAM8K,IAAI,GAAGiS,QAAQ,CAACrN,UAAT,CAAoB3P,GAApB,CAAb,CAAA;AACA,EAAA,OAAO+X,UAAU,CAACsoB,OAAX,CAAmBsC,gBAAnB,EAAqC53B,IAArC,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;;AACO,SAAS43B,gBAAT,CAA0B5qB,UAA1B,EAAkDhN,IAAlD,EAA8D;AACnE,EAAM,MAAA;AAAEiS,IAAAA,QAAQ,EAAE4lB,MAAAA;AAAZ,GAAuB7qB,GAAAA,UAAU,CAAC9X,KAAxC,CAAA;AACA,EAAA,MAAMZ,IAAI,GAAGujC,MAAM,CAAChzB,gBAAP,CAAwB7E,IAAxB,CAAb,CAAA;AAEA,EAAM,MAAA;AAAEsO,IAAAA,SAAF;AAAa2D,IAAAA,QAAAA;AAAb,GAA0BjF,GAAAA,UAAU,CAAC9X,KAA3C,CAAA;AACA,EAAA,MAAM4gB,IAAI,GAAG7D,QAAQ,CAACjM,qBAAT,CAA+BhG,IAA/B,CAAb,CAAA;AACA,EAAA,MAAMrG,IAAI,GAAGsY,QAAQ,CAAC5L,iBAAT,CAA2BrG,IAA3B,CAAb,CAAA;;AACA,EAAM83B,MAAAA,QAAQ,GAAI5lB,KAAD,IAAkC;AACjD,IAAI5d,IAAAA,IAAI,CAACW,GAAL,KAAaid,KAAK,CAACjd,GAAnB,IAA2BX,IAAI,CAAC2B,SAAL,EAAoB3B,IAAAA,IAAI,CAAC4Q,OAAL,CAAagN,KAAK,CAACjd,GAAnB,CAAnD,EAA6E;AAC3E,MAAA,IAAI6gB,IAAJ,EAAU;AACR,QAAA,OAAO9I,UAAU,CAACoa,KAAX,CAAiB0B,gBAAjB,EAAmChT,IAAnC,CAAP,CAAA;AACD,OAAA;;AACD,MAAA,IAAInc,IAAJ,EAAU;AACR,QAAA,OAAOqT,UAAU,CAACoa,KAAX,CAAiByB,kBAAjB,EAAqClvB,IAArC,CAAP,CAAA;AACD,OAAA;AACF,KAAA;;AACD,IAAA,OAAOuY,KAAP,CAAA;AACD,GAVD,CAAA;;AAWA,EAAI4c,IAAAA,YAAY,GAAGxgB,SAAnB,CAAA;;AACA,EAAIwH,IAAAA,IAAI,IAAInc,IAAZ,EAAkB;AAChB;AACA;AACA;AACA,IAAA,MAAMgjB,MAAM,GAAGmb,QAAQ,CAACxpB,SAAS,CAACqO,MAAX,CAAvB,CAAA;AACA,IAAA,MAAMC,KAAK,GAAGkb,QAAQ,CAACxpB,SAAS,CAACsO,KAAX,CAAtB,CAAA;AACAkS,IAAAA,YAAY,GAAGpS,SAAS,CAACjmB,MAAV,CAAiB;AAC9BkmB,MAAAA,MAD8B;AAE9BC,MAAAA,KAAAA;AAF8B,KAAjB,CAAf,CAAA;AAID,GA7BkE;;;AA+BnE5P,EAAAA,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BjG,YAA3B,CAAA,CAAA;AACA9hB,EAAAA,UAAU,CAACgoB,cAAX,CAA0B;AACxBx/B,IAAAA,IAAI,EAAE8a,qBAAa,CAACynB,UADI;AAExB/3B,IAAAA,IAFwB;AAGxB1L,IAAAA,IAAI,EAAEA,IAAAA;AAHkB,GAA1B,CAAA,CAAA;;AAKA,EAAIw6B,IAAAA,YAAY,KAAKxgB,SAArB,EAAgC;AAC9B,IAAA,OAAOtB,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BjG,YAA3B,CAAP,CAAA;AACD,GAAA;;AACD,EAAA,OAAO9hB,UAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;;AACO,SAASgrB,eAAT,CACLhrB,UADK,EAEL/X,GAFK,EAGL8E,MAHK,EAILhB,IAJK,EAKL;AACA,EAAM,MAAA;AAAE7D,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAA,GAAe/c,KAArB,CAAA;AACA,EAAA,MAAM8K,IAAI,GAAGiS,QAAQ,CAACrN,UAAT,CAAoB3P,GAApB,CAAb,CAAA;AACA,EAAO+X,OAAAA,UAAU,CAACsoB,OAAX,CAAmB2C,gBAAnB,EAAqCj4B,IAArC,EAA2CjG,MAA3C,EAAmDhB,IAAnD,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;;AACO,SAASk/B,gBAAT,CACLjrB,UADK,EAELhN,IAFK,EAGLjG,MAHK,EAILhB,IAJK,EAKL;AACA,EAAM,MAAA;AAAE7D,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAE9P,IAAAA,WAAF;AAAe+U,IAAAA,QAAAA;AAAf,GAAA,GAA4B/c,KAAlC,CAAA;AACA,EAAA,MAAMZ,IAAI,GAAG2d,QAAQ,CAAClN,gBAAT,CAA0B/E,IAA1B,CAAb,CAAA;AAEA,EAAIk4B,IAAAA,OAAO,GAAG,KAAd,CAAA;AACA,EAAM,MAAA;AAAEjjC,IAAAA,GAAF;AAAOoE,IAAAA,MAAAA;AAAP,GAAA,GAAkB/E,IAAxB,CAAA;AACA,EAAM6f,MAAAA,IAAI,GAAGpa,MAAb,CAAA;AACA,EAAM+sB,MAAAA,EAAE,GAAG/sB,MAAM,GAAGhB,IAAI,CAAC3C,MAAzB,CARA;;AAWA,EAAA,MAAM+hC,IAAI,GAAGj7B,WAAW,CAACtE,MAAZ,CAAoB0E,GAAD,IAAS;AACvC,IAAM,MAAA;AAAEC,MAAAA,KAAF;AAASC,MAAAA,GAAT;AAAcrG,MAAAA,IAAAA;AAAd,KAAA,GAAuBmG,GAA7B,CAAA;AACA,IAAM86B,MAAAA,QAAQ,GAAGprB,UAAU,CAACoa,KAAX,CAAiB,UAAjB,EAA6BjwB,IAA7B,CAAjB,CAAA;AACA,IAAA,IAAI,CAACihC,QAAL,EAAe,OAAO,IAAP,CAAA;AACf,IAAA,IAAI76B,KAAK,CAACtI,GAAN,KAAcA,GAAlB,EAAuB,OAAO,IAAP,CAAA;;AAEvB,IAAA,IAAIsI,KAAK,CAACxD,MAAN,GAAeoa,IAAf,KAAwB3W,GAAG,CAACvI,GAAJ,KAAYA,GAAZ,IAAmBuI,GAAG,CAACzD,MAAJ,GAAaoa,IAAxD,CAAJ,EAAmE;AACjE+jB,MAAAA,OAAO,GAAG,IAAV,CAAA;AACA,MAAA,OAAO,KAAP,CAAA;AACD,KAAA;;AAED,IAAA,IAAI36B,KAAK,CAACxD,MAAN,GAAe+sB,EAAf,KAAsBtpB,GAAG,CAACvI,GAAJ,KAAYA,GAAZ,IAAmBuI,GAAG,CAACzD,MAAJ,GAAa+sB,EAAtD,CAAJ,EAA+D;AAC7DoR,MAAAA,OAAO,GAAG,IAAV,CAAA;AACA,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AAED,IAAA,OAAO,IAAP,CAAA;AACD,GAjBY,CAAb,CAAA;;AAmBA,EAAA,IAAIA,OAAJ,EAAa;AACXlrB,IAAAA,UAAU,CAACqrB,cAAX,CAA0BF,IAA1B,CAAA,CAAA;AACD,GAAA;;AAED,EAAMG,MAAAA,QAA+B,GAAG,EAAxC,CAAA;AACA,EAAIC,IAAAA,MAAM,GAAG,CAAb,CAAA;AAEAl/B,EAAAA,MAAM,CAACgE,OAAP,CAAgB3D,IAAD,IAAU;AACvB,IAAM8+B,MAAAA,WAAW,GAAGD,MAApB,CAAA;AACA,IAAME,MAAAA,SAAS,GAAGF,MAAM,GAAG7+B,IAAI,CAACX,IAAL,CAAU3C,MAArC,CAAA;AAEAmiC,IAAAA,MAAM,IAAI7+B,IAAI,CAACX,IAAL,CAAU3C,MAApB,CAJuB;;AAOvB,IAAIqiC,IAAAA,SAAS,GAAGtkB,IAAZ,IAAoB2S,EAAE,GAAG0R,WAA7B,EAA0C,OAPnB;;AAUvB,IAAMj7B,MAAAA,KAAK,GAAG2C,IAAI,CAAC+d,GAAL,CAASua,WAAT,EAAsBrkB,IAAtB,CAAd,CAAA;AACA,IAAM3W,MAAAA,GAAG,GAAG0C,IAAI,CAACC,GAAL,CAASs4B,SAAT,EAAoB3R,EAApB,CAAZ,CAAA;AACA,IAAMjR,MAAAA,MAAM,GAAGvhB,IAAI,CAACyE,IAAL,CAAUlB,KAAV,CAAgB0F,KAAhB,EAAuBC,GAAvB,CAAf,CAAA;AAEA86B,IAAAA,QAAQ,CAAC38B,IAAT,CAAc;AACZnG,MAAAA,IAAI,EAAE8a,qBAAa,CAACooB,UADR;AAEZ14B,MAAAA,IAFY;AAGZjG,MAAAA,MAAM,EAAEwD,KAHI;AAIZxE,MAAAA,IAAI,EAAE8c,MAJM;AAKZ7c,MAAAA,KAAK,EAAEU,IAAI,CAACV,KAAAA;AALA,KAAd,CAAA,CAAA;AAOD,GArBD,CAAA,CAAA;AAuBAgU,EAAAA,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2B7/B,KAAK,CAACoZ,SAAjC,CAAA,CAAA;AACAgqB,EAAAA,QAAQ,CAAC7yB,OAAT,EAAA,CAAmBpI,OAAnB,CAA4Bs7B,EAAD,IAAQ3rB,UAAU,CAACgoB,cAAX,CAA0B2D,EAA1B,CAAnC,CAAA,CAAA;AACA,EAAA,OAAO3rB,UAAP,CAAA;AACD;;AC/JD;AACA;AACA;AACA;AAKA;AACA;AACA;AACA;;AACO,SAAS4rB,aAAT,CACL5rB,UADK,EAEL/X,GAFK,EAGLuQ,SAHK,EAIL9N,KAJK,EAKL;AACA,EAAM,MAAA;AAAExC,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAA,GAAe/c,KAArB,CAAA;AACA,EAAA,MAAM8K,IAAI,GAAGiS,QAAQ,CAACrN,UAAT,CAAoB3P,GAApB,CAAb,CAAA;AACA,EAAA,MAAMiR,UAAU,GAAG+L,QAAQ,CAACrN,UAAT,CAAoBY,SAApB,CAAnB,CAAA;AACA,EAAOwH,OAAAA,UAAU,CAACsoB,OAAX,CAAmBuD,cAAnB,EAAmC74B,IAAnC,EAAyCkG,UAAzC,EAAqDxO,KAArD,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;;AACO,SAASmhC,cAAT,CACL7rB,UADK,EAELhN,IAFK,EAGLkG,UAHK,EAILxO,KAJK,EAKL;AACA,EAAIoI,IAAAA,IAAI,CAAC5I,OAAL,CAAa8I,IAAb,EAAmBkG,UAAnB,CAAJ,EAAoC;AAClC,IAAA,OAAO8G,UAAP,CAAA;AACD,GAAA;;AAED,EAAA,MAAMlM,OAAO,GAAGoF,UAAU,CAACnI,MAAX,CAAkBrG,KAAlB,CAAhB,CAAA;;AAEA,EAAIoI,IAAAA,IAAI,CAAC5I,OAAL,CAAa8I,IAAb,EAAmBc,OAAnB,CAAJ,EAAiC;AAC/B,IAAA,OAAOkM,UAAP,CAAA;AACD,GAAA;;AAED,EAAOA,OAAAA,UAAU,CAACgoB,cAAX,CAA0B;AAC/Bx/B,IAAAA,IAAI,EAAE8a,qBAAa,CAACwoB,QADW;AAE/B94B,IAAAA,IAF+B;AAG/Bc,IAAAA,OAAAA;AAH+B,GAA1B,CAAP,CAAA;AAKD;;AClDD;AASO,SAASi4B,cAAT,CAAwB/rB,UAAxB,EAAgD;AACrD,EAAM,MAAA;AAAE9X,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAA,GAAgBpZ,KAAtB,CAAA;;AAEA,EAAIoZ,IAAAA,SAAS,CAAC2d,UAAd,EAA0B;AACxBjf,IAAAA,UAAU,CAACsoB,OAAX,CAAmB0D,GAAnB,CAAA,CAAA;AACD,GAAA;AACF,CAAA;AAED;AACA;AACA;;AACO,SAASC,qBAAT,CACLjsB,UADK,EAELoU,KAFK,EAGM;AACX,EAAM,MAAA;AAAElsB,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAA,GAAe/c,KAArB,CAAA;AACA,EAAM,MAAA;AAAEqI,IAAAA,KAAF;AAASC,IAAAA,GAAAA;AAAT,GAAA,GAAiB4jB,KAAK,CAACwL,IAAN,CAAW3a,QAAX,CAAvB,CAAA;;AACA,EAAImP,IAAAA,KAAK,CAAC6K,UAAV,EAAsB;AACpBjf,IAAAA,UAAU,CAACsoB,OAAX,CAAmB,eAAnB,EAAoClU,KAApC,CAAA,CAAA;AACD,GAAA;;AAED,EAAM,MAAA;AAAEnP,IAAAA,QAAQ,EAAEinB,WAAAA;AAAZ,GAA4BlsB,GAAAA,UAAU,CAAC9X,KAA7C,CAAA;;AACA,EAAIgkC,IAAAA,WAAW,CAACv0B,OAAZ,CAAoBpH,KAAK,CAACtI,GAA1B,CAAJ,EAAoC;AAClCmsB,IAAAA,KAAK,GAAGA,KAAK,CAACpqB,KAAN,CAAY;AAClB2lB,MAAAA,MAAM,EAAEpf,KADU;AAElBqf,MAAAA,KAAK,EAAErf,KAAAA;AAFW,KAAZ,CAAR,CAAA;AAID,GALD,MAKO;AACL,IAAA,MAAM2U,KAAK,GAAG1U,GAAG,CAACoU,WAAJ,EAAoBpU,GAAAA,GAAG,CAACvG,GAAJ,CAAQ,QAAR,EAAkB,CAAlB,CAApB,GAA2CuG,GAAzD,CAAA;AACA4jB,IAAAA,KAAK,GAAGA,KAAK,CAACpqB,KAAN,CAAY;AAClB2lB,MAAAA,MAAM,EAAEzK,KADU;AAElB0K,MAAAA,KAAK,EAAE1K,KAAAA;AAFW,KAAZ,CAAR,CAAA;AAID,GAAA;;AAED,EAAA,OAAOkP,KAAP,CAAA;AACD;;AC3CD,MAAM+X,MAAM,GAAG,eAAf,CAAA;AAEO,MAAMC,QAAQ,GAAG,CAAC9kC,IAAD,EAAa0L,IAAb,EAAyBP,QAAzB,KACrB,CAAE05B,EAAAA,MAAO,GAAE7kC,IAAI,CAAC0B,MAAL,EAAA,GAAgB,MAAhB,GAAyB,MAAO,CAAA,CAAA,EAAGk2B,IAAI,CAACC,SAAL,CAAe,CAC5DnsB,IAD4D,EAE5DP,QAF4D,CAAf,CAG5C,CAJE,CAAA;;ACNP;AAuBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAAS45B,qBAAT,CACLrsB,UADK,EAEL/X,GAFK,EAGLqkC,OAHK,EAILC,UAJK,EAKL;AACA,EAAM,MAAA;AAAErkC,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAA,GAAe/c,KAArB,CAAA;AACA,EAAA,MAAM8K,IAAI,GAAGiS,QAAQ,CAACrN,UAAT,CAAoB3P,GAApB,CAAb,CAAA;AACA,EAAA,MAAMukC,QAAQ,GAAGvnB,QAAQ,CAACrN,UAAT,CAAoB00B,OAApB,CAAjB,CAAA;AACA,EAAOtsB,OAAAA,UAAU,CAACsoB,OAAX,CACL,wBADK,EAELt1B,IAFK,EAGLw5B,QAHK,EAILD,UAJK,CAAP,CAAA;AAMD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASE,sBAAT,CACLzsB,UADK,EAELhN,IAFK,EAGLw5B,QAHK,EAILD,UAJK,EAKL;AACA,EAAA,IAAIniC,yBAAK,CAAC4I,IAAD,EAAOw5B,QAAP,CAAT,EAA2B;AACzBxsB,IAAAA,UAAU,CAACsoB,OAAX,CAAmBoE,eAAnB,EAAoCF,QAApC,EAA8CD,UAA9C,CAAA,CAAA;AACA,IAAA,OAAOvsB,UAAP,CAAA;AACD,GAAA;;AAED,EAAM,MAAA;AAAE9X,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAe/c,GAAAA,KAArB,CAPA;;AASA,EAAA,MAAMZ,IAAI,GAAG2d,QAAQ,CAACpN,gBAAT,CAA0B7E,IAA1B,CAAb,CAAA;AACA,EAAA,MAAMjH,IAAI,GAAGkZ,QAAQ,CAACpN,gBAAT,CAA0B20B,QAA1B,CAAb,CAAA;AACA,EAAA,MAAMt3B,SAAS,GAAG+P,QAAQ,CAACtK,kBAAT,CAA4B6xB,QAA5B,CAAlB,CAAA;AACA,EAAA,IAAIG,QAAQ,GAAGz3B,SAAS,CAACrK,KAAV,EAAf,CAAA;AACA8hC,EAAAA,QAAQ,GAAGC,gBAAS,CAACD,QAAD,EAAY/hC,CAAD,IAAOA,CAAC,CAAC3C,GAAF,KAAUX,IAAI,CAAEW,GAAlC,CAAT,CAAgDwQ,OAAhD,EAAX,CAAA;AAEA,EAAA,OAAOuH,UAAU,CAAC6sB,kBAAX,CAA8B,MAAM;AACzC7sB,IAAAA,UAAU,CAACsoB,OAAX,CAAmBwE,cAAnB,EAAmC/gC,IAAI,CAAC9D,GAAxC,EAA6CskC,UAA7C,CAAA,CAAA;AACA,IAAIt3B,IAAAA,QAAQ,GAAGlJ,IAAf,CAAA;AACA4gC,IAAAA,QAAQ,CAACt8B,OAAT,CAAkBgM,OAAD,IAAa;AAC5B2D,MAAAA,UAAU,CAACsoB,OAAX,CACEwE,cADF,EAEEzwB,OAAO,CAACpU,GAFV,EAGEoU,OAAO,CAAClT,KAAR,CAAc6T,OAAd,CAAsB/H,QAAtB,IAAkC,CAHpC,CAAA,CAAA;AAKAA,MAAAA,QAAQ,GAAGoH,OAAX,CAAA;AACD,KAPD,CAAA,CAAA;AAQD,GAXM,CAAP,CAAA;AAYD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASywB,cAAT,CACL9sB,UADK,EAEL/X,GAFK,EAGLwK,QAHK,EAIL;AACA,EAAM,MAAA;AAAEvK,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAA,GAAe/c,KAArB,CAAA;AACA,EAAA,MAAM8K,IAAI,GAAGiS,QAAQ,CAACrN,UAAT,CAAoB3P,GAApB,CAAb,CAAA;AACA,EAAO+X,OAAAA,UAAU,CAACsoB,OAAX,CAAmBoE,eAAnB,EAAoC15B,IAApC,EAA0CP,QAA1C,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASi6B,eAAT,CACL1sB,UADK,EAELhN,IAFK,EAGLP,QAHK,EAIL;AACA,EAAM,MAAA;AAAEvK,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAA,GAAe/c,KAArB,CAAA;AACA,EAAA,MAAMZ,IAAI,GAAG2d,QAAQ,CAACpN,gBAAT,CAA0B7E,IAA1B,CAAb,CAAA;AACA,EAAMkG,MAAAA,UAAU,GAAGlG,IAAI,CAACnI,KAAL,CAAW,CAAX,EAAc,CAAC,CAAf,CAAnB,CAAA;AACA,EAAA,MAAM2J,MAAM,GAAGyQ,QAAQ,CAACnN,aAAT,CAAuBoB,UAAvB,CAAf,CAAA;AACA,EAAMxO,MAAAA,KAAK,GAAG8J,MAAM,CAACrL,KAAP,CAAa6T,OAAb,CAAqB1V,IAArB,CAAd,CAAA;;AAEA,EAAA,IAAIyB,SAAO,CAACE,SAAR,CAAkB3B,IAAlB,CAAJ,EAA6B;AAC3BoC,IAAkBpC,IAAI,CAACkB,IAAvB,CAAA;AACAkB,IAAkBpC,IAAI,CAACsC,IAAvB,CAAA;AACD,GAAA;;AAEDoW,EAAAA,UAAU,CAAC+sB,aAAX,CACEX,QAAQ,CAAC9kC,IAAD,EAAO0L,IAAP,EAAaP,QAAb,CADV,EAEE,MAAM;AACJuN,IAAAA,UAAU,CAACgtB,eAAX,CAA2B,MAAM;AAC/BhtB,MAAAA,UAAU,CAAC6sB,kBAAX,CAA8B,MAAM;AAClC,QAAA,IAAIvlC,IAAI,CAAC0B,MAAL,EAAJ,EAAmB;AACjB;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACY,UAAM,MAAA,GAAG8H,KAAH,CAAYxJ,GAAAA,IAAI,CAACkL,SAAL,CAAeC,QAAf,CAAlB,CAAA;AACA,UAAM,MAAA;AAAE6O,YAAAA,SAAF;AAAapR,YAAAA,WAAAA;AAAb,WAA6B8P,GAAAA,UAAU,CAAC9X,KAA9C,CAAA;AACA8X,UAAAA,UAAU,CACPsoB,OADH,CACW2C,gBADX,EAC6Bj4B,IAD7B,EACmCP,QADnC,EAC6C3B,KAAK,CAAC/E,IADnD,CAEGu8B,CAAAA,OAFH,CAEW2E,gBAFX,EAE6B/zB,UAF7B,EAEyCxO,KAAK,GAAG,CAFjD,EAEoDoG,KAFpD,CAAA,CAAA;AAGA;AACZ;AACA;AACA;AACA;AACA;AACA;;AACY,UAAA,MAAMo8B,aAAa,GAAGltB,UAAU,CAAC9X,KAAX,CACnB+B,GADmB,CACf,aADe,EACAiG,WADA,CAEnBjG,CAAAA,GAFmB,CAEf,WAFe,EAEFqX,SAFE,CAAtB,CAAA;AAGA,UAAM6rB,MAAAA,YAAY,GAAGD,aAAa,CAAC9L,YAAd,CACnB8L,aAAa,CAACjoB,QADK,EAElBC,KAAD,IAAW;AACT,YAAA,IAAIA,KAAK,CAACjd,GAAN,KAAcX,IAAI,CAACW,GAAnB,IAA0BwK,QAAQ,IAAIyS,KAAK,CAACnY,MAAhD,EAAwD;AACtD,cAAOmY,OAAAA,KAAK,CAAClb,KAAN,CAAY;AACjB/B,gBAAAA,GAAG,EAAE6I,KAAK,CAAC7I,GADM;AAEjB8E,gBAAAA,MAAM,EAAEmY,KAAK,CAACnY,MAAN,GAAe0F,QAAAA;AAFN,eAAZ,CAAP,CAAA;AAID,aAAA;;AACD,YAAA,OAAOyS,KAAP,CAAA;AACD,WAVkB,CAArB,CAAA;AAYAlF,UAAAA,UAAU,CAACotB,QAAX,CAAoBD,YAApB,EAAkC;AAAEE,YAAAA,eAAe,EAAE,KAAA;AAAnB,WAAlC,CAAA,CAAA;AACD,SA5CD,MA4CO;AACL;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACY,UAAMhxB,MAAAA,OAAO,GAAG/U,IAAhB,CAAA;AACA,UAAM6W,MAAAA,UAAU,GAAG9B,OAAO,CAACpS,GAAR,CAAY,OAAZ,EAAqB,EAArB,CAAyB+F,CAAAA,aAAzB,EAAnB,CAAA;AACA,UAAM2C,MAAAA,MAAM,GAAG0J,OAAO,CAAClT,KAAR,CAAc0B,KAAd,CAAoB4H,QAApB,CAAf,CAAA;AACA,UAAA,MAAM6nB,EAAE,GAAG5vB,KAAK,GAAG,CAAnB,CAAA;AACAsV,UAAAA,UAAU,CAACsoB,OAAX,CAAmB2E,gBAAnB,EAAqC/zB,UAArC,EAAiDohB,EAAjD,EAAqDnc,UAArD,CAAA,CAAA;AACA,UAAA,MAAMmvB,cAAc,GAAGp0B,UAAU,CAACnI,MAAX,CAAkBupB,EAAlB,CAAvB,CAAA;AACA,UAAA,MAAMiT,YAAY,GAAGv6B,IAAI,CAACjC,MAAL,CAAY0B,QAAZ,CAArB,CAAA;AACAE,UAAAA,MAAM,CAACtC,OAAP,CAAe,CAAC8K,CAAD,EAAI7C,GAAJ,KAAY;AACzB0H,YAAAA,UAAU,CAACsoB,OAAX,CACEuD,cADF,EAEE0B,YAFF,EAGED,cAHF,EAIEh1B,GAJF,CAAA,CAAA;AAMD,WAPD,CAAA,CAAA;AAQD,SAAA;AACF,OAjFD,CAAA,CAAA;AAkFD,KAnFD,CAAA,CAAA;AAoFD,GAvFH,CAAA,CAAA;AAyFA,EAAA,OAAO0H,UAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASwtB,UAAT,CAAoBxtB,UAApB,EAA4CytB,KAAK,GAAG,CAApD,EAAuD;AAC5D1B,EAAAA,cAAc,CAAC/rB,UAAD,CAAd,CAAA;AAEA,EAAM,MAAA;AAAE9X,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEsB,IAAAA,SAAF;AAAa2D,IAAAA,QAAAA;AAAb,GAAA,GAA0B/c,KAAhC,CAAA;AACA,EAAM8D,MAAAA,KAAK,GAAGsV,SAAS,CAACtV,KAAV,IAAmBiZ,QAAQ,CAAC6d,qBAAT,CAA+BxhB,SAA/B,CAAjC,CAAA;AACAtB,EAAAA,UAAU,CAACsoB,OAAX,CAAmB,mBAAnB,EAAwChnB,SAAxC,EAAmDmsB,KAAnD,CAAA,CAAA;AACA,EAAA,MAAMrZ,KAAK,GAAGpU,UAAU,CAAC9X,KAAX,CAAiBoZ,SAA/B,CAAA;AACA,EAAA,IAAI8b,QAAQ,GAAGhJ,KAAK,CAAC6L,SAAN,CAAgBhb,QAAhB,CAAf,CAAA;;AACA,EAAA,IAAIjZ,KAAK,CAAC5C,MAAN,IAAgBkY,SAAS,CAACtV,KAA9B,EAAqC;AACnC;AACAoxB,IAAAA,QAAQ,GAAGhJ,KAAK,CAACpqB,KAAN,CAAY;AACrBgC,MAAAA,KAAK,EAAEA,KAAK,CAAC5C,MAAN,GAAe4C,KAAf,GAAuBsV,SAAS,CAACtV,KAAAA;AADnB,KAAZ,CAAX,CAAA;AAGD,GAAA;;AACD,EAAA,OAAOgU,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2B3K,QAA3B,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASsQ,iBAAT,CACL1tB,UADK,EAELsB,SAFK,EAGLmsB,KAAK,GAAG,CAHH,EAIL;AACA,EAAIrZ,IAAAA,KAAK,GAAG9S,SAAZ,CAAA;AACA,EAAI,IAAA;AAAEpZ,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAhB,CAAA;AACA,EAAI,IAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAA,GAAe/c,KAAnB,CAAA;;AACA,EAAIksB,IAAAA,KAAK,CAACkD,WAAN,IAAqBlD,KAAK,CAACzE,MAAN,CAAa9K,WAAb,EAAzB,EAAqD;AACnD;AACA,IAAA,MAAMK,KAAK,GAAGkP,KAAK,CAACzE,MAApB,CAAA;AACA,IAAMge,MAAAA,UAAU,GAAGzoB,KAAK,CAACX,IAAN,KAAeD,SAAS,CAACa,MAA5C,CAAA;AACAnF,IAAAA,UAAU,CAACsoB,OAAX,CAAmBsF,gBAAnB,EAAqC1oB,KAArC,CAAA,CAAA;;AACA,IAAA,IAAIyoB,UAAJ,EAAgB;AACd3tB,MAAAA,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2B3T,KAA3B,CAAA,CAAA;AACD,KAAA;;AACD,IAAA,OAAOpU,UAAP,CAAA;AACD,GAAA;;AAEDoU,EAAAA,KAAK,GAAG6X,qBAAqB,CAACjsB,UAAD,EAAaoU,KAAb,CAA7B,CAAA;AAEA,EAAM,MAAA;AAAE7jB,IAAAA,KAAF;AAASC,IAAAA,GAAAA;AAAT,GAAA,GAAiB4jB,KAAK,CAACmD,mBAAN,CAA0BtS,QAA1B,CAAvB,CAAA;AACA,EAAI3d,IAAAA,IAAI,GAAG2d,QAAQ,CAAC/N,UAAT,CAAoB3G,KAAK,CAACtI,GAA1B,CAAX,CAAA;AACA,EAAIuM,IAAAA,MAAM,GAAGyQ,QAAQ,CAAC/K,eAAT,CAAyB5S,IAAI,CAAEW,GAA/B,CAAb,CAAA;AACA,EAAImI,IAAAA,CAAC,GAAG,CAAR,CAAA;;AAEA,EAAA,OAAOoE,MAAM,IAAIpE,CAAC,GAAGq9B,KAArB,EAA4B;AAC1BnmC,IAAAA,IAAI,GAAGkN,MAAP,CAAA;AACAA,IAAAA,MAAM,GAAGyQ,QAAQ,CAAC/K,eAAT,CAAyB1F,MAAM,CAACvM,GAAhC,CAAT,CAAA;AACAmI,IAAAA,CAAC,EAAA,CAAA;AACF,GAAA;;AAED,EAAA,OAAO4P,UAAU,CAAC6sB,kBAAX,CAA8B,MAAM;AACzC7sB,IAAAA,UAAU,CAACsoB,OAAX,CACE+D,qBADF,EAEE/kC,IAAI,CAAEW,GAFR,EAGEsI,KAAK,CAACtI,GAHR,EAIEsI,KAAK,CAACxD,MAJR,CAAA,CAAA;AAOA7E,IAAAA,KAAK,GAAG8X,UAAU,CAAC9X,KAAnB,CAAA;AACA+c,IAAAA,QAAQ,GAAG/c,KAAK,CAAC+c,QAAjB,CAAA;;AAEA,IAAImP,IAAAA,KAAK,CAAC6K,UAAV,EAAsB;AACpB,MAAA,IAAI7K,KAAK,CAACqL,UAAN,CAAiBxa,QAAjB,CAAJ,EAAgCmP,KAAK,GAAGA,KAAK,CAACuM,IAAN,EAAR,CAAA;AAChC,MAAMkN,MAAAA,SAAS,GAAG5oB,QAAQ,CAAC9K,YAAT,CAAsB7S,IAAI,CAAEW,GAA5B,CAAlB,CAAA;AACAmsB,MAAAA,KAAK,GAAGA,KAAK,CAAC+L,uBAAN,CAA8B0N,SAA9B,EAAyC7tB,UAAzC,CAAR,CAAA;;AAEA,MAAA,IAAIzP,KAAK,CAACtI,GAAN,KAAcuI,GAAG,CAACvI,GAAtB,EAA2B;AACzBmsB,QAAAA,KAAK,GAAGA,KAAK,CAACsM,WAAN,CACNtM,KAAK,CAACzE,MAAN,CAAa1nB,GADP,EAENuI,GAAG,CAACzD,MAAJ,GAAcwD,KAAK,CAACxD,MAFd,CAAR,CAAA;AAID,OAAA;;AAEDiT,MAAAA,UAAU,CAACsoB,OAAX,CAAmB,eAAnB,EAAoClU,KAApC,CAAA,CAAA;AACD,KAAA;AACF,GAzBM,CAAP,CAAA;AA0BD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAAS0Z,WAAT,CAAqB9tB,UAArB,EAA6CytB,KAAK,GAAG,CAArD,EAAwD;AAC7D1B,EAAAA,cAAc,CAAC/rB,UAAD,CAAd,CAAA;AACA,EAAM,MAAA;AAAEsB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAO8X,OAAAA,UAAU,CAACsoB,OAAX,CAAmByF,kBAAnB,EAAuCzsB,SAAvC,EAAkDmsB,KAAlD,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,SAASM,kBAAT,CAA4B/tB,UAA5B,EAAoDoU,KAApD,EAA2DqZ,KAAK,GAAGO,QAAnE,EAA6E;AAC3E5Z,EAAAA,KAAK,GAAG6X,qBAAqB,CAACjsB,UAAD,EAAaoU,KAAb,CAA7B,CAAA;AACA,EAAM,MAAA;AAAElsB,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAA,GAAe/c,KAArB,CAAA;AACA,EAAA,MAAMqI,KAAK,GAAG6jB,KAAK,CAAC6I,QAAN,CAAehY,QAAf,CAAd,CAAA;AAEA,EAAI3d,IAAAA,IAAI,GAAG2d,QAAQ,CAAC/N,UAAT,CAAoB3G,KAAK,CAACtI,GAA1B,CAAX,CAAA;AACA,EAAIuM,IAAAA,MAAM,GAAGyQ,QAAQ,CAAC1J,gBAAT,CAA0BjU,IAAI,CAAEW,GAAhC,CAAb,CAAA;AACA,EAAImI,IAAAA,CAAC,GAAG,CAAR,CAAA;;AAEA,EAAA,OAAOoE,MAAM,IAAIiD,MAAM,CAACD,QAAP,CAAgBhD,MAAhB,CAAV,IAAqCpE,CAAC,GAAGq9B,KAAhD,EAAuD;AACrDnmC,IAAAA,IAAI,GAAGkN,MAAP,CAAA;AACAA,IAAAA,MAAM,GAAGyQ,QAAQ,CAAC1J,gBAAT,CAA0B/G,MAAM,CAACvM,GAAjC,CAAT,CAAA;AACAmI,IAAAA,CAAC,EAAA,CAAA;AACF,GAAA;;AAED,EAAA,OAAO4P,UAAU,CAACsoB,OAAX,CACL+D,qBADK,EAEL/kC,IAAI,CAAEW,GAFD,EAGLsI,KAAK,CAACtI,GAHD,EAILsI,KAAK,CAACxD,MAJD,CAAP,CAAA;AAMD;;AC5pBM,MAAMkhC,cAAc,GAAG,MAAM,iBAA7B,CAAA;AACA,MAAMC,eAAe,GAAG,MAAM,kBAA9B,CAAA;AACA,MAAMC,SAAS,GAAIn7B,IAAD,IAAiB,CAAA,WAAA,EAAaksB,IAAI,CAACC,SAAL,CAAensB,IAAf,CAAqB,CAArE,CAAA,CAAA;;ACJP;AAiCA;AACA;AACA;AACA;AACA;;AACO,SAASo7B,eAAT,CACLpuB,UADK,EAEL/X,GAFK,EAGLyC,KAHK,EAILpD,IAJK,EAKL;AACA,EAAM,MAAA;AAAEY,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAA,GAAe/c,KAArB,CAAA;AACA,EAAA,MAAM8K,IAAI,GAAGiS,QAAQ,CAACrN,UAAT,CAAoB3P,GAApB,CAAb,CAAA;AACA,EAAO+X,OAAAA,UAAU,CAACsoB,OAAX,CAAmB2E,gBAAnB,EAAqCj6B,IAArC,EAA2CtI,KAA3C,EAAkDpD,IAAlD,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;;AACO,SAAS2lC,gBAAT,CACLjtB,UADK,EAELhN,IAFK,EAGLtI,KAHK,EAILpD,IAJK,EAKL;AACA,EAAA,MAAM+mC,UAAU,GAAG,CAAC,GAAGr7B,IAAJ,EAAUtI,KAAV,CAAnB,CAAA;AACA,EAAOsV,OAAAA,UAAU,CAAC+sB,aAAX,CAAyBoB,SAAS,CAACE,UAAD,CAAlC,EAAgD,MAAM;AAC3D,IAAOruB,OAAAA,UAAU,CAACgoB,cAAX,CAA0B;AAC/Bx/B,MAAAA,IAAI,EAAE8a,qBAAa,CAACgrB,UADW;AAE/Bt7B,MAAAA,IAAI,EAAEq7B,UAFyB;AAG/B/mC,MAAAA,IAAAA;AAH+B,KAA1B,CAAP,CAAA;AAKD,GANM,CAAP,CAAA;AAOD,CAAA;;AAED,SAASinC,YAAT,CAAsBvuB,UAAtB,EAA8C/F,KAA9C,EAA4D;AAC1D,EAAA,OACE,CAAC+F,UAAU,CAACoa,KAAX,CAAiB,QAAjB,EAA2BngB,KAA3B,CAAD,IACA+F,UAAU,CAACoa,KAAX,CAAiB,SAAjB,EAA4BngB,KAA5B,CADA,IAEAA,KAAK,CAAClO,IAAN,KAAe,EAFf,IAGA,CAACkO,KAAK,CAAC2D,cAAN,CAAsBhK,CAAD,IAAOoM,UAAU,CAACoa,KAAX,CAAiB,QAAjB,EAA2BxmB,CAA3B,CAA5B,CAJH,CAAA;AAMD,CAAA;AAED;AACA;AACA;AACA;;;AACO,SAAS9B,YAAT,CAAoBkO,UAApB,EAA4CjU,IAA5C,EAA0DyiC,EAA1D,EAAuE;AAC5E,EAAM,MAAA;AAAEtmC,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAF;AAAY3D,IAAAA,SAAAA;AAAZ,GAAA,GAA0BpZ,KAAhC,CAAA;;AACA,EAAI,IAAA,CAACoZ,SAAL,EAAgB;AACd,IAAA,OAAOtB,UAAP,CAAA;AACD,GAAA;;AACD,EAAA,MAAMhU,KAAK,GACTwiC,EAAE,IAAIltB,SAAS,CAACtV,KAAhB,IAAyBiZ,QAAQ,CAAC6d,qBAAT,CAA+BxhB,SAA/B,CAD3B,CAAA;AAEA,EAAOtB,OAAAA,UAAU,CAACsoB,OAAX,CAAmBmG,iBAAnB,EAAsCntB,SAAtC,EAAiDvV,IAAjD,EAAuDC,KAAvD,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;;AACO,SAAS4hC,gBAAT,CAA0B5tB,UAA1B,EAAkDsa,EAAlD,EAAiE;AACtE,EAAI,IAAA;AAAErV,IAAAA,QAAAA;AAAF,GAAejF,GAAAA,UAAU,CAAC9X,KAA9B,CAAA;AACA,EAAM+R,MAAAA,KAAK,GAAGgL,QAAQ,CAACtN,OAAT,CAAiB2iB,EAAE,CAACryB,GAApB,CAAd,CAAA;AACA,EAAMuM,MAAAA,MAAM,GAAGyQ,QAAQ,CAAC/I,SAAT,CAAmBoe,EAAE,CAACryB,GAAtB,CAAf,CAAA;AACA,EAAM0lC,MAAAA,UAAU,GAAGrT,EAAE,CAAC/V,IAAH,KAAYD,SAAS,CAACa,MAAzC,CAAA;;AACA,EAAA,IAAI,CAAClL,KAAD,IAAU,CAACzF,MAAX,IAAqB,CAACyF,KAAK,CAAChR,SAAN,EAAtB,IAA2C,CAACgR,KAAK,CAACvC,OAAN,EAAhD,EAAiE;AAC/D,IAAA,OAAOsI,UAAP,CAAA;AACD,GAAA;;AACD,EAAMtV,MAAAA,KAAK,GAAG8J,MAAM,CAACrL,KAAP,CAAa6T,OAAb,CAAqB/C,KAArB,CAAd,CAAA;AACA,EAAMy0B,MAAAA,QAAQ,GAAGp3B,KAAK,CAAC7N,MAAN,CAAa6N,KAAK,CAACsI,YAAnB,CAAjB,CAAA;AACA,EAAM+uB,MAAAA,WAAW,GAAGhB,UAAU,GAAGjjC,KAAH,GAAWA,KAAK,GAAG,CAAjD,CAAA;AACAsV,EAAAA,UAAU,CAACsoB,OAAX,CAAmB8F,eAAnB,EAAoC55B,MAAM,CAACvM,GAA3C,EAAgD0mC,WAAhD,EAA6DD,QAA7D,CAAA,CAAA;AACAzpB,EAAAA,QAAQ,GAAGjF,UAAU,CAAC9X,KAAX,CAAiB+c,QAA5B,CAAA;AACA,EAAA,MAAM3d,IAAI,GAAGonC,QAAQ,CAACxlC,YAAT,EAAb,CAAA;AACA,EAAA,MAAMymB,MAAM,GAAGtL,SAAS,CAAC5a,MAAV,CAAiB;AAAExB,IAAAA,GAAG,EAAEX,IAAI,CAACW,GAAZ;AAAiB8E,IAAAA,MAAM,EAAE,CAAA;AAAzB,GAAjB,CAAf,CAAA;AACA,EAAM6iB,MAAAA,KAAK,GAAGD,MAAd,CAAA;AACA,EAAO3P,OAAAA,UAAU,CAACsoB,OAAX,CAAmBP,MAAnB,EAA2BrY,SAAS,CAACjmB,MAAV,CAAiB;AAAEkmB,IAAAA,MAAF;AAAUC,IAAAA,KAAAA;AAAV,GAAjB,CAA3B,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;;AACO,SAAS6e,iBAAT,CACLzuB,UADK,EAEL+U,CAFK,EAGLhpB,IAHK,EAILC,KAJK,EAKL;AACA,EAAI+oB,IAAAA,CAAC,CAACuC,WAAF,IAAiBvC,CAAC,CAACpF,MAAF,CAAS9K,WAAT,EAArB,EAA6C;AAC3C7E,IAAAA,UAAU,CAACsoB,OAAX,CAAmBsF,gBAAnB,EAAqC7Y,CAAC,CAACpF,MAAvC,CAAA,CAAA;AACA,IAAA,MAAMzR,QAAQ,GAAG8B,UAAU,CAAC9X,KAAX,CAAiB0mC,SAAlC,CAAA;;AACA,IAAI,IAAA,CAAC1wB,QAAL,EAAe;AACb,MAAA,OAAO8B,UAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAOA,UAAU,CAACsoB,OAAX,CAAmBuG,eAAnB,EAAoC3wB,QAAQ,CAACjW,GAA7C,EAAkD,CAAlD,EAAqD8D,IAArD,EAA2DC,KAA3D,CAAP,CAAA;AACD,GAAA;;AACD,EAAA,MAAMooB,KAAK,GAAGW,CAAC,CAACkK,UAAF,GAAegN,qBAAqB,CAACjsB,UAAD,EAAa+U,CAAb,CAApC,GAAsDA,CAApE,CAAA;AACA,EAAM,MAAA;AAAE7sB,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAA,GAAe/c,KAArB,CAAA;AACA,EAAM,MAAA;AAAEqI,IAAAA,KAAAA;AAAF,GAAA,GAAY6jB,KAAK,CAACmD,mBAAN,CAA0BtS,QAA1B,CAAlB,CAAA;AACA,EAAMzQ,MAAAA,MAAM,GAAGyQ,QAAQ,CAAC/I,SAAT,CAAmB3L,KAAK,CAACtI,GAAzB,CAAf,CAAA;;AACA,EAAI+X,IAAAA,UAAU,CAACoa,KAAX,CAAiB,QAAjB,EAA2B5lB,MAA3B,CAAJ,EAAwC;AACtC,IAAA,OAAOwL,UAAP,CAAA;AACD,GAAA;;AAED,EAAA,OAAOA,UAAU,CAACsoB,OAAX,CACLuG,eADK,EAELt+B,KAAK,CAACtI,GAFD,EAGLsI,KAAK,CAACxD,MAHD,EAILhB,IAJK,EAKLC,KALK,CAAP,CAAA;AAOD,CAAA;AAED;AACA;AACA;AACA;AACA;;AACO,SAAS6iC,eAAT,CACL7uB,UADK,EAEL/X,GAFK,EAGL8E,MAHK,EAILhB,IAJK,EAKLC,KALK,EAML;AACA,EAAM,MAAA;AAAE9D,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAA,GAAe/c,KAArB,CAAA;AACA,EAAA,MAAM8K,IAAI,GAAGiS,QAAQ,CAACrN,UAAT,CAAoB3P,GAApB,CAAb,CAAA;AACA,EAAA,OAAO+X,UAAU,CAACsoB,OAAX,CAAmBwG,gBAAnB,EAAqC97B,IAArC,EAA2CjG,MAA3C,EAAmDhB,IAAnD,EAAyDC,KAAzD,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;;AACO,SAAS8iC,gBAAT,CACL9uB,UADK,EAELhN,IAFK,EAGLjG,MAHK,EAILhB,IAJK,EAKLyiC,EALK,EAML;AACA,EAAM,MAAA;AAAEtmC,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAF;AAAY/U,IAAAA,WAAAA;AAAZ,GAAA,GAA4BhI,KAAlC,CAAA;AACA,EAAA,MAAMZ,IAAI,GAAG2d,QAAQ,CAACpN,gBAAT,CAA0B7E,IAA1B,CAAb,CAAA;;AACA,EAAA,IAAI,CAAC1L,IAAI,CAAC0B,MAAL,EAAL,EAAoB;AAClB,IAAA,MAAM,IAAIN,KAAJ,CACH,CAAA,6BAAA,EAA+BsK,IAAI,CAACnD,IAAL,CAAU,GAAV,CAAe,CAC5CvI,QAAAA,EAAAA,IAAD,CAAkBkB,IACnB,sBAHG,CAAN,CAAA;AAKD,GAAA;;AACD,EAAMwD,MAAAA,KAAK,GAAGwiC,EAAE,IAAIlnC,IAAI,CAACoK,eAAL,CAAqB3E,MAArB,CAApB,CAAA;AAEA,EAAIm+B,IAAAA,OAAO,GAAG,KAAd,CAAA;AACA,EAAA,MAAMC,IAAI,GAAGj7B,WAAW,CAACtE,MAAZ,CAAoB0E,GAAD,IAAS;AACvC,IAAM,MAAA;AAAEC,MAAAA,KAAF;AAASC,MAAAA,GAAT;AAAcrG,MAAAA,IAAAA;AAAd,KAAA,GAAuBmG,GAA7B,CAAA;AACA,IAAM86B,MAAAA,QAAQ,GAAGprB,UAAU,CAACoa,KAAX,CAAiB,UAAjB,EAA6BjwB,IAA7B,CAAjB,CAAA;;AACA,IAAI,IAAA,CAACihC,QAAL,EAAe;AACb,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AAED,IAAMnI,MAAAA,SAAS,GAAGhe,QAAQ,CAAChN,OAAT,CAAiB1H,KAAK,CAACtI,GAAvB,CAAlB,CAAA;;AACA,IAAI,IAAA,CAACg7B,SAAL,EAAgB;AACdiI,MAAAA,OAAO,GAAG,IAAV,CAAA;AACA,MAAA,OAAO,KAAP,CAAA;AACD,KAAA;;AACD,IAAI,IAAA,CAACp4B,IAAI,CAAC5I,OAAL,CAAa+4B,SAAb,EAAwBjwB,IAAxB,CAAL,EAAoC;AAClC,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AAED,IAAMkwB,MAAAA,OAAO,GAAGje,QAAQ,CAAChN,OAAT,CAAiBzH,GAAG,CAACvI,GAArB,CAAhB,CAAA;;AACA,IAAI,IAAA,CAACi7B,OAAL,EAAc;AACZgI,MAAAA,OAAO,GAAG,IAAV,CAAA;AACA,MAAA,OAAO,KAAP,CAAA;AACD,KAAA;;AACD,IACE36B,IAAAA,KAAK,CAACxD,MAAN,GAAeA,MAAf,KACC,CAAC+F,IAAI,CAAC5I,OAAL,CAAag5B,OAAb,EAAsBlwB,IAAtB,CAAD,IAAgCxC,GAAG,CAACzD,MAAJ,GAAaA,MAD9C,CADF,EAGE;AACAm+B,MAAAA,OAAO,GAAG,IAAV,CAAA;AACA,MAAA,OAAO,KAAP,CAAA;AACD,KAAA;;AAED,IAAA,OAAO,IAAP,CAAA;AACD,GA9BY,CAAb,CAAA;;AA+BA,EAAA,IAAIA,OAAJ,EAAa;AACXlrB,IAAAA,UAAU,CAACotB,QAAX,CAAoBllC,KAAK,CAAC+B,GAAN,CAAU,aAAV,EAAyBkhC,IAAzB,CAApB,EAAoD;AAAEl8B,MAAAA,SAAS,EAAE,KAAA;AAAb,KAApD,CAAA,CAAA;AACD,GAAA;;AAED,EAAO+Q,OAAAA,UAAU,CAACgoB,cAAX,CAA0B;AAC/Bx/B,IAAAA,IAAI,EAAE8a,qBAAa,CAACyrB,UADW;AAE/B/7B,IAAAA,IAF+B;AAG/BjG,IAAAA,MAH+B;AAI/BhB,IAAAA,IAAI,EAAEA,IAAI,IAAI,EAJiB;AAK/BC,IAAAA,KAAK,EAAEA,KAAK,CAACC,GAAN,CAAUzC,IAAI,CAACC,MAAf,CAAA;AALwB,GAA1B,CAAP,CAAA;AAOD,CAAA;AAED;AACA;AACA;AACA;;AACO,SAASulC,kBAAT,CACLhvB,UADK,EAELoU,KAFK,EAGLna,KAHK,EAIL;AACA,EAAA,MAAMmjB,QAAQ,GAAG6O,qBAAqB,CAACjsB,UAAD,EAAaoU,KAAb,CAAtC,CAAA;AACA,EAAM,MAAA;AAAElsB,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAA,GAAe/c,KAArB,CAAA;AAEA,EAAM,MAAA;AAAEqI,IAAAA,KAAAA;AAAF,GAAA,GAAY6sB,QAAQ,CAAC7F,mBAAT,CAA6BtS,QAA7B,CAAlB,CAAA;AACA,EAAI,IAAA;AAAEhd,IAAAA,GAAG,EAAE0U,QAAP;AAAiB5P,IAAAA,MAAM,EAAEI,WAAAA;AAAzB,GAAA,GAAyCoD,KAA7C,CAAA;AACA,EAAA,MAAM8yB,UAAU,GAAGpe,QAAQ,CAAC/K,eAAT,CAAyByC,QAAzB,CAAnB,CAAA;AACA,EAAA,MAAMsyB,WAAW,GAAGhqB,QAAQ,CAAC1J,gBAAT,CAA0BoB,QAA1B,CAApB,CAAA;AACA,EAAMnI,MAAAA,MAAM,GAAGyQ,QAAQ,CAAC/I,SAAT,CAAmBmnB,UAAU,CAACp7B,GAA9B,CAAf,CAAA;AACA,EAAMyC,MAAAA,KAAK,GAAG8J,MAAM,CAACrL,KAAP,CAAa6T,OAAb,CAAqBqmB,UAArB,CAAd,CAAA;AAEArjB,EAAAA,UAAU,CAAC+sB,aAAX,CAAyBkB,cAAc,EAAvC,EAA2C,MAAM;AAC/C,IAAA,IAAI7Q,QAAQ,CAACzN,MAAT,CAAgB9K,WAAhB,EAAJ,EAAmC;AACjC;AACA7E,MAAAA,UAAU,CAACsoB,OAAX,CACE8F,eADF,EAEE55B,MAAM,CAACvM,GAFT,EAGEyC,KAAK,IAAI0yB,QAAQ,CAACzN,MAAT,CAAgBpL,IAAhB,KAAyB,QAAzB,GAAoC,CAApC,GAAwC,CAA5C,CAHP,EAIEtK,KAJF,CAAA,CAAA;AAMD,KARD,MAQO,IAAI,CAACg1B,WAAD,IAAgB5L,UAAU,CAACt3B,IAAX,KAAoB,EAAxC,EAA4C;AACjD;AACAiU,MAAAA,UAAU,CAACsoB,OAAX,CAAmB8F,eAAnB,EAAoC55B,MAAM,CAACvM,GAA3C,EAAgDyC,KAAK,GAAG,CAAxD,EAA2DuP,KAA3D,CAAA,CAAA;AACD,KAHM,MAGA,IAAI1J,KAAK,CAACkV,eAAN,CAAsB4d,UAAtB,CAAJ,EAAuC;AAC5CrjB,MAAAA,UAAU,CAACsoB,OAAX,CAAmB8F,eAAnB,EAAoC55B,MAAM,CAACvM,GAA3C,EAAgDyC,KAAhD,EAAuDuP,KAAvD,CAAA,CAAA;AACD,KAFM,MAEA,IAAI1J,KAAK,CAACmV,aAAN,CAAoB2d,UAApB,CAAJ,EAAqC;AAC1CrjB,MAAAA,UAAU,CAACsoB,OAAX,CAAmB8F,eAAnB,EAAoC55B,MAAM,CAACvM,GAA3C,EAAgDyC,KAAK,GAAG,CAAxD,EAA2DuP,KAA3D,CAAA,CAAA;AACD,KAFM,MAEA;AACL;AAEA;AACA,MAAIg1B,IAAAA,WAAW,IAAIjvB,UAAU,CAACoa,KAAX,CAAiB,QAAjB,EAA2B6U,WAA3B,CAAnB,EAA4D;AAC1D,QAAA,MAAMC,KAAK,GAAG3+B,KAAK,CAACmV,aAAN,CAAoBupB,WAApB,CAAd,CAAA;AACA,QAAA,MAAME,WAAW,GAAGD,KAAK,GACrBjqB,QAAQ,CAACrL,WAAT,CAAqB+C,QAArB,CADqB,GAErBsI,QAAQ,CAACxL,eAAT,CAAyBkD,QAAzB,CAFJ,CAAA;AAIA,QAAMyyB,MAAAA,UAAU,GAAGF,KAAK,GACpB9R,QAAQ,CAAC5Y,iBAAT,CAA2B2qB,WAA3B,EAAyCnvB,UAAzC,CADoB,GAEpBod,QAAQ,CAAC1Y,eAAT,CAAyByqB,WAAzB,EAAuCnvB,UAAvC,CAFJ,CAAA;AAIA,QAAM,MAAA;AAAE2P,UAAAA,MAAAA;AAAF,SAAayf,GAAAA,UAAU,CAAC7X,mBAAX,CACjBvX,UAAU,CAAC9X,KAAX,CAAiB+c,QADA,CAAnB,CAAA;AAGAtI,QAAAA,QAAQ,GAAGgT,MAAM,CAAC1nB,GAAlB,CAAA;AACAkF,QAAAA,WAAW,GAAGwiB,MAAM,CAAC5iB,MAArB,CAAA;AACD,OAAA;;AAEDiT,MAAAA,UAAU,CAAC6sB,kBAAX,CAA8B,MAAM;AAClC7sB,QAAAA,UAAU,CAACsoB,OAAX,CACE+D,qBADF,EAEEhJ,UAAU,CAACp7B,GAFb,EAGE0U,QAHF,EAIExP,WAJF,CAAA,CAAA;AAMA6S,QAAAA,UAAU,CAACsoB,OAAX,CAAmB8F,eAAnB,EAAoC55B,MAAM,CAACvM,GAA3C,EAAgDyC,KAAK,GAAG,CAAxD,EAA2DuP,KAA3D,CAAA,CAAA;AACD,OARD,CAAA,CAAA;AASD,KAAA;AACF,GA/CD,CAAA,CAAA;AAiDA,EAAA,OAAO+F,UAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASqvB,WAAT,CACLrvB,UADK,EAELsvB,UAFK,EAGL;AACA,EAAM,MAAA;AAAEhuB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,MAAM+R,KAAK,GAAG3C,KAAK,CAAC7N,MAAN,CAAa6lC,UAAb,CAAd,CAAA;AACAtvB,EAAAA,UAAU,CAACsoB,OAAX,CACE0G,kBADF,EAEE/C,qBAAqB,CAACjsB,UAAD,EAAasB,SAAb,CAFvB,EAGErH,KAHF,EAHA;;AAUA,EAAA,MAAM3S,IAAI,GAAG0Y,UAAU,CAAC9X,KAAX,CAAiB+c,QAAjB,CAA0BtN,OAA1B,CAAkCsC,KAAK,CAAChS,GAAxC,CAAb,CAAA;;AACA,EAAA,IAAIX,IAAJ,EAAU;AACR0Y,IAAAA,UAAU,CAACsoB,OAAX,CAAmB5jB,eAAnB,EAAoCpd,IAApC,CAAA,CAAA;AACD,GAAA;;AAED,EAAA,OAAO0Y,UAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;;AACO,SAASuvB,mBAAT,CACLvvB,UADK,EAELoU,KAFK,EAGL8Q,MAHK,EAIL;AACAllB,EAAAA,UAAU,CAAC+sB,aAAX,CAAyBmB,eAAe,EAAxC,EAA4C,MAAM;AAChDluB,IAAAA,UAAU,CAAC6sB,kBAAX,CAA8B,MAAM;AAClC,MAAM3nB,MAAAA,KAAK,GAAG+mB,qBAAqB,CAACjsB,UAAD,EAAaoU,KAAb,CAArB,CAAyCzE,MAAvD,CAAA;;AACA,MAAIyE,IAAAA,KAAK,CAACkD,WAAN,IAAqBpS,KAAK,CAACL,WAAN,EAAzB,EAA8C;AAC5C7E,QAAAA,UAAU,CAACsoB,OAAX,CAAmBsF,gBAAnB,EAAqC1oB,KAArC,CAAA,CAAA;AACD,OAAA;;AAED,MAAM,MAAA;AAAED,QAAAA,QAAF;AAAY3D,QAAAA,SAAAA;AAAZ,OAA0BtB,GAAAA,UAAU,CAAC9X,KAA3C,CAAA;AACA,MAAM,MAAA;AAAEqI,QAAAA,KAAAA;AAAF,OAAA,GAAY+Q,SAAS,CAACiW,mBAAV,CAA8BtS,QAA9B,CAAlB,CAAA;AACA,MAAMzQ,MAAAA,MAAM,GAAGyQ,QAAQ,CAAC/I,SAAT,CAAmB3L,KAAK,CAACtI,GAAzB,CAAf,CAAA;AACA,MAAM4U,MAAAA,SAAS,GAAGoI,QAAQ,CAAC/N,UAAT,CAAoB3G,KAAK,CAACtI,GAA1B,CAAlB,CAAA;AACA,MAAMyC,MAAAA,KAAK,GAAG8J,MAAM,CAACrL,KAAP,CAAa6T,OAAb,CAAqBH,SAArB,CAAd,CAAA;AAEA,MAAImD,IAAAA,UAAU,CAACoa,KAAX,CAAiB,QAAjB,EAA2B5lB,MAA3B,CAAJ,EAAwC,OAAA;AAExCwL,MAAAA,UAAU,CAACsoB,OAAX,CAAmBwE,cAAnB,EAAmCv8B,KAAK,CAACtI,GAAzC,EAA8CsI,KAAK,CAACxD,MAApD,CAAA,CAAA;AACAiT,MAAAA,UAAU,CAACsoB,OAAX,CAAmB8F,eAAnB,EAAoC55B,MAAM,CAACvM,GAA3C,EAAgDyC,KAAK,GAAG,CAAxD,EAA2Dw6B,MAA3D,CAAA,CAAA;AACD,KAhBD,CAAA,CAAA;AAiBD,GAlBD,CAAA,CAAA;AAmBA,EAAA,OAAOllB,UAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;;AACO,SAASwvB,YAAT,CACLxvB,UADK,EAELyvB,WAFK,EAGL;AACA,EAAM,MAAA;AAAEnuB,IAAAA,SAAAA;AAAF,GAAgBtB,GAAAA,UAAU,CAAC9X,KAAjC,CAAA;AACA,EAAA,MAAMg9B,MAAM,GAAGztB,MAAM,CAAChO,MAAP,CAAcgmC,WAAd,CAAf,CAAA;AAEAzvB,EAAAA,UAAU,CAACsoB,OAAX,CAAmBiH,mBAAnB,EAAwCjuB,SAAxC,EAAmD4jB,MAAnD,CAAA,CAJA;;AAOA,EAAA,MAAM59B,IAAI,GAAG0Y,UAAU,CAAC9X,KAAX,CAAiB+c,QAAjB,CAA0BtN,OAA1B,CAAkCutB,MAAM,CAACj9B,GAAzC,CAAb,CAAA;;AACA,EAAA,IAAIX,IAAJ,EAAU;AACR0Y,IAAAA,UAAU,CAACsoB,OAAX,CAAmB5jB,eAAnB,EAAoCpd,IAApC,CAAA,CAAA;AACD,GAAA;;AAED,EAAA,OAAO0Y,UAAP,CAAA;AACD;AAGD;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,MAAM0vB,iBAAiB,GAAG,CACxBC,QADwB,EAExB1qB,QAFwB,EAGxBtI,QAHwB,KAIrB;AACH,EAAMizB,MAAAA,aAAa,GAAIh9B,MAAD,IAA2B;AAC/C,IAAI,IAAA,CAACA,MAAD,IAAW9J,MAAI,CAACE,MAAL,CAAY4J,MAAZ,CAAf,EAAoC;AAClC,MAAA,OAAO,KAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAQA,MAAD,CAAoBzJ,KAApB,CAA0BC,MAA1B,KAAqC,CAA5C,CAAA;AACD,GALD,CAAA;;AAOA,EAAMqb,MAAAA,SAAS,GAAI7R,MAAD,IAAqBA,MAAM,IAAKA,MAAM,CAACzJ,KAAP,CAAa,CAAb,CAAlD,CAAA;;AACA,EAAI7B,IAAAA,IAAa,GAAGqoC,QAApB,CAAA;;AAEA,EAAA,IAAIC,aAAa,CAACD,QAAD,CAAjB,EAA6B;AAC3B,IAAA,IAAIE,aAAa,GAAGprB,SAAS,CAACkrB,QAAD,CAA7B,CAAA;AAEA,IAAIG,IAAAA,aAAa,GAAG7qB,QAAQ,CAACzK,YAAT,CAAsBmC,QAAtB,EAAiCozB,YAAD,IAAkB;AACpE,MAAI9qB,IAAAA,QAAQ,YAAYlc,SAAxB,EAAiC;AAC/B,QAAA,OAAQgnC,YAAD,CAA0BvnC,IAA1B,KAAmCqnC,aAAa,CAACrnC,IAAxD,CAAA;AACD,OAAA;;AACD,MAAA,OAAO,KAAP,CAAA;AACD,KALmB,CAApB,CAAA;;AAOA,IAAIsnC,IAAAA,aAAa,KAAK7qB,QAAQ,CAAC/I,SAAT,CAAmBS,QAAnB,CAAtB,EAAoD;AAClDrV,MAAAA,IAAI,GAAGuoC,aAAP,CAAA;AACD,KAAA;;AAED,IACED,OAAAA,aAAa,CAACC,aAAD,CAAb,IACAD,aAAa,CAACE,aAAD,CAFf,EAGE;AACAD,MAAAA,aAAa,GAAGprB,SAAS,CAACorB,aAAD,CAAzB,CAAA;AACAC,MAAAA,aAAa,GAAGrrB,SAAS,CAACqrB,aAAD,CAAzB,CAAA;;AACA,MAAA,IAAID,aAAa,CAACrnC,IAAd,KAAuBsnC,aAAa,CAACtnC,IAAzC,EAA+C;AAC7ClB,QAAAA,IAAI,GAAGuoC,aAAP,CAAA;AACD,OAFD,MAEO;AACL,QAAA,MAAA;AACD,OAAA;AACF,KAAA;AACF,GAAA;;AACD,EAAA,OAAOvoC,IAAP,CAAA;AACD,CA3CD,CAAA;AA6CA;AACA;AACA;AACA;AACA;;;AACO,SAAS0oC,mBAAT,CACLhwB,UADK,EAEL/X,GAFK,EAGLyC,KAHK,EAILilC,QAJK,EAKL;AACA,EAAM,MAAA;AAAEznC,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAM,MAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAA,GAAe/c,KAArB,CAAA;AACA,EAAA,MAAM8K,IAAI,GAAGiS,QAAQ,CAACrN,UAAT,CAAoB3P,GAApB,CAAb,CAAA;AACA,EAAO+X,OAAAA,UAAU,CAACsoB,OAAX,CAAmB2H,oBAAnB,EAAyCj9B,IAAzC,EAA+CtI,KAA/C,EAAsDilC,QAAtD,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;;AACO,SAASM,oBAAT,CACLjwB,UADK,EAELhN,IAFK,EAGLtI,KAHK,EAILilC,QAJK,EAKL;AACAA,EAAAA,QAAQ,CAACxmC,KAAT,CAAekH,OAAf,CAAuB,CAAC/I,IAAD,EAAO8L,CAAP,KAAa;AAClC4M,IAAAA,UAAU,CAACsoB,OAAX,CAAmB2E,gBAAnB,EAAqCj6B,IAArC,EAA2CtI,KAAK,GAAG0I,CAAnD,EAAsD9L,IAAtD,CAAA,CAAA;AACD,GAFD,CAAA,CAAA;AAGA,EAAA,OAAO0Y,UAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;;AACO,SAASkwB,cAAT,CAAwBlwB,UAAxB,EAAgD2vB,QAAhD,EAAoE;AACzE,EAAA,IAAI,CAACA,QAAQ,CAACxmC,KAAT,CAAeC,MAApB,EAA4B;AAC1B,IAAA,OAAO4W,UAAP,CAAA;AACD,GAHwE;;;AAMzE+rB,EAAAA,cAAc,CAAC/rB,UAAD,CAAd,CANyE;;AASzE,EAAI,IAAA;AAAE9X,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAhB,CAAA;AACA,EAAI,IAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAA,GAAe/c,KAAnB,CAAA;AACA,EAAI,IAAA;AAAEoZ,IAAAA,SAAAA;AAAF,GAAA,GAAgBpZ,KAApB,CAAA;;AACA,EAAI,IAAA,CAACoZ,SAAL,EAAgB;AACd,IAAA,OAAOtB,UAAP,CAAA;AACD,GAdwE;;;AAiBzE,EAAMmwB,MAAAA,cAAc,GAAGlrB,QAAQ,CAAC/J,YAAT,CAAsBoG,SAAS,CAACqO,MAAV,CAAiB1nB,GAAvC,CAAvB,CAAA;AACA,EAAA,MAAMmzB,QAAQ,GAAGuU,QAAQ,CAACpmC,WAAT,EAAjB,CAAA;;AACA,EAAI,IAAA,CAAC6xB,QAAL,EAAe;AACb,IAAA,OAAOpb,UAAP,CAAA;AACD,GAAA;;AAED,EAAM,MAAA;AAAEzP,IAAAA,KAAF;AAASC,IAAAA,GAAAA;AAAT,GAAA,GAAiB8Q,SAAS,CAACse,IAAV,CAAe3a,QAAf,CAAvB,CAAA;AACA,EAAM,MAAA;AAAEpI,IAAAA,SAAF;AAAaC,IAAAA,OAAAA;AAAb,GAAA,GAAyB5U,KAA/B,CAAA;AACA,EAAA,MAAM4b,IAAI,GAAGmB,QAAQ,CAAClV,QAAT,EAAoB9D,CAAAA,GAApB,CAAyBF,IAAD,IAAUA,IAAI,CAAC9D,GAAvC,CAAb,CAzByE;;AA4BzE+X,EAAAA,UAAU,CAACsoB,OAAX,CAAmB8H,qBAAnB,EAA0C9uB,SAA1C,EAAqDquB,QAArD,CAAA,CA5ByE;;AA+BzE,EAAC,CAAA;AAAEznC,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAb,EAAA;AACA,EAAC,CAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAA,GAAe/c,KAAhB,EAAA;AACAoZ,EAAAA,SAAS,GAAGpZ,KAAK,CAACoZ,SAAlB,CAAA;AAEA,EAAA,MAAM+uB,YAAY,GAAGprB,QAAQ,CAAClV,QAAT,EAArB,CAAA;AACA,EAAA,MAAMugC,QAAQ,GAAGD,YAAY,CAACzkC,MAAb,CAAqBgI,CAAD,IAAO,CAACkQ,IAAI,CAACqhB,QAAL,CAAcvxB,CAAC,CAAC3L,GAAhB,CAA5B,CAAjB,CAAA;AACA,EAAMsoC,MAAAA,WAAW,GAAGD,QAAQ,CAACA,QAAQ,CAAClnC,MAAT,GAAkB,CAAnB,CAA5B,CArCyE;;AAwCzE,EAAA,IAAI,CAACkY,SAAD,IAAc+uB,YAAY,CAACjnC,MAA/B,EAAuC;AACrC,IAAA,MAAM+xB,SAAS,GAAGkV,YAAY,CAAC,CAAD,CAA9B,CAAA;AACA,IAAA,MAAMnrB,KAAK,GAAGb,SAAS,CAAC5a,MAAV,CAAiB;AAAExB,MAAAA,GAAG,EAAEkzB,SAAS,CAAClzB,GAAjB;AAAsB8E,MAAAA,MAAM,EAAE,CAAA;AAA9B,KAAjB,CAAd,CAAA;AACAiT,IAAAA,UAAU,CAACsoB,OAAX,CACEP,MADF,EAEErY,SAAS,CAACjmB,MAAV,CAAiB;AAAEkmB,MAAAA,MAAM,EAAEzK,KAAV;AAAiB0K,MAAAA,KAAK,EAAE1K,KAAAA;AAAxB,KAAjB,CAFF,CAAA,CAAA;AAID,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;;;AACE,EAAA,IAAIqrB,WAAJ,EAAiB;AACfvwB,IAAAA,UAAU,CAACsoB,OAAX,CAAmB5jB,eAAnB,EAAoC6rB,WAApC,CAAA,CAAA;AACA,IAAMC,MAAAA,WAAW,GAAGvrB,QAAQ,CAAC/K,eAAT,CAAyBq2B,WAAW,CAACtoC,GAArC,CAApB,CAAA;AACA,IAAMwoC,MAAAA,QAAQ,GAAGD,WAAW,EAAE52B,WAAb,CAAyB22B,WAAW,CAACtoC,GAArC,CAAjB,CAHe;AAKf;;AACA,IAAIwoC,IAAAA,QAAQ,IAAIA,QAAQ,CAACxoC,GAAT,KAAiBuI,GAAG,CAACvI,GAArC,EAA0C;AACxC+X,MAAAA,UAAU,CAACsoB,OAAX,CAAmB9jB,iBAAnB,EAAsCisB,QAAtC,CAAA,CAAA;AACD,KAFD,MAEO,IAAI3zB,OAAO,IAAItM,GAAG,CAACoU,WAAJ,EAAf,EAAkC;AACvC;AACA;AACA;AACA;AACA,MAAM8rB,MAAAA,OAAO,GAAG5zB,OAAO,CAAC/Q,IAAR,CAAase,SAAb,CAAuB7Z,GAAG,CAACzD,MAA3B,CAAhB,CAAA;AACA,MAAA,MAAM4jC,WAAW,GAAGC,gBAAgB,CAACxnB,WAAjB,CAA6BsnB,OAA7B,CAApB,CAAA;AAEA,MAAMG,MAAAA,0BAA0B,GAAGlB,QAAQ,CAACxmC,KAAT,CAAe,CAAf,CAAkBwW,CAAAA,gBAAlB,EAAnC,CAAA;AACA,MAAM0jB,MAAAA,UAAU,GAAGxmB,SAAS,IAAIoI,QAAQ,CAAC/K,eAAT,CAAyB2C,SAAS,CAAC5U,GAAnC,CAAhC,CAAA;AACA,MAAM6oC,MAAAA,sBAAsB,GAAGzN,UAAU,IAAI9yB,KAAK,CAACkV,eAAN,CAAsB4d,UAAtB,CAA7C,CAAA;;AACA,MAAA,IAAIwN,0BAA0B,IAAIC,sBAAlC,EAA0D,CAA1D,MAEO;AACL9wB,QAAAA,UAAU,CAACsoB,OAAX,CAAmBxjB,YAAnB,EAAiC6rB,WAAjC,CAAA,CAAA;AACD,OAAA;;AACD,MAAA,MAAMI,OAAO,GAAG9rB,QAAQ,CAAC/J,YAAT,CAAsBq1B,WAAW,CAACtoC,GAAlC,CAAA,CAAuC,CAAvC,CAAhB,CAhBuC;;AAmBvC,MACE;AACA;AACAkoC,MAAAA,cAAc,CAAC/mC,MAAf,IAAyB,CAAzB,IACA4W,UAAU,CAACoa,KAAX,CAAiB,kBAAjB,EAAqC2W,OAArC,CADA,IAEAA,OAAO,CAACxnC,WAAR,EAAA,KAA0BgnC,WAL5B,EAME;AACAvwB,QAAAA,UAAU,CAACsoB,OAAX,CAAmBiC,sBAAnB,CAAA,CAAA;AACD,OAAA;AACF,KAAA;;AACD,IAAA,IAAIvqB,UAAU,CAAC9X,KAAX,CAAiBoZ,SAAjB,CAA2B2d,UAA/B,EAA2C;AACzCjf,MAAAA,UAAU,CAACsoB,OAAX,CAAmBpH,WAAnB,CAAA,CAAA;AACD,KAAA;AACF,GAAA;;AACD,EAAA,OAAOlhB,UAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;;AACO,SAASowB,qBAAT,CACLpwB,UADK,EAELoU,KAFK,EAGLub,QAHK,EAIL;AACA,EAAA,IAAI,CAACA,QAAQ,CAACxmC,KAAT,CAAeC,MAApB,EAA4B;AAC1B,IAAA,OAAO4W,UAAP,CAAA;AACD,GAAA;;AACD,EAAA,OAAOA,UAAU,CAAC6sB,kBAAX,CAA8B,MAAM;AACzCzY,IAAAA,KAAK,GAAG6X,qBAAqB,CAACjsB,UAAD,EAAaoU,KAAb,CAA7B,CAAA;;AACA,IAAIA,IAAAA,KAAK,CAACkD,WAAN,IAAqBlD,KAAK,CAACzE,MAAN,CAAa9K,WAAb,EAAzB,EAAqD;AACnD7E,MAAAA,UAAU,CAACsoB,OAAX,CAAmBsF,gBAAnB,EAAqCxZ,KAAK,CAACzE,MAA3C,CAAA,CAAA;AACAyE,MAAAA,KAAK,GAAGpU,UAAU,CAAC9X,KAAX,CAAiBoZ,SAAzB,CAAA;AACD,KAAA;;AAEDquB,IAAAA,QAAQ,GAAGA,QAAQ,CAACtyB,cAAT,CAAyBrD,KAAD,IAAWA,KAAK,CAAChK,aAAN,EAAnC,CAAX,CAPyC;AAUzC;;AACAgQ,IAAAA,UAAU,CAACsoB,OAAX,CAAmB,kCAAnB,EAAuDlU,KAAvD,EAA8Dub,QAA9D,CAAA,CAAA;AACD,GAZM,CAAP,CAAA;AAaD,CAAA;AAED;AACA;AACA;AACA;;AACO,SAASqB,gCAAT,CACLhxB,UADK,EAELoU,KAFK,EAGLub,QAHK,EAIL;AACA,EAAM,MAAA;AAAEznC,IAAAA,KAAAA;AAAF,GAAA,GAAY8X,UAAlB,CAAA;AACA,EAAI,IAAA;AAAEiF,IAAAA,QAAAA;AAAF,GAAe/c,GAAAA,KAAnB,CAFA;;AAKA,EAAM,MAAA;AAAEqI,IAAAA,KAAF;AAASC,IAAAA,GAAAA;AAAT,GAAA,GAAiB4jB,KAAK,CAACmD,mBAAN,CAA0BtS,QAA1B,CAAvB,CAAA;AACA,EAAIpI,IAAAA,SAAS,GAAGoI,QAAQ,CAACtN,OAAT,CAAiBpH,KAAK,CAACtI,GAAvB,CAAhB,CAAA;AACA,EAAIo7B,IAAAA,UAAU,GAAGpe,QAAQ,CAAC/K,eAAT,CAAyB2C,SAAS,CAAC5U,GAAnC,CAAjB,CAAA;AACA,EAAIgpC,IAAAA,UAAU,GAAG5N,UAAU,CAACznB,mBAAX,CAA+BiB,SAAS,CAAC5U,GAAzC,CAAjB,CAAA;AACA,EAAA,MAAMipC,SAAS,GAAG3gC,KAAK,CAACkV,eAAN,CAAsB4d,UAAtB,CAAlB,CAAA;AACA,EAAA,MAAM8N,OAAO,GAAG3gC,GAAG,CAACkV,aAAJ,CAAkB2d,UAAlB,CAAhB,CAAA;AACA,EAAI7uB,IAAAA,MAAM,GAAGyQ,QAAQ,CAAC/I,SAAT,CAAmBmnB,UAAU,CAACp7B,GAA9B,CAAb,CAAA;AACA,EAAMyC,MAAAA,KAAK,GAAG8J,MAAM,CAACrL,KAAP,CAAa6T,OAAb,CAAqBqmB,UAArB,CAAd,CAAA;AAEA,EAAA,MAAMmB,MAAM,GAAGmL,QAAQ,CAACnwB,SAAT,EAAf,CAAA;;AACA,EAAA,IAAIglB,MAAM,CAACp7B,MAAP,KAAkB,CAAtB,EAAyB;AACvB,IAAA,OAAO4W,UAAP,CAAA;AACD,GAAA;;AAED,EAAA,MAAMgW,UAAU,GAAG2Z,QAAQ,CAACxmC,KAAT,CAAe,CAAf,CAAnB,CAAA;AACA,EAAA,MAAMioC,SAAS,GAAGzB,QAAQ,CAACxmC,KAAT,CAAewmC,QAAQ,CAACxmC,KAAT,CAAeC,MAAf,GAAwB,CAAvC,CAAlB,CAAA;AACA,EAAA,MAAMioC,UAAU,GAAG7M,MAAM,CAAC,CAAD,CAAzB,CAAA;AACA,EAAM1J,MAAAA,SAAS,GAAG0J,MAAM,CAACA,MAAM,CAACp7B,MAAP,GAAgB,CAAjB,CAAxB,CAAA;AAEA,EAAA,MAAMkoC,aAAa,GAAG5B,iBAAiB,CAACC,QAAD,EAAW1qB,QAAX,EAAqBoe,UAAU,CAACp7B,GAAhC,CAAvC,CAxBA;;AA2BA+X,EAAAA,UAAU,CAACuxB,QAAX,CAAoBC,aAApB,CAAkC7B,QAAlC,EA3BA;;AA8BA,EACE0B,IAAAA,UAAU,KAAKvW,SAAf,IACA9a,UAAU,CAACoa,KAAX,CAAiB,QAAjB,EAA2BiX,UAA3B,CADA,IAEA,CAACrxB,UAAU,CAACoa,KAAX,CAAiB,aAAjB,EAAgCkX,aAAhC,CAHH,EAIE;AACAtxB,IAAAA,UAAU,CAACsoB,OAAX,CAAmB0G,kBAAnB,EAAuC5a,KAAvC,EAA8Cid,UAA9C,CAAA,CAAA;AACA,IAAA,OAAOrxB,UAAP,CAAA;AACD,GArCD;AAwCA;;;AACA,EAAA,MAAM6wB,0BAA0B,GAAG7a,UAAU,CAACrW,gBAAX,EAAnC,CAAA;AACA,EAAA,MAAM8xB,yBAAyB,GAAGL,SAAS,CAACzxB,gBAAV,EAAlC,CAAA;;AACA,EACE2xB,IAAAA,aAAa,KAAK3B,QAAlB,KACCkB,0BAA0B,IAAIY,yBAD/B,CADF,EAGE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAA,IAAIZ,0BAAJ,EAAgC;AAC9B;AACA,MAAA,MAAMC,sBAAsB,GAAGvgC,KAAK,CAACkV,eAAN,CAAsB4d,UAAtB,CAA/B,CAAA;AACA,MAAA,MAAMl6B,KAAK,GAAG2nC,sBAAsB,GAAGnB,QAAQ,CAACxmC,KAAZ,GAAoB,CAAC,GAAGwmC,QAAQ,CAACxmC,KAAb,CAAA,CAAoBsP,OAApB,EAAxD,CAAA;AACAtP,MAAAA,KAAK,CAACkH,OAAN,CAAe/I,IAAD,IAAU;AACtB0Y,QAAAA,UAAU,CAACsoB,OAAX,CAAmB0G,kBAAnB,EAAuC5a,KAAvC,EAA8C9sB,IAA9C,CAAA,CAAA;AACD,OAFD,CAAA,CAAA;AAGA,MAAA,OAAO0Y,UAAP,CAAA;AACD,KA5CD;AA+CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,IAAA,IAAIyxB,yBAAJ,EAA+B;AAC7B;AACAzxB,MAAAA,UAAU,CAACsoB,OAAX,CAAmB0G,kBAAnB,EAAuC5a,KAAvC,EAA8Cgd,SAA9C,CAAA,CAAA;AACA,MAAA,MAAMM,IAAI,GAAG/B,QAAQ,CAACvxB,UAAT,CAAoB,CAACuxB,QAAQ,CAACxmC,KAAT,CAAeC,MAAf,GAAwB,CAAzB,CAApB,CAAb,CAAA;;AACA,MAAA,IAAIsoC,IAAI,CAACvoC,KAAL,CAAWC,MAAf,EAAuB;AACrB4W,QAAAA,UAAU,CAACsoB,OAAX,CAAmB0I,gCAAnB,EAAqD5c,KAArD,EAA4Dsd,IAA5D,CAAA,CAAA;AACD,OAAA;AACF,KAAA;;AACD,IAAA,OAAO1xB,UAAP,CAAA;AACD,GArID;AAwIA;;;AACA,EAAIqxB,IAAAA,UAAU,KAAKvW,SAAnB,EAA8B;AAC5B,IAAA,MAAM6W,YAAY,GAAGL,aAAa,CAAC92B,YAAd,CACnB62B,UAAU,CAACppC,GADQ,EAElBkM,CAAD,IAAQA,CAAD,CAAahL,KAAb,CAAmBC,MAAnB,KAA8B,CAFlB,CAArB,CAAA;AAIA,IAAA,MAAMwoC,WAAW,GAAGD,YAAY,IAAIN,UAApC,CAAA;AAEA,IAAMlO,MAAAA,UAAU,GAAG3uB,MAAM,CAACrL,KAAP,CAAa6T,OAAb,CAAqBqmB,UAArB,CAAnB,CAAA;AACA,IAAA,MAAMwO,oBAAoB,GAAGP,aAAa,CAAClzB,UAAd,CAC3BkzB,aAAa,CAAC15B,UAAd,CAAyBg6B,WAAW,CAAC3pC,GAArC,CAD2B,CAA7B,CAAA;AAIA4pC,IAAAA,oBAAoB,CAAC1oC,KAArB,CAA2BkH,OAA3B,CAAmC,CAAC/I,IAAD,EAAO8L,CAAP,KAAa;AAC9C,MAAA,MAAM0+B,QAAQ,GAAG3O,UAAU,GAAG/vB,CAAb,GAAiB,CAAlC,CAAA;AACA4M,MAAAA,UAAU,CAACsoB,OAAX,CAAmB8F,eAAnB,EAAoC55B,MAAM,CAACvM,GAA3C,EAAgD6pC,QAAhD,EAA0DxqC,IAA1D,CAAA,CAAA;AACD,KAHD,CAAA,CAAA;AAID,GAzJD;;;AA4JA,EAAA,IAAIiJ,KAAK,CAACxD,MAAN,KAAiB,CAArB,EAAwB;AACtBiT,IAAAA,UAAU,CAACsoB,OAAX,CACE+D,qBADF,EAEE4E,UAAU,CAAChpC,GAFb,EAGEsI,KAAK,CAACtI,GAHR,EAIEsI,KAAK,CAACxD,MAJR,CAAA,CAAA;AAMD,GAAA;;AAED,EAAC,CAAA;AAAEkY,IAAAA,QAAAA;AAAF,GAAejF,GAAAA,UAAU,CAAC9X,KAA3B,EAAA;AACA2U,EAAAA,SAAS,GAAGoI,QAAQ,CAACtN,OAAT,CAAiBpH,KAAK,CAACtI,GAAvB,CAAZ,CAAA;AACAo7B,EAAAA,UAAU,GAAGpe,QAAQ,CAAC/K,eAAT,CAAyB3J,KAAK,CAACtI,GAA/B,CAAb,CAAA;AACAuM,EAAAA,MAAM,GAAGyQ,QAAQ,CAAC/I,SAAT,CAAmBmnB,UAAU,CAACp7B,GAA9B,CAAT,CAAA;AACAgpC,EAAAA,UAAU,GAAG5N,UAAU,CAACznB,mBAAX,CAA+BiB,SAAS,CAAC5U,GAAzC,CAAb,CAAA;;AAEA,EAAIopC,IAAAA,UAAU,KAAKvW,SAAnB,EAA8B;AAC5B,IAAA,MAAMiX,SAAS,GAAGb,SAAS,GACvBD,UADuB,GAEvB5N,UAAU,CAACxqB,cAAX,CAA0Bo4B,UAAU,CAAChpC,GAArC,CAFJ,CAAA;AAGA,IAAM+pC,MAAAA,SAAS,GAAGD,SAAS,GACvBnlC,SAAS,CAACrC,SAAV,CAAoB84B,UAAU,CAACl6B,KAA/B,EAAuCyK,CAAD,IAAOA,CAAC,CAAC3L,GAAF,KAAU8pC,SAAS,CAAC9pC,GAAjE,CADuB,GAEvB,EAFJ,CAAA;AAGA,IAAMgS,MAAAA,KAAK,GAAGgL,QAAQ,CAAC9N,aAAT,CAAuB2jB,SAAS,CAAC7yB,GAAjC,CAAd,CAAA;;AAEA,IAAI,IAAA,CAAC+X,UAAU,CAACoa,KAAX,CAAiB,QAAjB,EAA2BngB,KAA3B,CAAL,EAAwC;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAA,MAAMuL,MAAM,GAAGvL,KAAK,CAAC9Q,KAAN,CAAYC,MAA3B,CAAA;AACA4oC,MAAAA,SAAS,CAAC3hC,OAAV,CAAkB,CAAC/I,IAAD,EAAO8L,CAAP,KAAa;AAC7B,QAAA,MAAM0+B,QAAQ,GAAGtsB,MAAM,GAAGpS,CAA1B,CAAA;AACA4M,QAAAA,UAAU,CAACsoB,OAAX,CAAmBsD,aAAnB,EAAkCtkC,IAAI,CAACW,GAAvC,EAA4CgS,KAAK,CAAChS,GAAlD,EAAuD6pC,QAAvD,CAAA,CAAA;AACD,OAHD,CAAA,CAAA;AAID,KA7BD,MA6BO;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAA,MAAMG,QAAQ,GACZhtB,QAAQ,CAAC9N,aAAT,CAAuB3C,MAAM,CAACvM,GAA9B,CAAA,CAAmCkB,KAAnC,CAAyC6T,OAAzC,CAAiD/C,KAAjD,IAA0D,CAD5D,CAAA;AAEA+3B,MAAAA,SAAS,CAAC3hC,OAAV,CAAmB/I,IAAD,IAAU;AAC1B0Y,QAAAA,UAAU,CAACsoB,OAAX,CAAmBqC,eAAnB,EAAoCrjC,IAAI,CAACW,GAAzC,CAAA,CAAA;AACD,OAFD,EA3BK;;AA+BL,MAAMiqC,MAAAA,SAAS,GAAG7O,UAAU,CACzBp5B,GADe,CACX,OADW,EACF+nC,SADE,CAEfhiC,CAAAA,aAFe,EAAlB,CAAA;;AAGA,MAAI,IAAA,CAACmhC,OAAL,EAAc;AACZnxB,QAAAA,UAAU,CAACsoB,OAAX,CAAmB8F,eAAnB,EAAoC55B,MAAM,CAACvM,GAA3C,EAAgDgqC,QAAhD,EAA0DC,SAA1D,CAAA,CAAA;AACD,OAAA;AACF,KAAA;AACF,GAAA;;AAED,EAAA,IAAI3D,YAAY,CAACvuB,UAAD,EAAaqjB,UAAb,CAAhB,EAA0C;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACArjB,IAAAA,UAAU,CACPsoB,OADH,CACW8F,eADX,EAC4B55B,MAAM,CAACvM,GADnC,EACwCyC,KADxC,EAC+C2mC,UAD/C,EAEG/I,OAFH,CAEWqC,eAFX,EAE4BtH,UAAU,CAACp7B,GAFvC,CAAA,CAAA;AAGD,GA5BD,MA4BO;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAMkqC,MAAAA,WAAW,GAAG9O,UAAU,CAACznB,mBAAX,CAClBiB,SAAS,CAAC5U,GADQ,CAApB,CAAA;AAGA,IAAMmqC,MAAAA,WAAW,GAAG/O,UAAU,CAACl6B,KAAX,CAAiB6T,OAAjB,CAAyBm1B,WAAzB,CAApB,CAAA;;AACA,IAAInyB,IAAAA,UAAU,CAACoa,KAAX,CAAiB,QAAjB,EAA2BiX,UAA3B,CAAJ,EAA4C;AAC1C,MAAMY,MAAAA,QAAQ,GAAGz9B,MAAM,CAACrL,KAAP,CAAa6T,OAAb,CAAqBqmB,UAArB,CAAA,GAAmC,CAApD,CAAA;AACArjB,MAAAA,UAAU,CAACsoB,OAAX,CAAmB8F,eAAnB,EAAoC55B,MAAM,CAACvM,GAA3C,EAAgDgqC,QAAhD,EAA0DZ,UAA1D,CAAA,CAAA;AACD,KAHD,MAGO;AACLA,MAAAA,UAAU,CAACloC,KAAX,CAAiBkH,OAAjB,CAAyB,CAAC60B,MAAD,EAAS9xB,CAAT,KAAe;AACtC,QAAM/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A,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAAA,EAAAA;AAAA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;AAChB,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AAED,IAAA,IAAIt/G,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,aAA7B,EAA4C;AAC1C4gG,MAAAA,2BAAO,CACLwe,YAAY,KAAK,KADZ,EAEL,gMAFK,CAAP,CAAA;AAID,KAAA;AACF,GAAA;;AAED,EAAA,IAAI3yG,CAAC,CAACtM,IAAF,KAAW6M,CAAC,CAAC7M,IAAjB,EAAuB;AACrB,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AAED,EAAA,IAAIsM,CAAC,CAACizB,OAAF,KAAc1yB,CAAC,CAAC0yB,OAApB,EAA6B;AAC3B,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AAED,EAAM2/E,MAAAA,kBAAkB,GAAGxmG,UAAU,CAACE,WAAX,KAA2BL,mBAAW,CAACyB,SAAlE,CAhCyE;AAkCzE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,EAAA,IAAIklG,kBAAJ,EAAwB;AACtB,IAAMC,MAAAA,eAAe,GAAGzmG,UAAU,CAACopF,aAAX,CAAyBx1F,CAAC,CAACtM,IAAF,CAAOW,GAAhC,CAAxB,CAAA;;AACA,IAAA,IAAIkM,CAAC,CAAC41C,UAAF,KAAiBn2C,CAAC,CAACm2C,UAAvB,EAAmC;AACjC,MAAA,OAAO51C,CAAC,CAAC41C,UAAF,KAAiB08D,eAAxB,CAAA;AACD,KAAA;AACF,GA9EwE;AAiFzE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A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"}