{"version":3,"sources":["../../../src/utils/getLinkSz.ts"],"names":["setStyleWithMark","SzUtil","getLinkSz","controller","node","document","value","text","getFirstText","marks","getMarksAtPosition","key","Array","isArray","sizes","filter","m","type","length","getLinkMaxSz","selection","range","moveAnchorToStartOfNode","moveFocusToEndOfNode","getMarksAtRange","maxSz","maxPt","forEach","sz","pt","fromMark"],"mappings":"AACA,SAASA,gBAAT,QAAiC,yBAAjC;AACA,SAASC,MAAT,QAAuB,kBAAvB;AAMA,OAAO,SAASC,SAAT,CAAmBC,UAAnB,QAAqE;AAAA,MAAxBC,IAAwB,QAAxBA,IAAwB;AAAA,MAClEC,QADkE,GACrDF,UAAU,CAACG,KAD0C,CAClED,QADkE;AAE1E,MAAME,IAAI,GAAGH,IAAI,CAACI,YAAL,EAAb;;AACA,MAAID,IAAJ,EAAU;AACR,QAAME,KAAK,GAAGJ,QAAQ,CAACK,kBAAT,CAA4BH,IAAI,CAACI,GAAjC,EAAsC,CAAtC,CAAd;;AACA,QAAIF,KAAK,IAAIG,KAAK,CAACC,OAAN,CAAcJ,KAAd,CAAb,EAAmC;AACjC,UAAMK,KAAK,GAAGL,KAAK,CAACM,MAAN,CAAa,UAACC,CAAD;AAAA,eAAOA,CAAC,CAACC,IAAF,KAAW,IAAlB;AAAA,OAAb,CAAd;;AACA,UAAIH,KAAK,CAACI,MAAN,GAAe,CAAnB,EAAsB;AACpB,eAAOlB,gBAAgB,CAAC,EAAD,EAAKc,KAAK,CAAC,CAAD,CAAV,CAAvB;AACD;AACF;AACF;;AACD,SAAO,EAAP;AACD;AAED,OAAO,SAASK,YAAT,CAAsBhB,UAAtB,SAAwE;AAAA,MAAxBC,IAAwB,SAAxBA,IAAwB;AAAA,0BAC7CD,UAAU,CAACG,KADkC;AAAA,MACrED,QADqE,qBACrEA,QADqE;AAAA,MAC3De,SAD2D,qBAC3DA,SAD2D;AAE7E,MAAMb,IAAI,GAAGH,IAAI,CAACI,YAAL,EAAb;;AACA,MAAID,IAAJ,EAAU;AACR,QAAMc,KAAK,GAAGD,SAAS,CACpBE,uBADW,CACalB,IADb,EACmBD,UADnB,EAEXoB,oBAFW,CAEUnB,IAFV,EAEgBD,UAFhB,CAAd;AAGA,QAAMM,KAAK,GAAGJ,QAAQ,CAACmB,eAAT,CAAyBH,KAAzB,CAAd;;AAEA,QAAIZ,KAAK,IAAIG,KAAK,CAACC,OAAN,CAAcJ,KAAd,CAAb,EAAmC;AACjC,UAAMK,KAAK,GAAGL,KAAK,CAACM,MAAN,CAAa,UAACC,CAAD;AAAA,eAAOA,CAAC,CAACC,IAAF,KAAW,IAAlB;AAAA,OAAb,CAAd;;AACA,UAAIH,KAAK,CAACI,MAAN,GAAe,CAAnB,EAAsB;AACpB,YAAIO,KAAK,GAAGX,KAAK,CAAC,CAAD,CAAjB;AACA,YAAIY,KAAK,GAAG,CAAZ;AACAZ,QAAAA,KAAK,CAACa,OAAN,CAAc,UAACC,EAAD,EAAQ;AACpB,cAAMC,EAAE,GAAG5B,MAAM,CAAC6B,QAAP,CAAgBF,EAAhB,CAAX;;AACA,cAAIC,EAAE,GAAGH,KAAT,EAAgB;AACdA,YAAAA,KAAK,GAAGG,EAAR;AACAJ,YAAAA,KAAK,GAAGG,EAAR;AACD;AACF,SAND;AAOA,eAAO5B,gBAAgB,CAAC,EAAD,EAAKyB,KAAL,CAAvB;AACD;AACF;AACF;;AACD,SAAO,EAAP;AACD","sourcesContent":["import { Inline, Controller } from '@ali/4ever-cangjie';\nimport { setStyleWithMark } from '@ali/4ever-plugin-marks';\nimport { SzUtil } from '@ali/4ever-utils';\n\nexport interface GetLinkSzProps {\n  node: Inline;\n}\n\nexport function getLinkSz(controller: Controller, { node }: GetLinkSzProps) {\n  const { document } = controller.value;\n  const text = node.getFirstText();\n  if (text) {\n    const marks = document.getMarksAtPosition(text.key, 1);\n    if (marks && Array.isArray(marks)) {\n      const sizes = marks.filter((m) => m.type === 'sz');\n      if (sizes.length > 0) {\n        return setStyleWithMark({}, sizes[0]);\n      }\n    }\n  }\n  return {};\n}\n\nexport function getLinkMaxSz(controller: Controller, { node }: GetLinkSzProps) {\n  const { document, selection } = controller.value;\n  const text = node.getFirstText();\n  if (text) {\n    const range = selection\n      .moveAnchorToStartOfNode(node, controller)\n      .moveFocusToEndOfNode(node, controller);\n    const marks = document.getMarksAtRange(range);\n\n    if (marks && Array.isArray(marks)) {\n      const sizes = marks.filter((m) => m.type === 'sz');\n      if (sizes.length > 0) {\n        let maxSz = sizes[0];\n        let maxPt = 0;\n        sizes.forEach((sz) => {\n          const pt = SzUtil.fromMark(sz);\n          if (pt > maxPt) {\n            maxPt = pt;\n            maxSz = sz;\n          }\n        });\n        return setStyleWithMark({}, maxSz);\n      }\n    }\n  }\n  return {};\n}\n"],"file":"getLinkSz.js"}