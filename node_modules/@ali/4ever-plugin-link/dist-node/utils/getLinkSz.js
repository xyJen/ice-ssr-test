"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getLinkSz = getLinkSz;
exports.getLinkMaxSz = getLinkMaxSz;

var _everPluginMarks = require("@ali/4ever-plugin-marks");

var _everUtils = require("@ali/4ever-utils");

function getLinkSz(controller, {
  node
}) {
  const {
    document
  } = controller.value;
  const text = node.getFirstText();

  if (text) {
    const marks = document.getMarksAtPosition(text.key, 1);

    if (marks && Array.isArray(marks)) {
      const sizes = marks.filter(m => m.type === 'sz');

      if (sizes.length > 0) {
        return (0, _everPluginMarks.setStyleWithMark)({}, sizes[0]);
      }
    }
  }

  return {};
}

function getLinkMaxSz(controller, {
  node
}) {
  const {
    document,
    selection
  } = controller.value;
  const text = node.getFirstText();

  if (text) {
    const range = selection.moveAnchorToStartOfNode(node, controller).moveFocusToEndOfNode(node, controller);
    const marks = document.getMarksAtRange(range);

    if (marks && Array.isArray(marks)) {
      const sizes = marks.filter(m => m.type === 'sz');

      if (sizes.length > 0) {
        let maxSz = sizes[0];
        let maxPt = 0;
        sizes.forEach(sz => {
          const pt = _everUtils.SzUtil.fromMark(sz);

          if (pt > maxPt) {
            maxPt = pt;
            maxSz = sz;
          }
        });
        return (0, _everPluginMarks.setStyleWithMark)({}, maxSz);
      }
    }
  }

  return {};
}
//# sourceMappingURL=getLinkSz.js.map