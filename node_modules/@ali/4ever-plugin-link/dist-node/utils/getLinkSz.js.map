{"version":3,"sources":["../../../src/utils/getLinkSz.ts"],"names":["getLinkSz","controller","node","document","value","text","getFirstText","marks","getMarksAtPosition","key","Array","isArray","sizes","filter","m","type","length","getLinkMaxSz","selection","range","moveAnchorToStartOfNode","moveFocusToEndOfNode","getMarksAtRange","maxSz","maxPt","forEach","sz","pt","SzUtil","fromMark"],"mappings":";;;;;;;;AACA;;AACA;;AAMO,SAASA,SAAT,CAAmBC,UAAnB,EAA2C;AAAEC,EAAAA;AAAF,CAA3C,EAAqE;AAC1E,QAAM;AAAEC,IAAAA;AAAF,MAAeF,UAAU,CAACG,KAAhC;AACA,QAAMC,IAAI,GAAGH,IAAI,CAACI,YAAL,EAAb;;AACA,MAAID,IAAJ,EAAU;AACR,UAAME,KAAK,GAAGJ,QAAQ,CAACK,kBAAT,CAA4BH,IAAI,CAACI,GAAjC,EAAsC,CAAtC,CAAd;;AACA,QAAIF,KAAK,IAAIG,KAAK,CAACC,OAAN,CAAcJ,KAAd,CAAb,EAAmC;AACjC,YAAMK,KAAK,GAAGL,KAAK,CAACM,MAAN,CAAcC,CAAD,IAAOA,CAAC,CAACC,IAAF,KAAW,IAA/B,CAAd;;AACA,UAAIH,KAAK,CAACI,MAAN,GAAe,CAAnB,EAAsB;AACpB,eAAO,uCAAiB,EAAjB,EAAqBJ,KAAK,CAAC,CAAD,CAA1B,CAAP;AACD;AACF;AACF;;AACD,SAAO,EAAP;AACD;;AAEM,SAASK,YAAT,CAAsBhB,UAAtB,EAA8C;AAAEC,EAAAA;AAAF,CAA9C,EAAwE;AAC7E,QAAM;AAAEC,IAAAA,QAAF;AAAYe,IAAAA;AAAZ,MAA0BjB,UAAU,CAACG,KAA3C;AACA,QAAMC,IAAI,GAAGH,IAAI,CAACI,YAAL,EAAb;;AACA,MAAID,IAAJ,EAAU;AACR,UAAMc,KAAK,GAAGD,SAAS,CACpBE,uBADW,CACalB,IADb,EACmBD,UADnB,EAEXoB,oBAFW,CAEUnB,IAFV,EAEgBD,UAFhB,CAAd;AAGA,UAAMM,KAAK,GAAGJ,QAAQ,CAACmB,eAAT,CAAyBH,KAAzB,CAAd;;AAEA,QAAIZ,KAAK,IAAIG,KAAK,CAACC,OAAN,CAAcJ,KAAd,CAAb,EAAmC;AACjC,YAAMK,KAAK,GAAGL,KAAK,CAACM,MAAN,CAAcC,CAAD,IAAOA,CAAC,CAACC,IAAF,KAAW,IAA/B,CAAd;;AACA,UAAIH,KAAK,CAACI,MAAN,GAAe,CAAnB,EAAsB;AACpB,YAAIO,KAAK,GAAGX,KAAK,CAAC,CAAD,CAAjB;AACA,YAAIY,KAAK,GAAG,CAAZ;AACAZ,QAAAA,KAAK,CAACa,OAAN,CAAeC,EAAD,IAAQ;AACpB,gBAAMC,EAAE,GAAGC,kBAAOC,QAAP,CAAgBH,EAAhB,CAAX;;AACA,cAAIC,EAAE,GAAGH,KAAT,EAAgB;AACdA,YAAAA,KAAK,GAAGG,EAAR;AACAJ,YAAAA,KAAK,GAAGG,EAAR;AACD;AACF,SAND;AAOA,eAAO,uCAAiB,EAAjB,EAAqBH,KAArB,CAAP;AACD;AACF;AACF;;AACD,SAAO,EAAP;AACD","sourcesContent":["import { Inline, Controller } from '@ali/4ever-cangjie';\nimport { setStyleWithMark } from '@ali/4ever-plugin-marks';\nimport { SzUtil } from '@ali/4ever-utils';\n\nexport interface GetLinkSzProps {\n  node: Inline;\n}\n\nexport function getLinkSz(controller: Controller, { node }: GetLinkSzProps) {\n  const { document } = controller.value;\n  const text = node.getFirstText();\n  if (text) {\n    const marks = document.getMarksAtPosition(text.key, 1);\n    if (marks && Array.isArray(marks)) {\n      const sizes = marks.filter((m) => m.type === 'sz');\n      if (sizes.length > 0) {\n        return setStyleWithMark({}, sizes[0]);\n      }\n    }\n  }\n  return {};\n}\n\nexport function getLinkMaxSz(controller: Controller, { node }: GetLinkSzProps) {\n  const { document, selection } = controller.value;\n  const text = node.getFirstText();\n  if (text) {\n    const range = selection\n      .moveAnchorToStartOfNode(node, controller)\n      .moveFocusToEndOfNode(node, controller);\n    const marks = document.getMarksAtRange(range);\n\n    if (marks && Array.isArray(marks)) {\n      const sizes = marks.filter((m) => m.type === 'sz');\n      if (sizes.length > 0) {\n        let maxSz = sizes[0];\n        let maxPt = 0;\n        sizes.forEach((sz) => {\n          const pt = SzUtil.fromMark(sz);\n          if (pt > maxPt) {\n            maxPt = pt;\n            maxSz = sz;\n          }\n        });\n        return setStyleWithMark({}, maxSz);\n      }\n    }\n  }\n  return {};\n}\n"],"file":"getLinkSz.js"}