{"version":3,"sources":["../../../../src/utils/components/group.tsx"],"names":["React","toggleFold","Title","TitleBox","Content","useUserData","styled","clearImmediately","ContentBox","TitleContent","div","GroupBox","props","backgroundColor","generateRole","role","fold","Group","node","attributes","isSelected","controller","children","renderExtra","renderBackground","foldBoxLeft","visible","originStyle","style","display","useState","foldRole","setFoleRole","first","nodes","value","data","immediatelyUnfoldMap","immediately","key","foldRef","useRef","handleFoldChange","useCallback","_fold","run","useEffect","current","titleNode","contentNodes","Array","isArray","length","slice","type","displayName"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { toggleFold, Title as TitleBox, Content } from '@ali/4ever-plugin-heading-group'\nimport { Block, Controller, useUserData } from '@ali/4ever-cangjie';\nimport type { FoldableHeadingData } from '@ali/4ever-plugin-heading';\nimport styled from 'styled-components';\nimport { clearImmediately } from '../actions';\n\nconst ContentBox = styled(Content)`\n  position: relative;\n`;\n\nconst TitleContent = styled.div`\n`;\n\nconst GroupBox = styled.div<{ backgroundColor?: string }>`\n  position: relative;\n  background: ${(props) => props.backgroundColor || 'unset'};\n`;\n\nexport interface GroupProps {\n  node: Block<FoldableHeadingData>;\n  attributes: Record<string, string>;\n  isSelected: boolean;\n  controller: Controller;\n  renderExtra?: React.ReactElement | null;\n  renderBackground?: React.ReactElement | null;\n  foldBoxLeft?: number;\n  role?: string;\n  visible?: boolean;\n}\n\nconst generateRole = (role: string, fold: boolean): string => {\n  return `${role}${fold ? 'Fold' : 'UnFold'}`;\n};\n\nconst Group: React.FC<GroupProps> = (props) => {\n  const {\n    node,\n    attributes,\n    isSelected,\n    controller,\n    children,\n    renderExtra,\n    renderBackground,\n    foldBoxLeft,\n    role = 'Default',\n    visible,\n  } = props;\n\n  const originStyle = attributes?.style as React.CSSProperties | undefined;\n\n  const style: React.CSSProperties = originStyle ? { ...originStyle } : {};\n  if (visible === false) {\n    style.display = 'none';\n  }\n\n  const fold = useUserData(node, 'fold') || false;\n  const [foldRole, setFoleRole] = React.useState(generateRole(role, fold));\n  const first = node.nodes[0] as Block;\n  const { immediatelyUnfoldMap = {} } = controller.value.data;\n  const immediately = !!immediatelyUnfoldMap[first.key];\n\n  const foldRef = React.useRef(fold);\n\n  const handleFoldChange = React.useCallback((_fold: boolean) => {\n    controller.run('onCangjieBlur');\n    controller.run('onAction', toggleFold({\n      node: first,\n      fold: _fold,\n    }));\n    setFoleRole(generateRole(role, fold));\n  }, [controller, first, fold, role]);\n\n  React.useEffect(() => {\n    foldRef.current = fold;\n  }, [controller, first, fold, isSelected]);\n\n  // 立即展开后需要清除标记\n  React.useEffect(() => {\n    if (immediately) {\n      controller.run('onAction', clearImmediately({\n        node: first,\n      }));\n    }\n  }, [controller, first, immediately]);\n\n  // 切割议题的标题和内容块\n  let titleNode: React.ReactNode;\n  let contentNodes: React.ReactNode[];\n\n  if (Array.isArray(children) && children.length >= 1) {\n    titleNode = children[0];\n    contentNodes = children.slice(1);\n  } else {\n    return <>{children}</>;\n  }\n\n  return (\n    <GroupBox\n      {...attributes}\n      data-cangjie-group-block\n      data-name=\"heading-group\"\n      data-type={node.type}\n      style={style}\n      data-foldable\n    >\n      {renderBackground}\n      <TitleBox\n        dataName=\"heading-group-title\"\n        fold={fold}\n        foldBoxLeft={foldBoxLeft}\n        onChange={handleFoldChange}\n        role={foldRole}\n      >\n        <TitleContent data-name=\"heading-group-title-content\">\n          {titleNode}\n        </TitleContent>\n      </TitleBox>\n      {contentNodes.length > 0 && (\n        <ContentBox dataName=\"heading-group-content\" fold={fold}>\n          {renderExtra}\n          {contentNodes}\n        </ContentBox>\n      )}\n    </GroupBox>\n  );\n};\n\nGroup.displayName = 'Group';\n\nexport default Group;\n"],"file":"group.js"}