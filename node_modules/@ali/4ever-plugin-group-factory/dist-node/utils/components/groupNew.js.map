{"version":3,"sources":["../../../../src/utils/components/groupNew.tsx"],"names":["ContentBox","Content","TitleContent","styled","div","GroupBox","props","backgroundColor","generateRole","role","fold","GroupNew","node","attributes","isSelected","controller","children","renderExtra","renderBackground","foldBoxLeft","visible","style","display","foldRole","setFoleRole","React","useState","first","nodes","immediatelyUnfoldMap","value","data","immediately","key","foldRef","useRef","handleFoldChange","useCallback","_fold","run","useEffect","current","type","displayName"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { Title as TitleBox, Content, toggleFold } from '@ali/4ever-plugin-heading-group';\nimport { Block, Controller, GroupPlugin, useUserData } from '@ali/4ever-cangjie';\nimport { FoldableHeadingData } from '@ali/4ever-plugin-heading';\nimport styled from 'styled-components';\nimport { clearImmediately } from '../actions';\n\nconst ContentBox = styled(Content)`\n  position: relative;\n`;\n\nconst TitleContent = styled.div`\n`;\n\nconst GroupBox = styled.div<{backgroundColor?: string}>`\n  position: relative;\n  background: ${(props) => props.backgroundColor || 'unset'};\n`;\n\nexport interface GroupNewProps {\n  node: Block<FoldableHeadingData>;\n  attributes: Record<string, string>;\n  isSelected: boolean;\n  controller: Controller;\n  renderExtra?: React.ReactElement | null;\n  renderBackground?: React.ReactElement | null;\n  foldBoxLeft?: number;\n  role?: string;\n  isCollapsed?: boolean;\n  visible?: boolean;\n}\n\nconst generateRole = (role: string, fold: boolean): string => {\n  return `${role}${fold ? 'Fold' : 'UnFold'}`;\n};\n\nconst GroupNew: React.FC<GroupNewProps> = (props) => {\n  const {\n    node,\n    attributes,\n    isSelected,\n    controller,\n    children,\n    renderExtra,\n    renderBackground,\n    foldBoxLeft,\n    role = 'Default',\n    visible,\n  } = props;\n\n  const style: React.CSSProperties = {};\n  if (visible === false) {\n    style.display = 'none';\n  }\n\n  const fold = useUserData(node, 'fold') || false;\n  const [foldRole, setFoleRole] = React.useState(generateRole(role, fold));\n  const first = node.nodes[0] as Block;\n  const { immediatelyUnfoldMap = {} } = controller.value.data;\n  const immediately = !!immediatelyUnfoldMap[node.key];\n\n  const foldRef = React.useRef(fold);\n\n  const handleFoldChange = React.useCallback((_fold: boolean) => {\n    controller.run('onCangjieBlur');\n    controller.run('onAction', toggleFold({\n      node,\n      fold: _fold,\n    }));\n    // controller.run('onAction', GroupPlugin.actions.toggleGroupFold(node.key));\n    setFoleRole(generateRole(role, fold));\n  }, [controller, node, fold, role]);\n\n  React.useEffect(() => {\n    foldRef.current = fold;\n  }, [controller, node, fold, isSelected]);\n\n  // 立即展开后需要清除标记\n  React.useEffect(() => {\n    if (immediately) {\n      controller.run('onAction', clearImmediately({\n        node,\n      }));\n    }\n  }, [controller, first, immediately]);\n\n\n  return (\n    <GroupBox\n      {...attributes}\n      data-cangjie-group-block\n      data-name=\"heading-group\"\n      data-type={node.type}\n      style={style}\n      data-foldable\n    >\n      { renderBackground }\n      <TitleBox\n        dataName=\"heading-group-title\"\n        fold={fold}\n        foldBoxLeft={foldBoxLeft}\n        onChange={handleFoldChange}\n        role={foldRole}\n      >\n        <TitleContent data-name=\"heading-group-title-content\">\n          {children}\n        </TitleContent>\n      </TitleBox>\n    </GroupBox>\n  );\n};\n\nGroupNew.displayName = 'Group';\n\nexport default GroupNew;\n"],"file":"groupNew.js"}