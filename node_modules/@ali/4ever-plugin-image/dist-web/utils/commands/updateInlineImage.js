import _extends from "@babel/runtime/helpers/extends";
import { Commands, domUtils } from '@ali/4ever-cangjie';
import { isValidSize } from "../utils/aslService";
var injectionKeys = ['isImageCropping', 'uploadPercent', 'isError', 'isSettingBorder'];
export default function updateInlineImage(controller, image, data, container) {
  if (!image) {
    return controller;
  }

  var document = controller.value.document;
  var path = document.getPath(image.key);
  var node = document.getNodeByPath(path);
  if (!node) return controller;

  var newData = _extends({}, node == null ? void 0 : node.data, data);

  injectionKeys.forEach(function (key) {
    delete newData[key];
  }); // 更新 rotation 的时候，若宽或高未落库，会影响后续计算

  if (!isValidSize(newData.width, newData.height) && data.rotation > 0) {
    var root = container != null ? container : domUtils.findDOMNodeSafely(controller.value.document.key);
    var img = domUtils.findDOMNodeSafely(image.key, root);
    newData.width = img == null ? void 0 : img.clientWidth;
    newData.height = img == null ? void 0 : img.clientHeight;
  }

  return controller.command(Commands.setNodeByKey, image.key, {
    data: newData
  });
}
//# sourceMappingURL=updateInlineImage.js.map