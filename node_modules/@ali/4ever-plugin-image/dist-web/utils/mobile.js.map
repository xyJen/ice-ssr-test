{"version":3,"sources":["../../../src/utils/mobile.tsx"],"names":["React","Image","isParentClickable","forwardRef","props","ref","node","onLoad","controller","imageConfig","readonly","isSelected","rest","previewImage","shouldZoom","useRef","useState","isLoaded","setIsLoaded","data","src","handleZoomImage","useCallback","event","isSelectingNode","query","isQuickPreview","current","handlers","useMemo","onTouchEnd","onTouchStart","onTouchMove","onClick","preventDefault","handleOnLoad"],"mappings":";;AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;qBAC4B,a;AAC5B,OAAOC,KAAP;AAEA,OAAOC,iBAAP;AAeA,4BAAeF,KAAK,CAACG,UAAN,CAAiB,UAACC,KAAD,EAAgBC,GAAhB,EAA8D;AAAA,MAE1FC,IAF0F,GAGxFF,KAHwF,CAE1FE,IAF0F;AAAA,MAEpFC,MAFoF,GAGxFH,KAHwF,CAEpFG,MAFoF;AAAA,MAE5EC,UAF4E,GAGxFJ,KAHwF,CAE5EI,UAF4E;AAAA,MAEhEC,WAFgE,GAGxFL,KAHwF,CAEhEK,WAFgE;AAAA,MAEnDC,QAFmD,GAGxFN,KAHwF,CAEnDM,QAFmD;AAAA,MAEzCC,UAFyC,GAGxFP,KAHwF,CAEzCO,UAFyC;AAAA,MAE1BC,IAF0B,iCAGxFR,KAHwF;;AAAA,MAIpFS,YAJoF,GAInEJ,WAJmE,CAIpFI,YAJoF;AAM5F,MAAMC,UAAU,GAAGd,KAAK,CAACe,MAAN,CAAa,IAAb,CAAnB;;AAN4F,wBAO5Df,KAAK,CAACgB,QAAN,CAAe,KAAf,CAP4D;AAAA,MAOrFC,QAPqF;AAAA,MAO3EC,WAP2E;;AAAA,MAQpFC,IARoF,GAQ3Eb,IAR2E,CAQpFa,IARoF;AAAA,MASpFC,GAToF,GAS5ED,IAT4E,CASpFC,GAToF;AAU5F,MAAMC,eAAe,GAAGrB,KAAK,CAACsB,WAAN,CAAkB,UAACC,KAAD,EAA6B;AACrE,QAAMC,eAAe,GAAGhB,UAAU,CAACiB,KAAX,CAAiB,iBAAjB,CAAxB;;AACA,QAAIvB,iBAAiB,CAACM,UAAD,EAAaF,IAAb,CAAjB,IAAuCkB,eAA3C,EAA6D;AAC3D;AACD,KAJoE,CAKrE;;;AACA,QAAME,cAAc,GAAGlB,UAAU,CAACiB,KAAX,CAAiB,gBAAjB,CAAvB;;AACA,QACE,OAAOZ,YAAP,KAAwB,UAAxB,IAAsCC,UAAU,CAACa,OAAjD,IACI,CAACjB,QAAQ,IAAIC,UAAZ,IAA0Be,cAA3B,KAA8CT,QAFpD,EAGE;AACAJ,MAAAA,YAAY,CAACO,GAAD,EAAMd,IAAN,CAAZ;AACD;AACF,GAbuB,EAarB,CAACE,UAAD,EAAaF,IAAb,EAAmBO,YAAnB,EAAiCH,QAAjC,EAA2CC,UAA3C,EAAuDM,QAAvD,EAAiEG,GAAjE,CAbqB,CAAxB;AAeA,MAAMQ,QAAQ,GAAG5B,KAAK,CAAC6B,OAAN,CAAc,YAAM;AACnC,WAAO;AACLC,MAAAA,UAAU,EAAET,eADP;AAELU,MAAAA,YAAY,EAAE,wBAAM;AAClB,YAAMP,eAAe,GAAGhB,UAAU,CAACiB,KAAX,CAAiB,iBAAjB,CAAxB;AACAX,QAAAA,UAAU,CAACa,OAAX,GAAqB,CAACH,eAAtB;AACD,OALI;AAMLQ,MAAAA,WAAW,EAAE,uBAAM;AACjBlB,QAAAA,UAAU,CAACa,OAAX,GAAqB,KAArB;AACD,OARI;AASLM,MAAAA,OAAO,EAAE,iBAACV,KAAD,EAA6B;AACpC,YAAI,CAACrB,iBAAiB,CAACM,UAAD,EAAaF,IAAb,CAAtB,EAA0C;AACxCiB,UAAAA,KAAK,CAACW,cAAN;AACD;AACF;AAbI,KAAP;AAeD,GAhBgB,EAgBd,CAACb,eAAD,EAAkBb,UAAlB,EAA8BF,IAA9B,CAhBc,CAAjB;AAkBA,MAAM6B,YAAY,GAAGnC,KAAK,CAACsB,WAAN,CAAkB,YAAM;AAC3CJ,IAAAA,WAAW,CAAC,IAAD,CAAX;;AACA,QAAI,OAAOX,MAAP,KAAkB,UAAtB,EAAkC;AAChCA,MAAAA,MAAM;AACP;AACF,GALoB,EAKlB,CAACa,GAAD,EAAMb,MAAN,CALkB,CAArB;AAOA,sBACE,eAAC,KAAD,eACMK,IADN;AAEE,IAAA,GAAG,EAAEP,GAFP;AAGE,IAAA,IAAI,EAAEC,IAHR;AAIE,IAAA,UAAU,EAAEE,UAJd;AAKE,IAAA,MAAM,EAAE2B,YALV;AAME,IAAA,WAAW,EAAE1B;AANf,KAOMmB,QAPN;AAQE,IAAA,QAAQ;AARV,KADF;AAYD,CA9Dc,CAAf","sourcesContent":["import * as React from 'react';\nimport { Controller, Inline } from '@ali/4ever-cangjie';\nimport Image from './components/image';\nimport { ImagePluginConfig } from './types';\nimport isParentClickable from './utils/isParentClickable';\n\ninterface IProps {\n  node: Inline;\n  controller: Controller;\n  readonly?: boolean;\n  onClick?: (event: React.MouseEvent) => void;\n  onLoad?: () => void;\n  imageConfig: ImagePluginConfig;\n  isSelected: boolean;\n  isInserting?: boolean;\n  uploadPlaceholder?: string;\n  isTransferring?: boolean;\n}\n\nexport default React.forwardRef((props: IProps, ref: React.ForwardedRef<HTMLImageElement>) => {\n  const {\n    node, onLoad, controller, imageConfig, readonly, isSelected, ...rest\n  } = props;\n  const { previewImage } = imageConfig;\n\n  const shouldZoom = React.useRef(true);\n  const [isLoaded, setIsLoaded] = React.useState(false);\n  const { data } = node;\n  const { src } = data;\n  const handleZoomImage = React.useCallback((event: React.TouchEvent) => {\n    const isSelectingNode = controller.query('isSelectingNode');\n    if (isParentClickable(controller, node) || isSelectingNode ) {\n      return;\n    }\n    // 非只读的预览模式，点击可以放大\n    const isQuickPreview = controller.query('isQuickPreview');\n    if (\n      typeof previewImage === 'function' && shouldZoom.current\n      && ((readonly || isSelected || isQuickPreview) && isLoaded)\n    ) {\n      previewImage(src, node);\n    }\n  }, [controller, node, previewImage, readonly, isSelected, isLoaded, src]);\n\n  const handlers = React.useMemo(() => {\n    return {\n      onTouchEnd: handleZoomImage,\n      onTouchStart: () => {\n        const isSelectingNode = controller.query('isSelectingNode');\n        shouldZoom.current = !isSelectingNode;\n      },\n      onTouchMove: () => {\n        shouldZoom.current = false;\n      },\n      onClick: (event: React.MouseEvent) => {\n        if (!isParentClickable(controller, node)) {\n          event.preventDefault();\n        }\n      },\n    };\n  }, [handleZoomImage, controller, node]);\n\n  const handleOnLoad = React.useCallback(() => {\n    setIsLoaded(true);\n    if (typeof onLoad === 'function') {\n      onLoad();\n    }\n  }, [src, onLoad]);\n\n  return (\n    <Image\n      {...rest}\n      ref={ref}\n      node={node}\n      controller={controller}\n      onLoad={handleOnLoad}\n      imageConfig={imageConfig}\n      {...handlers}\n      isMobile\n    />\n  );\n});\n"],"file":"mobile.js"}