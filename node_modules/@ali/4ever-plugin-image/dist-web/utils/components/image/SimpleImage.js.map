{"version":3,"sources":["../../../../../src/utils/components/image/SimpleImage.tsx"],"names":["React","styled","DEFAULT_WIDTH","IMAGE_DATA_WRAPPER_CLASS_NAME","IMAGE_EDIT_BORDER","isValidSize","Status","MetaImage","Wrapper","span","getStyle","data","isAutoFit","status","imageStyle","position","top","left","width","height","wrapperStyle","maxWidth","isSizeValid","proportion","paddingTop","Success","boxSizing","SimpleImage","props","onStatusChangeProp","onStatusChange","styleProp","style","rest","useState","Loading","setStatus"],"mappings":"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","sourcesContent":["import React from 'react';\nimport styled from 'styled-components';\nimport type { ImageData } from '../../../mo/models';\nimport { DEFAULT_WIDTH, IMAGE_DATA_WRAPPER_CLASS_NAME, IMAGE_EDIT_BORDER } from '../../constants';\nimport { isValidSize } from '../../utils/aslService';\nimport { Status } from '../types';\nimport type { IImageProps } from './types';\nimport { MetaImage } from './MetaImage';\n\nconst Wrapper = styled.span`\n  display: inline-block;\n  vertical-align: bottom;\n  &::after {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    left: 0;\n    top: 0;\n    border: transparent;\n    pointer-events: none;\n    content: '';\n  }\n`;\n\nconst getStyle = (data: ImageData, isAutoFit: boolean, status: Status) => {\n  const imageStyle: React.CSSProperties = {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    width: '100%',\n    height: '100%',\n  };\n  const wrapperStyle: React.CSSProperties = {\n    position: 'relative',\n  };\n  if (isAutoFit) {\n    wrapperStyle.maxWidth = '100%';\n  }\n  const { width, height } = data;\n  const isSizeValid = isValidSize(width, height);\n  if (isSizeValid) {\n    const proportion = height! / width!;\n    wrapperStyle.width = width;\n    wrapperStyle.height = 0;\n    wrapperStyle.paddingTop = `calc(100% * ${proportion})`;\n  } else if (status === Status.Success) {\n    // 宽高未落库时，不再使用绝对定位，因为无法确定外面的容器的尺寸。\n    imageStyle.height = 'auto';\n    imageStyle.width = 'auto';\n    imageStyle.position = 'static';\n    imageStyle.maxWidth = wrapperStyle.maxWidth;\n    wrapperStyle.boxSizing = 'border-box';\n  } else {\n    wrapperStyle.width = DEFAULT_WIDTH;\n    wrapperStyle.height = 0;\n    wrapperStyle.paddingTop = '100%';\n  }\n  return {\n    wrapperStyle,\n    imageStyle,\n  };\n};\n\n\nexport const SimpleImage: React.FC<IImageProps> = (props) => {\n  const { data, isAutoFit, onStatusChange: onStatusChangeProp, style: styleProp, ...rest } = props;\n  const [status, setStatus] = React.useState(Status.Loading);\n  const { wrapperStyle, imageStyle } = getStyle(data, isAutoFit, status);\n\n  const onStatusChange = (status: Status) => {\n    setStatus(status);\n    onStatusChangeProp && onStatusChangeProp(status);\n  };\n\n  return (\n    <Wrapper style={wrapperStyle} className={`${IMAGE_DATA_WRAPPER_CLASS_NAME} ${IMAGE_EDIT_BORDER} cangjie-image-wrapper cangjie-image-simple-wrapper`}>\n      <MetaImage\n        data={data}\n        onStatusChange={onStatusChange}\n        style={{\n          ...styleProp,\n          ...imageStyle,\n        }}\n        {...rest}\n      />\n    </Wrapper>\n  );\n};"],"file":"SimpleImage.js"}