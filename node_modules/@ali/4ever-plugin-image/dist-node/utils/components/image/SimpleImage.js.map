{"version":3,"sources":["../../../../../src/utils/components/image/SimpleImage.tsx"],"names":["Wrapper","styled","span","getStyle","data","isAutoFit","status","imageStyle","position","top","left","width","height","wrapperStyle","maxWidth","isSizeValid","proportion","paddingTop","Status","Success","boxSizing","DEFAULT_WIDTH","SimpleImage","props","onStatusChange","onStatusChangeProp","style","styleProp","rest","setStatus","React","useState","Loading","IMAGE_DATA_WRAPPER_CLASS_NAME","IMAGE_EDIT_BORDER"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AAEA;;AACA;;AACA;;AAEA;;uBAN4B,a;;AAQ5B,MAAMA,OAAO,gBAAGC,0BAAOC,IAAV,mKAAb;;AAeA,MAAMC,QAAQ,GAAG,CAACC,IAAD,EAAkBC,SAAlB,EAAsCC,MAAtC,KAAyD;AACxE,QAAMC,UAA+B,GAAG;AACtCC,IAAAA,QAAQ,EAAE,UAD4B;AAEtCC,IAAAA,GAAG,EAAE,CAFiC;AAGtCC,IAAAA,IAAI,EAAE,CAHgC;AAItCC,IAAAA,KAAK,EAAE,MAJ+B;AAKtCC,IAAAA,MAAM,EAAE;AAL8B,GAAxC;AAOA,QAAMC,YAAiC,GAAG;AACxCL,IAAAA,QAAQ,EAAE;AAD8B,GAA1C;;AAGA,MAAIH,SAAJ,EAAe;AACbQ,IAAAA,YAAY,CAACC,QAAb,GAAwB,MAAxB;AACD;;AACD,QAAM;AAAEH,IAAAA,KAAF;AAASC,IAAAA;AAAT,MAAoBR,IAA1B;AACA,QAAMW,WAAW,GAAG,6BAAYJ,KAAZ,EAAmBC,MAAnB,CAApB;;AACA,MAAIG,WAAJ,EAAiB;AACf,UAAMC,UAAU,GAAGJ,MAAM,GAAID,KAA7B;AACAE,IAAAA,YAAY,CAACF,KAAb,GAAqBA,KAArB;AACAE,IAAAA,YAAY,CAACD,MAAb,GAAsB,CAAtB;AACAC,IAAAA,YAAY,CAACI,UAAb,GAA2B,eAAcD,UAAW,GAApD;AACD,GALD,MAKO,IAAIV,MAAM,KAAKY,cAAOC,OAAtB,EAA+B;AACpC;AACAZ,IAAAA,UAAU,CAACK,MAAX,GAAoB,MAApB;AACAL,IAAAA,UAAU,CAACI,KAAX,GAAmB,MAAnB;AACAJ,IAAAA,UAAU,CAACC,QAAX,GAAsB,QAAtB;AACAD,IAAAA,UAAU,CAACO,QAAX,GAAsBD,YAAY,CAACC,QAAnC;AACAD,IAAAA,YAAY,CAACO,SAAb,GAAyB,YAAzB;AACD,GAPM,MAOA;AACLP,IAAAA,YAAY,CAACF,KAAb,GAAqBU,wBAArB;AACAR,IAAAA,YAAY,CAACD,MAAb,GAAsB,CAAtB;AACAC,IAAAA,YAAY,CAACI,UAAb,GAA0B,MAA1B;AACD;;AACD,SAAO;AACLJ,IAAAA,YADK;AAELN,IAAAA;AAFK,GAAP;AAID,CArCD;;AAwCO,MAAMe,WAAkC,GAAIC,KAAD,IAAW;AAC3D,QAAM;AAAEnB,IAAAA,IAAF;AAAQC,IAAAA,SAAR;AAAmBmB,IAAAA,cAAc,EAAEC,kBAAnC;AAAuDC,IAAAA,KAAK,EAAEC,SAA9D;AAAyE,OAAGC;AAA5E,MAAqFL,KAA3F;;AACA,QAAM,CAACjB,MAAD,EAASuB,SAAT,IAAsBC,eAAMC,QAAN,CAAeb,cAAOc,OAAtB,CAA5B;;AACA,QAAM;AAAEnB,IAAAA,YAAF;AAAgBN,IAAAA;AAAhB,MAA+BJ,QAAQ,CAACC,IAAD,EAAOC,SAAP,EAAkBC,MAAlB,CAA7C;;AAEA,QAAMkB,cAAc,GAAIlB,MAAD,IAAoB;AACzCuB,IAAAA,SAAS,CAACvB,MAAD,CAAT;AACAmB,IAAAA,kBAAkB,IAAIA,kBAAkB,CAACnB,MAAD,CAAxC;AACD,GAHD;;AAKA,sBACE,eAAC,OAAD;AAAS,IAAA,KAAK,EAAEO,YAAhB;AAA8B,IAAA,SAAS,EAAG,GAAEoB,wCAA8B,IAAGC,4BAAkB;AAA/F,kBACE,eAAC,oBAAD;AACE,IAAA,IAAI,EAAE9B,IADR;AAEE,IAAA,cAAc,EAAEoB,cAFlB;AAGE,IAAA,KAAK,EAAE,EACL,GAAGG,SADE;AAEL,SAAGpB;AAFE;AAHT,KAOMqB,IAPN,EADF,CADF;AAaD,CAvBM","sourcesContent":["import React from 'react';\nimport styled from 'styled-components';\nimport type { ImageData } from '../../../mo/models';\nimport { DEFAULT_WIDTH, IMAGE_DATA_WRAPPER_CLASS_NAME, IMAGE_EDIT_BORDER } from '../../constants';\nimport { isValidSize } from '../../utils/aslService';\nimport { Status } from '../types';\nimport type { IImageProps } from './types';\nimport { MetaImage } from './MetaImage';\n\nconst Wrapper = styled.span`\n  display: inline-block;\n  vertical-align: bottom;\n  &::after {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    left: 0;\n    top: 0;\n    border: transparent;\n    pointer-events: none;\n    content: '';\n  }\n`;\n\nconst getStyle = (data: ImageData, isAutoFit: boolean, status: Status) => {\n  const imageStyle: React.CSSProperties = {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    width: '100%',\n    height: '100%',\n  };\n  const wrapperStyle: React.CSSProperties = {\n    position: 'relative',\n  };\n  if (isAutoFit) {\n    wrapperStyle.maxWidth = '100%';\n  }\n  const { width, height } = data;\n  const isSizeValid = isValidSize(width, height);\n  if (isSizeValid) {\n    const proportion = height! / width!;\n    wrapperStyle.width = width;\n    wrapperStyle.height = 0;\n    wrapperStyle.paddingTop = `calc(100% * ${proportion})`;\n  } else if (status === Status.Success) {\n    // 宽高未落库时，不再使用绝对定位，因为无法确定外面的容器的尺寸。\n    imageStyle.height = 'auto';\n    imageStyle.width = 'auto';\n    imageStyle.position = 'static';\n    imageStyle.maxWidth = wrapperStyle.maxWidth;\n    wrapperStyle.boxSizing = 'border-box';\n  } else {\n    wrapperStyle.width = DEFAULT_WIDTH;\n    wrapperStyle.height = 0;\n    wrapperStyle.paddingTop = '100%';\n  }\n  return {\n    wrapperStyle,\n    imageStyle,\n  };\n};\n\n\nexport const SimpleImage: React.FC<IImageProps> = (props) => {\n  const { data, isAutoFit, onStatusChange: onStatusChangeProp, style: styleProp, ...rest } = props;\n  const [status, setStatus] = React.useState(Status.Loading);\n  const { wrapperStyle, imageStyle } = getStyle(data, isAutoFit, status);\n\n  const onStatusChange = (status: Status) => {\n    setStatus(status);\n    onStatusChangeProp && onStatusChangeProp(status);\n  };\n\n  return (\n    <Wrapper style={wrapperStyle} className={`${IMAGE_DATA_WRAPPER_CLASS_NAME} ${IMAGE_EDIT_BORDER} cangjie-image-wrapper cangjie-image-simple-wrapper`}>\n      <MetaImage\n        data={data}\n        onStatusChange={onStatusChange}\n        style={{\n          ...styleProp,\n          ...imageStyle,\n        }}\n        {...rest}\n      />\n    </Wrapper>\n  );\n};"],"file":"SimpleImage.js"}