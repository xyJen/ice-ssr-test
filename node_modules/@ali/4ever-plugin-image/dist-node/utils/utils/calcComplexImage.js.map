{"version":3,"sources":["../../../../src/utils/utils/calcComplexImage.ts"],"names":["data","isAutoFit","rotationObj","width","height","opacity","outline","rectClip","radius","DEFAULT_RADIUS","rotation","border","outlineWidth","frameStyle","transform","undefined","borderStyle","borderRadius","translateX","translateY","rotateStyle","rWidth","rHeight","l","left","r","right","t","top","b","bottom","imgStyle","position","clipPath","WebkitClipPath","proportion","Number","toFixed","isNaN","imgWidth","imgHeight","maxWidth","paddingTop"],"mappings":";;;;;;;;;AACA;;AACA;;AAEA;;eAEe,CAACA,IAAD,EAAkBC,SAAlB,KAA0C;AACvD,MAAIC,WAAJ;AAEA,QAAM;AAAEC,IAAAA,KAAF;AAASC,IAAAA,MAAT;AAAiBC,IAAAA,OAAjB;AAA0BC,IAAAA,OAA1B;AAAmCC,IAAAA,QAAQ,GAAG,EAA9C;AAAkDC,IAAAA,MAAM,GAAGC;AAA3D,MAA8ET,IAApF;AACA,QAAMU,QAAQ,GAAG,+BAAeV,IAAI,EAAEU,QAAN,IAAkB,CAAjC,CAAjB;AACA,MAAIC,MAAJ;AACA,MAAIC,YAAY,GAAG,CAAnB;;AACA,MAAIN,OAAO,IAAIA,OAAO,CAACH,KAAvB,EAA8B;AAC5BQ,IAAAA,MAAM,GAAG,wBAAUL,OAAV,CAAT;AACAM,IAAAA,YAAY,GAAGN,OAAO,CAACH,KAAvB;AACD;;AAED,MAAIO,QAAQ,KAAK,CAAb,IAAkBP,KAAK,GAAI,CAA3B,IAAgCC,MAAM,GAAI,CAA9C,EAAiD;AAC/CF,IAAAA,WAAW,GAAG,gCAAgBC,KAAhB,EAAuBC,MAAvB,EAA+BM,QAA/B,CAAd;AACD;;AAED,QAAMG,UAA+B,GAAG;AACtCV,IAAAA,KADsC;AAEtCC,IAAAA,MAFsC;AAGtCC,IAAAA,OAHsC;AAItCS,IAAAA,SAAS,EAAEC;AAJ2B,GAAxC;AAOA,QAAMC,WAAgC,GAAG;AACvCL,IAAAA,MADuC;AAEvCM,IAAAA,YAAY,EAAET;AAFyB,GAAzC;;AAKA,MAAIN,WAAJ,EAAiB;AACfW,IAAAA,UAAU,CAACC,SAAX,GAAwB,aAAYZ,WAAW,CAACgB,UAAW,OAAMhB,WAAW,CAACiB,UAAW,cAAaT,QAAS,MAA9G;AACD;;AAED,QAAMU,WAAuF,GAAG;AAC9FjB,IAAAA,KAAK,EAAED,WAAW,GAAGA,WAAW,CAACmB,MAAf,GAAwBlB,KADoD;AAE9FC,IAAAA,MAAM,EAAEF,WAAW,GAAGA,WAAW,CAACoB,OAAf,GAAyBlB;AAFkD,GAAhG;AAIA,QAAMmB,CAAC,GAAGhB,QAAQ,CAACiB,IAAT,IAAiB,CAA3B;AACA,QAAMC,CAAC,GAAGlB,QAAQ,CAACmB,KAAT,IAAkB,CAA5B;AACA,QAAMC,CAAC,GAAGpB,QAAQ,CAACqB,GAAT,IAAgB,CAA1B;AACA,QAAMC,CAAC,GAAGtB,QAAQ,CAACuB,MAAT,IAAmB,CAA7B;AAEA,QAAMC,QAA6B,GAAG;AACpCP,IAAAA,IAAI,EAAE,CAACD,CAAD,GAAKX,YADyB;AAEpCgB,IAAAA,GAAG,EAAE,CAACD,CAAD,GAAKf,YAF0B;AAGpCT,IAAAA,KAAK,EAAE,OAAOA,KAAP,KAAiB,QAAjB,GAA6BA,KAAK,GAAGoB,CAAR,GAAYE,CAAzC,GAA8CtB,KAHjB;AAIpCC,IAAAA,MAAM,EAAE,OAAOA,MAAP,KAAkB,QAAlB,GAA8BA,MAAM,GAAGuB,CAAT,GAAaE,CAA3C,GAAgDzB,MAJpB;AAKpC4B,IAAAA,QAAQ,EAAE,UAL0B;AAMpC;AACAC,IAAAA,QAAQ,EAAG,SAAQN,CAAC,GAAGf,YAAa,MAAKa,CAAC,GAAGb,YAAa,MAAKiB,CAAC,GAAGjB,YAAa,MAAKW,CAAC,GAAGX,YAAa,KAPlE;AAQpCsB,IAAAA,cAAc,EAAG,SAAQP,CAAC,GAAGf,YAAa,MAAKa,CAAC,GAAGb,YAAa,MAAKiB,CAAC,GAAGjB,YAAa,MAAKW,CAAC,GAAGX,YAAa;AARxE,GAAtC;;AAWA,MAAIX,SAAJ,EAAe;AACb,UAAMkC,UAAU,GAAGC,MAAM,CAAC,CAAChB,WAAW,CAAChB,MAAZ,GAAsBgB,WAAW,CAACjB,KAAnC,EAA2CkC,OAA3C,CAAmD,CAAnD,CAAD,CAAzB;;AACA,QAAI,CAACD,MAAM,CAACE,KAAP,CAAaH,UAAb,CAAD,IAA6B,OAAOhC,KAAP,KAAiB,QAA9C,IAA0D,OAAOC,MAAP,KAAkB,QAAhF,EAA0F;AACxF,YAAMmC,QAAQ,GAAGpC,KAAK,GAAGoB,CAAR,GAAYE,CAA7B;AACA,YAAMe,SAAS,GAAGpC,MAAM,GAAGuB,CAAT,GAAaE,CAA/B;AACAE,MAAAA,QAAQ,CAACP,IAAT,GAAiB,eAAc,CAACD,CAAD,GAAKpB,KAAM,GAA1C;AACA4B,MAAAA,QAAQ,CAACH,GAAT,GAAgB,eAAc,CAACD,CAAD,GAAKvB,MAAO,GAA1C;AACA2B,MAAAA,QAAQ,CAAC5B,KAAT,GAAkB,eAAcoC,QAAQ,GAAGpC,KAAM,GAAjD;AACA4B,MAAAA,QAAQ,CAAC3B,MAAT,GAAmB,eAAcoC,SAAS,GAAGpC,MAAO,GAApD;AACA,YAAM6B,QAAQ,GAAI,qBAAoBN,CAAC,GAAGa,SAAU,iBAAgBf,CAAC,GAAGc,QAAS,iBAAgBV,CAAC,GAAGW,SAAU,iBAAgBjB,CAAC,GAAGgB,QAAS,IAA5I;AACAR,MAAAA,QAAQ,CAACE,QAAT,GAAoBA,QAApB;AACAF,MAAAA,QAAQ,CAACG,cAAT,GAA0BD,QAA1B;;AAGA,UAAI/B,WAAJ,EAAiB;AACfW,QAAAA,UAAU,CAACC,SAAX,GAAwB,UAASJ,QAAS,MAA1C;AACAG,QAAAA,UAAU,CAACW,IAAX,GAAmB,eAActB,WAAW,CAACgB,UAAZ,GAAyBE,WAAW,CAACjB,KAAM,GAA5E;AACAU,QAAAA,UAAU,CAACe,GAAX,GAAkB,eAAc1B,WAAW,CAACiB,UAAZ,GAAyBC,WAAW,CAAChB,MAAO,GAA5E;AACAS,QAAAA,UAAU,CAACV,KAAX,GAAoB,eAAcA,KAAK,GAAGiB,WAAW,CAACjB,KAAM,GAA5D;AACAU,QAAAA,UAAU,CAACT,MAAX,GAAqB,eAAcA,MAAM,GAAGgB,WAAW,CAAChB,MAAO,GAA/D;AACD,OAND,MAMO;AACLS,QAAAA,UAAU,CAACW,IAAX,GAAkB,CAAlB;AACAX,QAAAA,UAAU,CAACe,GAAX,GAAiB,CAAjB;AACAf,QAAAA,UAAU,CAACV,KAAX,GAAmB,MAAnB;AACAU,QAAAA,UAAU,CAACT,MAAX,GAAoB,MAApB;AACD;;AAEDgB,MAAAA,WAAW,CAACqB,QAAZ,GAAuB,MAAvB;AACArB,MAAAA,WAAW,CAACsB,UAAZ,GAA0B,eAAcP,UAAW,GAAnD;AACAf,MAAAA,WAAW,CAAChB,MAAZ,GAAqB,CAArB;AACD;AACF;;AAED,SAAO;AACLgB,IAAAA,WADK;AAELP,IAAAA,UAFK;AAGLkB,IAAAA,QAHK;AAILf,IAAAA,WAJK;AAKLJ,IAAAA;AALK,GAAP;AAOD,C","sourcesContent":["import React from 'react';\nimport { calcRotationObj, normalizeAngle } from '@ali/4ever-utils';\nimport getBorder from './getBorder';\nimport type { ImageData } from '../../mo/models';\nimport { DEFAULT_RADIUS } from '../constants';\n\nexport default (data: ImageData, isAutoFit?: boolean) => {\n  let rotationObj;\n\n  const { width, height, opacity, outline, rectClip = {}, radius = DEFAULT_RADIUS } = data!;\n  const rotation = normalizeAngle(data?.rotation || 0);\n  let border: string | undefined;\n  let outlineWidth = 0;\n  if (outline && outline.width) {\n    border = getBorder(outline);\n    outlineWidth = outline.width;\n  }\n\n  if (rotation !== 0 && width! > 0 && height! > 0) {\n    rotationObj = calcRotationObj(width, height, rotation);\n  }\n\n  const frameStyle: React.CSSProperties = {\n    width,\n    height,\n    opacity,\n    transform: undefined,\n  };\n\n  const borderStyle: React.CSSProperties = {\n    border,\n    borderRadius: radius,\n  };\n\n  if (rotationObj) {\n    frameStyle.transform = `translate(${rotationObj.translateX}px, ${rotationObj.translateY}px) rotate(${rotation}deg)`;\n  }\n\n  const rotateStyle: { width: number; height: number; maxWidth?: string; paddingTop?: string; } = {\n    width: rotationObj ? rotationObj.rWidth : width,\n    height: rotationObj ? rotationObj.rHeight : height,\n  };\n  const l = rectClip.left || 0;\n  const r = rectClip.right || 0;\n  const t = rectClip.top || 0;\n  const b = rectClip.bottom || 0;\n\n  const imgStyle: React.CSSProperties = {\n    left: -l - outlineWidth,\n    top: -t - outlineWidth,\n    width: typeof width === 'number' ? (width + l + r) : width,\n    height: typeof height === 'number' ? (height + t + b) : height,\n    position: 'absolute',\n    // 解决 iPad 上 overflow 不生效的问题\n    clipPath: `inset(${t + outlineWidth}px ${r + outlineWidth}px ${b + outlineWidth}px ${l + outlineWidth}px)`,\n    WebkitClipPath: `inset(${t + outlineWidth}px ${r + outlineWidth}px ${b + outlineWidth}px ${l + outlineWidth}px)`,\n  };\n\n  if (isAutoFit) {\n    const proportion = Number((rotateStyle.height! / rotateStyle.width!).toFixed(5));\n    if (!Number.isNaN(proportion) && typeof width === 'number' && typeof height === 'number') {\n      const imgWidth = width + l + r;\n      const imgHeight = height + t + b;\n      imgStyle.left = `calc(100% * ${-l / width})`;\n      imgStyle.top = `calc(100% * ${-t / height})`;\n      imgStyle.width = `calc(100% * ${imgWidth / width})`;\n      imgStyle.height = `calc(100% * ${imgHeight / height})`;\n      const clipPath = `inset(calc(100% * ${t / imgHeight}) calc(100% * ${r / imgWidth}) calc(100% * ${b / imgHeight}) calc(100% * ${l / imgWidth}))`;\n      imgStyle.clipPath = clipPath;\n      imgStyle.WebkitClipPath = clipPath;\n\n\n      if (rotationObj) {\n        frameStyle.transform = `rotate(${rotation}deg)`;\n        frameStyle.left = `calc(100% * ${rotationObj.translateX / rotateStyle.width})`;\n        frameStyle.top = `calc(100% * ${rotationObj.translateY / rotateStyle.height})`;\n        frameStyle.width = `calc(100% * ${width / rotateStyle.width})`;\n        frameStyle.height = `calc(100% * ${height / rotateStyle.height})`;\n      } else {\n        frameStyle.left = 0;\n        frameStyle.top = 0;\n        frameStyle.width = '100%';\n        frameStyle.height = '100%';\n      }\n\n      rotateStyle.maxWidth = '100%';\n      rotateStyle.paddingTop = `calc(100% * ${proportion})`;\n      rotateStyle.height = 0;\n    }\n  }\n\n  return {\n    rotateStyle,\n    frameStyle,\n    imgStyle,\n    borderStyle,\n    outlineWidth,\n  };\n};\n"],"file":"calcComplexImage.js"}