{"version":3,"sources":["../../../src/utils/Refer.tsx"],"names":["Refer","props","attributes","onDingpanPreview","node","data","name","fileType","corpId","spaceId","fileId","fileSize","text","nodes","leaf","leaves","marks","isClicked","onPreview","React","useCallback","fileName","mode","handleTouchStart","e","preventDefault","stopPropagation","handleTouchMove","handleTouchEnd","innerType","FileIcon","FileIconMap","environment","IS_MOBILE","memo"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;uBAJ4B,a;;AAM5B,MAAMA,KAAK,GAAIC,KAAD,IAAW;AACvB,QAAM;AAAEC,IAAAA,UAAF;AAAcC,IAAAA,gBAAd;AAAgCC,IAAAA;AAAhC,MAAyCH,KAA/C;AACA,QAAM;AAAEI,IAAAA;AAAF,MAAWD,IAAjB;AACA,QAAM;AAAEE,IAAAA,IAAF;AAAQC,IAAAA,QAAR;AAAkBC,IAAAA,MAAlB;AAA0BC,IAAAA,OAA1B;AAAmCC,IAAAA,MAAnC;AAA2CC,IAAAA;AAA3C,MAAwDN,IAA9D;AACA,QAAMO,IAAI,GAAGR,IAAI,CAACS,KAAL,CAAW,CAAX,CAAb;AACA,QAAMC,IAAI,GAAGF,IAAI,CAACG,MAAL,CAAY,CAAZ,CAAb;AACA,QAAMC,KAAK,GAAGF,IAAI,GAAGA,IAAI,CAACE,KAAR,GAAgB,EAAlC;AAEA,MAAIC,SAAS,GAAG,KAAhB;;AAEA,QAAMC,SAAS,GAAGC,eAAMC,WAAN,CAAkB,MAAM;AACxC,QAAIjB,gBAAJ,EAAsB;AACpBA,MAAAA,gBAAgB,CAAC;AACfK,QAAAA,MADe;AAEfC,QAAAA,OAFe;AAGfC,QAAAA,MAHe;AAIfC,QAAAA,QAJe;AAKfJ,QAAAA,QALe;AAMfc,QAAAA,QAAQ,EAAEf,IANK;AAOfgB,QAAAA,IAAI,EAAE;AAPS,OAAD,CAAhB;AASD;AACF,GAZiB,EAYf,EAZe,CAAlB;;AAcA,QAAMC,gBAAgB,GAAGJ,eAAMC,WAAN,CAAmBI,CAAD,IAAO;AAChDA,IAAAA,CAAC,CAACC,cAAF;AACAD,IAAAA,CAAC,CAACE,eAAF;AACAT,IAAAA,SAAS,GAAG,IAAZ;AACD,GAJwB,EAItB,EAJsB,CAAzB;;AAMA,QAAMU,eAAe,GAAGR,eAAMC,WAAN,CAAmBI,CAAD,IAAO;AAC/CA,IAAAA,CAAC,CAACC,cAAF;AACAD,IAAAA,CAAC,CAACE,eAAF;AACAT,IAAAA,SAAS,GAAG,KAAZ;AACD,GAJuB,EAIrB,EAJqB,CAAxB;;AAMA,QAAMW,cAAc,GAAGT,eAAMC,WAAN,CAAmBI,CAAD,IAAO;AAC9CA,IAAAA,CAAC,CAACC,cAAF;AACAD,IAAAA,CAAC,CAACE,eAAF;;AAEA,QAAIT,SAAJ,EAAe;AACbC,MAAAA,SAAS;AACV;AACF,GAPsB,EAOpB,EAPoB,CAAvB;;AASA,QAAMW,SAAS,GAAG,yCAAmBvB,IAAnB,CAAlB;AACA,QAAMwB,QAAQ,GAAGC,6BAAYF,SAAZ,CAAjB;AAEA,sBACE,uBAAU3B,UAAV,eACE,eAAC,wBAAD;AACE,mBAAY,OADd;AAEE,IAAA,OAAO,EAAEgB,SAFX;AAGE,IAAA,KAAK,EAAE,2BAAaF,KAAb,CAHT;AAIE,IAAA,YAAY,EAAEO,gBAJhB;AAKE,IAAA,WAAW,EAAEI,eALf;AAME,IAAA,UAAU,EAAEC;AANd,KAQGE,QAAQ,iBAAI,eAAC,QAAD,OARf,eASE,eAAC,iBAAD;AAAW,IAAA,QAAQ,EAAEE,yBAAYC;AAAjC,KACG,+BAAiBJ,SAAjB,EAA4BxB,IAAI,CAACC,IAAjC,CADH,CATF,CADF,CADF;AAiBD,CAjED;;4BAmEea,eAAMe,IAAN,CAAWlC,KAAX,C","sourcesContent":["import React from 'react';\nimport { Text, environment } from '@ali/4ever-cangjie';\nimport { ReferTextWrapper, ReferText } from './styled';\nimport convertMarks from './convertMarks';\nimport getFileName4Show from './getFileName4Show';\nimport { FileIconMap, getFileTypeForRead } from '@ali/4ever-plugin-embed';\n\nconst Refer = (props) => {\n  const { attributes, onDingpanPreview, node } = props;\n  const { data } = node;\n  const { name, fileType, corpId, spaceId, fileId, fileSize } = data;\n  const text = node.nodes[0] as Text;\n  const leaf = text.leaves[0];\n  const marks = leaf ? leaf.marks : [];\n\n  let isClicked = false;\n\n  const onPreview = React.useCallback(() => {\n    if (onDingpanPreview) {\n      onDingpanPreview({\n        corpId,\n        spaceId,\n        fileId,\n        fileSize,\n        fileType,\n        fileName: name,\n        mode: 'normal',\n      });\n    }\n  }, []);\n\n  const handleTouchStart = React.useCallback((e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    isClicked = true;\n  }, []);\n\n  const handleTouchMove = React.useCallback((e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    isClicked = false;\n  }, []);\n\n  const handleTouchEnd = React.useCallback((e) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    if (isClicked) {\n      onPreview();\n    }\n  }, []);\n\n  const innerType = getFileTypeForRead(name);\n  const FileIcon = FileIconMap[innerType];\n\n  return (\n    <span {...attributes}>\n      <ReferTextWrapper\n        data-testid=\"refer\"\n        onClick={onPreview}\n        style={convertMarks(marks)}\n        onTouchStart={handleTouchStart}\n        onTouchMove={handleTouchMove}\n        onTouchEnd={handleTouchEnd}\n      >\n        {FileIcon && <FileIcon />}\n        <ReferText isMobile={environment.IS_MOBILE}>\n          {getFileName4Show(innerType, data.name)}\n        </ReferText>\n      </ReferTextWrapper>\n    </span>\n  );\n};\n\nexport default React.memo(Refer);\n"],"file":"Refer.js"}