{"version":3,"sources":["../../../src/zhi/index.tsx"],"names":["handleAction","action","controller","next","type","ACTION_CLOSE","handleCloseContextMenu","data","value","contextData","setData","zhiFactory","configs","pcContextMenu","handleContextMenu","event","preventDefault","x","clientX","y","clientY","selection","document","command","Commands","focus","isCollapsed","anchor","point","voidParent","getClosestVoid","key","query","Queries","pointAtDistance","newSelection","Selection","create","run","handleMouseDown","renderEditable","_","onAction","onContextMenu","onMouseDown"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Controller, Commands, Selection, Queries, CangjieSelectEvent, ZhiFactory } from '@ali/4ever-cangjie';\nimport { key } from '../utils/meta';\nimport ContextMenu from '../utils/PCContextMenu';\nimport { ACTION_CLOSE, openContextMenu } from '../utils/actions';\n\nfunction handleAction(action, controller: Controller, next) {\n  const { type } = action;\n  if (type === ACTION_CLOSE) {\n    handleCloseContextMenu(controller);\n  }\n  return next();\n}\n\nfunction handleCloseContextMenu(controller: Controller) {\n  const { data } = controller.value;\n  if (data.contextData) {\n    controller.setData({\n      ...data,\n      contextData: null,\n    });\n  }\n}\n\nexport const zhiFactory: ZhiFactory = (configs) => {\n  const pcContextMenu = configs?.pcContextMenu || {};\n  function handleContextMenu(\n    event: React.MouseEvent,\n    controller: Controller,\n    next,\n  ) {\n    event.preventDefault();\n    const contextData = {\n      x: event.clientX,\n      y: event.clientY,\n    };\n    const { data, selection, document } = controller.value;\n    controller.command(Commands.focus);\n    if (selection.isCollapsed) {\n      const { anchor: point } = selection;\n      const voidParent = document.getClosestVoid(point.key, controller);\n      if (voidParent) {\n        const anchor = controller.query(Queries.pointAtDistance, point, -1);\n        const focus = controller.query(Queries.pointAtDistance, point, 1);\n        const newSelection = Selection.create({ anchor, focus });\n        controller.run(\n          'onCangjieSelect',\n          CangjieSelectEvent({\n            selection: newSelection,\n          }),\n        );\n      }\n    }\n    controller.setData({\n      ...data,\n      contextData,\n    });\n    controller.run('onAction', openContextMenu());\n    return next();\n  }\n  function handleMouseDown(\n    event: React.MouseEvent,\n    controller: Controller,\n    next,\n  ) {\n    handleCloseContextMenu(controller);\n    return next();\n  }\n\n  function renderEditable(_, controller, next) {\n    return (\n      <React.Fragment>\n        {next()}\n        <ContextMenu {...pcContextMenu} />\n      </React.Fragment>\n    );\n  }\n  return {\n    key,\n    onAction: handleAction,\n    onContextMenu: handleContextMenu,\n    onMouseDown: handleMouseDown,\n    renderEditable,\n  };\n}\n"],"file":"index.js"}