{"version":3,"sources":["../../../../src/utils/utils/getClosestViewNode.ts"],"names":["getNextViewGroupNode","node","controller","document","value","level","data","list","parent","getParent","key","nextNode","getNextBlock","nextLevel","getPreviousViewGroupNode","previousNode","getPreviousBlock","previousViewNode","prevLevel","viewLevel","fold","userData","get"],"mappings":";;;;;;;;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASA,oBAAT,CAA8BC,IAA9B,EAA2CC,UAA3C,EAAmE;AACxE,QAAM;AAAEC,IAAAA;AAAF,MAAeD,UAAU,CAACE,KAAhC;AACA,QAAM;AAAEC,IAAAA;AAAF,MAAYJ,IAAI,CAACK,IAAL,CAAUC,IAA5B;AACA,QAAMC,MAAM,GAAGL,QAAQ,CAACM,SAAT,CAAmBR,IAAI,CAACS,GAAxB,CAAf;;AACA,MAAI,CAACF,MAAD,IAAW,CAAC,2BAAOP,IAAP,CAAhB,EAA8B;AAC5B,WAAO,IAAP;AACD;;AACD,MAAIU,QAAQ,GAAGH,MAAM,CAACI,YAAP,CAAoBX,IAAI,CAACS,GAAzB,CAAf;;AACA,SAAMC,QAAQ,IAAI,2BAAOA,QAAP,CAAlB,EAAoC;AAClC,UAAME,SAAS,GAAGF,QAAQ,CAACL,IAAT,CAAcC,IAAd,CAAmBF,KAArC;;AACA,QAAIQ,SAAS,IAAIR,KAAjB,EAAwB;AACtB,aAAOM,QAAP;AACD;;AACDA,IAAAA,QAAQ,GAAGH,MAAM,CAACI,YAAP,CAAoBD,QAAQ,CAACD,GAA7B,CAAX;AACD;;AACD,SAAOC,QAAP;AACD;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASG,wBAAT,CAAkCb,IAAlC,EAA+CC,UAA/C,EAAuE;AAC5E,QAAM;AAAEC,IAAAA;AAAF,MAAeD,UAAU,CAACE,KAAhC;AACA,QAAMI,MAAM,GAAGL,QAAQ,CAACM,SAAT,CAAmBR,IAAI,CAACS,GAAxB,CAAf;;AACA,MAAI,CAACF,MAAL,EAAa;AACX,WAAO,IAAP;AACD;;AACD,MAAIO,YAAY,GAAGP,MAAM,CAACQ,gBAAP,CAAwBf,IAAI,CAACS,GAA7B,CAAnB;AACA,MAAIO,gBAAgB,GAAGF,YAAvB;;AACA,SAAMA,YAAY,IAAI,2BAAOA,YAAP,CAAtB,EAA4C;AAC1C,UAAMG,SAAS,GAAGH,YAAY,CAACT,IAAb,CAAkBC,IAAlB,CAAuBF,KAAzC;;AACA,QAAIa,SAAS,IAAI,CAAjB,EAAoB;AAClB,aAAOD,gBAAP;AACD;;AACDF,IAAAA,YAAY,GAAGP,MAAM,CAACQ,gBAAP,CAAwBD,YAAY,CAACL,GAArC,CAAf;;AACA,QAAIK,YAAY,IAAI,oCAAgBA,YAAhB,EAA8Bb,UAA9B,CAApB,EAA+D;AAC7D,YAAMiB,SAAS,GAAGF,gBAAgB,EAAEX,IAAlB,CAAuBC,IAAvB,EAA6BF,KAA/C;AACA,YAAMa,SAAS,GAAGH,YAAY,EAAET,IAAd,CAAmBC,IAAnB,EAAyBF,KAA3C;AACA,YAAMe,IAAI,GAAGlB,UAAU,CAACmB,QAAX,CAAoBC,GAApB,CAAwBP,YAAxB,EAAsC,MAAtC,CAAb;;AACA,UAAIK,IAAI,IAAID,SAAS,GAAGD,SAAxB,EAAmC;AACjCD,QAAAA,gBAAgB,GAAGF,YAAnB;AACD;AACF;AACF;;AACD,MAAI,CAACA,YAAD,IAAiB,CAAC,2BAAOE,gBAAP,CAAtB,EAAiD;AAC/C,WAAO,IAAP;AACD;;AACD,SAAOA,gBAAP;AACD","sourcesContent":["import { Block, Controller } from \"@ali/4ever-cangjie\";\nimport { isList, isFoldGroupNode } from './isInListGroup';\n/**\n * 获取下一个可视节点\n *\n * 场景一：折叠列表 aaa 对应的 nextViewGroupNode 就是 列表 ddd\n *  >1. aaa\n *   2. ddd\n *\n * 场景二：列表 aaa 对应的 nextViewGroupNode 就是 段落 ddd\n *   1. aaa\n *   |  a. bbb\n *   |  b. ccc\n *   ddd\n */\nexport function getNextViewGroupNode(node: Block, controller: Controller) {\n  const { document } = controller.value;\n  const { level } = node.data.list;\n  const parent = document.getParent(node.key);\n  if (!parent || !isList(node)) {\n    return null;\n  }\n  let nextNode = parent.getNextBlock(node.key);\n  while(nextNode && isList(nextNode)) {\n    const nextLevel = nextNode.data.list.level;\n    if (nextLevel <= level) {\n      return nextNode;\n    }\n    nextNode = parent.getNextBlock(nextNode.key);\n  }\n  return nextNode;\n}\n/**\n * 获取上一个可视节点\n *\n * 场景一：列表 ddd 对应的 previousViewGroupNode 就是 列表 ccc\n *   1. aaa\n *   |  a. bbb\n *   |    i. ccc\n *   2. ddd\n *\n * 场景二：段落 ddd 对应的 previousViewGroupNode 就是 列表 bbb\n *   1. aaa\n *   | >a. bbb\n *   ddd\n *\n * 场景三：段落 ddd 对应的 previousViewGroupNode 就是 列表 aaa\n *  >1. aaa\n *   ddd\n */\nexport function getPreviousViewGroupNode(node: Block, controller: Controller) {\n  const { document } = controller.value;\n  const parent = document.getParent(node.key);\n  if (!parent) {\n    return null;\n  }\n  let previousNode = parent.getPreviousBlock(node.key);\n  let previousViewNode = previousNode;\n  while(previousNode && isList(previousNode)) {\n    const prevLevel = previousNode.data.list.level;\n    if (prevLevel <= 0) {\n      return previousViewNode;\n    }\n    previousNode = parent.getPreviousBlock(previousNode.key);\n    if (previousNode && isFoldGroupNode(previousNode, controller)) {\n      const viewLevel = previousViewNode?.data.list?.level;\n      const prevLevel = previousNode?.data.list?.level;\n      const fold = controller.userData.get(previousNode, 'fold');\n      if (fold && viewLevel > prevLevel) {\n        previousViewNode = previousNode;\n      }\n    }\n  }\n  if (!previousNode || !isList(previousViewNode!)) {\n    return null;\n  }\n  return previousViewNode;\n}\n"],"file":"getClosestViewNode.js"}