"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createGroupNodes;

var _conditions = require("../conditions");

var _everUtils = require("@ali/4ever-utils");

var _utils = require("../utils");

function defaultIgnore() {
  return false;
}

function createGroupNodes(config) {
  const {
    ignore = defaultIgnore
  } = config;
  return function groupNodes(range, ctx, controller, next) {
    const [start] = range;
    const {
      parent,
      groups
    } = ctx;
    const first = parent.nodes[start];
    const second = parent.nodes[start + 1];
    const parentGroup = groups[groups.length - 1]; // 如果是文档末尾，则不分组

    if (ignore() || !second) {
      return next();
    }

    const inSameGrounp = (0, _utils.isSameGroupFrom)(parentGroup, first); // 查找可用的 group 条件

    const $condition = inSameGrounp && _conditions.listGroupConditions.find(({
      when
    }) => {
      return when(first, second);
    }); // group 节点


    if ($condition) {
      const {
        until
      } = $condition;
      return (0, _everUtils.groupHeading)(range, parent, 'list', until);
    }

    return next();
  };
}
//# sourceMappingURL=createGroupNodes.js.map