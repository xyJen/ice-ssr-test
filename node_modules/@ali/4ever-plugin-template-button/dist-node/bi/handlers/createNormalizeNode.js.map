{"version":3,"sources":["../../../../src/bi/handlers/createNormalizeNode.tsx"],"names":["createNormalizeNode","node","controller","next","TemplateButton","isTemplateButton","nodes","length","Block","isBlock","command","Commands","wrapBlockByKey","key","insertBlock","create","type","Text"],"mappings":";;;;;;;AAAA;;AACA;;AAEO,MAAMA,mBAAmB,GAAG,MAAiC;AAClE,SAAO,CAACC,IAAD,EAAOC,UAAP,EAAmBC,IAAnB,KAA4B;AACjC,QAAIC,mBAAeC,gBAAf,CAAgCJ,IAAhC,CAAJ,EAA2C;AACzC;AACA,UAAIA,IAAI,CAACK,KAAL,CAAWC,MAAX,KAAsB,CAAtB,IAA2B,CAACC,mBAAMC,OAAN,CAAcR,IAAI,CAACK,KAAL,CAAW,CAAX,CAAd,CAAhC,EAA8D;AAC5D,eAAO,MACLJ,UAAU,CAACQ,OAAX,CACEC,sBAASC,cADX,EAEEX,IAAI,CAACK,KAAL,CAAW,CAAX,EAAcO,GAFhB,EAGE,WAHF,CADF;AAMD,OAPD,MAOO,IAAIZ,IAAI,CAACK,KAAL,CAAWC,MAAX,KAAsB,CAA1B,EAA6B;AAClC,eAAO,MAAM;AACXL,UAAAA,UAAU,CAACQ,OAAX,CACEC,sBAASG,WADX,EAEEN,mBAAMO,MAAN,CAAa;AACXC,YAAAA,IAAI,EAAE,WADK;AAEXV,YAAAA,KAAK,EAAE,CAACW,kBAAKF,MAAL,CAAY,EAAZ,CAAD;AAFI,WAAb,CAFF;AAOD,SARD;AASD;AACF;;AACD,WAAOZ,IAAI,EAAX;AACD,GAvBD;AAwBD,CAzBM","sourcesContent":["import { BiPlugin, Block, Commands, Text } from \"@ali/4ever-cangjie\";\nimport { TemplateButton } from \"../../mo\";\n\nexport const createNormalizeNode = (): BiPlugin[\"normalizeNode\"] => {\n  return (node, controller, next) => {\n    if (TemplateButton.isTemplateButton(node)) {\n      // 确保模板按钮的直接子 Node 都是 Block\n      if (node.nodes.length === 1 && !Block.isBlock(node.nodes[0])) {\n        return () =>\n          controller.command(\n            Commands.wrapBlockByKey,\n            node.nodes[0].key,\n            \"paragraph\",\n          );\n      } else if (node.nodes.length === 0) {\n        return () => {\n          controller.command(\n            Commands.insertBlock,\n            Block.create({\n              type: \"paragraph\",\n              nodes: [Text.create(\"\")],\n            }),\n          );\n        };\n      }\n    }\n    return next();\n  };\n};\n"],"file":"createNormalizeNode.js"}