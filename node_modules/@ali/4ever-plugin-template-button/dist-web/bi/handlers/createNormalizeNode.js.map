{"version":3,"sources":["../../../../src/bi/handlers/createNormalizeNode.tsx"],"names":["Block","Commands","Text","TemplateButton","createNormalizeNode","node","controller","next","isTemplateButton","nodes","length","isBlock","command","wrapBlockByKey","key","insertBlock","create","type"],"mappings":"AAAA,SAAmBA,KAAnB,EAA0BC,QAA1B,EAAoCC,IAApC,QAAgD,oBAAhD;AACA,SAASC,cAAT;AAEA,OAAO,IAAMC,mBAAmB,GAAG,SAAtBA,mBAAsB,GAAiC;AAClE,SAAO,UAACC,IAAD,EAAOC,UAAP,EAAmBC,IAAnB,EAA4B;AACjC,QAAIJ,cAAc,CAACK,gBAAf,CAAgCH,IAAhC,CAAJ,EAA2C;AACzC;AACA,UAAIA,IAAI,CAACI,KAAL,CAAWC,MAAX,KAAsB,CAAtB,IAA2B,CAACV,KAAK,CAACW,OAAN,CAAcN,IAAI,CAACI,KAAL,CAAW,CAAX,CAAd,CAAhC,EAA8D;AAC5D,eAAO;AAAA,iBACLH,UAAU,CAACM,OAAX,CACEX,QAAQ,CAACY,cADX,EAEER,IAAI,CAACI,KAAL,CAAW,CAAX,EAAcK,GAFhB,EAGE,WAHF,CADK;AAAA,SAAP;AAMD,OAPD,MAOO,IAAIT,IAAI,CAACI,KAAL,CAAWC,MAAX,KAAsB,CAA1B,EAA6B;AAClC,eAAO,YAAM;AACXJ,UAAAA,UAAU,CAACM,OAAX,CACEX,QAAQ,CAACc,WADX,EAEEf,KAAK,CAACgB,MAAN,CAAa;AACXC,YAAAA,IAAI,EAAE,WADK;AAEXR,YAAAA,KAAK,EAAE,CAACP,IAAI,CAACc,MAAL,CAAY,EAAZ,CAAD;AAFI,WAAb,CAFF;AAOD,SARD;AASD;AACF;;AACD,WAAOT,IAAI,EAAX;AACD,GAvBD;AAwBD,CAzBM","sourcesContent":["import { BiPlugin, Block, Commands, Text } from \"@ali/4ever-cangjie\";\nimport { TemplateButton } from \"../../mo\";\n\nexport const createNormalizeNode = (): BiPlugin[\"normalizeNode\"] => {\n  return (node, controller, next) => {\n    if (TemplateButton.isTemplateButton(node)) {\n      // 确保模板按钮的直接子 Node 都是 Block\n      if (node.nodes.length === 1 && !Block.isBlock(node.nodes[0])) {\n        return () =>\n          controller.command(\n            Commands.wrapBlockByKey,\n            node.nodes[0].key,\n            \"paragraph\",\n          );\n      } else if (node.nodes.length === 0) {\n        return () => {\n          controller.command(\n            Commands.insertBlock,\n            Block.create({\n              type: \"paragraph\",\n              nodes: [Text.create(\"\")],\n            }),\n          );\n        };\n      }\n    }\n    return next();\n  };\n};\n"],"file":"createNormalizeNode.js"}