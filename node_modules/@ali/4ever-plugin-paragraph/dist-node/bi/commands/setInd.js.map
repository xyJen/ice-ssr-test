{"version":3,"sources":["../../../../src/bi/commands/setInd.ts"],"names":["setParagraphInd","controller","data","selectedBlocks","length","forEach","node","ind","firstLine","firstLineChars","hanging","hangingChars","leftChars","rightChars","DEFAULT_INDENT_FULL","type","command","Commands","setNodeByKey","key"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AAEe,SAASA,eAAT,CAAyBC,UAAzB,EAAiDC,IAAsB,GAAG,EAA1E,EAA8E;AAC3F,QAAMC,cAAc,GAAG,oCAAoBF,UAApB,CAAvB;AACA,MAAI,CAACE,cAAc,CAACC,MAApB,EAA4B,OAAOH,UAAP;AAE5BE,EAAAA,cAAc,CAACE,OAAf,CAAwBC,IAAD,IAAU;AAC/B,UAAMC,GAAG,GAAG,EACV,GAAGD,IAAI,CAACJ,IAAL,CAAUK;AADH,KAAZ,CAD+B,CAK/B;;AACA,QAAI,aAAaL,IAAb,IAAqB,kBAAkBA,IAA3C,EAAiD;AAC/C;AACA,aAAOK,GAAG,CAACC,SAAX;AACA,aAAOD,GAAG,CAACE,cAAX;AACD,KAJD,MAIO,IAAI,eAAeP,IAAf,IAAuB,oBAAoBA,IAA/C,EAAqD;AAC1D,aAAOK,GAAG,CAACG,OAAX;AACA,aAAOH,GAAG,CAACI,YAAX;AACD;;AAED,QAAI,UAAUT,IAAV,IAAkB,EAAE,eAAeA,IAAjB,CAAtB,EAA8C;AAC5C;AACA,aAAOK,GAAG,CAACK,SAAX;AACD;;AACD,QAAI,WAAWV,IAAX,IAAmB,EAAE,gBAAgBA,IAAlB,CAAvB,EAAgD;AAC9C,aAAOK,GAAG,CAACM,UAAX;AACD;;AACD,QAAI,eAAeX,IAAf,IAAuB,EAAE,oBAAoBA,IAAtB,CAA3B,EAAwD;AACtD,aAAOK,GAAG,CAACE,cAAX;AACD;;AACD,QAAI,aAAaP,IAAb,IAAqB,EAAE,kBAAkBA,IAApB,CAAzB,EAAoD;AAClD,aAAOK,GAAG,CAACI,YAAX;AACD;;AAED,QAAI,mCAAmB,EAAE,GAAGJ,GAAL;AAAU,SAAGL;AAAb,KAAnB,EAAwCI,IAAI,CAACJ,IAAL,CAAUK,GAAlD,EAAuDO,0BAAvD,CAAJ,EAAiF;AAC/E;AACD;;AAED,QAAI,gCAAoBR,IAAI,CAACS,IAAzB,CAAJ,EAAoC;AAClCd,MAAAA,UAAU,CAACe,OAAX,CAAmBC,sBAASC,YAA5B,EAA0CZ,IAAI,CAACa,GAA/C,EAAoD;AAClDjB,QAAAA,IAAI,EAAE,EACJ,GAAGI,IAAI,CAACJ,IADJ;AAEJK,UAAAA,GAAG,EAAE,EACH,GAAGA,GADA;AAEH,eAAGL;AAFA;AAFD;AAD4C,OAApD;AASD;AACF,GA5CD;AA6CA,SAAOD,UAAP;AACD","sourcesContent":["import { Controller, Commands } from '@ali/4ever-cangjie';\nimport { isEqualWithDefault, getBlocksFromEditor, IndentProperties } from '@ali/4ever-utils';\nimport { canSetParagraphAttr, DEFAULT_INDENT_FULL } from '../../utils';\n\nexport default function setParagraphInd(controller: Controller, data: IndentProperties = {}) {\n  const selectedBlocks = getBlocksFromEditor(controller);\n  if (!selectedBlocks.length) return controller;\n\n  selectedBlocks.forEach((node) => {\n    const ind = {\n      ...node.data.ind,\n    };\n\n    // 处理互斥关系\n    if ('hanging' in data || 'hangingChars' in data) {\n      // 首行与悬挂互斥\n      delete ind.firstLine;\n      delete ind.firstLineChars;\n    } else if ('firstLine' in data || 'firstLineChars' in data) {\n      delete ind.hanging;\n      delete ind.hangingChars;\n    }\n\n    if ('left' in data && !('leftChars' in data)) {\n      // 设置 left 时清除 leftChars（带单位优先级更高）\n      delete ind.leftChars;\n    }\n    if ('right' in data && !('rightChars' in data)) {\n      delete ind.rightChars;\n    }\n    if ('firstLine' in data && !('firstLineChars' in data)) {\n      delete ind.firstLineChars;\n    }\n    if ('hanging' in data && !('hangingChars' in data)) {\n      delete ind.hangingChars;\n    }\n\n    if (isEqualWithDefault({ ...ind, ...data }, node.data.ind, DEFAULT_INDENT_FULL)) {\n      return;\n    }\n\n    if (canSetParagraphAttr(node.type)) {\n      controller.command(Commands.setNodeByKey, node.key, {\n        data: {\n          ...node.data,\n          ind: {\n            ...ind,\n            ...data,\n          },\n        },\n      });\n    }\n  });\n  return controller;\n}\n"],"file":"setInd.js"}