"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = setParagraphInd;

var _everCangjie = require("@ali/4ever-cangjie");

var _everUtils = require("@ali/4ever-utils");

var _utils = require("../../utils");

function setParagraphInd(controller, data = {}) {
  const selectedBlocks = (0, _everUtils.getBlocksFromEditor)(controller);
  if (!selectedBlocks.length) return controller;
  selectedBlocks.forEach(node => {
    const ind = { ...node.data.ind
    }; // 处理互斥关系

    if ('hanging' in data || 'hangingChars' in data) {
      // 首行与悬挂互斥
      delete ind.firstLine;
      delete ind.firstLineChars;
    } else if ('firstLine' in data || 'firstLineChars' in data) {
      delete ind.hanging;
      delete ind.hangingChars;
    }

    if ('left' in data && !('leftChars' in data)) {
      // 设置 left 时清除 leftChars（带单位优先级更高）
      delete ind.leftChars;
    }

    if ('right' in data && !('rightChars' in data)) {
      delete ind.rightChars;
    }

    if ('firstLine' in data && !('firstLineChars' in data)) {
      delete ind.firstLineChars;
    }

    if ('hanging' in data && !('hangingChars' in data)) {
      delete ind.hangingChars;
    }

    if ((0, _everUtils.isEqualWithDefault)({ ...ind,
      ...data
    }, node.data.ind, _utils.DEFAULT_INDENT_FULL)) {
      return;
    }

    if ((0, _utils.canSetParagraphAttr)(node.type)) {
      controller.command(_everCangjie.Commands.setNodeByKey, node.key, {
        data: { ...node.data,
          ind: { ...ind,
            ...data
          }
        }
      });
    }
  });
  return controller;
}
//# sourceMappingURL=setInd.js.map