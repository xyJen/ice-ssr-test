"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _everUtils = require("@ali/4ever-utils");

var _models = _interopRequireDefault(require("../models"));

var _default = {
  name: _models.default.TYPE,
  match: (node, parent) => {
    const tag = (0, _everUtils.getTagName)(node);

    if (tag === 'p') {
      return true;
    } else if (parent) {
      const parentTagName = (0, _everUtils.getTagName)(parent);

      if (parentTagName === 'tc' || parentTagName === 'root') {
        console.warn(`${tag} under ${parentTagName} is not supported, forcely revert to paragraph`);
        return true;
      }
    }

    return false;
  },
  convert: node => {
    const data = (0, _everUtils.getAttributes)(node) || {};

    if (data.ind && typeof data.ind.firstline === 'number') {
      data.ind.firstLine = data.ind.firstline;
      delete data.ind.firstline;
    } // 序列化时对不合法 level 进行矫正


    if (data.list) {
      const hasInvalidLevel = list => {
        const {
          level
        } = list;
        return !/\d/g.test(String(level)) || level < 0;
      };

      if (hasInvalidLevel(data.list)) {
        data.list.level = 0;
      }
    }

    return _models.default.create({
      data
    });
  }
};
exports.default = _default;
//# sourceMappingURL=jsonMLToValue.js.map