import { getUserData } from '@ali/4ever-cangjie';
import { isSubject } from '@ali/4ever-plugin-subject';
import { isHeadingGroup } from "./utils";
/**
 * 节点是否在折叠的 Group 之内
 * @param document
 * @param node
 * @returns
 */

export function isFoldInGroup(document, node, controller) {
  var path = document.getPath(node.key); // path 不存在则返回 false

  if (!path || path.length === 0) {
    return false;
  } // 查询节点的父节点是否是折叠态


  for (var i = 1; i < path.length; i++) {
    var subPath = path.slice(0, i);
    var block = document.getNodeByPath(subPath);

    if (isSubject(block) || isHeadingGroup(block)) {
      var fold = getUserData(document, block, controller == null ? void 0 : controller.uid, 'fold');

      if (fold) {
        return true;
      }

      continue;
    } else {
      // 短路优化：若不为 group 节点则返回 false
      return false;
    }
  }

  return false;
}
/**
 * 节点是否在未折叠的 Group 内
 * @param document
 * @param node
 * @returns
 * @description 通常此方法需要与 `isFoldInGroup` 配合使用
 */

export function isUnfoldInGroup(document, node, controller) {
  var path = document.getPath(node.key); // path 不存在则返回 false

  if (!path || path.length === 0) {
    return false;
  }

  for (var i = 1; i < path.length; i++) {
    var subPath = path.slice(0, i);
    var block = document.getNodeByPath(subPath);

    if (isSubject(block) || isHeadingGroup(block)) {
      var fold = getUserData(document, block, controller == null ? void 0 : controller.uid, 'fold');

      if (fold) {
        return false;
      }

      continue;
    } else {
      // 短路优化：如果 group 组中途断掉，则返回 true
      return true;
    }
  }

  return true;
}
//# sourceMappingURL=helpers.js.map