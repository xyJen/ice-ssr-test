{"version":3,"sources":["../../../../src/utils/components/content.tsx"],"names":["React","styled","classnames","ContentBox","div","PocketBox","Content","props","fold","animate","style","className","dataName","children","foldRef","useRef","contentRef","pocketRef","useState","internalFold","setInternalFold","transition","setTransition","setAnimationHeight","useCallback","current","maxHeight","offsetHeight","useLayoutEffect","Promise","resolve","then","handleTransitionEnd","classNames","displayName"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport styled from 'styled-components';\nimport classnames from 'classnames';\n\nconst ContentBox = styled.div`\n  &.transition {\n    max-height: fit-content;\n    transition: all 0.2s ease-in-out;\n    overflow: hidden;\n\n    &.fold {\n      display: block;\n    }\n  }\n\n  &.fold {\n    max-height: 0;\n    overflow: hidden;\n    display: none;\n  }\n`;\n\nconst PocketBox = styled.div`\n  /* https://aone.alibaba-inc.com/v2/bug/36003865# 《标题收起展开会出现跳动》 */\n  :first-child > [data-cangjie-leaf-block] > * {\n    margin-top: 0 !important;\n  }\n  &\n    > :first-child\n    > [data-name='heading-group-title']\n    > [data-name='heading-group-title-content']\n    > [data-cangjie-leaf-block]\n    > * {\n    margin-top: 0 !important;\n  }\n`;\n\nexport interface ContentProps {\n  /**\n   * 折叠状态\n   */\n  fold: boolean;\n  /**\n   * 是否执行动画\n   */\n  animate?: boolean;\n  style?: React.CSSProperties;\n  className?: string;\n  dataName?: string;\n}\n\nconst Content: React.FC<ContentProps> = (props) => {\n  const { fold, animate, style, className, dataName, children } = props;\n\n  const foldRef = React.useRef(fold);\n  const contentRef = React.useRef<HTMLDivElement>(null);\n  const pocketRef = React.useRef<HTMLDivElement>(null);\n  const [internalFold, setInternalFold] = React.useState(fold);\n  const [transition, setTransition] = React.useState(false);\n\n  const setAnimationHeight = React.useCallback((fold: boolean) => {\n    if (pocketRef.current && contentRef.current) {\n      contentRef.current.style.maxHeight = fold\n        ? '0'\n        : `${pocketRef.current.offsetHeight}px`;\n    }\n  }, []);\n\n  /**\n   * Step1: 折叠状态发生变化，准备添加动画，并设置动画初始状态，在 task 末尾设置动画目标状态\n   */\n  React.useLayoutEffect(() => {\n    if (fold !== foldRef.current) {\n      if (animate) {\n        setTransition(true);\n        // 设置初始状态\n        setAnimationHeight(foldRef.current);\n        Promise.resolve().then(() => {\n          // 设置目标状态\n          setAnimationHeight(fold);\n        });\n      } else {\n        setTransition(false);\n        setInternalFold(fold);\n      }\n      foldRef.current = fold;\n    }\n  }, [animate, fold]);\n\n  /**\n   * Step2: 动画结束后移除动画类，更新折叠状态并设置高度自适应\n   */\n  const handleTransitionEnd = React.useCallback(() => {\n    setTransition(false);\n    setInternalFold(foldRef.current);\n    if (contentRef.current) {\n      // 动画结束重置 css 状态，自动撑起高度\n      contentRef.current.style.maxHeight = 'fit-content';\n    }\n  }, []);\n\n  const classNames = classnames({\n    transition,\n    fold: internalFold,\n  });\n\n  return (\n    <ContentBox\n      ref={contentRef}\n      className={classNames}\n      style={style}\n      onTransitionEnd={handleTransitionEnd}\n    >\n      <PocketBox\n        ref={pocketRef}\n        data-name={dataName}\n        data-heading-fold={fold}\n        className={className}\n      >\n        {children}\n      </PocketBox>\n    </ContentBox>\n  );\n};\n\nContent.displayName = 'Content';\n\nexport default Content;\n"],"file":"content.js"}