{"version":3,"sources":["../../../../src/utils/components/content.tsx"],"names":["ContentBox","styled","div","PocketBox","Content","props","fold","animate","style","className","dataName","children","foldRef","React","useRef","contentRef","pocketRef","internalFold","setInternalFold","useState","transition","setTransition","setAnimationHeight","useCallback","current","maxHeight","offsetHeight","useLayoutEffect","Promise","resolve","then","handleTransitionEnd","classNames","displayName"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport styled from 'styled-components';\nimport classnames from 'classnames';\n\nconst ContentBox = styled.div`\n  &.transition {\n    max-height: fit-content;\n    transition: all 0.2s ease-in-out;\n    overflow: hidden;\n\n    &.fold {\n      display: block;\n    }\n  }\n\n  &.fold {\n    max-height: 0;\n    overflow: hidden;\n    display: none;\n  }\n`;\n\nconst PocketBox = styled.div`\n  /* https://aone.alibaba-inc.com/v2/bug/36003865# 《标题收起展开会出现跳动》 */\n  :first-child > [data-cangjie-leaf-block] > * {\n    margin-top: 0 !important;\n  }\n  &\n    > :first-child\n    > [data-name='heading-group-title']\n    > [data-name='heading-group-title-content']\n    > [data-cangjie-leaf-block]\n    > * {\n    margin-top: 0 !important;\n  }\n`;\n\nexport interface ContentProps {\n  /**\n   * 折叠状态\n   */\n  fold: boolean;\n  /**\n   * 是否执行动画\n   */\n  animate?: boolean;\n  style?: React.CSSProperties;\n  className?: string;\n  dataName?: string;\n}\n\nconst Content: React.FC<ContentProps> = (props) => {\n  const { fold, animate, style, className, dataName, children } = props;\n\n  const foldRef = React.useRef(fold);\n  const contentRef = React.useRef<HTMLDivElement>(null);\n  const pocketRef = React.useRef<HTMLDivElement>(null);\n  const [internalFold, setInternalFold] = React.useState(fold);\n  const [transition, setTransition] = React.useState(false);\n\n  const setAnimationHeight = React.useCallback((fold: boolean) => {\n    if (pocketRef.current && contentRef.current) {\n      contentRef.current.style.maxHeight = fold\n        ? '0'\n        : `${pocketRef.current.offsetHeight}px`;\n    }\n  }, []);\n\n  /**\n   * Step1: 折叠状态发生变化，准备添加动画，并设置动画初始状态，在 task 末尾设置动画目标状态\n   */\n  React.useLayoutEffect(() => {\n    if (fold !== foldRef.current) {\n      if (animate) {\n        setTransition(true);\n        // 设置初始状态\n        setAnimationHeight(foldRef.current);\n        Promise.resolve().then(() => {\n          // 设置目标状态\n          setAnimationHeight(fold);\n        });\n      } else {\n        setTransition(false);\n        setInternalFold(fold);\n      }\n      foldRef.current = fold;\n    }\n  }, [animate, fold]);\n\n  /**\n   * Step2: 动画结束后移除动画类，更新折叠状态并设置高度自适应\n   */\n  const handleTransitionEnd = React.useCallback(() => {\n    setTransition(false);\n    setInternalFold(foldRef.current);\n    if (contentRef.current) {\n      // 动画结束重置 css 状态，自动撑起高度\n      contentRef.current.style.maxHeight = 'fit-content';\n    }\n  }, []);\n\n  const classNames = classnames({\n    transition,\n    fold: internalFold,\n  });\n\n  return (\n    <ContentBox\n      ref={contentRef}\n      className={classNames}\n      style={style}\n      onTransitionEnd={handleTransitionEnd}\n    >\n      <PocketBox\n        ref={pocketRef}\n        data-name={dataName}\n        data-heading-fold={fold}\n        className={className}\n      >\n        {children}\n      </PocketBox>\n    </ContentBox>\n  );\n};\n\nContent.displayName = 'Content';\n\nexport default Content;\n"],"file":"content.js"}