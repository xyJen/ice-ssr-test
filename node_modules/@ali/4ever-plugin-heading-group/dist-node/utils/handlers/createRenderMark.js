"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _actions = require("../actions");

var _queries = require("../queries");

var _utils = require("../utils");

function createRenderMark(options) {
  const {
    autoUnfold = false,
    inject = false
  } = options;
  return function renderMark(props, controller, next) {
    const {
      mark,
      node
    } = props;
    const {
      document,
      injections
    } = controller.value;

    if (autoUnfold && mark.type === 'match' && mark.data.selected) {
      const block = document.getFurthsestBlock(node.key);
      let groups = block ? controller.query(_queries.getHeadingAncestors, block) : []; // 注入 Injection 数据

      if (inject) {
        groups = (0, _utils.injectToNodes)(injections, groups);
      }

      const parents = groups.filter(group => controller.userData.get(group, 'fold'));
      parents.forEach(parent => controller.run('onAction', (0, _actions.toggleFold)({
        node: parent,
        fold: false
      })));
    }

    return next();
  };
}

var _default = createRenderMark;
exports.default = _default;
//# sourceMappingURL=createRenderMark.js.map