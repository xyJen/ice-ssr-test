{"version":3,"sources":["../../src/createCustomizedBiPlugins.ts"],"names":["createCustomizedBiPlugins","plugins","paragraphPlugin","paragraph","unknownCard","createUnknownCardPlugin","unknownTag","createUnknownTagPlugin","rest","allPlugins","exception","snippets","container","autoClose","clipboard","history","quickInsert","basic","createBiPlugins","configs","array","hash","forEach","key","factory","plugin","push","schema","lang"],"mappings":";;;;;;;;;AAIA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAfA;AACA;AACA;AACA;;AAqBA;AACA;AACA;AACA;AACe,SAASA,yBAAT,CACbC,OADa,EAEb;AACA,QAAMC,eAAe,GAAGD,OAAO,CAACE,SAAR,IAAqBA,8BAA7C;AACA,QAAM;AAAEC,IAAAA,WAAW,GAAGC,oCAAhB;AAAyCC,IAAAA,UAAU,GAAGC,mCAAtD;AAA8E,OAAGC;AAAjF,MAA0FP,OAAhG;AAEA,QAAMQ,UAAU,GAAG;AACjBC,IAAAA,SAAS,EAATA,8BADiB;AAEjB;AACAC,IAAAA,QAAQ,EAARA,6BAHiB;AAIjB,OAAGH,IAJc;AAKjB;AACAI,IAAAA,SAAS,EAATA,8BANiB;AAOjBR,IAAAA,WAPiB;AAQjBE,IAAAA,UARiB;AASjBO,IAAAA,SAAS,EAATA,kBATiB;AAUjBC,IAAAA,SAAS,EAATA,kBAViB;AAUN;AACXC,IAAAA,OAAO,EAAPA,gBAXiB;AAYjBZ,IAAAA,SAAS,EAAED,eAZM;AAajBc,IAAAA,WAAW,EAAXA,oBAbiB;AAcjBC,IAAAA,KAAK,EAALA,0BAdiB,CAcV;;AAdU,GAAnB;AAiBA,SAAO,SAASC,eAAT,CAAyBC,OAAuB,GAAG,EAAnD,EAAkE;AACvE,UAAMC,KAAe,GAAG,EAAxB;AACA,UAAMC,IAAI,GAAG,EAAb,CAFuE,CAGvE;;AACA,gCAAYZ,UAAZ,EAAwBa,OAAxB,CAAgC,CAAC;AAAEC,MAAAA,GAAF;AAAOC,MAAAA;AAAP,KAAD,KAAsB;AACpD,YAAMC,MAAM,GAAGD,OAAO,CAACL,OAAD,EAAUE,IAAV,CAAtB,CADoD,CAEpD;AACA;AACA;AACA;AACA;AACA;;AACAD,MAAAA,KAAK,CAACM,IAAN,CAAWD,MAAX;AACAJ,MAAAA,IAAI,CAACE,GAAD,CAAJ,GAAYE,MAAZ;AACD,KAVD;AAWA,UAAME,MAAM,GAAG,+BAAaP,KAAb,CAAf;AACAA,IAAAA,KAAK,CAACM,IAAN,CAAW;AAAEC,MAAAA;AAAF,KAAX;AACA,WAAO;AACLP,MAAAA,KADK;AAELC,MAAAA,IAFK;AAGLO,MAAAA,IAAI,EAAET,OAAO,CAACS,IAAR,IAAgB;AAHjB,KAAP;AAKD,GAtBD;AAuBD","sourcesContent":["/**\n * @packageDocumentation\n * @module Editor(Bi)\n */\nimport { createSchema, Plugin } from '@ali/4ever-cangjie';\nimport { biFactory as exception } from '@ali/4ever-plugin-exception';\nimport { sortPlugins } from '@ali/4ever-utils';\nimport autoClose from './plugins/autoClose';\nimport { createUnknownCardPlugin, createUnknownTagPlugin } from '@ali/4ever-factory';\nimport { biFactory as basic } from '@ali/4ever-plugin-basic';\nimport clipboard from './plugins/clipboard';\nimport history from './plugins/history';\nimport { biFactory as paragraph} from '@ali/4ever-plugin-paragraph';\nimport { biFactory as container } from '@ali/4ever-plugin-container';\nimport { biFactory as snippets } from '@ali/4ever-plugin-snippets';\nimport quickInsert from './plugins/quickInsert';\nimport { BiPluginConfig, PluginFactory } from './types';\n\nexport interface BiPlugins {\n  array: Plugin[];\n  hash: Record<string, Plugin>;\n  lang?: string | Record<string, any>;\n}\n\n/**\n * 创建自定义插件。传入自定义的插件 Map，返回一个插件创建函数（createBiPlugins）。\n * 传入内容格式：{ PluginName: PluginFactory }\n */\nexport default function createCustomizedBiPlugins(\n  plugins: Record<string, PluginFactory>,\n) {\n  const paragraphPlugin = plugins.paragraph || paragraph;\n  const { unknownCard = createUnknownCardPlugin, unknownTag = createUnknownTagPlugin, ...rest } = plugins;\n\n  const allPlugins = {\n    exception,\n    // 必须在 callout、code 等配置了 snippet 的插件之前\n    snippets,\n    ...rest,\n    // unknown 卡片/标签必须放在最后做兜底显示\n    container,\n    unknownCard,\n    unknownTag,\n    autoClose,\n    clipboard, // 默认需要 clipboard 插件\n    history,\n    paragraph: paragraphPlugin,\n    quickInsert,\n    basic, // 必须放在最后，以便其他插件覆盖行为\n  };\n\n  return function createBiPlugins(configs: BiPluginConfig = {}): BiPlugins {\n    const array: Plugin[] = [];\n    const hash = {};\n    // @ts-ignore\n    sortPlugins(allPlugins).forEach(({ key, factory }) => {\n      const plugin = factory(configs, hash);\n      // TODO 在 provider 中遍历通过 models 识别节点，unknown 节点报 warning\n      // warning(\n      //   checkModels(plugin),\n      //\n      //   'You should configure models field when register a plugin',\n      // );\n      array.push(plugin);\n      hash[key] = plugin;\n    });\n    const schema = createSchema(array as any);\n    array.push({ schema });\n    return {\n      array,\n      hash,\n      lang: configs.lang || 'zh-CN',\n    };\n  };\n}\n"],"file":"createCustomizedBiPlugins.js"}