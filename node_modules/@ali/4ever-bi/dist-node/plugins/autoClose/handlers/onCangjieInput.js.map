{"version":3,"sources":["../../../../../src/plugins/autoClose/handlers/onCangjieInput.ts"],"names":["regExp","isTextOrQuote","char","test","onCangjieInput","event","controller","next","data","detail","value","selection","startText","offset","anchor","leftChar","text","rightChar","isExpanded","preventDefault","command","Commands","wrapText","isCollapsed","moveForward"],"mappings":";;;;;;;AAAA;;AAMA;;AAUA,MAAMA,MAAM,GAAG,qBAAf;;AACA,SAASC,aAAT,CAAuBC,IAAvB,EAA6B;AAC3B,SAAOA,IAAI,KAAKF,MAAM,CAACG,IAAP,CAAYD,IAAZ,KAAqB,kCAAkBA,IAAlB,CAA1B,CAAX;AACD;;AAEc,SAASE,cAAT,CAAwBC,KAAxB,EAAkDC,UAAlD,EAA0EC,IAA1E,EAAgF;AAC7F,QAAM;AAAEC,IAAAA;AAAF,MAAWH,KAAK,CAACI,MAAvB;;AACA,MAAI,CAACD,IAAD,IAAS,CAAC,4BAAYA,IAAZ,CAAd,EAAiC;AAC/B,WAAOD,IAAI,EAAX;AACD;;AAED,QAAM;AAAEG,IAAAA;AAAF,MAAYJ,UAAlB;AACA,QAAM;AAAEK,IAAAA,SAAF;AAAaC,IAAAA;AAAb,MAA2BF,KAAjC;;AACA,MAAI,CAACC,SAAD,IAAc,CAACC,SAAnB,EAA8B;AAC5B,WAAOL,IAAI,EAAX;AACD;;AAED,QAAM;AAAEM,IAAAA;AAAF,MAAaF,SAAS,CAACG,MAA7B;AACA,QAAMC,QAAQ,GAAGH,SAAS,CAACI,IAAV,CAAeH,MAAM,GAAG,CAAxB,CAAjB;AACA,QAAMI,SAAS,GAAGL,SAAS,CAACI,IAAV,CAAeH,MAAf,CAAlB;;AACA,MAAIF,SAAS,CAACO,UAAV,IAAwB,kCAAkBV,IAAlB,CAA5B,EAAqD;AACnDH,IAAAA,KAAK,CAACc,cAAN;AACA,WAAOb,UAAU,CAACc,OAAX,CAAmBC,sBAASC,QAA5B,EAAsC,GAAG,kCAAkBd,IAAlB,CAAzC,CAAP;AACD;;AACD,MAAIG,SAAS,CAACO,UAAV,IAAwB,gCAAgBV,IAAhB,CAA5B,EAAmD;AACjDH,IAAAA,KAAK,CAACc,cAAN;AACA,WAAOb,UAAU,CAACc,OAAX,CAAmBC,sBAASC,QAA5B,EAAsCd,IAAtC,EAA4C,kCAAkBA,IAAlB,CAA5C,CAAP;AACD;;AACD,MAAIG,SAAS,CAACY,WAAV,IAAyB,kCAAkBf,IAAlB,CAAzB,IAAoDA,IAAI,KAAKS,SAA7D,IAA0EhB,aAAa,CAACc,QAAD,CAA3F,EAAuG;AACrGV,IAAAA,KAAK,CAACc,cAAN;AACA,WAAOb,UAAU,CAACc,OAAX,CAAmBC,sBAASG,WAA5B,EAAyC,CAAzC,CAAP;AACD;;AACD,MAAIb,SAAS,CAACY,WAAV,IAAyB,kCAAkBf,IAAlB,CAAzB,KAAqDP,aAAa,CAACc,QAAD,CAAb,IAA2Bd,aAAa,CAACgB,SAAD,CAA7F,CAAJ,EAA+G;AAC7G,WAAOV,IAAI,EAAX;AACD;;AACD,MAAII,SAAS,CAACY,WAAV,IAAyB,gCAAgBf,IAAhB,CAA7B,EAAoD;AAClDH,IAAAA,KAAK,CAACc,cAAN;AACA,WAAOb,UAAU,CAACc,OAAX,CAAmBC,sBAASC,QAA5B,EAAsCd,IAAtC,EAA4C,kCAAkBA,IAAlB,CAA5C,CAAP;AACD;;AACD,MAAIG,SAAS,CAACY,WAAV,IAAyB,+BAAef,IAAf,CAAzB,IAAiDS,SAAS,KAAKT,IAAnE,EAAyE;AACvEH,IAAAA,KAAK,CAACc,cAAN;AACA,WAAOb,UAAU,CAACc,OAAX,CAAmBC,sBAASG,WAA5B,EAAyC,CAAzC,CAAP;AACD;;AACD,SAAOjB,IAAI,EAAX;AACD","sourcesContent":["import {\n  Controller,\n  Commands,\n  CangjieInputEvent,\n  TextPoint,\n} from '@ali/4ever-cangjie';\nimport {\n  isCoupleKey,\n  isLeftCoupleKey,\n  isRightBracket,\n  getRightCoupleKey,\n  isEnglishQuoteKey,\n  isChineseQuoteKey,\n  getChineseQuoteCP,\n} from '../utils/coupleKey';\n\nconst regExp = /[\\u4e00-\\u9fa5\\d\\w]/;\nfunction isTextOrQuote(char) {\n  return char && (regExp.test(char) || isEnglishQuoteKey(char));\n}\n\nexport default function onCangjieInput(event: CangjieInputEvent, controller: Controller, next) {\n  const { data } = event.detail;\n  if (!data || !isCoupleKey(data)) {\n    return next();\n  }\n\n  const { value } = controller;\n  const { selection, startText } = value;\n  if (!selection || !startText) {\n    return next();\n  }\n\n  const { offset } = selection.anchor as TextPoint;\n  const leftChar = startText.text[offset - 1];\n  const rightChar = startText.text[offset];\n  if (selection.isExpanded && isChineseQuoteKey(data)) {\n    event.preventDefault();\n    return controller.command(Commands.wrapText, ...getChineseQuoteCP(data));\n  }\n  if (selection.isExpanded && isLeftCoupleKey(data)) {\n    event.preventDefault();\n    return controller.command(Commands.wrapText, data, getRightCoupleKey(data));\n  }\n  if (selection.isCollapsed && isEnglishQuoteKey(data) && data === rightChar && isTextOrQuote(leftChar)) {\n    event.preventDefault();\n    return controller.command(Commands.moveForward, 1);\n  }\n  if (selection.isCollapsed && isEnglishQuoteKey(data) && (isTextOrQuote(leftChar) || isTextOrQuote(rightChar))) {\n    return next();\n  }\n  if (selection.isCollapsed && isLeftCoupleKey(data)) {\n    event.preventDefault();\n    return controller.command(Commands.wrapText, data, getRightCoupleKey(data));\n  }\n  if (selection.isCollapsed && isRightBracket(data) && rightChar === data) {\n    event.preventDefault();\n    return controller.command(Commands.moveForward, 1);\n  }\n  return next();\n}\n"],"file":"onCangjieInput.js"}