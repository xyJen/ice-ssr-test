"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = onCangjieInput;

var _everCangjie = require("@ali/4ever-cangjie");

var _coupleKey = require("../utils/coupleKey");

const regExp = /[\u4e00-\u9fa5\d\w]/;

function isTextOrQuote(char) {
  return char && (regExp.test(char) || (0, _coupleKey.isEnglishQuoteKey)(char));
}

function onCangjieInput(event, controller, next) {
  const {
    data
  } = event.detail;

  if (!data || !(0, _coupleKey.isCoupleKey)(data)) {
    return next();
  }

  const {
    value
  } = controller;
  const {
    selection,
    startText
  } = value;

  if (!selection || !startText) {
    return next();
  }

  const {
    offset
  } = selection.anchor;
  const leftChar = startText.text[offset - 1];
  const rightChar = startText.text[offset];

  if (selection.isExpanded && (0, _coupleKey.isChineseQuoteKey)(data)) {
    event.preventDefault();
    return controller.command(_everCangjie.Commands.wrapText, ...(0, _coupleKey.getChineseQuoteCP)(data));
  }

  if (selection.isExpanded && (0, _coupleKey.isLeftCoupleKey)(data)) {
    event.preventDefault();
    return controller.command(_everCangjie.Commands.wrapText, data, (0, _coupleKey.getRightCoupleKey)(data));
  }

  if (selection.isCollapsed && (0, _coupleKey.isEnglishQuoteKey)(data) && data === rightChar && isTextOrQuote(leftChar)) {
    event.preventDefault();
    return controller.command(_everCangjie.Commands.moveForward, 1);
  }

  if (selection.isCollapsed && (0, _coupleKey.isEnglishQuoteKey)(data) && (isTextOrQuote(leftChar) || isTextOrQuote(rightChar))) {
    return next();
  }

  if (selection.isCollapsed && (0, _coupleKey.isLeftCoupleKey)(data)) {
    event.preventDefault();
    return controller.command(_everCangjie.Commands.wrapText, data, (0, _coupleKey.getRightCoupleKey)(data));
  }

  if (selection.isCollapsed && (0, _coupleKey.isRightBracket)(data) && rightChar === data) {
    event.preventDefault();
    return controller.command(_everCangjie.Commands.moveForward, 1);
  }

  return next();
}
//# sourceMappingURL=onCangjieInput.js.map