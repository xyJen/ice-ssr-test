"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = toggleVertAlignMark;

var _everCangjie = require("@ali/4ever-cangjie");

function toggleVertAlignMark(controller, ranges, alignType) {
  const alignMark = _everCangjie.Mark.create({
    type: 'vertAlign',
    data: {
      value: alignType
    }
  });

  const {
    value
  } = controller;
  const {
    selection
  } = value;
  const activeAlignMark = value.activeMarks.find(m => m.type === 'vertAlign');

  if (ranges.length === 1 && selection && selection.isCollapsed) {
    if (!activeAlignMark) {
      return controller.command(_everCangjie.Commands.addMark, alignMark);
    }

    if (activeAlignMark.data.value !== alignType) {
      return controller.command(_everCangjie.Commands.removeMark, activeAlignMark).command(_everCangjie.Commands.addMark, alignMark);
    }

    controller.command(_everCangjie.Commands.removeMark, alignMark);
  } else {
    ranges.forEach(range => {
      if (!activeAlignMark) {
        return controller.command(_everCangjie.Commands.addMarkAtRange, range, alignMark);
      }

      if (activeAlignMark.data.value !== alignType) {
        return controller.command(_everCangjie.Commands.removeMarkAtRange, range, activeAlignMark).command(_everCangjie.Commands.addMarkAtRange, range, alignMark);
      }

      return controller.command(_everCangjie.Commands.removeMarkAtRange, range, alignMark);
    });
  }

  return controller;
}
//# sourceMappingURL=toggleVertAlignMark.js.map