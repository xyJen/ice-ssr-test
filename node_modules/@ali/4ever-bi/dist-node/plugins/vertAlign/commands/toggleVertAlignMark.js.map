{"version":3,"sources":["../../../../../src/plugins/vertAlign/commands/toggleVertAlignMark.ts"],"names":["toggleVertAlignMark","controller","ranges","alignType","alignMark","Mark","create","type","data","value","selection","activeAlignMark","activeMarks","find","m","length","isCollapsed","command","Commands","addMark","removeMark","forEach","range","addMarkAtRange","removeMarkAtRange"],"mappings":";;;;;;;AAAA;;AAEe,SAASA,mBAAT,CAA6BC,UAA7B,EAAqDC,MAArD,EAA6DC,SAA7D,EAAwE;AACrF,QAAMC,SAAS,GAAGC,kBAAKC,MAAL,CAAY;AAC5BC,IAAAA,IAAI,EAAE,WADsB;AAE5BC,IAAAA,IAAI,EAAE;AAAEC,MAAAA,KAAK,EAAEN;AAAT;AAFsB,GAAZ,CAAlB;;AAIA,QAAM;AAAEM,IAAAA;AAAF,MAAYR,UAAlB;AACA,QAAM;AAAES,IAAAA;AAAF,MAAgBD,KAAtB;AACA,QAAME,eAAe,GAAGF,KAAK,CAACG,WAAN,CAAkBC,IAAlB,CAAuBC,CAAC,IAAIA,CAAC,CAACP,IAAF,KAAW,WAAvC,CAAxB;;AAEA,MAAKL,MAAM,CAACa,MAAP,KAAkB,CAAnB,IAAyBL,SAAzB,IAAsCA,SAAS,CAACM,WAApD,EAAiE;AAC/D,QAAI,CAACL,eAAL,EAAsB;AACpB,aAAOV,UAAU,CAACgB,OAAX,CAAmBC,sBAASC,OAA5B,EAAqCf,SAArC,CAAP;AACD;;AACD,QAAIO,eAAe,CAACH,IAAhB,CAAqBC,KAArB,KAA+BN,SAAnC,EAA8C;AAC5C,aAAOF,UAAU,CACdgB,OADI,CACIC,sBAASE,UADb,EACyBT,eADzB,EAEJM,OAFI,CAEIC,sBAASC,OAFb,EAEsBf,SAFtB,CAAP;AAGD;;AACDH,IAAAA,UAAU,CAACgB,OAAX,CAAmBC,sBAASE,UAA5B,EAAwChB,SAAxC;AACD,GAVD,MAUO;AACLF,IAAAA,MAAM,CAACmB,OAAP,CAAgBC,KAAD,IAAW;AACxB,UAAI,CAACX,eAAL,EAAsB;AACpB,eAAOV,UAAU,CAACgB,OAAX,CAAmBC,sBAASK,cAA5B,EAA4CD,KAA5C,EAAmDlB,SAAnD,CAAP;AACD;;AACD,UAAIO,eAAe,CAACH,IAAhB,CAAqBC,KAArB,KAA+BN,SAAnC,EAA8C;AAC5C,eAAOF,UAAU,CACdgB,OADI,CACIC,sBAASM,iBADb,EACgCF,KADhC,EACuCX,eADvC,EAEJM,OAFI,CAEIC,sBAASK,cAFb,EAE6BD,KAF7B,EAEoClB,SAFpC,CAAP;AAGD;;AACD,aAAOH,UAAU,CAACgB,OAAX,CAAmBC,sBAASM,iBAA5B,EAA+CF,KAA/C,EAAsDlB,SAAtD,CAAP;AACD,KAVD;AAWD;;AACD,SAAOH,UAAP;AACD","sourcesContent":["import { Controller, Commands, Mark } from '@ali/4ever-cangjie';\n\nexport default function toggleVertAlignMark(controller: Controller, ranges, alignType) {\n  const alignMark = Mark.create({\n    type: 'vertAlign',\n    data: { value: alignType },\n  });\n  const { value } = controller;\n  const { selection } = value;\n  const activeAlignMark = value.activeMarks.find(m => m.type === 'vertAlign');\n\n  if ((ranges.length === 1) && selection && selection.isCollapsed) {\n    if (!activeAlignMark) {\n      return controller.command(Commands.addMark, alignMark);\n    }\n    if (activeAlignMark.data.value !== alignType) {\n      return controller\n        .command(Commands.removeMark, activeAlignMark)\n        .command(Commands.addMark, alignMark);\n    }\n    controller.command(Commands.removeMark, alignMark);\n  } else {\n    ranges.forEach((range) => {\n      if (!activeAlignMark) {\n        return controller.command(Commands.addMarkAtRange, range, alignMark);\n      }\n      if (activeAlignMark.data.value !== alignType) {\n        return controller\n          .command(Commands.removeMarkAtRange, range, activeAlignMark)\n          .command(Commands.addMarkAtRange, range, alignMark);\n      }\n      return controller.command(Commands.removeMarkAtRange, range, alignMark);\n    });\n  }\n  return controller;\n}\n"],"file":"toggleVertAlignMark.js"}