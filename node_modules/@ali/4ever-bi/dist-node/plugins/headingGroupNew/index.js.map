{"version":3,"sources":["../../../../src/plugins/headingGroupNew/index.ts"],"names":["Heading1","Heading2","Heading3","Heading","actions","GroupFactory","DRAG_BUTTON_OFFSET","PI_MODE","createHeadingGroupPlugin","config","headingGroup","level","shouldOffsetTypes","i","push","renderGroup","generateGroup","queries","getHeadingGroupLevel","isHeadingGroupAvailable","getLeftToolbarOffset","controller","data","node","isPi","query","includes","type","x","y","undefined","isElementInGroup","element","group","isHeading1","isHeading2","isHeading3"],"mappings":";;;;;;;;;;;AAAA;;AAEA;;AAEA;;AACA;;AACA;;AAEA,MAAM;AACJA,EAAAA,QADI;AAEJC,EAAAA,QAFI;AAGJC,EAAAA;AAHI,IAIFC,eAJJ;AAMA,MAAM;AAAEC,EAAAA;AAAF,IAAcC,wBAApB;AACA,MAAMC,kBAAkB,GAAG,CAAC,EAA5B;AACA,MAAMC,OAAO,GAAG,aAAhB;;AAEA,MAAMC,wBAAwB,GAAKC,MAAD,IAA4B;AAC5D,QAAM;AAAEC,IAAAA,YAAY,GAAG;AAAjB,MAAwBD,MAA9B;AACA,QAAM;AAAEE,IAAAA,KAAK,GAAG;AAAV,MAAgBD,YAAtB;AACA,QAAME,iBAA2B,GAAG,EAApC;;AACA,OAAK,IAAIC,CAAC,GAAGF,KAAb,EAAoBE,CAAC,GAAG,CAAxB,EAA2BA,CAAC,EAA5B,EAAgC;AAC9BD,IAAAA,iBAAiB,CAACE,IAAlB,CAAwB,WAAUD,CAAE,EAApC;AACD;;AAAA;AACD,SAAO;AACLE,IAAAA,WAAW,EAAE,gCAAkBL,YAAlB,CADR;AAELM,IAAAA,aAAa,EAAE,kCAAoBN,YAApB,CAFV;AAGLO,IAAAA,OAAO,EAAE;AACPC,MAAAA,oBAAoB,EAAE,MAAMP,KADrB;AAEPQ,MAAAA,uBAAuB,EAAE,MAAM,IAFxB;AAGPC,MAAAA,oBAAoB,EAAE,CAACC,UAAD,EAAaC,IAAb,KAAsB;AAC1C,cAAM;AAAEC,UAAAA;AAAF,YAAWD,IAAjB;AACA,cAAME,IAAI,GAAGH,UAAU,CAACI,KAAX,CAAiB,eAAjB,MAAsClB,OAAnD;;AACA,YAAI,CAACiB,IAAD,IAASZ,iBAAiB,CAACc,QAAlB,CAA2BH,IAAI,CAACI,IAAhC,CAAb,EAAoD;AAClD,iBAAO;AACL;AACAC,YAAAA,CAAC,EAAEtB,kBAAkB,GAAG,CAFnB;AAGLuB,YAAAA,CAAC,EAAE;AAHE,WAAP;AAKD;;AACD,eAAOC,SAAP;AACD,OAdM;AAePC,MAAAA,gBAAgB,EAAE,CAChBV,UADgB,EAEhBW,OAFgB,EAGhBC,KAHgB,KAIb;AACH;AACA,YAAIjC,QAAQ,CAACkC,UAAT,CAAoBF,OAApB,CAAJ,EAAkC;AAChC,iBAAO,KAAP;AACD,SAFD,MAEO,IAAI/B,QAAQ,CAACkC,UAAT,CAAoBH,OAApB,CAAJ,EAAkC;AACvC,cAAIC,KAAK,CAACN,IAAN,KAAe,gBAAnB,EAAqC;AACnC,mBAAO,IAAP;AACD;;AACD,iBAAO,KAAP;AACD,SALM,MAKA,IAAIzB,QAAQ,CAACkC,UAAT,CAAoBJ,OAApB,CAAJ,EAAkC;AACvC,cAAIC,KAAK,CAACN,IAAN,KAAe,gBAAf,IAAmCM,KAAK,CAACN,IAAN,KAAe,gBAAtD,EAAwE;AACtE,mBAAO,IAAP;AACD;;AACD,iBAAO,KAAP;AACD;;AACD,eAAO,IAAP;AACD,OAnCM;AAoCP,SAAGV;AApCI;AAHJ,GAAP;AA0CD,CAjDD,C,CAmDA;;;AACAT,wBAAwB,CAACJ,OAAzB,GAAmCA,OAAnC,C,CACA;;AACAI,wBAAwB,CAACS,OAAzB,GAAmCA,OAAnC;eAEeT,wB","sourcesContent":["import { GroupFactory } from '@ali/4ever-bamboo';\nimport { Controller, Element, Group } from '@ali/4ever-cangjie';\nimport { Heading } from '@ali/4ever-mo';\nimport { BiPluginConfig } from '../../types';\nimport createGenerateGroup from './handlers/createGenerateGroup';\nimport createRenderGroup from './handlers/createRenderGroup';\nimport * as queries from './queries';\n\nconst {\n  Heading1,\n  Heading2,\n  Heading3,\n} = Heading;\n\nconst { actions } = GroupFactory;\nconst DRAG_BUTTON_OFFSET = -20;\nconst PI_MODE = 'page_layout';\n\nconst createHeadingGroupPlugin = ((config: BiPluginConfig) => {\n  const { headingGroup = {} } = config;\n  const { level = 3 } = headingGroup;\n  const shouldOffsetTypes: string[] = [];\n  for (let i = level; i > 0; i--) {\n    shouldOffsetTypes.push(`heading-${i}`);\n  };\n  return {\n    renderGroup: createRenderGroup(headingGroup),\n    generateGroup: createGenerateGroup(headingGroup),\n    queries: {\n      getHeadingGroupLevel: () => level,\n      isHeadingGroupAvailable: () => true,\n      getLeftToolbarOffset: (controller, data) => {\n        const { node } = data;\n        const isPi = controller.query('getLayoutMode') === PI_MODE;\n        if (!isPi && shouldOffsetTypes.includes(node.type)) {\n          return {\n            // 这里加上4是因为左侧工具栏的offset为6，但是在标题场景下是2\n            x: DRAG_BUTTON_OFFSET + 4,\n            y: 0,\n          };\n        }\n        return undefined;\n      },\n      isElementInGroup: (\n        controller: Controller,\n        element: Element,\n        group: Group,\n      ) => {\n        // 分组 2 只能存在于分组 1 之中\n        if (Heading1.isHeading1(element)) {\n          return false;\n        } else if (Heading2.isHeading2(element)) {\n          if (group.type === 'heading1-group') {\n            return true;\n          }\n          return false;\n        } else if (Heading3.isHeading3(element)) {\n          if (group.type === 'heading1-group' || group.type === 'heading2-group') {\n            return true;\n          }\n          return false;\n        }\n        return true;\n      },\n      ...queries,\n    },\n  };\n});\n\n// @ts-ignore\ncreateHeadingGroupPlugin.actions = actions;\n// @ts-ignore\ncreateHeadingGroupPlugin.queries = queries;\n\nexport default createHeadingGroupPlugin;\n"],"file":"index.js"}