{"version":3,"sources":["../../../../../src/plugins/heading/utils/fragment.ts"],"names":["removeNodeMarkByTypes","block","types","node","texts","getTexts","length","i","text","path","getPath","key","needRemoveMarks","getMarks","filter","m","find","t","type","j","removeMark","isSelectionAtHeading","value","selection","isCollapsedAtEdge","startBlock","Heading","isHeading","removeFirstNodeMarkByTypes","frag","fragment","nodes","firstNode","replaceNode","isVisualEmpty","maybeNode","Paragraph","isParagraph","Text","isText"],"mappings":";;;;;;;;;AAAA;;AAMA;;AAGA,SAASA,qBAAT,CAA+BC,KAA/B,EAA6CC,KAA7C,EAA8D;AAC5D,MAAIC,IAAI,GAAGF,KAAX;AACA,QAAMG,KAAK,GAAGD,IAAI,EAAEE,QAAN,EAAd;AACA,MAAI,CAACD,KAAK,EAAEE,MAAZ,EAAoB,OAAOH,IAAP;;AAEpB,OAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAACH,KAAK,CAACE,MAAxB,EAAgCC,CAAC,EAAjC,EAAqC;AACnC,UAAMC,IAAI,GAAGJ,KAAK,CAACG,CAAD,CAAlB;AACA,UAAME,IAAI,GAAGN,IAAI,CAACO,OAAL,CAAaF,IAAI,CAACG,GAAlB,CAAb;AACA,QAAI,CAACF,IAAL,EAAW;AAEX,UAAMG,eAAe,GAAGJ,IAAI,CAACK,QAAL,GAAgBC,MAAhB,CAAwBC,CAAD,IAAO;AACpD,aAAOb,KAAK,CAACc,IAAN,CAAYC,CAAC,IAAIF,CAAC,CAACG,IAAF,KAAWD,CAA5B,CAAP;AACD,KAFuB,CAAxB;;AAIA,SAAI,IAAIE,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGP,eAAe,CAACN,MAAnC,EAA2Ca,CAAC,EAA5C,EAAgD;AAC9ChB,MAAAA,IAAI,GAAGA,IAAI,CAACiB,UAAL,CAAgBX,IAAhB,EAAsB,CAAtB,EAAyBD,IAAI,CAACA,IAAL,CAAUF,MAAnC,EAA2CM,eAAe,CAACO,CAAD,CAA1D,CAAP;AACD;AACF;;AAED,SAAOhB,IAAP;AACD;;AAEM,SAASkB,oBAAT,CAA8BC,KAA9B,EAA4C;AACjD,MAAIA,KAAK,CAACC,SAAN,CAAgBC,iBAApB,EAAuC,OAAO,KAAP;AACvC,QAAM;AAAEC,IAAAA;AAAF,MAAiBH,KAAvB;AACA,SAAOI,gBAAQC,SAAR,CAAkBF,UAAlB,CAAP;AACD;AAGD;AACA;AACA;;;AACO,SAASG,0BAAT,CAAoCC,IAApC,EAAoD3B,KAApD,EAAqE;AAC1E,MAAI4B,QAAQ,GAAGD,IAAf;AACA,MAAI,CAACC,QAAQ,EAAEC,KAAV,EAAiBzB,MAAtB,EAA8B,OAAOwB,QAAP;AAE9B,QAAM3B,IAAI,GAAG2B,QAAQ,CAACC,KAAT,CAAe,CAAf,CAAb;AACA,QAAMtB,IAAI,GAAGqB,QAAQ,CAACpB,OAAT,CAAiBP,IAAI,CAACQ,GAAtB,CAAb;AACA,MAAI,CAACF,IAAL,EAAW,OAAOqB,QAAP;AAEX,QAAME,SAAS,GAAGhC,qBAAqB,CAACG,IAAD,EAAOD,KAAP,CAAvC;AACA,SAAO4B,QAAQ,CAACG,WAAT,CAAqBxB,IAArB,EAA2BuB,SAA3B,CAAP;AACD;AAGD;AACA;AACA;;;AACQ,SAASE,aAAT,CAAuBC,SAAvB,EAAuC;AAC7C,SACE,CAACC,kBAAUC,WAAV,CAAsBF,SAAtB,KAAoCT,gBAAQC,SAAR,CAAkBQ,SAAlB,CAArC,KACAA,SAAS,CAACJ,KAAV,CAAgBzB,MAAhB,KAA2B,CAD3B,IAEAgC,kBAAKC,MAAL,CAAYJ,SAAS,CAACJ,KAAV,CAAgB,CAAhB,CAAZ,CAFA,IAGAI,SAAS,CAAC3B,IAAV,KAAmB,EAJrB;AAMD","sourcesContent":["import { \n  Document, \n  Block,\n  Value,\n  Text,\n} from '@ali/4ever-cangjie';\nimport { Heading, Paragraph } from '@ali/4ever-mo';\n\n\nfunction removeNodeMarkByTypes(block: Block, types: string[]) {\n  let node = block;\n  const texts = node?.getTexts();\n  if (!texts?.length) return node;\n\n  for (let i = 0; i<texts.length; i++) {\n    const text = texts[i];\n    const path = node.getPath(text.key);\n    if (!path) continue;\n\n    const needRemoveMarks = text.getMarks().filter((m) => {\n      return types.find( t => m.type === t);\n    });\n\n    for(let j = 0; j < needRemoveMarks.length; j++) {\n      node = node.removeMark(path, 0, text.text.length, needRemoveMarks[j]);\n    }\n  }\n\n  return node;\n}\n\nexport function isSelectionAtHeading(value: Value) {\n  if (value.selection.isCollapsedAtEdge) return false;\n  const { startBlock } = value;\n  return Heading.isHeading(startBlock);\n}\n\n\n/**\n * 移除 fragment 第一个段落指定 marks\n */\nexport function removeFirstNodeMarkByTypes(frag: Document, types: string[]) {\n  let fragment = frag;\n  if (!fragment?.nodes?.length) return fragment;\n\n  const node = fragment.nodes[0];\n  const path = fragment.getPath(node.key);\n  if (!path) return fragment;\n\n  const firstNode = removeNodeMarkByTypes(node, types);\n  return fragment.replaceNode(path, firstNode);\n}\n\n\n/**\n * 视觉上是否为空段落\n */\n export function isVisualEmpty(maybeNode: any) {\n  return (\n    (Paragraph.isParagraph(maybeNode) || Heading.isHeading(maybeNode)) && \n    maybeNode.nodes.length === 1 && \n    Text.isText(maybeNode.nodes[0]) &&\n    maybeNode.text === ''\n  );\n}\n"],"file":"fragment.js"}