{"version":3,"sources":["../../../../../src/plugins/heading/queries/getHeading.ts"],"names":["getHeading","controller","startBlock","endBlock","value","emptyHeading","environment","IS_MOBILE","type","ranges","headings","length","heading","Block","create","Paragraph","isParagraph","Heading","isHeading"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AAEe,SAASA,UAAT,CAAoBC,UAApB,EAA4C;AACzD,QAAM;AAAEC,IAAAA,UAAF;AAAcC,IAAAA;AAAd,MAA2BF,UAAU,CAACG,KAA5C,CADyD,CAGzD;;AACA,QAAMC,YAAY,GAAGC,yBAAYC,SAAZ,GAAwB,WAAxB,GAAsC,EAA3D,CAJyD,CAMzD;;AACA,MAAIL,UAAU,EAAEM,IAAZ,KAAqBL,QAAQ,EAAEK,IAAnC,EAAyC,OAAOH,YAAP;AAEzC,QAAMI,MAAM,GAAG,oCAAoBR,UAApB,CAAf;AACA,QAAMS,QAAQ,GAAG,iCAAmBT,UAAnB,EAA+BQ,MAA/B,CAAjB;;AACA,MAAIC,QAAQ,CAACC,MAAT,KAAoB,CAAxB,EAA2B;AACzB,UAAMC,OAAO,GAAGC,mBAAMC,MAAN,CAAa;AAC3BN,MAAAA,IAAI,EAAEE,QAAQ,CAAC,CAAD;AADa,KAAb,CAAhB;;AAGA,QAAIK,kBAAUC,WAAV,CAAsBJ,OAAtB,KAAkCK,gBAAQC,SAAR,CAAkBN,OAAlB,CAAtC,EAAkE;AAChE,aAAOA,OAAO,CAACJ,IAAf;AACD;AACF;;AAED,SAAOH,YAAP;AACD","sourcesContent":["import { Controller, environment, Block } from '@ali/4ever-cangjie';\nimport { Heading, Paragraph } from '@ali/4ever-mo';\nimport { getRangesFromEditor }  from '@ali/4ever-utils';\nimport getHeadingAtRanges from '../utils/getHeadingAtRanges';\n\nexport default function getHeading(controller: Controller) {\n  const { startBlock, endBlock } = controller.value;\n\n  // 多个块级元素时返回空，以便区分正文（移动端不做此处理）\n  const emptyHeading = environment.IS_MOBILE ? 'paragraph' : '';\n\n  // 尽量避免遍历 ranges\n  if (startBlock?.type !== endBlock?.type) return emptyHeading;\n\n  const ranges = getRangesFromEditor(controller);\n  const headings = getHeadingAtRanges(controller, ranges);\n  if (headings.length === 1) {\n    const heading = Block.create({\n      type: headings[0],\n    });\n    if (Paragraph.isParagraph(heading) || Heading.isHeading(heading)) {\n      return heading.type;\n    }\n  }\n\n  return emptyHeading;\n}\n"],"file":"getHeading.js"}