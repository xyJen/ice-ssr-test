{"version":3,"sources":["../../../../../src/plugins/heading/handlers/createOnCangjiePaste.ts"],"names":["MIME_TYPES","constants","createOnCangjiePaste","config","onCangjiePaste","event","controller","next","clipboardData","query","hasData","FRAGMENT","fragment","getFragment","nodes","length","nextFragment","setData","transferUtils","encodeFragment"],"mappings":";;;;;;;AAAA;;AAGA,MAAM;AAAEA,EAAAA;AAAF,IAAiBC,sBAAvB;;AAEe,SAASC,oBAAT,CACbC,MADa,EAEa;AAE1B,SAAO,eAAeC,cAAf,CAA8BC,KAA9B,EAAqCC,UAArC,EAAiDC,IAAjD,EAAuD;AAC5D,UAAMC,aAAa,GAAGF,UAAU,CAACG,KAAX,CAAiB,kBAAjB,EAAqCJ,KAArC,CAAtB;;AACA,QAAI,CAACG,aAAa,EAAEE,OAAf,CAAuBV,UAAU,CAACW,QAAlC,CAAL,EAAkD;AAChD,aAAOJ,IAAI,EAAX;AACD;;AACD,QAAIK,QAAQ,GAAGJ,aAAa,CAACK,WAAd,EAAf;AACA,QAAI,CAACD,QAAQ,EAAEE,KAAV,EAAiBC,MAAtB,EAA8B,OAAOR,IAAI,EAAX;AAE9B,UAAMS,YAAyC,GAAGV,UAAU,CAACG,KAAX,CAAiB,yBAAjB,EAA4CG,QAA5C,CAAlD;;AAEA,QAAII,YAAJ,EAAkB;AAChBX,MAAAA,KAAK,CAACG,aAAN,CAAqBS,OAArB,CACEjB,UAAU,CAACW,QADb,EAEEO,2BAAcC,cAAd,CAA6BH,YAA7B,CAFF;AAID;;AACD,WAAOT,IAAI,EAAX;AACD,GAjBD;AAkBD;;AAAA","sourcesContent":["import { Plugin, constants, transferUtils, Document } from '@ali/4ever-cangjie';\nimport { BiPluginConfig } from '../../../types';\n\nconst { MIME_TYPES } = constants;\n\nexport default function createOnCangjiePaste(\n  config: BiPluginConfig,\n): Plugin['onCangjiePaste'] {\n\n  return async function onCangjiePaste(event, controller, next) {\n    const clipboardData = controller.query('getClipboardData', event);\n    if (!clipboardData?.hasData(MIME_TYPES.FRAGMENT)) {\n      return next();\n    }\n    let fragment = clipboardData.getFragment();\n    if (!fragment?.nodes?.length) return next();\n\n    const nextFragment: null | undefined | Document = controller.query('getHeadingPasteFragment', fragment);\n\n    if (nextFragment) {\n      event.clipboardData!.setData(\n        MIME_TYPES.FRAGMENT,\n        transferUtils.encodeFragment(nextFragment),\n      );\n    }\n    return next();\n  };\n};\n"],"file":"createOnCangjiePaste.js"}