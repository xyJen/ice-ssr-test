"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = setHeading;

var _everCangjie = require("@ali/4ever-cangjie");

var _everMo = require("@ali/4ever-mo");

var _everBamboo = require("@ali/4ever-bamboo");

var _everUtils = require("@ali/4ever-utils");

const boldMark = _everMo.Marks.Bold.create(true);

function setHeading(controller, type) {
  const {
    selection
  } = controller.value;
  const allBlocks = (0, _everUtils.getBlocksFromEditor)(controller);
  allBlocks.forEach(block => {
    // 跳过 hr、code等不支持heading的段落
    if (!_everMo.Paragraph.isParagraph(block) && !_everMo.Heading.isHeading(block)) return;
    const blockRange = selection.moveToRangeOfNode(block, controller);

    if (type === _everMo.Paragraph.TYPE) {
      (0, _everUtils.removeMarkAtRange)(controller, blockRange, boldMark.type);
      (0, _everUtils.removeMarkAtRange)(controller, blockRange, _everMo.Marks.Sz.TYPE);
    } else {
      // 非普通段落补一下 sz mark
      const szMark = _everMo.Marks.Sz.create({
        value: _everBamboo.SzUtil.fromHeadingType(type),
        szUnit: 'pt'
      });

      (0, _everUtils.addMarkAtRange)(controller, blockRange, boldMark);
      (0, _everUtils.addMarkAtRange)(controller, blockRange, szMark);
    } // 覆盖spacing，@tengxun/google


    const spacing = _everBamboo.SpacingUtil.fromHeadingType(type);

    controller.command(_everCangjie.Commands.setNodeByKey, block.key, {
      type,
      data: { ...block.data,
        spacing
      }
    });
  });
  return controller;
}
//# sourceMappingURL=setHeading.js.map