"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createOnAction;

var _everCangjie = require("@ali/4ever-cangjie");

var _actions = _interopRequireDefault(require("../actions"));

var _findNativeTextArea = _interopRequireDefault(require("../utils/findNativeTextArea"));

var _getScreenSelection = require("../utils/getScreenSelection");

function createOnAction(configs) {
  const {
    onToggleMode
  } = configs || {};
  return function handleAction(action, controller, next) {
    if (action.type === _actions.default.ENTER) {
      controller.setData({ ...controller.value.data,
        _exitPreview: false,
        // 进入预览模式时，需要隐藏弹出菜单
        _mobileFocusedSelection: undefined
      });
      onToggleMode && onToggleMode(true);
    } else if (action.type === _actions.default.EXIT) {
      const {
        noScroll,
        noFocus
      } = action.payload || {};
      const {
        data
      } = controller.value;
      const selection = noScroll ? null : (0, _getScreenSelection.getScreenSelection)(controller);

      if (selection) {
        controller.command(_everCangjie.Commands.select, selection);
      }

      controller.setData({ ...data,
        _exitPreview: true
      });
      onToggleMode && onToggleMode(false);

      if (!noFocus) {
        controller.run('onCangjieFocus');
        const textArea = (0, _findNativeTextArea.default)(controller);

        if (textArea?.focus) {
          textArea.focus({
            preventScroll: true
          });
        }
      }
    }

    return next();
  };
}
//# sourceMappingURL=onAction.js.map