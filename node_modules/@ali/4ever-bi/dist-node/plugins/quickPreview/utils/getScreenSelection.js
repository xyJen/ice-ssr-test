"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getScreenSelection = getScreenSelection;

var _everCangjie = require("@ali/4ever-cangjie");

const TOP_SPACE = 100;
const OFFSET = 10;
/**
 * 获取屏幕顶部的 selection，聚焦的时候避免滚动
 */

function getScreenSelection(controller) {
  const {
    key
  } = controller.value.document;

  const docNode = _everCangjie.domUtils.findDOMNodeSafely(key);

  if (!docNode) {
    return null;
  }

  const {
    left,
    top,
    bottom
  } = docNode.getBoundingClientRect();
  const clientX = left + OFFSET;
  let clientY = TOP_SPACE;

  if (top > TOP_SPACE) {
    clientY = top + OFFSET;
  } else if (bottom < TOP_SPACE) {
    clientY = bottom - OFFSET;
  }

  const hitedTarget = window.document.elementFromPoint(clientX, clientY);

  if (!hitedTarget) {
    return null;
  }

  return _everCangjie.domUtils.caretRangeFromTargetAndCoord(hitedTarget, clientX, clientY, controller);
}
//# sourceMappingURL=getScreenSelection.js.map