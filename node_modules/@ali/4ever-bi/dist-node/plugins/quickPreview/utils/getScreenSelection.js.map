{"version":3,"sources":["../../../../../src/plugins/quickPreview/utils/getScreenSelection.ts"],"names":["TOP_SPACE","OFFSET","getScreenSelection","controller","key","value","document","docNode","domUtils","findDOMNodeSafely","left","top","bottom","getBoundingClientRect","clientX","clientY","hitedTarget","window","elementFromPoint","caretRangeFromTargetAndCoord"],"mappings":";;;;;;;AAAA;;AAEA,MAAMA,SAAS,GAAG,GAAlB;AACA,MAAMC,MAAM,GAAG,EAAf;AAEA;AACA;AACA;;AACO,SAASC,kBAAT,CAA4BC,UAA5B,EAAoD;AACzD,QAAM;AAAEC,IAAAA;AAAF,MAAUD,UAAU,CAACE,KAAX,CAAiBC,QAAjC;;AACA,QAAMC,OAAO,GAAGC,sBAASC,iBAAT,CAA2BL,GAA3B,CAAhB;;AACA,MAAI,CAACG,OAAL,EAAc;AACZ,WAAO,IAAP;AACD;;AACD,QAAM;AAAEG,IAAAA,IAAF;AAAQC,IAAAA,GAAR;AAAaC,IAAAA;AAAb,MAAwBL,OAAO,CAACM,qBAAR,EAA9B;AACA,QAAMC,OAAO,GAAGJ,IAAI,GAAGT,MAAvB;AACA,MAAIc,OAAO,GAAGf,SAAd;;AACA,MAAIW,GAAG,GAAGX,SAAV,EAAqB;AACnBe,IAAAA,OAAO,GAAGJ,GAAG,GAAGV,MAAhB;AACD,GAFD,MAEO,IAAIW,MAAM,GAAGZ,SAAb,EAAwB;AAC7Be,IAAAA,OAAO,GAAGH,MAAM,GAAGX,MAAnB;AACD;;AACD,QAAMe,WAAW,GAAGC,MAAM,CAACX,QAAP,CAAgBY,gBAAhB,CAAiCJ,OAAjC,EAA0CC,OAA1C,CAApB;;AACA,MAAI,CAACC,WAAL,EAAkB;AAChB,WAAO,IAAP;AACD;;AACD,SAAOR,sBAASW,4BAAT,CACLH,WADK,EAELF,OAFK,EAGLC,OAHK,EAILZ,UAJK,CAAP;AAMD","sourcesContent":["import { Controller, domUtils } from '@ali/4ever-cangjie';\n\nconst TOP_SPACE = 100;\nconst OFFSET = 10;\n\n/**\n * 获取屏幕顶部的 selection，聚焦的时候避免滚动\n */\nexport function getScreenSelection(controller: Controller) {\n  const { key } = controller.value.document;\n  const docNode = domUtils.findDOMNodeSafely(key);\n  if (!docNode) {\n    return null;\n  }\n  const { left, top, bottom } = docNode.getBoundingClientRect();\n  const clientX = left + OFFSET;\n  let clientY = TOP_SPACE;\n  if (top > TOP_SPACE) {\n    clientY = top + OFFSET;\n  } else if (bottom < TOP_SPACE) {\n    clientY = bottom - OFFSET;\n  }\n  const hitedTarget = window.document.elementFromPoint(clientX, clientY);\n  if (!hitedTarget) {\n    return null;\n  }\n  return domUtils.caretRangeFromTargetAndCoord(\n    hitedTarget,\n    clientX,\n    clientY,\n    controller,\n  );\n}\n"],"file":"getScreenSelection.js"}