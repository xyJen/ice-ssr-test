"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = onKeyDown;

var _everCangjie = require("@ali/4ever-cangjie");

var _isHotkey = require("is-hotkey");

var _constants = require("../constants");

const isBackspaceHotKey = (0, _isHotkey.isKeyHotkey)('backspace');

function onKeyDown(event, controller, next) {
  const {
    document,
    data,
    selection
  } = controller.value;
  const {
    _stickerPanel
  } = data;

  if (_stickerPanel) {
    controller.setData({ ...data,
      _stickerPanel: false
    });
  }

  if (!selection.isCollapsed) {
    return next();
  }

  const {
    anchor
  } = selection;
  const curNode = document.getNode(anchor.key);

  if (isBackspaceHotKey(event)) {
    const prevNode = document.getPreviousNode(anchor.key);
    const isAtStart = curNode && anchor.isAtStartOfNode(curNode); // @ts-ignore

    if (!_everCangjie.environment.IS_MOBILE && isAtStart && prevNode?.type === _constants.STICKER_NODE_TYPE) {
      controller.command(_everCangjie.Commands.moveAnchorBackward, 1);
    }
  }

  return next();
}
//# sourceMappingURL=onKeyDown.js.map