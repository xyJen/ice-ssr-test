{"version":3,"sources":["../../../../../src/plugins/alignment/handlers/onKeyDown.ts"],"names":["isAlignLeftHotKey","isAlignCenterHotkey","isAlignRightHotkey","isAlignJustifyHotkey","onKeyDown","event","controller","next","value","hotkeys","isDeleteBackward","currentParagraph","data","selection","startBlock","isDeleteAtFirstChar","isCollapsed","anchor","isAtStartOfNode","isNewLineFirstChar","preventDefault"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AAGA,MAAMA,iBAAiB,GAAG,uBAAY,aAAZ,CAA1B;AACA,MAAMC,mBAAmB,GAAG,uBAAY,aAAZ,CAA5B;AACA,MAAMC,kBAAkB,GAAG,uBAAY,aAAZ,CAA3B;AACA,MAAMC,oBAAoB,GAAG,uBAAY,aAAZ,CAA7B;;AAEe,SAASC,SAAT,CAAmBC,KAAnB,EAA+CC,UAA/C,EAAuEC,IAAvE,EAAuF;AACpG,QAAM;AAAEC,IAAAA;AAAF,MAAYF,UAAlB;AACA;;AACA,MAAIG,qBAAQC,gBAAR,CAAyBL,KAAzB,CAAJ,EAAqC;AACnC,UAAMM,gBAAgB,GAAG,oCAAoBH,KAApB,CAAzB;;AACA,QAAI,CAACG,gBAAD,IAAqB,wBAAQA,gBAAgB,CAACC,IAAzB,EAA+B,IAA/B,EAAqC,MAArC,MAAiD,MAA1E,EAAkF;AAChF,aAAOL,IAAI,EAAX;AACD;;AAED,UAAM;AAAEM,MAAAA,SAAF;AAAaC,MAAAA;AAAb,QAA4BN,KAAlC;AACA,UAAMO,mBAAmB,GAAGF,SAAS,CAACG,WAAV,IACvBH,SAAS,CAACI,MAAV,CAAiBC,eAAjB,CAAiCP,gBAAjC,CADL;AAEA,UAAMQ,kBAAkB,GAAGN,SAAS,CAACG,WAAV,IACtBH,SAAS,CAACI,MAAV,CAAiBC,eAAjB,CAAiCJ,UAAjC,CADL;AAGA,QAAI,CAACC,mBAAD,IAAwB,CAACI,kBAA7B,EAAiD,OAAOZ,IAAI,EAAX;;AACjD,QAAIQ,mBAAJ,EAAyB;AACvB,aAAO,2BAAaT,UAAb,EAAyB,MAAzB,CAAP;AACD;AACF;;AAED,MAAIN,iBAAiB,CAACK,KAAD,CAArB,EAA8B;AAC5BA,IAAAA,KAAK,CAACe,cAAN;AACA,WAAO,2BAAad,UAAb,EAAyB,MAAzB,CAAP;AACD;;AACD,MAAIL,mBAAmB,CAACI,KAAD,CAAvB,EAAgC;AAC9BA,IAAAA,KAAK,CAACe,cAAN;AACA,WAAO,2BAAad,UAAb,EAAyB,QAAzB,CAAP;AACD;;AACD,MAAIJ,kBAAkB,CAACG,KAAD,CAAtB,EAA+B;AAC7BA,IAAAA,KAAK,CAACe,cAAN;AACA,WAAO,2BAAad,UAAb,EAAyB,OAAzB,CAAP;AACD;;AACD,MAAIH,oBAAoB,CAACE,KAAD,CAAxB,EAAiC;AAC/BA,IAAAA,KAAK,CAACe,cAAN;AACA,WAAO,2BAAad,UAAb,EAAyB,SAAzB,CAAP;AACD;;AAED,SAAOC,IAAI,EAAX;AACD","sourcesContent":["import { hotkeys, Controller } from '@ali/4ever-cangjie';\nimport isKeyHotkey from 'is-hotkey';\nimport setAlignment from '../commands/setAlignment';\nimport { getClosestParagraph } from '@ali/4ever-utils';\nimport { getData } from '@ali/4ever-utils';\n\nconst isAlignLeftHotKey = isKeyHotkey('mod+shift+l');\nconst isAlignCenterHotkey = isKeyHotkey('mod+shift+e');\nconst isAlignRightHotkey = isKeyHotkey('mod+shift+r');\nconst isAlignJustifyHotkey = isKeyHotkey('mod+shift+j');\n\nexport default function onKeyDown(event: React.KeyboardEvent, controller: Controller, next: Function) {\n  const { value } = controller;\n  /* 在行首backspace/delete撤销对齐 */\n  if (hotkeys.isDeleteBackward(event)) {\n    const currentParagraph = getClosestParagraph(value);\n    if (!currentParagraph || getData(currentParagraph.data, 'jc', 'left') === 'left') {\n      return next();\n    }\n\n    const { selection, startBlock } = value;\n    const isDeleteAtFirstChar = selection.isCollapsed\n      && selection.anchor.isAtStartOfNode(currentParagraph);\n    const isNewLineFirstChar = selection.isCollapsed\n      && selection.anchor.isAtStartOfNode(startBlock);\n\n    if (!isDeleteAtFirstChar && !isNewLineFirstChar) return next();\n    if (isDeleteAtFirstChar) {\n      return setAlignment(controller, 'left');\n    }\n  }\n\n  if (isAlignLeftHotKey(event)) {\n    event.preventDefault();\n    return setAlignment(controller, 'left');\n  }\n  if (isAlignCenterHotkey(event)) {\n    event.preventDefault();\n    return setAlignment(controller, 'center');\n  }\n  if (isAlignRightHotkey(event)) {\n    event.preventDefault();\n    return setAlignment(controller, 'right');\n  }\n  if (isAlignJustifyHotkey(event)) {\n    event.preventDefault();\n    return setAlignment(controller, 'justify');\n  }\n\n  return next();\n}\n"],"file":"onKeyDown.js"}