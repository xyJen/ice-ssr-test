{"version":3,"sources":["../../../../../src/plugins/hr/handlers/onKeyDown.ts"],"names":["isEnterHotkey","REGEXP_HR","onKeyDown","event","controller","next","value","selection","isExpanded","anchor","isTextPoint","startBlock","chars","text","slice","offset","replace","isOnlyHrSymbolParagraph","block","type","data","ind","left","list","Text","isTextList","nodes","test","preventDefault","command","Commands","moveFocusToStartOfBlock","del","insertHr","dispatch","mdType"],"mappings":";;;;;;;;;AACA;;AACA;;AACA;;AAEA,MAAMA,aAAa,GAAG,2BAAY,OAAZ,CAAtB;AAEA;AACA;AACA;AACA;AACA;;AACA,MAAMC,SAAS,GAAG,kBAAlB;;AAEe,SAASC,SAAT,CACbC,KADa,EAEbC,UAFa,EAGbC,IAHa,EAIb;AACA,QAAM;AAAEC,IAAAA;AAAF,MAAYF,UAAlB;AACA,QAAM;AAAEG,IAAAA;AAAF,MAAgBD,KAAtB;AAEA,MAAI,CAACC,SAAL,EAAgB,OAAOF,IAAI,EAAX;AAChB,MAAIE,SAAS,CAACC,UAAd,EAA0B,OAAOH,IAAI,EAAX;;AAE1B,MAAIL,aAAa,CAACG,KAAD,CAAb,IAAwBI,SAAS,CAACE,MAAV,CAAiBC,WAAjB,EAA5B,EAA4D;AAC1D,UAAM;AAAEC,MAAAA;AAAF,QAAiBL,KAAvB;AACA,QAAI,CAACK,UAAL,EAAiB,OAAON,IAAI,EAAX;AAEjB,UAAMO,KAAK,GAAGD,UAAU,CAACE,IAAX,CACXC,KADW,CACL,CADK,EACFP,SAAS,CAACE,MAAV,CAAiBM,MADf,EAEXC,OAFW,CAEH,MAFG,EAEK,EAFL,CAAd;;AAIA,UAAMC,uBAAuB,GAAIC,KAAD,IAAiB;AAC/C,aAAOA,KAAK,CAACC,IAAN,KAAe,WAAf,KACH,CAACD,KAAK,CAACE,IAAN,CAAWC,GAAZ,IAAmBH,KAAK,CAACE,IAAN,CAAWC,GAAX,CAAeC,IAAf,KAAwB,CADxC,KAEJ,CAACJ,KAAK,CAACE,IAAN,CAAWG,IAFR,IAGJC,kBAAKC,UAAL,CAAgBP,KAAK,CAACQ,KAAtB,CAHI,IAIJzB,SAAS,CAAC0B,IAAV,CAAef,KAAf,CAJH;AAKD,KAND;;AAQA,QAAIK,uBAAuB,CAACN,UAAD,CAA3B,EAAyC;AACvCR,MAAAA,KAAK,CAACyB,cAAN;AACAxB,MAAAA,UAAU,CACPyB,OADH,CACWC,sBAASC,uBADpB,EAEGF,OAFH,CAEWC,sBAASE,GAFpB,EAGGH,OAHH,CAGWI,iBAHX;AAIA,aAAO7B,UAAU,CAAC8B,QAAX,CAAoB,6BAApB,EAAmD;AAAEC,QAAAA,MAAM,EAAE;AAAV,OAAnD,CAAP;AACD;AACF;;AACD,SAAO9B,IAAI,EAAX;AACD","sourcesContent":["import * as React from 'react';\nimport { Controller, Commands, Block, Text, environment } from '@ali/4ever-cangjie';\nimport { isKeyHotkey } from 'is-hotkey';\nimport insertHr from '../commands/insertHr';\n\nconst isEnterHotkey = isKeyHotkey('enter');\n\n/**\n * 1. 三个及以上 「 * 」\n * 2. 三个及以上 「 - 」\n * 3. 三个及以上 「 — 」 (中文 shift + -, 半个破折号, 与 2 不同)\n */\nconst REGEXP_HR = /^(\\*|-|—)\\1{2,}$/;\n\nexport default function onKeyDown(\n  event: React.KeyboardEvent,\n  controller: Controller,\n  next: () => void,\n) {\n  const { value } = controller;\n  const { selection } = value;\n\n  if (!selection) return next();\n  if (selection.isExpanded) return next();\n\n  if (isEnterHotkey(event) && selection.anchor.isTextPoint()) {\n    const { startBlock } = value;\n    if (!startBlock) return next();\n\n    const chars = startBlock.text\n      .slice(0, selection.anchor.offset)\n      .replace(/\\s*/g, '');\n\n    const isOnlyHrSymbolParagraph = (block: Block) =>{\n      return block.type === 'paragraph'\n      && (!block.data.ind || block.data.ind.left === 0)\n      && !block.data.list\n      && Text.isTextList(block.nodes)\n      && REGEXP_HR.test(chars)\n    };\n\n    if (isOnlyHrSymbolParagraph(startBlock)) {\n      event.preventDefault();\n      controller\n        .command(Commands.moveFocusToStartOfBlock)\n        .command(Commands.del)\n        .command(insertHr);\n      return controller.dispatch('createTriggerMarkdownAction', { mdType: 'hr' });\n    }\n  }\n  return next();\n}\n"],"file":"onKeyDown.js"}