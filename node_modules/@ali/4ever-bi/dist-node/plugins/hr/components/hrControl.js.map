{"version":3,"sources":["../../../../../src/plugins/hr/components/hrControl.tsx"],"names":["height","themeHeight","theme","hr","HrWrapper","styled","div","props","isActive","HrControl","React","Component","constructor","handleMouseMove","e","preventDefault","stopPropagation","gap","X","clientX","originX1","length","originX2","offsetX","flag","state","finalLen","Math","abs","diffX","setState","onHrChange","editor","node","handleMouseUp","document","removeEventListener","handleMouseDown","target","ReactDOM","findDOMNode","targetDomInfo","getBoundingClientRect","x","width","addEventListener","payload","render","children","isSelected","attributes","marginLeft"],"mappings":";;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;uBAF4B,a;AAI5B;AACA,MAAM;AAAEA,EAAAA,MAAM,EAAEC;AAAV,IAA0BC,kBAAMC,EAAtC,C,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA,MAAMC,SAAS,gBAAGC,0BAAOC,GAAV,6JAIQC,KAAD,IAAiBA,KAAK,CAACC,QAAN,GAAiB,SAAjB,GAA6B,EAJrD,CAAf;;AAoCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEe,MAAMC,SAAN,SAAwBC,KAAK,CAACC,SAA9B,CAA0E;AACvFC,EAAAA,WAAW,CAACL,KAAD,EAAQ;AACjB,UAAMA,KAAN;;AADiB,SAiBnBM,eAjBmB,GAiBAC,CAAD,IAAO;AACvBA,MAAAA,CAAC,CAACC,cAAF;AACAD,MAAAA,CAAC,CAACE,eAAF;AACA,YAAMC,GAAG,GAAG,EAAZ;AACA,YAAMC,CAAC,GAAGJ,CAAC,CAACK,OAAZ;AACA,YAAM;AACJC,QAAAA,QADI;AACMC,QAAAA,MADN;AACcC,QAAAA,QADd;AACwBC,QAAAA,OADxB;AACiCC,QAAAA;AADjC,UAEF,KAAKC,KAFT;AAGA,UAAI,CAACD,IAAL,EAAW;AACX,UAAIE,QAAgB,GAAGL,MAAvB;;AACA,UAAIG,IAAI,KAAK,IAAb,EAAmB;AACjB,YAAIG,IAAI,CAACC,GAAL,CAASV,CAAC,GAAGE,QAAb,IAAyBH,GAAzB,IAAiCK,QAAQ,GAAGJ,CAAZ,GAAiBD,GAArD,EAA0D;AACxD,gBAAMY,KAAK,GAAGX,CAAC,GAAGE,QAAlB;AACAM,UAAAA,QAAQ,GAAGJ,QAAQ,GAAGJ,CAAtB;AACA,eAAKY,QAAL,CAAc;AACZV,YAAAA,QAAQ,EAAEF,CADE;AAEZK,YAAAA,OAAO,EAAEM,KAAK,GAAGN,OAFL;AAGZF,YAAAA,MAAM,EAAEK;AAHI,WAAd;AAKD;AACF;;AACD,UAAIF,IAAI,KAAK,IAAb,EAAmB;AACjB,YAAIG,IAAI,CAACC,GAAL,CAASV,CAAC,GAAGI,QAAb,IAAyBL,GAAzB,IAAiCC,CAAC,GAAGE,QAAL,GAAiBH,GAArD,EAA0D;AACxDS,UAAAA,QAAQ,GAAGR,CAAC,GAAGE,QAAf;AACA,eAAKU,QAAL,CAAc;AACZR,YAAAA,QAAQ,EAAEJ,CADE;AAEZG,YAAAA,MAAM,EAAEK;AAFI,WAAd;AAID;AACF;;AACD,YAAM;AAAEK,QAAAA,UAAU,GAAG,MAAM,CAAG,CAAxB;AAA0BC,QAAAA,MAA1B;AAAkCC,QAAAA;AAAlC,UAA2C,KAAK1B,KAAtD;AACAwB,MAAAA,UAAU,CAACC,MAAD,EAASC,IAAT,EAAe;AAAEZ,QAAAA,MAAM,EAAEK;AAAV,OAAf,CAAV;AACD,KAjDkB;;AAAA,SAsDnBQ,aAtDmB,GAsDFpB,CAAD,IAAO;AACrBA,MAAAA,CAAC,CAACC,cAAF;AACAD,MAAAA,CAAC,CAACE,eAAF,GAFqB,CAGrB;;AACAmB,MAAAA,QAAQ,CAACC,mBAAT,CAA6B,WAA7B,EAA0C,KAAKvB,eAA/C;AACAsB,MAAAA,QAAQ,CAACC,mBAAT,CAA6B,SAA7B,EAAwC,KAAKF,aAA7C;AACD,KA5DkB;;AAAA,SA8DnBG,eA9DmB,GA8DD,CAACvB,CAAD,EAAIU,IAAJ,KAAa;AAC7BV,MAAAA,CAAC,CAACC,cAAF;AACAD,MAAAA,CAAC,CAACE,eAAF,GAF6B,CAG7B;AACA;;AACA,YAAMsB,MAAW,GAAGC,QAAQ,CAACC,WAAT,CAAqB,IAArB,CAApB;AACA,YAAMC,aAAa,GAAGH,MAAM,CAACI,qBAAP,EAAtB;AACA,YAAM;AAAEC,QAAAA,CAAF;AAAKC,QAAAA;AAAL,UAAeH,aAArB;AACA,WAAKX,QAAL,CAAc;AACZV,QAAAA,QAAQ,EAAEuB,CADE;AAEZrB,QAAAA,QAAQ,EAAEqB,CAAC,GAAGC,KAFF;AAGZpB,QAAAA;AAHY,OAAd;AAMAW,MAAAA,QAAQ,CAACU,gBAAT,CAA0B,WAA1B,EAAuC,KAAKhC,eAA5C;AACAsB,MAAAA,QAAQ,CAACU,gBAAT,CAA0B,SAA1B,EAAqC,KAAKX,aAA1C;AACD,KA9EkB;;AAEjB,UAAM;AAAEY,MAAAA,OAAO,GAAG;AAAZ,QAAmBvC,KAAzB;AACA,UAAM;AAAEc,MAAAA,MAAM,EAANA;AAAF,QAAayB,OAAnB;AACA,SAAKrB,KAAL,GAAa;AACXJ,MAAAA,MAAM,EAANA,OADW;AAEXD,MAAAA,QAAQ,EAAE,CAFC;AAEE;AACbE,MAAAA,QAAQ,EAAE,CAHC;AAGE;AACbC,MAAAA,OAAO,EAAE,CAJE;AAKXC,MAAAA,IAAI,EAAE,EALK,CAKD;;AALC,KAAb;AAOD;AAED;AACF;AACA;AACA;;;AAgEEuB,EAAAA,MAAM,GAAG;AACP,UAAM;AAAEC,MAAAA,QAAF;AAAYC,MAAAA,UAAZ;AAAwBC,MAAAA;AAAxB,QAAuC,KAAK3C,KAAlD;AACA,UAAM;AAAEgB,MAAAA;AAAF,QAAc,KAAKE,KAAzB;AACA,wBACE,eAAC,SAAD;AACE,qBAAY,cADd;AAEE,MAAA,QAAQ,EAAEwB,UAFZ;AAGE,MAAA,KAAK,EAAE;AACLjD,QAAAA,MAAM,EAAG,GAAEC,WAAY,IADlB;AAELkD,QAAAA,UAAU,EAAG,GAAE5B,OAAQ;AAFlB,OAHT;AAOE,mBAAU;AAPZ,OAQM2B,UARN,GAWGF,QAXH,CADF;AAgBD;;AApGsF","sourcesContent":["import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport styled from 'styled-components';\nimport { theme } from '@ali/4ever-bamboo';\n\n// HACK: Pi2.0 要求插件尺寸与实际渲染必须保持一致，未来应该对 hr 类型做个映射 @统领\nconst { height: themeHeight } = theme.hr;\n\n// const ControlPoint = styled.div`\n//   width: 14px;\n//   height: 14px;\n//   box-sizing: border-box;\n//   background: #fff;\n//   position: absolute;\n//   border-radius: 50%;\n//   border: 1px solid #ddd;\n//   display: ${(props: any) => (props.isActive ? 'visible' : 'none')};\n//   &::after {\n//     width: 8px;\n//     height: 8px;\n//     position: absolute;\n//     border-radius: 50%;\n//     top: 2px;\n//     left: 2px;\n//     background: #3d8df3;\n//     content: '';\n//     cursor: ew-resize;\n//   }\n// `;\n\n// TODO fit-content\nconst HrWrapper = styled.div`\n  position: relative;\n  width: 100%;\n  padding: 5px 0; \n  background-color: ${(props: any) => (props.isActive ? '#f4f4f4' : '')};\n  &:hover {\n    background-color: #f4f4f4;\n  };\n  display: flex;\n  align-items: center;\n  & div {\n    width: 100%;\n  }\n`;\n\n\ninterface IHrControlProps {\n  onHrChange: any;\n  isSelected?: boolean;\n  length?: number;\n  color?: string;\n  lineStyle?: string;\n  editor?: any;\n  node?: any;\n  attributes: any;\n}\n\ninterface IHrControlState {\n  length: number;\n  originX1: number;\n  originX2: number;\n  offsetX: number;\n  flag: string; // 判断控制前一个控制点还是后一个\n}\n\n\n/**\n * top: 自身高度除去border / 2\n * left: 自身宽度 / 2\n */\n// const ControlPointStart = styled(ControlPoint)`\n//   position: absolute;\n//   top: 6px;\n//   left: -7px;\n// `;\n\n// const ControlPointEnd = styled(ControlPoint)`\n//   position: absolute;\n//   top: 6px;\n//   right: -7px;\n// `;\n\nexport default class HrControl extends React.Component<IHrControlProps, IHrControlState> {\n  constructor(props) {\n    super(props);\n    const { payload = {} } = props;\n    const { length } = payload;\n    this.state = {\n      length,\n      originX1: 0, // start point\n      originX2: 0, // end point\n      offsetX: 0,\n      flag: '', // 操作是左边还是右边\n    };\n  }\n\n  /**\n   * 移动算法, 计算startPoint 和 length, 即可获得具体位置\n   * TODO 需要加入边界范围\n   */\n  handleMouseMove = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const gap = 10;\n    const X = e.clientX;\n    const {\n      originX1, length, originX2, offsetX, flag,\n    } = this.state;\n    if (!flag) return;\n    let finalLen: number = length;\n    if (flag === 'st') {\n      if (Math.abs(X - originX1) > gap && (originX2 - X) > gap) {\n        const diffX = X - originX1;\n        finalLen = originX2 - X;\n        this.setState({\n          originX1: X,\n          offsetX: diffX + offsetX,\n          length: finalLen,\n        });\n      }\n    }\n    if (flag === 'et') {\n      if (Math.abs(X - originX2) > gap && (X - originX1) > gap) {\n        finalLen = X - originX1;\n        this.setState({\n          originX2: X,\n          length: finalLen,\n        });\n      }\n    }\n    const { onHrChange = () => { }, editor, node } = this.props;\n    onHrChange(editor, node, { length: finalLen });\n  };\n\n  /**\n   * 回掉设置值\n   */\n  handleMouseUp = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    // TODO 建议鼠标收起再赋值\n    document.removeEventListener('mousemove', this.handleMouseMove);\n    document.removeEventListener('mouseup', this.handleMouseUp);\n  };\n\n  handleMouseDown = (e, flag) => {\n    e.preventDefault();\n    e.stopPropagation();\n    // // 处理逻辑\n    // eslint-disable-next-line react/no-find-dom-node\n    const target: any = ReactDOM.findDOMNode(this);\n    const targetDomInfo = target.getBoundingClientRect();\n    const { x, width } = targetDomInfo;\n    this.setState({\n      originX1: x,\n      originX2: x + width,\n      flag,\n    });\n\n    document.addEventListener('mousemove', this.handleMouseMove);\n    document.addEventListener('mouseup', this.handleMouseUp);\n  };\n\n  render() {\n    const { children, isSelected, attributes } = this.props;\n    const { offsetX } = this.state;\n    return (\n      <HrWrapper\n        data-testid=\"horizon-line\"\n        isActive={isSelected}\n        style={{\n          height: `${themeHeight}px`,\n          marginLeft: `${offsetX}px`,\n        }}\n        data-type=\"hr\"\n        {...attributes}\n      >\n        {/* <ControlPointStart isActive={isSelected} onMouseDown={(e) => this.handleMouseDown(e, 'st')} onMouseUp={this.handleMouseUp} /> */}\n        {children}\n        {/* <ControlPointEnd isActive={isSelected} onMouseDown={(e) => this.handleMouseDown(e, 'et')} onMouseUp={this.handleMouseUp} /> */}\n      </HrWrapper>\n    );\n  }\n}\n"],"file":"hrControl.js"}