{"version":3,"sources":["../../../../../src/plugins/formatPainter/handlers/onMouseUp.ts"],"names":["onMouseUp","_","controller","next","value","tableSelection","query","formatClipboard","data","trigger","selection","range","isCollapsed","document","paragraph","getClosest","getStart","key","isParagraphBlock","moveToRangeOfNode"],"mappings":";;;;;;;;;AACA;;AACA;;AAEe,SAASA,SAAT,CAAmBC,CAAnB,EAAsBC,UAAtB,EAA8CC,IAA9C,EAAoD;AACjE,QAAM;AAAEC,IAAAA;AAAF,MAAYF,UAAlB;AACA,QAAMG,cAAc,GAAGH,UAAU,CAACI,KAAX,CAAiB,mBAAjB,CAAvB;;AACA,MAAID,cAAJ,EAAoB;AAClB,WAAOF,IAAI,EAAX;AACD;;AAED,QAAMI,eAAe,GAAGH,KAAK,CAACI,IAAN,CAAWD,eAAnC;;AACA,MAAI,CAACA,eAAD,IAAoBA,eAAe,CAACE,OAAhB,KAA4B,SAApD,EAA+D;AAC7D,WAAON,IAAI,EAAX;AACD,GAVgE,CAYjE;;;AACA,MAAI;AAAEO,IAAAA,SAAS,EAAEC;AAAb,MAAuBP,KAA3B;;AACA,MAAIO,KAAK,CAACC,WAAV,EAAuB;AACrB,UAAM;AAAEC,MAAAA;AAAF,QAAeT,KAArB;AACA,UAAMU,SAAS,GAAGD,QAAQ,CAACE,UAAT,CAAoBJ,KAAK,CAACK,QAAN,CAAeH,QAAf,EAAyBI,GAA7C,EAAkDC,yBAAlD,CAAlB;;AACA,QAAI,CAACJ,SAAL,EAAgB;AACd,aAAOX,IAAI,EAAX;AACD,KALoB,CAMrB;;;AACAQ,IAAAA,KAAK,GAAGA,KAAK,CAACQ,iBAAN,CAAwBL,SAAxB,EAAmCZ,UAAnC,CAAR;AACD;;AAED,SAAO,iCAAmBA,UAAnB,EAA+BS,KAA/B,CAAP;AACD","sourcesContent":["import { Controller } from '@ali/4ever-cangjie';\nimport pasteFormatAtRange from '../commands/pasteFormatAtRange';\nimport isParagraphBlock from '../utils/isParagraphBlock';\n\nexport default function onMouseUp(_, controller: Controller, next) {\n  const { value } = controller;\n  const tableSelection = controller.query('hasTableSelection');\n  if (tableSelection) {\n    return next();\n  }\n\n  const formatClipboard = value.data.formatClipboard;\n  if (!formatClipboard || formatClipboard.trigger !== 'toolbar') {\n    return next();\n  }\n\n  // NOTE: Do not need `event.preventDefault()`.\n  let { selection: range } = value;\n  if (range.isCollapsed) {\n    const { document } = value;\n    const paragraph = document.getClosest(range.getStart(document).key, isParagraphBlock);\n    if (!paragraph) {\n      return next();\n    }\n    // TODO: 这里直接将整段都格式化，office上是仅格式化分段\n    range = range.moveToRangeOfNode(paragraph, controller);\n  }\n\n  return pasteFormatAtRange(controller, range);\n}\n"],"file":"onMouseUp.js"}