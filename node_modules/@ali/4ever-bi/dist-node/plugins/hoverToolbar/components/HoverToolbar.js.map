{"version":3,"sources":["../../../../../src/plugins/hoverToolbar/components/HoverToolbar.tsx"],"names":["useActiveInteraction","ActiveInteractionHooks","HoverToolbar","props","controller","configs","plugins","zoomContainer","scrollableContainer","hoverCapture","zoom","currentNode","React","useRef","singleToolbar","setSingleToolbar","useState","wrapperRef","toolbarWidth","inOuterContainer","setInOuterContainer","inOuterContainerRef","innerContainer","window","document","body","outerContainer","Element","container","visiblePopoverSetRef","Set","needSlidInRef","isVisible","setVisible","content","activeType","setActiveType","activeRef","current","currentKey","setCurrentKey","showHoverToolbar","length","locale","useEffect","enableTrigger","style","opacity","reset","useCallback","clear","undefined","forceClose","updatePos","node","nodeDOM","domUtils","findDOMNodeSafely","key","newStyle","position","nodeRect","getBoundingClientRect","contentRect","containerRect","Window","x","y","width","innerWidth","height","innerHeight","nodeX","nodeY","nodeW","nodeH","containerY","containerH","contentX","contentY","contentWidth","contentW","offsetWidth","SAFE_CONTAINER_MARGIN_TOP","SAFE_NODE_MARGIN_TOP","HOVER_TOOLBAR_HEIGHT","top","classList","remove","HOVER_TOOLBAR_NOT_READY","SAFE_CONTAINER_MARGIN_RIGHT_OR_LEFT","left","toString","contains","add","HOVER_TOOLBAR_SLIDE_IN","noop","handleResize","newWidth","observer","ResizeObserver","observe","disconnect","cancel","handleChange","mutationObserver","MutationObserver","childList","subtree","attributes","attributeFilter","getContainer","handleTrigger","msg","currentLayout","layoutConfigs","layouts","visiblePopoverSet","setActiveInteraction","on","off","handleScroll","SCROLL_TIMEOUT","addEventListener","removeEventListener","handleMouseEnter","getCurrentNode","Block","isBlock","Inline","isInline","dispatch","type","reason","handleMouseLeave","handleAnimationEnd","event","target","PluginRoles","hoverToolbar","padding"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { debounce, noop, throttle } from 'lodash-es';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport { ToolbarLayout, IToolbarLayoutProps } from '@ali/we-design-next';\nimport { Controller, Node, useZoomContainer, useZoom, domUtils, Block, Inline } from '@ali/4ever-cangjie';\nimport { useScrollableContainer, useScrollableContent, PluginRoles } from '@ali/4ever-bamboo';\nimport { HoverToolbarContexts, ActiveInteractionHooks, BasicPortal as Portal } from '@ali/4ever-component';\nimport { usePlugins } from '../../../pluginsContext';\nimport { useHoverCapture } from '../context/hoverCaptureContext';\nimport { HoverCapture, ICallback } from '../utils/hoverCapture';\nimport { IHoverToolbarPluginConfigs } from '../types';\nimport { HOVER_TOOLBAR_HEIGHT, SAFE_CONTAINER_MARGIN_TOP, SAFE_NODE_MARGIN_TOP, SAFE_CONTAINER_MARGIN_RIGHT_OR_LEFT, SCROLL_TIMEOUT } from '../constants';\nimport { getHoverToolbarLayout } from './getHoverToolbarLayout';\nimport { HoverToolbarWrapper, HOVER_TOOLBAR_NOT_READY, HOVER_TOOLBAR_SLIDE_IN } from './styled';\n\ntype ISingLineItems = IToolbarLayoutProps['singleLineToolbar'];\nconst { useActiveInteraction } = ActiveInteractionHooks;\n\nexport interface IHoverToolbarProps {\n  controller: Controller;\n  configs: IHoverToolbarPluginConfigs;\n}\n\nexport const HoverToolbar: React.FC<IHoverToolbarProps> = ((props) => {\n  const { controller, configs } = props;\n  const plugins = usePlugins();\n  const zoomContainer = useZoomContainer();\n  const scrollableContainer = useScrollableContainer();\n  const hoverCapture = useHoverCapture();\n  const zoom = useZoom();\n  const currentNode = React.useRef<Node | null>(null);\n  const [singleToolbar, setSingleToolbar] = React.useState<ISingLineItems>();\n  const wrapperRef = React.useRef<HTMLDivElement>(null);\n  const toolbarWidth = React.useRef<number>(0);\n  const [inOuterContainer, setInOuterContainer] = React.useState(false);\n  const inOuterContainerRef = React.useRef(false);\n  const innerContainer = zoomContainer || window.document.body;\n  const outerContainer = scrollableContainer instanceof Element ? scrollableContainer : window.document.body;\n  const container = inOuterContainer ? outerContainer : innerContainer;\n  const visiblePopoverSetRef = React.useRef<Set<string>>(new Set());\n  const needSlidInRef = React.useRef<boolean>(false);\n  const [isVisible, setVisible] = React.useState(false);\n  const content = useScrollableContent();\n  const [activeType, setActiveType] = useActiveInteraction();\n  const activeRef = React.useRef('');\n  activeRef.current = activeType;\n  const [currentKey, setCurrentKey] = React.useState('');\n\n  const showHoverToolbar = singleToolbar && singleToolbar.length > 0;\n\n  inOuterContainerRef.current = inOuterContainer;\n  const locale = configs.locale || {};\n\n  React.useEffect(() => {\n    // inOuterContainer 更新时浮动工具栏会重新渲染\n    hoverCapture?.enableTrigger();\n    if (wrapperRef.current) {\n      wrapperRef.current.style.opacity = '1';\n    }\n  }, [inOuterContainer, hoverCapture]);\n\n  const reset = React.useCallback(() => {\n    visiblePopoverSetRef.current.clear();\n    hoverCapture?.enableTrigger();\n    setSingleToolbar(undefined);\n    toolbarWidth.current = 0;\n  }, [hoverCapture]);\n\n  React.useEffect(() => {\n    if (activeType && activeType !== 'hoverToolbarPopover') {\n      hoverCapture?.forceClose();\n      reset();\n    }\n  }, [activeType, hoverCapture]);\n\n  const updatePos = React.useCallback(() => {\n    const node = currentNode.current;\n    if (node && wrapperRef.current) {\n      if (toolbarWidth.current === 0) {\n        wrapperRef.current.style.opacity = '0';\n        return;\n      }\n      const nodeDOM = domUtils.findDOMNodeSafely(node.key, innerContainer);\n      if (nodeDOM) {\n        const newStyle: React.CSSProperties = {\n          position: 'absolute',\n        };\n        const nodeRect = nodeDOM.getBoundingClientRect();\n        const contentRect = innerContainer.getBoundingClientRect();\n        const containerRect = !scrollableContainer || scrollableContainer instanceof Window\n          ? { x: 0, y: 0, width: window.innerWidth, height: window.innerHeight }\n          : scrollableContainer.getBoundingClientRect();\n        const { x: nodeX, y: nodeY, width: nodeW, height: nodeH } = nodeRect;\n        const { y: containerY, height: containerH } = containerRect;\n        const { x: contentX, y: contentY, width: contentWidth } = contentRect;\n        const contentW = contentWidth || innerContainer.offsetWidth * zoom;\n        // 滚动的时候 contentWidth 可能为 0，会产生抖动\n        if (contentWidth === 0) {\n          return;\n        }\n        // 元素滚出下边缘\n        if (nodeY > containerY + containerH) {\n          newStyle.opacity = '0';\n          setVisible(false);\n          // 元素上边缘与滚动容器之间的距离足够固定安全距离 + 自适应安全距离 + 工具栏高度, 相对于纸张\n        } else if (nodeY >= containerY + (SAFE_CONTAINER_MARGIN_TOP + SAFE_NODE_MARGIN_TOP + HOVER_TOOLBAR_HEIGHT) * zoom) {\n          const top = (nodeY - contentY) / zoom - SAFE_NODE_MARGIN_TOP - HOVER_TOOLBAR_HEIGHT;\n          newStyle.top = top;\n          if (inOuterContainerRef.current) {\n            setInOuterContainer(false);\n            newStyle.opacity = '0';\n          } else {\n            newStyle.opacity = '1';\n            wrapperRef.current.classList.remove(HOVER_TOOLBAR_NOT_READY);\n          }\n          setVisible(true);\n          // 工具栏上边缘与容器上边缘距离固定, 相对于window\n        } else if ((nodeY + nodeH) >= containerY + (SAFE_CONTAINER_MARGIN_TOP + HOVER_TOOLBAR_HEIGHT) * zoom) {\n          const top = containerY + SAFE_CONTAINER_MARGIN_TOP * zoom + (zoom - 1) * HOVER_TOOLBAR_HEIGHT / 2;\n          newStyle.top = top;\n          newStyle.position = 'fixed';\n          if (!inOuterContainerRef.current) {\n            setInOuterContainer(true);\n            newStyle.opacity = '0';\n          } else {\n            newStyle.opacity = '1';\n            wrapperRef.current.classList.remove(HOVER_TOOLBAR_NOT_READY);\n          }\n          setVisible(true);\n          // 元素下边缘与滚动容器上边缘之间的距离不能容纳 工具栏高度 + 最小安全距离\n        } else {\n          setVisible(false);\n          newStyle.opacity = '0';\n        }\n        // 居中后左侧放不下\n        if (nodeX + nodeW / 2 - toolbarWidth.current * zoom / 2 - SAFE_CONTAINER_MARGIN_RIGHT_OR_LEFT * zoom < contentX) {\n          if (inOuterContainerRef.current) {\n            newStyle.left = SAFE_CONTAINER_MARGIN_RIGHT_OR_LEFT * zoom + contentX;\n          } else {\n            newStyle.left = SAFE_CONTAINER_MARGIN_RIGHT_OR_LEFT;\n          }\n        } else if (nodeX + nodeW / 2 - toolbarWidth.current * zoom / 2 - SAFE_CONTAINER_MARGIN_RIGHT_OR_LEFT * zoom >= contentX && nodeX + nodeW / 2 + toolbarWidth.current * zoom / 2 + SAFE_CONTAINER_MARGIN_RIGHT_OR_LEFT * zoom <= contentX + contentW) {\n          if (inOuterContainerRef.current) {\n            newStyle.left = nodeX + nodeW / 2 - toolbarWidth.current / 2;\n          } else {\n            newStyle.left = (nodeX + nodeW / 2 - toolbarWidth.current / 2 * zoom - contentX) / zoom;\n          }\n        } else if (inOuterContainerRef.current) {\n          newStyle.left = contentX + contentW - SAFE_CONTAINER_MARGIN_RIGHT_OR_LEFT * zoom;\n        } else {\n          newStyle.left = (contentX + contentW) / zoom - SAFE_CONTAINER_MARGIN_RIGHT_OR_LEFT;\n        }\n        if (!wrapperRef.current) {\n          hoverCapture?.forceClose();\n          return;\n        }\n        wrapperRef.current.style.top = `${newStyle.top || 0}px`;\n        wrapperRef.current.style.left = `${newStyle.left || 0}px`;\n        wrapperRef.current.style.opacity = (newStyle.opacity || 0).toString();\n        wrapperRef.current.style.position = newStyle.position || 'absolute';\n        if (needSlidInRef.current && !wrapperRef.current.classList.contains(HOVER_TOOLBAR_NOT_READY)) {\n          wrapperRef.current.classList.add(HOVER_TOOLBAR_SLIDE_IN);\n        }\n      } else {\n        hoverCapture?.forceClose();\n      }\n    }\n  }, [zoom, scrollableContainer, innerContainer, hoverCapture]);\n\n  React.useEffect(() => {\n    if (!singleToolbar) return noop;\n    const handleResize = debounce(() => {\n      const newWidth = wrapperRef.current?.offsetWidth || 0;\n      if (toolbarWidth.current !== newWidth) {\n        toolbarWidth.current = newWidth;\n        updatePos();\n      }\n    }, 200);\n    const observer = new ResizeObserver(handleResize);\n    wrapperRef.current && observer.observe(wrapperRef.current);\n    return () => {\n      observer.disconnect();\n      handleResize.cancel();\n      toolbarWidth.current = 0;\n    };\n  }, [singleToolbar, updatePos]);\n\n  React.useEffect(() => {\n    if (!singleToolbar) return noop;\n    const handleChange = throttle(() => {\n      updatePos();\n    }, 200);\n    const mutationObserver: MutationObserver = new MutationObserver(handleChange);\n    content && mutationObserver.observe(content, {\n      childList: true,\n      subtree: true,\n      attributes: true,\n      attributeFilter: ['style'],\n    });\n    return () => {\n      mutationObserver && mutationObserver.disconnect();\n      handleChange.cancel();\n    }\n  }, [singleToolbar, updatePos, content]);\n\n  const getContainer = React.useCallback(() => {\n    // Hack: 缩放的时候 popover 内部使用的 dom-align 不能正确定位到被 scale 的容器，所以需要挂载到 dom 上，缺点时不会跟随滚动\n    if (zoom !== 1) {\n      return window.document.body;\n    }\n    const innerContainer = zoomContainer || window.document.body;\n    const outerContainer = scrollableContainer instanceof Element ? scrollableContainer : window.document.body;\n    const container = inOuterContainerRef.current ? outerContainer : innerContainer;\n    return container;\n  }, [zoomContainer, scrollableContainer, zoom]);\n\n  React.useEffect(() => {\n    const handleTrigger: ICallback = (msg) => {\n      // 有其他激活中的菜单就不触发\n      if (activeRef.current && activeRef.current !== 'hoverToolbarPopover') {\n        return;\n      }\n      const { node = null } = msg;\n      if (currentNode.current !== node) {\n        if (!currentNode.current) {\n          needSlidInRef.current = true;\n        }\n        const currentLayout = node ? getHoverToolbarLayout({\n          layoutConfigs: configs.layouts || {},\n          plugins,\n          controller,\n          node,\n          hoverCapture: (hoverCapture as HoverCapture),\n          locale,\n          visiblePopoverSet: visiblePopoverSetRef.current,\n          activeRef,\n          setActiveInteraction: setActiveType,\n          reset,\n        }) : undefined;\n        setSingleToolbar(currentLayout);\n        setCurrentKey(node?.key || '');\n        currentNode.current = node;\n        toolbarWidth.current = 0;\n        if (!node) {\n          visiblePopoverSetRef.current.clear();\n          hoverCapture?.enableTrigger();\n        }\n      }\n    };\n    hoverCapture?.on(handleTrigger);\n    return () => {\n      hoverCapture?.off(handleTrigger);\n    };\n  }, [controller, configs, plugins, hoverCapture, updatePos, reset, setActiveType]);\n\n  React.useEffect(() => {\n    const handleScroll = throttle(() => {\n      updatePos();\n    }, SCROLL_TIMEOUT);\n    scrollableContainer?.addEventListener('scroll', handleScroll);\n    return () => {\n      scrollableContainer?.removeEventListener('scroll', handleScroll);\n    }\n  }, [scrollableContainer, updatePos]);\n\n  const handleMouseEnter = React.useCallback(() => {\n    const node = hoverCapture?.getCurrentNode();\n    if (!Block.isBlock(node) && !Inline.isInline(node)) return;\n    controller.dispatch('updateHighlight', {\n      node,\n      type: 'hover',\n      reason: 'hoverToolbar',\n    })\n  }, [hoverCapture]);\n\n  const handleMouseLeave = React.useCallback(() => {\n    const node = hoverCapture?.getCurrentNode();\n    if (!Block.isBlock(node) && !Inline.isInline(node)) return;\n    controller.dispatch('removeHighlight', {\n      node,\n      type: 'hover',\n      reason: 'hoverToolbar',\n    })\n  }, [hoverCapture]);\n\n  const handleAnimationEnd = React.useCallback((event: React.AnimationEvent) => {\n    const { target } = event;\n    const { classList } = (target as HTMLDivElement);\n    classList.remove(HOVER_TOOLBAR_SLIDE_IN);\n    needSlidInRef.current = false;\n  }, []);\n\n  return showHoverToolbar ? (\n    <Portal\n      container={container}\n    >\n      <HoverToolbarWrapper\n        ref={wrapperRef}\n        className={`hover-toolbar-wrapper ${HOVER_TOOLBAR_NOT_READY}`}\n        data-hover-toolbar\n        style={{\n          '--hover-toolbar-transform': inOuterContainer ? `scale(${zoom})` : 'scale(1)',\n        } as React.CSSProperties}\n        data-testid=\"hover-toolbar\"\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n        onAnimationEnd={handleAnimationEnd}\n        data-role={PluginRoles.hoverToolbar}\n      >\n        <HoverToolbarContexts.GetContainerContext.Provider value={getContainer} >\n          <HoverToolbarContexts.HoverToolbarVisibleContext.Provider value={isVisible}>\n            <HoverToolbarContexts.VisiblePopoverSetContext.Provider value={visiblePopoverSetRef.current}>\n              <ToolbarLayout\n                mode=\"singleLine\"\n                singleLineToolbar={singleToolbar}\n                layout=\"fit-content\"\n                align=\"left\"\n                style={{\n                  padding: '2px 0',\n                }}\n                key={currentKey}\n              />\n            </HoverToolbarContexts.VisiblePopoverSetContext.Provider>\n          </HoverToolbarContexts.HoverToolbarVisibleContext.Provider>\n        </HoverToolbarContexts.GetContainerContext.Provider>\n      </HoverToolbarWrapper>\n    </Portal>\n  ) : null;\n});\n"],"file":"HoverToolbar.js"}