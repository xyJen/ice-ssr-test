{"version":3,"sources":["../../../../../src/plugins/laserPointer/components/highlight.tsx"],"names":["Highlight","props","type","domRef","children","controller","node","highlighted","renderHighlight","getRole","highlight","React","useCallback","LaserPointerRole","HOST","path","value","document","getPath","key","run","actions","removeHighlight","getDOMNode","domNode","current","undefined","domUtils","findDOMNode","List","isList","closest","e"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAsBA,MAAMA,SAAmC,GAAIC,KAAD,IAAW;AACrD,QAAM;AACJC,IAAAA,IADI;AAEJC,IAAAA,MAFI;AAGJC,IAAAA,QAHI;AAIJC,IAAAA,UAJI;AAKJC,IAAAA,IALI;AAMJC,IAAAA,WANI;AAOJC,IAAAA,eAPI;AAQJC,IAAAA;AARI,MASFR,KATJ;AAWA,QAAMS,SAAS,GAAGC,KAAK,CAACC,WAAN,CAAkB,MAAM;AACxC,QAAIH,OAAO,OAAOI,wBAAiBC,IAAnC,EAAyC;AACvC,YAAMC,IAAI,GAAGV,UAAU,CAACW,KAAX,CAAiBC,QAAjB,CAA0BC,OAA1B,CAAkCZ,IAAI,CAACa,GAAvC,CAAb;AACAd,MAAAA,UAAU,CAACe,GAAX,CACE,UADF,EAEEC,OAAO,CAACX,SAAR,CAAkB;AAChBK,QAAAA;AADgB,OAAlB,CAFF;AAMD;AACF,GAViB,EAUf,CAACV,UAAD,EAAaC,IAAb,EAAmBG,OAAnB,CAVe,CAAlB;AAYA,QAAMa,eAAe,GAAGX,KAAK,CAACC,WAAN,CAAkB,MAAM;AAC9C,QAAIH,OAAO,OAAOI,wBAAiBC,IAAnC,EAAyC;AACvCT,MAAAA,UAAU,CAACe,GAAX,CACE,UADF,EAEEC,OAAO,CAACC,eAAR,EAFF;AAID;AACF,GAPuB,EAOrB,CAACjB,UAAD,EAAaI,OAAb,CAPqB,CAAxB;;AASA,QAAMc,UAAU,GAAG,MAAM;AACvB,QAAIC,OAAO,GAAGrB,MAAM,EAAEsB,OAAR,IAAmBC,SAAjC;;AACA,QAAI;AACFF,MAAAA,OAAO,GAAGG,sBAASC,WAAT,CAAqBtB,IAAI,CAACa,GAA1B,CAAV;;AACA,UAAI,CAACK,OAAL,EAAc;AACZ,eAAOE,SAAP;AACD;;AACD,UAAIG,qBAAKC,MAAL,CAAYxB,IAAZ,CAAJ,EAAuB;AACrB,eAAOkB,OAAO,CAACO,OAAR,CAAgB,sBAAhB,KAA2CL,SAAlD;AACD,OAFD,MAEO,IAAI,yBAAapB,IAAb,CAAJ,EAAwB;AAC7B,eAAOkB,OAAO,CAACO,OAAR,CAAgB,YAAhB,KAAiCL,SAAxC;AACD;AACF,KAVD,CAUE,OAAOM,CAAP,EAAU,CACV;AACD;;AACD,WAAOR,OAAP;AACD,GAhBD;;AAkBA,SAAOhB,eAAe,CAACN,IAAD,EAAOK,WAAP,EAAoB;AACxCH,IAAAA,QADwC;AAExCmB,IAAAA,UAFwC;AAGxCb,IAAAA,SAHwC;AAIxCY,IAAAA;AAJwC,GAApB,CAAtB;AAMD,CAzDD;;eA2DetB,S","sourcesContent":["import * as React from 'react';\nimport { Controller, domUtils, Node } from '@ali/4ever-cangjie';\nimport { List } from '@ali/4ever-plugin-list';\nimport * as actions from '../actions';\nimport { isBlockQuote } from '../utils';\nimport {\n  LaserPointerPluginConfig,\n  LaserPointerRole,\n} from '../types';\n\ninterface HighlightProps {\n  /** highlight 类型 */\n  type: string;\n  /** controller */\n  controller: Controller;\n  /** node */\n  node: Node;\n  /** 用户角色 */\n  getRole: () => LaserPointerRole;\n  /** DOM ref */\n  domRef?: React.MutableRefObject<HTMLElement | null>;\n  /** 是否被高亮 */\n  highlighted: boolean;\n  /** 自定义 highlight 渲染 */\n  renderHighlight: LaserPointerPluginConfig['renderHighlight'];\n}\n\nconst Highlight: React.FC<HighlightProps> = (props) => {\n  const {\n    type,\n    domRef,\n    children,\n    controller,\n    node,\n    highlighted,\n    renderHighlight,\n    getRole,\n  } = props;\n\n  const highlight = React.useCallback(() => {\n    if (getRole() === LaserPointerRole.HOST) {\n      const path = controller.value.document.getPath(node.key)!\n      controller.run(\n        'onAction',\n        actions.highlight({\n          path,\n        }),\n      );\n    }\n  }, [controller, node, getRole]);\n\n  const removeHighlight = React.useCallback(() => {\n    if (getRole() === LaserPointerRole.HOST) {\n      controller.run(\n        'onAction',\n        actions.removeHighlight(),\n      );\n    }\n  }, [controller, getRole]);\n\n  const getDOMNode = () => {\n    let domNode = domRef?.current ?? undefined;\n    try {\n      domNode = domUtils.findDOMNode(node.key);\n      if (!domNode) {\n        return undefined;\n      }\n      if (List.isList(node)) {\n        return domNode.closest('[data-testid=\"list\"]') ?? undefined;\n      } else if (isBlockQuote(node)) {\n        return domNode.closest('blockquote') ?? undefined;\n      }\n    } catch (e) {\n      // catch don't throw\n    }\n    return domNode;\n  };\n\n  return renderHighlight(type, highlighted, {\n    children,\n    getDOMNode,\n    highlight,\n    removeHighlight,\n  });\n};\n\nexport default Highlight;\n"],"file":"highlight.js"}