{"version":3,"sources":["../../../../../src/plugins/laserPointer/components/RegisterEvent.tsx"],"names":["DELAY_TIME","RegisterEvent","controller","getRole","getHighlightType","React","useEffect","prevLeaveNode","mouseEnter","event","LaserPointerRole","HOST","node","target","highlightType","path","value","document","getPath","key","run","actions","highlight","mouseleave","cancel","removeHighlight","addEventListener","capture","removeEventListener"],"mappings":";;;;;;;;;;;AAAA;;AAEA;;AACA;;AACA;;AACA;;AAEA;AACA,MAAMA,UAAU,GAAG,EAAnB;;AAQe,SAASC,aAAT,CAAuB;AAAEC,EAAAA,UAAF;AAAcC,EAAAA,OAAd;AAAuBC,EAAAA;AAAvB,CAAvB,EAAyE;AACtFC,iBAAMC,SAAN,CAAgB,MAAM;AACpB,QAAIC,aAA2B,GAAG,IAAlC;AAEA,UAAMC,UAAU,GAAG,sBAAUC,KAAD,IAAuB;AACjD,UAAIN,OAAO,OAAOO,wBAAiBC,IAAnC,EAAyC;AACvC;AACD;;AACD,YAAMC,IAAI,GAAG,8BAAkBH,KAAK,CAACI,MAAxB,EAA2CX,UAA3C,CAAb;AACA,YAAMY,aAAa,GAAGF,IAAI,IAAIR,gBAAgB,CAACQ,IAAD,EAAOV,UAAP,CAA9C;;AACA,UAAIY,aAAJ,EAAmB;AACjB,cAAMC,IAAI,GAAGb,UAAU,CAACc,KAAX,CAAiBC,QAAjB,CAA0BC,OAA1B,CAAkCN,IAAI,CAACO,GAAvC,CAAb;AACAjB,QAAAA,UAAU,CAACkB,GAAX,CACE,UADF,EAEEC,OAAO,CAACC,SAAR,CAAkB;AAChBP,UAAAA;AADgB,SAAlB,CAFF;AAMD;AACF,KAfkB,EAehBf,UAfgB,CAAnB;;AAiBA,UAAMuB,UAAU,GAAId,KAAD,IAAuB;AACxCD,MAAAA,UAAU,CAACgB,MAAX;;AACA,UAAIrB,OAAO,OAAOO,wBAAiBC,IAAnC,EAAyC;AACvC;AACD;;AACD,YAAMC,IAAI,GAAG,8BAAkBH,KAAK,CAACI,MAAxB,EAA2CX,UAA3C,CAAb;AACA,YAAMY,aAAa,GAAGF,IAAI,IAAIR,gBAAgB,CAACQ,IAAD,EAAOV,UAAP,CAA9C;;AACA,UAAIY,aAAa,IAAIP,aAAa,KAAKK,IAAvC,EAA6C;AAC3CV,QAAAA,UAAU,CAACkB,GAAX,CACE,UADF,EAEEC,OAAO,CAACI,eAAR,EAFF;AAID;;AACDlB,MAAAA,aAAa,GAAGK,IAAhB;AACD,KAdD;;AAeAK,IAAAA,QAAQ,CAACS,gBAAT,CAA0B,YAA1B,EAAwClB,UAAxC,EAAoD;AAAEmB,MAAAA,OAAO,EAAE;AAAX,KAApD;AACAV,IAAAA,QAAQ,CAACS,gBAAT,CAA0B,YAA1B,EAAwCH,UAAxC,EAAoD;AAAEI,MAAAA,OAAO,EAAE;AAAX,KAApD;AACA,WAAO,MAAM;AACXV,MAAAA,QAAQ,CAACW,mBAAT,CAA6B,YAA7B,EAA2CpB,UAA3C,EAAuD;AAAEmB,QAAAA,OAAO,EAAE;AAAX,OAAvD;AACAV,MAAAA,QAAQ,CAACW,mBAAT,CAA6B,YAA7B,EAA2CL,UAA3C,EAAuD;AAAEI,QAAAA,OAAO,EAAE;AAAX,OAAvD,EAFW,CAGX;;AACAnB,MAAAA,UAAU,CAACgB,MAAX;AACD,KALD,CArCoB,CA2CtB;AACC,GA5CD,EA4CG,EA5CH;;AA8CA,SAAO,IAAP;AACD","sourcesContent":["import React from 'react';\nimport { Controller, Node, Block } from '@ali/4ever-cangjie';\nimport { debounce } from 'lodash-es';\nimport * as actions from '../actions';\nimport { findClosesetBlock } from '../utils';\nimport { LaserPointerRole } from '../types';\n\n/** 高亮延迟 */\nconst DELAY_TIME = 50;\n\nexport interface Props {\n  getRole: () => LaserPointerRole;\n  controller: Controller;\n  getHighlightType: (node: Node, controller: Controller) => string | null;\n}\n\nexport default function RegisterEvent({ controller, getRole, getHighlightType }: Props) {\n  React.useEffect(() => {\n    let prevLeaveNode: Block | null = null;\n\n    const mouseEnter = debounce((event: MouseEvent) => {\n      if (getRole() !== LaserPointerRole.HOST) {\n        return;\n      }\n      const node = findClosesetBlock(event.target as Element, controller);\n      const highlightType = node && getHighlightType(node, controller);\n      if (highlightType) {\n        const path = controller.value.document.getPath(node.key)!;\n        controller.run(\n          'onAction',\n          actions.highlight({\n            path,\n          }),\n        );\n      }\n    }, DELAY_TIME);\n\n    const mouseleave = (event: MouseEvent) => {\n      mouseEnter.cancel();\n      if (getRole() !== LaserPointerRole.HOST) {\n        return;\n      }\n      const node = findClosesetBlock(event.target as Element, controller);\n      const highlightType = node && getHighlightType(node, controller);\n      if (highlightType && prevLeaveNode !== node) {\n        controller.run(\n          'onAction',\n          actions.removeHighlight(),\n        );\n      }\n      prevLeaveNode = node;\n    };\n    document.addEventListener('mouseenter', mouseEnter, { capture: true });\n    document.addEventListener('mouseleave', mouseleave, { capture: true });\n    return () => {\n      document.removeEventListener('mouseenter', mouseEnter, { capture: true });\n      document.removeEventListener('mouseleave', mouseleave, { capture: true });\n      // 防止内存泄漏\n      mouseEnter.cancel();\n    };\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return null;\n}\n"],"file":"RegisterEvent.js"}