{"version":3,"sources":["../../../../../src/plugins/columns/components/columnsMenu.tsx"],"names":["insertColumns","ColumnsPlugin","actions","createColumnsMenu","configs","ColumnsMenu","props","count","setCount","menuItem","controller","title","menuKey","rest","isCollapsedAtEdge","value","selection","handleClick","_","event","run","size","text","stopPropagation","handleDefaultClick","columnText","locale","insertText2","padding","PluginRoles","columns","height"],"mappings":";;;;;;;;;;;;;AAAA;;AACA;;AACA;;AAEA;;AACA;;uBAJ4B,a;AAO5B,MAAM;AAAEA,EAAAA;AAAF,IAAoBC,0BAAcC,OAAxC;;AAEA,MAAMC,iBAAiB,GAAIC,OAAD,IAAsB;AAC9C,SAAO,SAASC,WAAT,CAAqBC,KAArB,EAAgD;AACrD,UAAM,CAACC,KAAD,EAAQC,QAAR,IAAoB,qBAAS,CAAT,CAA1B;AAEA,UAAM;AAAEC,MAAAA,QAAF;AAAYC,MAAAA;AAAZ,QAA2BJ,KAAjC;AACA,UAAM;AAAEK,MAAAA,KAAF;AAASC,MAAAA,OAAT;AAAkB,SAAGC;AAArB,QAA8BJ,QAApC;AAEA,UAAM;AAAEK,MAAAA;AAAF,QAAwBJ,UAAU,CAACK,KAAX,CAAiBC,SAA/C;AACA,UAAMC,WAAW,GAAG,wBAClB,CAACC,CAAD,EAAIC,KAAJ,KAAgC;AAC9B,UAAI,CAACA,KAAL,EAAY;AACV;AACA;AACAX,QAAAA,QAAQ,CAAED,KAAD,IAAW;AAClBG,UAAAA,UAAU,CAACU,GAAX,CACE,UADF,EAEEpB,aAAa,CAAC;AAAEqB,YAAAA,IAAI,EAAEd,KAAR;AAAee,YAAAA,IAAI,EAAE;AAArB,WAAD,CAFf;AAIA,iBAAOf,KAAP;AACD,SANO,CAAR;AAOD,OAVD,MAUO;AACL;AACAG,QAAAA,UAAU,CAACU,GAAX,CAAe,UAAf,EAA2BpB,aAAa,CAAC;AAAEqB,UAAAA,IAAI,EAAEd,KAAR;AAAee,UAAAA,IAAI,EAAE;AAArB,SAAD,CAAxC;AACD;;AAEDH,MAAAA,KAAK,IAAIA,KAAK,CAACI,eAAN,EAAT;AACD,KAlBiB,EAmBlB,CAAChB,KAAD,CAnBkB,CAApB;AAsBA,UAAMiB,kBAAkB,GAAG,wBAAaL,KAAD,IAAW;AAChDT,MAAAA,UAAU,CAACU,GAAX,CAAe,UAAf,EAA2BpB,aAAa,CAAC;AAAEqB,QAAAA,IAAI,EAAE,CAAR;AAAWC,QAAAA,IAAI,EAAE;AAAjB,OAAD,CAAxC;AACAZ,MAAAA,UAAU,CAACU,GAAX,CAAe,UAAf,EAA2B,yCAAyB,KAAzB,CAA3B;AACAD,MAAAA,KAAK,IAAIA,KAAK,CAACI,eAAN,EAAT;AACD,KAJ0B,EAIxB,CAACb,UAAD,CAJwB,CAA3B;AAMA,UAAMe,UAAU,GAAGrB,OAAO,EAAEsB,MAAT,EAAiBC,WAApC;AACA,wBACE;AAAK,MAAA,OAAO,EAAEH;AAAd,oBACE,eAAC,iBAAD,6BACMX,IADN;AAEE,MAAA,QAAQ,EAAEC,iBAFZ;AAGE,MAAA,KAAK,EAAEH,KAAK,IAAI,EAHlB;AAIE,MAAA,YAAY,EAAE;AAAEiB,QAAAA,OAAO,EAAE;AAAX,OAJhB;AAKE,MAAA,gBAAgB,EAAC;AALnB,qBAOE,eAAC,kBAAD;AACE,MAAA,OAAO,EAAEhB,OAAO,IAAI,eADtB;AAEE,MAAA,SAAS,EAAE,KAFb;AAGE,MAAA,IAAI,EAAEiB,wBAAYC,OAHpB;AAIE,MAAA,KAAK,EAAE;AACLC,QAAAA,MAAM,EAAE,MADH;AAELH,QAAAA,OAAO,EAAE;AAFJ,OAJT;AAQE,MAAA,OAAO,EAAEX;AARX,oBAUE,eAAC,qBAAD;AACE,MAAA,WAAW,EAAEV,KADf;AAEE,MAAA,QAAQ,EAAEC,QAFZ;AAGE,MAAA,UAAU,EAAEiB;AAHd,MAVF,CAPF,CADF,CADF;AA4BD,GAhED;AAiED,CAlED;;eAoEetB,iB","sourcesContent":["import React, { useCallback, useState } from 'react';\nimport { ColumnsPlugin, PluginRoles } from '@ali/4ever-bamboo';\nimport { MenuItem, SubMenu } from '@ali/we-design';\nimport { MenuItemInnerProps } from '@ali/4ever-component';\nimport { removeNewlineTriggerText } from '@ali/4ever-utils';\nimport ColumnsPicker from './ColumnPicker';\nimport type { IConfig } from '../menubar';\n\nconst { insertColumns } = ColumnsPlugin.actions;\n\nconst createColumnsMenu = (configs: IConfig) => {\n  return function ColumnsMenu(props: MenuItemInnerProps) {\n    const [count, setCount] = useState(2);\n\n    const { menuItem, controller } = props;\n    const { title, menuKey, ...rest } = menuItem;\n\n    const { isCollapsedAtEdge } = controller.value.selection;\n    const handleClick = useCallback(\n      (_, event: React.MouseEvent) => {\n        if (!event) {\n          // 回车触发\n          // menuItem 有bug, 这里必须在 setCount 里才能拿到最新的 count\n          setCount((count) => {\n            controller.run(\n              'onAction',\n              insertColumns({ size: count, text: '' }),\n            );\n            return count;\n          });\n        } else {\n          // click 触发\n          controller.run('onAction', insertColumns({ size: count, text: '' }));\n        }\n\n        event && event.stopPropagation();\n      },\n      [count],\n    );\n\n    const handleDefaultClick = useCallback((event) => {\n      controller.run('onAction', insertColumns({ size: 2, text: '' }));\n      controller.run('onAction', removeNewlineTriggerText(false));\n      event && event.stopPropagation();\n    }, [controller]);\n\n    const columnText = configs?.locale?.insertText2;\n    return (\n      <div onClick={handleDefaultClick}>\n        <SubMenu\n          {...rest}\n          disabled={isCollapsedAtEdge}\n          title={title || ''}\n          overlayStyle={{ padding: 0 }}\n          overlayClassName=\"menu-columns-overlay\"\n        >\n          <MenuItem\n            menuKey={menuKey || 'columnsPicker'}\n            hoverable={false}\n            role={PluginRoles.columns}\n            style={{\n              height: 'auto',\n              padding: '12px',\n            }}\n            onClick={handleClick}\n          >\n            <ColumnsPicker\n              activeCount={count}\n              onChange={setCount}\n              columnText={columnText}\n            />\n          </MenuItem>\n        </SubMenu>\n      </div>\n    );\n  };\n};\n\nexport default createColumnsMenu;\n"],"file":"columnsMenu.js"}