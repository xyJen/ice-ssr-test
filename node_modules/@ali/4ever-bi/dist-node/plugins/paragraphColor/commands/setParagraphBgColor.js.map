{"version":3,"sources":["../../../../../src/plugins/paragraphColor/commands/setParagraphBgColor.ts"],"names":["setTableOrColumnBgColor","controller","node","color","command","selectRange","nodeOrNodes","table","query","selection","dispatch","Commands","moveToEndOfNode","setParagraphBgColor","payload","currentBlock","blocks","key","Array","isArray","length","forEach","data","type","isTableOrColumn","includes","newData","shd","val","fill","setNodeByKey"],"mappings":";;;;;;;;;AAAA;;AAEA;;AACA;;AAGA,MAAMA,uBAAuB,GAAG,CAACC,UAAD,EAAyBC,IAAzB,EAAsCC,KAAtC,KAAwD;AACtF;AACAF,EAAAA,UAAU,CAACG,OAAX,CAAmBC,oBAAnB,EAAgC;AAAEC,IAAAA,WAAW,EAAEJ;AAAf,GAAhC;AACA,QAAMK,KAAK,GAAGN,UAAU,CAACO,KAAX,CAAiB,UAAjB,CAAd;AACA,QAAMC,SAAS,GAAGR,UAAU,CAACO,KAAX,CAAiB,mBAAjB,CAAlB;AACAP,EAAAA,UAAU,CAACS,QAAX,CAAoB,kBAApB,EAAwCH,KAAxC,EAA+CE,SAA/C,EAA0DN,KAA1D;AACAF,EAAAA,UAAU,CAACG,OAAX,CAAmBO,sBAASC,eAA5B,EAA6CV,IAA7C;AACD,CAPD;;AASA,MAAMW,mBAAmB,GAAG,CAC1BZ,UAD0B,EAE1Ba,OAF0B,KAGvB;AACH,QAAM;AAAEZ,IAAAA,IAAI,EAAEa,YAAR;AAAsBZ,IAAAA;AAAtB,MAAgCW,OAAtC;AACA,QAAME,MAAM,GAAG,6BAAiBf,UAAjB,EAA6Bc,YAAY,CAACE,GAA1C,CAAf;;AAEA,MAAIC,KAAK,CAACC,OAAN,CAAcH,MAAd,KAAyBA,MAAM,CAACI,MAAP,GAAgB,CAA7C,EAAgD;AAC9CJ,IAAAA,MAAM,CAACK,OAAP,CAAgBnB,IAAD,IAAU;AACvB,YAAM;AAAEoB,QAAAA,IAAF;AAAQC,QAAAA;AAAR,UAAiBrB,IAAvB;AAEA,YAAMsB,eAAe,GAAG,CAAC,OAAD,EAAU,YAAV,EAAwBC,QAAxB,CAAiCF,IAAjC,CAAxB;;AACA,UAAIC,eAAJ,EAAqB;AACnB;AACAxB,QAAAA,uBAAuB,CAACC,UAAD,EAAaC,IAAb,EAAmBC,KAAnB,CAAvB;AACD,OAHD,MAGO;AACL,YAAIuB,OAAO,GAAG,EAAE,GAAGJ;AAAL,SAAd;;AAEA,YAAInB,KAAK,KAAK,EAAd,EAAkB;AAChB,iBAAOuB,OAAO,CAACC,GAAf;AACD,SAFD,MAEO;AACLD,UAAAA,OAAO,GAAG,EACR,GAAGA,OADK;AAERC,YAAAA,GAAG,EAAE;AACHC,cAAAA,GAAG,EAAE,OADF;AAEHzB,cAAAA,KAAK,EAAE,MAFJ;AAGH0B,cAAAA,IAAI,EAAE1B;AAHH;AAFG,WAAV;AAQD;;AAEDF,QAAAA,UAAU,CAACG,OAAX,CAAmBO,sBAASmB,YAA5B,EAA0C5B,IAAI,CAACe,GAA/C,EAAoD;AAAEK,UAAAA,IAAI,EAAEI;AAAR,SAApD;AACD;AACF,KAzBD;AA0BD;;AACD,SAAOzB,UAAP;AACD,CApCD;;eAsCeY,mB","sourcesContent":["import { Controller, Commands, Block } from '@ali/4ever-cangjie';\n\nimport selectRange from './selectRange';\nimport { getCurrentBlocks } from '../utils';\nimport type { ISetParagraphBgColor } from '../types';\n\nconst setTableOrColumnBgColor = (controller: Controller, node: Block, color: string) => {\n  // 当选区是表格或分栏时，调用 setTableCellFill 填充背景色\n  controller.command(selectRange, { nodeOrNodes: node });\n  const table = controller.query('getTable');\n  const selection = controller.query('getTableSelection');\n  controller.dispatch('setTableCellFill', table, selection, color);\n  controller.command(Commands.moveToEndOfNode, node);\n};\n\nconst setParagraphBgColor = (\n  controller: Controller,\n  payload: ISetParagraphBgColor,\n) => {\n  const { node: currentBlock, color } = payload;\n  const blocks = getCurrentBlocks(controller, currentBlock.key);\n\n  if (Array.isArray(blocks) && blocks.length > 0) {\n    blocks.forEach((node) => {\n      const { data, type } = node;\n\n      const isTableOrColumn = ['table', 'table-cell'].includes(type);\n      if (isTableOrColumn) {\n        // 处理表格和分栏的情况\n        setTableOrColumnBgColor(controller, node, color);\n      } else {\n        let newData = { ...data };\n\n        if (color === '') {\n          delete newData.shd;\n        } else {\n          newData = {\n            ...newData,\n            shd: {\n              val: 'clear',\n              color: 'auto',\n              fill: color,\n            },\n          };\n        }\n\n        controller.command(Commands.setNodeByKey, node.key, { data: newData });\n      }\n    });\n  }\n  return controller;\n};\n\nexport default setParagraphBgColor;\n\n"],"file":"setParagraphBgColor.js"}