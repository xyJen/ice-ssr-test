"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = onAction;

var _everUtils = require("@ali/4ever-utils");

var _actions = require("../actions");

var _setInjection = require("../commands/setInjection");

var _everFactory = require("@ali/4ever-factory");

function onAction(action, controller, next) {
  if (action.type === _actions.FORMULA_SET_DATA) {
    const {
      value
    } = controller;
    const {
      node,
      data
    } = action.payload;
    const closestBlock = (0, _everUtils.getClosestContainerBlock)(value, node);
    const maxWidth = (0, _everUtils.getInnerWidth)(closestBlock);
    const tagData = { ...data,
      width: !data.width ? data.width : Math.min(maxWidth, data.width),
      height: data.height
    };
    return controller.run('onAction', (0, _everFactory.setTagData)(node, tagData));
  }

  if (action.type === _actions.FORMULA_SET_INJECTION) {
    const {
      key,
      data
    } = action.payload;
    return (0, _setInjection.setInjection)(controller, key, data);
  }

  return next();
}
//# sourceMappingURL=onAction.js.map