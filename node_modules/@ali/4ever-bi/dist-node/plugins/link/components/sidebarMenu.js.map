{"version":3,"sources":["../../../../../src/plugins/link/components/sidebarMenu.tsx"],"names":["PLACEHOLDER","SetInlineHrefMenu","props","dataValue","controller","document","focusInline","value","parent","getParent","key","isParentClickable","isElement","type","data","href","setValue","React","useState","inputRef","useRef","handleBlur","useCallback","event","run","actions","updateLink","text","logger","sum","unwrapLink","wrapLink","selection","undefined","handleEnter","stopPropagation","preventDefault","current","blur","handleChange","target","handleFocus"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Controller, Inline } from '@ali/4ever-cangjie';\nimport { Input } from '@ali/we-design';\nimport logger from '@ali/4ever-logger';\nimport * as actions from '../actions';\n\nconst PLACEHOLDER = 'https://';\n\nexport interface ILinkMenuProps {\n  controller: Controller;\n}\n\nexport const SetInlineHrefMenu = (props: ILinkMenuProps) => {\n  let dataValue;\n  const { controller } = props;\n  const { document, focusInline } = controller.value;\n  const parent = document.getParent(focusInline?.key) as Inline;\n  const isParentClickable = parent?.isElement() && parent.type === 'link';\n  if (isParentClickable) {\n    dataValue = parent.data.href;\n  }\n  const [value, setValue] = React.useState(dataValue);\n  const inputRef = React.useRef<HTMLInputElement>(null);\n  const handleBlur: React.FocusEventHandler<HTMLInputElement> = React.useCallback((event) => {\n    if (isParentClickable) {\n      if (value && value !== PLACEHOLDER) {\n        controller.run('onAction', actions.updateLink(parent!, parent.data.text || '', value));\n        logger.sum('sidebar-link-update-link');\n      } else {\n        controller.run('onAction', actions.unwrapLink());\n        setValue('');\n        logger.sum('sidebar-link-unwrap-link');\n      }\n    } else if (value && value !== PLACEHOLDER) {\n      controller.run('onAction', actions.wrapLink(controller.value.selection));\n      const parent = controller.value.document.getParent(focusInline?.key) as Inline;\n      if (!parent) {\n        return undefined;\n      }\n      controller.run('onAction', actions.updateLink(parent, '', value));\n      logger.sum('sidebar-link-wrap-link');\n    } else {\n      setValue('');\n    }\n  }, [isParentClickable, parent, value, controller]);\n\n  const handleEnter: React.KeyboardEventHandler<HTMLInputElement> = React.useCallback(() => {\n    event?.stopPropagation();\n    event?.preventDefault();\n    inputRef.current?.blur();\n  }, []);\n\n  const handleChange: React.ChangeEventHandler<HTMLInputElement> = React.useCallback((event) => {\n    setValue(event.target.value);\n  }, []);\n\n  const handleFocus: React.FocusEventHandler<HTMLInputElement> = React.useCallback((event) => {\n    if (!value) {\n      setValue(PLACEHOLDER);\n    }\n  }, []);\n\n  return (\n    <Input\n      placeholder={PLACEHOLDER}\n      onChange={handleChange}\n      onBlur={handleBlur}\n      onEnter={handleEnter}\n      onFocus={handleFocus}\n      value={value}\n      ref={inputRef}\n      allowClear\n      disabled={!focusInline}\n    />\n  );\n};\n"],"file":"sidebarMenu.js"}