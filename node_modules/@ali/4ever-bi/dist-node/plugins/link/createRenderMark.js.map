{"version":3,"sources":["../../../../src/plugins/link/createRenderMark.tsx"],"names":["createRenderMark","linkConfig","locale","protocolAllowList","onCopyLink","getLinkInfo","enableCard","openLink","enableLinkCardBlock","mountRoot","renderMark","props","controller","next","mark","marks","node","type","find","document","value","inline","getClosestInline","key"],"mappings":";;;;;;;;;;;;;AAAA;;AAEA;;AAEA;;uBAH4B,a;;AAKb,SAASA,gBAAT,CACbC,UADa,EAES;AACtB,QAAM;AACJC,IAAAA,MADI;AAEJC,IAAAA,iBAFI;AAGJC,IAAAA,UAHI;AAIJC,IAAAA,WAJI;AAKJC,IAAAA,UAAU,GAAG,KALT;AAMJC,IAAAA,QANI;AAOJC,IAAAA,mBAPI;AAQJC,IAAAA,SAAS,GAAG;AARR,MASFR,UATJ;AAUA,SAAO,SAASS,UAAT,CAAoBC,KAApB,EAA4CC,UAA5C,EAAwDC,IAAxD,EAA8D;AACnE,UAAM;AAAEC,MAAAA,IAAF;AAAQC,MAAAA,KAAR;AAAeC,MAAAA;AAAf,QAAwBL,KAA9B;;AACA,QAAIG,IAAI,CAACG,IAAL,KAAc,MAAd,IAAwB,CAACF,KAAK,CAACG,IAAN,CAAW,CAAC;AAAED,MAAAA;AAAF,KAAD,KAAcA,IAAI,KAAK,QAAlC,CAA7B,EAA0E;AACxE,YAAM;AAAEE,QAAAA;AAAF,UAAeP,UAAU,CAACQ,KAAhC;AACA,YAAMC,MAAM,GAAGF,QAAQ,CAACG,gBAAT,CAA0BN,IAAI,CAACO,GAA/B,CAAf;;AACA,UAAI,CAAC,uBAAWF,MAAX,CAAL,EAAyB;AACvB;AACA,4BACE,eAAC,iBAAD,6BACMV,KADN;AAEE,UAAA,UAAU,EAAEC,UAFd;AAGE,UAAA,iBAAiB,EAAET,iBAAiB,IAAI,EAH1C;AAIE,UAAA,MAAM,EAAED,MAJV;AAKE,UAAA,UAAU,EAAEE,UALd;AAME,UAAA,WAAW,EAAEC,WANf;AAOE,UAAA,UAAU,EAAEC,UAPd;AAQE,UAAA,QAAQ,EAAEC,QARZ;AASE,UAAA,mBAAmB,EAAEC,mBATvB;AAUE,UAAA,SAAS,EAAEC;AAVb,WADF;AAcD;AAEF;;AACD,WAAOI,IAAI,EAAX;AACD,GAzBD;AA0BD","sourcesContent":["import * as React from 'react';\nimport { Plugin, RenderMarkProps } from '@ali/4ever-cangjie';\nimport PureLink from './components/pureLink';\nimport { LinkPluginConfig } from './types';\nimport { isLinkNode } from './utils';\n\nexport default function createRenderMark(\n  linkConfig: LinkPluginConfig,\n): Plugin['renderMark'] {\n  const {\n    locale,\n    protocolAllowList,\n    onCopyLink,\n    getLinkInfo,\n    enableCard = false,\n    openLink,\n    enableLinkCardBlock,\n    mountRoot = false,\n  } = linkConfig;\n  return function renderMark(props: RenderMarkProps, controller, next) {\n    const { mark, marks, node } = props;\n    if (mark.type === 'link' && !marks.find(({ type }) => type === 'unlink')) {\n      const { document } = controller.value;\n      const inline = document.getClosestInline(node.key);\n      if (!isLinkNode(inline)) {\n        // 仅在父节点不是 link 节点时，渲染 purelink, 避免节点嵌套\n        return (\n          <PureLink\n            {...props}\n            controller={controller}\n            protocolAllowList={protocolAllowList || []}\n            locale={locale}\n            onCopyLink={onCopyLink}\n            getLinkInfo={getLinkInfo}\n            enableCard={enableCard}\n            openLink={openLink}\n            enableLinkCardBlock={enableLinkCardBlock}\n            mountRoot={mountRoot}\n          />\n        );\n      }\n\n    }\n    return next();\n  };\n}\n"],"file":"createRenderMark.js"}