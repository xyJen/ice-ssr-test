{"version":3,"sources":["../../../../../src/plugins/link/mobile/createRenderMark.tsx"],"names":["createRenderMark","linkConfig","protocolAllowList","openLink","renderMark","props","controller","next","mark","marks","node","type","find","href","data","document","value","inline","getClosestInline","key"],"mappings":";;;;;;;;;;;;;AAAA;;AAEA;;AAEA;;uBAH4B,a;;AAKb,SAASA,gBAAT,CACbC,UADa,EAES;AACtB,QAAM;AACJC,IAAAA,iBADI;AAEJC,IAAAA;AAFI,MAGFF,UAHJ;AAIA,SAAO,SAASG,UAAT,CAAoBC,KAApB,EAA4CC,UAA5C,EAAwDC,IAAxD,EAA8D;AACnE,UAAM;AAAEC,MAAAA,IAAF;AAAQC,MAAAA,KAAR;AAAeC,MAAAA;AAAf,QAAwBL,KAA9B;;AACA,QAAIG,IAAI,CAACG,IAAL,KAAc,MAAd,IAAwB,CAACF,KAAK,CAACG,IAAN,CAAW,CAAC;AAAED,MAAAA;AAAF,KAAD,KAAcA,IAAI,KAAK,QAAlC,CAA7B,EAA0E;AAExE,YAAM;AAAEE,QAAAA;AAAF,UAAWL,IAAI,CAACM,IAAtB;AACA,YAAM;AAAEC,QAAAA;AAAF,UAAeT,UAAU,CAACU,KAAhC;AACA,YAAMC,MAAM,GAAGF,QAAQ,CAACG,gBAAT,CAA0BR,IAAI,CAACS,GAA/B,CAAf;;AAEA,UAAI,CAAC,uBAAWF,MAAX,CAAL,EAAyB;AACvB;AACA,4BACE,eAAC,iBAAD,6BACMZ,KADN;AAEE,UAAA,IAAI,EAAEQ,IAFR;AAGE,UAAA,iBAAiB,EAAEX,iBAAiB,IAAI,EAH1C;AAIE,UAAA,UAAU,EAAEC,QAJd;AAKE,UAAA,UAAU,EAAEG;AALd,WADF;AASD;AAEF;;AACD,WAAOC,IAAI,EAAX;AACD,GAvBD;AAwBD","sourcesContent":["import * as React from 'react';\nimport { Plugin, RenderMarkProps } from '@ali/4ever-cangjie';\nimport Link from './pureLink';\nimport { LinkPluginConfig } from '../types';\nimport { isLinkNode } from '../utils';\n\nexport default function createRenderMark(\n  linkConfig: LinkPluginConfig,\n): Plugin['renderMark'] {\n  const {\n    protocolAllowList,\n    openLink,\n  } = linkConfig;\n  return function renderMark(props: RenderMarkProps, controller, next) {\n    const { mark, marks, node } = props;\n    if (mark.type === 'link' && !marks.find(({ type }) => type === 'unlink')) {\n\n      const { href } = mark.data;\n      const { document } = controller.value;\n      const inline = document.getClosestInline(node.key);\n\n      if (!isLinkNode(inline)) {\n        // 仅在父节点不是 link 节点时，渲染 purelink, 避免节点嵌套\n        return (\n          <Link\n            {...props}\n            href={href}\n            protocolAllowList={protocolAllowList || []}\n            onOpenLink={openLink}\n            controller={controller}\n          />\n        );\n      }\n\n    }\n    return next();\n  };\n}\n"],"file":"createRenderMark.js"}