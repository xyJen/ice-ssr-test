"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = switchLinkDisplayType;

var _everCangjie = require("@ali/4ever-cangjie");

var _removeinjectedCardInfo = _interopRequireDefault(require("./removeinjectedCardInfo"));

function switchLinkDisplayType(controller, node, displayType) {
  const {
    href,
    cardInfo = {}
  } = node.data;
  const originalType = cardInfo?.displayType ?? 'link'; // 更新需要控制粒度，避免生成额外 op

  if (originalType !== displayType) {
    // 如果更新了卡片信息
    controller.command(_everCangjie.Commands.setNodeByKey, node.key, {
      type: 'link',
      data: {
        href,
        cardInfo: { ...cardInfo,
          displayType
        }
      }
    }).command(_everCangjie.Commands.moveToEndOfNode, node);

    if (displayType === 'link') {
      // 样式切换为链接时，清理节点的 injection 内容
      controller.command(_removeinjectedCardInfo.default, node);
    }
  }

  return controller.command(_everCangjie.Commands.moveToStartOfNextText).command(_everCangjie.Commands.focus);
}
//# sourceMappingURL=switchLinkDisplayType.js.map