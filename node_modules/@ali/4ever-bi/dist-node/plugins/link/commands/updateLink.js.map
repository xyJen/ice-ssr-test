{"version":3,"sources":["../../../../../src/plugins/link/commands/updateLink.ts"],"names":["updateLink","controller","node","text","href","selection","value","nodeText","length","originalHref","data","command","Commands","setNodeByKey","key","type","moveToEndOfNode","Text","isTextList","nodes","range","moveToRangeOfNode","select","insertText","moveToStartOfNextText"],"mappings":";;;;;;;AAAA;;AAEe,SAASA,UAAT,CACbC,UADa,EAEbC,IAFa,EAGbC,IAHa,EAIbC,IAJa,EAKb;AACA,QAAM;AAAEC,IAAAA;AAAF,MAAgBJ,UAAU,CAACK,KAAjC;AACA,QAAMC,QAAQ,GAAGJ,IAAI,CAACK,MAAL,GAAcL,IAAd,GAAqBC,IAAtC;AACA,QAAMK,YAAY,GAAGP,IAAI,CAACQ,IAAL,CAAUN,IAA/B,CAHA,CAKA;;AACA,MAAIA,IAAI,KAAKK,YAAb,EAA2B;AACzBR,IAAAA,UAAU,CAACU,OAAX,CAAmBC,sBAASC,YAA5B,EAA0CX,IAAI,CAACY,GAA/C,EAAoD;AAClDC,MAAAA,IAAI,EAAE,MAD4C;AAElDL,MAAAA,IAAI,EAAE;AAAEN,QAAAA;AAAF;AAF4C,KAApD,EAGGO,OAHH,CAGWC,sBAASI,eAHpB,EAGqCd,IAHrC;AAID;;AACD,MAAIe,kBAAKC,UAAL,CAAgBhB,IAAI,CAACiB,KAArB,KAA+BZ,QAAQ,KAAKL,IAAI,CAACC,IAArD,EAA2D;AACzD,UAAMiB,KAAK,GAAGf,SAAS,CAACgB,iBAAV,CAA4BnB,IAA5B,EAAkCD,UAAlC,CAAd;AACAA,IAAAA,UAAU,CAACU,OAAX,CAAmBC,sBAASU,MAA5B,EAAoCF,KAApC,EAA2CT,OAA3C,CAAmDC,sBAASW,UAA5D,EAAwEhB,QAAxE;AACD;;AACD,SAAON,UAAU,CAACU,OAAX,CAAmBC,sBAASY,qBAA5B,CAAP;AACD","sourcesContent":["import { Controller, Inline, Commands, Text } from '@ali/4ever-cangjie';\n\nexport default function updateLink(\n  controller: Controller,\n  node: Inline,\n  text: string,\n  href: string,\n) {\n  const { selection } = controller.value;\n  const nodeText = text.length ? text : href;\n  const originalHref = node.data.href;\n\n  // 更新需要控制粒度，避免生成额外 op\n  if (href !== originalHref) {\n    controller.command(Commands.setNodeByKey, node.key, {\n      type: 'link',\n      data: { href },\n    }).command(Commands.moveToEndOfNode, node);\n  }\n  if (Text.isTextList(node.nodes) && nodeText !== node.text) {\n    const range = selection.moveToRangeOfNode(node, controller);\n    controller.command(Commands.select, range).command(Commands.insertText, nodeText);\n  }\n  return controller.command(Commands.moveToStartOfNextText);\n}\n"],"file":"updateLink.js"}