"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = updateLink;

var _everCangjie = require("@ali/4ever-cangjie");

function updateLink(controller, node, text, href) {
  const {
    selection
  } = controller.value;
  const nodeText = text.length ? text : href;
  const originalHref = node.data.href; // 更新需要控制粒度，避免生成额外 op

  if (href !== originalHref) {
    controller.command(_everCangjie.Commands.setNodeByKey, node.key, {
      type: 'link',
      data: {
        href
      }
    }).command(_everCangjie.Commands.moveToEndOfNode, node);
  }

  if (_everCangjie.Text.isTextList(node.nodes) && nodeText !== node.text) {
    const range = selection.moveToRangeOfNode(node, controller);
    controller.command(_everCangjie.Commands.select, range).command(_everCangjie.Commands.insertText, nodeText);
  }

  return controller.command(_everCangjie.Commands.moveToStartOfNextText);
}
//# sourceMappingURL=updateLink.js.map