{"version":3,"sources":["../../../../../src/plugins/link/commands/unwrapPureLink.ts"],"names":["unwrapPureLink","controller","node","offset","href","selection","value","range","moveToStartOfNode","moveForward","moveFocusForward","length","moveTo","moveToFocus","command","Commands","addMarkAtRange","Mark","create","type","select","focus","isAtEndOfNode","insertText"],"mappings":";;;;;;;AAAA;;AAEe,SAASA,cAAT,CACbC,UADa,EAEbC,IAFa,EAGbC,MAHa,EAIbC,IAJa,EAKb;AACA,QAAM;AAAEC,IAAAA;AAAF,MAAgBJ,UAAU,CAACK,KAAjC;AACA,QAAMC,KAAK,GAAGF,SAAS,CACpBG,iBADW,CACON,IADP,EACaD,UADb,EAEXQ,WAFW,CAECN,MAFD,EAGXO,gBAHW,CAGMN,IAAI,CAACO,MAHX,CAAd;AAKA,QAAMC,MAAM,GAAGL,KAAK,CAACM,WAAN,EAAf;AACAZ,EAAAA,UAAU,CACPa,OADH,CAEIC,sBAASC,cAFb,EAGIT,KAHJ,EAIIU,kBAAKC,MAAL,CAAY;AACVC,IAAAA,IAAI,EAAE;AADI,GAAZ,CAJJ,EAQGL,OARH,CAQWC,sBAASK,MARpB,EAQ4BR,MAR5B,EARA,CAkBA;AACA;;AACA,MAAIL,KAAK,CAACc,KAAN,CAAYC,aAAZ,CAA0BpB,IAA1B,CAAJ,EAAqC;AACnCD,IAAAA,UAAU,CAACa,OAAX,CAAmBC,sBAASQ,UAA5B,EAAwC,GAAxC,EAA6C,EAA7C;AACD,GAFD,MAEO;AACLtB,IAAAA,UAAU,CAACa,OAAX,CAAmBC,sBAASN,WAA5B;AACD;;AAED,SAAOR,UAAP;AACD","sourcesContent":["import { Text, Controller, Commands, Mark } from '@ali/4ever-cangjie';\n\nexport default function unwrapPureLink(\n  controller: Controller,\n  node: Text,\n  offset: number,\n  href: string,\n) {\n  const { selection } = controller.value;\n  const range = selection\n    .moveToStartOfNode(node, controller)\n    .moveForward(offset)\n    .moveFocusForward(href.length);\n\n  const moveTo = range.moveToFocus();\n  controller\n    .command(\n      Commands.addMarkAtRange,\n      range,\n      Mark.create({\n        type: 'unlink',\n      }),\n    )\n    .command(Commands.select, moveTo);\n\n  // 如果 pure link 后面没有内容，为了避免输入新的 pure link 无法被高亮\n  // 需要手动插入一个空白符\n  if (range.focus.isAtEndOfNode(node)) {\n    controller.command(Commands.insertText, ' ', []);\n  } else {\n    controller.command(Commands.moveForward);\n  }\n\n  return controller;\n}\n"],"file":"unwrapPureLink.js"}