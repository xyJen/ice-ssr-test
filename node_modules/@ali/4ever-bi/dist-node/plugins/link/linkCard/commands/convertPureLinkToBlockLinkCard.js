"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = convertPureLinkToBlockLinkCard;

var _removePureLink = _interopRequireDefault(require("../../commands/removePureLink"));

var _buildLinkCardBlock = _interopRequireDefault(require("../utils/buildLinkCardBlock"));

var _fetchLinkData = require("../utils/fetchLinkData");

var _deleteExtraBlankLine = _interopRequireDefault(require("./deleteExtraBlankLine"));

function convertPureLinkToBlockLinkCard(controller, node, data) {
  const {
    offset,
    text,
    href,
    srcHref,
    cardInfo,
    needFetchLinkInfo,
    getLinkInfo
  } = data; // 将 pure link 转换为 block link card

  const nodeText = text.length ? text : href; // 如果更新了卡片信息

  const card = (0, _buildLinkCardBlock.default)({
    text: nodeText,
    href,
    cardInfo
  });
  controller.setOpRelatedId(card.key).command(_removePureLink.default, node, offset, srcHref).command('insertCard', card).command(_deleteExtraBlankLine.default, card.key);

  if (needFetchLinkInfo) {
    (0, _fetchLinkData.fetchLinkData)(card, controller, href, nodeText, getLinkInfo, card.key);
  }

  return controller;
}

;
//# sourceMappingURL=convertPureLinkToBlockLinkCard.js.map