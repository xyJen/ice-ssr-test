{"version":3,"sources":["../../../../src/plugins/callout/utils.ts"],"names":["isCalloutParagraph","node","Heading","isCallout","Block","isBlock","type","createCallout","props","create","condition","firstNode","nextNode","Paragraph","isParagraph","isHeading","data","calloutPr","findFirstBlockOfCalloutPr","document","startNode","finalNode","prevSibling","getPreviousSibling","key","generateClipCallout","endBlock","shouldCutOrCopyBlocks","currentBlock","unshift","fragment","Document","nodes","isEmptyNode","list","length","Text","isEmptyText"],"mappings":";;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AAIO,SAASA,kBAAT,CAA4BC,IAA5B,EAAuC;AAC5C,SAAOC,gBAAQC,SAAR,CAAkBF,IAAlB,CAAP;AACD;;AAEM,SAASE,SAAT,CAAmBF,IAAnB,EAA+C;AACpD,SAAOG,mBAAMC,OAAN,CAAcJ,IAAd,KAAuBA,IAAI,CAACK,IAAL,KAAc,eAA5C;AACD;;AAQM,SAASC,aAAT,CAAuBC,KAAvB,EAAqD;AAC1D,SAAOJ,mBAAMK,MAAN,CAAa,EAClB,GAAGD,KADe;AAElBF,IAAAA,IAAI,EAAE;AAFY,GAAb,CAAP;AAID;;AAEM,MAAMI,SAAS,GAAG,CAACC,SAAD,EAAmBC,QAAnB,KAA6C,EAAEA,QAAQ,KAC1EC,kBAAUC,WAAV,CAAsBF,QAAtB,KAAmCV,gBAAQa,SAAR,CAAkBH,QAAlB,CADuC,CAAR,IAEnE,CAAC,CAACA,QAAQ,CAACI,IAAT,CAAcC,SAFmD,IAGnE,4BAAML,QAAQ,CAACI,IAAT,CAAcC,SAApB,EAA+BN,SAAS,CAACK,IAAV,CAAeC,SAA9C,CAHiE,CAA/D;;;;AAMA,SAASC,yBAAT,CAAmCC,QAAnC,EAAuDC,SAAvD,EAAyE;AAC9E,MAAIC,SAAS,GAAGD,SAAhB;;AACA,SAAO,IAAP,EAAa;AACX,UAAME,WAAW,GAAGH,QAAQ,CAACI,kBAAT,CAA4BF,SAAS,CAACG,GAAtC,CAApB;;AACA,QAAId,SAAS,CAACU,SAAD,EAAYE,WAAZ,CAAb,EAAuC;AACrC;AACD;;AACDD,IAAAA,SAAS,GAAGC,WAAZ;AACD;;AACD,SAAOD,SAAP;AACD,C,CAED;AACA;;;AACO,SAASI,mBAAT,CAA6BN,QAA7B,EAAiDO,QAAjD,EAAkE;AAEvE,QAAMC,qBAA8B,GAAG,EAAvC;AACA,MAAIC,YAA0B,GAAGF,QAAjC;;AACA,SAAO,IAAP,EAAa;AACX,QAAIE,YAAY,EAAEJ,GAAlB,EAAuB;AACrBG,MAAAA,qBAAqB,CAACE,OAAtB,CAA8BD,YAA9B;AACAA,MAAAA,YAAY,GAAGT,QAAQ,CAACI,kBAAT,CAA4BK,YAAY,CAACJ,GAAzC,CAAf;AACD;;AAED,QAAId,SAAS,CAACgB,QAAD,EAAWE,YAAX,CAAb,EAAuC;AACrC;AACD;AACF;;AAED,QAAME,QAAQ,GAAGC,sBAAStB,MAAT,CAAgB;AAC/BuB,IAAAA,KAAK,EAAEL;AADwB,GAAhB,CAAjB;;AAGA,SAAOG,QAAP;AACD;;AAEM,SAASG,WAAT,CAAqBhC,IAArB,EAAwD;AAC7D,SAAOC,gBAAQC,SAAR,CAAkBF,IAAlB,KAA2B,CAACA,IAAI,CAACe,IAAL,CAAUkB,IAAtC,KACLjC,IAAI,CAAC+B,KAAL,CAAWG,MAAX,KAAsB,CAAtB,IACClC,IAAI,CAAC+B,KAAL,CAAWG,MAAX,KAAsB,CAAtB,IAA2BC,kBAAKC,WAAL,CAAiBpC,IAAI,CAAC+B,KAAL,CAAW,CAAX,CAAjB,CAFvB,CAAP;AAID","sourcesContent":["import equal from 'fast-deep-equal';\nimport { Paragraph, ParagraphData, Heading } from '@ali/4ever-mo';\nimport { Document, Block, Node, BlockChildren, Text, BlockChild } from '@ali/4ever-cangjie';\n\nexport type Callout = Block<ParagraphData, BlockChildren>;\n\nexport function isCalloutParagraph(node: any) {\n  return Heading.isCallout(node);\n}\n\nexport function isCallout(node: any): node is Callout {\n  return Block.isBlock(node) && node.type === 'callout-group';\n}\n\nexport interface CalloutProps {\n  key?: string;\n  data: ParagraphData;\n  nodes?: BlockChild[];\n}\n\nexport function createCallout(props: CalloutProps): Callout {\n  return Block.create({\n    ...props,\n    type: 'callout-group',\n  });\n}\n\nexport const condition = (firstNode: Block, nextNode: Node | null) => !(nextNode\n  && (Paragraph.isParagraph(nextNode) || Heading.isHeading(nextNode))\n  && !!nextNode.data.calloutPr\n  && equal(nextNode.data.calloutPr, firstNode.data.calloutPr)\n);\n\nexport function findFirstBlockOfCalloutPr(document: Document, startNode: Block) {\n  let finalNode = startNode;\n  while (true) {\n    const prevSibling = document.getPreviousSibling(finalNode.key);\n    if (condition(startNode, prevSibling)) {\n      break;\n    }\n    finalNode = prevSibling as Heading | Paragraph;\n  }\n  return finalNode;\n}\n\n// 高亮块全选时复制生成 fragment\n// TODO: 外部复制，生成 HTML\nexport function generateClipCallout(document: Document, endBlock: Block) {\n\n  const shouldCutOrCopyBlocks: Block[] = [];\n  let currentBlock: Block | null = endBlock;\n  while (true) {\n    if (currentBlock?.key) {\n      shouldCutOrCopyBlocks.unshift(currentBlock);\n      currentBlock = document.getPreviousSibling(currentBlock.key) as (Block | null);\n    }\n\n    if (condition(endBlock, currentBlock)) {\n      break;\n    }\n  }\n\n  const fragment = Document.create({\n    nodes: shouldCutOrCopyBlocks,\n  });\n  return fragment;\n}\n\nexport function isEmptyNode(node: Block | null): node is Block {\n  return Heading.isCallout(node) && !node.data.list && (\n    node.nodes.length === 0 ||\n    (node.nodes.length === 1 && Text.isEmptyText(node.nodes[0]))\n  );\n}\n"],"file":"utils.js"}