{"version":3,"sources":["../../../../../src/plugins/callout/commands/setCalloutStickerCode.ts"],"names":["setCalloutStickerCode","controller","key","stickerCode","node","value","document","getNode","ColorBlocks","isColorBlocks","metadata","data","sticker","run","command","Commands","setNodeByKey"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AAEO,SAASA,qBAAT,CACLC,UADK,EAELC,GAFK,EAGLC,WAHK,EAIL;AACA,QAAMC,IAAI,GAAGH,UAAU,CAACI,KAAX,CAAiBC,QAAjB,CAA0BC,OAA1B,CAAkCL,GAAlC,CAAb;;AACA,MAAI,CAACM,oBAAYC,aAAZ,CAA0BL,IAA1B,CAAL,EAAsC;AACpC,WAAOH,UAAP;AACD;;AACD,QAAMS,QAAQ,GAAG,EACf,GAAGN,IAAI,CAACO,IAAL,CAAUD;AADE,GAAjB;;AAGA,MAAIP,WAAJ,EAAiB;AACfO,IAAAA,QAAQ,CAACE,OAAT,GAAmBT,WAAnB;AACD,GAFD,MAEO;AACL,WAAOO,QAAQ,CAACE,OAAhB;AACD;;AAEDX,EAAAA,UAAU,CAACY,GAAX,CAAe,UAAf,EAA2B,kCAAoBH,QAApB,CAA3B;AAEA,SAAOT,UAAU,CAACa,OAAX,CAAmBC,sBAASC,YAA5B,EAA0Cd,GAA1C,EAA+C;AACpDS,IAAAA,IAAI,EAAE,EACJ,GAAGP,IAAI,CAACO,IADJ;AAEJD,MAAAA;AAFI;AAD8C,GAA/C,CAAP;AAMD","sourcesContent":["import { Controller, Commands } from '@ali/4ever-cangjie';\nimport { ColorBlocks } from '@ali/4ever-mo';\nimport { broadcastDataChange } from '../actions';\n\nexport function setCalloutStickerCode(\n  controller: Controller,\n  key: string,\n  stickerCode?: string,\n) {\n  const node = controller.value.document.getNode(key);\n  if (!ColorBlocks.isColorBlocks(node)) {\n    return controller;\n  }\n  const metadata = {\n    ...node.data.metadata,\n  };\n  if (stickerCode) {\n    metadata.sticker = stickerCode;\n  } else {\n    delete metadata.sticker;\n  }\n\n  controller.run('onAction', broadcastDataChange(metadata));\n\n  return controller.command(Commands.setNodeByKey, key, {\n    data: {\n      ...node.data,\n      metadata,\n    },\n  });\n}\n"],"file":"setCalloutStickerCode.js"}