"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createInsertCallout = createInsertCallout;

var _everCangjie = require("@ali/4ever-cangjie");

var _everMo = require("@ali/4ever-mo");

var _everBamboo = require("@ali/4ever-bamboo");

function createInsertCallout(config) {
  return function insertCallout(controller, text = '', type = '') {
    const {
      selection,
      document
    } = controller.value;
    const {
      key: focusKey
    } = selection.focus;
    const targetNode = document.getClosestBlock(focusKey);
    const targetPath = targetNode && document.getPath(targetNode.key);

    if (!targetPath || !targetPath.length) {
      return controller;
    }

    const targetIndex = targetPath.pop();

    const colorBlock = _everMo.ColorBlocks.createColorBlocks({ ...(config.getDefaultSetting && config.getDefaultSetting()),
      ...(type ? {
        bgcolor: _everBamboo.CalloutPlugin.COLOR_MAP[type] || {}
      } : {})
    });

    controller.command(_everCangjie.Commands.insertNodeByPath, targetPath, targetIndex + 1, colorBlock).command(_everCangjie.Commands.moveToStartOfNode, colorBlock.nodes[0]);

    if ((0, _everBamboo.isEmptyParagraph)(targetNode)) {
      controller.command(_everCangjie.Commands.removeNodeByKey, targetNode.key);
    }

    return controller;
  };
}
//# sourceMappingURL=insertCallout.js.map