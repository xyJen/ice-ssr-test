"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.setMetaData = setMetaData;

var _everCangjie = require("@ali/4ever-cangjie");

var _everMo = require("@ali/4ever-mo");

var _actions = require("../actions");

function setMetaData(controller, key, data) {
  const node = controller.value.document.getNode(key);

  if (!_everMo.ColorBlocks.isColorBlocks(node)) {
    return controller;
  }

  if (typeof data?.color === 'string') {
    const {
      selection: range,
      document
    } = controller.value;

    const selection = _everCangjie.Selection.create(range.moveToRangeOfNode(node, controller).convertToTextPoints(document));

    controller.command(_everCangjie.Commands.select, selection);
    controller.dispatch('setColor', data?.color);
    controller.command(_everCangjie.Commands.moveToStart);
  }

  const newData = data || {};
  const metadata = { ...node.data.metadata,
    ...newData
  };
  controller.run('onAction', (0, _actions.broadcastDataChange)(metadata));
  return controller.command(_everCangjie.Commands.setNodeByKey, key, {
    data: { ...node.data,
      metadata
    }
  });
}
//# sourceMappingURL=setMetaData.js.map