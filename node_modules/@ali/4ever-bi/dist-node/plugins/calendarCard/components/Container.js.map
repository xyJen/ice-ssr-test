{"version":3,"sources":["../../../../../src/plugins/calendarCard/components/Container.tsx"],"names":["SubjectPlaceholder","TimePlaceholder","SubjectParagraph","TimeTextParagraph","PlaceTextParagraph","ReceiversParagraph","CommentTextParagraph","LoadingWrapper","ContainerWrapper","BodyWrapper","ExtraArea","CommentTextWrapper","CALENDAR_CARD_MAX_RECEIVER_WIDTH","CALENDAR_CARD_PADDING_LEN","CalendarCardPlugin","renderLoadingWrapper","props","widthRange","isLoading","text","throttleHandleStopPropagation","event","stopPropagation","leading","Container","React","memo","locale","metadata","width","isSelected","jumpToCalendar","openProfile","refresh","isMobile","isFirstLoaded","isChangeData","refreshTipsNode","handleCreateCalendar","createCalendarBtn","currentLoading","time","place","comment","subject","isPlaceholder","viewCalendardetails","refreshToast","refreshTips","innerWidth","undefined","subjectRange","containerStyle","height","jumpToCalendarFactory","eventType","JumpToCalendarEventType","DOUBLECLICK","handleStopPropagation","persist","className","useMemo","placeholder","subjectNode","subjectInnerWidth","timeNode","TITLE","RECEIVER","ICON"],"mappings":"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","sourcesContent":["import React, { useCallback, ReactNode, CSSProperties, useMemo } from 'react';\nimport { isNumber, throttle, memoize } from 'lodash-es';\nimport classnames from 'classnames';\nimport { CalendarCardPlugin } from '@ali/4ever-bamboo';\nimport { CalendarCardMetadataType, CommonMouseEvent, JumpToCalendarEventType } from '../types';\n\nconst {\n  SubjectPlaceholder,\n  TimePlaceholder,\n  SubjectParagraph,\n  TimeTextParagraph,\n  PlaceTextParagraph,\n  ReceiversParagraph,\n  CommentTextParagraph,\n  LoadingWrapper,\n  ContainerWrapper,\n  BodyWrapper,\n  ExtraArea,\n  CommentTextWrapper,\n  CALENDAR_CARD_MAX_RECEIVER_WIDTH,\n  CALENDAR_CARD_PADDING_LEN,\n} = CalendarCardPlugin;\n\ninterface IProps {\n  locale?: {\n    refresh: string;\n    refreshTips: string; // 日程卡片有更新\n    receiverCount: string; // 等{count}人参会\n    viewCalendardetails: string; // 查看日程详情\n    noresponse: string; // 未响应\n    received: string; // 已接收\n    refused: string; // 已拒绝\n    pending: string; // 待定\n    organizer: string; // 组织人\n  };\n  isChangeData?: boolean; // 有更新数据\n  isMobile?: boolean;\n  isFirstLoaded?: boolean;\n  isLoading?: boolean;\n  height: 'auto' | number;\n  width?: number;\n  isSelected?: boolean;\n  metadata?: CalendarCardMetadataType;\n  jumpToCalendar?: (eventType?: JumpToCalendarEventType) => void;\n  openProfile?: (uid: number) => void;\n  jumpToAttachment?: (url: string) => void;\n  refresh?: CommonMouseEvent;\n  handleCreateCalendar: () => void;\n  createCalendarBtn?: () => ReactNode;\n  refreshTipsNode?: string | ReactNode | null;\n}\n\ninterface IBizLoadingProps {\n  widthRange: string;\n  isLoading?: boolean;\n  text?: string | ReactNode;\n}\n\nconst renderLoadingWrapper = (props: IBizLoadingProps): ReactNode | string => {\n  const { widthRange, isLoading, text } = props;\n  if (isLoading && !text) return (<LoadingWrapper widthRange={widthRange} />);\n  return text || null;\n};\n\nconst throttleHandleStopPropagation = throttle((event: React.SyntheticEvent) => {\n  event.stopPropagation();\n}, 150, { leading: true });\n\nconst Container: React.FC<IProps> = React.memo((props) => {\n  const {\n    locale,\n    metadata,\n    width,\n    isSelected,\n    jumpToCalendar,\n    openProfile,\n    refresh,\n    isMobile,\n    isFirstLoaded,\n    isLoading,\n    isChangeData,\n    refreshTipsNode,\n    handleCreateCalendar,\n    createCalendarBtn,\n  } = props;\n  let currentLoading = isLoading;\n  if (isMobile || isFirstLoaded) currentLoading = false;\n  const { time, place, comment, subject = '', isPlaceholder } = metadata || {};\n  const { viewCalendardetails, refresh: refreshToast, refreshTips } = locale || {};\n\n  const innerWidth: 'auto' | number = (width === undefined || isMobile) ? 'auto' : (width - CALENDAR_CARD_PADDING_LEN * 2);\n  const subjectRange: number = isNumber(width) ? width : CALENDAR_CARD_MAX_RECEIVER_WIDTH;\n\n  const containerStyle = useMemo<CSSProperties>(() => ({\n    height: 'auto',\n    width: 'auto',\n  }), []);\n\n  const jumpToCalendarFactory = useCallback(memoize((eventType?: JumpToCalendarEventType) => {\n    return () => {\n      if (\n        isPlaceholder &&\n        handleCreateCalendar &&\n        JumpToCalendarEventType.DOUBLECLICK === eventType\n      ) {\n        handleCreateCalendar();\n        return;\n      }\n      if (!jumpToCalendar) return;\n      jumpToCalendar(eventType);\n    };\n  }), [isPlaceholder, handleCreateCalendar, jumpToCalendar]);\n\n  // FIX: 鼠标松开后卡片内选区消失的问题\n  const handleStopPropagation = useCallback((event: React.SyntheticEvent) => {\n    event.persist();\n    throttleHandleStopPropagation(event);\n  }, []);\n\n  const className: string = React.useMemo(() => classnames({\n    'card-calendar-selected': isSelected,\n    placeholder: isPlaceholder,\n  }), [isPlaceholder, isSelected]);\n\n  const subjectNode = isPlaceholder ? (\n    <SubjectPlaceholder onClick={handleCreateCalendar} >{subject}</SubjectPlaceholder>\n  ) : subject;\n  // 移动端增加 20px间距\n  const subjectInnerWidth: string | number = isMobile ? `calc(100% - ${CALENDAR_CARD_PADDING_LEN * 2 + 20}px)` : innerWidth;\n\n  const timeNode = isPlaceholder ? (\n    <TimePlaceholder onClick={handleCreateCalendar}>{time}</TimePlaceholder>\n  ) : time;\n\n  return (\n    <ContainerWrapper\n      className={className}\n      style={containerStyle}\n      onDoubleClick={jumpToCalendarFactory(JumpToCalendarEventType.DOUBLECLICK)}\n      onMouseDown={handleStopPropagation}\n      onClick={handleStopPropagation}\n    >\n      <BodyWrapper>\n        <SubjectParagraph\n          isPlaceholder={isPlaceholder}\n          innerWidth={subjectInnerWidth}\n          subject={renderLoadingWrapper({\n            widthRange: `${subjectRange * 0.75}px`,\n            isLoading: currentLoading,\n            text: subjectNode,\n          })}\n          jumpToCalendar={jumpToCalendarFactory(JumpToCalendarEventType.TITLE)}\n        />\n        <TimeTextParagraph>\n          {renderLoadingWrapper({\n            widthRange: '50%',\n            isLoading: currentLoading,\n            text: timeNode,\n          })}\n        </TimeTextParagraph>\n        {isPlaceholder ? null : (\n          <PlaceTextParagraph>\n            {renderLoadingWrapper({\n              widthRange: '50%',\n              isLoading: currentLoading,\n              text: place,\n            })}\n          </PlaceTextParagraph>\n        )}\n        <ReceiversParagraph\n          isLoading={currentLoading}\n          locale={locale}\n          metadata={metadata}\n          innerWidth={innerWidth}\n          openProfile={(isPlaceholder ? handleCreateCalendar : openProfile)}\n          jumpToCalendar={jumpToCalendarFactory(JumpToCalendarEventType.RECEIVER)}\n        />\n        {comment ? (\n          <CommentTextParagraph>\n            <CommentTextWrapper>\n              {comment}\n            </CommentTextWrapper>\n          </CommentTextParagraph>\n        ) : null}\n        <ExtraArea\n          tipsNode={refreshTipsNode}\n          isOnlyRefresh={isMobile}\n          isLoading={isLoading}\n          isPlaceholder={isPlaceholder}\n          createCalendarBtn={createCalendarBtn}\n          isChangeData={isChangeData}\n          viewCalendardetails={viewCalendardetails}\n          refreshToast={refreshToast}\n          refreshTips={refreshTips}\n          jumpToCalendar={jumpToCalendarFactory(JumpToCalendarEventType.ICON)}\n          refreshCalendar={refresh}\n        />\n      </BodyWrapper>\n    </ContainerWrapper>\n  );\n});\n\nexport default Container;\n"],"file":"Container.js"}