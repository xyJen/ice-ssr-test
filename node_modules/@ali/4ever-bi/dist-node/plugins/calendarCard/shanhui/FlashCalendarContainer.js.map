{"version":3,"sources":["../../../../../src/plugins/calendarCard/shanhui/FlashCalendarContainer.tsx"],"names":["TimePlaceholder","TimeTextParagraph","PlaceTextParagraph","ReceiversParagraph","CommentTextParagraph","LoadingWrapper","ContainerWrapper","BodyWrapper","ExtraArea","CommentTextWrapper","CALENDAR_CARD_PADDING_LEN","CalendarCardPlugin","renderLoadingWrapper","props","widthRange","isLoading","text","throttleHandleStopPropagation","event","stopPropagation","leading","FlashCalendarContainer","React","memo","locale","metadata","width","isSelected","jumpToCalendar","openProfile","refresh","isMobile","isFirstLoaded","isChangeData","refreshTipsNode","handleCreateCalendar","createCalendarBtn","currentLoading","time","place","comment","isPlaceholder","viewCalendardetails","refreshToast","refreshTips","innerWidth","undefined","containerStyle","height","jumpToCalendarFactory","eventType","JumpToCalendarEventType","DOUBLECLICK","handleStopPropagation","persist","className","useMemo","placeholder","timeNode","RECEIVER","ICON"],"mappings":"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","sourcesContent":["import React, { useCallback, ReactNode, CSSProperties, useMemo } from 'react';\nimport { throttle, memoize } from 'lodash-es';\nimport classnames from 'classnames';\nimport { CalendarCardPlugin } from '@ali/4ever-bamboo';\nimport { CalendarCardMetadataType, CommonMouseEvent, JumpToCalendarEventType } from '../types';\n\nconst {\n  TimePlaceholder,\n  TimeTextParagraph,\n  PlaceTextParagraph,\n  ReceiversParagraph,\n  CommentTextParagraph,\n  LoadingWrapper,\n  ContainerWrapper,\n  BodyWrapper,\n  ExtraArea,\n  CommentTextWrapper,\n  CALENDAR_CARD_PADDING_LEN,\n} = CalendarCardPlugin;\n\ninterface IProps {\n  locale?: {\n    refresh: string;\n    refreshTips: string; // 日程卡片有更新\n    receiverCount: string; // 等{count}人参会\n    viewCalendardetails: string; // 查看日程详情\n    noresponse: string; // 未响应\n    received: string; // 已接收\n    refused: string; // 已拒绝\n    pending: string; // 待定\n    organizer: string; // 组织人\n  };\n  isChangeData?: boolean; // 有更新数据\n  isMobile?: boolean;\n  isFirstLoaded?: boolean;\n  isLoading?: boolean;\n  height: 'auto' | number;\n  width?: number;\n  isSelected?: boolean;\n  metadata?: CalendarCardMetadataType;\n  jumpToCalendar?: (eventType?: JumpToCalendarEventType) => void;\n  openProfile?: (uid: number) => void;\n  jumpToAttachment?: (url: string) => void;\n  refresh?: CommonMouseEvent;\n  handleCreateCalendar: () => void;\n  createCalendarBtn?: () => ReactNode;\n  refreshTipsNode?: string | ReactNode | null;\n}\n\ninterface IBizLoadingProps {\n  widthRange: string;\n  isLoading?: boolean;\n  text?: string | ReactNode;\n}\n\nconst renderLoadingWrapper = (props: IBizLoadingProps): ReactNode | string => {\n  const { widthRange, isLoading, text } = props;\n  if (isLoading && !text) return (<LoadingWrapper widthRange={widthRange} />);\n  return text || null;\n};\n\nconst throttleHandleStopPropagation = throttle((event: React.SyntheticEvent) => {\n  event.stopPropagation();\n}, 150, { leading: true });\n\nconst FlashCalendarContainer: React.FC<IProps> = React.memo((props) => {\n  const {\n    locale,\n    metadata,\n    width,\n    isSelected,\n    jumpToCalendar,\n    openProfile,\n    refresh,\n    isMobile,\n    isFirstLoaded,\n    isLoading,\n    isChangeData,\n    refreshTipsNode,\n    handleCreateCalendar,\n    createCalendarBtn,\n  } = props;\n  let currentLoading = isLoading;\n  if (isMobile || isFirstLoaded) currentLoading = false;\n  const { time, place, comment, isPlaceholder } = metadata || {};\n  const { viewCalendardetails, refresh: refreshToast, refreshTips } = locale || {};\n\n  const innerWidth: 'auto' | number = (width === undefined || isMobile) ? 'auto' : (width - CALENDAR_CARD_PADDING_LEN * 2);\n\n  const containerStyle = useMemo<CSSProperties>(() => ({\n    height: 'auto',\n    width: 'auto',\n  }), []);\n\n  const jumpToCalendarFactory = useCallback(memoize((eventType?: JumpToCalendarEventType) => {\n    return () => {\n      if (\n        isPlaceholder &&\n        handleCreateCalendar &&\n        JumpToCalendarEventType.DOUBLECLICK === eventType\n      ) {\n        handleCreateCalendar();\n        return;\n      }\n      if (!jumpToCalendar) return;\n      jumpToCalendar(eventType);\n    };\n  }), [isPlaceholder, handleCreateCalendar, jumpToCalendar]);\n\n  // FIX: 鼠标松开后卡片内选区消失的问题\n  const handleStopPropagation = useCallback((event: React.SyntheticEvent) => {\n    event.persist();\n    throttleHandleStopPropagation(event);\n  }, []);\n\n  const className: string = React.useMemo(() => classnames({\n    'card-calendar-selected': isSelected,\n    placeholder: isPlaceholder,\n  }), [isPlaceholder, isSelected]);\n\n  const timeNode = isPlaceholder ? (\n    <TimePlaceholder onClick={handleCreateCalendar}>{time}</TimePlaceholder>\n  ) : time;\n\n  return (\n    <ContainerWrapper\n      className={className}\n      backgroundColor={isPlaceholder ? '#F9FAFC' : '#F0F7FF'}\n      style={containerStyle}\n      onDoubleClick={jumpToCalendarFactory(JumpToCalendarEventType.DOUBLECLICK)}\n      onMouseDown={handleStopPropagation}\n      onClick={handleStopPropagation}\n    >\n      <BodyWrapper>\n        <TimeTextParagraph>\n          {renderLoadingWrapper({\n            widthRange: '50%',\n            isLoading: currentLoading,\n            text: timeNode,\n          })}\n        </TimeTextParagraph>\n        {place ?\n          <PlaceTextParagraph>\n            {renderLoadingWrapper({\n              widthRange: '50%',\n              isLoading: currentLoading,\n              text: place,\n            })}\n          </PlaceTextParagraph> : null}\n        <ReceiversParagraph\n          isLoading={currentLoading}\n          locale={locale}\n          metadata={metadata}\n          innerWidth={innerWidth}\n          openProfile={(isPlaceholder ? handleCreateCalendar : openProfile)}\n          jumpToCalendar={jumpToCalendarFactory(JumpToCalendarEventType.RECEIVER)}\n        />\n        {comment ? (\n          <CommentTextParagraph>\n            <CommentTextWrapper>\n              {comment}\n            </CommentTextWrapper>\n          </CommentTextParagraph>\n        ) : null}\n        <ExtraArea\n          isShanhui\n          tipsNode={refreshTipsNode}\n          isOnlyRefresh={isMobile}\n          isLoading={isLoading}\n          isPlaceholder={isPlaceholder}\n          createCalendarBtn={createCalendarBtn}\n          isChangeData={isChangeData}\n          viewCalendardetails={viewCalendardetails}\n          refreshToast={refreshToast}\n          refreshTips={refreshTips}\n          jumpToCalendar={jumpToCalendarFactory(JumpToCalendarEventType.ICON)}\n          refreshCalendar={refresh}\n        />\n      </BodyWrapper>\n    </ContainerWrapper>\n  );\n});\n\nexport default FlashCalendarContainer;\n"],"file":"FlashCalendarContainer.js"}