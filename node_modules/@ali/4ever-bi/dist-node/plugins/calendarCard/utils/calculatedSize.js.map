{"version":3,"sources":["../../../../../src/plugins/calendarCard/utils/calculatedSize.tsx"],"names":["TotalWarpper","TimeTextParagraph","PlaceTextParagraph","SubjectParagraph","ReceiversParagraph","CommentTextParagraph","CommentTextWrapper","ContainerWrapper","BodyWrapper","getReceiversHeight","CALENDAR_CARD_SINGLE_LINE_HEIGHT","CalendarCardPlugin","getCalculatedReceivers","metadata","containerWidth","totalCount","topReceivers","receivers","organizer","innerWidth","locale","zhLocale","calendarCard","receiverCount","totalCountText","replace","String","maxHeight","index","len","length","currHeight","currReceivers","slice","singleLineHeight","calculatedSize","time","place","comment","subject","containerNode","width","height","result"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { calculatedPluginSize, CalendarCardPlugin } from '@ali/4ever-bamboo';\nimport zhLocale from '../../../locales/zh_CN';\nimport { CalendarCardMetadataType, IReceiver } from '../types';\n\nconst {\n  TotalWarpper,\n  TimeTextParagraph,\n  PlaceTextParagraph,\n  SubjectParagraph,\n  ReceiversParagraph,\n  CommentTextParagraph,\n  CommentTextWrapper,\n  ContainerWrapper,\n  BodyWrapper,\n  getReceiversHeight,\n  CALENDAR_CARD_SINGLE_LINE_HEIGHT,\n} = CalendarCardPlugin;\n\n/**\n * 计算应该返回的Receivers数量，标签以中文为准\n * 规则：只取前两行，其中最后一行显示为 等{count}人参会\n * @param receivers 参会人\n * @param organizer 组织者\n * @param containerWidth 容器宽度\n */\nexport function getCalculatedReceivers(\n  metadata: CalendarCardMetadataType,\n  containerWidth: number,\n  totalCount: number,\n): IReceiver[] {\n  const { topReceivers: receivers = [], organizer } = metadata;\n  const innerWidth = containerWidth - 52;// 实际容器宽度（border）\n  const { locale } = zhLocale.calendarCard;\n  const { receiverCount } = locale;\n\n  const totalCountText = receiverCount.replace('{count}', String(totalCount));\n  // 最大不超过 2 行\n  const maxHeight = (CALENDAR_CARD_SINGLE_LINE_HEIGHT || 1) * 3;\n  let index = -1; // 当前Receiver索引\n  const len = receivers.length;// 最大两行\n  let currHeight = CALENDAR_CARD_SINGLE_LINE_HEIGHT;\n  while (currHeight < maxHeight && index < len) {\n    index++;\n    const currReceivers = receivers.slice(0, index + 1);\n    currHeight = getReceiversHeight({\n      receivers: currReceivers, locale, totalCountText, singleLineHeight: CALENDAR_CARD_SINGLE_LINE_HEIGHT, innerWidth\n    });\n  }\n  if (index === (len - 1)) {\n    if (currHeight <= maxHeight) index += 1;\n  }\n  return receivers.slice(0, index);\n}\n\nexport async function calculatedSize(metadata: CalendarCardMetadataType, containerWidth: number): Promise<number> {\n  const { locale } = zhLocale.calendarCard;\n  const { time, place, comment, subject } = metadata;\n\n  const containerNode = (\n    <div style={{ width: `${containerWidth}px` }}>\n      <ContainerWrapper style={{ height: 'auto', width: 'auto' }}>\n        <BodyWrapper>\n          <SubjectParagraph\n            isReadonly\n            subject={subject}\n            metadata={metadata}\n          />\n          <TimeTextParagraph>{time}</TimeTextParagraph>\n          <PlaceTextParagraph>{place}</PlaceTextParagraph>\n          <ReceiversParagraph\n            isReadonly\n            locale={locale}\n            metadata={metadata}\n          />\n          {comment ? (\n            <CommentTextParagraph>\n              <CommentTextWrapper>{comment}</CommentTextWrapper>\n            </CommentTextParagraph>\n          ) : null}\n        </BodyWrapper>\n      </ContainerWrapper>\n    </div>\n  );\n  const result = await calculatedPluginSize(containerNode, containerWidth);\n  return result.height;\n}\n"],"file":"calculatedSize.js"}