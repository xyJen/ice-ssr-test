{"version":3,"sources":["../../../../../src/plugins/calendarCard/handlers/createOnCangjiePaste.ts"],"names":["createOnCangjiePaste","config","calendarCard","calendarCardConfig","mode","onCangjiePaste","event","controller","next","clipboardData","query","fragment","getFragment","isShanhui","CalendarType","SHANHUI","calendarNodes","nodes","filter","block","data","cardType","newFragment","set","map","height","command"],"mappings":";;;;;;;AACA;;AAEA;;AAEe,SAASA,oBAAT,CACbC,MADa,EAEa;AAC1B,QAAM;AAAEC,IAAAA,YAAY,EAAEC,kBAAkB,GAAG;AAArC,MAA4CF,MAAlD;AACA,QAAM;AAAEG,IAAAA;AAAF,MAAWD,kBAAjB;AAEA,SAAO,eAAeE,cAAf,CAA8BC,KAA9B,EAAqCC,UAArC,EAAiDC,IAAjD,EAAuD;AAC5D,UAAMC,aAAa,GAAGF,UAAU,CAACG,KAAX,CAAiB,kBAAjB,EAAqCJ,KAArC,CAAtB;AACA,UAAMK,QAAQ,GAAGF,aAAa,EAAEG,WAAf,EAAjB;AACA,QAAI,CAACD,QAAL,EAAe,OAAOH,IAAI,EAAX;AAEf,UAAMK,SAAS,GAAGT,IAAI,KAAKU,oBAAaC,OAAxC;AAEA,UAAMC,aAAa,GAAGL,QAAQ,CAACM,KAAT,CAAeC,MAAf,CACnBC,KAAD,IAAWA,KAAK,CAACC,IAAN,CAAWC,QAAX,KAAwB,UADf,CAAtB;;AAGA,QAAI,qBAAQL,aAAR,CAAJ,EAA4B;AAC1B,aAAOR,IAAI,EAAX;AACD;;AACD,UAAMc,WAAW,GAAGX,QAAQ,CAACY,GAAT,CAClB,OADkB,EAElBZ,QAAQ,CAACM,KAAT,CAAeO,GAAf,CAAoBL,KAAD,IAAW;AAC5B,UAAIA,KAAK,CAACC,IAAN,CAAWC,QAAX,KAAwB,UAA5B,EAAwC;AACtC,eAAOF,KAAK,CAACI,GAAN,CAAU,MAAV,EAAkB,EACvB,GAAGJ,KAAK,CAACC,IADc;AAEvBK,UAAAA,MAAM,EAAEZ,SAAS,GAAG,EAAH,GAAQ;AAFF,SAAlB,CAAP;AAID;;AACD,aAAOM,KAAP;AACD,KARD,CAFkB,CAApB;AAYAZ,IAAAA,UAAU,CAACmB,OAAX,CAAmB,2BAAnB,EAAgDJ,WAAhD;AACD,GA1BD;AA2BD","sourcesContent":["import { Plugin } from '@ali/4ever-cangjie';\nimport { isEmpty } from 'lodash-es';\nimport { BiPluginConfig } from '../../../types';\nimport { CalendarType } from '../types';\n\nexport default function createOnCangjiePaste(\n  config: BiPluginConfig,\n): Plugin['onCangjiePaste'] {\n  const { calendarCard: calendarCardConfig = {} } = config;\n  const { mode } = calendarCardConfig;\n\n  return async function onCangjiePaste(event, controller, next) {\n    const clipboardData = controller.query('getClipboardData', event);\n    const fragment = clipboardData?.getFragment();\n    if (!fragment) return next();\n\n    const isShanhui = mode === CalendarType.SHANHUI;\n\n    const calendarNodes = fragment.nodes.filter(\n      (block) => block.data.cardType === 'calendar',\n    );\n    if (isEmpty(calendarNodes)) {\n      return next();\n    }\n    const newFragment = fragment.set(\n      'nodes',\n      fragment.nodes.map((block) => {\n        if (block.data.cardType === 'calendar') {\n          return block.set('data', {\n            ...block.data,\n            height: isShanhui ? 75 : 102,\n          });\n        }\n        return block;\n      }),\n    );\n    controller.command(\"insertFragmentByClipboard\", newFragment);\n  };\n}\n"],"file":"createOnCangjiePaste.js"}