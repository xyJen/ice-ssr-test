{"version":3,"sources":["../../../../../src/plugins/quickInsert/handlers/onKeyDown.ts"],"names":["isEscHotkey","isBackspaceHotkey","onKeyDown","event","controller","next","command","remove","selection","decorations","value","quickInsertDecoration","find","mark","type","focus","moveBackward","offset","start"],"mappings":";;;;;;;;;AACA;;AACA;;AACA;;AAEA,MAAMA,WAAW,GAAG,uBAAY,KAAZ,CAApB;AACA,MAAMC,iBAAiB,GAAG,uBAAY,WAAZ,CAA1B;;AAEe,SAASC,SAAT,CACbC,KADa,EAEbC,UAFa,EAGbC,IAHa,EAIb;AACA,MAAI,uCAAyBD,UAAzB,CAAJ,EAA0C;AACxC,QAAIJ,WAAW,CAACG,KAAD,CAAf,EAAwB;AACtBC,MAAAA,UAAU,CAACE,OAAX,CAAmBC,eAAnB;AACD;;AAED,QAAIN,iBAAiB,CAACE,KAAD,CAArB,EAA8B;AAC5B,YAAM;AAAEK,QAAAA,SAAF;AAAaC,QAAAA;AAAb,UAA6BL,UAAU,CAACM,KAA9C;AAEA,YAAMC,qBAAqB,GAAGF,WAAW,CAACG,IAAZ,CAC5B,CAAC;AAAEC,QAAAA;AAAF,OAAD,KAAcA,IAAI,CAACC,IAAL,KAAc,cADA,CAA9B;;AAIA,UACGN,SAAS,CAAEO,KAAX,CAAiBC,YAAjB,EAAD,CAA+CC,MAA/C,KACAN,qBAAqB,CAAEO,KAAvB,CAA6BD,MAF/B,EAGE;AACA,eAAOb,UAAU,CAACE,OAAX,CAAmBC,eAAnB,CAAP;AACD;AACF;AACF;;AAED,SAAOF,IAAI,EAAX;AACD","sourcesContent":["import { Controller, TextPoint } from '@ali/4ever-cangjie';\nimport isKeyHotkey from 'is-hotkey';\nimport remove from '../commands/remove';\nimport isSelectionInQuickInsert from '../queries/isSelectionInQuickInsert';\n\nconst isEscHotkey = isKeyHotkey('esc');\nconst isBackspaceHotkey = isKeyHotkey('backspace');\n\nexport default function onKeyDown(\n  event: KeyboardEvent,\n  controller: Controller,\n  next: () => void,\n) {\n  if (isSelectionInQuickInsert(controller)) {\n    if (isEscHotkey(event)) {\n      controller.command(remove);\n    }\n\n    if (isBackspaceHotkey(event)) {\n      const { selection, decorations } = controller.value;\n\n      const quickInsertDecoration = decorations.find(\n        ({ mark }) => mark.type === 'quick-insert',\n      );\n\n      if (\n        (selection!.focus.moveBackward() as TextPoint).offset ===\n        quickInsertDecoration!.start.offset\n      ) {\n        return controller.command(remove);\n      }\n    }\n  }\n\n  return next();\n}\n"],"file":"onKeyDown.js"}