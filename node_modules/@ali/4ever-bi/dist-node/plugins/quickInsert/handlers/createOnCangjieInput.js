"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createOnCangjieInput;

var _insert = _interopRequireDefault(require("../commands/insert"));

var _remove = _interopRequireDefault(require("../commands/remove"));

var _isSelectionInQuickInsert = _interopRequireDefault(require("../queries/isSelectionInQuickInsert"));

function createOnCangjieInput(config, insertMap) {
  const {
    triggers
  } = config;
  return function onCangjieInput(event, controller, next) {
    const plugin = triggers[event.detail.data];

    if (!plugin || !insertMap[plugin]) {
      return next();
    }

    event.preventDefault();

    if ((0, _isSelectionInQuickInsert.default)(controller)) {
      const {
        decorations
      } = controller.value; // 若此时仍尝试呼出相同插入，则重新呼出

      const quickInsertDecoration = decorations.find(({
        mark
      }) => mark.type === 'quick-insert');

      if (quickInsertDecoration.mark.data.plugin === plugin) {
        return controller.command(_remove.default).command(_insert.default, {
          plugin
        });
      }

      return next();
    }

    return controller.command(_insert.default, {
      plugin
    });
  };
}
//# sourceMappingURL=createOnCangjieInput.js.map