{"version":3,"sources":["../../../../../src/plugins/quickInsert/handlers/onSelect.ts"],"names":["onSelect","_","controller","next","value","selection","decorations","document","insertMention","find","item","mark","type","isCollapsed","start","getStart","end","getEnd","offset","command","remove"],"mappings":";;;;;;;;;AACA;;AAEe,SAASA,QAAT,CACbC,CADa,EAEbC,UAFa,EAGbC,IAHa,EAIb;AACA,QAAM;AAAEC,IAAAA;AAAF,MAAYF,UAAlB;AACA,QAAM;AAAEG,IAAAA,SAAF;AAAaC,IAAAA,WAAb;AAA0BC,IAAAA;AAA1B,MAAuCH,KAA7C;AACA,QAAMI,aAAa,GAAGF,WAAW,CAACG,IAAZ,CACnBC,IAAD,IAAUA,IAAI,CAACC,IAAL,CAAUC,IAAV,KAAmB,cADT,CAAtB;;AAIA,MAAI,CAACP,SAAL,EAAgB;AACd,WAAOF,IAAI,EAAX;AACD;;AAED,MAAI,CAACE,SAAS,CAACQ,WAAf,EAA4B;AAC1B,WAAOV,IAAI,EAAX;AACD;;AAED,QAAMW,KAAK,GAAGT,SAAS,CAACU,QAAV,CAAmBR,QAAnB,CAAd;AACA,QAAMS,GAAG,GAAGX,SAAS,CAACY,MAAV,CAAiBV,QAAjB,CAAZ;;AAEA,MAAIC,aAAJ,EAAmB;AACjB,QACEM,KAAK,CAACI,MAAN,GAAeV,aAAa,CAACQ,GAAd,CAAkBE,MAAjC,IACAF,GAAG,CAACE,MAAJ,GAAaV,aAAa,CAACM,KAAd,CAAoBI,MAFnC,EAGE;AACA,aAAOhB,UAAU,CAACiB,OAAX,CAAmBC,eAAnB,CAAP;AACD;AACF;;AACD,SAAOjB,IAAI,EAAX;AACD","sourcesContent":["import { Controller, TextPoint } from '@ali/4ever-cangjie';\nimport remove from '../commands/remove';\n\nexport default function onSelect(\n  _: KeyboardEvent,\n  controller: Controller,\n  next: () => void,\n) {\n  const { value } = controller;\n  const { selection, decorations, document } = value;\n  const insertMention = decorations.find(\n    (item) => item.mark.type === 'quick-insert',\n  );\n\n  if (!selection) {\n    return next();\n  }\n\n  if (!selection.isCollapsed) {\n    return next();\n  }\n\n  const start = selection.getStart(document) as TextPoint;\n  const end = selection.getEnd(document) as TextPoint;\n\n  if (insertMention) {\n    if (\n      start.offset > insertMention.end.offset ||\n      end.offset < insertMention.start.offset\n    ) {\n      return controller.command(remove);\n    }\n  }\n  return next();\n}\n"],"file":"onSelect.js"}