{"version":3,"sources":["../../../../../src/plugins/image/handlers/createContextMenu.ts"],"names":["createContextMenu","config","sideBarTrigger","locale","contextMenu","controller","next","document","selection","value","isCollapsed","start","getStart","end","getEnd","node1","getNextText","key","node2","getPreviousText","closeContextMenu","onActionController","run","PcContextMenu","node","getClosestVoid","Image","isImage","name","options","action","toggle","callback","group"],"mappings":";;;;;;;AACA;;AACA;;AACA;;AAIA,SAASA,iBAAT,CAA2BC,MAA3B,EAAsDC,cAAtD,EAAoH;AAClH,QAAM;AAAEC,IAAAA,MAAM,GAAG;AAAX,MAAkBF,MAAxB;AAEA,SAAO,SAASG,WAAT,CAAqBC,UAArB,EAAiCC,IAAjC,EAAuC;AAC5C,UAAM;AAAEC,MAAAA,QAAF;AAAYC,MAAAA;AAAZ,QAA0BH,UAAU,CAACI,KAA3C;AACA,UAAM;AAAEC,MAAAA;AAAF,QAAkBF,SAAxB;;AACA,QAAI,CAACE,WAAD,IAAgBR,cAApB,EAAoC;AAClC,YAAMS,KAAK,GAAGH,SAAS,CAACI,QAAV,CAAmBL,QAAnB,CAAd;AACA,YAAMM,GAAG,GAAGL,SAAS,CAACM,MAAV,CAAiBP,QAAjB,CAAZ;AACA,YAAMQ,KAAK,GAAGR,QAAQ,CAACS,WAAT,CAAqBL,KAAK,CAACM,GAA3B,CAAd;AACA,YAAMC,KAAK,GAAGX,QAAQ,CAACY,eAAT,CAAyBN,GAAG,CAACI,GAA7B,CAAd;;AACA,YAAMG,gBAAgB,GAAIC,kBAAD,IAAoC;AAC3DA,QAAAA,kBAAkB,CAACC,GAAnB,CAAuB,UAAvB,EAAmCC,0BAAcH,gBAAd,EAAnC;AACD,OAFD;;AAGA,UAAIL,KAAK,IAAIG,KAAT,IAAkBH,KAAK,KAAKG,KAAhC,EAAuC;AACrC,cAAMM,IAAI,GAAGjB,QAAQ,CAACkB,cAAT,CAAwBV,KAAK,CAACE,GAA9B,EAAmCZ,UAAnC,CAAb;;AACA,YAAIqB,cAAMC,OAAN,CAAcH,IAAd,CAAJ,EAAyB;AACvB,iBAAO,CACL,GAAGlB,IAAI,EADF,EAEL;AACEsB,YAAAA,IAAI,EAAEzB,MAAM,EAAE0B,OAAR,IAAmB,eAD3B;AAEEZ,YAAAA,GAAG,EAAE,eAFP;AAGEa,YAAAA,MAAM,EAAE,iCAAmB;AAAEN,cAAAA,IAAF;AAAQO,cAAAA,MAAM,EAAE,IAAhB;AAAsBC,cAAAA,QAAQ,EAAEZ;AAAhC,aAAnB,CAHV;AAIES,YAAAA,OAAO,EAAE;AACPI,cAAAA,KAAK,EAAE;AADA;AAJX,WAFK,CAAP;AAWD;AACF;AACF;;AACD,WAAO3B,IAAI,EAAX;AACD,GA7BD;AA8BD;;eAEcN,iB","sourcesContent":["import { Plugin, Controller } from '@ali/4ever-cangjie';\nimport { Image } from '@ali/4ever-mo';\nimport { PcContextMenu } from '@ali/4ever-bamboo';\nimport { toggleImageSidebar } from '../actions';\nimport { ImagePluginConfig } from '../types';\nimport { SidebarTriggerConfig } from '../../../types';\n\nfunction createContextMenu(config: ImagePluginConfig, sideBarTrigger?: SidebarTriggerConfig): Plugin['contextMenu'] {\n  const { locale = {} } = config;\n\n  return function contextMenu(controller, next) {\n    const { document, selection } = controller.value;\n    const { isCollapsed } = selection;\n    if (!isCollapsed && sideBarTrigger) {\n      const start = selection.getStart(document);\n      const end = selection.getEnd(document);\n      const node1 = document.getNextText(start.key);\n      const node2 = document.getPreviousText(end.key);\n      const closeContextMenu = (onActionController: Controller) => {\n        onActionController.run('onAction', PcContextMenu.closeContextMenu());\n      };\n      if (node1 && node2 && node1 === node2) {\n        const node = document.getClosestVoid(node1.key, controller);\n        if (Image.isImage(node)) {\n          return [\n            ...next(),\n            {\n              name: locale?.options || 'Image options',\n              key: 'image-options',\n              action: toggleImageSidebar({ node, toggle: true, callback: closeContextMenu }),\n              options: {\n                group: 2,\n              },\n            },\n          ];\n        }\n      }\n    }\n    return next();\n  };\n}\n\nexport default createContextMenu;\n"],"file":"createContextMenu.js"}