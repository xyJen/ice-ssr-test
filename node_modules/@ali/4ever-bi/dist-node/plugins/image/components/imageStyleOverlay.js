"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ImageStyleOverlay = void 0;

var _react = _interopRequireDefault(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _everBamboo = require("@ali/4ever-bamboo");

var _recommendStyleItems = require("./recommendStyleItems");

var _actions = require("../actions");

var _isStyleActive = require("../utils/isStyleActive");

const _createElement = /*#__PURE__*/_react.default.createElement;

const OverlayWrapper = /*#__PURE__*/_styledComponents.default.div(["width:186px;padding:10px 10px 0 10px;"]);

const Footer = /*#__PURE__*/_styledComponents.default.div(["margin-top:9px;border-top:1px solid rgba(126,134,142,0.16);font-size:13px;line-height:32px;text-align:center;color:#0089FF;height:32px;cursor:pointer;"]);

const ImageStyleOverlay = props => {
  const {
    controller,
    getImageNode,
    locale,
    onClick
  } = props;
  const image = getImageNode();

  const [data, setData] = _react.default.useState(image?.data || _everBamboo.ImagePlugin.DEFAULT_STYLE);

  const handleClean = _react.default.useCallback(() => {
    const image = getImageNode();

    if (!image) {
      return;
    }

    controller.run('onAction', (0, _actions.updateImage)(image, _everBamboo.ImagePlugin.DEFAULT_STYLE));
    setData(_everBamboo.ImagePlugin.DEFAULT_STYLE);
    onClick && onClick();
  }, [image, controller, onClick]);

  const handleClick = newData => {
    const image = getImageNode();
    if (!image) return;

    if ((0, _isStyleActive.isStyleActive)(newData, image.data)) {
      controller.run('onAction', (0, _actions.updateImage)(image, _everBamboo.ImagePlugin.DEFAULT_STYLE));
      setData(_everBamboo.ImagePlugin.DEFAULT_STYLE);
    } else {
      controller.run('onAction', (0, _actions.updateImage)(image, newData));
      setData(newData);
    }

    onClick && onClick();
  };

  return image ? /*#__PURE__*/_createElement(OverlayWrapper, {
    "data-testid": "overlay-image-style-menu"
  }, /*#__PURE__*/_createElement(_recommendStyleItems.RecommendStyleMenu, {
    onClick: handleClick,
    data: data,
    size: _recommendStyleItems.RecommendStyleMenuType.SMALL
  }), /*#__PURE__*/_createElement(Footer, {
    "data-testid": "image-toolbar-clear-style",
    "data-role": _everBamboo.PluginRoles.imageClearStyle,
    onClick: handleClean
  }, locale.clearStyle)) : null;
};

exports.ImageStyleOverlay = ImageStyleOverlay;
//# sourceMappingURL=imageStyleOverlay.js.map