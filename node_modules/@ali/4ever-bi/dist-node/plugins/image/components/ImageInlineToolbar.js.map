{"version":3,"sources":["../../../../../src/plugins/image/components/ImageInlineToolbar.tsx"],"names":["inlineToolbarOverlayStyle","backgroundColor","boxShadow","border","inlineToolbarStyle","padding","borderRadius","getToolButton","name","icon","handleClick","testid","role","controller","node","handleClickWithController","event","props","ImageInlineToolbar","React","Component","constructor","mutationObserver","observerCallback","mutationsList","parentDOM","ignoreMuation","every","mutation","shouldIgnoreMutation","setState","key","Math","random","handlepreview","e","preventDefault","stopPropagation","previewImage","src","data","handledeleteImg","run","handleCorp","isImageCropping","handleDownload","downloadImage","handlePreview","getCustomToolbar","customToolbars","extraData","getMoreMenuButton","inlineToolbarMore","getScrollableContent","getCustomToolButtons","locale","handleInlineToolbarRotate","handleInlineToolbarRotateAntiClockwise","cropping","PluginRoles","imageInlineToolbarCrop","downloadImg","imageInlineToolbarDownload","previewImg","imageInlineToolbarPreview","rotateAntiClockwise","rotate","imageInlineToolbarRotate","imageInlineToolbarSingleRotateReverse","getToolButtonFromConfig","config","buttons","state","componentDidMount","initMutationObserver","componentWillUnmount","disconnect","cancel","root","type","target","attributeName","res","current","document","body","targetKey","getAttribute","parentElement","parent","value","getParent","domUtils","findDOMNodeSafely","MutationObserver","observe","childList","attributes","subtree","attributeFilter","render","visible","triggerNode","inlineToolbarLayout","customToolButtonConfig","customToolLayout","environment","IS_TOUCH_DEVICE"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { debounce } from 'lodash-es';\nimport { Controller, Inline, environment, domUtils } from '@ali/4ever-cangjie';\nimport { ImagePlugin, PluginRoles } from '@ali/4ever-bamboo';\nimport { IconButton as Button, MoreButton } from '@ali/we-toolbar';\nimport {\n  RotatepictureNormal as CounterclockwiseNormal,\n  Rotate90Normal as ClockwiseNormal,\n  CutNormal as CutPicNormal,\n  DownloadpicturenewNormal as SelectDownloadNormal,\n  RotateLeftLineThinNormal,\n} from '@ali/we-icon';\nimport {\n  PreviewBetaNormal,\n  Menu,\n} from '@ali/we-design';\n\nimport { removeImage, setImageInjection } from '../actions';\nimport { InlineToolbar } from '../../../index';\nimport { getData } from '@ali/4ever-utils';\nimport { CustomToolButtonConfig } from '../types';\nimport TextButton from './TextButton';\nimport { TYPE_MENU_DATA, Menu as EditorMenu } from '@ali/4ever-component';\n\nconst inlineToolbarOverlayStyle = {\n  backgroundColor: 'transparent',\n  boxShadow: 'none',\n  border: 'none',\n};\n\nconst inlineToolbarStyle = {\n  border: 'none',\n  boxShadow: '0px 0px 1px rgb(0 0 0 / 24%), 0px 8px 24px rgb(0 0 0 / 16%)',\n  padding: '0 5px',\n  borderRadius: '4px',\n};\n\nexport interface ImageToolbarProps {\n  controller: Controller;\n  node: Inline;\n  locale: ImagePlugin.ILocale | Record<string, any>;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  handleInlineToolbarRotate(e: any): void;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  handleInlineToolbarRotateAntiClockwise(e: any): void;\n  previewImage(url: string, node: Inline): void;\n  downloadImage(url: string): void;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  onEnterCroppingMode(e: any): void;\n  getZoomContainer(): HTMLElement | null;\n  getScrollableContent(): HTMLElement;\n  triggerNode: HTMLElement | null;\n  visible?: boolean;\n  inlineToolbarLayout?: any;\n  customToolbars?: {\n    customToolButtonConfig: CustomToolButtonConfig;\n    customToolLayout: any;\n  };\n  inlineToolbarMore?: TYPE_MENU_DATA;\n}\n\nexport interface ImageToolbarState {\n  key: string;\n}\n\nexport const getToolButton = (\n  name: string | undefined,\n  icon: React.ReactNode,\n  handleClick: (event: React.MouseEvent, controller?: Controller, node?: any) => any,\n  testid: string,\n  role: string,\n  controller?: Controller,\n  node?: any,\n) => {\n  const handleClickWithController = (event) => {\n    return handleClick(event, controller, node);\n  };\n  return (props) => {\n    if (!icon) {\n      return <TextButton name={name} testid={testid} role={role} handleClick={handleClickWithController} />;\n    }\n    return (\n      <Button\n        {...props}\n        testid={testid}\n        onClick={handleClickWithController}\n        title={name}\n        tooltip={name}\n        bordered={false}\n        icon={icon}\n        role={role}\n      />\n    );\n  };\n};\n\nclass ImageInlineToolbar extends React.Component<ImageToolbarProps, ImageToolbarState> {\n  private mutationObserver: MutationObserver | null = null;\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      key: 'image-inline-toolbar-0',\n    };\n  }\n\n  componentDidMount() {\n    this.initMutationObserver();\n  }\n\n  componentWillUnmount() {\n    this.mutationObserver?.disconnect();\n    this.observerCallback.cancel();\n  }\n\n  shouldIgnoreMutation(mutation: MutationRecord, root: HTMLElement) {\n    const { type, target, attributeName } = mutation;\n    const { key } = this.props.node;\n    let res = false;\n    if (type === 'attributes' && attributeName === 'style') {\n      let current: HTMLElement | null = target as HTMLElement;\n      while (current && current !== root && current !== document.body) {\n        const targetKey = current.getAttribute('data-cangjie-key');\n        if (key === targetKey) {\n          res = true;\n          break;\n        }\n        current = current.parentElement;\n      }\n    }\n    return res;\n  }\n\n  observerCallback = debounce((mutationsList: MutationRecord[], parentDOM: HTMLElement) => {\n    const ignoreMuation = mutationsList.every((mutation: MutationRecord) => this.shouldIgnoreMutation(mutation, parentDOM));\n    if (!ignoreMuation) {\n      this.setState({\n        key: `image-inline-toolbar-${Math.random()}`,\n      });\n    }\n  }, 200);\n\n  initMutationObserver() {\n    const { node, getScrollableContent } = this.props;\n    const parent = this.props.controller.value.document.getParent(node.key);\n    const root = getScrollableContent();\n    const parentDOM = parent && domUtils.findDOMNodeSafely(parent.key, root);\n    if (!parentDOM) {\n      return;\n    }\n\n    this.mutationObserver = new MutationObserver((mutationsList) => {\n      this.observerCallback(mutationsList, parentDOM);\n    });\n    this.mutationObserver.observe(parentDOM, {\n      childList: true,\n      attributes: true,\n      subtree: true,\n      attributeFilter: ['style'],\n    });\n  }\n\n  handlepreview = e => {\n    e.preventDefault();\n    e.stopPropagation();\n    const { node, previewImage } = this.props;\n    if (previewImage) {\n      const { src } = node.data;\n      previewImage(src, node);\n    }\n  };\n\n  handledeleteImg = e => {\n    e.preventDefault();\n    e.stopPropagation();\n    const { controller, node } = this.props;\n    controller.run('onAction', removeImage(node));\n  };\n\n  private readonly handleCorp = (event: React.MouseEvent) => {\n    const { controller, node } = this.props;\n    event.preventDefault();\n    event.stopPropagation();\n    controller.run(\n      'onAction',\n      setImageInjection(node.key, {\n        isImageCropping: true,\n      }),\n    );\n  };\n\n  private readonly handleDownload = (event: React.MouseEvent) => {\n    const { downloadImage, node } = this.props;\n    event.preventDefault();\n    event.stopPropagation();\n    if (downloadImage) {\n      const { src } = node.data;\n      downloadImage(src);\n    }\n  };\n\n  private readonly handlePreview = (event: React.MouseEvent) => {\n    const { previewImage, node } = this.props;\n    event.preventDefault();\n    event.stopPropagation();\n    if (previewImage) {\n      const { src } = node.data;\n      previewImage(src, node);\n    }\n  };\n\n  getCustomToolbar = (node, customToolbars) => {\n    const extraData = getData(node.data, 'extraData', {} as any);\n    for (const key in customToolbars) {\n      if (extraData[key]) {\n        return customToolbars[key];\n      }\n    }\n    return null;\n  };\n\n  getMoreMenuButton = () => {\n    const { inlineToolbarMore, getScrollableContent } = this.props;\n    return () => {\n      if (!inlineToolbarMore) {\n        return null;\n      }\n      return (\n        <MoreButton\n          testid=\"image-inline-more-dropdown\"\n          getContainer={getScrollableContent}\n          placement=\"bottomLeft\"\n          offsetY={0}\n          overlay={\n            <Menu\n              getContainer={getScrollableContent}\n              testid=\"image-inline-more-menu\"\n            >\n              <EditorMenu\n                menus={inlineToolbarMore}\n              />\n            </Menu>\n          }\n        />\n      );\n    };\n  };\n\n  getCustomToolButtons = () => {\n    const {\n      locale,\n      handleInlineToolbarRotate,\n      handleInlineToolbarRotateAntiClockwise,\n      downloadImage,\n      previewImage,\n    } = this.props;\n\n    return {\n      'image.crop': getToolButton(locale.cropping, <CutPicNormal />, this.handleCorp, 'bi-toolbar-image-crop', PluginRoles.imageInlineToolbarCrop),\n      'image.download': !downloadImage\n        ? null\n        : getToolButton(locale.downloadImg, <SelectDownloadNormal />, this.handleDownload, 'bi-toolbar-image-download', PluginRoles.imageInlineToolbarDownload),\n      'image.preview': !previewImage\n        ? null\n        : getToolButton(locale.previewImg, <PreviewBetaNormal />, this.handlePreview, 'bi-toolbar-image-preview', PluginRoles.imageInlineToolbarPreview),\n      'image.rotateReverse': getToolButton(\n        locale.rotateAntiClockwise,\n        <CounterclockwiseNormal />,\n        handleInlineToolbarRotateAntiClockwise,\n        'bi-toolbar-image-rotateReverse',\n        'imageInlineToolbarRotateReverse',\n      ),\n      'image.rotate': getToolButton(locale.rotate, <ClockwiseNormal />, handleInlineToolbarRotate, 'bi-toolbar-image-rotate', PluginRoles.imageInlineToolbarRotate),\n      'image.singeRotateReverse': getToolButton(\n        locale.rotateAntiClockwise,\n        <RotateLeftLineThinNormal />,\n        handleInlineToolbarRotateAntiClockwise,\n        'bi-toolbar-image-rotateReverse',\n        PluginRoles.imageInlineToolbarSingleRotateReverse,\n      ),\n      'image.more': this.getMoreMenuButton(),\n    };\n  };\n\n  getToolButtonFromConfig = (config: CustomToolButtonConfig) => {\n    const { controller, node } = this.props;\n    const buttons = {};\n    // eslint-disable-next-line guard-for-in\n    for (const key in config) {\n      const { name, icon, handleClick, testid, role } = config[key];\n      buttons[key] = getToolButton(name, icon, handleClick, testid, role, controller, node);\n    }\n    return buttons;\n  };\n\n  render() {\n    const { visible, triggerNode, inlineToolbarLayout, node, customToolbars } = this.props;\n    const { customToolButtonConfig, customToolLayout } = this.getCustomToolbar(node, customToolbars) || {};\n    // 狗姐：所有 inlineToolbar 样式和极简模式 inlineToolbar 保持一致，先从图片开刀\n    // 图片比较紧急，所以基于原来的 inlineToolbar 修改样式，而暂未使用新 inlineToolbar\n    return (\n      <InlineToolbar\n        key={this.state.key}\n        style={inlineToolbarStyle}\n        overlayStyle={inlineToolbarOverlayStyle}\n        visible={visible}\n        triggerNode={triggerNode}\n        inlineLayout={customToolLayout || inlineToolbarLayout}\n        customToolButtons={\n          customToolButtonConfig ?\n            this.getToolButtonFromConfig(customToolButtonConfig) : this.getCustomToolButtons()\n        }\n        offsetY={environment.IS_TOUCH_DEVICE ? -22 : -12}\n        testid=\"image\"\n      />\n    );\n  }\n}\n\nexport default ImageInlineToolbar;\n"],"file":"ImageInlineToolbar.js"}