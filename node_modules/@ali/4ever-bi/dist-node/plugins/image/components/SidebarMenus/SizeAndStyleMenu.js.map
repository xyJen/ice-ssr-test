{"version":3,"sources":["../../../../../../src/plugins/image/components/SidebarMenus/SizeAndStyleMenu.tsx"],"names":["ACCURACY","MAX_FIXED_WIDTH","MIN_FIXED_WIDTH","COLUMN_GAP","CustomButton","styled","div","RotateButton","MenuLine","MenuWrapper","ButtonsBox","processNumber","num","maxNumber","accuracy","realNumber","Math","min","getZoomRectClip","rectClip","ratio","left","right","top","bottom","SizeAndStyleMenu","props","controller","config","value","disableStretchMode","locale","zhLocale","image","node","ImagePlugin","useFocusImage","type","getInlinesByType","at","rotation","data","src","radius","DEFAULT_RADIUS","container","width","height","React","useMemo","memoRealWidth","memoRealHeight","isValidSize","dom","domUtils","findDOMNodeSafely","key","window","imageWrapper","querySelector","IMAGE_DATA_WRAPPER_CLASS_NAME","rect","getBoundingClientRect","UnitConvert","pix2cm","realWidth","realHeight","fixedMaxWidth","fixedMaxHeight","memoFixedMaxWidth","memoFixedMaxHeight","maxWidth","getImageMaxWidth","maxHeight","widthInCM","heightInCM","maxWidthInCM","maxHeightInCM","fixedMinWidth","fixedMinHeight","handleWidthChange","useCallback","change","px","cm2pix","newWidth","newHeight","zoomRatio","newData","run","logger","sum","handleHeightChange","handleRotationChange","newRotation","handleReverseRotate90","handleRotate90","handleRestore","then","resetWidth","resetHeight","newPayload","RESTORE_DATA","handleRadiusChange","inputNumberStyle","flex","restoreStyle","marginTop","textAlign","isInvalidSize","PluginRoles","imageSidebarWidthInput","imageSidebarHeightInput","rotateInput","imageSidebarRotationInput","rotateAntiClockwise","imageSidebarReverseRotate90","rotate","imageSidebarRotate90","rotate90","border","borderInput","imageSidebarRadiusInput","blockEvent","imageSidebarRestore","resetTitle"],"mappings":"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","sourcesContent":["import React from 'react';\nimport styled from 'styled-components';\nimport { Tooltip } from '@ali/we-design';\nimport { ImagePlugin, UnitConvert, InputNumberItem, CustomInputNumberItem, PluginRoles } from '@ali/4ever-bamboo';\nimport { Controller, Inline, domUtils, useZoomContainer } from '@ali/4ever-cangjie';\nimport logger from '@ali/4ever-logger';\nimport { normalizeAngle, blockEvent } from '@ali/4ever-utils';\nimport getImageSize from '../../utils/getImageSize';\nimport { ImageData } from '@ali/4ever-mo';\nimport { updateImage } from '../../actions';\nimport { ImageBorder } from '../../components/imageButton';\nimport type { ImagePluginConfig } from '../../types';\nimport zhLocale from '../../../../locales/zh_CN';\nimport { RESTORE_DATA } from '../../constants';\nimport { getFixedNumber } from '../../utils';\n\nconst ACCURACY = 2;\nconst MAX_FIXED_WIDTH = 167;\n// 24 / 37.7952755906 = 0.6349999999991798\nconst MIN_FIXED_WIDTH = 0.63;\nconst COLUMN_GAP = 36;\n\nexport interface ISizeAndStyleMenuProps {\n  controller: Controller;\n  config: ImagePluginConfig;\n}\n\nconst CustomButton = styled.div`\n  padding: 4px 6px;\n  line-height: 20px;\n  border: 1px solid rgba(0,0,0,0.16);\n  border-radius: 4px;\n  font-size: 12px;\n  color: rgb(17, 31, 44);\n  transition: border-color 0.3s ease-in-out;\n  cursor: default;\n  &:hover {\n    border: 1px solid #0089ff;\n  }\n`;\n\nconst RotateButton = styled(CustomButton)`\n  display: flex;\n  width: 28px;\n  height: 28px;\n  align-items: center;\n  justify-content: center;\n  padding: 0;\n`;\n\nconst MenuLine = styled.div`\n  display: grid;\n  grid-template-columns: calc(50% - ${COLUMN_GAP / 2}px) calc(50% - ${COLUMN_GAP / 2}px);\n  grid-column-gap: ${COLUMN_GAP}px;\n  ${RotateButton} + ${RotateButton} {\n    margin-left: 6px;\n  }\n`;\n\nconst MenuWrapper = styled.div`\n  position: relative;\n  ${MenuLine} + ${MenuLine} {\n    margin-top: 12px;\n  }\n`;\n\nconst ButtonsBox = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: flex-start;\n  align-items: center;\n`;\n\nfunction processNumber(num: number, maxNumber: number, accuracy: number = ACCURACY) {\n  const realNumber = Math.min(maxNumber, num);\n  return getFixedNumber(realNumber, accuracy);\n}\n\nfunction getZoomRectClip(rectClip: ImageData['rectClip'], ratio: number) {\n  const { left = 0, right = 0, top = 0, bottom = 0 } = rectClip || {};\n  if (left || right || top || bottom) {\n    return {\n      rectClip: {\n        left: left * ratio,\n        right: right * ratio,\n        top: top * ratio,\n        bottom: bottom * ratio,\n      },\n    };\n  }\n  return {\n    rectClip,\n  };\n}\n\n\nconst SizeAndStyleMenu = (props: ISizeAndStyleMenuProps) => {\n  const { controller, config } = props;\n  const { value } = controller;\n  const { disableStretchMode, locale = zhLocale.image.locale } = config;\n  const node = ImagePlugin.useFocusImage(controller);\n  // 通过右键菜单打开右侧面板时，是选中 text image text，因此不一定直接选中图片\n  // @ts-ignore\n  const image = node?.type === 'image' ? node : node?.getInlinesByType('image')?.at(0) || node;\n  const rotation = node?.data?.rotation || 0;\n  const src = node?.data?.src;\n  const radius = node?.data?.radius || ImagePlugin.DEFAULT_RADIUS;\n  const container = useZoomContainer();\n\n  const [width, height] = React.useMemo(() => {\n    let memoRealWidth = node?.data?.width;\n    let memoRealHeight = node?.data?.height;\n    if (!ImagePlugin.isValidSize(memoRealWidth, memoRealHeight)) {\n      const dom = domUtils.findDOMNodeSafely(image?.key || '', container || window);\n      if (dom) {\n        const imageWrapper = dom.querySelector(`.${ImagePlugin.IMAGE_DATA_WRAPPER_CLASS_NAME}`);\n        const rect = imageWrapper?.getBoundingClientRect();\n        memoRealWidth = UnitConvert.pix2cm(rect?.width);\n        memoRealHeight = UnitConvert.pix2cm(rect?.height);\n      }\n    }\n    return [memoRealWidth, memoRealHeight];\n  }, [image?.data?.width, image?.data?.height, image?.key, container]);\n\n  const ratio = (ImagePlugin.isValidSize(width, height) && width !== 0) ? height / width : 1;\n\n  const [realWidth, realHeight, fixedMaxWidth, fixedMaxHeight] = React.useMemo(() => {\n    let memoRealWidth: number | undefined = UnitConvert.pix2cm(width);\n    let memoRealHeight: number | undefined = UnitConvert.pix2cm(height);\n    let memoFixedMaxWidth;\n    let memoFixedMaxHeight;\n    if (!disableStretchMode || !disableStretchMode()) {\n      // 根据是否启用的自适应\n      const maxWidth = ImagePlugin.getImageMaxWidth(value, node as Inline);\n      const maxHeight = maxWidth * ratio;\n      const widthInCM = UnitConvert.pix2cm(width);\n      const heightInCM = UnitConvert.pix2cm(height);\n      const maxWidthInCM = UnitConvert.pix2cm(maxWidth);\n      const maxHeightInCM = UnitConvert.pix2cm(maxHeight);\n      memoRealWidth = processNumber(widthInCM, maxWidthInCM);\n      memoRealHeight = processNumber(heightInCM, maxHeightInCM);\n      memoFixedMaxWidth = getFixedNumber(maxWidthInCM);\n      memoFixedMaxHeight = getFixedNumber(maxHeightInCM);\n    } else {\n      memoFixedMaxWidth = MAX_FIXED_WIDTH;\n      memoFixedMaxHeight = getFixedNumber(fixedMaxWidth * ratio);\n      memoRealWidth = getFixedNumber(memoRealWidth);\n      memoRealHeight = getFixedNumber(memoRealHeight);\n    }\n    return [memoRealWidth, memoRealHeight, memoFixedMaxWidth, memoFixedMaxHeight];\n  }, [value, disableStretchMode, height, width, node, ratio]);\n\n  const fixedMinWidth = Math.min(MIN_FIXED_WIDTH, fixedMaxWidth);\n  const fixedMinHeight = fixedMinWidth * ratio;\n\n  const handleWidthChange = React.useCallback((change: number | string) => {\n    if (change < fixedMinWidth || change > fixedMaxWidth) {\n      return;\n    }\n\n    const px = UnitConvert.cm2pix(change as number);\n    const newWidth = getFixedNumber(px);\n    const newHeight = newWidth * ratio;\n    if (width !== newWidth || height !== newHeight) {\n      const zoomRatio = newWidth / node?.data.width;\n      const newData = {\n        width: newWidth,\n        height: newHeight,\n        ...getZoomRectClip(node?.data.rectClip, zoomRatio),\n      };\n      controller.run('onAction', updateImage(node, newData));\n      logger.sum('image-sidebar-width');\n    }\n  }, [controller, node, ratio, width, height, fixedMaxWidth, fixedMinWidth]);\n\n  const handleHeightChange = React.useCallback((change: number | string) => {\n    if (change < fixedMinHeight || change > fixedMaxHeight) {\n      return;\n    }\n    const px = UnitConvert.cm2pix(change as number);\n    const newHeight = getFixedNumber(px);\n    const newWidth = newHeight / ratio;\n    if (width !== newWidth || height !== newHeight) {\n      const zoomRatio = newHeight / node?.data.height;\n      const newData = {\n        width: newWidth,\n        height: newHeight,\n        ...getZoomRectClip(node?.data?.rectClip, zoomRatio),\n      };\n      controller.run('onAction', updateImage(node, newData));\n      logger.sum('image-sidebar-height');\n    }\n  }, [ratio, controller, node, width, height, fixedMaxHeight, fixedMinHeight]);\n\n  const handleRotationChange = React.useCallback((change: number | string) => {\n    const newRotation = normalizeAngle(change);\n    if (newRotation !== rotation) {\n      controller.run('onAction', updateImage(image, {\n        rotation: newRotation,\n      }, container));\n    }\n    logger.sum('image-sidebar-rotation');\n  }, [rotation, controller, image, container]);\n\n  const handleReverseRotate90 = React.useCallback(() => {\n    const newRotation = normalizeAngle(rotation - 90);\n    controller.run('onAction', updateImage(image, {\n      rotation: newRotation,\n    }, container));\n    logger.sum('image-sidebar-reverse-rotate90');\n  }, [rotation, controller, image, container]);\n\n  const handleRotate90 = React.useCallback(() => {\n    const newRotation = normalizeAngle(rotation + 90);\n    controller.run('onAction', updateImage(image, {\n      rotation: newRotation,\n    }, container));\n    logger.sum('image-sidebar-rotate90');\n  }, [rotation, controller, image, container]);\n\n  const handleRestore = React.useCallback(() => {\n    getImageSize(src, controller).then(({ width: resetWidth, height: resetHeight }) => {\n      const newPayload = {\n        width: resetWidth,\n        height: resetHeight,\n        ...RESTORE_DATA,\n      };\n      controller.run('onAction', updateImage(node, newPayload));\n      logger.sum('image-sidebar-restore');\n    });\n  }, [src, controller, node]);\n\n  const handleRadiusChange = React.useCallback((change) => {\n    controller.run('onAction', updateImage(node, {\n      radius: change,\n    }));\n    logger.sum('image-sidebar-radius');\n  }, [controller, node]);\n\n  const inputNumberStyle = React.useMemo(() => ({\n    flex: 1,\n  }), []);\n\n  const restoreStyle = React.useMemo<React.CSSProperties>(() => ({\n    marginTop: 12,\n    textAlign: 'center',\n  }), []);\n\n  const isInvalidSize = !ImagePlugin.isValidSize(realWidth, realHeight);\n\n  return node ? (\n    <MenuWrapper>\n      <MenuLine key=\"image-sidebar-size\">\n        <InputNumberItem\n          name=\"image-width\"\n          title={locale.width}\n          unit=\"cm\"\n          value={realWidth}\n          onChange={handleWidthChange}\n          max={fixedMaxWidth}\n          min={MIN_FIXED_WIDTH}\n          key=\"image-set-panel-width\"\n          style={inputNumberStyle}\n          disabled={isInvalidSize}\n          testid=\"image-sidebar-width\"\n          role={PluginRoles.imageSidebarWidthInput}\n        />\n        <InputNumberItem\n          name=\"image-height\"\n          title={locale.height}\n          unit=\"cm\"\n          value={realHeight}\n          onChange={handleHeightChange}\n          max={fixedMaxHeight}\n          min={fixedMinHeight}\n          key=\"image-set-panel-height\"\n          style={inputNumberStyle}\n          disabled={isInvalidSize}\n          testid=\"image-sidebar-height\"\n          role={PluginRoles.imageSidebarHeightInput}\n        />\n      </MenuLine>\n      <MenuLine key=\"image-sidebar-rotation\">\n        <InputNumberItem\n          name=\"image-rotation\"\n          title={locale.rotateInput}\n          unit=\"°\"\n          value={rotation}\n          onChange={handleRotationChange}\n          max={360}\n          min={-360}\n          key=\"image-set-panel-rotation\"\n          style={inputNumberStyle}\n          step={45}\n          testid=\"image-sidebar-rotation\"\n          role={PluginRoles.imageSidebarRotationInput}\n        />\n        <CustomInputNumberItem\n          content={\n            <ButtonsBox>\n              <Tooltip\n                title={locale.rotateAntiClockwise}\n              >\n                <RotateButton\n                  onClick={handleReverseRotate90}\n                  key=\"reverse-rotate-90\"\n                  data-testid=\"image-sidebar-reverse-rotate-90\"\n                  data-role={PluginRoles.imageSidebarReverseRotate90}\n                >\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" fill=\"none\"><path d=\"M2.696 6.572a.5.5 0 1 0-1 0v5a.498.498 0 0 0 .5.5h5a.5.5 0 1 0 0-1H3.403L5.05 9.425A7 7 0 0 1 17 14.375a.5.5 0 1 0 1 0A8 8 0 0 0 4.343 8.718l-1.647 1.647V6.572z\" fill=\"#171A1D\"/></svg>\n                </RotateButton>\n              </Tooltip>\n              <Tooltip\n                title={locale.rotate}\n              >\n                <RotateButton\n                  onClick={handleRotate90}\n                  key=\"rotate-90\"\n                  data-testid=\"image-sidebar-rotate-90\"\n                  data-role={PluginRoles.imageSidebarRotate90}\n                >\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" fill=\"none\"><path d=\"M17.304 6.572a.5.5 0 0 1 1 0v5a.499.499 0 0 1-.5.5h-5a.5.5 0 1 1 0-1h3.793L14.95 9.425A7 7 0 0 0 3 14.375a.5.5 0 0 1-1 0 8 8 0 0 1 13.657-5.657l1.647 1.647V6.572z\" fill=\"#171A1D\"/></svg>\n                </RotateButton>\n              </Tooltip>\n            </ButtonsBox>\n          }\n          style={inputNumberStyle}\n          title={locale.rotate90 || 'Rotate 90°'}\n        />\n      </MenuLine>\n      <MenuLine key=\"image-sidebar-border\">\n        <CustomInputNumberItem\n          content={\n            <ImageBorder\n              controller={controller}\n              locale={locale}\n              isButtonType\n            />\n          }\n          style={inputNumberStyle}\n          title={locale.border?.borderInput || 'Border'}\n        />\n        <InputNumberItem\n          name=\"image-radius\"\n          title={locale.radius}\n          value={radius}\n          onChange={handleRadiusChange}\n          min={0}\n          max={9999}\n          key=\"image-set-panel-radius\"\n          style={inputNumberStyle}\n          testid=\"image-sidebar-radius\"\n          data-role={PluginRoles.imageSidebarRadiusInput}\n        />\n      </MenuLine>\n      <CustomButton\n        onMouseDown={blockEvent}\n        onClick={handleRestore}\n        style={restoreStyle}\n        data-testid=\"image-sidebar-restore\"\n        data-role={PluginRoles.imageSidebarRestore}\n      >\n        {locale.resetTitle}\n      </CustomButton>\n    </MenuWrapper>\n  ) : null;\n};\n\nexport default SizeAndStyleMenu;\n"],"file":"SizeAndStyleMenu.js"}