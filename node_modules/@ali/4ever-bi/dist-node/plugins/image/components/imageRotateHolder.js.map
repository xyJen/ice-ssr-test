{"version":3,"sources":["../../../../../src/plugins/image/components/imageRotateHolder.tsx"],"names":["ROTATE_CURSOR_OFFSET","ImageRotateHolder","props","angle","getZoomContainer","onEnterRotationMode","width","height","rotation","rotateImageFrame","scale","handleRotate","isHide","originX","React","useRef","originY","currentX","currentY","rotateHolder","customCursorWrapper","customCursorIcon","rotationNumber","translateX","setTranslateX","useState","translateY","setTranslateY","isHolderRotating","setIsHolderRotating","isMouseEnterHolder","setMouseEnterHolder","useEffect","newTranslateX","newTranslateY","updateCursor","useCallback","e","newRotate","current","style","transform","left","clientX","top","clientY","onRotateStart","relativeEvent","relativeX","relativeY","onRotateMove","container","rect","objX","objY","x1","y1","x2","y2","triangleTop","triangleBottom","arc","Math","atan2","PI","innerText","toFixed","Number","isInteger","onRotateEnd","zoomContainer","handleMouseMove","preventDefault","stopPropagation","handleMouseUp","handleMouseDown","document","addEventListener","removeEventListener","handleMouseMoveInHolder","handleMouseLeave","handleMouseEnter","PluginRoles","imageRotator","ReactDOM","createPortal","rotateIcon","rotateIcon2x","body"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Controller } from '@ali/4ever-cangjie';\nimport {\n  calcRotationObj,\n  normalizeAngle,\n  getBoundingRelativeRect,\n  getRelativeMouseEvent,\n  RelativeEventType,\n} from '@ali/4ever-utils';\nimport { PluginRoles } from '@ali/4ever-bamboo';\nimport {\n  EditorRotateHolder,\n  RotateCursorWrapper,\n  RotateCursorIcon,\n  RotateCursorNumber,\n  DisableCursor,\n  rotateIcon,\n  rotateIcon2x,\n} from './styled';\nimport fitRotate from '../utils/fitRotate';\n\n// 旋转光标未旋转时，其视觉上应该平行于 x 轴，以下常量用于矫正角度\nconst ROTATE_CURSOR_OFFSET = -45;\nexport interface IImageRotateHolder {\n  angle: number;\n  onEnterRotationMode: () => void;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  handleRotate: (rotate: any, cb?: Function) => void;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  rotation: any;\n  width: number;\n  height: number;\n  rotateImageFrame: HTMLElement | null;\n  getZoomContainer: () => HTMLElement | null;\n  controller: Controller;\n  scale: number;\n  isHide: boolean;\n  isSupportTouch?: boolean;\n  isRotating?: boolean;\n  rotateControl?: any;\n}\n\nconst ImageRotateHolder: React.FC<IImageRotateHolder> = (props) => {\n  const { angle, getZoomContainer, onEnterRotationMode, width, height, rotation = 0, rotateImageFrame, scale, handleRotate, isHide } = props;\n  const originX = React.useRef<number>(0);\n  const originY = React.useRef<number>(0);\n  const currentX = React.useRef<number>(0);\n  const currentY = React.useRef<number>(0);\n  const rotateHolder = React.useRef<HTMLSpanElement>(null);\n  const customCursorWrapper = React.useRef<HTMLDivElement>(null);\n  const customCursorIcon = React.useRef<HTMLDivElement>(null);\n  const rotationNumber = React.useRef<HTMLDivElement>(null);\n  const [translateX, setTranslateX] = React.useState(0);\n  const [translateY, setTranslateY] = React.useState(0);\n  const [isHolderRotating, setIsHolderRotating] = React.useState(false);\n  const [isMouseEnterHolder, setMouseEnterHolder] = React.useState<boolean>(false);\n\n  React.useEffect(() => {\n    const { translateX: newTranslateX, translateY: newTranslateY } = calcRotationObj(width, height, rotation);\n    setTranslateX(newTranslateX);\n    setTranslateY(newTranslateY);\n  }, [width, height, rotation]);\n\n  const updateCursor = React.useCallback((e, newRotate: number) => {\n    if (customCursorWrapper.current) {\n      customCursorIcon.current!.style.transform = `rotate(${newRotate + angle - ROTATE_CURSOR_OFFSET}deg)`;\n      customCursorWrapper.current.style.left = `${e.clientX}px`;\n      customCursorWrapper.current.style.top = `${e.clientY}px`;\n    }\n  }, [angle]);\n\n  const onRotateStart = React.useCallback((relativeEvent: RelativeEventType) => {\n    onEnterRotationMode();\n    setIsHolderRotating(true);\n    originX.current = relativeEvent.relativeX;\n    originY.current = relativeEvent.relativeY;\n    currentX.current = relativeEvent.relativeX;\n    currentY.current = relativeEvent.relativeY;\n  }, [onEnterRotationMode]);\n\n  const onRotateMove = React.useCallback((relativeEvent: RelativeEventType, container: HTMLElement, e: MouseEvent) => {\n    if (!rotateImageFrame) return;\n    currentX.current = relativeEvent.relativeX;\n    currentY.current = relativeEvent.relativeY;\n\n    const rect = getBoundingRelativeRect(rotateImageFrame, container);\n\n    const objX = rect.left + rect.width / 2;\n    const objY = rect.top + rect.height / 2;\n    const x1 = originX.current - objX;\n    const y1 = originY.current - objY;\n    const x2 = currentX.current - objX;\n    const y2 = currentY.current - objY;\n    const triangleTop = x1 * y2 - x2 * y1;\n    const triangleBottom = x1 * x2 + y1 * y2;\n    const arc = Math.atan2(triangleTop, triangleBottom) * 180 / Math.PI;\n    let newRotate: number = normalizeAngle(rotation + arc);\n    newRotate = fitRotate(newRotate);\n    rotateImageFrame.style.transform = `translate(${translateX * scale}px, ${translateY * scale}px) rotate(${newRotate}deg)`;\n    rotationNumber.current!.innerText = `${newRotate.toFixed(Number.isInteger(newRotate) ? 0 : 1)}°`;\n    updateCursor(e, newRotate);\n  }, [rotation, rotateImageFrame, scale, translateX, translateY, updateCursor]);\n\n  const onRotateEnd = React.useCallback(() => {\n    let newRotate = null;\n    if (rotateImageFrame) {\n      const zoomContainer = getZoomContainer();\n\n      if (originX.current !== currentX.current || originY.current !== currentY.current) {\n        const rect = getBoundingRelativeRect(rotateImageFrame, zoomContainer);\n        const objX = rect.left + rect.width / 2;\n        const objY = rect.top + rect.height / 2;\n        const x1 = originX.current - objX;\n        const y1 = originY.current - objY;\n        const x2 = currentX.current - objX;\n        const y2 = currentY.current - objY;\n        const triangleTop = x1 * y2 - x2 * y1;\n        const triangleBottom = x1 * x2 + y1 * y2;\n        const arc = Math.atan2(triangleTop, triangleBottom) * 180 / Math.PI;\n        newRotate = normalizeAngle(rotation + arc);\n        newRotate = fitRotate(newRotate);\n      }\n    }\n    handleRotate(newRotate, () => setIsHolderRotating(false));\n\n    originX.current = 0;\n    originY.current = 0;\n    currentX.current = 0;\n    currentY.current = 0;\n  }, [handleRotate, rotateImageFrame, rotation, getZoomContainer]);\n\n  const handleMouseMove = React.useCallback((e: MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    if (!rotateImageFrame) return;\n    const zoomContainer = getZoomContainer();\n    const relativeEvent = getRelativeMouseEvent(e, zoomContainer!);\n    onRotateMove(relativeEvent, zoomContainer!, e);\n  }, [getZoomContainer, onRotateMove, rotateImageFrame]);\n\n  const handleMouseUp = React.useCallback((e: MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    onRotateEnd();\n  }, [onRotateEnd]);\n\n  const handleMouseDown = React.useCallback((e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const zoomContainer = getZoomContainer();\n    if (!zoomContainer) {\n      return;\n    }\n\n    const relativeEvent = getRelativeMouseEvent(e, zoomContainer);\n\n    onRotateStart(relativeEvent);\n  }, [getZoomContainer, onRotateStart]);\n\n  React.useEffect(() => {\n    if (isHolderRotating) {\n      document.addEventListener('mousemove', handleMouseMove);\n      document.addEventListener('mouseup', handleMouseUp);\n    }\n    return () => {\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('mouseup', handleMouseUp);\n    };\n  }, [handleMouseUp, handleMouseMove, isHolderRotating]);\n\n  React.useEffect(() => {\n    return () => {\n      // 销毁时必须重置父组件中 isRotating 的状态\n      handleRotate(null);\n    };\n  }, [handleRotate]);\n\n  const handleMouseMoveInHolder = React.useCallback((e: MouseEvent) => {\n    if (isHolderRotating) {\n      return;\n    }\n    updateCursor(e, rotation);\n  }, [updateCursor, isHolderRotating, rotation]);\n\n  const handleMouseLeave = React.useCallback(() => {\n    setMouseEnterHolder(false);\n  }, []);\n\n  const handleMouseEnter = React.useCallback(() => {\n    setMouseEnterHolder(true);\n  }, []);\n\n  React.useEffect(() => {\n    if (isMouseEnterHolder) {\n      rotateHolder.current?.addEventListener('mousemove', handleMouseMoveInHolder);\n    }\n    return () => {\n      rotateHolder.current?.removeEventListener('mousemove', handleMouseMoveInHolder);\n    };\n  }, [isMouseEnterHolder, handleMouseMoveInHolder]);\n\n  return (\n    <React.Fragment>\n      <EditorRotateHolder\n        onMouseDown={handleMouseDown}\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n        angle={angle}\n        ref={rotateHolder}\n        isHide={isHide}\n        role=\"rotator\"\n        data-role={`${PluginRoles.imageRotator}${angle}`}\n      />\n      {\n        (isMouseEnterHolder || isHolderRotating) &&\n        ReactDOM.createPortal((\n          <RotateCursorWrapper\n            ref={customCursorWrapper}\n          >\n            <RotateCursorIcon\n              ref={customCursorIcon}\n              rotation={Number(rotation) + angle - ROTATE_CURSOR_OFFSET}\n            >\n              <img\n                src={rotateIcon}\n                srcSet={`${rotateIcon2x} 2x`}\n              />\n            </RotateCursorIcon>\n            <RotateCursorNumber ref={rotationNumber} rotating={isHolderRotating} />\n          </RotateCursorWrapper>\n        ), document.body)\n      }\n      {\n        (isMouseEnterHolder || isHolderRotating) && <DisableCursor />\n      }\n    </React.Fragment>\n  );\n};\n\nexport default ImageRotateHolder;\n"],"file":"imageRotateHolder.js"}