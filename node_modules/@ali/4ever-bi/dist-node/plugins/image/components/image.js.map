{"version":3,"sources":["../../../../../src/plugins/image/components/image.tsx"],"names":["Img","isComplexImg","isNodeInTable","isValidSize","ImagePlugin","closeContextMenu","PcContextMenu","THROTTLE_PREVIEW_TIME","IS_EMPTY_IGNORE_PROPS","isImageRectChanged","prevData","data","width","height","rotation","rectClip","outline","prevWidth","prevHeight","prevRotation","prevRectClip","prevOutline","Image","React","Component","getDerivedStateFromProps","props","state","isSelected","node","isRectUpdating","newIsCanPreview","isCanPreview","undefined","newUpdate","isUpdating","constructor","image","ref","isFirstLoad","frameId","updatingEndFrameId","updateMaxWidthFrameId","isFocusedBeforeClick","resizeObserver","prevMaxWidth","getPortalPosition","scale","zoomContainer","current","left","right","rect","top","setIsLoaded","isLoaded","setState","getZoomContainer","getScrollableContent","scrollableContent","window","document","body","onEnterCroppingMode","e","preventDefault","stopPropagation","controller","run","key","isImageCropping","onExitCroppingMode","onEnterRotationMode","isRotating","onEnterResizingMode","isResizing","exitRotationMode","cb","getImageContainer","handleChangeSize","l","r","t","b","Number","bottom","handleRotate","container","handleInlineToolbarRotate","newRotation","handleInlineToolbarRotateAntiClockwise","getUploadProgress","src","uploadPercent","getCursor","imageConfig","previewImage","isFocused","value","shouldShowToolbar","handlePreviewImage","isSelectingNode","query","throttleHandlePreviewImage","handleLoad","url","pluginState","startsWith","URL","revokeObjectURL","handleContextMenu","event","handleImgClick","isParentClickable","handleImgDoubleClick","handleMouseDown","handleMouseEnter","isHovering","handleMouseLeave","handleMouseOver","onMouseOver","getImgRectData","isComplex","isValid","position","fixedOutline","renderImgWidth","clientWidth","renderImgHeight","clientHeight","renderVisibleWidth","renderContainerWidth","renderContainerHeight","renderVisibleHeight","getImgRef","renderImage","children","attributes","isTransferring","maxWidth","renderExtraNode","isBlurred","uploadProgress","normalizeRotation","transformedSrc","calcSrc","isImageSelected","isHover","isCropping","ReactDOM","createPortal","visibility","userSelect","isTesting","getIsAutoFit","createRef","disableStretchMode","isInTable","disableStretch","isAutoFit","initResizeObserver","getMaxWidthContainer","maxWidthContainer","updateMaxWidth","requestAnimationFrame","observerCallback","entries","entry","contentRect","ResizeObserver","observe","componentDidMount","componentDidUpdate","prevProps","prevState","prevPluginState","cancelAnimationFrame","componentWillUnmount","disconnect","imageManager","protocolAllowList","renderSrc","getTransformedURL","selection","isCollapsed","isSettingBorder","renderInlineToolbar","showToolbar","downloadImage","locale","customToolbars","inlineToolbarMore","realInlineLayout","hasInlineToolbar","Array","isArray","length","render","disableInlineToolbar","Container","useImageManager","setSelected","useState","hoverHandlers","handlePendingSelectionChange","useCallback","anchor","isPendingSelected","hasNode","selectionData$","placeholder","enablePending"],"mappings":"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","sourcesContent":["/* eslint-disable react/no-find-dom-node */\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { throttle, isEqual, isEmpty, omit } from 'lodash-es';\nimport classnames from 'classnames';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport { Inline, useZoom, useZoomContainer, useSelectionData, RenderNodeProps } from '@ali/4ever-cangjie';\nimport { useHover } from '@ali/4ever-component';\nimport {\n  ImagePlugin,\n  PcContextMenu,\n  useScrollableContent,\n} from '@ali/4ever-bamboo';\nimport { sanitizeUrl, getBoundingRelativeRect, normalizeAngle, getData } from '@ali/4ever-utils';\nimport { ImageData } from '@ali/4ever-mo';\nimport { updateImage, setImageInjection, selectImage } from '../actions';\nimport ImageEditor from './imageEditor';\nimport ImageCrop from './imageCrop';\nimport ImageInlineToolbar from './ImageInlineToolbar';\nimport { IImageData, ImagePluginConfig } from '../types';\nimport { ImgContent, ImgMeta } from './styled';\n\nconst {\n  Img,\n  isComplexImg,\n  isNodeInTable,\n  isValidSize,\n} = ImagePlugin;\n\nconst { closeContextMenu } = PcContextMenu;\n\nconst THROTTLE_PREVIEW_TIME = 400;\nconst IS_EMPTY_IGNORE_PROPS = ['uuid'];\n\ninterface IOwnProps extends RenderNodeProps<Inline>{\n  pluginState: any;\n  imageConfig?: ImagePluginConfig;\n}\n\ninterface IProps extends IOwnProps {\n  scrollableContent: HTMLElement | null;\n  zoomContainer: HTMLElement | null;\n  scale: number;\n  imageManager: ImagePlugin.ImageManager | null;\n  // TODO: @淼淼 hoverToolbar 全量后移除\n  disableInlineToolbar: boolean;\n  onMouseOver: React.MouseEventHandler;\n}\n\ninterface IState {\n  isRotating: boolean;\n  isResizing: boolean;\n  isHovering: boolean;\n  isTransferring: boolean;\n  isLoaded: boolean;\n  isCanPreview: boolean;\n  isUpdating: boolean;\n  prevData: ImageData;\n  maxWidth?: number | string;\n}\n\nfunction isImageRectChanged(prevData: ImageData, data: ImageData) {\n  const { width, height, rotation, rectClip, outline } = data;\n  const { width: prevWidth, height: prevHeight, rotation: prevRotation, rectClip: prevRectClip, outline: prevOutline } = prevData;\n  return width !== prevWidth\n    || height !== prevHeight\n    || rotation !== prevRotation\n    || !isEqual(rectClip, prevRectClip)\n    || outline?.width !== prevOutline?.width;\n}\n\nclass Image extends React.Component<IProps, IState> {\n  static getDerivedStateFromProps(props: IProps, state: IState): Partial<IState> | null {\n    const { isSelected, node } = props;\n    const isRectUpdating = isImageRectChanged(state.prevData, node.data);\n    if (!isSelected || isRectUpdating) {\n      const newIsCanPreview = !isSelected ? {\n        isCanPreview: false,\n      } : undefined;\n      const newUpdate = isRectUpdating ? {\n        isUpdating: true,\n        prevData: node.data,\n      } : undefined;\n      return {\n        ...newIsCanPreview,\n        ...newUpdate,\n      };\n    }\n    return null;\n  }\n\n  image: React.RefObject<HTMLImageElement>;\n\n  ref: React.RefObject<HTMLElement>;\n\n  isFirstLoad: boolean;\n\n  private frameId = -1;\n\n  private updatingEndFrameId = -1;\n\n  private updateMaxWidthFrameId = -1;\n\n  private isFocusedBeforeClick = false;\n\n  private resizeObserver: ResizeObserver | null = null;\n\n  private prevMaxWidth?: number;\n\n  constructor(props: IProps) {\n    super(props);\n\n    const { pluginState, isSelected, node, imageConfig } = props;\n    this.state = {\n      isRotating: false,\n      isResizing: false,\n      isHovering: false,\n      isTransferring: pluginState && pluginState.isTransferring,\n      // @ts-ignore\n      isLoaded: !!imageConfig?.isTesting,\n      isCanPreview: isSelected,\n      // 解决图片编辑后，编辑框未更新或编辑框闪烁更新\n      // 原因: 由于自适应后图片编辑后的尺寸不一定与编辑结束时一致，Image Editor 需要感知图片实际 render 的尺寸，但是可能传入未渲染完成的 render size，造成编辑框未更新。\n      // 解法1：在本组件的 componentDidUpdate 中，更新render size state时加上延时，可以解决未更新的问题，但是编辑框会闪烁。\n      // 解法2：增加 isUpdating state，默认为 false，在resize 和 旋转结束、更新图片时设置 isUpdating 为 true，紧接着延时设置为 false（预期渲染完毕）\n      // ，触发render，由于在 isUpdating = true 时不会渲染编辑框，因此不会出现编辑框闪烁的问题。\n      isUpdating: false,\n      prevData: node.data,\n      maxWidth: this.getIsAutoFit() ? '100%' : undefined,\n    };\n    this.image = React.createRef();\n    this.ref = React.createRef();\n    this.isFirstLoad = true;\n  }\n\n  getIsAutoFit() {\n    const { node, controller, imageConfig } = this.props;\n    const { disableStretchMode } = imageConfig || {};\n    const isInTable = isNodeInTable(node, controller.value.document);\n    const disableStretch = typeof disableStretchMode === 'function' && disableStretchMode();\n    const isAutoFit = !disableStretch || isInTable;\n    return isAutoFit;\n  }\n\n  getPortalPosition = () => {\n    const { scale, zoomContainer } = this.props;\n    if (!this.ref.current) {\n      return {\n        left: -9999,\n        right: -9999,\n      };\n    }\n    const rect = getBoundingRelativeRect(this.ref.current, zoomContainer);\n    const left = rect.left / scale;\n    const top = rect.top / scale;\n\n    return {\n      left,\n      top,\n    };\n  };\n\n  initResizeObserver() {\n    const { imageConfig = {}, controller, node } = this.props;\n    const { getMaxWidthContainer } = imageConfig;\n    const maxWidthContainer = getMaxWidthContainer && getMaxWidthContainer(node, controller.value.document);\n    if (!maxWidthContainer) {\n      return;\n    }\n    const updateMaxWidth = throttle(() => {\n      this.updateMaxWidthFrameId = window.requestAnimationFrame(() => {\n        const maxWidth = maxWidthContainer.clientWidth;\n        this.setState({\n          maxWidth: maxWidth || '100%',\n        });\n      });\n    }, 200);\n\n    const observerCallback = (entries) => {\n      for (const entry of entries) {\n        if (this.prevMaxWidth !== entry.contentRect.width) {\n          updateMaxWidth();\n          this.prevMaxWidth = entry.contentRect.width;\n        }\n      }\n    };\n\n    this.resizeObserver = new ResizeObserver(observerCallback);\n    this.resizeObserver.observe(maxWidthContainer);\n  }\n\n  componentDidMount() {\n    if (this.getIsAutoFit()) {\n      this.initResizeObserver();\n    }\n  }\n\n  componentDidUpdate(prevProps: IProps, prevState: IState) {\n    const { pluginState } = this.props;\n    const prevPluginState = prevProps.pluginState;\n    const { isTransferring } = pluginState;\n    if (prevPluginState.isTransferring !== isTransferring) {\n      this.setState({\n        isTransferring,\n      });\n    }\n    if (this.state.isUpdating && this.state.prevData && this.state.prevData !== prevState.prevData) {\n      window.cancelAnimationFrame(this.updatingEndFrameId);\n      this.updatingEndFrameId = window.requestAnimationFrame(() => {\n        this.setState({\n          isUpdating: false,\n          isResizing: false,\n          isRotating: false,\n        });\n      });\n    }\n\n    // preview 功能等待一个 frame 周期，防止 mousedown 提前更新导致的单击进入预览的问题\n    if (this.props.isSelected && !this.state.isCanPreview) {\n      this.frameId = window.requestAnimationFrame(() => {\n        this.setState({\n          isCanPreview: true,\n        });\n      });\n    }\n    if (!this.props.isSelected && prevProps.isSelected) {\n      this.state.isResizing && this.setState({\n        isResizing: false,\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    window.cancelAnimationFrame(this.frameId);\n    window.cancelAnimationFrame(this.updatingEndFrameId);\n    window.cancelAnimationFrame(this.updateMaxWidthFrameId);\n    this.resizeObserver && this.resizeObserver.disconnect();\n    const { url } = this.props.pluginState || {};\n    if (url && (url as string).startsWith('blob:')) {\n      URL.revokeObjectURL(url);\n    }\n  }\n\n  setIsLoaded = (isLoaded: boolean) => {\n    this.setState({\n      isLoaded,\n    });\n  };\n\n  calcSrc(src) {\n    if (src === null) return null;\n\n    if (!src) {\n      const { pluginState } = this.props;\n      const { url } = pluginState || {};\n      return url;\n    }\n\n    const { imageManager, imageConfig = {} } = this.props;\n    const { protocolAllowList } = imageConfig;\n    const renderSrc = imageManager?.getTransformedURL(src) || src;\n    return sanitizeUrl(renderSrc, protocolAllowList);\n  }\n\n  getZoomContainer = () => {\n    const { zoomContainer } = this.props;\n    return zoomContainer;\n  };\n\n  getScrollableContent = () => {\n    return this.props.scrollableContent || window.document.body;\n  };\n\n  shouldShowToolbar() {\n    const { controller, isSelected } = this.props;\n    return !this.isCropping()\n      && isSelected\n      && controller.value.selection.isCollapsed;\n  }\n\n  isCropping() {\n    const { node } = this.props;\n    return node.data.isImageCropping;\n  }\n\n  isSettingBorder() {\n    const { node } = this.props;\n    return node.data.isSettingBorder;\n  }\n\n  isRotating() {\n    const { isRotating } = this.state;\n    const { node } = this.props;\n    const { width, height } = node.data;\n    return (\n      isRotating && typeof width === 'number' && typeof height === 'number'\n    );\n  }\n\n  onEnterCroppingMode = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const { controller, node } = this.props;\n    controller.run(\n      'onAction',\n      setImageInjection(node.key, {\n        isImageCropping: true,\n      }),\n    );\n  };\n\n  onExitCroppingMode = () => {\n    const { controller, node } = this.props;\n    controller.run(\n      'onAction',\n      setImageInjection(node.key, {\n        isImageCropping: false,\n      }),\n    );\n  };\n\n  onEnterRotationMode = () => {\n    this.setState({\n      isRotating: true,\n    });\n  };\n\n  onEnterResizingMode = () => {\n    this.setState({\n      isResizing: true,\n    });\n  };\n\n  exitRotationMode = (cb?: () => void) => {\n    this.setState({\n      isRotating: false,\n    }, cb);\n  };\n\n  getImageContainer = () => {\n    return this.ref.current;\n  };\n\n  /**\n   * 调整图片的宽度、高度\n   */\n  handleChangeSize = (width, height, l = 0, r = 0, t = 0, b = 0) => {\n    width = Number(width);\n    height = Number(height);\n\n    if (typeof width !== 'number' || typeof height !== 'number') return;\n\n    const { node, controller } = this.props;\n    const data: IImageData = {\n      width,\n      height,\n    };\n    if (l || t || r || b) {\n      data.rectClip = {\n        left: l,\n        right: r,\n        top: t,\n        bottom: b,\n      };\n    }\n\n    const { rotation } = node.data;\n    if (typeof rotation !== 'number') {\n      data.rotation = 0;\n    }\n\n    controller.run('onAction', updateImage(node, data));\n    this.setState({\n      isResizing: false,\n    });\n  };\n\n  handleRotate = (rotation, cb?: () => void) => {\n    // 旋转同时会设置高宽，以方便排版等计算\n    const { node, controller } = this.props;\n    const { width, height } = node.data;\n    const container = this.getZoomContainer();\n    if (rotation !== null) {\n      rotation = normalizeAngle(rotation, true);\n      controller.run(\n        'onAction',\n        updateImage(node, {\n          rotation,\n          width,\n          height,\n        }, container),\n      );\n    }\n    this.exitRotationMode(cb);\n  };\n\n  handleInlineToolbarRotate = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const { node } = this.props;\n    const rotation = getData(node.data, 'rotation', 0);\n    const newRotation = normalizeAngle(rotation + 90);\n    this.handleRotate(newRotation);\n  };\n\n  handleInlineToolbarRotateAntiClockwise = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const { node } = this.props;\n    const rotation = getData(node.data, 'rotation', 0);\n    const newRotation = normalizeAngle(rotation - 90);\n    this.handleRotate(newRotation);\n  };\n\n  getUploadProgress = () => {\n    const { node } = this.props;\n    const { src, uploadPercent = 0 } = node.data || {};\n    // upload.progress 到达 100% 时，整体进度只展示 95%\n    // 不展示 100% 原因是还需要下载图片\n    // 目前看 progress 在生产环境可代表真实进度\n    return src ? 100 : uploadPercent * 0.95;\n  };\n\n  getCursor = () => {\n    const { imageConfig = {}, controller } = this.props;\n    const { previewImage } = imageConfig;\n    const { isFocused } = controller.value;\n    if (previewImage && this.shouldShowToolbar() && isFocused) {\n      return 'zoom-in';\n    }\n    return 'auto';\n  };\n\n  renderInlineToolbar() {\n    const { controller, node, imageConfig } = this.props;\n    const showToolbar = this.shouldShowToolbar() && (controller.value.isFocused || this.isSettingBorder());\n    if (!showToolbar) return null;\n\n    const { previewImage, downloadImage, locale, customToolbars, inlineToolbarMore } = imageConfig || {};\n    const realInlineLayout = controller.query('getImageInlineToolbarLayout');\n    const hasInlineToolbar = Array.isArray(realInlineLayout) && realInlineLayout.length > 0;\n    return hasInlineToolbar && (\n      <ImageInlineToolbar\n        visible\n        controller={controller}\n        triggerNode={this.ref.current}\n        node={node}\n        locale={locale}\n        handleInlineToolbarRotate={this.handleInlineToolbarRotate}\n        handleInlineToolbarRotateAntiClockwise={\n          this.handleInlineToolbarRotateAntiClockwise\n        }\n        previewImage={previewImage}\n        downloadImage={downloadImage}\n        onEnterCroppingMode={this.onEnterCroppingMode}\n        getZoomContainer={this.getZoomContainer}\n        getScrollableContent={this.getScrollableContent}\n        inlineToolbarLayout={realInlineLayout}\n        // @ts-ignore\n        customToolbars={customToolbars}\n        inlineToolbarMore={inlineToolbarMore}\n      />\n    );\n  }\n\n  handlePreviewImage = () => {\n    const { isLoaded } = this.state;\n    const { imageConfig, node, controller } = this.props;\n    const previewImage = imageConfig?.previewImage;\n    if (!isLoaded || !previewImage) return;\n    const { src } = node.data;\n    const isSelectingNode = controller.query('isSelectingNode');\n    if (isSelectingNode) return;\n    previewImage(src, node);\n  };\n\n  throttleHandlePreviewImage = throttle(this.handlePreviewImage, THROTTLE_PREVIEW_TIME);\n\n  handleLoad = () => {\n    this.setIsLoaded(true);\n    const { url } = this.props.pluginState || {};\n    if (url && (url as string).startsWith('blob:')) {\n      URL.revokeObjectURL(url);\n    }\n  };\n\n  handleContextMenu = (event) => {\n    event.preventDefault();\n  };\n\n  closeContextMenu = () => {\n    const { controller } = this.props;\n    controller.run('onAction', closeContextMenu());\n  };\n\n  handleImgClick = () => {\n    this.closeContextMenu();\n    const { controller, node } = this.props;\n    if (ImagePlugin.isParentClickable(controller, node)) {\n      return;\n    }\n    if (this.state.isCanPreview && this.isFocusedBeforeClick) {\n      this.handlePreviewImage();\n    }\n  };\n\n  handleImgDoubleClick = () => {\n    this.throttleHandlePreviewImage();\n  };\n\n  handleMouseDown = () => {\n    this.isFocusedBeforeClick = this.props.controller.value.isFocused;\n  };\n\n  handleMouseEnter = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    this.setState({\n      isHovering: true,\n    });\n  };\n\n  handleMouseLeave = () => {\n    this.setState({\n      isHovering: false,\n    });\n  };\n\n  handleMouseOver = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    this.props.onMouseOver(e);\n  };\n\n  getImgRectData = () => {\n    const { node } = this.props;\n    const { width, height, outline, rectClip } = node.data as ImageData;\n    const isComplex = isComplexImg(node.data);\n    const isValid = isValidSize(width, height);\n    const position = this.getPortalPosition();\n    const l = rectClip?.left || 0;\n    const r = rectClip?.right || 0;\n    const t = rectClip?.top || 0;\n    const b = rectClip?.bottom || 0;\n    if (isComplex && isValid) {\n      // img 标签的实际渲染宽度\n      const fixedOutline = ((outline?.width || 0)) * 2;\n      // HACK: 图片增加边框后整体所占的宽高不变，其实会导致图片变形，原因是宽高向内收缩的像素是相同的，但是图片的宽高比例不同\n      // img 元素的实际宽度\n      const renderImgWidth = (this.image.current?.clientWidth) || 0;\n      // img 元素的实际长度\n      const renderImgHeight = (this.image.current?.clientHeight) || 0;\n      // 图片实际可见的宽度（不包含边框）= img 元素的实际宽度 * 剪裁后剩余部分所占的比例\n      const renderVisibleWidth = renderImgWidth * (width! / (width! + l + r));\n      // 图片整体可见的宽度（包含边框）\n      const renderContainerWidth = renderVisibleWidth + fixedOutline;\n      // 图片整体可见的高度（包含边框）= 图片整体可见的宽度（包含边框） * 落库的高相对于宽的比例\n      const renderContainerHeight = renderContainerWidth * (height! / width!);\n      // 图片实际可见的高度（不包含边框） = 图片整体可见的高度 - 固定的边框（用户添加的边框）\n      const renderVisibleHeight = renderContainerHeight - fixedOutline;\n\n      return {\n        width: renderVisibleWidth,\n        height: renderVisibleHeight,\n        l: renderImgWidth * (l / (width! + l + r)),\n        r: renderImgWidth * (r / (width! + l + r)),\n        t: renderImgHeight * (t / (height! + t + b)),\n        b: renderImgHeight * (b / (height! + t + b)),\n        ...position,\n      };\n    }\n    return {\n      width: this.image.current?.clientWidth || 0,\n      height: this.image.current?.clientHeight || 0,\n      l,\n      r,\n      t,\n      b,\n      ...position,\n    };\n  };\n\n  getImgRef = () => {\n    return this.image.current;\n  };\n\n  renderImage = () => {\n    const {\n      node,\n      children,\n      attributes,\n      controller,\n      scale,\n      pluginState,\n      imageConfig = {},\n      zoomContainer,\n    } = this.props;\n    const { url } = pluginState || {};\n    const { isRotating, isResizing, isHovering, isTransferring, isLoaded, maxWidth } = this.state;\n    const { src } = node.data as ImageData;\n    const { renderExtraNode } = imageConfig;\n    const rotation = getData(node.data, 'rotation', 0);\n    const { isBlurred } = controller.value;\n    const uploadProgress = this.getUploadProgress();\n    const normalizeRotation = normalizeAngle(rotation);\n\n    const transformedSrc = this.calcSrc(src);\n    const isImageSelected = this.shouldShowToolbar();\n    const isHover = !isRotating && !isResizing && isHovering;\n\n    return (\n      <React.Fragment>\n        {children}\n        {zoomContainer\n          && this.isCropping()\n          && this.ref.current\n          ? ReactDOM.createPortal(\n            <ImageCrop\n              src={transformedSrc}\n              rotation={normalizeRotation}\n              handleCrop={this.handleChangeSize}\n              onExitCroppingMode={this.onExitCroppingMode}\n              getImgRectData={this.getImgRectData}\n              getZoomContainer={this.getZoomContainer}\n              controller={controller}\n              scale={scale}\n            />,\n            zoomContainer,\n          )\n          : null}\n        <ImgMeta\n          style={{\n            visibility:\n              this.isCropping() || this.isRotating() ? 'hidden' : 'visible',\n            userSelect:\n              this.isCropping() || this.isRotating() ? 'none' : 'auto',\n            maxWidth,\n          }}\n          className={classnames({\n            'show-highlight': isImageSelected && !isResizing && !isBlurred,\n            'disable-highlight-when-hover': isResizing,\n          })}\n          imgCursor={this.getCursor()}\n          onMouseEnter={renderExtraNode && this.handleMouseEnter}\n          onMouseLeave={renderExtraNode && this.handleMouseLeave}\n          onMouseOver={this.handleMouseOver}\n          data-hover-box=\"noBorderBox\"\n        >\n          <Img\n            {...attributes}\n            ref={this.image}\n            uploadPlaceholder={url}\n            node={node}\n            controller={controller}\n            uploadProgress={uploadProgress}\n            onDoubleClick={this.handleImgDoubleClick}\n            onContextMenu={this.handleContextMenu}\n            onClick={this.handleImgClick}\n            onMouseDown={this.handleMouseDown}\n            isTransferring={isTransferring}\n            imageConfig={imageConfig}\n            onLoad={this.handleLoad}\n          />\n          {\n            renderExtraNode && renderExtraNode(node, isHover, isImageSelected)\n          }\n        </ImgMeta>\n        {zoomContainer &&\n          isImageSelected &&\n          !this.state.isUpdating &&\n          this.ref.current &&\n          ReactDOM.createPortal(\n            <ImageEditor\n              node={node}\n              src={transformedSrc}\n              controller={controller}\n              scale={scale}\n              rotation={normalizeRotation}\n              onChangeSize={this.handleChangeSize}\n              onEnterRotationMode={this.onEnterRotationMode}\n              handleRotate={this.handleRotate}\n              onEnterResizingMode={this.onEnterResizingMode}\n              isRotating={isRotating}\n              getZoomContainer={this.getZoomContainer}\n              onContextMenu={this.handleContextMenu}\n              imageConfig={imageConfig}\n              isLoaded={isLoaded}\n              isBlurred={isBlurred}\n              getImgRectData={this.getImgRectData}\n              getImgRef={this.getImgRef}\n            />,\n            zoomContainer,\n          )}\n      </React.Fragment>\n    );\n  };\n\n  render() {\n    const { isLoaded, isResizing, isRotating } = this.state;\n    const { disableInlineToolbar } = this.props;\n    return (\n      <React.Fragment>\n        { !disableInlineToolbar && isLoaded && !(isResizing || isRotating) && this.renderInlineToolbar()}\n        <ImgContent ref={this.ref}>{this.renderImage()}</ImgContent>\n      </React.Fragment>\n    );\n  }\n}\n\nconst Container: React.FC<IOwnProps> = (props) => {\n  const { controller, node, imageConfig } = props;\n  const scrollableContent = useScrollableContent();\n  const zoomContainer = useZoomContainer() || document.body;\n  const scale = useZoom();\n  const imageManager = ImagePlugin.useImageManager();\n  const [isSelected, setSelected] = React.useState<boolean>(false);\n  const disableInlineToolbar = controller.query('hasHoverToolbar', 'image');\n  const hoverHandlers = useHover(true)[1];\n\n  const handlePendingSelectionChange = React.useCallback(() => {\n    const { selection } = controller.value;\n    const { isCollapsed, anchor } = selection;\n    if (!isCollapsed) {\n      isSelected && setSelected(false);\n    } else {\n      const isPendingSelected = node.hasNode(anchor.key);\n      isSelected !== isPendingSelected && setSelected(isPendingSelected);\n    }\n  }, [controller, node, isSelected]);\n\n  useSelectionData(controller.selectionData$, null, handlePendingSelectionChange, []);\n\n\n  if (!node.data || isEmpty(omit(node.data, IS_EMPTY_IGNORE_PROPS))) {\n    return (\n      <ImagePlugin.InlinePlaceholder\n        onClick={() => controller.run('onAction', selectImage(node.key))}\n      >\n        {imageConfig?.locale?.placeholder || 'Image'}\n      </ImagePlugin.InlinePlaceholder>\n    );\n  }\n\n  return (\n    <Image\n      {...props}\n      scrollableContent={scrollableContent}\n      zoomContainer={zoomContainer}\n      scale={scale}\n      isSelected={controller.enablePending.selection ? isSelected : props.isSelected}\n      imageManager={imageManager}\n      disableInlineToolbar={disableInlineToolbar}\n      onMouseOver={hoverHandlers.onMouseOver}\n    />\n  );\n};\n\nexport default Container;\n"],"file":"image.js"}