{"version":3,"sources":["../../../../../src/plugins/image/components/imageCrop.tsx"],"names":["MIN_CROP_DISTANCE","ImageCrop","React","Component","constructor","props","initialRectData","originX","originY","currentX","currentY","cropOuter","cropRealImage","cropFakeImage","cropFakeInner","cropOuterTransform","handleTarget","onCropStart","relativeEvent","orient","parentOrient","current","style","transform","relativeX","relativeY","matchedFrameResize","match","matchedImageResize","handleMouseDown","e","preventDefault","stopPropagation","getZoomContainer","zoomContainer","target","getAttribute","parentNode","document","addEventListener","handleMouseMove","handleMouseUp","handleTouchStart","targetTouches","length","touch","handleTouchMove","handleTouchEnd","updateCropFrame","x","y","width","height","l","t","state","rotation","scale","newWidth","newHeight","cropOuterEle","cropRealImageEle","cropFakeInnerEle","indexOf","Math","max","top","left","oldRotateObj","newRotateObj","translateX","translateY","tlXOld","tlX","tlYOld","tlY","tlXNew","tlYNew","trXOld","trX","trYOld","trY","trXNew","trYNew","finalizeCropFrame","handleCrop","r","b","round","resetOuterPos","setState","updateCropImage","cropFakeImageEle","min","finalizeCropImage","updateTranslateFrame","finalizeTranslateFrame","onCropMove","newX","cos","PI","sin","newY","onCropEnd","removeEventListener","handleExitCroppingMode","event","onExitCroppingMode","contains","exit","getImgRectData","createRef","componentWillUnmount","componentDidMount","render","attributes","src","rotationObj","rotateStyle","rWidth","rHeight","PluginRoles","imageCropper"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport {\n  getRelativeMouseEvent,\n  getRelativeTouchEvent,\n  RelativeEventType,\n  calcRotationObj,\n} from '@ali/4ever-utils';\nimport { Controller } from '@ali/4ever-cangjie';\nimport { PluginRoles } from '@ali/4ever-bamboo';\nimport {\n  ImageCropSrcRect, CropOuter, CropImageRotate,\n  CropRealOuter, CropRealImage, CropFakeImage, CropFakeInner, CropFrame,\n} from './styled';\nimport { IImgRectData } from './types';\n\nconst MIN_CROP_DISTANCE = 20;\n\ninterface IProps {\n  onExitCroppingMode: () => void;\n  getZoomContainer(): HTMLElement | null;\n  src: string;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  rotation: any;\n  handleCrop(width: number, height: number, l: number, r: number, t: number, b: number): void\n  controller: Controller;\n  scale: number;\n  getImgRectData: () => IImgRectData;\n  attributes?: any;\n}\n\ninterface IState {\n  width: number;\n  height: number;\n  l: number;\n  r: number;\n  t: number;\n  b: number;\n}\n\nclass ImageCrop extends React.Component<IProps, IState> {\n  private readonly initialRectData: IImgRectData;\n  private originX: number;\n  private originY: number;\n  private currentX: number;\n  private currentY: number;\n  private readonly cropOuter: React.RefObject<HTMLDivElement>;\n  private readonly cropRealImage: React.RefObject<HTMLImageElement>;\n  private readonly cropFakeImage: React.RefObject<HTMLImageElement>;\n  private readonly cropFakeInner: React.RefObject<HTMLDivElement>;\n  private cropOuterTransform: string;\n  private handleTarget: RegExpMatchArray | null;\n\n  constructor(props: IProps) {\n    super(props);\n    this.initialRectData = this.props.getImgRectData();\n    this.originX = 0;\n    this.originY = 0;\n    this.currentX = 0;\n    this.currentY = 0;\n    this.state = {\n      width: this.initialRectData.width,\n      height: this.initialRectData.height,\n      l: this.initialRectData.l,\n      r: this.initialRectData.r,\n      t: this.initialRectData.t,\n      b: this.initialRectData.b,\n    };\n\n    this.handleTarget = null;\n\n    this.cropOuter = React.createRef();\n    this.cropRealImage = React.createRef();\n    this.cropFakeImage = React.createRef();\n    this.cropFakeInner = React.createRef();\n\n    this.cropOuterTransform = '';\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mousemove', this.handleMouseMove);\n    document.removeEventListener('mouseup', this.handleMouseUp);\n    document.removeEventListener('mousedown', this.handleExitCroppingMode);\n    const { getZoomContainer } = this.props;\n    const zoomContainer = getZoomContainer();\n    if (zoomContainer) {\n      zoomContainer.removeEventListener('touchmove', this.handleTouchMove);\n      zoomContainer.removeEventListener('touchend', this.handleTouchEnd);\n      document.removeEventListener('touchstart', this.handleExitCroppingMode);\n    }\n  }\n\n  onCropStart = (relativeEvent: RelativeEventType, orient: string, parentOrient: string) => {\n    this.cropOuterTransform = this.cropOuter.current?.style.transform || '';\n    this.originX = relativeEvent.relativeX;\n    this.originY = relativeEvent.relativeY;\n    this.currentX = relativeEvent.relativeX;\n    this.currentY = relativeEvent.relativeY;\n    const matchedFrameResize = orient.match(/crop-handle-(\\w+)/)\n      || parentOrient.match(/crop-handle-(\\w+)/);\n    const matchedImageResize = orient.match(/image-handle-(\\w+)/)\n      || parentOrient.match(/image-handle-(\\w+)/);\n    if (matchedFrameResize) {\n      this.handleTarget = ['frameResize', matchedFrameResize[1]];\n    } else if (matchedImageResize) {\n      this.handleTarget = ['imageResize', matchedImageResize[1]];\n    } else {\n      this.handleTarget = ['frameTranslate'];\n    }\n  };\n\n  handleMouseDown = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const { getZoomContainer } = this.props;\n    const zoomContainer = getZoomContainer();\n    const relativeEvent = getRelativeMouseEvent(e, zoomContainer!);\n    const orient = e.target.getAttribute('data-orient') || '';\n    const parentOrient = e.target.parentNode.getAttribute('data-orient') || '';\n    this.onCropStart(relativeEvent, orient, parentOrient);\n\n    document.addEventListener('mousemove', this.handleMouseMove);\n    document.addEventListener('mouseup', this.handleMouseUp);\n  };\n\n  handleTouchStart = (e: React.TouchEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const { getZoomContainer } = this.props;\n    const zoomContainer = getZoomContainer();\n    const { targetTouches } = e;\n    if (!zoomContainer || targetTouches.length > 1) {\n      return;\n    }\n    const touch = targetTouches[0];\n    const relativeEvent = getRelativeTouchEvent(touch, zoomContainer);\n    const target = touch.target as HTMLElement;\n    const orient = target.getAttribute('data-orient') || '';\n    const parentOrient = (target.parentNode as HTMLElement)?.getAttribute('data-orient') || '';\n    this.onCropStart(relativeEvent, orient, parentOrient);\n\n    zoomContainer.addEventListener('touchmove', this.handleTouchMove);\n    zoomContainer.addEventListener('touchend', this.handleTouchEnd);\n  };\n\n  updateCropFrame = (x, y, target) => {\n    const { width, height, l, t } = this.state;\n    const { rotation, scale } = this.props;\n    let newWidth = width;\n    let newHeight = height;\n\n    const cropOuterEle = this.cropOuter.current;\n    const cropRealImageEle = this.cropRealImage.current;\n    const cropFakeInnerEle = this.cropFakeInner.current;\n    if (!cropOuterEle || !cropRealImageEle || !cropFakeInnerEle) {\n      return;\n    }\n    if (target.indexOf('s') >= 0) {\n      newHeight = Math.max(height * scale + y, MIN_CROP_DISTANCE * scale);\n      cropOuterEle.style.height = newHeight + 'px';\n    }\n    if (target.indexOf('e') >= 0) {\n      newWidth = Math.max(width * scale + x, MIN_CROP_DISTANCE * scale);\n      cropOuterEle.style.width = newWidth + 'px';\n    }\n    if (target.indexOf('n') >= 0) {\n      newHeight = Math.max(height * scale - y, MIN_CROP_DISTANCE * scale);\n      cropOuterEle.style.height = newHeight + 'px';\n      const top = (-t * scale - y) + 'px';\n      cropRealImageEle.style.top = top;\n      cropFakeInnerEle.style.top = top;\n    }\n    if (target.indexOf('w') >= 0) {\n      newWidth = Math.max(width * scale - x, MIN_CROP_DISTANCE * scale);\n      cropOuterEle.style.width = newWidth + 'px';\n      const left = (-l * scale - x) + 'px';\n      cropRealImageEle.style.left = left;\n      cropFakeInnerEle.style.left = left;\n    }\n    const oldRotateObj = calcRotationObj(width * scale, height * scale, rotation);\n    const newRotateObj = calcRotationObj(newWidth, newHeight, rotation);\n    let translateX = oldRotateObj.translateX;\n    let translateY = oldRotateObj.translateY;\n    // 修正旋转后缩放的左上角顶点对齐\n    if (target === 's' || target === 'e' || target === 'se') {\n      const tlXOld = oldRotateObj.tlX;\n      const tlYOld = oldRotateObj.tlY;\n      const tlXNew = newRotateObj.tlX;\n      const tlYNew = newRotateObj.tlY;\n\n      translateX = translateX - (tlXNew + newWidth / 2 - tlXOld - width * scale / 2);\n      translateY = translateY - (tlYNew + newHeight / 2 - tlYOld - height * scale / 2);\n    }\n    // 修正旋转后缩放的右下角顶点对齐\n    if (target === 'n' || target === 'w' || target === 'nw') {\n      const tlXOld = -oldRotateObj.tlX;\n      const tlYOld = -oldRotateObj.tlY;\n      const tlXNew = -newRotateObj.tlX;\n      const tlYNew = -newRotateObj.tlY;\n\n      translateX = translateX - (tlXNew + newWidth / 2 - tlXOld - width * scale / 2);\n      translateY = translateY - (tlYNew + newHeight / 2 - tlYOld - height * scale / 2);\n    }\n    // 修正旋转后缩放的右上角顶点对齐\n    if (target === 'sw') {\n      const trXOld = oldRotateObj.trX;\n      const trYOld = oldRotateObj.trY;\n      const trXNew = newRotateObj.trX;\n      const trYNew = newRotateObj.trY;\n\n      translateX = translateX - (trXNew + newWidth / 2 - trXOld - width * scale / 2);\n      translateY = translateY - (trYNew + newHeight / 2 - trYOld - height * scale / 2);\n    }\n    // 修正旋转后缩放的左下角顶点对齐\n    if (target === 'ne') {\n      const trXOld = -oldRotateObj.trX;\n      const trYOld = -oldRotateObj.trY;\n      const trXNew = -newRotateObj.trX;\n      const trYNew = -newRotateObj.trY;\n\n      translateX = translateX - (trXNew + newWidth / 2 - trXOld - width * scale / 2);\n      translateY = translateY - (trYNew + newHeight / 2 - trYOld - height * scale / 2);\n    }\n    cropOuterEle.style.transform = `translate(${translateX}px, ${translateY}px) rotate(${rotation}deg)`;\n  };\n\n  finalizeCropFrame = (x, y, target) => {\n    const { handleCrop, scale } = this.props;\n    const { width, height } = this.state;\n    let { l, t, r, b } = this.state;\n    let newWidth = width;\n    let newHeight = height;\n    x = Math.round(x / scale);\n    y = Math.round(y / scale);\n    this.resetOuterPos();\n    if (target.indexOf('n') >= 0) {\n      newHeight = Math.max(height - y, MIN_CROP_DISTANCE);\n      t = t + height - newHeight;\n    }\n    if (target.indexOf('w') >= 0) {\n      newWidth = Math.max(width - x, MIN_CROP_DISTANCE);\n      l = l + width - newWidth;\n    }\n    if (target.indexOf('s') >= 0) {\n      newHeight = Math.max(height + y, MIN_CROP_DISTANCE);\n      b = b + height - newHeight;\n    }\n    if (target.indexOf('e') >= 0) {\n      newWidth = Math.max(width + x, MIN_CROP_DISTANCE);\n      r = r + width - newWidth;\n    }\n    this.setState({\n      l,\n      t,\n      r,\n      b,\n      width: newWidth,\n      height: newHeight,\n    });\n    handleCrop(newWidth, newHeight, l, r, t, b);\n  };\n\n  updateCropImage = (x, y, target) => {\n    const { scale } = this.props;\n    const { l, t, r, b } = this.state;\n    const height = this.state.height + t + b;\n    const width = this.state.width + l + r;\n\n    const cropRealImageEle = this.cropRealImage.current;\n    const cropFakeImageEle = this.cropFakeImage.current;\n    const cropFakeInnerEle = this.cropFakeInner.current;\n    if (!cropRealImageEle || !cropFakeImageEle || !cropFakeInnerEle) {\n      return;\n    }\n\n    if (target.indexOf('s') >= 0) {\n      cropRealImageEle.style.height = Math.max(height * scale + y, MIN_CROP_DISTANCE * scale) + 'px';\n      cropFakeImageEle.style.height = Math.max(height * scale + y, MIN_CROP_DISTANCE * scale) + 'px';\n    }\n    if (target.indexOf('e') >= 0) {\n      cropRealImageEle.style.width = Math.max(width * scale + x, MIN_CROP_DISTANCE * scale) + 'px';\n      cropFakeImageEle.style.width = Math.max(width * scale + x, MIN_CROP_DISTANCE * scale) + 'px';\n    }\n    if (target.indexOf('n') >= 0) {\n      cropRealImageEle.style.height = Math.max(height * scale - y, MIN_CROP_DISTANCE * scale) + 'px';\n      cropFakeImageEle.style.height = Math.max(height * scale - y, MIN_CROP_DISTANCE * scale) + 'px';\n      cropRealImageEle.style.top = (-t * scale + Math.min(y, (height - MIN_CROP_DISTANCE) * scale)) + 'px';\n      cropFakeInnerEle.style.top = (-t * scale + Math.min(y, (height - MIN_CROP_DISTANCE) * scale)) + 'px';\n    }\n    if (target.indexOf('w') >= 0) {\n      cropRealImageEle.style.width = Math.max(width * scale - x, MIN_CROP_DISTANCE) + 'px';\n      cropFakeImageEle.style.width = Math.max(width * scale - x, MIN_CROP_DISTANCE) + 'px';\n      cropRealImageEle.style.left = (-l * scale + Math.min(x, (width - MIN_CROP_DISTANCE) * scale)) + 'px';\n      cropFakeInnerEle.style.left = (-l * scale + Math.min(x, (width - MIN_CROP_DISTANCE) * scale)) + 'px';\n    }\n  };\n\n  finalizeCropImage = (x, y, target) => {\n    let { l, r, t, b } = this.state;\n    const { handleCrop, scale } = this.props;\n    const height = this.state.height + t + b;\n    const width = this.state.width + l + r;\n    x = Math.round(x / scale);\n    y = Math.round(y / scale);\n    this.resetOuterPos();\n    if (target.indexOf('s') >= 0) {\n      b = b + Math.max(y, MIN_CROP_DISTANCE - height);\n    }\n    if (target.indexOf('e') >= 0) {\n      r = r + Math.max(x, MIN_CROP_DISTANCE - width);\n    }\n    if (target.indexOf('n') >= 0) {\n      t = t - Math.min(y, height - MIN_CROP_DISTANCE);\n    }\n    if (target.indexOf('w') >= 0) {\n      l = l - Math.min(x, width - MIN_CROP_DISTANCE);\n    }\n    this.setState({\n      l, r, t, b,\n    });\n    handleCrop(this.state.width, this.state.height, l, r, t, b);\n  };\n\n  updateTranslateFrame = (x, y) => {\n    const { scale } = this.props;\n    const { l, t } = this.state;\n\n    const cropRealImageEle = this.cropRealImage.current;\n    const cropFakeImageEle = this.cropFakeImage.current;\n    const cropFakeInnerEle = this.cropFakeInner.current;\n    if (!cropRealImageEle || !cropFakeImageEle || !cropFakeInnerEle) {\n      return;\n    }\n\n    cropRealImageEle.style.left = (-l * scale + x) + 'px';\n    cropFakeInnerEle.style.left = (-l * scale + x) + 'px';\n\n    cropRealImageEle.style.top = (-t * scale + y) + 'px';\n    cropFakeInnerEle.style.top = (-t * scale + y) + 'px';\n  };\n\n  finalizeTranslateFrame = (x, y) => {\n    const { handleCrop, scale } = this.props;\n    x = Math.round(x / scale);\n    y = Math.round(y / scale);\n    const { width, height } = this.state;\n    this.resetOuterPos();\n    let { l, t, r, b } = this.state;\n    l = l - x;\n    t = t - y;\n    r = r + x;\n    b = b + y;\n    this.setState({\n      l, t, r, b,\n    });\n    handleCrop(width, height, l, r, t, b);\n  };\n\n  onCropMove = (relativeEvent: RelativeEventType) => {\n    const { rotation } = this.props;\n    this.currentX = relativeEvent.relativeX;\n    this.currentY = relativeEvent.relativeY;\n    const x = this.currentX - this.originX;\n    const y = this.currentY - this.originY;\n\n    const newX = x * Math.cos(-rotation / 180 * Math.PI) - y * Math.sin(-rotation / 180 * Math.PI);\n    const newY = x * Math.sin(-rotation / 180 * Math.PI) + y * Math.cos(-rotation / 180 * Math.PI);\n\n    if (this.handleTarget && this.handleTarget[0] === 'frameResize') {\n      this.updateCropFrame(newX, newY, this.handleTarget[1]);\n    } else if (this.handleTarget && this.handleTarget[0] === 'imageResize') {\n      this.updateCropImage(newX, newY, this.handleTarget[1]);\n    } else if (this.handleTarget && this.handleTarget[0] === 'frameTranslate') {\n      this.updateTranslateFrame(newX, newY);\n    }\n  };\n\n  handleMouseMove = (e) => {\n    const { getZoomContainer } = this.props;\n    e.preventDefault();\n    e.stopPropagation();\n\n    const zoomContainer = getZoomContainer();\n    const relativeEvent = getRelativeMouseEvent(e, zoomContainer!);\n    this.onCropMove(relativeEvent);\n  };\n\n  handleTouchMove = (e: TouchEvent) => {\n    const { getZoomContainer } = this.props;\n    e.preventDefault();\n    e.stopPropagation();\n\n    const zoomContainer = getZoomContainer();\n    const { targetTouches } = e;\n    const relativeEvent = getRelativeTouchEvent(targetTouches[0], zoomContainer!);\n    this.onCropMove(relativeEvent);\n  };\n\n  resetOuterPos = () => {\n    const cropOuterEle = this.cropOuter.current;\n    if (!cropOuterEle) {\n      return;\n    }\n\n    cropOuterEle.style.transform = this.cropOuterTransform;\n  };\n\n  onCropEnd = () => {\n    const { rotation } = this.props;\n\n    if (this.originX !== this.currentX || this.originY !== this.currentY) {\n      const x = this.currentX - this.originX;\n      const y = this.currentY - this.originY;\n\n      const newX = x * Math.cos(-rotation / 180 * Math.PI) - y * Math.sin(-rotation / 180 * Math.PI);\n      const newY = x * Math.sin(-rotation / 180 * Math.PI) + y * Math.cos(-rotation / 180 * Math.PI);\n\n      if (this.handleTarget && this.handleTarget[0] === 'frameResize') {\n        this.finalizeCropFrame(newX, newY, this.handleTarget[1]);\n      } else if (this.handleTarget && this.handleTarget[0] === 'imageResize') {\n        this.finalizeCropImage(newX, newY, this.handleTarget[1]);\n      } else if (this.handleTarget && this.handleTarget[0] === 'frameTranslate') {\n        this.finalizeTranslateFrame(newX, newY);\n      }\n    }\n\n    this.handleTarget = null;\n    this.originX = 0;\n    this.originY = 0;\n    this.currentX = 0;\n    this.currentY = 0;\n  };\n\n  handleMouseUp = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    this.onCropEnd();\n\n    document.removeEventListener('mousemove', this.handleMouseMove);\n    document.removeEventListener('mouseup', this.handleMouseUp);\n  };\n\n  handleTouchEnd = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const { getZoomContainer } = this.props;\n\n    const zoomContainer = getZoomContainer();\n    this.onCropEnd();\n\n    zoomContainer!.removeEventListener('touchmove', this.handleTouchMove);\n    zoomContainer!.removeEventListener('touchend', this.handleTouchEnd);\n  };\n\n  handleExitCroppingMode = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n    const { onExitCroppingMode } = this.props;\n    if (this.cropOuter.current && !this.cropOuter.current.contains(event.target)) {\n      onExitCroppingMode();\n    }\n  };\n\n  exit = (event: React.SyntheticEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    const { onExitCroppingMode } = this.props;\n    onExitCroppingMode();\n  };\n\n  componentDidMount() {\n    document.addEventListener('mousedown', this.handleExitCroppingMode);\n    document.addEventListener('touchstart', this.handleExitCroppingMode);\n  }\n\n  render() {\n    const { attributes, src, rotation, scale } = this.props;\n    const { width, height, l, r, t, b } = this.state;\n    const style: React.CSSProperties = {\n      width: width * scale,\n      height: height * scale,\n    };\n    const rotationObj = calcRotationObj(width, height, rotation);\n    if (rotationObj) {\n      style.transform = `translate(${rotationObj.translateX * scale}px, ${rotationObj.translateY * scale}px) rotate(${rotation}deg)`;\n    }\n\n    const rotateStyle = {\n      width: rotationObj ? rotationObj.rWidth * scale : width * scale,\n      height: rotationObj ? rotationObj.rHeight * scale : height * scale,\n      left: this.initialRectData.left,\n      top: this.initialRectData.top,\n    };\n\n    return (\n      <CropImageRotate style={rotateStyle}>\n        <CropOuter\n          ref={this.cropOuter}\n          onMouseDown={this.handleMouseDown}\n          onTouchStart={this.handleTouchStart}\n          style={style}\n          onDoubleClick={this.exit}\n          data-role={PluginRoles.imageCropper}\n        >\n          <CropRealOuter>\n            <CropRealImage\n              ref={this.cropRealImage}\n              src={src}\n              style={{\n                left: -l * scale,\n                top: -t * scale,\n                width: (width + l + r) * scale,\n                height: (height + t + b) * scale,\n              }}\n              {...attributes}\n            />\n          </CropRealOuter>\n          <ImageCropSrcRect />\n          <CropFrame>\n            <CropFakeInner\n              ref={this.cropFakeInner}\n              style={{\n                left: -l * scale,\n                top: -t * scale,\n              }}\n            >\n              <CropFakeImage\n                ref={this.cropFakeImage}\n                src={src}\n                style={{\n                  width: (width + l + r) * scale,\n                  height: (height + t + b) * scale,\n                }}\n              />\n            </CropFakeInner>\n          </CropFrame>\n        </CropOuter>\n      </CropImageRotate>\n    );\n  }\n}\n\nexport default ImageCrop;\n"],"file":"imageCrop.js"}