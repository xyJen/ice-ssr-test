{"version":3,"sources":["../../../../../src/plugins/image/utils/checkFileType.ts"],"names":["checkFileType","file","buffer","ImageTypeEnum","getImageTypeFromBuffer","ImagePlugin","partialBuffer","slice","imageType","fileTypeRegExp","execRes","exec","name","fileType","UNCERTAIN","newFile","File","replace","type"],"mappings":";;;;;;;AAAA;;AACA,MAAMA,aAAa,GAAG,CAACC,IAAD,EAAaC,MAAb,KAAqC;AACzD,QAAM;AAAEC,IAAAA,aAAF;AAAiBC,IAAAA;AAAjB,MAA4CC,uBAAlD;AACA,QAAMC,aAAa,GAAGJ,MAAM,CAACK,KAAP,CAAa,CAAb,EAAgB,CAAhB,CAAtB;AACA,QAAMC,SAAS,GAAGJ,sBAAsB,CAACE,aAAD,CAAxC;AACA,QAAMG,cAAc,GAAG,oBAAvB;AACA,QAAMC,OAAO,GAAGD,cAAc,CAACE,IAAf,CAAoBV,IAAI,CAACW,IAAzB,CAAhB;AACA,QAAMC,QAAQ,GAAIH,OAAO,IAAIA,OAAO,CAAC,CAAD,CAAnB,IAA2B,EAA5C;;AACA,MAAIF,SAAS,KAAKL,aAAa,CAACW,SAA5B,IAAyCD,QAAQ,KAAKL,SAA1D,EAAqE;AACnE,UAAMO,OAAO,GAAG,IAAIC,IAAJ,CAAS,CAACf,IAAD,CAAT,EAAkB,GAAEA,IAAI,CAACW,IAAL,CAAUK,OAAV,CAAkBR,cAAlB,EAAkC,EAAlC,CAAsC,IAAGD,SAAU,EAAvE,EAA0E;AACxFU,MAAAA,IAAI,EAAG,SAAQV,SAAU;AAD+D,KAA1E,CAAhB;AAGA,WAAO;AACLP,MAAAA,IAAI,EAAEc,OADD;AAELG,MAAAA,IAAI,EAAEV;AAFD,KAAP;AAID;;AACD,SAAO;AACLP,IAAAA,IADK;AAELiB,IAAAA,IAAI,EAAEL;AAFD,GAAP;AAID,CApBD;;eAsBeb,a","sourcesContent":["import { ImagePlugin } from '@ali/4ever-bamboo';\nconst checkFileType = (file: File, buffer: ArrayBuffer) => {\n  const { ImageTypeEnum, getImageTypeFromBuffer } = ImagePlugin;\n  const partialBuffer = buffer.slice(0, 4);\n  const imageType = getImageTypeFromBuffer(partialBuffer);\n  const fileTypeRegExp = /\\.([a-zA-Z0-9_]*)$/;\n  const execRes = fileTypeRegExp.exec(file.name);\n  const fileType = (execRes && execRes[1]) || '';\n  if (imageType !== ImageTypeEnum.UNCERTAIN && fileType !== imageType) {\n    const newFile = new File([file], `${file.name.replace(fileTypeRegExp, '')}.${imageType}`, {\n      type: `image/${imageType}`,\n    });\n    return {\n      file: newFile,\n      type: imageType,\n    };\n  }\n  return {\n    file,\n    type: fileType,\n  };\n};\n\nexport default checkFileType;\n"],"file":"checkFileType.js"}