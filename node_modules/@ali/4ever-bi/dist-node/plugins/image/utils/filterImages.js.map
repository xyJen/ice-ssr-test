{"version":3,"sources":["../../../../../src/plugins/image/utils/filterImages.ts"],"names":["dropImages","fragment","shouldSkipImageURL","drops","filterDescendants","node","Inline","isInline","type","data","src","result","forEach","drop","path","getPath","key","removeNode","filterTransferableImages","shouldTransferImageURL","images"],"mappings":";;;;;;;;AAAA;;AACA;;AAGA;AACA;AACA;AACA;AACA;AACO,SAASA,UAAT,CAAoBC,QAApB,EAAwCC,kBAAxC,EAAsF;AAC3F,QAAMC,KAAK,GAAGF,QAAQ,CAACG,iBAAT,CAA4BC,IAAD,IAAU;AACjD,WAAOC,oBAAOC,QAAP,CAAgBF,IAAhB,KAAyBA,IAAI,CAACG,IAAL,KAAc,OAAvC,IAAkD,CAAC,qBAAQH,IAAI,CAACI,IAAb,CAAnD,IAAyEP,kBAAkB,CAACG,IAAI,CAACI,IAAL,CAAUC,GAAX,CAAlG;AACD,GAFa,CAAd;AAIA,MAAIC,MAAM,GAAGV,QAAb;AACAE,EAAAA,KAAK,CAACS,OAAN,CAAeC,IAAD,IAAU;AACtB,UAAMC,IAAI,GAAGH,MAAM,CAACI,OAAP,CAAeF,IAAI,CAACG,GAApB,CAAb;;AACA,QAAIF,IAAJ,EAAU;AACRH,MAAAA,MAAM,GAAGA,MAAM,CAACM,UAAP,CAAkBH,IAAlB,CAAT;AACD;AACF,GALD;AAOA,SAAOH,MAAP;AACD;AAED;AACA;AACA;AACA;AACA;;;AACO,SAASO,wBAAT,CAAkCjB,QAAlC,EAAsDkB,sBAAtD,EAA2H;AAChI,QAAMC,MAAM,GAAGnB,QAAQ,CAACG,iBAAT,CAA4BC,IAAD,IAAU;AAClD,WAAOC,oBAAOC,QAAP,CAAgBF,IAAhB,KAAyBA,IAAI,CAACG,IAAL,KAAc,OAAvC,IAAkD,CAAC,CAACW,sBAApD,IAA8EA,sBAAsB,CAACd,IAAI,CAACI,IAAL,CAAUC,GAAX,CAA3G;AACD,GAFc,CAAf;AAGA,SAAOU,MAAP;AACD","sourcesContent":["import { Document, Inline } from '@ali/4ever-cangjie';\nimport { isEmpty } from 'lodash-es';\nimport { ImagePluginConfig } from '../types';\n\n/**\n * 删除某些特定 URL 的 img，这个问题主要用来处理 Word 拷贝图文的情况，图片的链接是本地文件，无法读取\n * @param fragment\n * @param dropImage\n */\nexport function dropImages(fragment: Document, shouldSkipImageURL: (src: string) => boolean) {\n  const drops = fragment.filterDescendants((node) => {\n    return Inline.isInline(node) && node.type === 'image' && !isEmpty(node.data) && shouldSkipImageURL(node.data.src);\n  });\n\n  let result = fragment;\n  drops.forEach((drop) => {\n    const path = result.getPath(drop.key);\n    if (path) {\n      result = result.removeNode(path);\n    }\n  });\n\n  return result;\n}\n\n/**\n * 过滤出可以 transfer 的图片\n * @param fragment\n * @param filterTransfer\n */\nexport function filterTransferableImages(fragment: Document, shouldTransferImageURL: ImagePluginConfig['shouldTransferImageURL']) {\n  const images = fragment.filterDescendants((node) => {\n    return Inline.isInline(node) && node.type === 'image' && !!shouldTransferImageURL && shouldTransferImageURL(node.data.src);\n  }) as Inline[];\n  return images;\n}\n"],"file":"filterImages.js"}