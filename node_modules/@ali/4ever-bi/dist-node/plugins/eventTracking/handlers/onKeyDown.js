"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = onKeyDown;

var _everCangjie = require("@ali/4ever-cangjie");

var _everBamboo = require("@ali/4ever-bamboo");

var _actions = require("../actions");

const trackSplitBlock = (0, _everBamboo.sample)(controller => {
  controller.run('onAction', (0, _actions.eventTracking)({
    type: _actions.TrackingType.splitBlock
  }));
}, {
  sample: 10
});
const trackDeleteText = (0, _everBamboo.sample)(controller => {
  controller.run('onAction', (0, _actions.eventTracking)({
    type: _actions.TrackingType.deleteText
  }));
}, {
  sample: 25
});
const trackSelectAll = (0, _everBamboo.sample)(controller => {
  controller.run('onAction', (0, _actions.eventTracking)({
    type: _actions.TrackingType.selectAll
  }));
}, {
  sample: 5
});

function onKeyDown(event, controller, next) {
  const {
    selection
  } = controller.value; // 简单排除复杂的情况，选择高频的用户场景

  if (!selection || selection.isExpanded || selection.anchor.isEdgePoint() || selection.focus.isEdgePoint()) {
    return next();
  }

  if (_everCangjie.hotkeys.isSplitBlock(event)) {
    trackSplitBlock(controller);
  } else if (_everCangjie.hotkeys.isDeleteBackward(event)) {
    const atFirstPos = selection.anchor.offset === 0;

    if (!atFirstPos) {
      trackDeleteText(controller);
    }
  } else if (_everCangjie.hotkeys.isSelectAll(event)) {
    trackSelectAll(controller);
  }

  return next();
}
//# sourceMappingURL=onKeyDown.js.map