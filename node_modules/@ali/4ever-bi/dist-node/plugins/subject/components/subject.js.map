{"version":3,"sources":["../../../../../src/plugins/subject/components/subject.tsx"],"names":["isSelectionInFoldArea","GroupFactory","Title","actions","HeadingGroupPlugin","components","SubjectPlugin","InlinePlaceholder","InnerCardWrapperForMention","Placeholder","toggleFold","SUBJECT_PADDING_LEFT","SubjectBox","styled","div","ContentBox","Content","props","paddingRight","BorderBar","color","HighlightBox","TitleContent","TitleBox","ToolBox","Subject","controller","node","attributes","isSelected","config","children","fold","subjectPr","data","review","reviewConfig","renderDingIcon","DingIcon","renderMeetingClock","MeetingClock","renderReviewPlaceholder","ReviewPlaceholder","id","name","first","nodes","topicTitlePlaceholderBefore","locale","topicTitlePlaceholderAfter","highlight","setHighlight","foldRef","React","useRef","toolRef","toolWidth","setToolWidth","useState","startBlock","endBlock","value","initFocused","key","focused","setFocused","document","displayFinishButton","isFirst","useMemo","path","getPath","index","i","$node","setFocusedValue","useCallback","newStartBlock","newEndBlock","selectionData$","useEffect","handleFoldChange","_fold","run","command","Commands","moveToStartOfNode","refreshToolWidth","tool","current","offsetWidth","moveToEndOfNode","useLayoutEffect","displayTitlePlaceholder","item","handleMentionClick","dispatch","renderTitlePlaceholder","environment","IS_MOBILE","renderTitleToolbar","toolbars","push","titleNode","titleElement","contentElements","Array","isArray","length","slice","className","selected","query","isSubjectSelected","type","top","TinyColor","setAlpha","toRgbString","bottom","displayName"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { Block, Commands, Controller, useSelectionData, environment, useUserData, useSelectingHots } from '@ali/4ever-cangjie';\nimport { Heading1Data } from '@ali/4ever-mo';\nimport styled from 'styled-components';\nimport { TinyColor } from '@ctrl/tinycolor';\nimport Content from './content';\nimport { HeadingGroupPlugin, SubjectPlugin, GroupFactory } from '@ali/4ever-bamboo';\nimport { SubjectConfig } from '../types';\nimport { isEmptyNode, isSubjectHeading } from '../utils';\nimport TopicToolbar from './topicToolbar';\nimport InsertBar from './insertBar';\nimport { getSubjectBorderColor } from '../helpers';\nimport MentionButton from './mentionButton';\nimport useHighlight from '../hooks/useHighlight';\nimport { isSubjectSelected } from '../queries';\nimport classnames from 'classnames';\nimport type { Subject as SubjectNode } from '../utils';\n\nconst { isSelectionInFoldArea } = GroupFactory;\n\nconst { Title, actions } = HeadingGroupPlugin;\n\nconst { components } = SubjectPlugin;\nconst { InlinePlaceholder, InnerCardWrapperForMention, Placeholder } = components;\n\nconst { toggleFold } = actions;\n\nexport const SUBJECT_PADDING_LEFT = 19;\n\nconst SubjectBox = styled.div<{ paddingRight?: number }>`\n  position: relative;\n  padding-left: ${SUBJECT_PADDING_LEFT}px;\n  margin: 40px 0;\n\n  & [data-name=\"group-fold-btn\"] {\n    left: -18px;\n  }\n\n  &.selected {\n    background-color: rgba(17, 31, 44, 0.08);\n  }\n`;\n\nconst ContentBox = styled(Content) <{ paddingRight?: number }>`\n  position: relative;\n\n  & > [data-type='heading-1-group'] > [data-name='heading-group-title'] {\n    padding-right: ${(props) => props.paddingRight || 0}px;\n  }\n\n  /* fix: https://aone.alibaba-inc.com/v2/project/1090534/bug/35751455 */\n  & .draggable-highlight.shadow-highlight {\n    border-radius: 0;\n    box-shadow: none;\n  }\n`;\n\nconst BorderBar = styled.div<{ color: string }>`\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 3px;\n  border-radius: 1.5px;\n  height: 100%;\n  background: ${(props) => props.color};\n  transition: all 0.2s ease-in-out;\n`;\n\nconst HighlightBox = styled.div`\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  background-color: ${(props) => props.color};\n\n  @keyframes highlight-in {\n    from {\n    }\n\n    to {\n      background-color: transparent;\n    }\n  }\n\n  animation-fill-mode: forwards;\n  animation-name: highlight-in;\n  animation-duration: 2s;\n`;\n\nconst TitleContent = styled.div`\n  /* fix: https://aone.alibaba-inc.com/v2/project/1090534/bug/35812515 */\n  & h1 {\n    font-size: 20px;\n  }\n`;\n\nconst TitleBox = styled(Title) <{ paddingRight?: number }>`\n  padding-right: ${(props) => props.paddingRight}px;\n\n  & .data-comment-bubbles {\n    left: ${(props) => props.paddingRight}px;\n  }\n`;\n\nconst ToolBox = styled.div`\n  position: absolute;\n  height: 28px;\n  right: 0;\n  top: 0;\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n`;\n\nexport interface SubjectProps {\n  controller: Controller;\n  node: Block<Heading1Data>;\n  attributes: Record<string, string>;\n  isSelected: boolean;\n  config: SubjectConfig;\n}\n\n/**\n * 议题区块\n * @param props\n * @returns\n */\nconst Subject: React.FC<SubjectProps> = (props) => {\n  const {\n    controller,\n    node,\n    attributes,\n    isSelected,\n    config,\n    children,\n  } = props;\n\n  const fold = useUserData(node, 'fold') || false;\n  const { subjectPr = {} } = node.data;\n  const { review: reviewConfig } = config;\n  const {\n    renderDingIcon: DingIcon,\n    renderMeetingClock: MeetingClock,\n    renderReviewPlaceholder: ReviewPlaceholder,\n  } = reviewConfig || {};\n  const { id = '', name = 'topic' } = subjectPr;\n  const first = node.nodes[0] as Block;\n  const topicTitlePlaceholderBefore = config?.locale?.topicTitlePlaceholderBefore;\n  const topicTitlePlaceholderAfter = config?.locale?.topicTitlePlaceholderAfter;\n  const [highlight, setHighlight] = useHighlight(controller, id);\n\n  const foldRef = React.useRef(fold);\n  const toolRef = React.useRef<HTMLDivElement>(null);\n  const [toolWidth, setToolWidth] = React.useState(0);\n\n  const { startBlock, endBlock } = controller.value;\n  const initFocused = !!startBlock && startBlock.key === first.key\n    && !!endBlock && endBlock.key === first.key;\n  const [focused, setFocused] = React.useState(initFocused);\n\n  const { document } = controller.value;\n\n  const displayFinishButton = !(name === 'topic' && isEmptyNode(first)) && focused;\n\n  // 查询当前议题是否是第一个议题\n  // NOTE: 这个写法感觉还是存在查询性能问题，但是目前没有其他比较好的解法\n  const isFirst = React.useMemo(() => {\n    const path = document.getPath(first.key);\n    if (path) {\n      const [index] = path;\n      for (let i = index - 1; i >= 0; i--) {\n        const $node = document.nodes[i];\n        if (isSubjectHeading($node)) {\n          return false;\n        }\n      }\n      return true;\n    }\n    return false;\n  }, [document, first]);\n\n  const setFocusedValue = React.useCallback(() => {\n    const { startBlock: newStartBlock, endBlock: newEndBlock } = controller.value;\n    if (newStartBlock && newStartBlock.key === first.key\n      && newEndBlock && newEndBlock.key === first.key\n    ) {\n      if (focused === false) {\n        setFocused(true);\n      }\n    } else if (focused === true) {\n      setFocused(false);\n    }\n  }, [controller, first, focused]);\n\n  useSelectionData(controller.selectionData$, null, setFocusedValue, []);\n  useSelectingHots(controller, setFocusedValue);\n\n  React.useEffect(() => {\n    setFocusedValue();\n  }, [startBlock, endBlock, setFocusedValue]);\n\n  const handleFoldChange = React.useCallback((_fold: boolean) => {\n    controller.run('onAction', toggleFold({\n      node: first,\n      fold: _fold,\n    }));\n    // 折叠标题后，将选区移动至标题行首，避免页面聚焦造成的抖动\n    controller.command(Commands.moveToStartOfNode, first);\n  }, [controller, first]);\n\n  const color = React.useMemo(() => getSubjectBorderColor(name), [name]);\n\n  const refreshToolWidth = React.useCallback(() => {\n    const tool = toolRef.current;\n    if (tool && tool.offsetWidth !== toolWidth) {\n      setToolWidth(tool.offsetWidth);\n    }\n  }, [toolWidth]);\n\n  // fix: https://aone.alibaba-inc.com/v2/project/897543/bug/36243039\n  React.useEffect(() => {\n    if (!foldRef.current && fold && isSelected && isSelectionInFoldArea(controller, first)) {\n      controller.command(Commands.moveToEndOfNode, first);\n    }\n    foldRef.current = fold;\n  }, [controller, first, fold, isSelected]);\n\n  React.useLayoutEffect(() => {\n    refreshToolWidth();\n  }, [displayFinishButton]);\n\n  const displayTitlePlaceholder = (item: Block) => {\n    // 类型是议题 && 非预览模式 && 没有标题 && 有 placeholder 文字配置才展示\n    if (name === 'topic' && isEmptyNode(item) && topicTitlePlaceholderBefore && topicTitlePlaceholderAfter) {\n      return true;\n    }\n    return false;\n  };\n\n  const handleMentionClick = React.useCallback(() => {\n    const { startBlock } = controller.value;\n    if (startBlock?.key !== first.key) {\n      controller.command(Commands.moveToEndOfNode, first);\n    }\n    controller.dispatch('activeMention');\n  }, [controller, first]);\n\n  const renderTitlePlaceholder = () => {\n    if (name === 'topic') {\n      if (environment.IS_MOBILE) {\n        return (\n          <InlinePlaceholder>\n            {topicTitlePlaceholderBefore}\n            {' @ '}\n            {topicTitlePlaceholderAfter}\n          </InlinePlaceholder>\n        );\n      }\n      return (\n        <InlinePlaceholder>\n          {topicTitlePlaceholderBefore}\n          <InnerCardWrapperForMention>\n            <MentionButton onClick={handleMentionClick} />\n          </InnerCardWrapperForMention>\n          {topicTitlePlaceholderAfter}\n        </InlinePlaceholder>\n      );\n    }\n    return '';\n  };\n\n  const renderTitleToolbar = (displayFinishButton = true) => {\n    const toolbars = [] as any;\n    if (name === 'review' && DingIcon) {\n      toolbars.push(<DingIcon node={node} />);\n    }\n\n    if (name === 'review' && ReviewPlaceholder) {\n      toolbars.push(<ReviewPlaceholder node={node} type=\"iconOnly\" />);\n    }\n\n    if (name === 'topic') {\n      MeetingClock && toolbars.push(<MeetingClock node={node} refreshToolWidth={refreshToolWidth} />);\n      toolbars.push(<TopicToolbar displayFinishButton={displayFinishButton} node={first} controller={controller} config={config} />);\n    }\n\n    return toolbars;\n  };\n\n  // 切割议题的标题和内容块\n  let titleNode: Block;\n  let titleElement: React.ReactNode;\n  let contentElements: React.ReactNode[];\n\n  if (Array.isArray(children) && children.length >= 1) {\n    titleNode = node.nodes[0] as Block;\n    titleElement = children[0];\n    contentElements = children.slice(1);\n  } else {\n    return <>{children}</>;\n  }\n\n  const className = classnames({\n    selected: controller.query(isSubjectSelected, first as SubjectNode),\n  });\n\n  return (\n    <SubjectBox\n      {...attributes}\n      className={className}\n      key={node.key}\n      id={id}\n      data-block-uuid={id}\n      paddingRight={toolWidth}\n      data-cangjie-group-block\n      data-name=\"subject-group\"\n      data-subject-name={name}\n      data-type={node.type}\n      data-foldable\n    >\n      {!environment.IS_MOBILE && isFirst && (\n        <InsertBar\n          style={{ top: -40 }}\n          config={config}\n          node={first}\n          direction=\"before\"\n          controller={controller}\n        />\n      )}\n      <BorderBar color={color} />\n      {highlight && (\n        <HighlightBox\n          color={new TinyColor(color).setAlpha(0.3).toRgbString()}\n          onAnimationEnd={() => setHighlight(false)}\n        />\n      )}\n      <TitleBox\n        dataName=\"subject-group-title\"\n        fold={fold}\n        onChange={handleFoldChange}\n        paddingRight={toolWidth}\n      >\n        <TitleContent data-name=\"subject-group-title-content\">\n          <Placeholder\n            controller={controller}\n            node={titleNode}\n            display={displayTitlePlaceholder}\n            placeholder={renderTitlePlaceholder()}\n          >\n            {titleElement}\n          </Placeholder>\n        </TitleContent>\n        <ToolBox ref={toolRef}>\n          {renderTitleToolbar(displayFinishButton)}\n        </ToolBox>\n      </TitleBox>\n      <ContentBox config={config} dataName=\"subject-group-content\" controller={controller} node={node} fold={fold} paddingRight={toolWidth}>\n        {contentElements}\n      </ContentBox>\n      {!environment.IS_MOBILE && (\n        <InsertBar\n          style={{ bottom: -40 }}\n          config={config}\n          node={first}\n          direction=\"after\"\n          controller={controller}\n        />\n      )}\n    </SubjectBox>\n  );\n};\n\nSubject.displayName = 'Subject';\n\nexport default Subject;\n"],"file":"subject.js"}