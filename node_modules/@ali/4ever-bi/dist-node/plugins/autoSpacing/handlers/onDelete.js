"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = onDelete;

var _everCangjie = require("@ali/4ever-cangjie");

var _utils = require("../utils");

function onDelete(controller, next, isForward) {
  // 选中内容执行删除不进入空格清除流程
  if (controller.value.selection.isExpanded) return next();
  const deleted = isForward ? (0, _utils.getNextText)(controller).shift() : (0, _utils.getPreText)(controller).pop(); // 删除后判断是否需要清除空格

  next(); // 未删除内容提前结束

  if (!deleted) return;
  const preText = (0, _utils.getPreText)(controller);
  const nextText = (0, _utils.getNextText)(controller);
  if (!preText.length && !nextText.length) return;
  const preLastText = preText[preText.length - 1];
  const preSecondText = preText[preText.length - 2];
  const nextFirstText = nextText[0];
  const nextSecondText = nextText[1];
  const [shouldDeleteBefore, shouldDeleteAfter] = (0, _utils.shouldDeleteSiblingSpacing)(preSecondText, preLastText, nextFirstText, nextSecondText, deleted);

  if (shouldDeleteBefore) {
    controller.command(_everCangjie.Commands.deleteBackward);
  }

  if (shouldDeleteAfter) {
    controller.command(_everCangjie.Commands.deleteForward);
  }
}
//# sourceMappingURL=onDelete.js.map