{"version":3,"sources":["../../../../src/plugins/autoSpacing/utils.ts"],"names":["SPACING","isBlankOrEmoji","char","length","test","isLatin","shouldDeleteSpacing","a","b","c","sibling","isExpanded","textUtils","isChineseChar","shouldAutoSpacing","isPunc","getNodeText","node","start","end","Array","from","text","slice","getPreText","controller","document","selection","value","convertToTextPoints","startTextNode","getNode","key","offset","getNextText","endTextNode","shouldKeepSpcing","shouldDeleteSiblingSpacing","d","deleted","shoudDeleteBefore","shoudDeleteAfter"],"mappings":"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","sourcesContent":["import { textUtils, Controller, Node } from '@ali/4ever-cangjie';\n\nconst SPACING = ' ';\n\n/**\n * åˆ¤æ–­æ˜¯å¦ä¸ºç©ºç™½ç¬¦æˆ–emoji\n * å¤„äºæ€§èƒ½è€ƒè™‘ä¸åš unicode splitï¼Œæ‰€æœ‰é•¿åº¦å¤§äº 1 çš„ grapheme éƒ½è¢«è§†ä¸º emoji\n */\nexport function isBlankOrEmoji(char?: string) {\n  // char.length > 1: ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦\n  if (!char || char.length > 1 || /\\s/.test(char)) return true;\n  return false;\n}\n\n/**\n * æ£€æµ‹æ˜¯å¤Ÿä¸ºå¸¸è§æ‹‰ä¸æ–‡\n * ascii: https://www.ascii-code.com/\n * https://newbedev.com/regex-with-extended-latin-alphabet-a-o-u-e-ss\n */\nexport function isLatin(char: string) {\n  // C0 åˆ° FF ä¸ä¸€å®šåŒ…å«æ‰€æœ‰å˜å½¢ï¼Œå¦‚: Å¬\n  // /[A-z|0-9|\\u00C0-\\u00FF]/.test(undefined) = true\n  return char && /[A-z|0-9|\\u00C0-\\u00FF]/.test(char);\n}\n\n/**\n * åˆ¤æ–­æ˜¯å¦åº”è¯¥åˆ é™¤ç©ºæ ¼\n * é¦–å…ˆï¼Œåº”è¯¥æ»¡è¶³åœ¨è¥¿æ–‡å‰åè¾“å…¥ï¼š\n * ä¸­æ–‡ [è¾“å…¥:ä¸­æ–‡][å…‰æ ‡]Charï¼šåˆ é™¤å‰é¢ç©ºæ ¼\n * Char[å…‰æ ‡][è¾“å…¥:ä¸­æ–‡] ä¸­æ–‡ï¼šåˆ é™¤åé¢ç©ºæ ¼\n * å…¶æ¬¡ï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹ patternï¼š\n *     a          b          c\n * eastAsian   spacing   eastAsian\n * å¦å¤–ç”¨æˆ·å¦‚æœæ˜¯é€‰ä¸­å†…å®¹è¾“å…¥ï¼Œæˆ‘ä»¬ä¸åšç©ºæ ¼æ¸…é™¤ï¼ŒåŸå› åœ¨äºæ— æ³•å‡†ç¡®åˆ¤æ–­ç”¨æˆ·æ„å›¾ï¼Œä¾‹å¦‚ï¼š\n *     [-----é€‰åŒº-----] \n * ä¸­æ–‡   Char ä¸­æ–‡ä¸­æ–‡ä¸­æ–‡ä¸­æ–‡\n * æˆ‘ä»¬éš¾ä»¥åˆ¤æ–­æ­¤æ—¶ç”¨æˆ·æ˜¯æƒ³è¾“å…¥å†…å®¹ä¸åé¢å†…å®¹è”ç³»è¿˜æ˜¯ä¸å‰é¢å†…å®¹è”ç³»\n */\nexport function shouldDeleteSpacing(a: string, b: string, c: string, sibling: string, isExpanded: boolean) {\n  if (isExpanded || b !== SPACING || !isLatin(sibling)) return false;\n  return textUtils.isChineseChar(a) && textUtils.isChineseChar(c);\n}\n\n/**\n * åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¹‹é—´æ˜¯å¦åº”è¯¥ autoSpacing\n */\nexport function shouldAutoSpacing(a: string, b: string) {\n  // æœ‰ä»»æ„ä¸€ä¸ªä¸ºç©ºç™½ç¬¦ æˆ– å¤šç ç‚¹ unicode åˆ™ä¸åŠ  spacing\n  if(isBlankOrEmoji(a) || isBlankOrEmoji(b)) return false;\n\n  // æœ‰ä»»æ„ä¸€ä¸ªä¸ºæ ‡ç‚¹ åˆ™ä¸åŠ  spacing\n  if(textUtils.isPunc(a) || textUtils.isPunc(b)) return false;\n\n  return isLatin(a) !== isLatin(b);\n}\n\n/**\n * è·å–èŠ‚ç‚¹æ–‡æœ¬\n */\nfunction getNodeText(node: Node | null, start: number, end?: number) {\n  if (!node) return [];\n  // perf: use Array.from é¿å…å¤æ‚çš„ unicode æ‹†åˆ†\n  return Array.from(node.text.slice(start, end));\n}\n\n/**\n * è·å–å½“å‰é€‰åŒºå‰åçš„æ–‡å­—\n * @param controller \n */\nexport function getPreText(controller: Controller) {\n  const { document, selection } = controller.value;\n  const { start } = selection.convertToTextPoints(document);\n  const startTextNode = document.getNode(start.key);\n  \n  return getNodeText(startTextNode, 0, start.offset);\n}\n\nexport function getNextText(controller: Controller) {\n  const { document, selection } = controller.value;\n  const { end } = selection.convertToTextPoints(document);\n  const endTextNode = document.getNode(end.key);\n  \n  return getNodeText(endTextNode, end.offset);\n}\n\n/**\n * è¥¿æ–‡ä¸­é—´å…è®¸æœ‰ç©ºæ ¼\n */\nfunction shouldKeepSpcing(a: string, b: string) {\n  return isLatin(a) && isLatin(b);\n}\n\n/**\n * è¿ç»­ç©ºæ ¼åˆ é™¤é€»è¾‘\n * é¦–å…ˆï¼Œå¿…é¡»æ˜¯è¿ç»­ç©ºæ ¼ç›¸é‚»\n *     a          b          c          d\n *             spacing    spacing\n * å…¶æ¬¡ï¼Œåˆ†åˆ«åˆ¤æ–­ deleted å’Œ a/b çš„ç±»å‹ä»¥å†³å®šæ˜¯å¦åˆ é™¤å¯¹åº”ç©ºæ ¼\n * æœ€åï¼Œè¥¿æ–‡ä¹‹é—´æ˜¯éœ€è¦ç©ºæ ¼çš„ï¼Œä½†æˆ‘ä»¬éš¾ä»¥åˆ¤æ–­è¿ç»­ç©ºæ ¼å‰åçš„è¯­ä¹‰ï¼Œå› æ­¤ä¿ç•™ä¸€ä¸ªç©ºæ ¼\n */\nexport function shouldDeleteSiblingSpacing(a: string, b: string, c: string, d: string, deleted?: string) {\n  // éè¿ç»­ç©ºæ ¼ä¸å¤„ç†\n  if (isBlankOrEmoji(deleted) || b !== SPACING || c !== SPACING) return [false, false];\n  \n  // ç‰¹åˆ«æ³¨æ„ï¼šç…§é¡¾è‹±æ–‡è¾“å…¥ä¹ æƒ¯ï¼Œç©ºæ ¼ç•™åœ¨å‰é¢\n  const shoudDeleteBefore = shouldAutoSpacing(a, deleted || '') && !shouldKeepSpcing(a, d);\n  const shoudDeleteAfter = shouldAutoSpacing(deleted || '', d);\n\n  return [shoudDeleteBefore, shoudDeleteAfter];\n}"],"file":"utils.js"}