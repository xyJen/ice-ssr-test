{"version":3,"sources":["../../../../../src/plugins/indent/components/createMobileButtons.tsx"],"names":["MOBILE_TOOLBAR","increase","icon","action","increaseIndent","decrease","decreaseIndent","canIndent","controller","isInc","value","startBlock","endBlock","indentNode","data","ind","left","list","level","MAX_INDENT_SIZE","useDisabledAndClick","isCollapsedAtEdge","selection","isDisabled","Boolean","query","handleClick","React","useCallback","run","createMobileHeading","locale","Object","keys","reduce","result","type","props","Wrapper","item","indentable"],"mappings":"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","sourcesContent":["/* eslint-disable no-param-reassign */\nimport * as React from 'react';\nimport { increaseIndent, decreaseIndent } from '../actions';\nimport type { MobileToolbarButtonProps } from '@ali/4ever-component';\nimport { getClosestParagraph, MAX_INDENT_SIZE } from '@ali/4ever-utils';\nimport { Controller } from '@ali/4ever-cangjie';\n\nconst MOBILE_TOOLBAR = {\n  increase: {\n    icon: 'indentRight',\n    action: increaseIndent,\n  },\n  decrease: {\n    icon: 'indentLeft',\n    action: decreaseIndent,\n  },\n};\n\nfunction canIndent(controller: Controller, isInc: boolean) {\n  const { value } = controller;\n  const { startBlock, endBlock } = value;\n  if (startBlock !== endBlock || !startBlock) {\n    return true;\n  }\n  const indentNode = getClosestParagraph(value, startBlock);\n  if (!indentNode) {\n    return true;\n  }\n\n  // 减少的情况。如果没有、或者已经很小了，就 disable\n  if (!isInc && !indentNode.data?.ind?.left && !indentNode.data?.list?.level) {\n    return false;\n  }\n\n  // 增加的情况。如果有、并且已经很大了，就 disable\n  if (\n    isInc &&\n    indentNode.data?.ind?.left &&\n    indentNode.data.ind.left >= MAX_INDENT_SIZE\n  ) {\n    return false;\n  }\n  return true;\n}\n\nfunction useDisabledAndClick(controller, action) {\n  const { isCollapsedAtEdge } = controller.value.selection;\n  const isDisabled = Boolean(\n    isCollapsedAtEdge ||\n      controller.query('isSelectionInHr') ||\n      controller.query('isSelectionInListSymbol'),\n  );\n  const handleClick = React.useCallback(\n    () => controller.run('onAction', action()),\n    [action, controller],\n  );\n  return { isDisabled, handleClick };\n}\n\nexport default function createMobileHeading(locale: any) {\n  return Object.keys(MOBILE_TOOLBAR).reduce((result, type) => {\n    result[`${type}MobileBig`] = (props: MobileToolbarButtonProps) => {\n      const { controller, Wrapper, item } = props;\n      const { icon, action } = MOBILE_TOOLBAR[type];\n      // eslint-disable-next-line react-hooks/rules-of-hooks\n      const { isDisabled, handleClick } = useDisabledAndClick(\n        controller,\n        action,\n      );\n      const indentable =\n        !isDisabled && canIndent(controller, type === 'increase');\n\n      return (\n        <Wrapper\n          item={item}\n          type=\"big\"\n          icon={icon}\n          isDisabled={isDisabled || !indentable}\n          onClick={handleClick}\n        />\n      );\n    };\n    result[`${type}Mobile`] = (props: MobileToolbarButtonProps) => {\n      const { controller, Wrapper, item } = props;\n      const { icon, action } = MOBILE_TOOLBAR[type];\n      // eslint-disable-next-line react-hooks/rules-of-hooks\n      const { isDisabled, handleClick } = useDisabledAndClick(\n        controller,\n        action,\n      );\n\n      return (\n        <Wrapper\n          item={item}\n          type=\"horiz\"\n          icon={icon}\n          isDisabled={Boolean(isDisabled)}\n          onClick={handleClick}\n        />\n      );\n    };\n    return result;\n  }, {});\n}\n"],"file":"createMobileButtons.js"}