{"version":3,"sources":["../../../../../src/plugins/indent/handlers/onDelete.ts"],"names":["onDelete","event","editor","next","value","document","selection","isExpanded","startText","Code","isCode","startOffset","convertToTextPoints","start","offset","prevText","text","slice","preventDefault","command","Commands","removeTextByKey","key","currentParagraph","isDeleteAtFirstChar","anchor","isAtStartOfNode","ind","data","hasLeftInd","leftChars","left","firstLine","firstLineChars","hanging","hangingChars","IndentTrigger","keyboard"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AAEe,SAASA,QAAT,CAAkBC,KAAlB,EAAyBC,MAAzB,EAA6CC,IAA7C,EAAmD;AAChE,QAAM;AAAEC,IAAAA;AAAF,MAAYF,MAAlB;AACA,QAAM;AAAEG,IAAAA;AAAF,MAAeD,KAArB;AACA,QAAM;AAAEE,IAAAA;AAAF,MAAgBF,KAAtB;;AACA,MAAIE,SAAS,EAAEC,UAAf,EAA2B;AACzB,WAAOJ,IAAI,EAAX;AACD;;AAED,QAAM;AAAEK,IAAAA;AAAF,MAAgBJ,KAAtB,CARgE,CAShE;;AACA,MAAIK,aAAKC,MAAL,CAAYF,SAAZ,CAAJ,EAA4B;AAC1B,WAAOL,IAAI,EAAX;AACD;;AACD,QAAMQ,WAAW,GAAGL,SAAS,CAAEM,mBAAX,CAA+BP,QAA/B,EAAyCQ,KAAzC,CAA+CC,MAAnE;;AAEA,MAAIH,WAAW,GAAG,CAAlB,EAAqB;AACnB,QAAIA,WAAW,GAAG,CAAlB,EAAqB;AACnB,aAAOR,IAAI,EAAX;AACD;;AAED,UAAMY,QAAQ,GAAGP,SAAS,GAAGA,SAAS,CAACQ,IAAV,CAAeC,KAAf,CAAqBN,WAAW,GAAG,CAAnC,EAAsCA,WAAtC,CAAH,GAAwD,EAAlF;;AACA,QAAII,QAAQ,KAAK,MAAjB,EAAyB;AACvB,aAAOZ,IAAI,EAAX;AACD;AAED;;;AACAF,IAAAA,KAAK,CAACiB,cAAN;AACA,WAAOhB,MAAM,CAACiB,OAAP,CAAeC,sBAASC,eAAxB,EAAyCb,SAAS,GAAGA,SAAS,CAACc,GAAb,GAAmB,EAArE,EAAyEX,WAAW,GAAG,CAAvF,EAA0F,MAA1F,CAAP;AACD;AAED;;;AACA,QAAMY,gBAAgB,GAAG,oCAAoBnB,KAApB,CAAzB;;AACA,MAAI,CAACmB,gBAAL,EAAuB;AACrB,WAAOpB,IAAI,EAAX;AACD;;AAED,QAAMqB,mBAAmB,GAAGlB,SAAS,CAAEmB,MAAX,CAAkBC,eAAlB,CAAkCH,gBAAlC,CAA5B;;AACA,MAAI,CAACC,mBAAL,EAA0B;AACxB,WAAOrB,IAAI,EAAX;AACD;;AAED,QAAM;AAAEwB,IAAAA;AAAF,MAAUJ,gBAAgB,CAACK,IAAjC;;AACA,MAAI,CAACD,GAAL,EAAU;AACR,WAAOxB,IAAI,EAAX;AACD;;AACD,QAAM0B,UAAU,GAAGF,GAAG,CAACG,SAAJ,IAAiBH,GAAG,CAACI,IAArB,IAA6BJ,GAAG,CAACK,SAAjC,IAA8CL,GAAG,CAACM,cAAlD,IAAoEN,GAAG,CAACO,OAAxE,IAAmFP,GAAG,CAACQ,YAA1G;;AACA,MAAI,CAACN,UAAL,EAAiB;AACf,WAAO1B,IAAI,EAAX;AACD;;AAEDF,EAAAA,KAAK,CAACiB,cAAN;AACA,SAAO,6BAAehB,MAAf,EAAuBkC,qBAAcC,QAArC,CAAP;AACD","sourcesContent":["import { Controller, Commands } from '@ali/4ever-cangjie';\nimport { Code } from '@ali/4ever-mo';\nimport decreaseIndent from '../commands/decreaseIndent';\nimport { getClosestParagraph } from '@ali/4ever-utils';\nimport { IndentTrigger } from '../utils';\n\nexport default function onDelete(event, editor: Controller, next) {\n  const { value } = editor;\n  const { document } = value;\n  const { selection } = value;\n  if (selection?.isExpanded) {\n    return next();\n  }\n\n  const { startText } = value;\n  // 代码块因为不是 void(历史原因)，当内容末尾是 4 个空格时，要跳过这段逻辑\n  if (Code.isCode(startText)) {\n    return next();\n  }\n  const startOffset = selection!.convertToTextPoints(document).start.offset;\n\n  if (startOffset > 0) {\n    if (startOffset < 4) {\n      return next();\n    }\n\n    const prevText = startText ? startText.text.slice(startOffset - 4, startOffset) : '';\n    if (prevText !== '    ') {\n      return next();\n    }\n\n    /* 若前面有四个连续空格，则删除 */\n    event.preventDefault();\n    return editor.command(Commands.removeTextByKey, startText ? startText.key : '', startOffset - 4, '    ');\n  }\n\n  /* 在行首 backspace/delete 撤销缩进 */\n  const currentParagraph = getClosestParagraph(value);\n  if (!currentParagraph) {\n    return next();\n  }\n\n  const isDeleteAtFirstChar = selection!.anchor.isAtStartOfNode(currentParagraph);\n  if (!isDeleteAtFirstChar) {\n    return next();\n  }\n\n  const { ind } = currentParagraph.data;\n  if (!ind) {\n    return next();\n  }\n  const hasLeftInd = ind.leftChars || ind.left || ind.firstLine || ind.firstLineChars || ind.hanging || ind.hangingChars;\n  if (!hasLeftInd) {\n    return next();\n  }\n\n  event.preventDefault();\n  return decreaseIndent(editor, IndentTrigger.keyboard);\n}\n"],"file":"onDelete.js"}