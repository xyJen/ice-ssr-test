{"version":3,"sources":["../../../../src/__tests__/heading/ui.test.tsx"],"names":["getListData","OldUtils","origin_value","beforeAll","process","env","RUNTIME_ENV","ToolbarLayout","UITEST_FLAG","afterAll","createValue","text","createListValue","level","type","listStyleType","listId","PARAM_HOT_KEY","describe","triggerText","selector","headType","hotKey","forEach","it","container","queryByTestId","trigger","fireEvent","click","btn","node","querySelector","expect","textContent","toBe","listItem","paragraphBtn","para","headings","querySelectorAll","style","marginBottom","length","value","editor","content","cangjieInput","data","keyDown"],"mappings":"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","sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\n/** @jsx jsx */\nimport { wait, waitFor, waitForElementToBeRemoved } from '@testing-library/react';\nimport { renderEditor, getHotkeyEvent, jsx, fireEvent } from '@ali/4ever-dev-test';\nimport { Value } from '@ali/4ever-cangjie';\nimport { OldUtils } from '@ali/4ever-plugin-list';\nimport Editor from '../editor';\nimport { ToolbarLayout } from '@ali/we-design-next';\n\nconst { getListData } = OldUtils;\n\nlet origin_value\nbeforeAll(() => {\n  origin_value = process.env.RUNTIME_ENV;\n  process.env.RUNTIME_ENV = ToolbarLayout.UITEST_FLAG\n})\n\nafterAll(() => {\n  process.env.RUNTIME_ENV = origin_value;\n})\n\nfunction createValue(text: string) {\n  return (\n    <value>\n      <document>\n        <block type=\"paragraph\"><cursor />{text}</block>\n      </document>\n    </value>\n  ) as unknown as Value;\n}\n\nfunction createListValue (text: string) {\n  return (\n    <value>\n      <document>\n        <block\n          type=\"paragraph\"\n          data={getListData({ level: 0, type: 'ol', listStyleType: 'DEC_LEN_LROM_P', listId: 'dn7ncrq6m7j' })}\n        >\n          <cursor />\n          {text}\n        </block>\n      </document>\n    </value>\n  ) as unknown as Value;\n}\n\nconst PARAM_HOT_KEY = '0+ctrl+alt';\n\ndescribe('Bi/heading/ui', () => {\n  [{\n    type: '一级标题',\n    triggerText: '#',\n    selector: 'h1',\n    headType: 'heading-1',\n    hotKey: '1+ctrl+alt',\n  }, {\n    type: '二级标题',\n    triggerText: '##',\n    selector: 'h2',\n    headType: 'heading-2',\n    hotKey: '2+ctrl+alt',\n  }, {\n    type: '三级标题',\n    triggerText: '###',\n    selector: 'h3',\n    headType: 'heading-3',\n    hotKey: '3+ctrl+alt',\n  }, {\n    type: '四级标题',\n    triggerText: '####',\n    selector: 'h4',\n    headType: 'heading-4',\n    hotKey: '4+ctrl+alt',\n  }].forEach(({\n    type, headType, triggerText, selector, hotKey,\n  }) => {\n    describe(type, () => {\n      it(`点击按钮把当前行设为${type}`, async () => {\n        const { container, queryByTestId } = await renderEditor(<Editor defaultValue={createValue('Hello')} />);\n   \n        const trigger = await waitFor(() => queryByTestId('bi-toolbar-heading'));\n        fireEvent.click(trigger!);\n        const btn = await waitFor(() => queryByTestId(`bi-toolbar-heading__list_${headType}`));\n        fireEvent.click(btn!);\n\n        // flush\n        await wait();\n\n        const node = container.querySelector(selector) as HTMLElement;\n        expect(node.textContent).toBe('Hello');\n\n        const listItem = queryByTestId('list');\n        expect(listItem).toBe(null);\n      });\n      it(`点击按钮把当前列表行设为${type}`, async () => {\n        const { container, queryByTestId } = await renderEditor(<Editor defaultValue={createListValue('Hello')} />);\n    \n        const trigger = await waitFor(() => queryByTestId('bi-toolbar-heading'));\n        fireEvent.click(trigger!);\n        const btn = await waitFor(() => queryByTestId(`bi-toolbar-heading__list_${headType}`));\n        fireEvent.click(btn!);\n\n        // flush\n        await wait();\n\n        const node = container.querySelector(selector) as HTMLElement;\n        expect(node.textContent).toBe('Hello');\n\n        const listItem = queryByTestId('list');\n        expect(listItem.textContent).toBe('1.Hello');\n      });\n\n      it(`点击按钮把当前${type}设为普通段落`, async () => {\n        const { container, queryByTestId } = await renderEditor(<Editor defaultValue={createValue('Hello')} />);\n      \n        let trigger = await waitFor(() => queryByTestId('bi-toolbar-heading'));\n        fireEvent.click(trigger!);\n        const btn = await waitFor(() => queryByTestId(`bi-toolbar-heading__list_${headType}`));\n        fireEvent.click(btn!);\n\n        // flush\n        await wait();\n\n        trigger = container.querySelector('[data-testid=\"bi-toolbar-heading\"]');\n\n        // 再次唤起工具栏\n        fireEvent.click(trigger!);\n\n        const paragraphBtn = await waitFor(() => queryByTestId('bi-toolbar-heading__list_paragraph'));\n        fireEvent.click(paragraphBtn!);\n\n        // flush\n        await wait();\n\n        const para = container.querySelector('[data-type=\"paragraph\"]') as HTMLElement;\n        const headings = container.querySelectorAll(selector);\n        // 确认正文 margin 即段后距, 被reset，before和after支持margin-top=0px\n        expect(para.style.marginBottom).toBe('');\n        expect(para.textContent).toBe('Hello');\n        expect(headings.length).toBe(0);\n      });\n\n      it(`在 ${triggerText} 后输入空格，把 ${triggerText} 替换为 ${type}`, async () => {\n        const value = (\n          <value>\n            <document>\n              <block type=\"paragraph\">{triggerText}<cursor /></block>\n            </document>\n          </value>\n        ) as unknown as Value;\n        const { editor, content } = await renderEditor(<Editor defaultValue={value} />);\n        fireEvent.cangjieInput(editor, { data: ' ' });\n\n        // flush\n        await wait();\n\n        expect(content.querySelectorAll(selector).length).toBe(1);\n      });\n\n      it(`在被嵌套的情况下，不把 ${triggerText} 替换为 ${type}`, async () => {\n        const value = (\n          <value>\n            <document>\n              <block type=\"paragraph\">*{triggerText}<cursor /></block>\n            </document>\n          </value>\n        ) as unknown as Value;\n        const { editor, content } = await renderEditor(<Editor defaultValue={value} />);\n        fireEvent.cangjieInput(editor, { data: ' ' });\n\n        // flush\n        await wait();\n\n        expect(content.querySelector('div[data-type=paragraph] span[data-cangjie-leaf]')?.textContent).toBe(`*${triggerText} `);\n        expect(content.querySelectorAll(selector).length).toBe(0);\n      });\n\n      it(`通过快捷键'${hotKey}'把正文文本设置为${type}, 并可以通过'0+Ctrl+alt'重置为正文`, async () => {\n        const { content, editor } = await renderEditor(<Editor defaultValue={createValue('Hello')} />);\n        fireEvent.keyDown(editor, getHotkeyEvent(hotKey));\n        await wait();\n        expect(content.querySelectorAll(selector).length).toBe(1);\n\n        fireEvent.keyDown(editor, getHotkeyEvent(PARAM_HOT_KEY));\n        await wait();\n        expect(content.querySelectorAll(selector).length).toBe(0);\n      });\n    });\n  });\n});\n"],"file":"ui.test.js"}