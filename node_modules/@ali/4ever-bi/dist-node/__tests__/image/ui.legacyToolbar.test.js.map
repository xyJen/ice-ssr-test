{"version":3,"sources":["../../../../src/__tests__/image/ui.legacyToolbar.test.tsx"],"names":["Object","defineProperty","imageConfig","get","imagePreviewMockFn","sleep","ms","Promise","resolve","setTimeout","IMAGE_URL","NESW","NWSE","NS","EW","_Image","global","Image","_URL","URL","value","Mo","jsonMLToValue","src","width","height","opacity","outline","type","color","complexValue","rectClip","left","right","top","bottom","fitRotateTest","before","after","resizeCursorTest","filterDataTest","radius","shadow","rotation","list","describe","afterAll","it","fn","jest","constructor","naturalWidth","naturalHeight","onload","url","editor","content","textToValue","toolButtons","name","fireEvent","paste","outerSrc","keyDown","querySelector","img","expect","toBe","getAttribute","innerSrc","toHaveBeenCalledTimes","container","findByTestId","queryByTestId","findAllByTestId","contextMenu","optionMenuItem","click","sidebar","toBeInstanceOf","Element","borderBtn","lineOptions","size6","styleDash","imageBorder","imageBorderStyle","getComputedStyle","borderStyle","borderWidth","toString","skip","find","prop","border","toEqual","stringContaining","forEach","JSON","stringify","transferableImages","document","transferableSrc","map","image","data","droppedFragment","images","filterDescendants","node","ImageMoPlugin","isImage","dropRes","expectRes","imageSelect","imagePreviewCalls","mock","calls","length","configValue","imgBorder","style","borderRadius","boxShadow","restoreBtn","imageSelectFrame","imageInlineToolbar","HTMLElement","findAllByRole","resizer","mouseDown","mouseMove","clientX","clientLeft","clientWidth","clientY","clientTop","clientHeight","mouseUp","rotators","trigger","alignmentOption","getByTestId","inlineToolbar","borderPicker","borderPanel","colorBox","borderColor","getAllByTestId","moreBtn","downloadMenuItem","imageDownloadMockFn","recommendStylesButton","style5","clearStyle","transformImageURL","revokeObjectURLFn","createObjectURL","file","revokeObjectURL","_src","imageBtn","HOTKEYS","deleteBackward","toBeCalledTimes"],"mappings":"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","sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\n/** @jsx jsx */\nimport * as React from 'react';\nimport { waitForElement, waitFor, wait, render } from '@testing-library/react';\nimport Mo from '../serializer';\nimport { ImageData, Image as ImageMoPlugin } from '@ali/4ever-mo';\nimport { ImagePlugin } from '@ali/4ever-bamboo';\nimport { Inline } from '@ali/4ever-cangjie';\nimport { EditorWidthLegacyToolbar as Editor, imageConfig, imagePreviewMockFn, imageDownloadMockFn } from '../editor';\nimport { renderEditor, fireEvent, jsx, getHotkeyEvent, HOTKEYS } from '@ali/4ever-dev-test';\nimport { getContent } from '../helper';\nimport fitRotate from '../../plugins/image/utils/fitRotate';\nimport filterImageData from '../../plugins/image/utils/filterImageData';\nimport { dropImages, filterTransferableImages } from '../../plugins/image/utils/filterImages';\nimport { getResizeCursor } from '../../plugins/image/utils';\nimport { innerSrc, outerSrc } from './utils';\n\nObject.defineProperty(imageConfig, 'previewImage', {\n  get() {\n    imagePreviewMockFn();\n    return imagePreviewMockFn;\n  },\n});\n\nexport function sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nconst IMAGE_URL = 'https://cn.bing.com/az/hprichbg/rb/TeslaCoil_EN-CN1604235004_1920x1080.jpg';\n\nconst NESW = 'nesw-resize';\nconst NWSE = 'nwse-resize';\nconst NS = 'ns-resize';\nconst EW = 'ew-resize';\n\nconst _Image = global.Image;\nconst _URL = global.URL;\n\nconst value = Mo.jsonMLToValue([\n  'root', {},\n  ['p',\n    ['img', {\n      src: IMAGE_URL,\n      width: 1920,\n      height: 1080,\n      opacity: 0.5,\n      outline: {\n        width: 1,\n        type: 'solid',\n        color: '#002060',\n      },\n      type: 'jpg',\n    }],\n  ],\n]);\n\nconst complexValue = Mo.jsonMLToValue([\n  'root', {},\n  ['p',\n    ['img', {\n      src: IMAGE_URL,\n      width: 1000,\n      height: 800,\n      opacity: 0.5,\n      outline: {\n        width: 6,\n        type: 'solid',\n        color: '#002060',\n      },\n      rectClip: {\n        left: 900,\n        right: 20,\n        top: 200,\n        bottom: 80,\n      },\n      type: 'jpg',\n    }],\n  ],\n]);\n\nconst fitRotateTest = [{\n  before: 89,\n  after: 90,\n}, {\n  before: 91,\n  after: 90,\n}, {\n  before: 60,\n  after: 60,\n}];\n\nconst resizeCursorTest = [{\n  before: -22.5,\n  after: NS,\n}, {\n  before: 22.5,\n  after: NESW,\n}, {\n  before: 77.5,\n  after: EW,\n}, {\n  before: 122.5,\n  after: NWSE,\n}];\n\nconst filterDataTest: Array<{ before: ImageData; after: ImageData; list: ImagePlugin.FilterDataItem[]; }> = [{\n  before: {\n    src: 'xxx',\n    width: 300,\n    height: 100,\n    rectClip: {\n      left: 20,\n      right: 30,\n      top: 40,\n    },\n    outline: {\n      width: 2,\n      type: 'solid',\n      color: 'red',\n    },\n    radius: 8,\n    shadow: 'xxx',\n    rotation: 30,\n  }, after: {\n    src: 'xxx',\n    width: 350,\n    height: 140,\n    radius: 8,\n  },\n  list: ['rectClip', 'rotation', 'outline', 'shadow'],\n}, {\n  before: {\n    src: 'xxx',\n    width: 300,\n    height: 100,\n    rectClip: {\n      left: 20,\n      right: 30,\n      top: 40,\n    },\n    outline: {\n      width: 2,\n      type: 'solid',\n      color: 'red',\n    },\n    shadow: 'xxx',\n  }, after: {\n    src: 'xxx',\n    width: 300,\n    height: 100,\n    rectClip: {\n      left: 20,\n      right: 30,\n      top: 40,\n    },\n  },\n  list: ['shadow', 'outline'],\n}];\n\ndescribe('Bi/image/ui', () => {\n  afterAll(() => {\n    global.Image = _Image;\n  });\n  it('转存图片', async () => {\n    const fn = jest.fn();\n    global.Image = class {\n      naturalWidth;\n      naturalHeight;\n      onload;\n      constructor(src?: string) {\n        if (src) {\n          this.src = src;\n        }\n      }\n      set src(url: string) {\n        this?.onload();\n        this.naturalWidth = 384;\n        this.naturalHeight = 108;\n        fn();\n      }\n    };\n    const { editor, content } = await renderEditor(\n      <Editor\n        defaultValue={Mo.textToValue('')}\n        singleLayout={[{ toolButtons: [{ name: 'image' }] }]}\n      />,\n    );\n    fireEvent.paste(editor, 'text/html', `\n      <div>\n        <img src=\"${outerSrc}\" />\n      </div>\n    `);\n\n    fireEvent.keyDown(editor, getHotkeyEvent('ctrl+v'));\n    await waitForElement(() => content.querySelector('img[data-type=image]'));\n    const img = content.querySelector('[data-type=image]')\n    expect(!!img).toBe(true);\n    expect(img.getAttribute('data-src')).toBe(innerSrc);\n    expect(fn).toHaveBeenCalledTimes(1);\n  });\n  it('更新图片宽高', async () => {\n    const fn = jest.fn();\n    global.Image = class {\n      naturalWidth;\n      naturalHeight;\n      onload;\n      constructor(src?: string) {\n        if (src) {\n          this.src = src;\n        }\n      }\n      set src(url: string) {\n        this?.onload();\n        this.naturalWidth = 384;\n        this.naturalHeight = 108;\n        fn();\n      }\n    };\n    const { editor, content, container } = await renderEditor(\n      <Editor\n        defaultValue={Mo.textToValue('')}\n        singleLayout={[{ toolButtons: [{ name: 'image' }] }]}\n      />,\n    );\n    fireEvent.paste(editor, 'text/html', `\n      <div>\n        <img src=\"${innerSrc}\" />\n      </div>\n    `);\n\n    fireEvent.keyDown(editor, getHotkeyEvent('ctrl+v'));\n    await sleep(100);\n    await waitForElement(() => content.querySelector('img[data-type=image]'));\n    const img = content.querySelector('[data-type=image]');\n    expect(!!img).toBe(true);\n    expect(img.getAttribute('data-src')).toBe(innerSrc);\n    expect(fn).toHaveBeenCalledTimes(1);\n  });\n\n  it('image 右侧面板中设置边框样式和大小后，边框面板不会消失', async () => {\n    const { content, findByTestId, queryByTestId, findAllByTestId } = await renderEditor(<Editor defaultValue={value} />);\n    const img = content.querySelector('[data-type=\"image\"]');\n    fireEvent.contextMenu(img);\n\n    await findByTestId('bi-contextmenu');\n\n    const optionMenuItem = await findByTestId('menu-item-image-options');\n\n    fireEvent.click(optionMenuItem);\n    const sidebar = await findByTestId('image-sidebar');\n\n    expect(sidebar).toBeInstanceOf(Element);\n\n    const borderBtn = await findByTestId('image-sidebar-border-button');\n    fireEvent.click(borderBtn);\n    await queryByTestId('Popup-image-sidebar-border-dropdown');\n    const lineOptions = await findAllByTestId('SelectWrap-CommonLineSelect');\n    fireEvent.click(lineOptions[0]);\n    const size6 = await findByTestId('option-6');\n    fireEvent.click(size6);\n    await wait();\n    fireEvent.click(lineOptions[1]);\n    const styleDash = await findByTestId('option-dashed');\n    fireEvent.click(styleDash);\n\n    const imageBorder = await findByTestId('editor-image-real-box');\n    const imageBorderStyle = getComputedStyle(imageBorder);\n    expect(imageBorderStyle.borderStyle).toBe('dashed');\n    expect(imageBorderStyle.borderWidth.toString()).toBe('6px');\n  });\n\n  it.skip('image 有渲染出透明度以及轮廓', async () => {\n    const { container } = render(<Editor defaultValue={value} />);\n    expect(getContent(container).find('MetaImgFrame').prop('style').opacity).toBe(0.5);\n    expect(getContent(container).find('MetaImgFrame').prop('style').border).toEqual(expect.stringContaining('solid'));\n  });\n  it('图片旋转在断点处自动吸附', () => {\n    fitRotateTest.forEach(({ before, after }) => {\n      expect(JSON.stringify(fitRotate(before))).toBe(JSON.stringify(after));\n    });\n  });\n  it('图片resize光标', () => {\n    resizeCursorTest.forEach(({ before, after }) => {\n      expect(getResizeCursor(0, before)).toBe(after);\n      expect(getResizeCursor(0, before - 180)).toBe(after);\n      expect(getResizeCursor(0, before + 180)).toBe(after);\n    });\n  });\n  it('粘贴时过滤图片数据', () => {\n    filterDataTest.forEach(({ before, after, list }) => {\n      expect(JSON.stringify(filterImageData(before, list))).toBe(JSON.stringify(after));\n    });\n  });\n  it('粘贴时获取需要转换的图片', () => {\n    const value = Mo.jsonMLToValue([\n      'root', {},\n      ['p',\n        ['img', {\n          src: 'aaa'\n        }],\n        ['img', {\n          src: 'bbb'\n        }],\n        ['img', {\n          src: 'ccc'\n        }],\n      ],\n    ]);\n    const transferableImages = filterTransferableImages(value.document, (url) => url === 'aaa');\n    const transferableSrc = transferableImages.map(image => image.data.src).toString();\n    expect(transferableSrc).toBe('aaa');\n    const droppedFragment = dropImages(value.document, (url) => url === 'aaa');\n    const images = droppedFragment.filterDescendants((node) => ImageMoPlugin.isImage(node));\n    const dropRes = images.map((image) => (image as Inline).data.src).toString();\n    const expectRes = 'bbb,ccc';\n    expect(dropRes).toBe(expectRes);\n  });\n  // TODO: FIXME @淼淼\n  // imagePreviewMockFn 读一次就会执行一次，之前由于每次点击后都会 re-render 一次，导致有个读操作，所以测试会过\n  it.skip('图片预览', async () => {\n    const { content, findByTestId } = await renderEditor(<Editor defaultValue={value} />);\n    let img = content.querySelector('[data-type=\"image\"]');\n    fireEvent.click(img);\n    // 单击图片后，图片被选中\n    const imageSelect = await findByTestId('image-select');\n\n    img = imageSelect.querySelector('img');\n    const imagePreviewCalls = imagePreviewMockFn.mock.calls.length;\n    fireEvent.click(img);\n    await waitFor(() => expect(imagePreviewMockFn.mock.calls.length).toBe(imagePreviewCalls + 1));\n  });\n\n  it('图片面板 - 还原', async () => {\n    const fn = jest.fn();\n    global.Image = class {\n      naturalWidth;\n      naturalHeight;\n      onload;\n      constructor(src?: string) {\n        if (src) {\n          this.src = src;\n        }\n      }\n      set src(url: string) {\n        this?.onload();\n        this.naturalWidth = 384;\n        this.naturalHeight = 108;\n        fn();\n      }\n    };\n    const configValue = Mo.jsonMLToValue([\n      'root', {},\n      ['p',\n        ['img', {\n          src: 'https://cn.bing.com/az/hprichbg/rb/TeslaCoil_EN-CN1604235004_1920x1080.jpg',\n          width: 192,\n          height: 108,\n          outline: {\n            width: 1,\n            type: 'solid',\n            color: '#002060',\n          },\n          shadow: '1px 1px 10px 0 rgba(0, 0, 0, 0.12)',\n          radius: 4,\n          type: 'jpg',\n        }],\n      ],\n    ]);\n    const { content, findByTestId } = await renderEditor(<Editor defaultValue={configValue} />);\n    const img = content.querySelector('[data-type=\"image\"]');\n    let imgBorder = await findByTestId('editor-image-real-box');\n\n    expect(imgBorder?.style?.border).toBe('1px solid #002060');\n    expect(imgBorder?.style?.borderRadius).toBe('4px');\n    expect(imgBorder?.style?.boxShadow === '1px 1px 10px 0 rgba(0, 0, 0, 0.12)' || imgBorder?.style?.boxShadow === 'rgba(0, 0, 0, 0.12) 1px 1px 10px 0').toBe(true);\n\n    fireEvent.contextMenu(img);\n\n    await findByTestId('bi-contextmenu');\n\n    const optionMenuItem = await findByTestId('menu-item-image-options');\n\n    fireEvent.click(optionMenuItem);\n    const sidebar = await findByTestId('image-sidebar');\n\n    expect(sidebar).toBeInstanceOf(Element);\n\n    const restoreBtn = await findByTestId('image-sidebar-restore');\n    fireEvent.click(restoreBtn);\n\n    imgBorder = await findByTestId('editor-image-real-box');\n\n    expect(imgBorder?.style?.border).toBe('');\n    expect(imgBorder?.style?.borderRadius).toBe('0');\n    expect(imgBorder?.style?.boxShadow).toBe('');\n\n    // TODO: 补充推荐样式和对齐方式的 test\n  });\n\n  it('图片编辑框&工具栏 - 选中后出现', async () => {\n    const { container, findByTestId } = await renderEditor(<Editor defaultValue={complexValue} />);\n    const img = container.querySelector('[data-type=\"image\"]');\n    fireEvent.click(img);\n    const imageSelectFrame = await findByTestId('image-select-frame');\n    const imageInlineToolbar = await findByTestId('inline-toolbar-image');\n    expect(imageSelectFrame).toBeInstanceOf(HTMLElement);\n    expect(imageInlineToolbar).toBeInstanceOf(HTMLElement);\n  });\n\n  it.skip('图片编辑框-缩放后跟随', async () => {\n    const { container, findByTestId, findAllByRole } = await renderEditor(<Editor defaultValue={complexValue} />);\n    const img = container.querySelector('[data-type=\"image\"]');\n    fireEvent.click(img);\n    // 缩放\n    const resizer = await findAllByRole('resizer');\n    fireEvent.mouseDown(resizer[1]);\n    fireEvent.mouseMove(resizer[1], {\n      clientX: resizer[1].clientLeft - img.clientWidth / 2,\n      clientY: resizer[1].clientTop - img.clientHeight / 2,\n    });\n    fireEvent.mouseUp(resizer[1]);\n    const imageSelectFrame = await findByTestId('image-select-frame');\n    expect(imageSelectFrame).toBeInstanceOf(HTMLElement);\n  });\n\n  it.skip('图片编辑框&工具栏 - 旋转后跟随', async () => {\n    const { container, findByTestId, findAllByRole } = await renderEditor(<Editor defaultValue={value} />);\n    const img = container.querySelector('[data-type=\"image\"]');\n    fireEvent.click(img);\n\n    // 旋转\n    const rotators = await findAllByRole('rotator');\n    fireEvent.mouseDown(rotators[1]);\n    fireEvent.mouseMove(rotators[1], {\n      clientX: rotators[1].clientLeft - img.clientWidth / 2,\n      clientY: rotators[1].clientTop + img.clientHeight / 2,\n    });\n    fireEvent.mouseUp(rotators[1]);\n    const imageSelectFrame = await findByTestId('image-select-frame');\n    expect(imageSelectFrame).toBeInstanceOf(HTMLElement);\n  });\n\n  it('图片编辑框&工具栏 - 调整对齐方式后跟随', async () => {\n    const value = Mo.jsonMLToValue([\n      'root', {},\n      ['p',\n        ['img', {\n          src: 'https://cn.bing.com/az/hprichbg/rb/TeslaCoil_EN-CN1604235004_1920x1080.jpg',\n          width: 192,\n          height: 108,\n          opacity: 0.5,\n          outline: {\n            width: 1,\n            type: 'solid',\n            color: '#002060',\n          },\n          type: 'jpg',\n        }],\n      ],\n    ]);\n    const { container, findByTestId } = await renderEditor(<Editor defaultValue={value} singleLayout={[{ toolButtons: [{ name: 'alignment' }] }]} />);\n    const img = container.querySelector('[data-type=\"image\"]');\n    fireEvent.click(img);\n    // 打开 alignment 工具栏\n    const trigger = await findByTestId('SelectWrap-bi-toolbar-align');\n    fireEvent.click(trigger!);\n\n    // 点击对齐方式\n    const alignmentOption = await findByTestId('option-right');\n    fireEvent.click(alignmentOption);\n    const imageSelectFrame = await findByTestId('image-select-frame');\n    expect(imageSelectFrame).toBeInstanceOf(HTMLElement);\n  });\n\n  it('设置图片边框颜色', async () => {\n    const { container, queryByTestId, findByTestId, getByTestId } = await renderEditor(<Editor defaultValue={value} />);\n    const img = container.querySelector('[data-type=\"image\"]');\n    fireEvent.click(img);\n    const inlineToolbar = await findByTestId('inline-toolbar-image');\n    const borderPicker = inlineToolbar.querySelector('[data-testid=\"splitbutton-arrow-BorderPicker\"]');\n    fireEvent.click(borderPicker);\n\n    const borderPanel = await findByTestId('splite-overlay-BorderPicker');\n\n    const colorBox = borderPanel.querySelector('[color=\"#C10002\"]');\n    fireEvent.click(colorBox);\n\n    await waitFor(() => {\n      const imgBorder = getByTestId('editor-image-real-box');\n      expect(imgBorder.style.borderColor).toBe('#c10002');\n    });\n  });\n\n  it('行内工具栏 - 更多菜单 - 下载', async () => {\n    const { container, findByTestId, getAllByTestId, queryByTestId } = await renderEditor(<Editor defaultValue={value} />);\n    const img = container.querySelector('[data-type=\"image\"]');\n    fireEvent.click(img);\n    await findByTestId('inline-toolbar-image');\n    const moreBtn = getAllByTestId('image-inline-more-dropdown');\n    expect(moreBtn.length).toBe(1);\n    fireEvent.click(moreBtn[0]);\n    const downloadMenuItem = await findByTestId('menu-item-image-menu-download');\n    fireEvent.click(downloadMenuItem);\n    expect(imageDownloadMockFn).toHaveBeenCalledTimes(1);\n  });\n  it('行内工具栏 - 更多菜单 - 推荐样式', async () => {\n    const { container, findByTestId, queryByTestId, getByTestId } = await renderEditor(<Editor defaultValue={value} />);\n    const img = container.querySelector('[data-type=\"image\"]');\n    fireEvent.click(img);\n    await findByTestId('inline-toolbar-image');\n    let recommendStylesButton = queryByTestId('image-toolbar-recommend-styles');\n    fireEvent.click(recommendStylesButton);\n    await findByTestId('Popup-image-toolbar-recommend-styles');\n    const style5 = queryByTestId('image-recommend-style-5');\n    const imgBorder = getByTestId('editor-image-real-box');\n    fireEvent.click(style5);\n    await waitFor(() => {\n      expect(imgBorder.style.borderRadius).toBe('0');\n    });\n    await waitFor(() => {\n      expect(imgBorder.style.border).toBe('4px solid #ffffff');\n    });\n    await waitFor(() => {\n      expect(imgBorder.style.boxShadow).toBe('0px 0px 1px rgba(0, 0, 0, 0.24), 0px 2px 10px rgba(0, 0, 0, 0.24)');\n    });\n    fireEvent.click(img);\n    recommendStylesButton = queryByTestId('image-toolbar-recommend-styles');\n    fireEvent.click(recommendStylesButton);\n    const clearStyle = await findByTestId('image-toolbar-clear-style');\n    fireEvent.click(clearStyle);\n    await waitFor(() => {\n      expect(imgBorder.style.borderRadius).toBe('0');\n    });\n    await waitFor(() => {\n      expect(imgBorder.style.border).toBe('');\n    });\n    await waitFor(() => {\n      expect(imgBorder.style.boxShadow).toBe('');\n    });\n  });\n  it('图片异步转换', async () => {\n    const { container, findByTestId } = await renderEditor(\n      <Editor\n        defaultValue={value}\n        imageCustomConfig={{\n          transformImageURL: (url) => {\n            return new Promise((resolve) => {\n              resolve(`${url}?t=1`);\n            });\n          },\n        }}\n      />,\n    );\n    const img = await findByTestId('cangjie-image');\n    await waitFor(() => {\n      expect(img.getAttribute('src')).toBe(`${IMAGE_URL}?t=1`);\n    });\n  });\n  it('图片同步转换', async () => {\n    const fn = jest.fn();\n    const { findByTestId } = await renderEditor(\n      <Editor\n        defaultValue={value}\n        imageCustomConfig={{\n          transformImageURL: (url) => `${url}?t=1`,\n        }}\n      />,\n    );\n    const img = await findByTestId('cangjie-image');\n    await waitFor(() => {\n      expect(img.getAttribute('src')).toBe(`${IMAGE_URL}?t=1`);\n    });\n  });\n  it('上传后清理 object url', async () => {\n    const revokeObjectURLFn = jest.fn();\n    global.URL = class {\n      static createObjectURL(file: File) {\n        return `blob:/${file.name}`;\n      }\n      static revokeObjectURL = revokeObjectURLFn;\n    };\n    global.Image = class {\n      onload;\n      private _src;\n      set src(url: string) {\n        this._src = url;\n        this.onload && this.onload();\n      }\n      get src() {\n        return this._src;\n      }\n    };\n    const { editor, container } = await renderEditor(\n      <Editor\n        defaultValue={Mo.textToValue('')}\n        singleLayout={[{ toolButtons: [{ name: 'image' }] }]}\n      />,\n    );\n    const imageBtn = container.querySelector('[data-testid=\"bi-toolbar-picture\"]');\n    fireEvent.click(imageBtn);\n    await sleep(100);\n    fireEvent.keyDown(editor, getHotkeyEvent(HOTKEYS.deleteBackward));\n    fireEvent.keyDown(editor, getHotkeyEvent(HOTKEYS.deleteBackward));\n    await sleep(0);\n    expect(revokeObjectURLFn).toBeCalledTimes(1);\n    global.Image = _Image;\n    global.URL = _URL;\n  });\n});\n"],"file":"ui.legacyToolbar.test.js"}