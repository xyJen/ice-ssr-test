{"version":3,"sources":["../../../../src/__tests__/marks/ui.test.tsx"],"names":["createBiPlugins","bold","marks","mark","italic","strike","vertAlign","underline","inlineCode","Editor","props","defaultValue","text","value","setValue","React","useState","handleChange","useCallback","changed","plugins","locale","items","name","HeaderToolbarMode","single","hotKey","rules","triggerText","intraword","insideWhitespace","style","tagName","skipButtonTest","forEach","origin_value","beforeAll","process","env","RUNTIME_ENV","ToolbarLayout","UITEST_FLAG","afterAll","describe","test","content","editor","fireEvent","keyDown","mark1","querySelector","expect","textContent","toBe","expectStyle","queryMark","container","toolbarName","toolBtn","document","click","markEle","testTriggerText","testOverrideMarks","node","toEqual","trailingSpace","cangjieInput","data","markTrigger","trim","nextElementSibling","innerHTML","srcMark","targetMark","srcStyle","targetStyle","markOverride"],"mappings":"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","sourcesContent":["/** @jsx jsx */\nimport * as React from 'react';\nimport '@testing-library/jest-dom/extend-expect';\nimport {\n  waitForElement,\n  waitForElementToBeRemoved,\n} from '@testing-library/react';\nimport { ToolbarLayout } from '@ali/we-design-next';\nimport { Value } from '@ali/4ever-cangjie';\nimport {\n  renderEditor,\n  getHotkeyEvent,\n  fireEvent,\n  jsx,\n  waitForTime,\n} from '@ali/4ever-dev-test';\nimport { locale_zh_CN as locale } from '@ali/4ever-bi'\n\nimport { createCustomizedBiPlugins, HeadingToolbar, HeaderToolbarMode } from '../..';\n\nimport Provider from '../../provider';\nimport Content from '../../content';\nimport bold from '../../plugins/bold';\nimport marks from '../../plugins/marks';\nimport italic from '../../plugins/italic';\nimport strike from '../../plugins/strike';\nimport vertAlign from '../../plugins/vertAlign';\nimport underline from '../../plugins/underline';\nimport inlineCode from '../../plugins/inlineCode';\nimport { MarksPlugin as mark } from '@ali/4ever-bamboo';\n\ninterface EditorProps {\n  defaultValue?: Value;\n  text?: string;\n}\n\nconst createBiPlugins = createCustomizedBiPlugins({\n  bold,\n  marks,\n  mark,\n  italic,\n  strike,\n  vertAlign,\n  underline,\n  inlineCode,\n});\n\nconst Editor: React.FC<EditorProps> = (props) => {\n  const defaultValue = (\n    <value>\n      <document>\n        <block type=\"paragraph\">\n          <anchor />\n          {props.text || 'Hello'}\n          <focus />\n        </block>\n      </document>\n    </value>\n  ) as any;\n  const [value, setValue] = React.useState(props.defaultValue || defaultValue);\n  const handleChange = React.useCallback((changed) => {\n    setValue(changed.value);\n  }, []);\n  const plugins = createBiPlugins({...locale});\n\n  return (\n    <Provider value={value} plugins={plugins} onChange={handleChange}>\n      <HeadingToolbar\n        singleLayout={[{ items: [\n          { name: 'underline' },\n          { name: 'bold' },\n          { name: 'strike' },\n          { name: 'italic' },\n          { name: 'vertAlign.supMark' },\n          { name: 'vertAlign.subMark' },\n        ] }]}\n        mode={HeaderToolbarMode.single}\n      />\n      <Content />\n    </Provider>\n  );\n};\n\n[{\n  name: 'bold',\n  hotKey: 'ctrl+b',\n  rules: [{\n    triggerText: '**',\n    intraword: true,\n    insideWhitespace: false,\n  }, {\n    triggerText: '__',\n    intraword: false,\n    insideWhitespace: false,\n  }],\n  style: ['fontWeight', 'bold'],\n}, {\n  name: 'italic',\n  hotKey: 'ctrl+i',\n  rules: [{\n    triggerText: '*',\n    intraword: true,\n    insideWhitespace: false,\n  }, {\n    triggerText: '_',\n    intraword: false,\n    insideWhitespace: false,\n  }],\n  style: ['fontStyle', 'italic'],\n}, {\n  name: 'strike',\n  hotKey: 'shift+ctrl+x',\n  rules: [{\n    triggerText: '~~',\n    intraword: true,\n    insideWhitespace: false,\n  }],\n  style: ['textDecorationLine', 'line-through'],\n}, {\n  name: 'sub',\n  hotKey: 'ctrl+,',\n  rules: [{\n    triggerText: '~',\n    intraword: true,\n    insideWhitespace: false,\n  }],\n  style: ['verticalAlign', 'sub'],\n}, {\n  name: 'super',\n  hotKey: 'ctrl+.',\n  rules: [{\n    triggerText: '^',\n    intraword: true,\n    insideWhitespace: false,\n  }],\n  style: ['verticalAlign', 'super'],\n}, {\n  name: 'underline',\n  hotKey: 'ctrl+u',\n  rules: [{\n    triggerText: '++',\n    intraword: true,\n    insideWhitespace: false,\n  }],\n  style: ['textDecorationLine', 'underline'],\n}, {\n  name: 'inlineCode',\n  hotKey: 'ctrl+e',\n  rules: [{\n    triggerText: '`',\n    intraword: true,\n    insideWhitespace: true,\n  }],\n  style: ['backgroundColor', 'rgb(247, 247, 247)'],\n  tagName: 'CODE',\n  skipButtonTest: true,\n}].forEach(({\n  name,\n  hotKey,\n  rules,\n  style,\n  tagName,\n  skipButtonTest,\n}) => {\n  let origin_value\n  beforeAll(() => {\n    origin_value = process.env.RUNTIME_ENV;\n    process.env.RUNTIME_ENV = ToolbarLayout.UITEST_FLAG\n  })\n\n  afterAll(() => {\n    process.env.RUNTIME_ENV = origin_value;\n  })\n  describe(`Bi/${name}/ui`, () => {\n    if (hotKey) {\n      test('使用快捷键切换选择区域的样式', async () => {\n        const { content, editor } = await renderEditor(\n          <Editor />,\n        );\n\n        fireEvent.keyDown(editor, getHotkeyEvent(hotKey));\n        let mark1 = await waitForElement(() => content?.querySelector('[data-cangjie-mark]'));\n        expect(mark1?.textContent).toBe('Hello');\n        expectStyle(mark1, style);\n\n        // 撤销\n        fireEvent.keyDown(editor, getHotkeyEvent(hotKey));\n        mark1 = await waitForElementToBeRemoved(() => content?.querySelector('[data-cangjie-mark]'));\n        expect(queryMark(editor)).toBe(null);\n      });\n    }\n\n    if (!skipButtonTest) {\n      test(`点击按钮切换选择区域的样式 ${name}`, async () => {\n        const { editor, container } = await renderEditor(\n          <Editor />,\n        );\n\n        let toolbarName = `[data-testid=\"bi-toolbar-${name}\"]`;\n\n        if (name === 'sub') {\n          // 先点击下拉再选择下标\n          toolbarName = '[data-testid=\"bi-toolbar-sub\"]';\n        } else if (name === 'super') {\n          // 直接点击可选择上标\n          toolbarName = '[data-testid=\"bi-toolbar-sup\"]';\n        }\n\n        let toolBtn = document.querySelector(toolbarName);\n        fireEvent.click(toolBtn);\n\n        const markEle = await waitForElement(() => container?.querySelector('[data-cangjie-mark]'));\n        expect(markEle?.textContent).toBe('Hello');\n        expectStyle(markEle, style);\n\n        if (name === 'sub') {\n          // 再次点击取消下标\n          toolbarName = '[data-testid=\"bi-toolbar-sub\"]';\n        }\n\n        toolBtn = document.querySelector(toolbarName);\n        // 撤销\n        fireEvent.click(toolBtn);\n\n        await waitForTime(100);\n        expect(queryMark(editor)).toBe(null);\n      });\n    }\n\n    if (rules) {\n      rules.forEach(({ triggerText, insideWhitespace, intraword }) => {\n        test('在段首时，Markdown 快捷输入样式', async () => {\n          await testTriggerText(`${triggerText}Hello${triggerText}`, style, false, tagName);\n        });\n\n        test('在段中时，前面为空格，Markdown 快捷输入样式', async () => {\n          await testTriggerText(`Markdown ${triggerText}Hello${triggerText}`, style, true, tagName);\n        });\n\n        test('在段中时，前面为标点符号，Markdown 快捷输入样式', async () => {\n          await testTriggerText(`Markdown,${triggerText}Hello${triggerText}`, style, false, tagName);\n        });\n\n        if (intraword) {\n          test('intraword 时，Markdown 快捷输入样式', async () => {\n            await testTriggerText(`Markdown${triggerText}Hello${triggerText}`, style, false, tagName);\n          });\n        }\n        if (insideWhitespace) {\n          test('允许内侧空白符时，Markdown 快捷输入样式', async () => {\n            await testTriggerText(`Markdown ${triggerText} Hello${triggerText}`, style, true, tagName);\n          });\n        }\n      });\n    }\n\n    if (name === 'sub') {\n      test('设置 sub 样式可以覆盖已有的 super 样式', async () => {\n        await testOverrideMarks('super', name, ['verticalAlign', 'super'], style);\n      });\n    }\n\n    if (name === 'super') {\n      test('设置 super 样式可以覆盖已有的 sub 样式', async () => {\n        await testOverrideMarks('sub', name, ['verticalAlign', 'sub'], style);\n      });\n    }\n  });\n});\n\nfunction queryMark(container) {\n  return container.querySelector('[data-cangjie-mark]');\n}\n\nfunction expectStyle(node, style) {\n  expect(node.style[style[0]]).toEqual(style[1]);\n}\n\nasync function testTriggerText(text, style, trailingSpace: boolean, tagName?: string) {\n  const defaultValue = (\n    <value>\n      <document>\n        <block type=\"paragraph\">\n          {text}\n          <cursor />\n        </block>\n      </document>\n    </value>\n  ) as any;\n\n  const { content, editor } = await renderEditor(\n    <Editor defaultValue={defaultValue} />,\n  );\n\n  expect(queryMark(editor)).toBe(null);\n\n  fireEvent.cangjieInput(editor, { data: ' ' });\n  const markTrigger = await waitForElement(() => content?.querySelector('[data-cangjie-mark]'));\n  expect(markTrigger?.textContent.trim()).toBe('Hello');\n  expectStyle(markTrigger, style);\n  if (trailingSpace) {\n    expect(markTrigger.nextElementSibling.innerHTML).toBe(' ');\n  }\n  if (tagName) {\n    expect(markTrigger.tagName).toBe(tagName);\n  }\n}\n\nasync function testOverrideMarks(srcMark, targetMark, srcStyle, targetStyle) {\n  const defaultValue = (\n    <value>\n      <document>\n        <block type=\"paragraph\">\n          <anchor />\n          Hello\n          <focus />\n        </block>\n      </document>\n    </value>\n  ) as any;\n\n  const { content } = await renderEditor(\n    <Editor defaultValue={defaultValue} />,\n  );\n\n  let toolbarName;\n  if (srcMark === 'sub') {\n    toolbarName = '[data-testid=\"bi-toolbar-sub\"]';\n  } else if (srcMark === 'super') {\n    toolbarName = '[data-testid=\"bi-toolbar-sup\"]';\n  }\n  let toolBtn = document.querySelector(toolbarName);\n\n  // 先变成 srcMark 样式\n  fireEvent.click(toolBtn);\n\n  let markOverride = await waitForElement(() => content?.querySelector('[data-cangjie-mark]'));\n  expect(markOverride?.textContent).toBe('Hello');\n  expectStyle(markOverride, srcStyle);\n\n  if (targetMark === 'sub') {\n    toolbarName = '[data-testid=\"bi-toolbar-sub\"]';\n  } else if (targetMark === 'super') {\n    toolbarName = '[data-testid=\"bi-toolbar-sup\"]';\n  }\n  toolBtn = document.querySelector(toolbarName);\n  fireEvent.click(toolBtn);\n\n  markOverride = await waitForElement(() => content?.querySelector('[data-cangjie-mark]'));\n  expect(markOverride?.textContent).toBe('Hello');\n  expectStyle(markOverride, targetStyle);\n}\n"],"file":"ui.test.js"}