{"version":3,"sources":["../../../../src/__tests__/draggable/thumbnails.ui.test.tsx"],"names":["getDragThumbnails","oldUtils","App","props","val","controllerRef","value","setValue","React","useState","createBiPlugins","draggable","hr","table","leftToolbar","handleChange","change","enabled","menu","key","renderApp","controller","c","results","container","document","body","findByTestId","paragraphs","querySelectorAll","fireEvent","mouseMove","dragHander","mouseEnter","describe","afterEach","jest","clearAllMocks","test","expect","DRAG_HIGHLIGHT_CLASSNAME","length","toBe","thumbnail","viewKey","getAttribute","colsWidth","DRAG_HIGHLIGHT_TABLE_CLASSNAME","complexElements","firstElementChild","childElementCount","querySelector","mouseLeave"],"mappings":";;;;;;AACA;;AACA;;AACA;;AAMA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAlBA;AAoBA,MAAMA,iBAAiB,GAAGC,8BAASD,iBAAnC;;WA0CM,sBAAC,gBAAD,O;;AAnCN,MAAME,GAAuB,GAAIC,KAAD,IAAW;AACzC,QAAM;AAAEC,IAAAA,GAAF;AAAOC,IAAAA;AAAP,MAAyBF,KAA/B;AACA,QAAM,CAACG,KAAD,EAAQC,QAAR,IAAoBC,KAAK,CAACC,QAAN,CAAeL,GAAf,CAA1B;AACA,QAAMM,eAAe,GAAG,wCAA0B;AAChDC,IAAAA,SAAS,EAATA,kBADgD;AAEhDC,IAAAA,EAAE,EAAFA,WAFgD;AAGhDC,IAAAA,KAAK,EAALA,0BAHgD;AAIhDC,IAAAA,WAAW,EAAXA;AAJgD,GAA1B,CAAxB;;AAOA,QAAMC,YAAY,GAAIC,MAAD,IAAoB;AACvC,qBAAI,MAAM;AACRT,MAAAA,QAAQ,CAACS,MAAM,CAACV,KAAR,CAAR;AACD,KAFD;AAGD,GAJD;;AAMA,SACE,sBAAC,iBAAD;AACE,IAAA,KAAK,EAAEA,KADT;AAEE,IAAA,OAAO,EAAEI,eAAe,CAAC;AACvBC,MAAAA,SAAS,EAAE;AACTM,QAAAA,OAAO,EAAE;AADA,OADY;AAIvBH,MAAAA,WAAW,EAAE;AACXI,QAAAA,IAAI,EAAE,CACJ;AACEC,UAAAA,GAAG,EAAE;AADP,SADI;AADK;AAJU,KAAD,CAF1B;AAcE,IAAA,aAAa,EAAEd,aAdjB;AAeE,IAAA,QAAQ,EAAEU,YAfZ;AAgBE,IAAA,SAAS;AAhBX,UADF;AAsBD,CAtCD;;AAwCA,eAAeK,SAAf,CAAyBhB,GAAzB,EAAsC;AACpC,MAAIiB,UAAJ;;AACA,QAAMhB,aAAa,GAAIiB,CAAD,IAAO;AAC3BD,IAAAA,UAAU,GAAGC,CAAb;AACD,GAFD;;AAGA,QAAMC,OAAO,GAAG,MAAM,+BAAa,sBAAC,GAAD;AAAK,IAAA,GAAG,EAAEnB,GAAV;AAAe,IAAA,aAAa,EAAEC;AAA9B,IAAb,EAA8D;AAClFmB,IAAAA,SAAS,EAAEC,QAAQ,CAACC;AAD8D,GAA9D,CAAtB;AAGA,QAAM;AAAEF,IAAAA,SAAF;AAAaG,IAAAA;AAAb,MAA8BJ,OAApC;AACA,QAAMK,UAAU,GAAGJ,SAAS,CAACK,gBAAV,CAA2B,wBAA3B,CAAnB;;AACAC,yBAAUC,SAAV,CAAoBH,UAAU,CAAC,CAAD,CAA9B;;AACA,QAAMI,UAAU,GAAG,MAAM,qBAAQ,MAAML,YAAY,CAAC,aAAD,CAA1B,CAAzB;;AACAG,yBAAUG,UAAV,CAAqBD,UAArB;;AACA,SAAO,EAAE,GAAGT,OAAL;AAAcK,IAAAA,UAAd;AAA0BP,IAAAA,UAA1B;AAAsCW,IAAAA;AAAtC,GAAP;AACD;;YAUK,qCACE,wCACE;AAAO,EAAA,IAAI,EAAC,WAAZ;AAAwB,EAAA,GAAG,EAAC;AAA5B,QACG,qCADH,CADF,CADF,C;;YAwBM;AAAO,EAAA,IAAI,EAAC;AAAZ,GACE;AAAO,EAAA,IAAI,EAAC;AAAZ,GACE;AAAO,EAAA,IAAI,EAAC;AAAZ,GACE,qCADF,MADF,CADF,C;;YA8BN,qCACE,wCACE;AAAO,EAAA,IAAI,EAAC,WAAZ;AAAwB,EAAA,GAAG,EAAC;AAA5B,GACE,qCADF,MADF,EAIE;AAAO,EAAA,IAAI,EAAC,WAAZ;AAAwB,EAAA,GAAG,EAAC;AAA5B,QACG,oCADH,CAJF,CADF,C;;AA9DNE,QAAQ,CAAC,yBAAD,EAA4B,MAAM;AACxCC,EAAAA,SAAS,CAAC,MAAM;AACd;AACAC,IAAAA,IAAI,CAACC,aAAL;AACD,GAHQ,CAAT;AAKAC,EAAAA,IAAI,CAAC,4BAAD,EAA+B,YAAY;AAC7C,UAAMhC,KAAK,QAAX;AASA,UAAM;AAAEkB,MAAAA,SAAF;AAAaH,MAAAA;AAAb,QAA4B,MAAMD,SAAS,CAACd,KAAD,CAAjD;AACA,UAAM,qBAAQ,MAAM;AAClBiC,MAAAA,MAAM,CAACf,SAAS,CAACK,gBAAV,CAA4B,IAAGW,6CAAyB,EAAxD,EAA2DC,MAA5D,CAAN,CAA0EC,IAA1E,CAA+E,CAA/E;AACD,KAFK,CAAN;AAGA,UAAMC,SAAS,GAAG3C,iBAAiB,CAACqB,UAAD,EAAa;AAC9CuB,MAAAA,OAAO,EAAE;AADqC,KAAb,CAAnC;AAIAL,IAAAA,MAAM,CAACI,SAAS,CAACE,YAAV,CAAuB,kBAAvB,CAAD,CAAN,CAAmDH,IAAnD,CAAwD,GAAxD;AACD,GAnBG,CAAJ;AAqBAJ,EAAAA,IAAI,CAAC,yBAAD,EAA4B,YAAY;AAC1C,UAAMhC,KAAK,GACT,qCACE,wCACE;AAAO,MAAA,IAAI,EAAC,OAAZ;AAAoB,MAAA,GAAG,EAAC,GAAxB;AAA4B,MAAA,IAAI,EAAE;AAAEwC,QAAAA,SAAS,EAAE,CAAC,GAAD;AAAb;AAAlC,aADF,CADF,CADF;AAeA,UAAM;AAAEtB,MAAAA,SAAF;AAAaH,MAAAA;AAAb,QAA4B,MAAMD,SAAS,CAACd,KAAD,CAAjD;AACA,UAAM,qBAAQ,MAAM;AAClBiC,MAAAA,MAAM,CAACf,SAAS,CAACK,gBAAV,CAA4B,IAAGkB,mDAA+B,EAA9D,EAAiEN,MAAlE,CAAN,CAAgFC,IAAhF,CAAqF,CAArF;AACAH,MAAAA,MAAM,CAACf,SAAS,CAACK,gBAAV,CAA4B,IAAGW,6CAAyB,EAAxD,EAA2DC,MAA5D,CAAN,CAA0EC,IAA1E,CAA+E,CAA/E;AACD,KAHK,CAAN;AAIA,UAAMC,SAAS,GAAG3C,iBAAiB,CAACqB,UAAD,EAAa;AAC9CuB,MAAAA,OAAO,EAAE;AADqC,KAAb,EAEhC;AACDI,MAAAA,eAAe,EAAE;AACfnC,QAAAA,KAAK,EAAE;AADQ;AADhB,KAFgC,CAAnC;AAQA0B,IAAAA,MAAM,CAACI,SAAS,CAACM,iBAAV,CAA4BC,iBAA7B,CAAN,CAAsDR,IAAtD,CAA2D,CAA3D;AACAH,IAAAA,MAAM,CAAC,CAAC,CAACI,SAAS,CAACQ,aAAV,CAAwB,wBAAxB,CAAH,CAAN,CAA4DT,IAA5D,CAAiE,KAAjE;AACD,GA/BG,CAAJ;AAiCAJ,EAAAA,IAAI,CAAC,4BAAD,EAA+B,YAAY;AAC7C,UAAMhC,KAAK,QAAX;AAYA,UAAM;AAAEkB,MAAAA,SAAF;AAAaH,MAAAA,UAAb;AAAyBW,MAAAA,UAAzB;AAAqCJ,MAAAA,UAArC;AAAiDD,MAAAA;AAAjD,QAAkE,MAAMP,SAAS,CAACd,KAAD,CAAvF;AACA,UAAM,qBAAQ,MAAM;AAClBiC,MAAAA,MAAM,CAACf,SAAS,CAACK,gBAAV,CAA4B,IAAGW,6CAAyB,EAAxD,EAA2DC,MAA5D,CAAN,CAA0EC,IAA1E,CAA+E,CAA/E;AACD,KAFK,CAAN;AAGA,UAAMC,SAAS,GAAG3C,iBAAiB,CAACqB,UAAD,EAAa;AAC9CuB,MAAAA,OAAO,EAAE;AADqC,KAAb,CAAnC;AAGAL,IAAAA,MAAM,CAACI,SAAS,CAACM,iBAAV,CAA4BC,iBAA7B,CAAN,CAAsDR,IAAtD,CAA2D,CAA3D;AACAH,IAAAA,MAAM,CAAC,CAAC,CAACI,SAAS,CAACQ,aAAV,CAAwB,wBAAxB,CAAH,CAAN,CAA4DT,IAA5D,CAAiE,IAAjE;AACAH,IAAAA,MAAM,CAAC,CAAC,CAACI,SAAS,CAACQ,aAAV,CAAwB,wBAAxB,CAAH,CAAN,CAA4DT,IAA5D,CAAiE,IAAjE;;AACAZ,2BAAUsB,UAAV,CAAqBpB,UAArB;;AACA,UAAM,qBAAQ,MAAM;AAClBO,MAAAA,MAAM,CAACf,SAAS,CAACK,gBAAV,CAA4B,IAAGW,6CAAyB,EAAxD,EAA2DC,MAA5D,CAAN,CAA0EC,IAA1E,CAA+E,CAA/E;AACD,KAFK,CAAN;;AAGAZ,2BAAUsB,UAAV,CAAqBxB,UAAU,CAAC,CAAD,CAA/B;;AACA,UAAM,qBAAQ,MAAM,CAACD,YAAY,CAAC,aAAD,CAA3B,CAAN;AACD,GA7BG,CAAJ;AA8BD,CA1FO,CAAR","sourcesContent":["/** @jsx jsx */\nimport * as React from 'react';\nimport { fireEvent, jsx, renderEditor } from '@ali/4ever-dev-test';\nimport { cleanup, waitFor, act } from '@testing-library/react';\nimport {\n  Value,\n  Change,\n  Controller,\n} from '@ali/4ever-cangjie';\nimport '@testing-library/jest-dom/extend-expect';\n\nimport Provider from '../../provider';\nimport Content from '../../content';\nimport { biFactory as table } from '@ali/4ever-plugin-table';\nimport hr from '../../plugins/hr';\nimport draggable from '../../plugins/draggable';\nimport leftToolbar from '../../plugins/leftToolbar';\nimport { DRAG_HIGHLIGHT_CLASSNAME, DRAG_HIGHLIGHT_TABLE_CLASSNAME, oldUtils } from '@ali/4ever-plugin-draggable';\nimport createCustomizedBiPlugins from '../../createCustomizedBiPlugins';\n\nconst getDragThumbnails = oldUtils.getDragThumbnails;\n\ninterface AppProps {\n  val?: Value;\n  controllerRef?: (controller: Controller) => void;\n}\n\nconst App: React.FC<AppProps> = (props) => {\n  const { val, controllerRef } = props;\n  const [value, setValue] = React.useState(val);\n  const createBiPlugins = createCustomizedBiPlugins({\n    draggable,\n    hr,\n    table,\n    leftToolbar,\n  });\n\n  const handleChange = (change: Change) => {\n    act(() => {\n      setValue(change.value);\n    });\n  };\n\n  return (\n    <Provider\n      value={value}\n      plugins={createBiPlugins({\n        draggable: {\n          enabled: true,\n        },\n        leftToolbar: {\n          menu: [\n            {\n              key: 'draggable',\n            },\n          ],\n        },\n      })}\n      controllerRef={controllerRef}\n      onChange={handleChange}\n      autoFocus\n    >\n      <Content />\n    </Provider>\n  );\n};\n\nasync function renderApp(val?: Value) {\n  let controller: Controller | undefined;\n  const controllerRef = (c) => {\n    controller = c;\n  };\n  const results = await renderEditor(<App val={val} controllerRef={controllerRef} />, {\n    container: document.body,\n  });\n  const { container, findByTestId } = results;\n  const paragraphs = container.querySelectorAll('[data-cangjie-key=\"a\"]');\n  fireEvent.mouseMove(paragraphs[0]);\n  const dragHander = await waitFor(() => findByTestId('drag-hander'));\n  fireEvent.mouseEnter(dragHander);\n  return { ...results, paragraphs, controller, dragHander };\n}\n\ndescribe('Bi/draggable/thumbnails', () => {\n  afterEach(() => {\n    cleanup();\n    jest.clearAllMocks();\n  });\n\n  test('single paragraph thumbnail', async () => {\n    const value = ((\n      <value>\n        <document>\n          <block type=\"paragraph\" key=\"a\">\n            A<cursor />\n          </block>\n        </document>\n      </value>\n    ) as unknown) as Value;\n    const { container, controller } = await renderApp(value);\n    await waitFor(() => {\n      expect(container.querySelectorAll(`.${DRAG_HIGHLIGHT_CLASSNAME}`).length).toBe(1);\n    });\n    const thumbnail = getDragThumbnails(controller, {\n      viewKey: 'a',\n    });\n\n    expect(thumbnail.getAttribute('data-cangjie-key')).toBe('a');\n  });\n\n  test('complex block thumbnail', async () => {\n    const value = ((\n      <value>\n        <document>\n          <block type=\"table\" key=\"a\" data={{ colsWidth: [100] }}>\n            <block type=\"table-row\">\n              <block type=\"table-cell\">\n                <block type=\"paragraph\">\n                  <cursor />A\n                </block>\n              </block>\n            </block>\n          </block>\n        </document>\n      </value>\n    ) as unknown) as Value;\n    const { container, controller } = await renderApp(value);\n    await waitFor(() => {\n      expect(container.querySelectorAll(`.${DRAG_HIGHLIGHT_TABLE_CLASSNAME}`).length).toBe(1);\n      expect(container.querySelectorAll(`.${DRAG_HIGHLIGHT_CLASSNAME}`).length).toBe(0);\n    });\n    const thumbnail = getDragThumbnails(controller, {\n      viewKey: 'a',\n    }, {\n      complexElements: {\n        table: true,\n      },\n    });\n\n    expect(thumbnail.firstElementChild.childElementCount).toBe(1);\n    expect(!!thumbnail.querySelector('[data-cangjie-key=\"a\"]')).toBe(false);\n  });\n\n  test('multi paragraphs thumbnail', async () => {\n    const value = ((\n      <value>\n        <document>\n          <block type=\"paragraph\" key=\"a\">\n            <anchor />A\n          </block>\n          <block type=\"paragraph\" key=\"b\">\n            B<focus />\n          </block>\n        </document>\n      </value>\n    ) as unknown) as Value;\n    const { container, controller, dragHander, paragraphs, findByTestId } = await renderApp(value);\n    await waitFor(() => {\n      expect(container.querySelectorAll(`.${DRAG_HIGHLIGHT_CLASSNAME}`).length).toBe(2);\n    });\n    const thumbnail = getDragThumbnails(controller, {\n      viewKey: 'a',\n    });\n    expect(thumbnail.firstElementChild.childElementCount).toBe(2);\n    expect(!!thumbnail.querySelector('[data-cangjie-key=\"a\"]')).toBe(true);\n    expect(!!thumbnail.querySelector('[data-cangjie-key=\"b\"]')).toBe(true);\n    fireEvent.mouseLeave(dragHander);\n    await waitFor(() => {\n      expect(container.querySelectorAll(`.${DRAG_HIGHLIGHT_CLASSNAME}`).length).toBe(0);\n    });\n    fireEvent.mouseLeave(paragraphs[0]);\n    await waitFor(() => !findByTestId('drag-hander'));\n  });\n});\n"],"file":"thumbnails.ui.test.js"}