{"version":3,"sources":["../../../../src/__tests__/draggable/dragList.ui.test.tsx"],"names":["defaultValue","list","listId","level","isOrdered","listStyleType","App","props","val","value","setValue","React","useState","createBiPlugins","draggable","ImTagPlugin","listPlugin","leftToolbar","handleChange","change","enabled","menu","key","renderApp","results","container","document","body","paragraphs","querySelectorAll","describe","afterEach","jest","clearAllMocks","test","findByTestId","fireEvent","mouseMove","dragHander","mouseEnter","expect","DRAG_HIGHLIGHT_CLASSNAME","length","toBe","mouseLeave"],"mappings":"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","sourcesContent":["/** @jsx jsx */\nimport * as React from 'react';\nimport { fireEvent, jsx, renderEditor } from '@ali/4ever-dev-test';\nimport { cleanup, waitFor, act } from '@testing-library/react';\nimport {\n  Value,\n  Change,\n} from '@ali/4ever-cangjie';\nimport '@testing-library/jest-dom/extend-expect';\n\nimport Provider from '../../provider';\nimport Content from '../../content';\nimport draggable from '../../plugins/draggable';\nimport leftToolbar from '../../plugins/leftToolbar';\nimport listPlugin from '../../plugins/list';\nimport ImTagPlugin from '../../plugins/imTag';\nimport { DRAG_HIGHLIGHT_CLASSNAME } from '@ali/4ever-plugin-draggable';\nimport createCustomizedBiPlugins from '../../createCustomizedBiPlugins';\n\nconst defaultValue = ((\n  <value>\n    <document>\n      <block\n        type=\"paragraph\"\n        data={{\n          list: {\n            listId: 'id1',\n            level: 0,\n            isOrdered: true,\n            listStyleType: 'DEC_LEN_LROM_P',\n          },\n        }}\n      >\n        <cursor />AAA\n      </block>\n      <block\n        type=\"paragraph\"\n        data={{\n          list: {\n            listId: 'id2',\n            level: 1,\n            isOrdered: true,\n            listStyleType: 'DEC_LEN_LROM_P',\n          },\n        }}\n      >\n        BBB\n      </block>\n    </document>\n  </value>\n) as unknown) as Value;\n\n\ninterface AppProps {\n  val?: Value;\n}\n\nconst App: React.FC<AppProps> = (props) => {\n  const { val = defaultValue } = props;\n  const [value, setValue] = React.useState(val);\n  const createBiPlugins = createCustomizedBiPlugins({\n    draggable,\n    ImTagPlugin,\n    listPlugin,\n    leftToolbar,\n  });\n\n  const handleChange = (change: Change) => {\n    act(() => {\n      setValue(change.value);\n    });\n  };\n\n  return (\n    <Provider\n      value={value}\n      plugins={createBiPlugins({\n        draggable: {\n          enabled: true,\n        },\n        leftToolbar: {\n          menu: [\n            {\n              key: 'draggable',\n            },\n          ],\n        },\n      })}\n      onChange={handleChange}\n      autoFocus\n    >\n      <Content />\n    </Provider>\n  );\n};\n\nasync function renderApp(val?: Value) {\n  const results = await renderEditor(<App val={val} />, {\n    container: document.body,\n  });\n  const { container } = results;\n  const paragraphs = container.querySelectorAll('[data-type=\"paragraph\"]');\n  return { ...results, paragraphs };\n}\n\ndescribe('Bi/draggable/ui', () => {\n  afterEach(() => {\n    cleanup();\n    jest.clearAllMocks();\n  });\n\n  test('show list highlight', async () => {\n    const { findByTestId, paragraphs, container } = await renderApp();\n    fireEvent.mouseMove(paragraphs[0]);\n    const dragHander = await findByTestId('drag-hander');\n    fireEvent.mouseEnter(dragHander);\n\n    await waitFor(() => {\n      expect(container.querySelectorAll(`.${DRAG_HIGHLIGHT_CLASSNAME}`).length).toBe(2);\n    });\n\n    fireEvent.mouseLeave(dragHander);\n\n    await waitFor(() => {\n      expect(container.querySelectorAll(`.${DRAG_HIGHLIGHT_CLASSNAME}`).length).toBe(0);\n    });\n  });\n\n  test('show list highlight selection priority', async () => {\n    const { findByTestId, paragraphs, container } = await renderApp();\n    fireEvent.mouseMove(paragraphs[0]);\n    const dragHander = await findByTestId('drag-hander');\n    fireEvent.mouseEnter(dragHander);\n\n    await waitFor(() => {\n      expect(container.querySelectorAll(`.${DRAG_HIGHLIGHT_CLASSNAME}`).length).toBe(2);\n    });\n\n    fireEvent.mouseLeave(dragHander);\n\n    await waitFor(() => {\n      expect(container.querySelectorAll(`.${DRAG_HIGHLIGHT_CLASSNAME}`).length).toBe(0);\n    });\n  });\n});\n"],"file":"dragList.ui.test.js"}