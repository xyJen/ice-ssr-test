{"version":3,"sources":["../../../../src/__tests__/code/ui.test.tsx"],"names":["createBiPlugins","code","hotKey","insertEvent","undoEvent","Editor","props","defaultValue","codeConfig","value","setValue","React","useState","plugins","useMemo","config","locale","buttonTitle","themeTitle","languageTitle","copy","delete","insert","cancel","darkTheme","lightTheme","handleChange","useCallback","changed","toolButtons","name","describe","beforeAll","jest","spyOn","console","error","mockImplementation","afterAll","mockRestore","afterEach","test","queryByTestId","container","Mo","textToValue","codeButton","querySelector","fireEvent","click","codeEditor","expect","textContent","toBe","editor","keyDown","queryByPlaceholderText","queryByText","not","toBeInTheDocument","document","activeElement","querySelectorAll","toHaveLength","event","HOTKEYS","deleteBackward","content","deleteForward","skip","findByTestId","caret","domUtils","getCaretDom","caretValue","getAttribute","indexOf","cangjieInput","data","syntaxSelect","javascriptOption","selected","innerHTML","themeSelect","darkOption","codeMirror","focus","themeSelected","syntaxSelected","only","moreBtn","cutBtn"],"mappings":"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","sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\n/** @jsx jsx */\nimport * as React from 'react';\nimport { Value, domUtils } from '@ali/4ever-cangjie';\nimport {\n  fireEvent,\n  renderEditor,\n  jsx,\n  getHotkeyEvent,\n  HOTKEYS,\n} from '@ali/4ever-dev-test';\nimport '@testing-library/jest-dom/extend-expect';\nimport {\n  cleanup,\n  waitForElement,\n  wait,\n} from '@testing-library/react';\nimport Mo from '../serializer';\nimport { biFactory as code, CodePluginConfig } from '@ali/4ever-plugin-code';\nimport { createCustomizedBiPlugins, Toolbar } from '../..';\nimport Provider from '../../provider';\nimport Content from '../../content';\n\nimport {weWaitFor, weWaitForElement, weWaitForElementToBeRemoved} from '../helper';\n\ninterface EditorProps {\n  codeConfig?: Partial<CodePluginConfig>;\n  defaultValue: Value;\n}\n\nconst createBiPlugins = createCustomizedBiPlugins({\n  code,\n});\n\nconst hotKey = 'ctrl+k';\nconst insertEvent = getHotkeyEvent(hotKey);\nconst undoEvent = getHotkeyEvent('ctrl+z');\n\nconst Editor: React.FC<EditorProps> = (props) => {\n  const { defaultValue, codeConfig = {} } = props;\n  const [value, setValue] = React.useState(defaultValue);\n  const plugins = React.useMemo(() => {\n    const config: CodePluginConfig = {\n      hotKey,\n      locale: {\n        buttonTitle: '代码块',\n        themeTitle: '主题',\n        languageTitle: '高亮语言',\n        copy: '复制',\n        delete: '删除',\n        insert: '插入',\n        cancel: '删除',\n        darkTheme: 'Dark',\n        lightTheme: 'Light',\n      },\n      ...codeConfig,\n    };\n\n    return createBiPlugins({\n      code: config,\n    });\n  }, [codeConfig]);\n\n  const handleChange = React.useCallback((changed) => {\n    setValue(changed.value);\n  }, []);\n\n  return (\n    <Provider value={value} onChange={handleChange} plugins={plugins} autoFocus>\n      <Toolbar\n        autoFolding={false}\n        singleLayout={[{ toolButtons: [{ name: 'code' }] }]}\n      />\n      <Content />\n    </Provider>\n  );\n};\n\ndescribe('Bi/code/ui', () => {\n  beforeAll(() => {\n    // 防止被 componentDidCatch catch 的 error 被控制台输出\n    jest.spyOn(console, 'error');\n    // @ts-ignore\n    console.error.mockImplementation(() => { });\n  });\n\n  afterAll(() => {\n    // @ts-ignore\n    console.error.mockRestore();\n  });\n\n  afterEach(() => {\n    cleanup();\n  });\n\n  describe('插入代码块', () => {\n    test('工具栏插入代码块', async () => {\n      const { queryByTestId, container } = await renderEditor(\n        <Editor defaultValue={Mo.textToValue('')} />,\n      );\n      const codeButton = container.querySelector(\n        '[data-testid=\"bi-toolbar-code-block\"] > div', // TODO @淼淼 迁移到3.0框架中\n      );\n      fireEvent.click(codeButton!);\n      await waitForElement(() => queryByTestId('code-editor'));\n    });\n\n    test('选中文本后，工具栏插入代码块', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              <anchor />\n              const a = 1;\n              <focus />\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n      const { container } = await renderEditor(<Editor defaultValue={value} />);\n      const codeButton = container.querySelector(\n        '[data-testid=\"bi-toolbar-code-block\"] > div',\n      );\n      fireEvent.click(codeButton!);\n      const codeEditor = await weWaitForElement(() => container.querySelector('.CodeMirror'));\n      expect(codeEditor!.textContent).toBe('const a = 1;');\n    });\n\n    test('快捷键插入代码块', async () => {\n      const { queryByTestId, editor } = await renderEditor(\n        <Editor defaultValue={Mo.textToValue('')} />,\n      );\n      fireEvent.keyDown(editor, insertEvent);\n      await waitForElement(() => queryByTestId('code-editor'));\n    });\n\n    test('空行连续输入 ``` 回车，插入代码块', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              ```\n              <cursor />\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n      const { queryByTestId, editor } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      fireEvent.keyDown(editor, getHotkeyEvent('enter'));\n      await weWaitForElement(() => queryByTestId('code-editor'));\n    });\n\n    test('空行连续输入 ```syntax 回车，插入代码块', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              ```js\n              <cursor />\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n      const { queryByTestId, editor, queryByPlaceholderText } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      fireEvent.keyDown(editor, getHotkeyEvent('enter'));\n      await weWaitForElement(() => queryByTestId('code-editor'));\n      await weWaitForElement(() => queryByPlaceholderText(/JavaScript/i));\n    });\n\n    test('行末连续输入 ```syntax 回车，插入代码块', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              abcd```js\n              <cursor />\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n      const { queryByTestId, queryByText, editor, queryByPlaceholderText } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      fireEvent.keyDown(editor, getHotkeyEvent('enter'));\n      await weWaitForElement(() => queryByText(/^abcd$/));\n      await weWaitForElement(() => queryByTestId('code-editor'));\n      // 工具栏选中对应语言\n      await weWaitForElement(() => queryByPlaceholderText(/JavaScript/i));\n    });\n\n    test('若 ```syntax 不位于行末，则回车不响应代码块插入', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              before```js after\n              <cursor />\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n      const { queryByTestId, queryByText, editor } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      fireEvent.keyDown(editor, getHotkeyEvent('enter'));\n      await weWaitForElement(() => queryByText(/^before```js after$/));\n      expect(queryByTestId('code-editor')).not.toBeInTheDocument();\n    });\n\n    test('插入代码块时，自动将选中文本初始化到代码块', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              <anchor />\n              const a = 1;\n              <focus />\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n      const { container, editor } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      fireEvent.keyDown(editor, insertEvent);\n\n      const codeEditor = await weWaitForElement(() => container.querySelector('.CodeMirror'));\n      expect(codeEditor!.textContent).toBe('const a = 1;');\n    });\n\n    test('插入代码块，避免截断当前行', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              123\n              <cursor />\n              456\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n      const { editor, container, queryByText } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      fireEvent.keyDown(editor, insertEvent);\n\n      await weWaitForElement(() => container.querySelector('.CodeMirror'));\n      expect(queryByText(/123456/)).toBeInTheDocument();\n    });\n\n    test('插入代码块后，自动 focus 到代码块', async () => {\n      const { queryByTestId, editor } = await renderEditor(\n        <Editor defaultValue={Mo.textToValue('')} />,\n      );\n      fireEvent.keyDown(editor, insertEvent);\n      const codeEditor = await weWaitForElement(() => queryByTestId('code-editor'));\n      expect(codeEditor!.querySelector('textarea')).toBe(\n        document.activeElement,\n      );\n    });\n\n    test('代码块后冗余一个空行（方便用户定位光标到代码块）', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              first paragraph\n              <cursor />\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n      const { container, editor, queryByTestId } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      fireEvent.keyDown(editor, insertEvent);\n      await weWaitForElement(() => queryByTestId('code-editor'));\n\n      expect(\n        container.querySelectorAll('[data-type=\"paragraph\"]'),\n      ).toHaveLength(2);\n    });\n  });\n\n  describe('删除代码块', () => {\n    test('向前删除代码块', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\" />\n            <block type=\"code\" />\n            <block type=\"paragraph\">\n              <cursor />\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n      const event = getHotkeyEvent(HOTKEYS.deleteBackward);\n      const { content, queryByTestId } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      // 选中\n      fireEvent.keyDown(content, event);\n      // 删除\n      fireEvent.keyDown(content, event);\n\n      await weWaitForElementToBeRemoved(() => queryByTestId('code-editor'));\n    });\n\n    test('向后删除代码块', async () => {\n      const event = getHotkeyEvent(HOTKEYS.deleteForward);\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              <cursor />\n            </block>\n            <block type=\"code\" />\n            <block type=\"paragraph\" />\n          </document>\n        </value>\n      ) as unknown) as Value;\n      const { content, queryByTestId } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      // 选中\n      fireEvent.keyDown(content, event);\n      // 删除\n      fireEvent.keyDown(content, event);\n      await weWaitForElementToBeRemoved(() => queryByTestId('code-editor'));\n    });\n\n    test('选中删除代码块', async () => {\n      const event = getHotkeyEvent(HOTKEYS.deleteBackward);\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              <anchor />\n            </block>\n            <block type=\"code\" />\n            <block type=\"code\" />\n            <block type=\"paragraph\" >\n              <focus />\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n      const { content, queryByTestId } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      // 删除\n      fireEvent.keyDown(content, event);\n      await wait();\n      expect(!!queryByTestId('code-editor')).toBe(false);\n    });\n\n    test('在代码块开头退格，删除代码块', async () => {\n      const { editor, queryByTestId } = await renderEditor(\n        <Editor defaultValue={Mo.textToValue('')} />,\n      );\n      fireEvent.keyDown(editor, insertEvent);\n      const codeEditor = await waitForElement(() => queryByTestId('code-editor'));\n      fireEvent.keyDown(\n        codeEditor!.querySelector('textarea')!,\n        getHotkeyEvent('backspace'),\n      );\n      await weWaitForElementToBeRemoved(() => queryByTestId('code-editor'));\n    });\n  });\n\n  // TODO: FIXME getCaretDom 取不到具体 dom，实际测试正常\n  describe.skip('光标移动', () => {\n    test('在代码块上方段落右移，跳到代码块左边', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              <cursor />\n            </block>\n            <block key=\"code\" type=\"code\" />\n            <block type=\"paragraph\" />\n          </document>\n        </value>\n      ) as unknown) as Value;\n\n      const { content, findByTestId } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      const event = getHotkeyEvent('arrowright');\n      fireEvent.keyDown(content, event);\n      await wait();\n      const caret = await domUtils.getCaretDom(content);\n      const caretValue = caret.getAttribute('data-cangjie-point');\n      expect(caretValue).toBe('code-before');\n    });\n\n    test('在代码块左侧往右移，跳到代码块右侧', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\" />\n            <block key=\"code\" type=\"code\" cursor=\"before\" />\n            <block type=\"paragraph\" />\n          </document>\n        </value>\n      ) as unknown) as Value;\n\n      const { content, findByTestId } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      const event = getHotkeyEvent('arrowright');\n      fireEvent.keyDown(content, event);\n      await wait();\n      const caret = await domUtils.getCaretDom(content);\n      const caretValue = caret.getAttribute('data-cangjie-point');\n      expect(caretValue).toBe('code-after');\n    });\n    test('在代码块左侧往左移，跳到上一个段落', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              <text key=\"text1\" />\n            </block>\n            <block type=\"code\" cursor=\"before\" />\n            <block type=\"paragraph\" />\n          </document>\n        </value>\n      ) as unknown) as Value;\n\n      const { content, findByTestId } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      const event = getHotkeyEvent('arrowup');\n      fireEvent.keyDown(content, event);\n      await wait();\n      const caret = await domUtils.getCaretDom(content);\n      const caretValue = caret.getAttribute('data-cangjie-point');\n      expect(caretValue).toBe('text1-0');\n    });\n\n    test('在代码块右侧往左移，跳到代码块左侧', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\" />\n            <block key=\"code\" type=\"code\" cursor=\"after\" />\n            <block type=\"paragraph\" />\n          </document>\n        </value>\n      ) as unknown) as Value;\n\n      const { content, findByTestId } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      const event = getHotkeyEvent('arrowleft');\n      fireEvent.keyDown(content, event);\n      await wait();\n      const caret = await domUtils.getCaretDom(content);\n      const caretValue = caret.getAttribute('data-cangjie-point');\n      expect(caretValue).toBe('code-before');\n    });\n\n    test('在代码块右侧往右移，跳到代码块下方段落', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\" />\n            <block key=\"code\" type=\"code\" cursor=\"after\" />\n            <block type=\"paragraph\">\n              <text key=\"text2\" />\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n\n      const { content, findByTestId } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      const event = getHotkeyEvent('arrowright');\n      fireEvent.keyDown(content, event);\n      await wait();\n      const caret = await domUtils.getCaretDom(content);\n      const caretValue = caret.getAttribute('data-cangjie-point');\n      expect(caretValue).toBe('text2-0');\n    });\n\n    test('在代码块下方段落左移，跳到代码块右边', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\" />\n            <block key=\"code\" type=\"code\" />\n            <block type=\"paragraph\">\n              <cursor />\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n\n      const { content, findByTestId } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      const event = getHotkeyEvent('arrowleft');\n      fireEvent.keyDown(content, event);\n      await wait();\n      const caret = await domUtils.getCaretDom(content);\n      const caretValue = caret.getAttribute('data-cangjie-point');\n      expect(caretValue).toBe('code-after');\n    });\n  });\n\n  describe('回到正文', () => {\n    // TODO: FIXME\n    test.skip('在代码块开头左移，跳到代码块左边', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              first paragraph\n              <cursor />\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n      const { editor, content, queryByTestId, findByTestId } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      fireEvent.keyDown(editor, insertEvent);\n      const codeEditor = await waitForElement(() => queryByTestId('code-editor'));\n      fireEvent.keyDown(\n        codeEditor!.querySelector('textarea')!,\n        getHotkeyEvent('left'),\n      );\n      await wait();\n      const caret = await domUtils.getCaretDom(content);\n      const caretValue = caret.getAttribute('data-cangjie-point');\n      expect(caretValue.indexOf('-before') >= 0).toBe(true);\n    });\n\n    test('在代码块首行上移，跳回上一段落（若存在）', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              first paragraph\n              <cursor />\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n      const { editor, queryByText, queryByTestId } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      fireEvent.keyDown(editor, insertEvent);\n      const codeEditor = await weWaitForElement(() => queryByTestId('code-editor'));\n      fireEvent.keyDown(\n        codeEditor!.querySelector('textarea')!,\n        getHotkeyEvent('up'),\n      );\n\n      fireEvent.cangjieInput(editor, { data: 's' });\n      await weWaitForElement(() => queryByText(/first paragraphs/));\n    });\n\n    test('代码块按下 ESC，退出代码块', async () => {\n      const { editor, findByTestId } = await renderEditor(\n        <Editor defaultValue={Mo.textToValue('')} />,\n      );\n      fireEvent.keyDown(editor, insertEvent);\n      const codeEditor = await findByTestId('code-editor');\n      fireEvent.keyDown(\n        codeEditor!.querySelector('textarea')!,\n        getHotkeyEvent('esc'),\n      );\n      await wait();\n      await weWaitFor(() => expect(document.activeElement).toBe(editor));\n    });\n  });\n\n  describe('动态工具栏', () => {\n    test('支持切换高亮语言', async () => {\n      const { editor, queryByText, queryByTestId } = await renderEditor(\n        <Editor defaultValue={Mo.textToValue('')} />,\n      );\n      fireEvent.keyDown(editor, insertEvent);\n      await weWaitForElement(() => document.querySelector('.code-block-theme-select'));\n\n      const syntaxSelect = await weWaitForElement(() => document.querySelector('.code-block-syntax-select > div'));\n      await weWaitForElement(() => document.querySelector('[data-select-value=\"plaintext\"]'))\n      fireEvent.click(syntaxSelect!);\n      const javascriptOption = await weWaitForElement(() => queryByTestId('option-text/javascript'));\n      fireEvent.click(javascriptOption);\n\n      const selected = await weWaitForElement(() => document.querySelector('.code-block-syntax-select > div'));\n      expect(/JavaScript(JSON)/.test(selected.innerHTML));\n    });\n\n    test('支持切换主题', async () => {\n      const { editor, queryByTestId } = await renderEditor(\n        <Editor defaultValue={Mo.textToValue('')} />,\n      );\n      fireEvent.keyDown(editor, insertEvent);\n      const themeSelect = await weWaitForElement(() => document.querySelector('.code-block-theme-select > div'));\n      await weWaitForElement(() => document.querySelector('[data-select-value=\"default\"]'));\n      fireEvent.click(themeSelect!);\n      const darkOption = await weWaitForElement(() => queryByTestId('option-dracula'));\n      fireEvent.click(darkOption!);\n\n      const selected = await weWaitForElement(() => document.querySelector('.code-block-theme-select > div'));\n      expect(/Dark/.test(selected.innerHTML));\n    });\n\n    test('语言及主题切换后，重新回到代码块，状态保留', async () => {\n      const {\n        editor,\n        queryByText,\n        queryByTestId,\n      } = await renderEditor(<Editor defaultValue={Mo.textToValue('')} />);\n      fireEvent.keyDown(editor, insertEvent);\n      const codeMirror = await weWaitForElement(() => queryByTestId('code-editor'));\n      // 切换主题\n      const themeSelect = await weWaitForElement(() => document.querySelector('.code-block-theme-select > div'));\n      fireEvent.click(themeSelect!);\n      const darkOption = await weWaitForElement(() => queryByText(/Dark/i));\n      fireEvent.click(darkOption!);\n      // 切换语言\n      const syntaxSelect = await weWaitForElement(() => document.querySelector('.code-block-syntax-select > div'));\n      fireEvent.click(syntaxSelect!);\n      const javascriptOption = await weWaitForElement(() => queryByText(/JavaScript/i));\n      fireEvent.click(javascriptOption!);\n      // 离开编辑器\n      fireEvent.focus(editor);\n      await weWaitFor(() => document.activeElement === editor);\n      // 回到编辑器\n      fireEvent.focus(codeMirror!.querySelector('.CodeMirror textarea')!);\n      await weWaitFor(() => document.activeElement === codeMirror!.querySelector('.CodeMirror textarea')!);\n      const themeSelected = await weWaitForElement(() => document.querySelector('.code-block-theme-select > div'));\n      const syntaxSelected = await weWaitForElement(() => document.querySelector('.code-block-syntax-select > div'));\n      expect(/Dark/.test(themeSelected.innerHTML));\n      expect(/JavaScript/.test(syntaxSelected.innerHTML));\n    });\n\n    test.only('更多', async () => {\n      const { editor, queryByTestId } = await renderEditor(\n        <Editor defaultValue={Mo.textToValue('')} />,\n      );\n      fireEvent.keyDown(editor, insertEvent);\n      const moreBtn = await weWaitForElement(() => document.querySelector('.code-toolbar-overlay .inline-toolbar-container .button-box'));\n      fireEvent.click(moreBtn);\n\n      const cutBtn = await weWaitForElement(() => document.querySelector('.code-toolbar-overlay div[data-path=\"other-1\"]'));\n      fireEvent.click(cutBtn);\n\n      //await weWaitForElementToBeRemoved(() => queryByTestId('code-editor'));\n    });\n  });\n});\n"],"file":"ui.test.js"}