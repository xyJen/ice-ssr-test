{"version":3,"sources":["../../../../src/__tests__/sticker/ui.test.tsx"],"names":["createValue","text","clickToolbar","container","selector","quoteBlockElement","querySelector","fireEvent","click","originValue","beforeAll","process","env","RUNTIME_ENV","ToolbarLayout","UITEST_FLAG","afterAll","describe","it","content","queryByTestId","stickerPanel","stkItem","children","stkBtn","code","getAttribute","stickerElement","expect","not","toBe","value","fontBtn","stickerItem1","style","width","stickerItem2","backgroundColor","inputContent","editor","firstSticker","headingSize","theme","Number","window","getComputedStyle","cangjieInput","data","leaves","querySelectorAll","textContent","fontStyle"],"mappings":"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","sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\n/** @jsx jsx */\nimport { wait, waitFor } from '@testing-library/react';\nimport { renderEditor, getHotkeyEvent, jsx, fireEvent } from '@ali/4ever-dev-test';\nimport { Value } from '@ali/4ever-cangjie';\nimport { theme } from '@ali/4ever-bamboo';\nimport { ToolbarLayout } from '@ali/we-design-next';\nimport Editor from '../editor';\n\nfunction createValue(text: string) {\n  return ((\n    <value>\n      <document>\n        <block type=\"paragraph\">\n          <cursor />\n          {text}\n        </block>\n      </document>\n    </value>\n  ) as unknown) as Value;\n}\n\nfunction clickToolbar(container, selector) {\n  const quoteBlockElement = container.querySelector(selector);\n  fireEvent.click(quoteBlockElement);\n}\n\nlet originValue;\n\nbeforeAll(() => {\n  originValue = process.env.RUNTIME_ENV;\n  process.env.RUNTIME_ENV = ToolbarLayout.UITEST_FLAG;\n})\n\nafterAll(() => {\n  process.env.RUNTIME_ENV = originValue\n})\n\ndescribe('Bi/sticker', () => {\n  it('通过 Toolbar 添加表情', async () => {\n    const { container, content, queryByTestId } = await renderEditor(\n      <Editor defaultValue={createValue('Hello')} />,\n    );\n    clickToolbar(container, '[data-testid=\"bi-toolbar-sticker\"]');\n    await wait();\n    const stickerPanel = await waitFor(() => queryByTestId('sticker-panel'));\n    for (const stkItem of stickerPanel.children) {\n      const stkBtn = stkItem.querySelector('[data-type=\"sticker\"]');\n      if (!stkBtn) continue;\n      fireEvent.click(stkBtn.children[0]);\n    }\n    await wait();\n    for (const stkItem of stickerPanel.children) {\n      const stkBtn = stkItem.querySelector('[data-type=\"sticker\"]');\n      if (!stkBtn) continue;\n      const code = stkBtn.getAttribute('data-sticker');\n      const stickerElement = await waitFor(() =>\n        content.querySelector(`[data-sticker=\"${code}\"]`));\n      expect(stickerElement).not.toBe(null);\n    }\n  });\n  it('表情设置大小、背景色', async () => {\n    const value = (\n      <value>\n        <document>\n          <block type=\"paragraph\">\n            <anchor />\n            <inline\n              type=\"emoji\"\n              data={{\n                code: '微笑',\n              }}\n            />\n            <focus />\n          </block>\n        </document>\n      </value>\n    ) as any;\n    const { container, queryByTestId } = await renderEditor(\n      <Editor defaultValue={value} />,\n    );\n    clickToolbar(container, '[data-testid=\"bi-toolbar-sz\"]');\n    await wait();\n    const fontBtn = await waitFor(() => queryByTestId('bi-toolbar-sz__list_42'));\n    fireEvent.click(fontBtn);\n    await wait();\n    const stickerItem1 = await waitFor(\n      () => container.querySelector('[data-type=\"sticker\"]').children[0],\n    );\n    expect(stickerItem1.style.width).toBe('84px');\n    clickToolbar(container, '[data-testid=\"bi-toolbar-highlight\"] .wdn-toolbar-split-left');\n    await wait();\n    const stickerItem2 = await waitFor(\n      () => container.querySelector('[data-type=\"sticker\"]').children[0],\n    );\n    expect(stickerItem2.style.backgroundColor).toBe('rgb(253, 190, 61)');\n\n  });\n  it('标题中加入表情, 自动继承标题样式', async () => {\n    const inputContent = 'aaa';\n    const value = (\n      <value>\n        <document>\n          <block key=\"h1\" type=\"heading-1\">\n            <text key=\"text\">\n              <m type=\"italic\">\n                Heading1\n                <cursor />\n                Heading1\n              </m>\n            </text>\n          </block>\n        </document>\n      </value>\n    );\n    const { container, content, editor, queryByTestId } = await renderEditor(\n      <Editor defaultValue={value} />,\n    );\n    clickToolbar(container, '[data-testid=\"bi-toolbar-sticker\"]');\n    await wait();\n    const stickerPanel = await waitFor(() => queryByTestId('sticker-panel'));\n    const firstSticker = stickerPanel.children[0];\n    const stkBtn = firstSticker.querySelector('[data-type=\"sticker\"]');\n    const code = stkBtn.getAttribute('data-sticker');\n    fireEvent.click(stkBtn.children[0]);\n    await wait();\n    const stickerElement = await waitFor(\n      () => content.querySelector(`[data-sticker=\"${code}\"]`).children[0],\n    );\n    const headingSize = theme['heading-1']['font-size'];\n    expect(Number(window.getComputedStyle(stickerElement).width)).toBe(\n      Number(headingSize) * 2,\n    );\n    await wait();\n    fireEvent.cangjieInput(editor, { data: inputContent });\n    const leaves = await waitFor(() => content.querySelectorAll('[data-cangjie-mark=\"true\"]'));\n    expect(leaves[1].textContent).toBe(inputContent);\n    expect(leaves[1].style.fontStyle).toBe('italic');\n  });\n});\n"],"file":"ui.test.js"}