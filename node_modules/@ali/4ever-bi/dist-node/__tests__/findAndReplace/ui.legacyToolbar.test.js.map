{"version":3,"sources":["../../../../src/__tests__/findAndReplace/ui.legacyToolbar.test.tsx"],"names":["defaultValue","scrollIntoViewMock","jest","fn","window","HTMLElement","prototype","scrollIntoView","describe","only","test","queryByTestId","editor","fireEvent","keyDown","fapPortal","expect","children","length","toBeGreaterThan","fapButton","click","toBe","findByTestId","content","contextMenu","querySelector","fapContextButton","inputEle","value","arrowRight","text2","bgColor","getComputedStyle","getPropertyValue","toggleReplaceBtn","replaceInput","inputChange","replaceBtn","text1","innerHTML","matches","querySelectorAll","toHaveLength"],"mappings":"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","sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\n/** @jsx jsx */\nimport '@testing-library/jest-dom/extend-expect';\nimport { EditorWidthLegacyToolbar as Editor } from '../editor';\nimport { Value } from '@ali/4ever-cangjie';\nimport {\n  renderEditor,\n  jsx,\n  getHotkeyEvent,\n  fireEvent,\n  waitForTime,\n} from '@ali/4ever-dev-test';\nimport { wait, waitFor } from '@testing-library/react';\n\nconst defaultValue = ((\n  <value>\n    <document>\n      <block type=\"paragraph\" key=\"paragraph1\">\n        <text key=\"text1\">\n          <anchor />\n          AAA\n          <focus />\n        </text>\n      </block>\n      <block type=\"paragraph\">\n        <text key=\"text2\">AAA</text>\n      </block>\n      <block type=\"paragraph\">\n        <text key=\"text3\">AAA</text>\n      </block>\n    </document>\n  </value>\n) as unknown) as Value;\n\nconst scrollIntoViewMock = jest.fn();\nwindow.HTMLElement.prototype.scrollIntoView = scrollIntoViewMock;\n\ndescribe.only('查找替换 - 查找替换面板', () => {\n  test('按下 mod + f 可唤出查找替换面板', async () => {\n    const { queryByTestId, editor } = await renderEditor(\n      <Editor defaultValue={defaultValue} />,\n    );\n\n    fireEvent.keyDown(editor, getHotkeyEvent('mod+f'));\n\n    const fapPortal = queryByTestId('Portal_wrapper_FindAndReplacePortal');\n    await waitFor(() => expect(fapPortal.children.length).toBeGreaterThan(0));\n  });\n\n  test('点击工具栏「查找替换」可唤出查找替换面板，再次按下可关闭', async () => {\n    const { queryByTestId } = await renderEditor(\n      <Editor defaultValue={defaultValue} />,\n    );\n\n    const fapButton = queryByTestId('bi-toolbar-search');\n    fireEvent.click(fapButton);\n\n    const fapPortal = queryByTestId('Portal_wrapper_FindAndReplacePortal');\n    await waitFor(() => expect(fapPortal.children.length).toBeGreaterThan(0));\n\n    fireEvent.click(fapButton);\n    await waitFor(() => expect(fapPortal.children.length).toBe(0));\n  });\n\n  test('选中文本, 右键, 点击查找替换可唤出查找替换面板', async () => {\n    const { queryByTestId, findByTestId, content } = await renderEditor(\n      <Editor defaultValue={defaultValue} />,\n    );\n\n    fireEvent.contextMenu(content.querySelector('[data-cangjie-key=\"text1:0\"]')!);\n    const fapContextButton = await findByTestId('6-find');\n    fireEvent.click(fapContextButton!);\n\n    const fapPortal = queryByTestId('Portal_wrapper_FindAndReplacePortal');\n    await waitFor(() => expect(fapPortal.children.length).toBeGreaterThan(0));\n  });\n});\n\ndescribe('查找替换 - 查找', () => {\n  test('存在选区时，搜索框初始化为选区文本', async () => {\n    const { queryByTestId, editor } = await renderEditor(\n      <Editor defaultValue={defaultValue} />,\n    );\n\n    fireEvent.keyDown(editor, getHotkeyEvent('mod+f'));\n\n    await waitFor(() => {\n      const inputEle = queryByTestId('J_findValueInput') as HTMLInputElement;\n      expect(inputEle.value).toBe('AAA');\n    });\n  });\n\n  test('点击右箭头, 可切换到下一个匹配项', async () => {\n    const { content, queryByTestId, editor } = await renderEditor(\n      <Editor defaultValue={defaultValue} />,\n    );\n\n    fireEvent.keyDown(editor, getHotkeyEvent('mod+f'));\n\n    await waitFor(() => {\n      const arrowRight = queryByTestId('ArrowRightNormal-FindAndReplacePortal');\n      fireEvent.click(arrowRight);\n\n      const text2 = content.querySelector('[data-cangjie-key=\"text2:0\"]');\n      const bgColor = window\n        .getComputedStyle(text2)\n        .getPropertyValue('background-color');\n      expect(bgColor).toBe('rgb(255, 153, 51)');\n    });\n  });\n});\n\ndescribe('查找替换 - 替换', () => {\n  test('点击替换，可替换当前项', async () => {\n    const { queryByTestId, editor, content } = await renderEditor(\n      <Editor defaultValue={defaultValue} />,\n    );\n\n    fireEvent.keyDown(editor, getHotkeyEvent('mod+f'));\n\n    await waitFor(() => {\n      const toggleReplaceBtn = queryByTestId('undefined_replace');\n      fireEvent.click(toggleReplaceBtn);\n    });\n\n    const replaceInput = queryByTestId('J_replaceValueInput');\n    fireEvent.inputChange(replaceInput, 'BBB');\n\n    const replaceBtn = queryByTestId('J_replaceOne');\n    fireEvent.click(replaceBtn);\n\n    await waitFor(() => {\n      const text1 = content.querySelector('[data-cangjie-key=\"text1:0\"]');\n      expect(text1.innerHTML).toBe('BBB');\n    });\n  });\n\n  test('点击替换全部，可替换全部匹配项', async () => {\n    const { queryByTestId, editor, content } = await renderEditor(\n      <Editor defaultValue={defaultValue} />,\n    );\n\n    fireEvent.keyDown(editor, getHotkeyEvent('mod+f'));\n\n    await waitFor(() => {\n      const toggleReplaceBtn = queryByTestId('undefined_replace');\n      fireEvent.click(toggleReplaceBtn);\n    });\n\n    const replaceInput = queryByTestId('J_replaceValueInput');\n    fireEvent.inputChange(replaceInput, 'BBB');\n\n    const replaceBtn = queryByTestId('J_replaceAll');\n    fireEvent.click(replaceBtn);\n\n    await waitForTime(1000);\n    const matches = content.querySelectorAll('[data-cangjie-mark]');\n    expect(matches).toHaveLength(0);\n  });\n});\n"],"file":"ui.legacyToolbar.test.js"}