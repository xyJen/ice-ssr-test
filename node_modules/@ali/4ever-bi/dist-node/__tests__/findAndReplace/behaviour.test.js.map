{"version":3,"sources":["../../../../src/__tests__/findAndReplace/behaviour.test.tsx"],"names":["toggleFindAndReplace","updateFindText","replaceText","updateSearchResult","FindAndReplacePlugin","actions","createBiPlugins","biPlugins","findAndReplacePlugin","value","plugins","findAndReplace","locale","draggableArea","top","right","bottom","left","initialPosition","marginTop","marginRight","isFindOnly","role","array","describe","test","controller","Controller","create","run","expect","data","findAndReplaceVisible","toBe","searchResult","toHaveLength","firstMatch","selected","toBeTruthy"],"mappings":"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","sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\n/** @jsx jsx */\nimport { jsx, waitForTime } from '@ali/4ever-dev-test';\n\nimport {\n  createCustomizedBiPlugins,\n  FindAndReplacePlugin,\n  plugins as biPlugins,\n  locale_zh_CN as locale,\n} from '../..';\nimport { Value, Change, Controller, DocStyle } from '@ali/4ever-cangjie';\n\nconst {\n  toggleFindAndReplace,\n  updateFindText,\n  replaceText,\n  updateSearchResult,\n} = FindAndReplacePlugin.actions;\n\nconst createBiPlugins = createCustomizedBiPlugins({\n  ...biPlugins,\n  findAndReplacePlugin: FindAndReplacePlugin,\n});\n\nconst value = ((\n  <value>\n    <document>\n      <block type=\"paragraph\">\n        <text key=\"text1\">\n          <anchor />\n          AAA\n          <focus />\n        </text>\n      </block>\n      <block type=\"paragraph\">\n        <text key=\"text2\">AAA</text>\n      </block>\n      <block type=\"paragraph\">\n        <text key=\"text3\">AAA</text>\n      </block>\n    </document>\n  </value>\n) as unknown) as Value;\n\nconst plugins = createBiPlugins({\n  findAndReplace: {\n    locale: locale.findAndReplace as any,\n    draggableArea: {\n      top: 41,\n      right: 8,\n      bottom: 8,\n      left: 8,\n    },\n    initialPosition: {\n      marginTop: 0,\n      marginRight: 50,\n    },\n    isFindOnly: false,\n    role: '',\n  },\n}).array;\n\ndescribe('Bi/findAndReplace/behaviour', () => {\n  test('打开查找替换面板', async () => {\n    const controller = Controller.create({ plugins, value });\n    controller.run('onAction', toggleFindAndReplace(true));\n    expect(controller.value.data.findAndReplaceVisible).toBe(true);\n  });\n\n  test('查找', async () => {\n    const controller = Controller.create({ plugins, value });\n    controller.run('onAction', toggleFindAndReplace(true));\n    controller.run('onAction', updateFindText('AAA'));\n\n    await waitForTime(1);\n    expect(controller.value.data.searchResult).toHaveLength(3);\n  });\n\n  test('替换', async () => {\n    const controller = Controller.create({ plugins, value });\n    controller.run('onAction', toggleFindAndReplace(true));\n    controller.run('onAction', updateFindText('AAA'));\n\n    await waitForTime(1);\n    const firstMatch = controller.value.data.searchResult[0];\n    controller.run('onAction', replaceText(firstMatch, 'BBB'));\n\n    await waitForTime(1);\n    expect(controller.value.data.searchResult).toHaveLength(2);\n  });\n\n  test('选中一项', async () => {\n    const controller = Controller.create({ plugins, value });\n    controller.run('onAction', toggleFindAndReplace(true));\n    controller.run('onAction', updateFindText('AAA'));\n\n    await waitForTime(1);\n    const firstMatch = controller.value.data.searchResult[0];\n    controller.run('onAction', updateSearchResult(firstMatch));\n\n    expect(controller.value.data.searchResult[0].selected).toBeTruthy();\n  });\n\n  test('多次 render, 缓存正确', async () => {\n    const controller = Controller.create({ plugins, value });\n    controller.run('onAction', toggleFindAndReplace(true));\n    controller.run('onAction', updateFindText('AAA'));\n\n    await waitForTime(1);\n    expect(controller.value.data.searchResult).toHaveLength(3);\n    controller.run('onCangjieBlur');\n    expect(controller.value.data.searchResult).toHaveLength(3);\n  });\n});\n"],"file":"behaviour.test.js"}