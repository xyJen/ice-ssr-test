{"version":3,"sources":["../../../../src/__tests__/comment/ui.test.tsx"],"names":["mockComments","plugins","comment","CommentPlugin","defaultPlugins","locale","sendComment","req","content","contentId","replyId","Promise","resolve","push","id","date","author","setTimeout","getCommentList","filter","c","fetchComment","clickCommentButton","container","markButton","querySelector","fireEvent","click","describe","skip","it","value","controller","queryByTestId","addButton","expect","isFocused","toBe","mouseDown","mouseUp","input","window","document","change","target","send","command","Commands","moveToEndOfDocument","keyDown","toBeNull","paragraph","contextMenu"],"mappings":"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","sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\n/** @jsx jsx */\nimport {\n  renderEditor,\n  fireEvent,\n  jsx,\n  getHotkeyEvent,\n} from '@ali/4ever-dev-test';\nimport { Value, Controller, Commands } from '@ali/4ever-cangjie';\nimport {\n  wait,\n  waitFor,\n  waitForElement,\n  waitForElementToBeRemoved,\n} from '@testing-library/react';\n\nimport {\n  createCustomizedBiPlugins,\n  plugins as defaultPlugins,\n  locale_zh_CN as locale,\n  CommentPlugin,\n} from '../../';\nimport BiEditor from '../editor';\n\nimport {weWaitFor, weWaitForElement, weWaitForElementToBeRemoved} from '../helper';\n\nconst mockComments = [];\n\nconst plugins = createCustomizedBiPlugins({\n  comment: CommentPlugin,\n  ...defaultPlugins,\n})({\n  ...locale,\n  comment: {\n    sendComment: (req) => {\n      const { content, contentId, replyId } = req;\n      return new Promise((resolve) => {\n        mockComments.push({\n          id: '123',\n          date: '12-25',\n          author: '多鱼',\n          content,\n          contentId,\n          replyId,\n        });\n        setTimeout(() => {\n          resolve();\n        }, 100);\n      });\n    },\n    getCommentList: (contentId: string) => {\n      return new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(mockComments.filter((c) => c.contentId === contentId));\n        }, 0);\n      });\n    },\n    fetchComment: () => {\n      return new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(mockComments);\n        }, 0);\n      });\n    },\n  },\n});\n\nasync function clickCommentButton(container) {\n  const markButton = container.querySelector(\n    '[data-testid=\"button-bi-comment\"]',\n  );\n  fireEvent.click(markButton);\n  await wait();\n}\n\ndescribe.skip('Bi/comment/ui', () => {\n  it('基本添加', async () => {\n    const value = ((\n      <value>\n        <document>\n          <block type=\"paragraph\">\n            This <anchor />\n            is a paragraph\n            <focus /> ab\n          </block>\n        </document>\n      </value>\n    ) as unknown) as Value;\n    let controller: Controller | undefined;\n    const { queryByTestId, content } = await renderEditor(\n      <BiEditor\n        controllerRef={(c) => (controller = c)}\n        plugins={plugins}\n        defaultValue={value}\n      />,\n    );\n\n    /**\n     * 1. 添加按钮\n     */\n    const addButton = await weWaitForElement(() => queryByTestId('comment-add'));\n    expect(controller.value.isFocused).toBe(true);\n    fireEvent.mouseDown(addButton);\n    fireEvent.mouseUp(addButton);\n    await weWaitForElementToBeRemoved(() => queryByTestId('comment-add'));\n\n    /**\n     * 2. 输入文字\n     */\n    const input = await weWaitForElement(() => window.document.querySelector('[data-testid=\"comment-input\"]'));\n    expect(controller.value.isFocused).toBe(false);\n    fireEvent.change(input, {\n      target: {\n        value: 'new comment',\n      },\n    });\n\n    /**\n     * 3. 发送\n     */\n    const send = await waitForElement(() =>\n      window.document.querySelector('[data-testid=\"comment-send\"]'),\n    );\n    send.click();\n    await weWaitForElementToBeRemoved(() => window.document.querySelector('[data-testid=\"comment-send\"]'));\n\n    /**\n     * 4. 显示在列表中\n     */\n    await weWaitForElement(() => window.document.querySelector('[data-testid=\"comment-item\"]'));\n\n    /**\n     * 5. 移动高亮显示\n     */\n\n    await weWaitForElement(() => window.document.querySelector('[data-comment-active=\"true\"]'));\n    controller.command(Commands.moveToEndOfDocument);\n    fireEvent.keyDown(content, getHotkeyEvent('ArrowLeft'));\n    await weWaitFor(() => expect(window.document.querySelector('[data-comment-active=\"true\"]')).toBeNull());\n\n    expect(\n      window.document.querySelector('[data-comment-active=\"true\"]'),\n    ).toBeNull();\n    fireEvent.keyDown(content, getHotkeyEvent('ArrowLeft'));\n    fireEvent.keyDown(content, getHotkeyEvent('ArrowLeft'));\n    fireEvent.keyDown(content, getHotkeyEvent('ArrowLeft'));\n  });\n\n  it('光标模式添加', async () => {\n    const value = ((\n      <value>\n        <document>\n          <block type=\"paragraph\">\n            This <cursor />\n            is a paragraph\n          </block>\n        </document>\n      </value>\n    ) as unknown) as Value;\n    let controller: Controller | undefined;\n    const { queryByTestId, content } = await renderEditor(\n      <BiEditor\n        controllerRef={(c) => (controller = c)}\n        plugins={plugins}\n        defaultValue={value}\n      />,\n    );\n\n    /**\n     * 1. 添加按钮\n     */\n    const paragraph = content.querySelector('[data-cangjie-leaf]');\n    fireEvent.contextMenu(paragraph);\n    const addButton = await weWaitForElement(() => queryByTestId('menu-item-comment'));\n    fireEvent.click(addButton);\n    await weWaitForElementToBeRemoved(() => queryByTestId('menu-item-comment'));\n\n    /**\n     * 2. 输入文字\n     */\n    const input = await weWaitForElement(() => window.document.querySelector('[data-testid=\"comment-input\"]'));\n    expect(controller.value.isFocused).toBe(false);\n    fireEvent.change(input, {\n      target: {\n        value: 'new comment',\n      },\n    });\n\n    /**\n     * 3. 发送\n     */\n    const send = await waitForElement(() =>\n      window.document.querySelector('[data-testid=\"comment-send\"]'),\n    );\n    send.click();\n    await weWaitForElementToBeRemoved(() => window.document.querySelector('[data-testid=\"comment-send\"]'));\n\n    /**\n     * 4. 显示在列表中\n     */\n    await weWaitForElement(() => window.document.querySelector('[data-testid=\"comment-item\"]'));\n  });\n});\n"],"file":"ui.test.js"}