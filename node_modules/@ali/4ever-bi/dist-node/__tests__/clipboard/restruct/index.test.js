"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var fs = _interopRequireWildcard(require("fs"));

var path = _interopRequireWildcard(require("path"));

var _jestFileSnapshot = require("jest-file-snapshot");

var _everCangjie = require("@ali/4ever-cangjie");

var _everPluginClipboard = require("@ali/4ever-plugin-clipboard");

expect.extend({
  toMatchFile: _jestFileSnapshot.toMatchFile
});
describe('Restruct fragment between different plugins editor', () => {
  describe('Restruct fragment without models', () => {
    const fixturesPath = path.join(__dirname, 'fixtures');
    const fixtures = fs.readdirSync(fixturesPath);
    fixtures.forEach(fixture => {
      const fixturePath = path.join(fixturesPath, fixture);
      const inputPath = path.join(fixturePath, 'input.json');
      const outputPath = path.join(fixturePath, 'output.json');
      const modelPath = path.join(fixturePath, 'model.ts');
      let modelConfig;

      try {
        modelConfig = require(modelPath).default;
      } catch (error) {// do nothing;
      }

      const input = fs.readFileSync(inputPath).toString();

      const fragment = _everCangjie.Document.fromJSON(JSON.parse(input));

      const models = new Map([['mark_color', [{
        value: String
      }]], ['mark_sz', [{
        value: Number,
        szUnit: String
      }]], ['block_paragraph', [{
        data: {
          ind: [undefined, Object],
          spacing: [undefined, Object],
          list: Object
        }
      }, {
        data: {
          ind: [undefined, Object],
          spacing: [undefined, Object]
        }
      }]]]);

      if (modelConfig) {
        const [key, value] = modelConfig;
        models.set(key, value);
      }

      const fragmentRestructed = (0, _everPluginClipboard.restructFragment)(fragment, models);
      const fragmentStr = JSON.stringify(fragmentRestructed.toJSON(), null, 2);
      it(fixture, () => {
        expect(fragmentStr).toMatchFile(outputPath);
      });
    });
  });
});
//# sourceMappingURL=index.test.js.map