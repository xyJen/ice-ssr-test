{"version":3,"sources":["../../../../src/__tests__/link/blockLinkCard.ui.test.tsx"],"names":["createBiPlugins","link","linkPlugin","linkCard","linkCardPlugin","LOCALE","locale","createRangeDescriptor","Object","getOwnPropertyDescriptor","document","beforeAll","defineProperty","configurable","value","range","getClientRects","width","height","top","right","left","bottom","afterAll","createTextLink","text","href","prefix","suffix","createLinkCard","cardType","metadata","cardInfo","title","createPureLink","Editor","props","defaultValue","linkConfig","setValue","React","useState","plugins","useMemo","config","getLinkInfo","Promise","resolve","enableCard","hotkey","enableLinkCardBlock","protocolAllowList","handleChange","useCallback","changed","toolButtons","name","describe","openLink","jest","fn","spiedWindowOpen","spiedConsoleError","spyOn","console","mockImplementation","window","mockRestore","afterEach","mockReset","initValue","initValueWithSelection","test","queryByTestId","editor","queryByText","fireEvent","keyDown","linkEditor","textInput","hrefInput","button","save","click","inputChange","card","querySelector","expect","toBeTruthy","findByTestId","content","debug","toBeCalledWith","blankValue","container","mouseOver","switcher","switchCard","switchLink","HOTKEYS","deleteBackward","deleteForward"],"mappings":"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","sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\n/** @jsx jsx */\nimport '@testing-library/jest-dom/extend-expect';\nimport {\n  cleanup,\n  waitForElementToBeRemoved,\n  waitFor,\n  waitForElement,\n  queryByTestId,\n} from '@testing-library/react';\nimport {\n  renderEditor,\n  getHotkeyEvent,\n  jsx,\n  fireEvent,\n  HOTKEYS,\n} from '@ali/4ever-dev-test';\nimport { Value, transferUtils } from '@ali/4ever-cangjie';\nimport * as React from 'react';\nimport linkPlugin from '../../plugins/link';\nimport linkCardPlugin from '../../plugins/link/linkCard';\nimport { createCustomizedBiPlugins, Toolbar, Provider, Content } from '../..';\nimport { LinkPluginConfig } from '../../plugins/link/types';\nimport locale from '../../locales/zh_CN';\n\ninterface EditorProps {\n  defaultValue: Value;\n  linkConfig?: Partial<LinkPluginConfig>;\n}\n\nconst createBiPlugins = createCustomizedBiPlugins({\n  link: linkPlugin,\n  linkCard: linkCardPlugin,\n});\n\nconst LOCALE = locale.link.locale;\n\nconst createRangeDescriptor = Object.getOwnPropertyDescriptor(\n  document,\n  'createRange',\n);\n\nbeforeAll(() => {\n  Object.defineProperty(document, 'createRange', {\n    configurable: true,\n    value() {\n      const range = createRangeDescriptor ? createRangeDescriptor.value() : {};\n      return {\n        ...range,\n        getClientRects() {\n          return [\n            {\n              width: 100,\n              height: 60,\n              top: 100,\n              right: 200,\n              left: 200,\n              bottom: 400,\n            },\n          ];\n        },\n      };\n    },\n  });\n});\n\nafterAll(() => {\n  Object.defineProperty(\n    document,\n    'createRange',\n    createRangeDescriptor || {\n      value() {\n        return {};\n      },\n    },\n  );\n});\n\nconst createTextLink = (\n  text = 'DingTalk',\n  href = 'https://www.dingtalk.com',\n  prefix = ' ',\n  suffix = ' ',\n) => {\n  const value = ((\n    <value>\n      <document>\n        <block type=\"paragraph\">\n          {prefix}\n          <inline key=\"link\" type=\"link\" data={{ href }}>\n            {text}\n          </inline>\n          {suffix}\n          <cursor />\n        </block>\n      </document>\n    </value>\n  ) as unknown) as Value;\n  return value;\n};\n\nconst createLinkCard = (\n  text = 'DingTalk',\n  href = 'https://www.dingtalk.com',\n) => {\n  const value = ((\n    <value>\n      <document>\n        <block type=\"card\" data={{ cardType: 'link', height: 88, metadata: { href, text, cardInfo: {title:'test'} } }} />\n        <cursor />\n      </document>\n    </value>\n  ) as unknown) as Value;\n  return value;\n};\n\nconst createPureLink = (\n  href = 'https://www.dingtalk.com',\n  prefix = 'before',\n  suffix = 'after',\n) => {\n  const value = ((\n    <value>\n      <document>\n        <block type=\"paragraph\">\n          {`${prefix} ${href} ${suffix}`}\n          <cursor />\n        </block>\n      </document>\n    </value>\n  ) as unknown) as Value;\n  return value;\n};\n\nconst Editor: React.FC<EditorProps> = (props) => {\n  const { defaultValue, linkConfig = {} } = props;\n  const [value, setValue] = React.useState(defaultValue);\n\n  const plugins = React.useMemo(() => {\n    const config: LinkPluginConfig = {\n      getLinkInfo: () => Promise.resolve({}),\n      enableCard: true,\n      hotkey: 'mod+k',\n      locale: { ...LOCALE },\n      enableLinkCardBlock: true,\n      protocolAllowList: ['xxx:', 'http:', 'https:'],\n      ...linkConfig,\n    };\n\n    return createBiPlugins({\n      link: config,\n    });\n  }, [linkConfig]);\n\n  const handleChange = React.useCallback((changed) => {\n    setValue(changed.value);\n  }, []);\n\n  return (\n    <Provider plugins={plugins} value={value} onChange={handleChange} autoFocus>\n      <Toolbar\n        autoFolding={false}\n        singleLayout={[{ toolButtons: [{ name: 'link' }] }]}\n      />\n      <Content tabIndex={0} />\n    </Provider>\n  );\n};\n\ndescribe('bi/link/ui', () => {\n  const openLink = jest.fn();\n  let spiedWindowOpen: jest.SpyInstance;\n  let spiedConsoleError: jest.SpyInstance;\n\n  beforeAll(() => {\n    // 防止被 componentDidCatch catch 的 error 被控制台输出\n    spiedConsoleError = jest.spyOn(console, 'error');\n    spiedConsoleError.mockImplementation(() => { });\n    spiedWindowOpen = jest.spyOn(window, 'open');\n    spiedWindowOpen.mockImplementation(openLink);\n  });\n\n  afterAll(() => {\n    spiedConsoleError.mockRestore();\n    spiedWindowOpen.mockRestore();\n  });\n\n  afterEach(() => {\n    cleanup();\n    openLink.mockReset();\n  });\n\n  describe('插入链接', () => {\n    const initValue = ((\n      <value>\n        <document>\n          <block type=\"paragraph\" />\n        </document>\n      </value>\n    ) as unknown) as Value;\n    const initValueWithSelection = ((\n      <value>\n        <document>\n          <block type=\"paragraph\" >\n            12<anchor />34567<focus />890\n          </block>\n        </document>\n      </value>\n    ) as unknown) as Value;\n\n    test('快捷键插入空链接，保存为卡片', async () => {\n      const { queryByTestId, editor, queryByText } = await renderEditor(\n        <Editor defaultValue={initValue} />,\n      );\n      fireEvent.keyDown(editor as HTMLElement, getHotkeyEvent('mod+k'));\n      const linkEditor = await waitFor(() => queryByTestId('link-editor'));\n      const textInput = await waitFor(() => queryByTestId('link-editor-input-text'));\n      const hrefInput = await waitFor(() => queryByTestId('link-editor-input-href'));\n      const button = await waitFor(() => queryByText('卡片'));\n\n      const save = await waitFor(() => queryByTestId('link-editor-save'));\n\n      fireEvent.click(button);\n      fireEvent.inputChange(textInput!, '谷歌');\n      fireEvent.inputChange(hrefInput!, 'https://www.baidu.com');\n\n      fireEvent.click(save);\n      const card = waitFor(() => editor.querySelector('[data-testid=\"link\"][data-type=\"card\"]'));\n      expect(card).toBeTruthy();\n    });\n\n    test('点击链接后无 schema link，跳转页面', async () => {\n      const { findByTestId, content,debug } = await renderEditor(\n        <Editor defaultValue={createLinkCard('DingTalk',\n          'www.dingtalk.com')} />,\n      );\n      const card = await findByTestId('link-card');\n      const link = await waitFor(() => card.querySelector('.card-layout-title'));\n      fireEvent.click(link as HTMLElement);\n      expect(openLink).toBeCalledWith('http://www.dingtalk.com');\n    });\n\n  });\n\n  describe('链接转卡片', () => {\n    const blankValue = ((\n      <value>\n        <document>\n          <block type=\"paragraph\" />\n        </document>\n      </value>\n    ) as unknown) as Value;\n\n\n    test('textLink 切换到 block', async () => {\n      const { queryByTestId, debug, content, container, findByTestId } = await renderEditor(\n        <Editor defaultValue={createTextLink('DingTalk',\n          'https://www.dingtalk.com', 'aaa')} />,\n      );\n\n      const link = await waitFor(() => queryByTestId('link'));\n      fireEvent.mouseOver(link);\n      const switcher = await findByTestId('submenu-link-toolbar-switch');\n      fireEvent.click(switcher as HTMLElement);\n\n      const switchCard = await findByTestId('link-toolbar-switch-card');\n      fireEvent.click(switchCard);\n      const card = await findByTestId('link-card');\n\n      expect(card).toBeTruthy();\n\n    });\n\n    test('pureLink 切换到 block', async () => {\n      const { queryByTestId, findByTestId, content } = await renderEditor(\n        <Editor defaultValue={createPureLink('DingTalk',\n          'https://www.dingtalk.com', 'aaa')} />,\n      );\n      const link = await waitFor(() => queryByTestId('pure-link'));\n      fireEvent.mouseOver(link);\n      const switcher = await findByTestId('submenu-link-toolbar-switch');\n      fireEvent.click(switcher as HTMLElement);\n\n      const switchCard = await findByTestId('link-toolbar-switch-card');\n      fireEvent.click(switchCard);\n      const card = await findByTestId('link-card');\n\n      expect(card).toBeTruthy();\n    });\n\n    test('block 切换到 textLink', async () => {\n      const { queryByTestId, findByTestId, content } = await renderEditor(\n        <Editor defaultValue={createLinkCard('DingTalk',\n          'https://www.dingtalk.com')} />,\n      );\n\n      const card = await findByTestId('link-card');\n\n      fireEvent.mouseOver(card);\n      const switcher = await findByTestId('submenu-link-toolbar-switch');\n      fireEvent.click(switcher as HTMLElement);\n\n      const switchLink = await findByTestId('link-toolbar-switch-link');\n      fireEvent.click(switchLink);\n\n      await waitForElementToBeRemoved(() => content.querySelector('[data-testid=\"link\"][data-type=\"card\"]'));\n\n\n      const link = await waitFor(() => queryByTestId('link'));\n\n      expect(card).toBeTruthy();\n    });\n\n  });\n\n\n  describe('删除链接', () => {\n    test('向前删除', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"card\" data={{ cardType: 'link', height: 88, metadata: { href: 'http://www.baidu.com', text: 'dingtalk', cardInfo: {} } }} />\n            <cursor />\n          </document>\n        </value>\n      ) as unknown) as Value;\n\n      const { queryByTestId, editor } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n\n      await waitForElement(() => queryByTestId('link-card'));\n      // 第一次选中，第二次删除\n      fireEvent.keyDown(editor!, getHotkeyEvent(HOTKEYS.deleteBackward));\n      fireEvent.keyDown(editor!, getHotkeyEvent(HOTKEYS.deleteBackward));\n      await waitForElementToBeRemoved(() => queryByTestId('link-card'));\n    });\n\n    test('向后删除', async () => {\n      const value = ((\n        <value>\n          <document>\n            <cursor />\n            <block type=\"card\" data={{ cardType: 'link', height: 88, metadata: { href: 'http://www.baidu.com', text: 'DingTalk', cardInfo: {} } }} />\n          </document>\n        </value>\n      ) as unknown) as Value;\n\n      const { queryByTestId, editor } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n\n      await waitForElement(() => queryByTestId('link-card'));\n      // 第一次选中，第二次删除\n      fireEvent.keyDown(editor!, getHotkeyEvent(HOTKEYS.deleteForward));\n      fireEvent.keyDown(editor!, getHotkeyEvent(HOTKEYS.deleteForward));\n      await waitForElementToBeRemoved(() => queryByTestId('link-card'));\n    });\n  });\n});\n"],"file":"blockLinkCard.ui.test.js"}