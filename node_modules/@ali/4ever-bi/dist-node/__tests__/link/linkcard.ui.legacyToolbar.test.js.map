{"version":3,"sources":["../../../../src/__tests__/link/linkcard.ui.legacyToolbar.test.tsx"],"names":["createBiPlugins","link","linkPlugin","LOCALE","locale","createRangeDescriptor","Object","getOwnPropertyDescriptor","document","beforeAll","defineProperty","configurable","value","range","getClientRects","width","height","top","right","left","bottom","afterAll","createTextLink","text","href","prefix","suffix","createLinkCard","cardInfo","displayType","createPureLink","Editor","props","defaultValue","linkConfig","setValue","React","useState","plugins","useMemo","config","getLinkInfo","Promise","resolve","enableCard","hotkey","protocolAllowList","handleChange","useCallback","changed","toolButtons","name","describe","openLink","jest","fn","spiedWindowOpen","spiedConsoleError","spyOn","console","mockImplementation","window","mockRestore","afterEach","mockReset","initValue","initValueWithSelection","test","queryByTestId","editor","fireEvent","keyDown","linkEditor","activeElement","ownerDocument","expect","nodeName","toBe","container","linkButton","querySelector","click","textContent","addLinkPlaceholder","done","findByText","timeout","e","toBeInTheDocument","Mo","jsonMLToValue","src","opacity","outline","type","color","content","findByTestId","img","domUtils","getCaretDom","parentElement","hasAttribute","toBeFalsy","code","debug","toBeTruthy","blankValue","mouseDown","queryByText","mouseOver","cancelButton","not","mouseLeave","setData","copy","nativeEvent","clipboardData","preventDefault","fragment","transferUtils","decodeFragment","mock","calls","fragmentString","JSON","stringify","isContainsTitle","indexOf","toEqual","input","toHaveFocus","title","HOTKEYS","deleteBackward","deleteForward"],"mappings":";;;;;;AAEA;;AACA;;AAOA;;AAOA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;AAxBA;;AACA;AA8BA,MAAMA,eAAe,GAAG,iCAA0B;AAChDC,EAAAA,IAAI,EAAEC;AAD0C,CAA1B,CAAxB;AAIA,MAAMC,MAAM,GAAGC,eAAOH,IAAP,CAAYG,MAA3B;AAEA,MAAMC,qBAAqB,GAAGC,MAAM,CAACC,wBAAP,CAC5BC,QAD4B,EAE5B,aAF4B,CAA9B;AAKAC,SAAS,CAAC,MAAM;AACdH,EAAAA,MAAM,CAACI,cAAP,CAAsBF,QAAtB,EAAgC,aAAhC,EAA+C;AAC7CG,IAAAA,YAAY,EAAE,IAD+B;;AAE7CC,IAAAA,KAAK,GAAG;AACN,YAAMC,KAAK,GAAGR,qBAAqB,GAAGA,qBAAqB,CAACO,KAAtB,EAAH,GAAmC,EAAtE;AACA,aAAO,EACL,GAAGC,KADE;;AAELC,QAAAA,cAAc,GAAG;AACf,iBAAO,CACL;AACEC,YAAAA,KAAK,EAAE,GADT;AAEEC,YAAAA,MAAM,EAAE,EAFV;AAGEC,YAAAA,GAAG,EAAE,GAHP;AAIEC,YAAAA,KAAK,EAAE,GAJT;AAKEC,YAAAA,IAAI,EAAE,GALR;AAMEC,YAAAA,MAAM,EAAE;AANV,WADK,CAAP;AAUD;;AAbI,OAAP;AAeD;;AAnB4C,GAA/C;AAqBD,CAtBQ,CAAT;AAwBAC,QAAQ,CAAC,MAAM;AACbf,EAAAA,MAAM,CAACI,cAAP,CACEF,QADF,EAEE,aAFF,EAGEH,qBAAqB,IAAI;AACvBO,IAAAA,KAAK,GAAG;AACN,aAAO,EAAP;AACD;;AAHsB,GAH3B;AASD,CAVO,CAAR;;WA2BU,qC;;AAfV,MAAMU,cAAc,GAAG,CACrBC,IAAI,GAAG,UADc,EAErBC,IAAI,GAAG,0BAFc,EAGrBC,MAAM,GAAG,GAHY,EAIrBC,MAAM,GAAG,GAJY,KAKlB;AACH,QAAMd,KAAK,GACT,qCACE,wCACE;AAAO,IAAA,IAAI,EAAC;AAAZ,KACGa,MADH,EAEE;AAAQ,IAAA,GAAG,EAAC,MAAZ;AAAmB,IAAA,IAAI,EAAC,MAAxB;AAA+B,IAAA,IAAI,EAAE;AAAED,MAAAA;AAAF;AAArC,KACGD,IADH,CAFF,EAKGG,MALH,OADF,CADF,CADF;AAcA,SAAOd,KAAP;AACD,CArBD;;YAsCU,qC;;AAfV,MAAMe,cAAc,GAAG,CACrBJ,IAAI,GAAG,UADc,EAErBC,IAAI,GAAG,0BAFc,EAGrBC,MAAM,GAAG,GAHY,EAIrBC,MAAM,GAAG,GAJY,KAKlB;AACH,QAAMd,KAAK,GACT,qCACE,wCACE;AAAO,IAAA,IAAI,EAAC;AAAZ,KACGa,MADH,EAEE;AAAQ,IAAA,GAAG,EAAC,MAAZ;AAAmB,IAAA,IAAI,EAAC,MAAxB;AAA+B,IAAA,IAAI,EAAE;AAAED,MAAAA,IAAF;AAAQI,MAAAA,QAAQ,EAAE;AAAEC,QAAAA,WAAW,EAAE;AAAf;AAAlB;AAArC,KACGN,IADH,CAFF,EAKGG,MALH,QADF,CADF,CADF;AAcA,SAAOd,KAAP;AACD,CArBD;;YAiCU,qC;;AAVV,MAAMkB,cAAc,GAAG,CACrBN,IAAI,GAAG,0BADc,EAErBC,MAAM,GAAG,QAFY,EAGrBC,MAAM,GAAG,OAHY,KAIlB;AACH,QAAMd,KAAK,GACT,qCACE,wCACE;AAAO,IAAA,IAAI,EAAC;AAAZ,KACI,GAAEa,MAAO,IAAGD,IAAK,IAAGE,MAAO,EAD/B,QADF,CADF,CADF;AAUA,SAAOd,KAAP;AACD,CAhBD;;YA+CM,sBAAC,SAAD;AAAS,EAAA,QAAQ,EAAE;AAAnB,E;;AA7BN,MAAMmB,MAA6B,GAAIC,KAAD,IAAW;AAC/C,QAAM;AAAEC,IAAAA,YAAF;AAAgBC,IAAAA,UAAU,GAAG;AAA7B,MAAoCF,KAA1C;AACA,QAAM,CAACpB,KAAD,EAAQuB,QAAR,IAAoBC,KAAK,CAACC,QAAN,CAAeJ,YAAf,CAA1B;AAEA,QAAMK,OAAO,GAAGF,KAAK,CAACG,OAAN,CAAc,MAAM;AAClC,UAAMC,MAAwB,GAAG;AAC/BC,MAAAA,WAAW,EAAE,MAAMC,OAAO,CAACC,OAAR,CAAgB,EAAhB,CADY;AAE/BC,MAAAA,UAAU,EAAE,IAFmB;AAG/BC,MAAAA,MAAM,EAAE,OAHuB;AAI/BzC,MAAAA,MAAM,EAAED,MAJuB;AAK/B2C,MAAAA,iBAAiB,EAAE,CAAC,MAAD,EAAS,OAAT,EAAkB,QAAlB,CALY;AAM/B,SAAGZ;AAN4B,KAAjC;AASA,WAAOlC,eAAe,CAAC;AACrBC,MAAAA,IAAI,EAAEuC;AADe,KAAD,CAAtB;AAGD,GAbe,EAab,CAACN,UAAD,CAba,CAAhB;AAeA,QAAMa,YAAY,GAAGX,KAAK,CAACY,WAAN,CAAmBC,OAAD,IAAa;AAClDd,IAAAA,QAAQ,CAACc,OAAO,CAACrC,KAAT,CAAR;AACD,GAFoB,EAElB,EAFkB,CAArB;AAIA,SACE,sBAAC,UAAD;AAAU,IAAA,OAAO,EAAE0B,OAAnB;AAA4B,IAAA,KAAK,EAAE1B,KAAnC;AAA0C,IAAA,QAAQ,EAAEmC,YAApD;AAAkE,IAAA,SAAS;AAA3E,KACE,sBAAC,SAAD;AACE,IAAA,WAAW,EAAE,KADf;AAEE,IAAA,YAAY,EAAE,CAAC;AAAEG,MAAAA,WAAW,EAAE,CAAC;AAAEC,QAAAA,IAAI,EAAE;AAAR,OAAD;AAAf,KAAD;AAFhB,IADF,QADF;AASD,CAhCD;;YA2DM,qCACE,wCACE;AAAO,EAAA,IAAI,EAAC;AAAZ,EADF,CADF,C;;YAOA,qCACE,wCACE;AAAO,EAAA,IAAI,EAAC;AAAZ,SACI,qCADJ,WACmB,oCADnB,QADF,CADF,C;;aAyHU,qC;;aA8BA,qC;;aAgDF,qC;;aAOA,oC;;aAgBR,qCACE,wCACE;AAAO,EAAA,IAAI,EAAC;AAAZ,EADF,CADF,C;;aA8FU,qC;;aAEF,qC;;aAwCF,qC;;aAuCE,qC;;aAoBA,qC;;AAjcdC,QAAQ,CAAC,YAAD,EAAe,MAAM;AAC3B,QAAMC,QAAQ,GAAGC,IAAI,CAACC,EAAL,EAAjB;AACA,MAAIC,eAAJ;AACA,MAAIC,iBAAJ;AAEAhD,EAAAA,SAAS,CAAC,MAAM;AACd;AACAgD,IAAAA,iBAAiB,GAAGH,IAAI,CAACI,KAAL,CAAWC,OAAX,EAAoB,OAApB,CAApB;AACAF,IAAAA,iBAAiB,CAACG,kBAAlB,CAAqC,MAAM,CAAG,CAA9C;AACAJ,IAAAA,eAAe,GAAGF,IAAI,CAACI,KAAL,CAAWG,MAAX,EAAmB,MAAnB,CAAlB;AACAL,IAAAA,eAAe,CAACI,kBAAhB,CAAmCP,QAAnC;AACD,GANQ,CAAT;AAQAhC,EAAAA,QAAQ,CAAC,MAAM;AACboC,IAAAA,iBAAiB,CAACK,WAAlB;AACAN,IAAAA,eAAe,CAACM,WAAhB;AACD,GAHO,CAAR;AAKAC,EAAAA,SAAS,CAAC,MAAM;AACd;AACAV,IAAAA,QAAQ,CAACW,SAAT;AACD,GAHQ,CAAT;AAKAZ,EAAAA,QAAQ,CAAC,MAAD,EAAS,MAAM;AACrB,UAAMa,SAAS,QAAf;AAOA,UAAMC,sBAAsB,QAA5B;;AARqB,gBAoBjB,sBAAC,MAAD;AAAQ,MAAA,YAAY,EAAED;AAAtB,MApBiB;;AAkBrBE,IAAAA,IAAI,CAAC,4BAAD,EAA+B,YAAY;AAC7C,YAAM;AAAEC,QAAAA,aAAF;AAAiBC,QAAAA;AAAjB,UAA4B,MAAM,qCAAxC;;AAGAC,6BAAUC,OAAV,CAAkBF,MAAlB,EAAyC,iCAAe,OAAf,CAAzC;;AACA,YAAMG,UAAU,GAAG,MAAM,2BAAe,MAAMJ,aAAa,CAAC,aAAD,CAAlC,CAAzB,CAL6C,CAM7C;;AACA,YAAM;AAAEK,QAAAA;AAAF,UAAoBD,UAAU,CAACE,aAAX,IAA4B,EAAtD;AACAC,MAAAA,MAAM,CAACF,aAAa,IAAIA,aAAa,CAACG,QAAd,KAA2B,OAA5C,IAAuDH,aAAa,CAACtB,IAAd,KAAuB,MAA/E,CAAN,CAA6F0B,IAA7F,CAAkG,IAAlG;AACD,KATG,CAAJ;;AAlBqB,gBA+BjB,sBAAC,MAAD;AAAQ,MAAA,YAAY,EAAEZ;AAAtB,MA/BiB;;AA6BrBE,IAAAA,IAAI,CAAC,4BAAD,EAA+B,YAAY;AAC7C,YAAM;AAAEC,QAAAA,aAAF;AAAiBU,QAAAA;AAAjB,UAA+B,MAAM,qCAA3C;AAGA,YAAMC,UAAU,GAAGD,SAAS,CAACE,aAAV,CAAwB,uCAAxB,CAAnB;;AACAV,6BAAUW,KAAV,CAAgBF,UAAhB;;AACA,YAAMP,UAAU,GAAG,MAAM,2BAAe,MAAMJ,aAAa,CAAC,aAAD,CAAlC,CAAzB,CAN6C,CAO7C;;AACA,YAAM;AAAEK,QAAAA;AAAF,UAAoBD,UAAU,CAACE,aAAX,IAA4B,EAAtD;AACAC,MAAAA,MAAM,CAACF,aAAa,IAAIA,aAAa,CAACG,QAAd,KAA2B,OAA5C,IAAuDH,aAAa,CAACtB,IAAd,KAAuB,MAA/E,CAAN,CAA6F0B,IAA7F,CAAkG,IAAlG;AACD,KAVG,CAAJ;;AA7BqB,gBA2CjB,sBAAC,MAAD;AAAQ,MAAA,YAAY,EAAEZ;AAAtB,MA3CiB;;AAyCrBE,IAAAA,IAAI,CAAC,yBAAD,EAA4B,YAAY;AAC1C,YAAM;AAAEC,QAAAA,aAAF;AAAiBC,QAAAA;AAAjB,UAA4B,MAAM,qCAAxC;;AAGAC,6BAAUC,OAAV,CAAkBF,MAAlB,EAAyC,iCAAe,OAAf,CAAzC;;AACA,YAAMpE,IAAI,GAAG,MAAM,2BAAe,MAAMmE,aAAa,CAAC,MAAD,CAAlC,CAAnB;AACA,YAAM,2BAAe,MAAMA,aAAa,CAAC,aAAD,CAAlC,CAAN;;AACAE,6BAAUW,KAAV,CAAgBZ,MAAhB;;AACA,YAAM,2BAAe,MAAMD,aAAa,CAAC,aAAD,CAAlC,CAAN;AACA,YAAM;AAAEK,QAAAA;AAAF,UAAoBxE,IAAI,CAACyE,aAAL,IAAsB,EAAhD;AACAC,MAAAA,MAAM,CAACF,aAAa,IAAIA,aAAa,CAACG,QAAd,KAA2B,UAA7C,CAAN,CAA+DC,IAA/D,CAAoE,IAApE;AACD,KAXG,CAAJ;;AAzCqB,iBAwDjB,sBAAC,MAAD;AAAQ,MAAA,YAAY,EAAEZ;AAAtB,MAxDiB;;AAsDrBE,IAAAA,IAAI,CAAC,+BAAD,EAAkC,YAAY;AAChD,YAAM;AAAEC,QAAAA,aAAF;AAAiBC,QAAAA;AAAjB,UAA4B,MAAM,sCAAxC;;AAGAC,6BAAUC,OAAV,CAAkBF,MAAlB,EAAyC,iCAAe,OAAf,CAAzC;;AACA,YAAMpE,IAAI,GAAG,MAAM,2BAAe,MAAMmE,aAAa,CAAC,MAAD,CAAlC,CAAnB;AACA,YAAM,2BAAe,MAAMA,aAAa,CAAC,aAAD,CAAlC,CAAN;;AACAE,6BAAUW,KAAV,CAAgBhF,IAAhB;;AACA,YAAM,2BAAe,MAAMmE,aAAa,CAAC,aAAD,CAAlC,CAAN;AACA,YAAM;AAAEK,QAAAA;AAAF,UAAoBxE,IAAI,CAACyE,aAAL,IAAsB,EAAhD;AACAC,MAAAA,MAAM,CAACF,aAAa,IAAIA,aAAa,CAACG,QAAd,KAA2B,OAA5C,IAAuDH,aAAa,CAACtB,IAAd,KAAuB,MAA/E,CAAN,CAA6F0B,IAA7F,CAAkG,IAAlG;AACD,KAXG,CAAJ;;AAtDqB,iBAqEjB,sBAAC,MAAD;AAAQ,MAAA,YAAY,EAAEZ;AAAtB,MArEiB;;AAmErBE,IAAAA,IAAI,CAAC,SAAD,EAAY,YAAY;AAC1B,YAAM;AAAEC,QAAAA,aAAF;AAAiBC,QAAAA;AAAjB,UAA4B,MAAM,sCAAxC;;AAGAC,6BAAUC,OAAV,CAAkBF,MAAlB,EAAyC,iCAAe,OAAf,CAAzC;;AACA,YAAMpE,IAAI,GAAG,MAAM,2BAAe,MAAMmE,aAAa,CAAC,MAAD,CAAlC,CAAnB;AACAO,MAAAA,MAAM,CAAC1E,IAAI,EAAEiF,WAAP,CAAN,CAA0BL,IAA1B,CAA+B,QAA/B;AACD,KAPG,CAAJ;;AAnEqB,iBA8EjB,sBAAC,MAAD;AAAQ,MAAA,YAAY,EAAEX;AAAtB,MA9EiB;;AA4ErBC,IAAAA,IAAI,CAAC,iCAAD,EAAoC,YAAY;AAClD,YAAM;AAAEC,QAAAA,aAAF;AAAiBC,QAAAA;AAAjB,UAA4B,MAAM,sCAAxC;;AAGAC,6BAAUC,OAAV,CAAkBF,MAAlB,EAAyC,iCAAe,OAAf,CAAzC;;AACA,YAAMG,UAAU,GAAG,MAAM,2BAAe,MAAMJ,aAAa,CAAC,aAAD,CAAlC,CAAzB;AACA,YAAM;AAAEK,QAAAA;AAAF,UAAoBD,UAAU,CAACE,aAAX,IAA4B,EAAtD;AACAC,MAAAA,MAAM,CAACF,aAAa,IAAIA,aAAa,CAACG,QAAd,KAA2B,OAA5C,IAAuDH,aAAa,CAACtB,IAAd,KAAuB,MAA/E,CAAN,CAA6F0B,IAA7F,CAAkG,IAAlG;AACD,KARG,CAAJ;;AA5EqB,iBAwFjB,sBAAC,MAAD;AAAQ,MAAA,YAAY,EAAEZ;AAAtB,MAxFiB;;AAsFrBE,IAAAA,IAAI,CAAC,SAAD,EAAY,YAAY;AAC1B,YAAM;AAAEC,QAAAA,aAAF;AAAiBU,QAAAA;AAAjB,UAA+B,MAAM,sCAA3C;AAGA,YAAMC,UAAU,GAAGD,SAAS,CAACE,aAAV,CAAwB,uCAAxB,CAAnB;;AACAV,6BAAUW,KAAV,CAAgBF,UAAhB;;AACA,YAAM9E,IAAI,GAAG,MAAM,2BAAe,MAAMmE,aAAa,CAAC,MAAD,CAAlC,CAAnB;AACAO,MAAAA,MAAM,CAAC1E,IAAI,EAAEiF,WAAP,CAAN,CAA0BL,IAA1B,CAA+B,QAA/B;AACD,KARG,CAAJ;;AAtFqB,iBAiGjB,sBAAC,MAAD;AAAQ,MAAA,YAAY,EAAEX;AAAtB,MAjGiB;;AA+FrBC,IAAAA,IAAI,CAAC,iCAAD,EAAoC,YAAY;AAClD,YAAM;AAAEC,QAAAA,aAAF;AAAiBU,QAAAA;AAAjB,UAA+B,MAAM,sCAA3C;AAGA,YAAMC,UAAU,GAAGD,SAAS,CAACE,aAAV,CAAwB,uCAAxB,CAAnB;;AACAV,6BAAUW,KAAV,CAAgBF,UAAhB;;AACA,YAAMP,UAAU,GAAG,MAAM,2BAAe,MAAMJ,aAAa,CAAC,aAAD,CAAlC,CAAzB;AACA,YAAM;AAAEK,QAAAA;AAAF,UAAoBD,UAAU,CAACE,aAAX,IAA4B,EAAtD;AACAC,MAAAA,MAAM,CAACF,aAAa,IAAIA,aAAa,CAACG,QAAd,KAA2B,OAA5C,IAAuDH,aAAa,CAACtB,IAAd,KAAuB,MAA/E,CAAN,CAA6F0B,IAA7F,CAAkG,IAAlG;AACD,KATG,CAAJ;AAWAV,IAAAA,IAAI,CAAC,WAAD,EAAc,YAAY;AAC5B,YAAM;AAAEC,QAAAA,aAAF;AAAiBU,QAAAA;AAAjB,UAA+B,MAAM,+BACzC,sBAAC,MAAD;AACE,QAAA,YAAY,EAAEb,SADhB;AAEE,QAAA,UAAU,EAAE;AAAE7D,UAAAA,MAAM,EAAE,EAAE,GAAGD,MAAL;AAAagF,YAAAA,kBAAkB,EAAE;AAAjC;AAAV;AAFd,QADyC,CAA3C;AAMA,YAAMJ,UAAU,GAAGD,SAAS,CAACE,aAAV,CAAwB,uCAAxB,CAAnB;;AACAV,6BAAUW,KAAV,CAAgBF,UAAhB;;AACA,YAAM9E,IAAI,GAAG,MAAM,2BAAe,MAAMmE,aAAa,CAAC,MAAD,CAAlC,CAAnB;AACAO,MAAAA,MAAM,CAAC1E,IAAI,EAAEiF,WAAP,CAAN,CAA0BL,IAA1B,CAA+B,MAA/B;AACD,KAXG,CAAJ;AAaAV,IAAAA,IAAI,CAAC,aAAD,EAAgB,MAAOiB,IAAP,IAAgB;AAClC,YAAMxE,KAAK,GACT,qCACE,wCACE;AAAO,QAAA,IAAI,EAAC;AAAZ,SACE;AACE,QAAA,GAAG,EAAC,MADN;AAEE,QAAA,IAAI,EAAC,MAFP;AAGE,QAAA,IAAI,EAAE;AAAEY,UAAAA,IAAI,EAAE;AAAR;AAHR,gCADF,CADF,CADF,CADF;AAkBA,YAAM;AAAE6C,QAAAA,MAAF;AAAUgB,QAAAA;AAAV,UAAyB,MAAM,+BACnC,sBAAC,MAAD;AAAQ,QAAA,YAAY,EAAEzE;AAAtB,QADmC,CAArC;;AAGA0D,6BAAUC,OAAV,CAAkBF,MAAlB,EAAyC,iCAAe,OAAf,CAAzC;;AACA,UAAI;AACF,cAAMgB,UAAU,CAAC,YAAD,EAAe,EAAf,EAAmB;AAAEC,UAAAA,OAAO,EAAE;AAAX,SAAnB,CAAhB;AACD,OAFD,CAEE,OAAOC,CAAP,EAAU;AACVH,QAAAA,IAAI;AACL;AACF,KA5BG,CAAJ;AA8BAjB,IAAAA,IAAI,CAAC,+BAAD,EAAkC,YAAY;AAChD,YAAMvD,KAAK,GACT,qCACE,wCACE;AAAO,QAAA,IAAI,EAAC;AAAZ,SACE;AACE,QAAA,GAAG,EAAC,MADN;AAEE,QAAA,IAAI,EAAC,MAFP;AAGE,QAAA,IAAI,EAAE;AAAEY,UAAAA,IAAI,EAAE;AAAR;AAHR,gCADF,CADF,CADF,CADF;AAkBA,YAAM;AAAEsD,QAAAA;AAAF,UAAgB,MAAM,+BAAa,sBAAC,MAAD;AAAQ,QAAA,YAAY,EAAElE;AAAtB,QAAb,CAA5B;AACA,YAAMmE,UAAU,GAAGD,SAAS,CAACE,aAAV,CAAwB,mCAAxB,CAAnB,CApBgD,CAoBiC;;AACjFL,MAAAA,MAAM,CAACI,UAAD,CAAN,CAAmBS,iBAAnB;AACD,KAtBG,CAAJ;AAwBArB,IAAAA,IAAI,CAAC,2BAAD,EAA8B,YAAY;AAC5C,YAAMvD,KAAK,GAAG6E,oBAAGC,aAAH,CAAiB,CAC7B,MAD6B,EACrB,EADqB,EAE7B,CAAC,GAAD,EACE,CAAC,KAAD,EAAQ;AACNC,QAAAA,GAAG,EAAE,4EADC;AAEN5E,QAAAA,KAAK,EAAE,IAFD;AAGNC,QAAAA,MAAM,EAAE,IAHF;AAIN4E,QAAAA,OAAO,EAAE,GAJH;AAKNC,QAAAA,OAAO,EAAE;AACP9E,UAAAA,KAAK,EAAE,CADA;AAEP+E,UAAAA,IAAI,EAAE,OAFC;AAGPC,UAAAA,KAAK,EAAE;AAHA,SALH;AAUND,QAAAA,IAAI,EAAE;AAVA,OAAR,CADF,CAF6B,CAAjB,CAAd;;AAkBA,YAAM;AAAEhB,QAAAA,SAAF;AAAakB,QAAAA,OAAb;AAAsBC,QAAAA,YAAtB;AAAoC5B,QAAAA;AAApC,UAA+C,MAAM,+BAAa,sBAAC,gCAAD;AAAY,QAAA,YAAY,EAAEzD;AAA1B,QAAb,CAA3D;AACA,UAAIsF,GAAG,GAAGF,OAAO,CAAChB,aAAR,CAAsB,qBAAtB,CAAV;;AACAV,6BAAUC,OAAV,CAAkBF,MAAlB,EAA0B,iCAAe,WAAf,CAA1B;;AACA,YAAM8B,sBAASC,WAAT,CAAqBJ,OAArB,CAAN;AACA,YAAMjB,UAAU,GAAGD,SAAS,CACzBE,aADgB,CACF,4DADE,CAAnB;AAGAL,MAAAA,MAAM,CAACI,UAAU,CAACsB,aAAX,CAAyBC,YAAzB,CAAsC,UAAtC,CAAD,CAAN,CAA0DC,SAA1D;AACD,KA3BG,CAAJ;AA6BApC,IAAAA,IAAI,CAAC,4BAAD,EAA+B,YAAY;AAC7C,YAAMvD,KAAK,GACT,qCACE,wCACE;AAAO,QAAA,IAAI,EAAC;AAAZ,uBAGE;AACE,QAAA,IAAI,EAAC,OADP;AAEE,QAAA,IAAI,EAAE;AACJ4F,UAAAA,IAAI,EAAE;AADF;AAFR,QAHF,eADF,CADF,CADF;AAmBA,YAAM;AAAE1B,QAAAA,SAAF;AAAa2B,QAAAA,KAAb;AAAoBT,QAAAA;AAApB,UAAgC,MAAM,+BAAa,sBAAC,gCAAD;AAAY,QAAA,YAAY,EAAEpF;AAA1B,QAAb,CAA5C;AACA,YAAMmE,UAAU,GAAGD,SAAS,CACzBE,aADgB,CACF,4DADE,CAAnB;AAEAL,MAAAA,MAAM,CAACI,UAAU,CAACsB,aAAX,CAAyBC,YAAzB,CAAsC,UAAtC,CAAD,CAAN,CAA0DI,UAA1D;AACD,KAxBG,CAAJ;AAyBD,GAnOO,CAAR;AAqOAtD,EAAAA,QAAQ,CAAC,OAAD,EAAU,MAAM;AACtB,UAAMuD,UAAU,SAAhB;AAQAxC,IAAAA,IAAI,CAAC,aAAD,EAAgB,YAAY;AAC9B,YAAM;AAAEC,QAAAA;AAAF,UAAoB,MAAM,+BAC9B,sBAAC,MAAD;AAAQ,QAAA,YAAY,EAAE9C,cAAc;AAApC,QAD8B,CAAhC;AAGA,YAAMrB,IAAI,GAAG,MAAM,oBAAQ,MAAMmE,aAAa,CAAC,MAAD,CAA3B,CAAnB;;AACAE,6BAAUsC,SAAV,CAAoB3G,IAApB;;AACA,YAAM,oBAAQ,MAAMmE,aAAa,CAAC,cAAD,CAA3B,CAAN;AACD,KAPG,CAAJ;AASAD,IAAAA,IAAI,CAAC,0BAAD,EAA6B,YAAY;AAC3C,YAAM;AAAEC,QAAAA,aAAF;AAAiByC,QAAAA,WAAjB;AAA8Bb,QAAAA;AAA9B,UAA0C,MAAM,+BACpD,sBAAC,MAAD;AAAQ,QAAA,YAAY,EAAE1E,cAAc,CAAC,UAAD,EAClC,0BADkC,EACN,KADM;AAApC,QADoD,CAAtD;AAIA,YAAMrB,IAAI,GAAG,MAAM,oBAAQ,MAAMmE,aAAa,CAAC,MAAD,CAA3B,CAAnB;AACA,YAAM3C,MAAM,GAAG,MAAM,oBAAQ,MAAMoF,WAAW,CAAC,KAAD,CAAzB,CAArB;;AACAvC,6BAAUsC,SAAV,CAAoBnF,MAApB;;AACA6C,6BAAUwC,SAAV,CAAoB7G,IAApB;;AACA,YAAM,oBAAQ,MAAMmE,aAAa,CAAC,cAAD,CAA3B,CAAN;AACD,KAVG,CAAJ;;AAlBsB,iBAgClB,sBAAC,MAAD;AAAQ,MAAA,YAAY,EAAEuC;AAAtB,MAhCkB;;AA8BtBxC,IAAAA,IAAI,CAAC,aAAD,EAAgB,YAAY;AAC9B,YAAM;AAAEC,QAAAA,aAAF;AAAiBC,QAAAA;AAAjB,UAA4B,MAAM,sCAAxC;;AAGAC,6BAAUC,OAAV,CAAkBF,MAAlB,EAAyC,iCAAe,OAAf,CAAzC;;AACA,YAAM,oBAAQ,MAAMD,aAAa,CAAC,aAAD,CAA3B,CAAN;AACD,KANG,CAAJ;;AA9BsB,iBAwClB,sBAAC,MAAD;AAAQ,MAAA,YAAY,EAAEuC;AAAtB,MAxCkB;;AAsCtBxC,IAAAA,IAAI,CAAC,wBAAD,EAA2B,YAAY;AACzC,YAAM;AAAEC,QAAAA,aAAF;AAAiBC,QAAAA,MAAjB;AAAyBoC,QAAAA,KAAzB;AAAgCT,QAAAA;AAAhC,UAA4C,MAAM,sCAAxD;;AAIA1B,6BAAUC,OAAV,CAAkBF,MAAlB,EAAyC,iCAAe,OAAf,CAAzC;;AACA,YAAM,oBAAQ,MAAMD,aAAa,CAAC,aAAD,CAA3B,CAAN;AAEA,YAAM2C,YAAY,GAAG3C,aAAa,CAAC,oBAAD,CAAlC;;AACAE,6BAAUsC,SAAV,CAAoBG,YAApB,EATyC,CAUzC;;;AACA,YAAM,sCAA0B,MAAM3C,aAAa,CAAC,MAAD,CAA7C,CAAN;AACD,KAZG,CAAJ;AAcAD,IAAAA,IAAI,CAAC,kBAAD,EAAqB,YAAY;AACnC,YAAM;AAAEC,QAAAA;AAAF,UAAoB,MAAM,+BAC9B,sBAAC,MAAD;AAAQ,QAAA,YAAY,EAAE9C,cAAc;AAApC,QAD8B,CAAhC;AAGAqD,MAAAA,MAAM,CAACP,aAAa,CAAC,cAAD,CAAd,CAAN,CAAsC4C,GAAtC,CAA0CxB,iBAA1C;AACD,KALG,CAAJ;AAOArB,IAAAA,IAAI,CAAC,sBAAD,EAAyB,YAAY;AACvC,YAAM;AAAEC,QAAAA;AAAF,UAAoB,MAAM,+BAC9B,sBAAC,MAAD;AAAQ,QAAA,YAAY,EAAE9C,cAAc,CAAC,OAAD,EAAU,EAAV;AAApC,QAD8B,CAAhC;AAGA,YAAMrB,IAAI,GAAG,MAAM,oBAAQ,MAAMmE,aAAa,CAAC,MAAD,CAA3B,CAAnB;;AACAE,6BAAUsC,SAAV,CAAoB3G,IAApB;;AACA,YAAM,oBAAQ,MAAMmE,aAAa,CAAC,aAAD,CAA3B,CAAN;AACD,KAPG,CAAJ;AASAD,IAAAA,IAAI,CAAC,sBAAD,EAAyB,YAAY;AACvC,YAAM;AAAEC,QAAAA;AAAF,UAAoB,MAAM,+BAC9B,sBAAC,MAAD;AAAQ,QAAA,YAAY,EAAEtC,cAAc;AAApC,QAD8B,CAAhC;AAGA,YAAM7B,IAAI,GAAG,MAAM,oBAAQ,MAAMmE,aAAa,CAAC,WAAD,CAA3B,CAAnB;;AACAE,6BAAUsC,SAAV,CAAoB3G,IAApB;;AACA,YAAM,oBAAQ,MAAMmE,aAAa,CAAC,cAAD,CAA3B,CAAN;AACD,KAPG,CAAJ;AASAD,IAAAA,IAAI,CAAC,oCAAD,EAAuC,YAAY;AACrD,YAAM;AAAEC,QAAAA;AAAF,UAAoB,MAAM,+BAC9B,sBAAC,MAAD;AAAQ,QAAA,YAAY,EAAEtC,cAAc;AAApC,QAD8B,CAAhC;AAGA,YAAM7B,IAAI,GAAG,MAAM,oBAAQ,MAAMmE,aAAa,CAAC,WAAD,CAA3B,CAAnB;;AACAE,6BAAUsC,SAAV,CAAoB3G,IAApB;;AACA,YAAM,oBAAQ,MAAMmE,aAAa,CAAC,cAAD,CAA3B,CAAN;;AACAE,6BAAU2C,UAAV,CAAqBhH,IAArB;;AACA0E,MAAAA,MAAM,CAACP,aAAa,CAAC,cAAD,CAAd,CAAN,CAAsC4C,GAAtC,CAA0CxB,iBAA1C;AACD,KATG,CAAJ;AAWArB,IAAAA,IAAI,CAAC,kBAAD,EAAqB,YAAY;AAEnC,YAAMvD,KAAK,GACT,qCACE,wCACE;AAAO,QAAA,IAAI,EAAC;AAAZ,SACE;AAAQ,QAAA,GAAG,EAAC,MAAZ;AAAmB,QAAA,IAAI,EAAC,MAAxB;AAA+B,QAAA,IAAI,EAAE;AAAEY,UAAAA,IAAI,EAAE,sBAAR;AAAgCI,UAAAA,QAAQ,EAAE;AAAEC,YAAAA,WAAW,EAAE;AAAf;AAA1C;AAArC,SACG,UADH,SADF,SADF,CADF,CADF;AAcA,YAAM;AAAEuC,QAAAA,aAAF;AAAiBC,QAAAA;AAAjB,UAA4B,MAAM,+BACtC,sBAAC,MAAD;AAAQ,QAAA,YAAY,EAAEzD;AAAtB,QADsC,CAAxC;AAGA,YAAMsG,OAAO,GAAG5D,IAAI,CAACC,EAAL,EAAhB;AACA,YAAMtD,IAAI,GAAG,MAAM,oBAAQ,MAAMmE,aAAa,CAAC,WAAD,CAA3B,CAAnB;;AACAE,6BAAUW,KAAV,CAAgBhF,IAAhB;;AACAqE,6BAAU6C,IAAV,CAAe9C,MAAf,EAAuB;AACrB+C,QAAAA,WAAW,EAAE;AACXC,UAAAA,aAAa,EAAE;AACbH,YAAAA;AADa,WADJ;;AAIXI,UAAAA,cAAc,GAAG,CAAG;;AAJT;AADQ,OAAvB;;AAQA,YAAMC,QAAQ,GAAGC,2BAAcC,cAAd,CAA6BP,OAAO,CAACQ,IAAR,CAAaC,KAAb,CAAmB,CAAnB,EAAsB,CAAtB,CAA7B,CAAjB;;AACA,YAAMC,cAAc,GAAGC,IAAI,CAACC,SAAL,CAAeP,QAAf,CAAvB,CA/BmC,CAgCnC;;AACA,YAAMQ,eAAe,GAAGH,cAAc,CAACI,OAAf,CAAuB,UAAvB,IAAqC,CAA7D;AACArD,MAAAA,MAAM,CAACoD,eAAD,CAAN,CAAwBE,OAAxB,CAAgC,IAAhC;AACD,KAnCG,CAAJ;AAoCD,GA5HO,CAAR;AA8HA7E,EAAAA,QAAQ,CAAC,OAAD,EAAU,MAAM;AACtB,UAAMxC,KAAK,GACT,qCACE,wCACE;AAAO,MAAA,IAAI,EAAC;AAAZ,OACE;AACE,MAAA,GAAG,EAAC,MADN;AAEE,MAAA,IAAI,EAAC,MAFP;AAGE,MAAA,IAAI,EAAE;AAAEY,QAAAA,IAAI,EAAE;AAAR;AAHR,OAKGrB,MAAM,CAACgF,kBALV,CADF,SADF,CADF,CADF;;AADsB,iBAmBlB,sBAAC,MAAD;AAAQ,MAAA,YAAY,EAAEvE;AAAtB,MAnBkB;;AAiBtBuD,IAAAA,IAAI,CAAC,kCAAD,EAAqC,YAAY;AACnD,YAAM;AAAEC,QAAAA,aAAF;AAAiBC,QAAAA,MAAjB;AAAyBoC,QAAAA,KAAzB;AAAgC3B,QAAAA;AAAhC,UAA8C,MAAM,sCAA1D;;AAGAR,6BAAUC,OAAV,CAAkBF,MAAlB,EAAyC,iCAAe,WAAf,CAAzC;;AACA,YAAM,oBAAQ,MAAMD,aAAa,CAAC,aAAD,CAA3B,CAAN,CALmD,CAMnD;;AACA,UAAI8D,KAAK,GAAG,MAAM,oBAAQ,MAAM9D,aAAa,CAAC,wBAAD,CAA3B,CAAlB;AACAO,MAAAA,MAAM,CAACuD,KAAD,CAAN,CAAcC,WAAd,GARmD,CASnD;;AACA7D,6BAAUC,OAAV,CAAkBH,aAAa,CAAC,aAAD,CAA/B,EAA+D,iCAAe,KAAf,CAA/D,EAVmD,CAWnD;;;AACAE,6BAAUC,OAAV,CAAkBF,MAAlB,EAAyC,iCAAe,KAAf,CAAzC;;AACA,YAAM,sCAA0B,MAAMD,aAAa,CAAC,aAAD,CAA7C,CAAN,CAbmD,CAcnD;AACA;AACA;AACD,KAjBG,CAAJ;AAmBD,GApCO,CAAR;AAsCAhB,EAAAA,QAAQ,CAAC,MAAD,EAAS,MAAM;AACrBe,IAAAA,IAAI,CAAC,MAAD,EAAS,YAAY;AACvB,YAAMvD,KAAK,GACT,qCACE,wCACE;AAAO,QAAA,IAAI,EAAC;AAAZ,SACE;AACE,QAAA,GAAG,EAAC,MADN;AAEE,QAAA,IAAI,EAAC,MAFP;AAGE,QAAA,IAAI,EAAE;AAAEY,UAAAA,IAAI,EAAE,0BAAR;AAAoCI,UAAAA,QAAQ,EAAE;AAAEwG,YAAAA,KAAK,EAAE,OAAT;AAAkBvG,YAAAA,WAAW,EAAE;AAA/B;AAA9C;AAHR,oBADF,SADF,CADF,CADF;AAiBA,YAAM;AAAEuC,QAAAA,aAAF;AAAiBC,QAAAA;AAAjB,UAA4B,MAAM,+BACtC,sBAAC,MAAD;AAAQ,QAAA,YAAY,EAAEzD;AAAtB,QADsC,CAAxC;AAIA,YAAM,2BAAe,MAAMwD,aAAa,CAAC,WAAD,CAAlC,CAAN;;AACAE,6BAAUC,OAAV,CAAkBF,MAAlB,EAA2B,iCAAegE,qBAAQC,cAAvB,CAA3B;;AACA,YAAM,sCAA0B,MAAMlE,aAAa,CAAC,WAAD,CAA7C,CAAN;AACD,KAzBG,CAAJ;AA2BAD,IAAAA,IAAI,CAAC,MAAD,EAAS,YAAY;AACvB,YAAMvD,KAAK,GACT,qCACE,wCACE;AAAO,QAAA,IAAI,EAAC;AAAZ,iBAEE;AACE,QAAA,GAAG,EAAC,MADN;AAEE,QAAA,IAAI,EAAC,MAFP;AAGE,QAAA,IAAI,EAAE;AAAEY,UAAAA,IAAI,EAAE,0BAAR;AAAoCI,UAAAA,QAAQ,EAAE;AAAEwG,YAAAA,KAAK,EAAE,OAAT;AAAkBvG,YAAAA,WAAW,EAAE;AAA/B;AAA9C;AAHR,oBAFF,CADF,CADF,CADF;AAiBA,YAAM;AAAEuC,QAAAA,aAAF;AAAiBC,QAAAA;AAAjB,UAA4B,MAAM,+BACtC,sBAAC,MAAD;AAAQ,QAAA,YAAY,EAAEzD;AAAtB,QADsC,CAAxC;AAIA,YAAM,2BAAe,MAAMwD,aAAa,CAAC,WAAD,CAAlC,CAAN;;AACAE,6BAAUC,OAAV,CAAkBF,MAAlB,EAA2B,iCAAegE,qBAAQE,aAAvB,CAA3B;;AACA,YAAM,sCAA0B,MAAMnE,aAAa,CAAC,WAAD,CAA7C,CAAN;AACD,KAzBG,CAAJ;AA0BD,GAtDO,CAAR;AAuDD,CAvdO,CAAR","sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\n/** @jsx jsx */\nimport '@testing-library/jest-dom/extend-expect';\nimport {\n  cleanup,\n  waitForElementToBeRemoved,\n  waitFor,\n  waitForElement,\n  queryByTestId,\n} from '@testing-library/react';\nimport {\n  renderEditor,\n  getHotkeyEvent,\n  jsx,\n  fireEvent,\n  HOTKEYS,\n} from '@ali/4ever-dev-test';\nimport Mo from '../serializer';\nimport { Value, transferUtils, domUtils } from '@ali/4ever-cangjie';\nimport * as React from 'react';\nimport linkPlugin from '../../plugins/link';\nimport { createCustomizedBiPlugins, Toolbar, Provider, Content } from '../..';\nimport { LinkPluginConfig } from '../../plugins/link/types';\nimport locale from '../../locales/zh_CN';\nimport { EditorWidthLegacyToolbar as FullEditor } from '../editor';\n\ninterface EditorProps {\n  defaultValue: Value;\n  linkConfig?: Partial<LinkPluginConfig>;\n}\n\nconst createBiPlugins = createCustomizedBiPlugins({\n  link: linkPlugin,\n});\n\nconst LOCALE = locale.link.locale;\n\nconst createRangeDescriptor = Object.getOwnPropertyDescriptor(\n  document,\n  'createRange',\n);\n\nbeforeAll(() => {\n  Object.defineProperty(document, 'createRange', {\n    configurable: true,\n    value() {\n      const range = createRangeDescriptor ? createRangeDescriptor.value() : {};\n      return {\n        ...range,\n        getClientRects() {\n          return [\n            {\n              width: 100,\n              height: 60,\n              top: 100,\n              right: 200,\n              left: 200,\n              bottom: 400,\n            },\n          ];\n        },\n      };\n    },\n  });\n});\n\nafterAll(() => {\n  Object.defineProperty(\n    document,\n    'createRange',\n    createRangeDescriptor || {\n      value() {\n        return {};\n      },\n    },\n  );\n});\n\nconst createTextLink = (\n  text = 'DingTalk',\n  href = 'https://www.dingtalk.com',\n  prefix = ' ',\n  suffix = ' ',\n) => {\n  const value = ((\n    <value>\n      <document>\n        <block type=\"paragraph\">\n          {prefix}\n          <inline key=\"link\" type=\"link\" data={{ href }}>\n            {text}\n          </inline>\n          {suffix}\n          <cursor />\n        </block>\n      </document>\n    </value>\n  ) as unknown) as Value;\n  return value;\n};\n\nconst createLinkCard = (\n  text = 'DingTalk',\n  href = 'https://www.dingtalk.com',\n  prefix = ' ',\n  suffix = ' ',\n) => {\n  const value = ((\n    <value>\n      <document>\n        <block type=\"paragraph\">\n          {prefix}\n          <inline key=\"link\" type=\"link\" data={{ href, cardInfo: { displayType: 'card' } }}>\n            {text}\n          </inline>\n          {suffix}\n          <cursor />\n        </block>\n      </document>\n    </value>\n  ) as unknown) as Value;\n  return value;\n};\n\nconst createPureLink = (\n  href = 'https://www.dingtalk.com',\n  prefix = 'before',\n  suffix = 'after',\n) => {\n  const value = ((\n    <value>\n      <document>\n        <block type=\"paragraph\">\n          {`${prefix} ${href} ${suffix}`}\n          <cursor />\n        </block>\n      </document>\n    </value>\n  ) as unknown) as Value;\n  return value;\n};\n\nconst Editor: React.FC<EditorProps> = (props) => {\n  const { defaultValue, linkConfig = {} } = props;\n  const [value, setValue] = React.useState(defaultValue);\n\n  const plugins = React.useMemo(() => {\n    const config: LinkPluginConfig = {\n      getLinkInfo: () => Promise.resolve({}),\n      enableCard: true,\n      hotkey: 'mod+k',\n      locale: LOCALE,\n      protocolAllowList: ['xxx:', 'http:', 'https:'],\n      ...linkConfig,\n    };\n\n    return createBiPlugins({\n      link: config,\n    });\n  }, [linkConfig]);\n\n  const handleChange = React.useCallback((changed) => {\n    setValue(changed.value);\n  }, []);\n\n  return (\n    <Provider plugins={plugins} value={value} onChange={handleChange} autoFocus>\n      <Toolbar\n        autoFolding={false}\n        singleLayout={[{ toolButtons: [{ name: 'link' }] }]}\n      />\n      <Content tabIndex={0} />\n    </Provider>\n  );\n};\n\ndescribe('bi/link/ui', () => {\n  const openLink = jest.fn();\n  let spiedWindowOpen: jest.SpyInstance;\n  let spiedConsoleError: jest.SpyInstance;\n\n  beforeAll(() => {\n    // 防止被 componentDidCatch catch 的 error 被控制台输出\n    spiedConsoleError = jest.spyOn(console, 'error');\n    spiedConsoleError.mockImplementation(() => { });\n    spiedWindowOpen = jest.spyOn(window, 'open');\n    spiedWindowOpen.mockImplementation(openLink);\n  });\n\n  afterAll(() => {\n    spiedConsoleError.mockRestore();\n    spiedWindowOpen.mockRestore();\n  });\n\n  afterEach(() => {\n    cleanup();\n    openLink.mockReset();\n  });\n\n  describe('插入链接', () => {\n    const initValue = ((\n      <value>\n        <document>\n          <block type=\"paragraph\" />\n        </document>\n      </value>\n    ) as unknown) as Value;\n    const initValueWithSelection = ((\n      <value>\n        <document>\n          <block type=\"paragraph\" >\n            12<anchor />34567<focus />890\n          </block>\n        </document>\n      </value>\n    ) as unknown) as Value;\n\n    test('快捷键插入空链接后光标 focus 到「标题地址」中', async () => {\n      const { queryByTestId, editor } = await renderEditor(\n        <Editor defaultValue={initValue} />,\n      );\n      fireEvent.keyDown(editor as HTMLElement, getHotkeyEvent('mod+k'));\n      const linkEditor = await waitForElement(() => queryByTestId('link-editor'));\n      // 插入空链接时，光标应该在标题地址中\n      const { activeElement } = linkEditor.ownerDocument || {};\n      expect(activeElement && activeElement.nodeName === 'INPUT' && activeElement.name === 'text').toBe(true);\n    });\n\n    test('工具栏插入空链接后光标 focus 到「标题地址」中', async () => {\n      const { queryByTestId, container } = await renderEditor(\n        <Editor defaultValue={initValue} />,\n      );\n      const linkButton = container.querySelector('[data-testid=\"bi-toolbar-link\"] > div');\n      fireEvent.click(linkButton as HTMLElement);\n      const linkEditor = await waitForElement(() => queryByTestId('link-editor'));\n      // 插入空链接时，光标应该在标题地址中\n      const { activeElement } = linkEditor.ownerDocument || {};\n      expect(activeElement && activeElement.nodeName === 'INPUT' && activeElement.name === 'text').toBe(true);\n    });\n\n    test('首次插入空链接，再次点击编辑器，光标回归编辑器', async () => {\n      const { queryByTestId, editor } = await renderEditor(\n        <Editor defaultValue={initValue} />,\n      );\n      fireEvent.keyDown(editor as HTMLElement, getHotkeyEvent('mod+k'));\n      const link = await waitForElement(() => queryByTestId('link'));\n      await waitForElement(() => queryByTestId('link-editor'));\n      fireEvent.click(editor);\n      await waitForElement(() => queryByTestId('link-editor'));\n      const { activeElement } = link.ownerDocument || {};\n      expect(activeElement && activeElement.nodeName === 'TEXTAREA').toBe(true);\n    });\n\n    test('首次插入空链接，再次点击链接，focus 到「标题地址」中', async () => {\n      const { queryByTestId, editor } = await renderEditor(\n        <Editor defaultValue={initValue} />,\n      );\n      fireEvent.keyDown(editor as HTMLElement, getHotkeyEvent('mod+k'));\n      const link = await waitForElement(() => queryByTestId('link'));\n      await waitForElement(() => queryByTestId('link-editor'));\n      fireEvent.click(link);\n      await waitForElement(() => queryByTestId('link-editor'));\n      const { activeElement } = link.ownerDocument || {};\n      expect(activeElement && activeElement.nodeName === 'INPUT' && activeElement.name === 'text').toBe(true);\n    });\n\n    test('快捷键插入链接', async () => {\n      const { queryByTestId, editor } = await renderEditor(\n        <Editor defaultValue={initValue} />,\n      );\n      fireEvent.keyDown(editor as HTMLElement, getHotkeyEvent('mod+k'));\n      const link = await waitForElement(() => queryByTestId('link'));\n      expect(link?.textContent).toBe('添加网页链接');\n    });\n\n    test('有选区状态下快捷键插入链接，光标 focus 到「链接地址」中', async () => {\n      const { queryByTestId, editor } = await renderEditor(\n        <Editor defaultValue={initValueWithSelection} />,\n      );\n      fireEvent.keyDown(editor as HTMLElement, getHotkeyEvent('mod+k'));\n      const linkEditor = await waitForElement(() => queryByTestId('link-editor'));\n      const { activeElement } = linkEditor.ownerDocument || {};\n      expect(activeElement && activeElement.nodeName === 'INPUT' && activeElement.name === 'href').toBe(true);\n    });\n\n    test('工具栏插入链接', async () => {\n      const { queryByTestId, container } = await renderEditor(\n        <Editor defaultValue={initValue} />,\n      );\n      const linkButton = container.querySelector('[data-testid=\"bi-toolbar-link\"] > div');\n      fireEvent.click(linkButton as HTMLElement);\n      const link = await waitForElement(() => queryByTestId('link'));\n      expect(link?.textContent).toBe('添加网页链接');\n    });\n    test('有选区状态下工具栏插入链接，光标 focus 到「链接地址」中', async () => {\n      const { queryByTestId, container } = await renderEditor(\n        <Editor defaultValue={initValueWithSelection} />,\n      );\n      const linkButton = container.querySelector('[data-testid=\"bi-toolbar-link\"] > div');\n      fireEvent.click(linkButton as HTMLElement);\n      const linkEditor = await waitForElement(() => queryByTestId('link-editor'));\n      const { activeElement } = linkEditor.ownerDocument || {};\n      expect(activeElement && activeElement.nodeName === 'INPUT' && activeElement.name === 'href').toBe(true);\n    });\n\n    test('自定义预置链接文案', async () => {\n      const { queryByTestId, container } = await renderEditor(\n        <Editor\n          defaultValue={initValue}\n          linkConfig={{ locale: { ...LOCALE, addLinkPlaceholder: 'link' } }}\n        />,\n      );\n      const linkButton = container.querySelector('[data-testid=\"bi-toolbar-link\"] > div');\n      fireEvent.click(linkButton as HTMLElement);\n      const link = await waitForElement(() => queryByTestId('link'));\n      expect(link?.textContent).toBe('link');\n    });\n\n    test('不允许在链接中插入链接', async (done) => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              <inline\n                key=\"link\"\n                type=\"link\"\n                data={{ href: 'https://www.dingtalk.com' }}\n              >\n                Ding\n                <cursor />\n                Talk\n              </inline>\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n\n      const { editor, findByText } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      fireEvent.keyDown(editor as HTMLElement, getHotkeyEvent('mod+k'));\n      try {\n        await findByText(/Ding链接Talk/, {}, { timeout: 1000 });\n      } catch (e) {\n        done();\n      }\n    });\n\n    test('光标 focus 在链接中时，工具栏链接按钮展示为取消链接', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              <inline\n                key=\"link\"\n                type=\"link\"\n                data={{ href: 'https://www.dingtalk.com' }}\n              >\n                Ding\n                <cursor />\n                Talk\n              </inline>\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n\n      const { container } = await renderEditor(<Editor defaultValue={value} />);\n      const linkButton = container.querySelector('[data-testid=\"bi-toolbar-unlink\"]'); // TODO @淼淼 需要修改单测\n      expect(linkButton).toBeInTheDocument();\n    });\n\n    test('选中 image 时，工具栏链接按钮展示为正常链接', async () => {\n      const value = Mo.jsonMLToValue([\n        'root', {},\n        ['p',\n          ['img', {\n            src: 'https://cn.bing.com/az/hprichbg/rb/TeslaCoil_EN-CN1604235004_1920x1080.jpg',\n            width: 1920,\n            height: 1080,\n            opacity: 0.5,\n            outline: {\n              width: 1,\n              type: 'solid',\n              color: '#002060',\n            },\n            type: 'jpg',\n          }],\n        ],\n      ]);\n\n      const { container, content, findByTestId, editor } = await renderEditor(<FullEditor defaultValue={value} />);\n      let img = content.querySelector('[data-type=\"image\"]');\n      fireEvent.keyDown(editor, getHotkeyEvent('control+A'));\n      await domUtils.getCaretDom(content);\n      const linkButton = container\n        .querySelector('.icon-button-layout > [data-testid=\"bi-toolbar-link_wrap\"]');\n\n      expect(linkButton.parentElement.hasAttribute('disabled')).toBeFalsy();\n    });\n\n    test('选中其他 inline 时，工具栏链接按钮展示为禁用', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              11\n              <anchor />\n              <inline\n                type=\"emoji\"\n                data={{\n                  code: 'smile',\n                }}\n              />\n              <focus />\n              22\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n\n      const { container, debug, content } = await renderEditor(<FullEditor defaultValue={value} />);\n      const linkButton = container\n        .querySelector('.icon-button-layout > [data-testid=\"bi-toolbar-link_wrap\"]');\n      expect(linkButton.parentElement.hasAttribute('disabled')).toBeTruthy();\n    });\n  });\n\n  describe('链接工具栏', () => {\n    const blankValue = ((\n      <value>\n        <document>\n          <block type=\"paragraph\" />\n        </document>\n      </value>\n    ) as unknown) as Value;\n\n    test('点击链接后，弹出工具栏', async () => {\n      const { queryByTestId } = await renderEditor(\n        <Editor defaultValue={createTextLink()} />,\n      );\n      const link = await waitFor(() => queryByTestId('link'));\n      fireEvent.mouseDown(link as HTMLElement);\n      await waitFor(() => queryByTestId('link-toolbar'));\n    });\n\n    test('focus 文档时，hover 链接，弹出工具栏', async () => {\n      const { queryByTestId, queryByText, content } = await renderEditor(\n        <Editor defaultValue={createTextLink('DingTalk',\n          'https://www.dingtalk.com', 'aaa')} />,\n      );\n      const link = await waitFor(() => queryByTestId('link'));\n      const prefix = await waitFor(() => queryByText('aaa'));\n      fireEvent.mouseDown(prefix as HTMLElement);\n      fireEvent.mouseOver(link as HTMLElement);\n      await waitFor(() => queryByTestId('link-toolbar'));\n    });\n\n    test('创建链接时，弹出编辑框', async () => {\n      const { queryByTestId, editor } = await renderEditor(\n        <Editor defaultValue={blankValue} />,\n      );\n      fireEvent.keyDown(editor as HTMLElement, getHotkeyEvent('mod+k'));\n      await waitFor(() => queryByTestId('link-editor'));\n    });\n\n    test('插入占位链接，点击「取消链接」，空连接被删除', async () => {\n      const { queryByTestId, editor, debug, content } = await renderEditor(\n        <Editor defaultValue={blankValue} />,\n      );\n\n      fireEvent.keyDown(editor as HTMLElement, getHotkeyEvent('mod+k'));\n      await waitFor(() => queryByTestId('link-editor'));\n\n      const cancelButton = queryByTestId('link-editor-unlink');\n      fireEvent.mouseDown(cancelButton as HTMLElement);\n      // 空连接已删除\n      await waitForElementToBeRemoved(() => queryByTestId('link'));\n    });\n\n    test('扩展选区选中链接时，不弹出工具栏', async () => {\n      const { queryByTestId } = await renderEditor(\n        <Editor defaultValue={createTextLink()} />,\n      );\n      expect(queryByTestId('link-toolbar')).not.toBeInTheDocument();\n    });\n\n    test('点击链接后，若地址为空，则直接弹出编辑框', async () => {\n      const { queryByTestId } = await renderEditor(\n        <Editor defaultValue={createTextLink('baidu', '')} />,\n      );\n      const link = await waitFor(() => queryByTestId('link'));\n      fireEvent.mouseDown(link as HTMLElement);\n      await waitFor(() => queryByTestId('link-editor'));\n    });\n\n    test('点击 pure link 后，弹出工具栏', async () => {\n      const { queryByTestId } = await renderEditor(\n        <Editor defaultValue={createPureLink()} />,\n      );\n      const link = await waitFor(() => queryByTestId('pure-link'));\n      fireEvent.mouseDown(link as HTMLElement);\n      await waitFor(() => queryByTestId('link-toolbar'));\n    });\n\n    test('mouseleave，关闭 toolbar，并 focus 回编辑器', async () => {\n      const { queryByTestId } = await renderEditor(\n        <Editor defaultValue={createPureLink()} />,\n      );\n      const link = await waitFor(() => queryByTestId('pure-link'));\n      fireEvent.mouseDown(link as HTMLElement);\n      await waitFor(() => queryByTestId('link-toolbar'));\n      fireEvent.mouseLeave(link as HTMLElement);\n      expect(queryByTestId('link-toolbar')).not.toBeInTheDocument();\n    });\n\n    test('选中链接后复制，粘贴的卡片有标题', async () => {\n\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              <inline key=\"link\" type=\"link\" data={{ href: 'http://www.baidu.com', cardInfo: { displayType: 'card' } }}>\n                {'dingtalk'}\n                <anchor />\n              </inline>\n              <cursor />\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n\n      const { queryByTestId, editor } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      const setData = jest.fn();\n      const link = await waitFor(() => queryByTestId('link-card'));\n      fireEvent.click(link as HTMLElement);\n      fireEvent.copy(editor, {\n        nativeEvent: {\n          clipboardData: {\n            setData,\n          },\n          preventDefault() { },\n        },\n      });\n      const fragment = transferUtils.decodeFragment(setData.mock.calls[0][1])\n      const fragmentString = JSON.stringify(fragment);\n      // 从 fragment 的字符串中找到 text 节点的内容\n      const isContainsTitle = fragmentString.indexOf('dingtalk') > 0;\n      expect(isContainsTitle).toEqual(true);\n    });\n  });\n\n  describe('链接占位符', () => {\n    const value = ((\n      <value>\n        <document>\n          <block type=\"paragraph\">\n            <inline\n              key=\"link\"\n              type=\"link\"\n              data={{ href: '' }}\n            >\n              {LOCALE.addLinkPlaceholder}\n            </inline>\n            <cursor />\n          </block>\n        </document>\n      </value>\n    ) as unknown) as Value;\n    test('移动光标进入链接占位符，弹出编辑框；点击 esc，光标移出占位符', async () => {\n      const { queryByTestId, editor, debug, container } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n      fireEvent.keyDown(editor as HTMLElement, getHotkeyEvent('arrowleft'));\n      await waitFor(() => queryByTestId('link-editor'));\n      // 插入空链接时，光标应该在标题地址中\n      let input = await waitFor(() => queryByTestId('link-editor-input-text'));\n      expect(input).toHaveFocus();\n      // 第一次 esc 输入框失去光标\n      fireEvent.keyDown(queryByTestId('link-editor') as HTMLElement, getHotkeyEvent('esc'));\n      // 第二次 esc 编辑框消失\n      fireEvent.keyDown(editor as HTMLElement, getHotkeyEvent('esc'));\n      await waitForElementToBeRemoved(() => queryByTestId('link-editor'));\n      // 选区渲染不在 node 中了，所以无需再 check\n      // await waitFor(() => queryByTestId('cangjie-caret'));\n      // expect(container.querySelector('[data-testid=\"link\"] [data-testid=\"cangjie-caret\"]')).toBeNull();\n    });\n\n  });\n\n  describe('删除链接', () => {\n    test('向前删除', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              <inline\n                key=\"link\"\n                type=\"link\"\n                data={{ href: 'https://www.dingtalk/com', cardInfo: { title: 'baidu', displayType: 'card' } }}\n              >\n                DingTalk\n              </inline>\n              <cursor />\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n\n      const { queryByTestId, editor } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n\n      await waitForElement(() => queryByTestId('link-card'));\n      fireEvent.keyDown(editor!, getHotkeyEvent(HOTKEYS.deleteBackward));\n      await waitForElementToBeRemoved(() => queryByTestId('link-card'));\n    });\n\n    test('向后删除', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"paragraph\">\n              <cursor />\n              <inline\n                key=\"link\"\n                type=\"link\"\n                data={{ href: 'https://www.dingtalk/com', cardInfo: { title: 'baidu', displayType: 'card' } }}\n              >\n                DingTalk\n              </inline>\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n\n      const { queryByTestId, editor } = await renderEditor(\n        <Editor defaultValue={value} />,\n      );\n\n      await waitForElement(() => queryByTestId('link-card'));\n      fireEvent.keyDown(editor!, getHotkeyEvent(HOTKEYS.deleteForward));\n      await waitForElementToBeRemoved(() => queryByTestId('link-card'));\n    });\n  });\n});\n"],"file":"linkcard.ui.legacyToolbar.test.js"}