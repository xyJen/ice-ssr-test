"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _everCangjie = require("@ali/4ever-cangjie");

var _everDevTest = require("@ali/4ever-dev-test");

var _createBiPlugins = _interopRequireDefault(require("../../createBiPlugins"));

var _everPluginList = require("@ali/4ever-plugin-list");

/** @jsx jsx */
const {
  continueNumbering
} = _everPluginList.OldActions;
const {
  MIME_TYPES
} = _everCangjie.constants;
const {
  encodeFragment
} = _everCangjie.transferUtils;
const plugins = (0, _createBiPlugins.default)().array;
const OL_LIST_DATA_1 = {
  ind: {
    left: 0
  },
  list: {
    listId: 'sgdg3hhcv1f',
    level: 0,
    isOrdered: true,
    isTaskList: false,
    listStyle: {
      format: 'decimal',
      text: '%1.',
      align: 'left'
    },
    hideSymbol: false,
    symbolStyle: {},
    listStyleType: 'DEC_LEN_LROM_P'
  }
};
const OL_LIST_DATA_2 = {
  ind: {
    left: 0
  },
  list: {
    listId: 'dn7ncrq6m7j',
    level: 0,
    isOrdered: true,
    isTaskList: false,
    listStyle: {
      format: 'decimal',
      text: '%1.',
      align: 'left'
    },
    hideSymbol: false,
    symbolStyle: {},
    listStyleType: 'DEC_LEN_LROM_P'
  }
};
const UL_LIST_DATA_1 = {
  ind: {
    left: 0
  },
  list: {
    listId: 'bzbrc33hgd',
    level: 0,
    isOrdered: false,
    isTaskList: false,
    listStyle: {
      format: 'bullet',
      text: '\u25cf',
      align: 'left'
    },
    hideSymbol: false,
    symbolStyle: {},
    listStyleType: 'SCIR_ECIR_SREC'
  }
};

var _ref = (0, _everDevTest.jsx)("value", null, (0, _everDevTest.jsx)("document", null, (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: OL_LIST_DATA_1
}, "\u6709\u5E8F\u5217\u88681"), (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: OL_LIST_DATA_1
}, "\u6709\u5E8F\u5217\u88681"), (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: UL_LIST_DATA_1
}, "\u65E0\u5E8F\u5217\u88681"), (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: UL_LIST_DATA_1
}, "\u65E0\u5E8F\u5217\u88681"), (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: OL_LIST_DATA_2
}, (0, _everDevTest.jsx)("cursor", null), "\u6709\u5E8F\u5217\u88682")));

var _ref2 = (0, _everDevTest.jsx)("value", null, (0, _everDevTest.jsx)("document", null, (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: OL_LIST_DATA_1
}, "\u6709\u5E8F\u5217\u88681"), (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: OL_LIST_DATA_1
}, "\u6709\u5E8F\u5217\u88681"), (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: UL_LIST_DATA_1
}, "\u65E0\u5E8F\u5217\u88681"), (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: UL_LIST_DATA_1
}, "\u65E0\u5E8F\u5217\u88681"), (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: OL_LIST_DATA_1
}, (0, _everDevTest.jsx)("cursor", null), "\u6709\u5E8F\u5217\u88682")));

var _ref3 = (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: OL_LIST_DATA_1
}, (0, _everDevTest.jsx)("cursor", null), "\u666E\u901A\u6BB5\u843D");

var _ref4 = (0, _everDevTest.jsx)("block", {
  type: "paragraph"
}, "4. ", (0, _everDevTest.jsx)("cursor", null), "\u666E\u901A\u6BB5\u843D");

var _ref7 = (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: OL_LIST_DATA_1
}, "\u6709\u5E8F\u5217\u88681");

var _ref8 = (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: OL_LIST_DATA_1
}, "\u6709\u5E8F\u5217\u88681");

var _ref9 = (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: UL_LIST_DATA_1
}, "\u65E0\u5E8F\u5217\u88681");

var _ref10 = (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: UL_LIST_DATA_1
}, "\u65E0\u5E8F\u5217\u88681");

var _ref11 = (0, _everDevTest.jsx)("cursor", null);

var _ref12 = (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: OL_LIST_DATA_1
}, "\u6709\u5E8F\u5217\u88681");

var _ref13 = (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: OL_LIST_DATA_1
}, "\u6709\u5E8F\u5217\u88681");

var _ref14 = (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: UL_LIST_DATA_1
}, "\u65E0\u5E8F\u5217\u88681");

var _ref15 = (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: UL_LIST_DATA_1
}, "\u65E0\u5E8F\u5217\u88681");

var _ref16 = (0, _everDevTest.jsx)("value", null, (0, _everDevTest.jsx)("document", null, (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: OL_LIST_DATA_1
}, "\u6709\u5E8F\u5217\u88681"), (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: OL_LIST_DATA_1
}, "\u6709\u5E8F\u5217\u88681"), (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: UL_LIST_DATA_1
}, "\u65E0\u5E8F\u5217\u88681"), (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: UL_LIST_DATA_1
}, "\u65E0\u5E8F\u5217\u88681"), (0, _everDevTest.jsx)("block", {
  type: "paragraph"
}, (0, _everDevTest.jsx)("cursor", null))));

var _ref17 = (0, _everDevTest.jsx)("value", null, (0, _everDevTest.jsx)("document", null, (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: OL_LIST_DATA_1
}, "\u6709\u5E8F\u5217\u88681"), (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: OL_LIST_DATA_1
}, "\u6709\u5E8F\u5217\u88681"), (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: UL_LIST_DATA_1
}, "\u65E0\u5E8F\u5217\u88681"), (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: UL_LIST_DATA_1
}, "\u65E0\u5E8F\u5217\u88681"), (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: OL_LIST_DATA_1
}, "\u6709\u5E8F\u5217\u88681")));

var _ref18 = (0, _everDevTest.jsx)("document", null, (0, _everDevTest.jsx)("block", {
  type: "paragraph",
  data: OL_LIST_DATA_1
}, "\u6709\u5E8F\u5217\u88681"));

var _ref19 = (0, _everDevTest.jsx)("value", null, (0, _everDevTest.jsx)("document", null, (0, _everDevTest.jsx)("block", {
  type: "paragraph"
}, (0, _everDevTest.jsx)("cursor", null), "1.\u6709\u5E8F\u5217\u8868")));

var _ref20 = (0, _everDevTest.jsx)("value", null, (0, _everDevTest.jsx)("document", null, (0, _everDevTest.jsx)("block", {
  type: "paragraph"
}), (0, _everDevTest.jsx)("block", {
  type: "paragraph"
}, "1.\u6709\u5E8F\u5217\u8868")));

describe('list', () => {
  it('跨无序列表, 继续编号, 自动连接到最近的有序列表', async () => {
    const value = _ref;
    const output = _ref2;

    const controller = _everCangjie.Controller.create({
      value,
      plugins
    });

    controller.run('onAction', continueNumbering());
    await (0, _everDevTest.waitForTime)(1);
    const actual = controller.value.toJSON();
    const expected = controller.setValue(output).value.toJSON();
    expect(actual).toEqual(expected);
  });
  [{
    title: '跨无序列表, 输入 "3 + . ", 序号连接上则自动转为 listId 相同的有序列表',
    content: '3.',
    result: _ref3
  }, {
    title: '跨无序列表, 输入 "4 + . ", 序号连接不上则保持普通段落',
    content: '4.',
    result: _ref4
  }].forEach(({
    title,
    content,
    result
  }) => {
    var _ref6 = (0, _everDevTest.jsx)("value", null, (0, _everDevTest.jsx)("document", null, _ref12, _ref13, _ref14, _ref15, result));

    var _ref5 = (0, _everDevTest.jsx)("value", null, (0, _everDevTest.jsx)("document", null, _ref7, _ref8, _ref9, _ref10, (0, _everDevTest.jsx)("block", {
      type: "paragraph"
    }, content, _ref11, "\u666E\u901A\u6BB5\u843D")));

    it(title, async () => {
      const value = _ref5;
      const output = _ref6;

      const controller = _everCangjie.Controller.create({
        value,
        plugins
      });

      controller.run('onCangjieInput', (0, _everCangjie.CangjieInputEvent)({
        type: 'insertText',
        data: ' '
      }));
      await (0, _everDevTest.waitForTime)(1);
      const actual = controller.value.toJSON();
      const expected = controller.setValue(output).value.toJSON();
      expect(actual).toEqual(expected);
    });
  });
  it('跨无序列表, 粘贴有序列表 listId 保持不变', async () => {
    const value = _ref16;
    const output = _ref17;
    const fragment = _ref18;
    const clipboardData = {
      [MIME_TYPES.FRAGMENT]: encodeFragment(fragment)
    };
    const event = (0, _everCangjie.CangjieClipboardEvent)('cangjiePaste', {
      clipboardData: {
        items: [// @ts-ignore
        {
          type: MIME_TYPES.FRAGMENT
        }],
        types: [MIME_TYPES.FRAGMENT],
        data: clipboardData,
        getData: format => {
          return clipboardData[format];
        }
      }
    });

    const controller = _everCangjie.Controller.create({
      value,
      plugins
    });

    controller.run('onCangjiePaste', event);
    await (0, _everDevTest.waitForTime)(1);
    const actual = controller.value.toJSON();
    const expected = controller.setValue(output).value.toJSON();
    expect(actual).toEqual(expected);
  });
  it('在 1.xxx 内容开始位置回车，不生成列表', async () => {
    const value = _ref19;
    const output = _ref20;

    const controller = _everCangjie.Controller.create({
      value,
      plugins
    });

    controller.run('onKeyDown', new KeyboardEvent('keydown', (0, _everDevTest.getHotkeyEvent)('enter')));
    const actual = controller.value.toJSON();
    const expected = controller.setValue(output).value.toJSON();
    expect(actual).toEqual(expected);
  });
});
//# sourceMappingURL=numbering.test.js.map