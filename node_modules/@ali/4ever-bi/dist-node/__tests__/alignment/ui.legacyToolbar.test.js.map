{"version":3,"sources":["../../../../src/__tests__/alignment/ui.legacyToolbar.test.tsx"],"names":["createValue","text","cursor","describe","title","type","hotKey","forEach","it","container","content","queryByTestId","toolButtons","name","trigger","querySelector","fireEvent","click","btn","para","expect","style","textAlign","toBe","editor","keyDown","textContent","value","mock","onChange","jest","fn","receiveValue","calls","startBlock","data","toEqual","jc","textAlignLast"],"mappings":";;AAEA;;AACA;;AAIA;;AAEA;;AACA;;AAVA;;AACA;WAqBgC,qC;;YAEF,qC;;AAZ9B;AACA;AACA;AACA;AACA;AACA,SAASA,WAAT,CAAqBC,IAArB,EAAmCC,MAAuB,GAAG,OAA7D,EAAsE;AACpE,SACE,qCACE,wCACE;AAAO,IAAA,IAAI,EAAC;AAAZ,KACGA,MAAM,KAAK,OAAX,UAAkC,IADrC,EAEGD,IAFH,EAGGC,MAAM,KAAK,KAAX,WAAgC,IAHnC,CADF,CADF,CADF;AAWD;;YAqGW,qC;;AAnGZC,QAAQ,CAAC,iBAAD,EAAoB,MAAM;AAChC,GAAC;AACCC,IAAAA,KAAK,EAAE,IADR;AAECC,IAAAA,IAAI,EAAE,QAFP;AAGCC,IAAAA,MAAM,EAAE;AAHT,GAAD,EAIG;AACDF,IAAAA,KAAK,EAAE,IADN;AAEDC,IAAAA,IAAI,EAAE,OAFL;AAGDC,IAAAA,MAAM,EAAE;AAHP,GAJH,EAQG;AACDF,IAAAA,KAAK,EAAE,IADN;AAEDC,IAAAA,IAAI,EAAE,SAFL;AAGDC,IAAAA,MAAM,EAAE;AAHP,GARH,EAYGC,OAZH,CAYW,CAAC;AAAEH,IAAAA,KAAF;AAASC,IAAAA,IAAT;AAAeC,IAAAA;AAAf,GAAD,KAA6B;AACtCE,IAAAA,EAAE,CAAE,SAAQJ,KAAM,EAAhB,EAAmB,YAAY;AAC/B,YAAM;AAAEK,QAAAA,SAAF;AAAaC,QAAAA,OAAb;AAAsBC,QAAAA;AAAtB,UAAwC,MAAM,+BAClD,sBAAC,gCAAD;AACE,QAAA,YAAY,EAAEX,WAAW,CAAC,OAAD,CAD3B;AAEE,QAAA,YAAY,EAAE,CAAC;AAAEY,UAAAA,WAAW,EAAE,CAAC;AAAEC,YAAAA,IAAI,EAAE;AAAR,WAAD;AAAf,SAAD;AAFhB,QADkD,CAApD,CAD+B,CAQ/B;;AACA,YAAMC,OAAO,GAAGL,SAAS,CAACM,aAAV,CAAwB,mDAAxB,CAAhB;;AACAC,6BAAUC,KAAV,CAAgBH,OAAhB,EAV+B,CAY/B;;;AACA,YAAMI,GAAG,GAAG,MAAM,2BAAe,MAAMP,aAAa,CAAE,UAASN,IAAK,EAAhB,CAAlC,CAAlB;;AACAW,6BAAUC,KAAV,CAAgBC,GAAhB,EAd+B,CAgB/B;;;AACA,YAAM,kBAAN;AACA,YAAMC,IAAI,GAAGT,OAAO,CAACK,aAAR,CAAsB,yBAAtB,CAAb;AACAK,MAAAA,MAAM,CAACD,IAAI,CAACE,KAAL,CAAWC,SAAZ,CAAN,CAA6BC,IAA7B,CAAkClB,IAAlC;AACD,KApBC,CAAF;AAsBAG,IAAAA,EAAE,CAAE,kBAAiBJ,KAAM,EAAzB,EAA4B,YAAY;AACxC,YAAM;AAAEK,QAAAA,SAAF;AAAae,QAAAA,MAAb;AAAqBd,QAAAA,OAArB;AAA8BC,QAAAA;AAA9B,UAAgD,MAAM,+BAC1D,sBAAC,gCAAD;AACE,QAAA,YAAY,EAAEX,WAAW,CAAC,OAAD,CAD3B;AAEE,QAAA,YAAY,EAAE,CAAC;AAAEY,UAAAA,WAAW,EAAE,CAAC;AAAEC,YAAAA,IAAI,EAAE;AAAR,WAAD;AAAf,SAAD;AAFhB,QAD0D,CAA5D,CADwC,CAQxC;;AACA,YAAMC,OAAO,GAAGL,SAAS,CAACM,aAAV,CAAwB,mDAAxB,CAAhB;;AACAC,6BAAUC,KAAV,CAAgBH,OAAhB,EAVwC,CAYxC;;;AACA,YAAMI,GAAG,GAAG,MAAM,2BAAe,MAAMP,aAAa,CAAE,UAASN,IAAK,EAAhB,CAAlC,CAAlB;;AACAW,6BAAUC,KAAV,CAAgBC,GAAhB,EAdwC,CAgBxC;;;AACA,YAAM,kBAAN,CAjBwC,CAmBxC;;AACAF,6BAAUS,OAAV,CAAkBD,MAAlB,EAA0B,iCAAe,WAAf,CAA1B;;AACA,YAAM,kBAAN;AAEA,YAAML,IAAI,GAAGT,OAAO,CAACK,aAAR,CAAsB,yBAAtB,CAAb;AACAK,MAAAA,MAAM,CAACD,IAAI,CAACE,KAAL,CAAWC,SAAZ,CAAN,CAA6BC,IAA7B,CAAkC,MAAlC;AACD,KAzBC,CAAF;AA2BAf,IAAAA,EAAE,CAAE,MAAKJ,KAAM,MAAb,EAAoB,YAAY;AAChC,YAAM;AAAEoB,QAAAA,MAAF;AAAUd,QAAAA;AAAV,UAAsB,MAAM,+BAChC,sBAAC,gCAAD;AAAQ,QAAA,YAAY,EAAEV,WAAW,CAAC,OAAD;AAAjC,QADgC,CAAlC;;AAIAgB,6BAAUS,OAAV,CAAkBD,MAAlB,EAA0B,iCAAgB,GAAElB,MAAO,aAAzB,CAA1B;;AACA,YAAM,kBAAN;AACA,YAAMa,IAAI,GAAGT,OAAO,CAACK,aAAR,CAAsB,yBAAtB,CAAb;AACAK,MAAAA,MAAM,CAACD,IAAI,CAACE,KAAL,CAAWC,SAAZ,CAAN,CAA6BC,IAA7B,CAAkClB,IAAlC;AACD,KATC,CAAF;AAUD,GAxED;AA0EAG,EAAAA,EAAE,CAAC,sBAAD,EAAyB,YAAY;AACrC,UAAM;AAAEgB,MAAAA,MAAF;AAAUd,MAAAA;AAAV,QAAsB,MAAM,+BAChC,sBAAC,gCAAD;AACE,MAAA,YAAY,EAAEV,WAAW,CAAC,OAAD,EAAU,KAAV,CAD3B;AAEE,MAAA,YAAY,EAAE,CAAC;AAAEY,QAAAA,WAAW,EAAE,CAAC;AAAEC,UAAAA,IAAI,EAAE;AAAR,SAAD;AAAf,OAAD;AAFhB,MADgC,CAAlC;;AAOAG,2BAAUS,OAAV,CAAkBD,MAAlB,EAA0B,iCAAe,OAAf,CAA1B;;AACAR,2BAAUS,OAAV,CAAkBD,MAAlB,EAA0B,iCAAe,WAAf,CAA1B;;AACAR,2BAAUS,OAAV,CAAkBD,MAAlB,EAA0B,iCAAe,WAAf,CAA1B,EAVqC,CAYrC;;;AACA,UAAM,kBAAN;AAEA,UAAML,IAAI,GAAGT,OAAO,CAACK,aAAR,CAAsB,yBAAtB,CAAb;AACAK,IAAAA,MAAM,CAACD,IAAI,CAACO,WAAN,CAAN,CAAyBH,IAAzB,CAA8B,MAA9B;AACD,GAjBC,CAAF;AAmBAf,EAAAA,EAAE,CAAC,mBAAD,EAAsB,YAAY;AAClC,UAAMmB,KAAK,GACT,qCACE,wCACE;AAAO,MAAA,IAAI,EAAC,WAAZ;AAAwB,MAAA,IAAI,EAAE;AAAEC,QAAAA,IAAI,EAAE;AAAR;AAA9B,sBADF,CADF,CADF;AAUA,UAAMC,QAAQ,GAAGC,IAAI,CAACC,EAAL,EAAjB;AACA,UAAM;AAAEtB,MAAAA,SAAF;AAAaE,MAAAA;AAAb,QAA+B,MAAM,+BACzC,sBAAC,gCAAD;AACE,MAAA,YAAY,EAAEgB,KADhB;AAEE,MAAA,YAAY,EAAE,CAAC;AAAEf,QAAAA,WAAW,EAAE,CAAC;AAAEC,UAAAA,IAAI,EAAE;AAAR,SAAD;AAAf,OAAD,CAFhB;AAGE,MAAA,QAAQ,EAAEgB;AAHZ,MADyC,CAA3C,CAZkC,CAoBlC;;AACA,UAAMf,OAAO,GAAGL,SAAS,CAACM,aAAV,CAAwB,mDAAxB,CAAhB;;AACAC,2BAAUC,KAAV,CAAgBH,OAAhB,EAtBkC,CAwBlC;;;AACA,UAAMI,GAAG,GAAG,MAAM,2BAAe,MAAMP,aAAa,CAAC,eAAD,CAAlC,CAAlB;;AACAK,2BAAUC,KAAV,CAAgBC,GAAhB,EA1BkC,CA4BlC;;;AACA,UAAM,kBAAN;AAEA,UAAMc,YAAY,GAAG,kBAAKH,QAAQ,CAACD,IAAT,CAAcK,KAAnB,EAA0B,CAA1B,EAA6BN,KAAlD;AACAP,IAAAA,MAAM,CAACY,YAAY,CAACE,UAAb,EAAyBC,IAA1B,CAAN,CAAsCC,OAAtC,CAA8C;AAAER,MAAAA,IAAI,EAAE,IAAR;AAAcS,MAAAA,EAAE,EAAE;AAAlB,KAA9C;AACD,GAjCC,CAAF;AAmCA7B,EAAAA,EAAE,CAAC,8CAAD,EAAiD,YAAY;AAC7D,UAAMmB,KAAK,GACT,qCACE,wCACE;AAAO,MAAA,IAAI,EAAC,WAAZ;AAAwB,MAAA,IAAI,EAAE;AAAEU,QAAAA,EAAE,EAAE;AAAN;AAA9B,eADF,CADF,CADF;AAUA,UAAM;AAAE3B,MAAAA;AAAF,QAAc,MAAM,+BAAa,sBAAC,gCAAD;AAAQ,MAAA,YAAY,EAAEiB;AAAtB,MAAb,CAA1B;AAEA,UAAMR,IAAI,GAAGT,OAAO,CAACK,aAAR,CAAsB,yBAAtB,CAAb;AAEAK,IAAAA,MAAM,CAACD,IAAI,CAACE,KAAL,CAAWC,SAAZ,CAAN,CAA6BC,IAA7B,CAAkC,SAAlC;AACAH,IAAAA,MAAM,CAACD,IAAI,CAACE,KAAL,CAAWiB,aAAZ,CAAN,CAAiCf,IAAjC,CAAsC,SAAtC;AACD,GAjBC,CAAF;AAmBAf,EAAAA,EAAE,CAAC,cAAD,EAAiB,YAAY;AAC7B,UAAMmB,KAAK,GACT,qCACE,wCACE;AAAO,MAAA,IAAI,EAAC,WAAZ;AAAwB,MAAA,IAAI,EAAE;AAAEU,QAAAA,EAAE,EAAE;AAAN;AAA9B,eADF,CADF,CADF;AASA,UAAM;AAAEb,MAAAA,MAAF;AAAUd,MAAAA;AAAV,QAAsB,MAAM,+BAAa,sBAAC,gCAAD;AAAQ,MAAA,YAAY,EAAEiB;AAAtB,MAAb,CAAlC;;AACAX,2BAAUS,OAAV,CAAkBD,MAAlB,EAA0B,iCAAe,cAAf,CAA1B;;AAEA,UAAM,kBAAN;AAEA,UAAML,IAAI,GAAGT,OAAO,CAACK,aAAR,CAAsB,yBAAtB,CAAb;AAEAK,IAAAA,MAAM,CAACD,IAAI,CAACE,KAAL,CAAWC,SAAZ,CAAN,CAA6BC,IAA7B,CAAkC,MAAlC;AACD,GAlBC,CAAF;AAmBD,CAvKO,CAAR","sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\n/** @jsx jsx */\nimport '@testing-library/jest-dom/extend-expect';\nimport {\n  wait,\n  waitForElement,\n} from '@testing-library/react';\nimport { renderEditor, getHotkeyEvent, jsx, fireEvent } from '@ali/4ever-dev-test';\nimport { Value } from '@ali/4ever-cangjie';\nimport { last } from 'lodash-es';\nimport { EditorWidthLegacyToolbar as Editor } from '../editor';\n\n/**\n * 注意不能使用 {cursor === 'start' && <cursor />} 这种语法不然会报错\n * @param text\n * @param cursor 光标的位置\n */\nfunction createValue(text: string, cursor: 'start' | 'end' = 'start') {\n  return (\n    <value>\n      <document>\n        <block type=\"paragraph\">\n          {cursor === 'start' ? <cursor /> : null}\n          {text}\n          {cursor === 'end' ? <cursor /> : null}\n        </block>\n      </document>\n    </value>\n  ) as unknown as Value;\n}\n\ndescribe('Bi/alignment/ui', () => {\n  [{\n    title: '居中',\n    type: 'center',\n    hotKey: 'e',\n  }, {\n    title: '右侧',\n    type: 'right',\n    hotKey: 'r',\n  }, {\n    title: '自动',\n    type: 'justify',\n    hotKey: 'j',\n  }].forEach(({ title, type, hotKey }) => {\n    it(`使用按钮切换${title}`, async () => {\n      const { container, content, queryByTestId } = await renderEditor(\n        <Editor\n          defaultValue={createValue('Hello')}\n          singleLayout={[{ toolButtons: [{ name: 'alignment' }] }]}\n        />,\n      );\n\n      // 打开 alignment 工具栏\n      const trigger = container.querySelector('[data-testid=\"SelectWrap-bi-toolbar-align\"] > div');\n      fireEvent.click(trigger!);\n\n      // 点击对齐方式\n      const btn = await waitForElement(() => queryByTestId(`option-${type}`));\n      fireEvent.click(btn!);\n\n      // flush\n      await wait();\n      const para = content.querySelector('[data-type=\"paragraph\"]') as HTMLElement;\n      expect(para.style.textAlign).toBe(type);\n    });\n\n    it(`在行首按backspace撤销${title}`, async () => {\n      const { container, editor, content, queryByTestId } = await renderEditor(\n        <Editor\n          defaultValue={createValue('Hello')}\n          singleLayout={[{ toolButtons: [{ name: 'alignment' }] }]}\n        />,\n      );\n\n      // 打开 alignment 工具栏\n      const trigger = container.querySelector('[data-testid=\"SelectWrap-bi-toolbar-align\"] > div');\n      fireEvent.click(trigger!);\n\n      // 点击对齐方式\n      const btn = await waitForElement(() => queryByTestId(`option-${type}`));\n      fireEvent.click(btn!);\n\n      // flush\n      await wait();\n\n      // 撤销\n      fireEvent.keyDown(editor, getHotkeyEvent('backspace'));\n      await wait();\n\n      const para = content.querySelector('[data-type=\"paragraph\"]') as HTMLElement;\n      expect(para.style.textAlign).toBe('left');\n    });\n\n    it(`使用 ${title} 快捷键`, async () => {\n      const { editor, content } = await renderEditor(\n        <Editor defaultValue={createValue('Hello')} />,\n      );\n\n      fireEvent.keyDown(editor, getHotkeyEvent(`${hotKey}+ctrl+shift`));\n      await wait();\n      const para = content.querySelector('[data-type=\"paragraph\"]') as HTMLElement;\n      expect(para.style.textAlign).toBe(type);\n    });\n  });\n\n  it('在第二行行首能继续删除第一行左对齐的文本', async () => {\n    const { editor, content } = await renderEditor(\n      <Editor\n        defaultValue={createValue('Hello', 'end')}\n        singleLayout={[{ toolButtons: [{ name: 'alignment' }] }]}\n      />,\n    );\n\n    fireEvent.keyDown(editor, getHotkeyEvent('enter'));\n    fireEvent.keyDown(editor, getHotkeyEvent('backspace'));\n    fireEvent.keyDown(editor, getHotkeyEvent('backspace'));\n\n    // flush\n    await wait();\n\n    const para = content.querySelector('[data-type=\"paragraph\"]') as HTMLElement;\n    expect(para.textContent).toBe('Hell');\n  });\n\n  it('设置对齐方式不会覆盖节点已有的属性', async () => {\n    const value = (\n      <value>\n        <document>\n          <block type=\"paragraph\" data={{ mock: true }}>\n            <cursor />Hello\n          </block>\n        </document>\n      </value>\n    ) as unknown as Value;\n\n    const onChange = jest.fn();\n    const { container, queryByTestId } = await renderEditor(\n      <Editor\n        defaultValue={value}\n        singleLayout={[{ toolButtons: [{ name: 'alignment' }] }]}\n        onChange={onChange}\n      />,\n    );\n\n    // 打开 alignment 工具栏\n    const trigger = container.querySelector('[data-testid=\"SelectWrap-bi-toolbar-align\"] > div');\n    fireEvent.click(trigger!);\n\n    // 点击对齐方式\n    const btn = await waitForElement(() => queryByTestId('option-center'));\n    fireEvent.click(btn!);\n\n    // flush\n    await wait();\n\n    const receiveValue = last(onChange.mock.calls)[0].value as Value;\n    expect(receiveValue.startBlock?.data).toEqual({ mock: true, jc: 'center' });\n  });\n\n  it('distribute 渲染为 justify, 同时加上 text-align-last', async () => {\n    const value = (\n      <value>\n        <document>\n          <block type=\"paragraph\" data={{ jc: 'distribute' }}>\n            Hello\n          </block>\n        </document>\n      </value>\n    ) as unknown as Value;\n\n    const { content } = await renderEditor(<Editor defaultValue={value} />);\n\n    const para = content.querySelector('[data-type=\"paragraph\"]') as HTMLElement;\n\n    expect(para.style.textAlign).toBe('justify');\n    expect(para.style.textAlignLast).toBe('justify');\n  });\n\n  it('居左快捷键可以使段落居左', async () => {\n    const value = (\n      <value>\n        <document>\n          <block type=\"paragraph\" data={{ jc: 'distribute' }}>\n            Hello\n          </block>\n        </document>\n      </value>\n    ) as unknown as Value;\n    const { editor, content } = await renderEditor(<Editor defaultValue={value} />);\n    fireEvent.keyDown(editor, getHotkeyEvent('l+ctrl+shift'));\n\n    await wait();\n\n    const para = content.querySelector('[data-type=\"paragraph\"]') as HTMLElement;\n\n    expect(para.style.textAlign).toBe('left');\n  });\n});\n"],"file":"ui.legacyToolbar.test.js"}