{"version":3,"sources":["../../../../src/__tests__/formatPainter/ui.test.tsx"],"names":["marks","type","data","value","paragraphData","jc","defaultValue","copyAndPasteFormat","controller","container","target","offset","offScreenToolbarItem","querySelector","btn","fireEvent","text","mouseDown","command","Commands","moveAnchorToKey","moveFocusToKey","mouseUp","describe","skip","afterEach","test","c","expect","style","color","toBe","textAlign","formatClipboard","editor","keyDown","findByText","partA","partB","parentElement","fontSize","fontWeight"],"mappings":"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","sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\n/** @jsx jsx */\nimport { waitForElementToBeRemoved, cleanup } from '@testing-library/react';\nimport { renderEditor, getHotkeyEvent, jsx, fireEvent, waitForTime } from '@ali/4ever-dev-test';\nimport { Controller, Value, Commands } from '@ali/4ever-cangjie';\nimport Editor from '../editor';\n\nconst marks = [{\n  type: 'color',\n  data: {\n    value: 'red',\n  },\n}];\n\nconst paragraphData = {\n  jc: 'right',\n};\n\nconst defaultValue = (\n  <value>\n    <document>\n      <block type=\"paragraph\" key=\"paragraphA\" data={paragraphData}>\n        <text key=\"textA\" marks={marks}>with <cursor />marks</text>\n      </block>\n      <block type=\"paragraph\" key=\"paragraphB\">\n        <text key=\"textB\">without marks</text>\n      </block>\n    </document>\n  </value>\n) as unknown as Value;\n\nasync function copyAndPasteFormat(\n  controller: Controller,\n  container: HTMLElement,\n  type: 'click' | 'doubleClick',\n  target: string,\n  offset?: number,\n) {\n  // 避免选中离屏渲染的 toolbar\n  const offScreenToolbarItem = container.querySelector('[class*=\"OffScreen\"] [data-testid=\"SelectWrap-bi-toolbar-heading\"]');\n  if (offScreenToolbarItem) {\n    await waitForElementToBeRemoved(offScreenToolbarItem);\n  }\n\n  const btn = container.querySelector(\n    '[data-testid=\"bi-toolbar-painter\"]',\n  );\n  fireEvent[type](btn);\n  await waitForTime(100);\n  const text = container.querySelector(`[data-cangjie-key=\"${target}\"]`);\n\n  fireEvent.mouseDown(text);\n  controller.command(Commands.moveAnchorToKey, target, 0);\n  controller.command(Commands.moveFocusToKey, target, offset || 0);\n  fireEvent.mouseUp(text);\n  await waitForTime(100);\n  return text;\n}\n\ndescribe.skip('Bi/formatPainter/ui', () => {\n  afterEach(() => {\n    cleanup();\n  });\n\n  test('单击只能使用一次', async () => {\n    let controller: Controller | undefined;\n    const { container } = await renderEditor(<Editor defaultValue={defaultValue} controllerRef={(c) => { controller = c; }} />);\n    const text = await copyAndPasteFormat(controller, container, 'click', 'textB');\n\n    expect(text.querySelector('[data-cangjie-mark]').style.color).toBe('red');\n    expect(container.querySelector('[data-cangjie-key=\"paragraphB\"]').style.textAlign).toBe('right');\n    expect(!!controller.value.data.formatClipboard).toBe(false);\n  });\n\n  test('双击格式可多次使用，按 esc 可取消', async () => {\n    let controller: Controller | undefined;\n    const { editor, container } = await renderEditor(<Editor defaultValue={defaultValue} controllerRef={(c) => { controller = c; }} />);\n    const text = await copyAndPasteFormat(controller, container, 'doubleClick', 'textB');\n\n    expect(text.querySelector('[data-cangjie-mark]').style.color).toBe('red');\n    expect(container.querySelector('[data-cangjie-key=\"paragraphB\"]').style.textAlign).toBe('right');\n    expect(!!controller.value.data.formatClipboard).toBe(true);\n\n    fireEvent.keyDown(editor, getHotkeyEvent('esc'));\n    await waitForTime(100);\n    expect(!!controller.value.data.formatClipboard).toBe(false);\n  });\n\n  test('快捷键粘贴和复制', async () => {\n    let controller: Controller | undefined;\n    const { editor, container } = await renderEditor(<Editor defaultValue={defaultValue} controllerRef={(c) => { controller = c; }} />);\n    fireEvent.keyDown(editor, getHotkeyEvent('c+ctrl+shift'));\n    await waitForTime(100);\n\n    controller.command(Commands.moveAnchorToKey, 'textB', 0);\n    controller.command(Commands.moveFocusToKey, 'textB', 0);\n\n    fireEvent.keyDown(editor, getHotkeyEvent('v+ctrl+shift'));\n    await waitForTime(100);\n\n    expect(container.querySelector('[data-cangjie-key=\"textB\"] [data-cangjie-mark]').style.color).toBe('red');\n    expect(container.querySelector('[data-cangjie-key=\"paragraphB\"]').style.textAlign).toBe('right');\n    expect(!!controller.value.data.formatClipboard).toBe(false);\n  });\n\n  test('从默认文本复制到标题', async () => {\n    const value = (\n      <value>\n        <document>\n          <block type=\"paragraph\" key=\"paragraphA\" data={paragraphData}>\n            <text key=\"textA\">ppp<cursor />ppp</text>\n          </block>\n          <block type=\"heading-1\" key=\"paragraphB\">\n            <text key=\"textB\">withoutmarks</text>\n          </block>\n        </document>\n      </value>\n    ) as unknown as Value;\n    let controller: Controller | undefined;\n    const { editor, findByText } = await renderEditor(<Editor defaultValue={value} controllerRef={(c) => { controller = c; }} />);\n    fireEvent.keyDown(editor, getHotkeyEvent('c+ctrl+shift'));\n    await waitForTime(100);\n\n    controller.command(Commands.moveAnchorToKey, 'textB', 0);\n    controller.command(Commands.moveFocusToKey, 'textB', 7);\n\n    fireEvent.keyDown(editor, getHotkeyEvent('v+ctrl+shift'));\n    const partA = await findByText('without');\n    const partB = await findByText('marks');\n\n    expect(partA.parentElement.style.fontSize).toBe('11pt');\n    expect(partA.parentElement.style.fontWeight).toBe('normal');\n    expect(partB.parentElement.style.fontSize).toBe('');\n  });\n\n  test('从默认标题复制到文本', async () => {\n    const value = (\n      <value>\n        <document>\n          <block type=\"heading-1\" key=\"paragraphA\" data={paragraphData}>\n            <text key=\"textA\">ppp<cursor />ppp</text>\n          </block>\n          <block type=\"paragraph\" key=\"paragraphB\">\n            <text key=\"textB\">withoutmarks</text>\n          </block>\n        </document>\n      </value>\n    ) as unknown as Value;\n    let controller: Controller | undefined;\n    const { editor, findByText } = await renderEditor(<Editor defaultValue={value} controllerRef={(c) => { controller = c; }} />);\n    fireEvent.keyDown(editor, getHotkeyEvent('c+ctrl+shift'));\n    await waitForTime(100);\n\n    controller.command(Commands.moveAnchorToKey, 'textB', 0);\n    controller.command(Commands.moveFocusToKey, 'textB', 7);\n\n    fireEvent.keyDown(editor, getHotkeyEvent('v+ctrl+shift'));\n    const partA = await findByText('without');\n    const partB = await findByText('marks');\n\n    expect(partA.parentElement.style.fontSize).toBe('20pt');\n    expect(partA.parentElement.style.fontWeight).toBe('bold');\n    expect(partB.parentElement.style.fontSize).toBe('');\n  });\n});\n"],"file":"ui.test.js"}