{"version":3,"sources":["../../../../src/__tests__/table/keyboard.next.test.tsx"],"names":["describe","beforeAll","jest","spyOn","console","error","mockImplementation","afterAll","mockRestore","afterEach","test","value","colsWidth","controllerRef","fn","content","controller","mock","calls","event","fireEvent","keyDown","para","querySelector","expect","not","toBeNull","it","table","Table","create","nodes","TableRow","TableCell","Text","data","selection","tableCell","document","findDescendant","isTableCell","newSelection","moveToStartOfNode","command","Commands","select","e","detail","type","noop","toThrowError"],"mappings":"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","sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\n/** @jsx jsx */\nimport { Text, Controller, Value, Commands } from '@ali/4ever-cangjie';\nimport {\n  fireEvent,\n  renderEditor,\n  jsx,\n  getHotkeyEvent,\n} from '@ali/4ever-dev-test';\nimport { Table, TableCell, TableRow } from '@ali/4ever-mo';\nimport '@testing-library/jest-dom/extend-expect';\nimport {\n  cleanup,\n  wait,\n} from '@testing-library/react';\nimport { last, noop } from 'lodash-es';\nimport { onCangjieInput } from '@ali/4ever-plugin-table';\nimport BiEditor from '../editor';\nimport { createControllerInstance } from './helpers';\n\ndescribe('bi/table/keyboardNext', () => {\n  beforeAll(() => {\n    // 防止被 componentDidCatch catch 的 error 被控制台输出\n    jest.spyOn(console, 'error');\n    // @ts-ignore\n    console.error.mockImplementation(() => { });\n  });\n  afterAll(() => {\n    // @ts-ignore\n    console.error.mockRestore();\n  });\n  afterEach(() => {\n    cleanup();\n  });\n  describe('删除行为', () => {\n    test('在 cell 左测的空 inline 中 backspace 不会损坏该 cell', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block type=\"table\" key=\"table-key\" data={{ colsWidth: [100, 100] }}>\n              <block type=\"table-row\">\n                <block type=\"table-cell\" key=\"test1\">\n                  <block type=\"paragraph\">\n                    DingDoc\n                  </block>\n                </block>\n                <block type=\"table-cell\">\n                  <block type=\"paragraph\" key=\"test2\">\n                    <inline>\n                      <cursor />\n                    </inline>\n                    test\n                  </block>\n                </block>\n              </block>\n            </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n      const controllerRef = jest.fn();\n      const { content } = await renderEditor(\n        <BiEditor defaultValue={value} controllerRef={controllerRef} />,\n      );\n      const controller = last(controllerRef.mock.calls)[0] as Controller;\n      const event = getHotkeyEvent('backspace');\n      fireEvent.keyDown(content, event);\n      await wait();\n      const para = content.querySelector('[data-cangjie-key=\"test2\"]');\n      expect(para).not.toBeNull();\n    });\n\n    it('delete in cell whose children are not blocks', () => {\n      const table = Table.create({\n        nodes: [TableRow.create({\n          nodes: [TableCell.create({\n            nodes: [Text.create('')],\n          })],\n        })],\n        data: {\n          colsWidth: [100],\n        },\n      });\n      const controller = createControllerInstance([table]);\n\n      const { selection } = controller.value;\n\n      const tableCell = controller.value.document.findDescendant(TableCell.isTableCell);\n      const newSelection = selection.moveToStartOfNode(tableCell, controller);\n      controller.command(Commands.select, newSelection);\n      const e = {\n        detail: {\n          type: 'deleteContentBackward',\n        },\n      };\n      // @ts-ignore\n      expect(() => onCangjieInput(e, controller, noop)).not.toThrowError();\n    });\n  });\n});\n"],"file":"keyboard.next.test.js"}