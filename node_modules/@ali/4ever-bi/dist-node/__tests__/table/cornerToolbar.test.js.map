{"version":3,"sources":["../../../../src/__tests__/table/cornerToolbar.test.tsx"],"names":["COPY_ITEM","describe","test","value","before","after","controllerRef","jest","fn","controller","mock","calls","command","Commands","moveToEndOfDocument","cornerToolbar","document","querySelector","expect","style","display","toBe","toolbarItems","querySelectorAll","fireEvent","mouseEnter","useRealTimers","selection","table","firstCell","nodes","select","moveToStartOfNode","tableDOM","mouseLeave","lastNode","getLastNode","queryByTestId","click","dragMenuRoot","not","copyItem"],"mappings":"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","sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\n/** @jsx jsx */\nimport '@testing-library/jest-dom/extend-expect';\nimport { renderEditor, jsx, fireEvent, waitForTime } from '@ali/4ever-dev-test';\nimport { Controller, Commands } from '@ali/4ever-cangjie';\nimport { last } from 'lodash-es';\nimport Editor from '../editor';\nimport { createTable, getTableFromController } from './helpers';\nimport { waitForElement } from '@testing-library/react';\n\n// 复制选项\nconst COPY_ITEM = '[data-role=\"copy\"]';\n\ndescribe('table cornerToolbar', () => {\n  test('鼠标在表格内展示汉堡，移出表格隐藏汉堡', async () => {\n    const value = createTable([['A', 'B'], ['C', 'D']], {\n      before: '<p>123</p>',\n      after: '<p>abc</p>',\n    });\n    const controllerRef = jest.fn();\n    await renderEditor(<Editor defaultValue={value} controllerRef={controllerRef} />);\n    const controller = last(controllerRef.mock.calls)[0] as Controller;\n    controller.command(Commands.moveToEndOfDocument);\n    const cornerToolbar = document.querySelector('[data-testid=\"table-corner-toobar-button\"]') as HTMLDivElement;\n    // 光标不在表格内\n    expect(cornerToolbar.style.display).toBe('none');\n    const toolbarItems = document.querySelectorAll('[data-type=\"table-cell\"]');\n    fireEvent.mouseEnter(toolbarItems[0]);\n    // 光标在表格内\n    expect(cornerToolbar.style.display).toBe('block');\n    jest.useRealTimers();\n  });\n\n  test('选中表格时，显示汉堡；点击表格外时隐藏汉堡', async () => {\n    const value = createTable([['A', 'B'], ['C', 'D']], {\n      before: '<p>123</p>',\n      after: '<p>abc</p>',\n    });\n    const controllerRef = jest.fn();\n    await renderEditor(<Editor defaultValue={value} controllerRef={controllerRef} />);\n    const controller = last(controllerRef.mock.calls)[0] as Controller;\n    const { selection } = controller.value;\n    const table = getTableFromController(controller);\n    const firstCell = table.nodes[0].nodes[0];\n    controller.command(\n      Commands.select,\n      selection.moveToStartOfNode(firstCell, controller),\n    );\n    await waitForTime(0);\n    const cornerToolbar = document.querySelector('[data-testid=\"table-corner-toobar-button\"]') as HTMLDivElement;\n    // 光标不在表格内\n    expect(cornerToolbar.style.display).toBe('block');\n    const tableDOM = document.querySelector('[data-type=\"table\"]');\n    fireEvent.mouseLeave(tableDOM as HTMLElement);\n    const lastNode = controller.value.document.getLastNode();\n    controller.command(\n      Commands.select,\n      selection.moveToStartOfNode(lastNode, controller),\n    );\n    await waitForTime(0);\n    expect(cornerToolbar.style.display).toBe('none');\n  });\n\n  test('点击汉堡菜单选项，菜单隐藏', async () => {\n    const value = createTable([['A', 'B'], ['C', 'D']], {\n      before: '<p>123</p>',\n      after: '<p>abc</p>',\n    });\n    const controllerRef = jest.fn();\n    const { queryByTestId } = await renderEditor(<Editor defaultValue={value} controllerRef={controllerRef} />);\n    const controller = last(controllerRef.mock.calls)[0] as Controller;\n    controller.command(Commands.moveToEndOfDocument);\n    const cornerToolbar = await waitForElement(() => queryByTestId('drag-hander'));\n    const toolbarItems = document.querySelectorAll('[data-type=\"table-cell\"]');\n    fireEvent.click(toolbarItems[0]);\n    // 光标点击到汉堡\n    fireEvent.click(cornerToolbar);\n    let dragMenuRoot = await waitForElement(() => queryByTestId('drag-menu_root'));\n    // 菜单显示\n    expect(dragMenuRoot).not.toBe(null);\n    // 点击复制按钮\n    const copyItem = document.querySelector(COPY_ITEM);\n    fireEvent.click(copyItem);\n    await waitForTime(1000);\n    // 菜单隐藏\n    dragMenuRoot = document.querySelector('[data-testid=\"drag-menu_root\"]');\n    expect(dragMenuRoot).toBe(null);\n  });\n});\n"],"file":"cornerToolbar.test.js"}