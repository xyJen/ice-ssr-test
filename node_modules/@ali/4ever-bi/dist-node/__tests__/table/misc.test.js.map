{"version":3,"sources":["../../../../src/__tests__/table/misc.test.tsx"],"names":["originValue","beforeAll","process","env","RUNTIME_ENV","ToolbarLayout","UITEST_FLAG","afterAll","describe","test","skip","value","controllerRef","jest","fn","editor","useFakeTimers","controller","mock","calls","command","Commands","moveToEndOfDocument","fireEvent","keyDown","expect","runOnlyPendingTimers","not","toThrow","useRealTimers","toolBtn","document","querySelector","click","Promise","resolve","data","formatClipboard","toBe"],"mappings":";;;;AAEA;;AACA;;AACA;;AAGA;;AACA;;AACA;;AACA;;AACA;;AAXA;;AACA;AAYA,IAAIA,WAAJ;AAEAC,SAAS,CAAC,MAAM;AACdD,EAAAA,WAAW,GAAGE,OAAO,CAACC,GAAR,CAAYC,WAA1B;AACAF,EAAAA,OAAO,CAACC,GAAR,CAAYC,WAAZ,GAA0BC,4BAAcC,WAAxC;AACD,CAHQ,CAAT;AAKAC,QAAQ,CAAC,MAAM;AACbL,EAAAA,OAAO,CAACC,GAAR,CAAYC,WAAZ,GAA0BJ,WAA1B;AACD,CAFO,CAAR;AAIAQ,QAAQ,CAAC,cAAD,EAAiB,MAAM;AAC7B;AACAC,EAAAA,IAAI,CAACC,IAAL,CAAU,4BAAV,EAAwC,YAAY;AAClD,UAAMC,KAAK,GAAG,0BAAY,CACxB,CAAC,GAAD,EAAM,GAAN,CADwB,CAAZ,CAAd;AAIA,UAAMC,aAAa,GAAGC,IAAI,CAACC,EAAL,EAAtB;AACA,UAAM;AAAEC,MAAAA;AAAF,QAAa,MAAM,+BAAa,sBAAC,eAAD;AAAQ,MAAA,YAAY,EAAEJ,KAAtB;AAA6B,MAAA,aAAa,EAAEC;AAA5C,MAAb,CAAzB;AACAC,IAAAA,IAAI,CAACG,aAAL;AACA,UAAMC,UAAU,GAAG,kBAAKL,aAAa,CAACM,IAAd,CAAmBC,KAAxB,EAA+B,CAA/B,CAAnB;AAEAF,IAAAA,UAAU,CAACG,OAAX,CAAmBC,sBAASC,mBAA5B;;AAEAC,2BAAUC,OAAV,CAAkBT,MAAlB,EAA0B,iCAAe,WAAf,CAA1B;;AACAQ,2BAAUC,OAAV,CAAkBT,MAAlB,EAA0B,iCAAe,WAAf,CAA1B;;AAEA,UAAM,kBAAN;AAEAU,IAAAA,MAAM,CAAC,MAAMZ,IAAI,CAACa,oBAAL,EAAP,CAAN,CAA0CC,GAA1C,CAA8CC,OAA9C;AAEAf,IAAAA,IAAI,CAACgB,aAAL;AACD,GApBD;AAqBD,CAvBO,CAAR;AAyBArB,QAAQ,CAAC,eAAD,EAAkB,MAAM;AAC9BC,EAAAA,IAAI,CAAC,uBAAD,EAA0B,YAAY;AACxC,UAAME,KAAK,GAAG,0BAAY,CACxB,CAAC,GAAD,EAAM,GAAN,CADwB,CAAZ,CAAd;AAIA,UAAMC,aAAa,GAAGC,IAAI,CAACC,EAAL,EAAtB;AACA,UAAM,+BAAa,sBAAC,eAAD;AAAQ,MAAA,YAAY,EAAEH,KAAtB;AAA6B,MAAA,aAAa,EAAEC;AAA5C,MAAb,CAAN;AACAC,IAAAA,IAAI,CAACG,aAAL;AACA,UAAMC,UAAU,GAAG,kBAAKL,aAAa,CAACM,IAAd,CAAmBC,KAAxB,EAA+B,CAA/B,CAAnB;AAEA,UAAMW,OAAO,GAAGC,QAAQ,CAACC,aAAT,CAAuB,oCAAvB,CAAhB;;AACAT,2BAAUU,KAAV,CAAgBH,OAAhB;;AACAjB,IAAAA,IAAI,CAACa,oBAAL;AACA,UAAMQ,OAAO,CAACC,OAAR,EAAN;AAEAV,IAAAA,MAAM,CAACR,UAAU,CAACN,KAAX,CAAiByB,IAAjB,CAAsBC,eAAvB,CAAN,CAA8CV,GAA9C,CAAkDW,IAAlD,CAAuD,IAAvD;AAEAzB,IAAAA,IAAI,CAACgB,aAAL;AACD,GAlBG,CAAJ;AAmBD,CApBO,CAAR","sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\n/** @jsx jsx */\nimport '@testing-library/jest-dom/extend-expect';\nimport { renderEditor, jsx, fireEvent, getHotkeyEvent } from '@ali/4ever-dev-test';\nimport {\n  wait,\n} from '@testing-library/react';\nimport { ToolbarLayout } from '@ali/we-design-next';\nimport { Controller, Commands } from '@ali/4ever-cangjie';\nimport { last } from 'lodash-es';\nimport Editor from '../editor';\nimport { createTable } from './helpers';\n\nlet originValue;\n\nbeforeAll(() => {\n  originValue = process.env.RUNTIME_ENV;\n  process.env.RUNTIME_ENV = ToolbarLayout.UITEST_FLAG;\n})\n\nafterAll(() => {\n  process.env.RUNTIME_ENV = originValue\n})\n\ndescribe('table render', () => {\n  // 这个 case 会报错，辛苦 一辙 看下 TODO 一辙\n  test.skip('表格 mount 后立刻 unmount，不应该报错', async () => {\n    const value = createTable([\n      ['A', 'B'],\n    ]);\n\n    const controllerRef = jest.fn();\n    const { editor } = await renderEditor(<Editor defaultValue={value} controllerRef={controllerRef} />);\n    jest.useFakeTimers();\n    const controller = last(controllerRef.mock.calls)[0] as Controller;\n\n    controller.command(Commands.moveToEndOfDocument);\n\n    fireEvent.keyDown(editor, getHotkeyEvent('Backspace'));\n    fireEvent.keyDown(editor, getHotkeyEvent('Backspace'));\n\n    await wait();\n\n    expect(() => jest.runOnlyPendingTimers()).not.toThrow();\n\n    jest.useRealTimers();\n  });\n});\n\ndescribe('table toolbar', () => {\n  test('光标在表格内时，点击格式刷按钮正常拷贝样式', async () => {\n    const value = createTable([\n      ['A', 'B'],\n    ]);\n\n    const controllerRef = jest.fn();\n    await renderEditor(<Editor defaultValue={value} controllerRef={controllerRef} />);\n    jest.useFakeTimers();\n    const controller = last(controllerRef.mock.calls)[0] as Controller;\n\n    const toolBtn = document.querySelector('[data-testid=\"bi-toolbar-painter\"]');\n    fireEvent.click(toolBtn!);\n    jest.runOnlyPendingTimers();\n    await Promise.resolve();\n\n    expect(controller.value.data.formatClipboard).not.toBe(null);\n\n    jest.useRealTimers();\n  });\n});\n"],"file":"misc.test.js"}