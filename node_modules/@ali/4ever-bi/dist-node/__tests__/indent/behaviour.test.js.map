{"version":3,"sources":["../../../../src/__tests__/indent/behaviour.test.tsx"],"names":["plugins","array","describe","test","value","controller","Controller","create","run","history","data","History","expect","undos","length","toEqual","ind","left","MAX_INDENT_SIZE","output","preventDefault","command","Commands","deleteBackward","actual","toJSON","expected","setValue"],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable import/no-extraneous-dependencies */\n/** @jsx jsx */\nimport { Value, Controller, History, Commands } from '@ali/4ever-cangjie';\nimport '@testing-library/jest-dom/extend-expect';\n\nimport {\n  jsx, waitForTime,\n} from '@ali/4ever-dev-test';\nimport { createBiPlugins } from '../..';\nimport { MAX_INDENT_SIZE } from '../../plugins/indent/utils';\nimport { decreaseIndent, increaseIndent } from '../../plugins/indent/actions';\nimport onDelete from '../../plugins/indent/handlers/onDelete';\n\nconst plugins = createBiPlugins({}).array;\n\ndescribe('Bi/indent/behaviour', () => {\n  describe('边界场景', () => {\n    test('左缩进为默认值 0 时，缩小缩进，不产生 history', async () => {\n      const value = (\n        <value>\n          <document>\n            <block type=\"paragraph\"><cursor />段落</block>\n            <block type=\"paragraph\">段落</block>\n          </document>\n        </value>\n      ) as unknown as Value;\n      const controller = Controller.create({\n        value,\n        plugins,\n      });\n\n      controller.run('onAction', decreaseIndent());\n      await waitForTime(1);\n      const history: History = controller.value.data.history || History.create();\n      expect(history.undos.length).toEqual(0);\n    });\n\n    test('左缩进为最大值时，增大缩进，不产生 history', async () => {\n      const value = (\n        <value>\n          <document>\n            <block type=\"paragraph\" data={{ ind: { left: MAX_INDENT_SIZE } }}><cursor />段落</block>\n            <block type=\"paragraph\">段落</block>\n          </document>\n        </value>\n      ) as unknown as Value;\n      const controller = Controller.create({\n        value,\n        plugins,\n      });\n\n      controller.run('onAction', increaseIndent());\n      await waitForTime(1);\n      const { history = History.create() } = controller.value.data;\n      expect(history.undos.length).toEqual(0);\n    });\n  });\n\n  describe('onDelete', () => {\n    test('delete 左侧为代码块时，忽略 4 个空格的处理', async () => {\n      const value = ((\n        <value>\n          <document>\n            <block\n              type=\"code\"\n              cursor=\"after\"\n            >ends with four space       </block>\n          </document>\n        </value>\n      ) as unknown) as Value;\n\n      const output = ((\n        <value>\n          <document>\n            <block type=\"paragraph\" />\n          </document>\n        </value>\n      ) as unknown) as Value;\n\n      const controller = Controller.create({\n        value,\n        plugins,\n      });\n\n      // mock onDelete，未处理代码块，测试报错\n      onDelete({ preventDefault: () => {} }, controller, () => {});\n      controller.command(Commands.deleteBackward);\n      const actual = controller.value.toJSON();\n      const expected = controller.setValue(output).value.toJSON();\n      expect(actual).toEqual(expected);\n    });\n  });\n});\n"],"file":"behaviour.test.js"}