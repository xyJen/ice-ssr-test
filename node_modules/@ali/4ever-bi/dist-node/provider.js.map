{"version":3,"sources":["../../src/provider.tsx"],"names":["BiProvider","React","Component","state","value","plugins","handleChange","change","onChange","props","resolveCangjiePlugins","onAction","isPlaceholderVisible","array","render","controllerRef","children","rest","lang","hash","defaultProps","readOnly","action","controller","next","onCatch"],"mappings":";;;;;;;;;;;;;AAIA;;AACA;;AACA;;AAEA;;AACA;;AAQA;;AACA;;AAlBA;AACA;AACA;AACA;uBAF4B,a;;AAqC5B;AACA;AACA;AACA;AACe,MAAMA,UAAN,SAAyBC,KAAK,CAACC,SAA/B,CAA0D;AAAA;AAAA;AAAA,SAUvEC,KAVuE,GAU/D;AACNC,MAAAA,KAAK,EAAE;AADD,KAV+D;AAAA,SAc/DC,OAd+D,GAcpC,IAdoC;;AAAA,SAgB/DC,YAhB+D,GAgBhDC,MAAM,IAAI;AAC/B,YAAM;AAAEC,QAAAA;AAAF,UAAe,KAAKC,KAA1B;AACAD,MAAAA,QAAQ,GAAGD,MAAH,CAAR;AACD,KAnBsE;AAAA;;AAqB/DG,EAAAA,qBAAR,GAAgC;AAC9B,QAAI,CAAC,KAAKL,OAAV,EAAmB;AACjB,YAAM;AAAEA,QAAAA,OAAF;AAAWM,QAAAA;AAAX,UAAwB,KAAKF,KAAnC;AACA,WAAKJ,OAAL,GAAe,CACb;AACA,gDAAwB;AACtBO,QAAAA,oBAAoB,EAApBA;AADsB,OAAxB,CAFa,EAKb;AAAED,QAAAA;AAAF,OALa,EAMb,IAAIN,OAAO,EAAEQ,KAAT,IAAkB,EAAtB,CANa,CAAf;AAQD;;AACD,WAAO,KAAKR,OAAZ;AACD;;AAEDS,EAAAA,MAAM,GAAG;AACP,UAAM;AAAEC,MAAAA,aAAF;AAAiBC,MAAAA,QAAjB;AAA2BX,MAAAA,OAA3B;AAAoC,SAAGY;AAAvC,QAAgD,KAAKR,KAA3D;AACA,UAAM;AAAEL,MAAAA;AAAF,QAAY,KAAKD,KAAvB;AACA,wBACE,eAAC,4BAAD;AAA0B,MAAA,KAAK,EAAEE,OAAO,EAAEa,IAAT,IAAiB;AAAlD,oBACE,eAAC,oBAAD;AAAgB,MAAA,KAAK,EAAEb,OAAO,EAAEa,IAAT,IAAiB;AAAxC,oBACE,eAAC,sBAAD;AAAsB,MAAA,KAAK,EAAEb,OAAO,EAAEa,IAAT,IAAiB;AAA9C,oBACE,eAAC,qBAAD,6BACMD,IADN;AAEE,MAAA,aAAa,EAAEF,aAFjB;AAGE,MAAA,OAAO,EAAE,KAAKL,qBAAL,EAHX;AAIE,MAAA,KAAK,EAAEN,KAAK,IAAI,KAAKK,KAAL,CAAWL,KAJ7B;AAKE,MAAA,QAAQ,EAAE,KAAKE;AALjB,qBAOE,eAAC,6BAAD,CAAgB,QAAhB;AAAyB,MAAA,KAAK,EAAED,OAAO,IAAI;AAAEQ,QAAAA,KAAK,EAAE,EAAT;AAAaM,QAAAA,IAAI,EAAE;AAAnB;AAA3C,oBACE,eAAC,wCAAD,QACGH,QADH,CADF,CAPF,CADF,CADF,CADF,CADF;AAqBD;;AA5DsE;;;AAApDhB,U,CACZoB,Y,GAAe;AACpBC,EAAAA,QAAQ,EAAE,KADU;;AAEpBV,EAAAA,QAAQ,CAACW,MAAD,EAASC,UAAT,EAAqBC,IAArB,EAA2B;AACjC,WAAOA,IAAI,EAAX;AACD,GAJmB;;AAKpBC,EAAAA,OAAO,GAAG,CAAG,CALO;;AAMpBjB,EAAAA,QAAQ,GAAG,CAAG;;AANM,C","sourcesContent":["/**\n * @packageDocumentation\n * @module Provider\n */\nimport * as React from 'react';\nimport { LocaleProvider as WeUtilLocaleProvider } from '@ali/we-util';\nimport { LocaleProvider as DesignNextLocaleProvider } from '@ali/we-design-next';\n// 等待 we-ui 完全去除\nimport { LocaleProvider } from '@ali/we-ui';\nimport {\n  Controller,\n  Action,\n  Provider,\n  ProviderProps,\n  createPlaceholderPlugin,\n  Plugin,\n} from '@ali/4ever-cangjie';\nimport { PluginsContext, OldBiPlugins, ActiveInteractionProvider } from '@ali/4ever-component';\nimport { isPlaceholderVisible } from '@ali/4ever-utils';\n\n/**\n * 继承于编辑器内核的Props，由于TypeDoc限制，继承的选项没能在本页面显示：[「仓颉」Provider Props](https://pds.alibaba-inc.com/renquan.wrq/cangjie-beta-docs/interfaces/controller.providerprops.html)\n */\nexport interface BiProviderProps extends Omit<ProviderProps, 'plugins'> {\n  /**\n   * 插件集合\n   */\n  plugins?: OldBiPlugins & { lang?: string };\n  /**\n   * onAction回调\n   */\n  onAction?: (action: Action, controller: Controller, next: Function) => void;\n  /**\n   * onCatch回调\n   */\n  onCatch?: (error: Error) => void;\n}\n\n/**\n * 编辑器顶层Provider，提供编辑数据、插件、配置\n * @ignore\n */\nexport default class BiProvider extends React.Component<BiProviderProps> {\n  static defaultProps = {\n    readOnly: false,\n    onAction(action, controller, next) {\n      return next();\n    },\n    onCatch() { },\n    onChange() { },\n  };\n\n  state = {\n    value: null,\n  };\n\n  private plugins: Plugin[] | null = null;\n\n  private handleChange = change => {\n    const { onChange } = this.props;\n    onChange?.(change);\n  };\n\n  private resolveCangjiePlugins() {\n    if (!this.plugins) {\n      const { plugins, onAction } = this.props;\n      this.plugins = [\n        // @ts-ignore\n        createPlaceholderPlugin({\n          isPlaceholderVisible,\n        }),\n        { onAction },\n        ...(plugins?.array || []),\n      ];\n    }\n    return this.plugins!;\n  }\n\n  render() {\n    const { controllerRef, children, plugins, ...rest } = this.props;\n    const { value } = this.state;\n    return (\n      <DesignNextLocaleProvider value={plugins?.lang || 'zh-CN'}>\n        <LocaleProvider value={plugins?.lang || 'zh-CN'}>\n          <WeUtilLocaleProvider value={plugins?.lang || 'zh-CN'}>\n            <Provider\n              {...rest}\n              controllerRef={controllerRef}\n              plugins={this.resolveCangjiePlugins()}\n              value={value || this.props.value}\n              onChange={this.handleChange}\n            >\n              <PluginsContext.Provider value={plugins || { array: [], hash: {} }}>\n                <ActiveInteractionProvider>\n                  {children}\n                </ActiveInteractionProvider>\n              </PluginsContext.Provider>\n            </Provider>\n          </WeUtilLocaleProvider>\n        </LocaleProvider>\n      </DesignNextLocaleProvider>\n    );\n  }\n}\n"],"file":"provider.js"}