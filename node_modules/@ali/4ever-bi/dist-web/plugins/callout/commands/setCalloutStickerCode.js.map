{"version":3,"sources":["../../../../../src/plugins/callout/commands/setCalloutStickerCode.ts"],"names":["Commands","ColorBlocks","broadcastDataChange","setCalloutStickerCode","controller","key","stickerCode","node","value","document","getNode","isColorBlocks","metadata","data","sticker","run","command","setNodeByKey"],"mappings":";AAAA,SAAqBA,QAArB,QAAqC,oBAArC;AACA,SAASC,WAAT,QAA4B,eAA5B;AACA,SAASC,mBAAT;AAEA,OAAO,SAASC,qBAAT,CACLC,UADK,EAELC,GAFK,EAGLC,WAHK,EAIL;AACA,MAAMC,IAAI,GAAGH,UAAU,CAACI,KAAX,CAAiBC,QAAjB,CAA0BC,OAA1B,CAAkCL,GAAlC,CAAb;;AACA,MAAI,CAACJ,WAAW,CAACU,aAAZ,CAA0BJ,IAA1B,CAAL,EAAsC;AACpC,WAAOH,UAAP;AACD;;AACD,MAAMQ,QAAQ,gBACTL,IAAI,CAACM,IAAL,CAAUD,QADD,CAAd;;AAGA,MAAIN,WAAJ,EAAiB;AACfM,IAAAA,QAAQ,CAACE,OAAT,GAAmBR,WAAnB;AACD,GAFD,MAEO;AACL,WAAOM,QAAQ,CAACE,OAAhB;AACD;;AAEDV,EAAAA,UAAU,CAACW,GAAX,CAAe,UAAf,EAA2Bb,mBAAmB,CAACU,QAAD,CAA9C;AAEA,SAAOR,UAAU,CAACY,OAAX,CAAmBhB,QAAQ,CAACiB,YAA5B,EAA0CZ,GAA1C,EAA+C;AACpDQ,IAAAA,IAAI,eACCN,IAAI,CAACM,IADN;AAEFD,MAAAA,QAAQ,EAARA;AAFE;AADgD,GAA/C,CAAP;AAMD","sourcesContent":["import { Controller, Commands } from '@ali/4ever-cangjie';\nimport { ColorBlocks } from '@ali/4ever-mo';\nimport { broadcastDataChange } from '../actions';\n\nexport function setCalloutStickerCode(\n  controller: Controller,\n  key: string,\n  stickerCode?: string,\n) {\n  const node = controller.value.document.getNode(key);\n  if (!ColorBlocks.isColorBlocks(node)) {\n    return controller;\n  }\n  const metadata = {\n    ...node.data.metadata,\n  };\n  if (stickerCode) {\n    metadata.sticker = stickerCode;\n  } else {\n    delete metadata.sticker;\n  }\n\n  controller.run('onAction', broadcastDataChange(metadata));\n\n  return controller.command(Commands.setNodeByKey, key, {\n    data: {\n      ...node.data,\n      metadata,\n    },\n  });\n}\n"],"file":"setCalloutStickerCode.js"}