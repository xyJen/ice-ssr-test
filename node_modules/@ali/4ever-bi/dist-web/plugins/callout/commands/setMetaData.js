import _extends from "@babel/runtime/helpers/extends";
import { Commands, Selection } from '@ali/4ever-cangjie';
import { ColorBlocks } from '@ali/4ever-mo';
import { broadcastDataChange } from "../actions";
export function setMetaData(controller, key, data) {
  var node = controller.value.document.getNode(key);

  if (!ColorBlocks.isColorBlocks(node)) {
    return controller;
  }

  if (typeof (data == null ? void 0 : data.color) === 'string') {
    var _controller$value = controller.value,
        range = _controller$value.selection,
        document = _controller$value.document;
    var selection = Selection.create(range.moveToRangeOfNode(node, controller).convertToTextPoints(document));
    controller.command(Commands.select, selection);
    controller.dispatch('setColor', data == null ? void 0 : data.color);
    controller.command(Commands.moveToStart);
  }

  var newData = data || {};

  var metadata = _extends({}, node.data.metadata, newData);

  controller.run('onAction', broadcastDataChange(metadata));
  return controller.command(Commands.setNodeByKey, key, {
    data: _extends({}, node.data, {
      metadata: metadata
    })
  });
}
//# sourceMappingURL=setMetaData.js.map