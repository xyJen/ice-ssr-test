{"version":3,"sources":["../../../../../src/plugins/callout/commands/insertCallout.ts"],"names":["Commands","ColorBlocks","isEmptyParagraph","CalloutPlugin","createInsertCallout","config","insertCallout","controller","text","type","value","selection","document","focusKey","focus","key","targetNode","getClosestBlock","targetPath","getPath","length","targetIndex","pop","colorBlock","createColorBlocks","getDefaultSetting","bgcolor","COLOR_MAP","command","insertNodeByPath","moveToStartOfNode","nodes","removeNodeByKey"],"mappings":";AAAA,SAAqBA,QAArB,QAAqC,oBAArC;AACA,SAASC,WAAT,QAA4B,eAA5B;AAEA,SAASC,gBAAT,EAA2BC,aAA3B,QAAgD,mBAAhD;AAEA,OAAO,SAASC,mBAAT,CAA6BC,MAA7B,EAA0D;AAC/D,SAAO,SAASC,aAAT,CAAuBC,UAAvB,EAA+CC,IAA/C,EAA0DC,IAA1D,EAAqE;AAAA,QAAtBD,IAAsB;AAAtBA,MAAAA,IAAsB,GAAf,EAAe;AAAA;;AAAA,QAAXC,IAAW;AAAXA,MAAAA,IAAW,GAAJ,EAAI;AAAA;;AAAA,4BAC1CF,UAAU,CAACG,KAD+B;AAAA,QAClEC,SADkE,qBAClEA,SADkE;AAAA,QACvDC,QADuD,qBACvDA,QADuD;AAAA,QAE7DC,QAF6D,GAEhDF,SAAS,CAACG,KAFsC,CAElEC,GAFkE;AAG1E,QAAMC,UAAU,GAAGJ,QAAQ,CAACK,eAAT,CAAyBJ,QAAzB,CAAnB;AACA,QAAMK,UAAU,GAAGF,UAAU,IAAIJ,QAAQ,CAACO,OAAT,CAAiBH,UAAU,CAACD,GAA5B,CAAjC;;AACA,QAAI,CAACG,UAAD,IAAe,CAACA,UAAU,CAACE,MAA/B,EAAuC;AACrC,aAAOb,UAAP;AACD;;AACD,QAAMc,WAAW,GAAGH,UAAU,CAACI,GAAX,EAApB;AACA,QAAMC,UAAU,GAAGtB,WAAW,CAACuB,iBAAZ,cACdnB,MAAM,CAACoB,iBAAP,IAA4BpB,MAAM,CAACoB,iBAAP,EADd,EAEbhB,IAAI,GAAG;AAAEiB,MAAAA,OAAO,EAAEvB,aAAa,CAACwB,SAAd,CAAwBlB,IAAxB,KAAiC;AAA5C,KAAH,GAAsD,EAF7C,EAAnB;AAIAF,IAAAA,UAAU,CACPqB,OADH,CACW5B,QAAQ,CAAC6B,gBADpB,EACsCX,UADtC,EACkDG,WAAW,GAAG,CADhE,EACmEE,UADnE,EAEGK,OAFH,CAEW5B,QAAQ,CAAC8B,iBAFpB,EAEuCP,UAAU,CAACQ,KAAX,CAAiB,CAAjB,CAFvC;;AAGA,QAAI7B,gBAAgB,CAACc,UAAD,CAApB,EAAkC;AAChCT,MAAAA,UAAU,CAACqB,OAAX,CAAmB5B,QAAQ,CAACgC,eAA5B,EAA6ChB,UAAU,CAACD,GAAxD;AACD;;AACD,WAAOR,UAAP;AACD,GApBD;AAqBD","sourcesContent":["import { Controller, Commands } from '@ali/4ever-cangjie';\nimport { ColorBlocks } from '@ali/4ever-mo';\nimport { CalloutPluginConfig } from '../types';\nimport { isEmptyParagraph, CalloutPlugin } from '@ali/4ever-bamboo';\n\nexport function createInsertCallout(config: CalloutPluginConfig) {\n  return function insertCallout(controller: Controller, text = '', type = '') {\n    const { selection, document } = controller.value;\n    const { key: focusKey } = selection.focus;\n    const targetNode = document.getClosestBlock(focusKey);\n    const targetPath = targetNode && document.getPath(targetNode.key);\n    if (!targetPath || !targetPath.length) {\n      return controller;\n    }\n    const targetIndex = targetPath.pop()!;\n    const colorBlock = ColorBlocks.createColorBlocks({\n      ...config.getDefaultSetting && config.getDefaultSetting(),\n      ...(type ? { bgcolor: CalloutPlugin.COLOR_MAP[type] || {} } : {}),\n    });\n    controller\n      .command(Commands.insertNodeByPath, targetPath, targetIndex + 1, colorBlock)\n      .command(Commands.moveToStartOfNode, colorBlock.nodes[0]);\n    if (isEmptyParagraph(targetNode)) {\n      controller.command(Commands.removeNodeByKey, targetNode.key);\n    }\n    return controller;\n  };\n}\n"],"file":"insertCallout.js"}