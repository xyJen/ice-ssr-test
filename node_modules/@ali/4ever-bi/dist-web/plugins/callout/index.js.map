{"version":3,"sources":["../../../../src/plugins/callout/index.ts"],"names":["StickerPlugin","isEmptyParagraph","CalloutPlugin","createRenderNode","commands","createOnAction","menubar","createGroupNodes","createOnQuery","createOnCangjieSelect","onKeyDown","onCangjieCopyOrCut","onCangjieInput","queries","createRenderHoverToolbar","getSnippetConfig","actions","moFactory","DEFAULT_STICKERS","Sticker","createCalloutPlugin","config","callout","locale","stickerConfig","lang","customSticker","sticker","params","renderNode","onCangjieCopy","onCangjieCut","onCangjieSelect","onQuery","groupNodes","onAction","getNodeStyle","shouldNodeComponentUpdate","prevProps","props","__","next","value","data","selectedCallout","node","calloutPr","key","placeholder","text","when","controller","query","renderHoverToolbar"],"mappings":"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","sourcesContent":["import { Block } from '@ali/4ever-cangjie';\nimport { BiPlugin, BiPluginConfig } from '../../types';\nimport { StickerPlugin, isEmptyParagraph, CalloutPlugin } from '@ali/4ever-bamboo';\nimport createRenderNode from './handlers/createRenderNode';\nimport * as commands from './commands';\nimport createOnAction from './handlers/createOnAction';\nimport menubar from './menubar';\nimport createGroupNodes from './handlers/createGroupNodes';\nimport createOnQuery from './handlers/createOnQuery';\nimport createOnCangjieSelect from './handlers/createOnCangjieSelect';\nimport onKeyDown from './handlers/onKeyDown';\nimport onCangjieCopyOrCut from './handlers/onCangjieCopyOrCut';\nimport onCangjieInput from './handlers/onCangjieInput';\nimport queries from './queries';\nimport createRenderHoverToolbar from './createRenderHoverToolbar';\nimport getSnippetConfig from './getSnippetConfig';\nimport * as actions from './actions';\nimport { moFactory } from '@ali/4ever-plugin-color-blocks';\n\nconst { DEFAULT_STICKERS, Sticker } = StickerPlugin;\n\nfunction createCalloutPlugin(config: BiPluginConfig): BiPlugin {\n  const { callout = {} } = config;\n  const { locale } = callout;\n  const stickerConfig = {\n    // @ts-ignore\n    lang: 'zh_CN',\n    // @ts-ignore\n    customSticker: [DEFAULT_STICKERS],\n    ...config.sticker,\n  };\n  const sticker = new Sticker(stickerConfig);\n  const params = {\n    stickerConfig,\n    sticker,\n    locale: callout.locale,\n  };\n\n  return {\n    ...moFactory({}),\n    renderNode: createRenderNode(params),\n    // Copy Cut 拦截作用于高亮块全选时\n    onCangjieCopy: onCangjieCopyOrCut,\n    onCangjieCut: onCangjieCopyOrCut,\n    onCangjieInput,\n    onCangjieSelect: createOnCangjieSelect(),\n    onQuery: createOnQuery(),\n    groupNodes: createGroupNodes(callout),\n    onAction: createOnAction(callout),\n    getNodeStyle: CalloutPlugin.getNodeStyle,\n    // 作用于高亮块全选态变化时重渲\n    // controller.value.data 变化可能不会引发重渲\n    shouldNodeComponentUpdate: (prevProps, props, __, next) => {\n      if (\n        props.value.data.selectedCallout !==\n          prevProps.value.data.selectedCallout &&\n        (props.node as Block).data?.calloutPr &&\n        (props.node.key === props.value.data.selectedCallout ||\n          props.node.key === prevProps.value.data.selectedCallout)\n      ) {\n        return true;\n      }\n      return next();\n    },\n    // @ts-ignore 这里是 createCommands\n    commands,\n    menubar,\n    onKeyDown,\n    queries,\n    placeholder: {\n      text: locale?.placeholder,\n      when: (controller, node) => {\n        return isEmptyParagraph(node) &&\n          controller.query('getCalloutStartBlock', node) === node &&\n          controller.query('getCalloutEndBlock', node) === node;\n      },\n    },\n    renderHoverToolbar: createRenderHoverToolbar(callout),\n    getSnippetConfig,\n  };\n}\n\ncreateCalloutPlugin.actions = actions;\n\nexport default createCalloutPlugin;\n"],"file":"index.js"}