{"version":3,"sources":["../../../../../src/plugins/callout/handlers/onDelete.ts"],"names":["isKeyHotkey","isEqual","deleteCallout","setCalloutSelected","onDelete","event","controller","next","value","document","data","startBlock","endBlock","selection","isBackspaceHotKey","selectedCallout","calloutPr","run","node","prevBlock","getPreviousBlock","key","isCollapsed","getStart","isAtStartOfNode","preventDefault"],"mappings":"AACA,OAAOA,WAAP,MAAwB,WAAxB;AACA,OAAOC,OAAP,MAAoB,iBAApB;AAEA,SAASC,aAAT,EAAwBC,kBAAxB;AAEA,eAAe,SAASC,QAAT,CACbC,KADa,EAEbC,UAFa,EAGbC,IAHa,EAIb;AAAA;;AAAA,MACQC,KADR,GACkBF,UADlB,CACQE,KADR;AAAA,MAEQC,QAFR,GAE4DD,KAF5D,CAEQC,QAFR;AAAA,MAEkBC,IAFlB,GAE4DF,KAF5D,CAEkBE,IAFlB;AAAA,MAEwBC,UAFxB,GAE4DH,KAF5D,CAEwBG,UAFxB;AAAA,MAEoCC,QAFpC,GAE4DJ,KAF5D,CAEoCI,QAFpC;AAAA,MAE8CC,SAF9C,GAE4DL,KAF5D,CAE8CK,SAF9C;AAIA,MAAMC,iBAAiB,GAAGd,WAAW,CAAC,WAAD,CAArC;;AAEA,MAAIU,IAAI,CAACK,eAAL,IAAwBH,QAAxB,8BAAwBA,QAAQ,CAAEF,IAAlC,aAAwB,eAAgBM,SAA5C,EAAuD;AACrD,WAAOV,UAAU,CAACW,GAAX,CAAe,UAAf,EAA2Bf,aAAa,CAAC;AAAEgB,MAAAA,IAAI,EAAEN;AAAR,KAAD,CAAxC,CAAP;AACD;;AAED,MAAMO,SAAS,GAAGR,UAAU,IAAIF,QAAQ,CAACW,gBAAT,CAA0BT,UAAU,CAACU,GAArC,CAAhC;;AACA,MACEF,SAAS,IAAIR,UAAb,IACGQ,SAAS,CAACT,IAAV,CAAeM,SADlB,CAEA;AAFA,KAGG,CAACf,OAAO,CAACU,UAAU,CAACD,IAAX,CAAgBM,SAAjB,EAA4BG,SAAS,CAACT,IAAV,CAAeM,SAA3C,CAHX,IAIGH,SAAS,CAACS,WAJb,IAKGT,SAAS,CAACU,QAAV,CAAmBd,QAAnB,EAA6Be,eAA7B,CAA6Cb,UAA7C,CALH,IAMGG,iBAAiB,CAACT,KAAD,CAPtB,EAQE;AACAA,IAAAA,KAAK,CAACoB,cAAN,GADA,CAGA;;AACAlB,IAAAA,IAAI,GAJJ,CAMA;;AACA,WAAOD,UAAU,CAACW,GAAX,CAAe,UAAf,EAA2Bd,kBAAkB,CAAC;AACnDe,MAAAA,IAAI,EAAEC;AAD6C,KAAD,CAA7C,CAAP;AAGD;;AAEDd,EAAAA,KAAK,CAACoB,cAAN;AAEA,SAAOlB,IAAI,EAAX;AACD","sourcesContent":["import * as React from 'react';\nimport isKeyHotkey from 'is-hotkey';\nimport isEqual from 'fast-deep-equal';\nimport { Controller } from '@ali/4ever-cangjie';\nimport { deleteCallout, setCalloutSelected } from '../actions';\n\nexport default function onDelete(\n  event: React.KeyboardEvent,\n  controller: Controller,\n  next: Function,\n) {\n  const { value } = controller;\n  const { document, data, startBlock, endBlock, selection } = value;\n\n  const isBackspaceHotKey = isKeyHotkey('backspace');\n\n  if (data.selectedCallout && endBlock?.data?.calloutPr) {\n    return controller.run('onAction', deleteCallout({ node: endBlock }));\n  }\n\n  const prevBlock = startBlock && document.getPreviousBlock(startBlock.key);\n  if (\n    prevBlock && startBlock\n    && prevBlock.data.calloutPr\n    // !startBlock.data.calloutPr 也包含在下面的条件中\n    && !isEqual(startBlock.data.calloutPr, prevBlock.data.calloutPr)\n    && selection.isCollapsed\n    && selection.getStart(document).isAtStartOfNode(startBlock)\n    && isBackspaceHotKey(event)\n  ) {\n    event.preventDefault();\n\n    // 正常删除行\n    next();\n\n    // 删除后选中高亮块\n    return controller.run('onAction', setCalloutSelected({\n      node: prevBlock,\n    }));\n  }\n\n  event.preventDefault();\n\n  return next();\n}\n"],"file":"onDelete.js"}