{"version":3,"sources":["../../../../../src/plugins/formatPainter/handlers/onMouseUp.ts"],"names":["pasteFormatAtRange","isParagraphBlock","onMouseUp","_","controller","next","value","tableSelection","query","formatClipboard","data","trigger","range","selection","isCollapsed","document","paragraph","getClosest","getStart","key","moveToRangeOfNode"],"mappings":"AACA,OAAOA,kBAAP;AACA,OAAOC,gBAAP;AAEA,eAAe,SAASC,SAAT,CAAmBC,CAAnB,EAAsBC,UAAtB,EAA8CC,IAA9C,EAAoD;AAAA,MACzDC,KADyD,GAC/CF,UAD+C,CACzDE,KADyD;AAEjE,MAAMC,cAAc,GAAGH,UAAU,CAACI,KAAX,CAAiB,mBAAjB,CAAvB;;AACA,MAAID,cAAJ,EAAoB;AAClB,WAAOF,IAAI,EAAX;AACD;;AAED,MAAMI,eAAe,GAAGH,KAAK,CAACI,IAAN,CAAWD,eAAnC;;AACA,MAAI,CAACA,eAAD,IAAoBA,eAAe,CAACE,OAAhB,KAA4B,SAApD,EAA+D;AAC7D,WAAON,IAAI,EAAX;AACD,GAVgE,CAYjE;;;AAZiE,MAahDO,KAbgD,GAatCN,KAbsC,CAa3DO,SAb2D;;AAcjE,MAAID,KAAK,CAACE,WAAV,EAAuB;AAAA,QACbC,QADa,GACAT,KADA,CACbS,QADa;AAErB,QAAMC,SAAS,GAAGD,QAAQ,CAACE,UAAT,CAAoBL,KAAK,CAACM,QAAN,CAAeH,QAAf,EAAyBI,GAA7C,EAAkDlB,gBAAlD,CAAlB;;AACA,QAAI,CAACe,SAAL,EAAgB;AACd,aAAOX,IAAI,EAAX;AACD,KALoB,CAMrB;;;AACAO,IAAAA,KAAK,GAAGA,KAAK,CAACQ,iBAAN,CAAwBJ,SAAxB,EAAmCZ,UAAnC,CAAR;AACD;;AAED,SAAOJ,kBAAkB,CAACI,UAAD,EAAaQ,KAAb,CAAzB;AACD","sourcesContent":["import { Controller } from '@ali/4ever-cangjie';\nimport pasteFormatAtRange from '../commands/pasteFormatAtRange';\nimport isParagraphBlock from '../utils/isParagraphBlock';\n\nexport default function onMouseUp(_, controller: Controller, next) {\n  const { value } = controller;\n  const tableSelection = controller.query('hasTableSelection');\n  if (tableSelection) {\n    return next();\n  }\n\n  const formatClipboard = value.data.formatClipboard;\n  if (!formatClipboard || formatClipboard.trigger !== 'toolbar') {\n    return next();\n  }\n\n  // NOTE: Do not need `event.preventDefault()`.\n  let { selection: range } = value;\n  if (range.isCollapsed) {\n    const { document } = value;\n    const paragraph = document.getClosest(range.getStart(document).key, isParagraphBlock);\n    if (!paragraph) {\n      return next();\n    }\n    // TODO: 这里直接将整段都格式化，office上是仅格式化分段\n    range = range.moveToRangeOfNode(paragraph, controller);\n  }\n\n  return pasteFormatAtRange(controller, range);\n}\n"],"file":"onMouseUp.js"}