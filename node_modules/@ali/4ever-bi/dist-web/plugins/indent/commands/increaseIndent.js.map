{"version":3,"sources":["../../../../../src/plugins/indent/commands/increaseIndent.ts"],"names":["Commands","getClosestParagraph","getBlocksFromEditor","increaseListLevel","INDENT_SIZE","MAX_INDENT_SIZE","MAX_INDENT_SIZE_CHARS","INDENT_SIZE_CHARS","DEFAULT_INDENT","IndentTrigger","isEqualWithDefault","editor","trigger","givenValue","value","indentVal","undefined","selectedBlocks","query","depthItems","hasFirstStart","forEach","node","indentNode","indentNodeData","data","list","ind","nextInd","firstLine","firstLineChars","left","leftChars","hanging","hangingChars","firstLineIndent","hangingIndent","keyboard","realLeft","Math","min","command","setNodeByKey","key"],"mappings":";AAAA,SAAqBA,QAArB,QAAqC,oBAArC;AAEA,SAASC,mBAAT,QAAoC,kBAApC;AACA,SAASC,mBAAT,QAAqC,kBAArC;AACA,SAASC,iBAAT;AACA,SACEC,WADF,EAEEC,eAFF,EAGEC,qBAHF,EAIEC,iBAJF,EAKEC,cALF,EAMEC,aANF;AAQA,SAASC,kBAAT,QAAmC,kBAAnC;AAGA,gBAAe,UAACC,MAAD,EAAqBC,OAArB,EAA8CC,UAA9C,EAAsE;AAAA,MAC3EC,KAD2E,GACjEH,MADiE,CAC3EG,KAD2E;AAEnF,MAAMC,SAAS,GAAGF,UAAU,KAAKG,SAAf,GAA2BH,UAA3B,GAAwCT,WAA1D;AAEA,MAAIa,cAAc,GAAGf,mBAAmB,CAACS,MAAD,CAAxC;;AAJmF,aAK5CA,MAAM,CAACO,KAAP,CAAa,mBAAb,KAAqC,EALO;AAAA,MAK3EC,UAL2E,QAK3EA,UAL2E;AAAA,MAK/DC,aAL+D,QAK/DA,aAL+D;;AAMnF,MAAIA,aAAJ,EAAmB;AACjBH,IAAAA,cAAc,GAAGE,UAAjB;AACD;;AACDF,EAAAA,cAAc,CAACI,OAAf,CAAuB,UAACC,IAAD,EAAU;AAC/B,QAAMC,UAAU,GAAGtB,mBAAmB,CAACa,KAAD,EAAQQ,IAAR,CAAtC;;AACA,QAAIC,UAAJ,EAAgB;AACd,UAAMC,cAAc,GAAGD,UAAU,CAACE,IAAX,IAAmB,EAA1C;AADc,UAENC,IAFM,GAEGF,cAFH,CAENE,IAFM;;AAId,UAAIA,IAAJ,EAAU;AACR,eAAOvB,iBAAiB,CAACQ,MAAD,EAASY,UAAT,EAAqBH,aAArB,CAAxB;AACD;;AACD,UAAMO,GAAG,GAAIH,cAAc,CAACG,GAAf,IAAsB,EAAnC,CAPc,CAO8C;;AAC5D,UAAMC,OAAyB,gBAAQD,GAAR,CAA/B;;AARc,2BAgBVA,GAhBU,CAUZE,SAVY;AAAA,UAUZA,SAVY,+BAUA,CAVA;AAAA,gCAgBVF,GAhBU,CAWZG,cAXY;AAAA,UAWZA,cAXY,oCAWK,CAXL;AAAA,sBAgBVH,GAhBU,CAYZI,IAZY;AAAA,UAYZA,IAZY,0BAYL,CAZK;AAAA,2BAgBVJ,GAhBU,CAaZK,SAbY;AAAA,UAaZA,SAbY,+BAaA,CAbA;AAAA,yBAgBVL,GAhBU,CAcZM,OAdY;AAAA,UAcZA,OAdY,6BAcF,CAdE;AAAA,8BAgBVN,GAhBU,CAeZO,YAfY;AAAA,UAeZA,YAfY,kCAeG,CAfH;AAiBd,UAAMC,eAAe,GAAGL,cAAc,IAAID,SAA1C;AACA,UAAMO,aAAa,GAAGF,YAAY,IAAID,OAAhB,IAA2BJ,SAAS,GAAG,CAA7D;;AAEA,cAAQjB,OAAR;AACE,aAAKH,aAAa,CAAC4B,QAAnB;AACE,cAAID,aAAJ,EAAmB;AACjB;AACA;AACA;AACA,mBAAOR,OAAO,CAACK,OAAf;AACA,mBAAOL,OAAO,CAACM,YAAf;;AACA,gBAAIL,SAAS,GAAG,CAAhB,EAAmB;AACjB,qBAAOD,OAAO,CAACC,SAAf;AACD,aARgB,CASjB;;;AACA,gBAAMS,QAAQ,GAAGJ,YAAY,GAAGF,SAAH,GAAgBA,SAAS,IAAID,IAA1D;;AACA,gBAAI,CAACO,QAAL,EAAe;AACbV,cAAAA,OAAO,CAACG,IAAR,GAAe3B,WAAf;AACD;AACF,WAdD,MAcO,IAAI,CAAC+B,eAAL,EAAsB;AAC3B;AACAP,YAAAA,OAAO,CAACC,SAAR,GAAoBzB,WAApB;AACD,WAHM,MAGA,IAAI4B,SAAJ,EAAe;AACpB;AACAJ,YAAAA,OAAO,CAACI,SAAR,GAAoBO,IAAI,CAACC,GAAL,CAASR,SAAS,GAAGzB,iBAArB,EAAwCD,qBAAxC,CAApB;AACAsB,YAAAA,OAAO,CAACG,IAAR,GAAeH,OAAO,CAACI,SAAR,GAAoBzB,iBAApB,GAAwCH,WAAvD;AACD,WAJM,MAIA;AACLwB,YAAAA,OAAO,CAACG,IAAR,GAAeQ,IAAI,CAACC,GAAL,CAAST,IAAI,GAAG3B,WAAhB,EAA6BC,eAA7B,CAAf;AACD;;AACD;;AACF;AACE,cAAI+B,aAAa,IAAIJ,SAArB,EAAgC;AAC9B;AACAJ,YAAAA,OAAO,CAACI,SAAR,GAAoBO,IAAI,CAACC,GAAL,CAASR,SAAS,GAAGzB,iBAArB,EAAwCD,qBAAxC,CAApB;AACAsB,YAAAA,OAAO,CAACG,IAAR,GAAeH,OAAO,CAACI,SAAR,GAAoBzB,iBAApB,GAAwCH,WAAvD;AACD,WAJD,MAIO;AACLwB,YAAAA,OAAO,CAACG,IAAR,GAAeQ,IAAI,CAACC,GAAL,CAAST,IAAI,GAAGhB,SAAhB,EAA2BV,eAA3B,CAAf;AACD;;AAlCL;;AAqCA,UAAIK,kBAAkB,CAACkB,OAAD,EAAUD,GAAV,EAAenB,cAAf,CAAtB,EAAsD;AACpD,eAAOQ,SAAP;AACD;;AACDL,MAAAA,MAAM,CAAC8B,OAAP,CAAezC,QAAQ,CAAC0C,YAAxB,EAAsCnB,UAAU,CAACoB,GAAjD,EAAsD;AACpDlB,QAAAA,IAAI,eACCD,cADD;AAEFG,UAAAA,GAAG,EAAEC;AAFH;AADgD,OAAtD;AAMD;;AACD,WAAOZ,SAAP;AACD,GAtED;AAwEA,SAAOL,MAAP;AACD,CAlFD","sourcesContent":["import { Controller, Commands } from '@ali/4ever-cangjie';\nimport { IndentProperties } from '@ali/4ever-mo';\nimport { getClosestParagraph } from '@ali/4ever-utils';\nimport { getBlocksFromEditor }  from '@ali/4ever-utils';\nimport { increaseListLevel } from '../utils/setListLevelByIntent';\nimport {\n  INDENT_SIZE,\n  MAX_INDENT_SIZE,\n  MAX_INDENT_SIZE_CHARS,\n  INDENT_SIZE_CHARS,\n  DEFAULT_INDENT,\n  IndentTrigger,\n} from '../utils';\nimport { isEqualWithDefault } from '@ali/4ever-utils';\n\n\nexport default (editor: Controller, trigger?: IndentTrigger, givenValue?: number) => {\n  const { value } = editor;\n  const indentVal = givenValue !== undefined ? givenValue : INDENT_SIZE;\n\n  let selectedBlocks = getBlocksFromEditor(editor);\n  const { depthItems, hasFirstStart } =  editor.query('getListDepthItems') || {};\n  if (hasFirstStart) {\n    selectedBlocks = depthItems;\n  }\n  selectedBlocks.forEach((node) => {\n    const indentNode = getClosestParagraph(value, node);\n    if (indentNode) {\n      const indentNodeData = indentNode.data || {};\n      const { list } = indentNodeData;\n\n      if (list) {\n        return increaseListLevel(editor, indentNode, hasFirstStart!);\n      }\n      const ind = (indentNodeData.ind || {}) as IndentProperties; // data.ind can be null\n      const nextInd: IndentProperties = { ...ind };\n      const {\n        firstLine = 0,\n        firstLineChars = 0,\n        left = 0,\n        leftChars = 0,\n        hanging = 0,\n        hangingChars = 0,\n      } = ind;\n      const firstLineIndent = firstLineChars || firstLine;\n      const hangingIndent = hangingChars || hanging || firstLine < 0;\n\n      switch (trigger) {\n        case IndentTrigger.keyboard:\n          if (hangingIndent) {\n            // 取消悬挂缩进\n            // 如果已经存在 leftChars 则保留左缩进\n            // 否则增加左侧缩进，@wps/word\n            delete nextInd.hanging;\n            delete nextInd.hangingChars;\n            if (firstLine < 0) {\n              delete nextInd.firstLine;\n            }\n            // hangingChars 存在时 left 会被忽略\n            const realLeft = hangingChars ? leftChars : (leftChars || left);\n            if (!realLeft) {\n              nextInd.left = INDENT_SIZE;\n            }\n          } else if (!firstLineIndent) {\n            // 首先增加首行缩进\n            nextInd.firstLine = INDENT_SIZE;\n          } else if (leftChars) {\n            // 增加两字符\n            nextInd.leftChars = Math.min(leftChars + INDENT_SIZE_CHARS, MAX_INDENT_SIZE_CHARS);\n            nextInd.left = nextInd.leftChars / INDENT_SIZE_CHARS * INDENT_SIZE;\n          } else {\n            nextInd.left = Math.min(left + INDENT_SIZE, MAX_INDENT_SIZE);\n          }\n          break;\n        default:\n          if (hangingIndent || leftChars) {\n            // 悬挂缩进存在时需要增加 leftChars\n            nextInd.leftChars = Math.min(leftChars + INDENT_SIZE_CHARS, MAX_INDENT_SIZE_CHARS);\n            nextInd.left = nextInd.leftChars / INDENT_SIZE_CHARS * INDENT_SIZE;\n          } else {\n            nextInd.left = Math.min(left + indentVal, MAX_INDENT_SIZE);\n          }\n      }\n\n      if (isEqualWithDefault(nextInd, ind, DEFAULT_INDENT)) {\n        return undefined;\n      }\n      editor.command(Commands.setNodeByKey, indentNode.key, {\n        data: {\n          ...indentNodeData,\n          ind: nextInd,\n        },\n      });\n    }\n    return undefined;\n  });\n\n  return editor;\n};\n"],"file":"increaseIndent.js"}