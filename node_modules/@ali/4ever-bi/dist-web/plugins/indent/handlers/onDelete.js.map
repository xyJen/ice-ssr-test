{"version":3,"sources":["../../../../../src/plugins/indent/handlers/onDelete.ts"],"names":["Commands","Code","decreaseIndent","getClosestParagraph","IndentTrigger","onDelete","event","editor","next","value","document","selection","isExpanded","startText","isCode","startOffset","convertToTextPoints","start","offset","prevText","text","slice","preventDefault","command","removeTextByKey","key","currentParagraph","isDeleteAtFirstChar","anchor","isAtStartOfNode","ind","data","hasLeftInd","leftChars","left","firstLine","firstLineChars","hanging","hangingChars","keyboard"],"mappings":"AAAA,SAAqBA,QAArB,QAAqC,oBAArC;AACA,SAASC,IAAT,QAAqB,eAArB;AACA,OAAOC,cAAP;AACA,SAASC,mBAAT,QAAoC,kBAApC;AACA,SAASC,aAAT;AAEA,eAAe,SAASC,QAAT,CAAkBC,KAAlB,EAAyBC,MAAzB,EAA6CC,IAA7C,EAAmD;AAAA,MACxDC,KADwD,GAC9CF,MAD8C,CACxDE,KADwD;AAAA,MAExDC,QAFwD,GAE3CD,KAF2C,CAExDC,QAFwD;AAAA,MAGxDC,SAHwD,GAG1CF,KAH0C,CAGxDE,SAHwD;;AAIhE,MAAIA,SAAJ,YAAIA,SAAS,CAAEC,UAAf,EAA2B;AACzB,WAAOJ,IAAI,EAAX;AACD;;AAN+D,MAQxDK,SARwD,GAQ1CJ,KAR0C,CAQxDI,SARwD,EAShE;;AACA,MAAIZ,IAAI,CAACa,MAAL,CAAYD,SAAZ,CAAJ,EAA4B;AAC1B,WAAOL,IAAI,EAAX;AACD;;AACD,MAAMO,WAAW,GAAGJ,SAAS,CAAEK,mBAAX,CAA+BN,QAA/B,EAAyCO,KAAzC,CAA+CC,MAAnE;;AAEA,MAAIH,WAAW,GAAG,CAAlB,EAAqB;AACnB,QAAIA,WAAW,GAAG,CAAlB,EAAqB;AACnB,aAAOP,IAAI,EAAX;AACD;;AAED,QAAMW,QAAQ,GAAGN,SAAS,GAAGA,SAAS,CAACO,IAAV,CAAeC,KAAf,CAAqBN,WAAW,GAAG,CAAnC,EAAsCA,WAAtC,CAAH,GAAwD,EAAlF;;AACA,QAAII,QAAQ,KAAK,MAAjB,EAAyB;AACvB,aAAOX,IAAI,EAAX;AACD;AAED;;;AACAF,IAAAA,KAAK,CAACgB,cAAN;AACA,WAAOf,MAAM,CAACgB,OAAP,CAAevB,QAAQ,CAACwB,eAAxB,EAAyCX,SAAS,GAAGA,SAAS,CAACY,GAAb,GAAmB,EAArE,EAAyEV,WAAW,GAAG,CAAvF,EAA0F,MAA1F,CAAP;AACD;AAED;;;AACA,MAAMW,gBAAgB,GAAGvB,mBAAmB,CAACM,KAAD,CAA5C;;AACA,MAAI,CAACiB,gBAAL,EAAuB;AACrB,WAAOlB,IAAI,EAAX;AACD;;AAED,MAAMmB,mBAAmB,GAAGhB,SAAS,CAAEiB,MAAX,CAAkBC,eAAlB,CAAkCH,gBAAlC,CAA5B;;AACA,MAAI,CAACC,mBAAL,EAA0B;AACxB,WAAOnB,IAAI,EAAX;AACD;;AAvC+D,MAyCxDsB,GAzCwD,GAyChDJ,gBAAgB,CAACK,IAzC+B,CAyCxDD,GAzCwD;;AA0ChE,MAAI,CAACA,GAAL,EAAU;AACR,WAAOtB,IAAI,EAAX;AACD;;AACD,MAAMwB,UAAU,GAAGF,GAAG,CAACG,SAAJ,IAAiBH,GAAG,CAACI,IAArB,IAA6BJ,GAAG,CAACK,SAAjC,IAA8CL,GAAG,CAACM,cAAlD,IAAoEN,GAAG,CAACO,OAAxE,IAAmFP,GAAG,CAACQ,YAA1G;;AACA,MAAI,CAACN,UAAL,EAAiB;AACf,WAAOxB,IAAI,EAAX;AACD;;AAEDF,EAAAA,KAAK,CAACgB,cAAN;AACA,SAAOpB,cAAc,CAACK,MAAD,EAASH,aAAa,CAACmC,QAAvB,CAArB;AACD","sourcesContent":["import { Controller, Commands } from '@ali/4ever-cangjie';\nimport { Code } from '@ali/4ever-mo';\nimport decreaseIndent from '../commands/decreaseIndent';\nimport { getClosestParagraph } from '@ali/4ever-utils';\nimport { IndentTrigger } from '../utils';\n\nexport default function onDelete(event, editor: Controller, next) {\n  const { value } = editor;\n  const { document } = value;\n  const { selection } = value;\n  if (selection?.isExpanded) {\n    return next();\n  }\n\n  const { startText } = value;\n  // 代码块因为不是 void(历史原因)，当内容末尾是 4 个空格时，要跳过这段逻辑\n  if (Code.isCode(startText)) {\n    return next();\n  }\n  const startOffset = selection!.convertToTextPoints(document).start.offset;\n\n  if (startOffset > 0) {\n    if (startOffset < 4) {\n      return next();\n    }\n\n    const prevText = startText ? startText.text.slice(startOffset - 4, startOffset) : '';\n    if (prevText !== '    ') {\n      return next();\n    }\n\n    /* 若前面有四个连续空格，则删除 */\n    event.preventDefault();\n    return editor.command(Commands.removeTextByKey, startText ? startText.key : '', startOffset - 4, '    ');\n  }\n\n  /* 在行首 backspace/delete 撤销缩进 */\n  const currentParagraph = getClosestParagraph(value);\n  if (!currentParagraph) {\n    return next();\n  }\n\n  const isDeleteAtFirstChar = selection!.anchor.isAtStartOfNode(currentParagraph);\n  if (!isDeleteAtFirstChar) {\n    return next();\n  }\n\n  const { ind } = currentParagraph.data;\n  if (!ind) {\n    return next();\n  }\n  const hasLeftInd = ind.leftChars || ind.left || ind.firstLine || ind.firstLineChars || ind.hanging || ind.hangingChars;\n  if (!hasLeftInd) {\n    return next();\n  }\n\n  event.preventDefault();\n  return decreaseIndent(editor, IndentTrigger.keyboard);\n}\n"],"file":"onDelete.js"}