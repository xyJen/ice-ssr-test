import { Commands } from '@ali/4ever-cangjie';
import { List } from '@ali/4ever-plugin-list';
import { getCurrentBlocks, getRangeFromNodes, cloneData } from "../utils";

var setParagraphColor = function setParagraphColor(controller, payload) {
  var currentBlock = payload.node,
      color = payload.color;
  var blocks = getCurrentBlocks(controller, currentBlock.key);

  if (Array.isArray(blocks) && blocks.length > 0) {
    blocks.forEach(function (node) {
      var data = node.data;

      if (List.isList(node)) {
        // 列表拦截 SET_COLOR 设置列表符号颜色高度依赖 controller.selection
        // 所以这里手动处理下列表符号的颜色
        var newData = cloneData(data);
        newData.list.symbolStyle.color = color;
        controller.command(Commands.setNodeByKey, node.key, {
          data: newData
        });
      }
    });
    var range = getRangeFromNodes(controller, blocks);
    controller.dispatch('setColorAtRange', range, color);
  }

  return controller;
};

export default setParagraphColor;
//# sourceMappingURL=setParagraphColor.js.map