{"version":3,"sources":["../../../../../src/plugins/calendarCard/components/Calendar.tsx"],"names":["React","useCallback","useState","useMemo","Debug","CalendarCardPlugin","Container","FlashCalendarContainer","CalendarType","setCardInjection","setCardData","calculatedSize","getCalculatedReceivers","calculatedCalendarSize","getCalculatedCalendarReceivers","useRefreshResult","useRenderCalendarBtn","isEqualValue","useInit","debug","CALENDAR_CARD_MIN_HEIGHT","Calendar","nodeProps","controller","calendarConfig","locale","jumpToCalendar","openProfile","jumpToAttachment","onRefreshSuccess","refresh","isMobile","getContainerWidthInPC","handleCreateCalendar","onInitData","CreateCalendarBtn","renderCreateCalendarBtn","calendarMode","mode","isFocused","value","containerWidthInPC","node","isSelected","nodeKey","key","finalData","data","finalHeight","height","injectionMetadata","injectionHeight","isFirstLoaded","metadata","isInitialized","isPlaceholder","finalMetadata","calendarId","redirectUrl","isLoading","setLoading","isShanhui","SHANHUI","refreshTipsNode","setRefreshResult","injectToData","mergeData","latestNode","document","getNode","run","setCalendarCardData","newMetadata","calculateHeight","withoutSaving","CalendarBtn","createCalendarBtn","processCreateCalendar","goToCalendar","eventType","setRefreshDataToNode","undefined","fireRefresh","event","preventDefault","stopPropagation","then","res","status","getTopReceivers","totalCount","topReceivers","getLoadingState"],"mappings":"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","sourcesContent":["import React, { useCallback, useState, useMemo } from 'react';\nimport Debug from 'debug';\nimport { CalendarCardPlugin } from '@ali/4ever-bamboo';\nimport { Controller, RenderNodeProps, Block } from '@ali/4ever-cangjie';\nimport Container from '../components/Container';\nimport FlashCalendarContainer from '../shanhui/FlashCalendarContainer';\nimport {\n  CalendarCardDataType,\n  CalendarCardMetadataType,\n  CalendarCardPluginConfig,\n  CommonMouseEvent,\n  JumpToCalendarEventType,\n  CalendarInjectionType,\n  CalendarType,\n} from '../types';\nimport { setCardInjection, setCardData } from '@ali/4ever-factory';\nimport { calculatedSize, getCalculatedReceivers } from '../utils/calculatedSize';\nimport { calculatedCalendarSize, getCalculatedCalendarReceivers } from '../shanhui/calculatedCalendarSize';\nimport useRefreshResult from '../hooks/useRefreshResult';\nimport useRenderCalendarBtn from '../hooks/useRenderCalendarBtn';\nimport isEqualValue from '../utils/isEqualValue';\nimport useInit from '../hooks/useInit';\n\nconst debug = Debug('EDITOR:BI:CALENDAR:RENDER');\n\nconst { CALENDAR_CARD_MIN_HEIGHT } = CalendarCardPlugin;\n\ninterface IProps {\n  nodeProps: RenderNodeProps<Block>;\n  controller: Controller;\n  calendarConfig: CalendarCardPluginConfig;\n}\n\nexport const Calendar: React.FC<IProps> = ({\n  nodeProps,\n  controller,\n  calendarConfig,\n}) => {\n  const {\n    locale,\n    jumpToCalendar,\n    openProfile,\n    jumpToAttachment,\n    onRefreshSuccess,\n    refresh,\n    isMobile,\n    getContainerWidthInPC = () => 0,\n    handleCreateCalendar,\n    onInitData,\n    renderCreateCalendarBtn: CreateCalendarBtn,\n    mode: calendarMode,\n  } = calendarConfig;\n  const { isFocused } = controller.value;\n  const containerWidthInPC = useMemo(() => {\n    return getContainerWidthInPC() - 4;\n  }, [getContainerWidthInPC]);\n  const { node, isSelected } = nodeProps;\n  const nodeKey = node.key;\n  const finalData = node.data as CalendarCardDataType;\n  const finalHeight = isMobile ? 'auto' : (finalData.height || CALENDAR_CARD_MIN_HEIGHT);\n  const { injectionMetadata, injectionHeight, isFirstLoaded = !!isMobile } = finalData as CalendarInjectionType;\n  const { isInitialized, isPlaceholder, mode = calendarMode } = finalData.metadata;\n  const finalMetadata = injectionMetadata || finalData.metadata;\n  const { calendarId, redirectUrl } = finalMetadata;\n  const [isLoading, setLoading] = useState<boolean>(false);\n  const isShanhui = mode === CalendarType.SHANHUI;\n\n  // 点击刷新按钮后的消息反馈\n  const { refreshTipsNode, setRefreshResult } = useRefreshResult();\n\n  const injectToData = useCallback((mergeData: CalendarInjectionType) => {\n    const latestNode = controller.value.document.getNode(node.key) as Block;\n    controller.run('onAction', setCardInjection(latestNode, { injectionMetadata, injectionHeight, isFirstLoaded, ...mergeData }));\n  }, [controller, node.key, injectionMetadata, injectionHeight, isFirstLoaded]);\n\n  // 设置日程卡片 data\n  const setCalendarCardData = useCallback(async (newMetadata: CalendarCardMetadataType) => {\n    const calculateHeight = isShanhui ? calculatedCalendarSize : calculatedSize;\n    const height = await calculateHeight(newMetadata, containerWidthInPC);\n    const latestNode = controller.value.document.getNode(node.key) as Block;\n    controller.run('onAction', setCardData(latestNode, {\n      metadata: { ...newMetadata, mode, isInitialized: true },\n      height,\n      withoutSaving: true,\n    }));\n  }, [containerWidthInPC, controller, node.key, mode, isShanhui]);\n\n  // 创建右上角日程按钮\n  const [createCalendarBtn] = useRenderCalendarBtn({\n    isPlaceholder,\n    calendarId,\n    containerWidthInPC,\n    finalMetadata,\n    injectToData,\n    setLoading,\n    setCalendarCardData,\n    CalendarBtn: CreateCalendarBtn,\n    key: nodeKey,\n  });\n\n  // 点击创建日程按钮\n  const processCreateCalendar = useCallback(() => {\n    if (handleCreateCalendar) handleCreateCalendar(nodeKey);\n  }, [handleCreateCalendar, nodeKey]);\n\n  // 调整到日程容器\n  const goToCalendar = useCallback((eventType?: JumpToCalendarEventType) => {\n    if (!jumpToCalendar || !redirectUrl) return;\n    jumpToCalendar(redirectUrl, eventType);\n  }, [jumpToCalendar, redirectUrl]);\n\n  // 将日程数据持久化存储到卡片中\n  const setRefreshDataToNode = useCallback(() => {\n    if (injectionMetadata) {\n      const latestNode = controller.value.document.getNode(node.key) as Block;\n      controller.run('onAction', setCardData(latestNode, {\n        metadata: { ...injectionMetadata, mode, isInitialized: true },\n        height: injectionHeight,\n        withoutSaving: true,\n      }));\n      injectToData({\n        injectionMetadata: undefined,\n        injectionHeight: undefined,\n        isFirstLoaded: true,\n      });\n      if (onRefreshSuccess) onRefreshSuccess();\n    }\n  }, [injectionMetadata, controller, node.key, mode, injectionHeight, injectToData, onRefreshSuccess]);\n\n  const fireRefresh: CommonMouseEvent = useCallback((event) => {\n    event.preventDefault();\n    event.stopPropagation();\n    if (!refresh) return;\n    if (injectionMetadata) {\n      setRefreshDataToNode();\n      return;\n    }\n    setLoading(true);\n    refresh(calendarId, 'click').then(async (res) => {\n      setLoading(false);\n      if (res.status !== 'success') return;\n      if (!containerWidthInPC) return;\n      const getTopReceivers = isShanhui ? getCalculatedCalendarReceivers : getCalculatedReceivers;\n      const topReceivers = await getTopReceivers(res.data!, containerWidthInPC, res.data!.totalCount!);\n      const newMetadata = {\n        calendarId,\n        ...res.data,\n        topReceivers,\n      };\n      if (!isEqualValue(newMetadata, finalMetadata)) {\n        setCalendarCardData(newMetadata);\n      }\n      if (onRefreshSuccess) onRefreshSuccess();\n    }).catch(() => {\n      setLoading(false);\n    });\n  }, [\n    refresh,\n    injectionMetadata,\n    calendarId,\n    setRefreshDataToNode,\n    containerWidthInPC,\n    isShanhui,\n    finalMetadata,\n    onRefreshSuccess,\n    setCalendarCardData,\n  ]);\n\n  const getLoadingState = useCallback(() => {\n    debug('LOADINGSTATE', isFirstLoaded, isLoading);\n    return !isFirstLoaded ? true : isLoading;\n  }, [isFirstLoaded, isLoading]);\n\n  useInit({\n    isInitialized,\n    isPlaceholder,\n    containerWidthInPC,\n    isLoading,\n    isFirstLoaded,\n    isMobile,\n    calendarId,\n    setLoading,\n    refresh,\n    controller,\n    node,\n    finalMetadata,\n    finalData,\n    injectToData,\n    setRefreshResult,\n    onInitData,\n    mode,\n  });\n\n\n  if (isShanhui) {\n    return (\n      <FlashCalendarContainer\n        refreshTipsNode={refreshTipsNode}\n        height={finalHeight}\n        isLoading={isLoading}\n        isFirstLoaded={isFirstLoaded}\n        isChangeData={!!injectionMetadata}\n        metadata={{ ...finalMetadata, mode }}\n        locale={locale}\n        isSelected={isSelected && isFocused}\n        width={containerWidthInPC}\n        jumpToCalendar={goToCalendar}\n        openProfile={openProfile}\n        jumpToAttachment={jumpToAttachment}\n        refresh={fireRefresh}\n        isMobile={isMobile}\n        handleCreateCalendar={processCreateCalendar}\n        createCalendarBtn={createCalendarBtn}\n      />\n    );\n  }\n\n  return (\n    <Container\n      refreshTipsNode={refreshTipsNode}\n      height={finalHeight}\n      isLoading={getLoadingState()}\n      isFirstLoaded={isFirstLoaded}\n      isChangeData={!!injectionMetadata}\n      metadata={finalData.metadata}\n      locale={locale}\n      isSelected={isSelected && isFocused}\n      width={containerWidthInPC}\n      jumpToCalendar={goToCalendar}\n      openProfile={openProfile}\n      jumpToAttachment={jumpToAttachment}\n      refresh={fireRefresh}\n      isMobile={isMobile}\n      handleCreateCalendar={processCreateCalendar}\n      createCalendarBtn={createCalendarBtn}\n    />\n  );\n}\n\nexport default Calendar;\n"],"file":"Calendar.js"}