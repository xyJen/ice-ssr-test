{"version":3,"sources":["../../../../../src/plugins/calendarCard/components/Container.tsx"],"names":["React","useCallback","useMemo","isNumber","throttle","memoize","classnames","CalendarCardPlugin","JumpToCalendarEventType","SubjectPlaceholder","TimePlaceholder","SubjectParagraph","TimeTextParagraph","PlaceTextParagraph","ReceiversParagraph","CommentTextParagraph","LoadingWrapper","ContainerWrapper","BodyWrapper","ExtraArea","CommentTextWrapper","CALENDAR_CARD_MAX_RECEIVER_WIDTH","CALENDAR_CARD_PADDING_LEN","renderLoadingWrapper","props","widthRange","isLoading","text","throttleHandleStopPropagation","event","stopPropagation","leading","Container","memo","locale","metadata","width","isSelected","jumpToCalendar","openProfile","refresh","isMobile","isFirstLoaded","isChangeData","refreshTipsNode","handleCreateCalendar","createCalendarBtn","currentLoading","time","place","comment","subject","isPlaceholder","viewCalendardetails","refreshToast","refreshTips","innerWidth","undefined","subjectRange","containerStyle","height","jumpToCalendarFactory","eventType","DOUBLECLICK","handleStopPropagation","persist","className","placeholder","subjectNode","subjectInnerWidth","timeNode","TITLE","RECEIVER","ICON"],"mappings":"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","sourcesContent":["import React, { useCallback, ReactNode, CSSProperties, useMemo } from 'react';\nimport { isNumber, throttle, memoize } from 'lodash-es';\nimport classnames from 'classnames';\nimport { CalendarCardPlugin } from '@ali/4ever-bamboo';\nimport { CalendarCardMetadataType, CommonMouseEvent, JumpToCalendarEventType } from '../types';\n\nconst {\n  SubjectPlaceholder,\n  TimePlaceholder,\n  SubjectParagraph,\n  TimeTextParagraph,\n  PlaceTextParagraph,\n  ReceiversParagraph,\n  CommentTextParagraph,\n  LoadingWrapper,\n  ContainerWrapper,\n  BodyWrapper,\n  ExtraArea,\n  CommentTextWrapper,\n  CALENDAR_CARD_MAX_RECEIVER_WIDTH,\n  CALENDAR_CARD_PADDING_LEN,\n} = CalendarCardPlugin;\n\ninterface IProps {\n  locale?: {\n    refresh: string;\n    refreshTips: string; // 日程卡片有更新\n    receiverCount: string; // 等{count}人参会\n    viewCalendardetails: string; // 查看日程详情\n    noresponse: string; // 未响应\n    received: string; // 已接收\n    refused: string; // 已拒绝\n    pending: string; // 待定\n    organizer: string; // 组织人\n  };\n  isChangeData?: boolean; // 有更新数据\n  isMobile?: boolean;\n  isFirstLoaded?: boolean;\n  isLoading?: boolean;\n  height: 'auto' | number;\n  width?: number;\n  isSelected?: boolean;\n  metadata?: CalendarCardMetadataType;\n  jumpToCalendar?: (eventType?: JumpToCalendarEventType) => void;\n  openProfile?: (uid: number) => void;\n  jumpToAttachment?: (url: string) => void;\n  refresh?: CommonMouseEvent;\n  handleCreateCalendar: () => void;\n  createCalendarBtn?: () => ReactNode;\n  refreshTipsNode?: string | ReactNode | null;\n}\n\ninterface IBizLoadingProps {\n  widthRange: string;\n  isLoading?: boolean;\n  text?: string | ReactNode;\n}\n\nconst renderLoadingWrapper = (props: IBizLoadingProps): ReactNode | string => {\n  const { widthRange, isLoading, text } = props;\n  if (isLoading && !text) return (<LoadingWrapper widthRange={widthRange} />);\n  return text || null;\n};\n\nconst throttleHandleStopPropagation = throttle((event: React.SyntheticEvent) => {\n  event.stopPropagation();\n}, 150, { leading: true });\n\nconst Container: React.FC<IProps> = React.memo((props) => {\n  const {\n    locale,\n    metadata,\n    width,\n    isSelected,\n    jumpToCalendar,\n    openProfile,\n    refresh,\n    isMobile,\n    isFirstLoaded,\n    isLoading,\n    isChangeData,\n    refreshTipsNode,\n    handleCreateCalendar,\n    createCalendarBtn,\n  } = props;\n  let currentLoading = isLoading;\n  if (isMobile || isFirstLoaded) currentLoading = false;\n  const { time, place, comment, subject = '', isPlaceholder } = metadata || {};\n  const { viewCalendardetails, refresh: refreshToast, refreshTips } = locale || {};\n\n  const innerWidth: 'auto' | number = (width === undefined || isMobile) ? 'auto' : (width - CALENDAR_CARD_PADDING_LEN * 2);\n  const subjectRange: number = isNumber(width) ? width : CALENDAR_CARD_MAX_RECEIVER_WIDTH;\n\n  const containerStyle = useMemo<CSSProperties>(() => ({\n    height: 'auto',\n    width: 'auto',\n  }), []);\n\n  const jumpToCalendarFactory = useCallback(memoize((eventType?: JumpToCalendarEventType) => {\n    return () => {\n      if (\n        isPlaceholder &&\n        handleCreateCalendar &&\n        JumpToCalendarEventType.DOUBLECLICK === eventType\n      ) {\n        handleCreateCalendar();\n        return;\n      }\n      if (!jumpToCalendar) return;\n      jumpToCalendar(eventType);\n    };\n  }), [isPlaceholder, handleCreateCalendar, jumpToCalendar]);\n\n  // FIX: 鼠标松开后卡片内选区消失的问题\n  const handleStopPropagation = useCallback((event: React.SyntheticEvent) => {\n    event.persist();\n    throttleHandleStopPropagation(event);\n  }, []);\n\n  const className: string = React.useMemo(() => classnames({\n    'card-calendar-selected': isSelected,\n    placeholder: isPlaceholder,\n  }), [isPlaceholder, isSelected]);\n\n  const subjectNode = isPlaceholder ? (\n    <SubjectPlaceholder onClick={handleCreateCalendar} >{subject}</SubjectPlaceholder>\n  ) : subject;\n  // 移动端增加 20px间距\n  const subjectInnerWidth: string | number = isMobile ? `calc(100% - ${CALENDAR_CARD_PADDING_LEN * 2 + 20}px)` : innerWidth;\n\n  const timeNode = isPlaceholder ? (\n    <TimePlaceholder onClick={handleCreateCalendar}>{time}</TimePlaceholder>\n  ) : time;\n\n  return (\n    <ContainerWrapper\n      className={className}\n      style={containerStyle}\n      onDoubleClick={jumpToCalendarFactory(JumpToCalendarEventType.DOUBLECLICK)}\n      onMouseDown={handleStopPropagation}\n      onClick={handleStopPropagation}\n    >\n      <BodyWrapper>\n        <SubjectParagraph\n          isPlaceholder={isPlaceholder}\n          innerWidth={subjectInnerWidth}\n          subject={renderLoadingWrapper({\n            widthRange: `${subjectRange * 0.75}px`,\n            isLoading: currentLoading,\n            text: subjectNode,\n          })}\n          jumpToCalendar={jumpToCalendarFactory(JumpToCalendarEventType.TITLE)}\n        />\n        <TimeTextParagraph>\n          {renderLoadingWrapper({\n            widthRange: '50%',\n            isLoading: currentLoading,\n            text: timeNode,\n          })}\n        </TimeTextParagraph>\n        {isPlaceholder ? null : (\n          <PlaceTextParagraph>\n            {renderLoadingWrapper({\n              widthRange: '50%',\n              isLoading: currentLoading,\n              text: place,\n            })}\n          </PlaceTextParagraph>\n        )}\n        <ReceiversParagraph\n          isLoading={currentLoading}\n          locale={locale}\n          metadata={metadata}\n          innerWidth={innerWidth}\n          openProfile={(isPlaceholder ? handleCreateCalendar : openProfile)}\n          jumpToCalendar={jumpToCalendarFactory(JumpToCalendarEventType.RECEIVER)}\n        />\n        {comment ? (\n          <CommentTextParagraph>\n            <CommentTextWrapper>\n              {comment}\n            </CommentTextWrapper>\n          </CommentTextParagraph>\n        ) : null}\n        <ExtraArea\n          tipsNode={refreshTipsNode}\n          isOnlyRefresh={isMobile}\n          isLoading={isLoading}\n          isPlaceholder={isPlaceholder}\n          createCalendarBtn={createCalendarBtn}\n          isChangeData={isChangeData}\n          viewCalendardetails={viewCalendardetails}\n          refreshToast={refreshToast}\n          refreshTips={refreshTips}\n          jumpToCalendar={jumpToCalendarFactory(JumpToCalendarEventType.ICON)}\n          refreshCalendar={refresh}\n        />\n      </BodyWrapper>\n    </ContainerWrapper>\n  );\n});\n\nexport default Container;\n"],"file":"Container.js"}