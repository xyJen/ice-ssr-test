{"version":3,"sources":["../../../../../src/plugins/calendarCard/shanhui/calculatedCalendarSize.tsx"],"names":["calculatedPluginSize","CalendarCardPlugin","React","zhLocale","TotalWarpper","TimeTextParagraph","PlaceTextParagraph","ReceiversParagraph","CommentTextParagraph","CommentTextWrapper","ContainerWrapper","BodyWrapper","getReceiversHeight","CALENDAR_CARD_SINGLE_LINE_HEIGHT","getCalculatedCalendarReceivers","metadata","containerWidth","totalCount","topReceivers","receivers","organizer","innerWidth","locale","calendarCard","receiverCount","totalCountText","replace","String","maxHeight","index","len","length","currHeight","currReceivers","slice","singleLineHeight","calculatedCalendarSize","time","place","comment","containerNode","width","height","result"],"mappings":"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","sourcesContent":["import { calculatedPluginSize, CalendarCardPlugin } from '@ali/4ever-bamboo';\nimport React from 'react';\nimport zhLocale from '../../../locales/zh_CN';\nimport { CalendarCardMetadataType, IReceiver } from '../types';\n\nconst {\n  TotalWarpper,\n  TimeTextParagraph,\n  PlaceTextParagraph,\n  ReceiversParagraph,\n  CommentTextParagraph,\n  CommentTextWrapper,\n  ContainerWrapper,\n  BodyWrapper,\n  getReceiversHeight,\n  CALENDAR_CARD_SINGLE_LINE_HEIGHT,\n} = CalendarCardPlugin;\n\n/**\n * 计算应该返回的Receivers数量，标签以中文为准\n * 规则：只取前两行，其中最后一行显示为 等{count}人参会\n * @param receivers 参会人\n * @param organizer 组织者\n * @param containerWidth 容器宽度\n */\nexport function getCalculatedCalendarReceivers(\n  metadata: CalendarCardMetadataType,\n  containerWidth: number,\n  totalCount: number,\n): IReceiver[] {\n  const { topReceivers: receivers = [], organizer } = metadata;\n  const innerWidth = containerWidth - 52;// 实际容器宽度（border）\n  const { locale } = zhLocale.calendarCard;\n  const { receiverCount } = locale;\n\n  const totalCountText = receiverCount.replace('{count}', String(totalCount));\n  // 最大不超过 1 行\n  const maxHeight = (CALENDAR_CARD_SINGLE_LINE_HEIGHT || 1) * 2;\n  let index = -1; // 当前Receiver索引\n  const len = receivers.length;// 最大两行\n  let currHeight = CALENDAR_CARD_SINGLE_LINE_HEIGHT;\n  while (currHeight < maxHeight && index < len) {\n    index++;\n    const currReceivers = receivers.slice(0, index + 1);\n    currHeight = getReceiversHeight({\n      receivers: currReceivers, locale, totalCountText, singleLineHeight: CALENDAR_CARD_SINGLE_LINE_HEIGHT, innerWidth\n    });\n  }\n  if (index === (len - 1)) {\n    if (currHeight <= maxHeight) index += 1;\n  }\n  return receivers.slice(0, index);\n}\n\nexport async function calculatedCalendarSize(metadata: CalendarCardMetadataType, containerWidth: number): Promise<number> {\n  const { locale } = zhLocale.calendarCard;\n  const { time, place, comment } = metadata;\n\n  const containerNode = (\n    <div style={{ width: `${containerWidth}px` }}>\n      <ContainerWrapper style={{ height: 'auto', width: 'auto' }}>\n        <BodyWrapper>\n          <TimeTextParagraph>{time}</TimeTextParagraph>\n          <PlaceTextParagraph>{place}</PlaceTextParagraph>\n          <ReceiversParagraph\n            isReadonly\n            locale={locale}\n            metadata={metadata}\n          />\n          {comment ? (\n            <CommentTextParagraph>\n              <CommentTextWrapper>{comment}</CommentTextWrapper>\n            </CommentTextParagraph>\n          ) : null}\n        </BodyWrapper>\n      </ContainerWrapper>\n    </div>\n  );\n  const result = await calculatedPluginSize(containerNode, containerWidth);\n  return result.height;\n}\n"],"file":"calculatedCalendarSize.js"}