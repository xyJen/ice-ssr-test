{"version":3,"sources":["../../../../../src/plugins/calendarCard/shanhui/FlashCalendarContainer.tsx"],"names":["React","useCallback","useMemo","throttle","memoize","classnames","CalendarCardPlugin","JumpToCalendarEventType","TimePlaceholder","TimeTextParagraph","PlaceTextParagraph","ReceiversParagraph","CommentTextParagraph","LoadingWrapper","ContainerWrapper","BodyWrapper","ExtraArea","CommentTextWrapper","CALENDAR_CARD_PADDING_LEN","renderLoadingWrapper","props","widthRange","isLoading","text","throttleHandleStopPropagation","event","stopPropagation","leading","FlashCalendarContainer","memo","locale","metadata","width","isSelected","jumpToCalendar","openProfile","refresh","isMobile","isFirstLoaded","isChangeData","refreshTipsNode","handleCreateCalendar","createCalendarBtn","currentLoading","time","place","comment","isPlaceholder","viewCalendardetails","refreshToast","refreshTips","innerWidth","undefined","containerStyle","height","jumpToCalendarFactory","eventType","DOUBLECLICK","handleStopPropagation","persist","className","placeholder","timeNode","RECEIVER","ICON"],"mappings":"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","sourcesContent":["import React, { useCallback, ReactNode, CSSProperties, useMemo } from 'react';\nimport { throttle, memoize } from 'lodash-es';\nimport classnames from 'classnames';\nimport { CalendarCardPlugin } from '@ali/4ever-bamboo';\nimport { CalendarCardMetadataType, CommonMouseEvent, JumpToCalendarEventType } from '../types';\n\nconst {\n  TimePlaceholder,\n  TimeTextParagraph,\n  PlaceTextParagraph,\n  ReceiversParagraph,\n  CommentTextParagraph,\n  LoadingWrapper,\n  ContainerWrapper,\n  BodyWrapper,\n  ExtraArea,\n  CommentTextWrapper,\n  CALENDAR_CARD_PADDING_LEN,\n} = CalendarCardPlugin;\n\ninterface IProps {\n  locale?: {\n    refresh: string;\n    refreshTips: string; // 日程卡片有更新\n    receiverCount: string; // 等{count}人参会\n    viewCalendardetails: string; // 查看日程详情\n    noresponse: string; // 未响应\n    received: string; // 已接收\n    refused: string; // 已拒绝\n    pending: string; // 待定\n    organizer: string; // 组织人\n  };\n  isChangeData?: boolean; // 有更新数据\n  isMobile?: boolean;\n  isFirstLoaded?: boolean;\n  isLoading?: boolean;\n  height: 'auto' | number;\n  width?: number;\n  isSelected?: boolean;\n  metadata?: CalendarCardMetadataType;\n  jumpToCalendar?: (eventType?: JumpToCalendarEventType) => void;\n  openProfile?: (uid: number) => void;\n  jumpToAttachment?: (url: string) => void;\n  refresh?: CommonMouseEvent;\n  handleCreateCalendar: () => void;\n  createCalendarBtn?: () => ReactNode;\n  refreshTipsNode?: string | ReactNode | null;\n}\n\ninterface IBizLoadingProps {\n  widthRange: string;\n  isLoading?: boolean;\n  text?: string | ReactNode;\n}\n\nconst renderLoadingWrapper = (props: IBizLoadingProps): ReactNode | string => {\n  const { widthRange, isLoading, text } = props;\n  if (isLoading && !text) return (<LoadingWrapper widthRange={widthRange} />);\n  return text || null;\n};\n\nconst throttleHandleStopPropagation = throttle((event: React.SyntheticEvent) => {\n  event.stopPropagation();\n}, 150, { leading: true });\n\nconst FlashCalendarContainer: React.FC<IProps> = React.memo((props) => {\n  const {\n    locale,\n    metadata,\n    width,\n    isSelected,\n    jumpToCalendar,\n    openProfile,\n    refresh,\n    isMobile,\n    isFirstLoaded,\n    isLoading,\n    isChangeData,\n    refreshTipsNode,\n    handleCreateCalendar,\n    createCalendarBtn,\n  } = props;\n  let currentLoading = isLoading;\n  if (isMobile || isFirstLoaded) currentLoading = false;\n  const { time, place, comment, isPlaceholder } = metadata || {};\n  const { viewCalendardetails, refresh: refreshToast, refreshTips } = locale || {};\n\n  const innerWidth: 'auto' | number = (width === undefined || isMobile) ? 'auto' : (width - CALENDAR_CARD_PADDING_LEN * 2);\n\n  const containerStyle = useMemo<CSSProperties>(() => ({\n    height: 'auto',\n    width: 'auto',\n  }), []);\n\n  const jumpToCalendarFactory = useCallback(memoize((eventType?: JumpToCalendarEventType) => {\n    return () => {\n      if (\n        isPlaceholder &&\n        handleCreateCalendar &&\n        JumpToCalendarEventType.DOUBLECLICK === eventType\n      ) {\n        handleCreateCalendar();\n        return;\n      }\n      if (!jumpToCalendar) return;\n      jumpToCalendar(eventType);\n    };\n  }), [isPlaceholder, handleCreateCalendar, jumpToCalendar]);\n\n  // FIX: 鼠标松开后卡片内选区消失的问题\n  const handleStopPropagation = useCallback((event: React.SyntheticEvent) => {\n    event.persist();\n    throttleHandleStopPropagation(event);\n  }, []);\n\n  const className: string = React.useMemo(() => classnames({\n    'card-calendar-selected': isSelected,\n    placeholder: isPlaceholder,\n  }), [isPlaceholder, isSelected]);\n\n  const timeNode = isPlaceholder ? (\n    <TimePlaceholder onClick={handleCreateCalendar}>{time}</TimePlaceholder>\n  ) : time;\n\n  return (\n    <ContainerWrapper\n      className={className}\n      backgroundColor={isPlaceholder ? '#F9FAFC' : '#F0F7FF'}\n      style={containerStyle}\n      onDoubleClick={jumpToCalendarFactory(JumpToCalendarEventType.DOUBLECLICK)}\n      onMouseDown={handleStopPropagation}\n      onClick={handleStopPropagation}\n    >\n      <BodyWrapper>\n        <TimeTextParagraph>\n          {renderLoadingWrapper({\n            widthRange: '50%',\n            isLoading: currentLoading,\n            text: timeNode,\n          })}\n        </TimeTextParagraph>\n        {place ?\n          <PlaceTextParagraph>\n            {renderLoadingWrapper({\n              widthRange: '50%',\n              isLoading: currentLoading,\n              text: place,\n            })}\n          </PlaceTextParagraph> : null}\n        <ReceiversParagraph\n          isLoading={currentLoading}\n          locale={locale}\n          metadata={metadata}\n          innerWidth={innerWidth}\n          openProfile={(isPlaceholder ? handleCreateCalendar : openProfile)}\n          jumpToCalendar={jumpToCalendarFactory(JumpToCalendarEventType.RECEIVER)}\n        />\n        {comment ? (\n          <CommentTextParagraph>\n            <CommentTextWrapper>\n              {comment}\n            </CommentTextWrapper>\n          </CommentTextParagraph>\n        ) : null}\n        <ExtraArea\n          isShanhui\n          tipsNode={refreshTipsNode}\n          isOnlyRefresh={isMobile}\n          isLoading={isLoading}\n          isPlaceholder={isPlaceholder}\n          createCalendarBtn={createCalendarBtn}\n          isChangeData={isChangeData}\n          viewCalendardetails={viewCalendardetails}\n          refreshToast={refreshToast}\n          refreshTips={refreshTips}\n          jumpToCalendar={jumpToCalendarFactory(JumpToCalendarEventType.ICON)}\n          refreshCalendar={refresh}\n        />\n      </BodyWrapper>\n    </ContainerWrapper>\n  );\n});\n\nexport default FlashCalendarContainer;\n"],"file":"FlashCalendarContainer.js"}