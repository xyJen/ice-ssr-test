{"version":3,"sources":["../../../../../src/plugins/calendarCard/handlers/createOnCangjiePaste.ts"],"names":["isEmpty","CalendarType","createOnCangjiePaste","config","calendarCard","calendarCardConfig","mode","event","controller","next","clipboardData","query","fragment","getFragment","isShanhui","SHANHUI","calendarNodes","nodes","filter","block","data","cardType","newFragment","set","map","height","command","onCangjiePaste"],"mappings":";;;AACA,SAASA,OAAT,QAAwB,WAAxB;AAEA,SAASC,YAAT;AAEA,eAAe,SAASC,oBAAT,CACbC,MADa,EAEa;AAAA,6BACwBA,MADxB,CAClBC,YADkB;AAAA,MACJC,kBADI,qCACiB,EADjB;AAAA,MAElBC,IAFkB,GAETD,kBAFS,CAElBC,IAFkB;AAI1B;AAAA,mFAAO,iBAA8BC,KAA9B,EAAqCC,UAArC,EAAiDC,IAAjD;AAAA;AAAA;AAAA;AAAA;AAAA;AACCC,cAAAA,aADD,GACiBF,UAAU,CAACG,KAAX,CAAiB,kBAAjB,EAAqCJ,KAArC,CADjB;AAECK,cAAAA,QAFD,GAEYF,aAFZ,oBAEYA,aAAa,CAAEG,WAAf,EAFZ;;AAAA,kBAGAD,QAHA;AAAA;AAAA;AAAA;;AAAA,+CAGiBH,IAAI,EAHrB;;AAAA;AAKCK,cAAAA,SALD,GAKaR,IAAI,KAAKL,YAAY,CAACc,OALnC;AAOCC,cAAAA,aAPD,GAOiBJ,QAAQ,CAACK,KAAT,CAAeC,MAAf,CACpB,UAACC,KAAD;AAAA,uBAAWA,KAAK,CAACC,IAAN,CAAWC,QAAX,KAAwB,UAAnC;AAAA,eADoB,CAPjB;;AAAA,mBAUDrB,OAAO,CAACgB,aAAD,CAVN;AAAA;AAAA;AAAA;;AAAA,+CAWIP,IAAI,EAXR;;AAAA;AAaCa,cAAAA,WAbD,GAaeV,QAAQ,CAACW,GAAT,CAClB,OADkB,EAElBX,QAAQ,CAACK,KAAT,CAAeO,GAAf,CAAmB,UAACL,KAAD,EAAW;AAC5B,oBAAIA,KAAK,CAACC,IAAN,CAAWC,QAAX,KAAwB,UAA5B,EAAwC;AACtC,yBAAOF,KAAK,CAACI,GAAN,CAAU,MAAV,eACFJ,KAAK,CAACC,IADJ;AAELK,oBAAAA,MAAM,EAAEX,SAAS,GAAG,EAAH,GAAQ;AAFpB,qBAAP;AAID;;AACD,uBAAOK,KAAP;AACD,eARD,CAFkB,CAbf;AAyBLX,cAAAA,UAAU,CAACkB,OAAX,CAAmB,2BAAnB,EAAgDJ,WAAhD;;AAzBK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAP;;AAAA,aAAsBK,cAAtB;AAAA;AAAA;;AAAA,WAAsBA,cAAtB;AAAA;AA2BD","sourcesContent":["import { Plugin } from '@ali/4ever-cangjie';\nimport { isEmpty } from 'lodash-es';\nimport { BiPluginConfig } from '../../../types';\nimport { CalendarType } from '../types';\n\nexport default function createOnCangjiePaste(\n  config: BiPluginConfig,\n): Plugin['onCangjiePaste'] {\n  const { calendarCard: calendarCardConfig = {} } = config;\n  const { mode } = calendarCardConfig;\n\n  return async function onCangjiePaste(event, controller, next) {\n    const clipboardData = controller.query('getClipboardData', event);\n    const fragment = clipboardData?.getFragment();\n    if (!fragment) return next();\n\n    const isShanhui = mode === CalendarType.SHANHUI;\n\n    const calendarNodes = fragment.nodes.filter(\n      (block) => block.data.cardType === 'calendar',\n    );\n    if (isEmpty(calendarNodes)) {\n      return next();\n    }\n    const newFragment = fragment.set(\n      'nodes',\n      fragment.nodes.map((block) => {\n        if (block.data.cardType === 'calendar') {\n          return block.set('data', {\n            ...block.data,\n            height: isShanhui ? 75 : 102,\n          });\n        }\n        return block;\n      }),\n    );\n    controller.command(\"insertFragmentByClipboard\", newFragment);\n  };\n}\n"],"file":"createOnCangjiePaste.js"}