{"version":3,"sources":["../../../../src/plugins/headingGroupNew/index.ts"],"names":["GroupFactory","Heading","createGenerateGroup","createRenderGroup","queries","Heading1","Heading2","Heading3","actions","DRAG_BUTTON_OFFSET","PI_MODE","createHeadingGroupPlugin","config","headingGroup","level","shouldOffsetTypes","i","push","renderGroup","generateGroup","getHeadingGroupLevel","isHeadingGroupAvailable","getLeftToolbarOffset","controller","data","node","isPi","query","includes","type","x","y","undefined","isElementInGroup","element","group","isHeading1","isHeading2","isHeading3"],"mappings":";AAAA,SAASA,YAAT,QAA6B,mBAA7B;AAEA,SAASC,OAAT,QAAwB,eAAxB;AAEA,OAAOC,mBAAP;AACA,OAAOC,iBAAP;AACA,OAAO,KAAKC,OAAZ;IAGEC,Q,GAGEJ,O,CAHFI,Q;IACAC,Q,GAEEL,O,CAFFK,Q;IACAC,Q,GACEN,O,CADFM,Q;IAGMC,O,GAAYR,Y,CAAZQ,O;AACR,IAAMC,kBAAkB,GAAG,CAAC,EAA5B;AACA,IAAMC,OAAO,GAAG,aAAhB;;AAEA,IAAMC,wBAAwB,GAAI,SAA5BA,wBAA4B,CAACC,MAAD,EAA4B;AAAA,6BAC9BA,MAD8B,CACpDC,YADoD;AAAA,MACpDA,YADoD,qCACrC,EADqC;AAAA,4BAEtCA,YAFsC,CAEpDC,KAFoD;AAAA,MAEpDA,KAFoD,oCAE5C,CAF4C;AAG5D,MAAMC,iBAA2B,GAAG,EAApC;;AACA,OAAK,IAAIC,CAAC,GAAGF,KAAb,EAAoBE,CAAC,GAAG,CAAxB,EAA2BA,CAAC,EAA5B,EAAgC;AAC9BD,IAAAA,iBAAiB,CAACE,IAAlB,cAAkCD,CAAlC;AACD;;AAAA;AACD,SAAO;AACLE,IAAAA,WAAW,EAAEf,iBAAiB,CAACU,YAAD,CADzB;AAELM,IAAAA,aAAa,EAAEjB,mBAAmB,CAACW,YAAD,CAF7B;AAGLT,IAAAA,OAAO;AACLgB,MAAAA,oBAAoB,EAAE;AAAA,eAAMN,KAAN;AAAA,OADjB;AAELO,MAAAA,uBAAuB,EAAE;AAAA,eAAM,IAAN;AAAA,OAFpB;AAGLC,MAAAA,oBAAoB,EAAE,8BAACC,UAAD,EAAaC,IAAb,EAAsB;AAAA,YAClCC,IADkC,GACzBD,IADyB,CAClCC,IADkC;AAE1C,YAAMC,IAAI,GAAGH,UAAU,CAACI,KAAX,CAAiB,eAAjB,MAAsCjB,OAAnD;;AACA,YAAI,CAACgB,IAAD,IAASX,iBAAiB,CAACa,QAAlB,CAA2BH,IAAI,CAACI,IAAhC,CAAb,EAAoD;AAClD,iBAAO;AACL;AACAC,YAAAA,CAAC,EAAErB,kBAAkB,GAAG,CAFnB;AAGLsB,YAAAA,CAAC,EAAE;AAHE,WAAP;AAKD;;AACD,eAAOC,SAAP;AACD,OAdI;AAeLC,MAAAA,gBAAgB,EAAE,0BAChBV,UADgB,EAEhBW,OAFgB,EAGhBC,KAHgB,EAIb;AACH;AACA,YAAI9B,QAAQ,CAAC+B,UAAT,CAAoBF,OAApB,CAAJ,EAAkC;AAChC,iBAAO,KAAP;AACD,SAFD,MAEO,IAAI5B,QAAQ,CAAC+B,UAAT,CAAoBH,OAApB,CAAJ,EAAkC;AACvC,cAAIC,KAAK,CAACN,IAAN,KAAe,gBAAnB,EAAqC;AACnC,mBAAO,IAAP;AACD;;AACD,iBAAO,KAAP;AACD,SALM,MAKA,IAAItB,QAAQ,CAAC+B,UAAT,CAAoBJ,OAApB,CAAJ,EAAkC;AACvC,cAAIC,KAAK,CAACN,IAAN,KAAe,gBAAf,IAAmCM,KAAK,CAACN,IAAN,KAAe,gBAAtD,EAAwE;AACtE,mBAAO,IAAP;AACD;;AACD,iBAAO,KAAP;AACD;;AACD,eAAO,IAAP;AACD;AAnCI,OAoCFzB,OApCE;AAHF,GAAP;AA0CD,CAjDD,C,CAmDA;;;AACAO,wBAAwB,CAACH,OAAzB,GAAmCA,OAAnC,C,CACA;;AACAG,wBAAwB,CAACP,OAAzB,GAAmCA,OAAnC;AAEA,eAAeO,wBAAf","sourcesContent":["import { GroupFactory } from '@ali/4ever-bamboo';\nimport { Controller, Element, Group } from '@ali/4ever-cangjie';\nimport { Heading } from '@ali/4ever-mo';\nimport { BiPluginConfig } from '../../types';\nimport createGenerateGroup from './handlers/createGenerateGroup';\nimport createRenderGroup from './handlers/createRenderGroup';\nimport * as queries from './queries';\n\nconst {\n  Heading1,\n  Heading2,\n  Heading3,\n} = Heading;\n\nconst { actions } = GroupFactory;\nconst DRAG_BUTTON_OFFSET = -20;\nconst PI_MODE = 'page_layout';\n\nconst createHeadingGroupPlugin = ((config: BiPluginConfig) => {\n  const { headingGroup = {} } = config;\n  const { level = 3 } = headingGroup;\n  const shouldOffsetTypes: string[] = [];\n  for (let i = level; i > 0; i--) {\n    shouldOffsetTypes.push(`heading-${i}`);\n  };\n  return {\n    renderGroup: createRenderGroup(headingGroup),\n    generateGroup: createGenerateGroup(headingGroup),\n    queries: {\n      getHeadingGroupLevel: () => level,\n      isHeadingGroupAvailable: () => true,\n      getLeftToolbarOffset: (controller, data) => {\n        const { node } = data;\n        const isPi = controller.query('getLayoutMode') === PI_MODE;\n        if (!isPi && shouldOffsetTypes.includes(node.type)) {\n          return {\n            // 这里加上4是因为左侧工具栏的offset为6，但是在标题场景下是2\n            x: DRAG_BUTTON_OFFSET + 4,\n            y: 0,\n          };\n        }\n        return undefined;\n      },\n      isElementInGroup: (\n        controller: Controller,\n        element: Element,\n        group: Group,\n      ) => {\n        // 分组 2 只能存在于分组 1 之中\n        if (Heading1.isHeading1(element)) {\n          return false;\n        } else if (Heading2.isHeading2(element)) {\n          if (group.type === 'heading1-group') {\n            return true;\n          }\n          return false;\n        } else if (Heading3.isHeading3(element)) {\n          if (group.type === 'heading1-group' || group.type === 'heading2-group') {\n            return true;\n          }\n          return false;\n        }\n        return true;\n      },\n      ...queries,\n    },\n  };\n});\n\n// @ts-ignore\ncreateHeadingGroupPlugin.actions = actions;\n// @ts-ignore\ncreateHeadingGroupPlugin.queries = queries;\n\nexport default createHeadingGroupPlugin;\n"],"file":"index.js"}