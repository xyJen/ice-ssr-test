{"version":3,"sources":["../../../../../src/plugins/laserPointer/components/highlight.tsx"],"names":["React","domUtils","List","actions","isBlockQuote","LaserPointerRole","Highlight","props","type","domRef","children","controller","node","highlighted","renderHighlight","getRole","highlight","useCallback","HOST","path","value","document","getPath","key","run","removeHighlight","getDOMNode","domNode","current","undefined","findDOMNode","isList","closest","e"],"mappings":"AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,SAAqBC,QAArB,QAA2C,oBAA3C;AACA,SAASC,IAAT,QAAqB,wBAArB;AACA,OAAO,KAAKC,OAAZ;AACA,SAASC,YAAT;AACA,SAEEC,gBAFF;;AAsBA,IAAMC,SAAmC,GAAG,SAAtCA,SAAsC,CAACC,KAAD,EAAW;AAAA,MAEnDC,IAFmD,GAUjDD,KAViD,CAEnDC,IAFmD;AAAA,MAGnDC,MAHmD,GAUjDF,KAViD,CAGnDE,MAHmD;AAAA,MAInDC,QAJmD,GAUjDH,KAViD,CAInDG,QAJmD;AAAA,MAKnDC,UALmD,GAUjDJ,KAViD,CAKnDI,UALmD;AAAA,MAMnDC,IANmD,GAUjDL,KAViD,CAMnDK,IANmD;AAAA,MAOnDC,WAPmD,GAUjDN,KAViD,CAOnDM,WAPmD;AAAA,MAQnDC,eARmD,GAUjDP,KAViD,CAQnDO,eARmD;AAAA,MASnDC,OATmD,GAUjDR,KAViD,CASnDQ,OATmD;AAYrD,MAAMC,SAAS,GAAGhB,KAAK,CAACiB,WAAN,CAAkB,YAAM;AACxC,QAAIF,OAAO,OAAOV,gBAAgB,CAACa,IAAnC,EAAyC;AACvC,UAAMC,IAAI,GAAGR,UAAU,CAACS,KAAX,CAAiBC,QAAjB,CAA0BC,OAA1B,CAAkCV,IAAI,CAACW,GAAvC,CAAb;AACAZ,MAAAA,UAAU,CAACa,GAAX,CACE,UADF,EAEErB,OAAO,CAACa,SAAR,CAAkB;AAChBG,QAAAA,IAAI,EAAJA;AADgB,OAAlB,CAFF;AAMD;AACF,GAViB,EAUf,CAACR,UAAD,EAAaC,IAAb,EAAmBG,OAAnB,CAVe,CAAlB;AAYA,MAAMU,eAAe,GAAGzB,KAAK,CAACiB,WAAN,CAAkB,YAAM;AAC9C,QAAIF,OAAO,OAAOV,gBAAgB,CAACa,IAAnC,EAAyC;AACvCP,MAAAA,UAAU,CAACa,GAAX,CACE,UADF,EAEErB,OAAO,CAACsB,eAAR,EAFF;AAID;AACF,GAPuB,EAOrB,CAACd,UAAD,EAAaI,OAAb,CAPqB,CAAxB;;AASA,MAAMW,UAAU,GAAG,SAAbA,UAAa,GAAM;AAAA;;AACvB,QAAIC,OAAO,sBAAGlB,MAAH,oBAAGA,MAAM,CAAEmB,OAAX,8BAAsBC,SAAjC;;AACA,QAAI;AACFF,MAAAA,OAAO,GAAG1B,QAAQ,CAAC6B,WAAT,CAAqBlB,IAAI,CAACW,GAA1B,CAAV;;AACA,UAAI,CAACI,OAAL,EAAc;AACZ,eAAOE,SAAP;AACD;;AACD,UAAI3B,IAAI,CAAC6B,MAAL,CAAYnB,IAAZ,CAAJ,EAAuB;AAAA;;AACrB,mCAAOe,OAAO,CAACK,OAAR,CAAgB,sBAAhB,CAAP,+BAAkDH,SAAlD;AACD,OAFD,MAEO,IAAIzB,YAAY,CAACQ,IAAD,CAAhB,EAAwB;AAAA;;AAC7B,oCAAOe,OAAO,CAACK,OAAR,CAAgB,YAAhB,CAAP,gCAAwCH,SAAxC;AACD;AACF,KAVD,CAUE,OAAOI,CAAP,EAAU,CACV;AACD;;AACD,WAAON,OAAP;AACD,GAhBD;;AAkBA,SAAOb,eAAe,CAACN,IAAD,EAAOK,WAAP,EAAoB;AACxCH,IAAAA,QAAQ,EAARA,QADwC;AAExCgB,IAAAA,UAAU,EAAVA,UAFwC;AAGxCV,IAAAA,SAAS,EAATA,SAHwC;AAIxCS,IAAAA,eAAe,EAAfA;AAJwC,GAApB,CAAtB;AAMD,CAzDD;;AA2DA,eAAenB,SAAf","sourcesContent":["import * as React from 'react';\nimport { Controller, domUtils, Node } from '@ali/4ever-cangjie';\nimport { List } from '@ali/4ever-plugin-list';\nimport * as actions from '../actions';\nimport { isBlockQuote } from '../utils';\nimport {\n  LaserPointerPluginConfig,\n  LaserPointerRole,\n} from '../types';\n\ninterface HighlightProps {\n  /** highlight 类型 */\n  type: string;\n  /** controller */\n  controller: Controller;\n  /** node */\n  node: Node;\n  /** 用户角色 */\n  getRole: () => LaserPointerRole;\n  /** DOM ref */\n  domRef?: React.MutableRefObject<HTMLElement | null>;\n  /** 是否被高亮 */\n  highlighted: boolean;\n  /** 自定义 highlight 渲染 */\n  renderHighlight: LaserPointerPluginConfig['renderHighlight'];\n}\n\nconst Highlight: React.FC<HighlightProps> = (props) => {\n  const {\n    type,\n    domRef,\n    children,\n    controller,\n    node,\n    highlighted,\n    renderHighlight,\n    getRole,\n  } = props;\n\n  const highlight = React.useCallback(() => {\n    if (getRole() === LaserPointerRole.HOST) {\n      const path = controller.value.document.getPath(node.key)!\n      controller.run(\n        'onAction',\n        actions.highlight({\n          path,\n        }),\n      );\n    }\n  }, [controller, node, getRole]);\n\n  const removeHighlight = React.useCallback(() => {\n    if (getRole() === LaserPointerRole.HOST) {\n      controller.run(\n        'onAction',\n        actions.removeHighlight(),\n      );\n    }\n  }, [controller, getRole]);\n\n  const getDOMNode = () => {\n    let domNode = domRef?.current ?? undefined;\n    try {\n      domNode = domUtils.findDOMNode(node.key);\n      if (!domNode) {\n        return undefined;\n      }\n      if (List.isList(node)) {\n        return domNode.closest('[data-testid=\"list\"]') ?? undefined;\n      } else if (isBlockQuote(node)) {\n        return domNode.closest('blockquote') ?? undefined;\n      }\n    } catch (e) {\n      // catch don't throw\n    }\n    return domNode;\n  };\n\n  return renderHighlight(type, highlighted, {\n    children,\n    getDOMNode,\n    highlight,\n    removeHighlight,\n  });\n};\n\nexport default Highlight;\n"],"file":"highlight.js"}