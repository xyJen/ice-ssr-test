import React from 'react';
import { debounce } from 'lodash-es';
import * as actions from "../actions";
import { findClosesetBlock } from "../utils";
import { LaserPointerRole } from "../types";
/** 高亮延迟 */

var DELAY_TIME = 50;
export default function RegisterEvent(_ref) {
  var controller = _ref.controller,
      getRole = _ref.getRole,
      getHighlightType = _ref.getHighlightType;
  React.useEffect(function () {
    var prevLeaveNode = null;
    var mouseEnter = debounce(function (event) {
      if (getRole() !== LaserPointerRole.HOST) {
        return;
      }

      var node = findClosesetBlock(event.target, controller);
      var highlightType = node && getHighlightType(node, controller);

      if (highlightType) {
        var path = controller.value.document.getPath(node.key);
        controller.run('onAction', actions.highlight({
          path: path
        }));
      }
    }, DELAY_TIME);

    var mouseleave = function mouseleave(event) {
      mouseEnter.cancel();

      if (getRole() !== LaserPointerRole.HOST) {
        return;
      }

      var node = findClosesetBlock(event.target, controller);
      var highlightType = node && getHighlightType(node, controller);

      if (highlightType && prevLeaveNode !== node) {
        controller.run('onAction', actions.removeHighlight());
      }

      prevLeaveNode = node;
    };

    document.addEventListener('mouseenter', mouseEnter, {
      capture: true
    });
    document.addEventListener('mouseleave', mouseleave, {
      capture: true
    });
    return function () {
      document.removeEventListener('mouseenter', mouseEnter, {
        capture: true
      });
      document.removeEventListener('mouseleave', mouseleave, {
        capture: true
      }); // 防止内存泄漏

      mouseEnter.cancel();
    }; // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);
  return null;
}
//# sourceMappingURL=RegisterEvent.js.map