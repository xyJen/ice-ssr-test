{"version":3,"sources":["../../../../../src/plugins/alignment/handlers/onKeyDown.ts"],"names":["hotkeys","isKeyHotkey","setAlignment","getClosestParagraph","getData","isAlignLeftHotKey","isAlignCenterHotkey","isAlignRightHotkey","isAlignJustifyHotkey","onKeyDown","event","controller","next","value","isDeleteBackward","currentParagraph","data","selection","startBlock","isDeleteAtFirstChar","isCollapsed","anchor","isAtStartOfNode","isNewLineFirstChar","preventDefault"],"mappings":"AAAA,SAASA,OAAT,QAAoC,oBAApC;AACA,OAAOC,WAAP,MAAwB,WAAxB;AACA,OAAOC,YAAP;AACA,SAASC,mBAAT,QAAoC,kBAApC;AACA,SAASC,OAAT,QAAwB,kBAAxB;AAEA,IAAMC,iBAAiB,GAAGJ,WAAW,CAAC,aAAD,CAArC;AACA,IAAMK,mBAAmB,GAAGL,WAAW,CAAC,aAAD,CAAvC;AACA,IAAMM,kBAAkB,GAAGN,WAAW,CAAC,aAAD,CAAtC;AACA,IAAMO,oBAAoB,GAAGP,WAAW,CAAC,aAAD,CAAxC;AAEA,eAAe,SAASQ,SAAT,CAAmBC,KAAnB,EAA+CC,UAA/C,EAAuEC,IAAvE,EAAuF;AAAA,MAC5FC,KAD4F,GAClFF,UADkF,CAC5FE,KAD4F;AAEpG;;AACA,MAAIb,OAAO,CAACc,gBAAR,CAAyBJ,KAAzB,CAAJ,EAAqC;AACnC,QAAMK,gBAAgB,GAAGZ,mBAAmB,CAACU,KAAD,CAA5C;;AACA,QAAI,CAACE,gBAAD,IAAqBX,OAAO,CAACW,gBAAgB,CAACC,IAAlB,EAAwB,IAAxB,EAA8B,MAA9B,CAAP,KAAiD,MAA1E,EAAkF;AAChF,aAAOJ,IAAI,EAAX;AACD;;AAJkC,QAM3BK,SAN2B,GAMDJ,KANC,CAM3BI,SAN2B;AAAA,QAMhBC,UANgB,GAMDL,KANC,CAMhBK,UANgB;AAOnC,QAAMC,mBAAmB,GAAGF,SAAS,CAACG,WAAV,IACvBH,SAAS,CAACI,MAAV,CAAiBC,eAAjB,CAAiCP,gBAAjC,CADL;AAEA,QAAMQ,kBAAkB,GAAGN,SAAS,CAACG,WAAV,IACtBH,SAAS,CAACI,MAAV,CAAiBC,eAAjB,CAAiCJ,UAAjC,CADL;AAGA,QAAI,CAACC,mBAAD,IAAwB,CAACI,kBAA7B,EAAiD,OAAOX,IAAI,EAAX;;AACjD,QAAIO,mBAAJ,EAAyB;AACvB,aAAOjB,YAAY,CAACS,UAAD,EAAa,MAAb,CAAnB;AACD;AACF;;AAED,MAAIN,iBAAiB,CAACK,KAAD,CAArB,EAA8B;AAC5BA,IAAAA,KAAK,CAACc,cAAN;AACA,WAAOtB,YAAY,CAACS,UAAD,EAAa,MAAb,CAAnB;AACD;;AACD,MAAIL,mBAAmB,CAACI,KAAD,CAAvB,EAAgC;AAC9BA,IAAAA,KAAK,CAACc,cAAN;AACA,WAAOtB,YAAY,CAACS,UAAD,EAAa,QAAb,CAAnB;AACD;;AACD,MAAIJ,kBAAkB,CAACG,KAAD,CAAtB,EAA+B;AAC7BA,IAAAA,KAAK,CAACc,cAAN;AACA,WAAOtB,YAAY,CAACS,UAAD,EAAa,OAAb,CAAnB;AACD;;AACD,MAAIH,oBAAoB,CAACE,KAAD,CAAxB,EAAiC;AAC/BA,IAAAA,KAAK,CAACc,cAAN;AACA,WAAOtB,YAAY,CAACS,UAAD,EAAa,SAAb,CAAnB;AACD;;AAED,SAAOC,IAAI,EAAX;AACD","sourcesContent":["import { hotkeys, Controller } from '@ali/4ever-cangjie';\nimport isKeyHotkey from 'is-hotkey';\nimport setAlignment from '../commands/setAlignment';\nimport { getClosestParagraph } from '@ali/4ever-utils';\nimport { getData } from '@ali/4ever-utils';\n\nconst isAlignLeftHotKey = isKeyHotkey('mod+shift+l');\nconst isAlignCenterHotkey = isKeyHotkey('mod+shift+e');\nconst isAlignRightHotkey = isKeyHotkey('mod+shift+r');\nconst isAlignJustifyHotkey = isKeyHotkey('mod+shift+j');\n\nexport default function onKeyDown(event: React.KeyboardEvent, controller: Controller, next: Function) {\n  const { value } = controller;\n  /* 在行首backspace/delete撤销对齐 */\n  if (hotkeys.isDeleteBackward(event)) {\n    const currentParagraph = getClosestParagraph(value);\n    if (!currentParagraph || getData(currentParagraph.data, 'jc', 'left') === 'left') {\n      return next();\n    }\n\n    const { selection, startBlock } = value;\n    const isDeleteAtFirstChar = selection.isCollapsed\n      && selection.anchor.isAtStartOfNode(currentParagraph);\n    const isNewLineFirstChar = selection.isCollapsed\n      && selection.anchor.isAtStartOfNode(startBlock);\n\n    if (!isDeleteAtFirstChar && !isNewLineFirstChar) return next();\n    if (isDeleteAtFirstChar) {\n      return setAlignment(controller, 'left');\n    }\n  }\n\n  if (isAlignLeftHotKey(event)) {\n    event.preventDefault();\n    return setAlignment(controller, 'left');\n  }\n  if (isAlignCenterHotkey(event)) {\n    event.preventDefault();\n    return setAlignment(controller, 'center');\n  }\n  if (isAlignRightHotkey(event)) {\n    event.preventDefault();\n    return setAlignment(controller, 'right');\n  }\n  if (isAlignJustifyHotkey(event)) {\n    event.preventDefault();\n    return setAlignment(controller, 'justify');\n  }\n\n  return next();\n}\n"],"file":"onKeyDown.js"}