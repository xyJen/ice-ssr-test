{"version":3,"sources":["../../../../../src/plugins/subject/components/content.tsx"],"names":["React","environment","Commands","HeadingGroupPlugin","SubjectPlugin","isEmptyNode","isNormalParagraph","Content","components","Placeholder","InlinePlaceholder","InnerTextWrapper","InnerCardWrapper","SubjectPlaceholderWrapper","SubjectContent","props","node","children","config","controller","rest","data","subjectPr","name","locale","renderInsertAttachmentComponent","reviewConfig","review","ReviewPlaceholder","renderReviewPlaceholder","reviewTextPlaceholder","topicContentPlaceholder","topicContentPlaceholderMobile","reviewTextPlaceholderMobile","conclusionContentPlaceholder","node1","nodes","displayPlaceholder1","item","length","renderFileChoosePlaceholder","hasReviewTaskList","find","list","isTaskList","focusToLine","useCallback","command","moveToStartOfNode","renderAttachmentPlaceholder","placeholder","useMemo","IS_MOBILE","slice","displayName"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { environment, Block, Controller, Commands } from '@ali/4ever-cangjie';\nimport { Heading1Data } from '@ali/4ever-mo';\nimport { HeadingGroupPlugin, SubjectPlugin } from '@ali/4ever-bamboo';\nimport { SubjectConfig } from '../types';\nimport { isEmptyNode, isNormalParagraph } from '../utils';\n\nconst { Content } = HeadingGroupPlugin;\nconst { components } = SubjectPlugin;\nconst {\n  Placeholder,\n  InlinePlaceholder,\n  InnerTextWrapper,\n  InnerCardWrapper,\n  SubjectPlaceholderWrapper,\n} = components;\n\nexport interface SubjectContentProps extends HeadingGroupPlugin.ContentProps {\n  node: Block<Heading1Data>;\n  children: React.ReactNode[];\n  config: SubjectConfig;\n  controller: Controller;\n}\n\nconst SubjectContent: React.FC<SubjectContentProps> = (props) => {\n  const {\n    node,\n    children,\n    config,\n    controller,\n    ...rest\n  } = props;\n\n  const { subjectPr = {} } = node.data;\n  const { name } = subjectPr;\n  const { locale = {}, renderInsertAttachmentComponent } = config;\n  const { review: reviewConfig } = config;\n  const { renderReviewPlaceholder: ReviewPlaceholder } = reviewConfig || {};\n\n  const {\n    reviewTextPlaceholder,\n    topicContentPlaceholder,\n    topicContentPlaceholderMobile,\n    reviewTextPlaceholderMobile,\n    conclusionContentPlaceholder,\n  } = locale;\n\n  const node1 = node.nodes[1] as Block;\n\n  const displayPlaceholder1 = (item: Block) => {\n    if (name === 'review' || name === 'topic' || name === 'conclusion') {\n      return isNormalParagraph(item) && isEmptyNode(item) && node.nodes.length === 2;\n    }\n    return false;\n  };\n\n  const renderFileChoosePlaceholder = () => {\n    const hasReviewTaskList = !!node.nodes.find((node) => (node as Block)?.data?.list?.isTaskList);\n    // 没有taskList\n    if (!hasReviewTaskList && ReviewPlaceholder) {\n      return <ReviewPlaceholder node={node} />;\n    }\n    return null;\n  };\n\n  const focusToLine = React.useCallback(() => {\n    controller.command(Commands.moveToStartOfNode, node1);\n  }, [controller, node1]);\n\n  const renderAttachmentPlaceholder = () => {\n    if (renderInsertAttachmentComponent) {\n      return renderInsertAttachmentComponent({\n        focusToLine,\n      });\n    }\n    return null;\n  };\n\n  const placeholder = React.useMemo(() => {\n    if (name === 'review') {\n      if (environment.IS_MOBILE) {\n        return <InlinePlaceholder data-placeholder>{reviewTextPlaceholderMobile}</InlinePlaceholder>;\n      }\n      return (\n        <SubjectPlaceholderWrapper data-placeholder>\n          <InnerTextWrapper>\n            {reviewTextPlaceholder}\n          </InnerTextWrapper>\n          <InnerCardWrapper>\n            {renderFileChoosePlaceholder()}\n          </InnerCardWrapper>\n        </SubjectPlaceholderWrapper>\n      );\n    }\n\n    // 议题内容 placeholder\n    if (name === 'topic') {\n      if (environment.IS_MOBILE) {\n        return <InlinePlaceholder data-placeholder>{topicContentPlaceholderMobile}</InlinePlaceholder>;\n      }\n      return (\n        <SubjectPlaceholderWrapper data-placeholder>\n          <InnerTextWrapper>\n            {topicContentPlaceholder}\n          </InnerTextWrapper>\n          <InnerCardWrapper className=\"attachment\">\n            {renderAttachmentPlaceholder()}\n          </InnerCardWrapper>\n        </SubjectPlaceholderWrapper>\n      );\n    }\n\n    // 会议小结内容 placeholder\n    if (name === 'conclusion') {\n      return <InlinePlaceholder data-placeholder>{conclusionContentPlaceholder}</InlinePlaceholder>;\n    }\n\n    return null;\n  }, [conclusionContentPlaceholder, name, reviewTextPlaceholder, topicContentPlaceholder, topicContentPlaceholderMobile, renderFileChoosePlaceholder]);\n\n  if (children.length === 0) {\n    return null;\n  }\n\n  return (\n    <Content {...rest}>\n      {node1 && (\n        <Placeholder\n          controller={controller}\n          node={node1}\n          display={displayPlaceholder1}\n          placeholder={placeholder}\n        >\n          {children[0]}\n        </Placeholder>\n      )}\n      {children.slice(1)}\n    </Content>\n  );\n};\n\nSubjectContent.displayName = 'SubjectContent';\n\nexport default SubjectContent;\n"],"file":"content.js"}