{"version":3,"sources":["../../../../../src/plugins/subject/components/subject.tsx"],"names":["React","Commands","useSelectionData","environment","useUserData","useSelectingHots","styled","TinyColor","Content","HeadingGroupPlugin","SubjectPlugin","GroupFactory","isEmptyNode","isSubjectHeading","TopicToolbar","InsertBar","getSubjectBorderColor","MentionButton","useHighlight","isSubjectSelected","classnames","isSelectionInFoldArea","Title","actions","components","InlinePlaceholder","InnerCardWrapperForMention","Placeholder","toggleFold","SUBJECT_PADDING_LEFT","SubjectBox","div","ContentBox","props","paddingRight","BorderBar","color","HighlightBox","TitleContent","TitleBox","ToolBox","Subject","controller","node","attributes","isSelected","config","children","fold","data","subjectPr","reviewConfig","review","DingIcon","renderDingIcon","MeetingClock","renderMeetingClock","ReviewPlaceholder","renderReviewPlaceholder","id","name","first","nodes","topicTitlePlaceholderBefore","locale","topicTitlePlaceholderAfter","highlight","setHighlight","foldRef","useRef","toolRef","useState","toolWidth","setToolWidth","value","startBlock","endBlock","initFocused","key","focused","setFocused","document","displayFinishButton","isFirst","useMemo","path","getPath","index","i","$node","setFocusedValue","useCallback","newStartBlock","newEndBlock","selectionData$","useEffect","handleFoldChange","_fold","run","command","moveToStartOfNode","refreshToolWidth","tool","current","offsetWidth","moveToEndOfNode","useLayoutEffect","displayTitlePlaceholder","item","handleMentionClick","dispatch","renderTitlePlaceholder","IS_MOBILE","renderTitleToolbar","toolbars","push","titleNode","titleElement","contentElements","Array","isArray","length","slice","className","selected","query","type","top","setAlpha","toRgbString","bottom","displayName"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { Block, Commands, Controller, useSelectionData, environment, useUserData, useSelectingHots } from '@ali/4ever-cangjie';\nimport { Heading1Data } from '@ali/4ever-mo';\nimport styled from 'styled-components';\nimport { TinyColor } from '@ctrl/tinycolor';\nimport Content from './content';\nimport { HeadingGroupPlugin, SubjectPlugin, GroupFactory } from '@ali/4ever-bamboo';\nimport { SubjectConfig } from '../types';\nimport { isEmptyNode, isSubjectHeading } from '../utils';\nimport TopicToolbar from './topicToolbar';\nimport InsertBar from './insertBar';\nimport { getSubjectBorderColor } from '../helpers';\nimport MentionButton from './mentionButton';\nimport useHighlight from '../hooks/useHighlight';\nimport { isSubjectSelected } from '../queries';\nimport classnames from 'classnames';\nimport type { Subject as SubjectNode } from '../utils';\n\nconst { isSelectionInFoldArea } = GroupFactory;\n\nconst { Title, actions } = HeadingGroupPlugin;\n\nconst { components } = SubjectPlugin;\nconst { InlinePlaceholder, InnerCardWrapperForMention, Placeholder } = components;\n\nconst { toggleFold } = actions;\n\nexport const SUBJECT_PADDING_LEFT = 19;\n\nconst SubjectBox = styled.div<{ paddingRight?: number }>`\n  position: relative;\n  padding-left: ${SUBJECT_PADDING_LEFT}px;\n  margin: 40px 0;\n\n  & [data-name=\"group-fold-btn\"] {\n    left: -18px;\n  }\n\n  &.selected {\n    background-color: rgba(17, 31, 44, 0.08);\n  }\n`;\n\nconst ContentBox = styled(Content) <{ paddingRight?: number }>`\n  position: relative;\n\n  & > [data-type='heading-1-group'] > [data-name='heading-group-title'] {\n    padding-right: ${(props) => props.paddingRight || 0}px;\n  }\n\n  /* fix: https://aone.alibaba-inc.com/v2/project/1090534/bug/35751455 */\n  & .draggable-highlight.shadow-highlight {\n    border-radius: 0;\n    box-shadow: none;\n  }\n`;\n\nconst BorderBar = styled.div<{ color: string }>`\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 3px;\n  border-radius: 1.5px;\n  height: 100%;\n  background: ${(props) => props.color};\n  transition: all 0.2s ease-in-out;\n`;\n\nconst HighlightBox = styled.div`\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  background-color: ${(props) => props.color};\n\n  @keyframes highlight-in {\n    from {\n    }\n\n    to {\n      background-color: transparent;\n    }\n  }\n\n  animation-fill-mode: forwards;\n  animation-name: highlight-in;\n  animation-duration: 2s;\n`;\n\nconst TitleContent = styled.div`\n  /* fix: https://aone.alibaba-inc.com/v2/project/1090534/bug/35812515 */\n  & h1 {\n    font-size: 20px;\n  }\n`;\n\nconst TitleBox = styled(Title) <{ paddingRight?: number }>`\n  padding-right: ${(props) => props.paddingRight}px;\n\n  & .data-comment-bubbles {\n    left: ${(props) => props.paddingRight}px;\n  }\n`;\n\nconst ToolBox = styled.div`\n  position: absolute;\n  height: 28px;\n  right: 0;\n  top: 0;\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n`;\n\nexport interface SubjectProps {\n  controller: Controller;\n  node: Block<Heading1Data>;\n  attributes: Record<string, string>;\n  isSelected: boolean;\n  config: SubjectConfig;\n}\n\n/**\n * 议题区块\n * @param props\n * @returns\n */\nconst Subject: React.FC<SubjectProps> = (props) => {\n  const {\n    controller,\n    node,\n    attributes,\n    isSelected,\n    config,\n    children,\n  } = props;\n\n  const fold = useUserData(node, 'fold') || false;\n  const { subjectPr = {} } = node.data;\n  const { review: reviewConfig } = config;\n  const {\n    renderDingIcon: DingIcon,\n    renderMeetingClock: MeetingClock,\n    renderReviewPlaceholder: ReviewPlaceholder,\n  } = reviewConfig || {};\n  const { id = '', name = 'topic' } = subjectPr;\n  const first = node.nodes[0] as Block;\n  const topicTitlePlaceholderBefore = config?.locale?.topicTitlePlaceholderBefore;\n  const topicTitlePlaceholderAfter = config?.locale?.topicTitlePlaceholderAfter;\n  const [highlight, setHighlight] = useHighlight(controller, id);\n\n  const foldRef = React.useRef(fold);\n  const toolRef = React.useRef<HTMLDivElement>(null);\n  const [toolWidth, setToolWidth] = React.useState(0);\n\n  const { startBlock, endBlock } = controller.value;\n  const initFocused = !!startBlock && startBlock.key === first.key\n    && !!endBlock && endBlock.key === first.key;\n  const [focused, setFocused] = React.useState(initFocused);\n\n  const { document } = controller.value;\n\n  const displayFinishButton = !(name === 'topic' && isEmptyNode(first)) && focused;\n\n  // 查询当前议题是否是第一个议题\n  // NOTE: 这个写法感觉还是存在查询性能问题，但是目前没有其他比较好的解法\n  const isFirst = React.useMemo(() => {\n    const path = document.getPath(first.key);\n    if (path) {\n      const [index] = path;\n      for (let i = index - 1; i >= 0; i--) {\n        const $node = document.nodes[i];\n        if (isSubjectHeading($node)) {\n          return false;\n        }\n      }\n      return true;\n    }\n    return false;\n  }, [document, first]);\n\n  const setFocusedValue = React.useCallback(() => {\n    const { startBlock: newStartBlock, endBlock: newEndBlock } = controller.value;\n    if (newStartBlock && newStartBlock.key === first.key\n      && newEndBlock && newEndBlock.key === first.key\n    ) {\n      if (focused === false) {\n        setFocused(true);\n      }\n    } else if (focused === true) {\n      setFocused(false);\n    }\n  }, [controller, first, focused]);\n\n  useSelectionData(controller.selectionData$, null, setFocusedValue, []);\n  useSelectingHots(controller, setFocusedValue);\n\n  React.useEffect(() => {\n    setFocusedValue();\n  }, [startBlock, endBlock, setFocusedValue]);\n\n  const handleFoldChange = React.useCallback((_fold: boolean) => {\n    controller.run('onAction', toggleFold({\n      node: first,\n      fold: _fold,\n    }));\n    // 折叠标题后，将选区移动至标题行首，避免页面聚焦造成的抖动\n    controller.command(Commands.moveToStartOfNode, first);\n  }, [controller, first]);\n\n  const color = React.useMemo(() => getSubjectBorderColor(name), [name]);\n\n  const refreshToolWidth = React.useCallback(() => {\n    const tool = toolRef.current;\n    if (tool && tool.offsetWidth !== toolWidth) {\n      setToolWidth(tool.offsetWidth);\n    }\n  }, [toolWidth]);\n\n  // fix: https://aone.alibaba-inc.com/v2/project/897543/bug/36243039\n  React.useEffect(() => {\n    if (!foldRef.current && fold && isSelected && isSelectionInFoldArea(controller, first)) {\n      controller.command(Commands.moveToEndOfNode, first);\n    }\n    foldRef.current = fold;\n  }, [controller, first, fold, isSelected]);\n\n  React.useLayoutEffect(() => {\n    refreshToolWidth();\n  }, [displayFinishButton]);\n\n  const displayTitlePlaceholder = (item: Block) => {\n    // 类型是议题 && 非预览模式 && 没有标题 && 有 placeholder 文字配置才展示\n    if (name === 'topic' && isEmptyNode(item) && topicTitlePlaceholderBefore && topicTitlePlaceholderAfter) {\n      return true;\n    }\n    return false;\n  };\n\n  const handleMentionClick = React.useCallback(() => {\n    const { startBlock } = controller.value;\n    if (startBlock?.key !== first.key) {\n      controller.command(Commands.moveToEndOfNode, first);\n    }\n    controller.dispatch('activeMention');\n  }, [controller, first]);\n\n  const renderTitlePlaceholder = () => {\n    if (name === 'topic') {\n      if (environment.IS_MOBILE) {\n        return (\n          <InlinePlaceholder>\n            {topicTitlePlaceholderBefore}\n            {' @ '}\n            {topicTitlePlaceholderAfter}\n          </InlinePlaceholder>\n        );\n      }\n      return (\n        <InlinePlaceholder>\n          {topicTitlePlaceholderBefore}\n          <InnerCardWrapperForMention>\n            <MentionButton onClick={handleMentionClick} />\n          </InnerCardWrapperForMention>\n          {topicTitlePlaceholderAfter}\n        </InlinePlaceholder>\n      );\n    }\n    return '';\n  };\n\n  const renderTitleToolbar = (displayFinishButton = true) => {\n    const toolbars = [] as any;\n    if (name === 'review' && DingIcon) {\n      toolbars.push(<DingIcon node={node} />);\n    }\n\n    if (name === 'review' && ReviewPlaceholder) {\n      toolbars.push(<ReviewPlaceholder node={node} type=\"iconOnly\" />);\n    }\n\n    if (name === 'topic') {\n      MeetingClock && toolbars.push(<MeetingClock node={node} refreshToolWidth={refreshToolWidth} />);\n      toolbars.push(<TopicToolbar displayFinishButton={displayFinishButton} node={first} controller={controller} config={config} />);\n    }\n\n    return toolbars;\n  };\n\n  // 切割议题的标题和内容块\n  let titleNode: Block;\n  let titleElement: React.ReactNode;\n  let contentElements: React.ReactNode[];\n\n  if (Array.isArray(children) && children.length >= 1) {\n    titleNode = node.nodes[0] as Block;\n    titleElement = children[0];\n    contentElements = children.slice(1);\n  } else {\n    return <>{children}</>;\n  }\n\n  const className = classnames({\n    selected: controller.query(isSubjectSelected, first as SubjectNode),\n  });\n\n  return (\n    <SubjectBox\n      {...attributes}\n      className={className}\n      key={node.key}\n      id={id}\n      data-block-uuid={id}\n      paddingRight={toolWidth}\n      data-cangjie-group-block\n      data-name=\"subject-group\"\n      data-subject-name={name}\n      data-type={node.type}\n      data-foldable\n    >\n      {!environment.IS_MOBILE && isFirst && (\n        <InsertBar\n          style={{ top: -40 }}\n          config={config}\n          node={first}\n          direction=\"before\"\n          controller={controller}\n        />\n      )}\n      <BorderBar color={color} />\n      {highlight && (\n        <HighlightBox\n          color={new TinyColor(color).setAlpha(0.3).toRgbString()}\n          onAnimationEnd={() => setHighlight(false)}\n        />\n      )}\n      <TitleBox\n        dataName=\"subject-group-title\"\n        fold={fold}\n        onChange={handleFoldChange}\n        paddingRight={toolWidth}\n      >\n        <TitleContent data-name=\"subject-group-title-content\">\n          <Placeholder\n            controller={controller}\n            node={titleNode}\n            display={displayTitlePlaceholder}\n            placeholder={renderTitlePlaceholder()}\n          >\n            {titleElement}\n          </Placeholder>\n        </TitleContent>\n        <ToolBox ref={toolRef}>\n          {renderTitleToolbar(displayFinishButton)}\n        </ToolBox>\n      </TitleBox>\n      <ContentBox config={config} dataName=\"subject-group-content\" controller={controller} node={node} fold={fold} paddingRight={toolWidth}>\n        {contentElements}\n      </ContentBox>\n      {!environment.IS_MOBILE && (\n        <InsertBar\n          style={{ bottom: -40 }}\n          config={config}\n          node={first}\n          direction=\"after\"\n          controller={controller}\n        />\n      )}\n    </SubjectBox>\n  );\n};\n\nSubject.displayName = 'Subject';\n\nexport default Subject;\n"],"file":"subject.js"}