{"version":3,"sources":["../../../../../src/plugins/autoClose/handlers/onCangjieInput.ts"],"names":["Commands","isCoupleKey","isLeftCoupleKey","isRightBracket","getRightCoupleKey","isEnglishQuoteKey","isChineseQuoteKey","getChineseQuoteCP","regExp","isTextOrQuote","char","test","onCangjieInput","event","controller","next","data","detail","value","selection","startText","anchor","offset","leftChar","text","rightChar","isExpanded","preventDefault","command","wrapText","isCollapsed","moveForward"],"mappings":"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","sourcesContent":["import {\n  Controller,\n  Commands,\n  CangjieInputEvent,\n  TextPoint,\n} from '@ali/4ever-cangjie';\nimport {\n  isCoupleKey,\n  isLeftCoupleKey,\n  isRightBracket,\n  getRightCoupleKey,\n  isEnglishQuoteKey,\n  isChineseQuoteKey,\n  getChineseQuoteCP,\n} from '../utils/coupleKey';\n\nconst regExp = /[\\u4e00-\\u9fa5\\d\\w]/;\nfunction isTextOrQuote(char) {\n  return char && (regExp.test(char) || isEnglishQuoteKey(char));\n}\n\nexport default function onCangjieInput(event: CangjieInputEvent, controller: Controller, next) {\n  const { data } = event.detail;\n  if (!data || !isCoupleKey(data)) {\n    return next();\n  }\n\n  const { value } = controller;\n  const { selection, startText } = value;\n  if (!selection || !startText) {\n    return next();\n  }\n\n  const { offset } = selection.anchor as TextPoint;\n  const leftChar = startText.text[offset - 1];\n  const rightChar = startText.text[offset];\n  if (selection.isExpanded && isChineseQuoteKey(data)) {\n    event.preventDefault();\n    return controller.command(Commands.wrapText, ...getChineseQuoteCP(data));\n  }\n  if (selection.isExpanded && isLeftCoupleKey(data)) {\n    event.preventDefault();\n    return controller.command(Commands.wrapText, data, getRightCoupleKey(data));\n  }\n  if (selection.isCollapsed && isEnglishQuoteKey(data) && data === rightChar && isTextOrQuote(leftChar)) {\n    event.preventDefault();\n    return controller.command(Commands.moveForward, 1);\n  }\n  if (selection.isCollapsed && isEnglishQuoteKey(data) && (isTextOrQuote(leftChar) || isTextOrQuote(rightChar))) {\n    return next();\n  }\n  if (selection.isCollapsed && isLeftCoupleKey(data)) {\n    event.preventDefault();\n    return controller.command(Commands.wrapText, data, getRightCoupleKey(data));\n  }\n  if (selection.isCollapsed && isRightBracket(data) && rightChar === data) {\n    event.preventDefault();\n    return controller.command(Commands.moveForward, 1);\n  }\n  return next();\n}\n"],"file":"onCangjieInput.js"}