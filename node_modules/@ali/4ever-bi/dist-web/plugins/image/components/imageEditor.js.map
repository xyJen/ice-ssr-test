{"version":3,"sources":["../../../../../src/plugins/image/components/imageEditor.tsx"],"names":["React","throttle","debounce","ResizeObserver","calcRotationObj","calcXAfterRotation","calcYAfterRotation","getRelativeMouseEvent","getRelativeTouchEvent","environment","domUtils","PluginRoles","DraggablePlugin","ImageRotate","ImageRotateHolder","EditorResizeHolder","EditorNum","SelectBorder","BgImg","ImageLoading","RotateControl","ImageEditorFrame","getFixedNumber","getResizeCursor","Position","IMAGE_BG_COLOR","ACCURACY","shouldUseNaturalRatio","data","rectClip","left","right","top","bottom","ImageEditor","props","imageEditor","rotateControl","initialRectData","resizeObserver","mutationObserver","prevImgWidth","mutationFrameId","resizeFrameId","rate","naturalRate","scrollableAncestorsDOM","handleParentScroll","rectData","getRealImgRectData","setState","onResizeStart","relativeEvent","angle","mouse","x","relativeX","y","relativeY","resizing","onEnterResizingMode","onResizeMove","X","Y","state","scale","updateImageSize","onResizeEnd","onChangeSize","l","r","t","b","current","clientWidth","clientHeight","ratio","width","handleMouseDown","e","preventDefault","stopPropagation","getZoomContainer","zoomContainer","document","addEventListener","handleMouseMove","handleMouseUp","removeEventListener","handleTouchStart","targetTouches","length","handleTouchMove","handleTouchEnd","touch","rotation","node","Math","cos","PI","sin","nw","cW","useNaturalRatio","cH","height","updateNaturalRate","target","naturalWidth","naturalHeight","renderResizeHolder","isBlurred","imageConfig","disableResize","cursor","imageResizer","IS_TOUCH_DEVICE","renderRotateHolder","isRotating","onEnterRotationMode","handleRotate","controller","isHide","renderEditBorder","position","renderResizeNumber","normalizedWidth","Number","toFixed","normalizedHeight","renderResizeBg","src","onContextMenu","filter","handleClick","onClick","isImageDraggable","query","enabled","createRef","outlineWidth","outline","initResizeObserver","getImgRef","img","observerCallback","entries","entry","contentRect","window","requestAnimationFrame","observe","initMutationObserver","parent","value","getParent","key","parentDOM","findDOMNodeSafely","MutationObserver","childList","attributes","subtree","attributeFilter","initScrollHandler","parentElement","getAttribute","canScroll","SCROLLABLE_ATTRIBUTE_KEY","push","forEach","ancestorDOM","removeScrollHandler","cancel","componentDidMount","componentWillUnmount","container","disconnect","cancelAnimationFrame","getImgRectData","render","rotateObj","translateX","translateY","oldWidth","oldHeight","oldRotateObj","oldRtX","oldRtY","newRtX","newRtY","backgroundColor","disableRotate","rotateStyle","rHeight","rWidth","style","transform","isEditing","isTouchDevice","enableSingleRotateBtn","IS_MAC","IS_WINDOWS","showMultipleRotateBtn","Component"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { throttle, debounce } from 'lodash-es';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport {\n  calcRotationObj,\n  calcXAfterRotation,\n  calcYAfterRotation,\n  getRelativeMouseEvent,\n  getRelativeTouchEvent,\n  RelativeEventType,\n} from '@ali/4ever-utils';\nimport { Inline, Controller, environment, domUtils } from '@ali/4ever-cangjie';\nimport { PluginRoles, DraggablePlugin } from '@ali/4ever-bamboo';\nimport { ImageData } from '@ali/4ever-mo';\nimport ImageRotate from './imageRotate';\nimport ImageRotateHolder from './imageRotateHolder';\nimport {\n  EditorResizeHolder, EditorNum, SelectBorder, BgImg, ImageLoading,\n  RotateControl, ImageEditorFrame,\n} from './styled';\nimport { IImgRectData } from './types';\nimport { ImagePluginConfig } from '../types';\nimport { getFixedNumber, getResizeCursor } from '../utils';\nimport { Position } from './constants';\n\nconst IMAGE_BG_COLOR = 'rgba(0, 137, 255, .1)';\nconst ACCURACY = 5;\n\nexport interface ImageEditorProps {\n  getZoomContainer(): HTMLElement | null;\n  filter?: (url: string) => boolean;\n  src: string;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  rotation: any;\n  controller: Controller;\n  scale: number;\n  node: Inline;\n  onChangeSize(width: number, height: number, l: number, r: number, t: number, b: number): void;\n  onEnterRotationMode(): void;\n  onEnterResizingMode(): void;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  handleRotate(rotation: any): void;\n  isRotating: boolean;\n  onContextMenu(e: React.MouseEvent): void;\n  imageConfig: ImagePluginConfig;\n  isLoaded: boolean;\n  isBlurred: boolean;\n  getImgRectData: () => IImgRectData;\n  getImgRef: () => HTMLElement | null;\n  onClick?: () => void;\n}\n\nexport interface ImageEditorState {\n  mouse: {\n    x: number;\n    y: number;\n  };\n  width: number;\n  height: number;\n  resizing: boolean;\n  angle: number;\n  l: number;\n  r: number;\n  t: number;\n  b: number;\n  left: number;\n  top?: number;\n}\n\nfunction shouldUseNaturalRatio(data: ImageData) {\n  const { rectClip } = data;\n  return !rectClip || !(rectClip.left || rectClip.right || rectClip.top || rectClip.bottom);\n}\n\nclass ImageEditor extends React.Component<ImageEditorProps, ImageEditorState> {\n  private readonly imageEditor;\n  private readonly rotateControl;\n  private readonly initialRectData;\n  private resizeObserver: ResizeObserver | null = null;\n  private mutationObserver: MutationObserver | null = null;\n  private prevImgWidth: number;\n  private mutationFrameId = -1;\n  private resizeFrameId = -1;\n  private readonly rate: number;\n  private naturalRate?: number;\n  private readonly scrollableAncestorsDOM: Array<HTMLElement|undefined> = [];\n  private readonly handleParentScroll = throttle(() => {\n    const rectData = this.getRealImgRectData();\n    this.setState(rectData);\n  }, 200);\n\n  constructor(props) {\n    super(props);\n\n    const { node } = props;\n    const { width, height, l, r, t, b, left, top } = this.getRealImgRectData();\n\n    this.state = {\n      mouse: {\n        x: 0,\n        y: 0,\n      },\n      width,\n      height,\n      angle: 0,\n      resizing: false,\n      l,\n      r,\n      t,\n      b,\n      left,\n      top,\n    };\n\n    this.rotateControl = React.createRef();\n    this.imageEditor = React.createRef();\n    this.initialRectData = { width, height, l, r, t, b, left, top };\n    const outlineWidth: number = node.data?.outline?.width || 0;\n    this.prevImgWidth = width - 2 * (outlineWidth);\n    this.rate = height / width;\n  }\n\n  initResizeObserver() {\n    const { getImgRef } = this.props;\n    const img = getImgRef();\n    if (!img) {\n      return;\n    }\n\n    const observerCallback = throttle((entries) => {\n      for (const entry of entries) {\n        if (this.prevImgWidth !== entry.contentRect.width) {\n          this.resizeFrameId = window.requestAnimationFrame(() => {\n            const rectData = this.getRealImgRectData();\n            this.setState(rectData);\n          });\n          this.prevImgWidth = entry.contentRect.width;\n        }\n      }\n    }, 300);\n\n    this.resizeObserver = new ResizeObserver(observerCallback);\n    this.resizeObserver.observe(img);\n  }\n\n  initMutationObserver() {\n    const { node } = this.props;\n    const parent = this.props.controller.value.document.getParent(node.key);\n    const parentDOM = parent && domUtils.findDOMNodeSafely(parent.key);\n    if (!parentDOM) {\n      return;\n    }\n\n    const observerCallback = debounce(() => {\n      this.mutationFrameId = window.requestAnimationFrame(() => {\n        const rectData = this.getRealImgRectData();\n        this.setState(rectData);\n      });\n    }, 200);\n\n    this.mutationObserver = new MutationObserver(observerCallback);\n    this.mutationObserver.observe(parentDOM, {\n      childList: true,\n      attributes: true,\n      subtree: true,\n      attributeFilter: ['style'],\n    });\n  }\n\n  initScrollHandler() {\n    const { node } = this.props;\n    let current = domUtils.findDOMNodeSafely(node.key);\n    while (current?.parentElement && !current?.parentElement?.getAttribute('data-cangjie-content')) {\n      const canScroll = current?.parentElement.getAttribute(DraggablePlugin.SCROLLABLE_ATTRIBUTE_KEY);\n      canScroll && this.scrollableAncestorsDOM.push(current?.parentElement);\n      current = current?.parentElement;\n    }\n    this.scrollableAncestorsDOM.forEach((ancestorDOM) => {\n      ancestorDOM && ancestorDOM.addEventListener('scroll', this.handleParentScroll);\n    });\n  }\n\n  removeScrollHandler() {\n    this.scrollableAncestorsDOM.forEach((ancestorDOM) => {\n      ancestorDOM && ancestorDOM.removeEventListener('scroll', this.handleParentScroll);\n    });\n    this.handleParentScroll.cancel();\n  }\n\n  componentDidMount() {\n    this.initResizeObserver();\n    this.initMutationObserver();\n    this.initScrollHandler();\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mousemove', this.handleMouseMove);\n    document.removeEventListener('mouseup', this.handleMouseUp);\n    const { getZoomContainer } = this.props;\n    const container = getZoomContainer();\n    container && container.removeEventListener('touchmove', this.handleTouchMove);\n    container && container.removeEventListener('touchend', this.handleTouchEnd);\n    this.resizeObserver?.disconnect();\n    this.mutationObserver?.disconnect();\n    this.removeScrollHandler();\n    window.cancelAnimationFrame(this.resizeFrameId);\n    window.cancelAnimationFrame(this.mutationFrameId);\n  }\n\n  getRealImgRectData() {\n    const { node } = this.props;\n    const outlineWidth: number = node.data?.outline?.width || 0;\n    const rectData = this.props.getImgRectData();\n    rectData.width += ((outlineWidth as number)) * 2;\n    rectData.height += ((outlineWidth as number)) * 2;\n    return rectData;\n  }\n\n  onResizeStart = (relativeEvent: RelativeEventType, angle: number) => {\n    this.setState({\n      mouse: {\n        x: relativeEvent.relativeX,\n        y: relativeEvent.relativeY,\n      },\n      angle,\n      resizing: false,\n    });\n    this.props.onEnterResizingMode();\n  };\n\n  onResizeMove = (relativeEvent: RelativeEventType) => {\n    const X = relativeEvent.relativeX;\n    const Y = relativeEvent.relativeY;\n    const { mouse } = this.state;\n    const { scale } = this.props;\n\n    if (X !== mouse.x || Y !== mouse.y) {\n      const x = (mouse.x - X) / scale;\n      const y = (mouse.y - Y) / scale;\n      this.updateImageSize(x, y);\n      this.setState({\n        mouse: {\n          x: X,\n          y: Y,\n        },\n        resizing: true,\n      });\n    }\n  };\n\n  onResizeEnd = () => {\n    const { onChangeSize } = this.props;\n    let { l, r, t, b } = this.initialRectData;\n    const { clientWidth, clientHeight } = this.imageEditor.current;\n    const ratio = clientWidth / this.initialRectData.width;\n    l = getFixedNumber(ratio * l, ACCURACY);\n    r = getFixedNumber(ratio * r, ACCURACY);\n    t = getFixedNumber(ratio * t, ACCURACY);\n    b = getFixedNumber(ratio * b, ACCURACY);\n\n    onChangeSize(clientWidth, clientHeight, l, r, t, b);\n    this.setState({\n      resizing: false,\n      angle: 0,\n    });\n  };\n\n  handleMouseDown = (e, angle) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const { getZoomContainer } = this.props;\n    const zoomContainer = getZoomContainer();\n\n    if (!zoomContainer) return;\n\n    const relativeEvent = getRelativeMouseEvent(e, zoomContainer);\n    this.onResizeStart(relativeEvent, angle);\n\n    document.addEventListener('mousemove', this.handleMouseMove);\n    document.addEventListener('mouseup', this.handleMouseUp);\n  };\n\n  handleMouseMove = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const { getZoomContainer } = this.props;\n    const zoomContainer = getZoomContainer();\n    const relativeEvent = getRelativeMouseEvent(e, zoomContainer!);\n    this.onResizeMove(relativeEvent);\n  };\n\n  handleMouseUp = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    this.onResizeEnd();\n\n    document.removeEventListener('mousemove', this.handleMouseMove);\n    document.removeEventListener('mouseup', this.handleMouseUp);\n  };\n\n  handleTouchStart = (e: React.TouchEvent, angle: number) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const { getZoomContainer } = this.props;\n    const zoomContainer = getZoomContainer();\n    const { targetTouches } = e;\n\n    if (!zoomContainer || targetTouches.length > 1) return;\n\n    const relativeEvent = getRelativeTouchEvent(targetTouches[0], zoomContainer);\n    this.onResizeStart(relativeEvent, angle);\n\n    zoomContainer.addEventListener('touchmove', this.handleTouchMove);\n    zoomContainer.addEventListener('touchend', this.handleTouchEnd);\n  };\n\n  handleTouchMove = (e: TouchEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const { getZoomContainer } = this.props;\n    const zoomContainer = getZoomContainer();\n    const touch = e.targetTouches[0];\n    const relativeEvent = getRelativeTouchEvent(touch, zoomContainer!);\n    this.onResizeMove(relativeEvent);\n  };\n\n  handleTouchEnd = (e: TouchEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    this.onResizeEnd();\n\n    const { getZoomContainer } = this.props;\n    const zoomContainer = getZoomContainer();\n    zoomContainer && zoomContainer.removeEventListener('touchmove', this.handleTouchMove);\n    zoomContainer && zoomContainer.removeEventListener('touchend', this.handleTouchEnd);\n  };\n\n  updateImageSize = (x, y) => {\n    const { rotation, node } = this.props;\n    x = x * Math.cos(-rotation / 180 * Math.PI) - y * Math.sin(-rotation / 180 * Math.PI);\n    let nw: number;\n    const { width, angle, l, r, t, b } = this.state;\n    if (angle < 180) {\n      nw = width - x;\n    } else {\n      nw = width + x;\n    }\n\n    // 最小校验\n    if (nw < 24) {\n      nw = 24;\n    }\n\n    const ratio = nw / width;\n\n    const cW = nw;\n    const useNaturalRatio = shouldUseNaturalRatio(node.data);\n    const rate = (useNaturalRatio && this.naturalRate) ? this.naturalRate : this.rate;\n    const cH = nw * rate;\n\n    this.setState({\n      width: cW,\n      height: cH,\n      l: l * ratio,\n      t: t * ratio,\n      r: r * ratio,\n      b: b * ratio,\n    });\n  };\n\n  updateNaturalRate: React.ReactEventHandler<HTMLImageElement> = (e) => {\n    const { target } = e;\n    const { naturalWidth, naturalHeight } = target as HTMLImageElement;\n    this.naturalRate = naturalHeight / naturalWidth;\n  };\n\n  renderResizeHolder = (angle) => {\n    const { isBlurred, imageConfig, rotation } = this.props;\n    const { disableResize } = imageConfig;\n    const cursor = getResizeCursor(angle, rotation);\n    return !disableResize ? (\n      <EditorResizeHolder\n        role=\"resizer\"\n        data-role={`${PluginRoles.imageResizer}${angle}`}\n        angle={angle}\n        cursor={cursor}\n        onMouseDown={(e) => this.handleMouseDown(e, angle)}\n        onMouseUp={this.handleMouseUp}\n        onTouchStart={(e) => this.handleTouchStart(e, angle)}\n        onTouchEnd={this.handleMouseUp}\n        isSupportTouch={environment.IS_TOUCH_DEVICE}\n        isHide={isBlurred}\n      />\n    ) : null;\n  };\n\n  renderRotateHolder = (angle) => {\n    const { isRotating, onEnterRotationMode, handleRotate, rotation, scale, getZoomContainer, controller, isBlurred } = this.props;\n    const { width, height, resizing } = this.state;\n    const isHide = resizing || isBlurred;\n    return (\n      <ImageRotateHolder\n        angle={angle}\n        isSupportTouch={environment.IS_TOUCH_DEVICE}\n        isRotating={isRotating}\n        onEnterRotationMode={onEnterRotationMode}\n        handleRotate={handleRotate}\n        rotation={rotation}\n        width={width}\n        height={height}\n        rotateControl={this.rotateControl.current}\n        rotateImageFrame={this.imageEditor.current}\n        getZoomContainer={getZoomContainer}\n        controller={controller}\n        scale={scale}\n        isHide={isHide}\n      />\n    );\n  };\n\n  renderEditBorder = (position: Position) => (\n    <SelectBorder\n      position={position}\n    />\n  );\n\n  renderResizeNumber = () => {\n    const { width, height, angle, resizing } = this.state;\n    const { isRotating } = this.props;\n    const normalizedWidth = Number(Number(width).toFixed());\n    const normalizedHeight = Number(Number(height).toFixed());\n\n    return isRotating ? null : (\n      <EditorNum\n        angle={angle}\n        resizing={resizing}\n      >\n        {normalizedWidth} × {normalizedHeight}\n      </EditorNum>\n    );\n  };\n\n  renderResizeBg = () => {\n    const { src, isRotating, onContextMenu, filter } = this.props;\n    const { width, height, l, t, r, b, resizing } = this.state;\n    if (src) {\n      return (\n        <BgImg\n          resizing={resizing}\n          rotating={isRotating}\n        >\n          <img\n            src={src}\n            // @ts-ignore 该属性无效\n            filter={filter}\n            onContextMenu={onContextMenu}\n            style={{\n              position: 'relative',\n              left: -l,\n              top: -t,\n              width: typeof width === 'number' ? (width + l + r) : width,\n              height: typeof height === 'number' ? (height + t + b) : height,\n            }}\n            onLoad={this.updateNaturalRate}\n          />\n        </BgImg>\n      );\n    }\n    return <ImageLoading />;\n  };\n\n  handleClick = (e: React.MouseEvent) => {\n    const { onClick, controller } = this.props;\n    const isImageDraggable = controller.query('getDraggableConfig')?.enabled;\n    if (!isImageDraggable) {\n      e.preventDefault();\n    }\n    e.stopPropagation();\n    onClick && onClick();\n  };\n\n  render() {\n    const {\n      onEnterRotationMode,\n      handleRotate,\n      rotation,\n      isRotating,\n      getZoomContainer,\n      scale,\n      controller,\n      imageConfig,\n    } = this.props;\n    const { angle, width, height, resizing } = this.state;\n\n    let rotateObj;\n    if (width > 0 && height > 0) {\n      rotateObj = calcRotationObj(width, height, rotation);\n    }\n\n    let translateX = rotateObj?.translateX || 0;\n    let translateY = rotateObj?.translateY || 0;\n\n    const oldWidth = this.initialRectData.width;\n    const oldHeight = this.initialRectData.height;\n\n    // 修正旋转后缩放的左上角顶点对齐\n    if (rotation !== 0 && oldWidth > 0 && oldHeight > 0) {\n      const oldRotateObj = calcRotationObj(oldWidth, oldHeight, rotation);\n      const oldRtX = calcXAfterRotation(-oldWidth / 2, -oldHeight / 2, rotation, oldRotateObj.translateX);\n      const oldRtY = calcYAfterRotation(-oldWidth / 2, -oldHeight / 2, rotation, oldRotateObj.translateY);\n      const newRtX = calcXAfterRotation(-width / 2, -height / 2, rotation, translateX);\n      const newRtY = calcYAfterRotation(-width / 2, -height / 2, rotation, translateY);\n      translateX = translateX - (newRtX - oldRtX) + (oldWidth - width) / 2;\n      translateY = translateY - (newRtY - oldRtY) + (oldHeight - height) / 2;\n    }\n\n    let backgroundColor = IMAGE_BG_COLOR;\n    if (isRotating || rotation % 90 === 0 || resizing) {\n      backgroundColor = 'transparent';\n    }\n\n    const { disableRotate } = imageConfig;\n\n    const rotateStyle = {\n      height: rotateObj ? rotateObj.rHeight : height,\n      width: rotateObj ? rotateObj.rWidth : width,\n      backgroundColor,\n      left: this.state.left,\n      top: this.state.top,\n    };\n\n    const style = {\n      width,\n      height,\n      top: (angle === 45 || angle === 315) ? 'auto' : 0,\n      left: (angle === 225 || angle === 315) ? 'auto' : 0,\n      bottom: (angle === 225 || angle === 135) ? 'auto' : 0,\n      right: (angle === 45 || angle === 135) ? 'auto' : 0,\n      transform: `translate(${translateX}px, ${translateY}px) rotate(${rotation}deg)`,\n    };\n\n    const isEditing = isRotating || resizing;\n    const isTouchDevice = environment.IS_TOUCH_DEVICE;\n    const enableSingleRotateBtn = isTouchDevice && !(environment.IS_MAC || environment.IS_WINDOWS);\n    const showMultipleRotateBtn = !disableRotate && !enableSingleRotateBtn;\n\n    return (\n      <RotateControl\n        style={rotateStyle}\n        ref={this.rotateControl}\n        data-testid=\"image-select\"\n      >\n        <ImageEditorFrame style={style} ref={this.imageEditor} data-testid=\"image-select-frame\" >\n          {\n            !disableRotate &&\n            enableSingleRotateBtn &&\n            (<ImageRotate\n              isRotating={isRotating}\n              onEnterRotationMode={onEnterRotationMode}\n              handleRotate={handleRotate}\n              rotation={rotation}\n              width={width}\n              height={height}\n              rotateControl={this.rotateControl.current}\n              rotateImageFrame={this.imageEditor.current}\n              getZoomContainer={getZoomContainer}\n              controller={controller}\n              scale={scale}\n            />)\n          }\n          {this.renderResizeBg()}\n          {isEditing && this.renderEditBorder(Position.top)}\n          {isEditing && this.renderEditBorder(Position.right)}\n          {isEditing && this.renderEditBorder(Position.bottom)}\n          {isEditing && this.renderEditBorder(Position.left)}\n          {showMultipleRotateBtn && this.renderRotateHolder(45)}\n          {showMultipleRotateBtn && this.renderRotateHolder(135)}\n          {showMultipleRotateBtn && this.renderRotateHolder(225)}\n          {showMultipleRotateBtn && this.renderRotateHolder(315)}\n          {this.renderResizeHolder(45)}\n          {this.renderResizeHolder(135)}\n          {this.renderResizeHolder(225)}\n          {this.renderResizeHolder(315)}\n          {this.renderResizeNumber()}\n        </ImageEditorFrame>\n      </RotateControl>\n    );\n  }\n}\n\nexport default ImageEditor;\n"],"file":"imageEditor.js"}