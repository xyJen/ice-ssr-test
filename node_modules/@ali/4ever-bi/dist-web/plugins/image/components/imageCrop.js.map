{"version":3,"sources":["../../../../../src/plugins/image/components/imageCrop.tsx"],"names":["React","getRelativeMouseEvent","getRelativeTouchEvent","calcRotationObj","PluginRoles","ImageCropSrcRect","CropOuter","CropImageRotate","CropRealOuter","CropRealImage","CropFakeImage","CropFakeInner","CropFrame","MIN_CROP_DISTANCE","ImageCrop","props","initialRectData","originX","originY","currentX","currentY","cropOuter","cropRealImage","cropFakeImage","cropFakeInner","cropOuterTransform","handleTarget","onCropStart","relativeEvent","orient","parentOrient","current","style","transform","relativeX","relativeY","matchedFrameResize","match","matchedImageResize","handleMouseDown","e","preventDefault","stopPropagation","getZoomContainer","zoomContainer","target","getAttribute","parentNode","document","addEventListener","handleMouseMove","handleMouseUp","handleTouchStart","targetTouches","length","touch","handleTouchMove","handleTouchEnd","updateCropFrame","x","y","state","width","height","l","t","rotation","scale","newWidth","newHeight","cropOuterEle","cropRealImageEle","cropFakeInnerEle","indexOf","Math","max","top","left","oldRotateObj","newRotateObj","translateX","translateY","tlXOld","tlX","tlYOld","tlY","tlXNew","tlYNew","trXOld","trX","trYOld","trY","trXNew","trYNew","finalizeCropFrame","handleCrop","r","b","round","resetOuterPos","setState","updateCropImage","cropFakeImageEle","min","finalizeCropImage","updateTranslateFrame","finalizeTranslateFrame","onCropMove","newX","cos","PI","sin","newY","onCropEnd","removeEventListener","handleExitCroppingMode","event","onExitCroppingMode","contains","exit","getImgRectData","createRef","componentWillUnmount","componentDidMount","render","attributes","src","rotationObj","rotateStyle","rWidth","rHeight","imageCropper","Component"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport {\n  getRelativeMouseEvent,\n  getRelativeTouchEvent,\n  RelativeEventType,\n  calcRotationObj,\n} from '@ali/4ever-utils';\nimport { Controller } from '@ali/4ever-cangjie';\nimport { PluginRoles } from '@ali/4ever-bamboo';\nimport {\n  ImageCropSrcRect, CropOuter, CropImageRotate,\n  CropRealOuter, CropRealImage, CropFakeImage, CropFakeInner, CropFrame,\n} from './styled';\nimport { IImgRectData } from './types';\n\nconst MIN_CROP_DISTANCE = 20;\n\ninterface IProps {\n  onExitCroppingMode: () => void;\n  getZoomContainer(): HTMLElement | null;\n  src: string;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  rotation: any;\n  handleCrop(width: number, height: number, l: number, r: number, t: number, b: number): void\n  controller: Controller;\n  scale: number;\n  getImgRectData: () => IImgRectData;\n  attributes?: any;\n}\n\ninterface IState {\n  width: number;\n  height: number;\n  l: number;\n  r: number;\n  t: number;\n  b: number;\n}\n\nclass ImageCrop extends React.Component<IProps, IState> {\n  private readonly initialRectData: IImgRectData;\n  private originX: number;\n  private originY: number;\n  private currentX: number;\n  private currentY: number;\n  private readonly cropOuter: React.RefObject<HTMLDivElement>;\n  private readonly cropRealImage: React.RefObject<HTMLImageElement>;\n  private readonly cropFakeImage: React.RefObject<HTMLImageElement>;\n  private readonly cropFakeInner: React.RefObject<HTMLDivElement>;\n  private cropOuterTransform: string;\n  private handleTarget: RegExpMatchArray | null;\n\n  constructor(props: IProps) {\n    super(props);\n    this.initialRectData = this.props.getImgRectData();\n    this.originX = 0;\n    this.originY = 0;\n    this.currentX = 0;\n    this.currentY = 0;\n    this.state = {\n      width: this.initialRectData.width,\n      height: this.initialRectData.height,\n      l: this.initialRectData.l,\n      r: this.initialRectData.r,\n      t: this.initialRectData.t,\n      b: this.initialRectData.b,\n    };\n\n    this.handleTarget = null;\n\n    this.cropOuter = React.createRef();\n    this.cropRealImage = React.createRef();\n    this.cropFakeImage = React.createRef();\n    this.cropFakeInner = React.createRef();\n\n    this.cropOuterTransform = '';\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mousemove', this.handleMouseMove);\n    document.removeEventListener('mouseup', this.handleMouseUp);\n    document.removeEventListener('mousedown', this.handleExitCroppingMode);\n    const { getZoomContainer } = this.props;\n    const zoomContainer = getZoomContainer();\n    if (zoomContainer) {\n      zoomContainer.removeEventListener('touchmove', this.handleTouchMove);\n      zoomContainer.removeEventListener('touchend', this.handleTouchEnd);\n      document.removeEventListener('touchstart', this.handleExitCroppingMode);\n    }\n  }\n\n  onCropStart = (relativeEvent: RelativeEventType, orient: string, parentOrient: string) => {\n    this.cropOuterTransform = this.cropOuter.current?.style.transform || '';\n    this.originX = relativeEvent.relativeX;\n    this.originY = relativeEvent.relativeY;\n    this.currentX = relativeEvent.relativeX;\n    this.currentY = relativeEvent.relativeY;\n    const matchedFrameResize = orient.match(/crop-handle-(\\w+)/)\n      || parentOrient.match(/crop-handle-(\\w+)/);\n    const matchedImageResize = orient.match(/image-handle-(\\w+)/)\n      || parentOrient.match(/image-handle-(\\w+)/);\n    if (matchedFrameResize) {\n      this.handleTarget = ['frameResize', matchedFrameResize[1]];\n    } else if (matchedImageResize) {\n      this.handleTarget = ['imageResize', matchedImageResize[1]];\n    } else {\n      this.handleTarget = ['frameTranslate'];\n    }\n  };\n\n  handleMouseDown = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const { getZoomContainer } = this.props;\n    const zoomContainer = getZoomContainer();\n    const relativeEvent = getRelativeMouseEvent(e, zoomContainer!);\n    const orient = e.target.getAttribute('data-orient') || '';\n    const parentOrient = e.target.parentNode.getAttribute('data-orient') || '';\n    this.onCropStart(relativeEvent, orient, parentOrient);\n\n    document.addEventListener('mousemove', this.handleMouseMove);\n    document.addEventListener('mouseup', this.handleMouseUp);\n  };\n\n  handleTouchStart = (e: React.TouchEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const { getZoomContainer } = this.props;\n    const zoomContainer = getZoomContainer();\n    const { targetTouches } = e;\n    if (!zoomContainer || targetTouches.length > 1) {\n      return;\n    }\n    const touch = targetTouches[0];\n    const relativeEvent = getRelativeTouchEvent(touch, zoomContainer);\n    const target = touch.target as HTMLElement;\n    const orient = target.getAttribute('data-orient') || '';\n    const parentOrient = (target.parentNode as HTMLElement)?.getAttribute('data-orient') || '';\n    this.onCropStart(relativeEvent, orient, parentOrient);\n\n    zoomContainer.addEventListener('touchmove', this.handleTouchMove);\n    zoomContainer.addEventListener('touchend', this.handleTouchEnd);\n  };\n\n  updateCropFrame = (x, y, target) => {\n    const { width, height, l, t } = this.state;\n    const { rotation, scale } = this.props;\n    let newWidth = width;\n    let newHeight = height;\n\n    const cropOuterEle = this.cropOuter.current;\n    const cropRealImageEle = this.cropRealImage.current;\n    const cropFakeInnerEle = this.cropFakeInner.current;\n    if (!cropOuterEle || !cropRealImageEle || !cropFakeInnerEle) {\n      return;\n    }\n    if (target.indexOf('s') >= 0) {\n      newHeight = Math.max(height * scale + y, MIN_CROP_DISTANCE * scale);\n      cropOuterEle.style.height = newHeight + 'px';\n    }\n    if (target.indexOf('e') >= 0) {\n      newWidth = Math.max(width * scale + x, MIN_CROP_DISTANCE * scale);\n      cropOuterEle.style.width = newWidth + 'px';\n    }\n    if (target.indexOf('n') >= 0) {\n      newHeight = Math.max(height * scale - y, MIN_CROP_DISTANCE * scale);\n      cropOuterEle.style.height = newHeight + 'px';\n      const top = (-t * scale - y) + 'px';\n      cropRealImageEle.style.top = top;\n      cropFakeInnerEle.style.top = top;\n    }\n    if (target.indexOf('w') >= 0) {\n      newWidth = Math.max(width * scale - x, MIN_CROP_DISTANCE * scale);\n      cropOuterEle.style.width = newWidth + 'px';\n      const left = (-l * scale - x) + 'px';\n      cropRealImageEle.style.left = left;\n      cropFakeInnerEle.style.left = left;\n    }\n    const oldRotateObj = calcRotationObj(width * scale, height * scale, rotation);\n    const newRotateObj = calcRotationObj(newWidth, newHeight, rotation);\n    let translateX = oldRotateObj.translateX;\n    let translateY = oldRotateObj.translateY;\n    // 修正旋转后缩放的左上角顶点对齐\n    if (target === 's' || target === 'e' || target === 'se') {\n      const tlXOld = oldRotateObj.tlX;\n      const tlYOld = oldRotateObj.tlY;\n      const tlXNew = newRotateObj.tlX;\n      const tlYNew = newRotateObj.tlY;\n\n      translateX = translateX - (tlXNew + newWidth / 2 - tlXOld - width * scale / 2);\n      translateY = translateY - (tlYNew + newHeight / 2 - tlYOld - height * scale / 2);\n    }\n    // 修正旋转后缩放的右下角顶点对齐\n    if (target === 'n' || target === 'w' || target === 'nw') {\n      const tlXOld = -oldRotateObj.tlX;\n      const tlYOld = -oldRotateObj.tlY;\n      const tlXNew = -newRotateObj.tlX;\n      const tlYNew = -newRotateObj.tlY;\n\n      translateX = translateX - (tlXNew + newWidth / 2 - tlXOld - width * scale / 2);\n      translateY = translateY - (tlYNew + newHeight / 2 - tlYOld - height * scale / 2);\n    }\n    // 修正旋转后缩放的右上角顶点对齐\n    if (target === 'sw') {\n      const trXOld = oldRotateObj.trX;\n      const trYOld = oldRotateObj.trY;\n      const trXNew = newRotateObj.trX;\n      const trYNew = newRotateObj.trY;\n\n      translateX = translateX - (trXNew + newWidth / 2 - trXOld - width * scale / 2);\n      translateY = translateY - (trYNew + newHeight / 2 - trYOld - height * scale / 2);\n    }\n    // 修正旋转后缩放的左下角顶点对齐\n    if (target === 'ne') {\n      const trXOld = -oldRotateObj.trX;\n      const trYOld = -oldRotateObj.trY;\n      const trXNew = -newRotateObj.trX;\n      const trYNew = -newRotateObj.trY;\n\n      translateX = translateX - (trXNew + newWidth / 2 - trXOld - width * scale / 2);\n      translateY = translateY - (trYNew + newHeight / 2 - trYOld - height * scale / 2);\n    }\n    cropOuterEle.style.transform = `translate(${translateX}px, ${translateY}px) rotate(${rotation}deg)`;\n  };\n\n  finalizeCropFrame = (x, y, target) => {\n    const { handleCrop, scale } = this.props;\n    const { width, height } = this.state;\n    let { l, t, r, b } = this.state;\n    let newWidth = width;\n    let newHeight = height;\n    x = Math.round(x / scale);\n    y = Math.round(y / scale);\n    this.resetOuterPos();\n    if (target.indexOf('n') >= 0) {\n      newHeight = Math.max(height - y, MIN_CROP_DISTANCE);\n      t = t + height - newHeight;\n    }\n    if (target.indexOf('w') >= 0) {\n      newWidth = Math.max(width - x, MIN_CROP_DISTANCE);\n      l = l + width - newWidth;\n    }\n    if (target.indexOf('s') >= 0) {\n      newHeight = Math.max(height + y, MIN_CROP_DISTANCE);\n      b = b + height - newHeight;\n    }\n    if (target.indexOf('e') >= 0) {\n      newWidth = Math.max(width + x, MIN_CROP_DISTANCE);\n      r = r + width - newWidth;\n    }\n    this.setState({\n      l,\n      t,\n      r,\n      b,\n      width: newWidth,\n      height: newHeight,\n    });\n    handleCrop(newWidth, newHeight, l, r, t, b);\n  };\n\n  updateCropImage = (x, y, target) => {\n    const { scale } = this.props;\n    const { l, t, r, b } = this.state;\n    const height = this.state.height + t + b;\n    const width = this.state.width + l + r;\n\n    const cropRealImageEle = this.cropRealImage.current;\n    const cropFakeImageEle = this.cropFakeImage.current;\n    const cropFakeInnerEle = this.cropFakeInner.current;\n    if (!cropRealImageEle || !cropFakeImageEle || !cropFakeInnerEle) {\n      return;\n    }\n\n    if (target.indexOf('s') >= 0) {\n      cropRealImageEle.style.height = Math.max(height * scale + y, MIN_CROP_DISTANCE * scale) + 'px';\n      cropFakeImageEle.style.height = Math.max(height * scale + y, MIN_CROP_DISTANCE * scale) + 'px';\n    }\n    if (target.indexOf('e') >= 0) {\n      cropRealImageEle.style.width = Math.max(width * scale + x, MIN_CROP_DISTANCE * scale) + 'px';\n      cropFakeImageEle.style.width = Math.max(width * scale + x, MIN_CROP_DISTANCE * scale) + 'px';\n    }\n    if (target.indexOf('n') >= 0) {\n      cropRealImageEle.style.height = Math.max(height * scale - y, MIN_CROP_DISTANCE * scale) + 'px';\n      cropFakeImageEle.style.height = Math.max(height * scale - y, MIN_CROP_DISTANCE * scale) + 'px';\n      cropRealImageEle.style.top = (-t * scale + Math.min(y, (height - MIN_CROP_DISTANCE) * scale)) + 'px';\n      cropFakeInnerEle.style.top = (-t * scale + Math.min(y, (height - MIN_CROP_DISTANCE) * scale)) + 'px';\n    }\n    if (target.indexOf('w') >= 0) {\n      cropRealImageEle.style.width = Math.max(width * scale - x, MIN_CROP_DISTANCE) + 'px';\n      cropFakeImageEle.style.width = Math.max(width * scale - x, MIN_CROP_DISTANCE) + 'px';\n      cropRealImageEle.style.left = (-l * scale + Math.min(x, (width - MIN_CROP_DISTANCE) * scale)) + 'px';\n      cropFakeInnerEle.style.left = (-l * scale + Math.min(x, (width - MIN_CROP_DISTANCE) * scale)) + 'px';\n    }\n  };\n\n  finalizeCropImage = (x, y, target) => {\n    let { l, r, t, b } = this.state;\n    const { handleCrop, scale } = this.props;\n    const height = this.state.height + t + b;\n    const width = this.state.width + l + r;\n    x = Math.round(x / scale);\n    y = Math.round(y / scale);\n    this.resetOuterPos();\n    if (target.indexOf('s') >= 0) {\n      b = b + Math.max(y, MIN_CROP_DISTANCE - height);\n    }\n    if (target.indexOf('e') >= 0) {\n      r = r + Math.max(x, MIN_CROP_DISTANCE - width);\n    }\n    if (target.indexOf('n') >= 0) {\n      t = t - Math.min(y, height - MIN_CROP_DISTANCE);\n    }\n    if (target.indexOf('w') >= 0) {\n      l = l - Math.min(x, width - MIN_CROP_DISTANCE);\n    }\n    this.setState({\n      l, r, t, b,\n    });\n    handleCrop(this.state.width, this.state.height, l, r, t, b);\n  };\n\n  updateTranslateFrame = (x, y) => {\n    const { scale } = this.props;\n    const { l, t } = this.state;\n\n    const cropRealImageEle = this.cropRealImage.current;\n    const cropFakeImageEle = this.cropFakeImage.current;\n    const cropFakeInnerEle = this.cropFakeInner.current;\n    if (!cropRealImageEle || !cropFakeImageEle || !cropFakeInnerEle) {\n      return;\n    }\n\n    cropRealImageEle.style.left = (-l * scale + x) + 'px';\n    cropFakeInnerEle.style.left = (-l * scale + x) + 'px';\n\n    cropRealImageEle.style.top = (-t * scale + y) + 'px';\n    cropFakeInnerEle.style.top = (-t * scale + y) + 'px';\n  };\n\n  finalizeTranslateFrame = (x, y) => {\n    const { handleCrop, scale } = this.props;\n    x = Math.round(x / scale);\n    y = Math.round(y / scale);\n    const { width, height } = this.state;\n    this.resetOuterPos();\n    let { l, t, r, b } = this.state;\n    l = l - x;\n    t = t - y;\n    r = r + x;\n    b = b + y;\n    this.setState({\n      l, t, r, b,\n    });\n    handleCrop(width, height, l, r, t, b);\n  };\n\n  onCropMove = (relativeEvent: RelativeEventType) => {\n    const { rotation } = this.props;\n    this.currentX = relativeEvent.relativeX;\n    this.currentY = relativeEvent.relativeY;\n    const x = this.currentX - this.originX;\n    const y = this.currentY - this.originY;\n\n    const newX = x * Math.cos(-rotation / 180 * Math.PI) - y * Math.sin(-rotation / 180 * Math.PI);\n    const newY = x * Math.sin(-rotation / 180 * Math.PI) + y * Math.cos(-rotation / 180 * Math.PI);\n\n    if (this.handleTarget && this.handleTarget[0] === 'frameResize') {\n      this.updateCropFrame(newX, newY, this.handleTarget[1]);\n    } else if (this.handleTarget && this.handleTarget[0] === 'imageResize') {\n      this.updateCropImage(newX, newY, this.handleTarget[1]);\n    } else if (this.handleTarget && this.handleTarget[0] === 'frameTranslate') {\n      this.updateTranslateFrame(newX, newY);\n    }\n  };\n\n  handleMouseMove = (e) => {\n    const { getZoomContainer } = this.props;\n    e.preventDefault();\n    e.stopPropagation();\n\n    const zoomContainer = getZoomContainer();\n    const relativeEvent = getRelativeMouseEvent(e, zoomContainer!);\n    this.onCropMove(relativeEvent);\n  };\n\n  handleTouchMove = (e: TouchEvent) => {\n    const { getZoomContainer } = this.props;\n    e.preventDefault();\n    e.stopPropagation();\n\n    const zoomContainer = getZoomContainer();\n    const { targetTouches } = e;\n    const relativeEvent = getRelativeTouchEvent(targetTouches[0], zoomContainer!);\n    this.onCropMove(relativeEvent);\n  };\n\n  resetOuterPos = () => {\n    const cropOuterEle = this.cropOuter.current;\n    if (!cropOuterEle) {\n      return;\n    }\n\n    cropOuterEle.style.transform = this.cropOuterTransform;\n  };\n\n  onCropEnd = () => {\n    const { rotation } = this.props;\n\n    if (this.originX !== this.currentX || this.originY !== this.currentY) {\n      const x = this.currentX - this.originX;\n      const y = this.currentY - this.originY;\n\n      const newX = x * Math.cos(-rotation / 180 * Math.PI) - y * Math.sin(-rotation / 180 * Math.PI);\n      const newY = x * Math.sin(-rotation / 180 * Math.PI) + y * Math.cos(-rotation / 180 * Math.PI);\n\n      if (this.handleTarget && this.handleTarget[0] === 'frameResize') {\n        this.finalizeCropFrame(newX, newY, this.handleTarget[1]);\n      } else if (this.handleTarget && this.handleTarget[0] === 'imageResize') {\n        this.finalizeCropImage(newX, newY, this.handleTarget[1]);\n      } else if (this.handleTarget && this.handleTarget[0] === 'frameTranslate') {\n        this.finalizeTranslateFrame(newX, newY);\n      }\n    }\n\n    this.handleTarget = null;\n    this.originX = 0;\n    this.originY = 0;\n    this.currentX = 0;\n    this.currentY = 0;\n  };\n\n  handleMouseUp = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    this.onCropEnd();\n\n    document.removeEventListener('mousemove', this.handleMouseMove);\n    document.removeEventListener('mouseup', this.handleMouseUp);\n  };\n\n  handleTouchEnd = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const { getZoomContainer } = this.props;\n\n    const zoomContainer = getZoomContainer();\n    this.onCropEnd();\n\n    zoomContainer!.removeEventListener('touchmove', this.handleTouchMove);\n    zoomContainer!.removeEventListener('touchend', this.handleTouchEnd);\n  };\n\n  handleExitCroppingMode = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n    const { onExitCroppingMode } = this.props;\n    if (this.cropOuter.current && !this.cropOuter.current.contains(event.target)) {\n      onExitCroppingMode();\n    }\n  };\n\n  exit = (event: React.SyntheticEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    const { onExitCroppingMode } = this.props;\n    onExitCroppingMode();\n  };\n\n  componentDidMount() {\n    document.addEventListener('mousedown', this.handleExitCroppingMode);\n    document.addEventListener('touchstart', this.handleExitCroppingMode);\n  }\n\n  render() {\n    const { attributes, src, rotation, scale } = this.props;\n    const { width, height, l, r, t, b } = this.state;\n    const style: React.CSSProperties = {\n      width: width * scale,\n      height: height * scale,\n    };\n    const rotationObj = calcRotationObj(width, height, rotation);\n    if (rotationObj) {\n      style.transform = `translate(${rotationObj.translateX * scale}px, ${rotationObj.translateY * scale}px) rotate(${rotation}deg)`;\n    }\n\n    const rotateStyle = {\n      width: rotationObj ? rotationObj.rWidth * scale : width * scale,\n      height: rotationObj ? rotationObj.rHeight * scale : height * scale,\n      left: this.initialRectData.left,\n      top: this.initialRectData.top,\n    };\n\n    return (\n      <CropImageRotate style={rotateStyle}>\n        <CropOuter\n          ref={this.cropOuter}\n          onMouseDown={this.handleMouseDown}\n          onTouchStart={this.handleTouchStart}\n          style={style}\n          onDoubleClick={this.exit}\n          data-role={PluginRoles.imageCropper}\n        >\n          <CropRealOuter>\n            <CropRealImage\n              ref={this.cropRealImage}\n              src={src}\n              style={{\n                left: -l * scale,\n                top: -t * scale,\n                width: (width + l + r) * scale,\n                height: (height + t + b) * scale,\n              }}\n              {...attributes}\n            />\n          </CropRealOuter>\n          <ImageCropSrcRect />\n          <CropFrame>\n            <CropFakeInner\n              ref={this.cropFakeInner}\n              style={{\n                left: -l * scale,\n                top: -t * scale,\n              }}\n            >\n              <CropFakeImage\n                ref={this.cropFakeImage}\n                src={src}\n                style={{\n                  width: (width + l + r) * scale,\n                  height: (height + t + b) * scale,\n                }}\n              />\n            </CropFakeInner>\n          </CropFrame>\n        </CropOuter>\n      </CropImageRotate>\n    );\n  }\n}\n\nexport default ImageCrop;\n"],"file":"imageCrop.js"}