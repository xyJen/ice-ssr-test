{"version":3,"sources":["../../../../../src/plugins/image/components/imageRotateHolder.tsx"],"names":["React","ReactDOM","calcRotationObj","normalizeAngle","getBoundingRelativeRect","getRelativeMouseEvent","PluginRoles","EditorRotateHolder","RotateCursorWrapper","RotateCursorIcon","RotateCursorNumber","DisableCursor","rotateIcon","rotateIcon2x","fitRotate","ROTATE_CURSOR_OFFSET","ImageRotateHolder","props","angle","getZoomContainer","onEnterRotationMode","width","height","rotation","rotateImageFrame","scale","handleRotate","isHide","originX","useRef","originY","currentX","currentY","rotateHolder","customCursorWrapper","customCursorIcon","rotationNumber","useState","translateX","setTranslateX","translateY","setTranslateY","isHolderRotating","setIsHolderRotating","isMouseEnterHolder","setMouseEnterHolder","useEffect","newTranslateX","newTranslateY","updateCursor","useCallback","e","newRotate","current","style","transform","left","clientX","top","clientY","onRotateStart","relativeEvent","relativeX","relativeY","onRotateMove","container","rect","objX","objY","x1","y1","x2","y2","triangleTop","triangleBottom","arc","Math","atan2","PI","innerText","toFixed","Number","isInteger","onRotateEnd","zoomContainer","handleMouseMove","preventDefault","stopPropagation","handleMouseUp","handleMouseDown","document","addEventListener","removeEventListener","handleMouseMoveInHolder","handleMouseLeave","handleMouseEnter","imageRotator","createPortal","body"],"mappings":"AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;qBAC4B,a;AAA5B,OAAOC,QAAP,MAAqB,WAArB;AAEA,SACEC,eADF,EAEEC,cAFF,EAGEC,uBAHF,EAIEC,qBAJF,QAMO,kBANP;AAOA,SAASC,WAAT,QAA4B,mBAA5B;AACA,SACEC,kBADF,EAEEC,mBAFF,EAGEC,gBAHF,EAIEC,kBAJF,EAKEC,aALF,EAMEC,UANF,EAOEC,YAPF;AASA,OAAOC,SAAP,2B,CAEA;;AACA,IAAMC,oBAAoB,GAAG,CAAC,EAA9B;;wBAqNoD,eAAC,aAAD,O;;AAjMpD,IAAMC,iBAA+C,GAAG,SAAlDA,iBAAkD,CAACC,KAAD,EAAW;AAAA,MACzDC,KADyD,GACoED,KADpE,CACzDC,KADyD;AAAA,MAClDC,gBADkD,GACoEF,KADpE,CAClDE,gBADkD;AAAA,MAChCC,mBADgC,GACoEH,KADpE,CAChCG,mBADgC;AAAA,MACXC,KADW,GACoEJ,KADpE,CACXI,KADW;AAAA,MACJC,MADI,GACoEL,KADpE,CACJK,MADI;AAAA,wBACoEL,KADpE,CACIM,QADJ;AAAA,MACIA,QADJ,gCACe,CADf;AAAA,MACkBC,gBADlB,GACoEP,KADpE,CACkBO,gBADlB;AAAA,MACoCC,KADpC,GACoER,KADpE,CACoCQ,KADpC;AAAA,MAC2CC,YAD3C,GACoET,KADpE,CAC2CS,YAD3C;AAAA,MACyDC,MADzD,GACoEV,KADpE,CACyDU,MADzD;AAEjE,MAAMC,OAAO,GAAG5B,KAAK,CAAC6B,MAAN,CAAqB,CAArB,CAAhB;AACA,MAAMC,OAAO,GAAG9B,KAAK,CAAC6B,MAAN,CAAqB,CAArB,CAAhB;AACA,MAAME,QAAQ,GAAG/B,KAAK,CAAC6B,MAAN,CAAqB,CAArB,CAAjB;AACA,MAAMG,QAAQ,GAAGhC,KAAK,CAAC6B,MAAN,CAAqB,CAArB,CAAjB;AACA,MAAMI,YAAY,GAAGjC,KAAK,CAAC6B,MAAN,CAA8B,IAA9B,CAArB;AACA,MAAMK,mBAAmB,GAAGlC,KAAK,CAAC6B,MAAN,CAA6B,IAA7B,CAA5B;AACA,MAAMM,gBAAgB,GAAGnC,KAAK,CAAC6B,MAAN,CAA6B,IAA7B,CAAzB;AACA,MAAMO,cAAc,GAAGpC,KAAK,CAAC6B,MAAN,CAA6B,IAA7B,CAAvB;;AATiE,wBAU7B7B,KAAK,CAACqC,QAAN,CAAe,CAAf,CAV6B;AAAA,MAU1DC,UAV0D;AAAA,MAU9CC,aAV8C;;AAAA,yBAW7BvC,KAAK,CAACqC,QAAN,CAAe,CAAf,CAX6B;AAAA,MAW1DG,UAX0D;AAAA,MAW9CC,aAX8C;;AAAA,yBAYjBzC,KAAK,CAACqC,QAAN,CAAe,KAAf,CAZiB;AAAA,MAY1DK,gBAZ0D;AAAA,MAYxCC,mBAZwC;;AAAA,yBAaf3C,KAAK,CAACqC,QAAN,CAAwB,KAAxB,CAbe;AAAA,MAa1DO,kBAb0D;AAAA,MAatCC,mBAbsC;;AAejE7C,EAAAA,KAAK,CAAC8C,SAAN,CAAgB,YAAM;AAAA,2BAC6C5C,eAAe,CAACmB,KAAD,EAAQC,MAAR,EAAgBC,QAAhB,CAD5D;AAAA,QACAwB,aADA,oBACZT,UADY;AAAA,QAC2BU,aAD3B,oBACeR,UADf;;AAEpBD,IAAAA,aAAa,CAACQ,aAAD,CAAb;AACAN,IAAAA,aAAa,CAACO,aAAD,CAAb;AACD,GAJD,EAIG,CAAC3B,KAAD,EAAQC,MAAR,EAAgBC,QAAhB,CAJH;AAMA,MAAM0B,YAAY,GAAGjD,KAAK,CAACkD,WAAN,CAAkB,UAACC,CAAD,EAAIC,SAAJ,EAA0B;AAC/D,QAAIlB,mBAAmB,CAACmB,OAAxB,EAAiC;AAC/BlB,MAAAA,gBAAgB,CAACkB,OAAjB,CAA0BC,KAA1B,CAAgCC,SAAhC,gBAAsDH,SAAS,GAAGlC,KAAZ,GAAoBH,oBAA1E;AACAmB,MAAAA,mBAAmB,CAACmB,OAApB,CAA4BC,KAA5B,CAAkCE,IAAlC,GAA4CL,CAAC,CAACM,OAA9C;AACAvB,MAAAA,mBAAmB,CAACmB,OAApB,CAA4BC,KAA5B,CAAkCI,GAAlC,GAA2CP,CAAC,CAACQ,OAA7C;AACD;AACF,GANoB,EAMlB,CAACzC,KAAD,CANkB,CAArB;AAQA,MAAM0C,aAAa,GAAG5D,KAAK,CAACkD,WAAN,CAAkB,UAACW,aAAD,EAAsC;AAC5EzC,IAAAA,mBAAmB;AACnBuB,IAAAA,mBAAmB,CAAC,IAAD,CAAnB;AACAf,IAAAA,OAAO,CAACyB,OAAR,GAAkBQ,aAAa,CAACC,SAAhC;AACAhC,IAAAA,OAAO,CAACuB,OAAR,GAAkBQ,aAAa,CAACE,SAAhC;AACAhC,IAAAA,QAAQ,CAACsB,OAAT,GAAmBQ,aAAa,CAACC,SAAjC;AACA9B,IAAAA,QAAQ,CAACqB,OAAT,GAAmBQ,aAAa,CAACE,SAAjC;AACD,GAPqB,EAOnB,CAAC3C,mBAAD,CAPmB,CAAtB;AASA,MAAM4C,YAAY,GAAGhE,KAAK,CAACkD,WAAN,CAAkB,UAACW,aAAD,EAAmCI,SAAnC,EAA2Dd,CAA3D,EAA6E;AAClH,QAAI,CAAC3B,gBAAL,EAAuB;AACvBO,IAAAA,QAAQ,CAACsB,OAAT,GAAmBQ,aAAa,CAACC,SAAjC;AACA9B,IAAAA,QAAQ,CAACqB,OAAT,GAAmBQ,aAAa,CAACE,SAAjC;AAEA,QAAMG,IAAI,GAAG9D,uBAAuB,CAACoB,gBAAD,EAAmByC,SAAnB,CAApC;AAEA,QAAME,IAAI,GAAGD,IAAI,CAACV,IAAL,GAAYU,IAAI,CAAC7C,KAAL,GAAa,CAAtC;AACA,QAAM+C,IAAI,GAAGF,IAAI,CAACR,GAAL,GAAWQ,IAAI,CAAC5C,MAAL,GAAc,CAAtC;AACA,QAAM+C,EAAE,GAAGzC,OAAO,CAACyB,OAAR,GAAkBc,IAA7B;AACA,QAAMG,EAAE,GAAGxC,OAAO,CAACuB,OAAR,GAAkBe,IAA7B;AACA,QAAMG,EAAE,GAAGxC,QAAQ,CAACsB,OAAT,GAAmBc,IAA9B;AACA,QAAMK,EAAE,GAAGxC,QAAQ,CAACqB,OAAT,GAAmBe,IAA9B;AACA,QAAMK,WAAW,GAAGJ,EAAE,GAAGG,EAAL,GAAUD,EAAE,GAAGD,EAAnC;AACA,QAAMI,cAAc,GAAGL,EAAE,GAAGE,EAAL,GAAUD,EAAE,GAAGE,EAAtC;AACA,QAAMG,GAAG,GAAGC,IAAI,CAACC,KAAL,CAAWJ,WAAX,EAAwBC,cAAxB,IAA0C,GAA1C,GAAgDE,IAAI,CAACE,EAAjE;AACA,QAAI1B,SAAiB,GAAGjD,cAAc,CAACoB,QAAQ,GAAGoD,GAAZ,CAAtC;AACAvB,IAAAA,SAAS,GAAGtC,SAAS,CAACsC,SAAD,CAArB;AACA5B,IAAAA,gBAAgB,CAAC8B,KAAjB,CAAuBC,SAAvB,kBAAgDjB,UAAU,GAAGb,KAA7D,YAAyEe,UAAU,GAAGf,KAAtF,mBAAyG2B,SAAzG;AACAhB,IAAAA,cAAc,CAACiB,OAAf,CAAwB0B,SAAxB,GAAuC3B,SAAS,CAAC4B,OAAV,CAAkBC,MAAM,CAACC,SAAP,CAAiB9B,SAAjB,IAA8B,CAA9B,GAAkC,CAApD,CAAvC;AACAH,IAAAA,YAAY,CAACE,CAAD,EAAIC,SAAJ,CAAZ;AACD,GArBoB,EAqBlB,CAAC7B,QAAD,EAAWC,gBAAX,EAA6BC,KAA7B,EAAoCa,UAApC,EAAgDE,UAAhD,EAA4DS,YAA5D,CArBkB,CAArB;AAuBA,MAAMkC,WAAW,GAAGnF,KAAK,CAACkD,WAAN,CAAkB,YAAM;AAC1C,QAAIE,SAAS,GAAG,IAAhB;;AACA,QAAI5B,gBAAJ,EAAsB;AACpB,UAAM4D,aAAa,GAAGjE,gBAAgB,EAAtC;;AAEA,UAAIS,OAAO,CAACyB,OAAR,KAAoBtB,QAAQ,CAACsB,OAA7B,IAAwCvB,OAAO,CAACuB,OAAR,KAAoBrB,QAAQ,CAACqB,OAAzE,EAAkF;AAChF,YAAMa,IAAI,GAAG9D,uBAAuB,CAACoB,gBAAD,EAAmB4D,aAAnB,CAApC;AACA,YAAMjB,IAAI,GAAGD,IAAI,CAACV,IAAL,GAAYU,IAAI,CAAC7C,KAAL,GAAa,CAAtC;AACA,YAAM+C,IAAI,GAAGF,IAAI,CAACR,GAAL,GAAWQ,IAAI,CAAC5C,MAAL,GAAc,CAAtC;AACA,YAAM+C,EAAE,GAAGzC,OAAO,CAACyB,OAAR,GAAkBc,IAA7B;AACA,YAAMG,EAAE,GAAGxC,OAAO,CAACuB,OAAR,GAAkBe,IAA7B;AACA,YAAMG,EAAE,GAAGxC,QAAQ,CAACsB,OAAT,GAAmBc,IAA9B;AACA,YAAMK,EAAE,GAAGxC,QAAQ,CAACqB,OAAT,GAAmBe,IAA9B;AACA,YAAMK,WAAW,GAAGJ,EAAE,GAAGG,EAAL,GAAUD,EAAE,GAAGD,EAAnC;AACA,YAAMI,cAAc,GAAGL,EAAE,GAAGE,EAAL,GAAUD,EAAE,GAAGE,EAAtC;AACA,YAAMG,GAAG,GAAGC,IAAI,CAACC,KAAL,CAAWJ,WAAX,EAAwBC,cAAxB,IAA0C,GAA1C,GAAgDE,IAAI,CAACE,EAAjE;AACA1B,QAAAA,SAAS,GAAGjD,cAAc,CAACoB,QAAQ,GAAGoD,GAAZ,CAA1B;AACAvB,QAAAA,SAAS,GAAGtC,SAAS,CAACsC,SAAD,CAArB;AACD;AACF;;AACD1B,IAAAA,YAAY,CAAC0B,SAAD,EAAY;AAAA,aAAMT,mBAAmB,CAAC,KAAD,CAAzB;AAAA,KAAZ,CAAZ;AAEAf,IAAAA,OAAO,CAACyB,OAAR,GAAkB,CAAlB;AACAvB,IAAAA,OAAO,CAACuB,OAAR,GAAkB,CAAlB;AACAtB,IAAAA,QAAQ,CAACsB,OAAT,GAAmB,CAAnB;AACArB,IAAAA,QAAQ,CAACqB,OAAT,GAAmB,CAAnB;AACD,GA1BmB,EA0BjB,CAAC3B,YAAD,EAAeF,gBAAf,EAAiCD,QAAjC,EAA2CJ,gBAA3C,CA1BiB,CAApB;AA4BA,MAAMkE,eAAe,GAAGrF,KAAK,CAACkD,WAAN,CAAkB,UAACC,CAAD,EAAmB;AAC3DA,IAAAA,CAAC,CAACmC,cAAF;AACAnC,IAAAA,CAAC,CAACoC,eAAF;AAEA,QAAI,CAAC/D,gBAAL,EAAuB;AACvB,QAAM4D,aAAa,GAAGjE,gBAAgB,EAAtC;AACA,QAAM0C,aAAa,GAAGxD,qBAAqB,CAAC8C,CAAD,EAAIiC,aAAJ,CAA3C;AACApB,IAAAA,YAAY,CAACH,aAAD,EAAgBuB,aAAhB,EAAgCjC,CAAhC,CAAZ;AACD,GARuB,EAQrB,CAAChC,gBAAD,EAAmB6C,YAAnB,EAAiCxC,gBAAjC,CARqB,CAAxB;AAUA,MAAMgE,aAAa,GAAGxF,KAAK,CAACkD,WAAN,CAAkB,UAACC,CAAD,EAAmB;AACzDA,IAAAA,CAAC,CAACmC,cAAF;AACAnC,IAAAA,CAAC,CAACoC,eAAF;AAEAJ,IAAAA,WAAW;AACZ,GALqB,EAKnB,CAACA,WAAD,CALmB,CAAtB;AAOA,MAAMM,eAAe,GAAGzF,KAAK,CAACkD,WAAN,CAAkB,UAACC,CAAD,EAAyB;AACjEA,IAAAA,CAAC,CAACmC,cAAF;AACAnC,IAAAA,CAAC,CAACoC,eAAF;AACA,QAAMH,aAAa,GAAGjE,gBAAgB,EAAtC;;AACA,QAAI,CAACiE,aAAL,EAAoB;AAClB;AACD;;AAED,QAAMvB,aAAa,GAAGxD,qBAAqB,CAAC8C,CAAD,EAAIiC,aAAJ,CAA3C;AAEAxB,IAAAA,aAAa,CAACC,aAAD,CAAb;AACD,GAXuB,EAWrB,CAAC1C,gBAAD,EAAmByC,aAAnB,CAXqB,CAAxB;AAaA5D,EAAAA,KAAK,CAAC8C,SAAN,CAAgB,YAAM;AACpB,QAAIJ,gBAAJ,EAAsB;AACpBgD,MAAAA,QAAQ,CAACC,gBAAT,CAA0B,WAA1B,EAAuCN,eAAvC;AACAK,MAAAA,QAAQ,CAACC,gBAAT,CAA0B,SAA1B,EAAqCH,aAArC;AACD;;AACD,WAAO,YAAM;AACXE,MAAAA,QAAQ,CAACE,mBAAT,CAA6B,WAA7B,EAA0CP,eAA1C;AACAK,MAAAA,QAAQ,CAACE,mBAAT,CAA6B,SAA7B,EAAwCJ,aAAxC;AACD,KAHD;AAID,GATD,EASG,CAACA,aAAD,EAAgBH,eAAhB,EAAiC3C,gBAAjC,CATH;AAWA1C,EAAAA,KAAK,CAAC8C,SAAN,CAAgB,YAAM;AACpB,WAAO,YAAM;AACX;AACApB,MAAAA,YAAY,CAAC,IAAD,CAAZ;AACD,KAHD;AAID,GALD,EAKG,CAACA,YAAD,CALH;AAOA,MAAMmE,uBAAuB,GAAG7F,KAAK,CAACkD,WAAN,CAAkB,UAACC,CAAD,EAAmB;AACnE,QAAIT,gBAAJ,EAAsB;AACpB;AACD;;AACDO,IAAAA,YAAY,CAACE,CAAD,EAAI5B,QAAJ,CAAZ;AACD,GAL+B,EAK7B,CAAC0B,YAAD,EAAeP,gBAAf,EAAiCnB,QAAjC,CAL6B,CAAhC;AAOA,MAAMuE,gBAAgB,GAAG9F,KAAK,CAACkD,WAAN,CAAkB,YAAM;AAC/CL,IAAAA,mBAAmB,CAAC,KAAD,CAAnB;AACD,GAFwB,EAEtB,EAFsB,CAAzB;AAIA,MAAMkD,gBAAgB,GAAG/F,KAAK,CAACkD,WAAN,CAAkB,YAAM;AAC/CL,IAAAA,mBAAmB,CAAC,IAAD,CAAnB;AACD,GAFwB,EAEtB,EAFsB,CAAzB;AAIA7C,EAAAA,KAAK,CAAC8C,SAAN,CAAgB,YAAM;AACpB,QAAIF,kBAAJ,EAAwB;AAAA;;AACtB,+BAAAX,YAAY,CAACoB,OAAb,2CAAsBsC,gBAAtB,CAAuC,WAAvC,EAAoDE,uBAApD;AACD;;AACD,WAAO,YAAM;AAAA;;AACX,gCAAA5D,YAAY,CAACoB,OAAb,4CAAsBuC,mBAAtB,CAA0C,WAA1C,EAAuDC,uBAAvD;AACD,KAFD;AAGD,GAPD,EAOG,CAACjD,kBAAD,EAAqBiD,uBAArB,CAPH;AASA,sBACE,eAAC,KAAD,CAAO,QAAP,qBACE,eAAC,kBAAD;AACE,IAAA,WAAW,EAAEJ,eADf;AAEE,IAAA,YAAY,EAAEM,gBAFhB;AAGE,IAAA,YAAY,EAAED,gBAHhB;AAIE,IAAA,KAAK,EAAE5E,KAJT;AAKE,IAAA,GAAG,EAAEe,YALP;AAME,IAAA,MAAM,EAAEN,MANV;AAOE,IAAA,IAAI,EAAC,SAPP;AAQE,sBAAcrB,WAAW,CAAC0F,YAA1B,GAAyC9E;AAR3C,IADF,EAYI,CAAC0B,kBAAkB,IAAIF,gBAAvB,kBACAzC,QAAQ,CAACgG,YAAT,eACE,eAAC,mBAAD;AACE,IAAA,GAAG,EAAE/D;AADP,kBAGE,eAAC,gBAAD;AACE,IAAA,GAAG,EAAEC,gBADP;AAEE,IAAA,QAAQ,EAAE8C,MAAM,CAAC1D,QAAD,CAAN,GAAmBL,KAAnB,GAA2BH;AAFvC,kBAIE;AACE,IAAA,GAAG,EAAEH,UADP;AAEE,IAAA,MAAM,EAAKC,YAAL;AAFR,IAJF,CAHF,eAYE,eAAC,kBAAD;AAAoB,IAAA,GAAG,EAAEuB,cAAzB;AAAyC,IAAA,QAAQ,EAAEM;AAAnD,IAZF,CADF,EAeGgD,QAAQ,CAACQ,IAfZ,CAbJ,EA+BI,CAACtD,kBAAkB,IAAIF,gBAAvB,SA/BJ,CADF;AAoCD,CArMD;;AAuMA,eAAe1B,iBAAf","sourcesContent":["import * as React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Controller } from '@ali/4ever-cangjie';\nimport {\n  calcRotationObj,\n  normalizeAngle,\n  getBoundingRelativeRect,\n  getRelativeMouseEvent,\n  RelativeEventType,\n} from '@ali/4ever-utils';\nimport { PluginRoles } from '@ali/4ever-bamboo';\nimport {\n  EditorRotateHolder,\n  RotateCursorWrapper,\n  RotateCursorIcon,\n  RotateCursorNumber,\n  DisableCursor,\n  rotateIcon,\n  rotateIcon2x,\n} from './styled';\nimport fitRotate from '../utils/fitRotate';\n\n// 旋转光标未旋转时，其视觉上应该平行于 x 轴，以下常量用于矫正角度\nconst ROTATE_CURSOR_OFFSET = -45;\nexport interface IImageRotateHolder {\n  angle: number;\n  onEnterRotationMode: () => void;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  handleRotate: (rotate: any, cb?: Function) => void;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  rotation: any;\n  width: number;\n  height: number;\n  rotateImageFrame: HTMLElement | null;\n  getZoomContainer: () => HTMLElement | null;\n  controller: Controller;\n  scale: number;\n  isHide: boolean;\n  isSupportTouch?: boolean;\n  isRotating?: boolean;\n  rotateControl?: any;\n}\n\nconst ImageRotateHolder: React.FC<IImageRotateHolder> = (props) => {\n  const { angle, getZoomContainer, onEnterRotationMode, width, height, rotation = 0, rotateImageFrame, scale, handleRotate, isHide } = props;\n  const originX = React.useRef<number>(0);\n  const originY = React.useRef<number>(0);\n  const currentX = React.useRef<number>(0);\n  const currentY = React.useRef<number>(0);\n  const rotateHolder = React.useRef<HTMLSpanElement>(null);\n  const customCursorWrapper = React.useRef<HTMLDivElement>(null);\n  const customCursorIcon = React.useRef<HTMLDivElement>(null);\n  const rotationNumber = React.useRef<HTMLDivElement>(null);\n  const [translateX, setTranslateX] = React.useState(0);\n  const [translateY, setTranslateY] = React.useState(0);\n  const [isHolderRotating, setIsHolderRotating] = React.useState(false);\n  const [isMouseEnterHolder, setMouseEnterHolder] = React.useState<boolean>(false);\n\n  React.useEffect(() => {\n    const { translateX: newTranslateX, translateY: newTranslateY } = calcRotationObj(width, height, rotation);\n    setTranslateX(newTranslateX);\n    setTranslateY(newTranslateY);\n  }, [width, height, rotation]);\n\n  const updateCursor = React.useCallback((e, newRotate: number) => {\n    if (customCursorWrapper.current) {\n      customCursorIcon.current!.style.transform = `rotate(${newRotate + angle - ROTATE_CURSOR_OFFSET}deg)`;\n      customCursorWrapper.current.style.left = `${e.clientX}px`;\n      customCursorWrapper.current.style.top = `${e.clientY}px`;\n    }\n  }, [angle]);\n\n  const onRotateStart = React.useCallback((relativeEvent: RelativeEventType) => {\n    onEnterRotationMode();\n    setIsHolderRotating(true);\n    originX.current = relativeEvent.relativeX;\n    originY.current = relativeEvent.relativeY;\n    currentX.current = relativeEvent.relativeX;\n    currentY.current = relativeEvent.relativeY;\n  }, [onEnterRotationMode]);\n\n  const onRotateMove = React.useCallback((relativeEvent: RelativeEventType, container: HTMLElement, e: MouseEvent) => {\n    if (!rotateImageFrame) return;\n    currentX.current = relativeEvent.relativeX;\n    currentY.current = relativeEvent.relativeY;\n\n    const rect = getBoundingRelativeRect(rotateImageFrame, container);\n\n    const objX = rect.left + rect.width / 2;\n    const objY = rect.top + rect.height / 2;\n    const x1 = originX.current - objX;\n    const y1 = originY.current - objY;\n    const x2 = currentX.current - objX;\n    const y2 = currentY.current - objY;\n    const triangleTop = x1 * y2 - x2 * y1;\n    const triangleBottom = x1 * x2 + y1 * y2;\n    const arc = Math.atan2(triangleTop, triangleBottom) * 180 / Math.PI;\n    let newRotate: number = normalizeAngle(rotation + arc);\n    newRotate = fitRotate(newRotate);\n    rotateImageFrame.style.transform = `translate(${translateX * scale}px, ${translateY * scale}px) rotate(${newRotate}deg)`;\n    rotationNumber.current!.innerText = `${newRotate.toFixed(Number.isInteger(newRotate) ? 0 : 1)}°`;\n    updateCursor(e, newRotate);\n  }, [rotation, rotateImageFrame, scale, translateX, translateY, updateCursor]);\n\n  const onRotateEnd = React.useCallback(() => {\n    let newRotate = null;\n    if (rotateImageFrame) {\n      const zoomContainer = getZoomContainer();\n\n      if (originX.current !== currentX.current || originY.current !== currentY.current) {\n        const rect = getBoundingRelativeRect(rotateImageFrame, zoomContainer);\n        const objX = rect.left + rect.width / 2;\n        const objY = rect.top + rect.height / 2;\n        const x1 = originX.current - objX;\n        const y1 = originY.current - objY;\n        const x2 = currentX.current - objX;\n        const y2 = currentY.current - objY;\n        const triangleTop = x1 * y2 - x2 * y1;\n        const triangleBottom = x1 * x2 + y1 * y2;\n        const arc = Math.atan2(triangleTop, triangleBottom) * 180 / Math.PI;\n        newRotate = normalizeAngle(rotation + arc);\n        newRotate = fitRotate(newRotate);\n      }\n    }\n    handleRotate(newRotate, () => setIsHolderRotating(false));\n\n    originX.current = 0;\n    originY.current = 0;\n    currentX.current = 0;\n    currentY.current = 0;\n  }, [handleRotate, rotateImageFrame, rotation, getZoomContainer]);\n\n  const handleMouseMove = React.useCallback((e: MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    if (!rotateImageFrame) return;\n    const zoomContainer = getZoomContainer();\n    const relativeEvent = getRelativeMouseEvent(e, zoomContainer!);\n    onRotateMove(relativeEvent, zoomContainer!, e);\n  }, [getZoomContainer, onRotateMove, rotateImageFrame]);\n\n  const handleMouseUp = React.useCallback((e: MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    onRotateEnd();\n  }, [onRotateEnd]);\n\n  const handleMouseDown = React.useCallback((e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const zoomContainer = getZoomContainer();\n    if (!zoomContainer) {\n      return;\n    }\n\n    const relativeEvent = getRelativeMouseEvent(e, zoomContainer);\n\n    onRotateStart(relativeEvent);\n  }, [getZoomContainer, onRotateStart]);\n\n  React.useEffect(() => {\n    if (isHolderRotating) {\n      document.addEventListener('mousemove', handleMouseMove);\n      document.addEventListener('mouseup', handleMouseUp);\n    }\n    return () => {\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('mouseup', handleMouseUp);\n    };\n  }, [handleMouseUp, handleMouseMove, isHolderRotating]);\n\n  React.useEffect(() => {\n    return () => {\n      // 销毁时必须重置父组件中 isRotating 的状态\n      handleRotate(null);\n    };\n  }, [handleRotate]);\n\n  const handleMouseMoveInHolder = React.useCallback((e: MouseEvent) => {\n    if (isHolderRotating) {\n      return;\n    }\n    updateCursor(e, rotation);\n  }, [updateCursor, isHolderRotating, rotation]);\n\n  const handleMouseLeave = React.useCallback(() => {\n    setMouseEnterHolder(false);\n  }, []);\n\n  const handleMouseEnter = React.useCallback(() => {\n    setMouseEnterHolder(true);\n  }, []);\n\n  React.useEffect(() => {\n    if (isMouseEnterHolder) {\n      rotateHolder.current?.addEventListener('mousemove', handleMouseMoveInHolder);\n    }\n    return () => {\n      rotateHolder.current?.removeEventListener('mousemove', handleMouseMoveInHolder);\n    };\n  }, [isMouseEnterHolder, handleMouseMoveInHolder]);\n\n  return (\n    <React.Fragment>\n      <EditorRotateHolder\n        onMouseDown={handleMouseDown}\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n        angle={angle}\n        ref={rotateHolder}\n        isHide={isHide}\n        role=\"rotator\"\n        data-role={`${PluginRoles.imageRotator}${angle}`}\n      />\n      {\n        (isMouseEnterHolder || isHolderRotating) &&\n        ReactDOM.createPortal((\n          <RotateCursorWrapper\n            ref={customCursorWrapper}\n          >\n            <RotateCursorIcon\n              ref={customCursorIcon}\n              rotation={Number(rotation) + angle - ROTATE_CURSOR_OFFSET}\n            >\n              <img\n                src={rotateIcon}\n                srcSet={`${rotateIcon2x} 2x`}\n              />\n            </RotateCursorIcon>\n            <RotateCursorNumber ref={rotationNumber} rotating={isHolderRotating} />\n          </RotateCursorWrapper>\n        ), document.body)\n      }\n      {\n        (isMouseEnterHolder || isHolderRotating) && <DisableCursor />\n      }\n    </React.Fragment>\n  );\n};\n\nexport default ImageRotateHolder;\n"],"file":"imageRotateHolder.js"}