{"version":3,"sources":["../../../../../../src/plugins/image/components/SidebarMenus/SizeAndStyleMenu.tsx"],"names":["React","styled","Tooltip","ImagePlugin","UnitConvert","InputNumberItem","CustomInputNumberItem","PluginRoles","domUtils","useZoomContainer","logger","normalizeAngle","blockEvent","getImageSize","updateImage","ImageBorder","zhLocale","RESTORE_DATA","getFixedNumber","ACCURACY","MAX_FIXED_WIDTH","MIN_FIXED_WIDTH","COLUMN_GAP","CustomButton","div","RotateButton","MenuLine","MenuWrapper","ButtonsBox","processNumber","num","maxNumber","accuracy","realNumber","Math","min","getZoomRectClip","rectClip","ratio","left","right","top","bottom","SizeAndStyleMenu","props","controller","config","value","disableStretchMode","locale","image","node","useFocusImage","type","getInlinesByType","at","rotation","data","src","radius","DEFAULT_RADIUS","container","useMemo","memoRealWidth","width","memoRealHeight","height","isValidSize","dom","findDOMNodeSafely","key","window","imageWrapper","querySelector","IMAGE_DATA_WRAPPER_CLASS_NAME","rect","getBoundingClientRect","pix2cm","memoFixedMaxWidth","memoFixedMaxHeight","maxWidth","getImageMaxWidth","maxHeight","widthInCM","heightInCM","maxWidthInCM","maxHeightInCM","fixedMaxWidth","realWidth","realHeight","fixedMaxHeight","fixedMinWidth","fixedMinHeight","handleWidthChange","useCallback","change","px","cm2pix","newWidth","newHeight","zoomRatio","newData","run","sum","handleHeightChange","handleRotationChange","newRotation","handleReverseRotate90","handleRotate90","handleRestore","then","resetWidth","resetHeight","newPayload","handleRadiusChange","inputNumberStyle","flex","restoreStyle","marginTop","textAlign","isInvalidSize","imageSidebarWidthInput","imageSidebarHeightInput","rotateInput","imageSidebarRotationInput","rotateAntiClockwise","imageSidebarReverseRotate90","rotate","imageSidebarRotate90","rotate90","border","borderInput","imageSidebarRadiusInput","imageSidebarRestore","resetTitle"],"mappings":"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","sourcesContent":["import React from 'react';\nimport styled from 'styled-components';\nimport { Tooltip } from '@ali/we-design';\nimport { ImagePlugin, UnitConvert, InputNumberItem, CustomInputNumberItem, PluginRoles } from '@ali/4ever-bamboo';\nimport { Controller, Inline, domUtils, useZoomContainer } from '@ali/4ever-cangjie';\nimport logger from '@ali/4ever-logger';\nimport { normalizeAngle, blockEvent } from '@ali/4ever-utils';\nimport getImageSize from '../../utils/getImageSize';\nimport { ImageData } from '@ali/4ever-mo';\nimport { updateImage } from '../../actions';\nimport { ImageBorder } from '../../components/imageButton';\nimport type { ImagePluginConfig } from '../../types';\nimport zhLocale from '../../../../locales/zh_CN';\nimport { RESTORE_DATA } from '../../constants';\nimport { getFixedNumber } from '../../utils';\n\nconst ACCURACY = 2;\nconst MAX_FIXED_WIDTH = 167;\n// 24 / 37.7952755906 = 0.6349999999991798\nconst MIN_FIXED_WIDTH = 0.63;\nconst COLUMN_GAP = 36;\n\nexport interface ISizeAndStyleMenuProps {\n  controller: Controller;\n  config: ImagePluginConfig;\n}\n\nconst CustomButton = styled.div`\n  padding: 4px 6px;\n  line-height: 20px;\n  border: 1px solid rgba(0,0,0,0.16);\n  border-radius: 4px;\n  font-size: 12px;\n  color: rgb(17, 31, 44);\n  transition: border-color 0.3s ease-in-out;\n  cursor: default;\n  &:hover {\n    border: 1px solid #0089ff;\n  }\n`;\n\nconst RotateButton = styled(CustomButton)`\n  display: flex;\n  width: 28px;\n  height: 28px;\n  align-items: center;\n  justify-content: center;\n  padding: 0;\n`;\n\nconst MenuLine = styled.div`\n  display: grid;\n  grid-template-columns: calc(50% - ${COLUMN_GAP / 2}px) calc(50% - ${COLUMN_GAP / 2}px);\n  grid-column-gap: ${COLUMN_GAP}px;\n  ${RotateButton} + ${RotateButton} {\n    margin-left: 6px;\n  }\n`;\n\nconst MenuWrapper = styled.div`\n  position: relative;\n  ${MenuLine} + ${MenuLine} {\n    margin-top: 12px;\n  }\n`;\n\nconst ButtonsBox = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: flex-start;\n  align-items: center;\n`;\n\nfunction processNumber(num: number, maxNumber: number, accuracy: number = ACCURACY) {\n  const realNumber = Math.min(maxNumber, num);\n  return getFixedNumber(realNumber, accuracy);\n}\n\nfunction getZoomRectClip(rectClip: ImageData['rectClip'], ratio: number) {\n  const { left = 0, right = 0, top = 0, bottom = 0 } = rectClip || {};\n  if (left || right || top || bottom) {\n    return {\n      rectClip: {\n        left: left * ratio,\n        right: right * ratio,\n        top: top * ratio,\n        bottom: bottom * ratio,\n      },\n    };\n  }\n  return {\n    rectClip,\n  };\n}\n\n\nconst SizeAndStyleMenu = (props: ISizeAndStyleMenuProps) => {\n  const { controller, config } = props;\n  const { value } = controller;\n  const { disableStretchMode, locale = zhLocale.image.locale } = config;\n  const node = ImagePlugin.useFocusImage(controller);\n  // 通过右键菜单打开右侧面板时，是选中 text image text，因此不一定直接选中图片\n  // @ts-ignore\n  const image = node?.type === 'image' ? node : node?.getInlinesByType('image')?.at(0) || node;\n  const rotation = node?.data?.rotation || 0;\n  const src = node?.data?.src;\n  const radius = node?.data?.radius || ImagePlugin.DEFAULT_RADIUS;\n  const container = useZoomContainer();\n\n  const [width, height] = React.useMemo(() => {\n    let memoRealWidth = node?.data?.width;\n    let memoRealHeight = node?.data?.height;\n    if (!ImagePlugin.isValidSize(memoRealWidth, memoRealHeight)) {\n      const dom = domUtils.findDOMNodeSafely(image?.key || '', container || window);\n      if (dom) {\n        const imageWrapper = dom.querySelector(`.${ImagePlugin.IMAGE_DATA_WRAPPER_CLASS_NAME}`);\n        const rect = imageWrapper?.getBoundingClientRect();\n        memoRealWidth = UnitConvert.pix2cm(rect?.width);\n        memoRealHeight = UnitConvert.pix2cm(rect?.height);\n      }\n    }\n    return [memoRealWidth, memoRealHeight];\n  }, [image?.data?.width, image?.data?.height, image?.key, container]);\n\n  const ratio = (ImagePlugin.isValidSize(width, height) && width !== 0) ? height / width : 1;\n\n  const [realWidth, realHeight, fixedMaxWidth, fixedMaxHeight] = React.useMemo(() => {\n    let memoRealWidth: number | undefined = UnitConvert.pix2cm(width);\n    let memoRealHeight: number | undefined = UnitConvert.pix2cm(height);\n    let memoFixedMaxWidth;\n    let memoFixedMaxHeight;\n    if (!disableStretchMode || !disableStretchMode()) {\n      // 根据是否启用的自适应\n      const maxWidth = ImagePlugin.getImageMaxWidth(value, node as Inline);\n      const maxHeight = maxWidth * ratio;\n      const widthInCM = UnitConvert.pix2cm(width);\n      const heightInCM = UnitConvert.pix2cm(height);\n      const maxWidthInCM = UnitConvert.pix2cm(maxWidth);\n      const maxHeightInCM = UnitConvert.pix2cm(maxHeight);\n      memoRealWidth = processNumber(widthInCM, maxWidthInCM);\n      memoRealHeight = processNumber(heightInCM, maxHeightInCM);\n      memoFixedMaxWidth = getFixedNumber(maxWidthInCM);\n      memoFixedMaxHeight = getFixedNumber(maxHeightInCM);\n    } else {\n      memoFixedMaxWidth = MAX_FIXED_WIDTH;\n      memoFixedMaxHeight = getFixedNumber(fixedMaxWidth * ratio);\n      memoRealWidth = getFixedNumber(memoRealWidth);\n      memoRealHeight = getFixedNumber(memoRealHeight);\n    }\n    return [memoRealWidth, memoRealHeight, memoFixedMaxWidth, memoFixedMaxHeight];\n  }, [value, disableStretchMode, height, width, node, ratio]);\n\n  const fixedMinWidth = Math.min(MIN_FIXED_WIDTH, fixedMaxWidth);\n  const fixedMinHeight = fixedMinWidth * ratio;\n\n  const handleWidthChange = React.useCallback((change: number | string) => {\n    if (change < fixedMinWidth || change > fixedMaxWidth) {\n      return;\n    }\n\n    const px = UnitConvert.cm2pix(change as number);\n    const newWidth = getFixedNumber(px);\n    const newHeight = newWidth * ratio;\n    if (width !== newWidth || height !== newHeight) {\n      const zoomRatio = newWidth / node?.data.width;\n      const newData = {\n        width: newWidth,\n        height: newHeight,\n        ...getZoomRectClip(node?.data.rectClip, zoomRatio),\n      };\n      controller.run('onAction', updateImage(node, newData));\n      logger.sum('image-sidebar-width');\n    }\n  }, [controller, node, ratio, width, height, fixedMaxWidth, fixedMinWidth]);\n\n  const handleHeightChange = React.useCallback((change: number | string) => {\n    if (change < fixedMinHeight || change > fixedMaxHeight) {\n      return;\n    }\n    const px = UnitConvert.cm2pix(change as number);\n    const newHeight = getFixedNumber(px);\n    const newWidth = newHeight / ratio;\n    if (width !== newWidth || height !== newHeight) {\n      const zoomRatio = newHeight / node?.data.height;\n      const newData = {\n        width: newWidth,\n        height: newHeight,\n        ...getZoomRectClip(node?.data?.rectClip, zoomRatio),\n      };\n      controller.run('onAction', updateImage(node, newData));\n      logger.sum('image-sidebar-height');\n    }\n  }, [ratio, controller, node, width, height, fixedMaxHeight, fixedMinHeight]);\n\n  const handleRotationChange = React.useCallback((change: number | string) => {\n    const newRotation = normalizeAngle(change);\n    if (newRotation !== rotation) {\n      controller.run('onAction', updateImage(image, {\n        rotation: newRotation,\n      }, container));\n    }\n    logger.sum('image-sidebar-rotation');\n  }, [rotation, controller, image, container]);\n\n  const handleReverseRotate90 = React.useCallback(() => {\n    const newRotation = normalizeAngle(rotation - 90);\n    controller.run('onAction', updateImage(image, {\n      rotation: newRotation,\n    }, container));\n    logger.sum('image-sidebar-reverse-rotate90');\n  }, [rotation, controller, image, container]);\n\n  const handleRotate90 = React.useCallback(() => {\n    const newRotation = normalizeAngle(rotation + 90);\n    controller.run('onAction', updateImage(image, {\n      rotation: newRotation,\n    }, container));\n    logger.sum('image-sidebar-rotate90');\n  }, [rotation, controller, image, container]);\n\n  const handleRestore = React.useCallback(() => {\n    getImageSize(src, controller).then(({ width: resetWidth, height: resetHeight }) => {\n      const newPayload = {\n        width: resetWidth,\n        height: resetHeight,\n        ...RESTORE_DATA,\n      };\n      controller.run('onAction', updateImage(node, newPayload));\n      logger.sum('image-sidebar-restore');\n    });\n  }, [src, controller, node]);\n\n  const handleRadiusChange = React.useCallback((change) => {\n    controller.run('onAction', updateImage(node, {\n      radius: change,\n    }));\n    logger.sum('image-sidebar-radius');\n  }, [controller, node]);\n\n  const inputNumberStyle = React.useMemo(() => ({\n    flex: 1,\n  }), []);\n\n  const restoreStyle = React.useMemo<React.CSSProperties>(() => ({\n    marginTop: 12,\n    textAlign: 'center',\n  }), []);\n\n  const isInvalidSize = !ImagePlugin.isValidSize(realWidth, realHeight);\n\n  return node ? (\n    <MenuWrapper>\n      <MenuLine key=\"image-sidebar-size\">\n        <InputNumberItem\n          name=\"image-width\"\n          title={locale.width}\n          unit=\"cm\"\n          value={realWidth}\n          onChange={handleWidthChange}\n          max={fixedMaxWidth}\n          min={MIN_FIXED_WIDTH}\n          key=\"image-set-panel-width\"\n          style={inputNumberStyle}\n          disabled={isInvalidSize}\n          testid=\"image-sidebar-width\"\n          role={PluginRoles.imageSidebarWidthInput}\n        />\n        <InputNumberItem\n          name=\"image-height\"\n          title={locale.height}\n          unit=\"cm\"\n          value={realHeight}\n          onChange={handleHeightChange}\n          max={fixedMaxHeight}\n          min={fixedMinHeight}\n          key=\"image-set-panel-height\"\n          style={inputNumberStyle}\n          disabled={isInvalidSize}\n          testid=\"image-sidebar-height\"\n          role={PluginRoles.imageSidebarHeightInput}\n        />\n      </MenuLine>\n      <MenuLine key=\"image-sidebar-rotation\">\n        <InputNumberItem\n          name=\"image-rotation\"\n          title={locale.rotateInput}\n          unit=\"°\"\n          value={rotation}\n          onChange={handleRotationChange}\n          max={360}\n          min={-360}\n          key=\"image-set-panel-rotation\"\n          style={inputNumberStyle}\n          step={45}\n          testid=\"image-sidebar-rotation\"\n          role={PluginRoles.imageSidebarRotationInput}\n        />\n        <CustomInputNumberItem\n          content={\n            <ButtonsBox>\n              <Tooltip\n                title={locale.rotateAntiClockwise}\n              >\n                <RotateButton\n                  onClick={handleReverseRotate90}\n                  key=\"reverse-rotate-90\"\n                  data-testid=\"image-sidebar-reverse-rotate-90\"\n                  data-role={PluginRoles.imageSidebarReverseRotate90}\n                >\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" fill=\"none\"><path d=\"M2.696 6.572a.5.5 0 1 0-1 0v5a.498.498 0 0 0 .5.5h5a.5.5 0 1 0 0-1H3.403L5.05 9.425A7 7 0 0 1 17 14.375a.5.5 0 1 0 1 0A8 8 0 0 0 4.343 8.718l-1.647 1.647V6.572z\" fill=\"#171A1D\"/></svg>\n                </RotateButton>\n              </Tooltip>\n              <Tooltip\n                title={locale.rotate}\n              >\n                <RotateButton\n                  onClick={handleRotate90}\n                  key=\"rotate-90\"\n                  data-testid=\"image-sidebar-rotate-90\"\n                  data-role={PluginRoles.imageSidebarRotate90}\n                >\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" fill=\"none\"><path d=\"M17.304 6.572a.5.5 0 0 1 1 0v5a.499.499 0 0 1-.5.5h-5a.5.5 0 1 1 0-1h3.793L14.95 9.425A7 7 0 0 0 3 14.375a.5.5 0 0 1-1 0 8 8 0 0 1 13.657-5.657l1.647 1.647V6.572z\" fill=\"#171A1D\"/></svg>\n                </RotateButton>\n              </Tooltip>\n            </ButtonsBox>\n          }\n          style={inputNumberStyle}\n          title={locale.rotate90 || 'Rotate 90°'}\n        />\n      </MenuLine>\n      <MenuLine key=\"image-sidebar-border\">\n        <CustomInputNumberItem\n          content={\n            <ImageBorder\n              controller={controller}\n              locale={locale}\n              isButtonType\n            />\n          }\n          style={inputNumberStyle}\n          title={locale.border?.borderInput || 'Border'}\n        />\n        <InputNumberItem\n          name=\"image-radius\"\n          title={locale.radius}\n          value={radius}\n          onChange={handleRadiusChange}\n          min={0}\n          max={9999}\n          key=\"image-set-panel-radius\"\n          style={inputNumberStyle}\n          testid=\"image-sidebar-radius\"\n          data-role={PluginRoles.imageSidebarRadiusInput}\n        />\n      </MenuLine>\n      <CustomButton\n        onMouseDown={blockEvent}\n        onClick={handleRestore}\n        style={restoreStyle}\n        data-testid=\"image-sidebar-restore\"\n        data-role={PluginRoles.imageSidebarRestore}\n      >\n        {locale.resetTitle}\n      </CustomButton>\n    </MenuWrapper>\n  ) : null;\n};\n\nexport default SizeAndStyleMenu;\n"],"file":"SizeAndStyleMenu.js"}