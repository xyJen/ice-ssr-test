{"version":3,"sources":["../../../../../src/plugins/image/components/imageRotate.tsx"],"names":["React","ReactDOM","calcRotationObj","normalizeAngle","getBoundingRelativeRect","getRelativeTouchEvent","PluginRoles","RotateControlPot","RotateLine","EditorNum","fitRotate","ImageRotate","props","originX","originY","currentX","currentY","editorNum","onRotateStart","relativeEvent","onEnterRotationMode","relativeX","relativeY","onRotateMove","zoomContainer","state","translateX","translateY","rotateControl","rotation","rotateImageFrame","scale","rect","rectControl","current","style","display","left","top","objX","width","objY","height","x1","y1","x2","y2","triangleTop","triangleBottom","arc","Math","atan2","PI","newRotate","transform","setState","currentRotation","onRotateEnd","handleRotate","getZoomContainer","handleTouchStart","e","preventDefault","stopPropagation","targetTouches","length","addEventListener","handleTouchEnd","handleTouchMove","removeEventListener","renderRotateNumber","isRotating","createPortal","createRef","getDerivedStateFromProps","nextProps","prevStates","prevRotation","rWidth","rHeight","componentWillUnmount","render","imageSingleRotator","Component"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport {\n  calcRotationObj,\n  normalizeAngle,\n  getBoundingRelativeRect,\n  getRelativeTouchEvent,\n  RelativeEventType,\n} from '@ali/4ever-utils';\nimport { Controller } from '@ali/4ever-cangjie';\nimport { PluginRoles } from '@ali/4ever-bamboo';\nimport {\n  RotateControlPot,\n  RotateLine,\n  EditorNum,\n} from './styled';\nimport fitRotate from '../utils/fitRotate';\n\nexport interface ImageRotateProps {\n  isRotating: boolean;\n  onEnterRotationMode(): void;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  handleRotate(rotate: any): void;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  rotation: any;\n  width: number;\n  height: number;\n  rotateControl: HTMLElement | null;\n  rotateImageFrame: HTMLElement | null;\n  getZoomContainer(): HTMLElement | null;\n  controller: Controller;\n  scale: number;\n}\n\nexport interface ImageRotateState {\n  translateX: number;\n  translateY: number;\n  currentRotation: number;\n  rotation: number;\n  width: number;\n  height: number;\n}\n\nclass ImageRotate extends React.Component<ImageRotateProps, ImageRotateState> {\n  originX: number;\n  originY: number;\n  currentX: number;\n  currentY: number;\n  editorNum: React.RefObject<any>;\n\n  constructor(props) {\n    super(props);\n\n    const { width, height } = props;\n    const rotation = this.props.rotation || 0;\n    const { translateX, translateY } = calcRotationObj(width, height, rotation);\n    this.originX = 0;\n    this.originY = 0;\n    this.currentX = 0;\n    this.currentY = 0;\n    this.state = {\n      rotation,\n      currentRotation: rotation,\n      translateX,\n      translateY,\n      width,\n      height,\n    };\n    this.editorNum = React.createRef();\n  }\n\n  static getDerivedStateFromProps(nextProps, prevStates) {\n    const { width, height } = nextProps;\n    const rotation = nextProps.rotation || 0;\n    const prevRotation = prevStates.rotation || 0;\n    if (rotation !== prevRotation\n      || width !== prevStates.width || height !== prevStates.height) {\n      const { rWidth, rHeight, translateX, translateY } = calcRotationObj(width, height, rotation);\n      return ({\n        rotation,\n        currentRotation: rotation,\n        translateX,\n        translateY,\n        rWidth,\n        rHeight,\n        width,\n        height,\n      });\n    }\n    return null;\n  }\n\n  componentWillUnmount() {\n    const { getZoomContainer } = this.props;\n    const zoomContainer = getZoomContainer();\n    if (zoomContainer) {\n      zoomContainer.removeEventListener('touchend', this.handleTouchEnd);\n      zoomContainer.removeEventListener('touchmove', this.handleTouchMove);\n    }\n  }\n\n  onRotateStart = (relativeEvent: RelativeEventType) => {\n    const { onEnterRotationMode } = this.props;\n    onEnterRotationMode();\n\n    this.originX = relativeEvent.relativeX;\n    this.originY = relativeEvent.relativeY;\n    this.currentX = relativeEvent.relativeX;\n    this.currentY = relativeEvent.relativeY;\n  };\n\n  onRotateMove = (relativeEvent: RelativeEventType, zoomContainer: HTMLElement) => {\n    const { translateX, translateY } = this.state;\n    const { rotateControl, rotation, rotateImageFrame, scale } = this.props;\n\n    if (!rotateImageFrame || !rotateControl) return;\n\n    this.currentX = relativeEvent.relativeX;\n    this.currentY = relativeEvent.relativeY;\n\n    const rect = getBoundingRelativeRect(rotateImageFrame, zoomContainer);\n    const rectControl = getBoundingRelativeRect(rotateControl, zoomContainer);\n\n    this.editorNum.current.style.display = 'inline';\n    this.editorNum.current.style.left = (this.currentX - rectControl.left) + 16 + 'px';\n    this.editorNum.current.style.top = (this.currentY - rectControl.top) + 'px';\n\n    const objX = rect.left + rect.width / 2;\n    const objY = rect.top + rect.height / 2;\n    const x1 = this.originX - objX;\n    const y1 = this.originY - objY;\n    const x2 = this.currentX - objX;\n    const y2 = this.currentY - objY;\n    const triangleTop = x1 * y2 - x2 * y1;\n    const triangleBottom = x1 * x2 + y1 * y2;\n    const arc = Math.atan2(triangleTop, triangleBottom) * 180 / Math.PI;\n    let newRotate = normalizeAngle(rotation + arc);\n    newRotate = fitRotate(newRotate);\n    rotateImageFrame.style.transform = `translate(${translateX * scale}px, ${translateY * scale}px) rotate(${newRotate}deg)`;\n    this.setState({\n      currentRotation: newRotate,\n    });\n  };\n\n  onRotateEnd = () => {\n    const { rotation, handleRotate, rotateImageFrame, getZoomContainer } = this.props;\n\n    let newRotate = null;\n\n    if (rotateImageFrame) {\n      if (this.originX !== this.currentX || this.originY !== this.currentY) {\n        const rect = getBoundingRelativeRect(rotateImageFrame, getZoomContainer());\n        const objX = rect.left + rect.width / 2;\n        const objY = rect.top + rect.height / 2;\n        const x1 = this.originX - objX;\n        const y1 = this.originY - objY;\n        const x2 = this.currentX - objX;\n        const y2 = this.currentY - objY;\n        const triangleTop = x1 * y2 - x2 * y1;\n        const triangleBottom = x1 * x2 + y1 * y2;\n        const arc = Math.atan2(triangleTop, triangleBottom) * 180 / Math.PI;\n        newRotate = normalizeAngle(rotation + arc);\n        newRotate = fitRotate(newRotate);\n      }\n    }\n\n    handleRotate(newRotate);\n\n    this.originX = 0;\n    this.originY = 0;\n    this.currentX = 0;\n    this.currentY = 0;\n  };\n\n  handleTouchStart = (e: React.TouchEvent) => {\n    const { getZoomContainer } = this.props;\n    e.preventDefault();\n    e.stopPropagation();\n\n    const zoomContainer = getZoomContainer();\n    const { targetTouches } = e;\n    if (!zoomContainer || targetTouches.length > 1) {\n      return;\n    }\n    const relativeEvent = getRelativeTouchEvent(targetTouches[0], zoomContainer);\n\n    this.onRotateStart(relativeEvent);\n\n    zoomContainer.addEventListener('touchend', this.handleTouchEnd);\n    zoomContainer.addEventListener('touchmove', this.handleTouchMove);\n  };\n\n  handleTouchMove = (e: TouchEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const { rotateImageFrame, getZoomContainer } = this.props;\n    const zoomContainer = getZoomContainer();\n    const { targetTouches } = e;\n    const relativeEvent = getRelativeTouchEvent(targetTouches[0], zoomContainer!);\n\n    if (!rotateImageFrame) return;\n\n    this.onRotateMove(relativeEvent, zoomContainer!);\n  };\n\n  handleTouchEnd = (e: TouchEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    this.onRotateEnd();\n\n    const { getZoomContainer } = this.props;\n    const zoomContainer = getZoomContainer();\n    zoomContainer && zoomContainer.removeEventListener('touchmove', this.handleTouchMove);\n    zoomContainer && zoomContainer.removeEventListener('touchend', this.handleTouchEnd);\n  };\n\n  renderRotateNumber: () => React.ReactPortal | null = () => {\n    const { currentRotation } = this.state;\n    const { isRotating, rotateControl } = this.props;\n    const rotation = normalizeAngle(currentRotation, true);\n\n    // 传送到没有rotate的control层\n    return isRotating && rotateControl ? ReactDOM.createPortal(\n      <EditorNum ref={this.editorNum} style={{ display: 'none' }} rotating>\n        {rotation}°\n      </EditorNum>,\n      rotateControl,\n    ) : null;\n  };\n\n  render() {\n    return (\n      <span>\n        <RotateLine />\n        <RotateControlPot\n          onTouchStart={this.handleTouchStart}\n          data-role={PluginRoles.imageSingleRotator}\n        />\n        {this.renderRotateNumber()}\n      </span>\n    );\n  }\n}\n\nexport default ImageRotate;\n"],"file":"imageRotate.js"}