{"version":3,"sources":["../../../../src/plugins/image/createRenderHoverToolbar.tsx"],"names":["React","PreviewBetaNormal","TBItemSlot","IconDownload","IconCutPic","IconRotateLeftLineThin","IconSetting","RestorepictureNormal","ChangePicNormal","Commands","Point","Selection","PluginRoles","Image","normalizeAngle","setImageInjection","updateImage","toggleImageSidebar","getData","ImageStyleIconMenu","getImageSize","RESTORE_DATA","createRenderHoverToolbar","config","locale","downloadImage","previewImage","props","controller","getNode","getImageNode","node","isImage","buttonName","extraProps","icon","title","cropping","tooltip","onClick","anchor","createFromParams","getFirstNode","key","newSelection","create","focus","command","select","run","isImageCropping","role","imageInlineToolbarCrop","testid","downloadImg","src","data","imageInlineToolbarDownload","previewImg","imageInlineToolbarPreview","rotate90","rotation","newRotation","imageInlineToolbarRotateReverse","advancedSettings","toggle","imageOptions","autoClose","onOverlayVisibleChange","fontSize","resetTitle","then","width","height","newPayload","imageReset"],"mappings":";AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;qBAC4B,a;AAA5B,SAASC,iBAAT,QAAkC,gBAAlC;AACA,SAASC,UAAT,QAA2B,qBAA3B;AACA,SAAUC,YAAV,EAAwBC,UAAxB,EAAoCC,sBAApC,EAA4DC,WAA5D,QAA+E,sBAA/E;AACA,SAASC,oBAAoB,IAAIC,eAAjC,QAAwD,cAAxD;AACA,SAASC,QAAT,EAA2BC,KAA3B,EAAkCC,SAAlC,QAAmD,oBAAnD;AACA,SAASC,WAAT,QAA4B,mBAA5B;AACA,SAASC,KAAT,QAAsB,eAAtB;AACA,SAASC,cAAT,QAA+B,kBAA/B;AAGA,SAASC,iBAAT;AACA,SAASC,WAAT,EAAsBC,kBAAtB;AACA,SAASC,OAAT,QAAwB,kBAAxB;AACA,SAASC,kBAAT;AACA,OAAOC,YAAP;AACA,SAASC,YAAT;;wBAkBgB,eAAC,UAAD,O;;yBAwBA,eAAC,YAAD,O;;yBAaA,eAAC,iBAAD,O;;yBAYA,eAAC,sBAAD,O;;yBAiBA,eAAC,WAAD,O;;AAlFhB,eAAe,SAASC,wBAAT,CACbC,MADa,EAEmB;AAAA,uBACqBA,MADrB,CACxBC,MADwB;AAAA,MACxBA,MADwB,+BACf,EADe;AAAA,MACXC,aADW,GACqBF,MADrB,CACXE,aADW;AAAA,MACIC,YADJ,GACqBH,MADrB,CACIG,YADJ;AAEhC,SAAO,UAACC,KAAD,EAAQC,UAAR,EAAoBC,OAApB,EAAgC;AACrC,QAAMC,YAAY,GAAG,SAAfA,YAAe,GAAM;AACzB,UAAMC,IAAI,GAAGF,OAAO,EAApB;;AACA,UAAIhB,KAAK,CAACmB,OAAN,CAAcD,IAAd,CAAJ,EAAyB;AACvB,eAAOA,IAAP;AACD;;AACD,aAAO,IAAP;AACD,KAND;;AADqC,QAQ7BE,UAR6B,GAQFN,KARE,CAQ7BM,UAR6B;AAAA,QAQjBC,UARiB,GAQFP,KARE,CAQjBO,UARiB;;AASrC,YAAQD,UAAR;AACE,WAAK,MAAL;AACE,eAAO;AACLE,UAAAA,IAAI,MADC;AAELC,UAAAA,KAAK,EAAEZ,MAAF,oBAAEA,MAAM,CAAEa,QAFV;AAGLC,UAAAA,OAAO,EAAEd,MAAF,oBAAEA,MAAM,CAAEa,QAHZ;AAILE,UAAAA,OAAO,EAAE,mBAAM;AACb,gBAAMR,IAAI,GAAGD,YAAY,EAAzB;AACA,gBAAI,CAACjB,KAAK,CAACmB,OAAN,CAAcD,IAAd,CAAL,EAA0B;AAC1B,gBAAMS,MAAM,GAAG9B,KAAK,CAAC+B,gBAAN,CAAuBV,IAAI,CAACW,YAAL,GAAoBC,GAA3C,EAAgD,CAAhD,CAAf;AACA,gBAAMC,YAAY,GAAGjC,SAAS,CAACkC,MAAV,CAAiB;AACpCL,cAAAA,MAAM,EAANA,MADoC;AAEpCM,cAAAA,KAAK,EAAEN;AAF6B,aAAjB,CAArB;AAIAZ,YAAAA,UAAU,CAACmB,OAAX,CAAmBtC,QAAQ,CAACuC,MAA5B,EAAoCJ,YAApC;AACAhB,YAAAA,UAAU,CAACqB,GAAX,CACE,UADF,EAEElC,iBAAiB,CAACgB,IAAI,CAACY,GAAN,EAAW;AAC1BO,cAAAA,eAAe,EAAE;AADS,aAAX,CAFnB;AAMD,WAnBI;AAoBLC,UAAAA,IAAI,EAAEvC,WAAW,CAACwC,sBApBb;AAqBLC,UAAAA,MAAM,EAAE;AArBH,SAAP;;AAuBF,WAAK,UAAL;AACE,eAAO5B,aAAa,GAAG;AACrBU,UAAAA,IAAI,OADiB;AAErBC,UAAAA,KAAK,EAAEZ,MAAF,oBAAEA,MAAM,CAAE8B,WAFM;AAGrBhB,UAAAA,OAAO,EAAEd,MAAF,oBAAEA,MAAM,CAAE8B,WAHI;AAIrBf,UAAAA,OAAO,EAAE,mBAAM;AAAA;;AACb,gBAAMR,IAAI,GAAGD,YAAY,EAAzB;AACA,gBAAMyB,GAAG,GAAGxB,IAAH,kCAAGA,IAAI,CAAEyB,IAAT,qBAAG,WAAYD,GAAxB;AACAA,YAAAA,GAAG,IAAI9B,aAAa,CAAC8B,GAAD,CAApB;AACD,WARoB;AASrBJ,UAAAA,IAAI,EAAEvC,WAAW,CAAC6C,0BATG;AAUrBJ,UAAAA,MAAM,EAAE;AAVa,SAAH,GAWhB,IAXJ;;AAYF,WAAK,SAAL;AACE,eAAO3B,YAAY,GAAG;AACpBS,UAAAA,IAAI,OADgB;AAEpBC,UAAAA,KAAK,EAAEZ,MAAF,oBAAEA,MAAM,CAAEkC,UAFK;AAGpBpB,UAAAA,OAAO,EAAEd,MAAF,oBAAEA,MAAM,CAAEkC,UAHG;AAIpBnB,UAAAA,OAAO,EAAE,mBAAM;AAAA;;AACb,gBAAMR,IAAI,GAAGD,YAAY,EAAzB;AACA,gBAAMyB,GAAG,GAAGxB,IAAH,mCAAGA,IAAI,CAAEyB,IAAT,qBAAG,YAAYD,GAAxB;AACAA,YAAAA,GAAG,IAAI7B,YAAY,CAAC6B,GAAD,EAAOxB,IAAP,CAAnB;AACD,WARmB;AASpBoB,UAAAA,IAAI,EAAEvC,WAAW,CAAC+C;AATE,SAAH,GAUf,IAVJ;;AAWF,WAAK,QAAL;AACE,eAAO;AACLxB,UAAAA,IAAI,OADC;AAELC,UAAAA,KAAK,EAAEZ,MAAF,oBAAEA,MAAM,CAAEoC,QAFV;AAGLtB,UAAAA,OAAO,EAAEd,MAAF,oBAAEA,MAAM,CAAEoC,QAHZ;AAILrB,UAAAA,OAAO,EAAE,mBAAM;AACb,gBAAMR,IAAI,GAAGD,YAAY,EAAzB;AACA,gBAAI,CAACC,IAAL,EAAW;AACX,gBAAM8B,QAAQ,GAAG3C,OAAO,CAAEa,IAAD,CAAiByB,IAAlB,EAAwB,UAAxB,EAAoC,CAApC,CAAxB;AACA,gBAAMM,WAAW,GAAGhD,cAAc,CAAC+C,QAAQ,GAAG,EAAZ,CAAlC;AACAjC,YAAAA,UAAU,CAACqB,GAAX,CAAe,UAAf,EAA2BjC,WAAW,CAACe,IAAD,EAAO;AAC3C8B,cAAAA,QAAQ,EAAEC;AADiC,aAAP,CAAtC;AAGD,WAZI;AAaLX,UAAAA,IAAI,EAAEvC,WAAW,CAACmD,+BAbb;AAcLV,UAAAA,MAAM,EAAE;AAdH,SAAP;;AAgBF,WAAK,SAAL;AACE,eAAO;AACLlB,UAAAA,IAAI,OADC;AAELC,UAAAA,KAAK,EAAEZ,MAAF,oBAAEA,MAAM,CAAEwC,gBAFV;AAGL1B,UAAAA,OAAO,EAAEd,MAAF,oBAAEA,MAAM,CAAEwC,gBAHZ;AAILzB,UAAAA,OAAO,EAAE,mBAAM;AACb,gBAAMR,IAAI,GAAGD,YAAY,EAAzB;AACA,gBAAI,CAACC,IAAL,EAAW;AACX,gBAAMS,MAAM,GAAG9B,KAAK,CAAC+B,gBAAN,CAAuBV,IAAI,CAACY,GAA5B,EAAiC,QAAjC,CAAf;AACA,gBAAMG,KAAK,GAAGpC,KAAK,CAAC+B,gBAAN,CAAuBV,IAAI,CAACY,GAA5B,EAAiC,OAAjC,CAAd;AACA,gBAAMC,YAAY,GAAGjC,SAAS,CAACkC,MAAV,CAAiB;AACpCL,cAAAA,MAAM,EAANA,MADoC;AAEpCM,cAAAA,KAAK,EAALA;AAFoC,aAAjB,CAArB;AAIAlB,YAAAA,UAAU,CAACmB,OAAX,CAAmBtC,QAAQ,CAACuC,MAA5B,EAAoCJ,YAApC;AACAb,YAAAA,IAAI,IAAIH,UAAU,CAACqB,GAAX,CAAe,UAAf,EAA2BhC,kBAAkB,CAAC;AACpDc,cAAAA,IAAI,EAAJA,IADoD;AAEpDkC,cAAAA,MAAM,EAAE;AAF4C,aAAD,CAA7C,CAAR;AAID,WAlBI;AAmBLd,UAAAA,IAAI,EAAEvC,WAAW,CAACsD,YAnBb;AAoBLC,UAAAA,SAAS,EAAE,IApBN;AAqBLd,UAAAA,MAAM,EAAE;AArBH,SAAP;;AAuBF,WAAK,OAAL;AAAA,YACUe,sBADV,GACqClC,UADrC,CACUkC,sBADV;AAEE,4BACE,eAAC,UAAD;AAAY,UAAA,OAAO,EAAC;AAApB,wBACE,eAAC,kBAAD;AACE,UAAA,UAAU,EAAExC,UADd;AAEE,UAAA,MAAM,EAAEJ,MAFV;AAGE,UAAA,sBAAsB,EAAE4C,sBAH1B;AAIE,UAAA,YAAY,EAAEtC,YAJhB;AAKE,UAAA,MAAM,EAAC;AALT,UADF,CADF;;AAWF,WAAK,OAAL;AACE,eAAO;AACLK,UAAAA,IAAI,eAAE,eAAC,eAAD;AAAiB,YAAA,KAAK,EAAE;AAAEkC,cAAAA,QAAQ,EAAE;AAAZ;AAAxB,YADD;AAELjC,UAAAA,KAAK,EAAEZ,MAAF,oBAAEA,MAAM,CAAE8C,UAFV;AAGLhC,UAAAA,OAAO,EAAEd,MAAF,oBAAEA,MAAM,CAAE8C,UAHZ;AAIL/B,UAAAA,OAAO,EAAE,mBAAM;AACb,gBAAMR,IAAI,GAAGD,YAAY,EAAzB;AACA,gBAAI,CAACC,IAAL,EAAW;AACXX,YAAAA,YAAY,CAACW,IAAI,CAACyB,IAAL,CAAUD,GAAX,EAAgB3B,UAAhB,CAAZ,CAAwC2C,IAAxC,CAA6C,iBAAuB;AAAA,kBAApBC,KAAoB,SAApBA,KAAoB;AAAA,kBAAbC,MAAa,SAAbA,MAAa;;AAClE,kBAAMC,UAAU;AACdF,gBAAAA,KAAK,EAALA,KADc;AAEdC,gBAAAA,MAAM,EAANA;AAFc,iBAGXpD,YAHW,CAAhB;;AAKAO,cAAAA,UAAU,CAACqB,GAAX,CAAe,UAAf,EAA2BjC,WAAW,CAACe,IAAD,EAAO2C,UAAP,CAAtC;AACD,aAPD;AAQD,WAfI;AAgBLvB,UAAAA,IAAI,EAAEvC,WAAW,CAAC+D,UAhBb;AAiBLtB,UAAAA,MAAM,EAAE;AAjBH,SAAP;;AAmBF;AAAS,eAAO,IAAP;AA5HX;AA8HD,GAvID;AAwID","sourcesContent":["import * as React from 'react';\nimport { PreviewBetaNormal } from '@ali/we-design';\nimport { TBItemSlot } from '@ali/we-design-next';\nimport {  IconDownload, IconCutPic, IconRotateLeftLineThin, IconSetting } from '@ali/4ever-component';\nimport { RestorepictureNormal as ChangePicNormal } from '@ali/we-icon';\nimport { Commands, Inline, Point, Selection } from '@ali/4ever-cangjie';\nimport { PluginRoles } from '@ali/4ever-bamboo';\nimport { Image } from '@ali/4ever-mo';\nimport { normalizeAngle } from '@ali/4ever-utils';\nimport type { BiPlugin } from '../../types';\nimport { ImagePluginConfig } from './types';\nimport { setImageInjection } from './actions';\nimport { updateImage, toggleImageSidebar } from './actions';\nimport { getData } from '@ali/4ever-utils';\nimport { ImageStyleIconMenu } from './components/next/ImageStyleIconMenu';\nimport getImageSize from './utils/getImageSize';\nimport { RESTORE_DATA } from './constants';\n\nexport default function createRenderHoverToolbar(\n  config: ImagePluginConfig\n): BiPlugin['renderHoverToolbar'] {\n  const { locale = {}, downloadImage, previewImage } = config;\n  return (props, controller, getNode) => {\n    const getImageNode = () => {\n      const node = getNode();\n      if (Image.isImage(node)) {\n        return node;\n      }\n      return null;\n    }\n    const { buttonName, extraProps } = props;\n    switch (buttonName) {\n      case 'crop':\n        return {\n          icon: <IconCutPic/>,\n          title: locale?.cropping,\n          tooltip: locale?.cropping,\n          onClick: () => {\n            const node = getImageNode();\n            if (!Image.isImage(node)) return;\n            const anchor = Point.createFromParams(node.getFirstNode().key, 0);\n            const newSelection = Selection.create({\n              anchor,\n              focus: anchor,\n            });\n            controller.command(Commands.select, newSelection);\n            controller.run(\n              'onAction',\n              setImageInjection(node.key, {\n                isImageCropping: true,\n              }),\n            );\n          },\n          role: PluginRoles.imageInlineToolbarCrop,\n          testid: 'bi-toolbar-image-crop',\n        };\n      case 'download':\n        return downloadImage ? {\n          icon: <IconDownload />,\n          title: locale?.downloadImg,\n          tooltip: locale?.downloadImg,\n          onClick: () => {\n            const node = getImageNode();\n            const src = node?.data?.src;\n            src && downloadImage(src);\n          },\n          role: PluginRoles.imageInlineToolbarDownload,\n          testid: 'bi-toolbar-image-download',\n        } : null;\n      case 'preview':\n        return previewImage ? {\n          icon: <PreviewBetaNormal />,\n          title: locale?.previewImg,\n          tooltip: locale?.previewImg,\n          onClick: () => {\n            const node = getImageNode();\n            const src = node?.data?.src;\n            src && previewImage(src, (node as Inline));\n          },\n          role: PluginRoles.imageInlineToolbarPreview,\n        } : null;\n      case 'rotate':\n        return {\n          icon: <IconRotateLeftLineThin />,\n          title: locale?.rotate90,\n          tooltip: locale?.rotate90,\n          onClick: () => {\n            const node = getImageNode();\n            if (!node) return;\n            const rotation = getData((node as Inline).data, 'rotation', 0);\n            const newRotation = normalizeAngle(rotation - 90);\n            controller.run('onAction', updateImage(node, {\n              rotation: newRotation,\n            }));\n          },\n          role: PluginRoles.imageInlineToolbarRotateReverse,\n          testid: 'bi-toolbar-image-rotate',\n        }\n      case 'options':\n        return {\n          icon: <IconSetting />,\n          title: locale?.advancedSettings,\n          tooltip: locale?.advancedSettings,\n          onClick: () => {\n            const node = getImageNode();\n            if (!node) return;\n            const anchor = Point.createFromParams(node.key, 'before');\n            const focus = Point.createFromParams(node.key, 'after');\n            const newSelection = Selection.create({\n              anchor,\n              focus,\n            });\n            controller.command(Commands.select, newSelection);\n            node && controller.run('onAction', toggleImageSidebar({\n              node,\n              toggle: true,\n            }));\n          },\n          role: PluginRoles.imageOptions,\n          autoClose: true,\n          testid: 'bi-toolbar-image-options',\n        };\n      case 'style':\n        const { onOverlayVisibleChange } = extraProps;\n        return (\n          <TBItemSlot display='iconMenu'>\n            <ImageStyleIconMenu\n              controller={controller}\n              locale={locale}\n              onOverlayVisibleChange={onOverlayVisibleChange}\n              getImageNode={getImageNode}\n              testid=\"bi-toolbar-image-style\"\n            />\n          </TBItemSlot>\n        );\n      case 'reset':\n        return {\n          icon: <ChangePicNormal style={{ fontSize: 20 }}/>,\n          title: locale?.resetTitle,\n          tooltip: locale?.resetTitle,\n          onClick: () => {\n            const node = getImageNode();\n            if (!node) return;\n            getImageSize(node.data.src, controller).then(({ width, height }) => {\n              const newPayload = {\n                width,\n                height,\n                ...RESTORE_DATA,\n              };\n              controller.run('onAction', updateImage(node, newPayload));\n            });\n          },\n          role: PluginRoles.imageReset,\n          testid: 'bi-toolbar-image-reset',\n        };\n      default: return null;\n    }\n  };\n}\n"],"file":"createRenderHoverToolbar.js"}