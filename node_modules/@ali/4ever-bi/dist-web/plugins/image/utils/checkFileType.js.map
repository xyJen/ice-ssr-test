{"version":3,"sources":["../../../../../src/plugins/image/utils/checkFileType.ts"],"names":["ImagePlugin","checkFileType","file","buffer","ImageTypeEnum","getImageTypeFromBuffer","partialBuffer","slice","imageType","fileTypeRegExp","execRes","exec","name","fileType","UNCERTAIN","newFile","File","replace","type"],"mappings":"AAAA,SAASA,WAAT,QAA4B,mBAA5B;;AACA,IAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAACC,IAAD,EAAaC,MAAb,EAAqC;AAAA,MACjDC,aADiD,GACPJ,WADO,CACjDI,aADiD;AAAA,MAClCC,sBADkC,GACPL,WADO,CAClCK,sBADkC;AAEzD,MAAMC,aAAa,GAAGH,MAAM,CAACI,KAAP,CAAa,CAAb,EAAgB,CAAhB,CAAtB;AACA,MAAMC,SAAS,GAAGH,sBAAsB,CAACC,aAAD,CAAxC;AACA,MAAMG,cAAc,GAAG,oBAAvB;AACA,MAAMC,OAAO,GAAGD,cAAc,CAACE,IAAf,CAAoBT,IAAI,CAACU,IAAzB,CAAhB;AACA,MAAMC,QAAQ,GAAIH,OAAO,IAAIA,OAAO,CAAC,CAAD,CAAnB,IAA2B,EAA5C;;AACA,MAAIF,SAAS,KAAKJ,aAAa,CAACU,SAA5B,IAAyCD,QAAQ,KAAKL,SAA1D,EAAqE;AACnE,QAAMO,OAAO,GAAG,IAAIC,IAAJ,CAAS,CAACd,IAAD,CAAT,EAAoBA,IAAI,CAACU,IAAL,CAAUK,OAAV,CAAkBR,cAAlB,EAAkC,EAAlC,CAApB,SAA6DD,SAA7D,EAA0E;AACxFU,MAAAA,IAAI,aAAWV;AADyE,KAA1E,CAAhB;AAGA,WAAO;AACLN,MAAAA,IAAI,EAAEa,OADD;AAELG,MAAAA,IAAI,EAAEV;AAFD,KAAP;AAID;;AACD,SAAO;AACLN,IAAAA,IAAI,EAAJA,IADK;AAELgB,IAAAA,IAAI,EAAEL;AAFD,GAAP;AAID,CApBD;;AAsBA,eAAeZ,aAAf","sourcesContent":["import { ImagePlugin } from '@ali/4ever-bamboo';\nconst checkFileType = (file: File, buffer: ArrayBuffer) => {\n  const { ImageTypeEnum, getImageTypeFromBuffer } = ImagePlugin;\n  const partialBuffer = buffer.slice(0, 4);\n  const imageType = getImageTypeFromBuffer(partialBuffer);\n  const fileTypeRegExp = /\\.([a-zA-Z0-9_]*)$/;\n  const execRes = fileTypeRegExp.exec(file.name);\n  const fileType = (execRes && execRes[1]) || '';\n  if (imageType !== ImageTypeEnum.UNCERTAIN && fileType !== imageType) {\n    const newFile = new File([file], `${file.name.replace(fileTypeRegExp, '')}.${imageType}`, {\n      type: `image/${imageType}`,\n    });\n    return {\n      file: newFile,\n      type: imageType,\n    };\n  }\n  return {\n    file,\n    type: fileType,\n  };\n};\n\nexport default checkFileType;\n"],"file":"checkFileType.js"}