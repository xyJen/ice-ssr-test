{"version":3,"sources":["../../../../../src/plugins/image/handlers/createContextMenu.ts"],"names":["Image","PcContextMenu","toggleImageSidebar","createContextMenu","config","sideBarTrigger","locale","contextMenu","controller","next","value","document","selection","isCollapsed","start","getStart","end","getEnd","node1","getNextText","key","node2","getPreviousText","closeContextMenu","onActionController","run","node","getClosestVoid","isImage","name","options","action","toggle","callback","group"],"mappings":"AACA,SAASA,KAAT,QAAsB,eAAtB;AACA,SAASC,aAAT,QAA8B,mBAA9B;AACA,SAASC,kBAAT;;AAIA,SAASC,iBAAT,CAA2BC,MAA3B,EAAsDC,cAAtD,EAAoH;AAAA,uBAC1FD,MAD0F,CAC1GE,MAD0G;AAAA,MAC1GA,MAD0G,+BACjG,EADiG;AAGlH,SAAO,SAASC,WAAT,CAAqBC,UAArB,EAAiCC,IAAjC,EAAuC;AAAA,4BACZD,UAAU,CAACE,KADC;AAAA,QACpCC,QADoC,qBACpCA,QADoC;AAAA,QAC1BC,SAD0B,qBAC1BA,SAD0B;AAAA,QAEpCC,WAFoC,GAEpBD,SAFoB,CAEpCC,WAFoC;;AAG5C,QAAI,CAACA,WAAD,IAAgBR,cAApB,EAAoC;AAClC,UAAMS,KAAK,GAAGF,SAAS,CAACG,QAAV,CAAmBJ,QAAnB,CAAd;AACA,UAAMK,GAAG,GAAGJ,SAAS,CAACK,MAAV,CAAiBN,QAAjB,CAAZ;AACA,UAAMO,KAAK,GAAGP,QAAQ,CAACQ,WAAT,CAAqBL,KAAK,CAACM,GAA3B,CAAd;AACA,UAAMC,KAAK,GAAGV,QAAQ,CAACW,eAAT,CAAyBN,GAAG,CAACI,GAA7B,CAAd;;AACA,UAAMG,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACC,kBAAD,EAAoC;AAC3DA,QAAAA,kBAAkB,CAACC,GAAnB,CAAuB,UAAvB,EAAmCxB,aAAa,CAACsB,gBAAd,EAAnC;AACD,OAFD;;AAGA,UAAIL,KAAK,IAAIG,KAAT,IAAkBH,KAAK,KAAKG,KAAhC,EAAuC;AACrC,YAAMK,IAAI,GAAGf,QAAQ,CAACgB,cAAT,CAAwBT,KAAK,CAACE,GAA9B,EAAmCZ,UAAnC,CAAb;;AACA,YAAIR,KAAK,CAAC4B,OAAN,CAAcF,IAAd,CAAJ,EAAyB;AACvB,2BACKjB,IAAI,EADT,GAEE;AACEoB,YAAAA,IAAI,EAAE,CAAAvB,MAAM,QAAN,YAAAA,MAAM,CAAEwB,OAAR,KAAmB,eAD3B;AAEEV,YAAAA,GAAG,EAAE,eAFP;AAGEW,YAAAA,MAAM,EAAE7B,kBAAkB,CAAC;AAAEwB,cAAAA,IAAI,EAAJA,IAAF;AAAQM,cAAAA,MAAM,EAAE,IAAhB;AAAsBC,cAAAA,QAAQ,EAAEV;AAAhC,aAAD,CAH5B;AAIEO,YAAAA,OAAO,EAAE;AACPI,cAAAA,KAAK,EAAE;AADA;AAJX,WAFF;AAWD;AACF;AACF;;AACD,WAAOzB,IAAI,EAAX;AACD,GA7BD;AA8BD;;AAED,eAAeN,iBAAf","sourcesContent":["import { Plugin, Controller } from '@ali/4ever-cangjie';\nimport { Image } from '@ali/4ever-mo';\nimport { PcContextMenu } from '@ali/4ever-bamboo';\nimport { toggleImageSidebar } from '../actions';\nimport { ImagePluginConfig } from '../types';\nimport { SidebarTriggerConfig } from '../../../types';\n\nfunction createContextMenu(config: ImagePluginConfig, sideBarTrigger?: SidebarTriggerConfig): Plugin['contextMenu'] {\n  const { locale = {} } = config;\n\n  return function contextMenu(controller, next) {\n    const { document, selection } = controller.value;\n    const { isCollapsed } = selection;\n    if (!isCollapsed && sideBarTrigger) {\n      const start = selection.getStart(document);\n      const end = selection.getEnd(document);\n      const node1 = document.getNextText(start.key);\n      const node2 = document.getPreviousText(end.key);\n      const closeContextMenu = (onActionController: Controller) => {\n        onActionController.run('onAction', PcContextMenu.closeContextMenu());\n      };\n      if (node1 && node2 && node1 === node2) {\n        const node = document.getClosestVoid(node1.key, controller);\n        if (Image.isImage(node)) {\n          return [\n            ...next(),\n            {\n              name: locale?.options || 'Image options',\n              key: 'image-options',\n              action: toggleImageSidebar({ node, toggle: true, callback: closeContextMenu }),\n              options: {\n                group: 2,\n              },\n            },\n          ];\n        }\n      }\n    }\n    return next();\n  };\n}\n\nexport default createContextMenu;\n"],"file":"createContextMenu.js"}