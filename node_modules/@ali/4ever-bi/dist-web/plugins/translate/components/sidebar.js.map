{"version":3,"sources":["../../../../../src/plugins/translate/components/sidebar.tsx"],"names":["React","styled","throttle","ExclamationCircleBetaNormal","Select","SelectOption","Option","theme","Button","replaceWithTranslatedText","insertTranslatedText","useState","useEffect","useRef","MAX_WORD_COUNT","Wrapper","div","Content","p","isFailed","colorRed1","ContentStatus","ContentWrapper","ButtonWrapper","SelectionWrapper","fontSizeSmall","Selection","InnerWrapper","Footer","colorText1","PlaceholderWrapper","span","list","title","key","Sidebar","props","controller","getTranslation","defaultOutputLanguage","outputLanguageList","locale","maxWordCount","wrapperStyle","value","input","setInput","failedText","setFailedText","outputLanguage","setOutputLanguage","isExceedText","setExceedText","text","fragment","inputLanguage","undefined","handleChange","targetLan","then","res","failed","throttled","inputText","outputLan","length","exceedMaxLength","substring","current","disableReplaceText","selection","isCollapsed","disableInsertText","renderContent","content","placeholder","translateTo","map","l","color","run","replace","marginLeft","insert","footer","defaultProps","v"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport styled from 'styled-components';\nimport { throttle } from 'lodash-es';\nimport { ExclamationCircleBetaNormal, Select, SelectOption as Option, theme, Button } from '@ali/we-design';\nimport { replaceWithTranslatedText, insertTranslatedText } from '../actions';\nimport type { Controller } from '@ali/4ever-cangjie';\n\nconst { useState, useEffect, useRef } = React;\n\nconst MAX_WORD_COUNT = 100;\n\nexport interface IGetTranslation {\n  inputLanguage: string;\n  outputLanguage: string;\n  input: string;\n}\n\nexport interface ITranslateConfig {\n  getTranslation?: any; // 翻译接口\n  defaultOutputLanguage?: string; // 默认输出语言\n  outputLanguageList: any[];\n  maxWordCount?: number, // 最大翻译字数, 目前是字符 TODO\n  wrapperStyle?: React.CSSProperties,\n}\n\nexport interface ISidebarTranslate extends ITranslateConfig, ISidebar { }\n\nexport interface ISidebar {\n  controller: Controller;\n  locale: Record<string, any>;\n}\n\n\nconst Wrapper = styled.div<any>`\n  box-sizing: border-box;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  color: rgba(17,31,44,0.72);\n`;\n\n// 允许换行 和 多空格\nconst Content = styled.div<{ isFailed?: boolean }>`\n  width: 100%;\n  color: ${p => (p.isFailed ? theme.colorRed1 : 'inherit')};\n  word-break: break-all;\n  overflow-x: hidden;\n  overflow-y: scroll;\n  white-space: pre-wrap;\n`;\n\nconst ContentStatus = styled.div`\n  width: 100%;\n  color: #FB602D;\n`;\n\nconst ContentWrapper = styled.div<{ isFailed?: boolean }>`\n  flex: auto;\n  overflow: auto;\n  display: flex;\n  justify-content: space-between;\n  flex-direction: column;\n  max-height: 379px; \n  width: 100%;\n  border: 1px solid ${p => (p.isFailed ? '#FB602D' : 'rgba(126, 134, 142, 0.24)')};\n  border-radius: 8px;\n  padding: 10px;\n  margin: 10px 0;\n  font-size: 13px;\n`;\n\nconst ButtonWrapper = styled.div`\n  display: flex;\n  flex-direction: row;\n  margin-bottom: 50px;\n  margin-top: 6px;\n`;\n\nconst SelectionWrapper = styled.div`\n  font-size: ${theme.fontSizeSmall};\n  display: flex;\n  align-items: center;\n  flex-direction: row;\n  flex-shrink: 0;\n`;\n\nconst Selection = styled.div`\n  margin-right: 16px;\n  height: 14px;\n  line-height: 14px;\n  font-size: 14px;\n`;\n\nconst InnerWrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nconst Footer = styled.div`\n  color: ${theme.colorText1};\n  font-size: ${theme.fontSizeSmall};\n  text-align: center;\n  margin-bottom: 16px;\n`;\n\nconst PlaceholderWrapper = styled.span`\n  color: rgba(23, 26, 29, 0.24);\n  font-size: 14px;\n  line-height: 18px;\n`;\n\nconst list = [\n  {\n    title: '英文',\n    key: 'en',\n  },\n  {\n    title: '中文',\n    key: 'zh',\n  },\n];\n\nconst Sidebar: React.FC<ISidebarTranslate> = props => {\n  const {\n    controller,\n    getTranslation,\n    defaultOutputLanguage,\n    outputLanguageList,\n    locale = {},\n    maxWordCount,\n    wrapperStyle,\n  } = props;\n  const { value } = controller;\n  const [input, setInput] = useState();\n  const [failedText, setFailedText] = useState();\n  const [outputLanguage, setOutputLanguage] = useState(defaultOutputLanguage);\n  const [isExceedText, setExceedText] = useState(null);\n  let text: string = value.fragment && value.fragment.text;\n\n  const inputLanguage = undefined;\n\n  const handleChange = (targetLan: string) => {\n    setOutputLanguage(targetLan);\n    getTranslation({ inputLanguage, outputLanguage: targetLan, input: text })\n      .then(res => {\n        setFailedText(null);\n        setInput(res);\n      })\n      .catch(() => {\n        // handle exception\n        setFailedText(locale.failed || '翻译失败, 请重试.');\n      });\n  };\n\n  // add throttled to aovid frequent uses input\n  const throttled = useRef(\n    throttle((inputText: string, outputLan: string) => {\n      if (getTranslation) {\n        getTranslation({ inputLanguage, outputLanguage: outputLan, input: inputText })\n          .then(res => {\n            setFailedText(null);\n            setInput(res);\n          })\n          .catch(() => {\n            // handle exception\n            setFailedText(locale.failed || '翻译失败, 请重试.');\n          });\n      }\n    }, 500),\n  );\n\n  useEffect(() => {\n    // add async translation service here\n    if (text) {\n      // cut the input with limits\n      if (text.length > maxWordCount) {\n        setExceedText(locale.exceedMaxLength || '超过最大翻译字数');\n      } else {\n        setExceedText('');\n      }\n      text = text.substring(0, maxWordCount);\n      throttled.current(text, outputLanguage);\n    }\n  }, [text]);\n\n  const disableReplaceText = !!controller.value.selection.isCollapsed || !input || failedText;\n  const disableInsertText = !input || failedText;\n\n  const renderContent = () => {\n    const content = input ? input : (\n      <PlaceholderWrapper>\n        {locale.placeholder || '划词，将在面板中显示翻译结果'}\n      </PlaceholderWrapper>\n    );\n    if (failedText) {\n      return (\n        <Content isFailed>\n          <ExclamationCircleBetaNormal />\n          {failedText}\n        </Content>\n      );\n    } else if (isExceedText) {\n      return (\n        <React.Fragment>\n          <Content>{content}</Content>\n          <ContentStatus>\n            <ExclamationCircleBetaNormal />\n            {isExceedText}\n          </ContentStatus>\n        </React.Fragment>\n      );\n    } else {\n      return (\n        <Content>\n          {content}\n        </Content>\n      );\n    }\n  };\n\n  return (\n    <Wrapper data-testid=\"translate-panel\" style={wrapperStyle}>\n      <InnerWrapper>\n        <SelectionWrapper>\n          <Selection>{locale.translateTo}:</Selection>\n          <div>\n            <Select\n              value={outputLanguage}\n              onChange={handleChange}\n            >\n              {\n                outputLanguageList.map(l => (\n                  <Option value={l.key} key={l.key}>\n                    <span style={{ color: 'rgba(17, 31, 44, 0.72)' }}>{l.title}</span>\n                  </Option>\n                ))\n              }\n            </Select>\n          </div>\n        </SelectionWrapper>\n        <ContentWrapper>\n          {renderContent()}\n        </ContentWrapper>\n        <ButtonWrapper>\n          <Button\n            type=\"primary\"\n            onClick={() => controller.run('onAction', replaceWithTranslatedText(input))}\n            disabled={disableReplaceText}\n            testid=\"translate-replace\"\n          >\n            {locale.replace}\n          </Button>\n          <Button\n            type=\"normal\"\n            testid=\"translate-insert\"\n            disabled={disableInsertText}\n            onClick={() => controller.run('onAction', insertTranslatedText(input))}\n            style={{ marginLeft: 8 }}\n          >\n            {locale.insert}\n          </Button>\n        </ButtonWrapper>\n      </InnerWrapper>\n      <Footer>{locale.footer}</Footer>\n    </Wrapper >\n  );\n};\n\nSidebar.defaultProps = {\n  getTranslation: v => v, // 翻译接口\n  defaultOutputLanguage: 'en', // 默认输出语言\n  outputLanguageList: list, // 可翻译的语言列表\n  maxWordCount: MAX_WORD_COUNT, // 最大字数显示\n};\n\nexport default Sidebar;\n"],"file":"sidebar.js"}