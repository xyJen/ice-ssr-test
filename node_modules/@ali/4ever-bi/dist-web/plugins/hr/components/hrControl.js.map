{"version":3,"sources":["../../../../../src/plugins/hr/components/hrControl.tsx"],"names":["React","ReactDOM","styled","theme","themeHeight","hr","height","HrWrapper","div","props","isActive","HrControl","handleMouseMove","e","preventDefault","stopPropagation","gap","X","clientX","state","originX1","length","originX2","offsetX","flag","finalLen","Math","abs","diffX","setState","onHrChange","editor","node","handleMouseUp","document","removeEventListener","handleMouseDown","target","findDOMNode","targetDomInfo","getBoundingClientRect","x","width","addEventListener","payload","render","children","isSelected","attributes","marginLeft","Component"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport styled from 'styled-components';\nimport { theme } from '@ali/4ever-bamboo';\n\n// HACK: Pi2.0 要求插件尺寸与实际渲染必须保持一致，未来应该对 hr 类型做个映射 @统领\nconst { height: themeHeight } = theme.hr;\n\n// const ControlPoint = styled.div`\n//   width: 14px;\n//   height: 14px;\n//   box-sizing: border-box;\n//   background: #fff;\n//   position: absolute;\n//   border-radius: 50%;\n//   border: 1px solid #ddd;\n//   display: ${(props: any) => (props.isActive ? 'visible' : 'none')};\n//   &::after {\n//     width: 8px;\n//     height: 8px;\n//     position: absolute;\n//     border-radius: 50%;\n//     top: 2px;\n//     left: 2px;\n//     background: #3d8df3;\n//     content: '';\n//     cursor: ew-resize;\n//   }\n// `;\n\n// TODO fit-content\nconst HrWrapper = styled.div`\n  position: relative;\n  width: 100%;\n  padding: 5px 0; \n  background-color: ${(props: any) => (props.isActive ? '#f4f4f4' : '')};\n  &:hover {\n    background-color: #f4f4f4;\n  };\n  display: flex;\n  align-items: center;\n  & div {\n    width: 100%;\n  }\n`;\n\n\ninterface IHrControlProps {\n  onHrChange: any;\n  isSelected?: boolean;\n  length?: number;\n  color?: string;\n  lineStyle?: string;\n  editor?: any;\n  node?: any;\n  attributes: any;\n}\n\ninterface IHrControlState {\n  length: number;\n  originX1: number;\n  originX2: number;\n  offsetX: number;\n  flag: string; // 判断控制前一个控制点还是后一个\n}\n\n\n/**\n * top: 自身高度除去border / 2\n * left: 自身宽度 / 2\n */\n// const ControlPointStart = styled(ControlPoint)`\n//   position: absolute;\n//   top: 6px;\n//   left: -7px;\n// `;\n\n// const ControlPointEnd = styled(ControlPoint)`\n//   position: absolute;\n//   top: 6px;\n//   right: -7px;\n// `;\n\nexport default class HrControl extends React.Component<IHrControlProps, IHrControlState> {\n  constructor(props) {\n    super(props);\n    const { payload = {} } = props;\n    const { length } = payload;\n    this.state = {\n      length,\n      originX1: 0, // start point\n      originX2: 0, // end point\n      offsetX: 0,\n      flag: '', // 操作是左边还是右边\n    };\n  }\n\n  /**\n   * 移动算法, 计算startPoint 和 length, 即可获得具体位置\n   * TODO 需要加入边界范围\n   */\n  handleMouseMove = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const gap = 10;\n    const X = e.clientX;\n    const {\n      originX1, length, originX2, offsetX, flag,\n    } = this.state;\n    if (!flag) return;\n    let finalLen: number = length;\n    if (flag === 'st') {\n      if (Math.abs(X - originX1) > gap && (originX2 - X) > gap) {\n        const diffX = X - originX1;\n        finalLen = originX2 - X;\n        this.setState({\n          originX1: X,\n          offsetX: diffX + offsetX,\n          length: finalLen,\n        });\n      }\n    }\n    if (flag === 'et') {\n      if (Math.abs(X - originX2) > gap && (X - originX1) > gap) {\n        finalLen = X - originX1;\n        this.setState({\n          originX2: X,\n          length: finalLen,\n        });\n      }\n    }\n    const { onHrChange = () => { }, editor, node } = this.props;\n    onHrChange(editor, node, { length: finalLen });\n  };\n\n  /**\n   * 回掉设置值\n   */\n  handleMouseUp = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    // TODO 建议鼠标收起再赋值\n    document.removeEventListener('mousemove', this.handleMouseMove);\n    document.removeEventListener('mouseup', this.handleMouseUp);\n  };\n\n  handleMouseDown = (e, flag) => {\n    e.preventDefault();\n    e.stopPropagation();\n    // // 处理逻辑\n    // eslint-disable-next-line react/no-find-dom-node\n    const target: any = ReactDOM.findDOMNode(this);\n    const targetDomInfo = target.getBoundingClientRect();\n    const { x, width } = targetDomInfo;\n    this.setState({\n      originX1: x,\n      originX2: x + width,\n      flag,\n    });\n\n    document.addEventListener('mousemove', this.handleMouseMove);\n    document.addEventListener('mouseup', this.handleMouseUp);\n  };\n\n  render() {\n    const { children, isSelected, attributes } = this.props;\n    const { offsetX } = this.state;\n    return (\n      <HrWrapper\n        data-testid=\"horizon-line\"\n        isActive={isSelected}\n        style={{\n          height: `${themeHeight}px`,\n          marginLeft: `${offsetX}px`,\n        }}\n        data-type=\"hr\"\n        {...attributes}\n      >\n        {/* <ControlPointStart isActive={isSelected} onMouseDown={(e) => this.handleMouseDown(e, 'st')} onMouseUp={this.handleMouseUp} /> */}\n        {children}\n        {/* <ControlPointEnd isActive={isSelected} onMouseDown={(e) => this.handleMouseDown(e, 'et')} onMouseUp={this.handleMouseUp} /> */}\n      </HrWrapper>\n    );\n  }\n}\n"],"file":"hrControl.js"}