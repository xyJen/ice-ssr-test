import { Commands, Text } from '@ali/4ever-cangjie';
import { isKeyHotkey } from 'is-hotkey';
import insertHr from "../commands/insertHr";
var isEnterHotkey = isKeyHotkey('enter');
/**
 * 1. 三个及以上 「 * 」
 * 2. 三个及以上 「 - 」
 * 3. 三个及以上 「 — 」 (中文 shift + -, 半个破折号, 与 2 不同)
 */

var REGEXP_HR = /^(\*|-|—)\1{2,}$/;
export default function onKeyDown(event, controller, next) {
  var value = controller.value;
  var selection = value.selection;
  if (!selection) return next();
  if (selection.isExpanded) return next();

  if (isEnterHotkey(event) && selection.anchor.isTextPoint()) {
    var startBlock = value.startBlock;
    if (!startBlock) return next();
    var chars = startBlock.text.slice(0, selection.anchor.offset).replace(/\s*/g, '');

    var isOnlyHrSymbolParagraph = function isOnlyHrSymbolParagraph(block) {
      return block.type === 'paragraph' && (!block.data.ind || block.data.ind.left === 0) && !block.data.list && Text.isTextList(block.nodes) && REGEXP_HR.test(chars);
    };

    if (isOnlyHrSymbolParagraph(startBlock)) {
      event.preventDefault();
      controller.command(Commands.moveFocusToStartOfBlock).command(Commands.del).command(insertHr);
      return controller.dispatch('createTriggerMarkdownAction', {
        mdType: 'hr'
      });
    }
  }

  return next();
}
//# sourceMappingURL=onKeyDown.js.map