/* eslint-disable @typescript-eslint/ban-ts-comment */
import { domUtils, Document } from '@ali/4ever-cangjie';
import findInnerBlockKeyFromEvent from "./utils/findBlockKeyFromEvent";
import findInlineKeyFromEvent from "./utils/findInlineKeyFromEvent";
import getNodeType from "../getNodeType";

function findDocumentNode(document) {
  var domNode = domUtils.findDOMNodeSafely(document.key);
  return domNode || null;
}

export default function getNode(event, controller, layouts) {
  if (!layouts) return {};
  var layoutKeys = Object.keys(layouts);
  if (layoutKeys.length === 0) return {};
  var document = controller.value.document;
  var container = findDocumentNode(document);
  var inlineKey = findInlineKeyFromEvent(event, document);
  var inline = document.getNode(inlineKey);

  if (inline) {
    var inlineType = getNodeType(inline, controller);

    if (layoutKeys.indexOf(inlineType) > -1) {
      return {
        node: inline
      };
    }
  }

  var blockKey = findInnerBlockKeyFromEvent(event, container);
  var block = document.getNode(blockKey);
  if (!block || !layouts) return {};

  while (block && !Document.isDocument(block)) {
    var type = getNodeType(block, controller);

    if (layoutKeys.indexOf(type) > -1) {
      return {
        node: block
      };
    }

    block = document.getClosestBlock(block.key);
  }

  return {};
}
//# sourceMappingURL=getNode.js.map