{"version":3,"sources":["../../../../../../../src/plugins/hoverToolbar/utils/hoverNode/utils/findBlockKeyFromEvent.ts"],"names":["constants","leftThrottle","rightThrottle","Selector","leafBlockKey","leafBlock","cangjieKey","key","edgeSelectable","contentKey","content","COLUMN_SELECTOR","VOID_BLOCK","RIGHT_OFFSET","getParentByAttributes","attribute","target","attributes","Array","isArray","found","getAttribute","window","document","body","documentElement","i","length","parentElement","findInnerBlockKeyFromEvent","event","container","eventTarget","oriTarget","blockKey","paddingLeft","parseInt","getComputedStyle","rect","getBoundingClientRect","clientX","clientY","left","elementFromPoint","right","width","blockEle","querySelector"],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/ban-ts-comment */\nimport { constants } from '@ali/4ever-cangjie';\n\nconst leftThrottle = 100;\nconst rightThrottle = 30;\nconst { leafBlock: leafBlockKey, key: cangjieKey, edgeSelectable, content: contentKey } = constants.Selector;\n\nconst COLUMN_SELECTOR = 'data-column';\nconst VOID_BLOCK = 'data-block-uuid';\n\n// 如果鼠标在 content 左侧，则往右侧偏移一部分，取新的元素。\nconst RIGHT_OFFSET = 20;\n\n/**\n * 从 target 开始，往 parent 找，一直找到并返回满足 attribute 的元素\n */\nfunction getParentByAttributes(attribute: string | string[], target: HTMLElement | null) {\n  const attributes = Array.isArray(attribute) ? attribute : [attribute];\n  let found: HTMLElement | null = target;\n  while (\n    found &&\n    !found.getAttribute(contentKey) &&\n    found !== window.document.body &&\n    found !== window.document.documentElement\n  ) {\n    for (let i = 0; i < attributes.length; i++) {\n      if (found.getAttribute(attributes[i])) return found;\n    }\n    found = found.parentElement;\n  }\n  return null;\n}\n\nexport default function findInnerBlockKeyFromEvent(event: MouseEvent, container: Element | null): string {\n  const eventTarget = event.target as HTMLElement | null;\n  if (!eventTarget) {\n    return '';\n  }\n  let oriTarget: Element = eventTarget;\n  let blockKey = '';\n\n  if (container) {\n    const paddingLeft = parseInt(getComputedStyle(container).paddingLeft, 10) || leftThrottle;\n    const rect = container.getBoundingClientRect();\n    const { clientX, clientY } = event;\n    if (clientX > rect.left && clientX < rect.left + paddingLeft) {\n      oriTarget = window.document.elementFromPoint(rect.left + paddingLeft + RIGHT_OFFSET, clientY) || eventTarget;\n    }\n    if (clientX > rect.right && clientX < rect.right + rightThrottle) {\n      oriTarget = window.document.elementFromPoint(rect.right - rect.width / 2, clientY) || eventTarget;\n    }\n  }\n\n  let target = oriTarget as HTMLElement | null;\n  const blockEle = getParentByAttributes(['data-listid', leafBlockKey, VOID_BLOCK, COLUMN_SELECTOR, edgeSelectable], target);\n\n  if (blockEle) {\n    blockKey =\n      blockEle.getAttribute(cangjieKey) ||\n      blockEle.querySelector(`[${cangjieKey}]`)?.getAttribute(cangjieKey) || '';\n  }\n  return blockKey;\n\n\n  \n\n}\n"],"file":"findBlockKeyFromEvent.js"}