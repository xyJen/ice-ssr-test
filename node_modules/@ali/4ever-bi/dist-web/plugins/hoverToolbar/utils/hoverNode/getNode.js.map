{"version":3,"sources":["../../../../../../src/plugins/hoverToolbar/utils/hoverNode/getNode.ts"],"names":["domUtils","Document","findInnerBlockKeyFromEvent","findInlineKeyFromEvent","getNodeType","findDocumentNode","document","domNode","findDOMNodeSafely","key","getNode","event","controller","layouts","layoutKeys","Object","keys","length","value","container","inlineKey","inline","inlineType","indexOf","node","blockKey","block","isDocument","type","getClosestBlock"],"mappings":"AAAA;AACA,SAASA,QAAT,EAAmBC,QAAnB,QAA+C,oBAA/C;AACA,OAAOC,0BAAP;AACA,OAAOC,sBAAP;AAEA,OAAOC,WAAP;;AAEA,SAASC,gBAAT,CAA0BC,QAA1B,EAA8C;AAC5C,MAAMC,OAAO,GAAGP,QAAQ,CAACQ,iBAAT,CAA2BF,QAAQ,CAACG,GAApC,CAAhB;AACA,SAAOF,OAAO,IAAI,IAAlB;AACD;;AAED,eAAe,SAASG,OAAT,CACbC,KADa,EAEbC,UAFa,EAGbC,OAHa,EAIb;AACA,MAAI,CAACA,OAAL,EAAc,OAAO,EAAP;AACd,MAAMC,UAAU,GAAGC,MAAM,CAACC,IAAP,CAAYH,OAAZ,CAAnB;AACA,MAAIC,UAAU,CAACG,MAAX,KAAsB,CAA1B,EAA6B,OAAO,EAAP;AAH7B,MAIQX,QAJR,GAIqBM,UAAU,CAACM,KAJhC,CAIQZ,QAJR;AAKA,MAAMa,SAAS,GAAGd,gBAAgB,CAACC,QAAD,CAAlC;AACA,MAAMc,SAAS,GAAGjB,sBAAsB,CAACQ,KAAD,EAAQL,QAAR,CAAxC;AACA,MAAMe,MAAM,GAAGf,QAAQ,CAACI,OAAT,CAAiBU,SAAjB,CAAf;;AACA,MAAIC,MAAJ,EAAa;AACX,QAAMC,UAAU,GAAGlB,WAAW,CAACiB,MAAD,EAAST,UAAT,CAA9B;;AACA,QAAIE,UAAU,CAACS,OAAX,CAAmBD,UAAnB,IAAiC,CAAC,CAAtC,EAAyC;AACvC,aAAO;AACLE,QAAAA,IAAI,EAAEH;AADD,OAAP;AAGD;AACF;;AACD,MAAMI,QAAQ,GAAGvB,0BAA0B,CAACS,KAAD,EAAQQ,SAAR,CAA3C;AACA,MAAIO,KAAK,GAAGpB,QAAQ,CAACI,OAAT,CAAiBe,QAAjB,CAAZ;AACA,MAAI,CAACC,KAAD,IAAU,CAACb,OAAf,EAAwB,OAAO,EAAP;;AAExB,SAAMa,KAAK,IAAI,CAACzB,QAAQ,CAAC0B,UAAT,CAAoBD,KAApB,CAAhB,EAA4C;AAC1C,QAAME,IAAI,GAAGxB,WAAW,CAACsB,KAAD,EAAQd,UAAR,CAAxB;;AACA,QAAIE,UAAU,CAACS,OAAX,CAAmBK,IAAnB,IAA2B,CAAC,CAAhC,EAAmC;AACjC,aAAO;AAAEJ,QAAAA,IAAI,EAAEE;AAAR,OAAP;AACD;;AACDA,IAAAA,KAAK,GAAGpB,QAAQ,CAACuB,eAAT,CAAyBH,KAAK,CAACjB,GAA/B,CAAR;AACD;;AAED,SAAO,EAAP;AACD","sourcesContent":["/* eslint-disable @typescript-eslint/ban-ts-comment */\nimport { domUtils, Document, Controller } from '@ali/4ever-cangjie';\nimport findInnerBlockKeyFromEvent from './utils/findBlockKeyFromEvent';\nimport findInlineKeyFromEvent from './utils/findInlineKeyFromEvent';\nimport { IHoverToolbarPluginConfigs } from '../../types';\nimport getNodeType from '../getNodeType';\n\nfunction findDocumentNode(document: Document) {\n  const domNode = domUtils.findDOMNodeSafely(document.key);\n  return domNode || null;\n}\n\nexport default function getNode(\n  event: MouseEvent,\n  controller: Controller,\n  layouts: IHoverToolbarPluginConfigs['layouts'],\n) {\n  if (!layouts) return {};\n  const layoutKeys = Object.keys(layouts);\n  if (layoutKeys.length === 0) return {};\n  const { document } = controller.value;\n  const container = findDocumentNode(document);\n  const inlineKey = findInlineKeyFromEvent(event, document);\n  const inline = document.getNode(inlineKey);\n  if (inline ) {\n    const inlineType = getNodeType(inline, controller);\n    if (layoutKeys.indexOf(inlineType) > -1) {\n      return {\n        node: inline,\n      };\n    }\n  }\n  const blockKey = findInnerBlockKeyFromEvent(event, container);\n  let block = document.getNode(blockKey);\n  if (!block || !layouts) return {};\n\n  while(block && !Document.isDocument(block)) {\n    const type = getNodeType(block, controller);\n    if (layoutKeys.indexOf(type) > -1) {\n      return { node: block };\n    }\n    block = document.getClosestBlock(block.key);\n  }\n\n  return {};\n}\n"],"file":"getNode.js"}