/* eslint-disable @typescript-eslint/ban-ts-comment */
import { constants } from '@ali/4ever-cangjie';
var leftThrottle = 100;
var rightThrottle = 30;
var _constants$Selector = constants.Selector,
    leafBlockKey = _constants$Selector.leafBlock,
    cangjieKey = _constants$Selector.key,
    edgeSelectable = _constants$Selector.edgeSelectable,
    contentKey = _constants$Selector.content;
var COLUMN_SELECTOR = 'data-column';
var VOID_BLOCK = 'data-block-uuid'; // 如果鼠标在 content 左侧，则往右侧偏移一部分，取新的元素。

var RIGHT_OFFSET = 20;
/**
 * 从 target 开始，往 parent 找，一直找到并返回满足 attribute 的元素
 */

function getParentByAttributes(attribute, target) {
  var attributes = Array.isArray(attribute) ? attribute : [attribute];
  var found = target;

  while (found && !found.getAttribute(contentKey) && found !== window.document.body && found !== window.document.documentElement) {
    for (var i = 0; i < attributes.length; i++) {
      if (found.getAttribute(attributes[i])) return found;
    }

    found = found.parentElement;
  }

  return null;
}

export default function findInnerBlockKeyFromEvent(event, container) {
  var eventTarget = event.target;

  if (!eventTarget) {
    return '';
  }

  var oriTarget = eventTarget;
  var blockKey = '';

  if (container) {
    var paddingLeft = parseInt(getComputedStyle(container).paddingLeft, 10) || leftThrottle;
    var rect = container.getBoundingClientRect();
    var clientX = event.clientX,
        clientY = event.clientY;

    if (clientX > rect.left && clientX < rect.left + paddingLeft) {
      oriTarget = window.document.elementFromPoint(rect.left + paddingLeft + RIGHT_OFFSET, clientY) || eventTarget;
    }

    if (clientX > rect.right && clientX < rect.right + rightThrottle) {
      oriTarget = window.document.elementFromPoint(rect.right - rect.width / 2, clientY) || eventTarget;
    }
  }

  var target = oriTarget;
  var blockEle = getParentByAttributes(['data-listid', leafBlockKey, VOID_BLOCK, COLUMN_SELECTOR, edgeSelectable], target);

  if (blockEle) {
    var _blockEle$querySelect;

    blockKey = blockEle.getAttribute(cangjieKey) || ((_blockEle$querySelect = blockEle.querySelector("[" + cangjieKey + "]")) == null ? void 0 : _blockEle$querySelect.getAttribute(cangjieKey)) || '';
  }

  return blockKey;
}
//# sourceMappingURL=findBlockKeyFromEvent.js.map