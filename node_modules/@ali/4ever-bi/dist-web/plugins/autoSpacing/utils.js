import { textUtils } from '@ali/4ever-cangjie';
var SPACING = ' ';
/**
 * åˆ¤æ–­æ˜¯å¦ä¸ºç©ºç™½ç¬¦æˆ–emoji
 * å¤„äºæ€§èƒ½è€ƒè™‘ä¸åš unicode splitï¼Œæ‰€æœ‰é•¿åº¦å¤§äº 1 çš„ grapheme éƒ½è¢«è§†ä¸º emoji
 */

export function isBlankOrEmoji(_char) {
  // char.length > 1: ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦
  if (!_char || _char.length > 1 || /\s/.test(_char)) return true;
  return false;
}
/**
 * æ£€æµ‹æ˜¯å¤Ÿä¸ºå¸¸è§æ‹‰ä¸æ–‡
 * ascii: https://www.ascii-code.com/
 * https://newbedev.com/regex-with-extended-latin-alphabet-a-o-u-e-ss
 */

export function isLatin(_char2) {
  // C0 åˆ° FF ä¸ä¸€å®šåŒ…å«æ‰€æœ‰å˜å½¢ï¼Œå¦‚: Å¬
  // /[A-z|0-9|\u00C0-\u00FF]/.test(undefined) = true
  return _char2 && /[A-z|0-9|\u00C0-\u00FF]/.test(_char2);
}
/**
 * åˆ¤æ–­æ˜¯å¦åº”è¯¥åˆ é™¤ç©ºæ ¼
 * é¦–å…ˆï¼Œåº”è¯¥æ»¡è¶³åœ¨è¥¿æ–‡å‰åè¾“å…¥ï¼š
 * ä¸­æ–‡ [è¾“å…¥:ä¸­æ–‡][å…‰æ ‡]Charï¼šåˆ é™¤å‰é¢ç©ºæ ¼
 * Char[å…‰æ ‡][è¾“å…¥:ä¸­æ–‡] ä¸­æ–‡ï¼šåˆ é™¤åé¢ç©ºæ ¼
 * å…¶æ¬¡ï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹ patternï¼š
 *     a          b          c
 * eastAsian   spacing   eastAsian
 * å¦å¤–ç”¨æˆ·å¦‚æœæ˜¯é€‰ä¸­å†…å®¹è¾“å…¥ï¼Œæˆ‘ä»¬ä¸åšç©ºæ ¼æ¸…é™¤ï¼ŒåŸå› åœ¨äºæ— æ³•å‡†ç¡®åˆ¤æ–­ç”¨æˆ·æ„å›¾ï¼Œä¾‹å¦‚ï¼š
 *     [-----é€‰åŒº-----] 
 * ä¸­æ–‡   Char ä¸­æ–‡ä¸­æ–‡ä¸­æ–‡ä¸­æ–‡
 * æˆ‘ä»¬éš¾ä»¥åˆ¤æ–­æ­¤æ—¶ç”¨æˆ·æ˜¯æƒ³è¾“å…¥å†…å®¹ä¸åé¢å†…å®¹è”ç³»è¿˜æ˜¯ä¸å‰é¢å†…å®¹è”ç³»
 */

export function shouldDeleteSpacing(a, b, c, sibling, isExpanded) {
  if (isExpanded || b !== SPACING || !isLatin(sibling)) return false;
  return textUtils.isChineseChar(a) && textUtils.isChineseChar(c);
}
/**
 * åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¹‹é—´æ˜¯å¦åº”è¯¥ autoSpacing
 */

export function shouldAutoSpacing(a, b) {
  // æœ‰ä»»æ„ä¸€ä¸ªä¸ºç©ºç™½ç¬¦ æˆ– å¤šç ç‚¹ unicode åˆ™ä¸åŠ  spacing
  if (isBlankOrEmoji(a) || isBlankOrEmoji(b)) return false; // æœ‰ä»»æ„ä¸€ä¸ªä¸ºæ ‡ç‚¹ åˆ™ä¸åŠ  spacing

  if (textUtils.isPunc(a) || textUtils.isPunc(b)) return false;
  return isLatin(a) !== isLatin(b);
}
/**
 * è·å–èŠ‚ç‚¹æ–‡æœ¬
 */

function getNodeText(node, start, end) {
  if (!node) return []; // perf: use Array.from é¿å…å¤æ‚çš„ unicode æ‹†åˆ†

  return Array.from(node.text.slice(start, end));
}
/**
 * è·å–å½“å‰é€‰åŒºå‰åçš„æ–‡å­—
 * @param controller 
 */


export function getPreText(controller) {
  var _controller$value = controller.value,
      document = _controller$value.document,
      selection = _controller$value.selection;

  var _selection$convertToT = selection.convertToTextPoints(document),
      start = _selection$convertToT.start;

  var startTextNode = document.getNode(start.key);
  return getNodeText(startTextNode, 0, start.offset);
}
export function getNextText(controller) {
  var _controller$value2 = controller.value,
      document = _controller$value2.document,
      selection = _controller$value2.selection;

  var _selection$convertToT2 = selection.convertToTextPoints(document),
      end = _selection$convertToT2.end;

  var endTextNode = document.getNode(end.key);
  return getNodeText(endTextNode, end.offset);
}
/**
 * è¥¿æ–‡ä¸­é—´å…è®¸æœ‰ç©ºæ ¼
 */

function shouldKeepSpcing(a, b) {
  return isLatin(a) && isLatin(b);
}
/**
 * è¿ç»­ç©ºæ ¼åˆ é™¤é€»è¾‘
 * é¦–å…ˆï¼Œå¿…é¡»æ˜¯è¿ç»­ç©ºæ ¼ç›¸é‚»
 *     a          b          c          d
 *             spacing    spacing
 * å…¶æ¬¡ï¼Œåˆ†åˆ«åˆ¤æ–­ deleted å’Œ a/b çš„ç±»å‹ä»¥å†³å®šæ˜¯å¦åˆ é™¤å¯¹åº”ç©ºæ ¼
 * æœ€åï¼Œè¥¿æ–‡ä¹‹é—´æ˜¯éœ€è¦ç©ºæ ¼çš„ï¼Œä½†æˆ‘ä»¬éš¾ä»¥åˆ¤æ–­è¿ç»­ç©ºæ ¼å‰åçš„è¯­ä¹‰ï¼Œå› æ­¤ä¿ç•™ä¸€ä¸ªç©ºæ ¼
 */


export function shouldDeleteSiblingSpacing(a, b, c, d, deleted) {
  // éè¿ç»­ç©ºæ ¼ä¸å¤„ç†
  if (isBlankOrEmoji(deleted) || b !== SPACING || c !== SPACING) return [false, false]; // ç‰¹åˆ«æ³¨æ„ï¼šç…§é¡¾è‹±æ–‡è¾“å…¥ä¹ æƒ¯ï¼Œç©ºæ ¼ç•™åœ¨å‰é¢

  var shoudDeleteBefore = shouldAutoSpacing(a, deleted || '') && !shouldKeepSpcing(a, d);
  var shoudDeleteAfter = shouldAutoSpacing(deleted || '', d);
  return [shoudDeleteBefore, shoudDeleteAfter];
}
//# sourceMappingURL=utils.js.map