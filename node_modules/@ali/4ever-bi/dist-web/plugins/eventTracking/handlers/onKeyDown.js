import { hotkeys } from '@ali/4ever-cangjie';
import { sample } from '@ali/4ever-bamboo';
import { eventTracking, TrackingType } from "../actions";
var trackSplitBlock = sample(function (controller) {
  controller.run('onAction', eventTracking({
    type: TrackingType.splitBlock
  }));
}, {
  sample: 10
});
var trackDeleteText = sample(function (controller) {
  controller.run('onAction', eventTracking({
    type: TrackingType.deleteText
  }));
}, {
  sample: 25
});
var trackSelectAll = sample(function (controller) {
  controller.run('onAction', eventTracking({
    type: TrackingType.selectAll
  }));
}, {
  sample: 5
});
export default function onKeyDown(event, controller, next) {
  var selection = controller.value.selection; // 简单排除复杂的情况，选择高频的用户场景

  if (!selection || selection.isExpanded || selection.anchor.isEdgePoint() || selection.focus.isEdgePoint()) {
    return next();
  }

  if (hotkeys.isSplitBlock(event)) {
    trackSplitBlock(controller);
  } else if (hotkeys.isDeleteBackward(event)) {
    var atFirstPos = selection.anchor.offset === 0;

    if (!atFirstPos) {
      trackDeleteText(controller);
    }
  } else if (hotkeys.isSelectAll(event)) {
    trackSelectAll(controller);
  }

  return next();
}
//# sourceMappingURL=onKeyDown.js.map