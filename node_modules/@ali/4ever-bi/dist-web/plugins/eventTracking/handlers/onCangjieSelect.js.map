{"version":3,"sources":["../../../../../src/plugins/eventTracking/handlers/onCangjieSelect.ts"],"names":["eventTracking","TrackingType","isSelecting","shouldTrack","threshold","window","addEventListener","onCangjieSelect","e","controller","next","detail","trigger","run","type","selectText","Math","random"],"mappings":"AACA,SAASA,aAAT,EAAwBC,YAAxB;AAEA,IAAIC,WAAW,GAAG,KAAlB;AACA,IAAIC,WAAW,GAAG,KAAlB;AACA,IAAMC,SAAS,GAAG,IAAI,EAAtB;AAEAC,MAAM,CAACC,gBAAP,CAAwB,SAAxB,EAAmC,YAAM;AACvC;AACAJ,EAAAA,WAAW,GAAG,KAAd;AACAC,EAAAA,WAAW,GAAG,KAAd;AACD,CAJD;AAMA,eAAe,SAASI,eAAT,CAAyBC,CAAzB,EAAgDC,UAAhD,EAAwEC,IAAxE,EAA8E;AAC3F,MAAIR,WAAW,KAAK,IAAhB,IAAwBC,WAAxB,IAAuCK,CAAC,CAACG,MAAF,CAASC,OAAT,KAAqB,aAAhE,EAA+E;AAC7E;AACAH,IAAAA,UAAU,CAACI,GAAX,CACE,UADF,EAEEb,aAAa,CAAC;AAAEc,MAAAA,IAAI,EAAEb,YAAY,CAACc;AAArB,KAAD,CAFf;AAID;;AAED,MAAIP,CAAC,CAACG,MAAF,CAASC,OAAT,KAAqB,aAAzB,EAAwC;AACtCV,IAAAA,WAAW,GAAG,IAAd;AACAC,IAAAA,WAAW,GAAGa,IAAI,CAACC,MAAL,KAAgBb,SAA9B;AACD;;AAED,SAAOM,IAAI,EAAX;AACD","sourcesContent":["import { CangjieSelectEvent, Controller } from '@ali/4ever-cangjie';\nimport { eventTracking, TrackingType } from '../actions';\n\nlet isSelecting = false;\nlet shouldTrack = false;\nconst threshold = 1 / 50;\n\nwindow.addEventListener('mouseup', () => {\n  // 重置状态标记\n  isSelecting = false;\n  shouldTrack = false;\n});\n\nexport default function onCangjieSelect(e: CangjieSelectEvent, controller: Controller, next) {\n  if (isSelecting === true && shouldTrack && e.detail.trigger !== 'selectStart') {\n    // 采样\n    controller.run(\n      'onAction',\n      eventTracking({ type: TrackingType.selectText }),\n    );\n  }\n\n  if (e.detail.trigger === 'selectStart') {\n    isSelecting = true;\n    shouldTrack = Math.random() < threshold;\n  }\n\n  return next();\n}\n"],"file":"onCangjieSelect.js"}