{"version":3,"sources":["../../../../../src/plugins/eventTracking/handlers/onKeyDown.ts"],"names":["hotkeys","sample","eventTracking","TrackingType","trackSplitBlock","controller","run","type","splitBlock","trackDeleteText","deleteText","trackSelectAll","selectAll","onKeyDown","event","next","selection","value","isExpanded","anchor","isEdgePoint","focus","isSplitBlock","isDeleteBackward","atFirstPos","offset","isSelectAll"],"mappings":"AACA,SAAqBA,OAArB,QAAoC,oBAApC;AACA,SAASC,MAAT,QAAuB,mBAAvB;AACA,SAASC,aAAT,EAAwBC,YAAxB;AAEA,IAAMC,eAAe,GAAGH,MAAM,CAAC,UAACI,UAAD,EAAgB;AAC7CA,EAAAA,UAAU,CAACC,GAAX,CACE,UADF,EAEEJ,aAAa,CAAC;AACZK,IAAAA,IAAI,EAAEJ,YAAY,CAACK;AADP,GAAD,CAFf;AAMD,CAP6B,EAO3B;AAAEP,EAAAA,MAAM,EAAE;AAAV,CAP2B,CAA9B;AASA,IAAMQ,eAAe,GAAGR,MAAM,CAAC,UAACI,UAAD,EAAgB;AAC7CA,EAAAA,UAAU,CAACC,GAAX,CACE,UADF,EAEEJ,aAAa,CAAC;AACZK,IAAAA,IAAI,EAAEJ,YAAY,CAACO;AADP,GAAD,CAFf;AAMD,CAP6B,EAO3B;AAAET,EAAAA,MAAM,EAAE;AAAV,CAP2B,CAA9B;AASA,IAAMU,cAAc,GAAGV,MAAM,CAAC,UAACI,UAAD,EAAgB;AAC5CA,EAAAA,UAAU,CAACC,GAAX,CACE,UADF,EAEEJ,aAAa,CAAC;AACZK,IAAAA,IAAI,EAAEJ,YAAY,CAACS;AADP,GAAD,CAFf;AAMD,CAP4B,EAO1B;AAAEX,EAAAA,MAAM,EAAE;AAAV,CAP0B,CAA7B;AAUA,eAAe,SAASY,SAAT,CACbC,KADa,EAEbT,UAFa,EAGbU,IAHa,EAIb;AAAA,MACQC,SADR,GACsBX,UAAU,CAACY,KADjC,CACQD,SADR,EAGA;;AACA,MACE,CAACA,SAAD,IACAA,SAAS,CAACE,UADV,IAEAF,SAAS,CAACG,MAAV,CAAiBC,WAAjB,EAFA,IAGAJ,SAAS,CAACK,KAAV,CAAgBD,WAAhB,EAJF,EAKE;AACA,WAAOL,IAAI,EAAX;AACD;;AAED,MAAIf,OAAO,CAACsB,YAAR,CAAqBR,KAArB,CAAJ,EAAiC;AAC/BV,IAAAA,eAAe,CAACC,UAAD,CAAf;AACD,GAFD,MAEO,IAAIL,OAAO,CAACuB,gBAAR,CAAyBT,KAAzB,CAAJ,EAAqC;AAC1C,QAAMU,UAAU,GAAGR,SAAS,CAACG,MAAV,CAAiBM,MAAjB,KAA4B,CAA/C;;AACA,QAAI,CAACD,UAAL,EAAiB;AACff,MAAAA,eAAe,CAACJ,UAAD,CAAf;AACD;AACF,GALM,MAKA,IAAIL,OAAO,CAAC0B,WAAR,CAAoBZ,KAApB,CAAJ,EAAgC;AACrCH,IAAAA,cAAc,CAACN,UAAD,CAAd;AACD;;AAED,SAAOU,IAAI,EAAX;AACD","sourcesContent":["import * as React from 'react';\nimport { Controller, hotkeys } from '@ali/4ever-cangjie';\nimport { sample } from '@ali/4ever-bamboo';\nimport { eventTracking, TrackingType } from '../actions';\n\nconst trackSplitBlock = sample((controller) => {\n  controller.run(\n    'onAction',\n    eventTracking({\n      type: TrackingType.splitBlock\n    }),\n  );\n}, { sample: 10 })\n\nconst trackDeleteText = sample((controller) => {\n  controller.run(\n    'onAction',\n    eventTracking({\n      type: TrackingType.deleteText,\n    }),\n  );\n}, { sample: 25 })\n\nconst trackSelectAll = sample((controller) => {\n  controller.run(\n    'onAction',\n    eventTracking({\n      type: TrackingType.selectAll,\n    }),\n  );\n}, { sample: 5 })\n\n\nexport default function onKeyDown(\n  event: React.KeyboardEvent,\n  controller: Controller,\n  next: () => void,\n) {\n  const { selection } = controller.value;\n\n  // 简单排除复杂的情况，选择高频的用户场景\n  if (\n    !selection ||\n    selection.isExpanded ||\n    selection.anchor.isEdgePoint() ||\n    selection.focus.isEdgePoint()\n  ) {\n    return next();\n  }\n\n  if (hotkeys.isSplitBlock(event)) {\n    trackSplitBlock(controller);\n  } else if (hotkeys.isDeleteBackward(event)) {\n    const atFirstPos = selection.anchor.offset === 0\n    if (!atFirstPos) {\n      trackDeleteText(controller)\n    }\n  } else if (hotkeys.isSelectAll(event)) {\n    trackSelectAll(controller);\n  }\n\n  return next();\n}\n"],"file":"onKeyDown.js"}