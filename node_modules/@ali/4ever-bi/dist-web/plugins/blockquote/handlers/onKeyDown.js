import { isKeyHotkey } from 'is-hotkey';
import toggleQuote from "../commands/toggleQuote";
import { getClosestParagraph } from '@ali/4ever-utils';
var isBackspaceHotKey = isKeyHotkey('backspace');
var isEnterHotKey = isKeyHotkey('enter');
export default (function (event, editor, next) {
  var value = editor.value;
  var startBlock = value.startBlock,
      selection = value.selection,
      document = value.document; // 在 block 顶部 delete，移除引用状态

  var currentParagraph = getClosestParagraph(value);
  var isAtQuoteBlockStart = currentParagraph && currentParagraph.data.blockquote && selection.isCollapsed && selection.anchor.isAtStartOfNode(currentParagraph);
  var previousBlock = document.getPreviousBlock(selection.getEnd(document).key);

  if (isAtQuoteBlockStart && isBackspaceHotKey(event)) {
    event.preventDefault();

    if (previousBlock && previousBlock.data.blockquote) {
      // 当前一个 block 也是引用时，执行 next 回退一行
      return toggleQuote(editor, next);
    }

    return toggleQuote(editor);
  } // 空 blockquote ，回车删除引用


  var isEmptyBlockQuote = (currentParagraph == null ? void 0 : currentParagraph.data.blockquote) && !startBlock.text && startBlock.nodes.length === 1 && startBlock.getFirstNode().isText();

  if (isEmptyBlockQuote && isEnterHotKey(event)) {
    event.preventDefault();
    return toggleQuote(editor);
  }

  return next();
});
//# sourceMappingURL=onKeyDown.js.map