{"version":3,"sources":["../../../../../src/plugins/link/commands/updateLink.ts"],"names":["Commands","Text","updateLink","controller","node","text","href","selection","value","nodeText","length","originalHref","data","command","setNodeByKey","key","type","moveToEndOfNode","isTextList","nodes","range","moveToRangeOfNode","select","insertText","moveToStartOfNextText"],"mappings":"AAAA,SAA6BA,QAA7B,EAAuCC,IAAvC,QAAmD,oBAAnD;AAEA,eAAe,SAASC,UAAT,CACbC,UADa,EAEbC,IAFa,EAGbC,IAHa,EAIbC,IAJa,EAKb;AAAA,MACQC,SADR,GACsBJ,UAAU,CAACK,KADjC,CACQD,SADR;AAEA,MAAME,QAAQ,GAAGJ,IAAI,CAACK,MAAL,GAAcL,IAAd,GAAqBC,IAAtC;AACA,MAAMK,YAAY,GAAGP,IAAI,CAACQ,IAAL,CAAUN,IAA/B,CAHA,CAKA;;AACA,MAAIA,IAAI,KAAKK,YAAb,EAA2B;AACzBR,IAAAA,UAAU,CAACU,OAAX,CAAmBb,QAAQ,CAACc,YAA5B,EAA0CV,IAAI,CAACW,GAA/C,EAAoD;AAClDC,MAAAA,IAAI,EAAE,MAD4C;AAElDJ,MAAAA,IAAI,EAAE;AAAEN,QAAAA,IAAI,EAAJA;AAAF;AAF4C,KAApD,EAGGO,OAHH,CAGWb,QAAQ,CAACiB,eAHpB,EAGqCb,IAHrC;AAID;;AACD,MAAIH,IAAI,CAACiB,UAAL,CAAgBd,IAAI,CAACe,KAArB,KAA+BV,QAAQ,KAAKL,IAAI,CAACC,IAArD,EAA2D;AACzD,QAAMe,KAAK,GAAGb,SAAS,CAACc,iBAAV,CAA4BjB,IAA5B,EAAkCD,UAAlC,CAAd;AACAA,IAAAA,UAAU,CAACU,OAAX,CAAmBb,QAAQ,CAACsB,MAA5B,EAAoCF,KAApC,EAA2CP,OAA3C,CAAmDb,QAAQ,CAACuB,UAA5D,EAAwEd,QAAxE;AACD;;AACD,SAAON,UAAU,CAACU,OAAX,CAAmBb,QAAQ,CAACwB,qBAA5B,CAAP;AACD","sourcesContent":["import { Controller, Inline, Commands, Text } from '@ali/4ever-cangjie';\n\nexport default function updateLink(\n  controller: Controller,\n  node: Inline,\n  text: string,\n  href: string,\n) {\n  const { selection } = controller.value;\n  const nodeText = text.length ? text : href;\n  const originalHref = node.data.href;\n\n  // 更新需要控制粒度，避免生成额外 op\n  if (href !== originalHref) {\n    controller.command(Commands.setNodeByKey, node.key, {\n      type: 'link',\n      data: { href },\n    }).command(Commands.moveToEndOfNode, node);\n  }\n  if (Text.isTextList(node.nodes) && nodeText !== node.text) {\n    const range = selection.moveToRangeOfNode(node, controller);\n    controller.command(Commands.select, range).command(Commands.insertText, nodeText);\n  }\n  return controller.command(Commands.moveToStartOfNextText);\n}\n"],"file":"updateLink.js"}