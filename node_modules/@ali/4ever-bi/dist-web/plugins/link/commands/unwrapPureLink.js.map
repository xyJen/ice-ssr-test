{"version":3,"sources":["../../../../../src/plugins/link/commands/unwrapPureLink.ts"],"names":["Commands","Mark","unwrapPureLink","controller","node","offset","href","selection","value","range","moveToStartOfNode","moveForward","moveFocusForward","length","moveTo","moveToFocus","command","addMarkAtRange","create","type","select","focus","isAtEndOfNode","insertText"],"mappings":"AAAA,SAA2BA,QAA3B,EAAqCC,IAArC,QAAiD,oBAAjD;AAEA,eAAe,SAASC,cAAT,CACbC,UADa,EAEbC,IAFa,EAGbC,MAHa,EAIbC,IAJa,EAKb;AAAA,MACQC,SADR,GACsBJ,UAAU,CAACK,KADjC,CACQD,SADR;AAEA,MAAME,KAAK,GAAGF,SAAS,CACpBG,iBADW,CACON,IADP,EACaD,UADb,EAEXQ,WAFW,CAECN,MAFD,EAGXO,gBAHW,CAGMN,IAAI,CAACO,MAHX,CAAd;AAKA,MAAMC,MAAM,GAAGL,KAAK,CAACM,WAAN,EAAf;AACAZ,EAAAA,UAAU,CACPa,OADH,CAEIhB,QAAQ,CAACiB,cAFb,EAGIR,KAHJ,EAIIR,IAAI,CAACiB,MAAL,CAAY;AACVC,IAAAA,IAAI,EAAE;AADI,GAAZ,CAJJ,EAQGH,OARH,CAQWhB,QAAQ,CAACoB,MARpB,EAQ4BN,MAR5B,EARA,CAkBA;AACA;;AACA,MAAIL,KAAK,CAACY,KAAN,CAAYC,aAAZ,CAA0BlB,IAA1B,CAAJ,EAAqC;AACnCD,IAAAA,UAAU,CAACa,OAAX,CAAmBhB,QAAQ,CAACuB,UAA5B,EAAwC,GAAxC,EAA6C,EAA7C;AACD,GAFD,MAEO;AACLpB,IAAAA,UAAU,CAACa,OAAX,CAAmBhB,QAAQ,CAACW,WAA5B;AACD;;AAED,SAAOR,UAAP;AACD","sourcesContent":["import { Text, Controller, Commands, Mark } from '@ali/4ever-cangjie';\n\nexport default function unwrapPureLink(\n  controller: Controller,\n  node: Text,\n  offset: number,\n  href: string,\n) {\n  const { selection } = controller.value;\n  const range = selection\n    .moveToStartOfNode(node, controller)\n    .moveForward(offset)\n    .moveFocusForward(href.length);\n\n  const moveTo = range.moveToFocus();\n  controller\n    .command(\n      Commands.addMarkAtRange,\n      range,\n      Mark.create({\n        type: 'unlink',\n      }),\n    )\n    .command(Commands.select, moveTo);\n\n  // 如果 pure link 后面没有内容，为了避免输入新的 pure link 无法被高亮\n  // 需要手动插入一个空白符\n  if (range.focus.isAtEndOfNode(node)) {\n    controller.command(Commands.insertText, ' ', []);\n  } else {\n    controller.command(Commands.moveForward);\n  }\n\n  return controller;\n}\n"],"file":"unwrapPureLink.js"}