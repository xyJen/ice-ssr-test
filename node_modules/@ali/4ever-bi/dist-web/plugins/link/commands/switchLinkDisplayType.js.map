{"version":3,"sources":["../../../../../src/plugins/link/commands/switchLinkDisplayType.ts"],"names":["Commands","removeinjectedCardInfo","switchLinkDisplayType","controller","node","displayType","data","href","cardInfo","originalType","command","setNodeByKey","key","type","moveToEndOfNode","moveToStartOfNextText","focus"],"mappings":";AAAA,SAAqBA,QAArB,QAAqC,oBAArC;AAEA,OAAOC,sBAAP;AAEA,eAAe,SAASC,qBAAT,CACbC,UADa,EAEbC,IAFa,EAGbC,WAHa,EAIb;AAAA;;AAAA,mBACgCD,IAAI,CAACE,IADrC;AAAA,MACQC,IADR,cACQA,IADR;AAAA,uCACcC,QADd;AAAA,MACcA,QADd,oCACyB,EADzB;AAEA,MAAMC,YAAY,4BAAGD,QAAH,oBAAGA,QAAQ,CAAEH,WAAb,oCAA4B,MAA9C,CAFA,CAIA;;AACA,MAAII,YAAY,KAAKJ,WAArB,EAAkC;AAChC;AACAF,IAAAA,UAAU,CAACO,OAAX,CAAmBV,QAAQ,CAACW,YAA5B,EAA0CP,IAAI,CAACQ,GAA/C,EAAoD;AAClDC,MAAAA,IAAI,EAAE,MAD4C;AAElDP,MAAAA,IAAI,EAAE;AAAEC,QAAAA,IAAI,EAAJA,IAAF;AAAQC,QAAAA,QAAQ,eAAOA,QAAP;AAAiBH,UAAAA,WAAW,EAAXA;AAAjB;AAAhB;AAF4C,KAApD,EAGGK,OAHH,CAGWV,QAAQ,CAACc,eAHpB,EAGqCV,IAHrC;;AAIA,QAAIC,WAAW,KAAK,MAApB,EAA4B;AAC1B;AACAF,MAAAA,UAAU,CAACO,OAAX,CAAmBT,sBAAnB,EAA2CG,IAA3C;AACD;AACF;;AACD,SAAOD,UAAU,CAACO,OAAX,CAAmBV,QAAQ,CAACe,qBAA5B,EAAmDL,OAAnD,CAA2DV,QAAQ,CAACgB,KAApE,CAAP;AACD","sourcesContent":["import { Controller, Commands } from '@ali/4ever-cangjie';\nimport { LinkDisplayType, LinkNode } from '../types';\nimport removeinjectedCardInfo from './removeinjectedCardInfo';\n\nexport default function switchLinkDisplayType(\n  controller: Controller,\n  node: LinkNode,\n  displayType: LinkDisplayType,\n) {\n  const { href, cardInfo = {} } = node.data;\n  const originalType = cardInfo?.displayType ?? 'link';\n\n  // 更新需要控制粒度，避免生成额外 op\n  if (originalType !== displayType) {\n    // 如果更新了卡片信息\n    controller.command(Commands.setNodeByKey, node.key, {\n      type: 'link',\n      data: { href, cardInfo: { ...cardInfo, displayType } },\n    }).command(Commands.moveToEndOfNode, node);\n    if (displayType === 'link') {\n      // 样式切换为链接时，清理节点的 injection 内容\n      controller.command(removeinjectedCardInfo, node);\n    }\n  }\n  return controller.command(Commands.moveToStartOfNextText).command(Commands.focus);\n}\n"],"file":"switchLinkDisplayType.js"}