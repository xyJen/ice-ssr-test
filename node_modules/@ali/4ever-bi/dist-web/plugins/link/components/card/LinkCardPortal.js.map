{"version":3,"sources":["../../../../../../src/plugins/link/components/card/LinkCardPortal.tsx"],"names":["React","useZoom","useZoomContainer","Portal","LinkEditor","switchDisplayType","editLinkCard","LinkCardWrapper","LinkCard","getPositionTopLeft","offsetY","LinkCardPortal","props","node","text","href","onSave","onRemove","onUnlink","onCut","onCopyLink","controller","locale","draggable","attributes","enableCard","nodeKey","key","useState","visible","setVisible","portalRef","useRef","linkRef","isLinkCardSelected","query","scrollableContent","document","body","zoom","handleEdit","useCallback","run","handleEditorHide","handleClickoutside","event","target","current","contains","handleSwitchStyle","e","renderCard","useMemo","overlay"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { Controller, RenderNodeProps, useZoom, useZoomContainer } from '@ali/4ever-cangjie';\nimport Portal from '../AnimatePortal';\nimport LinkEditor from '../linkEditor';\nimport { LinkDisplayType, LinkNode, LinkPluginConfig } from '../../types';\nimport { BiPluginConfig } from '../../../../types';\nimport { switchDisplayType, editLinkCard } from '../../actions';\nimport { LinkCardWrapper } from '../styled';\nimport { LinkCard, CardState } from './LinkCard';\nimport { getPositionTopLeft, offsetY } from '../../utils/getPosition';\n\ninterface LinkPortalProps extends RenderNodeProps<LinkNode> {\n  node: LinkNode;\n  text: string;\n  href: string;\n  controller: Controller;\n  locale: LinkPluginConfig['locale'];\n  onSave: (text: string, href: string, displayType: LinkDisplayType) => void;\n  onRemove: () => void;\n  onCut: () => void;\n  onUnlink: () => void;\n  onOpenLink: () => void;\n  onCopyLink: (href: string) => void;\n  isLinkFocused?: boolean;\n  getLinkInfo?: LinkPluginConfig['getLinkInfo'];\n  isSelected: boolean;\n  title?: string;\n  desc?: string;\n  imgURL?: string;\n  state: CardState;\n  readonly: boolean;\n  isMobile: boolean;\n  displayType: LinkDisplayType;\n  onRefresh?: () => void;\n  draggable?: BiPluginConfig['DraggablePluginConfig'];\n  enableCard: boolean;\n}\n\nconst LinkCardPortal: React.FC<LinkPortalProps> = (props) => {\n  const {\n    node,\n    text,\n    href = '',\n    onSave,\n    onRemove,\n    onUnlink,\n    onCut,\n    onCopyLink,\n    controller,\n    locale,\n    draggable,\n    attributes,\n    enableCard,\n  } = props;\n\n  const nodeKey = node?.key;\n\n  const [visible, setVisible] = React.useState(false);\n\n  const portalRef = React.useRef<HTMLDivElement>(null);\n  const linkRef = React.useRef<HTMLDivElement>(null);\n  const isLinkCardSelected = controller.query('isLinkCardSelected', { node });\n\n  const scrollableContent = useZoomContainer() || document.body;\n  const zoom = useZoom();\n\n  const handleEdit = React.useCallback(() => {\n    setVisible(true);\n    controller.run('onAction', editLinkCard());\n  }, [controller]);\n\n  const handleEditorHide = React.useCallback(() => {\n    setVisible(false);\n  }, []);\n\n  const handleClickoutside = React.useCallback((event) => {\n    const target = event.target as HTMLElement;\n    if (target === linkRef.current || linkRef.current?.contains(target)) {\n      return;\n    }\n    setVisible(false);\n  }, []);\n\n  const handleSwitchStyle = React.useCallback((e: LinkDisplayType) => {\n    if (e === 'link') {\n      controller.run('onAction', switchDisplayType(node, 'link'));\n    }\n  }, [controller, node]);\n\n  const renderCard = React.useMemo(() => {\n    return (\n      <LinkCardWrapper {...attributes}>\n        <LinkCard\n          {...props}\n          href={href}\n          readonly={false}\n          isMobile={false}\n          isSelected={isLinkCardSelected}\n          onEdit={handleEdit}\n          onDelete={onRemove}\n          onCut={onCut}\n          onSwitchStyle={handleSwitchStyle}\n          onCopy={onCopyLink}\n        />\n      </LinkCardWrapper>\n    );\n  }, [attributes, props, href, isLinkCardSelected, handleEdit, onRemove, onCut, handleSwitchStyle, onCopyLink]);\n\n  const overlay = (\n    <LinkEditor\n      ref={portalRef}\n      displayType={'card'}\n      nodeKey={nodeKey}\n      text={text}\n      href={href}\n      onSave={onSave}\n      onRemove={onRemove}\n      onUnlink={onUnlink}\n      locale={locale}\n      controller={controller}\n      onHide={handleEditorHide}\n      onClickoutside={handleClickoutside}\n      enableCard={enableCard}\n    />\n  );\n\n  return (\n    <Portal\n      className=\"bi-link-card-portal\"\n      visible={visible}\n      triggerRef={linkRef}\n      overlay={overlay}\n      portalMatchTrigger={false}\n      container={scrollableContent}\n      getPosition={getPositionTopLeft}\n      offset={[0, offsetY]}\n      zoom={zoom}\n    >\n      {renderCard}\n    </Portal>\n  );\n};\n\nexport default LinkCardPortal;\n"],"file":"LinkCardPortal.js"}