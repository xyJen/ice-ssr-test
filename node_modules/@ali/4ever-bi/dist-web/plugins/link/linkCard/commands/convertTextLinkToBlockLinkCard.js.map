{"version":3,"sources":["../../../../../../src/plugins/link/linkCard/commands/convertTextLinkToBlockLinkCard.ts"],"names":["Commands","removeLink","buildLinkCardBlock","fetchLinkData","deleteExtraBlankLine","convertTextLinkToBlockLinkCard","controller","node","data","text","href","cardInfo","getLinkInfo","nodeText","length","needFetchLinkInfo","Boolean","card","setOpRelatedId","key","command","moveToStartOfNode"],"mappings":"AAAA,SAAqBA,QAArB,QAAqC,oBAArC;AAEA,SAASC,UAAT;AAEA,OAAOC,kBAAP;AACA,SAASC,aAAT;AACA,OAAOC,oBAAP;AAGA,eAAe,SAASC,8BAAT,CACbC,UADa,EAEbC,IAFa,EAGbC,IAHa,EASb;AAAA,MAEQC,IAFR,GAE8CD,IAF9C,CAEQC,IAFR;AAAA,MAEcC,IAFd,GAE8CF,IAF9C,CAEcE,IAFd;AAAA,MAEoBC,QAFpB,GAE8CH,IAF9C,CAEoBG,QAFpB;AAAA,MAE8BC,WAF9B,GAE8CJ,IAF9C,CAE8BI,WAF9B,EAIA;;AACA,MAAMC,QAAQ,GAAGJ,IAAI,CAACK,MAAL,GAAcL,IAAd,GAAqBC,IAAtC,CALA,CAOA;;AACA,MAAMK,iBAAiB,GAAG,CAACC,OAAO,CAACL,QAAD,CAAlC,CARA,CAUA;;AACA,MAAMM,IAAI,GAAGf,kBAAkB,CAAC;AAAEO,IAAAA,IAAI,EAAEI,QAAR;AAAkBH,IAAAA,IAAI,EAAJA,IAAlB;AAAwBC,IAAAA,QAAQ,EAAEA,QAAQ,IAAI;AAA9C,GAAD,CAA/B;AACAL,EAAAA,UAAU,CACPY,cADH,CACkBD,IAAI,CAACE,GADvB,EAEGC,OAFH,CAEWpB,QAAQ,CAACqB,iBAFpB,EAEuCd,IAFvC,EAGGa,OAHH,CAGWnB,UAHX,EAGuBM,IAHvB,EAIGa,OAJH,CAIW,YAJX,EAIyBH,IAJzB,EAKGG,OALH,CAKWhB,oBALX,EAKiCa,IAAI,CAACE,GALtC;;AAOA,MAAIJ,iBAAJ,EAAuB;AACrBZ,IAAAA,aAAa,CAACc,IAAD,EAAOX,UAAP,EAAmBI,IAAnB,EAAyBG,QAAzB,EAAmCD,WAAnC,EAAgDK,IAAI,CAACE,GAArD,CAAb;AACD;;AACD,SAAOb,UAAP;AACD;AAAA","sourcesContent":["import { Controller, Commands } from '@ali/4ever-cangjie';\nimport { LinkNode } from '../../actions';\nimport { removeLink } from '../../commands';\nimport { ILinkCardInfo, LinkPluginConfig } from '../../types';\nimport buildLinkCardBlock from '../utils/buildLinkCardBlock';\nimport { fetchLinkData } from '../utils/fetchLinkData';\nimport deleteExtraBlankLine from './deleteExtraBlankLine';\n\n\nexport default function convertTextLinkToBlockLinkCard(\n  controller: Controller,\n  node: LinkNode,\n  data: {\n    text: string,\n    href: string,\n    cardInfo?: ILinkCardInfo,\n    getLinkInfo?: LinkPluginConfig['getLinkInfo']\n  }\n) {\n\n  const { text, href, cardInfo, getLinkInfo } = data;\n\n  // 将 text link 转换为 block link card\n  const nodeText = text.length ? text : href;\n\n  // 如果已经有 cardInfo，则不需要拉取链接信息\n  const needFetchLinkInfo = !Boolean(cardInfo);\n\n  // 如果更新了卡片信息\n  const card = buildLinkCardBlock({ text: nodeText, href, cardInfo: cardInfo || {} });\n  controller\n    .setOpRelatedId(card.key)\n    .command(Commands.moveToStartOfNode, node)\n    .command(removeLink, node)\n    .command('insertCard', card)\n    .command(deleteExtraBlankLine, card.key);\n\n  if (needFetchLinkInfo) {\n    fetchLinkData(card, controller, href, nodeText, getLinkInfo, card.key);\n  }\n  return controller;\n};\n\n"],"file":"convertTextLinkToBlockLinkCard.js"}