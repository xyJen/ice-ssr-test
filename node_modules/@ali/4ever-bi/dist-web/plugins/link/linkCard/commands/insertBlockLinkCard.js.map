{"version":3,"sources":["../../../../../../src/plugins/link/linkCard/commands/insertBlockLinkCard.ts"],"names":["buildLinkCardBlock","fetchLinkData","insertBlockLinkCard","controller","data","text","href","cardInfo","getLinkInfo","nodeText","length","needFetchLinkInfo","card","setOpRelatedId","key","command"],"mappings":"AAEA,OAAOA,kBAAP;AACA,SAASC,aAAT;AAGA,eAAe,SAASC,mBAAT,CACbC,UADa,EAEbC,IAFa,EAQb;AAAA,MACQC,IADR,GAC8CD,IAD9C,CACQC,IADR;AAAA,MACcC,IADd,GAC8CF,IAD9C,CACcE,IADd;AAAA,MACoBC,QADpB,GAC8CH,IAD9C,CACoBG,QADpB;AAAA,MAC8BC,WAD9B,GAC8CJ,IAD9C,CAC8BI,WAD9B,EAGA;;AACA,MAAMC,QAAQ,GAAGJ,IAAI,CAACK,MAAL,GAAcL,IAAd,GAAqBC,IAAtC,CAJA,CAMA;;AACA,MAAMK,iBAAiB,GAAG,CAACJ,QAA3B,CAPA,CASA;;AACA,MAAMK,IAAI,GAAGZ,kBAAkB,CAAC;AAAEK,IAAAA,IAAI,EAAEI,QAAR;AAAkBH,IAAAA,IAAI,EAAJA,IAAlB;AAAwBC,IAAAA,QAAQ,EAAEA,QAAQ,IAAI;AAA9C,GAAD,CAA/B;AACAJ,EAAAA,UAAU,CACPU,cADH,CACkBD,IAAI,CAACE,GADvB,EAEGC,OAFH,CAEW,YAFX,EAEyBH,IAFzB;;AAGA,MAAID,iBAAJ,EAAuB;AACrBV,IAAAA,aAAa,CAACW,IAAD,EAAOT,UAAP,EAAmBG,IAAnB,EAAyBG,QAAzB,EAAmCD,WAAnC,EAAgDI,IAAI,CAACE,GAArD,CAAb;AACD;;AACD,SAAOX,UAAP;AACD","sourcesContent":["import { Controller } from '@ali/4ever-cangjie';\nimport { ILinkCardInfo, LinkPluginConfig } from '../../types';\nimport buildLinkCardBlock from '../utils/buildLinkCardBlock';\nimport { fetchLinkData } from '../utils/fetchLinkData';\n\n\nexport default function insertBlockLinkCard(\n  controller: Controller,\n  data: {\n    text: string;\n    href: string;\n    cardInfo?: ILinkCardInfo;\n    getLinkInfo?: LinkPluginConfig['getLinkInfo'];\n  },\n) {\n  const { text, href, cardInfo, getLinkInfo } = data;\n\n  // 将 text link 转换为 block link card\n  const nodeText = text.length ? text : href;\n\n  // 如果已经有 cardInfo，则不需要拉取链接信息\n  const needFetchLinkInfo = !cardInfo;\n\n  // 如果更新了卡片信息\n  const card = buildLinkCardBlock({ text: nodeText, href, cardInfo: cardInfo || {} });\n  controller\n    .setOpRelatedId(card.key)\n    .command('insertCard', card);\n  if (needFetchLinkInfo) {\n    fetchLinkData(card, controller, href, nodeText, getLinkInfo, card.key);\n  }\n  return controller;\n}\n\n"],"file":"insertBlockLinkCard.js"}