{"version":3,"sources":["../../../../../../src/plugins/link/linkCard/commands/convertPureLinkToBlockLinkCard.ts"],"names":["removePureLink","buildLinkCardBlock","fetchLinkData","deleteExtraBlankLine","convertPureLinkToBlockLinkCard","controller","node","data","offset","text","href","srcHref","cardInfo","needFetchLinkInfo","getLinkInfo","nodeText","length","card","setOpRelatedId","key","command"],"mappings":"AACA,OAAOA,cAAP;AAEA,OAAOC,kBAAP;AACA,SAASC,aAAT;AACA,OAAOC,oBAAP;AAGA,eAAe,SAASC,8BAAT,CACbC,UADa,EAEbC,IAFa,EAGbC,IAHa,EAYb;AAAA,MAEQC,MAFR,GAEkFD,IAFlF,CAEQC,MAFR;AAAA,MAEgBC,IAFhB,GAEkFF,IAFlF,CAEgBE,IAFhB;AAAA,MAEsBC,IAFtB,GAEkFH,IAFlF,CAEsBG,IAFtB;AAAA,MAE4BC,OAF5B,GAEkFJ,IAFlF,CAE4BI,OAF5B;AAAA,MAEqCC,QAFrC,GAEkFL,IAFlF,CAEqCK,QAFrC;AAAA,MAE+CC,iBAF/C,GAEkFN,IAFlF,CAE+CM,iBAF/C;AAAA,MAEkEC,WAFlE,GAEkFP,IAFlF,CAEkEO,WAFlE,EAIA;;AACA,MAAMC,QAAQ,GAAGN,IAAI,CAACO,MAAL,GAAcP,IAAd,GAAqBC,IAAtC,CALA,CAOA;;AACA,MAAMO,IAAI,GAAGhB,kBAAkB,CAAC;AAAEQ,IAAAA,IAAI,EAAEM,QAAR;AAAkBL,IAAAA,IAAI,EAAJA,IAAlB;AAAwBE,IAAAA,QAAQ,EAARA;AAAxB,GAAD,CAA/B;AACAP,EAAAA,UAAU,CACPa,cADH,CACkBD,IAAI,CAACE,GADvB,EAEGC,OAFH,CAEWpB,cAFX,EAE2BM,IAF3B,EAEiCE,MAFjC,EAEyCG,OAFzC,EAGGS,OAHH,CAGW,YAHX,EAGyBH,IAHzB,EAIGG,OAJH,CAIWjB,oBAJX,EAIiCc,IAAI,CAACE,GAJtC;;AAMA,MAAIN,iBAAJ,EAAuB;AACrBX,IAAAA,aAAa,CAACe,IAAD,EAAOZ,UAAP,EAAmBK,IAAnB,EAAyBK,QAAzB,EAAmCD,WAAnC,EAAgDG,IAAI,CAACE,GAArD,CAAb;AACD;;AACD,SAAOd,UAAP;AACD;AAAA","sourcesContent":["import { Commands, Controller, Node } from '@ali/4ever-cangjie';\nimport removePureLink from '../../commands/removePureLink';\nimport { ILinkCardInfo, LinkPluginConfig } from '../../types';\nimport buildLinkCardBlock from '../utils/buildLinkCardBlock';\nimport { fetchLinkData } from '../utils/fetchLinkData';\nimport deleteExtraBlankLine from './deleteExtraBlankLine';\n\n\nexport default function convertPureLinkToBlockLinkCard(\n  controller: Controller,\n  node: Node,\n  data: {\n    offset: number,\n    text: string,\n    href: string,\n    srcHref: string,\n    cardInfo: ILinkCardInfo,\n    needFetchLinkInfo?: boolean\n    getLinkInfo?: LinkPluginConfig['getLinkInfo']\n  }\n) {\n\n  const { offset, text, href, srcHref, cardInfo, needFetchLinkInfo, getLinkInfo } = data;\n\n  // 将 pure link 转换为 block link card\n  const nodeText = text.length ? text : href;\n\n  // 如果更新了卡片信息\n  const card = buildLinkCardBlock({ text: nodeText, href, cardInfo });\n  controller\n    .setOpRelatedId(card.key)\n    .command(removePureLink, node, offset, srcHref)\n    .command('insertCard', card)\n    .command(deleteExtraBlankLine, card.key);\n\n  if (needFetchLinkInfo) {\n    fetchLinkData(card, controller, href, nodeText, getLinkInfo, card.key);\n  }\n  return controller;\n};\n\n"],"file":"convertPureLinkToBlockLinkCard.js"}