import _extends from "@babel/runtime/helpers/extends";
import { Commands } from '@ali/4ever-cangjie';
import Actions from "../actions";
import findNativeTextArea from "../utils/findNativeTextArea";
import { getScreenSelection } from "../utils/getScreenSelection";
export default function createOnAction(configs) {
  var _ref = configs || {},
      onToggleMode = _ref.onToggleMode;

  return function handleAction(action, controller, next) {
    if (action.type === Actions.ENTER) {
      controller.setData(_extends({}, controller.value.data, {
        _exitPreview: false,
        // 进入预览模式时，需要隐藏弹出菜单
        _mobileFocusedSelection: undefined
      }));
      onToggleMode && onToggleMode(true);
    } else if (action.type === Actions.EXIT) {
      var _ref2 = action.payload || {},
          noScroll = _ref2.noScroll,
          noFocus = _ref2.noFocus;

      var data = controller.value.data;
      var selection = noScroll ? null : getScreenSelection(controller);

      if (selection) {
        controller.command(Commands.select, selection);
      }

      controller.setData(_extends({}, data, {
        _exitPreview: true
      }));
      onToggleMode && onToggleMode(false);

      if (!noFocus) {
        controller.run('onCangjieFocus');
        var textArea = findNativeTextArea(controller);

        if (textArea != null && textArea.focus) {
          textArea.focus({
            preventScroll: true
          });
        }
      }
    }

    return next();
  };
}
//# sourceMappingURL=onAction.js.map