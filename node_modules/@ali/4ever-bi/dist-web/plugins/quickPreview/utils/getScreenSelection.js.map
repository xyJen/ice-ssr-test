{"version":3,"sources":["../../../../../src/plugins/quickPreview/utils/getScreenSelection.ts"],"names":["domUtils","TOP_SPACE","OFFSET","getScreenSelection","controller","key","value","document","docNode","findDOMNodeSafely","getBoundingClientRect","left","top","bottom","clientX","clientY","hitedTarget","window","elementFromPoint","caretRangeFromTargetAndCoord"],"mappings":"AAAA,SAAqBA,QAArB,QAAqC,oBAArC;AAEA,IAAMC,SAAS,GAAG,GAAlB;AACA,IAAMC,MAAM,GAAG,EAAf;AAEA;AACA;AACA;;AACA,OAAO,SAASC,kBAAT,CAA4BC,UAA5B,EAAoD;AAAA,MACjDC,GADiD,GACzCD,UAAU,CAACE,KAAX,CAAiBC,QADwB,CACjDF,GADiD;AAEzD,MAAMG,OAAO,GAAGR,QAAQ,CAACS,iBAAT,CAA2BJ,GAA3B,CAAhB;;AACA,MAAI,CAACG,OAAL,EAAc;AACZ,WAAO,IAAP;AACD;;AALwD,8BAM3BA,OAAO,CAACE,qBAAR,EAN2B;AAAA,MAMjDC,IANiD,yBAMjDA,IANiD;AAAA,MAM3CC,GAN2C,yBAM3CA,GAN2C;AAAA,MAMtCC,MANsC,yBAMtCA,MANsC;;AAOzD,MAAMC,OAAO,GAAGH,IAAI,GAAGT,MAAvB;AACA,MAAIa,OAAO,GAAGd,SAAd;;AACA,MAAIW,GAAG,GAAGX,SAAV,EAAqB;AACnBc,IAAAA,OAAO,GAAGH,GAAG,GAAGV,MAAhB;AACD,GAFD,MAEO,IAAIW,MAAM,GAAGZ,SAAb,EAAwB;AAC7Bc,IAAAA,OAAO,GAAGF,MAAM,GAAGX,MAAnB;AACD;;AACD,MAAMc,WAAW,GAAGC,MAAM,CAACV,QAAP,CAAgBW,gBAAhB,CAAiCJ,OAAjC,EAA0CC,OAA1C,CAApB;;AACA,MAAI,CAACC,WAAL,EAAkB;AAChB,WAAO,IAAP;AACD;;AACD,SAAOhB,QAAQ,CAACmB,4BAAT,CACLH,WADK,EAELF,OAFK,EAGLC,OAHK,EAILX,UAJK,CAAP;AAMD","sourcesContent":["import { Controller, domUtils } from '@ali/4ever-cangjie';\n\nconst TOP_SPACE = 100;\nconst OFFSET = 10;\n\n/**\n * 获取屏幕顶部的 selection，聚焦的时候避免滚动\n */\nexport function getScreenSelection(controller: Controller) {\n  const { key } = controller.value.document;\n  const docNode = domUtils.findDOMNodeSafely(key);\n  if (!docNode) {\n    return null;\n  }\n  const { left, top, bottom } = docNode.getBoundingClientRect();\n  const clientX = left + OFFSET;\n  let clientY = TOP_SPACE;\n  if (top > TOP_SPACE) {\n    clientY = top + OFFSET;\n  } else if (bottom < TOP_SPACE) {\n    clientY = bottom - OFFSET;\n  }\n  const hitedTarget = window.document.elementFromPoint(clientX, clientY);\n  if (!hitedTarget) {\n    return null;\n  }\n  return domUtils.caretRangeFromTargetAndCoord(\n    hitedTarget,\n    clientX,\n    clientY,\n    controller,\n  );\n}\n"],"file":"getScreenSelection.js"}