import _extends from "@babel/runtime/helpers/extends";
import { Commands } from '@ali/4ever-cangjie';
import { getPreviousViewGroupNode, isHeadingGroupAvailable } from '@ali/4ever-plugin-heading-group';
/**
 *   
 * 场景一：标题一 合并到标题
 * 
 *   >标题三             >标题三
 *   >标题二             >标题二I标题一
 *    I标题一    ->           
 * 
 * 
 * 场景二：折叠标题一 合并到 折叠标题二
 * 
 *   >标题三             >标题三
 *   >标题二             >标题二I标题一
 *   >I标题一    ->      ><空标题一> 
 */

export default function onBackspace(event, controller, next) {
  var _controller$value = controller.value,
      selection = _controller$value.selection,
      startBlock = _controller$value.startBlock;
  if (!selection || !startBlock || selection.isExpanded || selection.anchor.offset > 0 || !isHeadingGroupAvailable(controller)) return next();
  var isAtBlockStart = selection.anchor.isAtStartOfNode(startBlock);
  if (!isAtBlockStart) return next();
  var previousViewNode = getPreviousViewGroupNode(startBlock, controller);

  if (controller.userData.get(previousViewNode, 'fold')) {
    var newNode = startBlock.set('data', _extends({}, startBlock.data, {
      fold: true
    }));
    return controller.command(Commands.moveToEndOfNode, previousViewNode).command(Commands.removeNodeByKey, startBlock.key).command(Commands.insertBlock, newNode).command(Commands.moveToStartOfNode, newNode).command(Commands.mergeNodeByKey, newNode.key);
  } else {
    return next();
  }
}
//# sourceMappingURL=onBackspace.js.map