{"version":3,"sources":["../../../../../src/plugins/heading/handlers/onBackspace.ts"],"names":["Commands","getPreviousViewGroupNode","isHeadingGroupAvailable","onBackspace","event","controller","next","value","selection","startBlock","isExpanded","anchor","offset","isAtBlockStart","isAtStartOfNode","previousViewNode","userData","get","newNode","set","data","fold","command","moveToEndOfNode","removeNodeByKey","key","insertBlock","moveToStartOfNode","mergeNodeByKey"],"mappings":";AAAA,SAAqBA,QAArB,QAAgD,oBAAhD;AACA,SAASC,wBAAT,EAAmCC,uBAAnC,QAAkE,iCAAlE;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,eAAe,SAASC,WAAT,CACbC,KADa,EAEbC,UAFa,EAGbC,IAHa,EAIb;AAAA,0BACkCD,UAAU,CAACE,KAD7C;AAAA,MACQC,SADR,qBACQA,SADR;AAAA,MACmBC,UADnB,qBACmBA,UADnB;AAGA,MACE,CAACD,SAAD,IACA,CAACC,UADD,IAEAD,SAAS,CAACE,UAFV,IAGCF,SAAS,CAACG,MAAX,CAAgCC,MAAhC,GAAyC,CAHzC,IAIA,CAACV,uBAAuB,CAACG,UAAD,CAL1B,EAME,OAAOC,IAAI,EAAX;AACF,MAAMO,cAAc,GAAGL,SAAS,CAACG,MAAV,CAAiBG,eAAjB,CAAiCL,UAAjC,CAAvB;AAEA,MAAI,CAACI,cAAL,EAAqB,OAAOP,IAAI,EAAX;AAErB,MAAMS,gBAAgB,GAAGd,wBAAwB,CAACQ,UAAD,EAAaJ,UAAb,CAAjD;;AAEA,MAAIA,UAAU,CAACW,QAAX,CAAoBC,GAApB,CAAwBF,gBAAxB,EAA0C,MAA1C,CAAJ,EAAuD;AACrD,QAAMG,OAAO,GAAGT,UAAU,CAACU,GAAX,CAAe,MAAf,eACXV,UAAU,CAACW,IADA;AAEdC,MAAAA,IAAI,EAAE;AAFQ,OAAhB;AAIA,WAAOhB,UAAU,CACdiB,OADI,CACItB,QAAQ,CAACuB,eADb,EAC8BR,gBAD9B,EAEJO,OAFI,CAEItB,QAAQ,CAACwB,eAFb,EAE8Bf,UAAU,CAACgB,GAFzC,EAGJH,OAHI,CAGItB,QAAQ,CAAC0B,WAHb,EAG0BR,OAH1B,EAIJI,OAJI,CAIItB,QAAQ,CAAC2B,iBAJb,EAIgCT,OAJhC,EAKJI,OALI,CAKItB,QAAQ,CAAC4B,cALb,EAK6BV,OAAO,CAACO,GALrC,CAAP;AAMD,GAXD,MAWO;AACL,WAAOnB,IAAI,EAAX;AACD;AACF","sourcesContent":["import { Controller, Commands, TextPoint } from '@ali/4ever-cangjie';\nimport { getPreviousViewGroupNode, isHeadingGroupAvailable } from '@ali/4ever-plugin-heading-group';\n\n/**\n *   \n * 场景一：标题一 合并到标题\n * \n *   >标题三             >标题三\n *   >标题二             >标题二I标题一\n *    I标题一    ->           \n * \n * \n * 场景二：折叠标题一 合并到 折叠标题二\n * \n *   >标题三             >标题三\n *   >标题二             >标题二I标题一\n *   >I标题一    ->      ><空标题一> \n */\n\nexport default function onBackspace(\n  event: React.KeyboardEvent,\n  controller: Controller,\n  next: Function,\n) {\n  const { selection, startBlock } = controller.value;\n\n  if (\n    !selection ||\n    !startBlock ||\n    selection.isExpanded ||\n    (selection.anchor as TextPoint).offset > 0 ||\n    !isHeadingGroupAvailable(controller)\n  ) return next();\n  const isAtBlockStart = selection.anchor.isAtStartOfNode(startBlock);\n\n  if (!isAtBlockStart) return next();\n\n  const previousViewNode = getPreviousViewGroupNode(startBlock, controller);\n\n  if (controller.userData.get(previousViewNode, 'fold')) {\n    const newNode = startBlock.set('data', {\n      ...startBlock.data,\n      fold: true,\n    });\n    return controller\n      .command(Commands.moveToEndOfNode, previousViewNode)\n      .command(Commands.removeNodeByKey, startBlock.key)\n      .command(Commands.insertBlock, newNode)\n      .command(Commands.moveToStartOfNode, newNode)\n      .command(Commands.mergeNodeByKey, newNode.key)\n  } else {\n    return next();\n  }\n}"],"file":"onBackspace.js"}