{"version":3,"sources":["../../../../../src/plugins/heading/utils/fragment.ts"],"names":["Text","Heading","Paragraph","removeNodeMarkByTypes","block","types","node","texts","getTexts","length","i","text","path","getPath","key","needRemoveMarks","getMarks","filter","m","find","t","type","j","removeMark","isSelectionAtHeading","value","selection","isCollapsedAtEdge","startBlock","isHeading","removeFirstNodeMarkByTypes","frag","fragment","nodes","firstNode","replaceNode","isVisualEmpty","maybeNode","isParagraph","isText"],"mappings":"AAAA,SAIEA,IAJF,QAKO,oBALP;AAMA,SAASC,OAAT,EAAkBC,SAAlB,QAAmC,eAAnC;;AAGA,SAASC,qBAAT,CAA+BC,KAA/B,EAA6CC,KAA7C,EAA8D;AAAA;;AAC5D,MAAIC,IAAI,GAAGF,KAAX;AACA,MAAMG,KAAK,YAAGD,IAAH,qBAAG,MAAME,QAAN,EAAd;AACA,MAAI,EAACD,KAAD,YAACA,KAAK,CAAEE,MAAR,CAAJ,EAAoB,OAAOH,IAAP;;AAEpB,OAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAACH,KAAK,CAACE,MAAxB,EAAgCC,CAAC,EAAjC,EAAqC;AACnC,QAAMC,IAAI,GAAGJ,KAAK,CAACG,CAAD,CAAlB;AACA,QAAME,IAAI,GAAGN,IAAI,CAACO,OAAL,CAAaF,IAAI,CAACG,GAAlB,CAAb;AACA,QAAI,CAACF,IAAL,EAAW;AAEX,QAAMG,eAAe,GAAGJ,IAAI,CAACK,QAAL,GAAgBC,MAAhB,CAAuB,UAACC,CAAD,EAAO;AACpD,aAAOb,KAAK,CAACc,IAAN,CAAY,UAAAC,CAAC;AAAA,eAAIF,CAAC,CAACG,IAAF,KAAWD,CAAf;AAAA,OAAb,CAAP;AACD,KAFuB,CAAxB;;AAIA,SAAI,IAAIE,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGP,eAAe,CAACN,MAAnC,EAA2Ca,CAAC,EAA5C,EAAgD;AAC9ChB,MAAAA,IAAI,GAAGA,IAAI,CAACiB,UAAL,CAAgBX,IAAhB,EAAsB,CAAtB,EAAyBD,IAAI,CAACA,IAAL,CAAUF,MAAnC,EAA2CM,eAAe,CAACO,CAAD,CAA1D,CAAP;AACD;AACF;;AAED,SAAOhB,IAAP;AACD;;AAED,OAAO,SAASkB,oBAAT,CAA8BC,KAA9B,EAA4C;AACjD,MAAIA,KAAK,CAACC,SAAN,CAAgBC,iBAApB,EAAuC,OAAO,KAAP;AADU,MAEzCC,UAFyC,GAE1BH,KAF0B,CAEzCG,UAFyC;AAGjD,SAAO3B,OAAO,CAAC4B,SAAR,CAAkBD,UAAlB,CAAP;AACD;AAGD;AACA;AACA;;AACA,OAAO,SAASE,0BAAT,CAAoCC,IAApC,EAAoD1B,KAApD,EAAqE;AAAA;;AAC1E,MAAI2B,QAAQ,GAAGD,IAAf;AACA,MAAI,EAACC,QAAD,+BAACA,QAAQ,CAAEC,KAAX,aAAC,gBAAiBxB,MAAlB,CAAJ,EAA8B,OAAOuB,QAAP;AAE9B,MAAM1B,IAAI,GAAG0B,QAAQ,CAACC,KAAT,CAAe,CAAf,CAAb;AACA,MAAMrB,IAAI,GAAGoB,QAAQ,CAACnB,OAAT,CAAiBP,IAAI,CAACQ,GAAtB,CAAb;AACA,MAAI,CAACF,IAAL,EAAW,OAAOoB,QAAP;AAEX,MAAME,SAAS,GAAG/B,qBAAqB,CAACG,IAAD,EAAOD,KAAP,CAAvC;AACA,SAAO2B,QAAQ,CAACG,WAAT,CAAqBvB,IAArB,EAA2BsB,SAA3B,CAAP;AACD;AAGD;AACA;AACA;;AACC,OAAO,SAASE,aAAT,CAAuBC,SAAvB,EAAuC;AAC7C,SACE,CAACnC,SAAS,CAACoC,WAAV,CAAsBD,SAAtB,KAAoCpC,OAAO,CAAC4B,SAAR,CAAkBQ,SAAlB,CAArC,KACAA,SAAS,CAACJ,KAAV,CAAgBxB,MAAhB,KAA2B,CAD3B,IAEAT,IAAI,CAACuC,MAAL,CAAYF,SAAS,CAACJ,KAAV,CAAgB,CAAhB,CAAZ,CAFA,IAGAI,SAAS,CAAC1B,IAAV,KAAmB,EAJrB;AAMD","sourcesContent":["import { \n  Document, \n  Block,\n  Value,\n  Text,\n} from '@ali/4ever-cangjie';\nimport { Heading, Paragraph } from '@ali/4ever-mo';\n\n\nfunction removeNodeMarkByTypes(block: Block, types: string[]) {\n  let node = block;\n  const texts = node?.getTexts();\n  if (!texts?.length) return node;\n\n  for (let i = 0; i<texts.length; i++) {\n    const text = texts[i];\n    const path = node.getPath(text.key);\n    if (!path) continue;\n\n    const needRemoveMarks = text.getMarks().filter((m) => {\n      return types.find( t => m.type === t);\n    });\n\n    for(let j = 0; j < needRemoveMarks.length; j++) {\n      node = node.removeMark(path, 0, text.text.length, needRemoveMarks[j]);\n    }\n  }\n\n  return node;\n}\n\nexport function isSelectionAtHeading(value: Value) {\n  if (value.selection.isCollapsedAtEdge) return false;\n  const { startBlock } = value;\n  return Heading.isHeading(startBlock);\n}\n\n\n/**\n * 移除 fragment 第一个段落指定 marks\n */\nexport function removeFirstNodeMarkByTypes(frag: Document, types: string[]) {\n  let fragment = frag;\n  if (!fragment?.nodes?.length) return fragment;\n\n  const node = fragment.nodes[0];\n  const path = fragment.getPath(node.key);\n  if (!path) return fragment;\n\n  const firstNode = removeNodeMarkByTypes(node, types);\n  return fragment.replaceNode(path, firstNode);\n}\n\n\n/**\n * 视觉上是否为空段落\n */\n export function isVisualEmpty(maybeNode: any) {\n  return (\n    (Paragraph.isParagraph(maybeNode) || Heading.isHeading(maybeNode)) && \n    maybeNode.nodes.length === 1 && \n    Text.isText(maybeNode.nodes[0]) &&\n    maybeNode.text === ''\n  );\n}\n"],"file":"fragment.js"}