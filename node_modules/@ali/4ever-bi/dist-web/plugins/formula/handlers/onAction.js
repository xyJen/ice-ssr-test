import _extends from "@babel/runtime/helpers/extends";
import { getClosestContainerBlock } from '@ali/4ever-utils';
import { getInnerWidth } from '@ali/4ever-utils';
import { FORMULA_SET_DATA, FORMULA_SET_INJECTION } from "../actions";
import { setInjection } from "../commands/setInjection";
import { setTagData } from '@ali/4ever-factory';
export default function onAction(action, controller, next) {
  if (action.type === FORMULA_SET_DATA) {
    var value = controller.value;
    var _ref = action.payload,
        node = _ref.node,
        data = _ref.data;
    var closestBlock = getClosestContainerBlock(value, node);
    var maxWidth = getInnerWidth(closestBlock);

    var tagData = _extends({}, data, {
      width: !data.width ? data.width : Math.min(maxWidth, data.width),
      height: data.height
    });

    return controller.run('onAction', setTagData(node, tagData));
  }

  if (action.type === FORMULA_SET_INJECTION) {
    var _ref2 = action.payload,
        key = _ref2.key,
        _data = _ref2.data;
    return setInjection(controller, key, _data);
  }

  return next();
}
//# sourceMappingURL=onAction.js.map