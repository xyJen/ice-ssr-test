{"version":3,"sources":["../../../../../src/plugins/columns/components/columnsMenu.tsx"],"names":["React","useCallback","useState","ColumnsPlugin","PluginRoles","MenuItem","SubMenu","removeNewlineTriggerText","ColumnsPicker","insertColumns","actions","createColumnsMenu","configs","ColumnsMenu","props","count","setCount","menuItem","controller","title","menuKey","rest","isCollapsedAtEdge","value","selection","handleClick","_","event","run","size","text","stopPropagation","handleDefaultClick","columnText","locale","insertText2","padding","columns","height"],"mappings":"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","sourcesContent":["import React, { useCallback, useState } from 'react';\nimport { ColumnsPlugin, PluginRoles } from '@ali/4ever-bamboo';\nimport { MenuItem, SubMenu } from '@ali/we-design';\nimport { MenuItemInnerProps } from '@ali/4ever-component';\nimport { removeNewlineTriggerText } from '@ali/4ever-utils';\nimport ColumnsPicker from './ColumnPicker';\nimport type { IConfig } from '../menubar';\n\nconst { insertColumns } = ColumnsPlugin.actions;\n\nconst createColumnsMenu = (configs: IConfig) => {\n  return function ColumnsMenu(props: MenuItemInnerProps) {\n    const [count, setCount] = useState(2);\n\n    const { menuItem, controller } = props;\n    const { title, menuKey, ...rest } = menuItem;\n\n    const { isCollapsedAtEdge } = controller.value.selection;\n    const handleClick = useCallback(\n      (_, event: React.MouseEvent) => {\n        if (!event) {\n          // 回车触发\n          // menuItem 有bug, 这里必须在 setCount 里才能拿到最新的 count\n          setCount((count) => {\n            controller.run(\n              'onAction',\n              insertColumns({ size: count, text: '' }),\n            );\n            return count;\n          });\n        } else {\n          // click 触发\n          controller.run('onAction', insertColumns({ size: count, text: '' }));\n        }\n\n        event && event.stopPropagation();\n      },\n      [count],\n    );\n\n    const handleDefaultClick = useCallback((event) => {\n      controller.run('onAction', insertColumns({ size: 2, text: '' }));\n      controller.run('onAction', removeNewlineTriggerText(false));\n      event && event.stopPropagation();\n    }, [controller]);\n\n    const columnText = configs?.locale?.insertText2;\n    return (\n      <div onClick={handleDefaultClick}>\n        <SubMenu\n          {...rest}\n          disabled={isCollapsedAtEdge}\n          title={title || ''}\n          overlayStyle={{ padding: 0 }}\n          overlayClassName=\"menu-columns-overlay\"\n        >\n          <MenuItem\n            menuKey={menuKey || 'columnsPicker'}\n            hoverable={false}\n            role={PluginRoles.columns}\n            style={{\n              height: 'auto',\n              padding: '12px',\n            }}\n            onClick={handleClick}\n          >\n            <ColumnsPicker\n              activeCount={count}\n              onChange={setCount}\n              columnText={columnText}\n            />\n          </MenuItem>\n        </SubMenu>\n      </div>\n    );\n  };\n};\n\nexport default createColumnsMenu;\n"],"file":"columnsMenu.js"}