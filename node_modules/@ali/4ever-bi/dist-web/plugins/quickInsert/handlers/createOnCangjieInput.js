import insertQuickInsert from "../commands/insert";
import removeQuickInsert from "../commands/remove";
import isSelectionInQuickInsert from "../queries/isSelectionInQuickInsert";
export default function createOnCangjieInput(config, insertMap) {
  var triggers = config.triggers;
  return function onCangjieInput(event, controller, next) {
    var plugin = triggers[event.detail.data];

    if (!plugin || !insertMap[plugin]) {
      return next();
    }

    event.preventDefault();

    if (isSelectionInQuickInsert(controller)) {
      var decorations = controller.value.decorations; // 若此时仍尝试呼出相同插入，则重新呼出

      var quickInsertDecoration = decorations.find(function (_ref) {
        var mark = _ref.mark;
        return mark.type === 'quick-insert';
      });

      if (quickInsertDecoration.mark.data.plugin === plugin) {
        return controller.command(removeQuickInsert).command(insertQuickInsert, {
          plugin: plugin
        });
      }

      return next();
    }

    return controller.command(insertQuickInsert, {
      plugin: plugin
    });
  };
}
//# sourceMappingURL=createOnCangjieInput.js.map