{"version":3,"sources":["../../../../../src/plugins/quickInsert/handlers/onKeyDown.ts"],"names":["isKeyHotkey","remove","isSelectionInQuickInsert","isEscHotkey","isBackspaceHotkey","onKeyDown","event","controller","next","command","value","selection","decorations","quickInsertDecoration","find","mark","type","focus","moveBackward","offset","start"],"mappings":"AACA,OAAOA,WAAP,MAAwB,WAAxB;AACA,OAAOC,MAAP;AACA,OAAOC,wBAAP;AAEA,IAAMC,WAAW,GAAGH,WAAW,CAAC,KAAD,CAA/B;AACA,IAAMI,iBAAiB,GAAGJ,WAAW,CAAC,WAAD,CAArC;AAEA,eAAe,SAASK,SAAT,CACbC,KADa,EAEbC,UAFa,EAGbC,IAHa,EAIb;AACA,MAAIN,wBAAwB,CAACK,UAAD,CAA5B,EAA0C;AACxC,QAAIJ,WAAW,CAACG,KAAD,CAAf,EAAwB;AACtBC,MAAAA,UAAU,CAACE,OAAX,CAAmBR,MAAnB;AACD;;AAED,QAAIG,iBAAiB,CAACE,KAAD,CAArB,EAA8B;AAAA,8BACOC,UAAU,CAACG,KADlB;AAAA,UACpBC,SADoB,qBACpBA,SADoB;AAAA,UACTC,WADS,qBACTA,WADS;AAG5B,UAAMC,qBAAqB,GAAGD,WAAW,CAACE,IAAZ,CAC5B;AAAA,YAAGC,IAAH,QAAGA,IAAH;AAAA,eAAcA,IAAI,CAACC,IAAL,KAAc,cAA5B;AAAA,OAD4B,CAA9B;;AAIA,UACGL,SAAS,CAAEM,KAAX,CAAiBC,YAAjB,EAAD,CAA+CC,MAA/C,KACAN,qBAAqB,CAAEO,KAAvB,CAA6BD,MAF/B,EAGE;AACA,eAAOZ,UAAU,CAACE,OAAX,CAAmBR,MAAnB,CAAP;AACD;AACF;AACF;;AAED,SAAOO,IAAI,EAAX;AACD","sourcesContent":["import { Controller, TextPoint } from '@ali/4ever-cangjie';\nimport isKeyHotkey from 'is-hotkey';\nimport remove from '../commands/remove';\nimport isSelectionInQuickInsert from '../queries/isSelectionInQuickInsert';\n\nconst isEscHotkey = isKeyHotkey('esc');\nconst isBackspaceHotkey = isKeyHotkey('backspace');\n\nexport default function onKeyDown(\n  event: KeyboardEvent,\n  controller: Controller,\n  next: () => void,\n) {\n  if (isSelectionInQuickInsert(controller)) {\n    if (isEscHotkey(event)) {\n      controller.command(remove);\n    }\n\n    if (isBackspaceHotkey(event)) {\n      const { selection, decorations } = controller.value;\n\n      const quickInsertDecoration = decorations.find(\n        ({ mark }) => mark.type === 'quick-insert',\n      );\n\n      if (\n        (selection!.focus.moveBackward() as TextPoint).offset ===\n        quickInsertDecoration!.start.offset\n      ) {\n        return controller.command(remove);\n      }\n    }\n  }\n\n  return next();\n}\n"],"file":"onKeyDown.js"}