{"version":3,"sources":["../../src/provider.tsx"],"names":["React","LocaleProvider","WeUtilLocaleProvider","DesignNextLocaleProvider","Provider","createPlaceholderPlugin","PluginsContext","ActiveInteractionProvider","isPlaceholderVisible","BiProvider","state","value","plugins","handleChange","change","onChange","props","resolveCangjiePlugins","onAction","array","render","controllerRef","children","rest","lang","hash","Component","defaultProps","readOnly","action","controller","next","onCatch"],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;qBAH4B,a;AAI5B,SAASC,cAAc,IAAIC,oBAA3B,QAAuD,cAAvD;AACA,SAASD,cAAc,IAAIE,wBAA3B,QAA2D,qBAA3D,C,CACA;;AACA,SAASF,cAAT,QAA+B,YAA/B;AACA,SAGEG,QAHF,EAKEC,uBALF,QAOO,oBAPP;AAQA,SAASC,cAAT,EAAuCC,yBAAvC,QAAwE,sBAAxE;AACA,SAASC,oBAAT,QAAqC,kBAArC;AAEA;AACA;AACA;;AAgBA;AACA;AACA;AACA;IACqBC,U;;;;;;;;;;;UAUnBC,K,GAAQ;AACNC,MAAAA,KAAK,EAAE;AADD,K;UAIAC,O,GAA2B,I;;UAE3BC,Y,GAAe,UAAAC,MAAM,EAAI;AAAA,UACvBC,QADuB,GACV,MAAKC,KADK,CACvBD,QADuB;AAE/BA,MAAAA,QAAQ,QAAR,YAAAA,QAAQ,CAAGD,MAAH,CAAR;AACD,K;;;;;;;SAEOG,qB,GAAR,iCAAgC;AAC9B,QAAI,CAAC,KAAKL,OAAV,EAAmB;AAAA,wBACa,KAAKI,KADlB;AAAA,UACTJ,OADS,eACTA,OADS;AAAA,UACAM,QADA,eACAA,QADA;AAEjB,WAAKN,OAAL,IACE;AACAP,MAAAA,uBAAuB,CAAC;AACtBG,QAAAA,oBAAoB,EAApBA;AADsB,OAAD,CAFzB,EAKE;AAAEU,QAAAA,QAAQ,EAARA;AAAF,OALF,SAMM,CAAAN,OAAO,QAAP,YAAAA,OAAO,CAAEO,KAAT,KAAkB,EANxB;AAQD;;AACD,WAAO,KAAKP,OAAZ;AACD,G;;SAEDQ,M,GAAA,kBAAS;AAAA,uBAC+C,KAAKJ,KADpD;AAAA,QACCK,aADD,gBACCA,aADD;AAAA,QACgBC,QADhB,gBACgBA,QADhB;AAAA,QAC0BV,OAD1B,gBAC0BA,OAD1B;AAAA,QACsCW,IADtC;;AAAA,QAECZ,KAFD,GAEW,KAAKD,KAFhB,CAECC,KAFD;AAGP,wBACE,eAAC,wBAAD;AAA0B,MAAA,KAAK,EAAE,CAAAC,OAAO,QAAP,YAAAA,OAAO,CAAEY,IAAT,KAAiB;AAAlD,oBACE,eAAC,cAAD;AAAgB,MAAA,KAAK,EAAE,CAAAZ,OAAO,QAAP,YAAAA,OAAO,CAAEY,IAAT,KAAiB;AAAxC,oBACE,eAAC,oBAAD;AAAsB,MAAA,KAAK,EAAE,CAAAZ,OAAO,QAAP,YAAAA,OAAO,CAAEY,IAAT,KAAiB;AAA9C,oBACE,eAAC,QAAD,eACMD,IADN;AAEE,MAAA,aAAa,EAAEF,aAFjB;AAGE,MAAA,OAAO,EAAE,KAAKJ,qBAAL,EAHX;AAIE,MAAA,KAAK,EAAEN,KAAK,IAAI,KAAKK,KAAL,CAAWL,KAJ7B;AAKE,MAAA,QAAQ,EAAE,KAAKE;AALjB,qBAOE,eAAC,cAAD,CAAgB,QAAhB;AAAyB,MAAA,KAAK,EAAED,OAAO,IAAI;AAAEO,QAAAA,KAAK,EAAE,EAAT;AAAaM,QAAAA,IAAI,EAAE;AAAnB;AAA3C,oBACE,eAAC,yBAAD,QACGH,QADH,CADF,CAPF,CADF,CADF,CADF,CADF;AAqBD,G;;;EA5DqCtB,KAAK,CAAC0B,S;;AAAzBjB,U,CACZkB,Y,GAAe;AACpBC,EAAAA,QAAQ,EAAE,KADU;AAEpBV,EAAAA,QAFoB,oBAEXW,MAFW,EAEHC,UAFG,EAESC,IAFT,EAEe;AACjC,WAAOA,IAAI,EAAX;AACD,GAJmB;AAKpBC,EAAAA,OALoB,qBAKV,CAAG,CALO;AAMpBjB,EAAAA,QANoB,sBAMT,CAAG;AANM,C;SADHN,U","sourcesContent":["/**\n * @packageDocumentation\n * @module Provider\n */\nimport * as React from 'react';\nimport { LocaleProvider as WeUtilLocaleProvider } from '@ali/we-util';\nimport { LocaleProvider as DesignNextLocaleProvider } from '@ali/we-design-next';\n// 等待 we-ui 完全去除\nimport { LocaleProvider } from '@ali/we-ui';\nimport {\n  Controller,\n  Action,\n  Provider,\n  ProviderProps,\n  createPlaceholderPlugin,\n  Plugin,\n} from '@ali/4ever-cangjie';\nimport { PluginsContext, OldBiPlugins, ActiveInteractionProvider } from '@ali/4ever-component';\nimport { isPlaceholderVisible } from '@ali/4ever-utils';\n\n/**\n * 继承于编辑器内核的Props，由于TypeDoc限制，继承的选项没能在本页面显示：[「仓颉」Provider Props](https://pds.alibaba-inc.com/renquan.wrq/cangjie-beta-docs/interfaces/controller.providerprops.html)\n */\nexport interface BiProviderProps extends Omit<ProviderProps, 'plugins'> {\n  /**\n   * 插件集合\n   */\n  plugins?: OldBiPlugins & { lang?: string };\n  /**\n   * onAction回调\n   */\n  onAction?: (action: Action, controller: Controller, next: Function) => void;\n  /**\n   * onCatch回调\n   */\n  onCatch?: (error: Error) => void;\n}\n\n/**\n * 编辑器顶层Provider，提供编辑数据、插件、配置\n * @ignore\n */\nexport default class BiProvider extends React.Component<BiProviderProps> {\n  static defaultProps = {\n    readOnly: false,\n    onAction(action, controller, next) {\n      return next();\n    },\n    onCatch() { },\n    onChange() { },\n  };\n\n  state = {\n    value: null,\n  };\n\n  private plugins: Plugin[] | null = null;\n\n  private handleChange = change => {\n    const { onChange } = this.props;\n    onChange?.(change);\n  };\n\n  private resolveCangjiePlugins() {\n    if (!this.plugins) {\n      const { plugins, onAction } = this.props;\n      this.plugins = [\n        // @ts-ignore\n        createPlaceholderPlugin({\n          isPlaceholderVisible,\n        }),\n        { onAction },\n        ...(plugins?.array || []),\n      ];\n    }\n    return this.plugins!;\n  }\n\n  render() {\n    const { controllerRef, children, plugins, ...rest } = this.props;\n    const { value } = this.state;\n    return (\n      <DesignNextLocaleProvider value={plugins?.lang || 'zh-CN'}>\n        <LocaleProvider value={plugins?.lang || 'zh-CN'}>\n          <WeUtilLocaleProvider value={plugins?.lang || 'zh-CN'}>\n            <Provider\n              {...rest}\n              controllerRef={controllerRef}\n              plugins={this.resolveCangjiePlugins()}\n              value={value || this.props.value}\n              onChange={this.handleChange}\n            >\n              <PluginsContext.Provider value={plugins || { array: [], hash: {} }}>\n                <ActiveInteractionProvider>\n                  {children}\n                </ActiveInteractionProvider>\n              </PluginsContext.Provider>\n            </Provider>\n          </WeUtilLocaleProvider>\n        </LocaleProvider>\n      </DesignNextLocaleProvider>\n    );\n  }\n}\n"],"file":"provider.js"}