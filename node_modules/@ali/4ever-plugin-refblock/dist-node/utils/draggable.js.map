{"version":3,"sources":["../../../src/utils/draggable.tsx"],"names":["getRefBlockDragMenuItems","options","block","locale","value","disableNodeInRefBlock","onCopyAsRefBlock","onCopyRefBlock","item","type","TYPE_MENU_ITEM","title","copyAsRefBlock","icon","role","RefBlockRole","menuExtraKey","onClick","containsForbiddenItems","element","findDescendant","RefBlock","isRefBlock","refblock","document","getClosest","key","node","blocks","includes","fragment"],"mappings":";;;;;;;;;;;AAAA;;AAEA;;AACA;;AACA;;AACA;;AACA;;uBAL4B,a;;wBAkClB,eAAC,2BAAD,O;;AA3BV;AACA;AACA;AACA;AACA;AACO,SAASA,wBAAT,CAAkCC,OAAlC,EASJ;AACD,QAAM;AACJC,IAAAA,KADI;AAEJC,IAAAA,MAFI;AAGJC,IAAAA,KAHI;AAIJC,IAAAA,qBAJI;AAKJC,IAAAA,gBALI;AAMJC,IAAAA;AANI,MAOFN,OAPJ;AASA,QAAMO,IAAI,GAAG;AACXC,IAAAA,IAAI,EAAEC,6BADK;AAEXC,IAAAA,KAAK,EAAER,MAAM,EAAES,cAFJ;AAGXC,IAAAA,IAAI,MAHO;AAIXC,IAAAA,IAAI,EAAEC,mBAJK;AAKXC,IAAAA,YAAY,EAAE,gBALH;AAMXC,IAAAA,OAAO,EAAEX;AANE,GAAb;;AASA,WAASY,sBAAT,CAAgCC,OAAhC,EAAkD;AAChD,WAAO,CAAC,CAACA,OAAO,CAACC,cAAR,CAAuBf,qBAAvB,CAAT;AACD,GArBA,CAuBD;;;AACA,MAAIgB,gBAASC,UAAT,CAAoBpB,KAApB,CAAJ,EAAgC;AAC9B,WAAO,CACL,EACE,GAAGM,IADL;AAEES,MAAAA,OAAO,EAAE,MAAMV,cAAc,CAACL,KAAD;AAF/B,KADK,CAAP;AAMD,GA/BA,CAiCD;;;AACA,MAAI,yBAAaE,KAAb,EAAoBF,KAApB,CAAJ,EAAgC;AAC9B,UAAMqB,QAAQ,GAAGnB,KAAK,CAACoB,QAAN,CAAeC,UAAf,CAA0BvB,KAAK,CAACwB,GAAhC,EAAsCC,IAAD,IACpDN,gBAASC,UAAT,CAAoBK,IAApB,CADe,CAAjB;AAGA,WAAO,CACL,EACE,GAAGnB,IADL;AAEES,MAAAA,OAAO,EAAE,MAAMV,cAAc,CAACgB,QAAD;AAF/B,KADK,CAAP;AAMD;;AAED,MAAIlB,qBAAqB,CAACH,KAAD,CAArB,IAAgCgB,sBAAsB,CAAChB,KAAD,CAA1D,EAAmE;AACjE,WAAO,EAAP;AACD;;AAED,MACEE,KAAK,CAACwB,MAAN,CAAaC,QAAb,CAAsB3B,KAAtB,MACC,kCAAsBE,KAAtB,KAAgCc,sBAAsB,CAACd,KAAK,CAAC0B,QAAP,CADvD,CADF,EAGE;AACA,WAAO,EAAP;AACD;;AAED,SAAO,CAACtB,IAAD,CAAP;AACD","sourcesContent":["import * as React from 'react';\nimport { Block, Value, Node, Element } from '@ali/4ever-cangjie';\nimport { CopyblocklinkNormal } from '@ali/we-icon';\nimport { TYPE_MENU_ITEM } from '@ali/4ever-component';\nimport { isInRefBlock, isSelectionInRefBlock } from './logic';\nimport { RefBlockRole } from './roles';\nimport RefBlock from '../mo/models';\n\n/**\n * 获得引用块拖拽项目\n * @param options\n * @returns\n */\nexport function getRefBlockDragMenuItems(options: {\n  block: Block;\n  locale: Record<string, string>;\n  value: Value;\n  disableNodeInRefBlock: (node: Node) => boolean;\n  /** 复制为引用块 */\n  onCopyAsRefBlock: () => void;\n  /** 复制引用块 */\n  onCopyRefBlock: (block: RefBlock) => void;\n}) {\n  const {\n    block,\n    locale,\n    value,\n    disableNodeInRefBlock,\n    onCopyAsRefBlock,\n    onCopyRefBlock,\n  } = options;\n\n  const item = {\n    type: TYPE_MENU_ITEM,\n    title: locale?.copyAsRefBlock,\n    icon: <CopyblocklinkNormal />,\n    role: RefBlockRole,\n    menuExtraKey: 'copyAsRefBlock',\n    onClick: onCopyAsRefBlock,\n  };\n\n  function containsForbiddenItems(element: Element) {\n    return !!element.findDescendant(disableNodeInRefBlock);\n  }\n\n  // 如果当前 block 已经是引用块，则复制引用块自身\n  if (RefBlock.isRefBlock(block)) {\n    return [\n      {\n        ...item,\n        onClick: () => onCopyRefBlock(block),\n      },\n    ];\n  }\n\n  // 如果当前在引用块内部，则复制引用块自身\n  if (isInRefBlock(value, block)) {\n    const refblock = value.document.getClosest(block.key, (node) =>\n      RefBlock.isRefBlock(node),\n    )!;\n    return [\n      {\n        ...item,\n        onClick: () => onCopyRefBlock(refblock as RefBlock),\n      },\n    ];\n  }\n\n  if (disableNodeInRefBlock(block) || containsForbiddenItems(block)) {\n    return [];\n  }\n\n  if (\n    value.blocks.includes(block) &&\n    (isSelectionInRefBlock(value) || containsForbiddenItems(value.fragment))\n  ) {\n    return [];\n  }\n\n  return [item];\n}\n\nexport type RefBlockDraggableConfig = Record<string, any>;\n"],"file":"draggable.js"}