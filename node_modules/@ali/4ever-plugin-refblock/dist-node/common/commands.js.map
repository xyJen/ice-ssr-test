{"version":3,"sources":["../../../src/common/commands.ts"],"names":["setRefBlockInjection","controller","node","data","overwrite","injections","value","injection","find","inj","key","Injection","create","mergeData","Object","keys","excludeInjections","filter","setInjections","concat","flush","setRefBlockInjectionByKey","document","getNode","RefBlock","isRefBlock","command","setRefBlockInjectionByDocKey","docKey","forEachDescendant","commands"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AACA;;AAEA,SAASA,oBAAT,CACEC,UADF,EAEEC,IAFF,EAGEC,IAHF,EAIEC,SAJF,EAKE;AACA,QAAM;AAAEC,IAAAA;AAAF,MAAiBJ,UAAU,CAACK,KAAlC;AACA,MAAIC,SAAS,GAAGF,UAAU,CAACG,IAAX,CAAiBC,GAAD,IAASA,GAAG,CAACC,GAAJ,KAAYR,IAAI,CAACQ,GAA1C,CAAhB;AACAH,EAAAA,SAAS,GAAGI,uBAAUC,MAAV,CAAiB;AAC3BF,IAAAA,GAAG,EAAER,IAAI,CAACQ,GADiB;AAE3BP,IAAAA,IAAI,EAAEI,SAAS,GACXA,SAAS,CAACM,SAAV,CACEN,SAAS,CAACJ,IADZ,EAEEC,SAAS,GAAGD,IAAH,GAAU,kBAAKA,IAAL,EAAWW,MAAM,CAACC,IAAP,CAAYR,SAAS,CAACJ,IAAtB,CAAX,CAFrB,CADW,GAKXA;AAPuB,GAAjB,CAAZ;AASA,QAAMa,iBAAiB,GAAGX,UAAU,CAACY,MAAX,CAAmBR,GAAD,IAASA,GAAG,CAACC,GAAJ,KAAYR,IAAI,CAACQ,GAA5C,CAA1B;AACA,SAAOT,UAAU,CAACiB,aAAX,CAAyBF,iBAAiB,CAACG,MAAlB,CAAyBZ,SAAzB,CAAzB,EAA8Da,KAA9D,EAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASC,yBAAT,CACLpB,UADK,EAELS,GAFK,EAGLP,IAHK,EAILC,SAAS,GAAG,IAJP,EAKO;AACZ,QAAM;AAAEkB,IAAAA;AAAF,MAAerB,UAAU,CAACK,KAAhC;AACA,QAAMJ,IAAI,GAAGoB,QAAQ,CAACC,OAAT,CAAiBb,GAAjB,CAAb;;AACA,MAAI,CAACR,IAAD,IAAS,CAACsB,gBAASC,UAAT,CAAoBvB,IAApB,CAAd,EAAyC;AACvC,WAAOD,UAAP;AACD;;AACD,SAAOA,UAAU,CAACyB,OAAX,CAAmB1B,oBAAnB,EAAyCE,IAAzC,EAA+CC,IAA/C,EAAqDC,SAArD,CAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASuB,4BAAT,CACL1B,UADK,EAEL2B,MAFK,EAGLzB,IAHK,EAILC,SAAS,GAAG,IAJP,EAKL;AACA,QAAM;AAAEkB,IAAAA;AAAF,MAAerB,UAAU,CAACK,KAAhC;AACAgB,EAAAA,QAAQ,CAACO,iBAAT,CAA4B3B,IAAD,IAAU;AACnC,QAAIsB,gBAASC,UAAT,CAAoBvB,IAApB,KAA6BA,IAAI,CAACC,IAAL,CAAUyB,MAAV,KAAqBA,MAAtD,EAA8D;AAC5D3B,MAAAA,UAAU,CAACyB,OAAX,CAAmB1B,oBAAnB,EAAyCE,IAAzC,EAA+CC,IAA/C,EAAqDC,SAArD;AACD;AACF,GAJD;AAKA,SAAOH,UAAP;AACD;;AAEM,MAAM6B,QAAQ,GAAG;AACtBT,EAAAA,yBADsB;AAEtBM,EAAAA;AAFsB,CAAjB","sourcesContent":["import { Controller, Injection } from '@ali/4ever-cangjie';\nimport { omit } from 'lodash-es';\nimport RefBlock, { RefBlockInjectionData } from '../mo/models';\n\nfunction setRefBlockInjection(\n  controller: Controller,\n  node: RefBlock,\n  data: Partial<RefBlockInjectionData>,\n  overwrite: boolean,\n) {\n  const { injections } = controller.value;\n  let injection = injections.find((inj) => inj.key === node.key);\n  injection = Injection.create({\n    key: node.key,\n    data: injection\n      ? injection.mergeData(\n          injection.data,\n          overwrite ? data : omit(data, Object.keys(injection.data)),\n        )\n      : data,\n  });\n  const excludeInjections = injections.filter((inj) => inj.key !== node.key);\n  return controller.setInjections(excludeInjections.concat(injection)).flush();\n}\n\n/**\n * 根据节点 key 设置引用块加载态\n * @param controller\n * @param key\n * @param data\n * @param overwrite\n * @returns\n */\nexport function setRefBlockInjectionByKey(\n  controller: Controller,\n  key: string,\n  data: Partial<RefBlockInjectionData>,\n  overwrite = true,\n): Controller {\n  const { document } = controller.value;\n  const node = document.getNode(key);\n  if (!node || !RefBlock.isRefBlock(node)) {\n    return controller;\n  }\n  return controller.command(setRefBlockInjection, node, data, overwrite);\n}\n\n/**\n * 根据 doc key 设置应用块加载态\n * @param controller\n * @param docKey\n * @param data\n * @param overwrite\n */\nexport function setRefBlockInjectionByDocKey(\n  controller: Controller,\n  docKey: string,\n  data: Partial<RefBlockInjectionData>,\n  overwrite = true,\n) {\n  const { document } = controller.value;\n  document.forEachDescendant((node) => {\n    if (RefBlock.isRefBlock(node) && node.data.docKey === docKey) {\n      controller.command(setRefBlockInjection, node, data, overwrite);\n    }\n  });\n  return controller;\n}\n\nexport const commands = {\n  setRefBlockInjectionByKey,\n  setRefBlockInjectionByDocKey,\n}\n"],"file":"commands.js"}