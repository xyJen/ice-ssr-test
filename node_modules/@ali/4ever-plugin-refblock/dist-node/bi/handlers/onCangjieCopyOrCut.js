"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = onCangjieCopyOrCut;

var _everCangjie = require("@ali/4ever-cangjie");

var _ccp = require("../utils/ccp");

/* istanbul ignore file */
const {
  MIME_TYPES
} = _everCangjie.constants;

function onCangjieCopyOrCut(event, controller, next) {
  if (!event.clipboardData) {
    return next();
  }

  const rawFragment = event.clipboardData.getData(MIME_TYPES.FRAGMENT);

  if (!rawFragment) {
    return next();
  }

  const fragment = _everCangjie.transferUtils.decodeFragment(rawFragment);

  const newFragment = (0, _ccp.unwrapRefBlock)(fragment); // 没有对 fragment 产生变更，则意味着不含有引用块

  if (newFragment === fragment) {
    return next();
  }

  return next(event.setClipboardData(event.clipboardData.setData(MIME_TYPES.FRAGMENT, _everCangjie.transferUtils.encodeFragment(newFragment))));
}
//# sourceMappingURL=onCangjieCopyOrCut.js.map