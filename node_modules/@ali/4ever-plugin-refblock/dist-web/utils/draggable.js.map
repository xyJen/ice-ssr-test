{"version":3,"sources":["../../../src/utils/draggable.tsx"],"names":["React","CopyblocklinkNormal","TYPE_MENU_ITEM","isInRefBlock","isSelectionInRefBlock","RefBlockRole","RefBlock","getRefBlockDragMenuItems","options","block","locale","value","disableNodeInRefBlock","onCopyAsRefBlock","onCopyRefBlock","item","type","title","copyAsRefBlock","icon","role","menuExtraKey","onClick","containsForbiddenItems","element","findDescendant","isRefBlock","refblock","document","getClosest","key","node","blocks","includes","fragment"],"mappings":";AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;qBAC4B,a;AAC5B,SAASC,mBAAT,QAAoC,cAApC;AACA,SAASC,cAAT,QAA+B,sBAA/B;AACA,SAASC,YAAT,EAAuBC,qBAAvB;AACA,SAASC,YAAT;AACA,OAAOC,QAAP;AAEA;AACA;AACA;AACA;AACA;;wBAuBU,eAAC,mBAAD,O;;AAtBV,OAAO,SAASC,wBAAT,CAAkCC,OAAlC,EASJ;AAAA,MAECC,KAFD,GAQGD,OARH,CAECC,KAFD;AAAA,MAGCC,MAHD,GAQGF,OARH,CAGCE,MAHD;AAAA,MAICC,KAJD,GAQGH,OARH,CAICG,KAJD;AAAA,MAKCC,qBALD,GAQGJ,OARH,CAKCI,qBALD;AAAA,MAMCC,gBAND,GAQGL,OARH,CAMCK,gBAND;AAAA,MAOCC,cAPD,GAQGN,OARH,CAOCM,cAPD;AAUD,MAAMC,IAAI,GAAG;AACXC,IAAAA,IAAI,EAAEd,cADK;AAEXe,IAAAA,KAAK,EAAEP,MAAF,oBAAEA,MAAM,CAAEQ,cAFJ;AAGXC,IAAAA,IAAI,MAHO;AAIXC,IAAAA,IAAI,EAAEf,YAJK;AAKXgB,IAAAA,YAAY,EAAE,gBALH;AAMXC,IAAAA,OAAO,EAAET;AANE,GAAb;;AASA,WAASU,sBAAT,CAAgCC,OAAhC,EAAkD;AAChD,WAAO,CAAC,CAACA,OAAO,CAACC,cAAR,CAAuBb,qBAAvB,CAAT;AACD,GArBA,CAuBD;;;AACA,MAAIN,QAAQ,CAACoB,UAAT,CAAoBjB,KAApB,CAAJ,EAAgC;AAC9B,WAAO,cAEAM,IAFA;AAGHO,MAAAA,OAAO,EAAE;AAAA,eAAMR,cAAc,CAACL,KAAD,CAApB;AAAA;AAHN,OAAP;AAMD,GA/BA,CAiCD;;;AACA,MAAIN,YAAY,CAACQ,KAAD,EAAQF,KAAR,CAAhB,EAAgC;AAC9B,QAAMkB,QAAQ,GAAGhB,KAAK,CAACiB,QAAN,CAAeC,UAAf,CAA0BpB,KAAK,CAACqB,GAAhC,EAAqC,UAACC,IAAD;AAAA,aACpDzB,QAAQ,CAACoB,UAAT,CAAoBK,IAApB,CADoD;AAAA,KAArC,CAAjB;AAGA,WAAO,cAEAhB,IAFA;AAGHO,MAAAA,OAAO,EAAE;AAAA,eAAMR,cAAc,CAACa,QAAD,CAApB;AAAA;AAHN,OAAP;AAMD;;AAED,MAAIf,qBAAqB,CAACH,KAAD,CAArB,IAAgCc,sBAAsB,CAACd,KAAD,CAA1D,EAAmE;AACjE,WAAO,EAAP;AACD;;AAED,MACEE,KAAK,CAACqB,MAAN,CAAaC,QAAb,CAAsBxB,KAAtB,MACCL,qBAAqB,CAACO,KAAD,CAArB,IAAgCY,sBAAsB,CAACZ,KAAK,CAACuB,QAAP,CADvD,CADF,EAGE;AACA,WAAO,EAAP;AACD;;AAED,SAAO,CAACnB,IAAD,CAAP;AACD","sourcesContent":["import * as React from 'react';\nimport { Block, Value, Node, Element } from '@ali/4ever-cangjie';\nimport { CopyblocklinkNormal } from '@ali/we-icon';\nimport { TYPE_MENU_ITEM } from '@ali/4ever-component';\nimport { isInRefBlock, isSelectionInRefBlock } from './logic';\nimport { RefBlockRole } from './roles';\nimport RefBlock from '../mo/models';\n\n/**\n * 获得引用块拖拽项目\n * @param options\n * @returns\n */\nexport function getRefBlockDragMenuItems(options: {\n  block: Block;\n  locale: Record<string, string>;\n  value: Value;\n  disableNodeInRefBlock: (node: Node) => boolean;\n  /** 复制为引用块 */\n  onCopyAsRefBlock: () => void;\n  /** 复制引用块 */\n  onCopyRefBlock: (block: RefBlock) => void;\n}) {\n  const {\n    block,\n    locale,\n    value,\n    disableNodeInRefBlock,\n    onCopyAsRefBlock,\n    onCopyRefBlock,\n  } = options;\n\n  const item = {\n    type: TYPE_MENU_ITEM,\n    title: locale?.copyAsRefBlock,\n    icon: <CopyblocklinkNormal />,\n    role: RefBlockRole,\n    menuExtraKey: 'copyAsRefBlock',\n    onClick: onCopyAsRefBlock,\n  };\n\n  function containsForbiddenItems(element: Element) {\n    return !!element.findDescendant(disableNodeInRefBlock);\n  }\n\n  // 如果当前 block 已经是引用块，则复制引用块自身\n  if (RefBlock.isRefBlock(block)) {\n    return [\n      {\n        ...item,\n        onClick: () => onCopyRefBlock(block),\n      },\n    ];\n  }\n\n  // 如果当前在引用块内部，则复制引用块自身\n  if (isInRefBlock(value, block)) {\n    const refblock = value.document.getClosest(block.key, (node) =>\n      RefBlock.isRefBlock(node),\n    )!;\n    return [\n      {\n        ...item,\n        onClick: () => onCopyRefBlock(refblock as RefBlock),\n      },\n    ];\n  }\n\n  if (disableNodeInRefBlock(block) || containsForbiddenItems(block)) {\n    return [];\n  }\n\n  if (\n    value.blocks.includes(block) &&\n    (isSelectionInRefBlock(value) || containsForbiddenItems(value.fragment))\n  ) {\n    return [];\n  }\n\n  return [item];\n}\n\nexport type RefBlockDraggableConfig = Record<string, any>;\n"],"file":"draggable.js"}