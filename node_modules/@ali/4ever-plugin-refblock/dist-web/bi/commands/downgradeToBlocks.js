import { Commands, Path } from '@ali/4ever-cangjie';
import RefBlock from "../../mo/models";

function downgradeToBlocks(controller, node) {
  var document = controller.value.document;
  var path = document.assertPath(node.key);
  var parentPath = Path.parent(path);
  var refblockIndex = path[path.length - 1];
  controller.withoutNormalizing(function () {
    // 插入引用块内容
    node.nodes.forEach(function (child, index) {
      controller.command(Commands.insertNodeByPath, parentPath, refblockIndex + index, child);
    }); // 删除引用块

    controller.command(Commands.removeNodeByKey, node.key);
  });
  return controller;
}
/**
 * 降级为普通块
 * @param controller
 * @param docKey
 */


export function downgradeToBlocksByDocKey(controller, docKey) {
  var document = controller.value.document;
  document.forEachDescendant(function (node) {
    if (RefBlock.isRefBlock(node) && node.data.docKey === docKey) {
      controller.command(downgradeToBlocks, node);
    }
  });
  return controller;
}
/**
 * 降级对应节点 key 的块为普通块
 * @param controller
 * @param key
 */

export function downgradeToBlocksByKey(controller, key) {
  var document = controller.value.document;
  var node = document.assertNode(key);

  if (RefBlock.isRefBlock(node)) {
    return controller.command(downgradeToBlocks, node);
  }

  return controller;
}
//# sourceMappingURL=downgradeToBlocks.js.map