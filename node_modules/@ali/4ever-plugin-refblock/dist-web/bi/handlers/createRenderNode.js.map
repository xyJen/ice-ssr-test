{"version":3,"sources":["../../../../src/bi/handlers/createRenderNode.tsx"],"names":["React","message","RefBlock","RefBlockStatus","RefBlockComp","downgradeToBlocksByKey","createRenderNode","config","locale","toolbarAnimationDuration","enableToolbar","getReferenceList","getDocKey","detach","renderReadOnly","renderRefBlockInOtherStates","renderLoading","onRefBlockMounted","getDocURL","TYPE","props","controller","children","isSelected","node","status","data","loading","readOnly","child","detachRef","docKey","uuid","then","run","key","error","detachFailed","copyRefBlock","dispatch","value","selection","isCollapsed"],"mappings":"AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;qBAC4B,a;AAC5B,SAASC,OAAT,QAAwB,gBAAxB;AACA,OAAOC,QAAP,IAAmBC,cAAnB;AACA,OAAOC,YAAP;AAEA,SAASC,sBAAT;AAEA,eAAe,SAASC,gBAAT,CACbC,MADa,EAEb;AAAA;;AAAA,MAEEC,MAFF,GAaID,MAbJ,CAEEC,MAFF;AAAA,MAGEC,wBAHF,GAaIF,MAbJ,CAGEE,wBAHF;AAAA,MAIEC,aAJF,GAaIH,MAbJ,CAIEG,aAJF;AAAA,MAKEC,gBALF,GAaIJ,MAbJ,CAKEI,gBALF;AAAA,MAMEC,SANF,GAaIL,MAbJ,CAMEK,SANF;AAAA,MAOEC,MAPF,GAaIN,MAbJ,CAOEM,MAPF;AAAA,MAQEC,cARF,GAaIP,MAbJ,CAQEO,cARF;AAAA,MASEC,2BATF,GAaIR,MAbJ,CASEQ,2BATF;AAAA,MAUEC,aAVF,GAaIT,MAbJ,CAUES,aAVF;AAAA,MAWEC,iBAXF,GAaIV,MAbJ,CAWEU,iBAXF;AAAA,MAYEC,SAZF,GAaIX,MAbJ,CAYEW,SAZF;AAeA,yBACGhB,QAAQ,CAACiB,IADZ,IACmB,UAACC,KAAD,EAAyBC,UAAzB,EAAoD;AAAA,QAC3DC,QAD2D,GAClCF,KADkC,CAC3DE,QAD2D;AAAA,QACjDC,UADiD,GAClCH,KADkC,CACjDG,UADiD;AAEnE,QAAMC,IAAI,GAAGJ,KAAK,CAACI,IAAnB;AAEA,QAAMC,MAAM,GAAGD,IAAI,CAACE,IAAL,CAAUD,MAAV,IAAoBtB,cAAc,CAACwB,OAAlD;AAEA,QAAMC,QAAQ,GAAGH,MAAM,KAAKtB,cAAc,CAACyB,QAA3C;AACA,QAAMC,KAAK,GAAGD,QAAQ,GAAGd,cAAc,CAACM,KAAD,CAAjB,GAA2BE,QAAQ,EAAzD;;AAEA,QAAMQ,SAAS,GAAG,SAAZA,SAAY,CAACC,MAAD,EAAiBC,IAAjB,EAAkC;AAClD,aAAOnB,MAAM,CAACkB,MAAD,EAASC,IAAT,CAAN,CACJC,IADI,CACC,YAAM;AACVZ,QAAAA,UAAU,CAACa,GAAX,CAAe,UAAf,EAA2B7B,sBAAsB,CAACmB,IAAI,CAACW,GAAN,CAAjD;AACD,OAHI,WAIE,YAAM;AACXlC,QAAAA,OAAO,CAACmC,KAAR,CAAc5B,MAAM,CAAC6B,YAArB;AACD,OANI,CAAP;AAOD,KARD;;AAUA,QAAMC,YAAY,GAAG,SAAfA,YAAe,GAAM;AACzBjB,MAAAA,UAAU,CAACkB,QAAX,CAAoB,cAApB,EAAoCf,IAApC;AACD,KAFD;;AAIA,wBACE,eAAC,YAAD;AACE,MAAA,SAAS,EAAED,UAAU,IAAIF,UAAU,CAACmB,KAAX,CAAiBC,SAAjB,CAA2BC,WADtD;AAEE,MAAA,MAAM,EAAElC,MAFV;AAGE,MAAA,QAAQ,EAAEa,UAAU,CAACO,QAHvB;AAIE,MAAA,wBAAwB,EAAEnB,wBAJ5B;AAKE,MAAA,aAAa,EAAEC,aALjB;AAME,MAAA,gBAAgB,EAAEC,gBANpB;AAOE,MAAA,SAAS,EAAEC,SAPb;AAQE,MAAA,MAAM,EAAEkB,SARV;AASE,MAAA,WAAW,EAAEV,KATf;AAUE,MAAA,2BAA2B,EAAEL,2BAV/B;AAWE,MAAA,iBAAiB,EAAEE,iBAXrB;AAYE,MAAA,YAAY,EAAEqB,YAZhB;AAaE,MAAA,aAAa,EAAEtB,aAbjB;AAcE,MAAA,MAAM,EAAEE;AAdV,OAgBGW,KAhBH,CADF;AAoBD,GA5CH;AA8CD","sourcesContent":["import * as React from 'react';\nimport { Block, Controller, RenderNodeProps } from '@ali/4ever-cangjie';\nimport { message } from '@ali/we-design';\nimport RefBlock, { RefBlockStatus } from '../../mo/models';\nimport RefBlockComp from '../../components/RefBlock';\nimport type { BiConfig } from '../../utils/types';\nimport { downgradeToBlocksByKey } from '../actions';\n\nexport default function createRenderNode(\n  config: BiConfig,\n) {\n  const {\n    locale,\n    toolbarAnimationDuration,\n    enableToolbar,\n    getReferenceList,\n    getDocKey,\n    detach,\n    renderReadOnly,\n    renderRefBlockInOtherStates,\n    renderLoading,\n    onRefBlockMounted,\n    getDocURL,\n  } = config;\n\n  return {\n    [RefBlock.TYPE]: (props: RenderNodeProps, controller: Controller) => {\n      const { children, isSelected } = props;\n      const node = props.node as Block;\n\n      const status = node.data.status || RefBlockStatus.loading;\n\n      const readOnly = status === RefBlockStatus.readOnly;\n      const child = readOnly ? renderReadOnly(props) : children();\n\n      const detachRef = (docKey: string, uuid: string) => {\n        return detach(docKey, uuid)\n          .then(() => {\n            controller.run('onAction', downgradeToBlocksByKey(node.key));\n          })\n          .catch(() => {\n            message.error(locale.detachFailed);\n          });\n      };\n\n      const copyRefBlock = () => {\n        controller.dispatch('copyRefBlock', node)\n      };\n\n      return (\n        <RefBlockComp\n          isFocused={isSelected && controller.value.selection.isCollapsed}\n          locale={locale}\n          readOnly={controller.readOnly}\n          toolbarAnimationDuration={toolbarAnimationDuration}\n          enableToolbar={enableToolbar}\n          getReferenceList={getReferenceList}\n          getDocKey={getDocKey}\n          detach={detachRef}\n          renderProps={props}\n          renderRefBlockInOtherStates={renderRefBlockInOtherStates}\n          onRefBlockMounted={onRefBlockMounted}\n          copyRefBlock={copyRefBlock}\n          renderLoading={renderLoading}\n          getURL={getDocURL}\n        >\n          {child}\n        </RefBlockComp>\n      );\n    },\n  };\n}\n"],"file":"createRenderNode.js"}