{"version":3,"sources":["../../../../src/bi/handlers/onCangjieCopyOrCut.ts"],"names":["constants","transferUtils","unwrapRefBlock","MIME_TYPES","onCangjieCopyOrCut","event","controller","next","clipboardData","rawFragment","getData","FRAGMENT","fragment","decodeFragment","newFragment","setClipboardData","setData","encodeFragment"],"mappings":"AAAA;AACA,SAEEA,SAFF,EAGEC,aAHF,QAKO,oBALP;AAMA,SAASC,cAAT;IAEQC,U,GAAeH,S,CAAfG,U;AAER,eAAe,SAASC,kBAAT,CACbC,KADa,EAEbC,UAFa,EAGbC,IAHa,EAIb;AACA,MAAI,CAACF,KAAK,CAACG,aAAX,EAA0B;AACxB,WAAOD,IAAI,EAAX;AACD;;AAED,MAAME,WAAW,GAAGJ,KAAK,CAACG,aAAN,CAAoBE,OAApB,CAA4BP,UAAU,CAACQ,QAAvC,CAApB;;AAEA,MAAI,CAACF,WAAL,EAAkB;AAChB,WAAOF,IAAI,EAAX;AACD;;AAED,MAAMK,QAAQ,GAAGX,aAAa,CAACY,cAAd,CAA6BJ,WAA7B,CAAjB;AACA,MAAMK,WAAW,GAAGZ,cAAc,CAACU,QAAD,CAAlC,CAZA,CAcA;;AACA,MAAIE,WAAW,KAAKF,QAApB,EAA8B;AAC5B,WAAOL,IAAI,EAAX;AACD;;AAED,SAAOA,IAAI,CACTF,KAAK,CAACU,gBAAN,CACEV,KAAK,CAACG,aAAN,CAAoBQ,OAApB,CACEb,UAAU,CAACQ,QADb,EAEEV,aAAa,CAACgB,cAAd,CAA6BH,WAA7B,CAFF,CADF,CADS,CAAX;AAQD","sourcesContent":["/* istanbul ignore file */\nimport {\n  CangjieClipboardEvent,\n  constants,\n  transferUtils,\n  Controller,\n} from '@ali/4ever-cangjie';\nimport { unwrapRefBlock } from '../utils/ccp';\n\nconst { MIME_TYPES } = constants;\n\nexport default function onCangjieCopyOrCut(\n  event: CangjieClipboardEvent,\n  controller: Controller,\n  next,\n) {\n  if (!event.clipboardData) {\n    return next();\n  }\n\n  const rawFragment = event.clipboardData.getData(MIME_TYPES.FRAGMENT);\n\n  if (!rawFragment) {\n    return next();\n  }\n\n  const fragment = transferUtils.decodeFragment(rawFragment);\n  const newFragment = unwrapRefBlock(fragment);\n\n  // 没有对 fragment 产生变更，则意味着不含有引用块\n  if (newFragment === fragment) {\n    return next();\n  }\n\n  return next(\n    event.setClipboardData(\n      event.clipboardData.setData(\n        MIME_TYPES.FRAGMENT,\n        transferUtils.encodeFragment(newFragment),\n      ),\n    ),\n  );\n}\n"],"file":"onCangjieCopyOrCut.js"}