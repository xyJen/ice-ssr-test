import t from"@babel/runtime/helpers/extends";import{uuid as n,getTimeDiffSinceStart as e}from"@ali/we-logger-utils";var i;!function(t){t[t.SUM=0]="SUM",t[t.AVG=1]="AVG",t[t.API=2]="API",t[t.LOG=3]="LOG"}(i||(i={}));var r,a=i;!function(t){t[t.TRACE=0]="TRACE",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.FATAL=5]="FATAL"}(r||(r={}));var s=r,o=function(){function t(t){this._appender=void 0,this._enabled=!0,this._appender=t}var n=t.prototype;return n.getAppender=function(){return this._appender},n.isEnabled=function(){return this._enabled},n.disable=function(){this._enabled=!1},n.enable=function(){this._enabled=!0},n.setBaseInfo=function(t){try{this._appender.setBaseInfo(t)}catch(t){}},n.sum=function(t){if(this._enabled)try{if(this._appender.ignore(a[a.SUM],{key:t}))return;this._appender.sum(t)}catch(t){}},n.avg=function(t,n){if(this._enabled)try{if(this._appender.ignore(a[a.AVG],{key:t}))return;this._appender.avg(t,n)}catch(t){}},n.log=function(t,n,e){if(this._enabled)try{if(this._appender.ignore(a[a.LOG],{"log-level":s[t],"log-category":n,content:e}))return;this._appender.log(t,n,e)}catch(t){}},n.api=function(t){if(this._enabled)try{if(this._appender.ignore(a[a.API],t))return;this._appender.api(t)}catch(t){}},t}(),h=function(){function i(){this._traceId=void 0,this._enabled=!0,this._times={},this._baseInfo={},this._appenders=[],this.refreshTraceId()}var r=i.prototype;return r.getTraceId=function(){return this._traceId},r.refreshTraceId=function(t){return void 0===t&&(t=n().substring(0,8)),this._traceId=t,this.setBaseInfo({trace_id:this._traceId}),this._traceId},r.isEnabled=function(){return this._enabled},r.enable=function(){this._enabled=!0},r.disable=function(){this._enabled=!1},r.getBaseInfo=function(){return this._baseInfo},r.getAppenders=function(){return this._appenders},r.append=function(t){var n=new o(t);try{n.setBaseInfo(this._baseInfo)}catch(t){}return this._appenders.push(n),this},r.remove=function(t){return this._appenders=this._appenders.filter((function(n){return n.getAppender()!==t})),this},r.setBaseInfo=function(n){var e=this;this._baseInfo=t({},this._baseInfo,n),this._appenders.forEach((function(t){try{t.setBaseInfo(e._baseInfo)}catch(t){}}))},r.time=function(t,n){this.timeStart(t);try{n()}finally{this.timeEnd(t)}},r.timeStart=function(t){this._times[t]=Date.now()},r.timeEnd=function(t){var n=Date.now();this._times[t]&&n>=this._times[t]&&this.avg(t,n-this._times[t]),delete this._times[t]},r.perf=function(t,n){void 0===n&&(n=e()),this.avg(t,n)},r.count=function(t){this.sum(t)},r.sum=function(t){this.isEnabled()&&this._appenders.forEach((function(n){try{n.sum(t)}catch(t){}}))},r.avg=function(t,n){void 0===n&&(n=0),this.isEnabled()&&this._appenders.forEach((function(e){try{e.avg(t,n)}catch(t){}}))},r.error=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];this.logWithLevel.apply(this,[s.ERROR].concat(n))},r.fatal=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];this.logWithLevel.apply(this,[s.FATAL].concat(n))},r.warn=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];this.logWithLevel.apply(this,[s.WARN].concat(n))},r.info=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];this.logWithLevel.apply(this,[s.INFO].concat(n))},r.log=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];this.logWithLevel.apply(this,[s.INFO].concat(n))},r.debug=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];this.logWithLevel.apply(this,[s.DEBUG].concat(n))},r.trace=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];this.logWithLevel.apply(this,[s.TRACE].concat(n))},r.logWithLevel=function(t){for(var n=arguments.length,e=new Array(n>1?n-1:0),i=1;i<n;i++)e[i-1]=arguments[i];if(this.isEnabled()&&e&&0!==e.length){var r,a="default";2===e.length?(a=String(e[0]),r=e[1]):1===e.length&&(r=e[0]),this._appenders.forEach((function(n){try{n.log(t,a,r)}catch(t){}}))}},r.api=function(t){this.isEnabled()&&this._appenders.forEach((function(n){try{n.api(t)}catch(t){}}))},i}(),c=function(){function t(){}var n=t.prototype;return n.ignore=function(t,n){return!1},n.setBaseInfo=function(t){},n.sum=function(t){},n.avg=function(t,n){},n.log=function(t,n,e){},n.api=function(t){},t}();export default h;export{a as Action,s as Level,c as NoopAppender};
