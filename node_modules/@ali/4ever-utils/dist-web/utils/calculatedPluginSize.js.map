{"version":3,"sources":["../../../src/utils/calculatedPluginSize.tsx"],"names":["ReactDOM","calculatedPluginSize","node","containerWidth","currentElement","Promise","resolve","body","window","document","root","closest","querySelector","div","createElement","style","width","appendChild","render","target","firstElementChild","display","offsetWidth","height","offsetHeight","remove"],"mappings":";;AACA,OAAOA,QAAP,MAAqB,WAArB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAMC,oBAAoB;AAAA,sEAAG,iBAC3BC,IAD2B,EAE3BC,cAF2B,EAG3BC,cAH2B;AAAA;AAAA;AAAA;AAAA;AAAA,6CAKpB,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAa;AAAA,kBACtBC,IADsB,GACbC,MAAM,CAACC,QADM,CACtBF,IADsB;AAE9B,kBAAMG,IAAI,GAAG,CAAAN,cAAc,QAAd,YAAAA,cAAc,CAAEO,OAAhB,CAAwB,2BAAxB,MACXJ,IAAI,CAACK,aAAL,CAAmB,2BAAnB,CADW,IAEXL,IAFF;AAGA,kBAAMM,GAAG,GAAGL,MAAM,CAACC,QAAP,CAAgBK,aAAhB,CAA8B,KAA9B,CAAZ;AACAD,cAAAA,GAAG,CAACE,KAAJ,CAAUC,KAAV,GAAkB,CAAC,OAAOb,cAAP,KAA0B,QAA1B,GAAwCA,cAAxC,UAA6DA,cAA9D,KAAiF,EAAnG;AACAO,cAAAA,IAAI,CAACO,WAAL,CAAiBJ,GAAjB;AACAb,cAAAA,QAAQ,CAACkB,MAAT,CAAgBhB,IAAhB,EAAsBW,GAAtB,EAA2B,YAAM;AAC/B,oBAAIM,MAAM,GAAGN,GAAG,CAACO,iBAAjB;;AACA,oBAAI,CAACD,MAAL,EAAa;AACXA,kBAAAA,MAAM,GAAGN,GAAT;AACAM,kBAAAA,MAAM,CAACJ,KAAP,CAAaM,OAAb,GAAuB,QAAvB;AACD;;AACD,oBAAML,KAAK,GAAGG,MAAM,CAACG,WAArB;AACA,oBAAMC,MAAM,GAAGJ,MAAM,CAACK,YAAtB;AACAX,gBAAAA,GAAG,CAACY,MAAJ;AACA,uBAAOnB,OAAO,CAAC;AAAEU,kBAAAA,KAAK,EAALA,KAAF;AAASO,kBAAAA,MAAM,EAANA;AAAT,iBAAD,CAAd;AACD,eAVD;AAWD,aAnBM,CALoB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAApBtB,oBAAoB;AAAA;AAAA;AAAA,GAA1B;;AA2BA,eAAeA,oBAAf","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\n\n/**\n * 计算插件宽高\n * Tips: ReactDOM.render 在无其他 render 任务时会同步执行，有其他 render 时会变成异步方法\n * @param node 实例\n * @param containerWidth 容器宽度（eg: 取值兼容 pc 端容器宽度）\n * @param currentElement 当前实例渲染节点（查找仓颉父容器）\n */\nconst calculatedPluginSize = async (\n  node: React.ReactElement,\n  containerWidth?: number | string,\n  currentElement?: HTMLElement,\n): Promise<{ width: number; height: number }> => {\n  return new Promise((resolve) => {\n    const { body } = window.document;\n    const root = currentElement?.closest('div[data-cangjie-content]') ||\n      body.querySelector('div[data-cangjie-content]') ||\n      body;\n    const div = window.document.createElement('div') as HTMLElement;\n    div.style.width = (typeof containerWidth === 'number' ? `${containerWidth}px` : containerWidth) || '';\n    root.appendChild(div);\n    ReactDOM.render(node, div, () => {\n      let target = div.firstElementChild as HTMLElement | null;\n      if (!target) {\n        target = div;\n        target.style.display = 'inline';\n      }\n      const width = target.offsetWidth;\n      const height = target.offsetHeight;\n      div.remove();\n      return resolve({ width, height });\n    });\n  });\n};\n\nexport default calculatedPluginSize;\n"],"file":"calculatedPluginSize.js"}