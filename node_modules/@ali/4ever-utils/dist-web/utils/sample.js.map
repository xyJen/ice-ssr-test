{"version":3,"sources":["../../../src/utils/sample.ts"],"names":["sample","fn","options","divisor","threshold","_sample","Math","random","args","apply","Sample","deco","target","propertyKey","descriptor","value","TypeError","String"],"mappings":";;AAQA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASA,MAAT,CAAoCC,EAApC,EAA2CC,OAA3C,EAAsE;AAAA,MAC3DC,OAD2D,GAC/CD,OAD+C,CACnEF,MADmE;AAE3E,MAAMI,SAAS,GAAG,IAAID,OAAtB;AACA,SAAO,SAASE,OAAT,GAA0C;AAC/C,QAAIC,IAAI,CAACC,MAAL,KAAgBH,SAApB,EAA+B;AAAA,wCADKI,IACL;AADKA,QAAAA,IACL;AAAA;;AAC7BP,MAAAA,EAAE,CAACQ,KAAH,CAAS,IAAT,EAAeD,IAAf;AACD;AACF,GAJD;AAKD;AAED;AACA;AACA;AACA;;AACA,OAAO,SAASE,MAAT,CAAgBR,OAAhB,EAAyD;AAC9D,SAAO,SAASS,IAAT,CACLC,MADK,EAELC,WAFK,EAGLC,UAHK,EAIuB;AAC5B,QAAI,CAACA,UAAD,IAAgB,OAAOA,UAAU,CAACC,KAAlB,KAA4B,UAAhD,EAA6D;AAC3D,YAAM,IAAIC,SAAJ,mDAA8DC,MAAM,CAACJ,WAAD,CAApE,wBAAN;AACD;;AACD,wBACKC,UADL;AAEEC,MAAAA,KAAK,EAAEf,MAAM,CAACc,UAAU,CAACC,KAAZ,EAAmBb,OAAnB;AAFf;AAID,GAZD;AAaD","sourcesContent":["\nexport interface SampleOptions {\n  /**\n   * 采样除数，采样率为 1/sample\n   */\n  sample: number;\n}\n\n/**\n * 装饰函数对齐进行采样\n * @param fn 采样函数\n * @param options 采样配置\n */\nexport function sample<T extends Function>(fn: T, options: SampleOptions): T {\n  const { sample: divisor } = options;\n  const threshold = 1 / divisor;\n  return function _sample(this: any, ...args: any) {\n    if (Math.random() < threshold) {\n      fn.apply(this, args);\n    }\n  } as unknown as T;\n}\n\n/**\n * 函数采样装饰器\n * @param options\n */\nexport function Sample(options: SampleOptions): MethodDecorator {\n  return function deco<F>(\n    target: object,\n    propertyKey: string | symbol,\n    descriptor: TypedPropertyDescriptor<F>,\n  ): TypedPropertyDescriptor<F> {\n    if (!descriptor || (typeof descriptor.value !== 'function')) {\n      throw new TypeError(`Only methods can be decorated with @Sample. <${String(propertyKey)}> is not a method!`);\n    }\n    return {\n      ...descriptor,\n      value: sample(descriptor.value, options) as any,\n    };\n  };\n}\n"],"file":"sample.js"}