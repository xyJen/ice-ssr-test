{"version":3,"sources":["../../../src/heading/group.ts"],"names":["generateHeadingGroupType","type","generateHeadingGroupKey","key","defaultPass","groupHeading","start","end","parent","until","pass","first","nodes","i","node","children","slice","result","Block","create","data","remainedRange"],"mappings":";;;;;;;;;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACO,SAASA,wBAAT,CAAkCC,IAAlC,EAAwD;AAC7D,SAAQ,GAAEA,IAAK,QAAf;AACD;AAED;AACA;AACA;AACA;AACA;;;AACO,SAASC,uBAAT,CAAiCC,GAAjC,EAAsD;AAC3D,SAAQ,GAAEA,GAAI,QAAd;AACD;;AAED,SAASC,WAAT,GAAuB;AACrB,SAAO,KAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASC,YAAT,CACL,CAACC,KAAD,EAAQC,GAAR,CADK,EAELC,MAFK,EAGLP,IAHK,EAILQ,KAJK,EAKLC,IAA8B,GAAGN,WAL5B,EAMuC;AAC5C,QAAMO,KAAK,GAAGH,MAAM,CAACI,KAAP,CAAaN,KAAb,CAAd;AACA,MAAIO,CAAC,GAAGP,KAAK,GAAG,CAAhB;;AACA,SAAOO,CAAC,GAAGN,GAAX,EAAgB;AACd,UAAMO,IAAI,GAAGN,MAAM,CAACI,KAAP,CAAaC,CAAb,CAAb;;AACA,QAAIJ,KAAK,CAACK,IAAD,EAAgBH,KAAhB,CAAL,IAA+B,CAACD,IAAI,CAACI,IAAD,CAAxC,EAAyD;AACvD;AACD;;AACDD,IAAAA,CAAC,IAAI,CAAL;AACD;;AAED,QAAME,QAAQ,GAAGP,MAAM,CAACI,KAAP,CAAaI,KAAb,CAAmBV,KAAnB,EAA0BO,CAA1B,CAAjB;;AAEA,QAAMI,MAAM,GAAGC,mBAAMC,MAAN,CAAa;AAC1BlB,IAAAA,IAAI,EAAED,wBAAwB,CAACC,IAAD,CADJ;AAE1BmB,IAAAA,IAAI,EAAET,KAAK,CAACS,IAFc;AAG1BjB,IAAAA,GAAG,EAAED,uBAAuB,CAACS,KAAK,CAACR,GAAP,CAHF;AAI1BS,IAAAA,KAAK,EAAEG;AAJmB,GAAb,CAAf;;AAOA,SAAO;AACLD,IAAAA,IAAI,EAAEG,MADD;AAELI,IAAAA,aAAa,EAAE,CAACR,CAAD,EAAIN,GAAJ;AAFV,GAAP;AAID","sourcesContent":["import { Block, Document, Plugin } from \"@ali/4ever-cangjie\";\n\n/**\n * 生成 group type\n * @param type\n * @returns\n */\nexport function generateHeadingGroupType(type: string): string {\n  return `${type}-group`;\n}\n\n/**\n * 生成 group key\n * @param key\n * @returns\n */\nexport function generateHeadingGroupKey(key: string): string {\n  return `${key}-group`;\n}\n\nfunction defaultPass() {\n  return false;\n}\n\n/**\n * 聚合一组节点\n * @param nodes 节点组\n * @param type group type\n * @param until 停止 group 条件\n * @param pass 跳过节点\n * @returns\n */\nexport function groupHeading(\n  [start, end]: [number, number],\n  parent: Document | Block,\n  type: string,\n  until: (node: Block, first: Block) => boolean,\n  pass: (node: Block) => boolean = defaultPass,\n): ReturnType<Required<Plugin>['groupNodes']> {\n  const first = parent.nodes[start] as Block;\n  let i = start + 1;\n  while (i < end) {\n    const node = parent.nodes[i];\n    if (until(node as Block, first) && !pass(node as Block)) {\n      break;\n    }\n    i += 1;\n  }\n\n  const children = parent.nodes.slice(start, i);\n\n  const result = Block.create({\n    type: generateHeadingGroupType(type),\n    data: first.data,\n    key: generateHeadingGroupKey(first.key),\n    nodes: children,\n  });\n\n  return {\n    node: result,\n    remainedRange: [i, end],\n  };\n}\n"],"file":"group.js"}