{"version":3,"sources":["../../../../src/utils/formats/underline.ts"],"names":["UL_CSS_MAP","dash","single","wave","strAppend","prev","current","addWebkitPrefix","style","Object","keys","forEach","key","test","k","toUpperCase","slice","setTextDecotation","type","mark","value","color","data","underlineStyle","textDecorationStyle","textDecorationLine","textDecorationColor","environment","IS_ANDROID","textUnderlinePosition"],"mappings":";;;;;;;AACA;;AADA;AAIA,MAAMA,UAAU,GAAG;AACjBC,EAAAA,IAAI,EAAE,QADW;AAEjBC,EAAAA,MAAM,EAAE,OAFS;AAGjBC,EAAAA,IAAI,EAAE;AAHW,CAAnB;;AAMA,SAASC,SAAT,CAAmBC,IAAnB,EAAyBC,OAAzB,EAAkC;AAChC,SAAOD,IAAI,GAAI,GAAEA,IAAK,IAAGC,OAAQ,EAAtB,GAA0BA,OAArC;AACD;;AAED,SAASC,eAAT,CAAyBC,KAAzB,EAAqD;AACnDC,EAAAA,MAAM,CAACC,IAAP,CAAYF,KAAZ,EAAmBG,OAAnB,CAA4BC,GAAD,IAAS;AAClC,QAAI,iCAAiCC,IAAjC,CAAsCD,GAAtC,CAAJ,EAAgD;AAC9C,YAAME,CAAC,GAAI,SAAQF,GAAG,CAAC,CAAD,CAAH,CAAOG,WAAP,EAAqB,GAAEH,GAAG,CAACI,KAAJ,CAAU,CAAV,CAAa,EAAvD;AACAR,MAAAA,KAAK,CAACM,CAAD,CAAL,GAAWN,KAAK,CAACI,GAAD,CAAhB;AACD;AACF,GALD;AAMD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASK,iBAAT,CAA2BT,KAA3B,EAAuDU,IAAvD,EAAqEC,IAArE,EAAiF;AAC/E,MAAID,IAAI,KAAK,WAAb,EAA0B;AACxB;AACA,UAAM;AAAEE,MAAAA,KAAK,GAAG,QAAV;AAAoBC,MAAAA;AAApB,QAA+BF,IAAI,CAACG,IAAL,IAAa,EAAlD;AACA,UAAMC,cAAc,GAAGvB,UAAU,CAACoB,KAAD,CAAV,IAAqBA,KAA5C,CAHwB,CAIxB;;AACA,QAAI,CAACG,cAAD,IAAmBA,cAAc,KAAK,MAA1C,EAAkD,OAL1B,CAOxB;;AACAf,IAAAA,KAAK,CAACgB,mBAAN,GAA4BD,cAA5B;AACAf,IAAAA,KAAK,CAACiB,kBAAN,GAA2BrB,SAAS,CAACI,KAAK,CAACiB,kBAAP,EAA2B,WAA3B,CAApC;;AAEA,QAAIJ,KAAJ,EAAW;AACTb,MAAAA,KAAK,CAACkB,mBAAN,GAA4BL,KAA5B;AACD,KAbuB,CAcxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,QAAI,CAACM,yBAAYC,UAAjB,EAA6B;AAC3BpB,MAAAA,KAAK,CAACqB,qBAAN,GAA8B,OAA9B;AACD;;AACD,WAAOtB,eAAe,CAACC,KAAD,CAAtB;AACD;;AAED,MAAIU,IAAI,KAAK,QAAT,IAAqBC,IAAI,CAACG,IAAL,EAAWF,KAAX,KAAqB,KAA9C,EAAqD;AACnDZ,IAAAA,KAAK,CAACiB,kBAAN,GAA2BrB,SAAS,CAACI,KAAK,CAACiB,kBAAP,EAA2B,cAA3B,CAApC;AACA,WAAOlB,eAAe,CAACC,KAAD,CAAtB;AACD;;AAED,MAAIU,IAAI,KAAK,SAAT,IAAsBC,IAAI,CAACG,IAAL,EAAWF,KAAX,KAAqB,KAA/C,EAAsD;AACpD,QAAI,CAACZ,KAAK,CAACgB,mBAAX,EAAgC;AAC9B;AACAhB,MAAAA,KAAK,CAACgB,mBAAN,GAA4B,QAA5B;AACD;;AACDhB,IAAAA,KAAK,CAACiB,kBAAN,GAA2BrB,SAAS,CAACI,KAAK,CAACiB,kBAAP,EAA2B,cAA3B,CAApC;AACA,WAAOlB,eAAe,CAACC,KAAD,CAAtB;AACD;AACF;;eAEc;AACbS,EAAAA;AADa,C","sourcesContent":["/* eslint-disable no-param-reassign */\nimport { environment, Mark } from '@ali/4ever-cangjie';\nimport type { UnderlineData } from '../modelData';\n\nconst UL_CSS_MAP = {\n  dash: 'dashed',\n  single: 'solid',\n  wave: 'wavy',\n};\n\nfunction strAppend(prev, current) {\n  return prev ? `${prev} ${current}` : current;\n}\n\nfunction addWebkitPrefix(style: React.CSSProperties) {\n  Object.keys(style).forEach((key) => {\n    if (/^textDecoration|^textUnderline/.test(key)) {\n      const k = `Webkit${key[0].toUpperCase()}${key.slice(1)}`;\n      style[k] = style[key];\n    }\n  });\n}\n\n/**\n * 设置 CSS 文字修饰\n * textDecorationStyle 只允许一个值，因此 underline 和 双删除线无法共存\n * @param style\n * @param type\n * @param underline\n */\nfunction setTextDecotation(style: React.CSSProperties, type: string, mark: Mark) {\n  if (type === 'underline') {\n    // 兼容 mark = {type: 'underline'} 的生成方式\n    const { value = 'single', color } = (mark.data || {}) as UnderlineData;\n    const underlineStyle = UL_CSS_MAP[value] || value;\n    // 跳过不支持的样式\n    if (!underlineStyle || underlineStyle === 'none') return;\n\n    // 下划线优先级更高：直接覆盖 textDecorationStyle\n    style.textDecorationStyle = underlineStyle;\n    style.textDecorationLine = strAppend(style.textDecorationLine, 'underline');\n\n    if (color) {\n      style.textDecorationColor = color;\n    }\n    // BACKGROUND: \n    //   https://aone.alibaba-inc.com/v2/bug/35006381# 《【0615文字bvt】文本设置样式后取消下划线重新设置异常》\n    //   Android 下有时候会出现取消下划线时仍渲染下划线的情况。\n    //   但实际上代码确实是正确的，当出现问题后又触发重新渲染（例如取消选区、增大字号等操作），则奇怪的下划线就会消失。\n    //   通过注释下面的样式，问题消失。\n    // HOW:\n    //   这里暂时通过让 Android 下不使用 textUnderlinePosition 这个属性来避免\n    //   后续可以评估下通过类似 boxShadow: '0 1px' 等方式来实现下划线效果是否可行\n    if (!environment.IS_ANDROID) {\n      style.textUnderlinePosition = 'under';\n    }\n    return addWebkitPrefix(style);\n  }\n\n  if (type === 'strike' && mark.data?.value !== false) {\n    style.textDecorationLine = strAppend(style.textDecorationLine, 'line-through');\n    return addWebkitPrefix(style);\n  }\n\n  if (type === 'dstrike' && mark.data?.value !== false) {\n    if (!style.textDecorationStyle) {\n      // 优先级低于 underline：仅在没有设置 textDecorationStyle (没有下划线）的情况下设置\n      style.textDecorationStyle = 'double';\n    }\n    style.textDecorationLine = strAppend(style.textDecorationLine, 'line-through');\n    return addWebkitPrefix(style);\n  }\n}\n\nexport default {\n  setTextDecotation,\n};\n"],"file":"underline.js"}