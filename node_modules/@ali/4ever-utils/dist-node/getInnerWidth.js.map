{"version":3,"sources":["../../src/getInnerWidth.ts"],"names":["isList","node","data","list","isOrderedList","isOrdered","isTaskList","isUnorderedList","getInnerWidth","root","domNode","domUtils","findDOMNode","key","e","getInnerWidthFromDOM","getInnerFullWidth","document","innerWidth","parentNode","getParent","parentWidth","getAttribute","childNodes","computedStyle","window","getComputedStyle","offsetWidth","paddingLeft","parseInt","paddingRight","width"],"mappings":"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","sourcesContent":["import { Document, Element, domUtils, Block } from '@ali/4ever-cangjie';\n\nexport const isList = (node: Block | null) => !!node?.data?.list;\nexport const isOrderedList = (node: Block) => !!node.data?.list?.isOrdered;\nexport const isTaskList = (node: Block) => node.data?.list && !node.data.list.isOrdered && node.data.list.isTaskList;\nexport const isUnorderedList = (node: Block) => node.data?.list && !isOrderedList(node) && !isTaskList(node);\n\nexport function getInnerWidth(node: Element | null, root?: globalThis.Element): number | null {\n  if (!node) {\n    return null;\n  }\n  let domNode: HTMLElement | null = null;\n\n  // HACK: 排版模式通过key-0获取dom元素\n  try {\n    domNode = domUtils.findDOMNode(node.key, root) as HTMLElement;\n  } catch (e) {\n    // do nothing\n  }\n\n  if (!domNode) {\n    try {\n      domNode = domUtils.findDOMNode(`${node.key}-0`, root) as HTMLElement;\n    } catch (e) {\n      // do nothing\n    }\n  }\n\n  if (!domNode) {\n    return null;\n  }\n  return getInnerWidthFromDOM(domNode);\n}\n\n// 获取内部撑开的宽度，主要处理依赖父元素宽度切默认宽度是 100% 的节点(如图片、表格)\nexport function getInnerFullWidth(\n  node: Element | null,\n  document: Document,\n  root?: globalThis.Element,\n): number | null {\n  if (!node) return null;\n  let innerWidth = getInnerWidth(node, root);\n  if (isOrderedList(node as Block) || isUnorderedList(node as Block)) {\n    const parentNode = document.getParent(node.key);\n    if (parentNode) {\n      const parentWidth = getInnerWidth(parentNode, root);\n      // 列表节点在无内容时宽度为零，则宽度以它的父节点为准\n      // 内容为空时，由于 placeholder 存在，所以 inner width 不为 0，但是未被完全撑开\n      if (innerWidth === 0 || (innerWidth || 0) < (parentWidth || 0)) {\n        innerWidth = parentWidth;\n      }\n    }\n    return innerWidth;\n  }\n  if (innerWidth === 0) {\n    const parentNode = document.getParent(node.key);\n    if (!parentNode) return null;\n    innerWidth = getInnerWidth(parentNode, root);\n  }\n  return innerWidth;\n}\n\nexport function getInnerWidthFromDOM(domNode: HTMLElement) {\n  // TODO: 排版模式下 document 节点的宽度计算偏大，会导致空列表中插入的图片尺寸偏大溢出\n  if (domNode.getAttribute('data-type') === 'page') {\n    domNode = domNode.childNodes[0] as HTMLElement;\n  }\n\n  const computedStyle = window.getComputedStyle(domNode, null);\n  const offsetWidth = domNode.offsetWidth;\n  const paddingLeft = parseInt(computedStyle[\"padding-left\"], 10) || 0;\n  const paddingRight = parseInt(computedStyle[\"padding-right\"], 10) || 0;\n  const width = offsetWidth - paddingLeft - paddingRight;\n  return width;\n}\n"],"file":"getInnerWidth.js"}