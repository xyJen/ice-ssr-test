{"version":3,"sources":["../../../src/type/migrations.ts"],"names":["MigrateErrorCode"],"mappings":";;;;;;IA0BYA,gB;;;WAAAA,gB;AAAAA,EAAAA,gB,CAAAA,gB;AAAAA,EAAAA,gB,CAAAA,gB;GAAAA,gB,gCAAAA,gB","sourcesContent":["import type { JsonML, Document } from '@ali/4ever-cangjie';\n\nexport interface BaseMigration<T extends Function = any> {\n  /** prev model version */\n  prevVersion: number;\n  /** next model version */\n  nextVersion: number;\n  /** upgrade model */\n  upgrade: T;\n  /** downgrade model */\n  downgrade: T;\n}\n\ntype MigrateFunc = (m: Document) => Document;\n\nexport type BaseCorrection<T = any> = (model: any) => T;\n\nexport type Migration = BaseMigration<MigrateFunc>;\n\nexport type Correction = BaseCorrection<JsonML>;\n\nexport type MigrateAlg = {\n  upgrade: MigrateFunc;\n  downgrade: MigrateFunc;\n};\n\nexport enum MigrateErrorCode {\n  /** 未知错误 */\n  Unknown = 0,\n  /** 缺少迁移脚本 */\n  MissingMigration = 1,\n}\n\nexport interface MigrateError {\n  /** 迁移错误码 */\n  code: MigrateErrorCode;\n  /** 错误消息 */\n  message: string;\n}\n\nexport interface BaseMigrateOptions<\n  M extends BaseMigration,\n  C extends BaseCorrection,\n> {\n  /** 迁移源 */\n  src: any;\n  /** 自定义迁移脚本，默认为当前 Package 导出的迁移脚本 */\n  migrations?: M[];\n  /** 自定义矫正脚本，默认为当前 Package 导出的矫正脚本 */\n  corrections?: C[];\n  /** 迁移到的目标版本，默认为当前 Package 声明的版本 */\n  targetVersion?: number;\n  /** 错误回调 */\n  onError?: (e: MigrateError) => void;\n}\n\nexport type MigrateOptions = BaseMigrateOptions<Migration, Correction>;\n"],"file":"migrations.js"}