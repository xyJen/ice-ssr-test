## 介绍
* 向剪切板写入不同 `Mime Type` 的数据
* 兼容 Android、mac、win、iOS 10.x 以上版本
* 简化向剪切板写入数据


## 安装

```
tnpm install @ali/clipboard-manager
```

## 用法

```jsx
import ClipboardManager from '@ali/clipboard-manager';

const Button: React.FC<> = () => {
  const clip = ClipboardManager.create();

  const onCopy = React.useCallback(() => {
    clip.write({
      ['text/html']: '<div>html 内容</div>'，
      ['text/plain']: '文本内容',
      ['application/custom']: '自定义 mime type 的内容'
    })
  }, [])
  return <button onClick={onCopy}>copy</button>
}
```

**创建实例对象**
```jsx

new ClipboardManager({
  // 支持监听 copy、cut 两种事件
  action,

  // 触发 copy 事件的 input、textarea 或 contentEditable 为 true 的 div 节点
  fakeElem,
  
  // 插入 fakeElem 的容器节点
  container,
})
```

**写入数据的方法：`write`与`writeText`**
```jsx
const clip = ClipboardManager.create();

// 写入不同 mimeType 的数据
clip.write({
  ['text/html']: '<div>html 内容</div>',
  ['text/plain']: '文本内容',
  ['application/custom']: '自定义 mime type 的内容',
}).then(() => {
  // 复制成功
}, () => {
 // 复制失败
}).catch((e) => {
  // error
});

// 写入纯文本
clip.writeText('文本内容').then(() => {
  // 复制成功
}, () => {
 // 复制失败
}).catch((e) => {
  // error
});

// write 与 writeText 也支持同步写入数据，第二个参数传为 false 即可
clip.write({...}, false);
```

**剪切板写入图片 File 对象**
> *Atention!!!*
> * 剪切板写入 file 使用的 `navigator.clipboard.write` API, 如果浏览器未开启写入权限，会导致写入失败
> * 浏览器`clipboard.clipboard.write` 目前的实现比较简单，仅支持 `text/html`、`text/plain`、`image/png` mime type 类型写入, 不支持其他复合类型数据写入, 所以当传入 `image/jpeg` 类型数据 ClipboardManager 默认写入 `image/png` 类型而不是 `image/`, 自定义的 mime type 等其他类型数据会被丢弃。
> * 由于写入 file 对象是异步操作，此时的 clipboard.write 将会返回 Promise 对象，不支持同步写入

```jsx
// 剪切板写入图片 file 对象, 支持传入 url 链接或者 Blob 对象
clipboard.write({
  'image/png': 'https://alidocs.oss-accelerate.aliyuncs.com/res/E8K4nyVo6RapqLbj/img/c0d39b35-0c85-46f4-92d7-8f008cd26da6.jpeg'
})

clipboard.write({
  'image/png': blob
})
```

## Q&A

**1. `new ClipboardManager` 与 `ClipboardManager.create` 的区别是什么？**
```jsx
/**
 * 每次 create 指向的同一个 ClipboardManager 单例, 以下是 create 源码
 * 适用于不需要定制化的业务场景
 * 
 * 而 new 适用于需要传参做定制化的业务场景
 */
ClipboardManager.create = () => {
  return Clipboard.__commonManager;
}
```

**2. 为什么只提供了 copy、cut, 不提供 paste 事件？**

浏览器安全策略，`js` 无法直接读取剪切板数据，只能通过 用户操作触发粘贴事件或通过 `jsapi` 获取剪切板数据。
参考文档：https://www.w3.org/TR/clipboard-apis/#clipboard-event-paste



**3. 为什么使用 ClipboardManager, 数据没有成功写入剪切板？**

一定要在用户点击按钮的 `click` 事件中使用，在其他执行环境或 `js` 模拟的 `click` 事件是无法成功写入数据的。

**4. 为什么异步读取 `copy event` 对象是 `undefined`？**

如果在 React 中想异步读取 `copy event` 对象，可以使用 `event.persist()` 方法
参考文档：https://reactjs.org/docs/events.html

**5. github 上 clipboard.js 跟这个有什么区别？**

`clipboard.js` 注重于兼容四个平台和触发 `copy` 事件，至于触发后如何写入剪切板就丢给了开发者。而 `ClipboardManager` 处理更加精细，直接告诉要写入什么类型数据就可以了，其他不需要开发者处理，另外`write` 与 `writeText` 方法也是参考了 W3C 对 `Clipboard` 设计的新接口，未来 API 升级融合度更高。
参考文档：https://developer.mozilla.org/en-US/docs/Web/API/Clipboard/write

**6. 为什么 iOS 上写入成功，但是 Android 上写入失败？**

检查下是否有全局的 user-select: none 的样式，这个样式会影响触发 fakeElement 的 Copy 事件。

**7. 为什么写入图片 File 对象，传入 url 就可以了？**

clipboard manager 内部会自动识别到 url，将 url 转换为 File 对象写入剪切板，省去开发者转换步骤

**8. 为什么写入图片 File 失败？**

Clipboard API(参考：[Clipboard API](https://juejin.cn/post/6979763242134405128)) 还处于草案阶段，浏览器之间的实现也存在差异，对剪切板写入 File 对象条件比较苛刻，请严格按照 **剪切板写入图片 File 对象** 章节使用教程及控制台的 warnning 信息定位问题原因。
