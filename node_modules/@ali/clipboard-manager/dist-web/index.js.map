{"version":3,"file":"index.js","sources":["../../src/constant.ts","../../src/createHiddenTextarea.ts","../../src/select.ts","../../src/utils/writeFileToClipboard.ts","../../src/manager.ts"],"sourcesContent":["export const IS_IOS = typeof navigator !== 'undefined'\n  && typeof window !== 'undefined'\n  && /iPad|iPhone|iPod/.test(navigator.userAgent)\n  // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n  // @ts-ignore\n  && !window.MSStream;\n\nexport const IS_BROWSER = typeof window !== 'undefined'\n  && typeof window.document !== 'undefined'\n  && typeof window.document.createElement !== 'undefined';\n\nexport const IS_SAFARI = typeof navigator !== 'undefined'\n  && navigator.vendor === 'Apple Computer, Inc.';\n\nexport const MIME_TYPES = {\n  HTML: 'text/html',\n  TEXT: 'text/plain',\n};\n\n// match \\s string.\nexport const NONEMPTY_REG = /^\\s+$/;\n","import { IS_IOS } from './constant';\nimport { HiddenTextarea } from './types';\n\nexport default function createHiddenTextarea(): HiddenTextarea {\n  const isRTL = document.documentElement.getAttribute('dir') === 'rtl';\n  const fakeElem = document.createElement(IS_IOS ? 'div' : 'textarea');\n  if (IS_IOS) {\n    fakeElem.setAttribute('style', '-webkit-user-select: text !important');\n  }\n  // Prevent zooming on iOS\n  fakeElem.style.fontSize = '12pt';\n  // Reset box model\n  fakeElem.style.border = '0';\n  fakeElem.style.padding = '0';\n  fakeElem.style.margin = '0';\n  // Move element out of screen horizontally\n  fakeElem.style.position = 'absolute';\n  fakeElem.style[isRTL ? 'right' : 'left'] = '-9999px';\n  // Move element to the same position vertically\n  const yPosition = window.pageYOffset || document.documentElement.scrollTop;\n  fakeElem.style.top = `${yPosition}px`;\n  return fakeElem;\n}\n","import { IS_IOS } from './constant';\n\ntype SelectElement = HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement | HTMLDivElement;\n\nexport default function select(element: SelectElement): string {\n  let selectedText;\n\n  if (IS_IOS || element instanceof HTMLDivElement) {\n    /**\n     *  兼容至 ios 10 以上\n     *  https://stackoverflow.com/questions/34045777/copy-to-clipboard-using-javascript-in-ios\n     * */\n    const selection = window.getSelection();\n    const range = document.createRange();\n\n    // There must be html content to trigger copy event.\n    if (!element.innerHTML) {\n      element.innerHTML = '<div>123</div>';\n    }\n\n    range.selectNodeContents(element);\n\n    // eslint-disable-next-line no-unused-expressions\n    selection?.removeAllRanges();\n    // eslint-disable-next-line no-unused-expressions\n    selection?.addRange(range);\n    return '';\n  }\n\n  if (element.nodeName === 'SELECT') {\n    element.focus();\n\n    selectedText = element.value;\n  } else if (element.nodeName === 'INPUT' || element.nodeName === 'TEXTAREA') {\n    const isReadOnly = element.hasAttribute('readonly');\n\n    if (!isReadOnly) {\n      element.setAttribute('readonly', '');\n    }\n\n    if ('select' in element) {\n      element.select();\n    }\n\n    if ('setSelectionRange' in element) {\n      // eslint-disable-next-line no-unused-expressions\n      element?.setSelectionRange(0, element.value.length);\n    }\n\n    if (!isReadOnly) {\n      element.removeAttribute('readonly');\n    }\n\n    selectedText = element.value;\n  } else {\n    if (element.hasAttribute('contenteditable')) {\n      element.focus();\n    }\n\n    const selection = window.getSelection();\n    const range = document.createRange();\n\n    range.selectNodeContents(element);\n    // eslint-disable-next-line no-unused-expressions\n    selection?.removeAllRanges();\n    // eslint-disable-next-line no-unused-expressions\n    selection?.addRange(range);\n\n    selectedText = selection?.toString();\n  }\n\n  return selectedText || '';\n}\n","import { WriteData } from '../types';\nimport { MIME_TYPES, IS_SAFARI, NONEMPTY_REG } from '../constant';\n\nlet canvas: HTMLCanvasElement;\nlet ctx: CanvasRenderingContext2D | null;\n\n/**\n * @description Clear canvas memory.\n */\nfunction clearCanvas(): void {\n  if (canvas) {\n    canvas.width = 0;\n    canvas.height = 0;\n  }\n}\n\n/**\n * @description Only support image type.\n */\nexport function isFileMimeType(mimeType: string): boolean {\n  return /^(image)\\//.test(mimeType);\n}\n\n/**\n * @description Transform media url to blob\n */\nexport function urlToBlob(url: string): Promise<Blob> {\n  return new Promise<Blob>((resolve, reject) => {\n    const img = new Image();\n    img.setAttribute('crossOrigin', 'anonymous');\n    img.onload = () => {\n      if (!canvas || !ctx) {\n        canvas = document.createElement('canvas');\n        ctx = canvas.getContext('2d');\n      }\n      canvas.width = img.naturalWidth;\n      canvas.height = img.naturalHeight;\n      if (ctx) {\n        ctx.drawImage(img, 0, 0);\n        canvas.toBlob((blob) => {\n          if (blob) {\n            resolve(blob);\n          }\n          clearCanvas();\n        }, 'image/png');\n      } else {\n        reject(new Error(\"canvas.getContext('2d') return null\"));\n        clearCanvas();\n      }\n    };\n    img.onerror = (e) => {\n      reject(e);\n      clearCanvas();\n    };\n    img.src = url;\n  });\n}\n\nasync function fileDataToBlob(fileData: string | Blob): Promise<Blob> {\n  if (fileData instanceof Blob) {\n    return Promise.resolve(fileData);\n  }\n  const blob = await urlToBlob(fileData);\n  return blob;\n}\n\n/**\n * @description Support for multiple ClipboardItems is not implemented.\n * @see https://source.chromium.org/chromium/chromium/src/+/master:ui/base/clipboard/scoped_clipboard_writer.cc;l=22?q=~ScopedClipboardWriter\n */\nasync function asyncClipboardDataToBlob(writeData: WriteData): Promise<Record<string, Blob>> {\n  const result: Record<string, Blob> = {};\n  for await (const key of Object.keys(writeData)) {\n    if (isFileMimeType(key)) {\n      // DOMException: Type image/jpeg not supported on write.\n      result['image/png'] = await fileDataToBlob(writeData[key]);\n    } else if ([MIME_TYPES.HTML, MIME_TYPES.TEXT].includes(key)) {\n      result[key] = new Blob([writeData[key]], { type: key });\n    } else {\n      console.warn('Support for multiple ClipboardItems is not implemented.(details: https://source.chromium.org/chromium/chromium/src/+/master:ui/base/clipboard/scoped_clipboard_writer.cc;l=22?q=~ScopedClipboardWriter)');\n    }\n  }\n  return result;\n}\n\n/**\n * @description Compatible with safari.\n * @see https://stackoverflow.com/questions/66312944/javascript-clipboard-api-write-does-not-work-in-safari\n */\nfunction syncClipboardDataToBlob(writeData: WriteData): Record<string, Blob | Promise<Blob>> {\n  const result: Record<string, Blob | Promise<Blob>> = {};\n  for (const key of Object.keys(writeData)) {\n    if (isFileMimeType(key)) {\n      // DOMException: Type image/jpeg not supported on write.\n      result['image/png'] = fileDataToBlob(writeData[key]);\n    } else if ([MIME_TYPES.HTML, MIME_TYPES.TEXT].includes(key)) {\n      result[key] = new Blob([writeData[key]], { type: key });\n    } else {\n      console.warn('Support for multiple ClipboardItems is not implemented.(details: https://source.chromium.org/chromium/chromium/src/+/master:ui/base/clipboard/scoped_clipboard_writer.cc;l=22?q=~ScopedClipboardWriter)');\n    }\n  }\n  return result;\n}\n\nexport const isInValidData = (data: string) => !data || NONEMPTY_REG.test(data);\n\nexport function isSupportWriteFile() {\n  const nav = window.navigator as any;\n  // eslint-disable-next-line no-param-reassign\n  const ClipboardItem = window?.ClipboardItem as any;\n  return nav?.clipboard?.write && !ClipboardItem;\n}\n\n/**\n * @param {WriteData} writeData\n * @return {*}  {Promise<any>}\n * @description Write file data(allow blob or url) to clipboard.\n */\nexport async function writeFileToClipboard(writeData: WriteData): Promise<any> {\n  try {\n    const nav = window.navigator as any;\n    // eslint-disable-next-line no-param-reassign\n    const ClipboardItem = window?.ClipboardItem as any;\n    if (!nav?.clipboard?.write || !ClipboardItem) {\n      return Promise.reject(\n        new Error('Your browser does not support navigator.clipboard.write method.'),\n      );\n    }\n    if (IS_SAFARI) {\n      const result = await nav.clipboard.write([\n        new ClipboardItem(syncClipboardDataToBlob(writeData)),\n      ]);\n      return Promise.resolve(result);\n    }\n    const blobData = await asyncClipboardDataToBlob(writeData);\n    const result = await nav.clipboard.write([\n      new ClipboardItem(blobData),\n    ]);\n    return Promise.resolve(result);\n  } catch (err) {\n    return Promise.reject(err);\n  }\n}\n","import { ClipboardEvent } from 'react';\nimport createHiddenTextarea from './createHiddenTextarea';\nimport select from './select';\nimport {\n  ClipboardActionType,\n  IClipboardOptions,\n  ICopyTextResult,\n  WriteData,\n  HiddenTextarea,\n} from './types';\nimport { MIME_TYPES, IS_IOS, IS_BROWSER } from './constant';\nimport {\n  isFileMimeType,\n  isSupportWriteFile,\n  writeFileToClipboard,\n  isInValidData,\n} from './utils/writeFileToClipboard';\n\n/**\n * Cannot run on the server.\n */\nlet _commonManager: ClipboardManager | null = null;\n\n/**\n * Inner class which performs selection from either `text` or `target`\n * properties and then executes copy or cut operations.\n */\nexport default class ClipboardManager {\n  private readonly action: ClipboardActionType = 'copy';\n\n  private fakeElem: HiddenTextarea = createHiddenTextarea();\n\n  private readonly container: HTMLElement = document.body;\n\n  private text = ' ';\n\n  /**\n   * Create a common manager, write data to clipboard directly without new object.\n   */\n  static create = (): ClipboardManager | null => {\n    if (!IS_BROWSER) {\n      return null;\n    }\n    if (!_commonManager) {\n      _commonManager = new ClipboardManager();\n    }\n    return _commonManager;\n  };\n\n  /**\n   * @param {Object} options\n   */\n  constructor(options: IClipboardOptions = {}) {\n    if (options.action) {\n      this.action = options.action;\n    }\n    if (options.container instanceof HTMLElement) {\n      this.container = options.container;\n    }\n    if (options.target) {\n      this.fakeElem = options.target;\n    }\n  }\n\n  /**\n   * Executes the copy operation based on the current selection.\n   */\n  private copyText = (): ICopyTextResult => {\n    let succeeded;\n\n    try {\n      succeeded = window.document.execCommand(this.action);\n    } catch (err) {\n      succeeded = false;\n    }\n\n    const cbResult = {\n      succeeded,\n      action: this.action,\n      text: this.text,\n    };\n    return cbResult;\n  };\n\n  /**\n   * Create action function.\n   */\n  private createOnAction = (data: WriteData): ((e: ClipboardEvent) => void) => {\n    const { action } = this;\n    const onAction = (e: ClipboardEvent): void => {\n      e.preventDefault();\n      const dataEntries = Object.entries(data);\n      dataEntries.forEach((item) => {\n        const [mimeType, content] = item;\n        if (!isFileMimeType(mimeType) && typeof content === 'string') {\n          const text = (\n            isInValidData(content as string) ? ' ' : content\n          ) as string;\n          if (mimeType === MIME_TYPES.TEXT) {\n            this.text = text;\n          }\n          e.clipboardData.setData(mimeType, text);\n        }\n      });\n      // @ts-ignore\n      this.fakeElem.removeEventListener(action, onAction);\n      this.destroy();\n    };\n    return onAction;\n  };\n\n  /**\n   * Creates a fake textarea element, sets its value from `text` property,\n   * and makes a selection on it.\n   */\n  public selectFake = (data: WriteData): void => {\n    if (!(this.fakeElem instanceof HTMLDivElement)) {\n      this.fakeElem.value = (data[MIME_TYPES.TEXT] || '') as string;\n    } else {\n      this.fakeElem.innerHTML = (data[MIME_TYPES.HTML] || '') as string;\n    }\n    this.container.appendChild(this.fakeElem);\n    this.fakeElem.focus();\n    select(this.fakeElem);\n  };\n\n  /**\n   * Async set file data of clipboard.\n   */\n  public writeFile = (\n    data: WriteData,\n    result: ICopyTextResult,\n  ): Promise<ICopyTextResult> => {\n    const { activeElement } = window.document;\n    return new Promise((resolve, reject) => {\n      if (!isSupportWriteFile()) {\n        this.writeDataWithoutFile(data);\n      }\n      const selection = window.getSelection();\n      const range = document.createRange();\n      this.selectFake(data);\n      writeFileToClipboard(data)\n        .then(resolve, (error) => {\n          console.warn(error);\n          return result.succeeded ? resolve(result) : reject(result);\n        })\n        .finally(() => {\n          if (selection) {\n            selection.addRange(range);\n          }\n          this.destroy();\n          if (\n            activeElement instanceof HTMLTextAreaElement\n            || activeElement instanceof HTMLInputElement\n          ) {\n            activeElement.blur();\n            activeElement.focus();\n          }\n        });\n    });\n  };\n\n  /**\n   * Set clipboard data without file.\n   */\n  private writeDataWithoutFile = (data: WriteData): ICopyTextResult => {\n    const onCopy = this.createOnAction(data);\n    if (!IS_IOS) {\n      // TODO copy failed in ios version lower than 13 if prevent default event.\n      // @ts-ignore\n      this.fakeElem.addEventListener(this.action, onCopy);\n    }\n\n    const copyDataByExecCommand = (): ICopyTextResult => {\n      this.selectFake(data);\n      const copyResult = this.copyText();\n      this.destroy();\n      return copyResult;\n    };\n\n    return copyDataByExecCommand();\n  }\n\n  /**\n   * Set clipboard data by mine type.\n   * Support async and sync syntactic sugars.\n   */\n  public write = (\n    data: WriteData,\n    async = true,\n  ): Promise<ICopyTextResult> | ICopyTextResult => {\n    const result = this.writeDataWithoutFile(data);\n    // set media data\n    if (Object.keys(data).some(isFileMimeType)) {\n      return this.writeFile(data, result);\n    }\n\n    if (async) {\n      return new Promise((resolve, reject) => {\n        if (result.succeeded) {\n          return resolve(result);\n        }\n        return reject(result);\n      });\n    }\n    return result;\n  };\n\n  /**\n   * Only set plain text of clipboard.\n   * Support async and sync syntactic sugars.\n   */\n  public writeText = (\n    clipText: string,\n    async = true,\n  ): Promise<ICopyTextResult> | ICopyTextResult => {\n    this.text = clipText;\n    this.selectFake({ [MIME_TYPES.TEXT]: clipText });\n    const result = this.copyText();\n    this.destroy();\n    if (async) {\n      return new Promise((resolve, reject) => {\n        if (result.succeeded) {\n          return resolve(result);\n        }\n        return reject(result);\n      });\n    }\n    return result;\n  };\n\n  /**\n   * Remove fake textarea element.\n   */\n  public destroy = (): void => {\n    this.fakeElem.remove();\n  };\n}\n"],"names":["IS_IOS","navigator","window","test","userAgent","MSStream","IS_BROWSER","document","createElement","IS_SAFARI","vendor","MIME_TYPES","HTML","TEXT","NONEMPTY_REG","createHiddenTextarea","isRTL","documentElement","getAttribute","fakeElem","setAttribute","style","fontSize","border","padding","margin","position","yPosition","pageYOffset","scrollTop","top","select","element","selectedText","HTMLDivElement","selection","getSelection","range","createRange","innerHTML","selectNodeContents","removeAllRanges","addRange","nodeName","focus","value","isReadOnly","hasAttribute","setSelectionRange","length","removeAttribute","toString","canvas","ctx","clearCanvas","width","height","isFileMimeType","mimeType","urlToBlob","url","Promise","resolve","reject","img","Image","onload","getContext","naturalWidth","naturalHeight","drawImage","toBlob","blob","Error","onerror","e","src","fileDataToBlob","fileData","Blob","asyncClipboardDataToBlob","writeData","result","Object","keys","key","includes","type","console","warn","syncClipboardDataToBlob","isInValidData","data","isSupportWriteFile","nav","ClipboardItem","clipboard","write","writeFileToClipboard","blobData","_commonManager","ClipboardManager","options","body","succeeded","execCommand","action","err","cbResult","text","onAction","preventDefault","dataEntries","entries","forEach","item","content","clipboardData","setData","removeEventListener","destroy","container","appendChild","activeElement","writeDataWithoutFile","selectFake","then","error","HTMLTextAreaElement","HTMLInputElement","blur","onCopy","createOnAction","addEventListener","copyDataByExecCommand","copyResult","copyText","async","some","writeFile","clipText","remove","HTMLElement","target"],"mappings":"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"}