{"version":3,"sources":["../../../src/utils/useParentWidth.tsx"],"names":["useResetWidthByParentWidth","controller","node","currElement","value","parentWidth","setParentWidth","Number","MAX_SAFE_INTEGER","parentNode","document","getClosest","key","maybeBlock","Block","isBlock","extra","data","pi","inList","inTaskList","type","list","root","closest","innerWidth","undefined"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AAEO,MAAMA,0BAA0B,GAAG,CAACC,UAAD,EAAyBC,IAAzB,EAAqCC,WAArC,KAAwF;AAChI,QAAMC,KAAK,GAAGH,UAAU,CAACG,KAAzB;AACA,QAAM,CAACC,WAAD,EAAcC,cAAd,IAAgC,qBAAiBC,MAAM,CAACC,gBAAxB,CAAtC;AAEA,wBAAU,MAAM;AACd,UAAMC,UAAU,GAAGL,KAAK,CAACM,QAAN,CAAeC,UAAf,CAA0BT,IAAI,CAACU,GAA/B,EAAqCC,UAAD,IAAgBC,mBAAMC,OAAN,CAAcF,UAAd,CAApD,CAAnB,CADc,CAEd;AACA;;AACA,UAAMG,KAAK,GAAGP,UAAU,EAAEQ,IAAZ,EAAkBC,EAAlB,EAAsBF,KAAtB,IAA+B,EAA7C;AACA,UAAMG,MAAM,GAAGH,KAAK,CAACG,MAAN,IAAgBH,KAAK,CAACI,UAAtB,IAAqCX,UAAU,EAAEY,IAAZ,KAAqB,WAArB,IAAoCZ,UAAU,EAAEQ,IAAZ,EAAkBK,IAA1G;AACA,QAAIH,MAAJ,EAAY,OANE,CAOd;;AACA,QAAIV,UAAU,EAAEQ,IAAZ,EAAkBK,IAAtB,EAA4B,OARd,CASd;;AACA,UAAMC,IAAI,GAAGpB,WAAW,EAAEqB,OAAb,CAAqB,2BAArB,CAAb;AACA,UAAMC,UAAU,GAAGhB,UAAU,GAAG,8BAAcA,UAAd,EAA0Bc,IAAI,IAAIG,SAAlC,CAAH,GAAkD,IAA/E;;AACA,QAAID,UAAU,KAAK,IAAnB,EAAyB;AACvBnB,MAAAA,cAAc,CAACC,MAAM,CAACC,gBAAR,CAAd;AACA;AACD;;AACDF,IAAAA,cAAc,CAACmB,UAAD,CAAd;AACD,GAjBD,EAiBG,CAACrB,KAAD,EAAQF,IAAI,CAACU,GAAb,CAjBH;AAmBA,SAAO,CAACP,WAAD,CAAP;AACD,CAxBM","sourcesContent":["import { useState, useEffect } from 'react';\nimport { Controller, Node, Block } from '@ali/4ever-cangjie';\nimport { getInnerWidth } from '@ali/4ever-utils';\n\nexport const useResetWidthByParentWidth = (controller: Controller, node: Node, currElement?: HTMLSpanElement | null): [number] => {\n  const value = controller.value;\n  const [parentWidth, setParentWidth] = useState<number>(Number.MAX_SAFE_INTEGER);\n\n  useEffect(() => {\n    const parentNode = value.document.getClosest(node.key, (maybeBlock) => Block.isBlock(maybeBlock)) as Block | null;\n    // list 下宽度不要约束\n    // @ts-ignore node.data\n    const extra = parentNode?.data?.pi?.extra || {};\n    const inList = extra.inList || extra.inTaskList || (parentNode?.type === 'paragraph' && parentNode?.data?.list);\n    if (inList) return;\n    // isList\n    if (parentNode?.data?.list) return;\n    // FIX: 避免多实例渲染时定位到非目标节点\n    const root = currElement?.closest('div[data-cangjie-content]');\n    const innerWidth = parentNode ? getInnerWidth(parentNode, root || undefined) : null;\n    if (innerWidth === null) {\n      setParentWidth(Number.MAX_SAFE_INTEGER);\n      return;\n    }\n    setParentWidth(innerWidth);\n  }, [value, node.key]);\n\n  return [parentWidth];\n};\n"],"file":"useParentWidth.js"}