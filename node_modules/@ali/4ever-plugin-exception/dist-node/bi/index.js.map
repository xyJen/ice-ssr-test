{"version":3,"sources":["../../../src/bi/index.ts"],"names":["EVENT_HANDLERS1","EVENT_HANDLERS2","monitHandler","next","e","logger","error","biFactory","plugins1","reduce","handlers","handler","_","controller","plugins2","cangjieSelectHandler","Error","message","indexOf","sum","key","renderEditable","onCangjieSelect","models"],"mappings":";;;;;;;;;AAAA;;AAEA;;AAEA,MAAMA,eAAe,GAAG,CACtB,UADsB,EAEtB,gBAFsB,EAGtB,eAHsB,EAItB,cAJsB,EAKtB,gBALsB,EAMtB,SANsB,EAOtB,eAPsB,EAQtB,WARsB,EAStB,kBATsB,EAUtB,oBAVsB,EAWtB,QAXsB,EAYtB,OAZsB,EAatB,WAbsB,EActB,aAdsB,EAetB,YAfsB,EAgBtB,aAhBsB,EAiBtB,QAjBsB,EAkBtB,SAlBsB,EAmBtB,WAnBsB,EAoBtB,SApBsB,EAqBtB,aArBsB,EAsBtB,WAtBsB,EAuBtB,SAvBsB,EAwBtB,UAxBsB,EAyBtB,cAzBsB,EA0BtB,aA1BsB,EA2BtB,YA3BsB,CAAxB;AA8BA,MAAMC,eAAe,GAAG,CACtB,eADsB,EAEtB,UAFsB,CAAxB;;AAKA,MAAMC,YAAY,GAAIC,IAAD,IAAsB;AACzC,MAAI;AACF,WAAOA,IAAI,EAAX;AACD,GAFD,CAEE,OAAOC,CAAP,EAAe;AACfC,wBAAOC,KAAP,CAAaF,CAAb;;AACA,UAAOA,CAAP;AACD;AACF,CAPD;;AASO,MAAMG,SAAoB,GAAG,MAAM;AACxC,QAAMC,QAAQ,GAAGR,eAAe,CAACS,MAAhB,CAAuB,CAACC,QAAD,EAAWC,OAAX,KAAuB;AAC7D,WAAO,EACL,GAAGD,QADE;AAEL,OAACC,OAAD,GAAW,CAACC,CAAD,EAAIC,UAAJ,EAA4BV,IAA5B,KAAiD;AAC1D,eAAOD,YAAY,CAACC,IAAD,CAAnB;AACD;AAJI,KAAP;AAMD,GAPgB,EAOd,EAPc,CAAjB;AASA,QAAMW,QAAQ,GAAGb,eAAe,CAACQ,MAAhB,CAAuB,CAACC,QAAD,EAAWC,OAAX,KAAuB;AAC7D,WAAO,EACL,GAAGD,QADE;AAEL,OAACC,OAAD,GAAW,CAACE,UAAD,EAAyBV,IAAzB,KAA8C;AACvD,eAAOD,YAAY,CAACC,IAAD,CAAnB;AACD;AAJI,KAAP;AAMD,GAPgB,EAOd,EAPc,CAAjB;;AASA,QAAMY,oBAAoB,GAAG,CAACH,CAAD,EAAIC,UAAJ,EAA4BV,IAA5B,KAAiD;AAC5E,QAAI;AACF,aAAOA,IAAI,EAAX;AACD,KAFD,CAEE,OAAOC,CAAP,EAAe;AACf,UAAIA,CAAC,YAAYY,KAAb,IAAsBZ,CAAC,CAACa,OAAF,CAAUC,OAAV,CAAkB,kDAAlB,IAAwE,CAAC,CAAnG,EAAsG;AACpGb,4BAAOc,GAAP,CAAW,+DAAX;AACD,OAFD,MAEO;AACLd,4BAAOC,KAAP,CAAaF,CAAb;;AACA,cAAOA,CAAP;AACD;AACF;AACF,GAXD;;AAaA,SAAO;AACLgB,IAAAA,GAAG,EAAE,WADA;AAELC,IAAAA,cAAc,EAAdA,8BAFK;AAGLC,IAAAA,eAAe,EAAEP,oBAHZ;AAIL,OAAGP,QAJE;AAKL,OAAGM,QALE;AAMLS,IAAAA,MAAM,EAAE;AANH,GAAP;AAQD,CAxCM","sourcesContent":["import logger from '@ali/4ever-logger';\nimport type { BiFactory, Controller } from '@ali/4ever-cangjie';\nimport { renderEditable } from './renderEditable';\n\nconst EVENT_HANDLERS1 = [\n  'onAction',\n  'onCangjieInput',\n  'onCangjieCopy',\n  'onCangjieCut',\n  'onCangjiePaste',\n  'onClick',\n  'onContextMenu',\n  'onCommand',\n  'onCompositionEnd',\n  'onCompositionStart',\n  'onCopy',\n  'onCut',\n  'onDragEnd',\n  'onDragEnter',\n  'onDragExit',\n  'onDragLeave',\n  'onDrop',\n  'onInput',\n  'onKeyDown',\n  'onKeyUp',\n  'onMouseDown',\n  'onMouseUp',\n  'onPaste',\n  'onSelect',\n  'onTouchStart',\n  'onTouchMove',\n  'onTouchEnd',\n];\n\nconst EVENT_HANDLERS2 = [\n  'onCangjieBlur',\n  'onChange',\n];\n\nconst monitHandler = (next: () => void) => {\n  try {\n    return next();\n  } catch (e: any) {\n    logger.error(e);\n    throw (e);\n  }\n};\n\nexport const biFactory: BiFactory = () => {\n  const plugins1 = EVENT_HANDLERS1.reduce((handlers, handler) => {\n    return {\n      ...handlers,\n      [handler]: (_, controller: Controller, next: () => void) => {\n        return monitHandler(next);\n      },\n    };\n  }, {});\n\n  const plugins2 = EVENT_HANDLERS2.reduce((handlers, handler) => {\n    return {\n      ...handlers,\n      [handler]: (controller: Controller, next: () => void) => {\n        return monitHandler(next);\n      },\n    };\n  }, {});\n\n  const cangjieSelectHandler = (_, controller: Controller, next: () => void) => {\n    try {\n      return next();\n    } catch (e: any) {\n      if (e instanceof Error && e.message.indexOf('Core[onCangjieSelect] receive invalid selection:') > -1) {\n        logger.sum('Editor Error: Core[onCangjieSelect] receive invalid selection');\n      } else {\n        logger.error(e);\n        throw (e);\n      }\n    }\n  };\n\n  return {\n    key: 'exception',\n    renderEditable,\n    onCangjieSelect: cangjieSelectHandler,\n    ...plugins1,\n    ...plugins2,\n    models: [],\n  };\n};\n"],"file":"index.js"}