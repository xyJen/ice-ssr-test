{"version":3,"sources":["../../../src/bi/index.ts"],"names":["logger","renderEditable","EVENT_HANDLERS1","EVENT_HANDLERS2","monitHandler","next","e","error","biFactory","plugins1","reduce","handlers","handler","_","controller","plugins2","cangjieSelectHandler","Error","message","indexOf","sum","key","onCangjieSelect","models"],"mappings":";AAAA,OAAOA,MAAP,MAAmB,mBAAnB;AAEA,SAASC,cAAT;AAEA,IAAMC,eAAe,GAAG,CACtB,UADsB,EAEtB,gBAFsB,EAGtB,eAHsB,EAItB,cAJsB,EAKtB,gBALsB,EAMtB,SANsB,EAOtB,eAPsB,EAQtB,WARsB,EAStB,kBATsB,EAUtB,oBAVsB,EAWtB,QAXsB,EAYtB,OAZsB,EAatB,WAbsB,EActB,aAdsB,EAetB,YAfsB,EAgBtB,aAhBsB,EAiBtB,QAjBsB,EAkBtB,SAlBsB,EAmBtB,WAnBsB,EAoBtB,SApBsB,EAqBtB,aArBsB,EAsBtB,WAtBsB,EAuBtB,SAvBsB,EAwBtB,UAxBsB,EAyBtB,cAzBsB,EA0BtB,aA1BsB,EA2BtB,YA3BsB,CAAxB;AA8BA,IAAMC,eAAe,GAAG,CACtB,eADsB,EAEtB,UAFsB,CAAxB;;AAKA,IAAMC,YAAY,GAAG,SAAfA,YAAe,CAACC,IAAD,EAAsB;AACzC,MAAI;AACF,WAAOA,IAAI,EAAX;AACD,GAFD,CAEE,OAAOC,CAAP,EAAe;AACfN,IAAAA,MAAM,CAACO,KAAP,CAAaD,CAAb;AACA,UAAOA,CAAP;AACD;AACF,CAPD;;AASA,OAAO,IAAME,SAAoB,GAAG,SAAvBA,SAAuB,GAAM;AACxC,MAAMC,QAAQ,GAAGP,eAAe,CAACQ,MAAhB,CAAuB,UAACC,QAAD,EAAWC,OAAX,EAAuB;AAAA;;AAC7D,wBACKD,QADL,6BAEGC,OAFH,IAEa,UAACC,CAAD,EAAIC,UAAJ,EAA4BT,IAA5B,EAAiD;AAC1D,aAAOD,YAAY,CAACC,IAAD,CAAnB;AACD,KAJH;AAMD,GAPgB,EAOd,EAPc,CAAjB;AASA,MAAMU,QAAQ,GAAGZ,eAAe,CAACO,MAAhB,CAAuB,UAACC,QAAD,EAAWC,OAAX,EAAuB;AAAA;;AAC7D,wBACKD,QADL,6BAEGC,OAFH,IAEa,UAACE,UAAD,EAAyBT,IAAzB,EAA8C;AACvD,aAAOD,YAAY,CAACC,IAAD,CAAnB;AACD,KAJH;AAMD,GAPgB,EAOd,EAPc,CAAjB;;AASA,MAAMW,oBAAoB,GAAG,SAAvBA,oBAAuB,CAACH,CAAD,EAAIC,UAAJ,EAA4BT,IAA5B,EAAiD;AAC5E,QAAI;AACF,aAAOA,IAAI,EAAX;AACD,KAFD,CAEE,OAAOC,CAAP,EAAe;AACf,UAAIA,CAAC,YAAYW,KAAb,IAAsBX,CAAC,CAACY,OAAF,CAAUC,OAAV,CAAkB,kDAAlB,IAAwE,CAAC,CAAnG,EAAsG;AACpGnB,QAAAA,MAAM,CAACoB,GAAP,CAAW,+DAAX;AACD,OAFD,MAEO;AACLpB,QAAAA,MAAM,CAACO,KAAP,CAAaD,CAAb;AACA,cAAOA,CAAP;AACD;AACF;AACF,GAXD;;AAaA;AACEe,IAAAA,GAAG,EAAE,WADP;AAEEpB,IAAAA,cAAc,EAAdA,cAFF;AAGEqB,IAAAA,eAAe,EAAEN;AAHnB,KAIKP,QAJL,EAKKM,QALL;AAMEQ,IAAAA,MAAM,EAAE;AANV;AAQD,CAxCM","sourcesContent":["import logger from '@ali/4ever-logger';\nimport type { BiFactory, Controller } from '@ali/4ever-cangjie';\nimport { renderEditable } from './renderEditable';\n\nconst EVENT_HANDLERS1 = [\n  'onAction',\n  'onCangjieInput',\n  'onCangjieCopy',\n  'onCangjieCut',\n  'onCangjiePaste',\n  'onClick',\n  'onContextMenu',\n  'onCommand',\n  'onCompositionEnd',\n  'onCompositionStart',\n  'onCopy',\n  'onCut',\n  'onDragEnd',\n  'onDragEnter',\n  'onDragExit',\n  'onDragLeave',\n  'onDrop',\n  'onInput',\n  'onKeyDown',\n  'onKeyUp',\n  'onMouseDown',\n  'onMouseUp',\n  'onPaste',\n  'onSelect',\n  'onTouchStart',\n  'onTouchMove',\n  'onTouchEnd',\n];\n\nconst EVENT_HANDLERS2 = [\n  'onCangjieBlur',\n  'onChange',\n];\n\nconst monitHandler = (next: () => void) => {\n  try {\n    return next();\n  } catch (e: any) {\n    logger.error(e);\n    throw (e);\n  }\n};\n\nexport const biFactory: BiFactory = () => {\n  const plugins1 = EVENT_HANDLERS1.reduce((handlers, handler) => {\n    return {\n      ...handlers,\n      [handler]: (_, controller: Controller, next: () => void) => {\n        return monitHandler(next);\n      },\n    };\n  }, {});\n\n  const plugins2 = EVENT_HANDLERS2.reduce((handlers, handler) => {\n    return {\n      ...handlers,\n      [handler]: (controller: Controller, next: () => void) => {\n        return monitHandler(next);\n      },\n    };\n  }, {});\n\n  const cangjieSelectHandler = (_, controller: Controller, next: () => void) => {\n    try {\n      return next();\n    } catch (e: any) {\n      if (e instanceof Error && e.message.indexOf('Core[onCangjieSelect] receive invalid selection:') > -1) {\n        logger.sum('Editor Error: Core[onCangjieSelect] receive invalid selection');\n      } else {\n        logger.error(e);\n        throw (e);\n      }\n    }\n  };\n\n  return {\n    key: 'exception',\n    renderEditable,\n    onCangjieSelect: cangjieSelectHandler,\n    ...plugins1,\n    ...plugins2,\n    models: [],\n  };\n};\n"],"file":"index.js"}