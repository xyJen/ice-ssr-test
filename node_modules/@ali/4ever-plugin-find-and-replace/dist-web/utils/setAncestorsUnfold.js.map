{"version":3,"sources":["../../../src/utils/setAncestorsUnfold.ts"],"names":["toggleFold","setAncestorsUnfold","controller","node","groups","query","parents","filter","group","userData","get","forEach","parent","run","fold","subject"],"mappings":"AACA,SAASA,UAAT,QAA2B,iCAA3B;;AAEA,IAAMC,kBAAkB,GAAG,SAArBA,kBAAqB,CAACC,UAAD,EAAyBC,IAAzB,EAAyC;AAClE;AACA,MAAMC,MAAM,GAAGF,UAAU,CAACG,KAAX,CAAiB,qBAAjB,EAAwCF,IAAxC,CAAf;AACA,MAAMG,OAAO,GAAGF,MAAM,CAACG,MAAP,CAAc,UAACC,KAAD;AAAA,WAAWN,UAAU,CAACO,QAAX,CAAoBC,GAApB,CAAwBF,KAAxB,EAA+B,MAA/B,CAAX;AAAA,GAAd,CAAhB;AACAF,EAAAA,OAAO,CAACK,OAAR,CAAgB,UAACC,MAAD,EAAY;AAC1BV,IAAAA,UAAU,CAACW,GAAX,CACE,UADF,EAEEb,UAAU,CAAC;AACTG,MAAAA,IAAI,EAAES,MADG;AAETE,MAAAA,IAAI,EAAE;AAFG,KAAD,CAFZ;AAOD,GARD,EAJkE,CAclE;AACA;;AACA,MAAMC,OAAO,GAAGb,UAAU,CAACG,KAAX,CAAiB,sBAAjB,EAAyCF,IAAzC,CAAhB;;AACA,MAAIY,OAAO,IAAIA,OAAO,KAAKZ,IAAvB,IAA+BD,UAAU,CAACO,QAAX,CAAoBC,GAApB,CAAwBK,OAAxB,EAAiC,MAAjC,CAAnC,EAA6E;AAC3Eb,IAAAA,UAAU,CAACW,GAAX,CACE,UADF,EAEEb,UAAU,CAAC;AACTG,MAAAA,IAAI,EAAEY,OADG;AAETD,MAAAA,IAAI,EAAE;AAFG,KAAD,CAFZ;AAOD;AACF,CA1BD;;AA4BA,eAAeb,kBAAf","sourcesContent":["import { Controller, Block } from '@ali/4ever-cangjie';\nimport { toggleFold } from '@ali/4ever-plugin-heading-group';\n\nconst setAncestorsUnfold = (controller: Controller, node: Block) => {\n  // 先展开标题\n  const groups = controller.query('getHeadingAncestors', node);\n  const parents = groups.filter((group) => controller.userData.get(group, 'fold'));\n  parents.forEach((parent) => {\n    controller.run(\n      'onAction',\n      toggleFold({\n        node: parent,\n        fold: false,\n      }),\n    );\n  });\n\n  // 再展开议题\n  // NOTE: 议题的层级比 H1 更高，如果大纲中存在 H1，则可能会被议题隐藏\n  const subject = controller.query('getSubjectStartBlock', node);\n  if (subject && subject !== node && controller.userData.get(subject, 'fold')) {\n    controller.run(\n      'onAction',\n      toggleFold({\n        node: subject,\n        fold: false,\n      }),\n    );\n  }\n};\n\nexport default setAncestorsUnfold;\n"],"file":"setAncestorsUnfold.js"}