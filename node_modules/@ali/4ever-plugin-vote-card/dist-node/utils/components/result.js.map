{"version":3,"sources":["../../../../src/utils/components/result.tsx"],"names":["Result","props","node","locale","controller","isSelected","data","readOnly","isPublish","handleReVote","run","userOptionTicketed","optionInfoList","find","item","userOptionTicket","voteType","EnumVoteType","RADIO","radio","checkbox","title","map","checked","content","String","optionTicket","unit","totalVoteCount","toFixed","width","participateUserCount","total","endTime","format","expired","hasEnded","reVote","submit"],"mappings":"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","sourcesContent":["import React, { useCallback, useMemo } from 'react';\nimport cls from 'classnames';\nimport dayjs from 'dayjs';\nimport { Controller, Block } from '@ali/4ever-cangjie';\nimport { votingActive } from '../actions';\nimport { EnumVoteType, IVoteData } from '../types';\nimport type { VotePluginConfig } from '../types';\nimport HeaderToolbar from './headerToolbar';\nimport { ContainerWrapper, ResultWrapper, TitleReaderWrapper } from './styled';\n\ninterface IProps {\n  node: Block;\n  locale: VotePluginConfig['locale'];\n  controller: Controller;\n  isSelected?: boolean;\n  data: IVoteData;\n  readOnly?: boolean;\n  isPublish?: boolean;\n}\n\nconst Result: React.FC<IProps> = (props: IProps) => {\n  const { node, locale, controller, isSelected, data, readOnly, isPublish } = props;\n\n  const handleReVote = useCallback(() => {\n    controller.run('onAction', votingActive(node));\n  }, []);\n\n  // 我是否有投过票\n  const userOptionTicketed = useMemo(() => !!data.optionInfoList?.find((item) => item.userOptionTicket !== 0), [data]);\n\n  return (\n    <ContainerWrapper\n      isSelected={isSelected}\n      data-role=\"vote\"\n      data-testid=\"card-vote-container-result\"\n    >\n      <ResultWrapper>\n        {\n          (!controller.readOnly && !readOnly) && !isPublish && \n          <HeaderToolbar\n            controller={controller}\n            node={node}\n          />\n        }\n        <TitleReaderWrapper>\n          <span>\n            {data.voteType === EnumVoteType.RADIO ? locale?.radio : locale?.checkbox}\n          </span>\n          <span data-testid=\"card-vote-result-title\">\n            {data.title}\n          </span>\n        </TitleReaderWrapper>\n        <div className=\"result-options\">\n          {\n            data.optionInfoList?.map((item) =>\n              (\n                <div\n                  className={cls({\n                    checked: item.userOptionTicket !== 0,\n                  })}\n                >\n                  <span>{item.content}</span>\n                  <span>\n                    {`${String(item.optionTicket)} ${locale?.unit}`}\n                    <i />\n                    {(!item.optionTicket || !data.totalVoteCount) ? 0 : ((item.optionTicket ?? 0) / (data.totalVoteCount ?? 0) * 100).toFixed(2)}%\n                  </span>\n                  <div>\n                    <div style={{ width: `${(!item.optionTicket || !data.totalVoteCount) ? 0 : ((item.optionTicket ?? 0) / (data.totalVoteCount ?? 0) * 100).toFixed(2)}%` }} />\n                  </div>\n                </div>\n              ))\n          }\n        </div>\n        <div className=\"result-footer\">\n          <span>\n            {`${String(data.participateUserCount ?? 0)}${locale?.total}`}\n          </span>\n          <span>{dayjs(data.endTime).format('YYYY-MM-DD HH:mm:ss')} {locale?.expired}</span>\n          {!data.hasEnded && !isPublish && <span onClick={handleReVote}>{userOptionTicketed ? locale?.reVote : locale?.submit}</span>}\n        </div>\n      </ResultWrapper>\n    </ContainerWrapper>\n  );\n};\n\nexport default Result;\n"],"file":"result.js"}