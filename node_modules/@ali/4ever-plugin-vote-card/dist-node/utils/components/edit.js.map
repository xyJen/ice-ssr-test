{"version":3,"sources":["../../../../src/utils/components/edit.tsx"],"names":["Option","Select","MAX_OPTIONS_LENGTH","Edit","React","memo","props","controller","node","locale","isSelected","data","setData","titleRef","optionRef","modifyData","voteId","optionInfoList","modifyList","optionHeightRef","draggingObj","form","setForm","state","draft","options","handleCancel","run","collectModifyData","realData","current","forEach","item","addOptions","filter","optionId","content","map","operationType","EnumModifyType","ADD","handleBlurContent","index","e","persist","target","collectModifyKey","MODIFY","value","handleContentChange","key","id","type","DELETE","push","MOVE","pos","includes","handleTitleChange","title","handleAdd","length","userOptionTicket","optionTicket","handleRemove","_","i","handleSave","handleDragStart","dragging","rect","getBoundingClientRect","offset","optionsRect","height","handleDragOver","targetRect","top","handleClickShowTicket","showTicketBeforeVoting","handleChangeEndTime","endTime","valueOf","handleVoteTypeChange","voteType","Number","handleDragEnd","finallyIndex","Math","floor","targetIndex","max","min","temp","saveDisable","currentDate","disabledDate","date","add","totalVoteCount","width","String","EnumVoteType","RADIO","radio","CHECKBOX","checkbox","titlePlaceholder","stopPropagation","preventDefault","environment","IS_SAFARI","optionPlaceholder","disabled","v","deadline","format","noDeadline","resultShow","afterVote","always","checked","Boolean","cancel","save"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;AACA;;uBAZ4B,a;AAkB5B,MAAM;AAAEA,EAAAA;AAAF,IAAaC,gBAAnB;AAEA,MAAMC,kBAAkB,GAAG,EAA3B;;wBAwSY,eAAC,iBAAD,O;;yBA8BQ,eAAC,qBAAD,O;;yBA6BV,eAAC,wBAAD,O;;yBAcQ,eAAC,mCAAD,O;;AAzVlB,MAAMC,IAAsB,gBAAGC,eAAMC,IAAN,CAAYC,KAAD,IAAmB;AAC3D,QAAM;AAAEC,IAAAA,UAAF;AAAcC,IAAAA,IAAd;AAAoBC,IAAAA,MAApB;AAA4BC,IAAAA,UAA5B;AAAwCC,IAAAA,IAAxC;AAA8CC,IAAAA;AAA9C,MAA0DN,KAAhE;AACA,QAAMO,QAAQ,GAAG,mBAAyB,IAAzB,CAAjB;AACA,QAAMC,SAAS,GAAG,mBAAuB,IAAvB,CAAlB;AACA,QAAMC,UAAU,GAAG,mBAAoB;AACrCC,IAAAA,MAAM,EAAEL,IAAI,CAACK,MADwB;AAErCC,IAAAA,cAAc,EAAE;AAFqB,GAApB,CAAnB;AAIA,QAAMC,UAAU,GAAG,mBAAiB,EAAjB,CAAnB;AACA,QAAMC,eAAe,GAAG,mBAAe,CAAf,CAAxB;AACA,QAAMC,WAAW,GAAG,oBAApB,CAV2D,CAW3D;;AACA,QAAM,CAACC,IAAD,EAAOC,OAAP,IAAkB,qBAAoBX,IAApB,CAAxB;AAEA,wBAAU,MAAM,CACd;AACD,GAFD,EAEG,CAACD,UAAD,CAFH;AAIA,wBAAU,MAAM;AACdY,IAAAA,OAAO,CAAEC,KAAD,IAAW;AACjB,aAAO,oBAAQA,KAAR,EAAgBC,KAAD,IAAW;AAC/B;AACAA,QAAAA,KAAK,GAAGb,IAAR;AACD,OAHM,CAAP;AAID,KALM,CAAP;AAMD,GAPD,EAOG,CAACA,IAAD,CAPH;AASA,QAAMc,OAAO,GAAG,oBAAQ,MAAM;AAC5B,WAAO,qBAAQJ,IAAI,CAACJ,cAAb,EAA6B,KAA7B,CAAP;AACD,GAFe,EAEb,CAACI,IAAD,CAFa,CAAhB;AAIA,QAAMK,YAAY,GAAG,wBAAY,MAAM;AACrCnB,IAAAA,UAAU,CAACoB,GAAX,CAAe,UAAf,EAA2B,4BAAcnB,IAAd,EAAoBG,IAApB,CAA3B;AACD,GAFoB,EAElB,EAFkB,CAArB;AAIA,QAAMiB,iBAAiB,GAAG,wBAAaC,QAAD,IAAc;AAClD,QAAI,CAACA,QAAQ,CAACb,MAAd,EAAsB,OAD4B,CAElD;;AACAE,IAAAA,UAAU,CAACY,OAAX,CAAmBC,OAAnB,CAA2BC,IAAI,IAAI;AACjC,UAAIH,QAAQ,CAACG,IAAD,CAAR,KAAmBX,IAAI,CAACW,IAAD,CAA3B,EAAmC;AACjCjB,QAAAA,UAAU,CAACe,OAAX,CAAmBE,IAAnB,IAA2BX,IAAI,CAACW,IAAD,CAA/B;AACD;AACF,KAJD;AAMA,UAAMC,UAAU,GAAGZ,IAAI,CAACJ,cAAL,CAAoBiB,MAApB,CAA2BF,IAAI,IAAI,CAACA,IAAI,CAACG,QAAN,IAAkBH,IAAI,CAACI,OAA1D,CAAnB;AACArB,IAAAA,UAAU,CAACe,OAAX,CAAmBb,cAAnB,GAAoC,CAAC,IAAIF,UAAU,CAACe,OAAX,CAAmBb,cAAnB,IAAqC,EAAzC,CAAD,EAClC,GAAGgB,UAAU,CAACI,GAAX,CAAgBL,IAAD,KAAW,EAAE,GAAGA,IAAL;AAAWM,MAAAA,aAAa,EAAEC,sBAAeC;AAAzC,KAAX,CAAf,CAD+B,CAApC;AAED,GAZyB,EAYvB,CAACnB,IAAD,CAZuB,CAA1B,CAnC2D,CAiD3D;;AACA,QAAMoB,iBAAiB,GAAG,wBAAY,CAACC,KAAD,EAAQC,CAAR,KAAmD;AACvFA,IAAAA,CAAC,CAACC,OAAF;AACA,UAAMC,MAAM,GAAGpB,OAAO,CAACiB,KAAD,CAAtB;AACAI,IAAAA,gBAAgB,CAAC,YAAD,EAAeD,MAAM,CAACV,QAAtB,EAAgCI,sBAAeQ,MAA/C,EAAuDJ,CAAC,CAACE,MAAF,CAASG,KAAhE,CAAhB;AACD,GAJyB,EAIvB,CAACvB,OAAD,CAJuB,CAA1B,CAlD2D,CAwD3D;;AACA,QAAMwB,mBAAmB,GAAG,wBAAY,CAACP,KAAD,EAAQC,CAAR,KAAmD;AACzFA,IAAAA,CAAC,CAACC,OAAF;AACAtB,IAAAA,OAAO,CAAEC,KAAD,IAAW;AACjB,aAAO,oBAAQA,KAAR,EAAgBC,KAAD,IAAW;AAC/BA,QAAAA,KAAK,CAACP,cAAN,CAAqByB,KAArB,EAA4BN,OAA5B,GAAsCO,CAAC,CAACE,MAAF,EAAUG,KAAhD;AACD,OAFM,CAAP;AAGD,KAJM,CAAP;AAKD,GAP2B,EAOzB,CAACvB,OAAD,CAPyB,CAA5B,CAzD2D,CAkE3D;;AACA,QAAMqB,gBAAgB,GAAG,wBAAY,CAACI,GAAD,EAAcC,EAAd,EAA2BC,IAA3B,EAAkDhB,OAAlD,KAAgF;AACnH;AACA,QAAI,CAACzB,IAAI,CAACK,MAAV,EAAkB;;AAClB,QAAIkC,GAAG,KAAK,YAAZ,EAA0B;AACxB,UAAI,CAACC,EAAL,EAAS;;AACT,UAAIC,IAAI,KAAKb,sBAAec,MAA5B,EAAoC;AAClCtC,QAAAA,UAAU,CAACe,OAAX,CAAmBb,cAAnB,EAAmCqC,IAAnC,CAAwC;AAAEnB,UAAAA,QAAQ,EAAEgB,EAAZ;AAAgBb,UAAAA,aAAa,EAAEC,sBAAec;AAA9C,SAAxC;AACD,OAFD,MAEO,IAAID,IAAI,KAAKb,sBAAeQ,MAA5B,EAAoC;AACzCX,QAAAA,OAAO,GACLrB,UAAU,CAACe,OAAX,CAAmBb,cAAnB,EAAmCqC,IAAnC,CAAwC;AAAEnB,UAAAA,QAAQ,EAAEgB,EAAZ;AAAgBb,UAAAA,aAAa,EAAEC,sBAAeQ,MAA9C;AAAsDX,UAAAA,OAAO,EAAEA;AAA/D,SAAxC,CADK,GAEHrB,UAAU,CAACe,OAAX,CAAmBb,cAAnB,EAAmCqC,IAAnC,CAAwC;AAAEnB,UAAAA,QAAQ,EAAEgB,EAAZ;AAAgBb,UAAAA,aAAa,EAAEC,sBAAec;AAA9C,SAAxC,CAFJ;AAGD,OAJM,MAIA,IAAID,IAAI,KAAKb,sBAAegB,IAA5B,EAAkC;AACvCxC,QAAAA,UAAU,CAACe,OAAX,CAAmBb,cAAnB,EAAmCqC,IAAnC,CAAwC;AAAEnB,UAAAA,QAAQ,EAAEgB,EAAZ;AAAgBb,UAAAA,aAAa,EAAEC,sBAAegB,IAA9C;AAAoDC,UAAAA,GAAG,EAAEpB;AAAzD,SAAxC;AACD;;AAED;AACD;;AAED,QAAI,CAAClB,UAAU,CAACY,OAAX,CAAmB2B,QAAnB,CAA4BP,GAA5B,CAAL,EAAuC;AACrChC,MAAAA,UAAU,CAACY,OAAX,CAAmBwB,IAAnB,CAAwBJ,GAAxB;AACD;AACF,GArBwB,EAqBtB,CAACvC,IAAD,CArBsB,CAAzB,CAnE2D,CA0F3D;;AACA,QAAM+C,iBAAiB,GAAG,wBAAaf,CAAD,IAA4C;AAChFA,IAAAA,CAAC,CAACC,OAAF;AACAE,IAAAA,gBAAgB,CAAC,OAAD,CAAhB;AACAxB,IAAAA,OAAO,CAAEC,KAAD,IAAW;AACjB,aAAO,oBAAQA,KAAR,EAAgBC,KAAD,IAAW;AAC/BA,QAAAA,KAAK,CAACmC,KAAN,GAAchB,CAAC,CAACE,MAAF,EAAUG,KAAxB;AACD,OAFM,CAAP;AAGD,KAJM,CAAP;AAKD,GARyB,EAQvB,EARuB,CAA1B,CA3F2D,CAqG3D;;AACA,QAAMY,SAAS,GAAG,wBAAY,MAAM;AAClC,QAAIvC,IAAI,CAACJ,cAAL,CAAoB4C,MAApB,IAA8B3D,kBAAlC,EAAsD;AACpD;AACD;;AACDoB,IAAAA,OAAO,CAAEC,KAAD,IAAW;AACjB,aAAO,oBAAQA,KAAR,EAAgBC,KAAD,IAAW;AAC/BA,QAAAA,KAAK,CAACP,cAAN,GACE,CAAC,GAAGM,KAAK,CAACN,cAAV,EACE;AACEmB,UAAAA,OAAO,EAAE,EADX;AAEEoB,UAAAA,GAAG,EAAEjC,KAAK,CAACN,cAAN,CAAqBM,KAAK,CAACN,cAAN,CAAqB4C,MAArB,GAA8B,CAAnD,EAAsDL,GAAtD,GAA4D,CAFnE;AAGEM,UAAAA,gBAAgB,EAAE,CAHpB;AAIEC,UAAAA,YAAY,EAAE;AAJhB,SADF,CADF;AASD,OAVM,CAAP;AAWD,KAZM,CAAP;AAaD,GAjBiB,EAiBf,CAAC1C,IAAD,CAjBe,CAAlB,CAtG2D,CAyH3D;;AACA,QAAM2C,YAAY,GAAG,wBAAatB,KAAD,IAAmB;AAClD,UAAMG,MAAM,GAAGpB,OAAO,CAACiB,KAAD,CAAtB;AACAI,IAAAA,gBAAgB,CAAC,YAAD,EAAeD,MAAM,CAACV,QAAtB,EAAgCI,sBAAec,MAA/C,CAAhB;AACA/B,IAAAA,OAAO,CAAEC,KAAD,IAAW;AACjB,aAAO,oBAAQA,KAAR,EAAgBC,KAAD,IAAW;AAC/BA,QAAAA,KAAK,CAACP,cAAN,GAAuBM,KAAK,CAACN,cAAN,CAAqBiB,MAArB,CAA4B,CAAC+B,CAAD,EAAIC,CAAJ,KAAUxB,KAAK,KAAKwB,CAAhD,CAAvB;AACD,OAFM,CAAP;AAGD,KAJM,CAAP;AAKD,GARoB,EAQlB,CAAC7C,IAAD,CARkB,CAArB;AAUA,QAAM8C,UAAU,GAAG,wBAAY,YAAY;AACzCvC,IAAAA,iBAAiB,CAACjB,IAAD,CAAjB;AAEAJ,IAAAA,UAAU,CAACoB,GAAX,CAAe,UAAf,EAA2B,uBAAS;AAClCnB,MAAAA,IADkC;AAElCG,MAAAA,IAAI,EAAEA,IAAI,CAACK,MAAL,GAAcD,UAAU,CAACe,OAAzB,GAAgD,EACpD,GAAGT,IADiD;AAEpDJ,QAAAA,cAAc,EAAEI,IAAI,CAACJ,cAAL,CAAoBiB,MAApB,CAA2B,CAAC;AAAEE,UAAAA;AAAF,SAAD,KAAiBA,OAA5C;AAFoC,OAFpB;AAMlCxB,MAAAA;AANkC,KAAT,CAA3B;AAQD,GAXkB,EAWhB,CAACJ,IAAD,EAAOa,IAAP,EAAaV,IAAI,CAACK,MAAlB,CAXgB,CAAnB;AAaA,QAAMoD,eAAe,GAAG,wBAAY,CAACzB,CAAD,EAAID,KAAJ,KAAsB;AACxD,UAAM2B,QAAQ,GAAG1B,CAAC,CAACE,MAAnB;AACAzB,IAAAA,WAAW,CAACU,OAAZ,GAAsB;AACpBY,MAAAA,KADoB;AAEpB4B,MAAAA,IAAI,EAAED,QAAQ,CAACE,qBAAT,EAFc;AAGpBC,MAAAA,MAAM,EAAE;AAHY,KAAtB;AAKD,GAPuB,EAOrB,EAPqB,CAAxB;AASA;;AACA,wBAAU,MAAM;AACd,QAAI,CAAC1D,SAAS,CAACgB,OAAf,EAAwB;AACxB,UAAM2C,WAAW,GAAG3D,SAAS,CAACgB,OAAV,CAAkByC,qBAAlB,EAApB;AACApD,IAAAA,eAAe,CAACW,OAAhB,GAA0B2C,WAAW,CAACC,MAAZ,GAAqBrD,IAAI,CAACJ,cAAL,CAAoB4C,MAAnE;AACD,GAJD,EAIG,CAACxC,IAAI,CAACJ,cAAN,CAJH;AAMA,QAAM0D,cAAc,GAAG,wBAAahC,CAAD,IAAO;AACxC,QAAI,CAACvB,WAAW,CAACU,OAAjB,EAA0B;AAC1B,UAAMe,MAAM,GAAGF,CAAC,CAACE,MAAjB;AACA,UAAM+B,UAAU,GAAG/B,MAAM,CAAC0B,qBAAP,EAAnB;AACAnD,IAAAA,WAAW,CAACU,OAAZ,CAAoB0C,MAApB,GAA6BI,UAAU,CAACC,GAAX,GAAiBzD,WAAW,CAACU,OAAZ,CAAoBwC,IAApB,CAAyBO,GAAvE;AACD,GALsB,EAKpB,EALoB,CAAvB;AAOA,QAAMC,qBAAqB,GAAG,wBAAY,MAAM;AAC9ChC,IAAAA,gBAAgB,CAAC,wBAAD,CAAhB;AACAxB,IAAAA,OAAO,CAAEC,KAAD,IAAW;AACjB,aAAO,oBAAQA,KAAR,EAAeC,KAAK,IAAI;AAC7BA,QAAAA,KAAK,CAACuD,sBAAN,GAA+B,CAACxD,KAAK,CAACwD,sBAAtC;AACD,OAFM,CAAP;AAGD,KAJM,CAAP;AAKD,GAP6B,EAO3B,EAP2B,CAA9B;AASA,QAAMC,mBAAmB,GAAG,wBAAarC,CAAD,IAAO;AAC7CG,IAAAA,gBAAgB,CAAC,SAAD,CAAhB;AACAxB,IAAAA,OAAO,CAAEC,KAAD,IAAW;AACjB,aAAO,oBAAQA,KAAR,EAAeC,KAAK,IAAI;AAC7BA,QAAAA,KAAK,CAACyD,OAAN,GAAgB,oBAAMtC,CAAN,EAASuC,OAAT,EAAhB;AACD,OAFM,CAAP;AAGD,KAJM,CAAP;AAKD,GAP2B,EAOzB,EAPyB,CAA5B;AASA,QAAMC,oBAAoB,GAAG,wBAAaxC,CAAD,IAAO;AAC9CG,IAAAA,gBAAgB,CAAC,UAAD,CAAhB;AACAxB,IAAAA,OAAO,CAAEC,KAAD,IAAW;AACjB,aAAO,oBAAQA,KAAR,EAAeC,KAAK,IAAI;AAC7BA,QAAAA,KAAK,CAAC4D,QAAN,GAAiBC,MAAM,CAAC1C,CAAD,CAAvB;AACD,OAFM,CAAP;AAGD,KAJM,CAAP;AAKD,GAP4B,EAO1B,EAP0B,CAA7B,CA1L2D,CAmM3D;;AACA,QAAM2C,aAAa,GAAG,wBAAY,MAAM;AACtC,QAAI,CAAClE,WAAW,CAACU,OAAjB,EAA0B;AAE1B,UAAM;AAAEY,MAAAA,KAAF;AAAS8B,MAAAA;AAAT,QAAoBpD,WAAW,CAACU,OAAtC;AAEA,UAAMyD,YAAY,GAAG7C,KAAK,GAAG8C,IAAI,CAACC,KAAL,CAAWjB,MAAM,GAAGrD,eAAe,CAACW,OAApC,CAA7B;AACA,UAAM4D,WAAW,GAAGF,IAAI,CAACG,GAAL,CAAS,CAAT,EAAYH,IAAI,CAACI,GAAL,CAASL,YAAT,EAAuB9D,OAAO,CAACoC,MAAR,GAAiB,CAAxC,CAAZ,CAApB,CANsC,CAQtC;;AACA,QAAI6B,WAAW,KAAKhD,KAApB,EAA2B;AAE3BpB,IAAAA,OAAO,CAAEC,KAAD,IAAW;AACjB,aAAO,oBAAQA,KAAR,EAAeC,KAAK,IAAI;AAC7B,cAAMqE,IAAI,GAAG,qBAAQtE,KAAK,CAACN,cAAd,EAA8B,KAA9B,EAAqCoB,GAArC,CAAyC,CAACL,IAAD,EAAOkC,CAAP,KAAa;AACjE,cAAIA,CAAC,KAAKxB,KAAV,EAAiB,OAAOV,IAAP;AAEjB,cAAIwB,GAAG,GAAGxB,IAAI,CAACwB,GAAf;;AACA,cAAIkC,WAAW,KAAK,CAApB,EAAuB;AACrB;AACAlC,YAAAA,GAAG,GAAGjC,KAAK,CAACN,cAAN,CAAqB,CAArB,EAAwBuC,GAAxB,GAA8B,CAApC;AACD,WAHD,MAGO,IAAIkC,WAAW,KAAKnE,KAAK,CAACN,cAAN,CAAqB4C,MAArB,GAA8B,CAAlD,EAAqD;AAC1D;AACAL,YAAAA,GAAG,GAAGjC,KAAK,CAACN,cAAN,CAAqBM,KAAK,CAACN,cAAN,CAAqB4C,MAArB,GAA8B,CAAnD,EAAsDL,GAAtD,GAA4D,CAAlE;AACD,WAHM,MAGA;AACL;AACAA,YAAAA,GAAG,GAAG,CAACjC,KAAK,CAACN,cAAN,CAAqByE,WAArB,EAAkClC,GAAlC,GAAwCjC,KAAK,CAACN,cAAN,CAAqByE,WAAW,GAAG,CAAnC,EAAsClC,GAA/E,IAAsF,CAA5F;AACD;;AAEDV,UAAAA,gBAAgB,CAAC,YAAD,EAAed,IAAI,CAACG,QAApB,EAA8BI,sBAAegB,IAA7C,EAAmDC,GAAnD,CAAhB;AAEA,iBAAO,EACL,GAAGxB,IADE;AAELwB,YAAAA;AAFK,WAAP;AAID,SArBY,CAAb;AAuBAhC,QAAAA,KAAK,CAACP,cAAN,GAAuB,CAAC,GAAG,qBAAQ4E,IAAR,EAAc,KAAd,CAAJ,CAAvB;AACD,OAzBM,CAAP;AA0BD,KA3BM,CAAP;AA4BD,GAvCqB,EAuCnB,CAACpE,OAAD,CAvCmB,CAAtB;AAyCA,QAAMqE,WAAW,GAAG,oBAAQ,MAAM;AAChC;AACA,QAAI,CAACzE,IAAI,CAACsC,KAAV,EAAiB,OAAO,IAAP;AACjB,QAAItC,IAAI,CAACJ,cAAL,CAAoBiB,MAApB,CAA2BF,IAAI,IAAIA,IAAI,CAACI,OAAxC,EAAiDyB,MAAjD,GAA0D,CAA9D,EAAiE,OAAO,IAAP;AACjE,WAAO,KAAP;AACD,GALmB,EAKjB,CAACxC,IAAD,CALiB,CAApB;AAOA,QAAM0E,WAAW,GAAG,qBAApB;AACA,QAAMC,YAAY,GAAG,wBAAaC,IAAD,IAAU;AACzC,QAAI,CAACA,IAAL,EAAW;AACT,aAAO,KAAP;AACD;;AACD,WAAOA,IAAI,CAACf,OAAL,MAAkBa,WAAW,CAACG,GAAZ,CAAgB,CAAC,CAAjB,EAAoB,KAApB,EAA2BhB,OAA3B,EAAzB;AACD,GALoB,EAKlB,EALkB,CAArB;AAMA,sBACE,eAAC,wBAAD;AACE,IAAA,UAAU,EAAExE,UADd;AAEE,qCAFF;AAGE,iBAAU,MAHZ;AAIE,mBAAY;AAJd,kBAME,eAAC,4BAAD,qBACE;AAAK,IAAA,SAAS,EAAC;AAAf,kBACE,eAAC,0BAAD,qBACE,eAAC,gBAAD;AACE,IAAA,QAAQ,EAAEC,IAAI,CAACwF,cAAL,GAAsB,CADlC;AAEE,IAAA,KAAK,EAAE;AAAEC,MAAAA,KAAK,EAAE;AAAT,KAFT;AAGE,IAAA,KAAK,EAAEC,MAAM,CAAChF,IAAI,CAAC+D,QAAN,CAHf;AAIE,IAAA,QAAQ,EAAED,oBAJZ;AAKE,IAAA,MAAM,EAAC,MALT;AAME,IAAA,SAAS,EAAC;AANZ,kBAQE,eAAC,MAAD;AAAQ,IAAA,GAAG,EAAC,OAAZ;AAAoB,IAAA,KAAK,EAAEkB,MAAM,CAACC,oBAAaC,KAAd;AAAjC,KAAyD9F,MAAM,EAAE+F,KAAjE,CARF,eASE,eAAC,MAAD;AAAQ,IAAA,GAAG,EAAC,UAAZ;AAAuB,IAAA,KAAK,EAAEH,MAAM,CAACC,oBAAaG,QAAd;AAApC,KAA+DhG,MAAM,EAAEiG,QAAvE,CATF,CADF,OADF,eAeE,eAAC,yBAAD;AACE,mBAAY,sBADd;AAEE,IAAA,GAAG,EAAE7F,QAFP;AAGE,IAAA,IAAI,EAAC,MAHP;AAIE,IAAA,QAAQ,EAAE6C,iBAJZ;AAKE,IAAA,KAAK,EAAErC,IAAI,CAACsC,KALd;AAME,IAAA,SAAS,EAAE,GANb;AAOE,IAAA,WAAW,EAAElD,MAAM,EAAEkG;AAPvB,IAfF,CADF,eA0BE;AAAK,IAAA,SAAS,EAAC,iBAAf;AAAiC,mBAAY,wBAA7C;AAAsE,IAAA,GAAG,EAAE7F;AAA3E,KAEIW,OAAO,CAACY,GAAR,CAAY,CAACL,IAAD,EAAOU,KAAP,kBAER;AACE,IAAA,GAAG,EAAEV,IAAI,CAACG,QAAL,IAAiBO,KADxB;AAEE,IAAA,SAAS,EAAErB,IAAI,CAACJ,cAAL,CAAoB4C,MAApB,GAA6B,CAF1C;AAGE,IAAA,SAAS,EAAEyB,aAHb;AAIE,IAAA,UAAU,EAAEX,cAJd;AAKE,IAAA,WAAW,EAAGhC,CAAD,IAAOyB,eAAe,CAACzB,CAAD,EAAID,KAAJ;AALrC,kBAOE;AACE,IAAA,SAAS,EACP,yBAAW;AACT,mBAAarB,IAAI,CAACJ,cAAL,CAAoB4C,MAApB,GAA6B;AADjC,KAAX;AAFJ,WAPF,eAgBE,eAAC,2BAAD;AACE,IAAA,WAAW,EAAElB,CAAC,IAAI;AAAEA,MAAAA,CAAC,CAACiE,eAAF;AAAqBjE,MAAAA,CAAC,CAACkE,cAAF;AAAqB,KADhE;AAEE,IAAA,SAAS,EAAE,CAACC,yBAAYC,SAF1B;AAGE,IAAA,IAAI,EAAC,MAHP;AAIE,IAAA,KAAK,EAAE/E,IAAI,CAACI,OAJd;AAKE,IAAA,SAAS,EAAE,GALb;AAME,IAAA,QAAQ,EAAGO,CAAD,IAAOM,mBAAmB,CAACP,KAAD,EAAQC,CAAR,CANtC;AAOE,IAAA,MAAM,EAAGA,CAAD,IAAOF,iBAAiB,CAACC,KAAD,EAAQC,CAAR,CAPlC;AAQE,IAAA,WAAW,EAAG,GAAElC,MAAM,EAAEuG,iBAAkB,IAAGtE,KAAK,GAAG,CAAE;AARzD,IAhBF,eA0BE,eAAC,0BAAD,QAEIjB,OAAO,CAACoC,MAAR,GAAiB,CAAjB,iBACA,eAAC,2BAAD;AAAqB,IAAA,OAAO,EAAE,MAAMG,YAAY,CAACtB,KAAD;AAAhD,IAHJ,CA1BF,CAFJ,CAFJ,CA1BF,eAkEE;AACE,IAAA,SAAS,EAAE,yBAAW;AACpB,qBAAe,IADK;AAEpBuE,MAAAA,QAAQ,EAAExF,OAAO,CAACoC,MAAR,IAAkB3D;AAFR,KAAX,CADb;AAKE,IAAA,OAAO,EAAE0D;AALX,YAQGnD,MAAM,EAAEyF,GARX,CAlEF,eA4EE;AAAK,IAAA,SAAS,EAAC;AAAf,kBACE,eAAC,oBAAD;AACE,IAAA,QAAQ,MADV;AAEE,IAAA,YAAY,EAAEF,YAFhB;AAGE,IAAA,aAAa,EAAGkB,CAAD,IAAO;AACpB,0BACE,eAAC,yBAAD,QACGzG,MAAM,EAAE0G,QADX,eAEE,6BACGD,CAAC,GAAGA,CAAC,CAACE,MAAF,CAAS,qBAAT,CAAH,GAAqC3G,MAAM,EAAE4G,UADjD,CAFF,QADF;AASD,KAbH;AAcE,IAAA,YAAY,EAAE,oBAAMhG,IAAI,CAAC4D,OAAX,CAdhB;AAeE,IAAA,QAAQ,EAAED,mBAfZ;AAgBE,IAAA,KAAK,EAAE;AAAEoB,MAAAA,KAAK,EAAE;AAAT,KAhBT;AAiBE,IAAA,MAAM,EAAC,YAjBT;AAkBE,IAAA,MAAM,EAAC,IAlBT;AAmBE,IAAA,UAAU;AAnBZ,IADF,CA5EF,eAmGE;AAAK,IAAA,SAAS,EAAC;AAAf,kBACE,6BAAO3F,MAAM,EAAE6G,UAAf,CADF,EAEG,CAAC7G,MAAM,EAAE8G,SAAT,EAAoB9G,MAAM,EAAE+G,MAA5B,EAAoCnF,GAApC,CAAyC,CAACL,IAAD,EAAOU,KAAP,kBACxC;AAAK,IAAA,OAAO,EAAEoC;AAAd,kBACE;AAAM,IAAA,SAAS,EAAE,yBAAW;AAC1B2C,MAAAA,OAAO,EAAEpG,IAAI,CAAC0D,sBAAL,KAAgC2C,OAAO,CAAChF,KAAD;AADtB,KAAX;AAAjB,IADF,EAKGV,IALH,CADD,CAFH,eAWE,yCACE,eAAC,oBAAD;AAAQ,IAAA,OAAO,EAAEN;AAAjB,KAAgCjB,MAAM,EAAEkH,MAAxC,CADF,eAEE,eAAC,oBAAD;AAAQ,iBAAU,QAAlB;AAA2B,IAAA,QAAQ,EAAE7B,WAArC;AAAkD,IAAA,IAAI,EAAC,SAAvD;AAAiE,IAAA,OAAO,EAAE3B;AAA1E,KAAuF1D,MAAM,EAAEmH,IAA/F,CAFF,CAXF,CAnGF,CANF,CADF;AA6HD,CAxX8B,CAA/B;;eA0XezH,I","sourcesContent":["import React, { useCallback, useMemo, useEffect, useState, useRef } from 'react';\nimport { environment } from '@ali/4ever-cangjie';\nimport { Block, Controller } from '@ali/4ever-cangjie';\nimport classnames from 'classnames';\nimport { orderBy } from 'lodash-es';\nimport produce from 'immer';\nimport dayjs from 'dayjs';\nimport { ToolbarAddNormal, SelectArrowDownNormalNormal, DragallNormal, ToolbarDeleteNormal } from '@ali/we-icon';\nimport { Select, DatePicker } from '@ali/we-design';\nimport { Button } from '@ali/we-design-next';\nimport type { VotePluginConfig, IVoteData, IModifyOptionInfo } from '../types';\nimport { EnumVoteType, EnumModifyType } from '../types';\nimport { cancelEditing, voteSave } from '../actions';\nimport {\n  ContainerWrapper, ContainerEditWrapper,\n  DatePickerWrapper, InputTitleWrapper, InputContentWrapper,\n  InputPrefixWrapper, Separator, InputSuffixWrapper,\n} from './styled';\n\nconst { Option } = Select;\n\nconst MAX_OPTIONS_LENGTH = 50;\n\ntype DraggingProps = {\n  index: number;\n  offset: number;\n  rect: {\n    [x: string]: number;\n  };\n};\n\ninterface IModifyData {\n  voteId?: string;\n  optionInfoList: IModifyOptionInfo[];\n}\n\ninterface IProps {\n  node: Block;\n  locale: VotePluginConfig['locale'];\n  controller: Controller;\n  isSelected?: boolean;\n  data: IVoteData;\n  setData: React.Dispatch<React.SetStateAction<IVoteData>>;\n}\n\nconst Edit: React.FC<IProps> = React.memo((props: IProps) => {\n  const { controller, node, locale, isSelected, data, setData } = props;\n  const titleRef = useRef<HTMLInputElement>(null);\n  const optionRef = useRef<HTMLDivElement>(null);\n  const modifyData = useRef<IModifyData>({\n    voteId: data.voteId,\n    optionInfoList: [],\n  });\n  const modifyList = useRef<string[]>([]);\n  const optionHeightRef = useRef<number>(0);\n  const draggingObj = useRef<DraggingProps>();\n  // @ts-ignore\n  const [form, setForm] = useState<IVoteData>(data as IVoteData);\n\n  useEffect(() => {\n    // isSelected && titleRef.current?.focus();\n  }, [isSelected]);\n\n  useEffect(() => {\n    setForm((state) => {\n      return produce(state, (draft) => {\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        draft = data;\n      });\n    });\n  }, [data]);\n\n  const options = useMemo(() => {\n    return orderBy(form.optionInfoList, 'pos');\n  }, [form]);\n\n  const handleCancel = useCallback(() => {\n    controller.run('onAction', cancelEditing(node, data));\n  }, []);\n\n  const collectModifyData = useCallback((realData) => {\n    if (!realData.voteId) return;\n    // title, voteType, endTime, showTicketBeforeVoting 变化\n    modifyList.current.forEach(item => {\n      if (realData[item] !== form[item]) {\n        modifyData.current[item] = form[item];\n      }\n    });\n\n    const addOptions = form.optionInfoList.filter(item => !item.optionId && item.content);\n    modifyData.current.optionInfoList = [...(modifyData.current.optionInfoList ?? []),\n      ...addOptions.map((item) => ({ ...item, operationType: EnumModifyType.ADD }))];\n  }, [form]);\n\n  // 内容修改结束\n  const handleBlurContent = useCallback((index, e: React.ChangeEvent<HTMLInputElement>) => {\n    e.persist();\n    const target = options[index];\n    collectModifyKey('optionInfo', target.optionId, EnumModifyType.MODIFY, e.target.value);\n  }, [options]);\n\n  // 内容修改\n  const handleContentChange = useCallback((index, e: React.ChangeEvent<HTMLInputElement>) => {\n    e.persist();\n    setForm((state) => {\n      return produce(state, (draft) => {\n        draft.optionInfoList[index].content = e.target?.value;\n      });\n    });\n  }, [options]);\n\n  // 收集修改内容的 key\n  const collectModifyKey = useCallback((key: string, id?: number, type?: EnumModifyType, content?: string | number) => {\n    // 如果是新增投票，不用收集差异数据\n    if (!data.voteId) return;\n    if (key === 'optionInfo') {\n      if (!id) return;\n      if (type === EnumModifyType.DELETE) {\n        modifyData.current.optionInfoList?.push({ optionId: id, operationType: EnumModifyType.DELETE });\n      } else if (type === EnumModifyType.MODIFY) {\n        content ?\n          modifyData.current.optionInfoList?.push({ optionId: id, operationType: EnumModifyType.MODIFY, content: content! as string })\n          : modifyData.current.optionInfoList?.push({ optionId: id, operationType: EnumModifyType.DELETE });\n      } else if (type === EnumModifyType.MOVE) {\n        modifyData.current.optionInfoList?.push({ optionId: id, operationType: EnumModifyType.MOVE, pos: content! as number });\n      }\n\n      return;\n    }\n\n    if (!modifyList.current.includes(key)) {\n      modifyList.current.push(key);\n    }\n  }, [data]);\n\n  // 标题修改\n  const handleTitleChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    e.persist();\n    collectModifyKey('title');\n    setForm((state) => {\n      return produce(state, (draft) => {\n        draft.title = e.target?.value;\n      });\n    });\n  }, []);\n\n  // 添加\n  const handleAdd = useCallback(() => {\n    if (form.optionInfoList.length >= MAX_OPTIONS_LENGTH) {\n      return;\n    }\n    setForm((state) => {\n      return produce(state, (draft) => {\n        draft.optionInfoList =\n          [...state.optionInfoList,\n            {\n              content: '',\n              pos: state.optionInfoList[state.optionInfoList.length - 1].pos + 1,\n              userOptionTicket: 0,\n              optionTicket: 0,\n            },\n          ];\n      });\n    });\n  }, [form]);\n\n  // 删除\n  const handleRemove = useCallback((index: number) => {\n    const target = options[index];\n    collectModifyKey('optionInfo', target.optionId, EnumModifyType.DELETE);\n    setForm((state) => {\n      return produce(state, (draft) => {\n        draft.optionInfoList = state.optionInfoList.filter((_, i) => index !== i);\n      });\n    });\n  }, [form]);\n\n  const handleSave = useCallback(async () => {\n    collectModifyData(data);\n\n    controller.run('onAction', voteSave({\n      node,\n      data: data.voteId ? modifyData.current as IVoteData : {\n        ...form,\n        optionInfoList: form.optionInfoList.filter(({ content }) => content),\n      },\n      setData,\n    }));\n  }, [node, form, data.voteId]);\n\n  const handleDragStart = useCallback((e, index: number) => {\n    const dragging = e.target;\n    draggingObj.current = {\n      index,\n      rect: dragging.getBoundingClientRect(),\n      offset: 0,\n    };\n  }, []);\n\n  /** 计算 options 的单位高度 */\n  useEffect(() => {\n    if (!optionRef.current) return;\n    const optionsRect = optionRef.current.getBoundingClientRect();\n    optionHeightRef.current = optionsRect.height / form.optionInfoList.length;\n  }, [form.optionInfoList]);\n\n  const handleDragOver = useCallback((e) => {\n    if (!draggingObj.current) return;\n    const target = e.target;\n    const targetRect = target.getBoundingClientRect();\n    draggingObj.current.offset = targetRect.top - draggingObj.current.rect.top;\n  }, []);\n\n  const handleClickShowTicket = useCallback(() => {\n    collectModifyKey('showTicketBeforeVoting');\n    setForm((state) => {\n      return produce(state, draft => {\n        draft.showTicketBeforeVoting = !state.showTicketBeforeVoting;\n      });\n    });\n  }, []);\n\n  const handleChangeEndTime = useCallback((e) => {\n    collectModifyKey('endTime');\n    setForm((state) => {\n      return produce(state, draft => {\n        draft.endTime = dayjs(e).valueOf();\n      });\n    });\n  }, []);\n\n  const handleVoteTypeChange = useCallback((e) => {\n    collectModifyKey('voteType');\n    setForm((state) => {\n      return produce(state, draft => {\n        draft.voteType = Number(e);\n      });\n    });\n  }, []);\n\n  // 拖拽后排序\n  const handleDragEnd = useCallback(() => {\n    if (!draggingObj.current) return;\n\n    const { index, offset } = draggingObj.current;\n\n    const finallyIndex = index + Math.floor(offset / optionHeightRef.current);\n    const targetIndex = Math.max(0, Math.min(finallyIndex, options.length - 1));\n\n    // 位置未发生变化\n    if (targetIndex === index) return;\n\n    setForm((state) => {\n      return produce(state, draft => {\n        const temp = orderBy(state.optionInfoList, 'pos').map((item, i) => {\n          if (i !== index) return item;\n\n          let pos = item.pos;\n          if (targetIndex === 0) {\n            // 拖拽到第一位\n            pos = state.optionInfoList[0].pos / 2;\n          } else if (targetIndex === state.optionInfoList.length - 1) {\n            // 拖拽到最后\n            pos = state.optionInfoList[state.optionInfoList.length - 1].pos + 1;\n          } else {\n            // 拖拽到中间位置\n            pos = (state.optionInfoList[targetIndex].pos + state.optionInfoList[targetIndex - 1].pos) / 2;\n          }\n\n          collectModifyKey('optionInfo', item.optionId, EnumModifyType.MOVE, pos);\n\n          return {\n            ...item,\n            pos,\n          };\n        });\n\n        draft.optionInfoList = [...orderBy(temp, 'pos')];\n      });\n    });\n  }, [options]);\n\n  const saveDisable = useMemo(() => {\n    // title 不能为空\n    if (!form.title) return true;\n    if (form.optionInfoList.filter(item => item.content).length < 2) return true;\n    return false;\n  }, [form]);\n\n  const currentDate = dayjs();\n  const disabledDate = useCallback((date) => {\n    if (!date) {\n      return false;\n    }\n    return date.valueOf() <= currentDate.add(-1, 'day').valueOf();\n  }, []);\n  return (\n    <ContainerWrapper\n      isSelected={isSelected}\n      data-cangjie-not-editable\n      data-role=\"vote\"\n      data-testid=\"card-vote-container-edit\"\n    >\n      <ContainerEditWrapper>\n        <div className=\"editing-header\">\n          <InputPrefixWrapper>\n            <Select\n              disabled={data.totalVoteCount > 0}\n              style={{ width: '60px' }}\n              value={String(form.voteType)}\n              onChange={handleVoteTypeChange}\n              testid=\"test\"\n              styleType=\"toolbar\"\n            >\n              <Option key=\"radio\" value={String(EnumVoteType.RADIO)} >{locale?.radio}</Option>\n              <Option key=\"checkbox\" value={String(EnumVoteType.CHECKBOX)} >{locale?.checkbox}</Option>\n            </Select>\n            <Separator />\n          </InputPrefixWrapper>\n          <InputTitleWrapper\n            data-testid=\"card-vote-edit-title\"\n            ref={titleRef}\n            type=\"text\"\n            onChange={handleTitleChange}\n            value={form.title}\n            maxLength={100}\n            placeholder={locale?.titlePlaceholder}\n          />\n        </div>\n        <div className=\"editing-options\" data-testid=\"card-vote-edit-options\" ref={optionRef}>\n          {\n            options.map((item, index) =>\n              (\n                <div\n                  key={item.optionId || index}\n                  draggable={form.optionInfoList.length > 1}\n                  onDragEnd={handleDragEnd}\n                  onDragOver={handleDragOver}\n                  onDragStart={(e) => handleDragStart(e, index)}\n                >\n                  <span\n                    className={\n                      classnames({\n                        'drag-icon': form.optionInfoList.length > 1,\n                      })\n                    }\n                  >\n                    <DragallNormal />\n                  </span>\n                  <InputContentWrapper\n                    onDragStart={e => { e.stopPropagation(); e.preventDefault(); }}\n                    draggable={!environment.IS_SAFARI}\n                    type=\"text\"\n                    value={item.content}\n                    maxLength={100}\n                    onChange={(e) => handleContentChange(index, e)}\n                    onBlur={(e) => handleBlurContent(index, e)}\n                    placeholder={`${locale?.optionPlaceholder} ${index + 1}`}\n                  />\n                  <InputSuffixWrapper>\n                    {\n                      options.length > 2 &&\n                      <ToolbarDeleteNormal onClick={() => handleRemove(index)} />\n                    }\n                  </InputSuffixWrapper>\n                </div>\n              ))\n          }\n        </div>\n        <div\n          className={classnames({\n            'editing-add': true,\n            disabled: options.length >= MAX_OPTIONS_LENGTH,\n          })}\n          onClick={handleAdd}\n        >\n          <ToolbarAddNormal />\n          {locale?.add}\n        </div>\n        <div className=\"editing-datepicker\">\n          <DatePicker\n            showTime\n            disabledDate={disabledDate}\n            renderTrigger={(v) => {\n              return (\n                <DatePickerWrapper>\n                  {locale?.deadline}\n                  <span>\n                    {v ? v.format('YYYY-MM-DD HH:mm:ss') : locale?.noDeadline}\n                  </span>\n                  <SelectArrowDownNormalNormal />\n                </DatePickerWrapper>\n              );\n            }}\n            defaultValue={dayjs(form.endTime)}\n            onChange={handleChangeEndTime}\n            style={{ width: 280 }}\n            testid=\"DatePicker\"\n            locale=\"ja\"\n            allowClear\n          />\n        </div>\n        <div className=\"editing-footer\">\n          <span>{locale?.resultShow}</span>\n          {[locale?.afterVote, locale?.always].map(((item, index) => (\n            <div onClick={handleClickShowTicket}>\n              <span className={classnames({\n                checked: form.showTicketBeforeVoting === Boolean(index),\n              })}\n              />\n              {item}\n            </div>\n          )))}\n          <div>\n            <Button onClick={handleCancel}>{locale?.cancel}</Button>\n            <Button data-role=\"create\" disabled={saveDisable} type=\"primary\" onClick={handleSave}>{locale?.save}</Button>\n          </div>\n        </div>\n      </ContainerEditWrapper>\n    </ContainerWrapper>\n  );\n});\n\nexport default Edit;\n"],"file":"edit.js"}