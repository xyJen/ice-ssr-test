{"version":3,"sources":["../../../../src/utils/components/voting.tsx"],"names":["Voting","React","memo","props","checked","setChecked","node","locale","controller","isSelected","data","setData","readOnly","userOptionTicketed","optionInfoList","find","item","userOptionTicket","handleVote","length","run","voteId","optionIds","handleCancel","handleChecked","id","includes","filter","i","voteType","EnumVoteType","RADIO","radio","checkbox","title","map","optionId","content","participateUserCount","String","total","endTime","format","expired","showTicketBeforeVoting","cancel","submit"],"mappings":"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","sourcesContent":["import React, { useCallback, useState, useMemo } from 'react';\nimport cls from 'classnames';\nimport dayjs from 'dayjs';\nimport { Controller, Block } from '@ali/4ever-cangjie';\nimport { Button } from '@ali/we-design-next';\nimport { voteSubmit, cancelVoting } from '../actions';\nimport type { VotePluginConfig } from '../types';\nimport { EnumVoteType, IVoteData } from '../types';\nimport HeaderToolbar from './headerToolbar';\nimport { ContainerWrapper, VotingWrapper, TitleReaderWrapper } from './styled';\n\ninterface IProps {\n  node: Block;\n  locale: VotePluginConfig['locale'];\n  controller: Controller;\n  isSelected?: boolean;\n  data: IVoteData;\n  setData: React.Dispatch<React.SetStateAction<IVoteData>>;\n  readOnly?: boolean;\n}\n\nconst Voting: React.FC<IProps> = React.memo((props: IProps) => {\n  const [checked, setChecked] = useState<number[]>([]);\n  const { node, locale, controller, isSelected, data, setData, readOnly } = props;\n\n  // 我是否有投过票\n  const userOptionTicketed = useMemo(() => !!data.optionInfoList?.find((item) => item.userOptionTicket !== 0), [data]);\n\n  const handleVote = useCallback(() => {\n    if (checked.length === 0) return;\n    controller.run('onAction', voteSubmit(\n      {\n        node,\n        voteId: data.voteId!,\n        optionIds: checked,\n        setData,\n      },\n    ));\n  }, [checked, setData]);\n\n  const handleCancel = useCallback(() => {\n    controller.run('onAction', cancelVoting(node));\n  }, [node]);\n\n  const handleChecked = useCallback((id: number) => {\n    if (checked.includes(id)) {\n      setChecked(checked.filter(i => i !== id));\n      return;\n    }\n\n    // 单选只能选一个\n    if (data.voteType === EnumVoteType.RADIO) {\n      setChecked([id]);\n      return;\n    }\n    setChecked([...checked, id]);\n  }, [checked]);\n\n  return (\n    <ContainerWrapper\n      isSelected={isSelected}\n      data-role=\"vote\"\n      data-testid=\"card-vote-container-voting\"\n    >\n      <VotingWrapper>\n        {\n          !controller.readOnly && !readOnly &&\n          <HeaderToolbar\n            controller={controller}\n            node={node}\n          />\n        }\n        <TitleReaderWrapper>\n          <span>\n            {data.voteType === EnumVoteType.RADIO ? locale?.radio : locale?.checkbox}\n          </span>\n          <span data-testid=\"card-vote-voting-title\">\n            {data.title}\n          </span>\n        </TitleReaderWrapper>\n        <div className=\"voting-options\">\n          {\n            data.optionInfoList?.map((item) =>\n              (\n                <div\n                  className={cls({\n                    checked: checked.includes(item.optionId!),\n                  })}\n                  onClick={() => handleChecked(item.optionId!)}\n                >\n                  <span className={data.voteType === EnumVoteType.RADIO ? 'radio' : 'checkbox'} />\n                  <span>{item.content}</span>\n                </div>\n              ))\n          }\n        </div>\n        <div className=\"voting-footer\">\n          <div>\n            {data.participateUserCount > 0 && <span>{`${String(data.participateUserCount ?? 0)}${locale?.total}`} </span>}\n            <span>{dayjs(data.endTime).format('YYYY-MM-DD HH:mm:ss')} {locale?.expired} </span>\n          </div>\n          <div>\n            {((data.showTicketBeforeVoting && data.participateUserCount) || userOptionTicketed) &&\n              <Button className=\"cancel\" data-role=\"cancel\" onClick={handleCancel}>{locale?.cancel}</Button>\n            }\n            <Button data-role=\"submit\" type=\"primary\" disabled={checked.length === 0} onClick={handleVote}>{locale?.submit}</Button>\n          </div>\n        </div>\n      </VotingWrapper>\n    </ContainerWrapper>\n  );\n});\n\nexport default Voting;\n"],"file":"voting.js"}