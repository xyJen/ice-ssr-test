{"version":3,"sources":["../../../../src/utils/components/result.tsx"],"names":["React","useCallback","useMemo","cls","dayjs","votingActive","EnumVoteType","HeaderToolbar","ContainerWrapper","ResultWrapper","TitleReaderWrapper","Result","props","node","locale","controller","isSelected","data","readOnly","isPublish","handleReVote","run","userOptionTicketed","optionInfoList","find","item","userOptionTicket","voteType","RADIO","radio","checkbox","title","map","checked","content","String","optionTicket","unit","totalVoteCount","toFixed","width","participateUserCount","total","endTime","format","expired","hasEnded","reVote","submit"],"mappings":"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","sourcesContent":["import React, { useCallback, useMemo } from 'react';\nimport cls from 'classnames';\nimport dayjs from 'dayjs';\nimport { Controller, Block } from '@ali/4ever-cangjie';\nimport { votingActive } from '../actions';\nimport { EnumVoteType, IVoteData } from '../types';\nimport type { VotePluginConfig } from '../types';\nimport HeaderToolbar from './headerToolbar';\nimport { ContainerWrapper, ResultWrapper, TitleReaderWrapper } from './styled';\n\ninterface IProps {\n  node: Block;\n  locale: VotePluginConfig['locale'];\n  controller: Controller;\n  isSelected?: boolean;\n  data: IVoteData;\n  readOnly?: boolean;\n  isPublish?: boolean;\n}\n\nconst Result: React.FC<IProps> = (props: IProps) => {\n  const { node, locale, controller, isSelected, data, readOnly, isPublish } = props;\n\n  const handleReVote = useCallback(() => {\n    controller.run('onAction', votingActive(node));\n  }, []);\n\n  // 我是否有投过票\n  const userOptionTicketed = useMemo(() => !!data.optionInfoList?.find((item) => item.userOptionTicket !== 0), [data]);\n\n  return (\n    <ContainerWrapper\n      isSelected={isSelected}\n      data-role=\"vote\"\n      data-testid=\"card-vote-container-result\"\n    >\n      <ResultWrapper>\n        {\n          (!controller.readOnly && !readOnly) && !isPublish && \n          <HeaderToolbar\n            controller={controller}\n            node={node}\n          />\n        }\n        <TitleReaderWrapper>\n          <span>\n            {data.voteType === EnumVoteType.RADIO ? locale?.radio : locale?.checkbox}\n          </span>\n          <span data-testid=\"card-vote-result-title\">\n            {data.title}\n          </span>\n        </TitleReaderWrapper>\n        <div className=\"result-options\">\n          {\n            data.optionInfoList?.map((item) =>\n              (\n                <div\n                  className={cls({\n                    checked: item.userOptionTicket !== 0,\n                  })}\n                >\n                  <span>{item.content}</span>\n                  <span>\n                    {`${String(item.optionTicket)} ${locale?.unit}`}\n                    <i />\n                    {(!item.optionTicket || !data.totalVoteCount) ? 0 : ((item.optionTicket ?? 0) / (data.totalVoteCount ?? 0) * 100).toFixed(2)}%\n                  </span>\n                  <div>\n                    <div style={{ width: `${(!item.optionTicket || !data.totalVoteCount) ? 0 : ((item.optionTicket ?? 0) / (data.totalVoteCount ?? 0) * 100).toFixed(2)}%` }} />\n                  </div>\n                </div>\n              ))\n          }\n        </div>\n        <div className=\"result-footer\">\n          <span>\n            {`${String(data.participateUserCount ?? 0)}${locale?.total}`}\n          </span>\n          <span>{dayjs(data.endTime).format('YYYY-MM-DD HH:mm:ss')} {locale?.expired}</span>\n          {!data.hasEnded && !isPublish && <span onClick={handleReVote}>{userOptionTicketed ? locale?.reVote : locale?.submit}</span>}\n        </div>\n      </ResultWrapper>\n    </ContainerWrapper>\n  );\n};\n\nexport default Result;\n"],"file":"result.js"}