{"version":3,"sources":["../../../../src/utils/components/voting.tsx"],"names":["React","useCallback","useState","useMemo","cls","dayjs","Button","voteSubmit","cancelVoting","EnumVoteType","HeaderToolbar","ContainerWrapper","VotingWrapper","TitleReaderWrapper","Voting","memo","props","checked","setChecked","node","locale","controller","isSelected","data","setData","readOnly","userOptionTicketed","optionInfoList","find","item","userOptionTicket","handleVote","length","run","voteId","optionIds","handleCancel","handleChecked","id","includes","filter","i","voteType","RADIO","radio","checkbox","title","map","optionId","content","participateUserCount","String","total","endTime","format","expired","showTicketBeforeVoting","cancel","submit"],"mappings":"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","sourcesContent":["import React, { useCallback, useState, useMemo } from 'react';\nimport cls from 'classnames';\nimport dayjs from 'dayjs';\nimport { Controller, Block } from '@ali/4ever-cangjie';\nimport { Button } from '@ali/we-design-next';\nimport { voteSubmit, cancelVoting } from '../actions';\nimport type { VotePluginConfig } from '../types';\nimport { EnumVoteType, IVoteData } from '../types';\nimport HeaderToolbar from './headerToolbar';\nimport { ContainerWrapper, VotingWrapper, TitleReaderWrapper } from './styled';\n\ninterface IProps {\n  node: Block;\n  locale: VotePluginConfig['locale'];\n  controller: Controller;\n  isSelected?: boolean;\n  data: IVoteData;\n  setData: React.Dispatch<React.SetStateAction<IVoteData>>;\n  readOnly?: boolean;\n}\n\nconst Voting: React.FC<IProps> = React.memo((props: IProps) => {\n  const [checked, setChecked] = useState<number[]>([]);\n  const { node, locale, controller, isSelected, data, setData, readOnly } = props;\n\n  // 我是否有投过票\n  const userOptionTicketed = useMemo(() => !!data.optionInfoList?.find((item) => item.userOptionTicket !== 0), [data]);\n\n  const handleVote = useCallback(() => {\n    if (checked.length === 0) return;\n    controller.run('onAction', voteSubmit(\n      {\n        node,\n        voteId: data.voteId!,\n        optionIds: checked,\n        setData,\n      },\n    ));\n  }, [checked, setData]);\n\n  const handleCancel = useCallback(() => {\n    controller.run('onAction', cancelVoting(node));\n  }, [node]);\n\n  const handleChecked = useCallback((id: number) => {\n    if (checked.includes(id)) {\n      setChecked(checked.filter(i => i !== id));\n      return;\n    }\n\n    // 单选只能选一个\n    if (data.voteType === EnumVoteType.RADIO) {\n      setChecked([id]);\n      return;\n    }\n    setChecked([...checked, id]);\n  }, [checked]);\n\n  return (\n    <ContainerWrapper\n      isSelected={isSelected}\n      data-role=\"vote\"\n      data-testid=\"card-vote-container-voting\"\n    >\n      <VotingWrapper>\n        {\n          !controller.readOnly && !readOnly &&\n          <HeaderToolbar\n            controller={controller}\n            node={node}\n          />\n        }\n        <TitleReaderWrapper>\n          <span>\n            {data.voteType === EnumVoteType.RADIO ? locale?.radio : locale?.checkbox}\n          </span>\n          <span data-testid=\"card-vote-voting-title\">\n            {data.title}\n          </span>\n        </TitleReaderWrapper>\n        <div className=\"voting-options\">\n          {\n            data.optionInfoList?.map((item) =>\n              (\n                <div\n                  className={cls({\n                    checked: checked.includes(item.optionId!),\n                  })}\n                  onClick={() => handleChecked(item.optionId!)}\n                >\n                  <span className={data.voteType === EnumVoteType.RADIO ? 'radio' : 'checkbox'} />\n                  <span>{item.content}</span>\n                </div>\n              ))\n          }\n        </div>\n        <div className=\"voting-footer\">\n          <div>\n            {data.participateUserCount > 0 && <span>{`${String(data.participateUserCount ?? 0)}${locale?.total}`} </span>}\n            <span>{dayjs(data.endTime).format('YYYY-MM-DD HH:mm:ss')} {locale?.expired} </span>\n          </div>\n          <div>\n            {((data.showTicketBeforeVoting && data.participateUserCount) || userOptionTicketed) &&\n              <Button className=\"cancel\" data-role=\"cancel\" onClick={handleCancel}>{locale?.cancel}</Button>\n            }\n            <Button data-role=\"submit\" type=\"primary\" disabled={checked.length === 0} onClick={handleVote}>{locale?.submit}</Button>\n          </div>\n        </div>\n      </VotingWrapper>\n    </ContainerWrapper>\n  );\n});\n\nexport default Voting;\n"],"file":"voting.js"}