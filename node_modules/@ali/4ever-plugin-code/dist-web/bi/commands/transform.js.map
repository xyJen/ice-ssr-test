{"version":3,"sources":["../../../../src/bi/commands/transform.ts"],"names":["Commands","Paragraph","createInsertCode","code2Code","controller","block","lineArr","text","split","command","removeNodeByKey","key","deleteLineForward","withoutNormalizing","forEach","line","insertBlock","type","TYPE","insertText","transform","config","id","blocks","query","array","Array","isArray","length","moveToStartOfNode","blur","push","join","undefined","focus"],"mappings":"AAAA,SAAqBA,QAArB,QAA2C,oBAA3C;AACA,SAASC,SAAT,QAA0B,6BAA1B;AACA,OAAOC,gBAAP;AAEA;AAEA,OAAO,IAAMC,SAAS,GAAG,SAAZA,SAAY,CAACC,UAAD,EAAyBC,KAAzB,EAAyC;AAChE,MAAMC,OAAO,GAAGD,KAAK,CAACE,IAAN,CAAWC,KAAX,CAAiB,IAAjB,CAAhB;AACAJ,EAAAA,UAAU,CACPK,OADH,CACWT,QAAQ,CAACU,eADpB,EACqCL,KAAK,CAACM,GAD3C,EAEGF,OAFH,CAEWT,QAAQ,CAACY,iBAFpB;AAIAR,EAAAA,UAAU,CAACS,kBAAX,CAA8B,YAAM;AAClCP,IAAAA,OAAO,CAACQ,OAAR,CAAgB,UAACC,IAAD,EAAU;AACxBX,MAAAA,UAAU,CACPK,OADH,CACWT,QAAQ,CAACgB,WADpB,EACiC;AAC7BC,QAAAA,IAAI,EAAEhB,SAAS,CAACiB;AADa,OADjC,EAIGT,OAJH,CAIWT,QAAQ,CAACmB,UAJpB,EAIgCJ,IAJhC;AAKD,KAND;AAOD,GARD;AASD,CAfM;AAiBP,OAAO,IAAMK,SAAS,GAAG,SAAZA,SAAY,CAAChB,UAAD,EAAyBiB,MAAzB,EAAmDC,EAAnD,EAA8E;AACrG,MAAMC,MAAM,GAAGnB,UAAU,CAACoB,KAAX,CAAiB,mBAAjB,CAAf;AACA,MAAMC,KAAe,GAAG,EAAxB;;AACA,MAAIC,KAAK,CAACC,OAAN,CAAcJ,MAAd,KAAyBA,MAAM,CAACK,MAAP,GAAgB,CAA7C,EAAgD;AAC9C;AACAxB,IAAAA,UAAU,CACPK,OADH,CACWT,QAAQ,CAAC6B,iBADpB,EACuCN,MAAM,CAAC,CAAD,CAD7C,EAEGd,OAFH,CAEWT,QAAQ,CAACgB,WAFpB,EAEiCf,SAAS,CAACiB,IAF3C,EAGGT,OAHH,CAGWT,QAAQ,CAAC8B,IAHpB;AAKA1B,IAAAA,UAAU,CAACS,kBAAX,CAA8B,YAAM;AAClCU,MAAAA,MAAM,CAACT,OAAP,CAAe,UAACT,KAAD,EAAW;AACxB,YAAIA,KAAK,CAACY,IAAN,KAAe,MAAnB,EAA2B;AACzB,iBAAOd,SAAS,CAACC,UAAD,EAAaC,KAAb,CAAhB;AACD,SAFD,MAEO;AACLoB,UAAAA,KAAK,CAACM,IAAN,CAAW1B,KAAK,CAACE,IAAjB;AACAH,UAAAA,UAAU,CAACK,OAAX,CAAmBT,QAAQ,CAACU,eAA5B,EAA6CL,KAAK,CAACM,GAAnD;AACD;AACF,OAPD;;AAQA,UAAIc,KAAK,CAACG,MAAN,GAAe,CAAnB,EAAsB;AACpB,YAAMrB,IAAI,GAAGkB,KAAK,CAACO,IAAN,CAAW,IAAX,CAAb;AACA,eAAO5B,UAAU,CAACK,OAAX,CAAmBP,gBAAgB,CAACmB,MAAD,CAAnC,EAA6CC,EAA7C,EAAiDf,IAAjD,CAAP;AACD;;AACD,aAAO0B,SAAP;AACD,KAdD;AAgBD;;AACD,SAAO7B,UAAU,CAACK,OAAX,CAAmBT,QAAQ,CAACkC,KAA5B,CAAP;AACD,CA5BM","sourcesContent":["import { Controller, Commands, Node } from '@ali/4ever-cangjie';\nimport { Paragraph } from '@ali/4ever-plugin-paragraph';\nimport createInsertCode from './insertCode';\nimport { CodePluginConfig } from '../types';\n;\n\nexport const code2Code = (controller: Controller, block: Node) => {\n  const lineArr = block.text.split('\\n');\n  controller\n    .command(Commands.removeNodeByKey, block.key)\n    .command(Commands.deleteLineForward);\n\n  controller.withoutNormalizing(() => {\n    lineArr.forEach((line) => {\n      controller\n        .command(Commands.insertBlock, {\n          type: Paragraph.TYPE,\n        })\n        .command(Commands.insertText, line);\n    });\n  });\n};\n\nexport const transform = (controller: Controller, config: CodePluginConfig, id: string): Controller => {\n  const blocks = controller.query('getTransformNodes');\n  const array: string[] = [];\n  if (Array.isArray(blocks) && blocks.length > 0) {\n    // 创建空段落聚焦\n    controller\n      .command(Commands.moveToStartOfNode, blocks[0])\n      .command(Commands.insertBlock, Paragraph.TYPE)\n      .command(Commands.blur);\n\n    controller.withoutNormalizing(() => {\n      blocks.forEach((block) => {\n        if (block.type === 'code') {\n          return code2Code(controller, block);\n        } else {\n          array.push(block.text);\n          controller.command(Commands.removeNodeByKey, block.key);\n        }\n      });\n      if (array.length > 0) {\n        const text = array.join('\\n');\n        return controller.command(createInsertCode(config), id, text);\n      }\n      return undefined;\n    });\n\n  }\n  return controller.command(Commands.focus);\n};\n"],"file":"transform.js"}