import { CangjieSelectEvent, EdgePoint, RangeSelection } from '@ali/4ever-cangjie';
export default function createOnCangjieSelect() {
  return function (event, controller, next) {
    var selection = event.detail.selection;
    var anchor = selection.anchor; // 如果目标选区是一个 text 节点的话，判断是否在代码块内

    if (selection.isCollapsed && anchor.isTextPoint()) {
      var _controller$value = controller.value,
          document = _controller$value.document,
          _selection = _controller$value.selection;
      var block = document.getClosestBlock(anchor.key);

      if ((block == null ? void 0 : block.type) === 'code') {
        var edge = null;

        if (block.text.length) {
          edge = anchor.offset > 0 ? EdgePoint.BEFORE : EdgePoint.AFTER;
        } else if (_selection != null && _selection.anchor.isEdgePoint()) {
          // 如果代码块是空的，则根据当前的选区 （selection）判断
          edge = _selection.anchor.edge === EdgePoint.BEFORE ? EdgePoint.AFTER : EdgePoint.BEFORE;
        }

        if (edge) {
          var key = block.key;
          var point = EdgePoint.create({
            key: key,
            edge: edge
          });
          var newSelection = RangeSelection.create({
            anchor: point,
            focus: point
          });
          return controller.run('onCangjieSelect', CangjieSelectEvent({
            selection: newSelection
          }));
        }
      }
    }

    return next();
  };
}
//# sourceMappingURL=createOnCangjieSelect.js.map