{"version":3,"sources":["../../../../src/bi/handlers/createOnCangjieSelect.ts"],"names":["CangjieSelectEvent","EdgePoint","RangeSelection","createOnCangjieSelect","event","controller","next","selection","detail","anchor","isCollapsed","isTextPoint","value","document","block","getClosestBlock","key","type","edge","text","length","offset","BEFORE","AFTER","isEdgePoint","point","create","newSelection","focus","run"],"mappings":"AAAA,SAEEA,kBAFF,EAGEC,SAHF,EAIEC,cAJF,QAMO,oBANP;AAQA,eAAe,SAASC,qBAAT,GAAiC;AAC9C,SAAO,UACLC,KADK,EAELC,UAFK,EAGLC,IAHK,EAIF;AAAA,QACKC,SADL,GACmBH,KAAK,CAACI,MADzB,CACKD,SADL;AAAA,QAEKE,MAFL,GAEgBF,SAFhB,CAEKE,MAFL,EAGH;;AACA,QAAIF,SAAS,CAACG,WAAV,IAAyBD,MAAM,CAACE,WAAP,EAA7B,EAAmD;AAAA,8BACjBN,UAAU,CAACO,KADM;AAAA,UACzCC,QADyC,qBACzCA,QADyC;AAAA,UAC/BN,UAD+B,qBAC/BA,SAD+B;AAEjD,UAAMO,KAAK,GAAGD,QAAQ,CAACE,eAAT,CAAyBN,MAAM,CAACO,GAAhC,CAAd;;AACA,UAAI,CAAAF,KAAK,QAAL,YAAAA,KAAK,CAAEG,IAAP,MAAgB,MAApB,EAA4B;AAC1B,YAAIC,IAAsB,GAAG,IAA7B;;AACA,YAAIJ,KAAK,CAACK,IAAN,CAAWC,MAAf,EAAuB;AACrBF,UAAAA,IAAI,GAAGT,MAAM,CAACY,MAAP,GAAgB,CAAhB,GAAoBpB,SAAS,CAACqB,MAA9B,GAAuCrB,SAAS,CAACsB,KAAxD;AACD,SAFD,MAEO,IAAIhB,UAAJ,YAAIA,UAAS,CAAEE,MAAX,CAAkBe,WAAlB,EAAJ,EAAqC;AAC1C;AACAN,UAAAA,IAAI,GAAGX,UAAS,CAACE,MAAV,CAAiBS,IAAjB,KAA0BjB,SAAS,CAACqB,MAApC,GAA6CrB,SAAS,CAACsB,KAAvD,GAA+DtB,SAAS,CAACqB,MAAhF;AACD;;AACD,YAAIJ,IAAJ,EAAU;AAAA,cACAF,GADA,GACQF,KADR,CACAE,GADA;AAER,cAAMS,KAAK,GAAGxB,SAAS,CAACyB,MAAV,CAAiB;AAAEV,YAAAA,GAAG,EAAHA,GAAF;AAAOE,YAAAA,IAAI,EAAJA;AAAP,WAAjB,CAAd;AACA,cAAMS,YAAY,GAAGzB,cAAc,CAACwB,MAAf,CAAsB;AACzCjB,YAAAA,MAAM,EAAEgB,KADiC;AAEzCG,YAAAA,KAAK,EAAEH;AAFkC,WAAtB,CAArB;AAIA,iBAAOpB,UAAU,CAACwB,GAAX,CACL,iBADK,EAEL7B,kBAAkB,CAAC;AACjBO,YAAAA,SAAS,EAAEoB;AADM,WAAD,CAFb,CAAP;AAMD;AACF;AACF;;AACD,WAAOrB,IAAI,EAAX;AACD,GApCD;AAqCD","sourcesContent":["import {\n  Controller,\n  CangjieSelectEvent,\n  EdgePoint,\n  RangeSelection,\n  PointEdge,\n} from '@ali/4ever-cangjie';\n\nexport default function createOnCangjieSelect() {\n  return (\n    event: CangjieSelectEvent,\n    controller: Controller,\n    next: Function,\n  ) => {\n    const { selection } = event.detail;\n    const { anchor } = selection;\n    // 如果目标选区是一个 text 节点的话，判断是否在代码块内\n    if (selection.isCollapsed && anchor.isTextPoint()) {\n      const { document, selection } = controller.value;\n      const block = document.getClosestBlock(anchor.key);\n      if (block?.type === 'code') {\n        let edge: PointEdge | null = null;\n        if (block.text.length) {\n          edge = anchor.offset > 0 ? EdgePoint.BEFORE : EdgePoint.AFTER;\n        } else if (selection?.anchor.isEdgePoint()) {\n          // 如果代码块是空的，则根据当前的选区 （selection）判断\n          edge = selection.anchor.edge === EdgePoint.BEFORE ? EdgePoint.AFTER : EdgePoint.BEFORE;\n        }\n        if (edge) {\n          const { key } = block;\n          const point = EdgePoint.create({ key, edge });\n          const newSelection = RangeSelection.create({\n            anchor: point,\n            focus: point,\n          });\n          return controller.run(\n            'onCangjieSelect',\n            CangjieSelectEvent({\n              selection: newSelection,\n            }),\n          );\n        }\n      }\n    }\n    return next();\n  };\n}\n"],"file":"createOnCangjieSelect.js"}