{"version":3,"sources":["../../../../src/bi/components/CodeInlineToolbar.tsx"],"names":["React","copyToClipboard","Button","DeleteNormal","ToolbarCopyNormal","InlineToolbar","removeCode","IconButton","codeMobileLayout","toolButtons","name","CodeInlineToolbar","props","locale","controller","node","isMobile","focusedCodeKey","triggerNode","handleCopy","useCallback","event","preventDefault","stopPropagation","text","handleDel","run","CopyCodeButton","copy","DelCodeButton","customToolButtons","undefined","moreToolButtons","nodeKey","query","unshift","codeToolbarLayout"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { copyToClipboard } from '@ali/4ever-utils';\nimport { Button, DeleteNormal } from '@ali/we-design';\nimport { ToolbarCopyNormal } from '@ali/we-icon';\nimport {\n  Block,\n  Controller,\n} from '@ali/4ever-cangjie';\nimport {\n  InlineToolbar,\n} from '@ali/4ever-component';\nimport { removeCode } from '../actions';\nimport { IconButton } from '@ali/we-toolbar';\n;\n\nconst codeMobileLayout = [{\n  toolButtons: [{\n    name: 'code.del',\n  }],\n}];\n\ninterface InlineToolbarProps {\n  controller: Controller;\n  node: Block;\n  locale: Record<string, any>;\n  isMobile?: boolean;\n  focusedCodeKey?: string;\n  triggerNode: HTMLDivElement | null;\n}\n\nconst CodeInlineToolbar: React.FC<InlineToolbarProps> = (props) => {\n  const {\n    locale,\n    controller,\n    node,\n    isMobile,\n    focusedCodeKey,\n    triggerNode,\n  } = props;\n\n  const handleCopy = React.useCallback((event: React.MouseEvent | React.TouchEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    copyToClipboard(node.text || '');\n  }, [node]);\n\n  const handleDel = React.useCallback((event: React.MouseEvent | React.TouchEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    controller.run('onAction', removeCode(node));\n  }, [controller, node]);\n\n  const CopyCodeButton = () => {\n    return (\n      <IconButton testid=\"code-block-copy\" onClick={handleCopy} title={locale.copy} icon={<ToolbarCopyNormal />} />\n    );\n  };\n\n  const DelCodeButton = () => {\n    // 加上 title，二次点击 onClick 才生效\n    return <Button testid=\"code-block-remove\" onClick={handleDel} bordered={false} icon={<DeleteNormal />} />;\n  };\n\n  const customToolButtons = {\n    'code.copy': CopyCodeButton,\n    'code.del': DelCodeButton,\n  };\n\n  if (isMobile) {\n    return (\n      <InlineToolbar\n        visible\n        triggerNode={triggerNode || undefined}\n        inlineLayout={codeMobileLayout}\n        customToolButtons={{\n          'code.del': DelCodeButton,\n        }}\n      />\n    );\n  }\n\n  const moreToolButtons: any = [\n    //{\n    //  name: 'code.copy',\n    //}, \n    {\n      name: 'code.more',\n      nodeKey: focusedCodeKey,\n    }];\n  if (controller.query('canComment')) {\n    moreToolButtons.unshift({\n      name: 'comment',\n    });\n  }\n\n  const codeToolbarLayout = [{\n    toolButtons: [{\n      name: 'code.theme',\n      focusedCodeKey,\n    }],\n  }, {\n    toolButtons: [{\n      name: 'code.syntax',\n      focusedCodeKey,\n    }, {\n      name: 'code.wrap',\n      focusedCodeKey,\n    }],\n  }, {\n    toolButtons: moreToolButtons,\n  }];\n\n  return (\n    <InlineToolbar\n      visible\n      triggerNode={triggerNode || undefined}\n      inlineLayout={codeToolbarLayout}\n      customToolButtons={customToolButtons}\n      overlayClassName=\"code-toolbar-overlay\"\n    />\n  );\n};\n\nexport default CodeInlineToolbar;\n"],"file":"CodeInlineToolbar.js"}