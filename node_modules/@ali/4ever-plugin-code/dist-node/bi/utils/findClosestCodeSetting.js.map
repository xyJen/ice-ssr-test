{"version":3,"sources":["../../../../src/bi/utils/findClosestCodeSetting.ts"],"names":["getCodeDataSetting","code","targetSyntax","syntax","theme","data","findClosestCodeSetting","document","anchorNode","findClosest","dire","findCodeFun","key","getPreviousBlock","getNextBlock","maybeCode","CodeModel","isCode","result"],"mappings":";;;;;;;;;AACA;;AAOA,MAAMA,kBAAkB,GAAG,CAACC,IAAD,EAAgBC,YAAhB,KAAmE;AAC5F,QAAM;AAAEC,IAAAA,MAAF;AAAUC,IAAAA;AAAV,MAAoBH,IAAI,CAACI,IAA/B;;AACA,MAAIH,YAAY,IAAIA,YAAY,KAAKC,MAArC,EAA6C;AAC3C,WAAO;AAAEA,MAAAA,MAAF;AAAUC,MAAAA;AAAV,KAAP;AACD,GAFD,MAEO,IAAI,CAACF,YAAL,EAAmB;AACxB,WAAO;AAAEC,MAAAA,MAAF;AAAUC,MAAAA;AAAV,KAAP;AACD;;AACD,SAAO,IAAP;AACD,CARD;;AAUA,MAAME,sBAAsB,GAAG,CAACC,QAAD,EAAqBC,UAArB,EAAuCN,YAAvC,KAA0F;AACvH,WAASO,WAAT,CAAqBC,IAArB,EAAqE;AACnE,UAAMC,WAAW,GAAIC,GAAD,IAAiBF,IAAI,KAAK,MAAT,GAAkBH,QAAQ,CAACM,gBAAT,CAA0BD,GAA1B,CAAlB,GAAmDL,QAAQ,CAACO,YAAT,CAAsBF,GAAtB,CAAxF;;AACA,QAAIG,SAAS,GAAGJ,WAAW,CAACH,UAAU,CAACI,GAAZ,CAA3B;;AACA,WAAOG,SAAP,EAAkB;AAChB,UAAIC,eAAUC,MAAV,CAAiBF,SAAjB,CAAJ,EAAiC;AAC/B,cAAMG,MAAM,GAAGlB,kBAAkB,CAACe,SAAD,EAAYb,YAAZ,CAAjC;AACA,YAAIgB,MAAJ,EAAY,OAAOA,MAAP;AACb;;AACDH,MAAAA,SAAS,GAAGJ,WAAW,CAACI,SAAS,CAACH,GAAX,CAAvB;AACD;;AACD,WAAO,IAAP;AACD;;AACD,SAAOH,WAAW,CAAC,MAAD,CAAX,IAAuBA,WAAW,CAAC,MAAD,CAAzC;AACD,CAdD;;eAgBeH,sB","sourcesContent":["import { Document, Node, Element } from \"@ali/4ever-cangjie\";\nimport CodeModel from '../../mo/models/index'\n\ntype CodeConfigResult = {\n  syntax?: string;\n  theme?: string;\n}\n\nconst getCodeDataSetting = (code: Element, targetSyntax?: string): CodeConfigResult | null => {\n  const { syntax, theme } = code.data as CodeConfigResult;\n  if (targetSyntax && targetSyntax === syntax) {\n    return { syntax, theme };\n  } else if (!targetSyntax) {\n    return { syntax, theme };\n  }\n  return null;\n};\n\nconst findClosestCodeSetting = (document: Document, anchorNode: Node, targetSyntax?: string): CodeConfigResult | null => {\n  function findClosest(dire: 'prev' | 'next'): CodeConfigResult | null {\n    const findCodeFun = (key: string) => dire === 'prev' ? document.getPreviousBlock(key) : document.getNextBlock(key);\n    let maybeCode = findCodeFun(anchorNode.key);\n    while (maybeCode) {\n      if (CodeModel.isCode(maybeCode)) {\n        const result = getCodeDataSetting(maybeCode, targetSyntax);\n        if (result) return result;\n      }\n      maybeCode = findCodeFun(maybeCode.key);\n    }\n    return null;\n  }\n  return findClosest('prev') || findClosest('next');\n};\n\nexport default findClosestCodeSetting;\n"],"file":"findClosestCodeSetting.js"}