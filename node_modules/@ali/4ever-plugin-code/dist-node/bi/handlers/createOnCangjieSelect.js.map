{"version":3,"sources":["../../../../src/bi/handlers/createOnCangjieSelect.ts"],"names":["createOnCangjieSelect","event","controller","next","selection","detail","anchor","isCollapsed","isTextPoint","document","value","block","getClosestBlock","key","type","edge","text","length","offset","EdgePoint","BEFORE","AFTER","isEdgePoint","point","create","newSelection","RangeSelection","focus","run"],"mappings":";;;;;;;AAAA;;AAQe,SAASA,qBAAT,GAAiC;AAC9C,SAAO,CACLC,KADK,EAELC,UAFK,EAGLC,IAHK,KAIF;AACH,UAAM;AAAEC,MAAAA;AAAF,QAAgBH,KAAK,CAACI,MAA5B;AACA,UAAM;AAAEC,MAAAA;AAAF,QAAaF,SAAnB,CAFG,CAGH;;AACA,QAAIA,SAAS,CAACG,WAAV,IAAyBD,MAAM,CAACE,WAAP,EAA7B,EAAmD;AACjD,YAAM;AAAEC,QAAAA,QAAF;AAAYL,QAAAA;AAAZ,UAA0BF,UAAU,CAACQ,KAA3C;AACA,YAAMC,KAAK,GAAGF,QAAQ,CAACG,eAAT,CAAyBN,MAAM,CAACO,GAAhC,CAAd;;AACA,UAAIF,KAAK,EAAEG,IAAP,KAAgB,MAApB,EAA4B;AAC1B,YAAIC,IAAsB,GAAG,IAA7B;;AACA,YAAIJ,KAAK,CAACK,IAAN,CAAWC,MAAf,EAAuB;AACrBF,UAAAA,IAAI,GAAGT,MAAM,CAACY,MAAP,GAAgB,CAAhB,GAAoBC,uBAAUC,MAA9B,GAAuCD,uBAAUE,KAAxD;AACD,SAFD,MAEO,IAAIjB,SAAS,EAAEE,MAAX,CAAkBgB,WAAlB,EAAJ,EAAqC;AAC1C;AACAP,UAAAA,IAAI,GAAGX,SAAS,CAACE,MAAV,CAAiBS,IAAjB,KAA0BI,uBAAUC,MAApC,GAA6CD,uBAAUE,KAAvD,GAA+DF,uBAAUC,MAAhF;AACD;;AACD,YAAIL,IAAJ,EAAU;AACR,gBAAM;AAAEF,YAAAA;AAAF,cAAUF,KAAhB;;AACA,gBAAMY,KAAK,GAAGJ,uBAAUK,MAAV,CAAiB;AAAEX,YAAAA,GAAF;AAAOE,YAAAA;AAAP,WAAjB,CAAd;;AACA,gBAAMU,YAAY,GAAGC,4BAAeF,MAAf,CAAsB;AACzClB,YAAAA,MAAM,EAAEiB,KADiC;AAEzCI,YAAAA,KAAK,EAAEJ;AAFkC,WAAtB,CAArB;;AAIA,iBAAOrB,UAAU,CAAC0B,GAAX,CACL,iBADK,EAEL,qCAAmB;AACjBxB,YAAAA,SAAS,EAAEqB;AADM,WAAnB,CAFK,CAAP;AAMD;AACF;AACF;;AACD,WAAOtB,IAAI,EAAX;AACD,GApCD;AAqCD","sourcesContent":["import {\n  Controller,\n  CangjieSelectEvent,\n  EdgePoint,\n  RangeSelection,\n  PointEdge,\n} from '@ali/4ever-cangjie';\n\nexport default function createOnCangjieSelect() {\n  return (\n    event: CangjieSelectEvent,\n    controller: Controller,\n    next: Function,\n  ) => {\n    const { selection } = event.detail;\n    const { anchor } = selection;\n    // 如果目标选区是一个 text 节点的话，判断是否在代码块内\n    if (selection.isCollapsed && anchor.isTextPoint()) {\n      const { document, selection } = controller.value;\n      const block = document.getClosestBlock(anchor.key);\n      if (block?.type === 'code') {\n        let edge: PointEdge | null = null;\n        if (block.text.length) {\n          edge = anchor.offset > 0 ? EdgePoint.BEFORE : EdgePoint.AFTER;\n        } else if (selection?.anchor.isEdgePoint()) {\n          // 如果代码块是空的，则根据当前的选区 （selection）判断\n          edge = selection.anchor.edge === EdgePoint.BEFORE ? EdgePoint.AFTER : EdgePoint.BEFORE;\n        }\n        if (edge) {\n          const { key } = block;\n          const point = EdgePoint.create({ key, edge });\n          const newSelection = RangeSelection.create({\n            anchor: point,\n            focus: point,\n          });\n          return controller.run(\n            'onCangjieSelect',\n            CangjieSelectEvent({\n              selection: newSelection,\n            }),\n          );\n        }\n      }\n    }\n    return next();\n  };\n}\n"],"file":"createOnCangjieSelect.js"}