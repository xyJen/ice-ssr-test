"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createOnCangjieSelect;

var _everCangjie = require("@ali/4ever-cangjie");

function createOnCangjieSelect() {
  return (event, controller, next) => {
    const {
      selection
    } = event.detail;
    const {
      anchor
    } = selection; // 如果目标选区是一个 text 节点的话，判断是否在代码块内

    if (selection.isCollapsed && anchor.isTextPoint()) {
      const {
        document,
        selection
      } = controller.value;
      const block = document.getClosestBlock(anchor.key);

      if (block?.type === 'code') {
        let edge = null;

        if (block.text.length) {
          edge = anchor.offset > 0 ? _everCangjie.EdgePoint.BEFORE : _everCangjie.EdgePoint.AFTER;
        } else if (selection?.anchor.isEdgePoint()) {
          // 如果代码块是空的，则根据当前的选区 （selection）判断
          edge = selection.anchor.edge === _everCangjie.EdgePoint.BEFORE ? _everCangjie.EdgePoint.AFTER : _everCangjie.EdgePoint.BEFORE;
        }

        if (edge) {
          const {
            key
          } = block;

          const point = _everCangjie.EdgePoint.create({
            key,
            edge
          });

          const newSelection = _everCangjie.RangeSelection.create({
            anchor: point,
            focus: point
          });

          return controller.run('onCangjieSelect', (0, _everCangjie.CangjieSelectEvent)({
            selection: newSelection
          }));
        }
      }
    }

    return next();
  };
}
//# sourceMappingURL=createOnCangjieSelect.js.map