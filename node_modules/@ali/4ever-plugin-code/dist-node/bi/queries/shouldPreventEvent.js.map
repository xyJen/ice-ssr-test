{"version":3,"sources":["../../../../src/bi/queries/shouldPreventEvent.ts"],"names":["shouldPreventEvent","event","controller","target","selection","value","isContentEditable","closest"],"mappings":";;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACe,SAASA,kBAAT,CACbC,KADa,EAEbC,UAFa,EAGb;AACA,QAAMC,MAAM,GAAGF,KAAK,CAACE,MAArB;AACA,QAAM;AAAEC,IAAAA;AAAF,MAAgBF,UAAU,CAACG,KAAjC;;AAEA,MACED,SAAS,IACTD,MADA,IAEAA,MAAM,CAACG,iBAFP,IAGA,CAAC,CAACH,MAAM,CAACI,OAAP,CAAe,aAAf,CAJJ,EAKE;AACA,WAAO,IAAP;AACD;;AAED,SAAO,KAAP;AACD","sourcesContent":["import { Controller } from '@ali/4ever-cangjie';\n\n/**\n * COMPAT:\n * CodeMirror 在移动端使用 contenteditable 作为替代 textarea 的输入模式，\n * 这导致，slate 认为当前的 CodeMirror 实例是编辑器文档内容的一部分，CodeMirror 的事件因此\n * 也会被 slate 拦截，产生诸如 IME 失效，光标飘逸，无法输入等问题。\n * 因此，在移动端，需要让 Code 插件阻止 slate 对 CodeMirror 事件的劫持。\n * 判断事件是否应当被阻止：\n * 1. slate editor 已经失焦\n * 2. 当前元素可编辑（`isContentEditbale === true`）\n * 3. 当前元素处在 CodeMirror 节点下\n * @param event\n * @param editor\n */\nexport default function shouldPreventEvent(\n  event: InputEvent | KeyboardEvent | TouchEvent | React.SyntheticEvent,\n  controller: Controller,\n) {\n  const target = event.target as HTMLDivElement;\n  const { selection } = controller.value;\n\n  if (\n    selection &&\n    target &&\n    target.isContentEditable &&\n    !!target.closest('.CodeMirror')\n  ) {\n    return true;\n  }\n\n  return false;\n}\n"],"file":"shouldPreventEvent.js"}