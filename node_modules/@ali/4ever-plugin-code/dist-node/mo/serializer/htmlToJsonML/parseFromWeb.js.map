{"version":3,"sources":["../../../../../src/mo/serializer/htmlToJsonML/parseFromWeb.ts"],"names":["parseFromWeb","index","name","onOpenTag","state","push","syntax","PLAIN_TEXT","theme","THEME_DEFAULT","onCloseTag","pop","codeBlockDom","htmlDom","getElementsByTagName","append"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AAEA;AACA;AACA;AACA,SAASA,YAAT,GAA0C;AACxC,MAAIC,KAAK,GAAG,CAAZ;AACA,SAAO;AACLC,IAAAA,IAAI,EAAE,MADD;;AAGLC,IAAAA,SAAS,CAACC,KAAD,EAAeF,IAAf,EAAsC;AAC7C,UAAIA,IAAI,KAAK,KAAb,EAAoB,OAAO,KAAP;AAEpBE,MAAAA,KAAK,CAACC,IAAN,CAAW,CAAC,MAAD,EAAS;AAAEC,QAAAA,MAAM,EAAEC,qBAAV;AAAsBC,QAAAA,KAAK,EAAEC;AAA7B,OAAT,CAAX;AACA,aAAO,IAAP;AACD,KARI;;AAULC,IAAAA,UAAU,CAACN,KAAD,EAAeF,IAAf,EAAsC;AAC9C,UAAIA,IAAI,KAAK,KAAb,EAAoB,OAAO,KAAP;AACpBE,MAAAA,KAAK,CAACO,GAAN;AAEA,YAAMC,YAAY,GAAGR,KAAK,CAACS,OAAN,CAAcC,oBAAd,CAAmC,KAAnC,EAA0Cb,KAA1C,CAArB;AAEAG,MAAAA,KAAK,CAACW,MAAN,CAAa,CACX,MADW,EAEX;AAAET,QAAAA,MAAM,EAAE,sBAAUM,YAAV,CAAV;AAAmCJ,QAAAA,KAAK,EAAEC;AAA1C,OAFW,EAGX,uCAAqB,2BAAeG,YAAf,KAAgC,EAArD,CAHW,CAAb;AAKAX,MAAAA,KAAK;AACL,aAAO,IAAP;AACD;;AAvBI,GAAP;AAyBD;;eAEcD,Y","sourcesContent":["import { MoState as State, createTextWithString, HTMLToJsonMLRule } from '@ali/4ever-cangjie';\nimport { PLAIN_TEXT, THEME_DEFAULT } from './constants';\nimport { getTextContent, getSyntax } from './utils';\n\n// 识别如下两种结构作为代码块\n// <pre><code>xxxxx</code></pre>\n// <pre>xxxx</pre>\nfunction parseFromWeb(): HTMLToJsonMLRule {\n  let index = 0;\n  return {\n    name: 'code',\n\n    onOpenTag(state: State, name: string): boolean {\n      if (name !== 'pre') return false;\n\n      state.push(['code', { syntax: PLAIN_TEXT, theme: THEME_DEFAULT }] as any);\n      return true;\n    },\n\n    onCloseTag(state: State, name: string): boolean {\n      if (name !== 'pre') return false;\n      state.pop();\n\n      const codeBlockDom = state.htmlDom.getElementsByTagName('pre')[index];\n\n      state.append([\n        'code',\n        { syntax: getSyntax(codeBlockDom), theme: THEME_DEFAULT },\n        createTextWithString(getTextContent(codeBlockDom) || ''),\n      ]);\n      index++;\n      return true;\n    },\n  };\n}\n\nexport default parseFromWeb;\n"],"file":"parseFromWeb.js"}