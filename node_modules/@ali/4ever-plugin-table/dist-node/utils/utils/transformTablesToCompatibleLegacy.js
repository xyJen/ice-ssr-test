"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = transformTablesToCompatibleLegacy;

var _models = _interopRequireDefault(require("../../mo/models"));

var _everUtils = require("@ali/4ever-utils");

var _constants = require("../constants");

var _colsWidthConverter = require("./colsWidthConverter");

function transformTablesToCompatibleLegacy(document, fragment, isMobile = false) {
  const autofitTables = fragment.filterDescendants(n => _models.default.isTable(n) && _models.default.isAutofitWidth(n));

  if (autofitTables.length > 0) {
    let pageWidth = _constants.DEFAULT_TOTAL_WIDTH_FOR_AUTOFIT;

    if (!isMobile) {
      pageWidth = (0, _everUtils.getInnerWidth)(document) || _constants.DEFAULT_TOTAL_WIDTH_FOR_AUTOFIT;
    }

    autofitTables.forEach(t => {
      const newColsWidth = (0, _colsWidthConverter.convertFromPercentToPixel)(t, pageWidth);
      const path = fragment.getPath(t.key);

      if (path) {
        fragment = fragment.setNode(path, {
          data: { ...t.data,
            colsWidth: newColsWidth
          }
        });
      }
    });
    return {
      shouldTransfrom: true,
      fragment
    };
  }

  return {
    shouldTransfrom: false,
    fragment
  };
}
//# sourceMappingURL=transformTablesToCompatibleLegacy.js.map