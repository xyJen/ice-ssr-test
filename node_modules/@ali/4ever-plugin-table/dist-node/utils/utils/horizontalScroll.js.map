{"version":3,"sources":["../../../../src/utils/utils/horizontalScroll.ts"],"names":["THUMB_HEIGH","TEST_ID","ScrollMode","Scroller","constructor","targetTableWrapperEl","getBottom","mountDom","mode","default","fullwidth","scrollBar","bar","thumb","checkIfScrollVisible","handleTableWrapperScroll","syncDestoryHandler","tableElObserver","needResetBottom","currentBottom","Error","document","body","footerHeight","scroller","createElement","setAttribute","style","height","position","bottom","zIndex","opacity","resetScroller","appendChild","backgroundColor","borderRadius","e","instance","fastdom","measure","viewHeight","window","innerHeight","documentElement","clientHeight","top","getBoundingClientRect","TOOLBAR_ITEM_SIZE","hideScroller","resetBar","showScroller","addEventListener","resetThumbPosition","initScrollSyncHandler","MutationObserver","setTimeout","observe","childList","subtree","attributes","attributeFilter","changeScrollerVisible","widthPercentage","clientWidth","scrollWidth","thumbWidth","Math","min","width","transform","moveX","boundingClientRect","isBottomChange","left","scrollLeft","cursorDown","tempClientX","rate","getRate","offsetWidth","mouseMoveDocumentHandler","clientX","offset","originTempClientX","tempScrollleft","mouseUpDocumentHandler","removeEventListener","onselectstart","startDrag","stopImmediatePropagation","handleThumbMouseDown","ctrlKey","button","handleBarClick","target","thumbPosition","targetScrollLeft","scrollTo","behavior","display","always","destroy","disconnect","parentNode","removeChild"],"mappings":"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","sourcesContent":["/**\n * 创建一个scroller的dom\n */\nimport { throttle } from 'lodash-es';\nimport fastdom from 'fastdom';\nimport { TOOLBAR_ITEM_SIZE } from '../constants';\n\n// 滚动条高度\nconst THUMB_HEIGH = 6;\nconst TEST_ID = 'table-horizontal-scrollbar';\n\n/**\n * 滚动条显示模式：\n *  - always：强制常驻\n *  - default：默认只在需要的时候展示\n */\nenum ScrollMode {\n  always = 'always',\n  default = 'default',\n}\n\nexport default class Scroller {\n  /**\n   * 表格滚动容器\n   */\n  readonly targetTableWrapperEl: HTMLDivElement;\n\n  /**\n   * 滚动条宽度是否占满，占满则不显示滚动条\n   */\n  private fullwidth: boolean;\n\n  /**\n   * 滚动条显示模式：默认只在需要的时候展示\n   */\n  readonly mode: ScrollMode;\n\n  /**\n   * 需要添加的滚动条dom\n   */\n  readonly scrollBar: HTMLDivElement;\n\n  /**\n   * 需要添加的滚动条杆dom\n   */\n  readonly bar: HTMLDivElement;\n\n  /**\n   * 需要添加的滚动条滑块dom\n   */\n  readonly thumb: HTMLDivElement;\n\n  /**\n   * 滚动时检查是否需要隐藏或者展示滚动条\n   */\n  readonly checkIfScrollVisible: () => void;\n\n  readonly handleTableWrapperScroll: () => void;\n\n  /**\n   * 销毁用于同步点击滚动条移动表格的事件监听器\n   */\n  readonly syncDestoryHandler: () => void;\n\n  /**\n   * 监听目标表格dom变化的observer\n   */\n  readonly tableElObserver: MutationObserver;\n\n  /**\n   * 滚动条挂载容器\n   */\n  readonly mountDom: HTMLElement | Window | null;\n\n  /**\n   * @param targetTableWrapperEl 表格滚动容器\n   * @param getBottom 获取滚动条到页面底部的距离\n   * @param mountDom 滚动条挂载容器\n   * @param mode 滚动条显示模式：默认只在需要的时候展示\n   */\n  readonly getBottom: undefined | (() => number);\n\n  /** 是否需要重新设置bottom */\n  private needResetBottom: boolean;\n\n  /** 当前bottom */\n  private currentBottom: number;\n\n  constructor(\n    targetTableWrapperEl: HTMLDivElement,\n    getBottom?: undefined | (() => number),\n    mountDom?: HTMLElement | Window | null,\n    mode = ScrollMode.default,\n  ) {\n    if (!targetTableWrapperEl) {\n      throw new Error('need have table element');\n    }\n    this.targetTableWrapperEl = targetTableWrapperEl;\n    this.fullwidth = false;\n    this.mode = mode;\n    this.mountDom = mountDom || document.body;\n    this.getBottom = getBottom;\n    this.needResetBottom = !!getBottom; // 如果传了getBottom则说明需要对bottom进行重置操作\n    /**\n     * 添加滚动条dom节点\n     */\n    const footerHeight = getBottom ? getBottom() : 0;\n    const scroller = document.createElement('div');\n    scroller.setAttribute('data-testid', TEST_ID);\n    scroller.style.height = `${THUMB_HEIGH}px`;\n    scroller.style.position = 'fixed';\n    scroller.style.bottom = `${footerHeight}px`;\n    this.currentBottom = footerHeight;\n    // z-index 要高于内容区域 以及 右侧分屏面板的 z-index\n    scroller.style.zIndex = '200';\n    scroller.style.opacity = '0';\n\n    this.scrollBar = scroller;\n    this.resetScroller();\n\n    const bar = document.createElement('div');\n    bar.style.height = '100%';\n    this.bar = bar;\n    scroller.appendChild(bar);\n\n    const thumb = document.createElement('div');\n    thumb.style.height = '100%';\n    thumb.style.backgroundColor = 'rgb(205, 205, 210)';\n    thumb.style.borderRadius = '5px';\n    bar.appendChild(thumb);\n    this.thumb = thumb;\n    try {\n      (this.mountDom as HTMLElement).appendChild(this.scrollBar);\n    } catch (e) {\n      document.body.appendChild(this.scrollBar);\n    }\n    /**\n     * 初始化配置\n     */\n    const instance = this;\n    this.checkIfScrollVisible = throttle(() => {\n      fastdom.measure(() => {\n        const viewHeight = window.innerHeight || document.documentElement.clientHeight;\n        // 当前可视区域超出表格最下方或者最上方时，隐藏\n        const { top, bottom } = this.targetTableWrapperEl.getBoundingClientRect();\n        // 当表格上方已经处于视口边缘一定距离阈值内时，不必再显示滚动条\n        if (bottom <= viewHeight || top >= viewHeight - THUMB_HEIGH * 2 - TOOLBAR_ITEM_SIZE) {\n          instance.hideScroller();\n        } else {\n          // 需要重新设置一次当前宽度\n          instance.resetBar(false);\n          instance.resetScroller();\n          // 显示当前的bar\n          instance.showScroller();\n        }\n      });\n    }\n    , 1000 / 60);\n    document.addEventListener('scroll', this.checkIfScrollVisible, true); // 全局判断是否需要显示scroller\n\n    this.handleTableWrapperScroll = throttle(() => {\n      fastdom.measure(() => {\n        instance.resetThumbPosition();\n      });\n    }, 1000 / 60);\n\n    // 自动同步,table => scroller\n    targetTableWrapperEl.addEventListener('scroll', this.handleTableWrapperScroll, true);\n\n    // 自动同步 scroller => table\n    this.syncDestoryHandler = this.initScrollSyncHandler();\n\n    // 监听table的dom变化，自动重新设置\n    this.tableElObserver = new MutationObserver(() => {\n      setTimeout(() => {\n        fastdom.measure(() => {\n          instance.resetBar();\n          instance.resetScroller();\n          instance.resetThumbPosition();\n          instance.checkIfScrollVisible();\n        });\n      });\n    });\n    this.tableElObserver.observe(\n      targetTableWrapperEl,\n      {\n        childList: true,\n        subtree: true, // Todo: @muyu 这里不确定只观察父节点变更是否会有bug，因此子节点变化也一并观察，可能会对性能有影响。\n        attributes: true,\n        attributeFilter: ['style'], // 只关注目标dom节点的style变化\n      },\n    );\n    // bar宽度自动重制\n    setTimeout(() => {\n      fastdom.measure(() => {\n        instance.resetBar();\n        instance.resetScroller();\n        instance.resetThumbPosition();\n        instance.checkIfScrollVisible();\n        scroller.style.opacity = '1';\n      });\n    }, 500);\n  }\n\n  /**\n   * 自动设置Bar\n   * @param {boolean} changeScrollerVisible 是否开启自动设置滚动条显示与否\n   */\n  resetBar(changeScrollerVisible = true) {\n    const { targetTableWrapperEl } = this;\n    const widthPercentage = (targetTableWrapperEl.clientWidth * 100 / targetTableWrapperEl.scrollWidth);\n    const thumbWidth = Math.min(widthPercentage, 100);\n    this.thumb.style.width = `${thumbWidth}%`;\n\n    this.fullwidth = thumbWidth >= 100;\n\n    if (changeScrollerVisible) {\n      if (this.fullwidth) {\n        this.hideScroller();\n      } else {\n        this.checkIfScrollVisible();\n      }\n    }\n  }\n\n  resetThumbPosition() {\n    // 通过transform来模拟滑块滚动\n    this.thumb.style.transform = `translateX(${this.moveX}%)`;\n  }\n\n  // 调整滚动条位置以及宽度\n  resetScroller() {\n    const { targetTableWrapperEl, scrollBar } = this;\n    const boundingClientRect = targetTableWrapperEl.getBoundingClientRect();\n    // 文档Footer的高度是固定的，缩放只针对Content区域，因此只需要获取其高度并设置一次bottom即可\n    if (this.needResetBottom) {\n      // 但是要考虑window.innerHeight 变化的场景\n      const footerHeight = this.getBottom!(); \n      const isBottomChange = footerHeight !== this.currentBottom;\n      if (isBottomChange) {\n        const bottom = footerHeight || 0;\n        // 文档由于底部Footer也是fixed，因此bottom不能设置为0，只能动态获取Footer的高度来设置bottom\n        scrollBar.style.bottom = `${bottom}px`;\n        this.currentBottom = bottom;\n      }\n    }\n    scrollBar.style.left = `${boundingClientRect.left }px`;\n    scrollBar.style.width = `${boundingClientRect.width }px`;\n  }\n\n  // 滑块位移计算\n  get moveX() {\n    const { targetTableWrapperEl } = this;\n    return ((targetTableWrapperEl.scrollLeft * 100) / targetTableWrapperEl.clientWidth);\n  }\n\n  /**\n   * 让scroller的拖动行为和table的同步\n   */\n  initScrollSyncHandler() {\n    let cursorDown = false;\n    let tempClientX = 0;\n    let rate = 1;\n\n    const { thumb, targetTableWrapperEl, bar } = this;\n\n    function getRate() {\n      // 计算一下变换比例，拖拽走的是具体数字，但是这个实际上应该是按照比例变的\n      return bar.offsetWidth / thumb.offsetWidth;\n    }\n\n    const mouseMoveDocumentHandler = throttle(\n      (e: MouseEvent) => {\n        // 拖动的时候如果已经松开鼠标则不处理\n        // cursorDown 是拖拽开启和结束的标识\n        if (cursorDown === false) {\n          return;\n        }\n        const { clientX } = e;\n        const offset = clientX - tempClientX;\n        const originTempClientX = tempClientX;\n        tempClientX = clientX;\n\n        const tempScrollleft = targetTableWrapperEl.scrollLeft;\n        targetTableWrapperEl.scrollLeft += offset * rate;\n        if (tempScrollleft === targetTableWrapperEl.scrollLeft) {\n          tempClientX = originTempClientX;\n        }\n      }, 1000 / 60,\n    );\n\n    function mouseUpDocumentHandler() {\n      cursorDown = false;\n      document.removeEventListener('mousemove', mouseMoveDocumentHandler);\n      document.removeEventListener('mouseup', mouseUpDocumentHandler);\n      document.onselectstart = null;\n    }\n\n    /**\n     * 拖拽处理\n     */\n    function startDrag(e: MouseEvent) {\n      e.stopImmediatePropagation();\n      cursorDown = true;\n      document.addEventListener('mousemove', mouseMoveDocumentHandler);\n      document.addEventListener('mouseup', mouseUpDocumentHandler);\n      document.onselectstart = () => false;\n    }\n\n    function handleThumbMouseDown(e: MouseEvent) {\n      // 右键点击以及ctrl+click事件不处理\n      if (e.ctrlKey || e.button === 2) {\n        return;\n      }\n\n      const { clientX } = e;\n      tempClientX = clientX;\n      rate = getRate();\n      startDrag(e);\n    }\n\n    thumb.addEventListener('mousedown', handleThumbMouseDown);\n\n    /**\n     * 点击槽快速移动\n     */\n\n    function handleBarClick(e: MouseEvent) {\n      const { target } = e;\n      if (target !== bar) {\n        return;\n      }\n      rate = getRate();\n      const { clientX } = e;\n      let offset = 0;\n      const thumbPosition = thumb.getBoundingClientRect();\n      if (thumbPosition.left >= clientX) {\n        offset = (clientX - thumbPosition.left);\n      } else {\n        offset = clientX - thumbPosition.left - thumbPosition.width;\n      }\n\n      const targetScrollLeft = targetTableWrapperEl.scrollLeft + offset * rate;\n      targetTableWrapperEl.scrollTo({\n        left: targetScrollLeft,\n        behavior: 'smooth',\n      });\n    }\n\n    bar.addEventListener('click', handleBarClick);\n\n    return function () {\n      thumb.removeEventListener('mousedown', handleThumbMouseDown);\n      bar.removeEventListener('click', handleBarClick);\n      document.removeEventListener('mouseup', mouseUpDocumentHandler);\n      document.removeEventListener('mousemove', mouseMoveDocumentHandler);\n    };\n  }\n\n  /**\n   * 显示整体\n   */\n  showScroller() {\n    if (!this.fullwidth) {\n      this.scrollBar.style.display = 'initial';\n    }\n  }\n\n  /**\n   * 隐藏整体\n   */\n  hideScroller() {\n    if (this.mode === ScrollMode.always) {\n      this.scrollBar.style.display = 'initial';\n    } else {\n      this.scrollBar.style.display = 'none';\n    }\n  }\n\n  /**\n  * 添加事件监听\n  */\n  addEventListener() {\n    this.mountDom?.addEventListener('scroll', this.checkIfScrollVisible);\n    this.targetTableWrapperEl.addEventListener('scroll', this.handleTableWrapperScroll);\n  }\n\n  /**\n   * 移除事件监听\n   */\n  removeEventListener() {\n    this.mountDom?.removeEventListener('scroll', this.checkIfScrollVisible);\n    this.targetTableWrapperEl.removeEventListener('scroll', this.handleTableWrapperScroll);\n  }\n\n  /**\n   * 销毁实例：\n   * - 取消observer监听\n   * - 监听器注销\n   * - 滚动条dom移除\n   */\n  destroy() {\n    this.tableElObserver.disconnect();\n    this.removeEventListener();\n    this.syncDestoryHandler();\n    this.thumb.parentNode?.removeChild(this.thumb);\n    this.bar.parentNode?.removeChild(this.bar);\n    this.scrollBar.parentNode?.removeChild(this.scrollBar);\n  }\n}\n"],"file":"horizontalScroll.js"}