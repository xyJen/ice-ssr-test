{"version":3,"sources":["../../../../../src/mo/serializer/htmlToMarkdown/utils.ts"],"names":["excuteByTimes","fn","times","i","normalizeTable","table","colgroup","getElementsByTagName","colsNum","children","length","rows","Array","from","forEach","row","cell","colSpan","nextCell","nextElementSibling","correctTable","td","document","createElement","insertBefore","appendChild","range","index","entries","rowSpan","isTable","node","nodeName","isHeadingRow","tr","parentNode","firstChild"],"mappings":";;;;;;;;;AAAA,SAASA,aAAT,CAAuBC,EAAvB,EAAqCC,KAArC,EAAoD;AAClD,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,KAApB,EAA2BC,CAAC,EAA5B,EAAgC;AAC9BF,IAAAA,EAAE;AACH;AACF,C,CAED;;;AACO,SAASG,cAAT,CAAwBC,KAAxB,EAAiD;AACtD,QAAMC,QAAQ,GAAGD,KAAK,CAACE,oBAAN,CAA2B,UAA3B,EAAuC,CAAvC,CAAjB;AACA,QAAMC,OAAO,GAAGF,QAAQ,CAACG,QAAT,CAAkBC,MAAlC;AACA,QAAMC,IAAI,GAAGC,KAAK,CAACC,IAAN,CAAWR,KAAK,CAACM,IAAjB,CAAb,CAHsD,CAKtD;;AACAA,EAAAA,IAAI,CAACG,OAAL,CAAcC,GAAD,IAAS;AACpB,SAAK,IAAIZ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGK,OAApB,EAA6BL,CAAC,EAA9B,EAAkC;AAChC,YAAMa,IAAI,GAAGD,GAAG,CAACN,QAAJ,CAAaN,CAAb,CAAb;;AACA,UAAI,CAACa,IAAD,IAAS,EAAEA,IAAI,CAACC,OAAL,GAAe,CAAjB,CAAb,EAAkC;AAChC;AACD;;AAED,YAAMC,QAAQ,GAAGF,IAAI,CAACG,kBAAtB;;AACA,YAAMC,YAAY,GAAG,MAAM;AACzB,cAAMC,EAAE,GAAGC,QAAQ,CAACC,aAAT,CAAuB,IAAvB,CAAX;;AACA,YAAIL,QAAJ,EAAc;AACZH,UAAAA,GAAG,CAACS,YAAJ,CAAiBH,EAAjB,EAAqBH,QAArB;AACD,SAFD,MAEO;AACLH,UAAAA,GAAG,CAACU,WAAJ,CAAgBJ,EAAhB;AACD;AACF,OAPD;;AAQArB,MAAAA,aAAa,CAACoB,YAAD,EAAeJ,IAAI,CAACC,OAAL,GAAe,CAA9B,CAAb;AACD;AACF,GAlBD,EANsD,CA0BtD;;AACA,OAAK,IAAId,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGK,OAApB,EAA6BL,CAAC,EAA9B,EAAkC;AAChC,QAAIuB,KAAK,GAAG,CAAZ;;AACA,SAAK,MAAM,CAACC,KAAD,EAAQZ,GAAR,CAAX,IAA2BJ,IAAI,CAACiB,OAAL,EAA3B,EAA2C;AACzC,YAAMZ,IAAI,GAAGD,GAAG,CAACN,QAAJ,CAAaN,CAAb,CAAb;;AACA,UAAI,CAACa,IAAL,EAAW;AACT;AACD;;AACD,UAAIW,KAAK,GAAGD,KAAZ,EAAmB;AACjB;AACA,cAAML,EAAE,GAAGC,QAAQ,CAACC,aAAT,CAAuB,IAAvB,CAAX;AACAR,QAAAA,GAAG,CAACS,YAAJ,CAAiBH,EAAjB,EAAqBL,IAArB;;AAEA,YAAIW,KAAK,KAAKD,KAAK,GAAG,CAAtB,EAAyB;AACvBA,UAAAA,KAAK,GAAG,CAAR;AACD;;AACD;AACD;;AACD,UAAIV,IAAI,CAACa,OAAL,GAAe,CAAnB,EAAsB;AACpBH,QAAAA,KAAK,GAAGC,KAAK,GAAGX,IAAI,CAACa,OAArB;AACD;AACF;AACF;AACF;;AAEM,SAASC,OAAT,CAAiBC,IAAjB,EAA8D;AACnE,SAAOA,IAAI,CAACC,QAAL,KAAkB,OAAzB;AACD;;AAEM,SAASC,YAAT,CAAsBC,EAAtB,EAAuC;AAC5C,QAAMC,UAAU,GAAGD,EAAE,CAACC,UAAtB;AACA,SACEA,UAAU,EAAEH,QAAZ,KAAyB,OAAzB,IACCG,UAAU,EAAEC,UAAZ,KAA2BF,EAA3B,IAAiCC,UAAU,CAACH,QAAX,KAAwB,OAF5D;AAID","sourcesContent":["function excuteByTimes(fn: Function, times: number) {\n  for (let i = 0; i < times; i++) {\n    fn();\n  }\n}\n\n// 拆分 table 已合并的单元格\nexport function normalizeTable(table: HTMLTableElement) {\n  const colgroup = table.getElementsByTagName('colgroup')[0];\n  const colsNum = colgroup.children.length;\n  const rows = Array.from(table.rows);\n\n  // 处理 colSpan 合并的单元格\n  rows.forEach((row) => {\n    for (let i = 0; i < colsNum; i++) {\n      const cell = row.children[i] as HTMLTableCellElement;\n      if (!cell || !(cell.colSpan > 1)) {\n        continue;\n      }\n\n      const nextCell = cell.nextElementSibling;\n      const correctTable = () => {\n        const td = document.createElement('td');\n        if (nextCell) {\n          row.insertBefore(td, nextCell);\n        } else {\n          row.appendChild(td);\n        }\n      }\n      excuteByTimes(correctTable, cell.colSpan - 1);\n    }\n  });\n\n  // 处理 rowSpan 合并的单元格\n  for (let i = 0; i < colsNum; i++) {\n    let range = 0;\n    for (const [index, row] of rows.entries()) {\n      const cell = row.children[i] as HTMLTableCellElement;\n      if (!cell) {\n        continue;\n      }\n      if (index < range) {\n        // 补上单元格\n        const td = document.createElement('td');\n        row.insertBefore(td, cell);\n\n        if (index === range - 1) {\n          range = 0;\n        }\n        continue;\n      }\n      if (cell.rowSpan > 1) {\n        range = index + cell.rowSpan;\n      }\n    }\n  }\n}\n\nexport function isTable(node: HTMLElement): node is HTMLTableElement {\n  return node.nodeName === 'TABLE';\n}\n\nexport function isHeadingRow(tr: HTMLElement) {\n  const parentNode = tr.parentNode;\n  return (\n    parentNode?.nodeName === 'THEAD' ||\n    (parentNode?.firstChild === tr && parentNode.nodeName === 'TBODY')\n  );\n}\n"],"file":"utils.js"}