{"version":3,"sources":["../../../../../src/bi/components/colToolbar/index.tsx"],"names":["usePixelColsWidth","useRowIsSticky","useScrollableContainerRect","useTableScrollContainerWidth","useTableScrollContainerScrollLeft","hooks","fallbackRect","left","top","right","bottom","height","width","Wrapper","styled","div","STICKY_ROW_TOP_HEIGHT","STICKY_TOOLBAR_INDEX_MAP","colToolbar","ColToolbarWrapper","ColToolbarResizer","props","TOOLBAR_ITEM_SIZE","scale","THEME","blue3","ColInlineToolbar","TableColToolbar","table","controller","tableRef","positionedAncestorRef","scrollContainer","zoomContainer","colIndicatorRef","isTableSelected","selection","locale","isHideDeleteButton","isHoverCornerToolbar","getLastActiveTableKey","onContextMenu","onSelect","onColResize","onGetAllColsNodes","setIsHighlightSelection","hoverSelection","setHoverSelection","colsWidth","isSticky","isColumnHeader","Table","contextMenuVisible","setContextMenuVisible","React","useState","positionOfInsertButton","setPositionOfInsertButton","isHoverDelete","setIsHoverDelete","resizingColData","setResizingColData","colIndex","colResizerHeight","hoverToolbarItemIndex","setHoverToolbarItemIndex","isDragging","setIsDragging","draggingColWidth","setDraggingColWidth","colToolbarRef","useRef","toolbarWrapperRef","resizingColDataRef","colSelectionRectRef","insetBtnPosRef","draggingColResizerRef","startClientXRef","startPositionLeftRef","originBodyCursorRef","deleteButtonRef","insertButtonRef","colsNodes","deleteButtonLeftRef","dragElementRef","startSelectIndexRef","getAllColsNodes","useCallback","current","getColsRects","map","node","rect","getBoundingClientRect","isSelectWholeCol","query","getColItemRect","index","thisNode","ReactDOM","findDOMNode","colNode","children","colRect","getSelectedIndexRange","tableSelection","isSelectWholeTable","startColIndex","endColIndex","nodes","start","end","getSortedSelectedRange","r","selectedIndexRange","range","min","Math","max","getColToolbarTop","thisRect","shouldHideButton","relativeLeft","undefined","tableRect","calcColsWidth","startIndex","endIndex","Array","isArray","slice","reduce","acc","w","updateInsertButtonStyle","toolbarRect","insertButtonNode","insertButtonRect","result","insertButtonLeft","curTop","abs","offsetHeight","DISTANCE_BETWEEN_INSERT_BUTTON_AND_TOOLBAR","style","shouldHide","visibility","setRectStyle","bgColor","borderColr","border","borderBottom","length","borderTopRightRadius","backgroundColor","updateColSelectionRectStyle","data","colSelectionNode","red1","blue1","borderColor","toolbarBgColor","hover","toolbarBorderColor","setItemsRectStyleByRange","useEffect","colsCount","default","updateIndicatorStyle","trueTableDOM","trueTableRect","round","SCROLL_BAR_HEIGHT","handleColResizing","event","preventDefault","relativeEvent","colToolbarItem","previousElementSibling","colToolbarNextItem","nextElementSibling","colToolbarItemRect","validClientX","MIN_COL_WIDTH","relativeX","getAttribute","colToolbarNextItemRect","startClientX","delta","hideContextMenu","document","removeEventListener","handleColResizeEnd","parseInt","resizingColIndex","body","cursor","handleColResizeStart","target","setProperty","REALTABLE_PADDING","addEventListener","handlePreventDefault","stopPropagation","handleContextMenu","isResizingCol","handleMouseEnterColToolbarItem","isNaN","tableRows","key","startRowIndex","endRowIndex","handleMouseOutColToolbarItem","handleMouseOver","e","clientX","scrollRect","horizontalPadding","colsRect","findIndex","handleMouseOut","insertButton","contains","selectCols","shouldHideContextMenu","shouldEnableEndDrag","insertIndex","colsLength","maxRowIndex","leftColSelection","handleMultiSelectCol","buttons","removeMultiSelectListener","colToolbarX","offsetX","endSelectedIndex","i","showIndicatorVisible","isVisible","opacity","setInsertButtonPos","addMultiSelectListener","moveColToIndex","originIndexRange","targetIndex","run","updateDragElementPosition","x","y","isShowColToolbar","updateDraggingStyle","clientY","relativeY","tableDOM","domUtils","colsRects","sortRange","shouldDragEnd","handleDragEnd","handleDragging","findDOMNodeSafely","handleDragStart","selectedIndex","enableDragIcon","Boolean","handleSelectCol","shiftKey","timer","isRightClick","clearTimer","clearTimeout","removeCancelDragEventListener","window","setTimeout","DRAG_TRIGGER_TIME","removeDragEventListener","handleColRectUpdate","isDelete","splice","insertCol","colWidth","deleteCol","highlightSelection","cancelHighlightSelection","renderColToolbarItems","useMemo","indexRange","deleteRange","selectRanges","push","activeRange","forEach","resizerLeft","translateY","INDICATOR_WRAPPER_WIDTH","GAP_BEWTEEN_INDICATOR_TOOLBAR","translateX","isLastItem","alignItems","transform","justifyContent","isShowButton","isShowDelete","handleMouseMove","sortedRange","leading","updateDeleteButtonStyle","menuNode","menuRect","startColRect","endColRect","mid","containerLeft","DISTANCE_BETWEEN_DELETE_BUTTON_AND_TOOLBAR","useLayoutEffect","fastdom","measure","borderRadius","containerWidth","tableScrollLeft","scrollLeft","isShowInsertButton","tableHeight","showInsert","wrapperStyle","pointerEvents","background","Number","isFinite","display","createPortal","transition"],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-shadow */\n/* eslint-disable max-lines */\n/* eslint-disable react/no-find-dom-node */\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport styled from 'styled-components';\nimport { throttle } from 'lodash-es';\nimport fastdom from 'fastdom';\nimport { domUtils } from '@ali/4ever-cangjie';\nimport Table from '../../../mo/models';\nimport {\n  getBoundingRelativeRect,\n  getRelativeMouseEvent,\n} from '@ali/4ever-utils';\nimport {\n  DISTANCE_BETWEEN_DELETE_BUTTON_AND_TOOLBAR,\n  DISTANCE_BETWEEN_INSERT_BUTTON_AND_TOOLBAR,\n  DRAG_TRIGGER_TIME,\n  MIN_COL_WIDTH,\n  THEME,\n  TOOLBAR_ITEM_SIZE,\n} from '../../constants';\nimport { TableColToolbarItem } from './tableColToolbarItem';\nimport { ColResizer } from '../styled';\nimport { ISelectedIndexRange, ITableSelection } from '../../types';\nimport {\n  clickTableToolbar,\n  deleteTableCols,\n  insertTableCol,\n  moveTableCols,\n} from '../../actions';\nimport InlineToolbarInsertButton from '../inlineToolbarButtons/inlineToolbarInsertButton';\nimport InlineToolbarDeleteButton from '../inlineToolbarButtons/inlineToolbarDeleteButton';\nimport InsertButtonIndicator, {\n  GAP_BEWTEEN_INDICATOR_TOOLBAR,\n  INDICATOR_WRAPPER_WIDTH,\n} from '../inlineToolbarButtons/insertButtonIndicator';\nimport DragElement from '../colToolbar/dragElement';\nimport { scrollHorizontal } from '../../utils/scrollContainer';\nimport createToolbarWithTableSeletion from '../createToolbarWithTableSelection';\nimport type { TableColToolbarProps } from '../createToolbarWithTableSelection';\nimport getDataTableSelectionByTable from '../../utils/getDataTableSelectionByTable';\nimport {\n  REALTABLE_PADDING,\n  SCROLL_BAR_HEIGHT,\n  STICKY_ROW_TOP_HEIGHT,\n  STICKY_TOOLBAR_INDEX_MAP,\n} from '../../../utils/constants';\nimport * as hooks from '../../../utils/hooks';\n\nconst {\n  usePixelColsWidth,\n  useRowIsSticky,\n  useScrollableContainerRect,\n  useTableScrollContainerWidth,\n  useTableScrollContainerScrollLeft,\n} = hooks;\n\nconst fallbackRect = {\n  left: -1,\n  top: -1,\n  right: -1,\n  bottom: -1,\n  height: -1,\n  width: -1,\n};\n\nconst Wrapper = styled.div`\n  visibility: hidden;\n  pointer-events: none;\n\n  &[data-sticky=\"true\"] {\n    position: fixed;\n    height: ${STICKY_ROW_TOP_HEIGHT}px;\n    overflow: hidden;\n    z-index: ${STICKY_TOOLBAR_INDEX_MAP.colToolbar};\n\n    [data-testid=\"table-col-toolbar\"] {\n      position: absolute;\n      bottom: 0;\n    }\n  }\n`;\n\nconst ColToolbarWrapper = styled.div`\n  position: relative;\n  z-index: 3;\n`;\n\nconst ColToolbarResizer = styled.div<{ scale: number }>`\n  position: absolute;\n  top: 0;\n  width: 7px;\n  height: ${(props) => ((TOOLBAR_ITEM_SIZE) / props.scale)}px;\n  margin-left: -3px;\n  background-color: transparent;\n  z-index: 1;\n  cursor: col-resize;\n\n  &:hover {\n    background-color: ${THEME.blue3};\n  }\n`;\n\nconst ColInlineToolbar = styled.div`\n  position: absolute;\n  z-index: 101;\n  transition: opacity ease-in-out 0.25s;\n`;\n\ninterface ResizingColData {\n  colIndex: number;\n  left: number;\n  top: number;\n  colResizerHeight: number;\n}\n\nfunction TableColToolbar(props: TableColToolbarProps) {\n  const {\n    table,\n    controller,\n    tableRef,\n    positionedAncestorRef,\n    scrollContainer,\n    zoomContainer,\n    colIndicatorRef,\n    isTableSelected,\n    selection,\n    scale,\n    locale,\n    isHideDeleteButton,\n    isHoverCornerToolbar,\n    getLastActiveTableKey,\n    onContextMenu,\n    onSelect,\n    onColResize,\n    onGetAllColsNodes,\n    setIsHighlightSelection,\n    hoverSelection,\n    setHoverSelection,\n  } = props;\n\n  const [colsWidth] = usePixelColsWidth();\n  const [isSticky] = useRowIsSticky();\n  const isColumnHeader = Table.isColumnHeader(table);\n\n  const [contextMenuVisible, setContextMenuVisible] = React.useState<boolean>(false);\n  const [positionOfInsertButton, setPositionOfInsertButton] = React.useState<number>(-1);\n  const [isHoverDelete, setIsHoverDelete] = React.useState<boolean>(false);\n  const [resizingColData, setResizingColData] = React.useState<ResizingColData>({ colIndex: -1, left: 0, top: 0, colResizerHeight: 0 });\n  const [hoverToolbarItemIndex, setHoverToolbarItemIndex] = React.useState<number>(-1);\n  const [isDragging, setIsDragging] = React.useState<boolean>(false);\n  const [draggingColWidth, setDraggingColWidth] = React.useState<number>(0);\n\n  const colToolbarRef = React.useRef<HTMLDivElement>(null);\n\n  const toolbarWrapperRef = React.useRef<HTMLDivElement>(null);\n\n  const resizingColDataRef = React.useRef<ResizingColData>({ colIndex: -1, left: 0, top: 0, colResizerHeight: 0 });\n\n  const colSelectionRectRef = React.useRef<HTMLDivElement>(null);\n\n  const insetBtnPosRef = React.useRef<number>(-1);\n\n  const draggingColResizerRef = React.useRef<HTMLDivElement | null>(null);\n\n  const startClientXRef = React.useRef<number | null>(null);\n\n  const startPositionLeftRef = React.useRef<number>(0);\n\n  const originBodyCursorRef = React.useRef<string>('');\n\n  const deleteButtonRef = React.useRef<HTMLDivElement>(null);\n\n  const insertButtonRef = React.useRef<HTMLDivElement>(null);\n\n  const colsNodes = React.useRef<HTMLDivElement[]>([]);\n\n  const deleteButtonLeftRef = React.useRef<number>(-1);\n\n  const dragElementRef = React.useRef<HTMLDivElement>(null);\n\n  const startSelectIndexRef = React.useRef<number>(-1);\n\n  const getAllColsNodes = React.useCallback(() => {\n    return colsNodes.current;\n  }, []);\n\n  const getColsRects = React.useCallback(() => {\n    return getAllColsNodes().map(\n      (node) => {\n        const rect = node.getBoundingClientRect();\n        return rect || fallbackRect;\n      },\n    );\n  }, [getAllColsNodes]);\n\n  const isSelectWholeCol = React.useCallback(() => {\n    return controller.query('isSelectWholeCol', {\n      node: table,\n    });\n  }, [controller, table]);\n\n  const getColItemRect = React.useCallback((index: number): DOMRect | null => {\n    const thisNode = ReactDOM.findDOMNode(colToolbarRef.current) as HTMLElement;\n    const colNode = thisNode.children[index * 2] as HTMLDivElement;\n    if (!colNode) {\n      return null;\n    }\n    const colRect = getBoundingRelativeRect(colNode, zoomContainer) as DOMRect;\n    return colRect;\n  }, [zoomContainer]);\n\n\n  const getSelectedIndexRange = React.useCallback(() => {\n    if (!selection) {\n      return null;\n    }\n    const tableSelection = getDataTableSelectionByTable(controller, table);\n\n    if (!tableSelection) {\n      return null;\n    }\n    const isSelectWholeTable = controller.query('isSelectWholeTable', {\n      node: table,\n    });\n    if (isSelectWholeTable) {\n      return null;\n    }\n\n    const {\n      startColIndex,\n      endColIndex,\n    } = tableSelection as ITableSelection;\n    if (!table.nodes) {\n      return null;\n    }\n    if (isSelectWholeCol()) {\n      return {\n        start: startColIndex,\n        end: endColIndex,\n      };\n    }\n    return null;\n  }, [controller, table, selection, isSelectWholeCol]);\n\n  const getSortedSelectedRange = React.useCallback((r?: ISelectedIndexRange) => {\n    const selectedIndexRange = getSelectedIndexRange();\n    const range = r || selectedIndexRange;\n    if (!range) {\n      return null;\n    }\n    const { start, end } = range;\n    const min = Math.min(start, end);\n    const max = Math.max(start, end);\n    return {\n      min,\n      max,\n    };\n  }, [getSelectedIndexRange]);\n\n  const getColToolbarTop = React.useCallback(() => {\n    if (!selection) {\n      return null;\n    }\n    const thisNode = ReactDOM.findDOMNode(colToolbarRef.current) as HTMLElement;\n    const thisRect = getBoundingRelativeRect(thisNode, zoomContainer);\n\n    return {\n      top: thisRect.top,\n    };\n  }, [selection, zoomContainer]);\n\n  const shouldHideButton = React.useCallback((relativeLeft: number) => {\n    const thisNode = ReactDOM.findDOMNode(colToolbarRef.current);\n    if (!thisNode || !scrollContainer.current) {\n      return undefined;\n    }\n    const tableRect = getBoundingRelativeRect(scrollContainer.current, zoomContainer);\n    return relativeLeft < -26 ||\n      relativeLeft - tableRect.right > 0;\n  }, [zoomContainer, scrollContainer]);\n\n  const calcColsWidth = React.useCallback((startIndex: number, endIndex: number) => {\n    if (!Array.isArray(colsWidth)) {\n      return 0;\n    }\n\n    if (endIndex < startIndex) return 0;\n\n    return colsWidth\n      .slice(startIndex, endIndex + 1)\n      .reduce((acc, w) => {\n        return acc + w;\n      }, 0);\n  }, [colsWidth]);\n\n  // @ts-ignore\n  const updateInsertButtonStyle = React.useCallback(() => {\n    if (\n      !selection\n      || positionOfInsertButton === -1\n      || !toolbarWrapperRef.current\n      || positionOfInsertButton === -1\n      || !Array.isArray(colsWidth)\n    ) {\n      return;\n    }\n\n    let relativeLeft = -1;\n    const toolbarRect = getBoundingRelativeRect(toolbarWrapperRef.current, zoomContainer);\n\n    const insertButtonNode = ReactDOM.findDOMNode(insertButtonRef.current) as HTMLElement;\n    if (!insertButtonNode) {\n      return;\n    }\n    const insertButtonRect = getBoundingRelativeRect(insertButtonNode, zoomContainer);\n\n    relativeLeft = calcColsWidth(0, positionOfInsertButton - 1) + toolbarRect.left;\n    relativeLeft -= insertButtonRect.width / 2;\n\n    const result = getColToolbarTop();\n    if (!result) return null;\n\n    const { top } = result;\n    const insertButtonLeft = relativeLeft / scale + 1; // 1px作为修正值\n    const curTop = Math.abs(top / scale - insertButtonNode.offsetHeight - DISTANCE_BETWEEN_INSERT_BUTTON_AND_TOOLBAR);\n    insertButtonNode.style.top = `${curTop}px`;\n    insertButtonNode.style.left = `${insertButtonLeft}px`;\n    const shouldHide = shouldHideButton(relativeLeft);\n    if (shouldHide) {\n      insertButtonNode.style.visibility = 'hidden';\n    } else {\n      insertButtonNode.style.visibility = 'visible';\n    }\n  }, [selection, positionOfInsertButton, colsWidth, zoomContainer, calcColsWidth, getColToolbarTop, scale, shouldHideButton]);\n\n  const setRectStyle = React.useCallback(\n    (\n      node: HTMLDivElement,\n      startIndex: number,\n      endIndex: number,\n      bgColor: string,\n      borderColr: string,\n    ) => {\n      if (!Array.isArray(colsWidth)) {\n        return;\n      }\n      const left = calcColsWidth(0, startIndex - 1);\n      node.style.left = `${left}px`;\n      const width = calcColsWidth(startIndex, endIndex);\n      node.style.border = `1px solid ${borderColr}`;\n      node.style.borderBottom = 'unset';\n      if (endIndex === colsWidth!.length - 1) {\n        node.style.borderTopRightRadius = '3px';\n      } else {\n        node.style.borderTopRightRadius = 'unset';\n      }\n      node.style.width = `${width + 1}px`;\n      if (bgColor) {\n        node.style.backgroundColor = bgColor;\n      }\n    },\n    [colsWidth, calcColsWidth],\n  );\n\n  const updateColSelectionRectStyle = React.useCallback(() => {\n    const selectedIndexRange = getSelectedIndexRange();\n    if (!selection || !table.data.colsWidth || isHoverCornerToolbar) {\n      return;\n    }\n    const { startColIndex, endColIndex } = selection;\n    const colSelectionNode = ReactDOM.findDOMNode(colSelectionRectRef.current) as HTMLDivElement;\n    if (!colSelectionNode) {\n      return;\n    }\n    // 全选表格的时候工具栏背景色也需要变化\n    const isSelectWholeTable = controller.query('isSelectWholeTable', {\n      node: table,\n    });\n    if (selectedIndexRange || isSelectWholeTable) {\n      const bgColor = isHoverDelete ? THEME.red1 : THEME.blue1;\n      const borderColor = isHoverDelete ? THEME.red1 : THEME.blue3;\n      setRectStyle(colSelectionNode, startColIndex, endColIndex, bgColor, borderColor);\n    } else {\n      setRectStyle(colSelectionNode, startColIndex, endColIndex, THEME.toolbarBgColor.hover, THEME.toolbarBorderColor);\n    }\n  }, [getSelectedIndexRange, selection, table, controller, isHoverDelete, setRectStyle, isHoverCornerToolbar]);\n\n  // hover到汉堡的时候高亮工具栏\n  const setItemsRectStyleByRange = React.useCallback((startColIndex: number, endColIndex: number, bgColor: string, borderColor: string) => {\n    const colSelectionNode = ReactDOM.findDOMNode(colSelectionRectRef.current) as HTMLDivElement;\n    if (!colSelectionNode) {\n      return;\n    }\n    setRectStyle(colSelectionNode, startColIndex, endColIndex, bgColor, borderColor);\n  }, [setRectStyle]);\n\n  React.useEffect(() => {\n    const colsCount = table.data?.colsWidth?.length;\n    if (!colsCount) return;\n    if (isHoverCornerToolbar) {\n      setItemsRectStyleByRange(0, colsCount - 1, THEME.blue1, THEME.blue3);\n    } else {\n      if (!selection || !table.data.colsWidth) {\n        setItemsRectStyleByRange(0, colsCount - 1, THEME.toolbarBgColor.default, THEME.toolbarBorderColor);\n        return;\n      }\n      updateColSelectionRectStyle();\n    }\n  }, [\n    setItemsRectStyleByRange,\n    updateColSelectionRectStyle,\n    selection,\n    table.data?.colsWidth?.length,\n    isHoverCornerToolbar,\n    table,\n    controller,\n  ]);\n\n  const updateIndicatorStyle = React.useCallback(() => {\n    if (\n      !colIndicatorRef.current ||\n      !selection ||\n      positionOfInsertButton === -1 ||\n      !tableRef.current ||\n      !positionedAncestorRef.current ||\n      !toolbarWrapperRef.current\n    ) {\n      return;\n    }\n    const trueTableDOM = tableRef.current;\n    const trueTableRect = getBoundingRelativeRect(\n      trueTableDOM,\n      positionedAncestorRef.current,\n    );\n    const toolbarRect = getBoundingRelativeRect(\n      toolbarWrapperRef.current,\n      positionedAncestorRef.current,\n    );\n    const left = positionOfInsertButton === 0\n      ? 0\n      : calcColsWidth(0, positionOfInsertButton - 1);\n    const height = trueTableRect.bottom - toolbarRect.top;\n    colIndicatorRef.current.style.left = `${Math.round(left / scale)}px`;\n    colIndicatorRef.current.style.bottom = `${Math.round(SCROLL_BAR_HEIGHT / scale)}px`;\n    colIndicatorRef.current.style.height = `${height / scale}px`;\n  }, [colIndicatorRef, selection, positionOfInsertButton, tableRef, positionedAncestorRef, calcColsWidth, scale]);\n\n  const handleColResizing = React.useCallback((event) => {\n    if (!draggingColResizerRef.current) return;\n\n    event.preventDefault();\n\n    const relativeEvent = getRelativeMouseEvent(event, zoomContainer);\n\n    const colToolbarItem = draggingColResizerRef.current.previousElementSibling as HTMLElement;\n    const colToolbarNextItem = draggingColResizerRef.current.nextElementSibling as HTMLElement;\n\n    if (!colToolbarItem || !colToolbarNextItem) return;\n    const colToolbarItemRect = getBoundingRelativeRect(colToolbarItem, zoomContainer);\n    let validClientX = Math.max(\n      colToolbarItemRect.left + MIN_COL_WIDTH * scale,\n      relativeEvent.relativeX,\n    );\n    if (colToolbarNextItem && colToolbarNextItem.getAttribute('data-index') !== null) {\n      const colToolbarNextItemRect = getBoundingRelativeRect(colToolbarNextItem, zoomContainer);\n      validClientX = Math.min(\n        colToolbarNextItemRect.left + colToolbarNextItemRect.width - MIN_COL_WIDTH * scale,\n        validClientX,\n      );\n    }\n\n    const startClientX = startClientXRef.current;\n    if (startClientX == null) {\n      return;\n    }\n    const delta = validClientX - startClientX;\n    const left = startPositionLeftRef.current + Math.round(delta / scale);\n    setResizingColData({\n      ...resizingColDataRef.current,\n      left,\n    });\n  }, [zoomContainer, scale]);\n\n  const hideContextMenu = React.useCallback(() => {\n    setContextMenuVisible(false);\n\n    document.removeEventListener('mousedown', hideContextMenu);\n  }, []);\n\n  const handleColResizeEnd = React.useCallback(() => {\n    // Fix to https://work.aone.alibaba-inc.com/issue/38856463. draggingColResizerRef.current会存在为null的情况\n    // 暂时不好定位具体原因，先做兜底处理\n    if (!draggingColResizerRef.current) {\n      document.removeEventListener('mousedown', hideContextMenu);\n      document.removeEventListener('mousemove', handleColResizing);\n      document.removeEventListener('mouseup', handleColResizeEnd);\n      return;\n    }\n    const delta = parseInt(draggingColResizerRef.current.style.left, 10) - startPositionLeftRef.current;\n    const resizingColIndex = parseInt(draggingColResizerRef.current.getAttribute('data-index')!, 10);\n    onColResize(resizingColIndex, delta);\n    draggingColResizerRef.current.style.backgroundColor = '';\n    draggingColResizerRef.current = null;\n    startClientXRef.current = null;\n    startPositionLeftRef.current = 0;\n\n    document.body.style.cursor = originBodyCursorRef.current;\n    originBodyCursorRef.current = '';\n\n    setResizingColData({\n      ...resizingColData,\n      colIndex: -1,\n    });\n\n    document.removeEventListener('mousedown', hideContextMenu);\n    document.removeEventListener('mousemove', handleColResizing);\n    document.removeEventListener('mouseup', handleColResizeEnd);\n  }, [onColResize, resizingColData, hideContextMenu, handleColResizing]);\n\n  const handleColResizeStart = React.useCallback((event: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    // NOTE: 不阻止冒泡，以便触发上层清空表格选区逻辑\n    event.preventDefault();\n    const relativeEvent = getRelativeMouseEvent(event, zoomContainer);\n\n    startClientXRef.current = relativeEvent.relativeX;\n    draggingColResizerRef.current = event.target as HTMLDivElement;\n    const resizingColIndex = parseInt(draggingColResizerRef.current.getAttribute('data-index')!, 10);\n    const left = parseInt(draggingColResizerRef.current.style.left, 10);\n    draggingColResizerRef.current.style.backgroundColor = 'transparent';\n\n    originBodyCursorRef.current = document.body.style.cursor;\n    document.body.style.setProperty('cursor', 'col-resize', 'important');\n\n    const table = ReactDOM.findDOMNode(tableRef.current);\n\n    const tableRect = getBoundingRelativeRect(table as HTMLElement, zoomContainer);\n    const top = REALTABLE_PADDING.top / scale;\n    startPositionLeftRef.current = left;\n    resizingColDataRef.current = {\n      colIndex: resizingColIndex,\n      left,\n      top,\n      colResizerHeight: (tableRect.height + TOOLBAR_ITEM_SIZE - REALTABLE_PADDING.top) / scale,\n    };\n\n    setResizingColData({\n      colIndex: resizingColIndex,\n      left,\n      top,\n      colResizerHeight: (tableRect.height + TOOLBAR_ITEM_SIZE - REALTABLE_PADDING.top) / scale,\n    });\n    document.addEventListener('mousemove', handleColResizing);\n    document.addEventListener('mouseup', handleColResizeEnd);\n  }, [handleColResizing, handleColResizeEnd, scale, tableRef, zoomContainer]);\n\n  const handlePreventDefault = React.useCallback((event) => {\n    event.preventDefault();\n    event.stopPropagation();\n  }, []);\n\n  const handleContextMenu = React.useCallback((event) => {\n    handlePreventDefault(event);\n\n    onContextMenu(event);\n\n    setContextMenuVisible(true);\n  }, [onContextMenu, handlePreventDefault]);\n\n  const isResizingCol = React.useCallback(() => {\n    return resizingColData && resizingColData.colIndex !== -1;\n  }, [resizingColData]);\n\n  const handleMouseEnterColToolbarItem = React.useCallback((event) => {\n    const index = parseInt(event.target.getAttribute('data-index'), 10);\n    if (isNaN(index)) return;\n    // hover对样式的影响优先级低于选中状态\n    const tableRows = table.nodes.length;\n    if (tableRows) {\n      // 构造hover选区\n      const hoverSelection = {\n        key: table.key,\n        startColIndex: index,\n        endColIndex: index,\n        startRowIndex: 0,\n        endRowIndex: tableRows - 1,\n      };\n      setHoverSelection(hoverSelection);\n    }\n  }, [setHoverSelection, table.key, table.nodes.length]);\n\n  const handleMouseOutColToolbarItem = React.useCallback(() => {\n    setHoverSelection(null);\n  }, [setHoverSelection]);\n\n  const handleMouseOver = React.useCallback((e) => {\n    if (isDragging || isResizingCol() || !scrollContainer.current) {\n      return;\n    }\n    const { clientX } = e;\n    const scrollRect = scrollContainer.current.getBoundingClientRect();\n    const horizontalPadding = 10;\n    if (\n      clientX < scrollRect.left - horizontalPadding\n      || clientX > scrollRect.right + horizontalPadding\n    ) {\n      return;\n    }\n    const colsRect = getColsRects();\n    const index = colsRect.findIndex((rect) => {\n      // node.getBoundingClientRect() 可能是 undefined？\n      // 这里比较奇怪，就算 node 从 DOM 中卸载，也会返回 DOMRect 只是数据都是 0\n      // 先兼容\n      if (!rect) {\n        return false;\n      }\n      return clientX >= rect.left && clientX <= rect.right;\n    });\n    setHoverToolbarItemIndex(index);\n  }, [isDragging, isResizingCol, scrollContainer, getColsRects]);\n\n  const handleMouseOut = React.useCallback((e) => {\n    const insertButton = insertButtonRef.current;\n    if (insertButton && insertButton.contains(e.target)) {\n      return;\n    }\n    if (isDragging || isResizingCol()) {\n      return;\n    }\n    setHoverToolbarItemIndex(-1);\n  }, [isDragging, isResizingCol]);\n\n  const selectCols = React.useCallback((\n    start: number,\n    end: number,\n    shouldHideContextMenu = true,\n  ) => {\n    if (start === end) {\n      startSelectIndexRef.current = start;\n    }\n    onSelect(\n      {\n        start,\n        end,\n      },\n      shouldHideContextMenu,\n    );\n  }, [onSelect]);\n\n  const shouldEnableEndDrag = React.useCallback((insertIndex: number, colsLength: number) => {\n    if (insertIndex === 0 && isColumnHeader) {\n      return false;\n    }\n    if (insertIndex > 0 && insertIndex < colsLength) {\n      const maxRowIndex = table.nodes.length - 1;\n      const leftColSelection: ITableSelection = {\n        startRowIndex: 0,\n        endRowIndex: maxRowIndex,\n        startColIndex: 0,\n        endColIndex: insertIndex - 1,\n        key: table.key,\n      };\n      return controller.query(\n        'isAllSelectedCellsComplete',\n        { node: table, tableSelection: leftColSelection },\n      );\n    }\n    return true;\n  }, [table, controller, isColumnHeader]);\n\n  const handleMultiSelectCol = React.useCallback(throttle((event: MouseEvent) => {\n    if (isDragging) {\n      return;\n    }\n    const { buttons } = event;\n    const selectedIndexRange = getSelectedIndexRange();\n    if (buttons !== 1 || !colToolbarRef.current || !selectedIndexRange) {\n      removeMultiSelectListener();\n      return;\n    }\n\n    const colsNodes = getAllColsNodes();\n    const { left: colToolbarX } = colToolbarRef.current.getBoundingClientRect()!;\n    const offsetX = event.clientX - colToolbarX;\n    let endSelectedIndex = colsNodes.length - 1;\n    let acc = 0;\n    for (let i = 0; i < colsNodes.length; i += 1) {\n      acc += colsNodes[i].getBoundingClientRect().width;\n      if (acc > offsetX) {\n        endSelectedIndex = i;\n        break;\n      }\n    }\n    selectCols(startSelectIndexRef.current, endSelectedIndex);\n  }, 100)\n  , [isDragging, getSelectedIndexRange, selectCols]);\n\n  const removeMultiSelectListener = React.useCallback(() => {\n    document.removeEventListener('mousemove', handleMultiSelectCol);\n    document.removeEventListener('mouseup', removeMultiSelectListener);\n  }, [handleMultiSelectCol]);\n\n  const showIndicatorVisible = React.useCallback((isVisible: boolean) => {\n    if (!colIndicatorRef.current) {\n      return;\n    }\n    const opacity = isVisible ? '1' : '0';\n    colIndicatorRef.current.style.opacity = opacity;\n  }, [colIndicatorRef]);\n\n  const setInsertButtonPos = React.useCallback((index: number) => {\n    let i = index;\n    if (i === 0 && isColumnHeader) {\n      i = -1;\n    }\n    setPositionOfInsertButton(i);\n    showIndicatorVisible(i !== -1);\n    insetBtnPosRef.current = i;\n  }, [isColumnHeader, showIndicatorVisible]);\n\n  const addMultiSelectListener = React.useCallback(() => {\n    document.addEventListener('mousemove', handleMultiSelectCol);\n    document.addEventListener('mouseup', removeMultiSelectListener);\n  }, [handleMultiSelectCol, removeMultiSelectListener]);\n\n  const moveColToIndex = React.useCallback((\n    originIndexRange: ISelectedIndexRange,\n    targetIndex: number,\n  ) => {\n    const { min, max } = getSortedSelectedRange(originIndexRange)!;\n    controller.run(\n      'onAction',\n      moveTableCols(\n        table,\n        {\n          start: min,\n          end: max,\n        },\n        targetIndex,\n      ),\n    );\n    const startIndex = min < targetIndex ?\n      targetIndex - (max - min + 1) :\n      targetIndex;\n    selectCols(startIndex, startIndex + max - min);\n  }, [getSortedSelectedRange, controller, selectCols, table]);\n\n  const updateDragElementPosition = React.useCallback((x: number, y: number) => {\n    if (!dragElementRef.current) {\n      return;\n    }\n\n    dragElementRef.current.style.left = `${x / scale}px`;\n    dragElementRef.current.style.top = `${y / scale}px`;\n  }, [scale]);\n\n  const isShowColToolbar = React.useCallback(() => {\n    const selectedIndexRange = getSelectedIndexRange();\n    return !!selectedIndexRange;\n  }, [getSelectedIndexRange]);\n\n  const updateDraggingStyle = React.useCallback((relativeEvent) => {\n    const {\n      clientX,\n      clientY,\n      relativeX,\n      relativeY,\n    } = relativeEvent;\n    const tableDOM = domUtils.findDOMNode(table.key) as HTMLElement;\n    if (!tableDOM) {\n      return;\n    }\n    updateDragElementPosition(relativeX, relativeY);\n    const tableRect = tableDOM.getBoundingClientRect();\n    if (\n      clientX < tableRect.left - TOOLBAR_ITEM_SIZE ||\n      clientX > tableRect.right ||\n      clientY < tableRect.top - TOOLBAR_ITEM_SIZE ||\n      clientY > tableRect.bottom\n    ) {\n      setInsertButtonPos(-1);\n      return;\n    }\n    const colsRects = getColsRects();\n    let insertIndex = -1;\n    for (let i = 0; i < colsRects.length; i++) {\n      const colRect = colsRects[i];\n      if (\n        clientX >= colRect.left &&\n        clientX <= colRect.left + colRect.width / 2\n      ) {\n        insertIndex = i;\n        break;\n      }\n      if (\n        clientX > colRect.left + colRect.width / 2 &&\n        clientX < colRect.right\n      ) {\n        insertIndex = i + 1;\n        break;\n      }\n    }\n    const sortRange = getSortedSelectedRange();\n    if (\n      !sortRange\n      || (\n        insertIndex >= sortRange.min\n        && insertIndex <= sortRange.max + 1\n      )\n    ) {\n      insertIndex = -1;\n    }\n\n    const shouldDragEnd = shouldEnableEndDrag(insertIndex, colsRects.length);\n    if (!shouldDragEnd) {\n      insertIndex = -1;\n    }\n    setInsertButtonPos(insertIndex);\n  }, [\n    table.key,\n    updateDragElementPosition,\n    getColsRects,\n    getSortedSelectedRange,\n    setInsertButtonPos,\n    shouldEnableEndDrag,\n  ]);\n\n  const handleDragEnd = React.useCallback(() => {\n    setIsDragging(false);\n    document.removeEventListener('mouseup', handleDragEnd);\n    if (insetBtnPosRef.current === -1) {\n      return;\n    }\n    const selectedIndexRange = getSelectedIndexRange();\n    moveColToIndex(selectedIndexRange!, insetBtnPosRef.current);\n    setInsertButtonPos(-1);\n  }, [getSelectedIndexRange, moveColToIndex, setInsertButtonPos]);\n\n  const handleDragging = React.useCallback((event: React.MouseEvent | MouseEvent) => {\n    const tableDOM = domUtils.findDOMNodeSafely(table.key) as HTMLElement;\n    if (!tableDOM || event.buttons !== 1) {\n      handleDragEnd();\n      document.removeEventListener('mousemove', handleDragging);\n      return;\n    }\n    event.stopPropagation();\n    const relativeEvent = getRelativeMouseEvent(event, zoomContainer);\n    updateDraggingStyle(relativeEvent);\n    scrollHorizontal(event.clientX, scrollContainer.current);\n  }, [table.key, zoomContainer, updateDraggingStyle, handleDragEnd, scrollContainer]);\n\n  const handleDragStart = React.useCallback((relativeEvent) => {\n    const selectedIndexRange = getSelectedIndexRange();\n    const selectedIndex = selectedIndexRange!.start;\n    setIsDragging(true);\n    setDraggingColWidth(colsWidth![selectedIndex]);\n    updateDraggingStyle(relativeEvent);\n    document.addEventListener('mousemove', handleDragging);\n    document.addEventListener('mouseup', handleDragEnd);\n  }, [colsWidth, setIsDragging, setDraggingColWidth, updateDraggingStyle, handleDragging, getSelectedIndexRange, handleDragEnd]);\n\n  const enableDragIcon = React.useCallback(() => {\n    const range = getSortedSelectedRange();\n    // 表头列禁止拖拽\n    if (isColumnHeader && range?.min === 0) return false;\n\n    return Boolean(range &&\n      hoverToolbarItemIndex >= range.min &&\n      hoverToolbarItemIndex <= range.max);\n  }, [getSortedSelectedRange, hoverToolbarItemIndex, isColumnHeader]);\n\n  const handleSelectCol = React.useCallback(\n    (event) => {\n      handlePreventDefault(event);\n      const selectedIndexRange = getSelectedIndexRange();\n      controller.run('onAction', clickTableToolbar(table, 'col', event.target));\n      const index = parseInt(event.target.getAttribute('data-index'), 10);\n      if (\n        event.shiftKey &&\n        selectedIndexRange &&\n        startSelectIndexRef.current !== index\n      ) {\n        selectCols(startSelectIndexRef.current, index);\n        return;\n      }\n      const sortRange = getSortedSelectedRange();\n      if (!sortRange || index > sortRange.max || index < sortRange.min) {\n        selectCols(index, index);\n        addMultiSelectListener();\n        return;\n      }\n\n      const relativeEvent = getRelativeMouseEvent(event, zoomContainer);\n      let timer: number;\n      const isRightClick = event.buttons === 2;\n      const clearTimer = () => {\n        clearTimeout(timer);\n        selectCols(index, index, !isRightClick);\n        removeCancelDragEventListener();\n      };\n      const removeCancelDragEventListener = () => {\n        document.removeEventListener('mousemove', clearTimer);\n        document.removeEventListener('mouseup', clearTimer);\n      };\n      timer = window.setTimeout(() => {\n        removeMultiSelectListener();\n        removeCancelDragEventListener();\n        handleDragStart(relativeEvent);\n      }, DRAG_TRIGGER_TIME);\n      if (!enableDragIcon()) {\n        clearTimer();\n      }\n\n      addMultiSelectListener();\n      document.addEventListener('mousemove', clearTimer);\n      document.addEventListener('mouseup', clearTimer);\n    },\n    [\n      handlePreventDefault,\n      getSelectedIndexRange,\n      controller,\n      table,\n      getSortedSelectedRange,\n      enableDragIcon,\n      zoomContainer,\n      addMultiSelectListener,\n      selectCols,\n      removeMultiSelectListener,\n      handleDragStart,\n    ],\n  );\n\n  const removeDragEventListener = React.useCallback(() => {\n    document.removeEventListener('mousemove', handleDragging);\n    document.removeEventListener('mouseup', handleDragEnd);\n  }, [handleDragging, handleDragEnd]);\n\n  const handleColRectUpdate = React.useCallback((index: number, colNode: HTMLDivElement, isDelete = false) => {\n    if (isDelete) {\n      colsNodes.current = colsNodes.current.splice(index, 1);\n    } else {\n      colsNodes.current[index] = colNode;\n    }\n    onGetAllColsNodes(getAllColsNodes());\n  }, [onGetAllColsNodes, getAllColsNodes]);\n\n  const insertCol = React.useCallback(() => {\n    const { colsWidth } = table.data;\n    if (!Array.isArray(colsWidth)) {\n      return;\n    }\n    if (positionOfInsertButton === -1) {\n      return;\n    }\n    const colWidth = colsWidth[Math.min(positionOfInsertButton, colsWidth.length - 1)];\n    controller.run(\n      'onAction',\n      insertTableCol(\n        table,\n        positionOfInsertButton,\n        Math.max(0, positionOfInsertButton - 1),\n        colWidth,\n      ),\n    );\n    if (positionOfInsertButton === colsWidth.length) {\n      setInsertButtonPos(positionOfInsertButton + 1);\n    }\n  }, [table, positionOfInsertButton, controller, setInsertButtonPos]);\n\n  const deleteCol = React.useCallback(() => {\n    controller.run('onAction', deleteTableCols(table));\n  }, [controller, table]);\n\n  const highlightSelection = React.useCallback(() => {\n    setIsHighlightSelection(true);\n    setIsHoverDelete(true);\n  }, [setIsHighlightSelection, setIsHoverDelete]);\n\n  const cancelHighlightSelection = React.useCallback(() => {\n    setIsHighlightSelection(false);\n    setIsHoverDelete(false);\n  }, [setIsHighlightSelection, setIsHoverDelete]);\n\n  const renderColToolbarItems = React.useMemo(() => {\n    if (!Array.isArray(colsWidth)) {\n      return null;\n    }\n\n    let left = 0;\n    const children: React.ReactElement[] = [];\n    const isSelectWholeTable = controller.query('isSelectWholeTable', {\n      node: table,\n    });\n    const indexRange = getSelectedIndexRange();\n    const deleteRange = isHoverDelete ? indexRange! : null;\n    const selectRanges = indexRange ? [indexRange] : [];\n    if (isHoverCornerToolbar || isSelectWholeTable) {\n      selectRanges.push({ start: 0, end: colsWidth.length - 1 });\n    } else if (\n      hoverSelection &&\n      hoverSelection.startColIndex === hoverSelection.endColIndex\n    ) {\n      selectRanges.push({\n        start: hoverSelection.startColIndex,\n        end: hoverSelection.endColIndex,\n      });\n    }\n    const activeRange = selection\n      ? {\n        start: selection.startColIndex,\n        end: selection.endColIndex,\n      }\n      : null;\n    colsWidth.forEach((width, index) => {\n      const resizerLeft =\n        resizingColData.colIndex === -1 ? left + width : resizingColData.left;\n\n      const translateY =\n        (INDICATOR_WRAPPER_WIDTH - GAP_BEWTEEN_INDICATOR_TOOLBAR) / scale;\n\n      // 第一个indicator如果不往右偏一点会被表格wrapper截断，因为超出了表格左侧区域\n      const translateX = index === 0 ? '45%' : '55%';\n      const isLastItem = index === colsWidth.length - 1;\n      children.push(\n        <React.Fragment key={index}>\n          <TableColToolbarItem\n            activeRange={activeRange}\n            selectRanges={selectRanges}\n            deleteRange={deleteRange}\n            index={index}\n            scale={scale}\n            onContextMenu={handleContextMenu}\n            onMouseDown={handleSelectCol}\n            onMouseEnter={handleMouseEnterColToolbarItem}\n            onMouseOut={handleMouseOutColToolbarItem}\n            onRectUpdate={handleColRectUpdate}\n          >\n            {index === 0 && isColumnHeader ? null : (\n              <InsertButtonIndicator\n                scale={scale}\n                onClick={insertCol}\n                style={{\n                  alignItems: 'start',\n                  transform: `translate(-${translateX}, -${translateY}px)`,\n                }}\n              />\n            )}\n            {isLastItem ? (\n              <InsertButtonIndicator\n                scale={scale}\n                onClick={insertCol}\n                style={{\n                  alignItems: 'start',\n                  left: `${width}px`,\n                  transform: `translate(-100%, -${translateY}px)`, // 最后一个indicator不能超出表格区域，否则自适应的时候会产生滚动条\n                  justifyContent: 'flex-end',\n                }}\n              />\n            ) : null}\n          </TableColToolbarItem>\n          <ColToolbarResizer\n            data-index={index}\n            data-type=\"col-resizer\"\n            scale={scale}\n            style={{\n              left: resizerLeft,\n              width: index === colsWidth.length - 1 ? '3px' : '',\n            }}\n            onMouseDown={handleColResizeStart}\n          />\n        </React.Fragment>,\n      );\n      left += width;\n    });\n    return children;\n  }, [\n    colsWidth,\n    controller,\n    table,\n    getSelectedIndexRange,\n    isHoverDelete,\n    isHoverCornerToolbar,\n    hoverSelection,\n    selection,\n    resizingColData.colIndex,\n    resizingColData.left,\n    scale,\n    handleContextMenu,\n    handleSelectCol,\n    handleMouseEnterColToolbarItem,\n    handleMouseOutColToolbarItem,\n    handleColRectUpdate,\n    isColumnHeader,\n    insertCol,\n    handleColResizeStart,\n  ]);\n\n  const isShowButton = React.useCallback(() => {\n    return !contextMenuVisible &&\n      zoomContainer &&\n      getLastActiveTableKey() === table.key &&\n      selection;\n  }, [contextMenuVisible, zoomContainer, getLastActiveTableKey, table.key, selection]);\n\n  // 展示插入按钮时隐藏删除按钮\n  const isShowDelete = React.useCallback(() => {\n    return isShowButton() &&\n      isSelectWholeCol() &&\n      isShowColToolbar() &&\n      positionOfInsertButton === -1 &&\n      !isDragging &&\n      !isHideDeleteButton;\n  }, [isShowButton, isSelectWholeCol, isShowColToolbar, positionOfInsertButton, isDragging, isHideDeleteButton]);\n\n  const handleMouseMove = React.useCallback(throttle((event) => {\n    if (\n      isDragging ||\n      isResizingCol() ||\n      !scrollContainer.current\n    ) {\n      return;\n    }\n\n    if (!isTableSelected) {\n      setInsertButtonPos(-1);\n      return;\n    }\n    const colsRects = getColsRects();\n    if (colsRects.length === 0) {\n      return;\n    }\n    const { clientX, clientY } = event;\n    // 鼠标位置在插入按钮区域时，不隐藏插入按钮\n    if (positionOfInsertButton !== -1 && insertButtonRef.current) {\n      const insertButtonNode = ReactDOM.findDOMNode(\n        insertButtonRef.current,\n      ) as HTMLDivElement;\n      const { left, top, right, bottom } = insertButtonNode.getBoundingClientRect();\n      if (\n        clientX >= left &&\n        clientX <= right &&\n        clientY >= top &&\n        clientY <= bottom\n      ) {\n        return;\n      }\n    }\n    const scrollRect = scrollContainer.current.getBoundingClientRect();\n    if (clientX < scrollRect.left || clientX > scrollRect.right) {\n      setInsertButtonPos(-1);\n      return;\n    }\n    let insertIndex = -1;\n    for (let i = 0; i < colsRects.length; i++) {\n      const colRect = colsRects[i];\n      // 理论上 colRect 非空，监控有报错显示 undefined，此处兼容\n      if (!colRect) break;\n      if (\n        clientY < colRect.top &&\n        clientY >= colRect.top - INDICATOR_WRAPPER_WIDTH\n      ) {\n        if (\n          clientX >= colRect.left - INDICATOR_WRAPPER_WIDTH / 2 &&\n          clientX <= colRect.left + INDICATOR_WRAPPER_WIDTH / 2\n        ) {\n          insertIndex = i;\n          break;\n        } else if (\n          clientX >= colRect.left + colRect.width - INDICATOR_WRAPPER_WIDTH / 2 &&\n          clientX <= colRect.left + colRect.width + INDICATOR_WRAPPER_WIDTH / 2\n        ) {\n          insertIndex = i + 1;\n          break;\n        }\n      }\n    }\n    const sortedRange = getSortedSelectedRange();\n    // 加号在所选行中间时，隐藏\n    if (\n      sortedRange &&\n      insertIndex > sortedRange.min &&\n      insertIndex < sortedRange.max + 1\n    ) {\n      insertIndex = -1;\n    }\n    setInsertButtonPos(insertIndex);\n  }, 200, { leading: true })\n  , [scrollContainer, isTableSelected, positionOfInsertButton, isDragging, isResizingCol, getColsRects, getSortedSelectedRange]);\n\n  const updateDeleteButtonStyle = React.useCallback(() => {\n    if (!deleteButtonRef.current || !selection || !isShowDelete()) {\n      return;\n    }\n\n    const menuNode = ReactDOM.findDOMNode(deleteButtonRef.current) as HTMLElement;\n    const menuRect = getBoundingRelativeRect(menuNode, zoomContainer);\n    const result = getColToolbarTop();\n    if (!result) {\n      return;\n    }\n    const { top } = result;\n    const startColRect = getColItemRect(selection.startColIndex);\n    const endColRect = getColItemRect(selection.endColIndex);\n    if (!startColRect || !endColRect) {\n      return;\n    }\n    const mid = (endColRect.right - startColRect.left) / 2;\n    const containerLeft = startColRect.left;\n    const relativeLeft = containerLeft + mid - menuRect.width / 2;\n\n    menuNode.style.top = `${top / scale - menuNode.offsetHeight - DISTANCE_BETWEEN_DELETE_BUTTON_AND_TOOLBAR}px`;\n    deleteButtonLeftRef.current = relativeLeft / scale;\n    menuNode.style.left = `${deleteButtonLeftRef.current - 1}px`;\n    const shouldHide = shouldHideButton(relativeLeft);\n    if (shouldHide) {\n      menuNode.style.opacity = '0';\n    } else {\n      menuNode.style.opacity = '1';\n    }\n  }, [selection, zoomContainer, scale, getColToolbarTop, shouldHideButton, getColItemRect, isShowDelete]);\n\n  React.useLayoutEffect(() => {\n    // 把样式改变放在layoutEffect中执行，防止闪烁\n    if (isTableSelected) {\n      fastdom.measure(() => {\n        updateDeleteButtonStyle();\n        updateInsertButtonStyle();\n        updateIndicatorStyle();\n        updateColSelectionRectStyle();\n      });\n    }\n  }, [updateDeleteButtonStyle, updateInsertButtonStyle, updateIndicatorStyle, updateColSelectionRectStyle, isTableSelected]);\n\n\n  React.useEffect(() => {\n    return () => {\n      document.removeEventListener('mousemove', handleColResizing);\n      document.removeEventListener('mouseup', handleColResizeEnd);\n      document.removeEventListener('mousemove', handleMouseMove);\n      removeMultiSelectListener();\n      removeDragEventListener();\n    };\n  }, []);\n\n  React.useEffect(() => {\n    if (!isTableSelected || !Array.isArray(colsWidth)) {\n      return undefined;\n    }\n    document.addEventListener('mousemove', handleMouseMove);\n    if (contextMenuVisible) {\n      document.addEventListener('mousedown', hideContextMenu);\n      return () => {\n        document.removeEventListener('mousedown', hideContextMenu);\n        document.removeEventListener('mousemove', handleMouseMove);\n      };\n    }\n    return () => {\n      document.removeEventListener('mousemove', handleMouseMove);\n    };\n  }, [isTableSelected, colsWidth, handleMouseMove, contextMenuVisible, hideContextMenu]);\n\n  const width = (colsWidth || []).reduce((acc, w) => acc + w, 0);\n  const style: React.CSSProperties = {\n    width: width + 1, // 保持和整体表格宽度一致\n    height: `${Math.round(TOOLBAR_ITEM_SIZE / scale)}px`,\n    borderRadius: `${Math.round(3 / scale)}px`,\n  };\n\n  const [scrollRect] = useScrollableContainerRect();\n  const containerWidth = useTableScrollContainerWidth();\n  const tableScrollLeft = useTableScrollContainerScrollLeft();\n\n  React.useLayoutEffect(() => {\n    if (!toolbarWrapperRef.current || !isSticky) return;\n\n    toolbarWrapperRef.current.scrollLeft = tableScrollLeft;\n  }, [isSticky, tableScrollLeft]);\n\n  // 在定义的函数内使用 positionOfInsertButton 需要通过ref来保证拿到的是最新值，在外部则通过 positionOfInsertButton 来获取最新值即可\n  const isShowInsertButton = !isDragging && positionOfInsertButton !== -1;\n  const tableHeight = (isDragging && tableRef.current)\n    ? tableRef.current.offsetHeight\n    : 0;\n  const showInsert = !!isShowButton() && isShowInsertButton;\n\n  const wrapperStyle: React.CSSProperties = {};\n  if (isTableSelected) {\n    wrapperStyle.visibility = 'visible';\n    wrapperStyle.pointerEvents = 'auto';\n  }\n  if (isSticky) {\n    wrapperStyle.width = containerWidth;\n    wrapperStyle.background = 'white';\n    if (Number.isFinite(scrollRect.top)) {\n      wrapperStyle.top = scrollRect.top;\n    }\n    if (Number.isFinite(scrollRect.left)) {\n      wrapperStyle.left = scrollRect.left;\n    }\n  }\n\n  return (\n    <Wrapper\n      style={wrapperStyle}\n      data-sticky={isSticky}\n      ref={toolbarWrapperRef}\n      data-testid=\"table-col-toolbar-wrapper\"\n    >\n      <ColToolbarWrapper\n        role=\"toolbar\"\n        ref={colToolbarRef}\n        style={style}\n        data-testid=\"table-col-toolbar\"\n        onMouseOver={handleMouseOver}\n        onMouseOut={handleMouseOut}\n      >\n        {renderColToolbarItems}\n        <ColResizer\n          style={{\n            display: resizingColData.colIndex === -1 ? 'none' : 'block',\n            left: resizingColData.left,\n            top: resizingColData.top,\n            height: resizingColData.colResizerHeight,\n          }}\n        />\n        {ReactDOM.createPortal(\n          <ColInlineToolbar\n            style={{\n              visibility: isShowDelete() ? 'visible' : 'hidden',\n              transition: 'left ease-in-out 0.1s',\n            }}\n            ref={deleteButtonRef}\n            data-testid=\"table-col-inline-toolbar\"\n          >\n            <InlineToolbarDeleteButton\n              mode=\"col\"\n              locale={locale}\n              scale={scale}\n              onDelete={deleteCol}\n              onHighlightSelection={highlightSelection}\n              onCancelHighlightSelection={cancelHighlightSelection}\n            />\n          </ColInlineToolbar>,\n          zoomContainer,\n        )}\n        {ReactDOM.createPortal(\n          <ColInlineToolbar\n            style={{\n              opacity: showInsert ? 1 : 0,\n              pointerEvents: showInsert ? 'auto' : 'none',\n            }}\n            ref={insertButtonRef}\n            data-testid=\"table-col-inline-toolbar-insert\"\n          >\n            <InlineToolbarInsertButton\n              locale={locale}\n              table={table}\n              selection={selection}\n              mode=\"col\"\n              tableRef={tableRef}\n              scale={scale}\n              onInsert={insertCol}\n              zoomContainer={zoomContainer}\n              insertIndex={positionOfInsertButton}\n              getAllColsNodes={getAllColsNodes}\n              onShowIndicatorVisible={showIndicatorVisible}\n            />\n          </ColInlineToolbar>,\n          zoomContainer,\n        )}\n        {zoomContainer && ReactDOM.createPortal(\n          <DragElement\n            ref={dragElementRef}\n            visible={isDragging}\n            width={draggingColWidth}\n            height={tableHeight + TOOLBAR_ITEM_SIZE}\n          />,\n          zoomContainer,\n        )}\n      </ColToolbarWrapper>\n    </Wrapper>\n  );\n}\n\nexport default createToolbarWithTableSeletion(TableColToolbar);\n"],"file":"index.js"}