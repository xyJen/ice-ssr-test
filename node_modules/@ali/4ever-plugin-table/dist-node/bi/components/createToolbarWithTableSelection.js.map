{"version":3,"sources":["../../../../src/bi/components/createToolbarWithTableSelection.tsx"],"names":["createToolbarWithTableSeletion","Comp","props","controller","table","isHoverCornerToolbar","tbSelection","setTbSelection","React","useState","hoverCornerToolbar","setHoverCornerToolbar","prevTbSelectionRef","useRef","prevHoverCornerToolbarRef","updater","useCallback","tbSel","current","selectionData$","useMemo","value","selection"],"mappings":";;;;;;;;;;;;;AAAA;;AACA;;AACA;;AAGA;;uBAJ4B,a;;AA8Db,SAASA,8BAAT,CAAwCC,IAAxC,EAA+G;AAC5H,SAAQC,KAAD,IAAW;AAChB,UAAM;AAAEC,MAAAA,UAAF;AAAcC,MAAAA,KAAd;AAAqBC,MAAAA;AAArB,QAA8CH,KAApD;AACA,UAAM,CAACI,WAAD,EAAcC,cAAd,IAAgCC,KAAK,CAACC,QAAN,CAAe,wDAAyBN,UAAzB,EAAqCC,KAArC,CAAf,CAAtC;AACA,UAAM,CAACM,kBAAD,EAAqBC,qBAArB,IAA8CH,KAAK,CAACC,QAAN,CAAeJ,oBAAf,CAApD;AACA,UAAMO,kBAAkB,GAAGJ,KAAK,CAACK,MAAN,CAAaP,WAAb,CAA3B;AACA,UAAMQ,yBAAyB,GAAGN,KAAK,CAACK,MAAN,CAAaR,oBAAb,CAAlC;AACA,UAAMU,OAAO,GAAGP,KAAK,CAACQ,WAAN,CAAkB,MAAM;AACtC,YAAMC,KAAK,GAAG,wDAAyBd,UAAzB,EAAqCC,KAArC,CAAd;;AACA,UAAI,CAAC,4BAAMQ,kBAAkB,CAACM,OAAzB,EAAkCD,KAAlC,CAAL,EAA+C;AAC7CV,QAAAA,cAAc,CAACU,KAAD,CAAd;AACAL,QAAAA,kBAAkB,CAACM,OAAnB,GAA6BD,KAA7B;AACD,OALqC,CAMtC;;;AACA,UAAIH,yBAAyB,CAACI,OAA1B,KAAsCb,oBAA1C,EAAgE;AAC9DM,QAAAA,qBAAqB,CAACN,oBAAD,CAArB;AACAS,QAAAA,yBAAyB,CAACI,OAA1B,GAAoCb,oBAApC;AACD;AACF,KAXe,EAWb,CAACF,UAAD,EAAaE,oBAAb,EAAmCD,KAAnC,CAXa,CAAhB;AAaA,uCAAiBD,UAAU,CAACgB,cAA5B,EAA4C,IAA5C,EAAkDJ,OAAlD,EAA2D,EAA3D;AAEA,uCAAiBZ,UAAjB,EAA6BY,OAA7B;AAEAP,IAAAA,KAAK,CAACY,OAAN,CACEL,OADF,EAEE,CAACZ,UAAU,CAACkB,KAAX,CAAiBC,SAAlB,EAA6BP,OAA7B,CAFF;AAIA,wBAAO,eAAC,IAAD,6BAAUb,KAAV;AAAiB,MAAA,oBAAoB,EAAEQ,kBAAvC;AAA2D,MAAA,SAAS,EAAEJ;AAAtE,OAAP;AACD,GA5BD;AA6BD","sourcesContent":["import * as React from 'react';\nimport equal from 'fast-deep-equal';\nimport { Controller, useSelectingHots, useSelectionData } from '@ali/4ever-cangjie';\nimport { ISelectedIndexRange, ITableSelection, TableLocale } from '../types';\nimport Table from '../../mo/models';\nimport { getToolbarTableSelection } from '../utils/getToolbarTableSelection';\n\nexport interface TableColToolbarProps {\n  table: Table;\n  controller: Controller;\n  tableRef: React.RefObject<HTMLTableElement>;\n  positionedAncestorRef: React.RefObject<HTMLDivElement>;\n  scrollContainer: React.RefObject<HTMLDivElement>;\n  zoomContainer: HTMLDivElement;\n  colIndicatorRef: React.RefObject<HTMLTableElement>;\n  isTableSelected: boolean;\n  selection: ITableSelection | null;\n  scale: number;\n  getLastActiveTableKey: () => string | null;\n  onContextMenu: (event) => void;\n  onSelect: (\n    selectedColRange: ISelectedIndexRange,\n    shouldHideContextMenu?: boolean,\n  ) => void;\n  onShortcutEvent: () => void;\n  onColResize: (resizeColIndex: number, delta: number) => void;\n  onGetAllColsNodes: (colsNodes: HTMLDivElement[]) => void;\n  setIsHighlightSelection: (isHighlight: boolean) => void;\n  hoverSelection: ITableSelection | null;\n  setHoverSelection: (selection: ITableSelection | null) => void;\n  isHideDeleteButton?: boolean;\n  isHoverCornerToolbar: boolean;\n  locale?: TableLocale;\n}\n\nexport interface TableRowToolbarProps {\n  table: Table;\n  isSelected: boolean;\n  controller: Controller;\n  zoomContainer: HTMLDivElement;\n  scale: number;\n  tableRef: React.RefObject<HTMLTableElement>;\n  offsetParentRef: React.RefObject<HTMLDivElement>;\n  realTableWrapperRef: React.RefObject<HTMLDivElement>;\n  rowIndicatorRef: React.RefObject<HTMLTableElement>;\n  isSelectWholeTable: boolean;\n  selection: ITableSelection | null;\n  scrollableContainer: Window | HTMLElement | null;\n  onContextMenu: (event) => void;\n  onSelect: (\n    selectedIndexRange: ISelectedIndexRange,\n    shouldHideContextMenu?: boolean,\n  ) => void;\n  onRowResize: (resizeColIndex: number, delta: number) => void;\n  setIsHighlightSelection: (isHighlight: boolean) => void;\n  hoverSelection: ITableSelection | null;\n  setHoverSelection: (selection: ITableSelection | null) => void;\n  getLastActiveTableKey: () => string | null;\n  isHideDeleteButton?: boolean;\n  locale?: TableLocale;\n  isHoverCornerToolbar: boolean;\n}\n\nexport default function createToolbarWithTableSeletion(Comp: React.FC<TableColToolbarProps> | React.FC<TableRowToolbarProps>) {\n  return (props) => {\n    const { controller, table, isHoverCornerToolbar } = props;\n    const [tbSelection, setTbSelection] = React.useState(getToolbarTableSelection(controller, table));\n    const [hoverCornerToolbar, setHoverCornerToolbar] = React.useState(isHoverCornerToolbar);\n    const prevTbSelectionRef = React.useRef(tbSelection);\n    const prevHoverCornerToolbarRef = React.useRef(isHoverCornerToolbar);\n    const updater = React.useCallback(() => {\n      const tbSel = getToolbarTableSelection(controller, table);\n      if (!equal(prevTbSelectionRef.current, tbSel)) {\n        setTbSelection(tbSel);\n        prevTbSelectionRef.current = tbSel;\n      }\n      // 要响应hover到左上角汉堡的状态变化\n      if (prevHoverCornerToolbarRef.current !== isHoverCornerToolbar) {\n        setHoverCornerToolbar(isHoverCornerToolbar);\n        prevHoverCornerToolbarRef.current = isHoverCornerToolbar;\n      }\n    }, [controller, isHoverCornerToolbar, table]);\n\n    useSelectionData(controller.selectionData$, null, updater, []);\n\n    useSelectingHots(controller, updater);\n\n    React.useMemo(\n      updater,\n      [controller.value.selection, updater],\n    );\n    return <Comp {...props} isHoverCornerToolbar={hoverCornerToolbar} selection={tbSelection} />;\n  };\n}\n"],"file":"createToolbarWithTableSelection.js"}