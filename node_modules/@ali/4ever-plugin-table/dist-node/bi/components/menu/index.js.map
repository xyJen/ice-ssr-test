{"version":3,"sources":["../../../../../src/bi/components/menu/index.tsx"],"names":["DEFAULT_COL","DEFAULT_ROW","TableMenu","props","selectedCol","setSelectedCol","React","useState","selectedRow","setSelectedRow","menuItem","controller","value","menuKey","title","rest","tableSelection","query","isDisabled","excludeColumns","onChange","row","col","insert","run","handleClickMenuItem","_","e","stopPropagation","handleClickSubMenu","LEGAL_EVENT","quickInsertMenuVisible","visible","padding","PluginRoles","tablePicker","height","margin"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { MenuItem, SubMenu, TablePanel } from '@ali/we-design';\nimport { TableRole as PluginRoles } from '../../../utils/role';\nimport { SubMenuInnerProps } from '@ali/4ever-component';\nimport { dispatchCustomEvent, LEGAL_EVENT, removeNewlineData, removeNewlineTriggerText } from '@ali/4ever-utils';\nimport isSelectionInTableCell from '../../utils/isSelectionInTableCell';\nimport { insertTable } from '../../actions';\n\nconst DEFAULT_COL = 3;\nconst DEFAULT_ROW = 3;\n\nexport default function TableMenu(props: SubMenuInnerProps) {\n  const [selectedCol, setSelectedCol] = React.useState<number>(DEFAULT_COL);\n  const [selectedRow, setSelectedRow] = React.useState<number>(DEFAULT_ROW);\n\n  const { menuItem, controller } = props;\n  const { value } = controller;\n  const { menuKey, title, ...rest } = menuItem;\n  const tableSelection = controller.query('hasTableSelection');\n  const isDisabled = tableSelection ||\n    isSelectionInTableCell(value, { excludeColumns: true }) ||\n    controller.query('isSelectionInLink') ||\n    controller.query('isSelectionInMention');\n\n  const onChange = (row: number, col: number): void => {\n    setSelectedCol(col);\n    setSelectedRow(row);\n  };\n\n  const insert = (row = DEFAULT_ROW, col = DEFAULT_COL) => {\n    controller.run('onAction', insertTable(row, col));\n  };\n\n  // NOTE: 通过回车插入，也会调用 onClick，we-design 此时没有传入 event 参数\n  const handleClickMenuItem = (_, e?: React.MouseEvent) => {\n    insert(selectedRow, selectedCol);\n    e?.stopPropagation();\n  };\n\n  const handleClickSubMenu = () => {\n    if (isDisabled) return;\n    controller.run('onAction', removeNewlineTriggerText(false));\n    controller.run('onAction', removeNewlineData());\n    insert();\n    dispatchCustomEvent(LEGAL_EVENT.quickInsertMenuVisible, { visible: false });\n  };\n\n  return (\n    <div onClick={handleClickSubMenu}>\n      <SubMenu\n        {...rest}\n        disabled={isDisabled}\n        title={title || ''}\n        overlayStyle={{ padding: 0 }}\n        overlayClassName=\"menu-table-overlay\"\n      >\n        <MenuItem\n          menuKey={menuKey || 'tablePicker'}\n          hoverable={false}\n          role={PluginRoles.tablePicker}\n          style={{\n            height: 'auto',\n            padding: 0,\n            margin: 0,\n          }}\n          onClick={handleClickMenuItem}\n        >\n          <TablePanel\n            row={10}\n            col={10}\n            selectedCol={selectedCol}\n            selectedRow={selectedRow}\n            onChange={onChange}\n          />\n        </MenuItem>\n      </SubMenu>\n    </div>\n  );\n}\n"],"file":"index.js"}