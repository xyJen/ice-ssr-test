{"version":3,"sources":["../../../../../src/bi/components/cornerButton/WholeSelectButton.tsx"],"names":["useRowIsSticky","useScrollableContainerRect","hooks","Icon","styled","div","Wrapper","CornerIcon","props","scale","size","TOOLBAR_ITEM_SIZE","active","isSelected","hoverSelection","onClick","onMouseEnter","onMouseLeave","isSticky","scrollRect","timer","React","useRef","isHover","setIsHover","useState","style","useMemo","hoverBgColor","THEME","blue1","toolbarBgColor","default","ret","backgroundColor","left","top","REALTABLE_PADDING","width","height","Math","ceil","borderTopLeftRadius","borderLeft","blue3","toolbarBorderColor","borderTop","boxShadow","zIndex","wrapperStyle","visibility","position","STICKY_ROW_TOP_HEIGHT","transform","STICKY_TOOLBAR_INDEX_MAP","cornerButton","Number","isFinite","handleMouseEnter","useCallback","e","current","setTimeout","handleMouseLeave","clearTimeout","useEffect","wrapperRef","preventDefault","stopPropagation"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AAMA;;uBAR4B,a;AAU5B,MAAM;AACJA,EAAAA,cADI;AAEJC,EAAAA;AAFI,IAGFC,KAHJ;;AAgBA,MAAMC,IAAI,gBAAGC,0BAAOC,GAAV,qBAAV;;AAIA,MAAMC,OAAO,gBAAGF,0BAAOC,GAAV,6FAAb;;AAQA,MAAME,UAAU,GACdC,KADiB,IAEd;AACH,QAAM;AACJC,IAAAA,KADI;AAEJC,IAAAA,IAAI,GAAGC,6BAFH;AAGJC,IAAAA,MAHI;AAIJC,IAAAA,UAJI;AAKJC,IAAAA,cALI;AAMJC,IAAAA,OANI;AAOJC,IAAAA,YAPI;AAQJC,IAAAA;AARI,MASFT,KATJ;AAWA,QAAM,CAACU,QAAD,IAAalB,cAAc,EAAjC;AACA,QAAM,CAACmB,UAAD,IAAelB,0BAA0B,EAA/C;AAEA,QAAMmB,KAAK,GAAGC,KAAK,CAACC,MAAN,CAAmD,IAAnD,CAAd;AAEA,QAAM,CAACC,OAAD,EAAUC,UAAV,IAAwBH,KAAK,CAACI,QAAN,CAAwB,KAAxB,CAA9B;AACA,QAAMC,KAA0B,GAAGL,KAAK,CAACM,OAAN,CAAc,MAAM;AACrD,UAAMC,YAAY,GAAGL,OAAO,GAAGM,iBAAMC,KAAT,GAAiBD,iBAAME,cAAN,CAAqBC,OAAlE;AACA,UAAMC,GAAwB,GAAG;AAC/BC,MAAAA,eAAe,EAAEtB,MAAM,GAAGiB,iBAAMC,KAAT,GAAiBF,YADT;AAE/BO,MAAAA,IAAI,EAAG,GAAE,EAAEzB,IAAI,GAAGD,KAAT,CAAgB,IAFM;AAG/B2B,MAAAA,GAAG,EAAG,GAAEC,8BAAkBD,GAAlB,GAAwB3B,KAAO,IAHR;AAI/B6B,MAAAA,KAAK,EAAG,GAAE5B,IAAI,GAAGD,KAAM,IAJQ;AAK/B8B,MAAAA,MAAM,EAAG,GAAEC,IAAI,CAACC,IAAL,CAAU/B,IAAI,GAAGD,KAAjB,CAAwB,IALJ;AAM/BiC,MAAAA,mBAAmB,EAAG,GAAE,IAAIjC,KAAM,IANH;AAO/BkC,MAAAA,UAAU,EAAE/B,MAAM,IAAIW,OAAV,GAAqB,aAAYM,iBAAMe,KAAM,EAA7C,GAAkD,aAAYf,iBAAMgB,kBAAmB,EAPpE;AAQ/BC,MAAAA,SAAS,EAAElC,MAAM,IAAIW,OAAV,GAAqB,aAAYM,iBAAMe,KAAM,EAA7C,GAAkD,aAAYf,iBAAMgB,kBAAmB,EARnE;AAS/BE,MAAAA,SAAS,EAAEnC,MAAM,IAAIE,cAAV,GAA4B,GAAEe,iBAAMe,KAAM,kBAA1C,GAA8D,kCAT1C;AAU/BI,MAAAA,MAAM,EAAElC,cAAc,GAAG,CAAH,GAAO,CAVE,CAUC;;AAVD,KAAjC;AAYA,WAAOmB,GAAP;AACD,GAfkC,EAehC,CAACV,OAAD,EAAUX,MAAV,EAAkBF,IAAlB,EAAwBD,KAAxB,CAfgC,CAAnC;AAiBA,QAAMwC,YAAiC,GAAG5B,KAAK,CAACM,OAAN,CAAc,MAAM;AAC5D,QAAI,CAACd,UAAL,EAAiB;AACf,aAAO;AACLqC,QAAAA,UAAU,EAAE;AADP,OAAP;AAGD;;AAED,UAAMjB,GAAwB,GAAG;AAC/BiB,MAAAA,UAAU,EAAE,SADmB;AAE/Bf,MAAAA,IAAI,EAAG,GAAE,EAAEzB,IAAI,GAAGD,KAAT,CAAgB,IAFM;AAG/B2B,MAAAA,GAAG,EAAG,GAAEC,8BAAkBD,GAAlB,GAAwB3B,KAAO;AAHR,KAAjC;;AAMA,QAAIS,QAAJ,EAAc;AACZe,MAAAA,GAAG,CAACkB,QAAJ,GAAe,OAAf;AACAlB,MAAAA,GAAG,CAACG,GAAJ,GAAW,GAAEjB,UAAU,CAACiB,GAAX,GAAiBgB,iCAAsB,IAApD;AACAnB,MAAAA,GAAG,CAACoB,SAAJ,GAAiB,cAAa3C,IAAK,QAAOA,IAAK,KAA/C;AACAuB,MAAAA,GAAG,CAACe,MAAJ,GAAaM,qCAAyBC,YAAtC;AACAtB,MAAAA,GAAG,CAACE,IAAJ,GAAWqB,MAAM,CAACC,QAAP,CAAgBtC,UAAU,CAACgB,IAA3B,IACPhB,UAAU,CAACgB,IADJ,GAEP,OAFJ;AAGD;;AAED,WAAOF,GAAP;AACD,GAxByC,EAwBvC,CAACpB,UAAD,EAAaK,QAAb,EAAuBT,KAAvB,EAA8BU,UAA9B,EAA0CT,IAA1C,CAxBuC,CAA1C;AA0BA,QAAMgD,gBAAgB,GAAGrC,KAAK,CAACsC,WAAN,CAAmBC,CAAD,IAAyB;AAClExC,IAAAA,KAAK,CAACyC,OAAN,GAAgBC,UAAU,CAAC,MAAM;AAC/B9C,MAAAA,YAAY,CAAC4C,CAAD,CAAZ;AACApC,MAAAA,UAAU,CAAC,IAAD,CAAV;AACD,KAHyB,EAGvB,GAHuB,CAA1B;AAID,GALwB,EAKtB,CAACR,YAAD,CALsB,CAAzB;AAOA,QAAM+C,gBAAgB,GAAG1C,KAAK,CAACsC,WAAN,CAAmBC,CAAD,IAAyB;AAClExC,IAAAA,KAAK,CAACyC,OAAN,IAAiBG,YAAY,CAAC5C,KAAK,CAACyC,OAAP,CAA7B;AACA5C,IAAAA,YAAY,CAAC2C,CAAD,CAAZ;AACApC,IAAAA,UAAU,CAAC,KAAD,CAAV;AACD,GAJwB,EAItB,CAACP,YAAD,CAJsB,CAAzB;AAMAI,EAAAA,KAAK,CAAC4C,SAAN,CAAgB,MAAM;AACpB7C,IAAAA,KAAK,CAACyC,OAAN,IAAiBG,YAAY,CAAC5C,KAAK,CAACyC,OAAP,CAA7B;AACD,GAFD,EAEG,EAFH;AAIA,QAAMK,UAAU,GAAG7C,KAAK,CAACC,MAAN,CAA6B,IAA7B,CAAnB;;AAEA,QAAM6C,cAAc,GAAIP,CAAD,IAAyB;AAC9CA,IAAAA,CAAC,CAACO,cAAF;AACAP,IAAAA,CAAC,CAACQ,eAAF;AACD,GAHD;;AAKA,sBACE,eAAC,OAAD;AACE,IAAA,GAAG,EAAEF,UADP;AAEE,mBAAahD,QAFf;AAGE,IAAA,KAAK,EAAE+B,YAHT;AAIE,mBAAY;AAJd,kBAME,eAAC,IAAD;AACE,IAAA,KAAK,EAAEvB,KADT;AAEE,IAAA,OAAO,EAAEX,OAFX;AAGE,IAAA,YAAY,EAAE2C,gBAHhB;AAIE,IAAA,YAAY,EAAEK,gBAJhB;AAKE,IAAA,WAAW,EAAEI;AALf,IANF,CADF;AAgBD,CAvGD;;eAyGe5D,U","sourcesContent":["import * as React from 'react';\nimport styled from 'styled-components';\nimport { THEME } from '../../constants';\nimport {\n  REALTABLE_PADDING,\n  TOOLBAR_ITEM_SIZE,\n  STICKY_ROW_TOP_HEIGHT,\n  STICKY_TOOLBAR_INDEX_MAP,\n} from '../../../utils/constants';\nimport * as hooks from '../../../utils/hooks';\n\nconst {\n  useRowIsSticky,\n  useScrollableContainerRect,\n} = hooks;\n\ninterface Props {\n  scale: number;\n  size?: number;\n  active: boolean;\n  isSelected: boolean;\n  onClick: (e: React.MouseEvent) => void;\n  onMouseEnter: (e: React.MouseEvent) => void;\n  onMouseLeave: (e: React.MouseEvent) => void;\n  hoverSelection: boolean;\n}\n\nconst Icon = styled.div`\n  cursor: default;\n`;\n\nconst Wrapper = styled.div`\n  position: absolute;\n  z-index: 2;\n  cursor: default;\n  box-shadow: rgb(214 214 214) 1px 0px 0px 0px;\n`;\n\n\nconst CornerIcon = (\n  props: Props,\n) => {\n  const {\n    scale,\n    size = TOOLBAR_ITEM_SIZE,\n    active,\n    isSelected,\n    hoverSelection,\n    onClick,\n    onMouseEnter,\n    onMouseLeave,\n  } = props;\n\n  const [isSticky] = useRowIsSticky();\n  const [scrollRect] = useScrollableContainerRect();\n\n  const timer = React.useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  const [isHover, setIsHover] = React.useState<boolean>(false);\n  const style: React.CSSProperties = React.useMemo(() => {\n    const hoverBgColor = isHover ? THEME.blue1 : THEME.toolbarBgColor.default;\n    const ret: React.CSSProperties = {\n      backgroundColor: active ? THEME.blue1 : hoverBgColor,\n      left: `${-(size / scale)}px`,\n      top: `${REALTABLE_PADDING.top / scale }px`,\n      width: `${size / scale}px`,\n      height: `${Math.ceil(size / scale)}px`,\n      borderTopLeftRadius: `${5 / scale}px`,\n      borderLeft: active || isHover ? `1px solid ${THEME.blue3}` : `1px solid ${THEME.toolbarBorderColor}`,\n      borderTop: active || isHover ? `1px solid ${THEME.blue3}` : `1px solid ${THEME.toolbarBorderColor}`,\n      boxShadow: active || hoverSelection ? `${THEME.blue3} 1px 0px 0px 0px` : 'rgb(214 214 214) 1px 0px 0px 0px',\n      zIndex: hoverSelection ? 2 : 5, // 选中工具栏的时候需要降低全选按钮的zindex，否则会导致工具栏高亮左边框缺失，未选中时需要提升，否则滚动时全选按钮右边框会缺失\n    };\n    return ret;\n  }, [isHover, active, size, scale]);\n\n  const wrapperStyle: React.CSSProperties = React.useMemo(() => {\n    if (!isSelected) {\n      return {\n        visibility: 'hidden',\n      };\n    }\n\n    const ret: React.CSSProperties = {\n      visibility: 'visible',\n      left: `${-(size / scale)}px`,\n      top: `${REALTABLE_PADDING.top / scale }px`,\n    };\n\n    if (isSticky) {\n      ret.position = 'fixed';\n      ret.top = `${scrollRect.top + STICKY_ROW_TOP_HEIGHT}px`;\n      ret.transform = `translate(-${size}px, -${size}px)`;\n      ret.zIndex = STICKY_TOOLBAR_INDEX_MAP.cornerButton;\n      ret.left = Number.isFinite(scrollRect.left)\n        ? scrollRect.left\n        : 'unset';\n    }\n\n    return ret;\n  }, [isSelected, isSticky, scale, scrollRect, size]);\n\n  const handleMouseEnter = React.useCallback((e: React.MouseEvent) => {\n    timer.current = setTimeout(() => {\n      onMouseEnter(e);\n      setIsHover(true);\n    }, 300);\n  }, [onMouseEnter]);\n\n  const handleMouseLeave = React.useCallback((e: React.MouseEvent) => {\n    timer.current && clearTimeout(timer.current);\n    onMouseLeave(e);\n    setIsHover(false);\n  }, [onMouseLeave]);\n\n  React.useEffect(() => {\n    timer.current && clearTimeout(timer.current);\n  }, []);\n\n  const wrapperRef = React.useRef<HTMLDivElement>(null);\n\n  const preventDefault = (e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  return (\n    <Wrapper\n      ref={wrapperRef}\n      data-sticky={isSticky}\n      style={wrapperStyle}\n      data-testid=\"table-whole-select-button\"\n    >\n      <Icon\n        style={style}\n        onClick={onClick}\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n        onMouseDown={preventDefault}\n      />\n    </Wrapper>\n  );\n};\n\nexport default CornerIcon;\n"],"file":"WholeSelectButton.js"}