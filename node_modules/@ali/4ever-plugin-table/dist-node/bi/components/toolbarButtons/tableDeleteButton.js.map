{"version":3,"sources":["../../../../../src/bi/components/toolbarButtons/tableDeleteButton.tsx"],"names":["TableDeleteButton","props","controller","locale","selection","node","value","document","getNode","key","tableRowCount","nodes","length","tableColCount","data","colsWidth","startRowIndex","startColIndex","endRowIndex","endColIndex","isSelectWholeRow","isSelectWholeCol","isSelectWholeTable","handleMouseDown","run","contextMenuDelete","PluginRoles","tableDelete","needRender"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Controller } from '@ali/4ever-cangjie';\nimport { IconButton } from '@ali/we-toolbar';\nimport { ToolbarTableDeleteNormal } from '@ali/we-design';\nimport { TableRole as PluginRoles } from '../../../utils/role';\nimport getTableSelection from '../../utils/getTableSelection';\nimport { deleteTable, deleteTableCols, deleteTableRows } from '../../actions';\nimport { isTable, TableLocale } from '../../types';\n\nexport interface TableDeleteButtonProps {\n  controller: Controller;\n  locale?: TableLocale;\n}\n\nexport default function TableDeleteButton(props: TableDeleteButtonProps) {\n  const { controller, locale } = props;\n  const selection = getTableSelection(controller);\n  if (!selection) return null;\n  const node = controller.value.document.getNode(selection?.key);\n  if (!(node && isTable(node))) return null;\n  const tableRowCount = node.nodes.length - 1;\n  const tableColCount = (node.data.colsWidth || []).length - 1;\n\n  const { startRowIndex, startColIndex, endRowIndex, endColIndex } = selection;\n\n  const isSelectWholeRow = startColIndex === 0 && endColIndex >= tableColCount;\n\n  const isSelectWholeCol = startRowIndex === 0 && endRowIndex >= tableRowCount;\n\n  const isSelectWholeTable = isSelectWholeCol && isSelectWholeRow;\n\n  if (!isSelectWholeRow && !isSelectWholeCol) {\n    return null;\n  }\n\n  const handleMouseDown = () => {\n    if (isSelectWholeTable) {\n      controller.run('onAction', deleteTable(node));\n    } else if (isSelectWholeRow) {\n      controller.run('onAction', deleteTableRows(node));\n    } else if (isSelectWholeCol) {\n      controller.run('onAction', deleteTableCols(node));\n    }\n  };\n\n  return (\n    <IconButton\n      icon={<ToolbarTableDeleteNormal />}\n      title={locale?.contextMenuDelete}\n      tooltip={locale?.contextMenuDelete}\n      testid=\"bi-toolbar-table-delete\"\n      onClick={handleMouseDown}\n      role={PluginRoles.tableDelete}\n    />\n  );\n}\n\nTableDeleteButton.needRender = function (controller: Controller) {\n  const selection = getTableSelection(controller);\n  if (!selection) return false;\n  const node = controller.value.document.getNode(selection.key);\n  if (!(node && isTable(node))) return false;\n  const tableRowCount = node.nodes.length - 1;\n  const tableColCount = (node.data.colsWidth || []).length - 1;\n\n  const { startRowIndex, startColIndex, endRowIndex, endColIndex } = selection;\n\n  const isSelectWholeRow = startColIndex === 0 && endColIndex >= tableColCount;\n\n  const isSelectWholeCol = startRowIndex === 0 && endRowIndex >= tableRowCount;\n\n  if (!isSelectWholeRow && !isSelectWholeCol) {\n    return false;\n  }\n  return true;\n};\n\n"],"file":"tableDeleteButton.js"}