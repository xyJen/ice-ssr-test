{"version":3,"sources":["../../../../../src/bi/components/tableSelection/index.tsx"],"names":["TableSelection","props","node","controller","selection","propSelection","isHighlight","tableRef","scale","getTableSelection","forceUpdate","colsWidth","setSelection","selectionData$","tempSelection","onHots","React","useCallback","hots","some","hot","key","hasNode","tableSelection","backgroundColor","THEME","red0","blue0","borderColor","red1","blue3"],"mappings":";;;;;;;;;;;AAAA;;AAIA;;AAEA;;AACA;;AAEA;;AACA;;uBAT4B,a;;AAsB5B,MAAMA,cAA6C,GAAIC,KAAD,IAAW;AAC/D,QAAM;AACJC,IAAAA,IADI;AAEJC,IAAAA,UAFI;AAGJC,IAAAA,SAAS,EAAEC,aAHP;AAIJC,IAAAA,WAJI;AAKJC,IAAAA,QALI;AAMJC,IAAAA,KAAK,GAAG,CANJ;AAOJC,IAAAA,iBAPI;AAQJC,IAAAA;AARI,MASFT,KATJ;AAaA,QAAM,CAACU,SAAD,IAAc,2CAApB;AAEA,QAAM,CAACP,SAAD,EAAYQ,YAAZ,IAA4B,qBAAiCP,aAAjC,CAAlC;AAEA,wBAAU,MAAM;AACdO,IAAAA,YAAY,CAACP,aAAD,CAAZ;AACD,GAFD,EAEG,CAACA,aAAD,CAFH;AAIA,qCAAiBF,UAAU,CAACU,cAA5B,EAA4C,IAA5C,EAAkD,MAAM;AACtD,UAAMC,aAAa,GAAGL,iBAAiB,EAAvC;;AACA,QAAI,CAAC,4BAAML,SAAN,EAAiBU,aAAjB,CAAL,EAAsC;AACpCF,MAAAA,YAAY,CAACE,aAAD,CAAZ;AACD;AACF,GALD,EAKG,EALH;;AAOA,QAAMC,MAAM,GAAGC,eAAMC,WAAN,CAAmBC,IAAD,IAAiB;AAChD;AACA,QACEA,IAAI,CAACC,IAAL,CACGC,GAAD,IAASlB,IAAI,CAACmB,GAAL,KAAaD,GAAG,CAAClB,IAAJ,CAASmB,GAAtB,IAA6BnB,IAAI,CAACoB,OAAL,CAAaF,GAAG,CAAClB,IAAJ,CAASmB,GAAtB,CADxC,CADF,EAIE;AACA,YAAME,cAAc,GAAGd,iBAAiB,EAAxC;AACAG,MAAAA,YAAY,CAACW,cAAD,CAAZ;AACD;AACF,GAVc,EAUZ,CAACrB,IAAD,EAAOO,iBAAP,CAVY,CAAf;;AAYA,qCAAiBN,UAAjB,EAA6BY,MAA7B;AAEA,sBACE,eAAC,sBAAD;AACE,IAAA,MAAM,EAAC,yBADT;AAEE,IAAA,KAAK,EAAEb,IAFT;AAGE,IAAA,QAAQ,EAAEK,QAHZ;AAIE,IAAA,cAAc,EAAEH,SAJlB;AAKE,IAAA,KAAK,EAAEI,KALT;AAME,IAAA,SAAS,EAAEG,SANb;AAOE,IAAA,KAAK,EAAE;AACLa,MAAAA,eAAe,EAAElB,WAAW,GAAGmB,iBAAMC,IAAT,GAAgBD,iBAAME,KAD7C;AAELC,MAAAA,WAAW,EAAEtB,WAAW,GAAGmB,iBAAMI,IAAT,GAAgBJ,iBAAMK;AAFzC,KAPT;AAWE,IAAA,WAAW,EAAEpB;AAXf,IADF;AAeD,CA1DD;;eA4DeV,c","sourcesContent":["import React, {\n  useEffect,\n  useState,\n} from 'react';\nimport equal from 'fast-deep-equal';\nimport Table from '../../../mo/models';\nimport { Controller, Hot, useSelectingHots, useSelectionData } from '@ali/4ever-cangjie';\nimport { THEME } from '../../constants';\nimport { ITableSelection } from '../../types';\nimport SelectionRect from './selectionRect';\nimport { usePixelColsWidth } from '../../../utils/hooks/usePixelColsWidth';\n\ninterface TableSelectionProps {\n  node: Table;\n  controller: Controller;\n  selection: ITableSelection | null;\n  tableRef: React.RefObject<HTMLTableElement>;\n  isHighlight?: boolean;\n  scale?: number;\n  getTableSelection: () => ITableSelection | null;\n  forceUpdate?: number;\n}\n\nconst TableSelection: React.FC<TableSelectionProps> = (props) => {\n  const {\n    node,\n    controller,\n    selection: propSelection,\n    isHighlight,\n    tableRef,\n    scale = 1,\n    getTableSelection,\n    forceUpdate,\n  } = props;\n\n  console.log('TableSelection Rerender');\n\n  const [colsWidth] = usePixelColsWidth();\n\n  const [selection, setSelection] = useState<ITableSelection | null>(propSelection);\n\n  useEffect(() => {\n    setSelection(propSelection);\n  }, [propSelection]);\n\n  useSelectionData(controller.selectionData$, null, () => {\n    const tempSelection = getTableSelection();\n    if (!equal(selection, tempSelection)) {\n      setSelection(tempSelection);\n    }\n  }, []);\n\n  const onHots = React.useCallback((hots: Hot[]) => {\n    // PERF: 非当前表格热区不处理\n    if (\n      hots.some(\n        (hot) => node.key === hot.node.key || node.hasNode(hot.node.key),\n      )\n    ) {\n      const tableSelection = getTableSelection();\n      setSelection(tableSelection);\n    }\n  }, [node, getTableSelection]);\n\n  useSelectingHots(controller, onHots);\n\n  return (\n    <SelectionRect\n      testid=\"table-selection-wrapper\"\n      table={node}\n      tableRef={tableRef}\n      tableSelection={selection}\n      scale={scale}\n      colsWidth={colsWidth}\n      style={{\n        backgroundColor: isHighlight ? THEME.red0 : THEME.blue0,\n        borderColor: isHighlight ? THEME.red1 : THEME.blue3,\n      }}\n      forceUpdate={forceUpdate}\n    />\n  );\n};\n\nexport default TableSelection;\n"],"file":"index.js"}