{"version":3,"sources":["../../../../src/bi/handlers/onArrowRight.ts"],"names":["onArrowRight","event","controller","next","value","selection","document","startText","tableSelection","query","preventDefault","table","getNode","key","node","endColIndex","startRowIndex","cell","getClosest","isTableCell","getStart","isAtEndOfNode","currentCell","nextCell","getNextSibling","currentRow","getParent","nextRow","nodes","data","hidden","s","moveToStartOfNode","command","Commands","select"],"mappings":";;;;;;;;;AAAA;;AAEA;;AACA;;AACA;;AACA;;AAEe,SAASA,YAAT,CAAsBC,KAAtB,EAA6BC,UAA7B,EAAqDC,IAArD,EAA2D;AACxE,QAAM;AAAEC,IAAAA;AAAF,MAAYF,UAAlB;AACA,QAAM;AAAEG,IAAAA,SAAF;AAAaC,IAAAA,QAAb;AAAuBC,IAAAA;AAAvB,MAAqCH,KAA3C;AAEA,QAAMI,cAAc,GAAGN,UAAU,CAACO,KAAX,CAAiB,gBAAjB,CAAvB;;AACA,MAAID,cAAJ,EAAoB;AAClBP,IAAAA,KAAK,CAACS,cAAN;AACA,UAAMC,KAAK,GAAGL,QAAQ,CAACM,OAAT,CAAiBJ,cAAc,CAACK,GAAhC,CAAd;;AACA,QAAI,CAACF,KAAL,EAAY;AACV;AACD;;AACD,QAAIT,UAAU,CAACO,KAAX,CAAiB,oBAAjB,EAAuC;AAAEK,MAAAA,IAAI,EAAEH;AAAR,KAAvC,CAAJ,EAA6D;AAC3D,aAAO,iDAAyBT,UAAzB,EAAqCS,KAArC,CAAP;AACD;;AACD,UAAM;AAAEI,MAAAA,WAAF;AAAeC,MAAAA;AAAf,QAAiCR,cAAvC;AACA,WAAO,0CAAkBN,UAAlB,EAA8BS,KAA9B,EAAqCK,aAArC,EAAoDD,WAAW,GAAG,CAAlE,CAAP;AACD;;AAED,MAAI,CAAC,qCAAuBX,KAAvB,CAAL,EAAoC,OAAOD,IAAI,EAAX;AAEpC,QAAMc,IAAI,GAAGX,QAAQ,CAACY,UAAT,CAAoBX,SAAS,EAAEM,GAA/B,EAAqCM,kBAArC,CAAb,CApBwE,CAoBT;;AAC/D,MAAI,CAACF,IAAL,EAAW,OAAOd,IAAI,EAAX;AAEX,MAAI,CAACE,SAAS,CAACe,QAAV,CAAmBd,QAAnB,EAA6Be,aAA7B,CAA2CJ,IAA3C,CAAL,EAAuD,OAAOd,IAAI,EAAX;AAEvD,MAAImB,WAAW,GAAGL,IAAlB;;AACA,KAAG;AACD,QAAIM,QAAQ,GAAGjB,QAAQ,CAACkB,cAAT,CAAwBF,WAAW,CAACT,GAApC,CAAf;;AACA,QAAI,CAACU,QAAL,EAAe;AACb,YAAME,UAAU,GAAGnB,QAAQ,CAACoB,SAAT,CAAmBJ,WAAW,CAACT,GAA/B,CAAnB;AACA,YAAMc,OAAO,GAAGrB,QAAQ,CAACkB,cAAT,CAAwBC,UAAU,CAACZ,GAAnC,CAAhB;AACA,UAAI,CAACc,OAAL,EAAc,OAAOxB,IAAI,EAAX;AACdoB,MAAAA,QAAQ,GAAGI,OAAO,CAACC,KAAR,CAAc,CAAd,CAAX;AACD,KAPA,CAQD;;;AACAN,IAAAA,WAAW,GAAGC,QAAd;AACD,GAVD,QAUSD,WAAW,CAACO,IAAZ,CAAiBC,MAAjB,IAA2B,KAVpC,EA1BwE,CAsCxE;;;AACA7B,EAAAA,KAAK,CAACS,cAAN;AAEA,QAAMqB,CAAC,GAAG1B,SAAS,CAAC2B,iBAAV,CAA4BV,WAA5B,EAAyCpB,UAAzC,CAAV;AACA,SAAOA,UAAU,CAAC+B,OAAX,CAAmBC,sBAASC,MAA5B,EAAoC,kCAAoBJ,CAApB,EAAuB,KAAvB,CAApC,CAAP;AACD","sourcesContent":["import { Commands, Controller, Block } from '@ali/4ever-cangjie';\nimport Table from '../../mo/models';\nimport { isTableCell } from '../types';\nimport isSelectionInTableCell from '../utils/isSelectionInTableCell';\nimport { moveToStartOfCell, moveToStartOfNextSibling } from '../utils/selectionCommands';\nimport setSelectionByTable from '../../utils/utils/setSelectionByTable';\n\nexport default function onArrowRight(event, controller: Controller, next) {\n  const { value } = controller;\n  const { selection, document, startText } = value;\n\n  const tableSelection = controller.query('tableSelection');\n  if (tableSelection) {\n    event.preventDefault();\n    const table = document.getNode(tableSelection.key) as Table | null;\n    if (!table) {\n      return;\n    }\n    if (controller.query('isSelectWholeTable', { node: table })) {\n      return moveToStartOfNextSibling(controller, table);\n    }\n    const { endColIndex, startRowIndex } = tableSelection;\n    return moveToStartOfCell(controller, table, startRowIndex, endColIndex + 1);\n  }\n\n  if (!isSelectionInTableCell(value)) return next();\n\n  const cell = document.getClosest(startText?.key!, isTableCell);// document.getClosest 有可能返回空\n  if (!cell) return next();\n\n  if (!selection.getStart(document).isAtEndOfNode(cell)) return next();\n\n  let currentCell = cell;\n  do {\n    let nextCell = document.getNextSibling(currentCell.key);\n    if (!nextCell) {\n      const currentRow = document.getParent(currentCell.key)!;\n      const nextRow = document.getNextSibling(currentRow.key) as Block;\n      if (!nextRow) return next();\n      nextCell = nextRow.nodes[0];\n    }\n    // @ts-ignore\n    currentCell = nextCell;\n  } while (currentCell.data.hidden || false);\n\n  // 阻止 Cangjie 默认事件\n  event.preventDefault();\n\n  const s = selection.moveToStartOfNode(currentCell, controller);\n  return controller.command(Commands.select, setSelectionByTable(s, false));\n}\n"],"file":"onArrowRight.js"}