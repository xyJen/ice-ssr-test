{"version":3,"sources":["../../../../src/bi/handlers/onArrowLeft.ts"],"names":["onArrowLeft","event","controller","next","value","selection","document","startText","tableSelection","query","preventDefault","table","getNode","key","startColIndex","startRowIndex","isExpanded","getStart","isAtStartOfNode","prevText","getPreviousText","cell","getClosest","isTableCell","data","hidden","currentCell","prevCell","getPreviousSibling","currentRow","getParent","prevRow","nodes","length","s","moveToEndOfNode","command","Commands","select"],"mappings":";;;;;;;;;AAAA;;AAEA;;AACA;;AACA;;AAEe,SAASA,WAAT,CAAqBC,KAArB,EAA4BC,UAA5B,EAAoDC,IAApD,EAA0D;AACvE,QAAM;AAAEC,IAAAA;AAAF,MAAYF,UAAlB;AACA,QAAM;AAAEG,IAAAA,SAAF;AAAaC,IAAAA,QAAb;AAAuBC,IAAAA;AAAvB,MAAqCH,KAA3C;AAEA,QAAMI,cAAc,GAAGN,UAAU,CAACO,KAAX,CAAiB,gBAAjB,CAAvB;;AACA,MAAID,cAAJ,EAAoB;AAClBP,IAAAA,KAAK,CAACS,cAAN;AACA,UAAMC,KAAK,GAAGL,QAAQ,CAACM,OAAT,CAAiBJ,cAAc,CAACK,GAAhC,CAAd;;AACA,QAAI,CAACF,KAAL,EAAY;AACV;AACD;;AACD,UAAM;AAAEG,MAAAA,aAAF;AAAiBC,MAAAA;AAAjB,QAAmCP,cAAzC;AACA,WAAO,0CAAkBN,UAAlB,EAA8BS,KAA9B,EAAqCI,aAArC,EAAoDD,aAApD,CAAP;AACD;;AAED,MAAIT,SAAS,CAACW,UAAV,IAAwB,CAACX,SAAS,CAACY,QAAV,CAAmBX,QAAnB,EAA6BY,eAA7B,CAA6CX,SAA7C,CAA7B,EAAuF,OAAOJ,IAAI,EAAX;AAEvF,QAAMgB,QAAQ,GAAGb,QAAQ,CAACc,eAAT,CAAyBb,SAAS,CAAEM,GAApC,CAAjB;AACA,MAAI,CAACM,QAAL,EAAe,OAAOhB,IAAI,EAAX;AAEf,QAAMkB,IAAI,GAAGf,QAAQ,CAACgB,UAAT,CAAoBH,QAAQ,CAACN,GAA7B,EAAkCU,kBAAlC,CAAb;AACA,MAAI,CAACF,IAAD,IAAS,CAACA,IAAI,CAACG,IAAL,CAAUC,MAAxB,EAAgC,OAAOtB,IAAI,EAAX;AAEhC,MAAIuB,WAAW,GAAGL,IAAlB;;AACA,KAAG;AACD,QAAIM,QAAQ,GAAGrB,QAAQ,CAACsB,kBAAT,CAA4BF,WAAW,CAACb,GAAxC,CAAf;;AACA,QAAI,CAACc,QAAL,EAAe;AACb,YAAME,UAAU,GAAGvB,QAAQ,CAACwB,SAAT,CAAmBJ,WAAW,CAACb,GAA/B,CAAnB;AACA,YAAMkB,OAAO,GAAGzB,QAAQ,CAACsB,kBAAT,CAA4BC,UAAU,CAAEhB,GAAxC,CAAhB;AACA,UAAI,CAACkB,OAAL,EAAc,OAAO5B,IAAI,EAAX,CAHD,CAIb;;AACAwB,MAAAA,QAAQ,GAAGI,OAAO,CAACC,KAAR,CAAcD,OAAO,CAACC,KAAR,CAAcC,MAAd,GAAuB,CAArC,CAAX;AACD,KARA,CASD;;;AACAP,IAAAA,WAAW,GAAGC,QAAd;AACD,GAXD,QAWSD,WAAW,CAACF,IAAZ,CAAiBC,MAAjB,IAA2B,KAXpC;;AAaA,QAAMS,CAAC,GAAG7B,SAAS,CAAC8B,eAAV,CAA0BT,WAA1B,EAAuCxB,UAAvC,CAAV;AACA,SAAOA,UAAU,CAACkC,OAAX,CAAmBC,sBAASC,MAA5B,EAAoC,kCAAoBJ,CAApB,EAAuB,KAAvB,CAApC,CAAP;AACD","sourcesContent":["import { Commands, Controller } from '@ali/4ever-cangjie';\nimport Table from '../../mo/models';\nimport { isTableCell } from '../types';\nimport { moveToStartOfCell } from '../utils/selectionCommands';\nimport setSelectionByTable from '../../utils/utils/setSelectionByTable';\n\nexport default function onArrowLeft(event, controller: Controller, next) {\n  const { value } = controller;\n  const { selection, document, startText } = value;\n\n  const tableSelection = controller.query('tableSelection');\n  if (tableSelection) {\n    event.preventDefault();\n    const table = document.getNode(tableSelection.key) as Table | null;\n    if (!table) {\n      return;\n    }\n    const { startColIndex, startRowIndex } = tableSelection;\n    return moveToStartOfCell(controller, table, startRowIndex, startColIndex);\n  }\n\n  if (selection.isExpanded || !selection.getStart(document).isAtStartOfNode(startText!)) return next();\n\n  const prevText = document.getPreviousText(startText!.key);\n  if (!prevText) return next();\n\n  const cell = document.getClosest(prevText.key, isTableCell);\n  if (!cell || !cell.data.hidden) return next();\n\n  let currentCell = cell;\n  do {\n    let prevCell = document.getPreviousSibling(currentCell.key);\n    if (!prevCell) {\n      const currentRow = document.getParent(currentCell.key);\n      const prevRow = document.getPreviousSibling(currentRow!.key);\n      if (!prevRow) return next();\n      // @ts-ignore\n      prevCell = prevRow.nodes[prevRow.nodes.length - 1];\n    }\n    // @ts-ignore\n    currentCell = prevCell;\n  } while (currentCell.data.hidden || false);\n\n  const s = selection.moveToEndOfNode(currentCell, controller);\n  return controller.command(Commands.select, setSelectionByTable(s, false));\n}\n"],"file":"onArrowLeft.js"}