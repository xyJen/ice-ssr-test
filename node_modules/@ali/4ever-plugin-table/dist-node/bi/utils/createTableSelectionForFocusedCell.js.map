{"version":3,"sources":["../../../../src/bi/utils/createTableSelectionForFocusedCell.ts"],"names":["createTableSelectionForFocusedCell","value","table","data","edgeSelection","selection","document","startPoint","getStart","endPoint","getEnd","startKey","key","endKey","startPath","getPath","endPath","selectionPath","Path","common","length","tablePath","isSelectionInTableCell","isAncestor","startRowIndex","startColIndex","slice","nodes","cell","rowSpan","colSpan","endRowIndex","endColIndex"],"mappings":";;;;;;;AAAA;;AAIe,SAASA,kCAAT,CACbC,KADa,EAEbC,KAFa,EAGW;AACxB,MAAID,KAAK,CAACE,IAAN,CAAWC,aAAf,EAA8B;AAC5B,WAAO,IAAP;AACD;;AAED,MAAI,CAACF,KAAL,EAAY;AACV,WAAO,IAAP;AACD;;AAED,QAAM;AAAEG,IAAAA,SAAF;AAAaC,IAAAA;AAAb,MAA0BL,KAAhC;;AAEA,MAAI,CAACI,SAAL,EAAgB;AACd,WAAO,IAAP;AACD;;AAED,QAAME,UAAU,GAAGF,SAAS,CAACG,QAAV,CAAmBF,QAAnB,CAAnB;AACA,QAAMG,QAAQ,GAAGJ,SAAS,CAACK,MAAV,CAAiBJ,QAAjB,CAAjB;AAEA,QAAMK,QAAQ,GAAGJ,UAAU,EAAEK,GAA7B;AACA,QAAMC,MAAM,GAAGJ,QAAQ,EAAEG,GAAzB;;AAGA,MAAI,CAACD,QAAD,IAAa,CAACE,MAAlB,EAA0B;AACxB,WAAO,IAAP;AACD;;AAED,QAAMC,SAAS,GAAGR,QAAQ,CAACS,OAAT,CAAiBJ,QAAjB,CAAlB;AACA,QAAMK,OAAO,GAAGV,QAAQ,CAACS,OAAT,CAAiBF,MAAjB,CAAhB;;AACA,MAAI,CAACC,SAAD,IAAc,CAACE,OAAnB,EAA4B;AAC1B,WAAO,IAAP;AACD;;AAED,QAAMC,aAAa,GAAGC,kBAAKC,MAAL,CAAYL,SAAZ,EAAuBE,OAAvB,CAAtB;;AACA,MAAI,CAACC,aAAa,CAACG,MAAnB,EAA2B;AACzB,WAAO,IAAP;AACD;;AAED,QAAMC,SAAS,GAAGf,QAAQ,CAACS,OAAT,CAAiBb,KAAK,CAACU,GAAvB,CAAlB;;AACA,MAAI,CAACS,SAAL,EAAgB;AACd,WAAO,IAAP;AACD;;AAED,QAAMC,sBAAsB,GAAGJ,kBAAKK,UAAL,CAAgBF,SAAhB,EAA2BJ,aAA3B,KAC1BA,aAAa,CAACG,MAAd,GAAuBC,SAAS,CAACD,MAAjC,IAA2C,CADhD;;AAEA,MAAI,CAACE,sBAAL,EAA6B;AAC3B,WAAO,IAAP;AACD;;AAED,QAAM,CAACE,aAAD,EAAgBC,aAAhB,IAAiCR,aAAa,CACjDS,KADoC,CAC9BL,SAAS,CAACD,MADoB,EACZC,SAAS,CAACD,MAAV,GAAmB,CADP,CAAvC,CAhDwB,CAoDxB;;AACA,MAAII,aAAa,IAAItB,KAAK,CAACyB,KAAN,CAAYP,MAAjC,EAAyC;AACvC,WAAO,IAAP;AACD;;AACD,QAAMQ,IAAI,GAAG1B,KAAK,CAACyB,KAAN,CAAYH,aAAZ,EAA2BG,KAA3B,CAAiCF,aAAjC,CAAb,CAxDwB,CA0DxB;;AACA,MAAI,CAACG,IAAL,EAAW;AACT,WAAO,IAAP;AACD;;AACD,QAAMC,OAAO,GAAID,IAAI,CAACzB,IAAL,IAAayB,IAAI,CAACzB,IAAL,CAAU0B,OAAxB,IAAoC,CAApD;AACA,QAAMC,OAAO,GAAIF,IAAI,CAACzB,IAAL,IAAayB,IAAI,CAACzB,IAAL,CAAU2B,OAAxB,IAAoC,CAApD;AACA,QAAMC,WAAW,GAAGP,aAAa,GAAGK,OAAhB,GAA0B,CAA9C;AACA,QAAMG,WAAW,GAAGP,aAAa,GAAGK,OAAhB,GAA0B,CAA9C;AAEA,SAAO;AACLlB,IAAAA,GAAG,EAAEV,KAAK,CAACU,GADN;AAELY,IAAAA,aAFK;AAGLO,IAAAA,WAHK;AAILN,IAAAA,aAJK;AAKLO,IAAAA;AALK,GAAP;AAOD","sourcesContent":["import { Path, Value } from '@ali/4ever-cangjie';\nimport Table from '../../mo/models';\nimport { ITableSelection } from '../types';\n\nexport default function createTableSelectionForFocusedCell(\n  value: Value,\n  table: Table,\n): ITableSelection | null {\n  if (value.data.edgeSelection) {\n    return null;\n  }\n\n  if (!table) {\n    return null;\n  }\n\n  const { selection, document } = value;\n\n  if (!selection) {\n    return null;\n  }\n\n  const startPoint = selection.getStart(document);\n  const endPoint = selection.getEnd(document);\n\n  const startKey = startPoint?.key;\n  const endKey = endPoint?.key;\n\n\n  if (!startKey || !endKey) {\n    return null;\n  }\n\n  const startPath = document.getPath(startKey);\n  const endPath = document.getPath(endKey);\n  if (!startPath || !endPath) {\n    return null;\n  }\n\n  const selectionPath = Path.common(startPath, endPath);\n  if (!selectionPath.length) {\n    return null;\n  }\n\n  const tablePath = document.getPath(table.key);\n  if (!tablePath) {\n    return null;\n  }\n\n  const isSelectionInTableCell = Path.isAncestor(tablePath, selectionPath)\n    && selectionPath.length - tablePath.length >= 2;\n  if (!isSelectionInTableCell) {\n    return null;\n  }\n\n  const [startRowIndex, startColIndex] = selectionPath\n    .slice(tablePath.length, tablePath.length + 2);\n\n\n  // 表格分裂时，startRowIndex 可能大于 renderTable 行数\n  if (startRowIndex >= table.nodes.length) {\n    return null;\n  }\n  const cell = table.nodes[startRowIndex].nodes[startColIndex];\n\n  // 快捷插入列时，cell 会不存在\n  if (!cell) {\n    return null;\n  }\n  const rowSpan = (cell.data && cell.data.rowSpan) || 1;\n  const colSpan = (cell.data && cell.data.colSpan) || 1;\n  const endRowIndex = startRowIndex + rowSpan - 1;\n  const endColIndex = startColIndex + colSpan - 1;\n\n  return {\n    key: table.key,\n    startRowIndex,\n    endRowIndex,\n    startColIndex,\n    endColIndex,\n  };\n}\n"],"file":"createTableSelectionForFocusedCell.js"}