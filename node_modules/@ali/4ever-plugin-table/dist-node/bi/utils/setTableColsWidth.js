"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = setTableColsWidth;

var _everCangjie = require("@ali/4ever-cangjie");

var _isNumber = _interopRequireDefault(require("./isNumber"));

var _constants = require("../../utils/constants");

var _filterValidData = _interopRequireDefault(require("../../utils/utils/filterValidData"));

function isValidColsWidth(colsWidth) {
  return Array.isArray(colsWidth) && colsWidth.every(_isNumber.default);
}

function setTableColsWidth(controller, table, colsWidth) {
  const currentColsWidth = table.data.colsWidth;
  let validColsWidth = [];

  if (!Array.isArray(colsWidth)) {
    if (isValidColsWidth(currentColsWidth)) {
      return controller;
    }

    validColsWidth = Array(table.nodes.length).fill(_constants.MIN_COL_WIDTH);
  } else {
    validColsWidth = colsWidth.map((cw, index) => {
      if ((0, _isNumber.default)(cw)) {
        return cw;
      }

      if (Array.isArray(currentColsWidth)) {
        const currentCw = currentColsWidth[index];

        if ((0, _isNumber.default)(currentCw)) {
          return currentCw;
        }
      }

      return _constants.MIN_COL_WIDTH;
    });
  }

  return controller.command(_everCangjie.Commands.setNodeByKey, table.key, {
    data: (0, _filterValidData.default)({ ...table.data,
      colsWidth: validColsWidth
    })
  });
}
//# sourceMappingURL=setTableColsWidth.js.map