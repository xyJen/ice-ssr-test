"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = setCellsData;
exports.DEFAULT_CELL_DATA = void 0;

var _everCangjie = require("@ali/4ever-cangjie");

var _everUtils = require("@ali/4ever-utils");

var _constants = require("../constants");

var CellDataKey;

(function (CellDataKey) {
  CellDataKey["fill"] = "fill";
  CellDataKey["vAlign"] = "vAlign";
})(CellDataKey || (CellDataKey = {}));

const DEFAULT_CELL_DATA = {
  [CellDataKey.fill]: '',
  [CellDataKey.vAlign]: _constants.DEFAULT_TABLE_ALIGNMENT
};
exports.DEFAULT_CELL_DATA = DEFAULT_CELL_DATA;

function setCellsData(controller, table, selection, key, data) {
  const {
    value
  } = controller;
  const {
    document
  } = value;

  if (!selection) {
    return controller;
  }

  const {
    startRowIndex,
    startColIndex,
    endRowIndex,
    endColIndex
  } = selection;
  const tablePath = document.getPath(table.key);

  for (let r = startRowIndex; r <= endRowIndex; r += 1) {
    for (let c = startColIndex; c <= endColIndex; c += 1) {
      const cellPath = [...tablePath, r, c];
      const cell = document.getNodeByPath(cellPath);

      if (cell) {
        const oldData = cell.data[key] ? {
          [key]: cell.data[key]
        } : {};
        const newData = data ? {
          [key]: data
        } : {};

        if (!(0, _everUtils.isEqualWithDefault)(oldData, newData, DEFAULT_CELL_DATA)) {
          controller.command(_everCangjie.Commands.setNodeByPath, cellPath, {
            data: { ...cell.data,
              [key]: data
            }
          });
        }
      }
    }
  }

  return controller;
}
//# sourceMappingURL=setCellsData.js.map