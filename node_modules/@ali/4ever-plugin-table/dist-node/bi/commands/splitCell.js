"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = splitCell;

var _everCangjie = require("@ali/4ever-cangjie");

var _createTableSelectionForFocusedCell = _interopRequireDefault(require("../utils/createTableSelectionForFocusedCell"));

var _getDataTableSelectionByTable = _interopRequireDefault(require("../utils/getDataTableSelectionByTable"));

function splitCell(controller, table, area) {
  const {
    value
  } = controller;
  const {
    document
  } = value;

  if (!table) {
    return controller;
  }

  let tableSelection;

  if (area) {
    tableSelection = area;
  } else {
    const queryTableSelection = (0, _getDataTableSelectionByTable.default)(controller, table);
    tableSelection = queryTableSelection || (0, _createTableSelectionForFocusedCell.default)(value, table);
  }

  if (!tableSelection) {
    return controller;
  }

  const {
    startRowIndex,
    startColIndex,
    endRowIndex,
    endColIndex
  } = tableSelection;
  const tablePath = document.getPath(table.key);

  for (let r = startRowIndex; r <= endRowIndex; r += 1) {
    for (let c = startColIndex; c <= endColIndex; c += 1) {
      const cellPath = [...tablePath, r, c];
      const cell = document.getNodeByPath(cellPath);

      if (cell) {
        controller.command(_everCangjie.Commands.setNodeByPath, cellPath, {
          data: { ...cell.data,
            rowSpan: 1,
            colSpan: 1,
            hidden: false
          }
        });
      }
    }
  }

  return controller;
}
//# sourceMappingURL=splitCell.js.map