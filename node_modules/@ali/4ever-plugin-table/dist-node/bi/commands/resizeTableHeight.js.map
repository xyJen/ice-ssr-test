{"version":3,"sources":["../../../../src/bi/commands/resizeTableHeight.ts"],"names":["resizeTableHeight","controller","table","rowsHeight","delta","originalRowsHeight","reduce","acc","curr","expectTotalRowsHeight","limitHeights","Array","length","fill","MIN_ROW_HEIGHT","outputRowsHeight","nodes","forEach","row","i","command","Commands","setNodeByKey","key","data","h"],"mappings":";;;;;;;;;AAAA;;AAEA;;AACA;;AAEA;AACA;AACA;AACe,SAASA,iBAAT,CACbC,UADa,EAEbC,KAFa,EAGbC,UAHa,EAIbC,KAJa,EAKb;AACA,MAAIA,KAAK,KAAK,CAAd,EAAiB;AACf,WAAOH,UAAP;AACD;;AACD,QAAMI,kBAAkB,GAAGF,UAAU,CAACG,MAAX,CAAkB,CAACC,GAAD,EAAMC,IAAN,KAAgBD,GAAG,GAAGC,IAAxC,EAA+C,CAA/C,CAA3B;AACA,QAAMC,qBAAqB,GAAGJ,kBAAkB,GAAGD,KAAnD;AACA,QAAMM,YAAY,GAAGC,KAAK,CAACR,UAAU,CAACS,MAAZ,CAAL,CAAyBC,IAAzB,CAA8BC,yBAA9B,CAArB;AACA,QAAMC,gBAAgB,GAAG,0BAAYZ,UAAZ,EAAwBM,qBAAxB,EAA+CC,YAA/C,CAAzB;AAEAR,EAAAA,KAAK,CAACc,KAAN,CAAYC,OAAZ,CAAoB,CAACC,GAAD,EAAMC,CAAN,KAAY;AAC9BlB,IAAAA,UAAU,CAACmB,OAAX,CAAmBC,sBAASC,YAA5B,EAA0CJ,GAAG,CAACK,GAA9C,EAAmD;AACjDC,MAAAA,IAAI,EAAE,EACJ,IAAIN,GAAG,CAACM,IAAJ,IAAY,EAAhB,CADI;AAEJC,QAAAA,CAAC,EAAEV,gBAAgB,CAACI,CAAD;AAFf;AAD2C,KAAnD;AAMD,GAPD;AAQA,SAAOlB,UAAP;AACD","sourcesContent":["import { Controller, Commands } from '@ali/4ever-cangjie';\nimport Table from '../../mo/models';\nimport { MIN_ROW_HEIGHT } from '../constants';\nimport resizeTable from '../utils/resizeTable';\n\n// rowsHeight 为 UI 上测得的高度\n// 这里有个毛病——如果有行的高度是被内容撑高的，resize 结果很可能不符合用户预期\n// 有合并单元格时这个问题基本无解。zoho 与 word 桌面版都有这个问题，google 不能 resize。\nexport default function resizeTableHeight(\n  controller: Controller,\n  table: Table,\n  rowsHeight: number[],\n  delta: number,\n) {\n  if (delta === 0) {\n    return controller;\n  }\n  const originalRowsHeight = rowsHeight.reduce((acc, curr) => (acc + curr), 0);\n  const expectTotalRowsHeight = originalRowsHeight + delta;\n  const limitHeights = Array(rowsHeight.length).fill(MIN_ROW_HEIGHT);\n  const outputRowsHeight = resizeTable(rowsHeight, expectTotalRowsHeight, limitHeights);\n\n  table.nodes.forEach((row, i) => {\n    controller.command(Commands.setNodeByKey, row.key, {\n      data: {\n        ...(row.data || {}),\n        h: outputRowsHeight[i],\n      },\n    });\n  });\n  return controller;\n}\n"],"file":"resizeTableHeight.js"}