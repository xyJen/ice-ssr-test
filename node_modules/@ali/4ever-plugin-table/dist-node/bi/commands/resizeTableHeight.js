"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = resizeTableHeight;

var _everCangjie = require("@ali/4ever-cangjie");

var _constants = require("../constants");

var _resizeTable = _interopRequireDefault(require("../utils/resizeTable"));

// rowsHeight 为 UI 上测得的高度
// 这里有个毛病——如果有行的高度是被内容撑高的，resize 结果很可能不符合用户预期
// 有合并单元格时这个问题基本无解。zoho 与 word 桌面版都有这个问题，google 不能 resize。
function resizeTableHeight(controller, table, rowsHeight, delta) {
  if (delta === 0) {
    return controller;
  }

  const originalRowsHeight = rowsHeight.reduce((acc, curr) => acc + curr, 0);
  const expectTotalRowsHeight = originalRowsHeight + delta;
  const limitHeights = Array(rowsHeight.length).fill(_constants.MIN_ROW_HEIGHT);
  const outputRowsHeight = (0, _resizeTable.default)(rowsHeight, expectTotalRowsHeight, limitHeights);
  table.nodes.forEach((row, i) => {
    controller.command(_everCangjie.Commands.setNodeByKey, row.key, {
      data: { ...(row.data || {}),
        h: outputRowsHeight[i]
      }
    });
  });
  return controller;
}
//# sourceMappingURL=resizeTableHeight.js.map