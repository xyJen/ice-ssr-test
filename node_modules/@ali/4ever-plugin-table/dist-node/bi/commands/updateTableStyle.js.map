{"version":3,"sources":["../../../../src/bi/commands/updateTableStyle.ts"],"names":["DEFAULT_TBLLOOK","firstRow","firstColumn","lastRow","lastColumn","updateStyleId","controller","table","newTable","value","document","getNode","key","tableData","data","styleId","shouldRemoveStyleId","Table","isRowHeader","isColumnHeader","command","Commands","setNodeByKey","TABLE_HEADER_STYLE_ID","updateTblLook","newTblLook","tblLook","updateTableStyle"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AAEA,MAAMA,eAAyC,GAAG;AAChDC,EAAAA,QAAQ,EAAE,CADsC;AAEhDC,EAAAA,WAAW,EAAE,CAFmC;AAGhDC,EAAAA,OAAO,EAAE,CAHuC;AAIhDC,EAAAA,UAAU,EAAE;AAJoC,CAAlD;;AAOA,SAASC,aAAT,CAAuBC,UAAvB,EAA+CC,KAA/C,EAA6D;AAC3D,QAAMC,QAAQ,GAAGF,UAAU,CAACG,KAAX,CAAiBC,QAAjB,CAA0BC,OAA1B,CAAkCJ,KAAK,CAACK,GAAxC,CAAjB;AAEA,MAAI,CAACJ,QAAL,EAAe,OAAOF,UAAP;AAEf,QAAMO,SAAS,GAAG,EAAE,IAAIL,QAAQ,CAACM,IAAT,IAAiB,EAArB;AAAF,GAAlB;AACA,QAAM;AAAEC,IAAAA;AAAF,MAAcF,SAApB;AACA,QAAMG,mBAAmB,GAAG,CAACC,gBAAMC,WAAN,CAAkBV,QAAlB,CAAD,IAAgC,CAACS,gBAAME,cAAN,CAAqBX,QAArB,CAA7D;;AAEA,MAAIQ,mBAAmB,IAAID,OAA3B,EAAoC;AAClC,WAAOF,SAAS,CAACE,OAAjB;AACA,WAAOT,UAAU,CAACc,OAAX,CAAmBC,sBAASC,YAA5B,EAA0Cd,QAAQ,CAACI,GAAnD,EAAwD;AAC7DE,MAAAA,IAAI,EAAED;AADuD,KAAxD,CAAP;AAGD;;AAED,MAAI,CAACG,mBAAD,IAAwB,CAACD,OAA7B,EAAsC;AACpCF,IAAAA,SAAS,CAACE,OAAV,GAAoBQ,gCAApB;AACA,WAAOjB,UAAU,CAACc,OAAX,CAAmBC,sBAASC,YAA5B,EAA0Cd,QAAQ,CAACI,GAAnD,EAAwD;AAC7DE,MAAAA,IAAI,EAAED;AADuD,KAAxD,CAAP;AAGD;;AAED,SAAOP,UAAP;AACD;;AAED,SAASkB,aAAT,CAAuBlB,UAAvB,EAA+CC,KAA/C,EAA6D;AAC3D,QAAMC,QAAQ,GAAGF,UAAU,CAACG,KAAX,CAAiBC,QAAjB,CAA0BC,OAA1B,CAAkCJ,KAAK,CAACK,GAAxC,CAAjB;AAEA,MAAI,CAACJ,QAAL,EAAe,OAAOF,UAAP;AAEf,QAAMO,SAAS,GAAG,EAAE,IAAIL,QAAQ,CAACM,IAAT,IAAiB,EAArB;AAAF,GAAlB;AACA,QAAMW,UAAU,GAAG,EAAE,GAAGzB;AAAL,GAAnB;;AACA,QAAMkB,WAAW,GAAGD,gBAAMC,WAAN,CAAkBV,QAAlB,CAApB;;AACA,QAAMW,cAAc,GAAGF,gBAAME,cAAN,CAAqBX,QAArB,CAAvB;;AAEAiB,EAAAA,UAAU,CAACxB,QAAX,GAAsBiB,WAAW,GAAG,CAAH,GAAO,CAAxC;AACAO,EAAAA,UAAU,CAACvB,WAAX,GAAyBiB,cAAc,GAAG,CAAH,GAAO,CAA9C;AAEA,SAAOb,UAAU,CAACc,OAAX,CAAmBC,sBAASC,YAA5B,EAA0Cd,QAAQ,CAACI,GAAnD,EAAwD;AAC7DE,IAAAA,IAAI,EAAE,EACJ,GAAGD,SADC;AAEJa,MAAAA,OAAO,EAAED;AAFL;AADuD,GAAxD,CAAP;AAMD;;AAEc,SAASE,gBAAT,CAA0BrB,UAA1B,EAAkDC,KAAlD,EAAgE;AAC7EF,EAAAA,aAAa,CAACC,UAAD,EAAaC,KAAb,CAAb;AACAiB,EAAAA,aAAa,CAAClB,UAAD,EAAaC,KAAb,CAAb;AACA,SAAOD,UAAP;AACD","sourcesContent":["import { Commands, Controller } from '@ali/4ever-cangjie';\nimport Table from '../../mo/models';\nimport { TABLE_HEADER_STYLE_ID } from '../constants';\n\nconst DEFAULT_TBLLOOK: Table['data']['tblLook'] = {\n  firstRow: 0,\n  firstColumn: 0,\n  lastRow: 0,\n  lastColumn: 0,\n};\n\nfunction updateStyleId(controller: Controller, table: Table) {\n  const newTable = controller.value.document.getNode(table.key) as Table;\n\n  if (!newTable) return controller;\n\n  const tableData = { ...(newTable.data || {}) };\n  const { styleId } = tableData;\n  const shouldRemoveStyleId = !Table.isRowHeader(newTable) && !Table.isColumnHeader(newTable);\n\n  if (shouldRemoveStyleId && styleId) {\n    delete tableData.styleId;\n    return controller.command(Commands.setNodeByKey, newTable.key, {\n      data: tableData,\n    });\n  }\n\n  if (!shouldRemoveStyleId && !styleId) {\n    tableData.styleId = TABLE_HEADER_STYLE_ID;\n    return controller.command(Commands.setNodeByKey, newTable.key, {\n      data: tableData,\n    });\n  }\n\n  return controller;\n}\n\nfunction updateTblLook(controller: Controller, table: Table) {\n  const newTable = controller.value.document.getNode(table.key) as Table;\n\n  if (!newTable) return controller;\n\n  const tableData = { ...(newTable.data || {}) };\n  const newTblLook = { ...DEFAULT_TBLLOOK };\n  const isRowHeader = Table.isRowHeader(newTable);\n  const isColumnHeader = Table.isColumnHeader(newTable);\n\n  newTblLook.firstRow = isRowHeader ? 1 : 0;\n  newTblLook.firstColumn = isColumnHeader ? 1 : 0;\n\n  return controller.command(Commands.setNodeByKey, newTable.key, {\n    data: {\n      ...tableData,\n      tblLook: newTblLook,\n    },\n  });\n}\n\nexport default function updateTableStyle(controller: Controller, table: Table) {\n  updateStyleId(controller, table);\n  updateTblLook(controller, table);\n  return controller;\n}\n"],"file":"updateTableStyle.js"}