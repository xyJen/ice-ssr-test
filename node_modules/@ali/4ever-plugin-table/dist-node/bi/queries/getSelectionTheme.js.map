{"version":3,"sources":["../../../../src/bi/queries/getSelectionTheme.ts"],"names":["getCellBorder","bdr","top","right","bottom","left","lBdColor","sz","color","rBdColor","tBdColor","bBdColor","getCellsSameValue","controller","fn","defaultValue","undefined","value","table","selection","res","startRowIndex","startColIndex","endRowIndex","endColIndex","tablePath","document","getPath","key","rowIndex","colIndex","isFirst","cellPath","cell","getNodeByPath","payload","data","hidden","getSelectionTheme","bgColor","fill","bdColor","DEFAULT_BORDER_COLOR","backgroundColor","borderColor"],"mappings":"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","sourcesContent":["import type { Controller, Block, MoInterfaces } from '@ali/4ever-cangjie';\nimport getTable from '../utils/getTable';\nimport getTableSelection from '../utils/getTableSelection';\nimport { DEFAULT_BORDER_COLOR } from '../../utils/constants';\n\nfunction getCellBorder(bdr: MoInterfaces.TableBorder.default) {\n  const { top, right, bottom, left } = bdr;\n  const lBdColor = left && left.sz! > 0 ? left.color : '';\n  const rBdColor = right && right.sz! > 0 ? right.color : '';\n  const tBdColor = top && top.sz! > 0 ? top.color : '';\n  const bBdColor = bottom && bottom.sz! > 0 ? bottom.color : '';\n\n  return lBdColor === rBdColor && tBdColor === bBdColor && lBdColor === tBdColor ? lBdColor : '';\n}\n\nfunction getCellsSameValue(controller: Controller, fn: (payload: any) => any, defaultValue: any = undefined) {\n  const { value } = controller;\n  const table = getTable(value);\n  const selection = getTableSelection(controller);\n  let res = defaultValue;\n  if (selection && table) {\n    const { startRowIndex, startColIndex, endRowIndex, endColIndex } = selection;\n\n    const tablePath = value.document.getPath(table.key);\n    if (tablePath) {\n      for (let rowIndex = startRowIndex; rowIndex <= endRowIndex; rowIndex++) {\n        for (let colIndex = startColIndex; colIndex <= endColIndex; colIndex++) {\n          const isFirst = rowIndex === startRowIndex && colIndex === startColIndex;\n\n          const cellPath = [...tablePath, rowIndex, colIndex];\n          const cell = cellPath && value.document.getNodeByPath(cellPath) as Block;\n          if (cell) {\n            const payload = cell.data;\n            if (payload && !payload.hidden) {\n              if (isFirst) {\n                res = fn(payload);\n              } else if (res !== fn(payload)) {\n                return defaultValue;\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n  return res;\n}\n\nexport function getSelectionTheme(controller: Controller) {\n  const bgColor = getCellsSameValue(controller, (payload) => payload?.fill);\n  const bdColor = getCellsSameValue(controller, (payload) => {\n    if (payload?.bdr) {\n      return getCellBorder(payload.bdr);\n    }\n    return DEFAULT_BORDER_COLOR;\n  }, DEFAULT_BORDER_COLOR);\n  return {\n    backgroundColor: bgColor,\n    borderColor: bdColor,\n  };\n}\n"],"file":"getSelectionTheme.js"}