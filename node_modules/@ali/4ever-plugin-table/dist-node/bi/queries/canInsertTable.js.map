{"version":3,"sources":["../../../../src/bi/queries/canInsertTable.ts"],"names":["isKeyInCell","document","key","ancestors","getAncestors","find","ancestor","type","canInsertTable","controller","value","tableSelection","query","selection","isCollapsedAtEdge","excludeColumns","e"],"mappings":";;;;;;;;AAEA;;AAEO,SAASA,WAAT,CAAqBC,QAArB,EAAyCC,GAAzC,EAAsD;AAC3D,QAAMC,SAAS,GAAGF,QAAQ,CAACG,YAAT,CAAsBF,GAAtB,CAAlB;AACA,SAAO,CAAC,CAACC,SAAS,CAACE,IAAV,CAAgBC,QAAD,IAAcA,QAAQ,CAACC,IAAT,KAAkB,YAA/C,CAAT;AACD;;AAEc,SAASC,cAAT,CAAwBC,UAAxB,EAAyD;AACtE,MAAI,CAACA,UAAL,EAAiB,OAAO,KAAP;AAEjB,QAAM;AAAEC,IAAAA;AAAF,MAAYD,UAAlB;AACA,QAAME,cAAc,GAAGF,UAAU,CAACG,KAAX,CAAiB,mBAAjB,CAAvB;;AACA,MAAID,cAAJ,EAAoB;AAClB;AACA,WAAO,KAAP;AACD;;AAED,QAAM;AAAEE,IAAAA;AAAF,MAAgBH,KAAtB;AACA,QAAM;AAAEI,IAAAA;AAAF,MAAwBD,SAA9B;;AACA,MAAI;AACF,WAAO,CAACC,iBAAD,IACF,CAAC,mCAAuBJ,KAAvB,EAA8B;AAAEK,MAAAA,cAAc,EAAE;AAAlB,KAA9B,CADC,IAEF,CAACN,UAAU,CAACG,KAAX,CAAiB,mBAAjB,CAFC,IAGF,CAACH,UAAU,CAACG,KAAX,CAAiB,sBAAjB,CAHN;AAID,GALD,CAKE,OAAOI,CAAP,EAAU;AACV,WAAO,IAAP;AACD;AACF","sourcesContent":["import { Controller, Document } from '@ali/4ever-cangjie';\n\nimport { isSelectionInTableCell } from '../utils';\n\nexport function isKeyInCell(document: Document, key: string) {\n  const ancestors = document.getAncestors(key);\n  return !!ancestors.find((ancestor) => ancestor.type === 'table-cell');\n}\n\nexport default function canInsertTable(controller: Controller): boolean {\n  if (!controller) return false;\n\n  const { value } = controller;\n  const tableSelection = controller.query('hasTableSelection');\n  if (tableSelection) {\n    // 单元格被选中\n    return false;\n  }\n\n  const { selection } = value;\n  const { isCollapsedAtEdge } = selection;\n  try {\n    return !isCollapsedAtEdge\n      && !isSelectionInTableCell(value, { excludeColumns: true })\n      && !controller.query('isSelectionInLink')\n      && !controller.query('isSelectionInMention');\n  } catch (e) {\n    return true;\n  }\n}\n"],"file":"canInsertTable.js"}