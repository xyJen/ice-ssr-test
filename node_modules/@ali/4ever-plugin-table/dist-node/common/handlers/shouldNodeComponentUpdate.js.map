{"version":3,"sources":["../../../../src/common/handlers/shouldNodeComponentUpdate.ts"],"names":["shouldNodeComponentUpdate","prevProps","props","__","next","TableRow","isTableRow","node","prevTable","parent","table","data","colsWidth","styleId","tblLook","TableCell","isTableCell","document","prevDocument","value","getClosest","key","Table","isTable","prevCellWidth","prevPosition","cellWidth","position","isSelected","prevValue","selection","plainViewKey","isByTable"],"mappings":";;;;;;;;;AAAA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AAIA,MAAMA,yBAAkC,GAAG,CAACC,SAAD,EAAYC,KAAZ,EAAmBC,EAAnB,EAAuBC,IAAvB,KAAgC;AACzE,MAAIC,kBAASC,UAAT,CAAoBJ,KAAK,CAACK,IAA1B,CAAJ,EAAqC;AACnC,UAAMC,SAAS,GAAGP,SAAS,CAACQ,MAA5B;AACA,UAAMC,KAAK,GAAGR,KAAK,CAACO,MAApB,CAFmC,CAGnC;;AACA,QACE,CAAC,4BAAMD,SAAS,EAAEG,IAAX,EAAiBC,SAAvB,EAAkCF,KAAK,EAAEC,IAAP,EAAaC,SAA/C,CAAD,IACG,CAAC,4BAAMJ,SAAS,EAAEG,IAAX,EAAiBE,OAAvB,EAAgCH,KAAK,EAAEC,IAAP,EAAaE,OAA7C,CADJ,IAEG,CAAC,4BAAML,SAAS,EAAEG,IAAX,EAAiBG,OAAvB,EAAgCJ,KAAK,EAAEC,IAAP,EAAaG,OAA7C,CAHN,EAIE;AACA,aAAO,IAAP;AACD;AACF;;AAED,MAAIC,mBAAUC,WAAV,CAAsBd,KAAK,CAACK,IAA5B,CAAJ,EAAuC;AACrC,UAAM;AAAEU,MAAAA,QAAQ,EAAEC;AAAZ,QAA6BjB,SAAS,CAACkB,KAA7C;AACA,UAAMX,SAAS,GAAGU,YAAY,CAACE,UAAb,CAAwBnB,SAAS,CAACM,IAAV,CAAec,GAAvC,EAA4CC,gBAAMC,OAAlD,CAAlB;AACA,UAAMC,aAAa,GAAG,gCAAkBvB,SAAS,CAACM,IAA5B,EAA+CC,SAA/C,CAAtB;AACA,UAAMiB,YAAY,GAAG,gCAAkBxB,SAAS,CAACM,IAAV,CAAec,GAAjC,EAAsCb,SAAtC,CAArB;AAEA,UAAM;AAAES,MAAAA;AAAF,QAAef,KAAK,CAACiB,KAA3B;AACA,UAAMT,KAAK,GAAGO,QAAQ,CAACG,UAAT,CAAoBlB,KAAK,CAACK,IAAN,CAAWc,GAA/B,EAAoCC,gBAAMC,OAA1C,CAAd;AACA,UAAMG,SAAS,GAAG,gCAAkBxB,KAAK,CAACK,IAAxB,EAA8BG,KAA9B,CAAlB;AACA,UAAMiB,QAAQ,GAAG,gCAAkBzB,KAAK,CAACK,IAAN,CAAWc,GAA7B,EAAkCX,KAAlC,CAAjB,CATqC,CAWrC;;AACA,QACE,CAAC,4BAAMc,aAAN,EAAqBE,SAArB,CAAD,IACG,CAAC,4BAAMD,YAAN,EAAoBE,QAApB,CADJ,IAEG,CAAC,4BAAMnB,SAAS,EAAEG,IAAX,EAAiBE,OAAvB,EAAgCH,KAAK,EAAEC,IAAP,EAAaE,OAA7C,CAFJ,IAGG,CAAC,4BAAML,SAAS,EAAEG,IAAX,EAAiBG,OAAvB,EAAgCJ,KAAK,EAAEC,IAAP,EAAaG,OAA7C,CAJN,EAKE;AACA,aAAO,IAAP;AACD;AACF;;AACD,MAAIQ,gBAAMC,OAAN,CAAcrB,KAAK,CAACK,IAApB,CAAJ,EAA+B;AAC7B;AACA;AACA,QACEL,KAAK,CAAC0B,UAAN,IACG3B,SAAS,CAAC2B,UADb,IAEG1B,KAAK,CAAC2B,SAAN,EAAiBC,SAAjB,CAA2BC,YAA3B,KAA4C7B,KAAK,CAACiB,KAAN,CAAYW,SAAZ,CAAsBC,YAFrE,IAGG7B,KAAK,CAAC2B,SAAN,EAAiBC,SAAjB,CAA2BnB,IAA3B,CAAgCqB,SAAhC,KAA8C9B,KAAK,CAACiB,KAAN,CAAYW,SAAZ,CAAsBnB,IAAtB,CAA2BqB,SAJ9E,EAKE;AACA,aAAO,IAAP;AACD;AACF;;AACD,SAAO5B,IAAI,EAAX;AACD,CAhDD;;eAkDeJ,yB","sourcesContent":["import equal from 'fast-deep-equal';\nimport { Plugin, Block } from '@ali/4ever-cangjie';\nimport Table from '../../mo/models';\nimport TableCell from '../../mo/models/tableCell';\nimport TableRow from '../../mo/models/tableRow';\nimport getTableCellWidth from '../../utils/utils/getTableCellWidth';\nimport getPositionOfCell from '../../utils/utils/getPositionOfCell';\n\ntype SNCType = Plugin['shouldNodeComponentUpdate'];\n\nconst shouldNodeComponentUpdate: SNCType = (prevProps, props, __, next) => {\n  if (TableRow.isTableRow(props.node)) {\n    const prevTable = prevProps.parent as Block;\n    const table = props.parent as Block;\n    // 表格列宽变化时 update 以触发 tableCell update\n    if (\n      !equal(prevTable?.data?.colsWidth, table?.data?.colsWidth)\n      || !equal(prevTable?.data?.styleId, table?.data?.styleId)\n      || !equal(prevTable?.data?.tblLook, table?.data?.tblLook)\n    ) {\n      return true;\n    }\n  }\n\n  if (TableCell.isTableCell(props.node)) {\n    const { document: prevDocument } = prevProps.value;\n    const prevTable = prevDocument.getClosest(prevProps.node.key, Table.isTable) as Table;\n    const prevCellWidth = getTableCellWidth(prevProps.node as TableCell, prevTable);\n    const prevPosition = getPositionOfCell(prevProps.node.key, prevTable);\n\n    const { document } = props.value;\n    const table = document.getClosest(props.node.key, Table.isTable) as Table;\n    const cellWidth = getTableCellWidth(props.node, table);\n    const position = getPositionOfCell(props.node.key, table);\n\n    // tableCell 宽度变化时 update（部分插件在 cell 宽度变化时需要 rerender）\n    if (\n      !equal(prevCellWidth, cellWidth)\n      || !equal(prevPosition, position)\n      || !equal(prevTable?.data?.styleId, table?.data?.styleId)\n      || !equal(prevTable?.data?.tblLook, table?.data?.tblLook)\n    ) {\n      return true;\n    }\n  }\n  if (Table.isTable(props.node)) {\n    // 当在单元格内选区时，若由于 mousemove 造成仅有 selection.data.isByTable 变化\n    // 则使表格 re-render 以显示单元格选区\n    if (\n      props.isSelected\n      && prevProps.isSelected\n      && props.prevValue?.selection.plainViewKey === props.value.selection.plainViewKey\n      && props.prevValue?.selection.data.isByTable !== props.value.selection.data.isByTable\n    ) {\n      return true;\n    }\n  }\n  return next();\n}\n\nexport default shouldNodeComponentUpdate;\n"],"file":"shouldNodeComponentUpdate.js"}