{"version":3,"sources":["../../../../src/bi/components/table.tsx"],"names":["React","ReactDOM","throttle","fastdom","useZoom","useZoomContainer","useScrollableContainer","actions","getClosestContainerBlock","getInnerWidth","getBoundingRelativeRect","getRelativeMouseEvent","resizeTableWidth","resizeTableWidthFitContainer","resizeTableHeight","resizeTableColWidth","setTableRowHeight","deleteTable","selectTableCols","selectTableRows","selectTable","scrollTable","adjustColsWidth","getPositionOfCell","MIN_COL_WIDTH","MIN_ROW_HEIGHT","DETECT_DELTA","TOOLBAR_ITEM_SIZE","createTableSelectionForFocusedCell","TableCornerToolbar","TableColToolbar","TableRowToolbar","TableResizeController","ColResizer","RowResizer","ColIndicator","RowIndicator","Wrapper","TableLeftSideShadow","TableRightSideShadow","logNPEInfo","TableWithSelection","CornerButton","useSelectionStatus","REALTABLE_PADDING","TableScrollContainer","TableIsSelectedContext","utils","PixelColsWidthContext","TableContextContainer","ContextContainer","getTableIsSelected","visibleUtil","getColIndex","cell","border","table","cellKey","getAttribute","position","colIndex","parseInt","getRowKey","row","parentElement","rowElements","Array","from","children","rowIndex","indexOf","adjustedRowIndex","adjustedRow","getPrevVisibleCell","prevVisibleCell","previousElementSibling","style","display","getNextVisibleCell","nextVisibleCell","nextElementSibling","lastActiveTableKey","closeContextMenu","getLastActiveTableKey","Table","props","colResizeable","rowResizeable","resizingColIndex","resizingRowKey","resizingColCell","resizingColNextCell","resizingRow","startTableX","startTableY","wrapperRef","createRef","realTableWrapperRef","tableRef","colResizerRef","rowResizerRef","colIndicatorRef","rowIndicatorRef","tableResizeControllerRef","tableResizeControlLinesRef","tableLeftShadowRef","tableRightShadowRef","lastEndCellKey","tableSelection","colsNodes","updateShadowRafId","tableCursorStyle","isResizingTable","controller","run","getContainerWidth","node","value","containerBlock","containerWidth","handleMouseEnter","current","cursor","handleMouseMove","event","zoomContainer","relativeEvent","isInNestedTable","targetCell","target","closest","prevCursor","targetCellRect","deltaToLeft","relativeX","left","deltaToRight","right","deltaToTop","relativeY","top","deltaToBottom","bottom","handleMouseDown","key","buttons","handleColResizeStart","handleRowResizeStart","handleTableResizeStart","scale","preventDefault","stopPropagation","realTableWrapper","findDOMNode","realTableWrapperRect","Math","round","document","addEventListener","handleTableResizing","handleTableResizeEnd","tableRect","tableResizeController","currentTableX","max","currentTableY","rowsHeight","query","deltaX","deltaY","removeEventListener","maxTableWidth","updateShadowState","firstRowDOM","querySelector","firstRowRect","colResizer","height","isSelected","handleColResizing","handleColResizeEnd","colsWidth","resizingColCellRect","resizingColCellRectLeft","resizingColCellIndex","data","type","nodeData","fixedColWidth","slice","reduce","sum","colWidth","validLeftLimit","totalWidth","validRightLimit","Infinity","resizingColNextCellRect","resizingColNextCellRectLeft","resizingColNextCellIndex","validClientX","min","delta","isNaN","handleColResize","resizeColIndex","rowResizer","marginTop","tableWidth","width","handleRowResizing","handleRowResizeEnd","resizingColRectTop","validTopLimit","validClientY","handleRowResize","tableRow","getNode","originalHeight","handleSelectRow","selectedRowRange","shouldHideContextMenu","start","end","handleSelectCol","selectedColRange","handleSelectCorner","updateShadowStyleCallback","visible","dataTable","unregisterVisibleChange","tableLeftShadow","tableRightShadow","updateShadowStyle","getVisible","registerVisibleChange","updateScrollLeft","percentOfScrollLeft","scrollContainer","offsetWidth","totalScroll","scrollTo","behavior","updateTableResizeController","tableDOM","updateOnRender","handleTableToolbarContextMenu","handleMenuEvent","selection","getTableSelection","window","cancelAnimationFrame","requestAnimationFrame","measure","shouldShowTableLeftShadow","scrollLeft","scrollableContentWidth","shouldShowTableRightShadow","state","prevLeft","prevRight","setState","handleTableScroll","tableConfig","onScroll","tblSelections","curTableSelection","find","ts","getTableLeftMaxBorder","nodes","acc","firstCell","hidden","bdr","sz","getAllColsNodes","handleSetIsHighlightSelection","isHighlight","isSelectionHighlight","handleSetHoverSelection","sel","hoverSelection","isShowCornerToolbar","hideCornerButton","handleMouseEnterTable","isHoverTable","handleMouseLeaveTable","setWholeTableHoverSelection","cols","length","rows","endColIndex","endRowIndex","startColIndex","startRowIndex","removeWholeTableHoverSelection","handleMouseEnterCornerToolbar","isHoverCornerToolbar","handleMouseLeaveCornerToolbar","componentDidMount","componentDidUpdate","prevProps","prevNode","prevIsSelected","componentWillUnmount","cancel","Boolean","render","locale","scrollableContainer","draggableConfig","hideDeleteButton","hideWidthFitButton","enableAutofitWidth","enableHeader","setTableHeaderStyle","leftOffset","floor","isSelectWholeTable","isHideDeleteButton","disableHorizontalScrollbar","marginLeft","paddingLeft","paddingTop","paddingBottom","Component","Container","body","useState","pendingSelectedWhole","setPendingSelectedWhole","realSelected","setRealSelected","useReducer","c","forceUpdate","useEffect","newTable","shouldUpdateTable","useCallback","isPendingSelected","hasHots","memoProps","useMemo","pixelColsWidth","enableHeaderSticky"],"mappings":"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","sourcesContent":["/* eslint-disable max-lines */\n/* eslint-disable react/no-find-dom-node */\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { throttle } from 'lodash-es';\nimport fastdom from 'fastdom';\nimport {\n  Controller,\n  Block,\n  useZoom,\n  useZoomContainer,\n  BiPluginConfig,\n  useScrollableContainer,\n} from '@ali/4ever-cangjie';\nimport { actions } from '@ali/4ever-plugin-pc-contex-menu';\nimport MoTable from '../../mo/models';\nimport {\n  getClosestContainerBlock,\n  getInnerWidth,\n  getBoundingRelativeRect,\n  getRelativeMouseEvent,\n} from '@ali/4ever-utils';\nimport {\n  resizeTableWidth,\n  resizeTableWidthFitContainer,\n  resizeTableHeight,\n  resizeTableColWidth,\n  setTableRowHeight,\n  deleteTable,\n  selectTableCols,\n  selectTableRows,\n  selectTable,\n  scrollTable,\n  adjustColsWidth,\n} from '../actions';\nimport getPositionOfCell from '../utils/getPositionOfCell';\nimport {\n  MIN_COL_WIDTH,\n  MIN_ROW_HEIGHT,\n  DETECT_DELTA,\n  TOOLBAR_ITEM_SIZE,\n} from '../constants';\nimport createTableSelectionForFocusedCell from '../utils/createTableSelectionForFocusedCell';\nimport TableCornerToolbar from './cornerToolbar';\nimport TableColToolbar from './colToolbar';\nimport TableRowToolbar from './rowToolbar';\nimport TableResizeController from './tableResizeController';\nimport {\n  ColResizer,\n  RowResizer,\n  ColIndicator,\n  RowIndicator,\n  Wrapper,\n  TableLeftSideShadow,\n  TableRightSideShadow,\n} from './styled';\nimport { logNPEInfo } from '../utils/logger';\nimport { ISelectedIndexRange, ITableSelection, TableConfig } from '../types';\nimport TableWithSelection from './tableWithSelection';\nimport CornerButton from './cornerButton';\nimport { useSelectionStatus } from '../../utils/hooks/useSelectionStatus';\nimport { REALTABLE_PADDING } from '../../utils/constants';\nimport TableScrollContainer from '../../components/tableScrollContainer';\nimport { TableIsSelectedContext } from '../../utils/hooks/useTableIsSelected';\nimport utils from '../../utils/utils';\nimport { PixelColsWidthContext } from '../../utils/hooks/usePixelColsWidth';\nimport TableContextContainer from '../../components/tableContextContainer';\nimport { ContextContainer } from './contextContainer';\n\nconst { getTableIsSelected, visibleUtil } = utils;\n\nfunction getColIndex(cell: HTMLTableCellElement, border: 'left' | 'right', table: MoTable) {\n  const cellKey = cell.getAttribute('data-cangjie-key')!;\n  const position = getPositionOfCell(\n    cellKey,\n    table,\n  );\n\n  const colIndex = position && position.colIndex;\n  if (!(typeof colIndex === 'number' && colIndex >= 0)) {\n    return null;\n  }\n\n  return border === 'left'\n    ? colIndex - 1\n    : colIndex + (parseInt(cell.getAttribute('colspan')!, 10) || 1) - 1;\n}\n\nfunction getRowKey(cell: HTMLTableCellElement, border: 'top' | 'bottom' | false) {\n  const row = cell.parentElement;\n  if (!row) {\n    return null;\n  }\n  const rowElements = Array.from(row.parentElement!.children);\n  const rowIndex = rowElements.indexOf(row!);\n  const adjustedRowIndex = border === 'top' ? rowIndex - 1 : rowIndex;\n  const adjustedRow = rowElements[adjustedRowIndex];\n  if (adjustedRow) {\n    return adjustedRow.getAttribute('data-cangjie-key');\n  }\n  return null;\n}\n\nfunction getPrevVisibleCell(cell: HTMLTableCellElement) {\n  let prevVisibleCell = cell.previousElementSibling as HTMLTableCellElement;\n  while (prevVisibleCell && prevVisibleCell.style.display === 'none') {\n    prevVisibleCell = prevVisibleCell.previousElementSibling as HTMLTableCellElement;\n  }\n  return prevVisibleCell;\n}\n\nfunction getNextVisibleCell(cell: HTMLTableCellElement) {\n  let nextVisibleCell = cell.nextElementSibling as HTMLTableCellElement;\n  while (nextVisibleCell && nextVisibleCell.style.display === 'none') {\n    nextVisibleCell = nextVisibleCell.nextElementSibling as HTMLTableCellElement;\n  }\n  return nextVisibleCell;\n}\n\nexport interface Selection {\n  startRowIndex: number;\n  startColIndex: number;\n  endRowIndex: number;\n  endColIndex: number;\n}\n\nlet lastActiveTableKey: string | null = null;\nconst { closeContextMenu } = actions;\n\nfunction getLastActiveTableKey() {\n  return lastActiveTableKey;\n}\n\nexport interface TableProps {\n  controller: Controller;\n  isSelected: boolean;\n  node: MoTable;\n  colsWidth: number[];\n  scale: number;\n  zoomContainer: HTMLElement;\n  scrollableContainer?: Window | HTMLElement | null;\n  tableSelection?: Omit<ITableSelection, 'key'> | null;\n  children: () => React.ReactNode;\n  tableConfig?: TableConfig;\n  draggableConfig?: BiPluginConfig['draggable'];\n  locale: any;\n  visible?: boolean;\n}\n\ninterface TableState {\n  shouldShowTableLeftShadow: boolean;\n  shouldShowTableRightShadow: boolean;\n  isSelectionHighlight: boolean;\n  hoverSelection: ITableSelection | null;\n  isHoverTable: boolean;\n  isHoverCornerToolbar: boolean;\n}\n\nclass Table extends React.Component<TableProps, TableState> {\n  colResizeable: false | 'left' | 'right' = false;\n\n  rowResizeable: false | 'top' | 'bottom' = false;\n\n  resizingColIndex: number | null = null;\n\n  resizingRowKey: string | null = null;\n\n  resizingColCell: HTMLTableCellElement | null = null;\n\n  resizingColNextCell: HTMLTableCellElement | null = null;\n\n  resizingRow: HTMLTableCellElement | null = null;\n\n  startTableX: number | null = null;\n\n  startTableY: number | null = null;\n\n  wrapperRef: React.RefObject<HTMLDivElement> = React.createRef();\n\n  realTableWrapperRef: React.RefObject<HTMLDivElement> = React.createRef();\n\n  tableRef: React.RefObject<HTMLTableElement> = React.createRef();\n\n  colResizerRef: React.RefObject<HTMLDivElement> = React.createRef();\n\n  rowResizerRef: React.RefObject<HTMLDivElement> = React.createRef();\n\n  colIndicatorRef: React.RefObject<HTMLTableElement> = React.createRef();\n\n  rowIndicatorRef: React.RefObject<HTMLTableElement> = React.createRef();\n\n  tableResizeControllerRef: React.RefObject<HTMLDivElement> = React.createRef();\n\n  tableResizeControlLinesRef: React.RefObject<\n  HTMLDivElement\n  > = React.createRef();\n\n  tableLeftShadowRef: React.RefObject<HTMLDivElement> = React.createRef();\n\n  tableRightShadowRef: React.RefObject<HTMLDivElement> = React.createRef();\n\n  lastEndCellKey: string | null = null;\n\n  tableSelection: ITableSelection | null = null;\n\n  colsNodes: HTMLDivElement[] = [];\n\n  updateShadowRafId: number | null = null;\n\n  tableCursorStyle: string | null = null;\n\n  isResizingTable = false;\n\n  constructor(props: TableProps) {\n    super(props);\n    this.state = {\n      shouldShowTableLeftShadow: false,\n      shouldShowTableRightShadow: false,\n      isSelectionHighlight: false,\n      hoverSelection: null,\n      isHoverTable: false,\n      isHoverCornerToolbar: false,\n    };\n  }\n\n  componentDidMount() {\n    this.updateOnRender();\n    this.updateShadowState();\n    this.updateScrollLeft();\n  }\n\n  componentDidUpdate(prevProps: TableProps) {\n    fastdom.measure(() => {\n      const { node, isSelected } = this.props;\n      this.updateOnRender();\n\n      const { node: prevNode, isSelected: prevIsSelected } = prevProps;\n      if (\n        isSelected !== prevIsSelected ||\n        (node.data.colsWidth || []).length !==\n        (prevNode.data.colsWidth || []).length\n      ) {\n        this.handleTableScroll();\n      }\n      if (node.data?.percentOfScrollLeft !== prevNode.data?.percentOfScrollLeft) {\n        this.updateScrollLeft();\n      }\n    });\n  }\n\n  componentWillUnmount() {\n    this.handleTableScroll.cancel();\n    this.updateOnRender.cancel();\n    if (this.updateShadowRafId !== null) {\n      window.cancelAnimationFrame(this.updateShadowRafId);\n    }\n\n    document.removeEventListener('mousemove', this.handleColResizing);\n    document.removeEventListener('mouseup', this.handleColResizeEnd);\n\n    document.removeEventListener('mousemove', this.handleRowResizing);\n    document.removeEventListener('mouseup', this.handleRowResizeEnd);\n\n    document.removeEventListener('mousemove', this.handleTableResizing);\n    document.removeEventListener('mouseup', this.handleTableResizeEnd);\n  }\n\n  isInNestedTable(event) {\n    const table = event.target.closest('table');\n    return table !== ReactDOM.findDOMNode(this.tableRef.current);\n  }\n\n  isSelected() {\n    const { isSelected } = this.props;\n    return isSelected || Boolean(this.getTableSelection());\n  }\n\n  closeContextMenu = () => {\n    const { controller } = this.props;\n    controller.run('onAction', closeContextMenu());\n  };\n\n  getContainerWidth = () => {\n    const { controller, node } = this.props;\n    const { value } = controller;\n    const containerBlock = getClosestContainerBlock(value, node);\n    const containerWidth = getInnerWidth(containerBlock);\n    return containerWidth;\n  };\n\n  handleMouseEnter = () => {\n    if (!this.realTableWrapperRef.current) return;\n\n    this.tableCursorStyle = this.realTableWrapperRef.current.style.cursor;\n  };\n\n  handleMouseMove = (event) => {\n    const { zoomContainer } = this.props;\n    const relativeEvent = getRelativeMouseEvent(event, zoomContainer);\n    if (\n      this.startTableX || // 正在调整列宽\n      this.startTableY ||\n      this.isInNestedTable(event)\n    ) {\n      return;\n    }\n\n    const targetCell = event.target.closest('td');\n    const prevCursor = this.tableCursorStyle;\n\n    if (!targetCell) {\n      return;\n    }\n\n    const targetCellRect = getBoundingRelativeRect(targetCell, zoomContainer);\n    const deltaToLeft = relativeEvent.relativeX - targetCellRect.left;\n    const deltaToRight = targetCellRect.right - relativeEvent.relativeX;\n    const deltaToTop = relativeEvent.relativeY - targetCellRect.top;\n    const deltaToBottom = targetCellRect.bottom - relativeEvent.relativeY;\n\n    // DETECT_DELTA不加成scale比较合理\n\n    if (deltaToLeft <= DETECT_DELTA) {\n      if (!targetCell.previousElementSibling) {\n        this.colResizeable = false;\n        targetCell.style.cursor = prevCursor;\n      } else {\n        this.colResizeable = 'left';\n        this.rowResizeable = false;\n        targetCell.style.cursor = 'col-resize';\n      }\n    } else if (deltaToRight <= DETECT_DELTA) {\n      this.colResizeable = 'right';\n      this.rowResizeable = false;\n      targetCell.style.cursor = 'col-resize';\n    } else if (deltaToTop <= 4) {\n      if (!targetCell.parentElement.previousElementSibling) {\n        this.rowResizeable = false;\n        targetCell.style.cursor = prevCursor;\n      } else {\n        this.rowResizeable = 'top';\n        this.colResizeable = false;\n        targetCell.style.cursor = 'row-resize';\n      }\n    } else if (deltaToBottom <= DETECT_DELTA) {\n      this.rowResizeable = 'bottom';\n      this.colResizeable = false;\n      targetCell.style.cursor = 'row-resize';\n    } else {\n      this.rowResizeable = false;\n      this.colResizeable = false;\n      // 单元格的鼠标默认样式\n      targetCell.style.cursor = prevCursor;\n    }\n  };\n\n  handleMouseDown = (event: React.MouseEvent<HTMLTableElement>) => {\n    const { node } = this.props;\n    lastActiveTableKey = node.key;\n    // 右键 mouseDown 不处理\n    if (\n      this.isInNestedTable(event) ||\n      event.buttons === 2\n    ) {\n      return;\n    }\n\n    if (this.colResizeable) {\n      this.handleColResizeStart(event);\n    } else if (this.rowResizeable) {\n      this.handleRowResizeStart(event);\n    }\n  };\n\n  handleTableResizeStart = (event) => {\n    const { scale, zoomContainer } = this.props;\n    event.preventDefault();\n    event.stopPropagation();\n    const relativeEvent = getRelativeMouseEvent(event, zoomContainer);\n    const realTableWrapper = ReactDOM.findDOMNode(this.realTableWrapperRef.current) as HTMLElement;\n    const realTableWrapperRect = getBoundingRelativeRect(\n      realTableWrapper,\n      zoomContainer,\n    );\n\n    this.startTableX = Math.round(\n      (relativeEvent.relativeX - realTableWrapperRect.left) / scale,\n    );\n    this.startTableY = Math.round(\n      (relativeEvent.relativeY - realTableWrapperRect.top) / scale,\n    );\n    if (this.tableResizeControlLinesRef.current) {\n      this.tableResizeControlLinesRef.current.style.display = 'block';\n    }\n\n    this.isResizingTable = true;\n\n    document.addEventListener('mousemove', this.handleTableResizing);\n    document.addEventListener('mouseup', this.handleTableResizeEnd);\n  };\n\n  handleTableResizing = (event) => {\n    const { scale, zoomContainer } = this.props;\n    if (!zoomContainer) return;\n\n    event.preventDefault();\n    event.stopPropagation();\n    const relativeEvent = getRelativeMouseEvent(event, zoomContainer);\n    const realTableWrapper = this.realTableWrapperRef.current;\n    if (!realTableWrapper || !this.tableRef.current || !this.tableResizeControllerRef.current) return;\n    const realTableWrapperRect = getBoundingRelativeRect(\n      realTableWrapper,\n      zoomContainer,\n    );\n    const table = this.tableRef.current;\n    const tableRect = getBoundingRelativeRect(table, zoomContainer);\n    const tableResizeController = this.tableResizeControllerRef.current;\n\n    const currentTableX = Math.max(\n      MIN_COL_WIDTH,\n      Math.round((relativeEvent.relativeX - realTableWrapperRect.left) / scale),\n    );\n    const currentTableY = Math.max(\n      MIN_ROW_HEIGHT,\n      Math.round((relativeEvent.relativeY - tableRect.top) / scale),\n    );\n\n    tableResizeController.style.left = `${currentTableX}px`;\n    tableResizeController.style.top =\n      `${currentTableY +\n      Math.round((tableRect.top - realTableWrapperRect.top) / scale)\n      }px`;\n  };\n\n  handleTableResizeEnd = (event) => {\n    this.isResizingTable = false;\n    event.preventDefault();\n    event.stopPropagation();\n    const { controller, node, zoomContainer, scale } = this.props;\n    const rowsHeight = controller.query('getAllRowsHeight', {\n      node,\n    });\n\n    const relativeEvent = getRelativeMouseEvent(event, zoomContainer);\n    const realTableWrapper = this.realTableWrapperRef.current;\n    if (!realTableWrapper) {\n      return;\n    }\n    const realTableWrapperRect = getBoundingRelativeRect(\n      realTableWrapper,\n      zoomContainer,\n    );\n\n    const deltaX =\n      Math.round((relativeEvent.relativeX - realTableWrapperRect.left) / scale) -\n      this.startTableX!;\n    const deltaY =\n      Math.round((relativeEvent.relativeY - realTableWrapperRect.top) / scale) -\n      this.startTableY!;\n\n    this.startTableX = null;\n    this.startTableY = null;\n    if (this.tableResizeControlLinesRef.current) {\n      this.tableResizeControlLinesRef.current.style.display = 'none';\n    }\n    document.removeEventListener('mousemove', this.handleTableResizing);\n    document.removeEventListener('mouseup', this.handleTableResizeEnd);\n    const maxTableWidth = controller.query('maxTableWidth', { node });\n    controller.run('onAction', resizeTableWidth(node, deltaX, maxTableWidth));\n    controller.run('onAction', resizeTableHeight(node, rowsHeight, deltaY));\n    this.updateShadowState();\n  };\n\n  handleColResizeStart = (event) => {\n    const { scale, zoomContainer, node } = this.props;\n    const relativeEvent = getRelativeMouseEvent(event, zoomContainer);\n\n    event.preventDefault();\n\n    const targetCell = event.target.closest('td');\n    if (!targetCell) {\n      return;\n    }\n    // @ts-ignore\n    this.resizingColIndex = getColIndex(targetCell, this.colResizeable, node);\n    if (typeof this.resizingColIndex !== 'number') {\n      return;\n    }\n    this.resizingColCell =\n      this.colResizeable === 'left'\n        ? getPrevVisibleCell(targetCell)\n        : targetCell;\n    this.resizingColNextCell =\n      this.colResizeable === 'left'\n        ? targetCell\n        : getNextVisibleCell(targetCell);\n\n    const realTableWrapper = ReactDOM.findDOMNode(this.realTableWrapperRef.current) as HTMLElement;\n    const realTableWrapperRect = getBoundingRelativeRect(\n      realTableWrapper,\n      zoomContainer,\n    );\n    const table = ReactDOM.findDOMNode(this.tableRef.current) as HTMLElement;\n    const tableRect = getBoundingRelativeRect(table, zoomContainer);\n    const firstRowDOM = table.querySelector('tr');\n    if (!firstRowDOM) return;\n\n    const firstRowRect = getBoundingRelativeRect(firstRowDOM, zoomContainer);\n\n    this.startTableX = relativeEvent.relativeX - realTableWrapperRect.left;\n\n    const colResizer = ReactDOM.findDOMNode(\n      this.colResizerRef.current,\n    ) as HTMLElement;\n    colResizer.style.display = 'block';\n    colResizer.style.height = `${\n      Math.round(tableRect.bottom - firstRowRect.top) / scale +\n      (this.isSelected() ? TOOLBAR_ITEM_SIZE / scale : 0)\n    }px`;\n\n    colResizer.style.left = `${Math.round(this.startTableX / scale)}px`;\n\n    document.addEventListener('mousemove', this.handleColResizing);\n    document.addEventListener('mouseup', this.handleColResizeEnd);\n  };\n\n  handleColResizing = (event) => {\n    const { node, colsWidth } = this.props;\n    const { scale, zoomContainer } = this.props;\n    if (!zoomContainer) return;\n\n    const relativeEvent = getRelativeMouseEvent(event, zoomContainer);\n\n    event.preventDefault();\n\n    const realTableWrapper = this.realTableWrapperRef.current;\n    const colResizer = this.colResizerRef.current;\n\n    // Fix: 找不到节点\n    if (!realTableWrapper || !colResizer || !this.resizingColCell) return;\n\n    const realTableWrapperRect = getBoundingRelativeRect(\n      realTableWrapper,\n      zoomContainer,\n    );\n    const resizingColCellRect = getBoundingRelativeRect(\n      this.resizingColCell,\n      zoomContainer,\n    );\n    const resizingColCellRectLeft = resizingColCellRect.left;\n    const resizingColCellIndex =\n      this.resizingColIndex! -\n      parseInt(this.resizingColCell.getAttribute('colspan')!, 10) +\n      1;\n    if (!node.data.colsWidth) {\n      logNPEInfo(node, {\n        type: `node.data.colsWidth is ${node.data.colsWidth}`,\n        nodeData: node.data,\n      });\n      return;\n    }\n    const fixedColWidth = (colsWidth || [])\n      .slice(resizingColCellIndex, this.resizingColIndex!)\n      .reduce((sum, colWidth) => sum + colWidth, 0);\n    const validLeftLimit =\n      resizingColCellRectLeft + fixedColWidth * scale + MIN_COL_WIDTH * scale;\n    const totalWidth = (colsWidth || []).reduce(\n      (sum, colWidth) => sum + colWidth,\n      0,\n    );\n    let validRightLimit = Infinity;\n    if (\n      this.resizingColNextCell &&\n      totalWidth <= this.getContainerWidth()! - 2\n    ) {\n      const resizingColNextCellRect = getBoundingRelativeRect(\n        this.resizingColNextCell,\n        zoomContainer,\n      );\n      const resizingColNextCellRectLeft = resizingColNextCellRect.left;\n      const resizingColNextCellIndex =\n        resizingColCellIndex +\n        parseInt(this.resizingColCell.getAttribute('colspan')!, 10);\n      validRightLimit =\n        resizingColNextCellRectLeft +\n        (colsWidth[resizingColNextCellIndex] - MIN_COL_WIDTH) * scale;\n    }\n    let validClientX = Math.max(validLeftLimit, relativeEvent.relativeX);\n    validClientX = Math.min(validRightLimit, validClientX);\n    colResizer.style.left = `${Math.round(\n      (validClientX - realTableWrapperRect.left) / scale,\n    )}px`;\n  };\n\n  handleColResizeEnd = () => {\n    const { scale } = this.props;\n    const colResizer = ReactDOM.findDOMNode(\n      this.colResizerRef.current,\n    ) as HTMLElement;\n    if (!colResizer) {\n      return;\n    }\n\n    const delta =\n      parseInt(colResizer.style.left, 10) -\n      Math.round(this.startTableX! / scale);\n    if (!isNaN(delta)) {\n      this.handleColResize(this.resizingColIndex, delta);\n    }\n\n    document.removeEventListener('mousemove', this.handleColResizing);\n    document.removeEventListener('mouseup', this.handleColResizeEnd);\n\n    colResizer.style.display = 'none';\n    colResizer.style.left = '';\n\n    this.resizingColIndex = null;\n    this.resizingColCell = null;\n    this.resizingColNextCell = null;\n    this.startTableX = null;\n  };\n\n  handleColResize = (resizeColIndex, delta) => {\n    const { controller, node } = this.props;\n    controller.run(\n      'onAction',\n      resizeTableColWidth({\n        node,\n        colIndex: resizeColIndex,\n        delta,\n      }),\n    );\n\n    this.updateShadowState();\n  };\n\n  handleRowResizeStart = (event) => {\n    const { scale, zoomContainer, isSelected } = this.props;\n    const relativeEvent = getRelativeMouseEvent(event, zoomContainer);\n    event.preventDefault();\n\n    const targetCell = event.target.closest('td');\n    if (!targetCell) {\n      return;\n    }\n    const resizingRowKey = getRowKey(targetCell, this.rowResizeable);\n    if (!resizingRowKey) {\n      return;\n    }\n    this.resizingRowKey = resizingRowKey;\n    this.resizingRow =\n      this.rowResizeable === 'top'\n        ? targetCell.parentElement.previousElementSibling\n        : targetCell.parentElement;\n\n    const realTableWrapper = ReactDOM.findDOMNode(this.realTableWrapperRef.current) as HTMLElement;\n    const realTableWrapperRect = getBoundingRelativeRect(\n      realTableWrapper,\n      zoomContainer,\n    );\n    const table = ReactDOM.findDOMNode(this.tableRef.current) as HTMLElement;\n    const tableRect = getBoundingRelativeRect(table, zoomContainer);\n\n    this.startTableY = relativeEvent.relativeY - realTableWrapperRect.top;\n\n    const rowResizer = ReactDOM.findDOMNode(\n      this.rowResizerRef.current,\n    ) as HTMLElement;\n    rowResizer.style.display = 'block';\n    rowResizer.style.marginTop = '-1px';\n    const tableWidth = Math.min(tableRect.width, realTableWrapperRect.width);\n    rowResizer.style.width = `${Math.round(\n      (tableWidth + (isSelected ? TOOLBAR_ITEM_SIZE : 0)) / scale,\n    )}px`;\n\n    rowResizer.style.top = `${Math.round(this.startTableY / scale)}px`;\n\n    document.addEventListener('mousemove', this.handleRowResizing);\n    document.addEventListener('mouseup', this.handleRowResizeEnd);\n  };\n\n  handleRowResizing = (event) => {\n    const { scale, zoomContainer } = this.props;\n    const relativeEvent = getRelativeMouseEvent(event, zoomContainer);\n    event.preventDefault();\n\n    const realTableWrapper = ReactDOM.findDOMNode(this.realTableWrapperRef.current) as HTMLElement;\n    const rowResizer = ReactDOM.findDOMNode(\n      this.rowResizerRef.current,\n    ) as HTMLElement;\n\n    // Fix: 找不到节点\n    if (!realTableWrapper || !rowResizer || !this.resizingRow) return;\n\n    const realTableWrapperRect = getBoundingRelativeRect(\n      realTableWrapper,\n      zoomContainer,\n    );\n    const resizingColRectTop = getBoundingRelativeRect(\n      this.resizingRow,\n      zoomContainer,\n    ).top;\n    const validTopLimit = resizingColRectTop + MIN_ROW_HEIGHT * scale;\n    const validClientY = Math.max(validTopLimit, relativeEvent.relativeY);\n    rowResizer.style.top = `${Math.round(\n      (validClientY - realTableWrapperRect.top) / scale,\n    )}px`;\n  };\n\n  handleRowResizeEnd = () => {\n    const { scale } = this.props;\n    const rowResizer = ReactDOM.findDOMNode(\n      this.rowResizerRef.current,\n    ) as HTMLElement;\n    if (!rowResizer) {\n      return;\n    }\n\n    const delta =\n      parseInt(rowResizer.style.top, 10) - Math.round(this.startTableY! / scale);\n    if (!isNaN(delta)) {\n      this.handleRowResize(this.resizingRowKey, delta);\n    }\n\n    document.removeEventListener('mousemove', this.handleRowResizing);\n    document.removeEventListener('mouseup', this.handleRowResizeEnd);\n\n    rowResizer.style.display = 'none';\n    rowResizer.style.top = '';\n\n    this.resizingRowKey = null;\n    this.resizingRow = null;\n    this.startTableY = null;\n  };\n\n  handleRowResize = (resizingRowKey, delta) => {\n    const { controller } = this.props;\n    const tableRow = controller.value.document.getNode(resizingRowKey);\n    // 协同者可能删除 row\n    if (!tableRow) return;\n    const originalHeight = controller.query('getRowsHeight', {\n      node: tableRow,\n    });\n    controller.run(\n      'onAction',\n      setTableRowHeight(tableRow, originalHeight + delta),\n    );\n  };\n\n  handleSelectRow = (\n    selectedRowRange: ISelectedIndexRange,\n    shouldHideContextMenu = true,\n  ) => {\n    const { controller, node } = this.props;\n    // selections不止一个的情况，交给pi处理\n    lastActiveTableKey = node.key;\n    const { start, end } = selectedRowRange;\n    controller.run(\n      'onAction',\n      selectTableRows(node, start, end),\n    );\n    if (shouldHideContextMenu) {\n      this.closeContextMenu();\n    }\n  };\n\n  handleSelectCol = (\n    selectedColRange: ISelectedIndexRange,\n    shouldHideContextMenu = true,\n  ) => {\n    const { controller, node } = this.props;\n    // selections不止一个的情况，交给pi处理\n    lastActiveTableKey = node.key;\n    const { start, end } = selectedColRange;\n    controller.run(\n      'onAction',\n      selectTableCols(node, start, end),\n    );\n    if (shouldHideContextMenu) {\n      this.closeContextMenu();\n    }\n  };\n\n  handleSelectCorner = () => {\n    const { controller, node } = this.props;\n    // selections不止一个的情况，交给pi处理\n    lastActiveTableKey = node.key;\n    controller.run('onAction', selectTable(node));\n    this.closeContextMenu();\n  };\n\n  updateShadowStyleCallback = (visible: boolean) => {\n    if (!visible) return;\n\n    const { scale, zoomContainer, node: dataTable } = this.props;\n    visibleUtil.unregisterVisibleChange(dataTable.key, this.updateShadowStyleCallback);\n    const table = ReactDOM.findDOMNode(this.tableRef.current) as HTMLElement;\n    if (!table) {\n      return;\n    }\n    const tableRect = getBoundingRelativeRect(table, zoomContainer);\n\n    const tableLeftShadow = ReactDOM.findDOMNode(\n      this.tableLeftShadowRef.current,\n    ) as HTMLElement;\n    const tableRightShadow = ReactDOM.findDOMNode(\n      this.tableRightShadowRef.current,\n    ) as HTMLElement;\n\n    const height = `${Math.round(tableRect.height / scale)}px`;\n\n    if (tableLeftShadow) {\n      tableLeftShadow.style.height = height;\n    }\n    if (tableRightShadow) {\n      tableRightShadow.style.height = height;\n    }\n  };\n\n  updateShadowStyle = () => {\n    const { node } = this.props;\n    if (visibleUtil.getVisible(node.key)) {\n      this.updateShadowStyleCallback(true);\n    } else {\n      visibleUtil.unregisterVisibleChange(node.key, this.updateShadowStyleCallback);\n      visibleUtil.registerVisibleChange(node.key, this.updateShadowStyleCallback);\n    }\n  };\n\n  updateScrollLeft = () => {\n    const { node } = this.props;\n    const { percentOfScrollLeft } = node.data || {};\n    const scrollContainer = this.realTableWrapperRef.current;\n    if (!scrollContainer || !this.tableRef.current) {\n      return;\n    }\n    if (typeof percentOfScrollLeft === 'number') {\n      const containerWidth = scrollContainer.offsetWidth;\n      const tableWidth = this.tableRef.current.offsetWidth;\n      const totalScroll = tableWidth - containerWidth;\n      scrollContainer.scrollTo({\n        left: percentOfScrollLeft * totalScroll,\n        behavior: 'smooth',\n      });\n    }\n  };\n\n  updateTableResizeController = () => {\n    const { controller, scale, zoomContainer } = this.props;\n    if (!this.isSelected() || !zoomContainer) {\n      return;\n    }\n    const tableDOM = ReactDOM.findDOMNode(this.tableRef.current) as HTMLElement;\n    const realTableWrapper = ReactDOM.findDOMNode(this.realTableWrapperRef.current) as HTMLElement;\n    const tableResizeController = ReactDOM.findDOMNode(\n      this.tableResizeControllerRef.current,\n    ) as HTMLElement;\n    if (!tableResizeController || !tableDOM || !realTableWrapper) {\n      return;\n    }\n    const tableRect = getBoundingRelativeRect(tableDOM, zoomContainer);\n    const realTableWrapperRect = getBoundingRelativeRect(\n      realTableWrapper,\n      zoomContainer,\n    );\n    if (!controller.query('isTableSupportResize')) {\n      tableResizeController.style.display = 'none';\n      return;\n    }\n    // 可能出现小数的偏差，容错\n    if (tableRect.right <= realTableWrapperRect.right + 1) {\n      tableResizeController.style.display = '';\n      tableResizeController.style.left =\n        `${Math.round((tableRect.right - realTableWrapperRect.left) / scale)}px`;\n      tableResizeController.style.top =\n        `${Math.round((tableRect.bottom - realTableWrapperRect.top) / scale)}px`;\n    } else {\n      tableResizeController.style.display = 'none';\n    }\n  };\n\n  updateOnRender = throttle(() => {\n    this.updateTableResizeController();\n    this.updateShadowStyle();\n  });\n\n  handleTableToolbarContextMenu = (event: React.MouseEvent<HTMLElement>) => {\n    event.preventDefault();\n    const { controller } = this.props;\n    controller.run('onContextMenu', event);\n  };\n\n  handleMenuEvent = (type) => {\n    const { controller, node } = this.props;\n    let selection = this.getTableSelection();\n    if (!selection) {\n      selection = createTableSelectionForFocusedCell(controller.value, node);\n    }\n    if (type === 'delete-table') {\n      controller.run('onAction', deleteTable(node));\n    } else if (type === 'table-width-fit-container') {\n      controller.run('onAction', resizeTableWidthFitContainer(node));\n    }\n  };\n\n  updateShadowState = () => {\n    // 文档模型更新后，DOM 不会立刻更新，所以需要等待 DOM 更新后再计算阴影的状态\n    if (this.updateShadowRafId !== null) {\n      window.cancelAnimationFrame(this.updateShadowRafId);\n    }\n    this.updateShadowRafId = window.requestAnimationFrame(() => {\n      fastdom.measure(() => {\n        const table = ReactDOM.findDOMNode(this.tableRef.current) as HTMLElement;\n        const realTableWrapper = ReactDOM.findDOMNode(\n          this.realTableWrapperRef.current,\n        ) as HTMLElement;\n        if (!table || !realTableWrapper) {\n          return;\n        }\n        const { zoomContainer } = this.props;\n\n        const tableRect = getBoundingRelativeRect(table, zoomContainer);\n\n        const realTableWrapperRect = getBoundingRelativeRect(\n          realTableWrapper,\n          zoomContainer,\n        );\n        const shouldShowTableLeftShadow = realTableWrapper.scrollLeft > 0;\n        const scrollableContentWidth = tableRect.width;\n        const shouldShowTableRightShadow =\n          scrollableContentWidth - realTableWrapper.scrollLeft >\n          realTableWrapperRect.width;\n        const {\n          shouldShowTableLeftShadow: prevLeft,\n          shouldShowTableRightShadow: prevRight,\n        } = this.state;\n        if (\n          prevLeft !== shouldShowTableLeftShadow ||\n          prevRight !== shouldShowTableRightShadow\n        ) {\n          this.setState({ shouldShowTableLeftShadow, shouldShowTableRightShadow });\n        }\n      });\n    });\n  };\n\n  handleTableScroll = throttle(() => {\n    const { controller, node, tableConfig } = this.props;\n    const table = ReactDOM.findDOMNode(this.tableRef.current);\n    if (!table || !this.realTableWrapperRef.current) {\n      return;\n    }\n    controller.run('onAction', scrollTable(this.realTableWrapperRef.current));\n    if (tableConfig?.onScroll) {\n      tableConfig.onScroll(this.realTableWrapperRef.current, node);\n    }\n    this.updateShadowState();\n  });\n\n  getTableSelection = () => {\n    const { controller, node } = this.props;\n    const tblSelections = controller.query(\n      'viewTableSelections',\n    );\n    if (!tblSelections) {\n      return null;\n    }\n    const curTableSelection = tblSelections.find(\n      (ts) => ts.key === node.key,\n    );\n    if (!curTableSelection) {\n      return null;\n    }\n    return curTableSelection;\n  };\n\n  getTableLeftMaxBorder = (table: MoTable) => {\n    return table.nodes.reduce((acc, row: Block) => {\n      if (!row.nodes) {\n        return acc;\n      }\n      const firstCell = row.nodes[0] as Block;\n      if (\n        firstCell &&\n        firstCell.data &&\n        !firstCell.data.hidden &&\n        firstCell.data.bdr &&\n        firstCell.data.bdr.left &&\n        firstCell.data.bdr.left.sz > acc\n      ) {\n        return firstCell.data.bdr.left.sz;\n      }\n      return acc;\n    }, 1);\n  };\n\n  getAllColsNodes = (colsNodes: HTMLDivElement[]) => {\n    this.colsNodes = colsNodes;\n  };\n\n  handleSetIsHighlightSelection = (isHighlight: boolean) => {\n    this.setState({\n      isSelectionHighlight: isHighlight,\n    });\n  };\n\n  handleSetHoverSelection = (sel: ITableSelection | null) => {\n    this.setState({\n      hoverSelection: sel,\n    });\n  };\n\n  isShowCornerToolbar = () => {\n    const { tableConfig } = this.props;\n    return !tableConfig?.hideCornerButton?.();\n  };\n\n  handleMouseEnterTable = () => {\n    // 调整表格宽高时，会频繁触发 mouseenter 和 mouseleave\n    // 所以调整期间不更新 isHoverTable\n    if (this.isResizingTable) return;\n\n    this.setState({\n      isHoverTable: true,\n    });\n  };\n\n  handleMouseLeaveTable = () => {\n    if (this.isResizingTable) return;\n\n    this.setState({\n      isHoverTable: false,\n    });\n  };\n\n  setWholeTableHoverSelection = () => {\n    const cols = this.props.node.data?.colsWidth?.length;\n    const rows = this.props.node?.nodes.length;\n    if (!cols || !rows) {\n      this.handleSetHoverSelection(null);\n      return;\n    }\n    this.handleSetHoverSelection({\n      key: this.props.node.key,\n      endColIndex: cols - 1,\n      endRowIndex: rows - 1,\n      startColIndex: 0,\n      startRowIndex: 0,\n    });\n  };\n\n  removeWholeTableHoverSelection = () => {\n    this.handleSetHoverSelection(null);\n  };\n\n\n  handleMouseEnterCornerToolbar = () => {\n    this.setWholeTableHoverSelection();\n    this.setState({\n      isHoverCornerToolbar: true,\n    });\n  };\n\n  handleMouseLeaveCornerToolbar = () => {\n    this.removeWholeTableHoverSelection();\n    this.setState({\n      isHoverCornerToolbar: false,\n    });\n  };\n\n  render() {\n    const {\n      controller,\n      node,\n      children,\n      locale,\n      scale = 1,\n      zoomContainer,\n      scrollableContainer,\n      tableConfig = {},\n      draggableConfig,\n      visible,\n    } = this.props;\n\n    const {\n      hideDeleteButton = false,\n      hideWidthFitButton = false,\n      enableAutofitWidth,\n      enableHeader,\n      setTableHeaderStyle,\n    } = tableConfig;\n\n    const {\n      shouldShowTableLeftShadow,\n      shouldShowTableRightShadow,\n      isSelectionHighlight,\n      hoverSelection,\n      isHoverCornerToolbar,\n    } = this.state;\n\n    const leftOffset = Math.floor(this.getTableLeftMaxBorder(node) / 2);\n\n    const isSelected = this.isSelected();\n    const isSelectWholeTable = controller.query('isSelectWholeTable', {\n      node,\n    });\n\n    const isHideDeleteButton = typeof hideDeleteButton === 'function'\n      ? hideDeleteButton() : hideDeleteButton;\n\n    const style: React.CSSProperties = {};\n\n    if (visible === false) {\n      style.display = 'none';\n    }\n\n    return (\n      <Wrapper\n        ref={this.wrapperRef}\n        onClick={() => {\n          // onClick 多覆盖了悬浮工具栏onMouseDown被拦截的情况\n          lastActiveTableKey = node.key;\n        }}\n        onMouseDown={this.handleMouseDown}\n        onMouseEnter={this.handleMouseEnterTable}\n        onMouseLeave={this.handleMouseLeaveTable}\n        style={style}\n        data-type=\"table\"\n      >\n        <TableIsSelectedContext.Provider value={isSelected}>\n          <TableScrollContainer\n            className=\"real-table-wrapper\"\n            table={node}\n            controller={controller}\n            ref={this.realTableWrapperRef}\n            onMouseEnter={this.handleMouseEnter}\n            onMouseMove={this.handleMouseMove}\n            onScroll={this.handleTableScroll}\n            disableHorizontalScrollbar={tableConfig?.disableHorizontalScrollbar}\n            // note: 解决左border因滚动表格overflow auto被遮挡的问题\n            style={{\n              marginLeft: -leftOffset,\n              paddingLeft: leftOffset,\n              // 设置 paddingTop、marginTop 保证列工具栏「点」不会被 overflow hidden\n              paddingTop: REALTABLE_PADDING.top / scale,\n              marginTop: -REALTABLE_PADDING.top / scale,\n              paddingBottom: REALTABLE_PADDING.bottom, // 由于选中后表格边框有1px边距，因此不加bottom会产生滚动条\n            }}\n          >\n            <TableColToolbar\n              locale={locale}\n              controller={controller}\n              table={node}\n              tableRef={this.tableRef}\n              positionedAncestorRef={this.realTableWrapperRef}\n              scrollContainer={this.realTableWrapperRef}\n              colIndicatorRef={this.colIndicatorRef}\n              isTableSelected={isSelected}\n              onContextMenu={this.handleTableToolbarContextMenu}\n              onSelect={this.handleSelectCol}\n              onColResize={this.handleColResize}\n              onGetAllColsNodes={this.getAllColsNodes}\n              zoomContainer={zoomContainer}\n              getLastActiveTableKey={getLastActiveTableKey}\n              scale={scale}\n              setIsHighlightSelection={this.handleSetIsHighlightSelection}\n              hoverSelection={hoverSelection}\n              setHoverSelection={this.handleSetHoverSelection}\n              isHideDeleteButton={isHideDeleteButton}\n              isHoverCornerToolbar={isHoverCornerToolbar}\n            />\n            <TableWithSelection\n              ref={this.tableRef}\n              node={node}\n              controller={controller}\n              left={-leftOffset}\n              scale={scale}\n              tableSelection={this.getTableSelection()}\n              getTableSelection={this.getTableSelection}\n              hoverSelection={hoverSelection}\n              isSelectionHighlight={isSelectionHighlight}\n            >{children()}\n            </TableWithSelection>\n          </TableScrollContainer>\n          <TableResizeController\n            visible={isSelected}\n            onMouseDown={this.handleTableResizeStart}\n            ref={{\n              // @ts-ignore\n              tableResizeControllerRef: this.tableResizeControllerRef,\n              tableResizeControlLinesRef: this.tableResizeControlLinesRef,\n            }}\n          />\n          <ColResizer\n            ref={this.colResizerRef}\n          />\n          <RowResizer\n            ref={this.rowResizerRef}\n            style={{ left: isSelected ? -TOOLBAR_ITEM_SIZE / scale! : 0 }}\n          />\n          <ColIndicator\n            ref={this.colIndicatorRef}\n            isTableSelected={isSelected}\n            data-testid=\"table-col-indicator\"\n            scale={scale}\n          />\n          <RowIndicator\n            ref={this.rowIndicatorRef}\n            isTableSelected={isSelected}\n            data-testid=\"table-row-indicator\"\n          />\n          <TableLeftSideShadow\n            ref={this.tableLeftShadowRef}\n            scale={scale}\n            style={{\n              display: shouldShowTableLeftShadow ? 'block' : 'none',\n            }}\n          />\n          <TableRightSideShadow\n            ref={this.tableRightShadowRef}\n            scale={scale}\n            style={{\n              display: shouldShowTableRightShadow ? 'block' : 'none',\n            }}\n          />\n          <TableRowToolbar\n            locale={locale}\n            isSelected={isSelected}\n            controller={controller}\n            table={node}\n            tableRef={this.tableRef}\n            offsetParentRef={this.wrapperRef}\n            realTableWrapperRef={this.realTableWrapperRef}\n            rowIndicatorRef={this.rowIndicatorRef}\n            isSelectWholeTable={isSelectWholeTable}\n            onContextMenu={this.handleTableToolbarContextMenu}\n            onSelect={this.handleSelectRow}\n            onRowResize={this.handleRowResize}\n            zoomContainer={zoomContainer}\n            getLastActiveTableKey={getLastActiveTableKey}\n            scale={scale}\n            setIsHighlightSelection={this.handleSetIsHighlightSelection}\n            setHoverSelection={this.handleSetHoverSelection}\n            hoverSelection={hoverSelection}\n            scrollableContainer={scrollableContainer}\n            isHideDeleteButton={isHideDeleteButton}\n            isHoverCornerToolbar={isHoverCornerToolbar}\n          />\n          {this.isShowCornerToolbar() && (\n            <TableCornerToolbar\n              locale={locale}\n              visible={this.isSelected() || this.state.isHoverTable}\n              controller={controller}\n              realTableWrapperRef={this.realTableWrapperRef}\n              table={node}\n              isSelectWholeTable={!!isSelectWholeTable}\n              onSelect={this.handleSelectCorner}\n              onMouseEnter={this.handleMouseEnterCornerToolbar}\n              onMouseLeave={this.handleMouseLeaveCornerToolbar}\n              onToolbarEvent={this.handleMenuEvent}\n              zoomContainer={zoomContainer}\n              getLastActiveTableKey={getLastActiveTableKey}\n              scale={scale!}\n              setIsHighlightSelection={this.handleSetIsHighlightSelection}\n              hideWidthFitButton={hideWidthFitButton}\n              draggableConfig={draggableConfig}\n              enableAutofitWidth={enableAutofitWidth}\n              enableHeader={enableHeader}\n              setTableHeaderStyle={setTableHeaderStyle}\n            />\n          )}\n          <CornerButton\n            scale={scale!}\n            isSelected={isSelected}\n            onClick={this.handleSelectCorner}\n            active={isSelectWholeTable || isHoverCornerToolbar}\n            onMouseEnter={this.handleMouseEnterCornerToolbar}\n            onMouseLeave={this.handleMouseLeaveCornerToolbar}\n            hoverSelection={!!hoverSelection}\n          />\n        </TableIsSelectedContext.Provider>\n      </Wrapper>\n    );\n  }\n}\n\nconst Container: React.FC<Omit<TableProps, 'colsWidth' | 'scale' | 'zoomContainer'>> = (props) => {\n  const scrollableContainer = useScrollableContainer();\n  const zoomContainer = useZoomContainer() || window.document.body;\n  const scale = useZoom();\n  const { controller, node, visible } = props;\n\n  const [pendingSelectedWhole, setPendingSelectedWhole] = React.useState<boolean>(false);\n\n  // 当仓颉pendingEnable开启的时候通过监听selectionData$的变化来实时确定是否需要更新table\n  // 避免等待500ms的防抖延时后再更新\n  // pendingEnable为false的情况下，useSelectionStatus注册的回调函数不会执行，因为此时渲染更新是实时的\n  const [realSelected, setRealSelected] = React.useState<boolean>(false);\n  const [, forceUpdate] = React.useReducer((c) => !c, false);\n\n  React.useEffect(() => {\n    const newTable = controller.value.document.getNode(node.key) as MoTable;\n    if (!newTable) return;\n    setRealSelected(getTableIsSelected(newTable, controller));\n  }, [node, controller.value.selection, controller]);\n\n  const shouldUpdateTable = React.useCallback(({ isPendingSelected, isSelectWholeTable }) => {\n    setRealSelected(isPendingSelected);\n    setPendingSelectedWhole(isSelectWholeTable);\n    if (controller.hasHots()) {\n      forceUpdate();\n    }\n  }, [controller, node]);\n\n  useSelectionStatus(controller, node, shouldUpdateTable, []);\n\n  React.useEffect(() => {\n    controller.run('onAction', adjustColsWidth(node));\n  });\n\n  const memoProps = React.useMemo(() => {\n    return { ...props, isSelected: realSelected, isSelectWholeTable: pendingSelectedWhole };\n  }, [props, realSelected, pendingSelectedWhole]);\n\n  return (\n    <ContextContainer isSelected={realSelected}>\n      <PixelColsWidthContext.Consumer>\n        {([pixelColsWidth]) => (<Table\n          {...memoProps}\n          scrollableContainer={scrollableContainer}\n          zoomContainer={zoomContainer}\n          scale={scale || 1}\n          colsWidth={pixelColsWidth}\n          visible={visible}\n        />)}\n      </PixelColsWidthContext.Consumer>\n    </ContextContainer>\n  );\n};\n\nexport default (props: Omit<TableProps, 'colsWidth' | 'scale' | 'zoomContainer'>) => {\n  const { controller, node, tableConfig = {} } = props;\n  const { enableHeaderSticky } = tableConfig;\n\n  return (\n    <TableContextContainer\n      controller={controller}\n      table={node}\n      enableHeaderSticky={enableHeaderSticky}\n    >\n      <Container {...props} />\n    </TableContextContainer>\n  );\n};\n"],"file":"table.js"}