{"version":3,"sources":["../../../../../src/bi/components/colToolbar/index.tsx"],"names":["React","ReactDOM","styled","throttle","fastdom","domUtils","Table","getBoundingRelativeRect","getRelativeMouseEvent","DISTANCE_BETWEEN_DELETE_BUTTON_AND_TOOLBAR","DISTANCE_BETWEEN_INSERT_BUTTON_AND_TOOLBAR","DRAG_TRIGGER_TIME","MIN_COL_WIDTH","THEME","TOOLBAR_ITEM_SIZE","TableColToolbarItem","ColResizer","clickTableToolbar","deleteTableCols","insertTableCol","moveTableCols","InlineToolbarInsertButton","InlineToolbarDeleteButton","InsertButtonIndicator","GAP_BEWTEEN_INDICATOR_TOOLBAR","INDICATOR_WRAPPER_WIDTH","DragElement","scrollHorizontal","createToolbarWithTableSeletion","getDataTableSelectionByTable","REALTABLE_PADDING","SCROLL_BAR_HEIGHT","STICKY_ROW_TOP_HEIGHT","STICKY_TOOLBAR_INDEX_MAP","hooks","usePixelColsWidth","useRowIsSticky","useScrollableContainerRect","useTableScrollContainerWidth","useTableScrollContainerScrollLeft","fallbackRect","left","top","right","bottom","height","width","Wrapper","div","colToolbar","ColToolbarWrapper","ColToolbarResizer","props","scale","blue3","ColInlineToolbar","TableColToolbar","table","controller","tableRef","positionedAncestorRef","scrollContainer","zoomContainer","colIndicatorRef","isTableSelected","selection","locale","isHideDeleteButton","isHoverCornerToolbar","getLastActiveTableKey","onContextMenu","onSelect","onColResize","onGetAllColsNodes","setIsHighlightSelection","hoverSelection","setHoverSelection","colsWidth","isSticky","isColumnHeader","useState","contextMenuVisible","setContextMenuVisible","positionOfInsertButton","setPositionOfInsertButton","isHoverDelete","setIsHoverDelete","colIndex","colResizerHeight","resizingColData","setResizingColData","hoverToolbarItemIndex","setHoverToolbarItemIndex","isDragging","setIsDragging","draggingColWidth","setDraggingColWidth","colToolbarRef","useRef","toolbarWrapperRef","resizingColDataRef","colSelectionRectRef","insetBtnPosRef","draggingColResizerRef","startClientXRef","startPositionLeftRef","originBodyCursorRef","deleteButtonRef","insertButtonRef","colsNodes","deleteButtonLeftRef","dragElementRef","startSelectIndexRef","getAllColsNodes","useCallback","current","getColsRects","map","node","rect","getBoundingClientRect","isSelectWholeCol","query","getColItemRect","index","thisNode","findDOMNode","colNode","children","colRect","getSelectedIndexRange","tableSelection","isSelectWholeTable","startColIndex","endColIndex","nodes","start","end","getSortedSelectedRange","r","selectedIndexRange","range","min","Math","max","getColToolbarTop","thisRect","shouldHideButton","relativeLeft","undefined","tableRect","calcColsWidth","startIndex","endIndex","Array","isArray","slice","reduce","acc","w","updateInsertButtonStyle","toolbarRect","insertButtonNode","insertButtonRect","result","insertButtonLeft","curTop","abs","offsetHeight","style","shouldHide","visibility","setRectStyle","bgColor","borderColr","border","borderBottom","length","borderTopRightRadius","backgroundColor","updateColSelectionRectStyle","data","colSelectionNode","red1","blue1","borderColor","toolbarBgColor","hover","toolbarBorderColor","setItemsRectStyleByRange","useEffect","colsCount","updateIndicatorStyle","trueTableDOM","trueTableRect","round","handleColResizing","event","preventDefault","relativeEvent","colToolbarItem","previousElementSibling","colToolbarNextItem","nextElementSibling","colToolbarItemRect","validClientX","relativeX","getAttribute","colToolbarNextItemRect","startClientX","delta","hideContextMenu","document","removeEventListener","handleColResizeEnd","parseInt","resizingColIndex","body","cursor","handleColResizeStart","target","setProperty","addEventListener","handlePreventDefault","stopPropagation","handleContextMenu","isResizingCol","handleMouseEnterColToolbarItem","isNaN","tableRows","key","startRowIndex","endRowIndex","handleMouseOutColToolbarItem","handleMouseOver","e","clientX","scrollRect","horizontalPadding","colsRect","findIndex","handleMouseOut","insertButton","contains","selectCols","shouldHideContextMenu","shouldEnableEndDrag","insertIndex","colsLength","maxRowIndex","leftColSelection","handleMultiSelectCol","buttons","removeMultiSelectListener","colToolbarX","offsetX","endSelectedIndex","i","showIndicatorVisible","isVisible","opacity","setInsertButtonPos","addMultiSelectListener","moveColToIndex","originIndexRange","targetIndex","run","updateDragElementPosition","x","y","isShowColToolbar","updateDraggingStyle","clientY","relativeY","tableDOM","colsRects","sortRange","shouldDragEnd","handleDragEnd","handleDragging","findDOMNodeSafely","handleDragStart","selectedIndex","enableDragIcon","Boolean","handleSelectCol","shiftKey","timer","isRightClick","clearTimer","clearTimeout","removeCancelDragEventListener","window","setTimeout","removeDragEventListener","handleColRectUpdate","isDelete","splice","insertCol","colWidth","deleteCol","highlightSelection","cancelHighlightSelection","renderColToolbarItems","useMemo","indexRange","deleteRange","selectRanges","push","activeRange","forEach","resizerLeft","translateY","translateX","isLastItem","alignItems","transform","justifyContent","isShowButton","isShowDelete","handleMouseMove","sortedRange","leading","updateDeleteButtonStyle","menuNode","menuRect","startColRect","endColRect","mid","containerLeft","useLayoutEffect","measure","borderRadius","containerWidth","tableScrollLeft","scrollLeft","isShowInsertButton","tableHeight","showInsert","wrapperStyle","pointerEvents","background","Number","isFinite","display","createPortal","transition"],"mappings":";;AAAA;;AACA;;AACA;AACA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;qBAF4B,a;AAG5B,OAAO,KAAKC,QAAZ,MAA0B,WAA1B;AACA,OAAOC,MAAP,MAAmB,mBAAnB;AACA,SAASC,QAAT,QAAyB,WAAzB;AACA,OAAOC,OAAP,MAAoB,SAApB;AACA,SAASC,QAAT,QAAyB,oBAAzB;AACA,OAAOC,KAAP;AACA,SACEC,uBADF,EAEEC,qBAFF,QAGO,kBAHP;AAIA,SACEC,0CADF,EAEEC,0CAFF,EAGEC,iBAHF,EAIEC,aAJF,EAKEC,KALF,EAMEC,iBANF;AAQA,SAASC,mBAAT;AACA,SAASC,UAAT;AAEA,SACEC,iBADF,EAEEC,eAFF,EAGEC,cAHF,EAIEC,aAJF;AAMA,OAAOC,yBAAP;AACA,OAAOC,yBAAP;AACA,OAAOC,qBAAP,IACEC,6BADF,EAEEC,uBAFF;AAIA,OAAOC,WAAP;AACA,SAASC,gBAAT;AACA,OAAOC,8BAAP;AAEA,OAAOC,4BAAP;AACA,SACEC,iBADF,EAEEC,iBAFF,EAGEC,qBAHF,EAIEC,wBAJF;AAMA,OAAO,KAAKC,KAAZ;IAGEC,iB,GAKED,K,CALFC,iB;IACAC,c,GAIEF,K,CAJFE,c;IACAC,0B,GAGEH,K,CAHFG,0B;IACAC,4B,GAEEJ,K,CAFFI,4B;IACAC,iC,GACEL,K,CADFK,iC;AAGF,IAAMC,YAAY,GAAG;AACnBC,EAAAA,IAAI,EAAE,CAAC,CADY;AAEnBC,EAAAA,GAAG,EAAE,CAAC,CAFa;AAGnBC,EAAAA,KAAK,EAAE,CAAC,CAHW;AAInBC,EAAAA,MAAM,EAAE,CAAC,CAJU;AAKnBC,EAAAA,MAAM,EAAE,CAAC,CALU;AAMnBC,EAAAA,KAAK,EAAE,CAAC;AANW,CAArB;AASA,IAAMC,OAAO,gBAAG7C,MAAM,CAAC8C,GAAV,gMAMChB,qBAND,EAQEC,wBAAwB,CAACgB,UAR3B,CAAb;AAiBA,IAAMC,iBAAiB,gBAAGhD,MAAM,CAAC8C,GAAV,kCAAvB;AAKA,IAAMG,iBAAiB,gBAAGjD,MAAM,CAAC8C,GAAV,gKAIX,UAACI,KAAD;AAAA,SAAatC,iBAAD,GAAsBsC,KAAK,CAACC,KAAxC;AAAA,CAJW,EAWCxC,KAAK,CAACyC,KAXP,CAAvB;AAeA,IAAMC,gBAAgB,gBAAGrD,MAAM,CAAC8C,GAAV,yEAAtB;;AAaA,SAASQ,eAAT,CAAyBJ,KAAzB,EAAsD;AAAA;;AAAA,MAElDK,KAFkD,GAuBhDL,KAvBgD,CAElDK,KAFkD;AAAA,MAGlDC,UAHkD,GAuBhDN,KAvBgD,CAGlDM,UAHkD;AAAA,MAIlDC,QAJkD,GAuBhDP,KAvBgD,CAIlDO,QAJkD;AAAA,MAKlDC,qBALkD,GAuBhDR,KAvBgD,CAKlDQ,qBALkD;AAAA,MAMlDC,eANkD,GAuBhDT,KAvBgD,CAMlDS,eANkD;AAAA,MAOlDC,aAPkD,GAuBhDV,KAvBgD,CAOlDU,aAPkD;AAAA,MAQlDC,eARkD,GAuBhDX,KAvBgD,CAQlDW,eARkD;AAAA,MASlDC,eATkD,GAuBhDZ,KAvBgD,CASlDY,eATkD;AAAA,MAUlDC,SAVkD,GAuBhDb,KAvBgD,CAUlDa,SAVkD;AAAA,MAWlDZ,KAXkD,GAuBhDD,KAvBgD,CAWlDC,KAXkD;AAAA,MAYlDa,MAZkD,GAuBhDd,KAvBgD,CAYlDc,MAZkD;AAAA,MAalDC,kBAbkD,GAuBhDf,KAvBgD,CAalDe,kBAbkD;AAAA,MAclDC,oBAdkD,GAuBhDhB,KAvBgD,CAclDgB,oBAdkD;AAAA,MAelDC,qBAfkD,GAuBhDjB,KAvBgD,CAelDiB,qBAfkD;AAAA,MAgBlDC,aAhBkD,GAuBhDlB,KAvBgD,CAgBlDkB,aAhBkD;AAAA,MAiBlDC,QAjBkD,GAuBhDnB,KAvBgD,CAiBlDmB,QAjBkD;AAAA,MAkBlDC,WAlBkD,GAuBhDpB,KAvBgD,CAkBlDoB,WAlBkD;AAAA,MAmBlDC,iBAnBkD,GAuBhDrB,KAvBgD,CAmBlDqB,iBAnBkD;AAAA,MAoBlDC,uBApBkD,GAuBhDtB,KAvBgD,CAoBlDsB,uBApBkD;AAAA,MAqBlDC,cArBkD,GAuBhDvB,KAvBgD,CAqBlDuB,cArBkD;AAAA,MAsBlDC,iBAtBkD,GAuBhDxB,KAvBgD,CAsBlDwB,iBAtBkD;;AAAA,2BAyBhCzC,iBAAiB,EAzBe;AAAA,MAyB7C0C,SAzB6C;;AAAA,wBA0BjCzC,cAAc,EA1BmB;AAAA,MA0B7C0C,QA1B6C;;AA2BpD,MAAMC,cAAc,GAAGzE,KAAK,CAACyE,cAAN,CAAqBtB,KAArB,CAAvB;;AA3BoD,wBA6BAzD,KAAK,CAACgF,QAAN,CAAwB,KAAxB,CA7BA;AAAA,MA6B7CC,kBA7B6C;AAAA,MA6BzBC,qBA7ByB;;AAAA,yBA8BQlF,KAAK,CAACgF,QAAN,CAAuB,CAAC,CAAxB,CA9BR;AAAA,MA8B7CG,sBA9B6C;AAAA,MA8BrBC,yBA9BqB;;AAAA,yBA+BVpF,KAAK,CAACgF,QAAN,CAAwB,KAAxB,CA/BU;AAAA,MA+B7CK,aA/B6C;AAAA,MA+B9BC,gBA/B8B;;AAAA,yBAgCNtF,KAAK,CAACgF,QAAN,CAAgC;AAAEO,IAAAA,QAAQ,EAAE,CAAC,CAAb;AAAgB9C,IAAAA,IAAI,EAAE,CAAtB;AAAyBC,IAAAA,GAAG,EAAE,CAA9B;AAAiC8C,IAAAA,gBAAgB,EAAE;AAAnD,GAAhC,CAhCM;AAAA,MAgC7CC,eAhC6C;AAAA,MAgC5BC,kBAhC4B;;AAAA,yBAiCM1F,KAAK,CAACgF,QAAN,CAAuB,CAAC,CAAxB,CAjCN;AAAA,MAiC7CW,qBAjC6C;AAAA,MAiCtBC,wBAjCsB;;AAAA,yBAkChB5F,KAAK,CAACgF,QAAN,CAAwB,KAAxB,CAlCgB;AAAA,MAkC7Ca,UAlC6C;AAAA,MAkCjCC,aAlCiC;;AAAA,yBAmCJ9F,KAAK,CAACgF,QAAN,CAAuB,CAAvB,CAnCI;AAAA,MAmC7Ce,gBAnC6C;AAAA,MAmC3BC,mBAnC2B;;AAqCpD,MAAMC,aAAa,GAAGjG,KAAK,CAACkG,MAAN,CAA6B,IAA7B,CAAtB;AAEA,MAAMC,iBAAiB,GAAGnG,KAAK,CAACkG,MAAN,CAA6B,IAA7B,CAA1B;AAEA,MAAME,kBAAkB,GAAGpG,KAAK,CAACkG,MAAN,CAA8B;AAAEX,IAAAA,QAAQ,EAAE,CAAC,CAAb;AAAgB9C,IAAAA,IAAI,EAAE,CAAtB;AAAyBC,IAAAA,GAAG,EAAE,CAA9B;AAAiC8C,IAAAA,gBAAgB,EAAE;AAAnD,GAA9B,CAA3B;AAEA,MAAMa,mBAAmB,GAAGrG,KAAK,CAACkG,MAAN,CAA6B,IAA7B,CAA5B;AAEA,MAAMI,cAAc,GAAGtG,KAAK,CAACkG,MAAN,CAAqB,CAAC,CAAtB,CAAvB;AAEA,MAAMK,qBAAqB,GAAGvG,KAAK,CAACkG,MAAN,CAAoC,IAApC,CAA9B;AAEA,MAAMM,eAAe,GAAGxG,KAAK,CAACkG,MAAN,CAA4B,IAA5B,CAAxB;AAEA,MAAMO,oBAAoB,GAAGzG,KAAK,CAACkG,MAAN,CAAqB,CAArB,CAA7B;AAEA,MAAMQ,mBAAmB,GAAG1G,KAAK,CAACkG,MAAN,CAAqB,EAArB,CAA5B;AAEA,MAAMS,eAAe,GAAG3G,KAAK,CAACkG,MAAN,CAA6B,IAA7B,CAAxB;AAEA,MAAMU,eAAe,GAAG5G,KAAK,CAACkG,MAAN,CAA6B,IAA7B,CAAxB;AAEA,MAAMW,SAAS,GAAG7G,KAAK,CAACkG,MAAN,CAA+B,EAA/B,CAAlB;AAEA,MAAMY,mBAAmB,GAAG9G,KAAK,CAACkG,MAAN,CAAqB,CAAC,CAAtB,CAA5B;AAEA,MAAMa,cAAc,GAAG/G,KAAK,CAACkG,MAAN,CAA6B,IAA7B,CAAvB;AAEA,MAAMc,mBAAmB,GAAGhH,KAAK,CAACkG,MAAN,CAAqB,CAAC,CAAtB,CAA5B;AAEA,MAAMe,eAAe,GAAGjH,KAAK,CAACkH,WAAN,CAAkB,YAAM;AAC9C,WAAOL,SAAS,CAACM,OAAjB;AACD,GAFuB,EAErB,EAFqB,CAAxB;AAIA,MAAMC,YAAY,GAAGpH,KAAK,CAACkH,WAAN,CAAkB,YAAM;AAC3C,WAAOD,eAAe,GAAGI,GAAlB,CACL,UAACC,IAAD,EAAU;AACR,UAAMC,IAAI,GAAGD,IAAI,CAACE,qBAAL,EAAb;AACA,aAAOD,IAAI,IAAI/E,YAAf;AACD,KAJI,CAAP;AAMD,GAPoB,EAOlB,CAACyE,eAAD,CAPkB,CAArB;AASA,MAAMQ,gBAAgB,GAAGzH,KAAK,CAACkH,WAAN,CAAkB,YAAM;AAC/C,WAAOxD,UAAU,CAACgE,KAAX,CAAiB,kBAAjB,EAAqC;AAC1CJ,MAAAA,IAAI,EAAE7D;AADoC,KAArC,CAAP;AAGD,GAJwB,EAItB,CAACC,UAAD,EAAaD,KAAb,CAJsB,CAAzB;AAMA,MAAMkE,cAAc,GAAG3H,KAAK,CAACkH,WAAN,CAAkB,UAACU,KAAD,EAAmC;AAC1E,QAAMC,QAAQ,GAAG5H,QAAQ,CAAC6H,WAAT,CAAqB7B,aAAa,CAACkB,OAAnC,CAAjB;AACA,QAAMY,OAAO,GAAGF,QAAQ,CAACG,QAAT,CAAkBJ,KAAK,GAAG,CAA1B,CAAhB;;AACA,QAAI,CAACG,OAAL,EAAc;AACZ,aAAO,IAAP;AACD;;AACD,QAAME,OAAO,GAAG1H,uBAAuB,CAACwH,OAAD,EAAUjE,aAAV,CAAvC;AACA,WAAOmE,OAAP;AACD,GARsB,EAQpB,CAACnE,aAAD,CARoB,CAAvB;AAWA,MAAMoE,qBAAqB,GAAGlI,KAAK,CAACkH,WAAN,CAAkB,YAAM;AACpD,QAAI,CAACjD,SAAL,EAAgB;AACd,aAAO,IAAP;AACD;;AACD,QAAMkE,cAAc,GAAGtG,4BAA4B,CAAC6B,UAAD,EAAaD,KAAb,CAAnD;;AAEA,QAAI,CAAC0E,cAAL,EAAqB;AACnB,aAAO,IAAP;AACD;;AACD,QAAMC,kBAAkB,GAAG1E,UAAU,CAACgE,KAAX,CAAiB,oBAAjB,EAAuC;AAChEJ,MAAAA,IAAI,EAAE7D;AAD0D,KAAvC,CAA3B;;AAGA,QAAI2E,kBAAJ,EAAwB;AACtB,aAAO,IAAP;AACD;;AAdmD,eAmBhDD,cAnBgD;AAAA,QAiBlDE,aAjBkD,QAiBlDA,aAjBkD;AAAA,QAkBlDC,WAlBkD,QAkBlDA,WAlBkD;;AAoBpD,QAAI,CAAC7E,KAAK,CAAC8E,KAAX,EAAkB;AAChB,aAAO,IAAP;AACD;;AACD,QAAId,gBAAgB,EAApB,EAAwB;AACtB,aAAO;AACLe,QAAAA,KAAK,EAAEH,aADF;AAELI,QAAAA,GAAG,EAAEH;AAFA,OAAP;AAID;;AACD,WAAO,IAAP;AACD,GA9B6B,EA8B3B,CAAC5E,UAAD,EAAaD,KAAb,EAAoBQ,SAApB,EAA+BwD,gBAA/B,CA9B2B,CAA9B;AAgCA,MAAMiB,sBAAsB,GAAG1I,KAAK,CAACkH,WAAN,CAAkB,UAACyB,CAAD,EAA6B;AAC5E,QAAMC,kBAAkB,GAAGV,qBAAqB,EAAhD;AACA,QAAMW,KAAK,GAAGF,CAAC,IAAIC,kBAAnB;;AACA,QAAI,CAACC,KAAL,EAAY;AACV,aAAO,IAAP;AACD;;AAL2E,QAMpEL,KANoE,GAMrDK,KANqD,CAMpEL,KANoE;AAAA,QAM7DC,GAN6D,GAMrDI,KANqD,CAM7DJ,GAN6D;AAO5E,QAAMK,GAAG,GAAGC,IAAI,CAACD,GAAL,CAASN,KAAT,EAAgBC,GAAhB,CAAZ;AACA,QAAMO,GAAG,GAAGD,IAAI,CAACC,GAAL,CAASR,KAAT,EAAgBC,GAAhB,CAAZ;AACA,WAAO;AACLK,MAAAA,GAAG,EAAHA,GADK;AAELE,MAAAA,GAAG,EAAHA;AAFK,KAAP;AAID,GAb8B,EAa5B,CAACd,qBAAD,CAb4B,CAA/B;AAeA,MAAMe,gBAAgB,GAAGjJ,KAAK,CAACkH,WAAN,CAAkB,YAAM;AAC/C,QAAI,CAACjD,SAAL,EAAgB;AACd,aAAO,IAAP;AACD;;AACD,QAAM4D,QAAQ,GAAG5H,QAAQ,CAAC6H,WAAT,CAAqB7B,aAAa,CAACkB,OAAnC,CAAjB;AACA,QAAM+B,QAAQ,GAAG3I,uBAAuB,CAACsH,QAAD,EAAW/D,aAAX,CAAxC;AAEA,WAAO;AACLpB,MAAAA,GAAG,EAAEwG,QAAQ,CAACxG;AADT,KAAP;AAGD,GAVwB,EAUtB,CAACuB,SAAD,EAAYH,aAAZ,CAVsB,CAAzB;AAYA,MAAMqF,gBAAgB,GAAGnJ,KAAK,CAACkH,WAAN,CAAkB,UAACkC,YAAD,EAA0B;AACnE,QAAMvB,QAAQ,GAAG5H,QAAQ,CAAC6H,WAAT,CAAqB7B,aAAa,CAACkB,OAAnC,CAAjB;;AACA,QAAI,CAACU,QAAD,IAAa,CAAChE,eAAe,CAACsD,OAAlC,EAA2C;AACzC,aAAOkC,SAAP;AACD;;AACD,QAAMC,SAAS,GAAG/I,uBAAuB,CAACsD,eAAe,CAACsD,OAAjB,EAA0BrD,aAA1B,CAAzC;AACA,WAAOsF,YAAY,GAAG,CAAC,EAAhB,IACLA,YAAY,GAAGE,SAAS,CAAC3G,KAAzB,GAAiC,CADnC;AAED,GARwB,EAQtB,CAACmB,aAAD,EAAgBD,eAAhB,CARsB,CAAzB;AAUA,MAAM0F,aAAa,GAAGvJ,KAAK,CAACkH,WAAN,CAAkB,UAACsC,UAAD,EAAqBC,QAArB,EAA0C;AAChF,QAAI,CAACC,KAAK,CAACC,OAAN,CAAc9E,SAAd,CAAL,EAA+B;AAC7B,aAAO,CAAP;AACD;;AAED,QAAI4E,QAAQ,GAAGD,UAAf,EAA2B,OAAO,CAAP;AAE3B,WAAO3E,SAAS,CACb+E,KADI,CACEJ,UADF,EACcC,QAAQ,GAAG,CADzB,EAEJI,MAFI,CAEG,UAACC,GAAD,EAAMC,CAAN,EAAY;AAClB,aAAOD,GAAG,GAAGC,CAAb;AACD,KAJI,EAIF,CAJE,CAAP;AAKD,GAZqB,EAYnB,CAAClF,SAAD,CAZmB,CAAtB,CAtKoD,CAoLpD;;AACA,MAAMmF,uBAAuB,GAAGhK,KAAK,CAACkH,WAAN,CAAkB,YAAM;AACtD,QACE,CAACjD,SAAD,IACGkB,sBAAsB,KAAK,CAAC,CAD/B,IAEG,CAACgB,iBAAiB,CAACgB,OAFtB,IAGGhC,sBAAsB,KAAK,CAAC,CAH/B,IAIG,CAACuE,KAAK,CAACC,OAAN,CAAc9E,SAAd,CALN,EAME;AACA;AACD;;AAED,QAAIuE,YAAY,GAAG,CAAC,CAApB;AACA,QAAMa,WAAW,GAAG1J,uBAAuB,CAAC4F,iBAAiB,CAACgB,OAAnB,EAA4BrD,aAA5B,CAA3C;AAEA,QAAMoG,gBAAgB,GAAGjK,QAAQ,CAAC6H,WAAT,CAAqBlB,eAAe,CAACO,OAArC,CAAzB;;AACA,QAAI,CAAC+C,gBAAL,EAAuB;AACrB;AACD;;AACD,QAAMC,gBAAgB,GAAG5J,uBAAuB,CAAC2J,gBAAD,EAAmBpG,aAAnB,CAAhD;AAEAsF,IAAAA,YAAY,GAAGG,aAAa,CAAC,CAAD,EAAIpE,sBAAsB,GAAG,CAA7B,CAAb,GAA+C8E,WAAW,CAACxH,IAA1E;AACA2G,IAAAA,YAAY,IAAIe,gBAAgB,CAACrH,KAAjB,GAAyB,CAAzC;AAEA,QAAMsH,MAAM,GAAGnB,gBAAgB,EAA/B;AACA,QAAI,CAACmB,MAAL,EAAa,OAAO,IAAP;AAxByC,QA0B9C1H,GA1B8C,GA0BtC0H,MA1BsC,CA0B9C1H,GA1B8C;AA2BtD,QAAM2H,gBAAgB,GAAGjB,YAAY,GAAG/F,KAAf,GAAuB,CAAhD,CA3BsD,CA2BH;;AACnD,QAAMiH,MAAM,GAAGvB,IAAI,CAACwB,GAAL,CAAS7H,GAAG,GAAGW,KAAN,GAAc6G,gBAAgB,CAACM,YAA/B,GAA8C9J,0CAAvD,CAAf;AACAwJ,IAAAA,gBAAgB,CAACO,KAAjB,CAAuB/H,GAAvB,GAAgC4H,MAAhC;AACAJ,IAAAA,gBAAgB,CAACO,KAAjB,CAAuBhI,IAAvB,GAAiC4H,gBAAjC;AACA,QAAMK,UAAU,GAAGvB,gBAAgB,CAACC,YAAD,CAAnC;;AACA,QAAIsB,UAAJ,EAAgB;AACdR,MAAAA,gBAAgB,CAACO,KAAjB,CAAuBE,UAAvB,GAAoC,QAApC;AACD,KAFD,MAEO;AACLT,MAAAA,gBAAgB,CAACO,KAAjB,CAAuBE,UAAvB,GAAoC,SAApC;AACD;AACF,GArC+B,EAqC7B,CAAC1G,SAAD,EAAYkB,sBAAZ,EAAoCN,SAApC,EAA+Cf,aAA/C,EAA8DyF,aAA9D,EAA6EN,gBAA7E,EAA+F5F,KAA/F,EAAsG8F,gBAAtG,CArC6B,CAAhC;AAuCA,MAAMyB,YAAY,GAAG5K,KAAK,CAACkH,WAAN,CACnB,UACEI,IADF,EAEEkC,UAFF,EAGEC,QAHF,EAIEoB,OAJF,EAKEC,UALF,EAMK;AACH,QAAI,CAACpB,KAAK,CAACC,OAAN,CAAc9E,SAAd,CAAL,EAA+B;AAC7B;AACD;;AACD,QAAMpC,IAAI,GAAG8G,aAAa,CAAC,CAAD,EAAIC,UAAU,GAAG,CAAjB,CAA1B;AACAlC,IAAAA,IAAI,CAACmD,KAAL,CAAWhI,IAAX,GAAqBA,IAArB;AACA,QAAMK,KAAK,GAAGyG,aAAa,CAACC,UAAD,EAAaC,QAAb,CAA3B;AACAnC,IAAAA,IAAI,CAACmD,KAAL,CAAWM,MAAX,kBAAiCD,UAAjC;AACAxD,IAAAA,IAAI,CAACmD,KAAL,CAAWO,YAAX,GAA0B,OAA1B;;AACA,QAAIvB,QAAQ,KAAK5E,SAAS,CAAEoG,MAAX,GAAoB,CAArC,EAAwC;AACtC3D,MAAAA,IAAI,CAACmD,KAAL,CAAWS,oBAAX,GAAkC,KAAlC;AACD,KAFD,MAEO;AACL5D,MAAAA,IAAI,CAACmD,KAAL,CAAWS,oBAAX,GAAkC,OAAlC;AACD;;AACD5D,IAAAA,IAAI,CAACmD,KAAL,CAAW3H,KAAX,GAAsBA,KAAK,GAAG,CAA9B;;AACA,QAAI+H,OAAJ,EAAa;AACXvD,MAAAA,IAAI,CAACmD,KAAL,CAAWU,eAAX,GAA6BN,OAA7B;AACD;AACF,GAzBkB,EA0BnB,CAAChG,SAAD,EAAY0E,aAAZ,CA1BmB,CAArB;AA6BA,MAAM6B,2BAA2B,GAAGpL,KAAK,CAACkH,WAAN,CAAkB,YAAM;AAC1D,QAAM0B,kBAAkB,GAAGV,qBAAqB,EAAhD;;AACA,QAAI,CAACjE,SAAD,IAAc,CAACR,KAAK,CAAC4H,IAAN,CAAWxG,SAA1B,IAAuCT,oBAA3C,EAAiE;AAC/D;AACD;;AAJyD,QAKlDiE,aALkD,GAKnBpE,SALmB,CAKlDoE,aALkD;AAAA,QAKnCC,WALmC,GAKnBrE,SALmB,CAKnCqE,WALmC;AAM1D,QAAMgD,gBAAgB,GAAGrL,QAAQ,CAAC6H,WAAT,CAAqBzB,mBAAmB,CAACc,OAAzC,CAAzB;;AACA,QAAI,CAACmE,gBAAL,EAAuB;AACrB;AACD,KATyD,CAU1D;;;AACA,QAAMlD,kBAAkB,GAAG1E,UAAU,CAACgE,KAAX,CAAiB,oBAAjB,EAAuC;AAChEJ,MAAAA,IAAI,EAAE7D;AAD0D,KAAvC,CAA3B;;AAGA,QAAImF,kBAAkB,IAAIR,kBAA1B,EAA8C;AAC5C,UAAMyC,OAAO,GAAGxF,aAAa,GAAGxE,KAAK,CAAC0K,IAAT,GAAgB1K,KAAK,CAAC2K,KAAnD;AACA,UAAMC,WAAW,GAAGpG,aAAa,GAAGxE,KAAK,CAAC0K,IAAT,GAAgB1K,KAAK,CAACyC,KAAvD;AACAsH,MAAAA,YAAY,CAACU,gBAAD,EAAmBjD,aAAnB,EAAkCC,WAAlC,EAA+CuC,OAA/C,EAAwDY,WAAxD,CAAZ;AACD,KAJD,MAIO;AACLb,MAAAA,YAAY,CAACU,gBAAD,EAAmBjD,aAAnB,EAAkCC,WAAlC,EAA+CzH,KAAK,CAAC6K,cAAN,CAAqBC,KAApE,EAA2E9K,KAAK,CAAC+K,kBAAjF,CAAZ;AACD;AACF,GArBmC,EAqBjC,CAAC1D,qBAAD,EAAwBjE,SAAxB,EAAmCR,KAAnC,EAA0CC,UAA1C,EAAsD2B,aAAtD,EAAqEuF,YAArE,EAAmFxG,oBAAnF,CArBiC,CAApC,CAzPoD,CAgRpD;;AACA,MAAMyH,wBAAwB,GAAG7L,KAAK,CAACkH,WAAN,CAAkB,UAACmB,aAAD,EAAwBC,WAAxB,EAA6CuC,OAA7C,EAA8DY,WAA9D,EAAsF;AACvI,QAAMH,gBAAgB,GAAGrL,QAAQ,CAAC6H,WAAT,CAAqBzB,mBAAmB,CAACc,OAAzC,CAAzB;;AACA,QAAI,CAACmE,gBAAL,EAAuB;AACrB;AACD;;AACDV,IAAAA,YAAY,CAACU,gBAAD,EAAmBjD,aAAnB,EAAkCC,WAAlC,EAA+CuC,OAA/C,EAAwDY,WAAxD,CAAZ;AACD,GANgC,EAM9B,CAACb,YAAD,CAN8B,CAAjC;AAQA5K,EAAAA,KAAK,CAAC8L,SAAN,CAAgB,YAAM;AAAA;;AACpB,QAAMC,SAAS,kBAAGtI,KAAK,CAAC4H,IAAT,8CAAG,YAAYxG,SAAf,qBAAG,sBAAuBoG,MAAzC;AACA,QAAI,CAACc,SAAL,EAAgB;;AAChB,QAAI3H,oBAAJ,EAA0B;AACxByH,MAAAA,wBAAwB,CAAC,CAAD,EAAIE,SAAS,GAAG,CAAhB,EAAmBlL,KAAK,CAAC2K,KAAzB,EAAgC3K,KAAK,CAACyC,KAAtC,CAAxB;AACD,KAFD,MAEO;AACL,UAAI,CAACW,SAAD,IAAc,CAACR,KAAK,CAAC4H,IAAN,CAAWxG,SAA9B,EAAyC;AACvCgH,QAAAA,wBAAwB,CAAC,CAAD,EAAIE,SAAS,GAAG,CAAhB,EAAmBlL,KAAK,CAAC6K,cAAN,WAAnB,EAAiD7K,KAAK,CAAC+K,kBAAvD,CAAxB;AACA;AACD;;AACDR,MAAAA,2BAA2B;AAC5B;AACF,GAZD,EAYG,CACDS,wBADC,EAEDT,2BAFC,EAGDnH,SAHC,kBAIDR,KAAK,CAAC4H,IAJL,8CAID,aAAYxG,SAJX,qBAID,sBAAuBoG,MAJtB,EAKD7G,oBALC,EAMDX,KANC,EAODC,UAPC,CAZH;AAsBA,MAAMsI,oBAAoB,GAAGhM,KAAK,CAACkH,WAAN,CAAkB,YAAM;AACnD,QACE,CAACnD,eAAe,CAACoD,OAAjB,IACA,CAAClD,SADD,IAEAkB,sBAAsB,KAAK,CAAC,CAF5B,IAGA,CAACxB,QAAQ,CAACwD,OAHV,IAIA,CAACvD,qBAAqB,CAACuD,OAJvB,IAKA,CAAChB,iBAAiB,CAACgB,OANrB,EAOE;AACA;AACD;;AACD,QAAM8E,YAAY,GAAGtI,QAAQ,CAACwD,OAA9B;AACA,QAAM+E,aAAa,GAAG3L,uBAAuB,CAC3C0L,YAD2C,EAE3CrI,qBAAqB,CAACuD,OAFqB,CAA7C;AAIA,QAAM8C,WAAW,GAAG1J,uBAAuB,CACzC4F,iBAAiB,CAACgB,OADuB,EAEzCvD,qBAAqB,CAACuD,OAFmB,CAA3C;AAIA,QAAM1E,IAAI,GAAG0C,sBAAsB,KAAK,CAA3B,GACT,CADS,GAEToE,aAAa,CAAC,CAAD,EAAIpE,sBAAsB,GAAG,CAA7B,CAFjB;AAGA,QAAMtC,MAAM,GAAGqJ,aAAa,CAACtJ,MAAd,GAAuBqH,WAAW,CAACvH,GAAlD;AACAqB,IAAAA,eAAe,CAACoD,OAAhB,CAAwBsD,KAAxB,CAA8BhI,IAA9B,GAAwCsG,IAAI,CAACoD,KAAL,CAAW1J,IAAI,GAAGY,KAAlB,CAAxC;AACAU,IAAAA,eAAe,CAACoD,OAAhB,CAAwBsD,KAAxB,CAA8B7H,MAA9B,GAA0CmG,IAAI,CAACoD,KAAL,CAAWpK,iBAAiB,GAAGsB,KAA/B,CAA1C;AACAU,IAAAA,eAAe,CAACoD,OAAhB,CAAwBsD,KAAxB,CAA8B5H,MAA9B,GAA0CA,MAAM,GAAGQ,KAAnD;AACD,GA3B4B,EA2B1B,CAACU,eAAD,EAAkBE,SAAlB,EAA6BkB,sBAA7B,EAAqDxB,QAArD,EAA+DC,qBAA/D,EAAsF2F,aAAtF,EAAqGlG,KAArG,CA3B0B,CAA7B;AA6BA,MAAM+I,iBAAiB,GAAGpM,KAAK,CAACkH,WAAN,CAAkB,UAACmF,KAAD,EAAW;AACrD,QAAI,CAAC9F,qBAAqB,CAACY,OAA3B,EAAoC;AAEpCkF,IAAAA,KAAK,CAACC,cAAN;AAEA,QAAMC,aAAa,GAAG/L,qBAAqB,CAAC6L,KAAD,EAAQvI,aAAR,CAA3C;AAEA,QAAM0I,cAAc,GAAGjG,qBAAqB,CAACY,OAAtB,CAA8BsF,sBAArD;AACA,QAAMC,kBAAkB,GAAGnG,qBAAqB,CAACY,OAAtB,CAA8BwF,kBAAzD;AAEA,QAAI,CAACH,cAAD,IAAmB,CAACE,kBAAxB,EAA4C;AAC5C,QAAME,kBAAkB,GAAGrM,uBAAuB,CAACiM,cAAD,EAAiB1I,aAAjB,CAAlD;AACA,QAAI+I,YAAY,GAAG9D,IAAI,CAACC,GAAL,CACjB4D,kBAAkB,CAACnK,IAAnB,GAA0B7B,aAAa,GAAGyC,KADzB,EAEjBkJ,aAAa,CAACO,SAFG,CAAnB;;AAIA,QAAIJ,kBAAkB,IAAIA,kBAAkB,CAACK,YAAnB,CAAgC,YAAhC,MAAkD,IAA5E,EAAkF;AAChF,UAAMC,sBAAsB,GAAGzM,uBAAuB,CAACmM,kBAAD,EAAqB5I,aAArB,CAAtD;AACA+I,MAAAA,YAAY,GAAG9D,IAAI,CAACD,GAAL,CACbkE,sBAAsB,CAACvK,IAAvB,GAA8BuK,sBAAsB,CAAClK,KAArD,GAA6DlC,aAAa,GAAGyC,KADhE,EAEbwJ,YAFa,CAAf;AAID;;AAED,QAAMI,YAAY,GAAGzG,eAAe,CAACW,OAArC;;AACA,QAAI8F,YAAY,IAAI,IAApB,EAA0B;AACxB;AACD;;AACD,QAAMC,KAAK,GAAGL,YAAY,GAAGI,YAA7B;AACA,QAAMxK,IAAI,GAAGgE,oBAAoB,CAACU,OAArB,GAA+B4B,IAAI,CAACoD,KAAL,CAAWe,KAAK,GAAG7J,KAAnB,CAA5C;AACAqC,IAAAA,kBAAkB,cACbU,kBAAkB,CAACe,OADN;AAEhB1E,MAAAA,IAAI,EAAJA;AAFgB,OAAlB;AAID,GAlCyB,EAkCvB,CAACqB,aAAD,EAAgBT,KAAhB,CAlCuB,CAA1B;AAoCA,MAAM8J,eAAe,GAAGnN,KAAK,CAACkH,WAAN,CAAkB,YAAM;AAC9ChC,IAAAA,qBAAqB,CAAC,KAAD,CAArB;AAEAkI,IAAAA,QAAQ,CAACC,mBAAT,CAA6B,WAA7B,EAA0CF,eAA1C;AACD,GAJuB,EAIrB,EAJqB,CAAxB;AAMA,MAAMG,kBAAkB,GAAGtN,KAAK,CAACkH,WAAN,CAAkB,YAAM;AACjD;AACA;AACA,QAAI,CAACX,qBAAqB,CAACY,OAA3B,EAAoC;AAClCiG,MAAAA,QAAQ,CAACC,mBAAT,CAA6B,WAA7B,EAA0CF,eAA1C;AACAC,MAAAA,QAAQ,CAACC,mBAAT,CAA6B,WAA7B,EAA0CjB,iBAA1C;AACAgB,MAAAA,QAAQ,CAACC,mBAAT,CAA6B,SAA7B,EAAwCC,kBAAxC;AACA;AACD;;AACD,QAAMJ,KAAK,GAAGK,QAAQ,CAAChH,qBAAqB,CAACY,OAAtB,CAA8BsD,KAA9B,CAAoChI,IAArC,EAA2C,EAA3C,CAAR,GAAyDgE,oBAAoB,CAACU,OAA5F;AACA,QAAMqG,gBAAgB,GAAGD,QAAQ,CAAChH,qBAAqB,CAACY,OAAtB,CAA8B4F,YAA9B,CAA2C,YAA3C,CAAD,EAA4D,EAA5D,CAAjC;AACAvI,IAAAA,WAAW,CAACgJ,gBAAD,EAAmBN,KAAnB,CAAX;AACA3G,IAAAA,qBAAqB,CAACY,OAAtB,CAA8BsD,KAA9B,CAAoCU,eAApC,GAAsD,EAAtD;AACA5E,IAAAA,qBAAqB,CAACY,OAAtB,GAAgC,IAAhC;AACAX,IAAAA,eAAe,CAACW,OAAhB,GAA0B,IAA1B;AACAV,IAAAA,oBAAoB,CAACU,OAArB,GAA+B,CAA/B;AAEAiG,IAAAA,QAAQ,CAACK,IAAT,CAAchD,KAAd,CAAoBiD,MAApB,GAA6BhH,mBAAmB,CAACS,OAAjD;AACAT,IAAAA,mBAAmB,CAACS,OAApB,GAA8B,EAA9B;AAEAzB,IAAAA,kBAAkB,cACbD,eADa;AAEhBF,MAAAA,QAAQ,EAAE,CAAC;AAFK,OAAlB;AAKA6H,IAAAA,QAAQ,CAACC,mBAAT,CAA6B,WAA7B,EAA0CF,eAA1C;AACAC,IAAAA,QAAQ,CAACC,mBAAT,CAA6B,WAA7B,EAA0CjB,iBAA1C;AACAgB,IAAAA,QAAQ,CAACC,mBAAT,CAA6B,SAA7B,EAAwCC,kBAAxC;AACD,GA5B0B,EA4BxB,CAAC9I,WAAD,EAAciB,eAAd,EAA+B0H,eAA/B,EAAgDf,iBAAhD,CA5BwB,CAA3B;AA8BA,MAAMuB,oBAAoB,GAAG3N,KAAK,CAACkH,WAAN,CAAkB,UAACmF,KAAD,EAAyD;AACtG;AACAA,IAAAA,KAAK,CAACC,cAAN;AACA,QAAMC,aAAa,GAAG/L,qBAAqB,CAAC6L,KAAD,EAAQvI,aAAR,CAA3C;AAEA0C,IAAAA,eAAe,CAACW,OAAhB,GAA0BoF,aAAa,CAACO,SAAxC;AACAvG,IAAAA,qBAAqB,CAACY,OAAtB,GAAgCkF,KAAK,CAACuB,MAAtC;AACA,QAAMJ,gBAAgB,GAAGD,QAAQ,CAAChH,qBAAqB,CAACY,OAAtB,CAA8B4F,YAA9B,CAA2C,YAA3C,CAAD,EAA4D,EAA5D,CAAjC;AACA,QAAMtK,IAAI,GAAG8K,QAAQ,CAAChH,qBAAqB,CAACY,OAAtB,CAA8BsD,KAA9B,CAAoChI,IAArC,EAA2C,EAA3C,CAArB;AACA8D,IAAAA,qBAAqB,CAACY,OAAtB,CAA8BsD,KAA9B,CAAoCU,eAApC,GAAsD,aAAtD;AAEAzE,IAAAA,mBAAmB,CAACS,OAApB,GAA8BiG,QAAQ,CAACK,IAAT,CAAchD,KAAd,CAAoBiD,MAAlD;AACAN,IAAAA,QAAQ,CAACK,IAAT,CAAchD,KAAd,CAAoBoD,WAApB,CAAgC,QAAhC,EAA0C,YAA1C,EAAwD,WAAxD;AAEA,QAAMpK,KAAK,GAAGxD,QAAQ,CAAC6H,WAAT,CAAqBnE,QAAQ,CAACwD,OAA9B,CAAd;AAEA,QAAMmC,SAAS,GAAG/I,uBAAuB,CAACkD,KAAD,EAAuBK,aAAvB,CAAzC;AACA,QAAMpB,GAAG,GAAGZ,iBAAiB,CAACY,GAAlB,GAAwBW,KAApC;AACAoD,IAAAA,oBAAoB,CAACU,OAArB,GAA+B1E,IAA/B;AACA2D,IAAAA,kBAAkB,CAACe,OAAnB,GAA6B;AAC3B5B,MAAAA,QAAQ,EAAEiI,gBADiB;AAE3B/K,MAAAA,IAAI,EAAJA,IAF2B;AAG3BC,MAAAA,GAAG,EAAHA,GAH2B;AAI3B8C,MAAAA,gBAAgB,EAAE,CAAC8D,SAAS,CAACzG,MAAV,GAAmB/B,iBAAnB,GAAuCgB,iBAAiB,CAACY,GAA1D,IAAiEW;AAJxD,KAA7B;AAOAqC,IAAAA,kBAAkB,CAAC;AACjBH,MAAAA,QAAQ,EAAEiI,gBADO;AAEjB/K,MAAAA,IAAI,EAAJA,IAFiB;AAGjBC,MAAAA,GAAG,EAAHA,GAHiB;AAIjB8C,MAAAA,gBAAgB,EAAE,CAAC8D,SAAS,CAACzG,MAAV,GAAmB/B,iBAAnB,GAAuCgB,iBAAiB,CAACY,GAA1D,IAAiEW;AAJlE,KAAD,CAAlB;AAMA+J,IAAAA,QAAQ,CAACU,gBAAT,CAA0B,WAA1B,EAAuC1B,iBAAvC;AACAgB,IAAAA,QAAQ,CAACU,gBAAT,CAA0B,SAA1B,EAAqCR,kBAArC;AACD,GAlC4B,EAkC1B,CAAClB,iBAAD,EAAoBkB,kBAApB,EAAwCjK,KAAxC,EAA+CM,QAA/C,EAAyDG,aAAzD,CAlC0B,CAA7B;AAoCA,MAAMiK,oBAAoB,GAAG/N,KAAK,CAACkH,WAAN,CAAkB,UAACmF,KAAD,EAAW;AACxDA,IAAAA,KAAK,CAACC,cAAN;AACAD,IAAAA,KAAK,CAAC2B,eAAN;AACD,GAH4B,EAG1B,EAH0B,CAA7B;AAKA,MAAMC,iBAAiB,GAAGjO,KAAK,CAACkH,WAAN,CAAkB,UAACmF,KAAD,EAAW;AACrD0B,IAAAA,oBAAoB,CAAC1B,KAAD,CAApB;AAEA/H,IAAAA,aAAa,CAAC+H,KAAD,CAAb;AAEAnH,IAAAA,qBAAqB,CAAC,IAAD,CAArB;AACD,GANyB,EAMvB,CAACZ,aAAD,EAAgByJ,oBAAhB,CANuB,CAA1B;AAQA,MAAMG,aAAa,GAAGlO,KAAK,CAACkH,WAAN,CAAkB,YAAM;AAC5C,WAAOzB,eAAe,IAAIA,eAAe,CAACF,QAAhB,KAA6B,CAAC,CAAxD;AACD,GAFqB,EAEnB,CAACE,eAAD,CAFmB,CAAtB;AAIA,MAAM0I,8BAA8B,GAAGnO,KAAK,CAACkH,WAAN,CAAkB,UAACmF,KAAD,EAAW;AAClE,QAAMzE,KAAK,GAAG2F,QAAQ,CAAClB,KAAK,CAACuB,MAAN,CAAab,YAAb,CAA0B,YAA1B,CAAD,EAA0C,EAA1C,CAAtB;AACA,QAAIqB,KAAK,CAACxG,KAAD,CAAT,EAAkB,OAFgD,CAGlE;;AACA,QAAMyG,SAAS,GAAG5K,KAAK,CAAC8E,KAAN,CAAY0C,MAA9B;;AACA,QAAIoD,SAAJ,EAAe;AACb;AACA,UAAM1J,eAAc,GAAG;AACrB2J,QAAAA,GAAG,EAAE7K,KAAK,CAAC6K,GADU;AAErBjG,QAAAA,aAAa,EAAET,KAFM;AAGrBU,QAAAA,WAAW,EAAEV,KAHQ;AAIrB2G,QAAAA,aAAa,EAAE,CAJM;AAKrBC,QAAAA,WAAW,EAAEH,SAAS,GAAG;AALJ,OAAvB;AAOAzJ,MAAAA,iBAAiB,CAACD,eAAD,CAAjB;AACD;AACF,GAhBsC,EAgBpC,CAACC,iBAAD,EAAoBnB,KAAK,CAAC6K,GAA1B,EAA+B7K,KAAK,CAAC8E,KAAN,CAAY0C,MAA3C,CAhBoC,CAAvC;AAkBA,MAAMwD,4BAA4B,GAAGzO,KAAK,CAACkH,WAAN,CAAkB,YAAM;AAC3DtC,IAAAA,iBAAiB,CAAC,IAAD,CAAjB;AACD,GAFoC,EAElC,CAACA,iBAAD,CAFkC,CAArC;AAIA,MAAM8J,eAAe,GAAG1O,KAAK,CAACkH,WAAN,CAAkB,UAACyH,CAAD,EAAO;AAC/C,QAAI9I,UAAU,IAAIqI,aAAa,EAA3B,IAAiC,CAACrK,eAAe,CAACsD,OAAtD,EAA+D;AAC7D;AACD;;AAH8C,QAIvCyH,OAJuC,GAI3BD,CAJ2B,CAIvCC,OAJuC;AAK/C,QAAMC,UAAU,GAAGhL,eAAe,CAACsD,OAAhB,CAAwBK,qBAAxB,EAAnB;AACA,QAAMsH,iBAAiB,GAAG,EAA1B;;AACA,QACEF,OAAO,GAAGC,UAAU,CAACpM,IAAX,GAAkBqM,iBAA5B,IACGF,OAAO,GAAGC,UAAU,CAAClM,KAAX,GAAmBmM,iBAFlC,EAGE;AACA;AACD;;AACD,QAAMC,QAAQ,GAAG3H,YAAY,EAA7B;AACA,QAAMQ,KAAK,GAAGmH,QAAQ,CAACC,SAAT,CAAmB,UAACzH,IAAD,EAAU;AACzC;AACA;AACA;AACA,UAAI,CAACA,IAAL,EAAW;AACT,eAAO,KAAP;AACD;;AACD,aAAOqH,OAAO,IAAIrH,IAAI,CAAC9E,IAAhB,IAAwBmM,OAAO,IAAIrH,IAAI,CAAC5E,KAA/C;AACD,KARa,CAAd;AASAiD,IAAAA,wBAAwB,CAACgC,KAAD,CAAxB;AACD,GAxBuB,EAwBrB,CAAC/B,UAAD,EAAaqI,aAAb,EAA4BrK,eAA5B,EAA6CuD,YAA7C,CAxBqB,CAAxB;AA0BA,MAAM6H,cAAc,GAAGjP,KAAK,CAACkH,WAAN,CAAkB,UAACyH,CAAD,EAAO;AAC9C,QAAMO,YAAY,GAAGtI,eAAe,CAACO,OAArC;;AACA,QAAI+H,YAAY,IAAIA,YAAY,CAACC,QAAb,CAAsBR,CAAC,CAACf,MAAxB,CAApB,EAAqD;AACnD;AACD;;AACD,QAAI/H,UAAU,IAAIqI,aAAa,EAA/B,EAAmC;AACjC;AACD;;AACDtI,IAAAA,wBAAwB,CAAC,CAAC,CAAF,CAAxB;AACD,GATsB,EASpB,CAACC,UAAD,EAAaqI,aAAb,CAToB,CAAvB;AAWA,MAAMkB,UAAU,GAAGpP,KAAK,CAACkH,WAAN,CAAkB,UACnCsB,KADmC,EAEnCC,GAFmC,EAGnC4G,qBAHmC,EAIhC;AAAA,QADHA,qBACG;AADHA,MAAAA,qBACG,GADqB,IACrB;AAAA;;AACH,QAAI7G,KAAK,KAAKC,GAAd,EAAmB;AACjBzB,MAAAA,mBAAmB,CAACG,OAApB,GAA8BqB,KAA9B;AACD;;AACDjE,IAAAA,QAAQ,CACN;AACEiE,MAAAA,KAAK,EAALA,KADF;AAEEC,MAAAA,GAAG,EAAHA;AAFF,KADM,EAKN4G,qBALM,CAAR;AAOD,GAfkB,EAehB,CAAC9K,QAAD,CAfgB,CAAnB;AAiBA,MAAM+K,mBAAmB,GAAGtP,KAAK,CAACkH,WAAN,CAAkB,UAACqI,WAAD,EAAsBC,UAAtB,EAA6C;AACzF,QAAID,WAAW,KAAK,CAAhB,IAAqBxK,cAAzB,EAAyC;AACvC,aAAO,KAAP;AACD;;AACD,QAAIwK,WAAW,GAAG,CAAd,IAAmBA,WAAW,GAAGC,UAArC,EAAiD;AAC/C,UAAMC,WAAW,GAAGhM,KAAK,CAAC8E,KAAN,CAAY0C,MAAZ,GAAqB,CAAzC;AACA,UAAMyE,gBAAiC,GAAG;AACxCnB,QAAAA,aAAa,EAAE,CADyB;AAExCC,QAAAA,WAAW,EAAEiB,WAF2B;AAGxCpH,QAAAA,aAAa,EAAE,CAHyB;AAIxCC,QAAAA,WAAW,EAAEiH,WAAW,GAAG,CAJa;AAKxCjB,QAAAA,GAAG,EAAE7K,KAAK,CAAC6K;AAL6B,OAA1C;AAOA,aAAO5K,UAAU,CAACgE,KAAX,CACL,4BADK,EAEL;AAAEJ,QAAAA,IAAI,EAAE7D,KAAR;AAAe0E,QAAAA,cAAc,EAAEuH;AAA/B,OAFK,CAAP;AAID;;AACD,WAAO,IAAP;AACD,GAnB2B,EAmBzB,CAACjM,KAAD,EAAQC,UAAR,EAAoBqB,cAApB,CAnByB,CAA5B;AAqBA,MAAM4K,oBAAoB,GAAG3P,KAAK,CAACkH,WAAN,CAAkB/G,QAAQ,CAAC,UAACkM,KAAD,EAAuB;AAC7E,QAAIxG,UAAJ,EAAgB;AACd;AACD;;AAH4E,QAIrE+J,OAJqE,GAIzDvD,KAJyD,CAIrEuD,OAJqE;AAK7E,QAAMhH,kBAAkB,GAAGV,qBAAqB,EAAhD;;AACA,QAAI0H,OAAO,KAAK,CAAZ,IAAiB,CAAC3J,aAAa,CAACkB,OAAhC,IAA2C,CAACyB,kBAAhD,EAAoE;AAClEiH,MAAAA,yBAAyB;AACzB;AACD;;AAED,QAAMhJ,SAAS,GAAGI,eAAe,EAAjC;;AAX6E,gBAY/ChB,aAAa,CAACkB,OAAd,CAAsBK,qBAAtB,EAZ+C;AAAA,QAY/DsI,WAZ+D,SAYrErN,IAZqE;;AAa7E,QAAMsN,OAAO,GAAG1D,KAAK,CAACuC,OAAN,GAAgBkB,WAAhC;AACA,QAAIE,gBAAgB,GAAGnJ,SAAS,CAACoE,MAAV,GAAmB,CAA1C;AACA,QAAInB,GAAG,GAAG,CAAV;;AACA,SAAK,IAAImG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGpJ,SAAS,CAACoE,MAA9B,EAAsCgF,CAAC,IAAI,CAA3C,EAA8C;AAC5CnG,MAAAA,GAAG,IAAIjD,SAAS,CAACoJ,CAAD,CAAT,CAAazI,qBAAb,GAAqC1E,KAA5C;;AACA,UAAIgH,GAAG,GAAGiG,OAAV,EAAmB;AACjBC,QAAAA,gBAAgB,GAAGC,CAAnB;AACA;AACD;AACF;;AACDb,IAAAA,UAAU,CAACpI,mBAAmB,CAACG,OAArB,EAA8B6I,gBAA9B,CAAV;AACD,GAxBsD,EAwBpD,GAxBoD,CAA1B,EAyB3B,CAACnK,UAAD,EAAaqC,qBAAb,EAAoCkH,UAApC,CAzB2B,CAA7B;AA2BA,MAAMS,yBAAyB,GAAG7P,KAAK,CAACkH,WAAN,CAAkB,YAAM;AACxDkG,IAAAA,QAAQ,CAACC,mBAAT,CAA6B,WAA7B,EAA0CsC,oBAA1C;AACAvC,IAAAA,QAAQ,CAACC,mBAAT,CAA6B,SAA7B,EAAwCwC,yBAAxC;AACD,GAHiC,EAG/B,CAACF,oBAAD,CAH+B,CAAlC;AAKA,MAAMO,oBAAoB,GAAGlQ,KAAK,CAACkH,WAAN,CAAkB,UAACiJ,SAAD,EAAwB;AACrE,QAAI,CAACpM,eAAe,CAACoD,OAArB,EAA8B;AAC5B;AACD;;AACD,QAAMiJ,OAAO,GAAGD,SAAS,GAAG,GAAH,GAAS,GAAlC;AACApM,IAAAA,eAAe,CAACoD,OAAhB,CAAwBsD,KAAxB,CAA8B2F,OAA9B,GAAwCA,OAAxC;AACD,GAN4B,EAM1B,CAACrM,eAAD,CAN0B,CAA7B;AAQA,MAAMsM,kBAAkB,GAAGrQ,KAAK,CAACkH,WAAN,CAAkB,UAACU,KAAD,EAAmB;AAC9D,QAAIqI,CAAC,GAAGrI,KAAR;;AACA,QAAIqI,CAAC,KAAK,CAAN,IAAWlL,cAAf,EAA+B;AAC7BkL,MAAAA,CAAC,GAAG,CAAC,CAAL;AACD;;AACD7K,IAAAA,yBAAyB,CAAC6K,CAAD,CAAzB;AACAC,IAAAA,oBAAoB,CAACD,CAAC,KAAK,CAAC,CAAR,CAApB;AACA3J,IAAAA,cAAc,CAACa,OAAf,GAAyB8I,CAAzB;AACD,GAR0B,EAQxB,CAAClL,cAAD,EAAiBmL,oBAAjB,CARwB,CAA3B;AAUA,MAAMI,sBAAsB,GAAGtQ,KAAK,CAACkH,WAAN,CAAkB,YAAM;AACrDkG,IAAAA,QAAQ,CAACU,gBAAT,CAA0B,WAA1B,EAAuC6B,oBAAvC;AACAvC,IAAAA,QAAQ,CAACU,gBAAT,CAA0B,SAA1B,EAAqC+B,yBAArC;AACD,GAH8B,EAG5B,CAACF,oBAAD,EAAuBE,yBAAvB,CAH4B,CAA/B;AAKA,MAAMU,cAAc,GAAGvQ,KAAK,CAACkH,WAAN,CAAkB,UACvCsJ,gBADuC,EAEvCC,WAFuC,EAGpC;AAAA,gBACkB/H,sBAAsB,CAAC8H,gBAAD,CADxC;AAAA,QACK1H,GADL,SACKA,GADL;AAAA,QACUE,GADV,SACUA,GADV;;AAEHtF,IAAAA,UAAU,CAACgN,GAAX,CACE,UADF,EAEEtP,aAAa,CACXqC,KADW,EAEX;AACE+E,MAAAA,KAAK,EAAEM,GADT;AAEEL,MAAAA,GAAG,EAAEO;AAFP,KAFW,EAMXyH,WANW,CAFf;AAWA,QAAMjH,UAAU,GAAGV,GAAG,GAAG2H,WAAN,GACjBA,WAAW,IAAIzH,GAAG,GAAGF,GAAN,GAAY,CAAhB,CADM,GAEjB2H,WAFF;AAGArB,IAAAA,UAAU,CAAC5F,UAAD,EAAaA,UAAU,GAAGR,GAAb,GAAmBF,GAAhC,CAAV;AACD,GApBsB,EAoBpB,CAACJ,sBAAD,EAAyBhF,UAAzB,EAAqC0L,UAArC,EAAiD3L,KAAjD,CApBoB,CAAvB;AAsBA,MAAMkN,yBAAyB,GAAG3Q,KAAK,CAACkH,WAAN,CAAkB,UAAC0J,CAAD,EAAYC,CAAZ,EAA0B;AAC5E,QAAI,CAAC9J,cAAc,CAACI,OAApB,EAA6B;AAC3B;AACD;;AAEDJ,IAAAA,cAAc,CAACI,OAAf,CAAuBsD,KAAvB,CAA6BhI,IAA7B,GAAuCmO,CAAC,GAAGvN,KAA3C;AACA0D,IAAAA,cAAc,CAACI,OAAf,CAAuBsD,KAAvB,CAA6B/H,GAA7B,GAAsCmO,CAAC,GAAGxN,KAA1C;AACD,GAPiC,EAO/B,CAACA,KAAD,CAP+B,CAAlC;AASA,MAAMyN,gBAAgB,GAAG9Q,KAAK,CAACkH,WAAN,CAAkB,YAAM;AAC/C,QAAM0B,kBAAkB,GAAGV,qBAAqB,EAAhD;AACA,WAAO,CAAC,CAACU,kBAAT;AACD,GAHwB,EAGtB,CAACV,qBAAD,CAHsB,CAAzB;AAKA,MAAM6I,mBAAmB,GAAG/Q,KAAK,CAACkH,WAAN,CAAkB,UAACqF,aAAD,EAAmB;AAAA,QAE7DqC,OAF6D,GAM3DrC,aAN2D,CAE7DqC,OAF6D;AAAA,QAG7DoC,OAH6D,GAM3DzE,aAN2D,CAG7DyE,OAH6D;AAAA,QAI7DlE,SAJ6D,GAM3DP,aAN2D,CAI7DO,SAJ6D;AAAA,QAK7DmE,SAL6D,GAM3D1E,aAN2D,CAK7D0E,SAL6D;AAO/D,QAAMC,QAAQ,GAAG7Q,QAAQ,CAACyH,WAAT,CAAqBrE,KAAK,CAAC6K,GAA3B,CAAjB;;AACA,QAAI,CAAC4C,QAAL,EAAe;AACb;AACD;;AACDP,IAAAA,yBAAyB,CAAC7D,SAAD,EAAYmE,SAAZ,CAAzB;AACA,QAAM3H,SAAS,GAAG4H,QAAQ,CAAC1J,qBAAT,EAAlB;;AACA,QACEoH,OAAO,GAAGtF,SAAS,CAAC7G,IAAV,GAAiB3B,iBAA3B,IACA8N,OAAO,GAAGtF,SAAS,CAAC3G,KADpB,IAEAqO,OAAO,GAAG1H,SAAS,CAAC5G,GAAV,GAAgB5B,iBAF1B,IAGAkQ,OAAO,GAAG1H,SAAS,CAAC1G,MAJtB,EAKE;AACAyN,MAAAA,kBAAkB,CAAC,CAAC,CAAF,CAAlB;AACA;AACD;;AACD,QAAMc,SAAS,GAAG/J,YAAY,EAA9B;AACA,QAAImI,WAAW,GAAG,CAAC,CAAnB;;AACA,SAAK,IAAIU,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGkB,SAAS,CAAClG,MAA9B,EAAsCgF,CAAC,EAAvC,EAA2C;AACzC,UAAMhI,OAAO,GAAGkJ,SAAS,CAAClB,CAAD,CAAzB;;AACA,UACErB,OAAO,IAAI3G,OAAO,CAACxF,IAAnB,IACAmM,OAAO,IAAI3G,OAAO,CAACxF,IAAR,GAAewF,OAAO,CAACnF,KAAR,GAAgB,CAF5C,EAGE;AACAyM,QAAAA,WAAW,GAAGU,CAAd;AACA;AACD;;AACD,UACErB,OAAO,GAAG3G,OAAO,CAACxF,IAAR,GAAewF,OAAO,CAACnF,KAAR,GAAgB,CAAzC,IACA8L,OAAO,GAAG3G,OAAO,CAACtF,KAFpB,EAGE;AACA4M,QAAAA,WAAW,GAAGU,CAAC,GAAG,CAAlB;AACA;AACD;AACF;;AACD,QAAMmB,SAAS,GAAG1I,sBAAsB,EAAxC;;AACA,QACE,CAAC0I,SAAD,IAEE7B,WAAW,IAAI6B,SAAS,CAACtI,GAAzB,IACGyG,WAAW,IAAI6B,SAAS,CAACpI,GAAV,GAAgB,CAJtC,EAME;AACAuG,MAAAA,WAAW,GAAG,CAAC,CAAf;AACD;;AAED,QAAM8B,aAAa,GAAG/B,mBAAmB,CAACC,WAAD,EAAc4B,SAAS,CAAClG,MAAxB,CAAzC;;AACA,QAAI,CAACoG,aAAL,EAAoB;AAClB9B,MAAAA,WAAW,GAAG,CAAC,CAAf;AACD;;AACDc,IAAAA,kBAAkB,CAACd,WAAD,CAAlB;AACD,GAzD2B,EAyDzB,CACD9L,KAAK,CAAC6K,GADL,EAEDqC,yBAFC,EAGDvJ,YAHC,EAIDsB,sBAJC,EAKD2H,kBALC,EAMDf,mBANC,CAzDyB,CAA5B;AAkEA,MAAMgC,aAAa,GAAGtR,KAAK,CAACkH,WAAN,CAAkB,YAAM;AAC5CpB,IAAAA,aAAa,CAAC,KAAD,CAAb;AACAsH,IAAAA,QAAQ,CAACC,mBAAT,CAA6B,SAA7B,EAAwCiE,aAAxC;;AACA,QAAIhL,cAAc,CAACa,OAAf,KAA2B,CAAC,CAAhC,EAAmC;AACjC;AACD;;AACD,QAAMyB,kBAAkB,GAAGV,qBAAqB,EAAhD;AACAqI,IAAAA,cAAc,CAAC3H,kBAAD,EAAsBtC,cAAc,CAACa,OAArC,CAAd;AACAkJ,IAAAA,kBAAkB,CAAC,CAAC,CAAF,CAAlB;AACD,GATqB,EASnB,CAACnI,qBAAD,EAAwBqI,cAAxB,EAAwCF,kBAAxC,CATmB,CAAtB;AAWA,MAAMkB,cAAc,GAAGvR,KAAK,CAACkH,WAAN,CAAkB,UAACmF,KAAD,EAA0C;AACjF,QAAM6E,QAAQ,GAAG7Q,QAAQ,CAACmR,iBAAT,CAA2B/N,KAAK,CAAC6K,GAAjC,CAAjB;;AACA,QAAI,CAAC4C,QAAD,IAAa7E,KAAK,CAACuD,OAAN,KAAkB,CAAnC,EAAsC;AACpC0B,MAAAA,aAAa;AACblE,MAAAA,QAAQ,CAACC,mBAAT,CAA6B,WAA7B,EAA0CkE,cAA1C;AACA;AACD;;AACDlF,IAAAA,KAAK,CAAC2B,eAAN;AACA,QAAMzB,aAAa,GAAG/L,qBAAqB,CAAC6L,KAAD,EAAQvI,aAAR,CAA3C;AACAiN,IAAAA,mBAAmB,CAACxE,aAAD,CAAnB;AACA5K,IAAAA,gBAAgB,CAAC0K,KAAK,CAACuC,OAAP,EAAgB/K,eAAe,CAACsD,OAAhC,CAAhB;AACD,GAXsB,EAWpB,CAAC1D,KAAK,CAAC6K,GAAP,EAAYxK,aAAZ,EAA2BiN,mBAA3B,EAAgDO,aAAhD,EAA+DzN,eAA/D,CAXoB,CAAvB;AAaA,MAAM4N,eAAe,GAAGzR,KAAK,CAACkH,WAAN,CAAkB,UAACqF,aAAD,EAAmB;AAC3D,QAAM3D,kBAAkB,GAAGV,qBAAqB,EAAhD;AACA,QAAMwJ,aAAa,GAAG9I,kBAAkB,CAAEJ,KAA1C;AACA1C,IAAAA,aAAa,CAAC,IAAD,CAAb;AACAE,IAAAA,mBAAmB,CAACnB,SAAS,CAAE6M,aAAF,CAAV,CAAnB;AACAX,IAAAA,mBAAmB,CAACxE,aAAD,CAAnB;AACAa,IAAAA,QAAQ,CAACU,gBAAT,CAA0B,WAA1B,EAAuCyD,cAAvC;AACAnE,IAAAA,QAAQ,CAACU,gBAAT,CAA0B,SAA1B,EAAqCwD,aAArC;AACD,GARuB,EAQrB,CAACzM,SAAD,EAAYiB,aAAZ,EAA2BE,mBAA3B,EAAgD+K,mBAAhD,EAAqEQ,cAArE,EAAqFrJ,qBAArF,EAA4GoJ,aAA5G,CARqB,CAAxB;AAUA,MAAMK,cAAc,GAAG3R,KAAK,CAACkH,WAAN,CAAkB,YAAM;AAC7C,QAAM2B,KAAK,GAAGH,sBAAsB,EAApC,CAD6C,CAE7C;;AACA,QAAI3D,cAAc,IAAI,CAAA8D,KAAK,QAAL,YAAAA,KAAK,CAAEC,GAAP,MAAe,CAArC,EAAwC,OAAO,KAAP;AAExC,WAAO8I,OAAO,CAAC/I,KAAK,IAClBlD,qBAAqB,IAAIkD,KAAK,CAACC,GADlB,IAEbnD,qBAAqB,IAAIkD,KAAK,CAACG,GAFnB,CAAd;AAGD,GARsB,EAQpB,CAACN,sBAAD,EAAyB/C,qBAAzB,EAAgDZ,cAAhD,CARoB,CAAvB;AAUA,MAAM8M,eAAe,GAAG7R,KAAK,CAACkH,WAAN,CACtB,UAACmF,KAAD,EAAW;AACT0B,IAAAA,oBAAoB,CAAC1B,KAAD,CAApB;AACA,QAAMzD,kBAAkB,GAAGV,qBAAqB,EAAhD;AACAxE,IAAAA,UAAU,CAACgN,GAAX,CAAe,UAAf,EAA2BzP,iBAAiB,CAACwC,KAAD,EAAQ,KAAR,EAAe4I,KAAK,CAACuB,MAArB,CAA5C;AACA,QAAMhG,KAAK,GAAG2F,QAAQ,CAAClB,KAAK,CAACuB,MAAN,CAAab,YAAb,CAA0B,YAA1B,CAAD,EAA0C,EAA1C,CAAtB;;AACA,QACEV,KAAK,CAACyF,QAAN,IACAlJ,kBADA,IAEA5B,mBAAmB,CAACG,OAApB,KAAgCS,KAHlC,EAIE;AACAwH,MAAAA,UAAU,CAACpI,mBAAmB,CAACG,OAArB,EAA8BS,KAA9B,CAAV;AACA;AACD;;AACD,QAAMwJ,SAAS,GAAG1I,sBAAsB,EAAxC;;AACA,QAAI,CAAC0I,SAAD,IAAcxJ,KAAK,GAAGwJ,SAAS,CAACpI,GAAhC,IAAuCpB,KAAK,GAAGwJ,SAAS,CAACtI,GAA7D,EAAkE;AAChEsG,MAAAA,UAAU,CAACxH,KAAD,EAAQA,KAAR,CAAV;AACA0I,MAAAA,sBAAsB;AACtB;AACD;;AAED,QAAM/D,aAAa,GAAG/L,qBAAqB,CAAC6L,KAAD,EAAQvI,aAAR,CAA3C;AACA,QAAIiO,KAAJ;AACA,QAAMC,YAAY,GAAG3F,KAAK,CAACuD,OAAN,KAAkB,CAAvC;;AACA,QAAMqC,UAAU,GAAG,SAAbA,UAAa,GAAM;AACvBC,MAAAA,YAAY,CAACH,KAAD,CAAZ;AACA3C,MAAAA,UAAU,CAACxH,KAAD,EAAQA,KAAR,EAAe,CAACoK,YAAhB,CAAV;AACAG,MAAAA,6BAA6B;AAC9B,KAJD;;AAKA,QAAMA,6BAA6B,GAAG,SAAhCA,6BAAgC,GAAM;AAC1C/E,MAAAA,QAAQ,CAACC,mBAAT,CAA6B,WAA7B,EAA0C4E,UAA1C;AACA7E,MAAAA,QAAQ,CAACC,mBAAT,CAA6B,SAA7B,EAAwC4E,UAAxC;AACD,KAHD;;AAIAF,IAAAA,KAAK,GAAGK,MAAM,CAACC,UAAP,CAAkB,YAAM;AAC9BxC,MAAAA,yBAAyB;AACzBsC,MAAAA,6BAA6B;AAC7BV,MAAAA,eAAe,CAAClF,aAAD,CAAf;AACD,KAJO,EAIL5L,iBAJK,CAAR;;AAKA,QAAI,CAACgR,cAAc,EAAnB,EAAuB;AACrBM,MAAAA,UAAU;AACX;;AAED3B,IAAAA,sBAAsB;AACtBlD,IAAAA,QAAQ,CAACU,gBAAT,CAA0B,WAA1B,EAAuCmE,UAAvC;AACA7E,IAAAA,QAAQ,CAACU,gBAAT,CAA0B,SAA1B,EAAqCmE,UAArC;AACD,GA7CqB,EA8CtB,CACElE,oBADF,EAEE7F,qBAFF,EAGExE,UAHF,EAIED,KAJF,EAKEiF,sBALF,EAMEiJ,cANF,EAOE7N,aAPF,EAQEwM,sBARF,EASElB,UATF,EAUES,yBAVF,EAWE4B,eAXF,CA9CsB,CAAxB;AA6DA,MAAMa,uBAAuB,GAAGtS,KAAK,CAACkH,WAAN,CAAkB,YAAM;AACtDkG,IAAAA,QAAQ,CAACC,mBAAT,CAA6B,WAA7B,EAA0CkE,cAA1C;AACAnE,IAAAA,QAAQ,CAACC,mBAAT,CAA6B,SAA7B,EAAwCiE,aAAxC;AACD,GAH+B,EAG7B,CAACC,cAAD,EAAiBD,aAAjB,CAH6B,CAAhC;AAKA,MAAMiB,mBAAmB,GAAGvS,KAAK,CAACkH,WAAN,CAAkB,UAACU,KAAD,EAAgBG,OAAhB,EAAyCyK,QAAzC,EAA8D;AAAA,QAArBA,QAAqB;AAArBA,MAAAA,QAAqB,GAAV,KAAU;AAAA;;AAC1G,QAAIA,QAAJ,EAAc;AACZ3L,MAAAA,SAAS,CAACM,OAAV,GAAoBN,SAAS,CAACM,OAAV,CAAkBsL,MAAlB,CAAyB7K,KAAzB,EAAgC,CAAhC,CAApB;AACD,KAFD,MAEO;AACLf,MAAAA,SAAS,CAACM,OAAV,CAAkBS,KAAlB,IAA2BG,OAA3B;AACD;;AACDtD,IAAAA,iBAAiB,CAACwC,eAAe,EAAhB,CAAjB;AACD,GAP2B,EAOzB,CAACxC,iBAAD,EAAoBwC,eAApB,CAPyB,CAA5B;AASA,MAAMyL,SAAS,GAAG1S,KAAK,CAACkH,WAAN,CAAkB,YAAM;AAAA,QAChCrC,SADgC,GAClBpB,KAAK,CAAC4H,IADY,CAChCxG,SADgC;;AAExC,QAAI,CAAC6E,KAAK,CAACC,OAAN,CAAc9E,SAAd,CAAL,EAA+B;AAC7B;AACD;;AACD,QAAIM,sBAAsB,KAAK,CAAC,CAAhC,EAAmC;AACjC;AACD;;AACD,QAAMwN,QAAQ,GAAG9N,SAAS,CAACkE,IAAI,CAACD,GAAL,CAAS3D,sBAAT,EAAiCN,SAAS,CAACoG,MAAV,GAAmB,CAApD,CAAD,CAA1B;AACAvH,IAAAA,UAAU,CAACgN,GAAX,CACE,UADF,EAEEvP,cAAc,CACZsC,KADY,EAEZ0B,sBAFY,EAGZ4D,IAAI,CAACC,GAAL,CAAS,CAAT,EAAY7D,sBAAsB,GAAG,CAArC,CAHY,EAIZwN,QAJY,CAFhB;;AASA,QAAIxN,sBAAsB,KAAKN,SAAS,CAACoG,MAAzC,EAAiD;AAC/CoF,MAAAA,kBAAkB,CAAClL,sBAAsB,GAAG,CAA1B,CAAlB;AACD;AACF,GArBiB,EAqBf,CAAC1B,KAAD,EAAQ0B,sBAAR,EAAgCzB,UAAhC,EAA4C2M,kBAA5C,CArBe,CAAlB;AAuBA,MAAMuC,SAAS,GAAG5S,KAAK,CAACkH,WAAN,CAAkB,YAAM;AACxCxD,IAAAA,UAAU,CAACgN,GAAX,CAAe,UAAf,EAA2BxP,eAAe,CAACuC,KAAD,CAA1C;AACD,GAFiB,EAEf,CAACC,UAAD,EAAaD,KAAb,CAFe,CAAlB;AAIA,MAAMoP,kBAAkB,GAAG7S,KAAK,CAACkH,WAAN,CAAkB,YAAM;AACjDxC,IAAAA,uBAAuB,CAAC,IAAD,CAAvB;AACAY,IAAAA,gBAAgB,CAAC,IAAD,CAAhB;AACD,GAH0B,EAGxB,CAACZ,uBAAD,EAA0BY,gBAA1B,CAHwB,CAA3B;AAKA,MAAMwN,wBAAwB,GAAG9S,KAAK,CAACkH,WAAN,CAAkB,YAAM;AACvDxC,IAAAA,uBAAuB,CAAC,KAAD,CAAvB;AACAY,IAAAA,gBAAgB,CAAC,KAAD,CAAhB;AACD,GAHgC,EAG9B,CAACZ,uBAAD,EAA0BY,gBAA1B,CAH8B,CAAjC;AAKA,MAAMyN,qBAAqB,GAAG/S,KAAK,CAACgT,OAAN,CAAc,YAAM;AAChD,QAAI,CAACtJ,KAAK,CAACC,OAAN,CAAc9E,SAAd,CAAL,EAA+B;AAC7B,aAAO,IAAP;AACD;;AAED,QAAIpC,IAAI,GAAG,CAAX;AACA,QAAMuF,QAA8B,GAAG,EAAvC;AACA,QAAMI,kBAAkB,GAAG1E,UAAU,CAACgE,KAAX,CAAiB,oBAAjB,EAAuC;AAChEJ,MAAAA,IAAI,EAAE7D;AAD0D,KAAvC,CAA3B;AAGA,QAAMwP,UAAU,GAAG/K,qBAAqB,EAAxC;AACA,QAAMgL,WAAW,GAAG7N,aAAa,GAAG4N,UAAH,GAAiB,IAAlD;AACA,QAAME,YAAY,GAAGF,UAAU,GAAG,CAACA,UAAD,CAAH,GAAkB,EAAjD;;AACA,QAAI7O,oBAAoB,IAAIgE,kBAA5B,EAAgD;AAC9C+K,MAAAA,YAAY,CAACC,IAAb,CAAkB;AAAE5K,QAAAA,KAAK,EAAE,CAAT;AAAYC,QAAAA,GAAG,EAAE5D,SAAS,CAACoG,MAAV,GAAmB;AAApC,OAAlB;AACD,KAFD,MAEO,IACLtG,cAAc,IACdA,cAAc,CAAC0D,aAAf,KAAiC1D,cAAc,CAAC2D,WAF3C,EAGL;AACA6K,MAAAA,YAAY,CAACC,IAAb,CAAkB;AAChB5K,QAAAA,KAAK,EAAE7D,cAAc,CAAC0D,aADN;AAEhBI,QAAAA,GAAG,EAAE9D,cAAc,CAAC2D;AAFJ,OAAlB;AAID;;AACD,QAAM+K,WAAW,GAAGpP,SAAS,GACzB;AACAuE,MAAAA,KAAK,EAAEvE,SAAS,CAACoE,aADjB;AAEAI,MAAAA,GAAG,EAAExE,SAAS,CAACqE;AAFf,KADyB,GAKzB,IALJ;AAMAzD,IAAAA,SAAS,CAACyO,OAAV,CAAkB,UAACxQ,KAAD,EAAQ8E,KAAR,EAAkB;AAClC,UAAM2L,WAAW,GACf9N,eAAe,CAACF,QAAhB,KAA6B,CAAC,CAA9B,GAAkC9C,IAAI,GAAGK,KAAzC,GAAiD2C,eAAe,CAAChD,IADnE;AAGA,UAAM+Q,UAAU,GACd,CAAC/R,uBAAuB,GAAGD,6BAA3B,IAA4D6B,KAD9D,CAJkC,CAOlC;;AACA,UAAMoQ,UAAU,GAAG7L,KAAK,KAAK,CAAV,GAAc,KAAd,GAAsB,KAAzC;AACA,UAAM8L,UAAU,GAAG9L,KAAK,KAAK/C,SAAS,CAACoG,MAAV,GAAmB,CAAhD;AACAjD,MAAAA,QAAQ,CAACoL,IAAT,eACE,eAAC,KAAD,CAAO,QAAP;AAAgB,QAAA,GAAG,EAAExL;AAArB,sBACE,eAAC,mBAAD;AACE,QAAA,WAAW,EAAEyL,WADf;AAEE,QAAA,YAAY,EAAEF,YAFhB;AAGE,QAAA,WAAW,EAAED,WAHf;AAIE,QAAA,KAAK,EAAEtL,KAJT;AAKE,QAAA,KAAK,EAAEvE,KALT;AAME,QAAA,aAAa,EAAE4K,iBANjB;AAOE,QAAA,WAAW,EAAE4D,eAPf;AAQE,QAAA,YAAY,EAAE1D,8BARhB;AASE,QAAA,UAAU,EAAEM,4BATd;AAUE,QAAA,YAAY,EAAE8D;AAVhB,SAYG3K,KAAK,KAAK,CAAV,IAAe7C,cAAf,GAAgC,IAAhC,gBACC,eAAC,qBAAD;AACE,QAAA,KAAK,EAAE1B,KADT;AAEE,QAAA,OAAO,EAAEqP,SAFX;AAGE,QAAA,KAAK,EAAE;AACLiB,UAAAA,UAAU,EAAE,OADP;AAELC,UAAAA,SAAS,kBAAgBH,UAAhB,WAAgCD,UAAhC;AAFJ;AAHT,QAbJ,EAsBGE,UAAU,gBACT,eAAC,qBAAD;AACE,QAAA,KAAK,EAAErQ,KADT;AAEE,QAAA,OAAO,EAAEqP,SAFX;AAGE,QAAA,KAAK,EAAE;AACLiB,UAAAA,UAAU,EAAE,OADP;AAELlR,UAAAA,IAAI,EAAKK,KAAL,OAFC;AAGL8Q,UAAAA,SAAS,yBAAuBJ,UAAvB,QAHJ;AAG4C;AACjDK,UAAAA,cAAc,EAAE;AAJX;AAHT,QADS,GAWP,IAjCN,CADF,eAoCE,eAAC,iBAAD;AACE,sBAAYjM,KADd;AAEE,qBAAU,aAFZ;AAGE,QAAA,KAAK,EAAEvE,KAHT;AAIE,QAAA,KAAK,EAAE;AACLZ,UAAAA,IAAI,EAAE8Q,WADD;AAELzQ,UAAAA,KAAK,EAAE8E,KAAK,KAAK/C,SAAS,CAACoG,MAAV,GAAmB,CAA7B,GAAiC,KAAjC,GAAyC;AAF3C,SAJT;AAQE,QAAA,WAAW,EAAE0C;AARf,QApCF,CADF;AAiDAlL,MAAAA,IAAI,IAAIK,KAAR;AACD,KA5DD;AA6DA,WAAOkF,QAAP;AACD,GA5F6B,EA4F3B,CACDnD,SADC,EAEDnB,UAFC,EAGDD,KAHC,EAIDyE,qBAJC,EAKD7C,aALC,EAMDjB,oBANC,EAODO,cAPC,EAQDV,SARC,EASDwB,eAAe,CAACF,QATf,EAUDE,eAAe,CAAChD,IAVf,EAWDY,KAXC,EAYD4K,iBAZC,EAaD4D,eAbC,EAcD1D,8BAdC,EAeDM,4BAfC,EAgBD8D,mBAhBC,EAiBDxN,cAjBC,EAkBD2N,SAlBC,EAmBD/E,oBAnBC,CA5F2B,CAA9B;AAkHA,MAAMmG,YAAY,GAAG9T,KAAK,CAACkH,WAAN,CAAkB,YAAM;AAC3C,WAAO,CAACjC,kBAAD,IACLnB,aADK,IAELO,qBAAqB,OAAOZ,KAAK,CAAC6K,GAF7B,IAGLrK,SAHF;AAID,GALoB,EAKlB,CAACgB,kBAAD,EAAqBnB,aAArB,EAAoCO,qBAApC,EAA2DZ,KAAK,CAAC6K,GAAjE,EAAsErK,SAAtE,CALkB,CAArB,CAr9BoD,CA49BpD;;AACA,MAAM8P,YAAY,GAAG/T,KAAK,CAACkH,WAAN,CAAkB,YAAM;AAC3C,WAAO4M,YAAY,MACjBrM,gBAAgB,EADX,IAELqJ,gBAAgB,EAFX,IAGL3L,sBAAsB,KAAK,CAAC,CAHvB,IAIL,CAACU,UAJI,IAKL,CAAC1B,kBALH;AAMD,GAPoB,EAOlB,CAAC2P,YAAD,EAAerM,gBAAf,EAAiCqJ,gBAAjC,EAAmD3L,sBAAnD,EAA2EU,UAA3E,EAAuF1B,kBAAvF,CAPkB,CAArB;AASA,MAAM6P,eAAe,GAAGhU,KAAK,CAACkH,WAAN,CAAkB/G,QAAQ,CAAC,UAACkM,KAAD,EAAW;AAC5D,QACExG,UAAU,IACVqI,aAAa,EADb,IAEA,CAACrK,eAAe,CAACsD,OAHnB,EAIE;AACA;AACD;;AAED,QAAI,CAACnD,eAAL,EAAsB;AACpBqM,MAAAA,kBAAkB,CAAC,CAAC,CAAF,CAAlB;AACA;AACD;;AACD,QAAMc,SAAS,GAAG/J,YAAY,EAA9B;;AACA,QAAI+J,SAAS,CAAClG,MAAV,KAAqB,CAAzB,EAA4B;AAC1B;AACD;;AAhB2D,QAiBpD2D,OAjBoD,GAiB/BvC,KAjB+B,CAiBpDuC,OAjBoD;AAAA,QAiB3CoC,OAjB2C,GAiB/B3E,KAjB+B,CAiB3C2E,OAjB2C,EAkB5D;;AACA,QAAI7L,sBAAsB,KAAK,CAAC,CAA5B,IAAiCyB,eAAe,CAACO,OAArD,EAA8D;AAC5D,UAAM+C,gBAAgB,GAAGjK,QAAQ,CAAC6H,WAAT,CACvBlB,eAAe,CAACO,OADO,CAAzB;;AAD4D,kCAIvB+C,gBAAgB,CAAC1C,qBAAjB,EAJuB;AAAA,UAIpD/E,IAJoD,yBAIpDA,IAJoD;AAAA,UAI9CC,GAJ8C,yBAI9CA,GAJ8C;AAAA,UAIzCC,KAJyC,yBAIzCA,KAJyC;AAAA,UAIlCC,MAJkC,yBAIlCA,MAJkC;;AAK5D,UACEgM,OAAO,IAAInM,IAAX,IACAmM,OAAO,IAAIjM,KADX,IAEAqO,OAAO,IAAItO,GAFX,IAGAsO,OAAO,IAAIpO,MAJb,EAKE;AACA;AACD;AACF;;AACD,QAAMiM,UAAU,GAAGhL,eAAe,CAACsD,OAAhB,CAAwBK,qBAAxB,EAAnB;;AACA,QAAIoH,OAAO,GAAGC,UAAU,CAACpM,IAArB,IAA6BmM,OAAO,GAAGC,UAAU,CAAClM,KAAtD,EAA6D;AAC3D0N,MAAAA,kBAAkB,CAAC,CAAC,CAAF,CAAlB;AACA;AACD;;AACD,QAAId,WAAW,GAAG,CAAC,CAAnB;;AACA,SAAK,IAAIU,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGkB,SAAS,CAAClG,MAA9B,EAAsCgF,CAAC,EAAvC,EAA2C;AACzC,UAAMhI,OAAO,GAAGkJ,SAAS,CAAClB,CAAD,CAAzB,CADyC,CAEzC;;AACA,UAAI,CAAChI,OAAL,EAAc;;AACd,UACE+I,OAAO,GAAG/I,OAAO,CAACvF,GAAlB,IACAsO,OAAO,IAAI/I,OAAO,CAACvF,GAAR,GAAcjB,uBAF3B,EAGE;AACA,YACEmN,OAAO,IAAI3G,OAAO,CAACxF,IAAR,GAAehB,uBAAuB,GAAG,CAApD,IACAmN,OAAO,IAAI3G,OAAO,CAACxF,IAAR,GAAehB,uBAAuB,GAAG,CAFtD,EAGE;AACA8N,UAAAA,WAAW,GAAGU,CAAd;AACA;AACD,SAND,MAMO,IACLrB,OAAO,IAAI3G,OAAO,CAACxF,IAAR,GAAewF,OAAO,CAACnF,KAAvB,GAA+BrB,uBAAuB,GAAG,CAApE,IACAmN,OAAO,IAAI3G,OAAO,CAACxF,IAAR,GAAewF,OAAO,CAACnF,KAAvB,GAA+BrB,uBAAuB,GAAG,CAF/D,EAGL;AACA8N,UAAAA,WAAW,GAAGU,CAAC,GAAG,CAAlB;AACA;AACD;AACF;AACF;;AACD,QAAMgE,WAAW,GAAGvL,sBAAsB,EAA1C,CA9D4D,CA+D5D;;AACA,QACEuL,WAAW,IACX1E,WAAW,GAAG0E,WAAW,CAACnL,GAD1B,IAEAyG,WAAW,GAAG0E,WAAW,CAACjL,GAAZ,GAAkB,CAHlC,EAIE;AACAuG,MAAAA,WAAW,GAAG,CAAC,CAAf;AACD;;AACDc,IAAAA,kBAAkB,CAACd,WAAD,CAAlB;AACD,GAxEiD,EAwE/C,GAxE+C,EAwE1C;AAAE2E,IAAAA,OAAO,EAAE;AAAX,GAxE0C,CAA1B,EAyEtB,CAACrQ,eAAD,EAAkBG,eAAlB,EAAmCmB,sBAAnC,EAA2DU,UAA3D,EAAuEqI,aAAvE,EAAsF9G,YAAtF,EAAoGsB,sBAApG,CAzEsB,CAAxB;AA2EA,MAAMyL,uBAAuB,GAAGnU,KAAK,CAACkH,WAAN,CAAkB,YAAM;AACtD,QAAI,CAACP,eAAe,CAACQ,OAAjB,IAA4B,CAAClD,SAA7B,IAA0C,CAAC8P,YAAY,EAA3D,EAA+D;AAC7D;AACD;;AAED,QAAMK,QAAQ,GAAGnU,QAAQ,CAAC6H,WAAT,CAAqBnB,eAAe,CAACQ,OAArC,CAAjB;AACA,QAAMkN,QAAQ,GAAG9T,uBAAuB,CAAC6T,QAAD,EAAWtQ,aAAX,CAAxC;AACA,QAAMsG,MAAM,GAAGnB,gBAAgB,EAA/B;;AACA,QAAI,CAACmB,MAAL,EAAa;AACX;AACD;;AAVqD,QAW9C1H,GAX8C,GAWtC0H,MAXsC,CAW9C1H,GAX8C;AAYtD,QAAM4R,YAAY,GAAG3M,cAAc,CAAC1D,SAAS,CAACoE,aAAX,CAAnC;AACA,QAAMkM,UAAU,GAAG5M,cAAc,CAAC1D,SAAS,CAACqE,WAAX,CAAjC;;AACA,QAAI,CAACgM,YAAD,IAAiB,CAACC,UAAtB,EAAkC;AAChC;AACD;;AACD,QAAMC,GAAG,GAAG,CAACD,UAAU,CAAC5R,KAAX,GAAmB2R,YAAY,CAAC7R,IAAjC,IAAyC,CAArD;AACA,QAAMgS,aAAa,GAAGH,YAAY,CAAC7R,IAAnC;AACA,QAAM2G,YAAY,GAAGqL,aAAa,GAAGD,GAAhB,GAAsBH,QAAQ,CAACvR,KAAT,GAAiB,CAA5D;AAEAsR,IAAAA,QAAQ,CAAC3J,KAAT,CAAe/H,GAAf,GAAwBA,GAAG,GAAGW,KAAN,GAAc+Q,QAAQ,CAAC5J,YAAvB,GAAsC/J,0CAA9D;AACAqG,IAAAA,mBAAmB,CAACK,OAApB,GAA8BiC,YAAY,GAAG/F,KAA7C;AACA+Q,IAAAA,QAAQ,CAAC3J,KAAT,CAAehI,IAAf,GAAyBqE,mBAAmB,CAACK,OAApB,GAA8B,CAAvD;AACA,QAAMuD,UAAU,GAAGvB,gBAAgB,CAACC,YAAD,CAAnC;;AACA,QAAIsB,UAAJ,EAAgB;AACd0J,MAAAA,QAAQ,CAAC3J,KAAT,CAAe2F,OAAf,GAAyB,GAAzB;AACD,KAFD,MAEO;AACLgE,MAAAA,QAAQ,CAAC3J,KAAT,CAAe2F,OAAf,GAAyB,GAAzB;AACD;AACF,GA9B+B,EA8B7B,CAACnM,SAAD,EAAYH,aAAZ,EAA2BT,KAA3B,EAAkC4F,gBAAlC,EAAoDE,gBAApD,EAAsExB,cAAtE,EAAsFoM,YAAtF,CA9B6B,CAAhC;AAgCA/T,EAAAA,KAAK,CAAC0U,eAAN,CAAsB,YAAM;AAC1B;AACA,QAAI1Q,eAAJ,EAAqB;AACnB5D,MAAAA,OAAO,CAACuU,OAAR,CAAgB,YAAM;AACpBR,QAAAA,uBAAuB;AACvBnK,QAAAA,uBAAuB;AACvBgC,QAAAA,oBAAoB;AACpBZ,QAAAA,2BAA2B;AAC5B,OALD;AAMD;AACF,GAVD,EAUG,CAAC+I,uBAAD,EAA0BnK,uBAA1B,EAAmDgC,oBAAnD,EAAyEZ,2BAAzE,EAAsGpH,eAAtG,CAVH;AAaAhE,EAAAA,KAAK,CAAC8L,SAAN,CAAgB,YAAM;AACpB,WAAO,YAAM;AACXsB,MAAAA,QAAQ,CAACC,mBAAT,CAA6B,WAA7B,EAA0CjB,iBAA1C;AACAgB,MAAAA,QAAQ,CAACC,mBAAT,CAA6B,SAA7B,EAAwCC,kBAAxC;AACAF,MAAAA,QAAQ,CAACC,mBAAT,CAA6B,WAA7B,EAA0C2G,eAA1C;AACAnE,MAAAA,yBAAyB;AACzByC,MAAAA,uBAAuB;AACxB,KAND;AAOD,GARD,EAQG,EARH;AAUAtS,EAAAA,KAAK,CAAC8L,SAAN,CAAgB,YAAM;AACpB,QAAI,CAAC9H,eAAD,IAAoB,CAAC0F,KAAK,CAACC,OAAN,CAAc9E,SAAd,CAAzB,EAAmD;AACjD,aAAOwE,SAAP;AACD;;AACD+D,IAAAA,QAAQ,CAACU,gBAAT,CAA0B,WAA1B,EAAuCkG,eAAvC;;AACA,QAAI/O,kBAAJ,EAAwB;AACtBmI,MAAAA,QAAQ,CAACU,gBAAT,CAA0B,WAA1B,EAAuCX,eAAvC;AACA,aAAO,YAAM;AACXC,QAAAA,QAAQ,CAACC,mBAAT,CAA6B,WAA7B,EAA0CF,eAA1C;AACAC,QAAAA,QAAQ,CAACC,mBAAT,CAA6B,WAA7B,EAA0C2G,eAA1C;AACD,OAHD;AAID;;AACD,WAAO,YAAM;AACX5G,MAAAA,QAAQ,CAACC,mBAAT,CAA6B,WAA7B,EAA0C2G,eAA1C;AACD,KAFD;AAGD,GAfD,EAeG,CAAChQ,eAAD,EAAkBa,SAAlB,EAA6BmP,eAA7B,EAA8C/O,kBAA9C,EAAkEkI,eAAlE,CAfH;AAiBA,MAAMrK,KAAK,GAAG,CAAC+B,SAAS,IAAI,EAAd,EAAkBgF,MAAlB,CAAyB,UAACC,GAAD,EAAMC,CAAN;AAAA,WAAYD,GAAG,GAAGC,CAAlB;AAAA,GAAzB,EAA8C,CAA9C,CAAd;AACA,MAAMU,KAA0B,GAAG;AACjC3H,IAAAA,KAAK,EAAEA,KAAK,GAAG,CADkB;AACf;AAClBD,IAAAA,MAAM,EAAKkG,IAAI,CAACoD,KAAL,CAAWrL,iBAAiB,GAAGuC,KAA/B,CAAL,OAF2B;AAGjCuR,IAAAA,YAAY,EAAK7L,IAAI,CAACoD,KAAL,CAAW,IAAI9I,KAAf,CAAL;AAHqB,GAAnC;;AA1nCoD,8BAgoC/BhB,0BAA0B,EAhoCK;AAAA,MAgoC7CwM,UAhoC6C;;AAioCpD,MAAMgG,cAAc,GAAGvS,4BAA4B,EAAnD;AACA,MAAMwS,eAAe,GAAGvS,iCAAiC,EAAzD;AAEAvC,EAAAA,KAAK,CAAC0U,eAAN,CAAsB,YAAM;AAC1B,QAAI,CAACvO,iBAAiB,CAACgB,OAAnB,IAA8B,CAACrC,QAAnC,EAA6C;AAE7CqB,IAAAA,iBAAiB,CAACgB,OAAlB,CAA0B4N,UAA1B,GAAuCD,eAAvC;AACD,GAJD,EAIG,CAAChQ,QAAD,EAAWgQ,eAAX,CAJH,EApoCoD,CA0oCpD;;AACA,MAAME,kBAAkB,GAAG,CAACnP,UAAD,IAAeV,sBAAsB,KAAK,CAAC,CAAtE;AACA,MAAM8P,WAAW,GAAIpP,UAAU,IAAIlC,QAAQ,CAACwD,OAAxB,GAChBxD,QAAQ,CAACwD,OAAT,CAAiBqD,YADD,GAEhB,CAFJ;AAGA,MAAM0K,UAAU,GAAG,CAAC,CAACpB,YAAY,EAAd,IAAoBkB,kBAAvC;AAEA,MAAMG,YAAiC,GAAG,EAA1C;;AACA,MAAInR,eAAJ,EAAqB;AACnBmR,IAAAA,YAAY,CAACxK,UAAb,GAA0B,SAA1B;AACAwK,IAAAA,YAAY,CAACC,aAAb,GAA6B,MAA7B;AACD;;AACD,MAAItQ,QAAJ,EAAc;AACZqQ,IAAAA,YAAY,CAACrS,KAAb,GAAqB+R,cAArB;AACAM,IAAAA,YAAY,CAACE,UAAb,GAA0B,OAA1B;;AACA,QAAIC,MAAM,CAACC,QAAP,CAAgB1G,UAAU,CAACnM,GAA3B,CAAJ,EAAqC;AACnCyS,MAAAA,YAAY,CAACzS,GAAb,GAAmBmM,UAAU,CAACnM,GAA9B;AACD;;AACD,QAAI4S,MAAM,CAACC,QAAP,CAAgB1G,UAAU,CAACpM,IAA3B,CAAJ,EAAsC;AACpC0S,MAAAA,YAAY,CAAC1S,IAAb,GAAoBoM,UAAU,CAACpM,IAA/B;AACD;AACF;;AAED,sBACE,eAAC,OAAD;AACE,IAAA,KAAK,EAAE0S,YADT;AAEE,mBAAarQ,QAFf;AAGE,IAAA,GAAG,EAAEqB,iBAHP;AAIE,mBAAY;AAJd,kBAME,eAAC,iBAAD;AACE,IAAA,IAAI,EAAC,SADP;AAEE,IAAA,GAAG,EAAEF,aAFP;AAGE,IAAA,KAAK,EAAEwE,KAHT;AAIE,mBAAY,mBAJd;AAKE,IAAA,WAAW,EAAEiE,eALf;AAME,IAAA,UAAU,EAAEO;AANd,KAQG8D,qBARH,eASE,eAAC,UAAD;AACE,IAAA,KAAK,EAAE;AACLyC,MAAAA,OAAO,EAAE/P,eAAe,CAACF,QAAhB,KAA6B,CAAC,CAA9B,GAAkC,MAAlC,GAA2C,OAD/C;AAEL9C,MAAAA,IAAI,EAAEgD,eAAe,CAAChD,IAFjB;AAGLC,MAAAA,GAAG,EAAE+C,eAAe,CAAC/C,GAHhB;AAILG,MAAAA,MAAM,EAAE4C,eAAe,CAACD;AAJnB;AADT,IATF,eAiBGvF,QAAQ,CAACwV,YAAT,eACC,eAAC,gBAAD;AACE,IAAA,KAAK,EAAE;AACL9K,MAAAA,UAAU,EAAEoJ,YAAY,KAAK,SAAL,GAAiB,QADpC;AAEL2B,MAAAA,UAAU,EAAE;AAFP,KADT;AAKE,IAAA,GAAG,EAAE/O,eALP;AAME,mBAAY;AANd,kBAQE,eAAC,yBAAD;AACE,IAAA,IAAI,EAAC,KADP;AAEE,IAAA,MAAM,EAAEzC,MAFV;AAGE,IAAA,KAAK,EAAEb,KAHT;AAIE,IAAA,QAAQ,EAAEuP,SAJZ;AAKE,IAAA,oBAAoB,EAAEC,kBALxB;AAME,IAAA,0BAA0B,EAAEC;AAN9B,IARF,CADD,EAkBChP,aAlBD,CAjBH,eAqCG7D,QAAQ,CAACwV,YAAT,eACC,eAAC,gBAAD;AACE,IAAA,KAAK,EAAE;AACLrF,MAAAA,OAAO,EAAE8E,UAAU,GAAG,CAAH,GAAO,CADrB;AAELE,MAAAA,aAAa,EAAEF,UAAU,GAAG,MAAH,GAAY;AAFhC,KADT;AAKE,IAAA,GAAG,EAAEtO,eALP;AAME,mBAAY;AANd,kBAQE,eAAC,yBAAD;AACE,IAAA,MAAM,EAAE1C,MADV;AAEE,IAAA,KAAK,EAAET,KAFT;AAGE,IAAA,SAAS,EAAEQ,SAHb;AAIE,IAAA,IAAI,EAAC,KAJP;AAKE,IAAA,QAAQ,EAAEN,QALZ;AAME,IAAA,KAAK,EAAEN,KANT;AAOE,IAAA,QAAQ,EAAEqP,SAPZ;AAQE,IAAA,aAAa,EAAE5O,aARjB;AASE,IAAA,WAAW,EAAEqB,sBATf;AAUE,IAAA,eAAe,EAAE8B,eAVnB;AAWE,IAAA,sBAAsB,EAAEiJ;AAX1B,IARF,CADD,EAuBCpM,aAvBD,CArCH,EA8DGA,aAAa,iBAAI7D,QAAQ,CAACwV,YAAT,eAChB,eAAC,WAAD;AACE,IAAA,GAAG,EAAE1O,cADP;AAEE,IAAA,OAAO,EAAElB,UAFX;AAGE,IAAA,KAAK,EAAEE,gBAHT;AAIE,IAAA,MAAM,EAAEkP,WAAW,GAAGnU;AAJxB,IADgB,EAOhBgD,aAPgB,CA9DpB,CANF,CADF;AAiFD;;AAED,eAAelC,8BAA8B,CAAC4B,eAAD,CAA7C","sourcesContent":["/* eslint-disable @typescript-eslint/no-shadow */\n/* eslint-disable max-lines */\n/* eslint-disable react/no-find-dom-node */\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport styled from 'styled-components';\nimport { throttle } from 'lodash-es';\nimport fastdom from 'fastdom';\nimport { domUtils } from '@ali/4ever-cangjie';\nimport Table from '../../../mo/models';\nimport {\n  getBoundingRelativeRect,\n  getRelativeMouseEvent,\n} from '@ali/4ever-utils';\nimport {\n  DISTANCE_BETWEEN_DELETE_BUTTON_AND_TOOLBAR,\n  DISTANCE_BETWEEN_INSERT_BUTTON_AND_TOOLBAR,\n  DRAG_TRIGGER_TIME,\n  MIN_COL_WIDTH,\n  THEME,\n  TOOLBAR_ITEM_SIZE,\n} from '../../constants';\nimport { TableColToolbarItem } from './tableColToolbarItem';\nimport { ColResizer } from '../styled';\nimport { ISelectedIndexRange, ITableSelection } from '../../types';\nimport {\n  clickTableToolbar,\n  deleteTableCols,\n  insertTableCol,\n  moveTableCols,\n} from '../../actions';\nimport InlineToolbarInsertButton from '../inlineToolbarButtons/inlineToolbarInsertButton';\nimport InlineToolbarDeleteButton from '../inlineToolbarButtons/inlineToolbarDeleteButton';\nimport InsertButtonIndicator, {\n  GAP_BEWTEEN_INDICATOR_TOOLBAR,\n  INDICATOR_WRAPPER_WIDTH,\n} from '../inlineToolbarButtons/insertButtonIndicator';\nimport DragElement from '../colToolbar/dragElement';\nimport { scrollHorizontal } from '../../utils/scrollContainer';\nimport createToolbarWithTableSeletion from '../createToolbarWithTableSelection';\nimport type { TableColToolbarProps } from '../createToolbarWithTableSelection';\nimport getDataTableSelectionByTable from '../../utils/getDataTableSelectionByTable';\nimport {\n  REALTABLE_PADDING,\n  SCROLL_BAR_HEIGHT,\n  STICKY_ROW_TOP_HEIGHT,\n  STICKY_TOOLBAR_INDEX_MAP,\n} from '../../../utils/constants';\nimport * as hooks from '../../../utils/hooks';\n\nconst {\n  usePixelColsWidth,\n  useRowIsSticky,\n  useScrollableContainerRect,\n  useTableScrollContainerWidth,\n  useTableScrollContainerScrollLeft,\n} = hooks;\n\nconst fallbackRect = {\n  left: -1,\n  top: -1,\n  right: -1,\n  bottom: -1,\n  height: -1,\n  width: -1,\n};\n\nconst Wrapper = styled.div`\n  visibility: hidden;\n  pointer-events: none;\n\n  &[data-sticky=\"true\"] {\n    position: fixed;\n    height: ${STICKY_ROW_TOP_HEIGHT}px;\n    overflow: hidden;\n    z-index: ${STICKY_TOOLBAR_INDEX_MAP.colToolbar};\n\n    [data-testid=\"table-col-toolbar\"] {\n      position: absolute;\n      bottom: 0;\n    }\n  }\n`;\n\nconst ColToolbarWrapper = styled.div`\n  position: relative;\n  z-index: 3;\n`;\n\nconst ColToolbarResizer = styled.div<{ scale: number }>`\n  position: absolute;\n  top: 0;\n  width: 7px;\n  height: ${(props) => ((TOOLBAR_ITEM_SIZE) / props.scale)}px;\n  margin-left: -3px;\n  background-color: transparent;\n  z-index: 1;\n  cursor: col-resize;\n\n  &:hover {\n    background-color: ${THEME.blue3};\n  }\n`;\n\nconst ColInlineToolbar = styled.div`\n  position: absolute;\n  z-index: 101;\n  transition: opacity ease-in-out 0.25s;\n`;\n\ninterface ResizingColData {\n  colIndex: number;\n  left: number;\n  top: number;\n  colResizerHeight: number;\n}\n\nfunction TableColToolbar(props: TableColToolbarProps) {\n  const {\n    table,\n    controller,\n    tableRef,\n    positionedAncestorRef,\n    scrollContainer,\n    zoomContainer,\n    colIndicatorRef,\n    isTableSelected,\n    selection,\n    scale,\n    locale,\n    isHideDeleteButton,\n    isHoverCornerToolbar,\n    getLastActiveTableKey,\n    onContextMenu,\n    onSelect,\n    onColResize,\n    onGetAllColsNodes,\n    setIsHighlightSelection,\n    hoverSelection,\n    setHoverSelection,\n  } = props;\n\n  const [colsWidth] = usePixelColsWidth();\n  const [isSticky] = useRowIsSticky();\n  const isColumnHeader = Table.isColumnHeader(table);\n\n  const [contextMenuVisible, setContextMenuVisible] = React.useState<boolean>(false);\n  const [positionOfInsertButton, setPositionOfInsertButton] = React.useState<number>(-1);\n  const [isHoverDelete, setIsHoverDelete] = React.useState<boolean>(false);\n  const [resizingColData, setResizingColData] = React.useState<ResizingColData>({ colIndex: -1, left: 0, top: 0, colResizerHeight: 0 });\n  const [hoverToolbarItemIndex, setHoverToolbarItemIndex] = React.useState<number>(-1);\n  const [isDragging, setIsDragging] = React.useState<boolean>(false);\n  const [draggingColWidth, setDraggingColWidth] = React.useState<number>(0);\n\n  const colToolbarRef = React.useRef<HTMLDivElement>(null);\n\n  const toolbarWrapperRef = React.useRef<HTMLDivElement>(null);\n\n  const resizingColDataRef = React.useRef<ResizingColData>({ colIndex: -1, left: 0, top: 0, colResizerHeight: 0 });\n\n  const colSelectionRectRef = React.useRef<HTMLDivElement>(null);\n\n  const insetBtnPosRef = React.useRef<number>(-1);\n\n  const draggingColResizerRef = React.useRef<HTMLDivElement | null>(null);\n\n  const startClientXRef = React.useRef<number | null>(null);\n\n  const startPositionLeftRef = React.useRef<number>(0);\n\n  const originBodyCursorRef = React.useRef<string>('');\n\n  const deleteButtonRef = React.useRef<HTMLDivElement>(null);\n\n  const insertButtonRef = React.useRef<HTMLDivElement>(null);\n\n  const colsNodes = React.useRef<HTMLDivElement[]>([]);\n\n  const deleteButtonLeftRef = React.useRef<number>(-1);\n\n  const dragElementRef = React.useRef<HTMLDivElement>(null);\n\n  const startSelectIndexRef = React.useRef<number>(-1);\n\n  const getAllColsNodes = React.useCallback(() => {\n    return colsNodes.current;\n  }, []);\n\n  const getColsRects = React.useCallback(() => {\n    return getAllColsNodes().map(\n      (node) => {\n        const rect = node.getBoundingClientRect();\n        return rect || fallbackRect;\n      },\n    );\n  }, [getAllColsNodes]);\n\n  const isSelectWholeCol = React.useCallback(() => {\n    return controller.query('isSelectWholeCol', {\n      node: table,\n    });\n  }, [controller, table]);\n\n  const getColItemRect = React.useCallback((index: number): DOMRect | null => {\n    const thisNode = ReactDOM.findDOMNode(colToolbarRef.current) as HTMLElement;\n    const colNode = thisNode.children[index * 2] as HTMLDivElement;\n    if (!colNode) {\n      return null;\n    }\n    const colRect = getBoundingRelativeRect(colNode, zoomContainer) as DOMRect;\n    return colRect;\n  }, [zoomContainer]);\n\n\n  const getSelectedIndexRange = React.useCallback(() => {\n    if (!selection) {\n      return null;\n    }\n    const tableSelection = getDataTableSelectionByTable(controller, table);\n\n    if (!tableSelection) {\n      return null;\n    }\n    const isSelectWholeTable = controller.query('isSelectWholeTable', {\n      node: table,\n    });\n    if (isSelectWholeTable) {\n      return null;\n    }\n\n    const {\n      startColIndex,\n      endColIndex,\n    } = tableSelection as ITableSelection;\n    if (!table.nodes) {\n      return null;\n    }\n    if (isSelectWholeCol()) {\n      return {\n        start: startColIndex,\n        end: endColIndex,\n      };\n    }\n    return null;\n  }, [controller, table, selection, isSelectWholeCol]);\n\n  const getSortedSelectedRange = React.useCallback((r?: ISelectedIndexRange) => {\n    const selectedIndexRange = getSelectedIndexRange();\n    const range = r || selectedIndexRange;\n    if (!range) {\n      return null;\n    }\n    const { start, end } = range;\n    const min = Math.min(start, end);\n    const max = Math.max(start, end);\n    return {\n      min,\n      max,\n    };\n  }, [getSelectedIndexRange]);\n\n  const getColToolbarTop = React.useCallback(() => {\n    if (!selection) {\n      return null;\n    }\n    const thisNode = ReactDOM.findDOMNode(colToolbarRef.current) as HTMLElement;\n    const thisRect = getBoundingRelativeRect(thisNode, zoomContainer);\n\n    return {\n      top: thisRect.top,\n    };\n  }, [selection, zoomContainer]);\n\n  const shouldHideButton = React.useCallback((relativeLeft: number) => {\n    const thisNode = ReactDOM.findDOMNode(colToolbarRef.current);\n    if (!thisNode || !scrollContainer.current) {\n      return undefined;\n    }\n    const tableRect = getBoundingRelativeRect(scrollContainer.current, zoomContainer);\n    return relativeLeft < -26 ||\n      relativeLeft - tableRect.right > 0;\n  }, [zoomContainer, scrollContainer]);\n\n  const calcColsWidth = React.useCallback((startIndex: number, endIndex: number) => {\n    if (!Array.isArray(colsWidth)) {\n      return 0;\n    }\n\n    if (endIndex < startIndex) return 0;\n\n    return colsWidth\n      .slice(startIndex, endIndex + 1)\n      .reduce((acc, w) => {\n        return acc + w;\n      }, 0);\n  }, [colsWidth]);\n\n  // @ts-ignore\n  const updateInsertButtonStyle = React.useCallback(() => {\n    if (\n      !selection\n      || positionOfInsertButton === -1\n      || !toolbarWrapperRef.current\n      || positionOfInsertButton === -1\n      || !Array.isArray(colsWidth)\n    ) {\n      return;\n    }\n\n    let relativeLeft = -1;\n    const toolbarRect = getBoundingRelativeRect(toolbarWrapperRef.current, zoomContainer);\n\n    const insertButtonNode = ReactDOM.findDOMNode(insertButtonRef.current) as HTMLElement;\n    if (!insertButtonNode) {\n      return;\n    }\n    const insertButtonRect = getBoundingRelativeRect(insertButtonNode, zoomContainer);\n\n    relativeLeft = calcColsWidth(0, positionOfInsertButton - 1) + toolbarRect.left;\n    relativeLeft -= insertButtonRect.width / 2;\n\n    const result = getColToolbarTop();\n    if (!result) return null;\n\n    const { top } = result;\n    const insertButtonLeft = relativeLeft / scale + 1; // 1px作为修正值\n    const curTop = Math.abs(top / scale - insertButtonNode.offsetHeight - DISTANCE_BETWEEN_INSERT_BUTTON_AND_TOOLBAR);\n    insertButtonNode.style.top = `${curTop}px`;\n    insertButtonNode.style.left = `${insertButtonLeft}px`;\n    const shouldHide = shouldHideButton(relativeLeft);\n    if (shouldHide) {\n      insertButtonNode.style.visibility = 'hidden';\n    } else {\n      insertButtonNode.style.visibility = 'visible';\n    }\n  }, [selection, positionOfInsertButton, colsWidth, zoomContainer, calcColsWidth, getColToolbarTop, scale, shouldHideButton]);\n\n  const setRectStyle = React.useCallback(\n    (\n      node: HTMLDivElement,\n      startIndex: number,\n      endIndex: number,\n      bgColor: string,\n      borderColr: string,\n    ) => {\n      if (!Array.isArray(colsWidth)) {\n        return;\n      }\n      const left = calcColsWidth(0, startIndex - 1);\n      node.style.left = `${left}px`;\n      const width = calcColsWidth(startIndex, endIndex);\n      node.style.border = `1px solid ${borderColr}`;\n      node.style.borderBottom = 'unset';\n      if (endIndex === colsWidth!.length - 1) {\n        node.style.borderTopRightRadius = '3px';\n      } else {\n        node.style.borderTopRightRadius = 'unset';\n      }\n      node.style.width = `${width + 1}px`;\n      if (bgColor) {\n        node.style.backgroundColor = bgColor;\n      }\n    },\n    [colsWidth, calcColsWidth],\n  );\n\n  const updateColSelectionRectStyle = React.useCallback(() => {\n    const selectedIndexRange = getSelectedIndexRange();\n    if (!selection || !table.data.colsWidth || isHoverCornerToolbar) {\n      return;\n    }\n    const { startColIndex, endColIndex } = selection;\n    const colSelectionNode = ReactDOM.findDOMNode(colSelectionRectRef.current) as HTMLDivElement;\n    if (!colSelectionNode) {\n      return;\n    }\n    // 全选表格的时候工具栏背景色也需要变化\n    const isSelectWholeTable = controller.query('isSelectWholeTable', {\n      node: table,\n    });\n    if (selectedIndexRange || isSelectWholeTable) {\n      const bgColor = isHoverDelete ? THEME.red1 : THEME.blue1;\n      const borderColor = isHoverDelete ? THEME.red1 : THEME.blue3;\n      setRectStyle(colSelectionNode, startColIndex, endColIndex, bgColor, borderColor);\n    } else {\n      setRectStyle(colSelectionNode, startColIndex, endColIndex, THEME.toolbarBgColor.hover, THEME.toolbarBorderColor);\n    }\n  }, [getSelectedIndexRange, selection, table, controller, isHoverDelete, setRectStyle, isHoverCornerToolbar]);\n\n  // hover到汉堡的时候高亮工具栏\n  const setItemsRectStyleByRange = React.useCallback((startColIndex: number, endColIndex: number, bgColor: string, borderColor: string) => {\n    const colSelectionNode = ReactDOM.findDOMNode(colSelectionRectRef.current) as HTMLDivElement;\n    if (!colSelectionNode) {\n      return;\n    }\n    setRectStyle(colSelectionNode, startColIndex, endColIndex, bgColor, borderColor);\n  }, [setRectStyle]);\n\n  React.useEffect(() => {\n    const colsCount = table.data?.colsWidth?.length;\n    if (!colsCount) return;\n    if (isHoverCornerToolbar) {\n      setItemsRectStyleByRange(0, colsCount - 1, THEME.blue1, THEME.blue3);\n    } else {\n      if (!selection || !table.data.colsWidth) {\n        setItemsRectStyleByRange(0, colsCount - 1, THEME.toolbarBgColor.default, THEME.toolbarBorderColor);\n        return;\n      }\n      updateColSelectionRectStyle();\n    }\n  }, [\n    setItemsRectStyleByRange,\n    updateColSelectionRectStyle,\n    selection,\n    table.data?.colsWidth?.length,\n    isHoverCornerToolbar,\n    table,\n    controller,\n  ]);\n\n  const updateIndicatorStyle = React.useCallback(() => {\n    if (\n      !colIndicatorRef.current ||\n      !selection ||\n      positionOfInsertButton === -1 ||\n      !tableRef.current ||\n      !positionedAncestorRef.current ||\n      !toolbarWrapperRef.current\n    ) {\n      return;\n    }\n    const trueTableDOM = tableRef.current;\n    const trueTableRect = getBoundingRelativeRect(\n      trueTableDOM,\n      positionedAncestorRef.current,\n    );\n    const toolbarRect = getBoundingRelativeRect(\n      toolbarWrapperRef.current,\n      positionedAncestorRef.current,\n    );\n    const left = positionOfInsertButton === 0\n      ? 0\n      : calcColsWidth(0, positionOfInsertButton - 1);\n    const height = trueTableRect.bottom - toolbarRect.top;\n    colIndicatorRef.current.style.left = `${Math.round(left / scale)}px`;\n    colIndicatorRef.current.style.bottom = `${Math.round(SCROLL_BAR_HEIGHT / scale)}px`;\n    colIndicatorRef.current.style.height = `${height / scale}px`;\n  }, [colIndicatorRef, selection, positionOfInsertButton, tableRef, positionedAncestorRef, calcColsWidth, scale]);\n\n  const handleColResizing = React.useCallback((event) => {\n    if (!draggingColResizerRef.current) return;\n\n    event.preventDefault();\n\n    const relativeEvent = getRelativeMouseEvent(event, zoomContainer);\n\n    const colToolbarItem = draggingColResizerRef.current.previousElementSibling as HTMLElement;\n    const colToolbarNextItem = draggingColResizerRef.current.nextElementSibling as HTMLElement;\n\n    if (!colToolbarItem || !colToolbarNextItem) return;\n    const colToolbarItemRect = getBoundingRelativeRect(colToolbarItem, zoomContainer);\n    let validClientX = Math.max(\n      colToolbarItemRect.left + MIN_COL_WIDTH * scale,\n      relativeEvent.relativeX,\n    );\n    if (colToolbarNextItem && colToolbarNextItem.getAttribute('data-index') !== null) {\n      const colToolbarNextItemRect = getBoundingRelativeRect(colToolbarNextItem, zoomContainer);\n      validClientX = Math.min(\n        colToolbarNextItemRect.left + colToolbarNextItemRect.width - MIN_COL_WIDTH * scale,\n        validClientX,\n      );\n    }\n\n    const startClientX = startClientXRef.current;\n    if (startClientX == null) {\n      return;\n    }\n    const delta = validClientX - startClientX;\n    const left = startPositionLeftRef.current + Math.round(delta / scale);\n    setResizingColData({\n      ...resizingColDataRef.current,\n      left,\n    });\n  }, [zoomContainer, scale]);\n\n  const hideContextMenu = React.useCallback(() => {\n    setContextMenuVisible(false);\n\n    document.removeEventListener('mousedown', hideContextMenu);\n  }, []);\n\n  const handleColResizeEnd = React.useCallback(() => {\n    // Fix to https://work.aone.alibaba-inc.com/issue/38856463. draggingColResizerRef.current会存在为null的情况\n    // 暂时不好定位具体原因，先做兜底处理\n    if (!draggingColResizerRef.current) {\n      document.removeEventListener('mousedown', hideContextMenu);\n      document.removeEventListener('mousemove', handleColResizing);\n      document.removeEventListener('mouseup', handleColResizeEnd);\n      return;\n    }\n    const delta = parseInt(draggingColResizerRef.current.style.left, 10) - startPositionLeftRef.current;\n    const resizingColIndex = parseInt(draggingColResizerRef.current.getAttribute('data-index')!, 10);\n    onColResize(resizingColIndex, delta);\n    draggingColResizerRef.current.style.backgroundColor = '';\n    draggingColResizerRef.current = null;\n    startClientXRef.current = null;\n    startPositionLeftRef.current = 0;\n\n    document.body.style.cursor = originBodyCursorRef.current;\n    originBodyCursorRef.current = '';\n\n    setResizingColData({\n      ...resizingColData,\n      colIndex: -1,\n    });\n\n    document.removeEventListener('mousedown', hideContextMenu);\n    document.removeEventListener('mousemove', handleColResizing);\n    document.removeEventListener('mouseup', handleColResizeEnd);\n  }, [onColResize, resizingColData, hideContextMenu, handleColResizing]);\n\n  const handleColResizeStart = React.useCallback((event: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    // NOTE: 不阻止冒泡，以便触发上层清空表格选区逻辑\n    event.preventDefault();\n    const relativeEvent = getRelativeMouseEvent(event, zoomContainer);\n\n    startClientXRef.current = relativeEvent.relativeX;\n    draggingColResizerRef.current = event.target as HTMLDivElement;\n    const resizingColIndex = parseInt(draggingColResizerRef.current.getAttribute('data-index')!, 10);\n    const left = parseInt(draggingColResizerRef.current.style.left, 10);\n    draggingColResizerRef.current.style.backgroundColor = 'transparent';\n\n    originBodyCursorRef.current = document.body.style.cursor;\n    document.body.style.setProperty('cursor', 'col-resize', 'important');\n\n    const table = ReactDOM.findDOMNode(tableRef.current);\n\n    const tableRect = getBoundingRelativeRect(table as HTMLElement, zoomContainer);\n    const top = REALTABLE_PADDING.top / scale;\n    startPositionLeftRef.current = left;\n    resizingColDataRef.current = {\n      colIndex: resizingColIndex,\n      left,\n      top,\n      colResizerHeight: (tableRect.height + TOOLBAR_ITEM_SIZE - REALTABLE_PADDING.top) / scale,\n    };\n\n    setResizingColData({\n      colIndex: resizingColIndex,\n      left,\n      top,\n      colResizerHeight: (tableRect.height + TOOLBAR_ITEM_SIZE - REALTABLE_PADDING.top) / scale,\n    });\n    document.addEventListener('mousemove', handleColResizing);\n    document.addEventListener('mouseup', handleColResizeEnd);\n  }, [handleColResizing, handleColResizeEnd, scale, tableRef, zoomContainer]);\n\n  const handlePreventDefault = React.useCallback((event) => {\n    event.preventDefault();\n    event.stopPropagation();\n  }, []);\n\n  const handleContextMenu = React.useCallback((event) => {\n    handlePreventDefault(event);\n\n    onContextMenu(event);\n\n    setContextMenuVisible(true);\n  }, [onContextMenu, handlePreventDefault]);\n\n  const isResizingCol = React.useCallback(() => {\n    return resizingColData && resizingColData.colIndex !== -1;\n  }, [resizingColData]);\n\n  const handleMouseEnterColToolbarItem = React.useCallback((event) => {\n    const index = parseInt(event.target.getAttribute('data-index'), 10);\n    if (isNaN(index)) return;\n    // hover对样式的影响优先级低于选中状态\n    const tableRows = table.nodes.length;\n    if (tableRows) {\n      // 构造hover选区\n      const hoverSelection = {\n        key: table.key,\n        startColIndex: index,\n        endColIndex: index,\n        startRowIndex: 0,\n        endRowIndex: tableRows - 1,\n      };\n      setHoverSelection(hoverSelection);\n    }\n  }, [setHoverSelection, table.key, table.nodes.length]);\n\n  const handleMouseOutColToolbarItem = React.useCallback(() => {\n    setHoverSelection(null);\n  }, [setHoverSelection]);\n\n  const handleMouseOver = React.useCallback((e) => {\n    if (isDragging || isResizingCol() || !scrollContainer.current) {\n      return;\n    }\n    const { clientX } = e;\n    const scrollRect = scrollContainer.current.getBoundingClientRect();\n    const horizontalPadding = 10;\n    if (\n      clientX < scrollRect.left - horizontalPadding\n      || clientX > scrollRect.right + horizontalPadding\n    ) {\n      return;\n    }\n    const colsRect = getColsRects();\n    const index = colsRect.findIndex((rect) => {\n      // node.getBoundingClientRect() 可能是 undefined？\n      // 这里比较奇怪，就算 node 从 DOM 中卸载，也会返回 DOMRect 只是数据都是 0\n      // 先兼容\n      if (!rect) {\n        return false;\n      }\n      return clientX >= rect.left && clientX <= rect.right;\n    });\n    setHoverToolbarItemIndex(index);\n  }, [isDragging, isResizingCol, scrollContainer, getColsRects]);\n\n  const handleMouseOut = React.useCallback((e) => {\n    const insertButton = insertButtonRef.current;\n    if (insertButton && insertButton.contains(e.target)) {\n      return;\n    }\n    if (isDragging || isResizingCol()) {\n      return;\n    }\n    setHoverToolbarItemIndex(-1);\n  }, [isDragging, isResizingCol]);\n\n  const selectCols = React.useCallback((\n    start: number,\n    end: number,\n    shouldHideContextMenu = true,\n  ) => {\n    if (start === end) {\n      startSelectIndexRef.current = start;\n    }\n    onSelect(\n      {\n        start,\n        end,\n      },\n      shouldHideContextMenu,\n    );\n  }, [onSelect]);\n\n  const shouldEnableEndDrag = React.useCallback((insertIndex: number, colsLength: number) => {\n    if (insertIndex === 0 && isColumnHeader) {\n      return false;\n    }\n    if (insertIndex > 0 && insertIndex < colsLength) {\n      const maxRowIndex = table.nodes.length - 1;\n      const leftColSelection: ITableSelection = {\n        startRowIndex: 0,\n        endRowIndex: maxRowIndex,\n        startColIndex: 0,\n        endColIndex: insertIndex - 1,\n        key: table.key,\n      };\n      return controller.query(\n        'isAllSelectedCellsComplete',\n        { node: table, tableSelection: leftColSelection },\n      );\n    }\n    return true;\n  }, [table, controller, isColumnHeader]);\n\n  const handleMultiSelectCol = React.useCallback(throttle((event: MouseEvent) => {\n    if (isDragging) {\n      return;\n    }\n    const { buttons } = event;\n    const selectedIndexRange = getSelectedIndexRange();\n    if (buttons !== 1 || !colToolbarRef.current || !selectedIndexRange) {\n      removeMultiSelectListener();\n      return;\n    }\n\n    const colsNodes = getAllColsNodes();\n    const { left: colToolbarX } = colToolbarRef.current.getBoundingClientRect()!;\n    const offsetX = event.clientX - colToolbarX;\n    let endSelectedIndex = colsNodes.length - 1;\n    let acc = 0;\n    for (let i = 0; i < colsNodes.length; i += 1) {\n      acc += colsNodes[i].getBoundingClientRect().width;\n      if (acc > offsetX) {\n        endSelectedIndex = i;\n        break;\n      }\n    }\n    selectCols(startSelectIndexRef.current, endSelectedIndex);\n  }, 100)\n  , [isDragging, getSelectedIndexRange, selectCols]);\n\n  const removeMultiSelectListener = React.useCallback(() => {\n    document.removeEventListener('mousemove', handleMultiSelectCol);\n    document.removeEventListener('mouseup', removeMultiSelectListener);\n  }, [handleMultiSelectCol]);\n\n  const showIndicatorVisible = React.useCallback((isVisible: boolean) => {\n    if (!colIndicatorRef.current) {\n      return;\n    }\n    const opacity = isVisible ? '1' : '0';\n    colIndicatorRef.current.style.opacity = opacity;\n  }, [colIndicatorRef]);\n\n  const setInsertButtonPos = React.useCallback((index: number) => {\n    let i = index;\n    if (i === 0 && isColumnHeader) {\n      i = -1;\n    }\n    setPositionOfInsertButton(i);\n    showIndicatorVisible(i !== -1);\n    insetBtnPosRef.current = i;\n  }, [isColumnHeader, showIndicatorVisible]);\n\n  const addMultiSelectListener = React.useCallback(() => {\n    document.addEventListener('mousemove', handleMultiSelectCol);\n    document.addEventListener('mouseup', removeMultiSelectListener);\n  }, [handleMultiSelectCol, removeMultiSelectListener]);\n\n  const moveColToIndex = React.useCallback((\n    originIndexRange: ISelectedIndexRange,\n    targetIndex: number,\n  ) => {\n    const { min, max } = getSortedSelectedRange(originIndexRange)!;\n    controller.run(\n      'onAction',\n      moveTableCols(\n        table,\n        {\n          start: min,\n          end: max,\n        },\n        targetIndex,\n      ),\n    );\n    const startIndex = min < targetIndex ?\n      targetIndex - (max - min + 1) :\n      targetIndex;\n    selectCols(startIndex, startIndex + max - min);\n  }, [getSortedSelectedRange, controller, selectCols, table]);\n\n  const updateDragElementPosition = React.useCallback((x: number, y: number) => {\n    if (!dragElementRef.current) {\n      return;\n    }\n\n    dragElementRef.current.style.left = `${x / scale}px`;\n    dragElementRef.current.style.top = `${y / scale}px`;\n  }, [scale]);\n\n  const isShowColToolbar = React.useCallback(() => {\n    const selectedIndexRange = getSelectedIndexRange();\n    return !!selectedIndexRange;\n  }, [getSelectedIndexRange]);\n\n  const updateDraggingStyle = React.useCallback((relativeEvent) => {\n    const {\n      clientX,\n      clientY,\n      relativeX,\n      relativeY,\n    } = relativeEvent;\n    const tableDOM = domUtils.findDOMNode(table.key) as HTMLElement;\n    if (!tableDOM) {\n      return;\n    }\n    updateDragElementPosition(relativeX, relativeY);\n    const tableRect = tableDOM.getBoundingClientRect();\n    if (\n      clientX < tableRect.left - TOOLBAR_ITEM_SIZE ||\n      clientX > tableRect.right ||\n      clientY < tableRect.top - TOOLBAR_ITEM_SIZE ||\n      clientY > tableRect.bottom\n    ) {\n      setInsertButtonPos(-1);\n      return;\n    }\n    const colsRects = getColsRects();\n    let insertIndex = -1;\n    for (let i = 0; i < colsRects.length; i++) {\n      const colRect = colsRects[i];\n      if (\n        clientX >= colRect.left &&\n        clientX <= colRect.left + colRect.width / 2\n      ) {\n        insertIndex = i;\n        break;\n      }\n      if (\n        clientX > colRect.left + colRect.width / 2 &&\n        clientX < colRect.right\n      ) {\n        insertIndex = i + 1;\n        break;\n      }\n    }\n    const sortRange = getSortedSelectedRange();\n    if (\n      !sortRange\n      || (\n        insertIndex >= sortRange.min\n        && insertIndex <= sortRange.max + 1\n      )\n    ) {\n      insertIndex = -1;\n    }\n\n    const shouldDragEnd = shouldEnableEndDrag(insertIndex, colsRects.length);\n    if (!shouldDragEnd) {\n      insertIndex = -1;\n    }\n    setInsertButtonPos(insertIndex);\n  }, [\n    table.key,\n    updateDragElementPosition,\n    getColsRects,\n    getSortedSelectedRange,\n    setInsertButtonPos,\n    shouldEnableEndDrag,\n  ]);\n\n  const handleDragEnd = React.useCallback(() => {\n    setIsDragging(false);\n    document.removeEventListener('mouseup', handleDragEnd);\n    if (insetBtnPosRef.current === -1) {\n      return;\n    }\n    const selectedIndexRange = getSelectedIndexRange();\n    moveColToIndex(selectedIndexRange!, insetBtnPosRef.current);\n    setInsertButtonPos(-1);\n  }, [getSelectedIndexRange, moveColToIndex, setInsertButtonPos]);\n\n  const handleDragging = React.useCallback((event: React.MouseEvent | MouseEvent) => {\n    const tableDOM = domUtils.findDOMNodeSafely(table.key) as HTMLElement;\n    if (!tableDOM || event.buttons !== 1) {\n      handleDragEnd();\n      document.removeEventListener('mousemove', handleDragging);\n      return;\n    }\n    event.stopPropagation();\n    const relativeEvent = getRelativeMouseEvent(event, zoomContainer);\n    updateDraggingStyle(relativeEvent);\n    scrollHorizontal(event.clientX, scrollContainer.current);\n  }, [table.key, zoomContainer, updateDraggingStyle, handleDragEnd, scrollContainer]);\n\n  const handleDragStart = React.useCallback((relativeEvent) => {\n    const selectedIndexRange = getSelectedIndexRange();\n    const selectedIndex = selectedIndexRange!.start;\n    setIsDragging(true);\n    setDraggingColWidth(colsWidth![selectedIndex]);\n    updateDraggingStyle(relativeEvent);\n    document.addEventListener('mousemove', handleDragging);\n    document.addEventListener('mouseup', handleDragEnd);\n  }, [colsWidth, setIsDragging, setDraggingColWidth, updateDraggingStyle, handleDragging, getSelectedIndexRange, handleDragEnd]);\n\n  const enableDragIcon = React.useCallback(() => {\n    const range = getSortedSelectedRange();\n    // 表头列禁止拖拽\n    if (isColumnHeader && range?.min === 0) return false;\n\n    return Boolean(range &&\n      hoverToolbarItemIndex >= range.min &&\n      hoverToolbarItemIndex <= range.max);\n  }, [getSortedSelectedRange, hoverToolbarItemIndex, isColumnHeader]);\n\n  const handleSelectCol = React.useCallback(\n    (event) => {\n      handlePreventDefault(event);\n      const selectedIndexRange = getSelectedIndexRange();\n      controller.run('onAction', clickTableToolbar(table, 'col', event.target));\n      const index = parseInt(event.target.getAttribute('data-index'), 10);\n      if (\n        event.shiftKey &&\n        selectedIndexRange &&\n        startSelectIndexRef.current !== index\n      ) {\n        selectCols(startSelectIndexRef.current, index);\n        return;\n      }\n      const sortRange = getSortedSelectedRange();\n      if (!sortRange || index > sortRange.max || index < sortRange.min) {\n        selectCols(index, index);\n        addMultiSelectListener();\n        return;\n      }\n\n      const relativeEvent = getRelativeMouseEvent(event, zoomContainer);\n      let timer: number;\n      const isRightClick = event.buttons === 2;\n      const clearTimer = () => {\n        clearTimeout(timer);\n        selectCols(index, index, !isRightClick);\n        removeCancelDragEventListener();\n      };\n      const removeCancelDragEventListener = () => {\n        document.removeEventListener('mousemove', clearTimer);\n        document.removeEventListener('mouseup', clearTimer);\n      };\n      timer = window.setTimeout(() => {\n        removeMultiSelectListener();\n        removeCancelDragEventListener();\n        handleDragStart(relativeEvent);\n      }, DRAG_TRIGGER_TIME);\n      if (!enableDragIcon()) {\n        clearTimer();\n      }\n\n      addMultiSelectListener();\n      document.addEventListener('mousemove', clearTimer);\n      document.addEventListener('mouseup', clearTimer);\n    },\n    [\n      handlePreventDefault,\n      getSelectedIndexRange,\n      controller,\n      table,\n      getSortedSelectedRange,\n      enableDragIcon,\n      zoomContainer,\n      addMultiSelectListener,\n      selectCols,\n      removeMultiSelectListener,\n      handleDragStart,\n    ],\n  );\n\n  const removeDragEventListener = React.useCallback(() => {\n    document.removeEventListener('mousemove', handleDragging);\n    document.removeEventListener('mouseup', handleDragEnd);\n  }, [handleDragging, handleDragEnd]);\n\n  const handleColRectUpdate = React.useCallback((index: number, colNode: HTMLDivElement, isDelete = false) => {\n    if (isDelete) {\n      colsNodes.current = colsNodes.current.splice(index, 1);\n    } else {\n      colsNodes.current[index] = colNode;\n    }\n    onGetAllColsNodes(getAllColsNodes());\n  }, [onGetAllColsNodes, getAllColsNodes]);\n\n  const insertCol = React.useCallback(() => {\n    const { colsWidth } = table.data;\n    if (!Array.isArray(colsWidth)) {\n      return;\n    }\n    if (positionOfInsertButton === -1) {\n      return;\n    }\n    const colWidth = colsWidth[Math.min(positionOfInsertButton, colsWidth.length - 1)];\n    controller.run(\n      'onAction',\n      insertTableCol(\n        table,\n        positionOfInsertButton,\n        Math.max(0, positionOfInsertButton - 1),\n        colWidth,\n      ),\n    );\n    if (positionOfInsertButton === colsWidth.length) {\n      setInsertButtonPos(positionOfInsertButton + 1);\n    }\n  }, [table, positionOfInsertButton, controller, setInsertButtonPos]);\n\n  const deleteCol = React.useCallback(() => {\n    controller.run('onAction', deleteTableCols(table));\n  }, [controller, table]);\n\n  const highlightSelection = React.useCallback(() => {\n    setIsHighlightSelection(true);\n    setIsHoverDelete(true);\n  }, [setIsHighlightSelection, setIsHoverDelete]);\n\n  const cancelHighlightSelection = React.useCallback(() => {\n    setIsHighlightSelection(false);\n    setIsHoverDelete(false);\n  }, [setIsHighlightSelection, setIsHoverDelete]);\n\n  const renderColToolbarItems = React.useMemo(() => {\n    if (!Array.isArray(colsWidth)) {\n      return null;\n    }\n\n    let left = 0;\n    const children: React.ReactElement[] = [];\n    const isSelectWholeTable = controller.query('isSelectWholeTable', {\n      node: table,\n    });\n    const indexRange = getSelectedIndexRange();\n    const deleteRange = isHoverDelete ? indexRange! : null;\n    const selectRanges = indexRange ? [indexRange] : [];\n    if (isHoverCornerToolbar || isSelectWholeTable) {\n      selectRanges.push({ start: 0, end: colsWidth.length - 1 });\n    } else if (\n      hoverSelection &&\n      hoverSelection.startColIndex === hoverSelection.endColIndex\n    ) {\n      selectRanges.push({\n        start: hoverSelection.startColIndex,\n        end: hoverSelection.endColIndex,\n      });\n    }\n    const activeRange = selection\n      ? {\n        start: selection.startColIndex,\n        end: selection.endColIndex,\n      }\n      : null;\n    colsWidth.forEach((width, index) => {\n      const resizerLeft =\n        resizingColData.colIndex === -1 ? left + width : resizingColData.left;\n\n      const translateY =\n        (INDICATOR_WRAPPER_WIDTH - GAP_BEWTEEN_INDICATOR_TOOLBAR) / scale;\n\n      // 第一个indicator如果不往右偏一点会被表格wrapper截断，因为超出了表格左侧区域\n      const translateX = index === 0 ? '45%' : '55%';\n      const isLastItem = index === colsWidth.length - 1;\n      children.push(\n        <React.Fragment key={index}>\n          <TableColToolbarItem\n            activeRange={activeRange}\n            selectRanges={selectRanges}\n            deleteRange={deleteRange}\n            index={index}\n            scale={scale}\n            onContextMenu={handleContextMenu}\n            onMouseDown={handleSelectCol}\n            onMouseEnter={handleMouseEnterColToolbarItem}\n            onMouseOut={handleMouseOutColToolbarItem}\n            onRectUpdate={handleColRectUpdate}\n          >\n            {index === 0 && isColumnHeader ? null : (\n              <InsertButtonIndicator\n                scale={scale}\n                onClick={insertCol}\n                style={{\n                  alignItems: 'start',\n                  transform: `translate(-${translateX}, -${translateY}px)`,\n                }}\n              />\n            )}\n            {isLastItem ? (\n              <InsertButtonIndicator\n                scale={scale}\n                onClick={insertCol}\n                style={{\n                  alignItems: 'start',\n                  left: `${width}px`,\n                  transform: `translate(-100%, -${translateY}px)`, // 最后一个indicator不能超出表格区域，否则自适应的时候会产生滚动条\n                  justifyContent: 'flex-end',\n                }}\n              />\n            ) : null}\n          </TableColToolbarItem>\n          <ColToolbarResizer\n            data-index={index}\n            data-type=\"col-resizer\"\n            scale={scale}\n            style={{\n              left: resizerLeft,\n              width: index === colsWidth.length - 1 ? '3px' : '',\n            }}\n            onMouseDown={handleColResizeStart}\n          />\n        </React.Fragment>,\n      );\n      left += width;\n    });\n    return children;\n  }, [\n    colsWidth,\n    controller,\n    table,\n    getSelectedIndexRange,\n    isHoverDelete,\n    isHoverCornerToolbar,\n    hoverSelection,\n    selection,\n    resizingColData.colIndex,\n    resizingColData.left,\n    scale,\n    handleContextMenu,\n    handleSelectCol,\n    handleMouseEnterColToolbarItem,\n    handleMouseOutColToolbarItem,\n    handleColRectUpdate,\n    isColumnHeader,\n    insertCol,\n    handleColResizeStart,\n  ]);\n\n  const isShowButton = React.useCallback(() => {\n    return !contextMenuVisible &&\n      zoomContainer &&\n      getLastActiveTableKey() === table.key &&\n      selection;\n  }, [contextMenuVisible, zoomContainer, getLastActiveTableKey, table.key, selection]);\n\n  // 展示插入按钮时隐藏删除按钮\n  const isShowDelete = React.useCallback(() => {\n    return isShowButton() &&\n      isSelectWholeCol() &&\n      isShowColToolbar() &&\n      positionOfInsertButton === -1 &&\n      !isDragging &&\n      !isHideDeleteButton;\n  }, [isShowButton, isSelectWholeCol, isShowColToolbar, positionOfInsertButton, isDragging, isHideDeleteButton]);\n\n  const handleMouseMove = React.useCallback(throttle((event) => {\n    if (\n      isDragging ||\n      isResizingCol() ||\n      !scrollContainer.current\n    ) {\n      return;\n    }\n\n    if (!isTableSelected) {\n      setInsertButtonPos(-1);\n      return;\n    }\n    const colsRects = getColsRects();\n    if (colsRects.length === 0) {\n      return;\n    }\n    const { clientX, clientY } = event;\n    // 鼠标位置在插入按钮区域时，不隐藏插入按钮\n    if (positionOfInsertButton !== -1 && insertButtonRef.current) {\n      const insertButtonNode = ReactDOM.findDOMNode(\n        insertButtonRef.current,\n      ) as HTMLDivElement;\n      const { left, top, right, bottom } = insertButtonNode.getBoundingClientRect();\n      if (\n        clientX >= left &&\n        clientX <= right &&\n        clientY >= top &&\n        clientY <= bottom\n      ) {\n        return;\n      }\n    }\n    const scrollRect = scrollContainer.current.getBoundingClientRect();\n    if (clientX < scrollRect.left || clientX > scrollRect.right) {\n      setInsertButtonPos(-1);\n      return;\n    }\n    let insertIndex = -1;\n    for (let i = 0; i < colsRects.length; i++) {\n      const colRect = colsRects[i];\n      // 理论上 colRect 非空，监控有报错显示 undefined，此处兼容\n      if (!colRect) break;\n      if (\n        clientY < colRect.top &&\n        clientY >= colRect.top - INDICATOR_WRAPPER_WIDTH\n      ) {\n        if (\n          clientX >= colRect.left - INDICATOR_WRAPPER_WIDTH / 2 &&\n          clientX <= colRect.left + INDICATOR_WRAPPER_WIDTH / 2\n        ) {\n          insertIndex = i;\n          break;\n        } else if (\n          clientX >= colRect.left + colRect.width - INDICATOR_WRAPPER_WIDTH / 2 &&\n          clientX <= colRect.left + colRect.width + INDICATOR_WRAPPER_WIDTH / 2\n        ) {\n          insertIndex = i + 1;\n          break;\n        }\n      }\n    }\n    const sortedRange = getSortedSelectedRange();\n    // 加号在所选行中间时，隐藏\n    if (\n      sortedRange &&\n      insertIndex > sortedRange.min &&\n      insertIndex < sortedRange.max + 1\n    ) {\n      insertIndex = -1;\n    }\n    setInsertButtonPos(insertIndex);\n  }, 200, { leading: true })\n  , [scrollContainer, isTableSelected, positionOfInsertButton, isDragging, isResizingCol, getColsRects, getSortedSelectedRange]);\n\n  const updateDeleteButtonStyle = React.useCallback(() => {\n    if (!deleteButtonRef.current || !selection || !isShowDelete()) {\n      return;\n    }\n\n    const menuNode = ReactDOM.findDOMNode(deleteButtonRef.current) as HTMLElement;\n    const menuRect = getBoundingRelativeRect(menuNode, zoomContainer);\n    const result = getColToolbarTop();\n    if (!result) {\n      return;\n    }\n    const { top } = result;\n    const startColRect = getColItemRect(selection.startColIndex);\n    const endColRect = getColItemRect(selection.endColIndex);\n    if (!startColRect || !endColRect) {\n      return;\n    }\n    const mid = (endColRect.right - startColRect.left) / 2;\n    const containerLeft = startColRect.left;\n    const relativeLeft = containerLeft + mid - menuRect.width / 2;\n\n    menuNode.style.top = `${top / scale - menuNode.offsetHeight - DISTANCE_BETWEEN_DELETE_BUTTON_AND_TOOLBAR}px`;\n    deleteButtonLeftRef.current = relativeLeft / scale;\n    menuNode.style.left = `${deleteButtonLeftRef.current - 1}px`;\n    const shouldHide = shouldHideButton(relativeLeft);\n    if (shouldHide) {\n      menuNode.style.opacity = '0';\n    } else {\n      menuNode.style.opacity = '1';\n    }\n  }, [selection, zoomContainer, scale, getColToolbarTop, shouldHideButton, getColItemRect, isShowDelete]);\n\n  React.useLayoutEffect(() => {\n    // 把样式改变放在layoutEffect中执行，防止闪烁\n    if (isTableSelected) {\n      fastdom.measure(() => {\n        updateDeleteButtonStyle();\n        updateInsertButtonStyle();\n        updateIndicatorStyle();\n        updateColSelectionRectStyle();\n      });\n    }\n  }, [updateDeleteButtonStyle, updateInsertButtonStyle, updateIndicatorStyle, updateColSelectionRectStyle, isTableSelected]);\n\n\n  React.useEffect(() => {\n    return () => {\n      document.removeEventListener('mousemove', handleColResizing);\n      document.removeEventListener('mouseup', handleColResizeEnd);\n      document.removeEventListener('mousemove', handleMouseMove);\n      removeMultiSelectListener();\n      removeDragEventListener();\n    };\n  }, []);\n\n  React.useEffect(() => {\n    if (!isTableSelected || !Array.isArray(colsWidth)) {\n      return undefined;\n    }\n    document.addEventListener('mousemove', handleMouseMove);\n    if (contextMenuVisible) {\n      document.addEventListener('mousedown', hideContextMenu);\n      return () => {\n        document.removeEventListener('mousedown', hideContextMenu);\n        document.removeEventListener('mousemove', handleMouseMove);\n      };\n    }\n    return () => {\n      document.removeEventListener('mousemove', handleMouseMove);\n    };\n  }, [isTableSelected, colsWidth, handleMouseMove, contextMenuVisible, hideContextMenu]);\n\n  const width = (colsWidth || []).reduce((acc, w) => acc + w, 0);\n  const style: React.CSSProperties = {\n    width: width + 1, // 保持和整体表格宽度一致\n    height: `${Math.round(TOOLBAR_ITEM_SIZE / scale)}px`,\n    borderRadius: `${Math.round(3 / scale)}px`,\n  };\n\n  const [scrollRect] = useScrollableContainerRect();\n  const containerWidth = useTableScrollContainerWidth();\n  const tableScrollLeft = useTableScrollContainerScrollLeft();\n\n  React.useLayoutEffect(() => {\n    if (!toolbarWrapperRef.current || !isSticky) return;\n\n    toolbarWrapperRef.current.scrollLeft = tableScrollLeft;\n  }, [isSticky, tableScrollLeft]);\n\n  // 在定义的函数内使用 positionOfInsertButton 需要通过ref来保证拿到的是最新值，在外部则通过 positionOfInsertButton 来获取最新值即可\n  const isShowInsertButton = !isDragging && positionOfInsertButton !== -1;\n  const tableHeight = (isDragging && tableRef.current)\n    ? tableRef.current.offsetHeight\n    : 0;\n  const showInsert = !!isShowButton() && isShowInsertButton;\n\n  const wrapperStyle: React.CSSProperties = {};\n  if (isTableSelected) {\n    wrapperStyle.visibility = 'visible';\n    wrapperStyle.pointerEvents = 'auto';\n  }\n  if (isSticky) {\n    wrapperStyle.width = containerWidth;\n    wrapperStyle.background = 'white';\n    if (Number.isFinite(scrollRect.top)) {\n      wrapperStyle.top = scrollRect.top;\n    }\n    if (Number.isFinite(scrollRect.left)) {\n      wrapperStyle.left = scrollRect.left;\n    }\n  }\n\n  return (\n    <Wrapper\n      style={wrapperStyle}\n      data-sticky={isSticky}\n      ref={toolbarWrapperRef}\n      data-testid=\"table-col-toolbar-wrapper\"\n    >\n      <ColToolbarWrapper\n        role=\"toolbar\"\n        ref={colToolbarRef}\n        style={style}\n        data-testid=\"table-col-toolbar\"\n        onMouseOver={handleMouseOver}\n        onMouseOut={handleMouseOut}\n      >\n        {renderColToolbarItems}\n        <ColResizer\n          style={{\n            display: resizingColData.colIndex === -1 ? 'none' : 'block',\n            left: resizingColData.left,\n            top: resizingColData.top,\n            height: resizingColData.colResizerHeight,\n          }}\n        />\n        {ReactDOM.createPortal(\n          <ColInlineToolbar\n            style={{\n              visibility: isShowDelete() ? 'visible' : 'hidden',\n              transition: 'left ease-in-out 0.1s',\n            }}\n            ref={deleteButtonRef}\n            data-testid=\"table-col-inline-toolbar\"\n          >\n            <InlineToolbarDeleteButton\n              mode=\"col\"\n              locale={locale}\n              scale={scale}\n              onDelete={deleteCol}\n              onHighlightSelection={highlightSelection}\n              onCancelHighlightSelection={cancelHighlightSelection}\n            />\n          </ColInlineToolbar>,\n          zoomContainer,\n        )}\n        {ReactDOM.createPortal(\n          <ColInlineToolbar\n            style={{\n              opacity: showInsert ? 1 : 0,\n              pointerEvents: showInsert ? 'auto' : 'none',\n            }}\n            ref={insertButtonRef}\n            data-testid=\"table-col-inline-toolbar-insert\"\n          >\n            <InlineToolbarInsertButton\n              locale={locale}\n              table={table}\n              selection={selection}\n              mode=\"col\"\n              tableRef={tableRef}\n              scale={scale}\n              onInsert={insertCol}\n              zoomContainer={zoomContainer}\n              insertIndex={positionOfInsertButton}\n              getAllColsNodes={getAllColsNodes}\n              onShowIndicatorVisible={showIndicatorVisible}\n            />\n          </ColInlineToolbar>,\n          zoomContainer,\n        )}\n        {zoomContainer && ReactDOM.createPortal(\n          <DragElement\n            ref={dragElementRef}\n            visible={isDragging}\n            width={draggingColWidth}\n            height={tableHeight + TOOLBAR_ITEM_SIZE}\n          />,\n          zoomContainer,\n        )}\n      </ColToolbarWrapper>\n    </Wrapper>\n  );\n}\n\nexport default createToolbarWithTableSeletion(TableColToolbar);\n"],"file":"index.js"}