{"version":3,"sources":["../../../../../src/bi/components/menu/index.tsx"],"names":["React","MenuItem","SubMenu","TablePanel","TableRole","PluginRoles","dispatchCustomEvent","LEGAL_EVENT","removeNewlineData","removeNewlineTriggerText","isSelectionInTableCell","insertTable","DEFAULT_COL","DEFAULT_ROW","TableMenu","props","useState","selectedCol","setSelectedCol","selectedRow","setSelectedRow","menuItem","controller","value","menuKey","title","rest","tableSelection","query","isDisabled","excludeColumns","onChange","row","col","insert","run","handleClickMenuItem","_","e","stopPropagation","handleClickSubMenu","quickInsertMenuVisible","visible","padding","tablePicker","height","margin"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { MenuItem, SubMenu, TablePanel } from '@ali/we-design';\nimport { TableRole as PluginRoles } from '../../../utils/role';\nimport { SubMenuInnerProps } from '@ali/4ever-component';\nimport { dispatchCustomEvent, LEGAL_EVENT, removeNewlineData, removeNewlineTriggerText } from '@ali/4ever-utils';\nimport isSelectionInTableCell from '../../utils/isSelectionInTableCell';\nimport { insertTable } from '../../actions';\n\nconst DEFAULT_COL = 3;\nconst DEFAULT_ROW = 3;\n\nexport default function TableMenu(props: SubMenuInnerProps) {\n  const [selectedCol, setSelectedCol] = React.useState<number>(DEFAULT_COL);\n  const [selectedRow, setSelectedRow] = React.useState<number>(DEFAULT_ROW);\n\n  const { menuItem, controller } = props;\n  const { value } = controller;\n  const { menuKey, title, ...rest } = menuItem;\n  const tableSelection = controller.query('hasTableSelection');\n  const isDisabled = tableSelection ||\n    isSelectionInTableCell(value, { excludeColumns: true }) ||\n    controller.query('isSelectionInLink') ||\n    controller.query('isSelectionInMention');\n\n  const onChange = (row: number, col: number): void => {\n    setSelectedCol(col);\n    setSelectedRow(row);\n  };\n\n  const insert = (row = DEFAULT_ROW, col = DEFAULT_COL) => {\n    controller.run('onAction', insertTable(row, col));\n  };\n\n  // NOTE: 通过回车插入，也会调用 onClick，we-design 此时没有传入 event 参数\n  const handleClickMenuItem = (_, e?: React.MouseEvent) => {\n    insert(selectedRow, selectedCol);\n    e?.stopPropagation();\n  };\n\n  const handleClickSubMenu = () => {\n    if (isDisabled) return;\n    controller.run('onAction', removeNewlineTriggerText(false));\n    controller.run('onAction', removeNewlineData());\n    insert();\n    dispatchCustomEvent(LEGAL_EVENT.quickInsertMenuVisible, { visible: false });\n  };\n\n  return (\n    <div onClick={handleClickSubMenu}>\n      <SubMenu\n        {...rest}\n        disabled={isDisabled}\n        title={title || ''}\n        overlayStyle={{ padding: 0 }}\n        overlayClassName=\"menu-table-overlay\"\n      >\n        <MenuItem\n          menuKey={menuKey || 'tablePicker'}\n          hoverable={false}\n          role={PluginRoles.tablePicker}\n          style={{\n            height: 'auto',\n            padding: 0,\n            margin: 0,\n          }}\n          onClick={handleClickMenuItem}\n        >\n          <TablePanel\n            row={10}\n            col={10}\n            selectedCol={selectedCol}\n            selectedRow={selectedRow}\n            onChange={onChange}\n          />\n        </MenuItem>\n      </SubMenu>\n    </div>\n  );\n}\n"],"file":"index.js"}