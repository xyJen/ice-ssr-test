{"version":3,"sources":["../../../../../../src/bi/components/toolbarButtons/next/tableFillButton.tsx"],"names":["React","TableRole","PluginRoles","EColorPanelMode","setTableCellFill","getTable","getTableSelection","setColorPanelMode","TableFillColorPicker","TableFillButton","props","controller","locale","rest","value","table","selection","isDisabled","color","startRowIndex","startColIndex","tablePath","document","getPath","key","cellPath","cell","getNodeByPath","payload","data","fill","undefined","handleChange","useCallback","run","currentPreset","query","mode","handleSelectValueChange","art","normal","fillColor","tipText","tableFillColor"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { Controller, Block } from '@ali/4ever-cangjie';\nimport { TableRole as PluginRoles } from '../../../../utils/role';\nimport { EColorPanelMode } from '@ali/we-toolbar';\n\nimport { setTableCellFill } from '../../../actions';\nimport getTable from '../../../utils/getTable';\nimport getTableSelection from '../../../utils/getTableSelection';\nimport { setColorPanelMode } from '@ali/4ever-plugin-pref';\nimport { TableFillColorPicker, IToolbarButtonConfig } from '@ali/4ever-component';\n\nexport interface TablePickerButtonProps extends IToolbarButtonConfig {\n  controller: Controller;\n  locale?: Record<string, string>;\n}\n\nexport default function TableFillButton(props) {\n  const { controller, locale, ...rest } = props;\n  const { value } = controller as Controller;\n  const table = getTable(value);\n  const selection = getTableSelection(controller);\n  let isDisabled = !(selection && table)\n  let color;\n  if (selection && table) {\n    const { startRowIndex, startColIndex } = selection;\n\n    const tablePath = value.document.getPath(table.key);\n    const cellPath = tablePath && [...tablePath, startRowIndex, startColIndex];\n    const cell = cellPath && value.document.getNodeByPath(cellPath) as Block;\n    if (cell) {\n      const payload = cell.data;\n      color = payload && payload.fill;\n    }\n  }\n  // DEFAULT COLOR\n  color = color === undefined ? '#FDBE3D' : color;\n\n  const handleChange = React.useCallback((fill: string) => {\n    controller.run('onAction', setTableCellFill(table, selection, fill));\n  }, [controller, table, selection]);\n\n  const currentPreset = controller.query('getColorPanelMode')?.mode;\n\n  const handleSelectValueChange = React.useCallback((mode: 'normal' | 'art') => {\n    controller.run('onAction', setColorPanelMode({ mode: (mode === 'art' ? EColorPanelMode.art : EColorPanelMode.normal) }));\n  }, [controller]);\n\n  return (\n    <TableFillColorPicker\n      testid=\"bi-toolbar-table-fill\"\n      disabled={!!isDisabled}\n      color={color}\n      onColorChange={handleChange}\n      tooltip={locale.fillColor?.tipText}\n      role={PluginRoles.tableFillColor}\n      currentPreset={currentPreset}\n      onCurrentPresetChange={handleSelectValueChange}\n      {...rest}\n    />\n  );\n}\n"],"file":"tableFillButton.js"}