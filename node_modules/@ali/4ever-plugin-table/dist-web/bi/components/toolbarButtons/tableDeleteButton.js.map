{"version":3,"sources":["../../../../../src/bi/components/toolbarButtons/tableDeleteButton.tsx"],"names":["React","IconButton","ToolbarTableDeleteNormal","TableRole","PluginRoles","getTableSelection","deleteTable","deleteTableCols","deleteTableRows","isTable","TableDeleteButton","props","controller","locale","selection","node","value","document","getNode","key","tableRowCount","nodes","length","tableColCount","data","colsWidth","startRowIndex","startColIndex","endRowIndex","endColIndex","isSelectWholeRow","isSelectWholeCol","isSelectWholeTable","handleMouseDown","run","contextMenuDelete","tableDelete","needRender"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Controller } from '@ali/4ever-cangjie';\nimport { IconButton } from '@ali/we-toolbar';\nimport { ToolbarTableDeleteNormal } from '@ali/we-design';\nimport { TableRole as PluginRoles } from '../../../utils/role';\nimport getTableSelection from '../../utils/getTableSelection';\nimport { deleteTable, deleteTableCols, deleteTableRows } from '../../actions';\nimport { isTable, TableLocale } from '../../types';\n\nexport interface TableDeleteButtonProps {\n  controller: Controller;\n  locale?: TableLocale;\n}\n\nexport default function TableDeleteButton(props: TableDeleteButtonProps) {\n  const { controller, locale } = props;\n  const selection = getTableSelection(controller);\n  if (!selection) return null;\n  const node = controller.value.document.getNode(selection?.key);\n  if (!(node && isTable(node))) return null;\n  const tableRowCount = node.nodes.length - 1;\n  const tableColCount = (node.data.colsWidth || []).length - 1;\n\n  const { startRowIndex, startColIndex, endRowIndex, endColIndex } = selection;\n\n  const isSelectWholeRow = startColIndex === 0 && endColIndex >= tableColCount;\n\n  const isSelectWholeCol = startRowIndex === 0 && endRowIndex >= tableRowCount;\n\n  const isSelectWholeTable = isSelectWholeCol && isSelectWholeRow;\n\n  if (!isSelectWholeRow && !isSelectWholeCol) {\n    return null;\n  }\n\n  const handleMouseDown = () => {\n    if (isSelectWholeTable) {\n      controller.run('onAction', deleteTable(node));\n    } else if (isSelectWholeRow) {\n      controller.run('onAction', deleteTableRows(node));\n    } else if (isSelectWholeCol) {\n      controller.run('onAction', deleteTableCols(node));\n    }\n  };\n\n  return (\n    <IconButton\n      icon={<ToolbarTableDeleteNormal />}\n      title={locale?.contextMenuDelete}\n      tooltip={locale?.contextMenuDelete}\n      testid=\"bi-toolbar-table-delete\"\n      onClick={handleMouseDown}\n      role={PluginRoles.tableDelete}\n    />\n  );\n}\n\nTableDeleteButton.needRender = function (controller: Controller) {\n  const selection = getTableSelection(controller);\n  if (!selection) return false;\n  const node = controller.value.document.getNode(selection.key);\n  if (!(node && isTable(node))) return false;\n  const tableRowCount = node.nodes.length - 1;\n  const tableColCount = (node.data.colsWidth || []).length - 1;\n\n  const { startRowIndex, startColIndex, endRowIndex, endColIndex } = selection;\n\n  const isSelectWholeRow = startColIndex === 0 && endColIndex >= tableColCount;\n\n  const isSelectWholeCol = startRowIndex === 0 && endRowIndex >= tableRowCount;\n\n  if (!isSelectWholeRow && !isSelectWholeCol) {\n    return false;\n  }\n  return true;\n};\n\n"],"file":"tableDeleteButton.js"}