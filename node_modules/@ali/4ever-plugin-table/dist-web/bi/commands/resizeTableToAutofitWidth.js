import _extends from "@babel/runtime/helpers/extends";
import Table from "../../mo/models";
import setTableColsWidth from "../utils/setTableColsWidth";
import calcResizeColsWidth from "../utils/calcResizeColsWidth";
import enableAutofitWidth from "../../utils/commands/enableAutofitWidth";
import { convertFromPercentToPixel, convertFromPixelToPercent } from "../../utils/utils/colsWidthConverter";
import getTableMaxWidthByContainer from "../../utils/utils/getTableMaxWidthByContainer";
import formatColWidth from "../../utils/utils/formatColWidth";
export default function resizeTableToAutofitWidth(controller, table, originTable, containerWidth) {
  if (!Table.isAutofitWidth(table)) return controller;
  var colsWidth = table.data.colsWidth;
  if (!Array.isArray(colsWidth)) return controller;
  var originTableWidth = originTable.data.colsWidth.reduce(function (acc, w) {
    return acc + w;
  });
  var newTableWidth = colsWidth.reduce(function (acc, w) {
    return acc + w;
  });
  var ratio = originTableWidth / newTableWidth;
  var newColsWidth = colsWidth.map(function (w) {
    return formatColWidth(w * ratio);
  });

  if (ratio < 1) {
    var containerW = containerWidth || getTableMaxWidthByContainer(controller, table);

    if (containerW) {
      var pixelTable = Table.create(_extends({}, table, {
        data: _extends({}, table.data, {
          colsWidth: convertFromPercentToPixel(table, containerW)
        })
      }));
      var deltaPixelWidth = containerW * (newTableWidth - originTableWidth) / originTableWidth;
      var outputPixelColsWidth = calcResizeColsWidth(controller, pixelTable, deltaPixelWidth, containerW);
      var tablePixelWidth = outputPixelColsWidth.reduce(function (acc, w) {
        return acc + w;
      });

      if (tablePixelWidth > containerW) {
        enableAutofitWidth(controller, table, false);
        var newTable = controller.value.document.getNode(table.key);
        return setTableColsWidth(controller, newTable, outputPixelColsWidth);
      }

      newColsWidth = convertFromPixelToPercent(outputPixelColsWidth, containerW);
    }
  }

  return setTableColsWidth(controller, table, newColsWidth);
}
//# sourceMappingURL=resizeTableToAutofitWidth.js.map