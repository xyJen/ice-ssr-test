{"version":3,"sources":["../../../../src/bi/commands/insertTable.ts"],"names":["Commands","TextPoint","Selection","createTable","createTableData","biActions","basicActions","setTableRowHeader","insertTable","controller","payload","rowSize","colSize","containerWidth","defaultAutofit","defaultHeader","setTableHeaderStyle","tableData","table","data","point","create","key","getFirstNode","offset","newSelection","anchor","focus","run","createInsertBlockWithoutExtraBlankAction","node","command","select","newTable","value","document","getNode"],"mappings":"AAAA,SAEEA,QAFF,EAGEC,SAHF,EAIEC,SAJF,QAKO,oBALP;AAOA,OAAOC,WAAP;AACA,OAAOC,eAAP;AACA,SAASC,SAAS,IAAIC,YAAtB,QAA0C,yBAA1C;AACA,SAASC,iBAAT;AAWA,eAAe,SAASC,WAAT,CAAqBC,UAArB,EAA6CC,OAA7C,EAA+D;AAAA,MAE1EC,OAF0E,GAQxED,OARwE,CAE1EC,OAF0E;AAAA,MAG1EC,OAH0E,GAQxEF,OARwE,CAG1EE,OAH0E;AAAA,MAI1EC,cAJ0E,GAQxEH,OARwE,CAI1EG,cAJ0E;AAAA,MAK1EC,cAL0E,GAQxEJ,OARwE,CAK1EI,cAL0E;AAAA,MAM1EC,aAN0E,GAQxEL,OARwE,CAM1EK,aAN0E;AAAA,MAO1EC,mBAP0E,GAQxEN,OARwE,CAO1EM,mBAP0E;AAU5E,MAAMC,SAAS,GAAGb,eAAe,CAACK,UAAD,EAAa;AAAEG,IAAAA,OAAO,EAAPA,OAAF;AAAWC,IAAAA,cAAc,EAAdA,cAAX;AAA2BC,IAAAA,cAAc,EAAdA;AAA3B,GAAb,CAAjC;AACA,MAAMI,KAAK,GAAGf,WAAW,CAAC;AACxBQ,IAAAA,OAAO,EAAPA,OADwB;AAExBC,IAAAA,OAAO,EAAPA,OAFwB;AAGxBO,IAAAA,IAAI,EAAEF;AAHkB,GAAD,CAAzB;AAKA,MAAMG,KAAK,GAAGnB,SAAS,CAACoB,MAAV,CAAiB;AAAEC,IAAAA,GAAG,EAAEJ,KAAK,CAACK,YAAN,GAAqBD,GAA5B;AAAiCE,IAAAA,MAAM,EAAE;AAAzC,GAAjB,CAAd;AACA,MAAMC,YAAY,GAAGvB,SAAS,CAACmB,MAAV,CAAiB;AAAEK,IAAAA,MAAM,EAAEN,KAAV;AAAiBO,IAAAA,KAAK,EAAEP;AAAxB,GAAjB,CAArB;;AAEA,MAAIL,aAAJ,EAAmB;AACjB;AACAC,IAAAA,mBAAmB,QAAnB,YAAAA,mBAAmB;AACpB;;AAEDP,EAAAA,UAAU,CAACmB,GAAX,CAAe,UAAf,EAA2BtB,YAAY,CAACuB,wCAAb,CAAsD;AAAEC,IAAAA,IAAI,EAAEZ;AAAR,GAAtD,CAA3B;AAEAT,EAAAA,UAAU,CACPsB,OADH,CACW/B,QAAQ,CAACgC,MADpB,EAC4BP,YAD5B,EA1B4E,CA2BjC;;AAE3C,MAAIV,aAAJ,EAAmB;AACjB,QAAMkB,QAAQ,GAAGxB,UAAU,CAACyB,KAAX,CAAiBC,QAAjB,CAA0BC,OAA1B,CAAkClB,KAAK,CAACI,GAAxC,CAAjB;AACAb,IAAAA,UAAU,CAACmB,GAAX,CAAe,UAAf,EAA2BrB,iBAAiB,CAAC0B,QAAD,CAA5C;AACD;;AAED,SAAOxB,UAAP;AACD","sourcesContent":["import {\n  Controller,\n  Commands,\n  TextPoint,\n  Selection,\n} from '@ali/4ever-cangjie';\nimport Table from '../../mo/models';\nimport createTable from '../utils/createTable';\nimport createTableData from '../utils/createTableData';\nimport { biActions as basicActions } from '@ali/4ever-plugin-basic';\nimport { setTableRowHeader } from '../actions';\n\ninterface Payload {\n  rowSize: number;\n  colSize: number;\n  containerWidth?: number;\n  defaultAutofit?: boolean;\n  defaultHeader?: boolean;\n  setTableHeaderStyle?: () => void;\n}\n\nexport default function insertTable(controller: Controller, payload: Payload) {\n  const {\n    rowSize,\n    colSize,\n    containerWidth,\n    defaultAutofit,\n    defaultHeader,\n    setTableHeaderStyle,\n  } = payload;\n\n  const tableData = createTableData(controller, { colSize, containerWidth, defaultAutofit });\n  const table = createTable({\n    rowSize,\n    colSize,\n    data: tableData,\n  });\n  const point = TextPoint.create({ key: table.getFirstNode().key, offset: 0 });\n  const newSelection = Selection.create({ anchor: point, focus: point });\n\n  if (defaultHeader) {\n    // NOTE: 需要先执行 setTableHeaderStyle\n    setTableHeaderStyle?.();\n  }\n\n  controller.run('onAction', basicActions.createInsertBlockWithoutExtraBlankAction({ node: table }));\n\n  controller\n    .command(Commands.select, newSelection); // 自动定位到第一个单元格\n\n  if (defaultHeader) {\n    const newTable = controller.value.document.getNode(table.key) as Table;\n    controller.run('onAction', setTableRowHeader(newTable));\n  }\n\n  return controller;\n}\n"],"file":"insertTable.js"}