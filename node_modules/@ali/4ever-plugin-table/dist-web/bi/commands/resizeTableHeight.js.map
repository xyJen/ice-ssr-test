{"version":3,"sources":["../../../../src/bi/commands/resizeTableHeight.ts"],"names":["Commands","MIN_ROW_HEIGHT","resizeTable","resizeTableHeight","controller","table","rowsHeight","delta","originalRowsHeight","reduce","acc","curr","expectTotalRowsHeight","limitHeights","Array","length","fill","outputRowsHeight","nodes","forEach","row","i","command","setNodeByKey","key","data","h"],"mappings":";AAAA,SAAqBA,QAArB,QAAqC,oBAArC;AAEA,SAASC,cAAT;AACA,OAAOC,WAAP,6B,CAEA;AACA;AACA;;AACA,eAAe,SAASC,iBAAT,CACbC,UADa,EAEbC,KAFa,EAGbC,UAHa,EAIbC,KAJa,EAKb;AACA,MAAIA,KAAK,KAAK,CAAd,EAAiB;AACf,WAAOH,UAAP;AACD;;AACD,MAAMI,kBAAkB,GAAGF,UAAU,CAACG,MAAX,CAAkB,UAACC,GAAD,EAAMC,IAAN;AAAA,WAAgBD,GAAG,GAAGC,IAAtB;AAAA,GAAlB,EAA+C,CAA/C,CAA3B;AACA,MAAMC,qBAAqB,GAAGJ,kBAAkB,GAAGD,KAAnD;AACA,MAAMM,YAAY,GAAGC,KAAK,CAACR,UAAU,CAACS,MAAZ,CAAL,CAAyBC,IAAzB,CAA8Bf,cAA9B,CAArB;AACA,MAAMgB,gBAAgB,GAAGf,WAAW,CAACI,UAAD,EAAaM,qBAAb,EAAoCC,YAApC,CAApC;AAEAR,EAAAA,KAAK,CAACa,KAAN,CAAYC,OAAZ,CAAoB,UAACC,GAAD,EAAMC,CAAN,EAAY;AAC9BjB,IAAAA,UAAU,CAACkB,OAAX,CAAmBtB,QAAQ,CAACuB,YAA5B,EAA0CH,GAAG,CAACI,GAA9C,EAAmD;AACjDC,MAAAA,IAAI,eACEL,GAAG,CAACK,IAAJ,IAAY,EADd;AAEFC,QAAAA,CAAC,EAAET,gBAAgB,CAACI,CAAD;AAFjB;AAD6C,KAAnD;AAMD,GAPD;AAQA,SAAOjB,UAAP;AACD","sourcesContent":["import { Controller, Commands } from '@ali/4ever-cangjie';\nimport Table from '../../mo/models';\nimport { MIN_ROW_HEIGHT } from '../constants';\nimport resizeTable from '../utils/resizeTable';\n\n// rowsHeight 为 UI 上测得的高度\n// 这里有个毛病——如果有行的高度是被内容撑高的，resize 结果很可能不符合用户预期\n// 有合并单元格时这个问题基本无解。zoho 与 word 桌面版都有这个问题，google 不能 resize。\nexport default function resizeTableHeight(\n  controller: Controller,\n  table: Table,\n  rowsHeight: number[],\n  delta: number,\n) {\n  if (delta === 0) {\n    return controller;\n  }\n  const originalRowsHeight = rowsHeight.reduce((acc, curr) => (acc + curr), 0);\n  const expectTotalRowsHeight = originalRowsHeight + delta;\n  const limitHeights = Array(rowsHeight.length).fill(MIN_ROW_HEIGHT);\n  const outputRowsHeight = resizeTable(rowsHeight, expectTotalRowsHeight, limitHeights);\n\n  table.nodes.forEach((row, i) => {\n    controller.command(Commands.setNodeByKey, row.key, {\n      data: {\n        ...(row.data || {}),\n        h: outputRowsHeight[i],\n      },\n    });\n  });\n  return controller;\n}\n"],"file":"resizeTableHeight.js"}