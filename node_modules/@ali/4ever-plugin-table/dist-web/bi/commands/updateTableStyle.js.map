{"version":3,"sources":["../../../../src/bi/commands/updateTableStyle.ts"],"names":["Commands","Table","TABLE_HEADER_STYLE_ID","DEFAULT_TBLLOOK","firstRow","firstColumn","lastRow","lastColumn","updateStyleId","controller","table","newTable","value","document","getNode","key","tableData","data","styleId","shouldRemoveStyleId","isRowHeader","isColumnHeader","command","setNodeByKey","updateTblLook","newTblLook","tblLook","updateTableStyle"],"mappings":";AAAA,SAASA,QAAT,QAAqC,oBAArC;AACA,OAAOC,KAAP;AACA,SAASC,qBAAT;AAEA,IAAMC,eAAyC,GAAG;AAChDC,EAAAA,QAAQ,EAAE,CADsC;AAEhDC,EAAAA,WAAW,EAAE,CAFmC;AAGhDC,EAAAA,OAAO,EAAE,CAHuC;AAIhDC,EAAAA,UAAU,EAAE;AAJoC,CAAlD;;AAOA,SAASC,aAAT,CAAuBC,UAAvB,EAA+CC,KAA/C,EAA6D;AAC3D,MAAMC,QAAQ,GAAGF,UAAU,CAACG,KAAX,CAAiBC,QAAjB,CAA0BC,OAA1B,CAAkCJ,KAAK,CAACK,GAAxC,CAAjB;AAEA,MAAI,CAACJ,QAAL,EAAe,OAAOF,UAAP;;AAEf,MAAMO,SAAS,gBAASL,QAAQ,CAACM,IAAT,IAAiB,EAA1B,CAAf;;AAL2D,MAMnDC,OANmD,GAMvCF,SANuC,CAMnDE,OANmD;AAO3D,MAAMC,mBAAmB,GAAG,CAAClB,KAAK,CAACmB,WAAN,CAAkBT,QAAlB,CAAD,IAAgC,CAACV,KAAK,CAACoB,cAAN,CAAqBV,QAArB,CAA7D;;AAEA,MAAIQ,mBAAmB,IAAID,OAA3B,EAAoC;AAClC,WAAOF,SAAS,CAACE,OAAjB;AACA,WAAOT,UAAU,CAACa,OAAX,CAAmBtB,QAAQ,CAACuB,YAA5B,EAA0CZ,QAAQ,CAACI,GAAnD,EAAwD;AAC7DE,MAAAA,IAAI,EAAED;AADuD,KAAxD,CAAP;AAGD;;AAED,MAAI,CAACG,mBAAD,IAAwB,CAACD,OAA7B,EAAsC;AACpCF,IAAAA,SAAS,CAACE,OAAV,GAAoBhB,qBAApB;AACA,WAAOO,UAAU,CAACa,OAAX,CAAmBtB,QAAQ,CAACuB,YAA5B,EAA0CZ,QAAQ,CAACI,GAAnD,EAAwD;AAC7DE,MAAAA,IAAI,EAAED;AADuD,KAAxD,CAAP;AAGD;;AAED,SAAOP,UAAP;AACD;;AAED,SAASe,aAAT,CAAuBf,UAAvB,EAA+CC,KAA/C,EAA6D;AAC3D,MAAMC,QAAQ,GAAGF,UAAU,CAACG,KAAX,CAAiBC,QAAjB,CAA0BC,OAA1B,CAAkCJ,KAAK,CAACK,GAAxC,CAAjB;AAEA,MAAI,CAACJ,QAAL,EAAe,OAAOF,UAAP;;AAEf,MAAMO,SAAS,gBAASL,QAAQ,CAACM,IAAT,IAAiB,EAA1B,CAAf;;AACA,MAAMQ,UAAU,gBAAQtB,eAAR,CAAhB;;AACA,MAAMiB,WAAW,GAAGnB,KAAK,CAACmB,WAAN,CAAkBT,QAAlB,CAApB;AACA,MAAMU,cAAc,GAAGpB,KAAK,CAACoB,cAAN,CAAqBV,QAArB,CAAvB;AAEAc,EAAAA,UAAU,CAACrB,QAAX,GAAsBgB,WAAW,GAAG,CAAH,GAAO,CAAxC;AACAK,EAAAA,UAAU,CAACpB,WAAX,GAAyBgB,cAAc,GAAG,CAAH,GAAO,CAA9C;AAEA,SAAOZ,UAAU,CAACa,OAAX,CAAmBtB,QAAQ,CAACuB,YAA5B,EAA0CZ,QAAQ,CAACI,GAAnD,EAAwD;AAC7DE,IAAAA,IAAI,eACCD,SADD;AAEFU,MAAAA,OAAO,EAAED;AAFP;AADyD,GAAxD,CAAP;AAMD;;AAED,eAAe,SAASE,gBAAT,CAA0BlB,UAA1B,EAAkDC,KAAlD,EAAgE;AAC7EF,EAAAA,aAAa,CAACC,UAAD,EAAaC,KAAb,CAAb;AACAc,EAAAA,aAAa,CAACf,UAAD,EAAaC,KAAb,CAAb;AACA,SAAOD,UAAP;AACD","sourcesContent":["import { Commands, Controller } from '@ali/4ever-cangjie';\nimport Table from '../../mo/models';\nimport { TABLE_HEADER_STYLE_ID } from '../constants';\n\nconst DEFAULT_TBLLOOK: Table['data']['tblLook'] = {\n  firstRow: 0,\n  firstColumn: 0,\n  lastRow: 0,\n  lastColumn: 0,\n};\n\nfunction updateStyleId(controller: Controller, table: Table) {\n  const newTable = controller.value.document.getNode(table.key) as Table;\n\n  if (!newTable) return controller;\n\n  const tableData = { ...(newTable.data || {}) };\n  const { styleId } = tableData;\n  const shouldRemoveStyleId = !Table.isRowHeader(newTable) && !Table.isColumnHeader(newTable);\n\n  if (shouldRemoveStyleId && styleId) {\n    delete tableData.styleId;\n    return controller.command(Commands.setNodeByKey, newTable.key, {\n      data: tableData,\n    });\n  }\n\n  if (!shouldRemoveStyleId && !styleId) {\n    tableData.styleId = TABLE_HEADER_STYLE_ID;\n    return controller.command(Commands.setNodeByKey, newTable.key, {\n      data: tableData,\n    });\n  }\n\n  return controller;\n}\n\nfunction updateTblLook(controller: Controller, table: Table) {\n  const newTable = controller.value.document.getNode(table.key) as Table;\n\n  if (!newTable) return controller;\n\n  const tableData = { ...(newTable.data || {}) };\n  const newTblLook = { ...DEFAULT_TBLLOOK };\n  const isRowHeader = Table.isRowHeader(newTable);\n  const isColumnHeader = Table.isColumnHeader(newTable);\n\n  newTblLook.firstRow = isRowHeader ? 1 : 0;\n  newTblLook.firstColumn = isColumnHeader ? 1 : 0;\n\n  return controller.command(Commands.setNodeByKey, newTable.key, {\n    data: {\n      ...tableData,\n      tblLook: newTblLook,\n    },\n  });\n}\n\nexport default function updateTableStyle(controller: Controller, table: Table) {\n  updateStyleId(controller, table);\n  updateTblLook(controller, table);\n  return controller;\n}\n"],"file":"updateTableStyle.js"}