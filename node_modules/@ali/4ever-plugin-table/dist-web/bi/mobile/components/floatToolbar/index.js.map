{"version":3,"sources":["../../../../../../src/bi/mobile/components/floatToolbar/index.tsx"],"names":["React","ReactDOM","useScroll","BasicFloatToolbar","calcTableSelectionPos","usePixelColsWidth","getToolbarPosition","createToolbarLayout","SINGLE_ROW_BUTTON_LENGTH","FloatToolbar","props","controller","table","tableSelection","tableRef","locale","selecteColRange","selecteRowRange","value","selection","data","isByTable","tableType","pixelColsWidth","toolbarNodeRef","useRef","useState","style","setStyle","toolbarType","setToolbarVisible","visible","current","opacity","visibility","hideToolbar","useCallback","toolbarLayout","useMemo","layout","type","slice","updateStyle","selectionRect","tableNode","tblSelection","colsWidth","absPostion","targetRect","x","y","left","top","useEffect","onStart","onEnd","createPortal","transition","document","body"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;qBAC4B,a;AAA5B,OAAOC,QAAP,MAAqB,WAArB;AACA,SAAqBC,SAArB,QAAsC,oBAAtC;AACA,SAASC,iBAAT;AAOA,OAAOC,qBAAP;AACA,SAASC,iBAAT;AACA,SAASC,kBAAT;AACA,SAASC,mBAAT;AAEA,OAAO,IAAMC,wBAAwB,GAAG,CAAjC;AAiBP,OAAO,IAAMC,YAAY,GAAG,SAAfA,YAAe,CAACC,KAAD,EAAkB;AAAA,MAE1CC,UAF0C,GASxCD,KATwC,CAE1CC,UAF0C;AAAA,MAG1CC,KAH0C,GASxCF,KATwC,CAG1CE,KAH0C;AAAA,MAI1CC,cAJ0C,GASxCH,KATwC,CAI1CG,cAJ0C;AAAA,MAK1CC,QAL0C,GASxCJ,KATwC,CAK1CI,QAL0C;AAAA,MAM1CC,MAN0C,GASxCL,KATwC,CAM1CK,MAN0C;AAAA,MAO1CC,eAP0C,GASxCN,KATwC,CAO1CM,eAP0C;AAAA,MAQ1CC,eAR0C,GASxCP,KATwC,CAQ1CO,eAR0C;AAAA,8BAUXN,UAAU,CAACO,KAAX,CAAiBC,SAAjB,CAA2BC,IAVhB;AAAA,MAUpCC,SAVoC,yBAUpCA,SAVoC;AAAA,MAUzBC,SAVyB,yBAUzBA,SAVyB;;AAAA,2BAWnBjB,iBAAiB,EAXE;AAAA,MAWrCkB,cAXqC;;AAY5C,MAAMC,cAAc,GAAGxB,KAAK,CAACyB,MAAN,CAA6B,IAA7B,CAAvB;;AAZ4C,wBAalBzB,KAAK,CAAC0B,QAAN,CAAoC,EAApC,CAbkB;AAAA,MAarCC,KAbqC;AAAA,MAa9BC,QAb8B;;AAe5C,MAAIC,WAAW,GAAGP,SAAlB;AACAN,EAAAA,eAAe,KAAKa,WAAW,GAAG,KAAnB,CAAf;AACAZ,EAAAA,eAAe,KAAKY,WAAW,GAAG,KAAnB,CAAf;;AAEA,MAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,CAACC,OAAD,EAAsB;AAC9C,QAAI,CAACP,cAAc,CAACQ,OAApB,EAA6B;AAE7BR,IAAAA,cAAc,CAACQ,OAAf,CAAuBL,KAAvB,CAA6BM,OAA7B,GAAuCF,OAAO,GAAG,GAAH,GAAS,GAAvD;AACAP,IAAAA,cAAc,CAACQ,OAAf,CAAuBL,KAAvB,CAA6BO,UAA7B,GAA0CH,OAAO,GAAG,OAAH,GAAa,QAA9D;AACD,GALD;;AAOA,MAAMI,WAAW,GAAGnC,KAAK,CAACoC,WAAN,CAAkB;AAAA,WAAMN,iBAAiB,CAAC,KAAD,CAAvB;AAAA,GAAlB,EAAkD,EAAlD,CAApB;AAEA,MAAMO,aAAsC,GAAGrC,KAAK,CAACsC,OAAN,CAAc,YAAM;AACjE,QAAI,CAACT,WAAD,IAAgB,CAAChB,cAArB,EAAqC,OAAO,EAAP;AAErC,QAAM0B,MAAM,GAAGhC,mBAAmB,CAAC;AACjCI,MAAAA,UAAU,EAAVA,UADiC;AAEjCC,MAAAA,KAAK,EAALA,KAFiC;AAGjCuB,MAAAA,WAAW,EAAXA,WAHiC;AAIjCK,MAAAA,IAAI,EAAEX,WAJ2B;AAKjChB,MAAAA,cAAc,EAAdA,cALiC;AAMjCE,MAAAA,MAAM,EAANA;AANiC,KAAD,CAAlC;AASA,WAAO,CACLwB,MAAM,CAACE,KAAP,CAAa,CAAb,EAAgBjC,wBAAhB,CADK,EAEL+B,MAAM,CAACE,KAAP,CAAajC,wBAAb,CAFK,CAAP;AAID,GAhB8C,EAgB5C,CAACG,UAAD,EAAawB,WAAb,EAA0BvB,KAA1B,EAAiCC,cAAjC,EAAiDgB,WAAjD,EAA8Dd,MAA9D,CAhB4C,CAA/C;;AAkBA,MAAM2B,WAAW,GAAG,SAAdA,WAAc,GAAM;AACxB,QACE,CAACb,WAAD,IACG,CAAChB,cADJ,IAEG,CAACW,cAAc,CAACQ,OAFnB,IAGG,CAACX,SAJN,EAKE;AACAS,MAAAA,iBAAiB,CAAC,KAAD,CAAjB;AACA;AACD;;AAED,QAAMa,aAAa,GAAGvC,qBAAqB,CAAC;AAC1CQ,MAAAA,KAAK,EAALA,KAD0C;AAE1CgC,MAAAA,SAAS,EAAE9B,QAAQ,CAACkB,OAFsB;AAG1Ca,MAAAA,YAAY,EAAEhC,cAH4B;AAI1CiC,MAAAA,SAAS,EAAEvB,cAJ+B;AAK1CwB,MAAAA,UAAU,EAAE;AAL8B,KAAD,CAA3C;;AAOA,QAAI,CAACJ,aAAL,EAAoB;AAClBb,MAAAA,iBAAiB,CAAC,KAAD,CAAjB;AACA;AACD;;AArBuB,8BAuBPxB,kBAAkB,CAAC;AAClC0C,MAAAA,UAAU,EAAEL,aADsB;AAElCd,MAAAA,WAAW,EAAXA;AAFkC,KAAD,CAvBX;AAAA,QAuBhBoB,CAvBgB,uBAuBhBA,CAvBgB;AAAA,QAuBbC,CAvBa,uBAuBbA,CAvBa;;AA2BxBpB,IAAAA,iBAAiB,CAAC,IAAD,CAAjB;AACAF,IAAAA,QAAQ,CAAC;AACPuB,MAAAA,IAAI,EAAEF,CADC;AAEPG,MAAAA,GAAG,EAAEF;AAFE,KAAD,CAAR;AAID,GAhCD,CA9C4C,CAgF5C;AACA;;;AACAlD,EAAAA,KAAK,CAACqD,SAAN,CAAgBX,WAAhB,EAA6B,CAAC7B,cAAD,EAAiBD,KAAjB,CAA7B;AAEAV,EAAAA,SAAS,CAAC;AACRoD,IAAAA,OAAO,EAAE,mBAAM;AACbxB,MAAAA,iBAAiB,CAAC,KAAD,CAAjB;AACD,KAHO;AAIRyB,IAAAA,KAAK,EAAE,iBAAM;AACXb,MAAAA,WAAW;AACZ;AANO,GAAD,CAAT;AASA,sBACEzC,QAAQ,CAACuD,YAAT,eACE;AAAK,IAAA,GAAG,EAAEhC;AAAV,kBACE,eAAC,iBAAD;AACE,IAAA,aAAa,EAAEa,aADjB;AAEE,IAAA,KAAK;AACHoB,MAAAA,UAAU,EAAE;AADT,OAEA9B,KAFA;AAFP,IADF,CADF,EAUG+B,QAAQ,CAACC,IAVZ,CADF;AAaD,CA1GM","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Controller, useScroll } from '@ali/4ever-cangjie';\nimport { BasicFloatToolbar, LayoutConfig } from './basic';\nimport { ITableSelection, TableConfig } from '../../../types';\nimport Table from '../../../../mo/models';\nimport {\n  getSelectedColRangeFromTableSelection,\n  getSelectedRowRangeFromTableSelection,\n} from '../../../utils/getSelectedRangeFromTableSelection';\nimport calcTableSelectionPos from '../../../utils/calcTableSelectionPos';\nimport { usePixelColsWidth } from '../../../../utils/hooks';\nimport { getToolbarPosition } from './utils/getToolbarPostion';\nimport { createToolbarLayout } from './utils/createToolbarLayout';\n\nexport const SINGLE_ROW_BUTTON_LENGTH = 5;\n\ninterface Range {\n  start: number;\n  end: number;\n}\n\ntype Props = {\n  controller: Controller;\n  table: Table;\n  tableSelection: ITableSelection | null;\n  tableRef: React.RefObject<HTMLTableElement>;\n  locale?: TableConfig['locale'];\n  selecteColRange: Range | null;\n  selecteRowRange: Range | null;\n} & React.HTMLAttributes<HTMLDivElement>;\n\nexport const FloatToolbar = (props: Props) => {\n  const {\n    controller,\n    table,\n    tableSelection,\n    tableRef,\n    locale,\n    selecteColRange,\n    selecteRowRange,\n  } = props;\n  const { isByTable, tableType } = controller.value.selection.data;\n  const [pixelColsWidth] = usePixelColsWidth();\n  const toolbarNodeRef = React.useRef<HTMLDivElement>(null);\n  const [style, setStyle] = React.useState<React.CSSProperties>({});\n\n  let toolbarType = tableType;\n  selecteColRange && (toolbarType = 'col');\n  selecteRowRange && (toolbarType = 'row');\n\n  const setToolbarVisible = (visible: boolean) => {\n    if (!toolbarNodeRef.current) return;\n\n    toolbarNodeRef.current.style.opacity = visible ? '1' : '0';\n    toolbarNodeRef.current.style.visibility = visible ? 'unset' : 'hidden';\n  };\n\n  const hideToolbar = React.useCallback(() => setToolbarVisible(false), []);\n\n  const toolbarLayout: LayoutConfig[][] | null = React.useMemo(() => {\n    if (!toolbarType || !tableSelection) return [];\n\n    const layout = createToolbarLayout({\n      controller,\n      table,\n      hideToolbar,\n      type: toolbarType,\n      tableSelection,\n      locale,\n    });\n\n    return [\n      layout.slice(0, SINGLE_ROW_BUTTON_LENGTH),\n      layout.slice(SINGLE_ROW_BUTTON_LENGTH),\n    ];\n  }, [controller, hideToolbar, table, tableSelection, toolbarType, locale]);\n\n  const updateStyle = () => {\n    if (\n      !toolbarType\n      || !tableSelection\n      || !toolbarNodeRef.current\n      || !isByTable\n    ) {\n      setToolbarVisible(false);\n      return;\n    }\n\n    const selectionRect = calcTableSelectionPos({\n      table,\n      tableNode: tableRef.current,\n      tblSelection: tableSelection,\n      colsWidth: pixelColsWidth,\n      absPostion: true,\n    });\n    if (!selectionRect) {\n      setToolbarVisible(false);\n      return;\n    }\n\n    const { x, y } = getToolbarPosition({\n      targetRect: selectionRect,\n      toolbarType,\n    });\n    setToolbarVisible(true);\n    setStyle({\n      left: x,\n      top: y,\n    });\n  };\n\n  // 表格选区变化时更新 toolbar 位置\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  React.useEffect(updateStyle, [tableSelection, table]);\n\n  useScroll({\n    onStart: () => {\n      setToolbarVisible(false);\n    },\n    onEnd: () => {\n      updateStyle();\n    },\n  });\n\n  return (\n    ReactDOM.createPortal((\n      <div ref={toolbarNodeRef}>\n        <BasicFloatToolbar\n          toolbarLayout={toolbarLayout}\n          style={{\n            transition: 'opacity .3s',\n            ...style,\n          }}\n        />\n      </div>\n    ), document.body)\n  );\n};\n"],"file":"index.js"}