{"version":3,"sources":["../../../../../../src/bi/mobile/components/toolbar/colToolbarDragButton.tsx"],"names":["React","styled","DragIcon","Table","DEFAULT_TOTAL_WIDTH_FOR_AUTOFIT","resizeTableColWidth","throttle","usePixelColsWidth","DragWrapper","div","ColToolbarDragButton","props","index","controller","table","dragRef","useRef","isResizingRef","resizeStartRef","deltaRef","pixelColsWidth","originColWidthRef","preventEvent","e","preventDefault","stopPropagation","handleResizing","stopImmediatePropagation","current","clientX","touches","isAutofit","isAutofitWidth","run","node","colIndex","delta","containerWidth","undefined","handleResizeStart","nativeEvent","addEventListener","passive","capture","handleResizeEnd","removeEventListener"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;qBAC4B,a;AAA5B,OAAOC,MAAP,MAAmB,mBAAnB;AAEA,SAASC,QAAT;AACA,OAAOC,KAAP;AACA,SAASC,+BAAT;AACA,SAASC,mBAAT;AACA,SAASC,QAAT,QAAyB,WAAzB;AACA,SAASC,iBAAT;AAEA,IAAMC,WAAW,gBAAGP,MAAM,CAACQ,GAAV,iKAAjB;;wBAoFM,eAAC,QAAD,O;;AAjEN,OAAO,IAAMC,oBAAoB,GAAG,SAAvBA,oBAAuB,CAACC,KAAD,EAAkB;AAAA,MAC5CC,KAD4C,GACfD,KADe,CAC5CC,KAD4C;AAAA,MACrCC,UADqC,GACfF,KADe,CACrCE,UADqC;AAAA,MACzBC,KADyB,GACfH,KADe,CACzBG,KADyB;AAEpD,MAAMC,OAAO,GAAGf,KAAK,CAACgB,MAAN,CAA6B,IAA7B,CAAhB;AACA,MAAMC,aAAa,GAAGjB,KAAK,CAACgB,MAAN,CAAa,KAAb,CAAtB;AACA,MAAME,cAAc,GAAGlB,KAAK,CAACgB,MAAN,CAAa,CAAb,CAAvB;AACA,MAAMG,QAAQ,GAAGnB,KAAK,CAACgB,MAAN,CAAa,CAAb,CAAjB;;AALoD,2BAM3BT,iBAAiB,EANU;AAAA,MAM7Ca,cAN6C;;AAOpD,MAAMC,iBAAiB,GAAGrB,KAAK,CAACgB,MAAN,CAAa,CAAb,CAA1B;;AACA,MAAMM,YAAY,GAAG,SAAfA,YAAe,CAACC,CAAD,EAAsC;AACzDA,IAAAA,CAAC,CAACC,cAAF;AACAD,IAAAA,CAAC,CAACE,eAAF;AACD,GAHD;;AAKA,MAAMC,cAAc,GAAGpB,QAAQ,CAAC,UAACiB,CAAD,EAAmB;AACjDD,IAAAA,YAAY,CAACC,CAAD,CAAZ;AACAA,IAAAA,CAAC,CAACI,wBAAF;;AACA,QAAIV,aAAa,CAACW,OAAlB,EAA2B;AACzB;AACA;AAFyB,UAGjBC,OAHiB,GAGLN,CAAC,CAACO,OAAF,CAAU,CAAV,CAHK,CAGjBD,OAHiB;AAIzBV,MAAAA,QAAQ,CAACS,OAAT,GAAmBC,OAAO,GAAGX,cAAc,CAACU,OAA5C;AACA,UAAMG,SAAS,GAAG5B,KAAK,CAAC6B,cAAN,CAAqBlB,KAArB,CAAlB;AACAD,MAAAA,UAAU,CAACoB,GAAX,CACE,UADF,EAEE5B,mBAAmB,CAAC;AAClB6B,QAAAA,IAAI,EAAEpB,KADY;AAElBqB,QAAAA,QAAQ,EAAEvB,KAFQ;AAGlBwB,QAAAA,KAAK,EAAEjB,QAAQ,CAACS,OAHE;AAIlBS,QAAAA,cAAc,EAAEN,SAAS,GAAG3B,+BAAH,GAAqCkC;AAJ5C,OAAD,CAFrB;AASD;AACF,GAnB8B,EAmB5B,GAnB4B,CAA/B;;AAqBA,MAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,CAAChB,CAAD,EAAyB;AAAA;;AACjDD,IAAAA,YAAY,CAACC,CAAD,CAAZ;AACAA,IAAAA,CAAC,CAACiB,WAAF,CAAcb,wBAAd;AACAV,IAAAA,aAAa,CAACW,OAAd,GAAwB,IAAxB;AAHiD,QAIzCC,OAJyC,GAI7BN,CAAC,CAACO,OAAF,CAAU,CAAV,CAJ6B,CAIzCD,OAJyC;AAKjDX,IAAAA,cAAc,CAACU,OAAf,GAAyBC,OAAzB;AACAR,IAAAA,iBAAiB,CAACO,OAAlB,GAA4BR,cAAc,CAACR,KAAD,CAA1C;AAEA,wBAAAG,OAAO,CAACa,OAAR,sCAAiBa,gBAAjB,CAAkC,WAAlC,EAA+Cf,cAA/C,EAA+D;AAC7DgB,MAAAA,OAAO,EAAE,KADoD;AAE7DC,MAAAA,OAAO,EAAE;AAFoD,KAA/D;AAID,GAZD;;AAcA,MAAMC,eAAe,GAAG,SAAlBA,eAAkB,CAACrB,CAAD,EAAyB;AAAA;;AAC/CD,IAAAA,YAAY,CAACC,CAAD,CAAZ;AACAA,IAAAA,CAAC,CAACiB,WAAF,CAAcb,wBAAd;AACAV,IAAAA,aAAa,CAACW,OAAd,GAAwB,KAAxB;AACA,yBAAAb,OAAO,CAACa,OAAR,uCAAiBiB,mBAAjB,CAAqC,WAArC,EAAkDnB,cAAlD,EAAkE;AAChEiB,MAAAA,OAAO,EAAE;AADuD,KAAlE;AAGD,GAPD;;AASA,sBACE,eAAC,WAAD;AACE,IAAA,GAAG,EAAE5B,OADP;AAEE,IAAA,YAAY,EAAEwB,iBAFhB;AAGE,IAAA,UAAU,EAAEK,eAHd;AAIE,IAAA,aAAa,EAAEA,eAJjB;AAKE,kBAAYhC;AALd,UADF;AAWD,CApEM","sourcesContent":["import React from 'react';\nimport styled from 'styled-components';\nimport { Controller } from '@ali/4ever-cangjie';\nimport { DragIcon } from './dragIcon';\nimport Table from '../../../../mo/models';\nimport { DEFAULT_TOTAL_WIDTH_FOR_AUTOFIT } from '../../../../utils/constants';\nimport { resizeTableColWidth } from '../../../actions';\nimport { throttle } from 'lodash-es';\nimport { usePixelColsWidth } from '../../../../utils/hooks';\n\nconst DragWrapper = styled.div`\n  box-sizing: border-box;\n  position: absolute;\n  height: 21px;\n  width: 30px;\n  padding-right: 4px;\n  right: 0;\n  top: -3px;\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n`;\n\ninterface Props {\n  index: number;\n  controller: Controller;\n  table: Table;\n}\n\nexport const ColToolbarDragButton = (props: Props) => {\n  const { index, controller, table } = props;\n  const dragRef = React.useRef<HTMLDivElement>(null);\n  const isResizingRef = React.useRef(false);\n  const resizeStartRef = React.useRef(0);\n  const deltaRef = React.useRef(0);\n  const [pixelColsWidth] = usePixelColsWidth();\n  const originColWidthRef = React.useRef(0);\n  const preventEvent = (e: TouchEvent | React.TouchEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  const handleResizing = throttle((e: TouchEvent) => {\n    preventEvent(e);\n    e.stopImmediatePropagation();\n    if (isResizingRef.current) {\n      // 这里的 table 是 resizeStart 闭包里的 table 值\n      // 所以 delta 是 resizeStart - 当前 clientX\n      const { clientX } = e.touches[0];\n      deltaRef.current = clientX - resizeStartRef.current;\n      const isAutofit = Table.isAutofitWidth(table);\n      controller.run(\n        'onAction',\n        resizeTableColWidth({\n          node: table,\n          colIndex: index,\n          delta: deltaRef.current,\n          containerWidth: isAutofit ? DEFAULT_TOTAL_WIDTH_FOR_AUTOFIT : undefined,\n        }),\n      );\n    }\n  }, 100);\n\n  const handleResizeStart = (e: React.TouchEvent) => {\n    preventEvent(e);\n    e.nativeEvent.stopImmediatePropagation();\n    isResizingRef.current = true;\n    const { clientX } = e.touches[0];\n    resizeStartRef.current = clientX;\n    originColWidthRef.current = pixelColsWidth[index];\n\n    dragRef.current?.addEventListener('touchmove', handleResizing, {\n      passive: false,\n      capture: true,\n    });\n  };\n\n  const handleResizeEnd = (e: React.TouchEvent) => {\n    preventEvent(e);\n    e.nativeEvent.stopImmediatePropagation();\n    isResizingRef.current = false;\n    dragRef.current?.removeEventListener('touchmove', handleResizing, {\n      capture: true,\n    });\n  };\n\n  return (\n    <DragWrapper\n      ref={dragRef}\n      onTouchStart={handleResizeStart}\n      onTouchEnd={handleResizeEnd}\n      onTouchCancel={handleResizeEnd}\n      data-index={index}\n    >\n      <DragIcon />\n    </DragWrapper>\n  );\n};\n"],"file":"colToolbarDragButton.js"}