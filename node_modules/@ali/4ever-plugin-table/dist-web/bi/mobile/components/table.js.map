{"version":3,"sources":["../../../../../src/bi/mobile/components/table.tsx"],"names":["React","useEffect","useRef","useState","fastdom","throttle","styled","useZoomContainer","useSelectingHots","getBoundingRelativeRect","TableRightSideShadow","adjustColsWidth","DEFAULT_TOTAL_WIDTH_FOR_AUTOFIT","SCROLL_BAR_HEIGHT","MOBILE_SPACING","TableScrollContainer","PureTable","ContextContainer","MobileRowToolbar","MobileColToolbar","getToolbarTableSelection","TableSelection","getSelectedRowRangeFromTableSelection","getSelectedColRangeFromTableSelection","getDataTableSelectionByTable","getTableIsSelected","FloatToolbar","TOOLBAR_ITEM_SIZE_MOBILE","Scrollbar","Wrapper","div","TableWithSelection","ScrollContent","Table","props","node","controller","children","tableConfig","enableToolbar","value","isFocused","selection","toolbarVisible","setToolbarVisible","zoomContainer","window","document","body","shouldShowTableRightShadow","setShouldShowTableRightShadow","tableRef","wrapperRef","tableLeftShadowRef","tableRightShadowRef","updateShadowRafIdRef","updateShadowState","current","cancelAnimationFrame","requestAnimationFrame","measure","table","realTableWrapper","tableRect","realTableWrapperRect","scrollableContentWidth","width","newShouldShowRight","scrollLeft","updateShadowHeight","height","Math","round","style","isMountedRef","run","handleTableScroll","onScroll","getTableSelection","tblSelections","query","curTableSelection","find","ts","key","activeRowRange","selecteRowRange","activeColRange","selecteColRange","activeSelection","tableSelection","selectionType","data","tableType","start","startRowIndex","end","endRowIndex","startColIndex","endColIndex","includeTable","isSelected","useReducer","c","_","forceUpdate","onHots","useCallback","hots","some","hot","hasNode","left","overflowY","locale","display"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport fastdom from 'fastdom';\nimport { throttle } from 'lodash-es';\nimport styled from 'styled-components';\nimport { useZoomContainer, RenderNodeProps, useSelectingHots, Hot } from '@ali/4ever-cangjie';\nimport { getBoundingRelativeRect } from '@ali/4ever-utils';\nimport MoTable from '../../../mo/models';\nimport { TableRightSideShadow } from '../../components/styled';\nimport { MobileTableConfig } from '../../types';\nimport { adjustColsWidth } from '../../actions';\nimport { DEFAULT_TOTAL_WIDTH_FOR_AUTOFIT, SCROLL_BAR_HEIGHT, MOBILE_SPACING } from '../../../utils/constants';\nimport TableScrollContainer from '../../../components/tableScrollContainer';\nimport PureTable from '../../../components/pureTable';\nimport { ContextContainer } from '../../components/contextContainer';\nimport type { Range } from '../../components/rowColToolbarItemRect';\nimport { MobileRowToolbar } from './toolbar/mobileRowToolbar';\nimport { MobileColToolbar } from './toolbar/mobileColToolbar';\nimport { getToolbarTableSelection } from '../../utils/getToolbarTableSelection';\nimport TableSelection from '../../components/tableSelection';\nimport {\n  getSelectedRowRangeFromTableSelection,\n  getSelectedColRangeFromTableSelection,\n} from '../../utils/getSelectedRangeFromTableSelection';\nimport getDataTableSelectionByTable from '../../utils/getDataTableSelectionByTable';\nimport getTableIsSelected from '../../../utils/utils/getTableIsSelected';\nimport { FloatToolbar } from './floatToolbar';\nimport { TOOLBAR_ITEM_SIZE_MOBILE } from '../../constants';\nimport { Scrollbar } from './scrollbar';\n\ntype Props = {\n  tableConfig: MobileTableConfig;\n} & Omit<RenderNodeProps<MoTable>, 'attributes'>;\n\nconst Wrapper = styled.div`\n  position: relative;\n  // 使表格上下间距一致\n  padding-top: ${MOBILE_SPACING - TOOLBAR_ITEM_SIZE_MOBILE}px;\n  padding-bottom: ${MOBILE_SPACING - SCROLL_BAR_HEIGHT}px;\n`;\n\nconst TableWithSelection = styled.div`\n  position: relative;\n`;\n\nconst ScrollContent = styled.div`\n  position: relative;\n  left: ${TOOLBAR_ITEM_SIZE_MOBILE}px;\n  width: calc(100% - ${TOOLBAR_ITEM_SIZE_MOBILE}px);\n`;\n\nconst Table = (props: Props) => {\n  const { node, controller, children, tableConfig } = props;\n  const { enableToolbar } = tableConfig;\n  const { isFocused, selection } = controller.value;\n  const [toolbarVisible, setToolbarVisible] = React.useState(!!enableToolbar && isFocused);\n  const zoomContainer = useZoomContainer() || window.document.body;\n\n  const [shouldShowTableRightShadow, setShouldShowTableRightShadow] = useState(false);\n\n  const tableRef = useRef<HTMLTableElement>(null);\n  const wrapperRef = useRef<HTMLDivElement>(null);\n  const tableLeftShadowRef = useRef<HTMLDivElement>(null);\n  const tableRightShadowRef = useRef<HTMLDivElement>(null);\n  const updateShadowRafIdRef = useRef<number>(0);\n\n  const updateShadowState = () => {\n    // 文档模型更新后，DOM 不会立刻更新，所以需要等待 DOM 更新后再计算阴影的状态\n    if (updateShadowRafIdRef.current !== -1) {\n      window.cancelAnimationFrame(updateShadowRafIdRef.current);\n    }\n    updateShadowRafIdRef.current = window.requestAnimationFrame(() => {\n      fastdom.measure(() => {\n        const table = tableRef.current;\n        const realTableWrapper = wrapperRef.current;\n        if (!table || !realTableWrapper) {\n          return;\n        }\n        const tableRect = getBoundingRelativeRect(table, zoomContainer);\n\n        const realTableWrapperRect = getBoundingRelativeRect(\n          realTableWrapper,\n          zoomContainer,\n        );\n        const scrollableContentWidth = tableRect.width;\n        const newShouldShowRight =\n          scrollableContentWidth - realTableWrapper.scrollLeft >\n          realTableWrapperRect.width;\n        if (\n          newShouldShowRight !== shouldShowTableRightShadow\n        ) {\n          setShouldShowTableRightShadow(newShouldShowRight);\n        }\n      });\n    });\n  };\n\n  const updateShadowHeight = () => {\n    if (!tableRef.current) {\n      return;\n    }\n\n    const tableRect = getBoundingRelativeRect(tableRef.current, zoomContainer);\n    const height = `${Math.round(tableRect.height)}px`;\n\n    if (tableLeftShadowRef.current) {\n      tableLeftShadowRef.current.style.height = height;\n    }\n    if (tableRightShadowRef.current) {\n      tableRightShadowRef.current.style.height = height;\n    }\n  };\n\n  const isMountedRef = useRef(false);\n  useEffect(() => {\n    fastdom.measure(() => {\n      updateShadowHeight();\n    });\n    controller.run(\n      'onAction',\n      adjustColsWidth(node, DEFAULT_TOTAL_WIDTH_FOR_AUTOFIT),\n    );\n    if (!isMountedRef.current) {\n      updateShadowState();\n      isMountedRef.current = true;\n    }\n  });\n\n  const handleTableScroll = throttle(() => {\n    if (!wrapperRef.current) {\n      return;\n    }\n    if (tableConfig?.onScroll) {\n      tableConfig.onScroll(wrapperRef.current, node);\n    }\n    updateShadowState();\n  });\n\n  const getTableSelection = () => {\n    const tblSelections = controller.query(\n      'viewTableSelections',\n    );\n    if (!tblSelections) {\n      return null;\n    }\n    const curTableSelection = tblSelections.find(\n      (ts) => ts.key === node.key,\n    );\n    if (!curTableSelection) {\n      return null;\n    }\n    return curTableSelection;\n  };\n\n  let activeRowRange: Range | null = null;\n  let selecteRowRange: Range | null = null;\n  let activeColRange: Range | null = null;\n  let selecteColRange: Range | null = null;\n\n  const activeSelection = getToolbarTableSelection(controller, node);\n  const tableSelection = getDataTableSelectionByTable(controller, node);\n  const selectionType = selection.data.tableType;\n  activeRowRange = activeSelection\n    ? {\n      start: activeSelection.startRowIndex,\n      end: activeSelection.endRowIndex,\n    }\n    : null;\n  activeColRange = activeSelection\n    ? {\n      start: activeSelection.startColIndex,\n      end: activeSelection.endColIndex,\n    }\n    : null;\n  if (selectionType === 'row') {\n    selecteRowRange = getSelectedRowRangeFromTableSelection({\n      controller,\n      table: node,\n      tableSelection,\n      includeTable: true,\n    });\n  } else if (selectionType === 'col') {\n    selecteColRange = getSelectedColRangeFromTableSelection({\n      controller,\n      table: node,\n      tableSelection,\n      includeTable: true,\n    });\n  }\n  const isSelected = getTableIsSelected(node, controller);\n\n  React.useEffect(() => {\n    if (isFocused && enableToolbar) {\n      setToolbarVisible(true);\n    }\n  }, [isFocused, enableToolbar]);\n\n  const [_, forceUpdate] = React.useReducer((c) => c + 1, 0);\n\n  const onHots = React.useCallback((hots: Hot[]) => {\n    // PERF: 非当前表格热区不处理\n    if (\n      hots.some(\n        (hot) => node.key === hot.node.key || node.hasNode(hot.node.key),\n      )\n    ) {\n      forceUpdate();\n    }\n  }, [node]);\n\n  useSelectingHots(controller, onHots);\n\n  return (\n    <Wrapper data-type=\"table\">\n      <ContextContainer isSelected={isSelected}>\n        <TableScrollContainer\n          ref={wrapperRef}\n          className=\"real-table-wrapper\"\n          table={node}\n          controller={controller}\n          onScroll={handleTableScroll}\n          isMobile\n          style={{\n            left: -TOOLBAR_ITEM_SIZE_MOBILE,\n            width: `calc(100% + ${TOOLBAR_ITEM_SIZE_MOBILE}px)`,\n            overflowY: 'hidden',\n          }}\n          hideScrollBar\n        >\n          <MobileRowToolbar\n            table={node}\n            controller={controller}\n            visible={isSelected && toolbarVisible}\n            activeRange={activeRowRange}\n            selectRange={selecteRowRange}\n          />\n          <ScrollContent>\n            <MobileColToolbar\n              table={node}\n              controller={controller}\n              visible={toolbarVisible && isSelected}\n              activeRange={activeColRange}\n              selectRange={selecteColRange}\n            />\n            <TableWithSelection>\n              <PureTable\n                ref={tableRef}\n                node={node}\n                controller={controller}\n                isMobile\n              >\n                {children()}\n              </PureTable>\n              {toolbarVisible && <TableSelection\n                data-testid=\"table-selection-wrapper\"\n                node={node}\n                controller={controller}\n                selection={tableSelection}\n                tableRef={tableRef}\n                getTableSelection={getTableSelection}\n              />}\n            </TableWithSelection>\n          </ScrollContent>\n        </TableScrollContainer>\n        <Scrollbar\n          scrollContainer={wrapperRef.current}\n          scrollContent={tableRef.current}\n        />\n        {toolbarVisible && <FloatToolbar\n          controller={controller}\n          table={node}\n          tableSelection={tableSelection}\n          tableRef={tableRef}\n          locale={tableConfig.locale}\n          selecteRowRange={selecteRowRange}\n          selecteColRange={selecteColRange}\n        />}\n      </ContextContainer>\n      <TableRightSideShadow\n        ref={tableRightShadowRef}\n        style={{\n          display: shouldShowTableRightShadow ? 'block' : 'none',\n        }}\n      />\n    </Wrapper>\n  );\n};\n\nexport default Table;\n"],"file":"table.js"}