{"version":3,"sources":["../../../../src/bi/handlers/onArrowRight.ts"],"names":["Commands","isTableCell","isSelectionInTableCell","moveToStartOfCell","moveToStartOfNextSibling","setSelectionByTable","onArrowRight","event","controller","next","value","selection","document","startText","tableSelection","query","preventDefault","table","getNode","key","node","endColIndex","startRowIndex","cell","getClosest","getStart","isAtEndOfNode","currentCell","nextCell","getNextSibling","currentRow","getParent","nextRow","nodes","data","hidden","s","moveToStartOfNode","command","select"],"mappings":"AAAA,SAASA,QAAT,QAA4C,oBAA5C;AAEA,SAASC,WAAT;AACA,OAAOC,sBAAP;AACA,SAASC,iBAAT,EAA4BC,wBAA5B;AACA,OAAOC,mBAAP;AAEA,eAAe,SAASC,YAAT,CAAsBC,KAAtB,EAA6BC,UAA7B,EAAqDC,IAArD,EAA2D;AAAA,MAChEC,KADgE,GACtDF,UADsD,CAChEE,KADgE;AAAA,MAEhEC,SAFgE,GAE7BD,KAF6B,CAEhEC,SAFgE;AAAA,MAErDC,QAFqD,GAE7BF,KAF6B,CAErDE,QAFqD;AAAA,MAE3CC,SAF2C,GAE7BH,KAF6B,CAE3CG,SAF2C;AAIxE,MAAMC,cAAc,GAAGN,UAAU,CAACO,KAAX,CAAiB,gBAAjB,CAAvB;;AACA,MAAID,cAAJ,EAAoB;AAClBP,IAAAA,KAAK,CAACS,cAAN;AACA,QAAMC,KAAK,GAAGL,QAAQ,CAACM,OAAT,CAAiBJ,cAAc,CAACK,GAAhC,CAAd;;AACA,QAAI,CAACF,KAAL,EAAY;AACV;AACD;;AACD,QAAIT,UAAU,CAACO,KAAX,CAAiB,oBAAjB,EAAuC;AAAEK,MAAAA,IAAI,EAAEH;AAAR,KAAvC,CAAJ,EAA6D;AAC3D,aAAOb,wBAAwB,CAACI,UAAD,EAAaS,KAAb,CAA/B;AACD;;AARiB,QASVI,WATU,GASqBP,cATrB,CASVO,WATU;AAAA,QASGC,aATH,GASqBR,cATrB,CASGQ,aATH;AAUlB,WAAOnB,iBAAiB,CAACK,UAAD,EAAaS,KAAb,EAAoBK,aAApB,EAAmCD,WAAW,GAAG,CAAjD,CAAxB;AACD;;AAED,MAAI,CAACnB,sBAAsB,CAACQ,KAAD,CAA3B,EAAoC,OAAOD,IAAI,EAAX;AAEpC,MAAMc,IAAI,GAAGX,QAAQ,CAACY,UAAT,CAAoBX,SAApB,oBAAoBA,SAAS,CAAEM,GAA/B,EAAqClB,WAArC,CAAb,CApBwE,CAoBT;;AAC/D,MAAI,CAACsB,IAAL,EAAW,OAAOd,IAAI,EAAX;AAEX,MAAI,CAACE,SAAS,CAACc,QAAV,CAAmBb,QAAnB,EAA6Bc,aAA7B,CAA2CH,IAA3C,CAAL,EAAuD,OAAOd,IAAI,EAAX;AAEvD,MAAIkB,WAAW,GAAGJ,IAAlB;;AACA,KAAG;AACD,QAAIK,QAAQ,GAAGhB,QAAQ,CAACiB,cAAT,CAAwBF,WAAW,CAACR,GAApC,CAAf;;AACA,QAAI,CAACS,QAAL,EAAe;AACb,UAAME,UAAU,GAAGlB,QAAQ,CAACmB,SAAT,CAAmBJ,WAAW,CAACR,GAA/B,CAAnB;AACA,UAAMa,OAAO,GAAGpB,QAAQ,CAACiB,cAAT,CAAwBC,UAAU,CAACX,GAAnC,CAAhB;AACA,UAAI,CAACa,OAAL,EAAc,OAAOvB,IAAI,EAAX;AACdmB,MAAAA,QAAQ,GAAGI,OAAO,CAACC,KAAR,CAAc,CAAd,CAAX;AACD,KAPA,CAQD;;;AACAN,IAAAA,WAAW,GAAGC,QAAd;AACD,GAVD,QAUSD,WAAW,CAACO,IAAZ,CAAiBC,MAAjB,IAA2B,KAVpC,EA1BwE,CAsCxE;;;AACA5B,EAAAA,KAAK,CAACS,cAAN;AAEA,MAAMoB,CAAC,GAAGzB,SAAS,CAAC0B,iBAAV,CAA4BV,WAA5B,EAAyCnB,UAAzC,CAAV;AACA,SAAOA,UAAU,CAAC8B,OAAX,CAAmBtC,QAAQ,CAACuC,MAA5B,EAAoClC,mBAAmB,CAAC+B,CAAD,EAAI,KAAJ,CAAvD,CAAP;AACD","sourcesContent":["import { Commands, Controller, Block } from '@ali/4ever-cangjie';\nimport Table from '../../mo/models';\nimport { isTableCell } from '../types';\nimport isSelectionInTableCell from '../utils/isSelectionInTableCell';\nimport { moveToStartOfCell, moveToStartOfNextSibling } from '../utils/selectionCommands';\nimport setSelectionByTable from '../../utils/utils/setSelectionByTable';\n\nexport default function onArrowRight(event, controller: Controller, next) {\n  const { value } = controller;\n  const { selection, document, startText } = value;\n\n  const tableSelection = controller.query('tableSelection');\n  if (tableSelection) {\n    event.preventDefault();\n    const table = document.getNode(tableSelection.key) as Table | null;\n    if (!table) {\n      return;\n    }\n    if (controller.query('isSelectWholeTable', { node: table })) {\n      return moveToStartOfNextSibling(controller, table);\n    }\n    const { endColIndex, startRowIndex } = tableSelection;\n    return moveToStartOfCell(controller, table, startRowIndex, endColIndex + 1);\n  }\n\n  if (!isSelectionInTableCell(value)) return next();\n\n  const cell = document.getClosest(startText?.key!, isTableCell);// document.getClosest 有可能返回空\n  if (!cell) return next();\n\n  if (!selection.getStart(document).isAtEndOfNode(cell)) return next();\n\n  let currentCell = cell;\n  do {\n    let nextCell = document.getNextSibling(currentCell.key);\n    if (!nextCell) {\n      const currentRow = document.getParent(currentCell.key)!;\n      const nextRow = document.getNextSibling(currentRow.key) as Block;\n      if (!nextRow) return next();\n      nextCell = nextRow.nodes[0];\n    }\n    // @ts-ignore\n    currentCell = nextCell;\n  } while (currentCell.data.hidden || false);\n\n  // 阻止 Cangjie 默认事件\n  event.preventDefault();\n\n  const s = selection.moveToStartOfNode(currentCell, controller);\n  return controller.command(Commands.select, setSelectionByTable(s, false));\n}\n"],"file":"onArrowRight.js"}