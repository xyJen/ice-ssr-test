{"version":3,"sources":["../../../../src/bi/handlers/onArrowLeft.ts"],"names":["Commands","isTableCell","moveToStartOfCell","setSelectionByTable","onArrowLeft","event","controller","next","value","selection","document","startText","tableSelection","query","preventDefault","table","getNode","key","startColIndex","startRowIndex","isExpanded","getStart","isAtStartOfNode","prevText","getPreviousText","cell","getClosest","data","hidden","currentCell","prevCell","getPreviousSibling","currentRow","getParent","prevRow","nodes","length","s","moveToEndOfNode","command","select"],"mappings":"AAAA,SAASA,QAAT,QAAqC,oBAArC;AAEA,SAASC,WAAT;AACA,SAASC,iBAAT;AACA,OAAOC,mBAAP;AAEA,eAAe,SAASC,WAAT,CAAqBC,KAArB,EAA4BC,UAA5B,EAAoDC,IAApD,EAA0D;AAAA,MAC/DC,KAD+D,GACrDF,UADqD,CAC/DE,KAD+D;AAAA,MAE/DC,SAF+D,GAE5BD,KAF4B,CAE/DC,SAF+D;AAAA,MAEpDC,QAFoD,GAE5BF,KAF4B,CAEpDE,QAFoD;AAAA,MAE1CC,SAF0C,GAE5BH,KAF4B,CAE1CG,SAF0C;AAIvE,MAAMC,cAAc,GAAGN,UAAU,CAACO,KAAX,CAAiB,gBAAjB,CAAvB;;AACA,MAAID,cAAJ,EAAoB;AAClBP,IAAAA,KAAK,CAACS,cAAN;AACA,QAAMC,KAAK,GAAGL,QAAQ,CAACM,OAAT,CAAiBJ,cAAc,CAACK,GAAhC,CAAd;;AACA,QAAI,CAACF,KAAL,EAAY;AACV;AACD;;AALiB,QAMVG,aANU,GAMuBN,cANvB,CAMVM,aANU;AAAA,QAMKC,aANL,GAMuBP,cANvB,CAMKO,aANL;AAOlB,WAAOjB,iBAAiB,CAACI,UAAD,EAAaS,KAAb,EAAoBI,aAApB,EAAmCD,aAAnC,CAAxB;AACD;;AAED,MAAIT,SAAS,CAACW,UAAV,IAAwB,CAACX,SAAS,CAACY,QAAV,CAAmBX,QAAnB,EAA6BY,eAA7B,CAA6CX,SAA7C,CAA7B,EAAuF,OAAOJ,IAAI,EAAX;AAEvF,MAAMgB,QAAQ,GAAGb,QAAQ,CAACc,eAAT,CAAyBb,SAAS,CAAEM,GAApC,CAAjB;AACA,MAAI,CAACM,QAAL,EAAe,OAAOhB,IAAI,EAAX;AAEf,MAAMkB,IAAI,GAAGf,QAAQ,CAACgB,UAAT,CAAoBH,QAAQ,CAACN,GAA7B,EAAkChB,WAAlC,CAAb;AACA,MAAI,CAACwB,IAAD,IAAS,CAACA,IAAI,CAACE,IAAL,CAAUC,MAAxB,EAAgC,OAAOrB,IAAI,EAAX;AAEhC,MAAIsB,WAAW,GAAGJ,IAAlB;;AACA,KAAG;AACD,QAAIK,QAAQ,GAAGpB,QAAQ,CAACqB,kBAAT,CAA4BF,WAAW,CAACZ,GAAxC,CAAf;;AACA,QAAI,CAACa,QAAL,EAAe;AACb,UAAME,UAAU,GAAGtB,QAAQ,CAACuB,SAAT,CAAmBJ,WAAW,CAACZ,GAA/B,CAAnB;AACA,UAAMiB,OAAO,GAAGxB,QAAQ,CAACqB,kBAAT,CAA4BC,UAAU,CAAEf,GAAxC,CAAhB;AACA,UAAI,CAACiB,OAAL,EAAc,OAAO3B,IAAI,EAAX,CAHD,CAIb;;AACAuB,MAAAA,QAAQ,GAAGI,OAAO,CAACC,KAAR,CAAcD,OAAO,CAACC,KAAR,CAAcC,MAAd,GAAuB,CAArC,CAAX;AACD,KARA,CASD;;;AACAP,IAAAA,WAAW,GAAGC,QAAd;AACD,GAXD,QAWSD,WAAW,CAACF,IAAZ,CAAiBC,MAAjB,IAA2B,KAXpC;;AAaA,MAAMS,CAAC,GAAG5B,SAAS,CAAC6B,eAAV,CAA0BT,WAA1B,EAAuCvB,UAAvC,CAAV;AACA,SAAOA,UAAU,CAACiC,OAAX,CAAmBvC,QAAQ,CAACwC,MAA5B,EAAoCrC,mBAAmB,CAACkC,CAAD,EAAI,KAAJ,CAAvD,CAAP;AACD","sourcesContent":["import { Commands, Controller } from '@ali/4ever-cangjie';\nimport Table from '../../mo/models';\nimport { isTableCell } from '../types';\nimport { moveToStartOfCell } from '../utils/selectionCommands';\nimport setSelectionByTable from '../../utils/utils/setSelectionByTable';\n\nexport default function onArrowLeft(event, controller: Controller, next) {\n  const { value } = controller;\n  const { selection, document, startText } = value;\n\n  const tableSelection = controller.query('tableSelection');\n  if (tableSelection) {\n    event.preventDefault();\n    const table = document.getNode(tableSelection.key) as Table | null;\n    if (!table) {\n      return;\n    }\n    const { startColIndex, startRowIndex } = tableSelection;\n    return moveToStartOfCell(controller, table, startRowIndex, startColIndex);\n  }\n\n  if (selection.isExpanded || !selection.getStart(document).isAtStartOfNode(startText!)) return next();\n\n  const prevText = document.getPreviousText(startText!.key);\n  if (!prevText) return next();\n\n  const cell = document.getClosest(prevText.key, isTableCell);\n  if (!cell || !cell.data.hidden) return next();\n\n  let currentCell = cell;\n  do {\n    let prevCell = document.getPreviousSibling(currentCell.key);\n    if (!prevCell) {\n      const currentRow = document.getParent(currentCell.key);\n      const prevRow = document.getPreviousSibling(currentRow!.key);\n      if (!prevRow) return next();\n      // @ts-ignore\n      prevCell = prevRow.nodes[prevRow.nodes.length - 1];\n    }\n    // @ts-ignore\n    currentCell = prevCell;\n  } while (currentCell.data.hidden || false);\n\n  const s = selection.moveToEndOfNode(currentCell, controller);\n  return controller.command(Commands.select, setSelectionByTable(s, false));\n}\n"],"file":"onArrowLeft.js"}