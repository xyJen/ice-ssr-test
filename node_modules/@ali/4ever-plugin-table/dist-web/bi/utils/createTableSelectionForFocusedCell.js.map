{"version":3,"sources":["../../../../src/bi/utils/createTableSelectionForFocusedCell.ts"],"names":["Path","createTableSelectionForFocusedCell","value","table","data","edgeSelection","selection","document","startPoint","getStart","endPoint","getEnd","startKey","key","endKey","startPath","getPath","endPath","selectionPath","common","length","tablePath","isSelectionInTableCell","isAncestor","slice","startRowIndex","startColIndex","nodes","cell","rowSpan","colSpan","endRowIndex","endColIndex"],"mappings":"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","sourcesContent":["import { Path, Value } from '@ali/4ever-cangjie';\nimport Table from '../../mo/models';\nimport { ITableSelection } from '../types';\n\nexport default function createTableSelectionForFocusedCell(\n  value: Value,\n  table: Table,\n): ITableSelection | null {\n  if (value.data.edgeSelection) {\n    return null;\n  }\n\n  if (!table) {\n    return null;\n  }\n\n  const { selection, document } = value;\n\n  if (!selection) {\n    return null;\n  }\n\n  const startPoint = selection.getStart(document);\n  const endPoint = selection.getEnd(document);\n\n  const startKey = startPoint?.key;\n  const endKey = endPoint?.key;\n\n\n  if (!startKey || !endKey) {\n    return null;\n  }\n\n  const startPath = document.getPath(startKey);\n  const endPath = document.getPath(endKey);\n  if (!startPath || !endPath) {\n    return null;\n  }\n\n  const selectionPath = Path.common(startPath, endPath);\n  if (!selectionPath.length) {\n    return null;\n  }\n\n  const tablePath = document.getPath(table.key);\n  if (!tablePath) {\n    return null;\n  }\n\n  const isSelectionInTableCell = Path.isAncestor(tablePath, selectionPath)\n    && selectionPath.length - tablePath.length >= 2;\n  if (!isSelectionInTableCell) {\n    return null;\n  }\n\n  const [startRowIndex, startColIndex] = selectionPath\n    .slice(tablePath.length, tablePath.length + 2);\n\n\n  // 表格分裂时，startRowIndex 可能大于 renderTable 行数\n  if (startRowIndex >= table.nodes.length) {\n    return null;\n  }\n  const cell = table.nodes[startRowIndex].nodes[startColIndex];\n\n  // 快捷插入列时，cell 会不存在\n  if (!cell) {\n    return null;\n  }\n  const rowSpan = (cell.data && cell.data.rowSpan) || 1;\n  const colSpan = (cell.data && cell.data.colSpan) || 1;\n  const endRowIndex = startRowIndex + rowSpan - 1;\n  const endColIndex = startColIndex + colSpan - 1;\n\n  return {\n    key: table.key,\n    startRowIndex,\n    endRowIndex,\n    startColIndex,\n    endColIndex,\n  };\n}\n"],"file":"createTableSelectionForFocusedCell.js"}