{"version":3,"sources":["../../../../src/utils/utils/horizontalScroll.ts"],"names":["throttle","fastdom","TOOLBAR_ITEM_SIZE","THUMB_HEIGH","TEST_ID","ScrollMode","Scroller","targetTableWrapperEl","getBottom","mountDom","mode","fullwidth","scrollBar","bar","thumb","checkIfScrollVisible","handleTableWrapperScroll","syncDestoryHandler","tableElObserver","needResetBottom","currentBottom","Error","document","body","footerHeight","scroller","createElement","setAttribute","style","height","position","bottom","zIndex","opacity","resetScroller","appendChild","backgroundColor","borderRadius","e","instance","measure","viewHeight","window","innerHeight","documentElement","clientHeight","getBoundingClientRect","top","hideScroller","resetBar","showScroller","addEventListener","resetThumbPosition","initScrollSyncHandler","MutationObserver","setTimeout","observe","childList","subtree","attributes","attributeFilter","changeScrollerVisible","widthPercentage","clientWidth","scrollWidth","thumbWidth","Math","min","width","transform","moveX","boundingClientRect","isBottomChange","left","cursorDown","tempClientX","rate","getRate","offsetWidth","mouseMoveDocumentHandler","clientX","offset","originTempClientX","tempScrollleft","scrollLeft","mouseUpDocumentHandler","removeEventListener","onselectstart","startDrag","stopImmediatePropagation","handleThumbMouseDown","ctrlKey","button","handleBarClick","target","thumbPosition","targetScrollLeft","scrollTo","behavior","display","always","destroy","disconnect","parentNode","removeChild"],"mappings":"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","sourcesContent":["/**\n * 创建一个scroller的dom\n */\nimport { throttle } from 'lodash-es';\nimport fastdom from 'fastdom';\nimport { TOOLBAR_ITEM_SIZE } from '../constants';\n\n// 滚动条高度\nconst THUMB_HEIGH = 6;\nconst TEST_ID = 'table-horizontal-scrollbar';\n\n/**\n * 滚动条显示模式：\n *  - always：强制常驻\n *  - default：默认只在需要的时候展示\n */\nenum ScrollMode {\n  always = 'always',\n  default = 'default',\n}\n\nexport default class Scroller {\n  /**\n   * 表格滚动容器\n   */\n  readonly targetTableWrapperEl: HTMLDivElement;\n\n  /**\n   * 滚动条宽度是否占满，占满则不显示滚动条\n   */\n  private fullwidth: boolean;\n\n  /**\n   * 滚动条显示模式：默认只在需要的时候展示\n   */\n  readonly mode: ScrollMode;\n\n  /**\n   * 需要添加的滚动条dom\n   */\n  readonly scrollBar: HTMLDivElement;\n\n  /**\n   * 需要添加的滚动条杆dom\n   */\n  readonly bar: HTMLDivElement;\n\n  /**\n   * 需要添加的滚动条滑块dom\n   */\n  readonly thumb: HTMLDivElement;\n\n  /**\n   * 滚动时检查是否需要隐藏或者展示滚动条\n   */\n  readonly checkIfScrollVisible: () => void;\n\n  readonly handleTableWrapperScroll: () => void;\n\n  /**\n   * 销毁用于同步点击滚动条移动表格的事件监听器\n   */\n  readonly syncDestoryHandler: () => void;\n\n  /**\n   * 监听目标表格dom变化的observer\n   */\n  readonly tableElObserver: MutationObserver;\n\n  /**\n   * 滚动条挂载容器\n   */\n  readonly mountDom: HTMLElement | Window | null;\n\n  /**\n   * @param targetTableWrapperEl 表格滚动容器\n   * @param getBottom 获取滚动条到页面底部的距离\n   * @param mountDom 滚动条挂载容器\n   * @param mode 滚动条显示模式：默认只在需要的时候展示\n   */\n  readonly getBottom: undefined | (() => number);\n\n  /** 是否需要重新设置bottom */\n  private needResetBottom: boolean;\n\n  /** 当前bottom */\n  private currentBottom: number;\n\n  constructor(\n    targetTableWrapperEl: HTMLDivElement,\n    getBottom?: undefined | (() => number),\n    mountDom?: HTMLElement | Window | null,\n    mode = ScrollMode.default,\n  ) {\n    if (!targetTableWrapperEl) {\n      throw new Error('need have table element');\n    }\n    this.targetTableWrapperEl = targetTableWrapperEl;\n    this.fullwidth = false;\n    this.mode = mode;\n    this.mountDom = mountDom || document.body;\n    this.getBottom = getBottom;\n    this.needResetBottom = !!getBottom; // 如果传了getBottom则说明需要对bottom进行重置操作\n    /**\n     * 添加滚动条dom节点\n     */\n    const footerHeight = getBottom ? getBottom() : 0;\n    const scroller = document.createElement('div');\n    scroller.setAttribute('data-testid', TEST_ID);\n    scroller.style.height = `${THUMB_HEIGH}px`;\n    scroller.style.position = 'fixed';\n    scroller.style.bottom = `${footerHeight}px`;\n    this.currentBottom = footerHeight;\n    // z-index 要高于内容区域 以及 右侧分屏面板的 z-index\n    scroller.style.zIndex = '200';\n    scroller.style.opacity = '0';\n\n    this.scrollBar = scroller;\n    this.resetScroller();\n\n    const bar = document.createElement('div');\n    bar.style.height = '100%';\n    this.bar = bar;\n    scroller.appendChild(bar);\n\n    const thumb = document.createElement('div');\n    thumb.style.height = '100%';\n    thumb.style.backgroundColor = 'rgb(205, 205, 210)';\n    thumb.style.borderRadius = '5px';\n    bar.appendChild(thumb);\n    this.thumb = thumb;\n    try {\n      (this.mountDom as HTMLElement).appendChild(this.scrollBar);\n    } catch (e) {\n      document.body.appendChild(this.scrollBar);\n    }\n    /**\n     * 初始化配置\n     */\n    const instance = this;\n    this.checkIfScrollVisible = throttle(() => {\n      fastdom.measure(() => {\n        const viewHeight = window.innerHeight || document.documentElement.clientHeight;\n        // 当前可视区域超出表格最下方或者最上方时，隐藏\n        const { top, bottom } = this.targetTableWrapperEl.getBoundingClientRect();\n        // 当表格上方已经处于视口边缘一定距离阈值内时，不必再显示滚动条\n        if (bottom <= viewHeight || top >= viewHeight - THUMB_HEIGH * 2 - TOOLBAR_ITEM_SIZE) {\n          instance.hideScroller();\n        } else {\n          // 需要重新设置一次当前宽度\n          instance.resetBar(false);\n          instance.resetScroller();\n          // 显示当前的bar\n          instance.showScroller();\n        }\n      });\n    }\n    , 1000 / 60);\n    document.addEventListener('scroll', this.checkIfScrollVisible, true); // 全局判断是否需要显示scroller\n\n    this.handleTableWrapperScroll = throttle(() => {\n      fastdom.measure(() => {\n        instance.resetThumbPosition();\n      });\n    }, 1000 / 60);\n\n    // 自动同步,table => scroller\n    targetTableWrapperEl.addEventListener('scroll', this.handleTableWrapperScroll, true);\n\n    // 自动同步 scroller => table\n    this.syncDestoryHandler = this.initScrollSyncHandler();\n\n    // 监听table的dom变化，自动重新设置\n    this.tableElObserver = new MutationObserver(() => {\n      setTimeout(() => {\n        fastdom.measure(() => {\n          instance.resetBar();\n          instance.resetScroller();\n          instance.resetThumbPosition();\n          instance.checkIfScrollVisible();\n        });\n      });\n    });\n    this.tableElObserver.observe(\n      targetTableWrapperEl,\n      {\n        childList: true,\n        subtree: true, // Todo: @muyu 这里不确定只观察父节点变更是否会有bug，因此子节点变化也一并观察，可能会对性能有影响。\n        attributes: true,\n        attributeFilter: ['style'], // 只关注目标dom节点的style变化\n      },\n    );\n    // bar宽度自动重制\n    setTimeout(() => {\n      fastdom.measure(() => {\n        instance.resetBar();\n        instance.resetScroller();\n        instance.resetThumbPosition();\n        instance.checkIfScrollVisible();\n        scroller.style.opacity = '1';\n      });\n    }, 500);\n  }\n\n  /**\n   * 自动设置Bar\n   * @param {boolean} changeScrollerVisible 是否开启自动设置滚动条显示与否\n   */\n  resetBar(changeScrollerVisible = true) {\n    const { targetTableWrapperEl } = this;\n    const widthPercentage = (targetTableWrapperEl.clientWidth * 100 / targetTableWrapperEl.scrollWidth);\n    const thumbWidth = Math.min(widthPercentage, 100);\n    this.thumb.style.width = `${thumbWidth}%`;\n\n    this.fullwidth = thumbWidth >= 100;\n\n    if (changeScrollerVisible) {\n      if (this.fullwidth) {\n        this.hideScroller();\n      } else {\n        this.checkIfScrollVisible();\n      }\n    }\n  }\n\n  resetThumbPosition() {\n    // 通过transform来模拟滑块滚动\n    this.thumb.style.transform = `translateX(${this.moveX}%)`;\n  }\n\n  // 调整滚动条位置以及宽度\n  resetScroller() {\n    const { targetTableWrapperEl, scrollBar } = this;\n    const boundingClientRect = targetTableWrapperEl.getBoundingClientRect();\n    // 文档Footer的高度是固定的，缩放只针对Content区域，因此只需要获取其高度并设置一次bottom即可\n    if (this.needResetBottom) {\n      // 但是要考虑window.innerHeight 变化的场景\n      const footerHeight = this.getBottom!(); \n      const isBottomChange = footerHeight !== this.currentBottom;\n      if (isBottomChange) {\n        const bottom = footerHeight || 0;\n        // 文档由于底部Footer也是fixed，因此bottom不能设置为0，只能动态获取Footer的高度来设置bottom\n        scrollBar.style.bottom = `${bottom}px`;\n        this.currentBottom = bottom;\n      }\n    }\n    scrollBar.style.left = `${boundingClientRect.left }px`;\n    scrollBar.style.width = `${boundingClientRect.width }px`;\n  }\n\n  // 滑块位移计算\n  get moveX() {\n    const { targetTableWrapperEl } = this;\n    return ((targetTableWrapperEl.scrollLeft * 100) / targetTableWrapperEl.clientWidth);\n  }\n\n  /**\n   * 让scroller的拖动行为和table的同步\n   */\n  initScrollSyncHandler() {\n    let cursorDown = false;\n    let tempClientX = 0;\n    let rate = 1;\n\n    const { thumb, targetTableWrapperEl, bar } = this;\n\n    function getRate() {\n      // 计算一下变换比例，拖拽走的是具体数字，但是这个实际上应该是按照比例变的\n      return bar.offsetWidth / thumb.offsetWidth;\n    }\n\n    const mouseMoveDocumentHandler = throttle(\n      (e: MouseEvent) => {\n        // 拖动的时候如果已经松开鼠标则不处理\n        // cursorDown 是拖拽开启和结束的标识\n        if (cursorDown === false) {\n          return;\n        }\n        const { clientX } = e;\n        const offset = clientX - tempClientX;\n        const originTempClientX = tempClientX;\n        tempClientX = clientX;\n\n        const tempScrollleft = targetTableWrapperEl.scrollLeft;\n        targetTableWrapperEl.scrollLeft += offset * rate;\n        if (tempScrollleft === targetTableWrapperEl.scrollLeft) {\n          tempClientX = originTempClientX;\n        }\n      }, 1000 / 60,\n    );\n\n    function mouseUpDocumentHandler() {\n      cursorDown = false;\n      document.removeEventListener('mousemove', mouseMoveDocumentHandler);\n      document.removeEventListener('mouseup', mouseUpDocumentHandler);\n      document.onselectstart = null;\n    }\n\n    /**\n     * 拖拽处理\n     */\n    function startDrag(e: MouseEvent) {\n      e.stopImmediatePropagation();\n      cursorDown = true;\n      document.addEventListener('mousemove', mouseMoveDocumentHandler);\n      document.addEventListener('mouseup', mouseUpDocumentHandler);\n      document.onselectstart = () => false;\n    }\n\n    function handleThumbMouseDown(e: MouseEvent) {\n      // 右键点击以及ctrl+click事件不处理\n      if (e.ctrlKey || e.button === 2) {\n        return;\n      }\n\n      const { clientX } = e;\n      tempClientX = clientX;\n      rate = getRate();\n      startDrag(e);\n    }\n\n    thumb.addEventListener('mousedown', handleThumbMouseDown);\n\n    /**\n     * 点击槽快速移动\n     */\n\n    function handleBarClick(e: MouseEvent) {\n      const { target } = e;\n      if (target !== bar) {\n        return;\n      }\n      rate = getRate();\n      const { clientX } = e;\n      let offset = 0;\n      const thumbPosition = thumb.getBoundingClientRect();\n      if (thumbPosition.left >= clientX) {\n        offset = (clientX - thumbPosition.left);\n      } else {\n        offset = clientX - thumbPosition.left - thumbPosition.width;\n      }\n\n      const targetScrollLeft = targetTableWrapperEl.scrollLeft + offset * rate;\n      targetTableWrapperEl.scrollTo({\n        left: targetScrollLeft,\n        behavior: 'smooth',\n      });\n    }\n\n    bar.addEventListener('click', handleBarClick);\n\n    return function () {\n      thumb.removeEventListener('mousedown', handleThumbMouseDown);\n      bar.removeEventListener('click', handleBarClick);\n      document.removeEventListener('mouseup', mouseUpDocumentHandler);\n      document.removeEventListener('mousemove', mouseMoveDocumentHandler);\n    };\n  }\n\n  /**\n   * 显示整体\n   */\n  showScroller() {\n    if (!this.fullwidth) {\n      this.scrollBar.style.display = 'initial';\n    }\n  }\n\n  /**\n   * 隐藏整体\n   */\n  hideScroller() {\n    if (this.mode === ScrollMode.always) {\n      this.scrollBar.style.display = 'initial';\n    } else {\n      this.scrollBar.style.display = 'none';\n    }\n  }\n\n  /**\n  * 添加事件监听\n  */\n  addEventListener() {\n    this.mountDom?.addEventListener('scroll', this.checkIfScrollVisible);\n    this.targetTableWrapperEl.addEventListener('scroll', this.handleTableWrapperScroll);\n  }\n\n  /**\n   * 移除事件监听\n   */\n  removeEventListener() {\n    this.mountDom?.removeEventListener('scroll', this.checkIfScrollVisible);\n    this.targetTableWrapperEl.removeEventListener('scroll', this.handleTableWrapperScroll);\n  }\n\n  /**\n   * 销毁实例：\n   * - 取消observer监听\n   * - 监听器注销\n   * - 滚动条dom移除\n   */\n  destroy() {\n    this.tableElObserver.disconnect();\n    this.removeEventListener();\n    this.syncDestoryHandler();\n    this.thumb.parentNode?.removeChild(this.thumb);\n    this.bar.parentNode?.removeChild(this.bar);\n    this.scrollBar.parentNode?.removeChild(this.scrollBar);\n  }\n}\n"],"file":"horizontalScroll.js"}