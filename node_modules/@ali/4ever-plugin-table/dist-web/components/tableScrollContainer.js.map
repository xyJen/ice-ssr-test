{"version":3,"sources":["../../../src/components/tableScrollContainer.tsx"],"names":["React","useEffect","useRef","useState","styled","noop","throttle","equal","SelectionSlot","useZoomContainer","useZoom","useScrollableContainer","Table","TableCell","QUICK_INSERT_BUTTON_WIDTH_HEIGHT","SCROLL_BAR_HEIGHT","DEFAULT_TOTAL_WIDTH_FOR_AUTOFIT","HorizontalScroll","SCROLLABLE_ATTRIBUTE","TableScrollContainerContext","TableScrollContainerWidthContext","TableScrollContainerScrollLeftContext","usePixelColsWidth","convertFromPercentToPixel","getPositionOfCell","useSelectionStatus","getBoundingRelativeRect","useResizeObserver","visibleUtil","Wrapper","div","p","hideScrollBar","TableScrollContainer","forwardRef","props","forRef","children","table","controller","isMobile","onMouseEnter","onMouseMove","onScroll","disableHorizontalScrollbar","rest","scrollableContainer","zoomContainer","zoom","horizontalScrollRef","ref","width","setWidth","scrollLeft","setScrollLeft","widthRef","intersectionObRef","current","callback","entries","isVisible","intersectionRatio","setVisible","key","removeEventListener","addEventListener","getFootBottom","isWindow","window","scrollContainerBottom","innerHeight","getBoundingClientRect","bottom","footerHeight","Math","ceil","max","IntersectionObserver","observe","unobserve","undefined","handleScroll","e","left","Number","isFinite","colsWidthByPixel","setColsWidthByPixel","pixelColsWidth","setPixelColsWidth","prevPixelColsWidth","newPixelColsWidth","isAutofitWidth","data","colsWidth","prevColsWidth","totalWidth","pxlColsWidth","totalColsWidth","reduce","acc","cw","prevTotalColsWidth","resizeObserverCallback","useCallback","rect","actualWith","min","prevPosition","handleScrollIntoView","focusPosition","colIndex","index","targetColRightBorder","slice","sum","colWidth","targetColLeftBorder","length","requestAnimationFrame","realTableWrapperRect","sl","finalScrollLeft","shouldUpdateTable","isPendingSelected","range","isCollapsed","focusCell","value","document","getClosest","focus","isTableCell","position","rowIndex"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport { noop, throttle } from 'lodash-es';\nimport equal from 'fast-deep-equal';\nimport { Controller, SelectionSlot, useZoomContainer, useZoom, useScrollableContainer } from '@ali/4ever-cangjie';\nimport Table from '../mo/models';\nimport TableCell from '../mo/models/tableCell';\nimport { QUICK_INSERT_BUTTON_WIDTH_HEIGHT, SCROLL_BAR_HEIGHT, DEFAULT_TOTAL_WIDTH_FOR_AUTOFIT } from '../utils/constants';\nimport HorizontalScroll from '../utils/utils/horizontalScroll';\nimport { SCROLLABLE_ATTRIBUTE } from '@ali/4ever-plugin-draggable';\nimport {\n  TableScrollContainerContext,\n  TableScrollContainerWidthContext,\n  TableScrollContainerScrollLeftContext,\n  usePixelColsWidth,\n} from '../utils/hooks';\nimport { convertFromPercentToPixel } from '../utils/utils/colsWidthConverter';\nimport getPositionOfCell from '../utils/utils/getPositionOfCell';\nimport { useSelectionStatus } from '../utils/hooks/useSelectionStatus';\nimport { getBoundingRelativeRect } from '@ali/4ever-utils';\nimport useResizeObserver from '../utils/utils/useResizeObserver';\nimport { visibleUtil } from '../utils/utils/visibleUtil';\n\nexport const Wrapper = styled.div<{ hideScrollBar?: boolean }>`\n  overflow-x: scroll;\n  overflow-y: auto;\n  position: relative;\n\n  ::-webkit-scrollbar {\n    width: ${SCROLL_BAR_HEIGHT}px;\n    height: ${SCROLL_BAR_HEIGHT}px;\n  }\n  :hover::-webkit-scrollbar-thumb {\n    background: rgba(0, 0, 0, 0.12);\n    border-radius: 5px;\n    border: 1px solid transparent;\n    background-clip: content-box;\n  }\n  :hover::-webkit-scrollbar-thumb:hover {\n    background: rgba(0, 0, 0, 0.20);\n    border-radius: 5px;\n    border: 1px solid transparent;\n    background-clip: content-box;\n  }\n\n  ${(p) => (p.hideScrollBar ? `\n    ::-webkit-scrollbar {\n      display: none;\n    }\n    ::-webkit-scrollbar-thumb {\n      display: none;\n    }\n  ` : '')}\n`;\n\nexport interface Props {\n  children: any;\n  table: Table;\n  controller: Controller;\n  className?: string;\n  style?: React.CSSProperties;\n  isMobile?: boolean;\n  onMouseEnter?: (e: Event) => void;\n  onMouseMove?: (e: Event) => void;\n  onScroll?: (e: Event) => void;\n  disableHorizontalScrollbar?: boolean;\n  hideScrollBar?: boolean;\n}\n\nconst TableScrollContainer = React.forwardRef<HTMLDivElement, Props>((props, forRef) => {\n  const {\n    children,\n    table,\n    controller,\n    isMobile,\n    onMouseEnter = noop,\n    onMouseMove = noop,\n    onScroll,\n    disableHorizontalScrollbar,\n    hideScrollBar,\n    ...rest\n  } = props;\n  const scrollableContainer = useScrollableContainer();\n  const zoomContainer = useZoomContainer();\n  const zoom = useZoom();\n\n  const horizontalScrollRef = useRef<any>(null);\n  const ref = useRef<HTMLDivElement>(null);\n  const [width, setWidth] = useState(0);\n  const [scrollLeft, setScrollLeft] = useState(0);\n  const widthRef = useRef(width);\n\n  const intersectionObRef = useRef<IntersectionObserver | null>(null);\n\n  useEffect(() => {\n    if (\n      !disableHorizontalScrollbar\n      && scrollableContainer\n      && !isMobile\n      && ref.current\n    ) {\n      const callback = function (entries) {\n        const isVisible = entries[0].intersectionRatio > 0;\n        visibleUtil.setVisible(table.key, isVisible);\n        if (!isVisible) {\n          horizontalScrollRef.current?.removeEventListener();\n        } else if (horizontalScrollRef.current) {\n          // fix: https://work.aone.alibaba-inc.com/issue/44551345\n          horizontalScrollRef.current?.addEventListener();\n        } else if (ref.current) {\n          const getFootBottom = () => {\n            const isWindow = (scrollableContainer as any).window;\n            const scrollContainerBottom = isWindow ?\n              window.innerHeight : (scrollableContainer as HTMLElement).getBoundingClientRect().bottom;\n            const footerHeight = Math.ceil(window.innerHeight - scrollContainerBottom);\n            return Math.max(footerHeight, 0);\n          };\n          horizontalScrollRef.current = new HorizontalScroll(\n            ref.current,\n            getFootBottom,\n            scrollableContainer,\n          );\n        }\n      };\n      intersectionObRef.current = new IntersectionObserver(callback);\n      intersectionObRef.current.observe(ref.current);\n      return () => {\n        if (ref.current) {\n          intersectionObRef.current?.unobserve(ref.current);\n        }\n      };\n    }\n    return undefined;\n  }, [scrollableContainer, isMobile, disableHorizontalScrollbar, table.key]);\n\n  useEffect(() => {\n    if (typeof forRef === 'function') {\n      forRef(ref.current);\n    } else if (forRef) {\n      forRef.current = ref.current;\n    }\n  }, [ref, forRef]);\n\n  const handleScroll = throttle((e: any) => {\n    onScroll && onScroll(e);\n    const left = ref.current?.scrollLeft;\n    if (Number.isFinite(left) && scrollLeft !== left) {\n      setScrollLeft(left!);\n    }\n  });\n\n  const [colsWidthByPixel, setColsWidthByPixel] = React.useState<number[]>([]);\n\n  const [pixelColsWidth, setPixelColsWidth] = usePixelColsWidth();\n  const prevPixelColsWidth = React.useRef<number[]>([]);\n  React.useEffect(() => {\n    const newPixelColsWidth = Table.isAutofitWidth(table)\n      ? colsWidthByPixel\n      : table.data.colsWidth;\n    if (!equal(newPixelColsWidth, prevPixelColsWidth.current)) {\n      setPixelColsWidth(newPixelColsWidth || []);\n      prevPixelColsWidth.current = (newPixelColsWidth || []);\n    }\n  }, [colsWidthByPixel, setPixelColsWidth, table]);\n\n  const prevColsWidth = React.useRef<number[] | undefined>([]);\n\n  // table 变化时\n  React.useEffect(() => {\n    if (!Table.isAutofitWidth(table) || !widthRef.current) return;\n\n    let totalWidth = widthRef.current / zoom - 2;\n    if (isMobile) {\n      totalWidth = DEFAULT_TOTAL_WIDTH_FOR_AUTOFIT;\n    }\n\n    const pxlColsWidth = convertFromPercentToPixel(table, totalWidth);\n    setColsWidthByPixel(pxlColsWidth);\n  }, [table, isMobile, zoom]);\n\n  const totalColsWidth = (pixelColsWidth || []).reduce((acc, cw) => (acc + cw), 0);\n  const prevTotalColsWidth = React.useRef(0);\n\n  const resizeObserverCallback = React.useCallback((rect: DOMRect) => {\n    // table 开启 prune display: none 时，宽度是 0\n    if (rect.width === 0) return;\n\n    const actualWith = rect.width;\n\n    if (\n      widthRef.current !== actualWith\n      || prevTotalColsWidth.current !== totalColsWidth\n    ) {\n      setWidth(\n        Number.isFinite(totalColsWidth)\n          ? Math.min(actualWith, totalColsWidth! + 1)\n          : actualWith,\n      );\n      widthRef.current = actualWith;\n      prevTotalColsWidth.current = totalColsWidth;\n      if (Table.isAutofitWidth(table)) {\n        prevColsWidth.current = table.data.colsWidth;\n        let totalWidth = actualWith / zoom - 2;\n        if (isMobile) {\n          totalWidth = DEFAULT_TOTAL_WIDTH_FOR_AUTOFIT;\n        }\n        const pxlColsWidth = convertFromPercentToPixel(table, totalWidth);\n        setColsWidthByPixel(pxlColsWidth);\n      }\n    }\n  }, [isMobile, table, totalColsWidth, zoom]);\n\n  useResizeObserver(ref.current, resizeObserverCallback);\n\n  const prevPosition = React.useRef<{ rowIndex: number; colIndex: number} | null>(null);\n  const handleScrollIntoView = React.useCallback((focusPosition: { colIndex: number; rowIndex: number }) => {\n    // horizontal\n    if (focusPosition?.colIndex !== undefined && pixelColsWidth) {\n      const index = focusPosition.colIndex;\n\n      let targetColRightBorder = pixelColsWidth\n        .slice(0, index + 1)\n        .reduce((sum, colWidth) => sum + colWidth, 0);\n      const targetColLeftBorder = targetColRightBorder - pixelColsWidth[index];\n      targetColRightBorder =\n        index === pixelColsWidth.length - 1\n          ? targetColRightBorder + QUICK_INSERT_BUTTON_WIDTH_HEIGHT\n          : targetColRightBorder;\n\n      window.requestAnimationFrame(() => {\n        if (!ref.current) {\n          return;\n        }\n        const realTableWrapperRect = getBoundingRelativeRect(\n          ref.current,\n          zoomContainer,\n        );\n        const { scrollLeft: sl } = ref.current;\n\n        if (\n          pixelColsWidth[index] <= realTableWrapperRect.width && (\n            sl > targetColLeftBorder ||\n            sl + realTableWrapperRect.width < targetColRightBorder\n          )\n        ) {\n          const finalScrollLeft = targetColRightBorder - realTableWrapperRect.width;\n          ref.current.scrollLeft = finalScrollLeft;\n        }\n      });\n    } else {\n      // vertical\n      // TODO: 向下插入一行后，新增行可能会超出可见区域\n    }\n  }, [pixelColsWidth, zoomContainer]);\n  const shouldUpdateTable = React.useCallback(({ isPendingSelected, range }) => {\n    // 在表格内的光标位置变化\n    if (range.isCollapsed && isPendingSelected) {\n      const focusCell = controller.value.document.getClosest(range.focus.key, TableCell.isTableCell);\n      if (!focusCell) {\n        return;\n      }\n      // 检查所属单元格位置是否发生变化，若变化则按需横向滚动进视区\n      const position = getPositionOfCell(focusCell.key, table);\n      if (\n        position && (\n          prevPosition.current?.colIndex !== position.colIndex ||\n          prevPosition.current?.rowIndex !== position.rowIndex\n        )\n      ) {\n        prevPosition.current = position;\n        handleScrollIntoView(position);\n      }\n    }\n  }, [controller, table, handleScrollIntoView]);\n\n  useSelectionStatus(controller, table, shouldUpdateTable, []);\n\n  return (\n    <Wrapper\n      {...rest}\n      onMouseEnter={onMouseEnter}\n      onMouseMove={onMouseMove}\n      onScroll={handleScroll}\n      ref={ref}\n      hideScrollBar={hideScrollBar}\n      {...SCROLLABLE_ATTRIBUTE}\n    >\n      <TableScrollContainerContext.Provider value={ref.current}>\n        <TableScrollContainerWidthContext.Provider value={width}>\n          <TableScrollContainerScrollLeftContext.Provider value={scrollLeft}>\n            {children}\n          </TableScrollContainerScrollLeftContext.Provider>\n        </TableScrollContainerWidthContext.Provider>\n      </TableScrollContainerContext.Provider>\n      <SelectionSlot layerFor={table.key} />\n    </Wrapper>\n  );\n});\n\nexport default TableScrollContainer;\n"],"file":"tableScrollContainer.js"}