{"version":3,"sources":["../../../src/components/pureTable.tsx"],"names":["React","forwardRef","styled","equal","fastdom","Commands","domUtils","CangjieSelectEvent","Table","TableCell","DEFAULT_TOTAL_WIDTH_FOR_AUTOFIT","DEFAULT_BORDER_COLOR","convertFromPercentToPixel","selectionTrigger","setSelectionByTable","usePixelColsWidth","useRowIsSticky","findDOMNodeSafely","DELTA","RealTable","table","contains","root","node","found","findDescendant","child","key","PureTable","props","fwdRef","children","left","isMobile","controller","forceRenderPercentColWidthForAutoFit","colsWidth","isValidColsWidth","length","isAutofit","isAutofitWidth","timerRef","useRef","isSticky","ref","useEffect","current","style","useMemo","tableWidth","reduce","sum","w","data","width","border","borderTopWidth","renderColsWidth","map","prevRenderColsWidth","value","selection","document","selectionNode","getClosestNode","setScrollType","command","select","merge","r","Math","random","clearTimeout","setTimeout","handleMouseMove","e","clientX","clientY","trigger","get","tableSelection","query","convertToTextPoints","anchor","focus","startTd","getClosest","isTableCell","endTd","hidden","tdDOM","measure","tdRect","getBoundingClientRect","l","right","top","bottom","height","isInCellEdge","run","handleMouseUp","removeEventListener","handleMouseLeave","handleMouseDown","addEventListener","colWidth","i"],"mappings":"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","sourcesContent":["import React, {\n  forwardRef,\n} from 'react';\nimport styled from 'styled-components';\nimport equal from 'fast-deep-equal';\nimport fastdom from 'fastdom';\nimport { Commands, Controller, Element, Node, domUtils, CangjieSelectEvent } from '@ali/4ever-cangjie';\nimport Table from '../mo/models';\nimport TableCell from '../mo/models/tableCell';\nimport { DEFAULT_TOTAL_WIDTH_FOR_AUTOFIT, DEFAULT_BORDER_COLOR } from '../utils/constants';\nimport { convertFromPercentToPixel } from '../utils/utils/colsWidthConverter';\nimport selectionTrigger from '../utils/utils/selectionTrigger';\nimport setSelectionByTable from '../utils/utils/setSelectionByTable';\nimport { usePixelColsWidth, useRowIsSticky } from '../utils/hooks';\n\nconst { findDOMNodeSafely } = domUtils;\n\nconst DELTA = 8;\n\nconst RealTable = styled.table`\n  position: relative;\n  table-layout: fixed;\n  border-collapse: collapse;\n  border: 1px solid ${DEFAULT_BORDER_COLOR};\n`;\n\nexport interface PureTableProps {\n  node: Table;\n  left?: number;\n  children: React.ReactNode;\n  isMobile?: boolean;\n  readonly?: boolean;\n  controller: Controller;\n  forceRenderPercentColWidthForAutoFit?: boolean;\n}\n\nconst contains = (root: Element, node: Node) => {\n  if (node) {\n    const found = root.findDescendant((child) => child.key === node.key);\n    if (found) {\n      return true;\n    }\n  }\n  return false;\n};\n\nconst PureTable = forwardRef<HTMLTableElement, PureTableProps>(\n  (props, fwdRef) => {\n    const {\n      children,\n      left,\n      node,\n      isMobile,\n      controller,\n      forceRenderPercentColWidthForAutoFit,\n    } = props;\n\n    const [colsWidth] = usePixelColsWidth();\n    const isValidColsWidth = colsWidth.length > 0;\n    const isAutofit = Table.isAutofitWidth(node);\n    const timerRef = React.useRef<number>();\n    const [isSticky] = useRowIsSticky();\n    const ref = React.useRef<HTMLTableElement>(null);\n    React.useEffect(() => {\n      if (typeof fwdRef === 'function') {\n        fwdRef(ref.current);\n      } else if (fwdRef) {\n        fwdRef.current = ref.current;\n      }\n    }, [ref, fwdRef]);\n\n    const style = React.useMemo(() => {\n      let tableWidth: React.CSSProperties['width'];\n      if (isAutofit && forceRenderPercentColWidthForAutoFit) {\n        tableWidth = '100%';\n      } else if (isAutofit && isMobile) {\n        tableWidth = DEFAULT_TOTAL_WIDTH_FOR_AUTOFIT;\n      } else if (isValidColsWidth) {\n        tableWidth = (colsWidth as number[])?.reduce((sum, w) => (sum + w), 0);\n      } else if (isAutofit) {\n        tableWidth = '100%';\n      } else {\n        tableWidth = (node.data?.colsWidth || []).reduce((sum, w) => (sum + w), 0);\n      }\n\n      return {\n        width: tableWidth,\n        left: `${left || 0}px`,\n        border: isSticky ? `1px solid ${DEFAULT_BORDER_COLOR}` : 'unset',\n        borderTopWidth: isSticky ? '0' : 'unset',\n      };\n    }, [isAutofit, forceRenderPercentColWidthForAutoFit, isMobile, isValidColsWidth, left, isSticky, colsWidth, node.data?.colsWidth]);\n\n    const renderColsWidth = React.useMemo(() => {\n      if (isAutofit && forceRenderPercentColWidthForAutoFit) {\n        return convertFromPercentToPixel(node, 100).map((w) => `${w}%`);\n      }\n\n      if (isAutofit && isMobile) {\n        return convertFromPercentToPixel(node, DEFAULT_TOTAL_WIDTH_FOR_AUTOFIT);\n      }\n\n      if (isValidColsWidth) {\n        return colsWidth;\n      }\n\n      if (isAutofit) {\n        return convertFromPercentToPixel(node, 100).map((w) => `${w}%`);\n      }\n\n      return node.data?.colsWidth || [];\n    }, [isAutofit, forceRenderPercentColWidthForAutoFit, isMobile, isValidColsWidth, node, colsWidth]);\n\n    const prevRenderColsWidth = React.useRef<string[] | number[] | undefined>([]);\n\n    // @ts-ignore\n    React.useEffect(() => {\n      if (\n        !isAutofit\n        || equal(prevRenderColsWidth.current, renderColsWidth)\n      ) return () => {};\n\n      prevRenderColsWidth.current = renderColsWidth;\n      const { selection, document } = controller.value;\n      const selectionNode = selection.getClosestNode(document);\n      // 不能用 node.contains(xxx)，始终为 false\n      if (selectionNode && contains(node, selectionNode)) {\n        controller.setScrollType('maintain');\n        controller.command(Commands.select, selection.merge({\n          data: {\n            ...selection.data,\n            r: Math.random(),\n          },\n        }));\n        clearTimeout(timerRef.current);\n        timerRef.current = setTimeout(() => {\n          controller.setScrollType('toSelection');\n        });\n        return () => {\n          clearTimeout(timerRef.current);\n          timerRef.current = setTimeout(() => {\n            controller.setScrollType('toSelection');\n          });\n        };\n      }\n    }, [renderColsWidth, controller, node, isAutofit]);\n\n    React.useEffect(() => {\n      return () => {\n        clearTimeout(timerRef.current);\n        controller.setScrollType('toSelection');\n      };\n    });\n\n    const handleMouseMove = (e: MouseEvent) => {\n      if (!ref.current) return;\n\n      const { clientX, clientY } = e;\n      const trigger = selectionTrigger.get();\n      if (trigger === 'selecting') {\n        const tableSelection = controller.query('tableSelection');\n        if (tableSelection) {\n          return;\n        }\n\n        const { selection, document } = controller.value;\n        const { anchor, focus } = selection.convertToTextPoints(document);\n        const startTd = document.getClosest(\n          anchor.key,\n          TableCell.isTableCell,\n        );\n        const endTd = document.getClosest(\n          focus.key,\n          TableCell.isTableCell,\n        );\n        if (\n          !startTd\n          || !endTd\n          || startTd.key !== endTd.key\n          || startTd.data.hidden\n        ) return;\n\n        const tdDOM = findDOMNodeSafely(startTd?.key, ref.current);\n        if (!tdDOM) return;\n\n        fastdom.measure(() => {\n          const tdRect = tdDOM.getBoundingClientRect();\n          const { left: l, right, top, bottom } = tdRect;\n          if (tdRect.height === 0) return;\n          const isInCellEdge = !(\n            clientX > l + DELTA\n            && clientX < right - DELTA\n            && clientY > top + DELTA\n            && clientY < bottom - DELTA\n          );\n          if (isInCellEdge) {\n            controller.run('onCangjieSelect', CangjieSelectEvent({\n              selection: setSelectionByTable(selection, -1),\n              trigger,\n            }));\n          }\n        });\n      }\n    };\n    const handleMouseUp = () => {\n      ref.current?.removeEventListener('mousemove', handleMouseMove);\n    };\n    const handleMouseLeave = () => {\n      ref.current?.removeEventListener('mousemove', handleMouseMove);\n      ref.current?.removeEventListener('mouseup', handleMouseUp);\n      ref.current?.removeEventListener('mouseleave', handleMouseLeave);\n    };\n    const handleMouseDown = () => {\n      ref.current?.addEventListener('mousemove', handleMouseMove);\n      ref.current?.addEventListener('mouseup', handleMouseUp);\n      ref.current?.addEventListener('mouseleave', handleMouseLeave);\n    };\n\n    return (\n      <RealTable\n        ref={ref}\n        style={style}\n        onMouseDown={handleMouseDown}\n      >\n        <colgroup>\n          {(renderColsWidth as Array<React.CSSProperties['width']>)?.map((colWidth, i) => (\n            <col key={i} width={colWidth} />\n          ))}\n        </colgroup>\n        <tbody>\n          {children}\n        </tbody>\n      </RealTable>\n    );\n  },\n);\n\nexport default PureTable;\n"],"file":"pureTable.js"}