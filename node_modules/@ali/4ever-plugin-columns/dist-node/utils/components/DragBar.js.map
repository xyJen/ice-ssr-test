{"version":3,"sources":["../../../../src/utils/components/DragBar.tsx"],"names":["IS_IPAD","environment","Line","styled","div","visible","Wrapper","props","readOnly","COLUMN_SPACE","isEnabled","CURSOR_SIZE","SplitLine","cellKey","isAligned","onDragging","onDraggingChange","index","isDragging","React","useRef","ref","activeIndex","setActiveIndex","handleMouseMove","useCallback","event","stopPropagation","stopImmediatePropagation","preventDefault","current","clientX","handleMouseUp","currentTarget","releasePointerCapture","pointerId","removeEventListener","handleMouseDown","pointerType","setPointerCapture","addEventListener","handleMouseEnter","handleMouseLeave","useEffect","node","undefined","handleClick","ele","closest"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport styled from 'styled-components';\nimport { environment } from '@ali/4ever-cangjie';\nimport { useIpadActiveBarIndex } from '../utils/useIpadActiveIndex';\nimport { useOnClickOutside } from '@ali/4ever-component';\n\nimport { COLUMN_SPACE } from '../constants';\n\nconst { IS_IPAD } = environment;\n\nconst Line = styled.div<{ isAligned: boolean; visible: boolean }>`\n  width: 4px;\n  height: 100%;\n  transition: background-color 250ms;\n  background-color: rgba(0, 137, 255, 0.48);\n  border-radius: 2px;\n\n  opacity: ${({ visible }) => (visible ? 1 : 0)};\n  .draggable-hander & {\n    opacity: 0 !important;\n    pointer-events: none;\n  }\n`;\n\nconst Wrapper = styled.div<{ isEnabled: boolean; readOnly: boolean }>`\n  cursor: ${(props) => (props.readOnly ? 'inherit' : 'col-resize')};\n  margin: 0;\n  padding: 0 ${(COLUMN_SPACE - 4) / 2}px;\n\n  &:hover ${Line} {\n    opacity: ${(props) => (props.isEnabled ? '1' : '0')};\n  }\n  [data-node-selecting] &[data-column-dragkey]{\n    pointer-events: none;\n  }\n`;\n\nconst CURSOR_SIZE = 5;\n\ninterface HoverAreaProps {\n  cellKey: string;\n  isEnabled: boolean;\n  readOnly: boolean;\n  isAligned: boolean;\n  onDraggingChange: (isDragging: boolean) => void;\n  onDragging: (cellKey: string, clientX: number) => void;\n  index: number;\n}\n\nexport default function SplitLine(props: HoverAreaProps) {\n  const {\n    cellKey,\n    isAligned,\n    isEnabled,\n    onDragging,\n    onDraggingChange,\n    readOnly,\n    index,\n  } = props;\n  const isDragging = React.useRef(false);\n  const ref = React.useRef<HTMLDivElement>(null);\n  const [activeIndex, setActiveIndex] = useIpadActiveBarIndex();\n\n  const handleMouseMove = React.useCallback(\n    (event: PointerEvent) => {\n      event.stopPropagation();\n      event.stopImmediatePropagation();\n      event.preventDefault();\n      if (isDragging.current) {\n        onDraggingChange(true);\n        onDragging(cellKey, event.clientX + CURSOR_SIZE);\n      }\n    },\n    [cellKey, onDragging, onDraggingChange],\n  );\n  const handleMouseUp = React.useCallback(\n    (event: PointerEvent) => {\n      event.stopPropagation();\n      event.stopImmediatePropagation();\n      event.preventDefault();\n      (event.currentTarget as HTMLElement).releasePointerCapture(\n        event.pointerId,\n      );\n      isDragging.current = false;\n      onDraggingChange(false);\n      if (!ref.current) {\n        return;\n      }\n      ref.current.removeEventListener('pointerup', handleMouseUp);\n      ref.current.removeEventListener('pointermove', handleMouseMove);\n    },\n    [handleMouseMove, onDraggingChange],\n  );\n  const handleMouseDown = React.useCallback(\n    (event: PointerEvent) => {\n      event.stopPropagation();\n      event.stopImmediatePropagation();\n      event.preventDefault();\n      if (!ref.current) {\n        return;\n      }\n\n      isDragging.current = true;\n\n      if (event.pointerType === 'mouse') {\n        (event.currentTarget as HTMLElement).setPointerCapture(event.pointerId);\n      }\n\n      ref.current.addEventListener('pointerup', handleMouseUp);\n      ref.current.addEventListener('pointermove', handleMouseMove);\n    },\n    [handleMouseMove, handleMouseUp],\n  );\n\n  const handleMouseEnter = React.useCallback(() => {\n    // ipad hover 时，期望 topBar 和 dragBar 同时显示\n    if (IS_IPAD) {\n      setActiveIndex(index);\n    }\n  }, [index, setActiveIndex]);\n\n  const handleMouseLeave = React.useCallback(() => {\n    if (IS_IPAD && activeIndex !== -1) {\n      setActiveIndex(-1);\n    }\n  }, [activeIndex, setActiveIndex]);\n\n  React.useEffect(() => {\n    const node = ref.current;\n    if (!node || !isEnabled) {\n      return undefined;\n    }\n    node.addEventListener('pointerdown', handleMouseDown);\n    return () => {\n      node.removeEventListener('pointerdown', handleMouseDown);\n    };\n  }, [handleMouseDown, handleMouseMove, handleMouseUp, isEnabled, activeIndex]);\n\n  const handleClick = () => {\n    if (IS_IPAD && activeIndex !== index) {\n      setActiveIndex(index);\n    }\n  };\n\n  useOnClickOutside(\n    ref,\n    () => {\n      if (IS_IPAD && activeIndex !== -1) {\n        setActiveIndex(-1);\n      }\n    },\n    false,\n    (ele) => {\n      // 忽略 topbar\n      return !!ele.closest('div[data-column-topbar]');\n    },\n  );\n\n  return (\n    <Wrapper\n      readOnly={readOnly}\n      isEnabled={isEnabled}\n      data-column-dragkey={cellKey}\n      ref={ref}\n      onClick={handleClick}\n      onMouseEnter={handleMouseEnter}\n      onMouseLeave={handleMouseLeave}\n    >\n      <Line\n        isAligned={isAligned}\n        data-column-dragkey={cellKey}\n        visible={activeIndex === index}\n      />\n    </Wrapper>\n  );\n}\n"],"file":"DragBar.js"}