{"version":3,"sources":["../../../../src/utils/components/TopBar.tsx"],"names":["IS_IPAD","environment","Wrapper","styled","div","Space","ItemWrapper","emptySpace","COLUMN_SPACE","Holder","InsertOuterWrapper","isVisible","SvgIcon","svg","IconWrapper","span","Dot","VertBar","height","ICON_SIZE","ICON_COLOR","DotIcon","InsertBar","insertTitle","targetKey","offset","index","ref","React","useRef","controller","Controller","useController","setIsVisible","useState","setHeight","zoom","activeIndex","setActiveIndex","ipadBarVisible","useEffect","barHeight","current","closest","getBoundingClientRect","handleMouseEnter","useCallback","handleMouseLeave","handleClick","run","fontSize","Item","configs","TopBar","items","totalWidth","reduce","a","i","width","fixedSize","length","map","key","locale","insertCol"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport styled from 'styled-components';\nimport { useZoom, Controller, environment } from '@ali/4ever-cangjie';\nimport { ToolbarTablePlusNormal, Tooltip } from '@ali/we-design';\n\nimport { COLUMN_SPACE } from '../constants';\nimport { insertCol } from '../actions';\nimport { CellItem } from '../utils/ColumnsProvider';\nimport { ColumnsConfigs } from '../types';\nimport { useIpadActiveBarIndex } from '../utils/useIpadActiveIndex';\n\nconst { IS_IPAD } = environment;\n\nconst Wrapper = styled.div`\n  position: absolute;\n  top: 0;\n  height: 0;\n  width: 100%;\n  left: 0;\n  display: flex;\n  flex-direction: row;\n  justify-content: stretch;\n  [data-node-selecting] &[data-column-topbar] {\n    display: none;\n  }\n`;\n\nconst Space = styled.div``;\n\nconst ItemWrapper = styled.div<{ emptySpace: boolean }>`\n  width: ${({ emptySpace }) => (emptySpace ? 0 : COLUMN_SPACE)}px;\n  height: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n`;\n\nconst Holder = styled.div`\n  width: 0;\n  height: 0;\n  position: relative;\n  z-index: 99;\n`;\n\nconst InsertOuterWrapper = styled.div<{ isVisible: boolean }>`\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n  font-size: 20px;\n  line-height: 20px;\n  border-radius: 50%;\n  box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.24);\n  box-sizing: border-box;\n  position: relative;\n  transform: ${({ isVisible }) => `scale(${isVisible ? 1 : 0.8})`};\n  opacity: ${({ isVisible }) => (isVisible ? 1 : 0)};\n  transition: transform 250ms, opacity 250ms;\n  color: white;\n  background-color: rgb(45, 132, 250);\n`;\n\nconst SvgIcon = styled.svg`\n  position: absolute;\n  left: 10px;\n  top: 18px;\n`;\n\nconst IconWrapper = styled.span`\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n`;\n\nconst Dot = styled.div`\n  position: absolute;\n  left: -12px;\n  top: -24px;\n  width: 24px;\n  height: 24px;\n`;\n\nconst VertBar = styled.div<{ height: number; isVisible: boolean }>`\n  width: 2px;\n  height: ${({ height }) => `${height}px`};\n  opacity: ${({ isVisible }) => (isVisible ? 1 : 0)};\n  background: #3296fa;\n  position: absolute;\n  transition: opacity 250ms;\n  left: 11px;\n  top: 24px;\n  pointer-events: none;\n`;\n\ninterface ItemProps {\n  // eslint-disable-next-line react/no-unused-prop-types\n  emptySpace: boolean;\n  insertTitle?: string;\n  targetKey: string;\n  offset: 0 | 1;\n  index: number;\n}\n\ninterface IProps {\n  items: CellItem[];\n  configs?: ColumnsConfigs;\n}\n\nconst ICON_SIZE = 3;\nconst ICON_COLOR = 'rgba(23, 26, 29, 0.24)';\nconst DotIcon = () => {\n  return (\n    <SvgIcon\n      width={ICON_SIZE}\n      height={ICON_SIZE}\n      viewBox={`0 0 ${ICON_SIZE} ${ICON_SIZE}`}\n      fill=\"none\"\n    >\n      <circle\n        cx={ICON_SIZE / 2}\n        cy={ICON_SIZE / 2}\n        r={ICON_SIZE / 2}\n        fill={ICON_COLOR}\n      />\n    </SvgIcon>\n  );\n};\n\nfunction InsertBar({ insertTitle, targetKey, offset, index }: ItemProps) {\n  const ref = React.useRef<HTMLDivElement>(null);\n  const controller = Controller.useController();\n  const [isVisible, setIsVisible] = React.useState(false);\n  const [height, setHeight] = React.useState(0);\n  const zoom = useZoom();\n  const [activeIndex, setActiveIndex] = useIpadActiveBarIndex();\n  const ipadBarVisible = activeIndex === index;\n\n  React.useEffect(() => {\n    if (!isVisible && !ipadBarVisible) {\n      return;\n    }\n    const { height: barHeight } =\n      ref.current?.closest('[data-columns]')?.getBoundingClientRect() || {};\n    setHeight((barHeight || 0) / zoom);\n  }, [isVisible, zoom, ipadBarVisible]);\n\n  const handleMouseEnter = React.useCallback(() => {\n    setIsVisible(true);\n\n    // ipad 使用键盘的触控板 hover 时会走这里\n    if (IS_IPAD) {\n      setActiveIndex(index);\n    }\n  }, [index, setActiveIndex]);\n\n  const handleMouseLeave = React.useCallback(() => {\n    setIsVisible(false);\n    if (IS_IPAD && activeIndex !== -1) {\n      setActiveIndex(-1);\n    }\n  }, [activeIndex, setActiveIndex]);\n\n  const handleClick = React.useCallback(() => {\n    if (IS_IPAD) {\n      if (ipadBarVisible) {\n        setActiveIndex(-1);\n      } else {\n        setActiveIndex(index);\n        return;\n      }\n    }\n    controller.run('onAction', insertCol({ targetKey, offset }));\n  }, [controller, targetKey, offset, ipadBarVisible, index, setActiveIndex]);\n\n  return (\n    <>\n      <InsertOuterWrapper\n        ref={ref}\n        onMouseDown={handleClick}\n        isVisible={isVisible || ipadBarVisible}\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n      >\n        <Tooltip\n          placement={'top'}\n          title={insertTitle || 'Insert'}\n          disabled={IS_IPAD}\n        >\n          <IconWrapper>\n            <ToolbarTablePlusNormal style={{ fontSize: 20 }} />\n          </IconWrapper>\n        </Tooltip>\n      </InsertOuterWrapper>\n      <VertBar height={height} isVisible={isVisible || ipadBarVisible} />\n    </>\n  );\n}\n\nfunction Item(configs: ItemProps) {\n  return (\n    <ItemWrapper emptySpace={configs.emptySpace}>\n      <Holder>\n        <Dot>\n          <DotIcon />\n          <InsertBar {...configs} />\n        </Dot>\n      </Holder>\n    </ItemWrapper>\n  );\n}\n\nexport default function TopBar({ items, configs }: IProps) {\n  const totalWidth = items.reduce((a, i) => a + i.width, 0);\n  const fixedSize = (items.length - 1) * COLUMN_SPACE;\n  return (\n    <Wrapper data-column-topbar>\n      {items.map(({ key, width }, index) => {\n        return (\n          <React.Fragment key={`${key}_${index}_${items.length}`}>\n            {index === 0 && (\n              <Item\n                emptySpace\n                insertTitle={configs?.locale?.insertCol}\n                targetKey={key}\n                offset={0}\n                index={0}\n              />\n            )}\n            <Space\n              style={{\n                width: `calc((100% - ${fixedSize}px) * ${width / totalWidth})`,\n              }}\n            />\n            <Item\n              emptySpace={index === items.length - 1}\n              insertTitle={configs?.locale?.insertCol}\n              targetKey={key}\n              offset={1}\n              index={index + 1}\n            />\n          </React.Fragment>\n        );\n      })}\n    </Wrapper>\n  );\n}\n"],"file":"TopBar.js"}