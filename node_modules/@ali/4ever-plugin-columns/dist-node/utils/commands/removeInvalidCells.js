"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = removeInvalidCells;

var _everCangjie = require("@ali/4ever-cangjie");

var _everPluginTable = require("@ali/4ever-plugin-table");

function removeInvalidCells(controller) {
  const {
    document
  } = controller.value;
  const aloneTable = document.nodes.find( // try to find invalid cells (row.nodes.some)
  n => _everPluginTable.Table.isTable(n) && n.data.sr && n.nodes[0]?.nodes?.some(c => !_everPluginTable.TableCell.isTableCell(c)));

  if (!aloneTable) {
    return controller;
  }

  const row = aloneTable.nodes[0];
  const keys = row.nodes.reduce((arr, node) => {
    if (!_everPluginTable.TableCell.isTableCell(node)) {
      arr.push(node.key);
    }

    return arr;
  }, []);
  controller.withoutNormalizing(() => {
    keys.forEach(k => {
      controller.command(_everCangjie.Commands.removeNodeByKey, k);
    });
  });
  return removeInvalidCells(controller);
}
//# sourceMappingURL=removeInvalidCells.js.map