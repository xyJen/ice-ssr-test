{"version":3,"sources":["../../../../src/utils/hooks/beforeCopySelectedNodes.ts"],"names":["Table","TableRow","DEFAULT_WIDTH","createColumns","cells","tableRow","create","nodes","size","length","colsWidth","Array","fill","Math","round","table","data","sr","beforeCopySelectedNodes","selectedNodes","controller","next","newNodes","document","value","prevColumnsRow","columnsRowNodes","i","query","getParent","key","curColumnsRow","push","columns"],"mappings":"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","sourcesContent":["import { Plugin, Node } from '@ali/4ever-cangjie';\nimport { Table, TableCell, TableRow } from '@ali/4ever-plugin-table';\n\nconst DEFAULT_WIDTH = 650;\n\nfunction createColumns(cells: TableCell[]) {\n  const tableRow = TableRow.create({ nodes: cells });\n  const { length: size } = cells;\n  const colsWidth = new Array(size).fill(Math.round(DEFAULT_WIDTH / size));\n  const table = Table.create({\n    nodes: [tableRow],\n    data: { sr: true, colsWidth },\n  });\n  return table;\n}\n\nconst beforeCopySelectedNodes: Plugin['beforeCopySelectedNodes'] = (selectedNodes, controller, next) => {\n  const newNodes: Node[] = [];\n  const { length } = selectedNodes;\n  const { document } = controller.value;\n  let prevColumnsRow: null | TableRow = null;\n  let columnsRowNodes: TableCell[] | null = null;\n  for (let i = 0; i < length; i++) {\n    if (controller.query('isColumnsChild', selectedNodes[i])) {\n      if (!columnsRowNodes) {\n        prevColumnsRow = (document.getParent(selectedNodes[i].key) as TableRow | null);\n        columnsRowNodes = [(selectedNodes[i] as TableCell)];\n      } else {\n        const curColumnsRow = (document.getParent(selectedNodes[i].key) as TableRow | null);\n        if (curColumnsRow?.key === prevColumnsRow?.key) {\n          columnsRowNodes.push((selectedNodes[i] as TableCell));\n        } else {\n          const columns = createColumns(columnsRowNodes);\n          newNodes.push(columns);\n          prevColumnsRow = (document.getParent(selectedNodes[i].key) as TableRow | null);\n          columnsRowNodes = [(selectedNodes[i] as TableCell)];\n        }\n      }\n    } else {\n      if (columnsRowNodes) {\n        const columns = createColumns(columnsRowNodes);\n        newNodes.push(columns);\n        prevColumnsRow = null;\n        columnsRowNodes = null;\n      }\n      newNodes.push(selectedNodes[i]);\n    }\n  }\n  if (columnsRowNodes) {\n    const columns = createColumns(columnsRowNodes);\n    newNodes.push(columns);\n    prevColumnsRow = null;\n    columnsRowNodes = null;\n  }\n  return newNodes;\n};\n\nexport default beforeCopySelectedNodes;\n\n"],"file":"beforeCopySelectedNodes.js"}