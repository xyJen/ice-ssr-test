{"version":3,"sources":["../../../../src/utils/hooks/onKeyDown.ts"],"names":["hotkeys","Table","TableCell","Heading","deleteColumn","isEmptyParagraph","tryRemoveColumn","controller","closestBlock","value","selection","document","key","focus","maybeTableCell","getParent","table","getClosest","isTable","data","sr","isTableCell","nodes","length","run","createOnKeyDown","onKeyDown","event","next","isExpanded","isDeleteBackward","focusKey","getClosestBlock","procceed","isHeading","text"],"mappings":"AACA,SAAqBA,OAArB,QAA2C,oBAA3C;AACA,SAASC,KAAT,EAAgBC,SAAhB,QAAiC,yBAAjC;AACA,SAASC,OAAT,QAAwB,2BAAxB;AACA,SAASC,YAAT;AACA,SAASC,gBAAT,QAAiC,kBAAjC;;AAEA,SAASC,eAAT,CAAyBC,UAAzB,EAAiDC,YAAjD,EAAsE;AAAA,0BACpCD,UAAU,CAACE,KADyB;AAAA,MAC5DC,SAD4D,qBAC5DA,SAD4D;AAAA,MACjDC,QADiD,qBACjDA,QADiD;AAAA,MAE5DC,GAF4D,GAEpDF,SAAS,CAACG,KAF0C,CAE5DD,GAF4D;AAGpE,MAAME,cAAc,GAAGH,QAAQ,CAACI,SAAT,CAAmBP,YAAY,CAACI,GAAhC,CAAvB;AACA,MAAMI,KAAK,GAAGL,QAAQ,CAACM,UAAT,CAAoBL,GAApB,EAAyBX,KAAK,CAACiB,OAA/B,CAAd;;AACA,OACE;AACAF,EAAAA,KAAK,IACLA,KAAK,CAACG,IAAN,CAAWC,EADX,IAEA;AACAlB,EAAAA,SAAS,CAACmB,WAAV,CAAsBP,cAAtB,CAHA,IAIAA,cAAc,CAACQ,KAAf,CAAqBC,MAArB,KAAgC,CANlC,EAOE;AACAhB,IAAAA,UAAU,CAACiB,GAAX,CAAe,UAAf,EAA2BpB,YAAY,CAAC;AAAEQ,MAAAA,GAAG,EAAEE,cAAc,CAACF;AAAtB,KAAD,CAAvC;AACA,WAAO,IAAP;AACD;;AACD,SAAO,KAAP;AACD;;AAED,eAAe,SAASa,eAAT,GAA2B;AACxC,SAAO,SAASC,SAAT,CACLC,KADK,EAELpB,UAFK,EAGLqB,IAHK,EAIL;AAAA,6BACgCrB,UAAU,CAACE,KAD3C;AAAA,QACQC,SADR,sBACQA,SADR;AAAA,QACmBC,QADnB,sBACmBA,QADnB;;AAEA,QAAID,SAAS,CAACmB,UAAV,IAAwB,CAAC7B,OAAO,CAAC8B,gBAAR,CAAyBH,KAAzB,CAA7B,EAA8D;AAC5D,aAAOC,IAAI,EAAX;AACD;;AAJD,QAMaG,QANb,GAM0BrB,SAAS,CAACG,KANpC,CAMQD,GANR;AAOA,QAAMJ,YAAY,GAAGG,QAAQ,CAACqB,eAAT,CAAyBD,QAAzB,CAArB;;AACA,QAAI,CAACvB,YAAL,EAAmB;AACjB,aAAOoB,IAAI,EAAX;AACD;;AAED,QAAIK,QAAQ,GAAG,KAAf,CAZA,CAaA;;AACA,QAAI5B,gBAAgB,CAACG,YAAD,CAApB,EAAoC;AAClCyB,MAAAA,QAAQ,GAAG3B,eAAe,CAACC,UAAD,EAAaC,YAAb,CAA1B;AACD,KAFD,MAEO,IAAIL,OAAO,CAAC+B,SAAR,CAAkB1B,YAAlB,KAAmC,CAACA,YAAY,CAAC2B,IAArD,EAA2D;AAChEF,MAAAA,QAAQ,GAAG3B,eAAe,CAACC,UAAD,EAAaC,YAAb,CAA1B;AACD;;AACD,QAAIyB,QAAJ,EAAc;AACZ,aAAO1B,UAAP;AACD;;AAED,WAAOqB,IAAI,EAAX;AACD,GA5BD;AA6BD","sourcesContent":["import * as React from 'react';\nimport { Controller, hotkeys, Block } from '@ali/4ever-cangjie';\nimport { Table, TableCell } from '@ali/4ever-plugin-table';\nimport { Heading } from '@ali/4ever-plugin-heading';\nimport { deleteColumn } from '../actions';\nimport { isEmptyParagraph } from '@ali/4ever-utils';\n\nfunction tryRemoveColumn(controller: Controller, closestBlock: Block) {\n  const { selection, document } = controller.value;\n  const { key } = selection.focus;\n  const maybeTableCell = document.getParent(closestBlock.key);\n  const table = document.getClosest(key, Table.isTable) as Table | undefined;\n  if (\n    // inside a column\n    table &&\n    table.data.sr &&\n    // only block\n    TableCell.isTableCell(maybeTableCell) &&\n    maybeTableCell.nodes.length === 1\n  ) {\n    controller.run('onAction', deleteColumn({ key: maybeTableCell.key }));\n    return true;\n  }\n  return false;\n}\n\nexport default function createOnKeyDown() {\n  return function onKeyDown(\n    event: React.KeyboardEvent,\n    controller: Controller,\n    next,\n  ) {\n    const { selection, document } = controller.value;\n    if (selection.isExpanded || !hotkeys.isDeleteBackward(event)) {\n      return next();\n    }\n\n    const { key: focusKey } = selection.focus;\n    const closestBlock = document.getClosestBlock(focusKey);\n    if (!closestBlock) {\n      return next();\n    }\n\n    let procceed = false;\n    // 如果在分栏里没有内容，再按下了删除：就删除掉整个分栏\n    if (isEmptyParagraph(closestBlock)) {\n      procceed = tryRemoveColumn(controller, closestBlock);\n    } else if (Heading.isHeading(closestBlock) && !closestBlock.text) {\n      procceed = tryRemoveColumn(controller, closestBlock);\n    }\n    if (procceed) {\n      return controller;\n    }\n\n    return next();\n  };\n}\n"],"file":"onKeyDown.js"}