{"version":3,"sources":["../../../../src/utils/commands/deleteColumn.ts"],"names":["Commands","isColumnsTable","clearAloneTables","isBadTable","deleteColumn","controller","key","document","value","targetColumn","getNode","command","removeNodeByKey","targetRow","getParent","targetTable","removedIndex","nodes","findIndex","node","colsWidth","data","willBeAssignedWidth","splice","deltaWidth","length","newColsWidth","map","width","setNodeByKey","newDocument","newTargetTable","withoutNormalizing","tablePath","getPath","removeNodeByPath"],"mappings":";AAAA,SAAqBA,QAArB,QAAqC,oBAArC;AACA,SAASC,cAAT;AAEA,OAAOC,gBAAP,IAA2BC,UAA3B;AAEA,eAAe,SAASC,YAAT,CACbC,UADa,QAGb;AAAA,MADEC,GACF,QADEA,GACF;AAAA,MACQC,QADR,GACqBF,UAAU,CAACG,KADhC,CACQD,QADR;AAEA,MAAME,YAAY,GAAGF,QAAQ,CAACG,OAAT,CAAiBJ,GAAjB,CAArB;;AACA,MAAIG,YAAJ,EAAkB;AAChBJ,IAAAA,UAAU,CAACM,OAAX,CAAmBX,QAAQ,CAACY,eAA5B,EAA6CN,GAA7C;AAEA,QAAMO,SAAS,GAAGN,QAAQ,CAACO,SAAT,CAAmBR,GAAnB,CAAlB;AACA,QAAMS,WAAW,GAAGR,QAAQ,CAACO,SAAT,CAAmB,CAAAD,SAAS,QAAT,YAAAA,SAAS,CAAEP,GAAX,KAAkB,EAArC,CAApB,CAJgB,CAMhB;;AACA,QAAIO,SAAS,IAAIE,WAAjB,EAA8B;AAC5B,UAAMC,YAAY,GAAGH,SAAS,CAACI,KAAV,CAAgBC,SAAhB,CAA0B,UAACC,IAAD;AAAA,eAAUA,IAAI,CAACb,GAAL,KAAaA,GAAvB;AAAA,OAA1B,CAArB;AACA,UAAMc,SAAS,aAAOL,WAAP,oBAAOA,WAAW,CAAEM,IAAb,CAAkBD,SAAzB,CAAf;AACA,UAAME,mBAAmB,GAAGF,SAAS,CAACG,MAAV,CAAiBP,YAAjB,EAA+B,CAA/B,EAAkC,CAAlC,CAA5B;AACA,UAAMQ,UAAU,GAAGF,mBAAmB,GAAGF,SAAS,CAACK,MAAnD;AACA,UAAMC,YAAY,GAAGN,SAAS,CAACO,GAAV,CAAc,UAACC,KAAD;AAAA,eAAWA,KAAK,GAAGJ,UAAnB;AAAA,OAAd,CAArB;AAEAnB,MAAAA,UAAU,CAACM,OAAX,CAAmBX,QAAQ,CAAC6B,YAA5B,EAA0Cd,WAA1C,oBAA0CA,WAAW,CAAET,GAAvD,EAA4D;AAC1De,QAAAA,IAAI,eACCN,WADD,oBACCA,WAAW,CAAEM,IADd;AAEFD,UAAAA,SAAS,EAAEM;AAFT;AADsD,OAA5D;AAMD,KApBe,CAsBhB;;;AAtBgB,QAuBEI,WAvBF,GAuBkBzB,UAAU,CAACG,KAvB7B,CAuBRD,QAvBQ;AAwBhB,QAAMwB,cAAc,GAAGD,WAAW,CAAChB,SAAZ,CAAsB,CAAAD,SAAS,QAAT,YAAAA,SAAS,CAAEP,GAAX,KAAkB,EAAxC,CAAvB;;AACA,QAAIL,cAAc,CAAC8B,cAAD,CAAd,IAAkC5B,UAAU,CAAC4B,cAAD,CAAhD,EAAkE;AAChE1B,MAAAA,UAAU,CAAC2B,kBAAX,CAA8B,YAAM;AAClC,YAAMC,SAAS,GAAG1B,QAAQ,CAAC2B,OAAT,CAAiBH,cAAc,CAACzB,GAAhC,CAAlB;AACAD,QAAAA,UAAU,CAACM,OAAX,CAAmBX,QAAQ,CAACmC,gBAA5B,EAA8CF,SAA9C;AACD,OAHD;AAID;AACF;;AAED,SAAO/B,gBAAgB,CAACG,UAAD,CAAvB;AACD","sourcesContent":["import { Controller, Commands } from '@ali/4ever-cangjie';\nimport { isColumnsTable } from '../utils/isColumns';\nimport { DeleteColumnsParams } from '../types';\nimport clearAloneTables, { isBadTable } from './clearAloneTables';\n\nexport default function deleteColumn(\n  controller: Controller,\n  { key }: DeleteColumnsParams,\n) {\n  const { document } = controller.value;\n  const targetColumn = document.getNode(key);\n  if (targetColumn) {\n    controller.command(Commands.removeNodeByKey, key);\n\n    const targetRow = document.getParent(key);\n    const targetTable = document.getParent(targetRow?.key || '');\n\n    // 删除栏后修正 colsWidth\n    if (targetRow && targetTable) {\n      const removedIndex = targetRow.nodes.findIndex((node) => node.key === key);\n      const colsWidth = [...targetTable?.data.colsWidth];\n      const willBeAssignedWidth = colsWidth.splice(removedIndex, 1)[0];\n      const deltaWidth = willBeAssignedWidth / colsWidth.length;\n      const newColsWidth = colsWidth.map((width) => width + deltaWidth);\n\n      controller.command(Commands.setNodeByKey, targetTable?.key, {\n        data: {\n          ...targetTable?.data,\n          colsWidth: newColsWidth,\n        },\n      });\n    }\n\n    // 当不存在栏时，删除整个分栏\n    const { document: newDocument } = controller.value;\n    const newTargetTable = newDocument.getParent(targetRow?.key || '');\n    if (isColumnsTable(newTargetTable) && isBadTable(newTargetTable)) {\n      controller.withoutNormalizing(() => {\n        const tablePath = document.getPath(newTargetTable.key)!;\n        controller.command(Commands.removeNodeByPath, tablePath);\n      });\n    }\n  }\n\n  return clearAloneTables(controller);\n}\n"],"file":"deleteColumn.js"}