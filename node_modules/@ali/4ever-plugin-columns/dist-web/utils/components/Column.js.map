{"version":3,"sources":["../../../../src/utils/components/Column.tsx"],"names":["React","throttle","styled","css","theme","environment","Block","useSelectingHots","hoverCSS","useHover","useCellConfigs","COLUMN_SPACE","HORIZ_PADDING","blockMarginStyleInContainer","DragBar","deleteColumn","isColumnsCell","isColumnsTable","IS_MOBILE","IS_IPAD","IS_PC_OR_IPAD","Wrapper","div","commonBgHoverColor","p","isHover","borderBoxHoverCSS","props","isLastOne","Content","PercentTab","PercentText","isAligned","SelectedColumnLayer","isSelectWholeTable","vAlignToFlex","vAlign","isHidePadding","colors","every","c","Column","cell","controller","ColorButton","children","configs","useReducer","forceUpdate","document","value","table","getClosest","key","query","node","cellItem","ref","useRef","useEffect","nodes","length","n","isBlock","run","useState","showInnerToolbar","setShowInnerToolbar","updateInnerToolbar","useCallback","event","target","HTMLElement","panel","closest","showIt","current","trailing","handleHideInnerToolbar","cancel","enableBorderHighlight","useMemo","onMouseLeave","hoverHandlers","handleMouseMove","persist","window","addEventListener","removeEventListener","onSelectingHots","hots","hot","find","hotNodeKey","maybeCell","index","percent","percentAligned","isDragging","count","handleDragging","handleDraggingChange","widthStr","data","fill","border","pLeft","pRight","background","style","width","contentStyle","justifyContent","paddingLeft","paddingRight","percentText","Math","round","disableInnerButton","ExtraAboveComponent","getExtraAboveComponent","extraAboveComponentStyle","Fragment","readOnly","uuid","isFocused"],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-shadow */\nimport * as React from 'react';\nimport { throttle } from 'lodash-es';\nimport styled, { css } from 'styled-components';\nimport { theme } from '@ali/we-design';\nimport { environment, Controller, Block, Hot, useSelectingHots } from '@ali/4ever-cangjie';\nimport { Table, TableCell } from '@ali/4ever-plugin-table';\nimport { hoverCSS, useHover } from '@ali/4ever-component';\nimport { useCellConfigs } from '../utils/ColumnsProvider';\nimport { COLUMN_SPACE, HORIZ_PADDING } from '../constants';\nimport { blockMarginStyleInContainer } from '@ali/4ever-utils';\nimport DragBar from './DragBar';\nimport { ColumnsConfigs } from '../types';\nimport { deleteColumn } from '../actions';\nimport { isColumnsCell, isColumnsTable } from '../utils/isColumns';\n\nconst { IS_MOBILE, IS_IPAD } = environment;\nconst IS_PC_OR_IPAD = !IS_MOBILE || IS_IPAD;\n\nconst Wrapper = styled.div<{ isHover: boolean; isLastOne: boolean }>`\n  flex-grow: 0;\n  flex-shrink: 0;\n  box-sizing: border-box;\n  position: relative;\n  display: block;\n  border-radius: 8px;\n  transition: background 300ms, border 300ms, padding 300ms;\n  margin-bottom: 0;\n  &.draggable-highlight {\n    background-color: ${theme.commonBgHoverColor} !important;\n  }\n  ${(p) => (p.isHover ? hoverCSS.borderBoxHoverCSS : '')}\n  ${(props) =>\n    (IS_PC_OR_IPAD\n      ? ''\n      : `\n      @media (max-width: 500px) {\n        width: initial !important;\n        margin-bottom: ${props.isLastOne ? '0' : '8px'};\n      }\n    `)}\n`;\n\nconst Content = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: stretch;\n  height: 100%;\n  padding-top: 7px;\n  padding-bottom: 7px;\n  & > [data-cangjie-leaf-block] {\n    max-width: 100%;\n  }\n\n  ${css`${blockMarginStyleInContainer}`}\n\n  /* placeholder 溢出问题 */\n  span[data-cangjie-placeholder]:not(td span[data-cangjie-placeholder]) {\n    position: absolute !important;\n    display: inline-block;\n    width: calc(100% - 14px);\n    height: calc(100% - 14px);\n\n    & > span {\n      width: 100% !important;\n      overflow: hidden;\n      text-overflow: ellipsis !important;\n    }\n  }\n\n`;\n\nconst PercentTab = styled.div`\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 137, 255, 0.08);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n`;\n\nconst PercentText = styled.div<{ isAligned: boolean }>`\n  color: ${({ isAligned }) =>\n    (isAligned ? 'rgba(0, 137, 255, 0.48)' : '#A9AEB3')};\n  font-size: 14px;\n  font-weight: bold;\n  transition: background-color 250ms;\n  background-color: ${({ isAligned }) =>\n    (isAligned ? 'rgba(231, 244, 255, 0.8)' : 'rgb(245, 246, 247, 0.8)')};\n  padding: 0 10px;\n  border-radius: 4px;\n`;\n\nconst SelectedColumnLayer = styled.div<{isSelectWholeTable: boolean}>`\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 106, 254, 0.12);\n  pointer-events: none;\n  border-radius: 8px;\n  display: ${({ isSelectWholeTable }) => (isSelectWholeTable ? 'block' : 'none')};\n`;\n\ninterface IProps {\n  cell: TableCell;\n  configs?: ColumnsConfigs;\n  controller: Controller;\n  ColorButton?: React.ComponentType<any>;\n}\n\nconst vAlignToFlex = (vAlign?: string) => {\n  if (vAlign === 'top') {\n    return 'flex-start';\n  }\n  if (vAlign === 'bottom') {\n    return 'flex-end';\n  }\n  return 'center';\n};\n\nfunction isHidePadding(colors: Array<string | undefined>) {\n  return colors.every((c) => !c || c === 'transparent');\n}\n\nexport default function Column({\n  cell,\n  controller,\n  ColorButton,\n  children,\n  configs,\n}: React.PropsWithChildren<IProps>) {\n  const [, forceUpdate] = React.useReducer((c) => !c, false);\n\n  const { document } = controller.value;\n  const table = document.getClosest(cell.key, isColumnsTable) as Table;\n  const isSelectWholeTable = controller.query('isSelectWholeTable', { node: table });\n  const cellItem = useCellConfigs(cell.key);\n  const ref = React.useRef<HTMLDivElement>(null);\n\n  React.useEffect(() => {\n    const nodes = cell.nodes || [];\n    if (!nodes.length || nodes.every((n) => !Block.isBlock(n))) {\n      controller.run('onAction', deleteColumn({ key: cell.key }));\n    }\n  }, [cell, controller]);\n\n  const [showInnerToolbar, setShowInnerToolbar] = React.useState(false);\n\n  const updateInnerToolbar = React.useCallback(\n    throttle((event: React.MouseEvent) => {\n      const { target } = event;\n      if (!(target instanceof HTMLElement)) {\n        return;\n      }\n      const panel = target.closest('[data-color-select-panel]');\n      const showIt = !panel || panel === ref.current;\n      if (showInnerToolbar !== showIt) {\n        setShowInnerToolbar(showIt);\n      }\n    }, 100, { trailing: true }),\n    [showInnerToolbar],\n  );\n\n  const handleHideInnerToolbar = React.useCallback(() => {\n    updateInnerToolbar.cancel();\n    setShowInnerToolbar(false);\n  }, [updateInnerToolbar]);\n\n  const enableBorderHighlight = React.useMemo(() => controller.query('enableBorderHighlight'), []);\n  const [isHover, hoverHandlers] = useHover(enableBorderHighlight, {\n    onMouseLeave: handleHideInnerToolbar,\n  });\n\n  const handleMouseMove = React.useCallback((event: React.MouseEvent) => {\n    if (!IS_PC_OR_IPAD) {\n      return;\n    }\n    event.persist();\n    // TODO\n    updateInnerToolbar(event);\n  }, [updateInnerToolbar]);\n\n  // TODO: 暴露全局的 keydown，不要每个组件自己注册一遍\n  React.useEffect(() => {\n    window.document.addEventListener('keydown', handleHideInnerToolbar);\n    return () => {\n      window.document.removeEventListener('keydown', handleHideInnerToolbar);\n    };\n  }, [controller, handleHideInnerToolbar]);\n\n  // fix: 选中整栏, 其他栏没有重渲\n  const onSelectingHots = React.useCallback((hots: Hot[]) => {\n    const isSelectWholeTable = controller.query('isSelectWholeTable', { node: table });\n    if (!isSelectWholeTable) {\n      return;\n    }\n    const hot = hots.find((hot) => {\n      const hotNodeKey = hot.node.key;\n      if (isColumnsCell(document, hotNodeKey) && hotNodeKey === cell.key) {\n        return hot;\n      } else {\n        const maybeCell = document.getClosest(hotNodeKey, ({ key }) => isColumnsCell(document, key));\n        if (maybeCell && maybeCell.key === cell.key) {\n          return hot;\n        }\n      }\n      return false;\n    });\n    if (hot) {\n      forceUpdate();\n    }\n  }, [controller, cell, table, document]);\n  useSelectingHots(controller, onSelectingHots);\n\n  if (!cellItem) {\n    return <React.Fragment>{children}</React.Fragment>;\n  }\n\n  const {\n    index,\n    percent,\n    percentAligned,\n    isDragging,\n    count,\n    handleDragging,\n    handleDraggingChange,\n  } = cellItem;\n\n  const widthStr = `calc((100% - ${\n    COLUMN_SPACE * (count - 1)\n  }px) * ${percent})`;\n\n  const { fill, vAlign, border } = cell.data;\n  const pLeft = isHidePadding([fill, border]) ? 0 : HORIZ_PADDING;\n  const pRight = isHidePadding([fill, border]) ? 0 : HORIZ_PADDING;\n  const background = fill || 'transparent';\n  const style: React.CSSProperties = {\n    width: widthStr,\n    background,\n    border: `1px solid ${border || background}`,\n  };\n\n  const contentStyle: React.CSSProperties = {\n    justifyContent: vAlignToFlex(vAlign),\n    paddingLeft: `${pLeft}px`,\n    paddingRight: `${pRight}px`,\n  };\n  const percentText = `${Math.round(percent * 100)}%`;\n  const disableInnerButton = controller.query('hasHoverToolbar', 'columns');\n\n  let ExtraAboveComponent = configs?.getExtraAboveComponent?.(cell, controller);\n  let extraAboveComponentStyle;\n  if (ExtraAboveComponent) {\n    extraAboveComponentStyle = {\n      width: widthStr,\n    };\n    style.width = '100%';\n  }\n\n  ExtraAboveComponent = ExtraAboveComponent || React.Fragment;\n\n\n  return (\n    <React.Fragment>\n      {index !== 0 && (\n        <DragBar\n          cellKey={cell.key}\n          isAligned={isDragging}\n          readOnly={controller.readOnly}\n          isEnabled={IS_PC_OR_IPAD && !controller.readOnly}\n          onDragging={handleDragging}\n          onDraggingChange={handleDraggingChange}\n          index={index}\n        />\n      )}\n      <ExtraAboveComponent\n        controller={controller}\n        node={cell}\n        style={extraAboveComponentStyle}\n        isLastOne={index === count - 1}\n      >\n        <Wrapper\n          style={style}\n          ref={ref}\n          data-column\n          isLastOne={index === count - 1}\n          data-container-block\n          data-color-select-panel\n          {...hoverHandlers}\n          onMouseMove={handleMouseMove}\n          data-block-uuid={cell.data?.uuid}\n          data-cangjie-key={cell.key}\n          data-hover-box=\"borderBox\"\n          isHover={isHover && controller.value.isFocused}\n        >\n          <SelectedColumnLayer isSelectWholeTable={isSelectWholeTable!} />\n          <Content style={contentStyle}>\n            {children}\n          </Content>\n          {isDragging && (\n            <PercentTab>\n              <PercentText isAligned={percentAligned}>{percentText}</PercentText>\n            </PercentTab>\n          )}\n          {!disableInnerButton && !controller.readOnly && !!ColorButton && (\n            <ColorButton\n              controller={controller}\n              bgcolor={background}\n              node={cell}\n              showInnerToolbar={showInnerToolbar}\n            />\n          )}\n        </Wrapper>\n      </ExtraAboveComponent>\n    </React.Fragment>\n  );\n}\n"],"file":"Column.js"}