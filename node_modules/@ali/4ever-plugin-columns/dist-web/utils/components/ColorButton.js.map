{"version":3,"sources":["../../../../src/utils/components/ColorButton.tsx"],"names":["React","styled","Dropdown","ColorPanel","DropdownAnimation","useScrollableContent","IconButton","PaletteNormal","setCellData","DEFAULTS","color","border","bgcolor","PaddingHolder","div","props","showInnerToolbar","visibile","Wrapper","ToolbarWrapper","ColorPanelWrapper","blockEvent","event","stopPropagation","preventDefault","colorToWhite","replace","NewPanel","controller","node","data","fill","handleChange","key","value","run","Toolbar","useState","overlayVisible","setOverlayVisible","visible","setVisible","scrollContent","window","document","body","useEffect","backgroundColor","vi"],"mappings":"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","sourcesContent":["import React from 'react';\nimport styled from 'styled-components';\nimport { Dropdown, ColorPanel } from '@ali/we-design';\nimport { DropdownAnimation } from '@ali/we-util';\nimport { Controller, useScrollableContent } from '@ali/4ever-cangjie';\nimport { IconButton } from '@ali/we-toolbar';\nimport { PaletteNormal } from '@ali/we-icon';\nimport { TableCell } from '@ali/4ever-plugin-table';\nimport { setCellData } from '../actions';\n\nconst DEFAULTS = {\n  color: '',\n  border: '',\n  bgcolor: '',\n};\n\nconst PaddingHolder = styled.div<{\n  showInnerToolbar: boolean;\n  visibile: boolean;\n}>`\n  display: ${(props) => (props.showInnerToolbar ? 'flex' : 'none')};\n  opacity: ${(props) => (props.visibile ? '1' : '0')};\n  flex-direction: row;\n  padding: 0;\n  position: absolute;\n  z-index: 200;\n  top: 3px;\n  right: 3px;\n`;\n\nconst Wrapper = styled.div<{\n  bgcolor: string;\n}>`\n  padding: ${({ bgcolor }) => (bgcolor === 'white' ? '0' : '1px')};\n  border-radius: 4px;\n  transition: background-color 250ms;\n  background-color: ${({ bgcolor }) => bgcolor};\n`;\n\nconst ToolbarWrapper = styled.div`\n  cursor: pointer;\n  border-radius: 4px;\n  transition: background-color 250ms;\n  background-color: rgba(126, 134, 142, 0.15);\n  &:hover {\n    background-color: rgba(126, 134, 142, 0.12);\n  }\n  & div .icon-button {\n    cursor: pointer;\n  }\n`;\n\ninterface IProps {\n  showInnerToolbar: boolean;\n  controller: Controller;\n  bgcolor: string;\n  node: TableCell;\n}\n\nconst ColorPanelWrapper = styled.div`\n  background: white;\n  padding: 8px;\n  border-radius: 4px;\n`;\n\nconst blockEvent = (event: React.MouseEvent) => {\n  event.stopPropagation();\n  event.preventDefault();\n};\n\nconst colorToWhite = (color?: string) => {\n  return (color || 'white').replace('transparent', 'white');\n};\n\nfunction NewPanel({ controller, node }: Omit<IProps, 'showInnerToolbar'>) {\n  const { color, fill: bgcolor, border } = node.data;\n  const handleChange = (key: 'color' | 'fill' | 'border') => (value: any) => {\n    const data = { [key]: value };\n    controller.run('onCangjieBlur');\n    controller.run('onAction', setCellData({ node, data }));\n  };\n\n  return (\n    <ColorPanelWrapper onMouseDown={blockEvent} onClick={blockEvent}>\n      <ColorPanel\n        color={color}\n        defaultColor={DEFAULTS.color}\n        onColorClick={handleChange('color')}\n        borderColor={border}\n        defaultBorderColor={DEFAULTS.border}\n        onBorderColorClick={handleChange('border')}\n        backgroundColor={bgcolor}\n        defaultBackgroundColor={DEFAULTS.bgcolor}\n        onBackgroundColorClick={handleChange('fill')}\n        enableResetButton\n      />\n    </ColorPanelWrapper>\n  );\n}\n\nconst Toolbar: React.FC<IProps> = (props) => {\n  const { showInnerToolbar, bgcolor, node } = props;\n  const [overlayVisible, setOverlayVisible] = React.useState(false);\n  const [visible, setVisible] = React.useState(!showInnerToolbar);\n  const scrollContent = useScrollableContent() || window.document.body;\n  // 加 EmptyContainer 是因为 IconButton 未监听 onMouseEnter 等， trigger=\"hover\" 无法生效\n  React.useEffect(() => {\n    if (!showInnerToolbar) {\n      setOverlayVisible(false);\n    }\n    setVisible(showInnerToolbar);\n  }, [showInnerToolbar]);\n  return (\n    <PaddingHolder showInnerToolbar={showInnerToolbar} visibile={visible}>\n      <Wrapper bgcolor={colorToWhite(bgcolor)}>\n        <ToolbarWrapper>\n          <Dropdown\n            trigger=\"click\"\n            overlay={\n              <DropdownAnimation visible={overlayVisible}>\n                <NewPanel {...props} />\n              </DropdownAnimation>\n            }\n            overlayStyle={{\n              backgroundColor: 'transparent',\n              border: 'none',\n            }}\n            onVisibleChange={(vi) => {\n              setOverlayVisible(vi);\n            }}\n            placement=\"topRight\"\n            visible={overlayVisible}\n            getContainer={() => scrollContent}\n          >\n            <IconButton icon={<PaletteNormal />} />\n          </Dropdown>\n        </ToolbarWrapper>\n      </Wrapper>\n    </PaddingHolder>\n  );\n};\n\nexport default Toolbar;\n"],"file":"ColorButton.js"}