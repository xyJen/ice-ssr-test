{"version":3,"sources":["../../../../src/utils/createMarkFactory/index.ts"],"names":["capitalize","createToolbar","createMenubar","createOnKeyDown","createOnCangjieInput","createToggleMark","createIsQuery","canToggleMark","createContextMenu","createOnAction","oldActions","actions","createRenderToolbarFactory","createMarkFactory","type","hotKey","Button","delimiter","insideWhitespace","Icon","toolbarIcon","localeKeys","moFactory","toolbar","createRenderToolbar","menubar","onKeyDown","onCangjieInput","toggleMark","isQuery","contextMenu","commands","queries","biFactory","config","pluginConfig","key","renderToolbar","locale","onAction","models","klass"],"mappings":"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","sourcesContent":["import { Command, Query, MoFactory, BiPlugin, BiPluginConfig } from '@ali/4ever-cangjie';\nimport { capitalize } from 'lodash-es';\nimport createToolbar from './createToolbar';\nimport createMenubar from './createMenubar';\nimport createOnKeyDown from './handlers/createOnKeyDown';\nimport createOnCangjieInput from './handlers/onCangjieInput';\nimport createToggleMark from './commands/createToggleMark';\nimport createIsQuery from './queries/createIsQuery';\nimport canToggleMark from './queries/canToggleMark';\nimport createContextMenu from './createContextMenu';\nimport createOnAction from './createOnAction';\n/** depreacted 只为兼容，请勿使用 */\nimport * as oldActions from './actions';\nimport { actions } from './actions';\nimport createRenderToolbarFactory from './createRenderToolbar';\nimport type { Delimiter } from '@ali/4ever-utils';\n\nexport interface ICreateMarkFactoryPayload {\n  moFactory?: MoFactory;\n  type: string,\n  hotKey: string,\n  Button: React.ComponentType,\n  delimiter: Delimiter | Delimiter[],\n  insideWhitespace?: boolean,\n  Icon: React.ComponentType,\n  toolbarIcon?: React.ReactElement,\n  localeKeys?: Record<string, string>,\n}\n\nexport function createMarkFactory({ type, hotKey, Button, delimiter, insideWhitespace = false, Icon, toolbarIcon, localeKeys = {}, moFactory }: ICreateMarkFactoryPayload) {\n  const toolbar = createToolbar(type, hotKey, Button, Icon, delimiter);\n  const createRenderToolbar = toolbarIcon && createRenderToolbarFactory({ type, hotKey, toolbarIcon, localeKeys, delimiter });\n  const menubar = createMenubar(type);\n  const onKeyDown = createOnKeyDown(type, hotKey, delimiter, insideWhitespace);\n  const onCangjieInput = createOnCangjieInput(type, delimiter, insideWhitespace);\n  const toggleMark = createToggleMark(type);\n  const isQuery = createIsQuery(type);\n  const contextMenu = createContextMenu(type, hotKey);\n\n  const commands: Record<string, Command> = {\n    [`toggle${capitalize(type)}`]: toggleMark,\n  };\n  const queries: Record<string, Query> = {\n    [`is${capitalize(type)}`]: isQuery,\n    [`canToggle${capitalize(type)}`]: canToggleMark,\n  };\n\n  const  biFactory  = (config: BiPluginConfig): BiPlugin => {\n    const pluginConfig = config[type] || {};\n    return {\n      ...moFactory?.({}),\n      key: type,\n      contextMenu: contextMenu(pluginConfig),\n      toolbar: toolbar(pluginConfig),\n      renderToolbar: createRenderToolbar?.(pluginConfig.locale),\n      menubar: menubar(),\n      actions,\n      commands,\n      queries,\n      onAction: createOnAction(type),\n      onKeyDown,\n      onCangjieInput,\n      models: {\n        klass: 'mark',\n        type,\n      },\n    };\n  }\n\n  // TODO 插件迁移: 待优化\n  biFactory.commands = commands;\n  biFactory.queries = queries;\n  biFactory.actions = oldActions;\n\n  return biFactory;\n}\n"],"file":"index.js"}