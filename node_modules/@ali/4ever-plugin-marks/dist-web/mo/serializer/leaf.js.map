{"version":3,"sources":["../../../../src/mo/serializer/leaf.ts"],"names":["jsonMLAttrsToStyle","jsonMLAttrsToMarks","markToJsonMLAttrs","htmlToJsonMLAttrs","createLeaf","configs","marks","marksConfig","allowedMarks","allowedMarksMap","reduce","acc","k","leafRules","attrs","style","name","curMarks","Object","keys","key","mark"],"mappings":"AACA,SAASA,kBAAkB,IAAlBA,mBAAT;AACA,SAASC,kBAAkB,IAAlBA,mBAAT;AACA,SAASC,iBAAiB,IAAjBA,kBAAT;AACA,SAASC,iBAAiB,IAAjBA,kBAAT;AAEA,OAAO,IAAMC,UAAU,GAAG,SAAbA,UAAa,CAACC,OAAD,EAAuC;AAC/D;AACF;AACA;AAHiE,aAI3BA,OAAO,IAAI,EAJgB;AAAA,wBAIvDC,KAJuD;AAAA,MAIhDC,WAJgD,2BAIlC,EAJkC;;AAAA,MAKvDC,YALuD,GAKtCD,WALsC,CAKvDC,YALuD;AAM/D,MAAMC,eAAe,GAAGD,YAAH,oBAAGA,YAAY,CAAEE,MAAd,CAAqB,UAACC,GAAD,EAAMC,CAAN,EAAY;AACvDD,IAAAA,GAAG,CAACC,CAAD,CAAH,GAAS,IAAT;AACA,WAAOD,GAAP;AACD,GAHuB,EAGrB,EAHqB,CAAxB;AAIA,MAAME,SAAmB,GAAG;AAC1Bb,IAAAA,kBAAkB,EAAE,4BAACc,KAAD,EAAQC,KAAR,EAAkB;AACpC,aAAOf,mBAAkB,CAACc,KAAD,EAAQC,KAAR,CAAzB;AACD,KAHyB;AAI1BZ,IAAAA,iBAAiB,EAAE,2BAACa,IAAD,EAAOF,KAAP,EAAcG,QAAd,EAA2B;AAC5C,UAAIX,KAAK,GAAGH,kBAAiB,CAACa,IAAD,EAAOF,KAAP,EAAcG,QAAd,CAA7B;;AACA,UAAIR,eAAJ,EAAqB;AACnBH,QAAAA,KAAK,GAAGY,MAAM,CAACC,IAAP,CAAYb,KAAZ,EAAmBI,MAAnB,CAA0B,UAACC,GAAD,EAAMS,GAAN,EAAc;AAC9C,cAAIX,eAAe,CAACW,GAAD,CAAnB,EAA0B;AACxBT,YAAAA,GAAG,CAACS,GAAD,CAAH,GAAWd,KAAK,CAACc,GAAD,CAAhB;AACD;;AACD,iBAAOT,GAAP;AACD,SALO,EAKL,EALK,CAAR;AAMD;;AACD,aAAOL,KAAP;AACD,KAfyB;AAgB1BL,IAAAA,kBAAkB,EAAE,4BAACa,KAAD,EAAW;AAC7B,aAAOb,mBAAkB,CAACa,KAAD,CAAzB;AACD,KAlByB;AAmB1BZ,IAAAA,iBAAiB,EAAE,2BAACmB,IAAD,EAAU;AAC3B,aAAOnB,kBAAiB,CAACmB,IAAD,CAAxB;AACD;AArByB,GAA5B;AAuBA,SAAOR,SAAP;AACD,CAlCM","sourcesContent":["import type { LeafRule, MoPluginConfig, TextMark } from '@ali/4ever-cangjie';\nimport { jsonMLAttrsToStyle } from '../../utils/jsonMLAttrsToStyle';\nimport { jsonMLAttrsToMarks } from '../../utils/jsonMLAttrsToMarks';\nimport { markToJsonMLAttrs } from '../../utils/markToJsonMLAttrs';\nimport { htmlToJsonMLAttrs } from '../../utils/htmlToJsonMLAttrs';\n\nexport const createLeaf = (configs: MoPluginConfig): LeafRule => {\n  /**\n   *\n   */\n  const { marks: marksConfig = {} } = configs || {};\n  const { allowedMarks } = marksConfig;\n  const allowedMarksMap = allowedMarks?.reduce((acc, k) => {\n    acc[k] = true;\n    return acc;\n  }, {} as Record<keyof TextMark, true>);\n  const leafRules: LeafRule = {\n    jsonMLAttrsToStyle: (attrs, style) => {\n      return jsonMLAttrsToStyle(attrs, style);\n    },\n    htmlToJsonMLAttrs: (name, attrs, curMarks) => {\n      let marks = htmlToJsonMLAttrs(name, attrs, curMarks);\n      if (allowedMarksMap) {\n        marks = Object.keys(marks).reduce((acc, key) => {\n          if (allowedMarksMap[key]) {\n            acc[key] = marks[key];\n          }\n          return acc;\n        }, {});\n      }\n      return marks;\n    },\n    jsonMLAttrsToMarks: (attrs) => {\n      return jsonMLAttrsToMarks(attrs);\n    },\n    markToJsonMLAttrs: (mark) => {\n      return markToJsonMLAttrs(mark);\n    },\n  };\n  return leafRules;\n};\n"],"file":"leaf.js"}