{"version":3,"sources":["../../../../src/bi/commands/removeRangesBoldMark.ts"],"names":["removeRangesBoldMark","controller","document","value","ranges","forEach","range","rangeBlocks","getLeafBlocksAtRange","boldMark","Bold","create","length","Heading","isHeading","TYPE","start","end","convertToTextPoints","startBlock","getClosestBlock","key","endBlock","block","blockRange","moveEndToEndOfNode","moveStartToStartOfNode","undefined"],"mappings":";;;;;;;AACA;;AACA;;AACA;;AAEe,SAASA,oBAAT,CAA8BC,UAA9B,EAAsD;AACnE,QAAM;AAAEC,IAAAA;AAAF,MAAeD,UAAU,CAACE,KAAhC;AACA,QAAMC,MAAM,GAAG,oCAAoBH,UAApB,CAAf;AAEAG,EAAAA,MAAM,CAACC,OAAP,CAAgBC,KAAD,IAAW;AACxB,UAAMC,WAAW,GAAGL,QAAQ,CAACM,oBAAT,CAA8BF,KAA9B,CAApB;;AACA,UAAMG,QAAQ,GAAGC,aAAKC,MAAL,CAAY,KAAZ,CAAjB;;AACA,QAAIJ,WAAW,CAACK,MAAZ,KAAuB,CAA3B,EAA8B;AAC5B;AACA,UAAIC,2BAAQC,SAAR,CAAkBP,WAAW,CAAC,CAAD,CAA7B,CAAJ,EAAuC;AACrC,eAAO,+BAAeN,UAAf,EAA2BK,KAA3B,EAAkCG,QAAlC,CAAP;AACD;;AACD,aAAO,kCAAkBR,UAAlB,EAA8BK,KAA9B,EAAqCI,aAAKK,IAA1C,CAAP;AACD;;AAED,UAAM;AAAEC,MAAAA,KAAF;AAASC,MAAAA;AAAT,QAAiBX,KAAK,CAACY,mBAAN,CAA0BhB,QAA1B,CAAvB;AACA,UAAMiB,UAAU,GAAGjB,QAAQ,CAACkB,eAAT,CAAyBJ,KAAK,CAACK,GAA/B,CAAnB;AACA,UAAMC,QAAQ,GAAGpB,QAAQ,CAACkB,eAAT,CAAyBH,GAAG,CAACI,GAA7B,CAAjB;AAEAd,IAAAA,WAAW,CAACF,OAAZ,CAAqBkB,KAAD,IAAW;AAC7B,UAAIC,UAAJ;;AACA,UAAID,KAAK,CAACF,GAAN,KAAcF,UAAU,EAAEE,GAA9B,EAAmC;AACjCG,QAAAA,UAAU,GAAGlB,KAAK,CAACmB,kBAAN,CAAyBF,KAAzB,EAAgCtB,UAAhC,CAAb;AACD,OAFD,MAEO,IAAIsB,KAAK,CAACF,GAAN,KAAcC,QAAQ,EAAED,GAA5B,EAAiC;AACtCG,QAAAA,UAAU,GAAGlB,KAAK,CAACoB,sBAAN,CAA6BH,KAA7B,EAAoCtB,UAApC,CAAb;AACD,OAFM,MAEA;AACLuB,QAAAA,UAAU,GAAGlB,KAAK,CAACoB,sBAAN,CAA6BH,KAA7B,EAAoCtB,UAApC,EAAgDwB,kBAAhD,CAAmEF,KAAnE,EAA0EtB,UAA1E,CAAb;AACD;;AAED,UAAIY,2BAAQC,SAAR,CAAkBS,KAAlB,CAAJ,EAA8B;AAC5B,uCAAetB,UAAf,EAA2BuB,UAA3B,EAAuCf,QAAvC;AACD,OAFD,MAEO;AACL,0CAAkBR,UAAlB,EAA8BuB,UAA9B,EAA0Cd,aAAKK,IAA/C;AACD;AACF,KAfD;AAiBA,WAAOY,SAAP;AACD,GAjCD;AAmCA,SAAO1B,UAAP;AACD","sourcesContent":["import { Controller } from '@ali/4ever-cangjie';\nimport { Heading } from '@ali/4ever-plugin-heading';\nimport { getRangesFromEditor, addMarkAtRange, removeMarkAtRange }  from '@ali/4ever-utils';\nimport { Bold } from '../../mo/models';\n\nexport default function removeRangesBoldMark(controller: Controller) {\n  const { document } = controller.value;\n  const ranges = getRangesFromEditor(controller);\n\n  ranges.forEach((range) => {\n    const rangeBlocks = document.getLeafBlocksAtRange(range);\n    const boldMark = Bold.create(false);\n    if (rangeBlocks.length === 1) {\n      // 选区未跨段落\n      if (Heading.isHeading(rangeBlocks[0])) {\n        return addMarkAtRange(controller, range, boldMark);\n      }\n      return removeMarkAtRange(controller, range, Bold.TYPE);\n    }\n\n    const { start, end } = range.convertToTextPoints(document);\n    const startBlock = document.getClosestBlock(start.key);\n    const endBlock = document.getClosestBlock(end.key);\n\n    rangeBlocks.forEach((block) => {\n      let blockRange;\n      if (block.key === startBlock?.key) {\n        blockRange = range.moveEndToEndOfNode(block, controller);\n      } else if (block.key === endBlock?.key) {\n        blockRange = range.moveStartToStartOfNode(block, controller);\n      } else {\n        blockRange = range.moveStartToStartOfNode(block, controller).moveEndToEndOfNode(block, controller);\n      }\n\n      if (Heading.isHeading(block)) {\n        addMarkAtRange(controller, blockRange, boldMark);\n      } else {\n        removeMarkAtRange(controller, blockRange, Bold.TYPE);\n      }\n    });\n\n    return undefined;\n  });\n\n  return controller;\n}\n"],"file":"removeRangesBoldMark.js"}