import { Path } from '@ali/4ever-cangjie';
import { sortNodeKeys } from "./sortNodeKeys";
export function isSequent(keys, controller) {
  var document = controller.value.document;
  var sortedNodeKeys = sortNodeKeys(keys, document);
  var length = sortedNodeKeys.length;
  return sortedNodeKeys.every(function (key, index) {
    if (index < length - 1) {
      var nextKey = sortedNodeKeys[index + 1];
      var path = document.getPath(key);
      var nextPath = document.getPath(nextKey);

      if (path && nextPath) {
        if (Path.isSibling(path, nextPath) && (path.at(-1) || 0) - (nextPath.at(-1) || 0) === -1) {
          return true;
        }

        var node = document.getNode(key);
        var nextNode = document.getNode(sortedNodeKeys[index + 1]);
        var isColumnsChild = controller.query('isColumnsChild', node);
        var isNextNodeColumnsChild = controller.query('isColumnsChild', nextNode);

        if (isColumnsChild || isNextNodeColumnsChild) {
          if (!isColumnsChild) {
            var nextColumnsPath = Path.parent(Path.parent(nextPath));

            if (Path.isSibling(path, nextColumnsPath) && nextPath.at(-1) === 0 && path.at(-1) - nextColumnsPath.at(-1) === -1) {
              return true;
            }
          } else if (!isNextNodeColumnsChild) {
            var columnsRowPath = Path.parent(path);
            var columnsPath = Path.parent(Path.parent(path));
            var columnsNum = document.getNodeByPath(columnsRowPath).nodes.length;
            return Path.isSibling(columnsPath, nextPath) && path.at(-1) === columnsNum - 1 && columnsPath.at(-1) - nextPath.at(-1) === -1;
          } else {
            var _nextColumnsPath = Path.parent(Path.parent(nextPath));

            var _columnsRowPath = Path.parent(path);

            var _columnsPath = Path.parent(Path.parent(path));

            var _columnsNum = document.getNodeByPath(_columnsRowPath).nodes.length;
            return Path.isSibling(_columnsPath, _nextColumnsPath) && path.at(-1) === _columnsNum - 1 && nextPath.at(-1) === 0 && _columnsPath.at(-1) - _nextColumnsPath.at(-1) === -1;
          }
        }

        return false;
      }
    }

    return true;
  });
}
//# sourceMappingURL=isSequent.js.map